{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44732","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44732/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44732/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44732/events","html_url":"https://github.com/elastic/elasticsearch/issues/44732","id":471501384,"node_id":"MDU6SXNzdWU0NzE1MDEzODQ=","number":44732,"title":" Unclosed object or array found","user":{"login":"laijianbin","id":26161527,"node_id":"MDQ6VXNlcjI2MTYxNTI3","avatar_url":"https://avatars2.githubusercontent.com/u/26161527?v=4","gravatar_id":"","url":"https://api.github.com/users/laijianbin","html_url":"https://github.com/laijianbin","followers_url":"https://api.github.com/users/laijianbin/followers","following_url":"https://api.github.com/users/laijianbin/following{/other_user}","gists_url":"https://api.github.com/users/laijianbin/gists{/gist_id}","starred_url":"https://api.github.com/users/laijianbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/laijianbin/subscriptions","organizations_url":"https://api.github.com/users/laijianbin/orgs","repos_url":"https://api.github.com/users/laijianbin/repos","events_url":"https://api.github.com/users/laijianbin/events{/privacy}","received_events_url":"https://api.github.com/users/laijianbin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-07-23T06:03:11Z","updated_at":"2019-07-23T07:05:47Z","closed_at":"2019-07-23T06:43:26Z","author_association":"NONE","active_lock_reason":null,"body":"I meet a bug ,can you help me find the cause\r\nThanks\r\n\r\n<!-- Feature request -->\r\nI am use ealsticsearch for batch save\r\n\r\n<!-- Bug report -->\r\nelasticsearch: 6.8.0\r\nOS: window 7\r\nJVM: 1.8.0_201\r\nPlugins installed : None\r\n\r\n**Bug demo sample**\r\n\r\npublic static List<BulkItemResponse> batchSave(RestHighLevelClient client, String index, String type,\r\n\t\t\tList<Map<String, Object>> listMap) throws IOException {\r\n\t\tBulkRequest req = new BulkRequest();\r\n\t\treq.setRefreshPolicy(RefreshPolicy.IMMEDIATE);\r\n\t\tfor (Map<String, Object> map : listMap) {\r\n\t\t\tObject esIdObj = map.get(\"_id\");\r\n\t\t\tmap.remove(\"_id\", esIdObj);\r\n\t\t\tIndexRequest indexRequest = new IndexRequest(index, type, String.valueOf(esIdObj)).source(map);\r\n\t\t\tUpdateRequest updateRequest = new UpdateRequest(index, type, String.valueOf(esIdObj))\r\n\t\t\t\t\t.upsert(indexRequest);\r\n\t\t\tupdateRequest.doc(indexRequest);\r\n\t\t\treq.add(updateRequest);\r\n\t\t}\r\n\t\tBulkResponse res = null;\r\n\t\ttry {\r\n\t\t\tres = client.bulk(req, RequestOptions.DEFAULT);\r\n\t\t} catch (IOException e) {\r\n\t\t\tthrow new IOException(e);\r\n\t\t}\r\n\t\tList<BulkItemResponse> failureRespList = new ArrayList<>();\r\n\t\tif (res.hasFailures()) {\r\n\t\t\tfor (BulkItemResponse resp : res.getItems()) {\r\n\t\t\t\tif (resp.isFailed()) {\r\n\t\t\t\t\tfailureRespList.add(resp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn failureRespList;\r\n\t}\r\n\r\n**The log**\r\n\r\n`Exception in thread \"main\" java.lang.NoSuchMethodError: org.elasticsearch.action.DocWriteRequest.ifSeqNo()J\r\n\tat org.elasticsearch.client.RequestConverters.bulk(RequestConverters.java:197)\r\n\tat org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1760)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1734)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1696)\r\n\tat org.elasticsearch.client.RestHighLevelClient.bulk(RestHighLevelClient.java:472)\r\n\tat fulltext.storage.http.impl.HighLevelClient.batchSave(HighLevelClient.java:198)\r\n\tat fulltext.storage.http.impl.HighLevelClient.main(HighLevelClient.java:99)\r\n\tSuppressed: java.lang.IllegalStateException: Failed to close the XContentBuilder\r\n\t\tat org.elasticsearch.common.xcontent.XContentBuilder.close(XContentBuilder.java:1002)\r\n\t\tat org.elasticsearch.client.RequestConverters.bulk(RequestConverters.java:163)\r\n\t\t... 6 more\r\n\tCaused by: java.io.IOException: Unclosed object or array found\r\n\t\tat org.elasticsearch.common.xcontent.json.JsonXContentGenerator.close(JsonXContentGenerator.java:469)\r\n\t\tat org.elasticsearch.common.xcontent.XContentBuilder.close(XContentBuilder.java:1000)\r\n\t\t... 7 more`\r\n\r\n\r\n**Maven dependencies**\r\n\r\n<dependencies>\r\n\t\t<dependency>\r\n\t\t\t<groupId>org.elasticsearch.client</groupId>\r\n\t\t\t<artifactId>elasticsearch-rest-high-level-client</artifactId>\r\n\t\t\t<version>6.8.0</version>\r\n\t\t</dependency>\r\n\t\t<dependency>\r\n\t\t\t<groupId>org.elasticsearch</groupId>\r\n\t\t\t<artifactId>elasticsearch</artifactId>\r\n\t\t\t<version>6.8.0</version>\r\n\t\t</dependency>\r\n\t</dependencies>","closed_by":{"login":"laijianbin","id":26161527,"node_id":"MDQ6VXNlcjI2MTYxNTI3","avatar_url":"https://avatars2.githubusercontent.com/u/26161527?v=4","gravatar_id":"","url":"https://api.github.com/users/laijianbin","html_url":"https://github.com/laijianbin","followers_url":"https://api.github.com/users/laijianbin/followers","following_url":"https://api.github.com/users/laijianbin/following{/other_user}","gists_url":"https://api.github.com/users/laijianbin/gists{/gist_id}","starred_url":"https://api.github.com/users/laijianbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/laijianbin/subscriptions","organizations_url":"https://api.github.com/users/laijianbin/orgs","repos_url":"https://api.github.com/users/laijianbin/repos","events_url":"https://api.github.com/users/laijianbin/events{/privacy}","received_events_url":"https://api.github.com/users/laijianbin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}