{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/46084","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46084/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46084/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46084/events","html_url":"https://github.com/elastic/elasticsearch/issues/46084","id":486451853,"node_id":"MDU6SXNzdWU0ODY0NTE4NTM=","number":46084,"title":"Elasticsearch service failed (OutOfMemoryError)","user":{"login":"smerzlyakov","id":1043736,"node_id":"MDQ6VXNlcjEwNDM3MzY=","avatar_url":"https://avatars0.githubusercontent.com/u/1043736?v=4","gravatar_id":"","url":"https://api.github.com/users/smerzlyakov","html_url":"https://github.com/smerzlyakov","followers_url":"https://api.github.com/users/smerzlyakov/followers","following_url":"https://api.github.com/users/smerzlyakov/following{/other_user}","gists_url":"https://api.github.com/users/smerzlyakov/gists{/gist_id}","starred_url":"https://api.github.com/users/smerzlyakov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smerzlyakov/subscriptions","organizations_url":"https://api.github.com/users/smerzlyakov/orgs","repos_url":"https://api.github.com/users/smerzlyakov/repos","events_url":"https://api.github.com/users/smerzlyakov/events{/privacy}","received_events_url":"https://api.github.com/users/smerzlyakov/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-08-28T15:24:41Z","updated_at":"2019-08-28T16:35:35Z","closed_at":"2019-08-28T16:08:14Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n7.2.0\r\n**Plugins installed**: [-]\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"11.0.3\" 2019-04-16 LTS\r\nOpenJDK Runtime Environment 18.9 (build 11.0.3+7-LTS)\r\nOpenJDK 64-Bit Server VM 18.9 (build 11.0.3+7-LTS, mixed mode, sharing)\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n(Centos 7) Linux  4.19.36-1.mru1.x86_64 #1 SMP Wed Apr 24 16:52:53 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n**Description of the problem including expected versus actual behavior**:\r\nsystemd[1]: elasticsearch.service failed.\r\n**Steps to reproduce**:\r\nTime to time Elasticsearch service stops. Last time i restart Logstash instance.\r\n**Provide logs (if relevant)**:\r\n/var/log/elasticsearch/elk.log\r\n\r\n```\r\n[2019-08-28T16:49:01,510][WARN ][o.e.m.j.JvmGcMonitorService] [node-7] [gc][446899] overhead, spent [873ms] collecting in the last [1s]\r\n[2019-08-28T16:49:02,022][ERROR][o.e.ExceptionsHelper     ] [node-7] fatal error\r\n        at org.elasticsearch.ExceptionsHelper.lambda$maybeDieOnAnotherThread$2(ExceptionsHelper.java:310)\r\n        at java.base/java.util.Optional.ifPresent(Optional.java:183)\r\n        at org.elasticsearch.ExceptionsHelper.maybeDieOnAnotherThread(ExceptionsHelper.java:300)\r\n        at org.elasticsearch.transport.netty4.Netty4TcpChannel.lambda$addPromise$1(Netty4TcpChannel.java:88)\r\n        at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:502)\r\n        at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:476)\r\n        at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:415)\r\n        at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:540)\r\n        at io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:533)\r\n        at io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:114)\r\n        at io.netty.util.concurrent.PromiseCombiner.tryPromise(PromiseCombiner.java:170)\r\n        at io.netty.util.concurrent.PromiseCombiner.access$600(PromiseCombiner.java:35)\r\n        at io.netty.util.concurrent.PromiseCombiner$1.operationComplete0(PromiseCombiner.java:62)\r\n        at io.netty.util.concurrent.PromiseCombiner$1.operationComplete(PromiseCombiner.java:44)\r\n        at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:502)\r\n        at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:476)\r\n        at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:415)\r\n        at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:540)\r\n        at io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:533)\r\n        at io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:114)\r\n        at io.netty.util.internal.PromiseNotificationUtil.tryFailure(PromiseNotificationUtil.java:64)\r\n        at io.netty.channel.ChannelOutboundBuffer.safeFail(ChannelOutboundBuffer.java:721)\r\n        at io.netty.channel.ChannelOutboundBuffer.remove0(ChannelOutboundBuffer.java:306)\r\n        at io.netty.channel.ChannelOutboundBuffer.failFlushed(ChannelOutboundBuffer.java:658)\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.closeOutboundBufferForShutdown(AbstractChannel.java:686)\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.shutdownOutput(AbstractChannel.java:679)\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.flush0(AbstractChannel.java:954)\r\n        at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.flush0(AbstractNioChannel.java:360)\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.flush(AbstractChannel.java:906)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.flush(DefaultChannelPipeline.java:1370)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:754)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:746)\r\n        at io.netty.channel.AbstractChannelHandlerContext.flush(AbstractChannelHandlerContext.java:732)\r\n        at io.netty.channel.ChannelDuplexHandler.flush(ChannelDuplexHandler.java:127)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:754)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:746)\r\n        at io.netty.channel.AbstractChannelHandlerContext.access$2100(AbstractChannelHandlerContext.java:56)\r\n        at io.netty.channel.AbstractChannelHandlerContext$WriteAndFlushTask.write(AbstractChannelHandlerContext.java:1155)\r\n        at io.netty.channel.AbstractChannelHandlerContext$AbstractWriteTask.run(AbstractChannelHandlerContext.java:1078)\r\nat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:405)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:500)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:906)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at java.base/java.lang.Thread.run(Thread.java:835)\r\n[2019-08-28T16:49:02,029][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-7] fatal error in thread [Thread-4], exiting\r\njava.lang.OutOfMemoryError: Direct buffer memory\r\n        at java.nio.Bits.reserveMemory(Bits.java:175) ~[?:?]\r\n        at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:118) ~[?:?]\r\n        at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:317) ~[?:?]\r\n        at sun.nio.ch.Util.getTemporaryDirectBuffer(Util.java:242) ~[?:?]\r\n        at sun.nio.ch.IOUtil.write(IOUtil.java:164) ~[?:?]\r\n        at sun.nio.ch.IOUtil.write(IOUtil.java:130) ~[?:?]\r\n        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:496) ~[?:?]\r\n        at io.netty.channel.socket.nio.NioSocketChannel.doWrite(NioSocketChannel.java:420) ~[?:?]\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.flush0(AbstractChannel.java:939) ~[?:?]\r\n        at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.flush0(AbstractNioChannel.java:360) ~[?:?]\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.flush(AbstractChannel.java:906) ~[?:?]\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.flush(DefaultChannelPipeline.java:1370) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:754) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:746) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.flush(AbstractChannelHandlerContext.java:732) ~[?:?]\r\n        at io.netty.channel.ChannelDuplexHandler.flush(ChannelDuplexHandler.java:127) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:754) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:746) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.access$2100(AbstractChannelHandlerContext.java:56) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext$WriteAndFlushTask.write(AbstractChannelHandlerContext.java:1155) ~[?:?]\r\nat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:405)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:500)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:906)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at java.base/java.lang.Thread.run(Thread.java:835)\r\n[2019-08-28T16:49:02,029][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-7] fatal error in thread [Thread-4], exiting\r\njava.lang.OutOfMemoryError: Direct buffer memory\r\n        at java.nio.Bits.reserveMemory(Bits.java:175) ~[?:?]\r\n        at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:118) ~[?:?]\r\n        at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:317) ~[?:?]\r\n        at sun.nio.ch.Util.getTemporaryDirectBuffer(Util.java:242) ~[?:?]\r\n        at sun.nio.ch.IOUtil.write(IOUtil.java:164) ~[?:?]\r\n        at sun.nio.ch.IOUtil.write(IOUtil.java:130) ~[?:?]\r\n        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:496) ~[?:?]\r\n        at io.netty.channel.socket.nio.NioSocketChannel.doWrite(NioSocketChannel.java:420) ~[?:?]\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.flush0(AbstractChannel.java:939) ~[?:?]\r\n        at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.flush0(AbstractNioChannel.java:360) ~[?:?]\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.flush(AbstractChannel.java:906) ~[?:?]\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.flush(DefaultChannelPipeline.java:1370) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:754) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:746) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.flush(AbstractChannelHandlerContext.java:732) ~[?:?]\r\n        at io.netty.channel.ChannelDuplexHandler.flush(ChannelDuplexHandler.java:127) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:754) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:746) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext.access$2100(AbstractChannelHandlerContext.java:56) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext$WriteAndFlushTask.write(AbstractChannelHandlerContext.java:1155) ~[?:?]\r\n        at io.netty.channel.AbstractChannelHandlerContext$AbstractWriteTask.run(AbstractChannelHandlerContext.java:1078) ~[?:?]\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) ~[?:?]\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:405) ~[?:?]\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:500) ~[?:?]\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:906) ~[?:?]\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[?:?]\r\n        at java.lang.Thread.run(Thread.java:835) [?:?]\r\n\r\n\r\n\r\n```","closed_by":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"performed_via_github_app":null}