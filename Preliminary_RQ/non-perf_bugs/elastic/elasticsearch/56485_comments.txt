[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/626210205","html_url":"https://github.com/elastic/elasticsearch/issues/56485#issuecomment-626210205","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56485","id":626210205,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNjIxMDIwNQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2020-05-09T17:33:00Z","updated_at":"2020-05-09T17:33:00Z","author_association":"MEMBER","body":"@nooneuse I'm not sure this is something worth optimizing. In the end, we'd only optimize the path for sending out `429` responses. But those `429` responses are supposed to make the client back off and send requests at a slower rate to begin with. The idea behind this kind of backpressure architecture is to give clients the ability to back off and reduce their request rate. The system is not designed to be in a steady state of full queues permanently.\r\n\r\nSo with properly behaving clients that reduce their request rate so that queues aren't permanently full, optimizing this path achieves nothing pretty much since they'd back off anyway removing the issue of contention on the `.toString` call quickly.\r\nWith badly behaved clients that constantly exceed the request rate that the cluster can handle without backing off on the other hand, nothing is achieved as well I think. Enabling those clients to send requests that mostly result in `429`s at a higher rate might mean wasting even more resources (memory, network IO, etc.) in a situation that should be fixed on the client-side.\r\n\r\nDoes that make sense, or can you see a situation where optimizing the `429` path achieves anything productive? (I would add that in practice having the detailed information about those queues available has been helpful in the past often times)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/627121719","html_url":"https://github.com/elastic/elasticsearch/issues/56485#issuecomment-627121719","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56485","id":627121719,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNzEyMTcxOQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2020-05-12T05:39:26Z","updated_at":"2020-05-12T05:39:26Z","author_association":"MEMBER","body":"Closing here for now due to lack of feedback for now, please reopen if you think there's still an issue here.","performed_via_github_app":null}]