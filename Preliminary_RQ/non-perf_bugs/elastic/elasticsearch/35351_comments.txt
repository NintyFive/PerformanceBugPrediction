[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436755549","html_url":"https://github.com/elastic/elasticsearch/issues/35351#issuecomment-436755549","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35351","id":436755549,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjc1NTU0OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-11-07T19:52:54Z","updated_at":"2018-11-07T19:52:54Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436772734","html_url":"https://github.com/elastic/elasticsearch/issues/35351#issuecomment-436772734","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35351","id":436772734,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjc3MjczNA==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2018-11-07T20:51:30Z","updated_at":"2018-11-07T20:51:30Z","author_association":"CONTRIBUTOR","body":"Here is a reproduction case:\r\n```\r\nDELETE test\r\nPOST test/_doc/_bulk\r\n{ \"index\" :{}}\r\n{ \"foo\" : 1}\r\n{ \"index\" :{}}\r\n{ \"foo\" : 2 }\r\n{ \"index\" :{}}\r\n{ \"foo\" : 3 }\r\n\r\nPOST /test/_search\r\n{\r\n  \"size\": 0,\r\n  \"aggs\": {\r\n    \"foo\": {\r\n      \"date_histogram\": {\r\n        \"field\": \"foo\",\r\n        \"interval\": \"1ms\"\r\n      },\r\n      \"aggs\": {\r\n        \"mymax\": {\r\n          \"max\": {\r\n            \"field\": \"foo\"\r\n          }\r\n        },\r\n        \"mybucket_script\": {\r\n          \"bucket_script\": {\r\n            \"buckets_path\": {\r\n              \"mymax\": \"mymax\"\r\n            },\r\n            \"script\": \"params.mymax > 0 ? params.mymax : 0\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nAll is good... now introduce a `0`\r\n```\r\nPOST test/_doc\r\n{\r\n  \"foo\": 0\r\n}\r\n```\r\nRe-run the search and \r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"\",\r\n    \"phase\": \"fetch\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [],\r\n    \"caused_by\": {\r\n      \"type\": \"script_exception\",\r\n      \"reason\": \"runtime error\",\r\n      \"script_stack\": [\r\n        \"params.mymax > 0 ? params.mymax : 0\",\r\n        \"^---- HERE\"\r\n      ],\r\n      \"script\": \"params.mymax > 0 ? params.mymax : 0\",\r\n      \"lang\": \"painless\",\r\n      \"caused_by\": {\r\n        \"type\": \"class_cast_exception\",\r\n        \"reason\": \"java.lang.Integer cannot be cast to java.lang.Double\"\r\n      }\r\n    }\r\n  },\r\n  \"status\": 503\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436778935","html_url":"https://github.com/elastic/elasticsearch/issues/35351#issuecomment-436778935","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35351","id":436778935,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjc3ODkzNQ==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2018-11-07T21:12:07Z","updated_at":"2018-11-07T21:12:07Z","author_association":"CONTRIBUTOR","body":"Briefly talked to @rjernst about this.  I'm thinking over the behavior of return values in Painless.  It's possible it makes more sense to make a change to casting model in the singular case because it will be better for the user.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436889807","html_url":"https://github.com/elastic/elasticsearch/issues/35351#issuecomment-436889807","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35351","id":436889807,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjg4OTgwNw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2018-11-08T06:42:13Z","updated_at":"2018-11-08T06:42:13Z","author_association":"MEMBER","body":"@jdconrad @rjernst \r\n\r\n> My recommended fix is to have this context return Object for now until we can come up with a better solution for deprecation.\r\n\r\nI'd be in favour of this as a short-term fix. We did exactly this elsewhere too when trying to make the new contexts return a specific type and running into trouble.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/439519442","html_url":"https://github.com/elastic/elasticsearch/issues/35351#issuecomment-439519442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35351","id":439519442,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTUxOTQ0Mg==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2018-11-16T20:36:10Z","updated_at":"2018-11-16T20:36:10Z","author_association":"CONTRIBUTOR","body":"Fixed by #35653 ","performed_via_github_app":null}]