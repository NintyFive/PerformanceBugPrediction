[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136415042","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-136415042","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":136415042,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjQxNTA0Mg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-08-31T15:59:59Z","updated_at":"2015-08-31T15:59:59Z","author_association":"CONTRIBUTOR","body":"I think some of these may be worth importing directly - `Splitter` and `Joiner` come to mind. They are cute and convenient. We should just be careful not to drift from Guava's source or upgrades will be difficult.\n\nI think other of these - `newHashMap`, `newHashSet`, `filtering`, etc, are worth banning and removing entirely because they just aren't that useful. The `new*` methods in particular are pretty much obsolete with the diamond operator.\n\nI guess what I'm getting at is that we should handle each of these in a case by case basic.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136471068","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-136471068","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":136471068,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjQ3MTA2OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-08-31T19:10:25Z","updated_at":"2015-08-31T19:11:43Z","author_association":"MEMBER","body":"Removing the v2.1.0 label; I suspect that some of these will stick around for convenience until we migrate to Java 8 and can replace uses of things like `Iterables.filter`/`Predicate` with `Stream.filter`/native `Predicate`.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137370669","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-137370669","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":137370669,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzM3MDY2OQ==","user":{"login":"xuzha","id":1799964,"node_id":"MDQ6VXNlcjE3OTk5NjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/1799964?v=4","gravatar_id":"","url":"https://api.github.com/users/xuzha","html_url":"https://github.com/xuzha","followers_url":"https://api.github.com/users/xuzha/followers","following_url":"https://api.github.com/users/xuzha/following{/other_user}","gists_url":"https://api.github.com/users/xuzha/gists{/gist_id}","starred_url":"https://api.github.com/users/xuzha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xuzha/subscriptions","organizations_url":"https://api.github.com/users/xuzha/orgs","repos_url":"https://api.github.com/users/xuzha/repos","events_url":"https://api.github.com/users/xuzha/events{/privacy}","received_events_url":"https://api.github.com/users/xuzha/received_events","type":"User","site_admin":false},"created_at":"2015-09-03T07:57:38Z","updated_at":"2015-09-03T07:57:38Z","author_association":"CONTRIBUTOR","body":"Just came across to google.io tonight, not sure if @jasontedor or others has been working on it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138149566","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-138149566","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":138149566,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODE0OTU2Ng==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-07T01:12:05Z","updated_at":"2015-09-07T01:12:05Z","author_association":"CONTRIBUTOR","body":"Can we talk about `com.google.common.base.Preconditions`? I kind of like it for times when you don't want an `assert`. I find its generally less clutter-y than lots of `if`s.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138153399","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-138153399","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":138153399,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODE1MzM5OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-09-07T01:37:24Z","updated_at":"2015-09-07T01:37:24Z","author_association":"MEMBER","body":"Do we need more than `checkArgument`? We can replace all the `checkNotNull` with `Objects.requireNonNull`. And `checkArgument` is a super simple method...doesn't seem worthwhile to keep an entire complex library around just for that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138168741","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-138168741","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":138168741,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODE2ODc0MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-09-07T03:17:29Z","updated_at":"2015-09-07T03:21:32Z","author_association":"MEMBER","body":"@nik9000:\n\n> Can we talk about com.google.common.base.Preconditions? I kind of like it for times when you don't want an assert. I find its generally less clutter-y than lots of ifs.\n\nHave you seen the comment regarding the use of these method in the [Javadocs](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/base/Preconditions.html#checkArgument%28boolean%29), specifically:\n\n> Remember that parameter values for message construction must all be computed eagerly, and autoboxing and varargs array creation may happen as well, even when the precondition check then succeeds (as it should almost always do in production). In some circumstances these wasted CPU cycles and allocations can add up to a real problem. Performance-sensitive precondition checks can always be converted to the customary form\n\nReducing object churn in Elasticsearch is immensely important because a garbage collection cycle is no different than a network partition from a failure perspective. Increasing the chance of long runtime latencies from excessive garbage collection cycles is detrimental to cluster health.\n\nThis is not to say that all uses of `checkArgument` and similar methods from `Preconditions` are problematic, but it is to raise awareness of an issue that these convenience methods can contribute to.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138168796","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-138168796","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":138168796,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODE2ODc5Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-09-07T03:17:41Z","updated_at":"2015-09-07T03:17:41Z","author_association":"MEMBER","body":"@rjernst:\n\n> And `checkArgument` is a super simple method...doesn't seem worthwhile to keep an entire complex library around just for that.\n\n+1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138170494","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-138170494","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":138170494,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODE3MDQ5NA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-09-07T03:27:10Z","updated_at":"2015-09-10T00:28:45Z","author_association":"MEMBER","body":"This should not be taken as a judgement on Guava. Guava is a popular library, and for good reasons. But the rationale here is rather simple:\n- All else equal, fewer dependencies is a positive.\n- A lot of the benefits of Guava have been supplanted by additions to the JDK in JDK 7 and JDK 8 (e.g., the diamond operator, lambdas, and streams).\n- We are no longer shading dependencies in the Elasticsearch jar (see #13252).\n- We do not have a proper Java client today; this means that developers that depend on the Elasticsearch jar are likely going to have to deal with Guava version conflicts (which are likely since Guava is popular).\n- Developers do embed Elasticsearch inside web containers which creates conflicts with the provided versions of Guava.\n- Plugin developers encounter issues with Guava version conflicts (again, because Guava is popular).\n\nIn short, the internal benefits have been reduced, and there are external benefits to developers to removing Guava.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138291342","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-138291342","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":138291342,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODI5MTM0Mg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-07T12:58:00Z","updated_at":"2015-09-07T12:58:00Z","author_association":"CONTRIBUTOR","body":"> And checkArgument is a super simple method...doesn't seem worthwhile to keep an entire complex library around just for that.\n\nI wasn't clear - I'm not advocating that. I'm advocating that we consider importing Preconditions, or at least portions of it rather than rewriting them all at the call sight.\n\n> Reducing object churn in Elasticsearch is immensely important because a garbage collection cycle is no different than a network partition from a failure perspective. Increasing the chance of long runtime latencies from excessive garbage collection cycles is detrimental to cluster health.\n\nI like this argument much better. To me it goes like this:\n1. We want to reduce our object allocation rate.\n2. `checkArgument` and its ilk always attempt to make your code more readable at the cost of potentially more allocations.\n3. This is often a fine tradeoff but for Elasticsearch its never what we want because of point 1.\n4. Its worse because the places where it is a fine tradeoff aren't always obvious in Elasticsearch. Put another way, it can be difficult to tell when you are in a commonly called code path. So its never worth the risk for the small readability payoff.\n\nI promise I won't freak out about all the parts of Guava. Its clearly fine to replace `Charsets.UTF_8` with `StandardCharsets.UTF_8` for example.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138299634","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-138299634","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":138299634,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODI5OTYzNA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-09-07T13:31:10Z","updated_at":"2015-09-10T00:28:21Z","author_association":"MEMBER","body":"@nik9000:\n\n> I like this argument much better. To me it goes like this:\n> 1. We want to reduce our object allocation rate.\n> 2. `checkArgument` and its ilk always attempt to make your code more readable at the cost of potentially more allocations.\n> 3. This is often a fine tradeoff but for Elasticsearch its never what we want because of point 1.\n> 4. Its worse because the places where it is a fine tradeoff aren't always obvious in Elasticsearch. Put another way, it can be difficult to tell when you are in a commonly called code path. So its never worth the risk for the small readability payoff.\n\nExactly. Tangentially, another place to be aware of this is calls to `logger.(debug|error|info|trace|warn)`; any invocations of these that are allocating strings (e.g., via concatenation or calls to `Object#toString`) to build the method parameters whether or not the corresponding log level is turned on contribute to object churn. In cases where there are allocations occurring, it's best to wrap the calls in the corresponding check against the `logger.is(Debug|Error|Info|Trace|Warn)Enabled` method. I've seen exactly this problem wreak havoc on HBase region server heaps.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142914616","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-142914616","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":142914616,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjkxNDYxNg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-24T12:29:42Z","updated_at":"2015-09-24T12:29:42Z","author_association":"CONTRIBUTOR","body":"I squashed the incomplete items together in the list to make the remaining work easier to read.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/145155429","html_url":"https://github.com/elastic/elasticsearch/issues/13224#issuecomment-145155429","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13224","id":145155429,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTE1NTQyOQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-10-02T21:06:56Z","updated_at":"2015-10-02T21:06:56Z","author_association":"CONTRIBUTOR","body":"It looks like the two remaining ones are claimed by me. I got a good start to them on the plane and will push something reviewable early next week. \n","performed_via_github_app":null}]