{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19471","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19471/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19471/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19471/events","html_url":"https://github.com/elastic/elasticsearch/issues/19471","id":166081676,"node_id":"MDU6SXNzdWUxNjYwODE2NzY=","number":19471,"title":"Mapper-attachments access denied while trying to find windows font directory","user":{"login":"Skoucail","id":20516786,"node_id":"MDQ6VXNlcjIwNTE2Nzg2","avatar_url":"https://avatars0.githubusercontent.com/u/20516786?v=4","gravatar_id":"","url":"https://api.github.com/users/Skoucail","html_url":"https://github.com/Skoucail","followers_url":"https://api.github.com/users/Skoucail/followers","following_url":"https://api.github.com/users/Skoucail/following{/other_user}","gists_url":"https://api.github.com/users/Skoucail/gists{/gist_id}","starred_url":"https://api.github.com/users/Skoucail/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Skoucail/subscriptions","organizations_url":"https://api.github.com/users/Skoucail/orgs","repos_url":"https://api.github.com/users/Skoucail/repos","events_url":"https://api.github.com/users/Skoucail/events{/privacy}","received_events_url":"https://api.github.com/users/Skoucail/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2016-07-18T12:25:04Z","updated_at":"2018-03-13T16:33:32Z","closed_at":"2018-03-13T16:33:32Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.4 (With plugin mapper-attachments)\n\n**JVM version**: 8 update 91 (build 1.8.0_91-b14)\n\n**OS version**: Windows Server 2012R2\n\n**Description of the problem including expected versus actual behavior**:\nWhen indexing the first PDF with the mapper-attachments plugin i get an error when pdfbox tries to find the windows directory witch contains the windows font.\nThis trows a access denied exeption (tried to run under different users always getting access denied)\nThen for every PDF without embedded fonts i get a warning that the font cant be found\n\n**Steps to reproduce**:\n1. Start up elasticsearch-service-x64.exe (make sure the mapper-attachments plugin is installed before starting)\n2. Index a PDF file without embedded font\n3. Check the logging\n\n**Provide logs (if relevant)**:\n[2016-07-18 14:05:54,930][ERROR][org.apache.pdfbox.pdmodel.font.PDSimpleFont] Can't determine the width of the space character using 250 as default\njava.security.AccessControlException: access denied (\"java.io.FilePermission\" \"<<ALL FILES>>\" \"execute\")\n    at java.security.AccessControlContext.checkPermission(Unknown Source)\n    at java.security.AccessController.checkPermission(Unknown Source)\n    at java.lang.SecurityManager.checkPermission(Unknown Source)\n    at java.lang.SecurityManager.checkExec(Unknown Source)\n    at java.lang.ProcessBuilder.start(Unknown Source)\n    at java.lang.Runtime.exec(Unknown Source)\n    at java.lang.Runtime.exec(Unknown Source)\n    at java.lang.Runtime.exec(Unknown Source)\n    at org.apache.fontbox.util.autodetect.WindowsFontDirFinder.getWinDir(WindowsFontDirFinder.java:50)\n    at org.apache.fontbox.util.autodetect.WindowsFontDirFinder.find(WindowsFontDirFinder.java:79)\n    at org.apache.fontbox.util.autodetect.FontFileFinder.find(FontFileFinder.java:74)\n    at org.apache.fontbox.util.FontManager.loadFonts(FontManager.java:65)\n    at org.apache.fontbox.util.FontManager.findTTFontname(FontManager.java:290)\n    at org.apache.fontbox.util.FontManager.findTTFont(FontManager.java:326)\n    at org.apache.pdfbox.pdmodel.font.PDTrueTypeFont.getTTFFont(PDTrueTypeFont.java:638)\n    at org.apache.pdfbox.pdmodel.font.PDTrueTypeFont.getFontWidth(PDTrueTypeFont.java:673)\n    at org.apache.pdfbox.pdmodel.font.PDSimpleFont.getFontWidth(PDSimpleFont.java:231)\n    at org.apache.pdfbox.pdmodel.font.PDSimpleFont.getSpaceWidth(PDSimpleFont.java:533)\n    at org.apache.pdfbox.util.PDFStreamEngine.processEncodedText(PDFStreamEngine.java:355)\n    at org.apache.pdfbox.util.operator.ShowText.process(ShowText.java:50)\n    at org.apache.pdfbox.util.PDFStreamEngine.processOperator(PDFStreamEngine.java:557)\n    at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:268)\n    at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:235)\n    at org.apache.pdfbox.util.PDFStreamEngine.processStream(PDFStreamEngine.java:215)\n    at org.apache.pdfbox.util.PDFTextStripper.processPage(PDFTextStripper.java:458)\n    at org.apache.pdfbox.util.PDFTextStripper.processPages(PDFTextStripper.java:383)\n    at org.apache.pdfbox.util.PDFTextStripper.writeText(PDFTextStripper.java:342)\n    at org.apache.tika.parser.pdf.PDF2XHTML.process(PDF2XHTML.java:148)\n    at org.apache.tika.parser.pdf.PDFParser.parse(PDFParser.java:148)\n    at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280)\n    at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)\n    at org.apache.tika.Tika.parseToString(Tika.java:537)\n    at org.elasticsearch.mapper.attachments.TikaImpl$1.run(TikaImpl.java:94)\n    at org.elasticsearch.mapper.attachments.TikaImpl$1.run(TikaImpl.java:91)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at org.elasticsearch.mapper.attachments.TikaImpl.parse(TikaImpl.java:91)\n    at org.elasticsearch.mapper.attachments.AttachmentMapper.parse(AttachmentMapper.java:481)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:309)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:326)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:252)\n    at org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:122)\n    at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:309)\n    at org.elasticsearch.index.shard.IndexShard.prepareIndex(IndexShard.java:580)\n    at org.elasticsearch.index.shard.IndexShard.prepareIndexOnPrimary(IndexShard.java:559)\n    at org.elasticsearch.action.index.TransportIndexAction.prepareIndexOperationOnPrimary(TransportIndexAction.java:212)\n    at org.elasticsearch.action.index.TransportIndexAction.executeIndexRequestOnPrimary(TransportIndexAction.java:224)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardIndexOperation(TransportShardBulkAction.java:327)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:120)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:68)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.doRun(TransportReplicationAction.java:639)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:279)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:271)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n    at java.lang.Thread.run(Unknown Source)\n[2016-07-18 14:05:57,078][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:57,105][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:57,711][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:57,748][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:57,850][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:57,867][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,040][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,057][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,081][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,131][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,142][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,154][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,557][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,565][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n[2016-07-18 14:05:59,572][WARN ][org.apache.fontbox.util.FontManager] Font not found: CourierNewPSMT\n[2016-07-18 14:05:59,579][WARN ][org.apache.fontbox.util.FontManager] Font not found: TimesNewRomanPSMT\n","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}