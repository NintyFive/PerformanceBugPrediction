{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9622","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9622/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9622/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9622/events","html_url":"https://github.com/elastic/elasticsearch/issues/9622","id":57123452,"node_id":"MDU6SXNzdWU1NzEyMzQ1Mg==","number":9622,"title":"double field return aggregations result totally wrong","user":{"login":"childe","id":2444825,"node_id":"MDQ6VXNlcjI0NDQ4MjU=","avatar_url":"https://avatars2.githubusercontent.com/u/2444825?v=4","gravatar_id":"","url":"https://api.github.com/users/childe","html_url":"https://github.com/childe","followers_url":"https://api.github.com/users/childe/followers","following_url":"https://api.github.com/users/childe/following{/other_user}","gists_url":"https://api.github.com/users/childe/gists{/gist_id}","starred_url":"https://api.github.com/users/childe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/childe/subscriptions","organizations_url":"https://api.github.com/users/childe/orgs","repos_url":"https://api.github.com/users/childe/repos","events_url":"https://api.github.com/users/childe/events{/privacy}","received_events_url":"https://api.github.com/users/childe/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-02-10T02:49:53Z","updated_at":"2015-02-12T10:28:09Z","closed_at":"2015-02-12T10:28:09Z","author_association":"NONE","active_lock_reason":null,"body":"I have a index named ops-linux-web-2015.02.09 with mapping:\n\n```\n               \"time_taken\": {\n                  \"type\": \"double\",\n                  \"doc_values\": true\n               }\n```\n\nthe full mapping is too long, and i put it in the bottom.\n\nI post a aggs request as below:\n\n```\nPOST ops-linux-web-2015.02.09/_search\n{\n    \"fields\": [\n       \"time_taken\"\n    ], \n   \"query\": {\n      \"bool\": {\n         \"must\": [\n            {\n               \"match\": {\n                  \"type\": \"nginx\"\n               }\n            },\n\n            {\n               \"match\": {\n                  \"c_ip\": \"10.8.109.225\"\n               }\n            },\n            {\n               \"range\": {\n                  \"@timestamp\": {\n                     \"from\": 1423456589000,\n                     \"to\": 1423456590000\n                  }\n               }\n            }\n         ]\n      }\n   },\n   \"aggs\": {\n      \"stat\": {\n         \"terms\": {\n            \"field\": \"time_taken\"\n         }\n      }\n   }\n}\n```\n\nand the result is:\n\n```\n{\n   \"took\": 6,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 10,\n      \"successful\": 10,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 5,\n      \"max_score\": 7.399907,\n      \"hits\": [\n         {\n            \"_index\": \"ops-linux-web-2015.02.09\",\n            \"_type\": \"nginx\",\n            \"_id\": \"ZLRiOmpWRVW6cPFNHPlsJA\",\n            \"_score\": 7.399907,\n            \"fields\": {\n               \"time_taken\": [\n                  0.094\n               ]\n            }\n         },\n         {\n            \"_index\": \"ops-linux-web-2015.02.09\",\n            \"_type\": \"nginx\",\n            \"_id\": \"vJEkBXf3S7K8u_UXFYe3sw\",\n            \"_score\": 7.399907,\n            \"fields\": {\n               \"time_taken\": [\n                  0.021\n               ]\n            }\n         },\n         {\n            \"_index\": \"ops-linux-web-2015.02.09\",\n            \"_type\": \"nginx\",\n            \"_id\": \"RH9_f3rVQOSmPmcuxztQ7g\",\n            \"_score\": 7.399348,\n            \"fields\": {\n               \"time_taken\": [\n                  0.044\n               ]\n            }\n         },\n         {\n            \"_index\": \"ops-linux-web-2015.02.09\",\n            \"_type\": \"nginx\",\n            \"_id\": \"KcDWPWhGRsOw9IEU-p8Ubg\",\n            \"_score\": 7.3951397,\n            \"fields\": {\n               \"time_taken\": [\n                  1.017\n               ]\n            }\n         },\n         {\n            \"_index\": \"ops-linux-web-2015.02.09\",\n            \"_type\": \"nginx\",\n            \"_id\": \"lcYuXRvHR3eDu1X3oZdB3g\",\n            \"_score\": 7.3951397,\n            \"fields\": {\n               \"time_taken\": [\n                  0.08\n               ]\n            }\n         }\n      ]\n   },\n   \"aggregations\": {\n      \"stat\": {\n         \"buckets\": [\n            {\n               \"key\": -62,\n               \"key_as_string\": \"-62\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": -42,\n               \"key_as_string\": \"-42\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": -14,\n               \"key_as_string\": \"-14\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": 9,\n               \"key_as_string\": \"9\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": 33,\n               \"key_as_string\": \"33\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": 4701,\n               \"key_as_string\": \"4701\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": 4713,\n               \"key_as_string\": \"4713\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": 4715,\n               \"key_as_string\": \"4715\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": 4734,\n               \"key_as_string\": \"4734\",\n               \"doc_count\": 1\n            },\n            {\n               \"key\": 4740,\n               \"key_as_string\": \"4740\",\n               \"doc_count\": 1\n            }\n         ]\n      }\n   }\n}\n```\n\nThe time_taken field return in hits that is between 0 and 1is correct . But why I got the strange result in aggs?\n\n**full maping:**\n\n```\n{\n   \"ops-linux-web-2015.02.09\": {\n      \"mappings\": {\n         \"_default_\": {\n            \"dynamic_templates\": [\n               {\n                  \"date_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"date\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"date\"\n                  }\n               },\n               {\n                  \"string_fields\": {\n                     \"mapping\": {\n                        \"index\": \"not_analyzed\",\n                        \"doc_values\": true,\n                        \"type\": \"string\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"string\"\n                  }\n               },\n               {\n                  \"long_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"long\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"long\"\n                  }\n               },\n               {\n                  \"integer_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"integer\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"integer\"\n                  }\n               },\n               {\n                  \"double_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"double\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"double\"\n                  }\n               },\n               {\n                  \"float_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"float\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"float\"\n                  }\n               }\n            ],\n            \"_all\": {\n               \"enabled\": false\n            },\n            \"properties\": {\n               \"@timestamp\": {\n                  \"type\": \"date\",\n                  \"doc_values\": true,\n                  \"format\": \"dateOptionalTime\"\n               },\n               \"@version\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"cs_Referer_\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_Referer_stem\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_User_Agent_\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_uri_query\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_uri_stem\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"data\": {\n                  \"type\": \"string\"\n               },\n               \"message\": {\n                  \"type\": \"string\"\n               },\n               \"path\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               }\n            }\n         },\n         \"nginx\": {\n            \"dynamic_templates\": [\n               {\n                  \"date_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"date\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"date\"\n                  }\n               },\n               {\n                  \"string_fields\": {\n                     \"mapping\": {\n                        \"index\": \"not_analyzed\",\n                        \"doc_values\": true,\n                        \"type\": \"string\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"string\"\n                  }\n               },\n               {\n                  \"long_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"long\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"long\"\n                  }\n               },\n               {\n                  \"integer_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"integer\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"integer\"\n                  }\n               },\n               {\n                  \"double_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"double\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"double\"\n                  }\n               },\n               {\n                  \"float_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"float\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"float\"\n                  }\n               }\n            ],\n            \"_all\": {\n               \"enabled\": false\n            },\n            \"properties\": {\n               \"@timestamp\": {\n                  \"type\": \"date\",\n                  \"doc_values\": true,\n                  \"format\": \"dateOptionalTime\"\n               },\n               \"@version\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"c_ip\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"cs_Referer_\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_Referer_stem\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_User_Agent_\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_host\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"cs_method\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"cs_status\": {\n                  \"type\": \"long\",\n                  \"doc_values\": true\n               },\n               \"cs_uri_query\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_uri_stem\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_version\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"data\": {\n                  \"type\": \"string\"\n               },\n               \"host\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"message\": {\n                  \"type\": \"string\"\n               },\n               \"path\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"request\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"s_ip\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"s_port\": {\n                  \"type\": \"long\",\n                  \"doc_values\": true\n               },\n               \"sc_sent\": {\n                  \"type\": \"long\",\n                  \"doc_values\": true\n               },\n               \"tags\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"time_taken\": {\n                  \"type\": \"double\",\n                  \"doc_values\": true\n               },\n               \"type\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"upstream_addr\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"upstream_response_time\": {\n                  \"type\": \"double\",\n                  \"doc_values\": true\n               },\n               \"upstream_status\": {\n                  \"type\": \"double\",\n                  \"doc_values\": true\n               },\n               \"xforward\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               }\n            }\n         },\n         \"apache\": {\n            \"dynamic_templates\": [\n               {\n                  \"date_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"date\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"date\"\n                  }\n               },\n               {\n                  \"string_fields\": {\n                     \"mapping\": {\n                        \"index\": \"not_analyzed\",\n                        \"doc_values\": true,\n                        \"type\": \"string\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"string\"\n                  }\n               },\n               {\n                  \"long_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"long\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"long\"\n                  }\n               },\n               {\n                  \"integer_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"integer\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"integer\"\n                  }\n               },\n               {\n                  \"double_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"double\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"double\"\n                  }\n               },\n               {\n                  \"float_fields\": {\n                     \"mapping\": {\n                        \"doc_values\": true,\n                        \"type\": \"float\"\n                     },\n                     \"match\": \"*\",\n                     \"match_mapping_type\": \"float\"\n                  }\n               }\n            ],\n            \"_all\": {\n               \"enabled\": false\n            },\n            \"properties\": {\n               \"@timestamp\": {\n                  \"type\": \"date\",\n                  \"doc_values\": true,\n                  \"format\": \"dateOptionalTime\"\n               },\n               \"@version\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"cs_Referer_\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_Referer_stem\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_User_Agent_\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_bytes\": {\n                  \"type\": \"long\",\n                  \"doc_values\": true\n               },\n               \"cs_host\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"cs_method\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"cs_uri_query\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_uri_stem\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"cs_username\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"cs_version\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"data\": {\n                  \"type\": \"string\"\n               },\n               \"datetime\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"host\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"message\": {\n                  \"type\": \"string\"\n               },\n               \"path\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true,\n                  \"fields\": {\n                     \"analyzed\": {\n                        \"type\": \"string\"\n                     }\n                  }\n               },\n               \"real_ip\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"s_ip\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"s_port\": {\n                  \"type\": \"long\",\n                  \"doc_values\": true\n               },\n               \"sc_bytes\": {\n                  \"type\": \"long\",\n                  \"doc_values\": true\n               },\n               \"sc_status\": {\n                  \"type\": \"long\",\n                  \"doc_values\": true\n               },\n               \"tags\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"time_taken\": {\n                  \"type\": \"long\",\n                  \"doc_values\": true\n               },\n               \"type\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               },\n               \"xforward\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\",\n                  \"doc_values\": true\n               }\n            }\n         }\n      }\n   }\n}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}