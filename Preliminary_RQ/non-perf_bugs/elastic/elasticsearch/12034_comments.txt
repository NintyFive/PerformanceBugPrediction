[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/118534918","html_url":"https://github.com/elastic/elasticsearch/issues/12034#issuecomment-118534918","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12034","id":118534918,"node_id":"MDEyOklzc3VlQ29tbWVudDExODUzNDkxOA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-07-04T17:06:39Z","updated_at":"2015-07-04T17:06:39Z","author_association":"MEMBER","body":"It sounds like that this dependency in plugin `pom.xml` is the culprit here:\n\n``` xml\n        <dependency>\n            <groupId>org.apache.httpcomponents</groupId>\n            <artifactId>httpclient</artifactId>\n            <scope>test</scope>\n        </dependency>\n```\n\nhttpclient and its dependencies (httpcore) is marked as a test dependency.\nBut httpclient is also a transitive dependency for aws sdk:\n\n```\n[INFO] +- com.amazonaws:aws-java-sdk-ec2:jar:1.10.0:compile\n[INFO] |  \\- com.amazonaws:aws-java-sdk-core:jar:1.10.0:compile\n[INFO] |     +- commons-logging:commons-logging:jar:1.1.3:compile\n[INFO] |     \\- org.apache.httpcomponents:httpclient:jar:4.3.6:compile\n[INFO] |        +- org.apache.httpcomponents:httpcore:jar:4.3.3:compile\n[INFO] |        \\- commons-codec:commons-codec:jar:1.6:compile\n```\n\nWhen httpclient is marked with a `test` scope, it's ignored then as it has precedence on transitive dependencies. `mvn dependency:tree` gives:\n\n```\n[INFO] --- maven-dependency-plugin:2.10:tree (default-cli) @ elasticsearch-cloud-aws ---\n[INFO] org.elasticsearch.plugin:elasticsearch-cloud-aws:jar:2.0.0-SNAPSHOT\n[INFO] +- com.amazonaws:aws-java-sdk-ec2:jar:1.10.0:compile\n[INFO] |  \\- com.amazonaws:aws-java-sdk-core:jar:1.10.0:compile\n[INFO] +- com.amazonaws:aws-java-sdk-s3:jar:1.10.0:compile\n[INFO] |  \\- com.amazonaws:aws-java-sdk-kms:jar:1.10.0:compile\n[INFO] +- org.hamcrest:hamcrest-all:jar:1.3:test\n[INFO] +- org.apache.lucene:lucene-test-framework:jar:5.2.1:test\n[INFO] |  +- org.apache.lucene:lucene-codecs:jar:5.2.1:test\n[INFO] |  +- com.carrotsearch.randomizedtesting:randomizedtesting-runner:jar:2.1.14:test\n[INFO] |  +- junit:junit:jar:4.11:test\n[INFO] |  \\- org.apache.ant:ant:jar:1.8.2:test\n[INFO] +- org.elasticsearch:elasticsearch:test-jar:tests:2.0.0-SNAPSHOT:test\n[INFO] |  \\- com.twitter:jsr166e:jar:1.1.0:provided\n[INFO] +- org.elasticsearch:elasticsearch:jar:2.0.0-SNAPSHOT:provided\n[INFO] +- org.apache.lucene:lucene-core:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-backward-codecs:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-analyzers-common:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-queries:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-memory:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-highlighter:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-queryparser:jar:5.2.1:provided\n[INFO] |  \\- org.apache.lucene:lucene-sandbox:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-suggest:jar:5.2.1:provided\n[INFO] |  \\- org.apache.lucene:lucene-misc:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-join:jar:5.2.1:provided\n[INFO] |  \\- org.apache.lucene:lucene-grouping:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-spatial:jar:5.2.1:provided\n[INFO] +- org.apache.lucene:lucene-expressions:jar:5.2.1:provided\n[INFO] |  +- org.antlr:antlr-runtime:jar:3.5:provided\n[INFO] |  +- org.ow2.asm:asm:jar:4.1:provided\n[INFO] |  \\- org.ow2.asm:asm-commons:jar:4.1:provided\n[INFO] +- com.spatial4j:spatial4j:jar:0.4.1:provided\n[INFO] +- com.vividsolutions:jts:jar:1.13:provided\n[INFO] +- com.github.spullara.mustache.java:compiler:jar:0.8.13:provided\n[INFO] +- com.google.guava:guava:jar:18.0:provided\n[INFO] +- com.carrotsearch:hppc:jar:0.7.1:provided\n[INFO] +- joda-time:joda-time:jar:2.8:provided\n[INFO] +- org.joda:joda-convert:jar:1.2:provided\n[INFO] +- com.fasterxml.jackson.core:jackson-core:jar:2.5.3:provided\n[INFO] +- com.fasterxml.jackson.dataformat:jackson-dataformat-smile:jar:2.5.3:provided\n[INFO] +- com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:jar:2.5.3:provided\n[INFO] |  +- com.fasterxml.jackson.core:jackson-databind:jar:2.5.3:compile\n[INFO] |  |  \\- com.fasterxml.jackson.core:jackson-annotations:jar:2.5.0:compile\n[INFO] |  \\- org.yaml:snakeyaml:jar:1.12:provided\n[INFO] +- com.fasterxml.jackson.dataformat:jackson-dataformat-cbor:jar:2.5.3:provided\n[INFO] +- io.netty:netty:jar:3.10.0.Final:provided\n[INFO] +- com.ning:compress-lzf:jar:1.0.2:provided\n[INFO] +- com.tdunning:t-digest:jar:3.0:provided\n[INFO] +- org.apache.commons:commons-lang3:jar:3.3.2:provided\n[INFO] +- commons-cli:commons-cli:jar:1.2:provided\n[INFO] +- org.codehaus.groovy:groovy-all:jar:indy:2.4.0:provided\n[INFO] +- log4j:log4j:jar:1.2.17:provided\n[INFO] +- log4j:apache-log4j-extras:jar:1.2.17:provided\n[INFO] +- org.slf4j:slf4j-api:jar:1.6.2:provided\n[INFO] +- net.java.dev.jna:jna:jar:4.1.0:provided\n[INFO] \\- org.apache.httpcomponents:httpclient:jar:4.3.6:test\n[INFO]    +- org.apache.httpcomponents:httpcore:jar:4.3.3:test\n[INFO]    +- commons-logging:commons-logging:jar:1.1.3:compile\n[INFO]    \\- commons-codec:commons-codec:jar:1.6:test\n```\n\nWe should change the scope of `httpclient` explicitly for every plugin which requires it. Will come with a PR for it.\n","performed_via_github_app":null}]