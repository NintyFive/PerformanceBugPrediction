{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8997","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8997/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8997/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8997/events","html_url":"https://github.com/elastic/elasticsearch/issues/8997","id":52314917,"node_id":"MDU6SXNzdWU1MjMxNDkxNw==","number":8997,"title":"Elasticsearch not handling empty content from Couchbase via XDCR","user":{"login":"vvalenti","id":10227219,"node_id":"MDQ6VXNlcjEwMjI3MjE5","avatar_url":"https://avatars0.githubusercontent.com/u/10227219?v=4","gravatar_id":"","url":"https://api.github.com/users/vvalenti","html_url":"https://github.com/vvalenti","followers_url":"https://api.github.com/users/vvalenti/followers","following_url":"https://api.github.com/users/vvalenti/following{/other_user}","gists_url":"https://api.github.com/users/vvalenti/gists{/gist_id}","starred_url":"https://api.github.com/users/vvalenti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvalenti/subscriptions","organizations_url":"https://api.github.com/users/vvalenti/orgs","repos_url":"https://api.github.com/users/vvalenti/repos","events_url":"https://api.github.com/users/vvalenti/events{/privacy}","received_events_url":"https://api.github.com/users/vvalenti/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-12-18T01:23:32Z","updated_at":"2014-12-19T11:30:37Z","closed_at":"2014-12-19T11:30:37Z","author_association":"NONE","active_lock_reason":null,"body":"Noticed on 1.3.0, 1.3.4 & 1.4.2.\n\nMalformed UTF-8 made its way to Couchbase as a key. Then the Key was deleted in Couchbase.  XDCR attempted send an empty object to Elasticsearch and Elasticsearch blows up.  :)  Need to restart Elasticsearch to work correctly again.\n\nThe key is stuck within XDCR until it has been acknowledged by Elasticsearch which can never happen.  Only way to resolve is to clear the data within Couchbase.  We have some data on a live system and clearing the data is not an option.  \n\nBelow is an example of the error message in the Elasticsearch logs:\n\nAny Ideas?\n\n[2014-12-17 17:12:12,779][ERROR][transport.couchbase.capi ] [Valinor] Unable to parse decoded base64 data as JSON, indexing stub for id: [73, 78, 67, 58, 58, 117, 115, 114, 94, 67, 67, 51, 185, 195, 184, 194, 167, 195, 185, 194, 132, 195, 184, 194, 185, 195, 184, 194, 170, 195, 185, 194, 138, 195, 184, 194, 168, 195, 185, 194, 58, 58, 99, 111, 100, 101]\n[2014-12-17 17:12:12,779][ERROR][transport.couchbase.capi ] [Valinor] Body was:  Parse error was: java.io.EOFException: No content to map to Object due to end of input\n[2014-12-17 17:12:12,779][WARN ][org.eclipse.jetty.servlet.ServletHandler] /hotelserve%2f879/_bulk_docs\njava.lang.ClassCastException: java.util.ArrayList cannot be cast to java.lang.String\n        at org.elasticsearch.transport.couchbase.capi.ElasticSearchCAPIBehavior.bulkDocs(ElasticSearchCAPIBehavior.java:306)\n        at com.couchbase.capi.servlet.CAPIServlet.handleBulkDocs(CAPIServlet.java:529)\n        at com.couchbase.capi.servlet.CAPIServlet.service(CAPIServlet.java:89)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:847)\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:594)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:485)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:486)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:233)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1065)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:412)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:192)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:999)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:111)\n        at org.eclipse.jetty.server.Server.handle(Server.java:351)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:451)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:931)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:857)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:230)\n        at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:76)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:609)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:45)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:599)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:534)\n        at java.lang.Thread.run(Thread.java:744)\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}