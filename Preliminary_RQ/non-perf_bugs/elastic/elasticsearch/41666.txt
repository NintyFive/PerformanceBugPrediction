{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41666","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41666/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41666/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41666/events","html_url":"https://github.com/elastic/elasticsearch/issues/41666","id":438662864,"node_id":"MDU6SXNzdWU0Mzg2NjI4NjQ=","number":41666,"title":"Dynamic date format fails to parse if multiple formats in list","user":{"login":"yoogie","id":2392903,"node_id":"MDQ6VXNlcjIzOTI5MDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2392903?v=4","gravatar_id":"","url":"https://api.github.com/users/yoogie","html_url":"https://github.com/yoogie","followers_url":"https://api.github.com/users/yoogie/followers","following_url":"https://api.github.com/users/yoogie/following{/other_user}","gists_url":"https://api.github.com/users/yoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/yoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yoogie/subscriptions","organizations_url":"https://api.github.com/users/yoogie/orgs","repos_url":"https://api.github.com/users/yoogie/repos","events_url":"https://api.github.com/users/yoogie/events{/privacy}","received_events_url":"https://api.github.com/users/yoogie/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-04-30T08:42:06Z","updated_at":"2019-05-22T16:21:38Z","closed_at":"2019-05-22T16:21:38Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 7.0.0, Build: default/zip/b7e28a7/2019-04-05T22:55:32.697037Z, JVM: 1.8.0_121\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_131\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_131-b11)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nwin7\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen using dynamic mapping for date fields, it is possible to index documents of various (correct) date formats to the same field. However it is not possible to index a single document with a list of fields with different formats when creating the index.\r\n\r\n**Steps to reproduce**:\r\nUsing Kibana console:\r\nAdd template with dynamic template\r\n```\r\nPOST _template/example_template\r\n{\r\n  \"order\": 1,\r\n  \"index_patterns\": [\r\n    \"idx*\"\r\n  ],\r\n  \"settings\": {\r\n    \"number_of_replicas\": 0,\r\n    \"number_of_shards\": 1\r\n  },\r\n  \"mappings\": {\r\n    \"dynamic_templates\": [\r\n      {\r\n        \"date_fields\": {\r\n          \"match_mapping_type\": \"date\",\r\n          \"mapping\": {\r\n            \"type\": \"date\",\r\n            \"format\": \"date_time||date_time_no_millis||date_hour_minute_second_fraction||date_hour_minute_second_millis\"\r\n          }\r\n        }\r\n      }\r\n      ],\r\n    \"properties\": {\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nIndex documents with different format of the same field to the same index:\r\n```\r\nPOST idx/_doc/1\r\n{\r\n  \"outer_doc\" : {\r\n    \"list_of_entities\" : [\r\n      {\r\n        \"at\": \"2019-04-30T07:20:11.01\"\r\n      }\r\n      ]\r\n  }\r\n}\r\n\r\nPOST idx/_doc/2\r\n{\r\n  \"outer_doc\" : {\r\n    \"list_of_entities\" : [\r\n      {\r\n        \"at\": \"2019-04-30T07:20:11.011Z\"\r\n      }\r\n      ]\r\n  }\r\n}\r\n```\r\n\r\nAt this point it is possible to index a document with different formats in the same document (since the mapping is now created for the index):\r\n\r\n```\r\nPOST idx/_doc/101\r\n{\r\n  \"outer_doc\" : {\r\n    \"list_of_entities\" : [\r\n      {\r\n        \"at\": \"2019-04-30T07:20:11.01\"\r\n      },\r\n      {\r\n        \"at\": \"2019-04-30T07:20:11.011Z\"\r\n      }\r\n      ]\r\n  }\r\n}\r\n```\r\n\r\nHow ever, adding the last document to a new index is not possible:\r\n```\r\nDELETE idx\r\n\r\nPOST idx/_doc/101\r\n{\r\n  \"outer_doc\" : {\r\n    \"list_of_entities\" : [\r\n      {\r\n        \"at\": \"2019-04-30T07:20:11.01\"\r\n      },\r\n      {\r\n        \"at\": \"2019-04-30T07:20:11.011Z\"\r\n      }\r\n      ]\r\n  }\r\n}\r\n```\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Add template\r\n 2. Index document with different formats of date\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"mapper [outer_doc.list_of_entities.at] of different type, current_type [date], merged_type [text]\"\r\n      }\r\n    ],\r\n    \"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"mapper [outer_doc.list_of_entities.at] of different type, current_type [date], merged_type [text]\"\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n","closed_by":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"performed_via_github_app":null}