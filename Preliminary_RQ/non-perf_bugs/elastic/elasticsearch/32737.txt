{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737/events","html_url":"https://github.com/elastic/elasticsearch/issues/32737","id":349036040,"node_id":"MDU6SXNzdWUzNDkwMzYwNDA=","number":32737,"title":":x-pack:qa:full-cluster-restart fails with SecurityException: Keystore has been corrupted or tampered with on FIPS JVM","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"labels":[{"id":912838879,"node_id":"MDU6TGFiZWw5MTI4Mzg4Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Security","name":":Security/Security","color":"0e8a16","default":false,"description":"Security issues without another label"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1009148120,"node_id":"MDU6TGFiZWwxMDA5MTQ4MTIw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.4.1","name":"v6.4.1","color":"DDDDDD","default":false,"description":""},{"id":962378555,"node_id":"MDU6TGFiZWw5NjIzNzg1NTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.5.0","name":"v6.5.0","color":"Dddddd","default":false,"description":""},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"assignees":[{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false}],"milestone":null,"comments":19,"created_at":"2018-08-09T08:53:09Z","updated_at":"2019-02-07T10:44:06Z","closed_at":"2018-08-17T15:23:14Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Relevant log \r\n```\r\n18:02:02 > Task :x-pack:qa:full-cluster-restart:with-system-key:v6.3.3-SNAPSHOT#oldClusterTestCluster#node0.addToKeystore#xpack.watcher.encryption_key\r\n18:02:02 Task ':x-pack:qa:full-cluster-restart:with-system-key:v6.3.3-SNAPSHOT#oldClusterTestCluster#node0.addToKeystore#xpack.watcher.encryption_key' is not up-to-date because:\r\n18:02:02   Task has not declared any outputs despite executing actions.\r\n18:02:02 \tat sun.security.provider.JavaKeyStore.engineLoad(JavaKeyStore.java:658)\r\n18:02:02 \tat sun.security.provider.JavaKeyStore$JKS.engineLoad(JavaKeyStore.java:56)\r\n18:02:02 \tat sun.security.provider.KeyStoreDelegator.engineLoad(KeyStoreDelegator.java:224)\r\n18:02:02 \tat sun.security.provider.JavaKeyStore$DualFormatJKS.engineLoad(JavaKeyStore.java:70)\r\n18:02:02 \tat java.security.KeyStore.load(KeyStore.java:1445)\r\n18:02:02 Starting process 'command '/var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT#oldClusterTestCluster node0/elasticsearch-6.3.3-SNAPSHOT/bin/elasticsearch-keystore''. Working directory: /var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT#oldClusterTestCluster node0/cwd Command: /var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT#oldClusterTestCluster node0/elasticsearch-6.3.3-SNAPSHOT/bin/elasticsearch-keystore add-file xpack.watcher.encryption_key /var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/src/test/resources/system_key\r\n18:02:02 Successfully started process 'command '/var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT#oldClusterTestCluster node0/elasticsearch-6.3.3-SNAPSHOT/bin/elasticsearch-keystore''\r\n18:02:02 warning: ignoring JAVA_TOOL_OPTIONS=-Dfile.encoding=UTF8\r\n18:02:02 \tat sun.security.util.AnchorCertificates$1.run(AnchorCertificates.java:61)\r\n18:02:02 \tat sun.security.util.AnchorCertificates$1.run(AnchorCertificates.java:52)\r\n18:02:02 \tat java.security.AccessController.doPrivileged(Native Method)\r\n18:02:02 \tat sun.security.util.AnchorCertificates.<clinit>(AnchorCertificates.java:52)\r\n18:02:02 \tat sun.security.provider.certpath.AlgorithmChecker.checkFingerprint(AlgorithmChecker.java:214)\r\n18:02:02 \tat sun.security.provider.certpath.AlgorithmChecker.<init>(AlgorithmChecker.java:164)\r\n18:02:02 \tat sun.security.provider.certpath.AlgorithmChecker.<init>(AlgorithmChecker.java:118)\r\n18:02:02 \tat sun.security.validator.SimpleValidator.engineValidate(SimpleValidator.java:157)\r\n18:02:02 \tat sun.security.validator.Validator.validate(Validator.java:262)\r\n18:02:02 \tat sun.security.validator.Validator.validate(Validator.java:238)\r\n18:02:02 \tat sun.security.validator.Validator.validate(Validator.java:207)\r\n18:02:02 \tat javax.crypto.JarVerifier.isTrusted(JarVerifier.java:610)\r\n18:02:02 \tat javax.crypto.JarVerifier.verifySingleJar(JarVerifier.java:530)\r\n18:02:02 \tat javax.crypto.JarVerifier.verifyJars(JarVerifier.java:363)\r\n18:02:02 \tat javax.crypto.JarVerifier.verify(JarVerifier.java:289)\r\n18:02:02 \tat javax.crypto.JceSecurity.verifyProviderJar(JceSecurity.java:164)\r\n18:02:02 \tat javax.crypto.JceSecurity.getVerificationResult(JceSecurity.java:190)\r\n18:02:02 \tat javax.crypto.JceSecurity.canUseProvider(JceSecurity.java:204)\r\n18:02:02 \tat javax.crypto.SecretKeyFactory.nextSpi(SecretKeyFactory.java:295)\r\n18:02:02 \tat javax.crypto.SecretKeyFactory.<init>(SecretKeyFactory.java:121)\r\n18:02:02 \tat javax.crypto.SecretKeyFactory.getInstance(SecretKeyFactory.java:160)\r\n18:02:02 \tat org.elasticsearch.common.settings.KeyStoreWrapper.createCipher(KeyStoreWrapper.java:288)\r\n18:02:02 \tat org.elasticsearch.common.settings.KeyStoreWrapper.decrypt(KeyStoreWrapper.java:336)\r\n18:02:02 \tat org.elasticsearch.common.settings.AddFileKeyStoreCommand.execute(AddFileKeyStoreCommand.java:73)\r\n18:02:02 \tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)\r\n18:02:02 \tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n18:02:02 \tat org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:79)\r\n18:02:02 \tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n18:02:02 \tat org.elasticsearch.cli.Command.main(Command.java:90)\r\n18:02:02 \tat org.elasticsearch.common.settings.KeyStoreCli.main(KeyStoreCli.java:41)\r\n18:02:02 Exception in thread \"main\" java.lang.SecurityException: Keystore has been corrupted or tampered with\r\n18:02:02 \tat org.elasticsearch.common.settings.KeyStoreWrapper.decrypt(KeyStoreWrapper.java:349)\r\n18:02:02 \tat org.elasticsearch.common.settings.AddFileKeyStoreCommand.execute(AddFileKeyStoreCommand.java:73)\r\n18:02:02 \tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)\r\n18:02:02 \tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n18:02:02 \tat org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:79)\r\n18:02:02 \tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n18:02:02 \tat org.elasticsearch.cli.Command.main(Command.java:90)\r\n18:02:02 \tat org.elasticsearch.common.settings.KeyStoreCli.main(KeyStoreCli.java:41)\r\n```\r\n\r\nThe  test is calling  `elasticsearch-keystore add xpack.watcher.encryption_key -x`\r\n\r\nCI logs:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.4+matrix-java-periodic/ES_BUILD_JAVA=java10,ES_RUNTIME_JAVA=java8fips,nodes=virtual&&linux/25/console","closed_by":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"performed_via_github_app":null}