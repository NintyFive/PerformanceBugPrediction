[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220313383","html_url":"https://github.com/elastic/elasticsearch/issues/18459#issuecomment-220313383","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18459","id":220313383,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMxMzM4Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T12:45:35Z","updated_at":"2016-05-19T12:45:35Z","author_association":"CONTRIBUTOR","body":"@almico So what happens here is:\n- You create an index with the incorrect version setting (you should never set the version yourself and won't be able to do so in ES 5.0 onwards)\n- The new index uses the current routing scheme\n- You index docs into it\n- When your restart the cluster, it finds what it thinks is an old index, which it then upgrades and adds the setting to use the old hash function.\n\nNever set the version yourself.  Like I say, you won't be able to do this in 5.0, but it's much harder to prevent in 2.x.\n\nTo fix your existing index, first close it, then set the following setting, then reopen it:\n\n```\nPUT ourindex/_settings\n{\n  \"index.legacy.routing.hash.type\": \"org.elasticsearch.cluster.routing.Murmur3HashFunction\"\n}\n```\n","performed_via_github_app":null}]