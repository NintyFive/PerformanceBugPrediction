[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606120443","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606120443","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606120443,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjEyMDQ0Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-03-30T16:59:54Z","updated_at":"2020-03-30T16:59:54Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security (:Security/Security)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606406435","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606406435","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606406435,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjQwNjQzNQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-03-31T05:21:17Z","updated_at":"2020-03-31T05:21:17Z","author_association":"CONTRIBUTOR","body":"This doesn't really make any sense. The line immediately before the failure is reading a document from that index. The index must exist ... perhaps it is yellow?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606412229","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606412229","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606412229,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjQxMjIyOQ==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2020-03-31T05:41:47Z","updated_at":"2020-03-31T05:41:47Z","author_association":"CONTRIBUTOR","body":"> perhaps it is yellow?\r\n\r\nThat is actually the case ( looking in my troubleshooting notes from last week and #54215 )","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606415074","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606415074","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606415074,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjQxNTA3NA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-03-31T05:51:24Z","updated_at":"2020-03-31T05:51:24Z","author_association":"CONTRIBUTOR","body":"Curious - I thought that cluster only had 1 node, and the index settings are to expand  replicas`0-1` so something isn't how I thought it would be.\r\n\r\nBut even then, why would it take more than 60s to get to green?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606542567","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606542567","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606542567,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjU0MjU2Nw==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2020-03-31T10:36:28Z","updated_at":"2020-03-31T10:36:28Z","author_association":"CONTRIBUTOR","body":"This has just failed on 7.x as well - can we backport the mute?\r\n\r\nhttps://gradle-enterprise.elastic.co/s/gidsxp5rxevea/tests/ypjwgchf3udh6-nee3awz3nsh5q","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606556219","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606556219","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606556219,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjU1NjIxOQ==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2020-03-31T11:02:17Z","updated_at":"2020-03-31T11:02:17Z","author_association":"CONTRIBUTOR","body":"messed up labels so we'll need to wait a little more, but I backported the mute to 7.x and 7.7 @romseygeek ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606583852","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606583852","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606583852,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjU4Mzg1Mg==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-03-31T12:01:47Z","updated_at":"2020-03-31T12:01:47Z","author_association":"CONTRIBUTOR","body":"A reminder to myself. Our current theory is that the template gets lost/dropped and so the index gets 1 replica, so on a single node cluster it's yellow not green.\r\n\r\nBut the question is why the template is being lost.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606585596","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606585596","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606585596,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjU4NTU5Ng==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-03-31T12:06:03Z","updated_at":"2020-03-31T12:06:16Z","author_association":"CONTRIBUTOR","body":"And that's definitely the cause:\r\n```\r\n» [2020-03-31T10:08:55,234][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] \r\n[saml-service-provider-v1] creating index, cause [auto(bulk api)], \r\ntemplates [], shards [1]/[1], mappings []\r\n```\r\nSo, it looks like a bug in our code that isn't guaranteeing that the template is installed before we create the index.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606985935","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-606985935","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":606985935,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjk4NTkzNQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-04-01T02:13:37Z","updated_at":"2020-04-01T02:13:37Z","author_association":"CONTRIBUTOR","body":"Update: I can reproduce this if I rename `ManageServiceProviderRestIT` to `ZManageServiceProviderRestIT` so that it runs after `WildcardServiceProviderRestIT`.\r\n\r\nI wonder if something is causing them to run in a different order in CI sometimes, but not when I try to reproduce it.\r\n\r\nAt least now I have something that I can work on fixing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/607013176","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-607013176","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":607013176,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNzAxMzE3Ng==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-04-01T03:52:21Z","updated_at":"2020-04-01T03:52:21Z","author_association":"CONTRIBUTOR","body":"I am now 99% convinced that this is due to:\r\n\r\n1. The order to test execution being non-determinisitic. It's file system dependent, so it's mostly alphabetical, but not guaranteed to be so.\r\n2. The template being deleted between tests (because it's [not yet listed as a x-pack system template](https://github.com/elastic/elasticsearch/pull/54215/files#diff-f7bdad16f322fc2d554401ea074400b5)).\r\n\r\nWhen `ManageServiceProviderRestIT` runs second there is no template, so the index is created without an special settings, so the replica count is set to 1, so in a single node cluster has yellow health, rather than the expected green.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/607038496","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-607038496","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":607038496,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNzAzODQ5Ng==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2020-04-01T05:20:47Z","updated_at":"2020-04-01T05:20:47Z","author_association":"CONTRIBUTOR","body":"Corresponds to what I've been seeing in #54215 and explains why this is solved by retaining the template when wiping stuff between tests. You can even replicate this by duplicating `testCreateAndDeleteServiceProvider` in the `ManageServiceProviderRestIT`, this would fail consistently he second time around. \r\n\r\nShouldn't the https://github.com/elastic/elasticsearch/blob/3cc2c80e4c5f7cb41905c68b6f8e2ca1d67ba579/x-pack/plugin/identity-provider/qa/idp-rest-tests/src/test/java/org/elasticsearch/xpack/idp/ManageServiceProviderRestIT.java#L53 cause the index template to be installed, even the second time, in https://github.com/elastic/elasticsearch/blob/b7af8524228891c305b8868ff7f748ec10cf724c/x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderIndex.java#L240 ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/607057842","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-607057842","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":607057842,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNzA1Nzg0Mg==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-04-01T06:19:00Z","updated_at":"2020-04-01T06:19:00Z","author_association":"CONTRIBUTOR","body":"As discussed in our sync, we never reset `templateInstalled` if the template is removed. That field is really tracking _have-we-done-the-work-of-installing-the-template-yet_, and wasn't intended to catch the case where an external process deletes the template after we installed it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/607157415","html_url":"https://github.com/elastic/elasticsearch/issues/54445#issuecomment-607157415","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","id":607157415,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNzE1NzQxNQ==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2020-04-01T10:04:15Z","updated_at":"2020-04-01T10:04:15Z","author_association":"CONTRIBUTOR","body":"Resolved in #54215","performed_via_github_app":null}]