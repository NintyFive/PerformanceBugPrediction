{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6939","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6939/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6939/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6939/events","html_url":"https://github.com/elastic/elasticsearch/issues/6939","id":38295103,"node_id":"MDU6SXNzdWUzODI5NTEwMw==","number":6939,"title":"Mapping: Geopoint with array broken (dynamic mapping): geo_point expected","user":{"login":"pierrre","id":131535,"node_id":"MDQ6VXNlcjEzMTUzNQ==","avatar_url":"https://avatars3.githubusercontent.com/u/131535?v=4","gravatar_id":"","url":"https://api.github.com/users/pierrre","html_url":"https://github.com/pierrre","followers_url":"https://api.github.com/users/pierrre/followers","following_url":"https://api.github.com/users/pierrre/following{/other_user}","gists_url":"https://api.github.com/users/pierrre/gists{/gist_id}","starred_url":"https://api.github.com/users/pierrre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pierrre/subscriptions","organizations_url":"https://api.github.com/users/pierrre/orgs","repos_url":"https://api.github.com/users/pierrre/repos","events_url":"https://api.github.com/users/pierrre/events{/privacy}","received_events_url":"https://api.github.com/users/pierrre/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111540092,"node_id":"MDU6TGFiZWwxMTE1NDAwOTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.4.0.Beta1","name":"v1.4.0.Beta1","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2014-07-21T11:34:53Z","updated_at":"2014-08-16T14:15:24Z","closed_at":"2014-08-11T12:09:41Z","author_association":"NONE","active_lock_reason":null,"body":"I use Elasticsearch with Logstash and dynamic mapping.\nI my logs, I have geopoints with the array syntax.\nIt was OK with ES 1.0.X, but it's broken with ES 1.2.2.\n\nTemplate:\n\n```\ncurl -XPUT localhost:9200/_template/logstash -d '{\n    \"template\": \"logstash_*\",\n    \"settings\" : {\n        \"refresh_interval\": \"30s\"\n    },\n    \"mappings\": {\n        \"logs\": {\n            \"_all\" : {\n                \"enabled\": false\n            },\n            \"dynamic_templates\": [\n                {\n                    \"location\": {\n                        \"match\": \"location*\",\n                        \"mapping\": {\n                            \"type\": \"geo_point\"\n                        }\n                    }\n                },\n                {\n                    \"generic\": {\n                        \"match\": \"*\",\n                        \"match_mapping_type\": \"string\",\n                        \"mapping\": {\n                            \"type\": \"string\",\n                            \"index\": \"not_analyzed\"\n                        }\n                    }\n                }\n            ],\n            \"dynamic_date_formats\": [\n                \"dateOptionalTime\",\n                \"yyyy-MM-dd\",\n                \"yyyy-MM-dd HH:mm:ss\"\n            ]\n        }\n    }\n}'\n```\n\nDelete index:\n\n```\ncurl -XDELETE localhost:9200/logstash_test\n```\n\nTry to add a doc/log:\n\n```\ncurl -XPOST localhost:9200/logstash_test/logs -d '{\n  \"location_array\": [\n    2.3069244,\n    48.8881598\n  ]\n}'\n```\n\nIt fails with this message:\n\n```\n[2014-07-21 11:31:49,168][INFO ][cluster.metadata         ] [fr-dev-01] [logstash_test] creating index, cause [auto(index api)], shards [5]/[1], mappings [logs]\n[2014-07-21 11:31:49,465][DEBUG][action.index             ] [fr-dev-01] [logstash_test][1], node[zzMEQe9JSS6qEgw0oRgdVA], [P], s[STARTED]: Failed to execute [index {[logstash_test][logs][PhqP9fpgQkS4tHfOs105GQ], source[{\"location_array\":[2.3069244,48.8881598]}]}]\norg.elasticsearch.index.mapper.MapperParsingException: failed to parse\n    at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:536)\n    at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:462)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.prepareCreate(InternalIndexShard.java:373)\n    at org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:203)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction.performOnPrimary(TransportShardReplicationOperationAction.java:534)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$1.run(TransportShardReplicationOperationAction.java:433)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:724)\nCaused by: org.elasticsearch.ElasticsearchParseException: geo_point expected\n    at org.elasticsearch.common.geo.GeoUtils.parseGeoPoint(GeoUtils.java:421)\n    at org.elasticsearch.index.mapper.geo.GeoPointFieldMapper.parse(GeoPointFieldMapper.java:530)\n    at org.elasticsearch.index.mapper.object.ObjectMapper.parseDynamicValue(ObjectMapper.java:819)\n    at org.elasticsearch.index.mapper.object.ObjectMapper.serializeValue(ObjectMapper.java:639)\n    at org.elasticsearch.index.mapper.object.ObjectMapper.serializeArray(ObjectMapper.java:625)\n    at org.elasticsearch.index.mapper.object.ObjectMapper.parse(ObjectMapper.java:482)\n    at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:515)\n    ... 8 more\n```\n\nIf I insert a doc with a geopoint as an object, it works, and the mapping is created dynamically.\nAfter that, I can insert a doc with a geopoint as an array without error.\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}