{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7759","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7759/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7759/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7759/events","html_url":"https://github.com/elastic/elasticsearch/issues/7759","id":42960254,"node_id":"MDU6SXNzdWU0Mjk2MDI1NA==","number":7759,"title":"Boolean query with 1 term in `must` and 1 term in `should` finds record where the should field does not exist","user":{"login":"hmalphettes","id":55289,"node_id":"MDQ6VXNlcjU1Mjg5","avatar_url":"https://avatars0.githubusercontent.com/u/55289?v=4","gravatar_id":"","url":"https://api.github.com/users/hmalphettes","html_url":"https://github.com/hmalphettes","followers_url":"https://api.github.com/users/hmalphettes/followers","following_url":"https://api.github.com/users/hmalphettes/following{/other_user}","gists_url":"https://api.github.com/users/hmalphettes/gists{/gist_id}","starred_url":"https://api.github.com/users/hmalphettes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hmalphettes/subscriptions","organizations_url":"https://api.github.com/users/hmalphettes/orgs","repos_url":"https://api.github.com/users/hmalphettes/repos","events_url":"https://api.github.com/users/hmalphettes/events{/privacy}","received_events_url":"https://api.github.com/users/hmalphettes/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-09-17T03:36:56Z","updated_at":"2014-09-24T19:19:42Z","closed_at":"2014-09-24T19:19:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"```\n$ curl -XGET \"http://localhost:9200\"\n{\n  \"status\" : 200,\n  \"name\" : \"Equilibrius\",\n  \"version\" : {\n    \"number\" : \"1.3.2\",\n    \"build_hash\" : \"dee175dbe2f254f3f26992f5d7591939aaefd12f\",\n    \"build_timestamp\" : \"2014-08-13T14:29:30Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.9\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n$ curl -XPOST \"http://localhost:9200/b-stc-d63fded1-043c-43ad-9135-d96b6d16cced-v20140916033807%2Cu-localhost-stc-d63fded1-043c-43ad-9135-d96b6d16cced-v20140916033807/_search?pretty=true\" -d '\n{\n  \"explain\": true,\n  \"_source\": [\n    \"stc_parent\"\n  ],\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"term\": {\n            \"stc_owner\": \"e4a8c0e4-0971-414b-8eee-d9a262dbb2df\"\n          }\n        }\n      ],\n      \"should\": [\n        {\n          \"term\": {\n            \"stc_parent\": \"4fad3fbf-0563-4df6-86e3-704f7a67b74e\"\n          }\n        },\n        {\n          \"term\": {\n            \"stc_parent\": \"f5b12506-d119-4408-b593-4b098128a299\"\n          }\n        }\n      ],\n    }\n  }\n}'\n```\n\nSome of the returned hits don't have an stc_owner property.\nFor example: the first hist is missing the property all together and the second one does have such a property.\n\n```\n{\n  \"took\" : 10,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 2,\n    \"successful\" : 2,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 6,\n    \"max_score\" : 2.1855037,\n    \"hits\" : [ {\n      \"_shard\" : 0,\n      \"_node\" : \"2U05i7A-Qg60eM0a5iPw4A\",\n      \"_index\" : \"b-stc-d63fded1-043c-43ad-9135-d96b6d16cced-v20140916033807\",\n      \"_type\" : \"stc_user\",\n      \"_id\" : \"e4a8c0e4-0971-414b-8eee-d9a262dbb2df\",\n      \"_score\" : 2.1855037,\n      \"_source\":{},\n      \"_explanation\" : {\n        \"value\" : 2.1855037,\n        \"description\" : \"product of:\",\n        \"details\" : [ {\n          \"value\" : 6.556511,\n          \"description\" : \"sum of:\",\n          \"details\" : [ {\n            \"value\" : 6.556511,\n            \"description\" : \"weight(stc_owner:e4a8c0e4-0971-414b-8eee-d9a262dbb2df in 6498) [PerFieldSimilarity], result of:\",\n            \"details\" : [ {\n              \"value\" : 6.556511,\n              \"description\" : \"score(doc=6498,freq=1.0 = termFreq=1.0\\n), product of:\",\n              \"details\" : [ {\n                \"value\" : 0.61388034,\n                \"description\" : \"queryWeight, product of:\",\n                \"details\" : [ {\n                  \"value\" : 10.680438,\n                  \"description\" : \"idf(docFreq=1, maxDocs=32003)\"\n                }, {\n                  \"value\" : 0.057477076,\n                  \"description\" : \"queryNorm\"\n                } ]\n              }, {\n                \"value\" : 10.680438,\n                \"description\" : \"fieldWeight in 6498, product of:\",\n                \"details\" : [ {\n                  \"value\" : 1.0,\n                  \"description\" : \"tf(freq=1.0), with freq of:\",\n                  \"details\" : [ {\n                    \"value\" : 1.0,\n                    \"description\" : \"termFreq=1.0\"\n                  } ]\n                }, {\n                  \"value\" : 10.680438,\n                  \"description\" : \"idf(docFreq=1, maxDocs=32003)\"\n                }, {\n                  \"value\" : 1.0,\n                  \"description\" : \"fieldNorm(doc=6498)\"\n                } ]\n              } ]\n            } ]\n          } ]\n        }, {\n          \"value\" : 0.33333334,\n          \"description\" : \"coord(1/3)\"\n        } ]\n      }\n    }, {\n      \"_shard\" : 0,\n      \"_node\" : \"2U05i7A-Qg60eM0a5iPw4A\",\n      \"_index\" : \"u-localhost-stc-d63fded1-043c-43ad-9135-d96b6d16cced-v20140916033807\",\n      \"_type\" : \"stc_page\",\n      \"_id\" : \"939ad133-5cd1-4132-a43a-037519dc1335\",\n      \"_score\" : 1.8167212,\n      \"_source\":{\"stc_parent\":\"4fad3fbf-0563-4df6-86e3-704f7a67b74e\"},\n      \"_explanation\" : {\n        \"value\" : 1.8167212,\n        \"description\" : \"product of:\",\n        \"details\" : [ {\n          \"value\" : 2.7250817,\n          \"description\" : \"sum of:\",\n          \"details\" : [ {\n            \"value\" : 0.7521613,\n            \"description\" : \"weight(stc_owner:e4a8c0e4-0971-414b-8eee-d9a262dbb2df in 0) [PerFieldSimilarity], result of:\",\n            \"details\" : [ {\n              \"value\" : 0.7521613,\n              \"description\" : \"score(doc=0,freq=1.0 = termFreq=1.0\\n), product of:\",\n              \"details\" : [ {\n                \"value\" : 0.42418543,\n                \"description\" : \"queryWeight, product of:\",\n                \"details\" : [ {\n                  \"value\" : 1.7731899,\n                  \"description\" : \"idf(docFreq=5, maxDocs=13)\"\n                }, {\n                  \"value\" : 0.23922166,\n                  \"description\" : \"queryNorm\"\n                } ]\n              }, {\n                \"value\" : 1.7731899,\n                \"description\" : \"fieldWeight in 0, product of:\",\n                \"details\" : [ {\n                  \"value\" : 1.0,\n                  \"description\" : \"tf(freq=1.0), with freq of:\",\n                  \"details\" : [ {\n                    \"value\" : 1.0,\n                    \"description\" : \"termFreq=1.0\"\n                  } ]\n                }, {\n                  \"value\" : 1.7731899,\n                  \"description\" : \"idf(docFreq=5, maxDocs=13)\"\n                }, {\n                  \"value\" : 1.0,\n                  \"description\" : \"fieldNorm(doc=0)\"\n                } ]\n              } ]\n            } ]\n          }, {\n            \"value\" : 1.9729203,\n            \"description\" : \"weight(stc_parent:4fad3fbf-0563-4df6-86e3-704f7a67b74e in 0) [PerFieldSimilarity], result of:\",\n            \"details\" : [ {\n              \"value\" : 1.9729203,\n              \"description\" : \"score(doc=0,freq=1.0 = termFreq=1.0\\n), product of:\",\n              \"details\" : [ {\n                \"value\" : 0.6869973,\n                \"description\" : \"queryWeight, product of:\",\n                \"details\" : [ {\n                  \"value\" : 2.871802,\n                  \"description\" : \"idf(docFreq=1, maxDocs=13)\"\n                }, {\n                  \"value\" : 0.23922166,\n                  \"description\" : \"queryNorm\"\n                } ]\n              }, {\n                \"value\" : 2.871802,\n                \"description\" : \"fieldWeight in 0, product of:\",\n                \"details\" : [ {\n                  \"value\" : 1.0,\n                  \"description\" : \"tf(freq=1.0), with freq of:\",\n                  \"details\" : [ {\n                    \"value\" : 1.0,\n                    \"description\" : \"termFreq=1.0\"\n                  } ]\n                }, {\n                  \"value\" : 2.871802,\n                  \"description\" : \"idf(docFreq=1, maxDocs=13)\"\n                }, {\n                  \"value\" : 1.0,\n                  \"description\" : \"fieldNorm(doc=0)\"\n                } ]\n              } ]\n            } ]\n          } ]\n        }, {\n          \"value\" : 0.6666667,\n          \"description\" : \"coord(2/3)\"\n        } ]\n      }\n    }\n(...)\n```\n\nOne possible workaround consists of rewriting the query as\n\n```\nmust: [\n  { term: { stc_owner: 'abc' } },\n  { terms: { stc_parent: [ 'def', 'ghj' ] } }\n]\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}