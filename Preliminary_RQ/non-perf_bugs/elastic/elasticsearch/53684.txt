{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53684","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53684/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53684/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53684/events","html_url":"https://github.com/elastic/elasticsearch/issues/53684","id":583178808,"node_id":"MDU6SXNzdWU1ODMxNzg4MDg=","number":53684,"title":"[CI] SourceOnlySnapshotIT fails for testSnapshotAndRestore and testSnapshotAndRestoreWithNested","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-03-17T17:29:41Z","updated_at":"2020-03-17T17:36:08Z","closed_at":"2020-03-17T17:36:07Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I've spotted this one after submitting a PR against 7.6 and failing consistently, just like in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+pull-request-2/18770/console.\r\n\r\n```\r\n17:05:22   2> REPRODUCE WITH: ./gradlew ':x-pack:plugin:core:internalClusterTest' --tests \"org.elasticsearch.snapshots.SourceOnlySnapshotIT.testSnapshotAndRestore\" -Dtests.seed=C8551ED852B77217 -Dtests.security.manager=true -Dtests.locale=pt-BR -Dtests.timezone=America/Costa_Rica -Dcompiler.java=13\r\n17:05:22   2> Failed to execute phase [query], all shards failed; shardFailures {[cag3_5_9TKy2bHAHpZG-fg][test-idx][0]: RemoteTransportException[[node_sd2][127.0.0.1:45305][indices:data/read/search[phase/query]]]; nested: QueryPhaseExecutionException[Query Failed [Failed to execute main query]]; nested: NotSerializableExceptionWrapper[unsupported_operation_exception: _source only indices can't be searched or filtered]; }\r\n17:05:22         at __randomizedtesting.SeedInfo.seed([C8551ED852B77217:8327DAB8F788F20]:0)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:545)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:306)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:574)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.onShardFailure(AbstractSearchAsyncAction.java:386)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.access$200(AbstractSearchAsyncAction.java:66)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:242)\r\n17:05:22         at org.elasticsearch.action.search.SearchExecutionStatsCollector.onFailure(SearchExecutionStatsCollector.java:73)\r\n17:05:22         at org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:59)\r\n17:05:22         at org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:423)\r\n17:05:22         at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1130)\r\n17:05:22         at org.elasticsearch.transport.InboundHandler.lambda$handleException$2(InboundHandler.java:244)\r\n17:05:22         at org.elasticsearch.common.util.concurrent.EsExecutors$DirectExecutorService.execute(EsExecutors.java:225)\r\n17:05:22         at org.elasticsearch.transport.InboundHandler.handleException(InboundHandler.java:242)\r\n17:05:22         at org.elasticsearch.transport.InboundHandler.handlerResponseError(InboundHandler.java:234)\r\n17:05:22         at org.elasticsearch.transport.InboundHandler.messageReceived(InboundHandler.java:137)\r\n17:05:22         at org.elasticsearch.transport.InboundHandler.inboundMessage(InboundHandler.java:103)\r\n17:05:22         at org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:667)\r\n17:05:22         at org.elasticsearch.transport.TcpTransport.consumeNetworkReads(TcpTransport.java:691)\r\n17:05:22         at org.elasticsearch.transport.nio.MockNioTransport$MockTcpReadWriteHandler.consumeReads(MockNioTransport.java:276)\r\n17:05:22         at org.elasticsearch.nio.SocketChannelContext.handleReadBytes(SocketChannelContext.java:228)\r\n17:05:22         at org.elasticsearch.nio.BytesChannelContext.read(BytesChannelContext.java:40)\r\n17:05:22         at org.elasticsearch.nio.EventHandler.handleRead(EventHandler.java:139)\r\n17:05:22         at org.elasticsearch.transport.nio.TestEventHandler.handleRead(TestEventHandler.java:151)\r\n17:05:22         at org.elasticsearch.nio.NioSelector.handleRead(NioSelector.java:420)\r\n17:05:22         at org.elasticsearch.nio.NioSelector.processKey(NioSelector.java:246)\r\n17:05:22         at org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:174)\r\n17:05:22         at org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:131)\r\n17:05:22         at java.lang.Thread.run(Thread.java:748)\r\n17:05:22 \r\n17:05:22         Caused by:\r\n17:05:22         NotSerializableExceptionWrapper[unsupported_operation_exception: _source only indices can't be searched or filtered]\r\n17:05:22             at org.elasticsearch.snapshots.SeqIdGeneratingFilterReader$SeqIdGeneratingSubReaderWrapper$1.terms(SeqIdGeneratingFilterReader.java:152)\r\n17:05:22             at org.apache.lucene.index.FilterLeafReader.terms(FilterLeafReader.java:366)\r\n17:05:22             at org.apache.lucene.index.TermStates.loadTermsEnum(TermStates.java:121)\r\n17:05:22             at org.apache.lucene.index.TermStates.build(TermStates.java:109)\r\n17:05:22             at org.apache.lucene.search.TermQuery.createWeight(TermQuery.java:199)\r\n17:05:22             at org.apache.lucene.search.IndexSearcher.createWeight(IndexSearcher.java:726)\r\n17:05:22             at org.elasticsearch.search.internal.ContextIndexSearcher.createWeight(ContextIndexSearcher.java:138)\r\n17:05:22             at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:445)\r\n17:05:22             at org.elasticsearch.search.query.QueryPhase.searchWithCollector(QueryPhase.java:333)\r\n17:05:22             at org.elasticsearch.search.query.QueryPhase.executeInternal(QueryPhase.java:295)\r\n17:05:22             at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:134)\r\n17:05:22             at org.elasticsearch.search.SearchService.loadOrExecuteQueryPhase(SearchService.java:338)\r\n17:05:22             at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:358)\r\n17:05:22             at org.elasticsearch.search.SearchService.lambda$executeQueryPhase$1(SearchService.java:343)\r\n17:05:22             at org.elasticsearch.action.ActionListener.lambda$map$2(ActionListener.java:146)\r\n17:05:22             at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\r\n17:05:22             at org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:58)\r\n17:05:22             at org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73)\r\n```\r\n\r\nAnd, also:\r\n\r\n\r\n```\r\n17:05:22   2> REPRODUCE WITH: ./gradlew ':x-pack:plugin:core:internalClusterTest' --tests \"org.elasticsearch.snapshots.SourceOnlySnapshotIT.testSnapshotAndRestoreWithNested\" -Dtests.seed=C8551ED852B77217 -Dtests.security.manager=true -Dtests.locale=pt-BR -Dtests.timezone=America/Costa_Rica -Dcompiler.java=13\r\n17:05:22   2> Failed to execute phase [query], all shards failed; shardFailures {[Y8odgH8rTJWkKTXH9VhOyw][test-idx][0]: RemoteTransportException[[node_sd2][127.0.0.1:37117][indices:data/read/search[phase/query]]]; nested: QueryPhaseExecutionException[Query Failed [Failed to execute main query]]; nested: UnsupportedOperationException[_source only indices can't be searched or filtered]; }\r\n17:05:22         at __randomizedtesting.SeedInfo.seed([C8551ED852B77217:3FA244755A7E84F3]:0)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:545)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:306)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:574)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.onShardFailure(AbstractSearchAsyncAction.java:386)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction.access$200(AbstractSearchAsyncAction.java:66)\r\n17:05:22         at org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:242)\r\n17:05:22         at org.elasticsearch.action.search.SearchExecutionStatsCollector.onFailure(SearchExecutionStatsCollector.java:73)\r\n17:05:22         at org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:59)\r\n17:05:22         at org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:423)\r\n17:05:22         at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1130)\r\n17:05:22         at org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1239)\r\n17:05:22         at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1213)\r\n17:05:22         at org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:60)\r\n17:05:22         at org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:56)\r\n17:05:22         at org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:71)\r\n17:05:22         at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:65)\r\n17:05:22         at org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:58)\r\n17:05:22         at org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73)\r\n17:05:22         at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n17:05:22         at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\r\n17:05:22         at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\r\n17:05:22         at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n17:05:22         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n17:05:22         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n17:05:22         at java.lang.Thread.run(Thread.java:748)\r\n17:05:22 \r\n17:05:22         Caused by:\r\n17:05:22         [_source only indices can't be searched or filtered]; nested: UnsupportedOperationException[_source only indices can't be searched or filtered];\r\n17:05:22             at org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:644)\r\n17:05:22             at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:304)\r\n17:05:22             ... 23 more\r\n17:05:22 \r\n17:05:22             Caused by:\r\n17:05:22             java.lang.UnsupportedOperationException: _source only indices can't be searched or filtered\r\n17:05:22                 at org.elasticsearch.snapshots.SeqIdGeneratingFilterReader$SeqIdGeneratingSubReaderWrapper$1.terms(SeqIdGeneratingFilterReader.java:152)\r\n17:05:22                 at org.apache.lucene.index.FilterLeafReader.terms(FilterLeafReader.java:366)\r\n17:05:22                 at org.apache.lucene.index.TermStates.loadTermsEnum(TermStates.java:121)\r\n17:05:22                 at org.apache.lucene.index.TermStates.build(TermStates.java:109)\r\n17:05:22                 at org.apache.lucene.search.TermQuery.createWeight(TermQuery.java:199)\r\n17:05:22                 at org.apache.lucene.search.IndexSearcher.createWeight(IndexSearcher.java:726)\r\n17:05:22                 at org.elasticsearch.search.internal.ContextIndexSearcher.createWeight(ContextIndexSearcher.java:138)\r\n17:05:22                 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:445)\r\n17:05:22                 at org.elasticsearch.search.query.QueryPhase.searchWithCollector(QueryPhase.java:333)\r\n17:05:22                 at org.elasticsearch.search.query.QueryPhase.executeInternal(QueryPhase.java:295)\r\n17:05:22                 at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:134)\r\n17:05:22                 at org.elasticsearch.search.SearchService.loadOrExecuteQueryPhase(SearchService.java:338)\r\n17:05:22                 at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:358)\r\n17:05:22                 at org.elasticsearch.search.SearchService.lambda$executeQueryPhase$1(SearchService.java:343)\r\n17:05:22                 at org.elasticsearch.action.ActionListener.lambda$map$2(ActionListener.java:146)\r\n17:05:22                 at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\r\n```","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}