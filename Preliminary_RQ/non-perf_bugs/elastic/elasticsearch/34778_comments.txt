[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432547457","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-432547457","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":432547457,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjU0NzQ1Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-24T07:40:20Z","updated_at":"2018-10-24T07:40:20Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432631281","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-432631281","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":432631281,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjYzMTI4MQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-10-24T12:15:55Z","updated_at":"2018-10-24T12:15:55Z","author_association":"MEMBER","body":"@melissachang Are you actually running into this kind of problem in a release version of Elasticsearch? Asking because I think the limit is only enforced starting with the yet unreleased version 7.0 (see https://github.com/elastic/elasticsearch/pull/26541). I think the warning might have been backported to previous versions of the docs by accident. However it is a good warning, since the limit is going to be enforced at least from 7.0 on to prevent accidental expansions of queries to all fields causing performance problems. So increasing it might be causing performance issues and at the moment doesn't seem to be possible.\r\n\r\n6600 is a huge number of fields, it would be interesting to learn more about your use case and see why you need to query so many fields. Maybe this indicates a problem in your document design. Could you elaborate?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435273815","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-435273815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":435273815,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTI3MzgxNQ==","user":{"login":"melissachang","id":10929390,"node_id":"MDQ6VXNlcjEwOTI5Mzkw","avatar_url":"https://avatars1.githubusercontent.com/u/10929390?v=4","gravatar_id":"","url":"https://api.github.com/users/melissachang","html_url":"https://github.com/melissachang","followers_url":"https://api.github.com/users/melissachang/followers","following_url":"https://api.github.com/users/melissachang/following{/other_user}","gists_url":"https://api.github.com/users/melissachang/gists{/gist_id}","starred_url":"https://api.github.com/users/melissachang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/melissachang/subscriptions","organizations_url":"https://api.github.com/users/melissachang/orgs","repos_url":"https://api.github.com/users/melissachang/repos","events_url":"https://api.github.com/users/melissachang/events{/privacy}","received_events_url":"https://api.github.com/users/melissachang/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T05:17:59Z","updated_at":"2018-11-02T05:17:59Z","author_association":"NONE","body":"So we finally got the index working. Elasticsearch 6.2.2, 122k documents, 6624 fields. Some of them are text fields with extra keyword fields, so there are actually 13251 mappings.\r\n```\r\nhttp://localhost:9200/_cat/indices?v\r\nhealth status index                       uuid                   pri rep docs.count docs.deleted store.size pri.store.size\r\nyellow open   nurse_s_health_study        eacHM2tARHetYdMlEHMN0A   5   1     121701            0      5.6gb          5.6gb\r\n```\r\nThis multi_match query worked beautifully:\r\n```\r\nGET /nurse_s_health_study/_search\r\n{\r\n  \"query\": {\r\n    \"multi_match\" : {\r\n      \"query\":    \"pre*\"\r\n    }\r\n  }\r\n}\r\n{\r\n  \"took\": 1485,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"skipped\": 0,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 106438,\r\n```\r\nI will explain my use case. But since things work with 13251 mappings, it seems like Elasticsearch shouldn't impose a hard limit? I can understand making the **default** limit 1024, but users should be able to increase that.\r\n\r\nI am using Elasticsearch to do faceted search on health-related datasets. You can see an [example here](https://test-data-explorer.appspot.com/).\r\n\r\n[Nurse's Health Study](http://www.nurseshealthstudy.org/) is one of our datasets. The Nurse's Health data is a table with 6k columns and 120k rows. Each row is a participant. Each column represents a field -- eg weight in a certain year, menopausal status in a certain year, etc. (Of course not every participant will have every field filled out.)\r\n\r\nIn the index, each document corresponds to a participant. Each of the 6k table columns is a field on the document.\r\n\r\nWe want to use `multi_match` to search across the column contents of all 6k columns. For example, `pre*` finds `pre/never`, `premenopause`, etc.\r\n\r\nCC @bfcrampton","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435338379","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-435338379","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":435338379,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTMzODM3OQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T10:38:54Z","updated_at":"2018-11-02T10:38:54Z","author_association":"MEMBER","body":"> But since things work with 13251 mappings, it seems like Elasticsearch shouldn't impose a hard limit? I can understand making the **default** limit 1024, but users should be able to increase that.\r\n\r\nGreat that it works in this particular case, but that still doesn't mean it works for other cases. We often see problems with that amount of fields. But I agree that it probably makes sense to make this configurable.\r\n\r\n> The Nurse's Health data is a table with 6k columns...\r\n\r\nThis again makes sense if you are coming from thinking of your data as a database table, but is problematic for an inverted index like Lucene that started out as being used for full text search. In your particular case I think the limit come into effect when searching across all fields. I would suggest to copy all text fields relevant to your search to a dedicated \"catch_all\" field using the `copy_to` parameter in the mappings.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435342386","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-435342386","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":435342386,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTM0MjM4Ng==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T10:55:47Z","updated_at":"2018-11-02T10:55:47Z","author_association":"MEMBER","body":"@melissachang fyi I changed the issue title to reflect better your ask about making the current hard limit introduced with https://github.com/elastic/elasticsearch/pull/26541 configurable. I marked this for internal group discussion, but maybe @dakrone who authored that change can share his thoughts on this as well on this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435420355","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-435420355","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":435420355,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTQyMDM1NQ==","user":{"login":"melissachang","id":10929390,"node_id":"MDQ6VXNlcjEwOTI5Mzkw","avatar_url":"https://avatars1.githubusercontent.com/u/10929390?v=4","gravatar_id":"","url":"https://api.github.com/users/melissachang","html_url":"https://github.com/melissachang","followers_url":"https://api.github.com/users/melissachang/followers","following_url":"https://api.github.com/users/melissachang/following{/other_user}","gists_url":"https://api.github.com/users/melissachang/gists{/gist_id}","starred_url":"https://api.github.com/users/melissachang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/melissachang/subscriptions","organizations_url":"https://api.github.com/users/melissachang/orgs","repos_url":"https://api.github.com/users/melissachang/repos","events_url":"https://api.github.com/users/melissachang/events{/privacy}","received_events_url":"https://api.github.com/users/melissachang/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T15:36:48Z","updated_at":"2018-11-02T15:36:48Z","author_association":"NONE","body":"Conceptually, our data is a database. It's not like other use cases like logs ingestion, where the fields are arbitrary strings. Our columns are well-defined and meaningful.\r\n\r\nWe are using Elasticsearch to perform full-text search over the database. It's performant, easy, and it works -- I don't see what the problem is.\r\n\r\nI experimented with `copy_to`. I spent maybe five hours and couldn't get `copy_to` to work with nested fields. (This is on a simple toy index, not the Nurse's Health index.) Also, there's no way to debug `copy_to`. Elasticsearch doesn't expose the inverted index in any way.\r\n\r\n`multi_match` works with zero work on our part. Just because some people experience performance problems with > 1024 fields, doesn't mean you should prohibit all users from this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435938123","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-435938123","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":435938123,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTkzODEyMw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-11-05T16:25:20Z","updated_at":"2018-11-05T16:25:20Z","author_association":"MEMBER","body":"We discussed this issue internally and agreed this limit should be configurable. We also said it would make sense to not introduce a new setting for overwrite this limit but instead use the `max_clause_count` setting that is currently already limiting the clauses a Lucene BooleanQuery can have to 1024. While changing this on master we should also make sure we update the deprecation warning on the 6.x branches to kick in only when the configurable `max_clause_count` limit is exceeded.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435984745","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-435984745","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":435984745,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTk4NDc0NQ==","user":{"login":"melissachang","id":10929390,"node_id":"MDQ6VXNlcjEwOTI5Mzkw","avatar_url":"https://avatars1.githubusercontent.com/u/10929390?v=4","gravatar_id":"","url":"https://api.github.com/users/melissachang","html_url":"https://github.com/melissachang","followers_url":"https://api.github.com/users/melissachang/followers","following_url":"https://api.github.com/users/melissachang/following{/other_user}","gists_url":"https://api.github.com/users/melissachang/gists{/gist_id}","starred_url":"https://api.github.com/users/melissachang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/melissachang/subscriptions","organizations_url":"https://api.github.com/users/melissachang/orgs","repos_url":"https://api.github.com/users/melissachang/repos","events_url":"https://api.github.com/users/melissachang/events{/privacy}","received_events_url":"https://api.github.com/users/melissachang/received_events","type":"User","site_admin":false},"created_at":"2018-11-05T18:35:29Z","updated_at":"2018-11-05T18:35:29Z","author_association":"NONE","body":"Great. Is there going to be an upper limit on `max_clause_count`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435999635","html_url":"https://github.com/elastic/elasticsearch/issues/34778#issuecomment-435999635","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34778","id":435999635,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTk5OTYzNQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-11-05T19:15:41Z","updated_at":"2018-11-05T19:15:41Z","author_association":"MEMBER","body":"Its default is 1024 clauses (if we use it for the field expansion as well this will mean 1024 fields). It can be increased to whatever value you want to, but you use this at your own risk then basically. Up until recently we didn't propery document this but I added docs about the setting in https://github.com/elastic/elasticsearch/pull/34779.","performed_via_github_app":null}]