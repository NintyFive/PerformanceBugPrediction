{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25259","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25259/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25259/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25259/events","html_url":"https://github.com/elastic/elasticsearch/issues/25259","id":236243988,"node_id":"MDU6SXNzdWUyMzYyNDM5ODg=","number":25259,"title":"New 5.4.1 cluster on EC2 fails with \"handshake failed. unexpected remote node\"","user":{"login":"andreausu","id":623986,"node_id":"MDQ6VXNlcjYyMzk4Ng==","avatar_url":"https://avatars3.githubusercontent.com/u/623986?v=4","gravatar_id":"","url":"https://api.github.com/users/andreausu","html_url":"https://github.com/andreausu","followers_url":"https://api.github.com/users/andreausu/followers","following_url":"https://api.github.com/users/andreausu/following{/other_user}","gists_url":"https://api.github.com/users/andreausu/gists{/gist_id}","starred_url":"https://api.github.com/users/andreausu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreausu/subscriptions","organizations_url":"https://api.github.com/users/andreausu/orgs","repos_url":"https://api.github.com/users/andreausu/repos","events_url":"https://api.github.com/users/andreausu/events{/privacy}","received_events_url":"https://api.github.com/users/andreausu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-06-15T16:18:02Z","updated_at":"2018-09-25T11:13:37Z","closed_at":"2017-06-16T10:11:50Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 5.4.1\r\n\r\n**Plugins installed**: [discovery-ec2]\r\n\r\n**JVM version** (`java -version`): JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_131/25.131-b11]\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Ubuntu 16.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nThis seems related to https://github.com/elastic/elasticsearch/issues/24575 even if it should've been fixed in 5.4.1.\r\nBasically I'm trying to set up a new cluster on AWS EC2 but as soon as I setup the second node the first one becomes unavailable (`master_not_discovered_exception`, full error in the error log below).\r\n\r\n**Steps to reproduce**:\r\n\r\nSetup 2 new EC2 instances in 2 steps using the official ansible playbook with the following config:\r\n\r\n```\r\n---\r\n\r\n- hosts: tag_Role_elasticsearch_logs_production\r\n  user: ubuntu\r\n  sudo: true\r\n\r\n  gather_facts: False\r\n  pre_tasks:\r\n    - name: Install python for Ansible\r\n      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)\r\n      changed_when: False\r\n    - name: Install aptitude for Ansible\r\n      raw: test -e /usr/bin/aptitude || (apt -y update && apt install -y aptitude)\r\n      changed_when: False\r\n    - setup:\r\n\r\n  roles:\r\n    - { role: ansible-elasticsearch, es_instance_name: \"{{ ansible_hostname }}\", es_data_dirs: \"/opt/elasticsearch/data\", es_log_dir: \"/opt/elasticsearch/logs\",\r\n        es_config: {\r\n          cluster.name: \"prima-logs-production\",\r\n          bootstrap.memory_lock: true,\r\n          discovery.zen.hosts_provider: \"ec2\",\r\n          cloud.aws.region: \"eu-west-1\",\r\n          discovery.ec2.groups: \"sg-a6d731de\",\r\n          discovery.ec2.host_type: \"private_dns\",\r\n          network.bind_host: 0.0.0.0\r\n        }\r\n      }\r\n\r\n  vars:\r\n    es_version_lock: false\r\n    es_heap_size: 4g\r\n    es_major_version: 5.x\r\n    es_version: 5.4.1\r\n    es_start_service: true\r\n    es_plugins_reinstall: true\r\n    es_plugins:\r\n      - plugin: discovery-ec2\r\n```\r\n\r\nFirst node that stopped working when the second node was started (the service restarts are made by ansible):\r\n\r\n```\r\n[2017-06-15T15:22:41,110][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] initializing ...\r\n[2017-06-15T15:22:41,200][INFO ][o.e.e.NodeEnvironment    ] [10.33.3.54-ip-10-33-3-54] using [1] data paths, mounts [[/ (/dev/xvda1)]], net usable_space [482.5gb], net total_space [484.6gb], spins? [no], types [ext4]\r\n[2017-06-15T15:22:41,201][INFO ][o.e.e.NodeEnvironment    ] [10.33.3.54-ip-10-33-3-54] heap size [3.9gb], compressed ordinary object pointers [true]\r\n[2017-06-15T15:22:41,202][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] node name [10.33.3.54-ip-10-33-3-54], node ID [hH1GaZyETSqQpvryQ8VMcQ]\r\n[2017-06-15T15:22:41,203][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] version[5.4.1], pid[12899], build[2cfe0df/2017-05-29T16:05:51.443Z], OS[Linux/4.4.0-1013-aws/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_131/25.131-b11]\r\n[2017-06-15T15:22:41,203][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] JVM arguments [-Xms4g, -Xmx4g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+DisableExplicitGC, -XX:+AlwaysPreTouch, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j.skipJansi=true, -XX:+HeapDumpOnOutOfMemoryError, -Des.path.home=/usr/share/elasticsearch]\r\n[2017-06-15T15:22:42,633][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [aggs-matrix-stats]\r\n[2017-06-15T15:22:42,633][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [ingest-common]\r\n[2017-06-15T15:22:42,633][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [lang-expression]\r\n[2017-06-15T15:22:42,634][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [lang-groovy]\r\n[2017-06-15T15:22:42,634][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [lang-mustache]\r\n[2017-06-15T15:22:42,634][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [lang-painless]\r\n[2017-06-15T15:22:42,634][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [percolator]\r\n[2017-06-15T15:22:42,634][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [reindex]\r\n[2017-06-15T15:22:42,634][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [transport-netty3]\r\n[2017-06-15T15:22:42,634][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [transport-netty4]\r\n[2017-06-15T15:22:42,635][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded plugin [discovery-ec2]\r\n[2017-06-15T15:22:45,405][INFO ][o.e.d.DiscoveryModule    ] [10.33.3.54-ip-10-33-3-54] using discovery type [zen]\r\n[2017-06-15T15:22:46,030][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] initialized\r\n[2017-06-15T15:22:46,031][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] starting ...\r\n[2017-06-15T15:22:46,218][INFO ][o.e.t.TransportService   ] [10.33.3.54-ip-10-33-3-54] publish_address {127.0.0.1:9300}, bound_addresses {[::]:9300}\r\n[2017-06-15T15:22:46,227][INFO ][o.e.b.BootstrapChecks    ] [10.33.3.54-ip-10-33-3-54] bound or publishing to a non-loopback or non-link-local address, enforcing bootstrap checks\r\n[2017-06-15T15:22:50,091][INFO ][o.e.c.s.ClusterService   ] [10.33.3.54-ip-10-33-3-54] new_master {10.33.3.54-ip-10-33-3-54}{hH1GaZyETSqQpvryQ8VMcQ}{L7mjja2FQe6lBV31H8WnMQ}{127.0.0.1}{127.0.0.1:9300}, reason: zen-disco-elected-as-master ([0] nodes joined)\r\n[2017-06-15T15:22:50,125][INFO ][o.e.h.n.Netty4HttpServerTransport] [10.33.3.54-ip-10-33-3-54] publish_address {127.0.0.1:9200}, bound_addresses {[::]:9200}\r\n[2017-06-15T15:22:50,127][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] started\r\n[2017-06-15T15:22:50,186][INFO ][o.e.g.GatewayService     ] [10.33.3.54-ip-10-33-3-54] recovered [0] indices into cluster_state\r\n[2017-06-15T16:00:28,098][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] stopping ...\r\n[2017-06-15T16:00:28,110][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] stopped\r\n[2017-06-15T16:00:28,110][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] closing ...\r\n[2017-06-15T16:00:28,122][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] closed\r\n[2017-06-15T16:00:30,485][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] initializing ...\r\n[2017-06-15T16:00:30,559][INFO ][o.e.e.NodeEnvironment    ] [10.33.3.54-ip-10-33-3-54] using [1] data paths, mounts [[/ (/dev/xvda1)]], net usable_space [482.5gb], net total_space [484.6gb], spins? [no], types [ext4]\r\n[2017-06-15T16:00:30,559][INFO ][o.e.e.NodeEnvironment    ] [10.33.3.54-ip-10-33-3-54] heap size [3.9gb], compressed ordinary object pointers [true]\r\n[2017-06-15T16:00:30,561][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] node name [10.33.3.54-ip-10-33-3-54], node ID [hH1GaZyETSqQpvryQ8VMcQ]\r\n[2017-06-15T16:00:30,561][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] version[5.4.1], pid[22726], build[2cfe0df/2017-05-29T16:05:51.443Z], OS[Linux/4.4.0-1013-aws/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_131/25.131-b11]\r\n[2017-06-15T16:00:30,561][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] JVM arguments [-Xms4g, -Xmx4g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+DisableExplicitGC, -XX:+AlwaysPreTouch, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j.skipJansi=true, -XX:+HeapDumpOnOutOfMemoryError, -Des.path.home=/usr/share/elasticsearch]\r\n[2017-06-15T16:00:32,107][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [aggs-matrix-stats]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [ingest-common]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [lang-expression]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [lang-groovy]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [lang-mustache]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [lang-painless]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [percolator]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [reindex]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [transport-netty3]\r\n[2017-06-15T16:00:32,108][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded module [transport-netty4]\r\n[2017-06-15T16:00:32,110][INFO ][o.e.p.PluginsService     ] [10.33.3.54-ip-10-33-3-54] loaded plugin [discovery-ec2]\r\n[2017-06-15T16:00:34,980][INFO ][o.e.d.DiscoveryModule    ] [10.33.3.54-ip-10-33-3-54] using discovery type [zen]\r\n[2017-06-15T16:00:35,547][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] initialized\r\n[2017-06-15T16:00:35,547][INFO ][o.e.n.Node               ] [10.33.3.54-ip-10-33-3-54] starting ...\r\n[2017-06-15T16:00:35,724][INFO ][o.e.t.TransportService   ] [10.33.3.54-ip-10-33-3-54] publish_address {127.0.0.1:9300}, bound_addresses {[::]:9300}\r\n[2017-06-15T16:00:35,736][INFO ][o.e.b.BootstrapChecks    ] [10.33.3.54-ip-10-33-3-54] bound or publishing to a non-loopback or non-link-local address, enforcing bootstrap checks\r\n[2017-06-15T16:00:39,862][WARN ][o.e.d.z.ZenDiscovery     ] [10.33.3.54-ip-10-33-3-54] failed to connect to master [{10.33.3.45-ip-10-33-3-45}{gw7g-PF8Tm2oxChEQIHWNg}{BDhWOA-iR1-ORSYNijJPGA}{127.0.0.1}{127.0.0.1:9300}], retrying...\r\norg.elasticsearch.transport.ConnectTransportException: [10.33.3.45-ip-10-33-3-45][127.0.0.1:9300] handshake failed. unexpected remote node {10.33.3.54-ip-10-33-3-54}{hH1GaZyETSqQpvryQ8VMcQ}{d08Cz7N5RsGrcbSQQGR6vQ}{127.0.0.1}{127.0.0.1:9300}\r\n        at org.elasticsearch.transport.TransportService.lambda$connectToNode$3(TransportService.java:319) ~[elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.transport.TcpTransport.connectToNode(TcpTransport.java:474) ~[elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:315) ~[elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:302) ~[elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.discovery.zen.ZenDiscovery.joinElectedMaster(ZenDiscovery.java:468) [elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.discovery.zen.ZenDiscovery.innerJoinCluster(ZenDiscovery.java:420) [elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.discovery.zen.ZenDiscovery.joinElectedMaster(ZenDiscovery.java:468) [elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.discovery.zen.ZenDiscovery.innerJoinCluster(ZenDiscovery.java:420) [elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.discovery.zen.ZenDiscovery.access$4100(ZenDiscovery.java:83) [elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.discovery.zen.ZenDiscovery$JoinThreadControl$1.run(ZenDiscovery.java:1197) [elasticsearch-5.4.1.jar:5.4.1]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569) [elasticsearch-5.4.1.jar:5.4.1]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n\r\n```\r\n\r\nSecond node that it's working:\r\n\r\n```\r\n[2017-06-15T16:00:30,600][INFO ][o.e.n.Node               ] [10.33.3.45-ip-10-33-3-45] initializing ...\r\n[2017-06-15T16:00:30,690][INFO ][o.e.e.NodeEnvironment    ] [10.33.3.45-ip-10-33-3-45] using [1] data paths, mounts [[/ (/dev/xvda1)]], net usable_space [482.6gb], net total_space [484.6gb], spins? [no], types [ext4]\r\n[2017-06-15T16:00:30,691][INFO ][o.e.e.NodeEnvironment    ] [10.33.3.45-ip-10-33-3-45] heap size [3.9gb], compressed ordinary object pointers [true]\r\n[2017-06-15T16:00:30,698][INFO ][o.e.n.Node               ] [10.33.3.45-ip-10-33-3-45] node name [10.33.3.45-ip-10-33-3-45], node ID [gw7g-PF8Tm2oxChEQIHWNg]\r\n[2017-06-15T16:00:30,698][INFO ][o.e.n.Node               ] [10.33.3.45-ip-10-33-3-45] version[5.4.1], pid[5779], build[2cfe0df/2017-05-29T16:05:51.443Z], OS[Linux/4.4.0-1013-aws/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_131/25.131-b11]\r\n[2017-06-15T16:00:30,698][INFO ][o.e.n.Node               ] [10.33.3.45-ip-10-33-3-45] JVM arguments [-Xms4g, -Xmx4g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+DisableExplicitGC, -XX:+AlwaysPreTouch, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j.skipJansi=true, -XX:+HeapDumpOnOutOfMemoryError, -Des.path.home=/usr/share/elasticsearch]\r\n[2017-06-15T16:00:32,301][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [aggs-matrix-stats]\r\n[2017-06-15T16:00:32,301][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [ingest-common]\r\n[2017-06-15T16:00:32,301][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [lang-expression]\r\n[2017-06-15T16:00:32,301][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [lang-groovy]\r\n[2017-06-15T16:00:32,301][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [lang-mustache]\r\n[2017-06-15T16:00:32,301][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [lang-painless]\r\n[2017-06-15T16:00:32,302][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [percolator]\r\n[2017-06-15T16:00:32,302][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [reindex]\r\n[2017-06-15T16:00:32,302][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [transport-netty3]\r\n[2017-06-15T16:00:32,302][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded module [transport-netty4]\r\n[2017-06-15T16:00:32,303][INFO ][o.e.p.PluginsService     ] [10.33.3.45-ip-10-33-3-45] loaded plugin [discovery-ec2]\r\n[2017-06-15T16:00:35,315][INFO ][o.e.d.DiscoveryModule    ] [10.33.3.45-ip-10-33-3-45] using discovery type [zen]\r\n[2017-06-15T16:00:35,939][INFO ][o.e.n.Node               ] [10.33.3.45-ip-10-33-3-45] initialized\r\n[2017-06-15T16:00:35,940][INFO ][o.e.n.Node               ] [10.33.3.45-ip-10-33-3-45] starting ...\r\n[2017-06-15T16:00:36,113][INFO ][o.e.t.TransportService   ] [10.33.3.45-ip-10-33-3-45] publish_address {127.0.0.1:9300}, bound_addresses {[::]:9300}\r\n[2017-06-15T16:00:36,123][INFO ][o.e.b.BootstrapChecks    ] [10.33.3.45-ip-10-33-3-45] bound or publishing to a non-loopback or non-link-local address, enforcing bootstrap checks\r\n[2017-06-15T16:00:39,984][INFO ][o.e.c.s.ClusterService   ] [10.33.3.45-ip-10-33-3-45] new_master {10.33.3.45-ip-10-33-3-45}{gw7g-PF8Tm2oxChEQIHWNg}{BDhWOA-iR1-ORSYNijJPGA}{127.0.0.1}{127.0.0.1:9300}, reason: zen-disco-elected-as-master ([0] nodes joined)\r\n[2017-06-15T16:00:40,016][INFO ][o.e.h.n.Netty4HttpServerTransport] [10.33.3.45-ip-10-33-3-45] publish_address {127.0.0.1:9200}, bound_addresses {[::]:9200}\r\n[2017-06-15T16:00:40,019][INFO ][o.e.g.GatewayService     ] [10.33.3.45-ip-10-33-3-45] recovered [0] indices into cluster_state\r\n[2017-06-15T16:00:40,020][INFO ][o.e.n.Node               ] [10.33.3.45-ip-10-33-3-45] started\r\n```\r\n\r\nThe port 9300 is open both ways (successful connection using telnet).\r\n\r\n**Provide logs (if relevant)**:\r\n\r\nES Config:\r\n\r\n```\r\nbootstrap.memory_lock: true\r\ncloud.aws.region: eu-west-1\r\ncluster.name: prima-logs-production\r\ndiscovery.ec2.groups: sg-a6d731de\r\ndiscovery.ec2.host_type: private_dns\r\ndiscovery.zen.hosts_provider: ec2\r\nnetwork.bind_host: 0.0.0.0\r\nnode.name: 10.33.3.37-ip-10-33-3-37\r\n\r\n#################################### Paths ####################################\r\n\r\n# Path to directory containing configuration (this file and logging.yml):\r\npath.conf: /etc/elasticsearch/ip-10-33-3-37\r\npath.data: /opt/elasticsearch/data/10.33.3.37-ip-10-33-3-37\r\npath.logs: /opt/elasticsearch/logs/10.33.3.37-ip-10-33-3-37\r\n```\r\n\r\nES response of the first node that isn't connecting:\r\n\r\n```\r\n{\r\n\"name\": \"10.33.3.54-ip-10-33-3-54\",\r\n\"cluster_name\": \"prima-logs-production\",\r\n\"cluster_uuid\": \"_na_\",\r\n\"version\": {\r\n\"number\": \"5.4.1\",\r\n\"build_hash\": \"2cfe0df\",\r\n\"build_date\": \"2017-05-29T16:05:51.443Z\",\r\n\"build_snapshot\": false,\r\n\"lucene_version\": \"6.5.1\"\r\n},\r\n\"tagline\": \"You Know, for Search\"\r\n}\r\n```\r\n\r\nES response of the second node:\r\n\r\n```\r\n{\r\n\"name\": \"10.33.3.45-ip-10-33-3-45\",\r\n\"cluster_name\": \"prima-logs-production\",\r\n\"cluster_uuid\": \"lTqWpjaITWWL0x52_4sIZA\",\r\n\"version\": {\r\n\"number\": \"5.4.1\",\r\n\"build_hash\": \"2cfe0df\",\r\n\"build_date\": \"2017-05-29T16:05:51.443Z\",\r\n\"build_snapshot\": false,\r\n\"lucene_version\": \"6.5.1\"\r\n},\r\n\"tagline\": \"You Know, for Search\"\r\n}\r\n```","closed_by":{"login":"andreausu","id":623986,"node_id":"MDQ6VXNlcjYyMzk4Ng==","avatar_url":"https://avatars3.githubusercontent.com/u/623986?v=4","gravatar_id":"","url":"https://api.github.com/users/andreausu","html_url":"https://github.com/andreausu","followers_url":"https://api.github.com/users/andreausu/followers","following_url":"https://api.github.com/users/andreausu/following{/other_user}","gists_url":"https://api.github.com/users/andreausu/gists{/gist_id}","starred_url":"https://api.github.com/users/andreausu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreausu/subscriptions","organizations_url":"https://api.github.com/users/andreausu/orgs","repos_url":"https://api.github.com/users/andreausu/repos","events_url":"https://api.github.com/users/andreausu/events{/privacy}","received_events_url":"https://api.github.com/users/andreausu/received_events","type":"User","site_admin":false},"performed_via_github_app":null}