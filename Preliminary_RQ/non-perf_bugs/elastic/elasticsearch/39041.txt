{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39041","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39041/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39041/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39041/events","html_url":"https://github.com/elastic/elasticsearch/issues/39041","id":411390086,"node_id":"MDU6SXNzdWU0MTEzOTAwODY=","number":39041,"title":"Rollup search: search is not working by mixed indexes","user":{"login":"alexwizp","id":20072247,"node_id":"MDQ6VXNlcjIwMDcyMjQ3","avatar_url":"https://avatars0.githubusercontent.com/u/20072247?v=4","gravatar_id":"","url":"https://api.github.com/users/alexwizp","html_url":"https://github.com/alexwizp","followers_url":"https://api.github.com/users/alexwizp/followers","following_url":"https://api.github.com/users/alexwizp/following{/other_user}","gists_url":"https://api.github.com/users/alexwizp/gists{/gist_id}","starred_url":"https://api.github.com/users/alexwizp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexwizp/subscriptions","organizations_url":"https://api.github.com/users/alexwizp/orgs","repos_url":"https://api.github.com/users/alexwizp/repos","events_url":"https://api.github.com/users/alexwizp/events{/privacy}","received_events_url":"https://api.github.com/users/alexwizp/received_events","type":"User","site_admin":false},"labels":[{"id":912843355,"node_id":"MDU6TGFiZWw5MTI4NDMzNTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Rollup","name":":Analytics/Rollup","color":"0e8a16","default":false,"description":"Turn fine-grained time-based data into coarser-grained data"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-02-18T09:54:46Z","updated_at":"2019-02-21T07:42:58Z","closed_at":"2019-02-21T07:42:57Z","author_association":"NONE","active_lock_reason":null,"body":"Regression, it worked before. \r\n\r\n**Steps to reproduce:** \r\n1) Add some of our default sample data e.g. 'Sample eCommerce orders'  (index: kibana_sample_data_flights)\r\n2) Create a Rollup job by that index. In my example I've created a rollup-index with name: test.\r\n3) Try to search by two indexes: \r\n       GET kibana_sample_data_flights,test/_rollup_search\r\n\r\n**Expected result:** I expect to see data by mixed index. \r\n**Actual result:** I see an error message\r\n![image](https://user-images.githubusercontent.com/20072247/52941821-bf4c8300-337a-11e9-8d75-e44519361322.png)\r\n\r\n**Rollup job configuration:** \r\n```\r\n{\r\n  \"config\": {\r\n    \"id\": \"test\",\r\n    \"index_pattern\": \"kibana_sample_data_ecommerce\",\r\n    \"rollup_index\": \"test\",\r\n    \"cron\": \"0 45 * * * ?\",\r\n    \"groups\": {\r\n      \"date_histogram\": {\r\n        \"interval\": \"2m\",\r\n        \"field\": \"order_date\",\r\n        \"delay\": \"1m\",\r\n        \"time_zone\": \"UTC\"\r\n      },\r\n      \"histogram\": {\r\n        \"interval\": 10,\r\n        \"fields\": [\r\n          \"products.min_price\",\r\n          \"products.price\",\r\n          \"products.quantity\",\r\n          \"day_of_week_i\"\r\n        ]\r\n      },\r\n      \"terms\": {\r\n        \"fields\": [\r\n          \"category.keyword\",\r\n          \"currency\",\r\n          \"day_of_week\",\r\n          \"day_of_week_i\"\r\n        ]\r\n      }\r\n    },\r\n    \"metrics\": [\r\n      {\r\n        \"field\": \"products.price\",\r\n        \"metrics\": [\r\n          \"avg\",\r\n          \"max\",\r\n          \"min\",\r\n          \"sum\",\r\n          \"value_count\"\r\n        ]\r\n      },\r\n      {\r\n        \"field\": \"day_of_week_i\",\r\n        \"metrics\": [\r\n          \"avg\",\r\n          \"max\",\r\n          \"min\",\r\n          \"value_count\",\r\n          \"sum\"\r\n        ]\r\n      },\r\n      {\r\n        \"field\": \"products.quantity\",\r\n        \"metrics\": [\r\n          \"avg\",\r\n          \"max\",\r\n          \"min\",\r\n          \"sum\",\r\n          \"value_count\"\r\n        ]\r\n      }\r\n    ],\r\n    \"timeout\": \"20s\",\r\n    \"page_size\": 1000\r\n  },\r\n  \"status\": {\r\n    \"job_state\": \"started\",\r\n    \"current_position\": {\r\n      \"category.keyword.terms\": \"Men's Shoes\",\r\n      \"currency.terms\": \"EUR\",\r\n      \"day_of_week.terms\": \"Monday\",\r\n      \"day_of_week_i.histogram\": 0,\r\n      \"day_of_week_i.terms\": 0,\r\n      \"order_date.date_histogram\": 1550479080000,\r\n      \"products.min_price.histogram\": 20,\r\n      \"products.price.histogram\": 60,\r\n      \"products.quantity.histogram\": 0\r\n    },\r\n    \"upgraded_doc_id\": true\r\n  },\r\n  \"stats\": {\r\n    \"pages_processed\": 13,\r\n    \"documents_processed\": 14536,\r\n    \"rollups_indexed\": 3919,\r\n    \"trigger_count\": 5,\r\n    \"index_time_in_ms\": 1238,\r\n    \"index_total\": 8,\r\n    \"index_failures\": 0,\r\n    \"search_time_in_ms\": 512,\r\n    \"search_total\": 13,\r\n    \"search_failures\": 0\r\n  }\r\n}\r\n```\r\n\r\n**Query to ES:** \r\n```\r\nGET kibana_sample_data_flights,test/_rollup_search\r\n{\r\n\t\"size\": 0,\r\n\t\"query\": {\r\n\t\t\"bool\": {\r\n\t\t\t\"must\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"range\": {\r\n\t\t\t\t\t\t\"order_date\": {\r\n\t\t\t\t\t\t\t\"gte\": 1550463050080,\r\n\t\t\t\t\t\t\t\"lte\": 1550464228892,\r\n\t\t\t\t\t\t\t\"format\": \"epoch_millis\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"filter\": [],\r\n\t\t\t\"should\": [],\r\n\t\t\t\"must_not\": []\r\n\t\t}\r\n\t},\r\n\t\"aggs\": {\r\n\t\t\"timeseries\": {\r\n\t\t\t\"date_histogram\": {\r\n\t\t\t\t\"field\": \"order_date\",\r\n\t\t\t\t\"interval\": \"2m\",\r\n\t\t\t\t\"min_doc_count\": 0,\r\n\t\t\t\t\"time_zone\": \"UTC\",\r\n\t\t\t\t\"extended_bounds\": {\r\n\t\t\t\t\t\"min\": 1550463050080,\r\n\t\t\t\t\t\"max\": 1550464228892\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\"aggs\": {\r\n\t\t\t\t\"61ca57f2-469d-11e7-af02-69e470af7417\": {\r\n\t\t\t\t\t\"bucket_script\": {\r\n\t\t\t\t\t\t\"buckets_path\": {\r\n\t\t\t\t\t\t\t\"count\": \"_count\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"script\": {\r\n\t\t\t\t\t\t\t\"source\": \"count * 1\",\r\n\t\t\t\t\t\t\t\"lang\": \"expression\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"gap_policy\": \"skip\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\"timeout\": \"30000ms\"\r\n}\r\n\r\n```","closed_by":{"login":"alexwizp","id":20072247,"node_id":"MDQ6VXNlcjIwMDcyMjQ3","avatar_url":"https://avatars0.githubusercontent.com/u/20072247?v=4","gravatar_id":"","url":"https://api.github.com/users/alexwizp","html_url":"https://github.com/alexwizp","followers_url":"https://api.github.com/users/alexwizp/followers","following_url":"https://api.github.com/users/alexwizp/following{/other_user}","gists_url":"https://api.github.com/users/alexwizp/gists{/gist_id}","starred_url":"https://api.github.com/users/alexwizp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexwizp/subscriptions","organizations_url":"https://api.github.com/users/alexwizp/orgs","repos_url":"https://api.github.com/users/alexwizp/repos","events_url":"https://api.github.com/users/alexwizp/events{/privacy}","received_events_url":"https://api.github.com/users/alexwizp/received_events","type":"User","site_admin":false},"performed_via_github_app":null}