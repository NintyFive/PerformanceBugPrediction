{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/35177","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35177/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35177/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35177/events","html_url":"https://github.com/elastic/elasticsearch/issues/35177","id":376505711,"node_id":"MDU6SXNzdWUzNzY1MDU3MTE=","number":35177,"title":"Rolling-upgrade test runner stops too many nodes","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-11-01T18:07:08Z","updated_at":"2020-11-11T21:50:14Z","closed_at":"2019-09-05T11:23:39Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When investigating #34950 I tried running the `REPRODUCE WITH` line and it failed for an unrelated reason. A simpler reproduction is to run:\r\n\r\n    ./gradlew :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestRunner -Dtests.class=org.elasticsearch.upgrades.RecoveryIT\r\n\r\nThis fails because it starts up three nodes, stops two of them, starts another one, and the two nodes that result from this aren't enough to form the cluster again. It should only stop one of them. Log excerpt:\r\n\r\n```\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oldClusterTestRunner\r\n==> Test Summary: 1 suite, 4 tests, 2 ignored (2 assumptions)\r\n   [junit4] JVM J0:     0.32 ..     5.75 =     5.43s\r\n   [junit4] Execution time total: 5.77 sec.\r\n   [junit4] Tests summary: 1 suite, 4 tests, 2 ignored (2 assumptions)\r\n\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oldClusterTestCluster#node2.stop\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oldClusterTestCluster#node0.stop\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#prepareCluster.cleanShared\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#clean\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#createCwd\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#checkPrevious SKIPPED\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#stopPrevious SKIPPED\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#extract\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#configure\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#start\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#wait\r\n\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#wait FAILED\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oneThirdUpgradedTestCluster#stop\r\n> Task :qa:rolling-upgrade:v6.6.0-SNAPSHOT#oldClusterTestCluster#node1.stop\r\n```\r\n\r\nHowever running the whole BWC test does pass:\r\n\r\n    ./gradlew :qa:rolling-upgrade:bwcTest -Dtests.class=org.elasticsearch.upgrades.RecoveryIT\r\n","closed_by":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"performed_via_github_app":null}