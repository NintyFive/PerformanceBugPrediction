[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66306379","html_url":"https://github.com/elastic/elasticsearch/issues/8851#issuecomment-66306379","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8851","id":66306379,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MzA2Mzc5","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"created_at":"2014-12-09T16:04:25Z","updated_at":"2014-12-09T16:04:25Z","author_association":"CONTRIBUTOR","body":"```\nindex                         shard time   type       stage source_host target_host repository snapshot files files_percent bytes       bytes_percent\nstatistics-20140830           2     71391  relocation index web607      web606      n/a        n/a      27    96.3%         2496867005  98.2%\nstatistics-20131118           0     32368  relocation index web606      web607      n/a        n/a      27    96.3%         1246676262  86.0%\n```\n\n```\nindex                         shard time   type       stage source_host target_host repository snapshot files files_percent bytes       bytes_percent\nstatistics-20141031           1     8719   relocation index web606      web607      n/a        n/a      27    77.8%         2888487819  15.1%\nstatistics-20140727           0     18103  relocation index web607      web606      n/a        n/a      27    77.8%         2010520985  39.2%\n```\n\n```\nindex                         shard time   type       stage source_host target_host repository snapshot files files_percent bytes       bytes_percent\nstatistics-20141121           1     2755   relocation index web606      web607      n/a        n/a      27    51.9%         2640396281  3.4%\nstatistics-20140523           0     6925   relocation index web607      web606      n/a        n/a      27    74.1%         1831083953  7.2%\n```\n\n```\nindex                         shard time   type       stage source_host target_host repository snapshot files files_percent bytes       bytes_percent\nstatistics-20140831           2     29902  relocation index web606      web607      n/a        n/a      27    85.2%         2547843368  40.4%\nstatistics-20140127           0     47969  relocation index web607      web606      n/a        n/a      27    96.3%         1496376261  100.0%\n```\n\n```\nindex                         shard time   type       stage source_host target_host repository snapshot files files_percent bytes       bytes_percent\nstatistics-20140820           1     6968   relocation index web606      web607      n/a        n/a      27    74.1%         2066391857  21.7%\nstatistics-20141030           2     12418  relocation index web607      web606      n/a        n/a      27    85.2%         2464653918  34.5%\n```\n\nNot the cheapest thing to do for a cluster under load. Interestingly, is not participating in this shuffling.\n\n```\nhost   ip           heap.percent ram.percent load node.role master name\nweb606 192.168.2.95           53          22 6.56 d         m      statistics07\nweb607 192.168.2.96           71          23 7.89 d         *      statistics08\nweb605 192.168.2.94           56          22 1.73 d         m      statistics06\n```\n\nLoad average there is lower, as you see.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66308773","html_url":"https://github.com/elastic/elasticsearch/issues/8851#issuecomment-66308773","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8851","id":66308773,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MzA4Nzcz","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-12-09T16:17:48Z","updated_at":"2014-12-09T16:18:11Z","author_association":"CONTRIBUTOR","body":"if you remove indices the balancer can see a chance to get a better overall balance and it might move shards around if it can and if it makes sense no matter if the disk size is equal. We don't take disk usage into account yet. The entire thing is a pretty intense discussion. Can I see how many shards are per node for these indices?\n\nCan you provide your setting too like concurrent rebalance etc?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66311070","html_url":"https://github.com/elastic/elasticsearch/issues/8851#issuecomment-66311070","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8851","id":66311070,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MzExMDcw","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"created_at":"2014-12-09T16:30:00Z","updated_at":"2014-12-09T16:30:00Z","author_association":"CONTRIBUTOR","body":"```\nindices.recovery.concurrent_streams: 5\nindices.recovery.max_bytes_per_sec: 200mb\n```\n\nThis is all what I have in `elasticsearch.yml` about recovery.\n\nIndices mostly have 5 shards and 0 replicas. Distribution could look like this:\n\n```\nindex               shard prirep ip           segment generation docs.count docs.deleted     size size.memory committed searchable version compound\nstatistics-20140512 0     p      192.168.2.94 _mo2         29378    5165999            0  570.9mb     1194000 true      true       4.6.0   false\nstatistics-20140512 0     p      192.168.2.94 _n4v         29983    7013120            0  772.8mb     2221768 true      true       4.9.0   false\nstatistics-20140512 1     p      192.168.2.96 _lfu         27786    5880136            0  657.4mb     1564848 true      true       4.6.0   false\nstatistics-20140512 1     p      192.168.2.96 _lq9         28161    5705014            0  652.9mb     1504816 true      true       4.9.0   false\nstatistics-20140512 2     p      192.168.2.95 _owl         32277    5226161            0    545mb     1199048 true      true       4.6.0   false\nstatistics-20140512 2     p      192.168.2.95 _p8o         32712    8039384            0  844.5mb     2655112 true      true       4.9.0   false\nstatistics-20140512 3     p      192.168.2.96 _jsn         25655    4646448            0  483.6mb      969208 true      true       4.6.0   false\nstatistics-20140512 3     p      192.168.2.96 _rts         36064    9493601            0 1002.7mb     3597432 true      true       4.9.0   false\nstatistics-20140512 4     p      192.168.2.96 _g6x         20985    7353308            0  818.9mb     2339240 true      true       4.6.0   false\nstatistics-20140512 4     p      192.168.2.96 _isp         24361    3456995            0  392.7mb      780912 true      true       4.9.0   false\n```\n\nBtw, third node is doing rebalancing too.\n\nCan you explain how best distribution for an index could change after another index is deleted? Link to an issue with discussion could help too!\n\nMy understanding of placement policy was \"evenly distribute shards between nodes taking disk space into account\". This way if index is deleted it might be a good idea to move a some shards if some disk usage disbalance threshold is violated.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66313454","html_url":"https://github.com/elastic/elasticsearch/issues/8851#issuecomment-66313454","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8851","id":66313454,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MzEzNDU0","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-12-09T16:42:19Z","updated_at":"2014-12-10T17:28:57Z","author_association":"CONTRIBUTOR","body":"> \"evenly distribute shards between nodes taking disk space into account\"\n\nno that is not what ES is doing. We try to evenly place shards across the index while making sure we evenly distribute on a shard level and an index level such that all nodes have an even number of shards and the number of shard per index is minimized per node. if you delete an index an in-balance can happen and we moving stuff over from one node to another\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/93394595","html_url":"https://github.com/elastic/elasticsearch/issues/8851#issuecomment-93394595","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8851","id":93394595,"node_id":"MDEyOklzc3VlQ29tbWVudDkzMzk0NTk1","user":{"login":"rtkmhart","id":2601414,"node_id":"MDQ6VXNlcjI2MDE0MTQ=","avatar_url":"https://avatars1.githubusercontent.com/u/2601414?v=4","gravatar_id":"","url":"https://api.github.com/users/rtkmhart","html_url":"https://github.com/rtkmhart","followers_url":"https://api.github.com/users/rtkmhart/followers","following_url":"https://api.github.com/users/rtkmhart/following{/other_user}","gists_url":"https://api.github.com/users/rtkmhart/gists{/gist_id}","starred_url":"https://api.github.com/users/rtkmhart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rtkmhart/subscriptions","organizations_url":"https://api.github.com/users/rtkmhart/orgs","repos_url":"https://api.github.com/users/rtkmhart/repos","events_url":"https://api.github.com/users/rtkmhart/events{/privacy}","received_events_url":"https://api.github.com/users/rtkmhart/received_events","type":"User","site_admin":false},"created_at":"2015-04-15T13:23:04Z","updated_at":"2015-04-15T13:23:04Z","author_association":"NONE","body":"I've been seeing very similar behaviour in 1.4.1, where shard0 of an index is moving from node1 to node2 and shard1 is moving from node2 to node1. In my case we noticed because are shards are too big for sane movement, but that this happens at all is a bit bizarre. We're in the process of upgrading to 1.5.1 but if we see this again I'll bump this issue and open a support case.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/139018312","html_url":"https://github.com/elastic/elasticsearch/issues/8851#issuecomment-139018312","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8851","id":139018312,"node_id":"MDEyOklzc3VlQ29tbWVudDEzOTAxODMxMg==","user":{"login":"lokeshhctm","id":1251647,"node_id":"MDQ6VXNlcjEyNTE2NDc=","avatar_url":"https://avatars3.githubusercontent.com/u/1251647?v=4","gravatar_id":"","url":"https://api.github.com/users/lokeshhctm","html_url":"https://github.com/lokeshhctm","followers_url":"https://api.github.com/users/lokeshhctm/followers","following_url":"https://api.github.com/users/lokeshhctm/following{/other_user}","gists_url":"https://api.github.com/users/lokeshhctm/gists{/gist_id}","starred_url":"https://api.github.com/users/lokeshhctm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lokeshhctm/subscriptions","organizations_url":"https://api.github.com/users/lokeshhctm/orgs","repos_url":"https://api.github.com/users/lokeshhctm/repos","events_url":"https://api.github.com/users/lokeshhctm/events{/privacy}","received_events_url":"https://api.github.com/users/lokeshhctm/received_events","type":"User","site_admin":false},"created_at":"2015-09-09T19:15:15Z","updated_at":"2015-09-09T19:15:15Z","author_association":"NONE","body":"I see the same issue while keep indexes for last 30 day and delete previous days of indexes.\nWhenever we delete indexes, rebalance starts and it takes a lot of time.\nCan we stop rebalancing while we delete indexes?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158686740","html_url":"https://github.com/elastic/elasticsearch/issues/8851#issuecomment-158686740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8851","id":158686740,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODY4Njc0MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-21T22:25:31Z","updated_at":"2015-11-21T22:25:31Z","author_association":"CONTRIBUTOR","body":"So many allocation improvements have been made since 1.4 (eg https://github.com/elastic/elasticsearch/pull/14678, https://github.com/elastic/elasticsearch/pull/14652, https://github.com/elastic/elasticsearch/pull/14259, https://github.com/elastic/elasticsearch/pull/13512, https://github.com/elastic/elasticsearch/pull/12947, https://github.com/elastic/elasticsearch/pull/12551) that I'm going to close this one.  Please reopen if you're seeing the same problems on 2.1.0 or above.\n","performed_via_github_app":null}]