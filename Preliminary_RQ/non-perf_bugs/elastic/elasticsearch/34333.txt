{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34333","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34333/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34333/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34333/events","html_url":"https://github.com/elastic/elasticsearch/issues/34333","id":367265061,"node_id":"MDU6SXNzdWUzNjcyNjUwNjE=","number":34333,"title":"log4j2 JsonLayout not loading","user":{"login":"jordansissel","id":131818,"node_id":"MDQ6VXNlcjEzMTgxOA==","avatar_url":"https://avatars1.githubusercontent.com/u/131818?v=4","gravatar_id":"","url":"https://api.github.com/users/jordansissel","html_url":"https://github.com/jordansissel","followers_url":"https://api.github.com/users/jordansissel/followers","following_url":"https://api.github.com/users/jordansissel/following{/other_user}","gists_url":"https://api.github.com/users/jordansissel/gists{/gist_id}","starred_url":"https://api.github.com/users/jordansissel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jordansissel/subscriptions","organizations_url":"https://api.github.com/users/jordansissel/orgs","repos_url":"https://api.github.com/users/jordansissel/repos","events_url":"https://api.github.com/users/jordansissel/events{/privacy}","received_events_url":"https://api.github.com/users/jordansissel/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-10-05T15:39:14Z","updated_at":"2018-10-10T21:40:07Z","closed_at":"2018-10-10T21:40:07Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I was helping a user out with some Elasticsearch log processing, and I recalled that Logstash offers JsonLayout for its logs, and until #8786 is resolved, I was hoping to offer a workaround.\r\n\r\nWhen attempting to use this in Elasticsearch, it crashes on startup with an exception. I searched existing issues which seem to point to a necessary security policy, but my error isn't identical and even with the workaround security policy (I think?) loaded it still fails.\r\n\r\n\r\nTested with:\r\n* Elasticsearch 6.4.2\r\n* openjdk version \"1.8.0_181\"\r\n* Fedora 28\r\n\r\nlog4j2.properties:\r\n\r\n```\r\nappender.console.layout.type = JsonLayout\r\nappender.console.layout.compact = true\r\nappender.console.layout.eventEol = true\r\n```\r\n\r\nElasticsearch output:\r\n\r\n```\r\n% bin/elasticsearch \r\nException in thread \"main\" java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/ser/FilterProvider\r\n\tat org.apache.logging.log4j.core.layout.JsonLayout.<init>(JsonLayout.java:158)\r\n\tat org.apache.logging.log4j.core.layout.JsonLayout.<init>(JsonLayout.java:69)\r\n\tat org.apache.logging.log4j.core.layout.JsonLayout$Builder.build(JsonLayout.java:99)\r\n\tat org.apache.logging.log4j.core.layout.JsonLayout$Builder.build(JsonLayout.java:77)\r\n\tat org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:123)\r\n\tat org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:959)\r\n\tat org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:899)\r\n\tat org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:891)\r\n\tat org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:891)\r\n\tat org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:514)\r\n\tat org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:238)\r\n\tat org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:250)\r\n\tat org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:547)\r\n\tat org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:263)\r\n\tat org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:163)\r\n\tat org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:119)\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:294)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127)\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n\tat org.elasticsearch.cli.Command.main(Command.java:90)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86)\r\nCaused by: java.lang.ClassNotFoundException: com.fasterxml.jackson.databind.ser.FilterProvider\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:381)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n\t... 24 more\r\n```","closed_by":{"login":"vladimirdolzhenko","id":209440,"node_id":"MDQ6VXNlcjIwOTQ0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/209440?v=4","gravatar_id":"","url":"https://api.github.com/users/vladimirdolzhenko","html_url":"https://github.com/vladimirdolzhenko","followers_url":"https://api.github.com/users/vladimirdolzhenko/followers","following_url":"https://api.github.com/users/vladimirdolzhenko/following{/other_user}","gists_url":"https://api.github.com/users/vladimirdolzhenko/gists{/gist_id}","starred_url":"https://api.github.com/users/vladimirdolzhenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vladimirdolzhenko/subscriptions","organizations_url":"https://api.github.com/users/vladimirdolzhenko/orgs","repos_url":"https://api.github.com/users/vladimirdolzhenko/repos","events_url":"https://api.github.com/users/vladimirdolzhenko/events{/privacy}","received_events_url":"https://api.github.com/users/vladimirdolzhenko/received_events","type":"User","site_admin":false},"performed_via_github_app":null}