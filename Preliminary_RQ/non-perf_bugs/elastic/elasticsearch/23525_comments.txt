[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/285491386","html_url":"https://github.com/elastic/elasticsearch/issues/23525#issuecomment-285491386","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23525","id":285491386,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NTQ5MTM4Ng==","user":{"login":"parisamir","id":25620575,"node_id":"MDQ6VXNlcjI1NjIwNTc1","avatar_url":"https://avatars3.githubusercontent.com/u/25620575?v=4","gravatar_id":"","url":"https://api.github.com/users/parisamir","html_url":"https://github.com/parisamir","followers_url":"https://api.github.com/users/parisamir/followers","following_url":"https://api.github.com/users/parisamir/following{/other_user}","gists_url":"https://api.github.com/users/parisamir/gists{/gist_id}","starred_url":"https://api.github.com/users/parisamir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/parisamir/subscriptions","organizations_url":"https://api.github.com/users/parisamir/orgs","repos_url":"https://api.github.com/users/parisamir/repos","events_url":"https://api.github.com/users/parisamir/events{/privacy}","received_events_url":"https://api.github.com/users/parisamir/received_events","type":"User","site_admin":false},"created_at":"2017-03-09T21:37:31Z","updated_at":"2017-03-09T21:37:31Z","author_association":"NONE","body":"The strange fact is if I create my visualization over the \"cpu stats\" search, the answer is correct!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/285503336","html_url":"https://github.com/elastic/elasticsearch/issues/23525#issuecomment-285503336","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23525","id":285503336,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NTUwMzMzNg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-03-09T22:25:08Z","updated_at":"2017-03-09T22:25:08Z","author_association":"CONTRIBUTOR","body":"I'm wondering this could be a bug with `getScriptValues` on scaled floats.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/286227850","html_url":"https://github.com/elastic/elasticsearch/issues/23525#issuecomment-286227850","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23525","id":286227850,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NjIyNzg1MA==","user":{"login":"parisamir","id":25620575,"node_id":"MDQ6VXNlcjI1NjIwNTc1","avatar_url":"https://avatars3.githubusercontent.com/u/25620575?v=4","gravatar_id":"","url":"https://api.github.com/users/parisamir","html_url":"https://github.com/parisamir","followers_url":"https://api.github.com/users/parisamir/followers","following_url":"https://api.github.com/users/parisamir/following{/other_user}","gists_url":"https://api.github.com/users/parisamir/gists{/gist_id}","starred_url":"https://api.github.com/users/parisamir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/parisamir/subscriptions","organizations_url":"https://api.github.com/users/parisamir/orgs","repos_url":"https://api.github.com/users/parisamir/repos","events_url":"https://api.github.com/users/parisamir/events{/privacy}","received_events_url":"https://api.github.com/users/parisamir/received_events","type":"User","site_admin":false},"created_at":"2017-03-13T20:08:44Z","updated_at":"2017-03-13T20:08:44Z","author_association":"NONE","body":"Hi again,\r\n\r\nI've found out why the visualization works with the \"cpu stats\" and not the metricbeat index itself.\r\nTaking a look at the request that is sending you'll see this:\r\n\r\n{\r\n  \"size\": 0,\r\n  \"aggs\": {\r\n    \"2\": {\r\n      \"date_histogram\": {\r\n        \"field\": \"@timestamp\",\r\n        \"interval\": \"30s\",\r\n        \"time_zone\": \"America/New_York\",\r\n        \"min_doc_count\": 1\r\n      },\r\n      \"aggs\": {\r\n        \"1\": {\r\n          \"avg\": {\r\n            \"script\": {\r\n              \"inline\": \"doc['system.cpu.idle.pct'].value\",\r\n              \"lang\": \"painless\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [\r\n        {\r\n          \"query_string\": {\r\n            \"query\": \"metricset.module: system AND metricset.name: cpu\",\r\n            \"analyze_wildcard\": true\r\n          }\r\n        },\r\n        {\r\n          \"range\": {\r\n            \"@timestamp\": {\r\n              \"gte\": 1489434545480,\r\n              \"lte\": 1489435445480,\r\n              \"format\": \"epoch_millis\"\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      \"must_not\": []\r\n    }\r\n  },\r\n  \"highlight\": {\r\n    \"pre_tags\": [\r\n      \"@kibana-highlighted-field@\"\r\n    ],\r\n    \"post_tags\": [\r\n      \"@/kibana-highlighted-field@\"\r\n    ],\r\n    \"fields\": {\r\n      \"*\": {}\r\n    },\r\n    \"require_field_match\": false,\r\n    \"fragment_size\": 2147483647\r\n  }\r\n}\r\n\r\n\r\nThe search filters if there is no value for the field and do not set it to value 0. \r\nThe metrics beat does not send values for all the timeslots. The timeslots that do not have the fields value will get the value zero for the script field. The search solves this by putting a filter.\r\n\r\nI think This is not a bug on elasticsearch/ kibana. But metric beat should warn the users that this can happen using the script fields over the index itself.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372780691","html_url":"https://github.com/elastic/elasticsearch/issues/23525#issuecomment-372780691","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23525","id":372780691,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjc4MDY5MQ==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T18:58:46Z","updated_at":"2018-03-13T18:58:46Z","author_association":"CONTRIBUTOR","body":"@jpountz Were you ever able to confirm your hypothesis?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/608018093","html_url":"https://github.com/elastic/elasticsearch/issues/23525#issuecomment-608018093","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23525","id":608018093,"node_id":"MDEyOklzc3VlQ29tbWVudDYwODAxODA5Mw==","user":{"login":"stu-elastic","id":24232742,"node_id":"MDQ6VXNlcjI0MjMyNzQy","avatar_url":"https://avatars0.githubusercontent.com/u/24232742?v=4","gravatar_id":"","url":"https://api.github.com/users/stu-elastic","html_url":"https://github.com/stu-elastic","followers_url":"https://api.github.com/users/stu-elastic/followers","following_url":"https://api.github.com/users/stu-elastic/following{/other_user}","gists_url":"https://api.github.com/users/stu-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/stu-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stu-elastic/subscriptions","organizations_url":"https://api.github.com/users/stu-elastic/orgs","repos_url":"https://api.github.com/users/stu-elastic/repos","events_url":"https://api.github.com/users/stu-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/stu-elastic/received_events","type":"User","site_admin":false},"created_at":"2020-04-02T18:07:26Z","updated_at":"2020-04-02T18:12:05Z","author_association":"CONTRIBUTOR","body":"This was https://github.com/elastic/elasticsearch/issues/29286, prior to 6.4 the script would return a default value, which was impacting the aggregated denominator.  This is different behavior between the avg agg, which would ignore such docs and the scripted avg agg which would return the default value.\r\n\r\nFrom 6.4 on, users must explicitly check for existence of any values.","performed_via_github_app":null}]