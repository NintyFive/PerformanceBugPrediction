{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/64173","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64173/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64173/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64173/events","html_url":"https://github.com/elastic/elasticsearch/issues/64173","id":729667511,"node_id":"MDU6SXNzdWU3Mjk2Njc1MTE=","number":64173,"title":"Wrong documentation of pattern_replace token filter","user":{"login":"amitmbm","id":4751393,"node_id":"MDQ6VXNlcjQ3NTEzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/4751393?v=4","gravatar_id":"","url":"https://api.github.com/users/amitmbm","html_url":"https://github.com/amitmbm","followers_url":"https://api.github.com/users/amitmbm/followers","following_url":"https://api.github.com/users/amitmbm/following{/other_user}","gists_url":"https://api.github.com/users/amitmbm/gists{/gist_id}","starred_url":"https://api.github.com/users/amitmbm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amitmbm/subscriptions","organizations_url":"https://api.github.com/users/amitmbm/orgs","repos_url":"https://api.github.com/users/amitmbm/repos","events_url":"https://api.github.com/users/amitmbm/events{/privacy}","received_events_url":"https://api.github.com/users/amitmbm/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":1967497573,"node_id":"MDU6TGFiZWwxOTY3NDk3NTcz","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Docs","name":"Team:Docs","color":"fef2c0","default":false,"description":"Meta label for docs team"},{"id":1967498216,"node_id":"MDU6TGFiZWwxOTY3NDk4MjE2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Search","name":"Team:Search","color":"fef2c0","default":false,"description":"Meta label for search team"}],"state":"closed","locked":false,"assignee":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"assignees":[{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2020-10-26T15:31:02Z","updated_at":"2020-10-27T13:33:03Z","closed_at":"2020-10-27T13:33:03Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\n7.9.1\r\n**Plugins installed**: []\r\nNone\r\n**JVM version** (`java -version`):\r\n11\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n11.0.7.10.1\r\n**Description of the problem including expected versus actual behavior**:\r\nDocs of pattern_replace filter https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-pattern_replace-tokenfilter.html  mentioned Regular expressions cannot be anchored to the beginning or end of a token, while it works, and looking at the code it seems docs might be wrong. Maybe its discourage to anchored to the beginning or end of a token due to performance reason, but it works totally fine.\r\n**Steps to reproduce**:\r\nRefer to https://stackoverflow.com/questions/64538891/anchor-token-replace-patterns-to-the-end-of-tokens question example.\r\n**Analyze API request**\r\n\r\ncurl -XGET \"localhost:9900/_analyze?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"tokenizer\": \"whitespace\",\r\n  \"filter\": [\r\n    {\r\n      \"type\": \"pattern_replace\",\r\n      \"pattern\": \"(dog)$\",\r\n      \"replacement\": \"hot$1\"\r\n    }\r\n  ],\r\n  \"text\": \"dog dogs\"\r\n}'\r\n\r\n**And generated tokens**\r\n{\r\n  \"tokens\" : [\r\n    {\r\n      \"token\" : \"hotdog\",\r\n      \"start_offset\" : 0,\r\n      \"end_offset\" : 3,\r\n      \"type\" : \"word\",\r\n      \"position\" : 0\r\n    },\r\n    {\r\n      \"token\" : \"dogs\",\r\n      \"start_offset\" : 4,\r\n      \"end_offset\" : 8,\r\n      \"type\" : \"word\",\r\n      \"position\" : 1\r\n    }\r\n  ]\r\n}\r\n\r\nAs shown in the https://github.com/elastic/elasticsearch/blob/master/modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/PatternReplaceTokenFilterFactory.java#L52 code, it doesn't have the special handling of the **end or beginning of the token**\r\nNote: Pattern(hot) is anchored to the end of the `dog` token and `dog(s)` is not replaced because it doesn't end with `dog`.\r\n**Provide logs (if relevant)**:\r\nN/A\r\n","closed_by":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"performed_via_github_app":null}