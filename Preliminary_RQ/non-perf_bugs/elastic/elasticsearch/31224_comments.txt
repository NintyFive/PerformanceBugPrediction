[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/395957371","html_url":"https://github.com/elastic/elasticsearch/issues/31224#issuecomment-395957371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31224","id":395957371,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NTk1NzM3MQ==","user":{"login":"damienalexandre","id":225704,"node_id":"MDQ6VXNlcjIyNTcwNA==","avatar_url":"https://avatars2.githubusercontent.com/u/225704?v=4","gravatar_id":"","url":"https://api.github.com/users/damienalexandre","html_url":"https://github.com/damienalexandre","followers_url":"https://api.github.com/users/damienalexandre/followers","following_url":"https://api.github.com/users/damienalexandre/following{/other_user}","gists_url":"https://api.github.com/users/damienalexandre/gists{/gist_id}","starred_url":"https://api.github.com/users/damienalexandre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/damienalexandre/subscriptions","organizations_url":"https://api.github.com/users/damienalexandre/orgs","repos_url":"https://api.github.com/users/damienalexandre/repos","events_url":"https://api.github.com/users/damienalexandre/events{/privacy}","received_events_url":"https://api.github.com/users/damienalexandre/received_events","type":"User","site_admin":false},"created_at":"2018-06-09T10:14:31Z","updated_at":"2018-06-09T10:14:31Z","author_association":"CONTRIBUTOR","body":"I did a new test with the [Emoji Plugin](https://github.com/jolicode/emoji-search/tree/master/esplugin) and there was no issues!\r\n\r\n### :heavy_check_mark: emoji_tokenizer and synonym\r\n\r\n```\r\nPUT demo\r\n{\r\n  \"settings\": {\r\n    \"analysis\": {\r\n      \"analyzer\": {\r\n        \"icu_with_emoji\": {\r\n          \"tokenizer\": \"emoji_tokenizer\",\r\n          \"filter\": [\r\n            \"english_emoji\"\r\n          ]\r\n        }\r\n      },\r\n      \"filter\": {\r\n        \"english_emoji\": {\r\n          \"type\": \"synonym\",\r\n          \"synonyms\": [\r\n            \"üçï, pizza\"\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThis plugin is very simple, it use ICU 59.1 (same as analysis-icu), and extend **DefaultICUTokenizerConfig** to override the default rbbi rules.\r\n\r\nIt should be the same as what I did sooner with the `\"rule_files\": \"Latn:Emoji.rbbi\"` option in icu_tokenizer, but the result is not the same.\r\n\r\nNew hypothesis: what is the \"script\" used / detected when testing the synonyms? My custom rbbi is what make possible the tokenization of emoji, but I only set the \"Latn\" script value. ICU Tokenizer fallback to the default rules when there is no custom rules for a script.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/395958020","html_url":"https://github.com/elastic/elasticsearch/issues/31224#issuecomment-395958020","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31224","id":395958020,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NTk1ODAyMA==","user":{"login":"damienalexandre","id":225704,"node_id":"MDQ6VXNlcjIyNTcwNA==","avatar_url":"https://avatars2.githubusercontent.com/u/225704?v=4","gravatar_id":"","url":"https://api.github.com/users/damienalexandre","html_url":"https://github.com/damienalexandre","followers_url":"https://api.github.com/users/damienalexandre/followers","following_url":"https://api.github.com/users/damienalexandre/following{/other_user}","gists_url":"https://api.github.com/users/damienalexandre/gists{/gist_id}","starred_url":"https://api.github.com/users/damienalexandre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/damienalexandre/subscriptions","organizations_url":"https://api.github.com/users/damienalexandre/orgs","repos_url":"https://api.github.com/users/damienalexandre/repos","events_url":"https://api.github.com/users/damienalexandre/events{/privacy}","received_events_url":"https://api.github.com/users/damienalexandre/received_events","type":"User","site_admin":false},"created_at":"2018-06-09T10:26:41Z","updated_at":"2018-06-09T10:26:41Z","author_association":"CONTRIBUTOR","body":"It's me again :wave: \r\n\r\nUsing the script \"common\" or \"Zyyy\" (see http://unicode.org/iso15924/iso15924-codes.html), I was able to create my analyzer with synonyms.\r\n\r\n```\r\nPUT demo\r\n{\r\n  \"settings\": {\r\n    \"analysis\": {\r\n      \"analyzer\": {\r\n        \"icu_with_emoji\": {\r\n          \"tokenizer\": \"icu_emoji_tokenizer\",\r\n          \"filter\": [\r\n            \"english_emoji\"\r\n          ]\r\n        }\r\n      },\r\n      \"tokenizer\": {\r\n        \"icu_emoji_tokenizer\": {\r\n          \"type\": \"icu_tokenizer\",\r\n          \"rule_files\": \"Latn:Emoji.rbbi,Zyyy:Emoji.rbbi\"\r\n        }\r\n      },\r\n      \"filter\": {\r\n        \"english_emoji\": {\r\n          \"type\": \"synonym\",\r\n          \"synonyms\": [\r\n            \"üçï, pizza\"\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nWhat I understand is that when building the synonym, the text used is only the left side (üçï), and this is not a Latin script for ICU. So the tokenizer was falling back to the defaults rules which do not treat emoji as text.\r\n\r\nThat's why the emoji plugin works: it replace those default rules.\r\n\r\nI guess we can close this, as my Tokenizer was effectively broken. Sorry for the noise, but I hope this can help futur readers!","performed_via_github_app":null}]