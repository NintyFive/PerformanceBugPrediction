{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52503","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52503/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52503/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52503/events","html_url":"https://github.com/elastic/elasticsearch/issues/52503","id":567395121,"node_id":"MDU6SXNzdWU1NjczOTUxMjE=","number":52503,"title":"Elasticsearch 7.6.0 cannot be used as service in GitLab pipeline anymore","user":{"login":"dawi","id":129870,"node_id":"MDQ6VXNlcjEyOTg3MA==","avatar_url":"https://avatars3.githubusercontent.com/u/129870?v=4","gravatar_id":"","url":"https://api.github.com/users/dawi","html_url":"https://github.com/dawi","followers_url":"https://api.github.com/users/dawi/followers","following_url":"https://api.github.com/users/dawi/following{/other_user}","gists_url":"https://api.github.com/users/dawi/gists{/gist_id}","starred_url":"https://api.github.com/users/dawi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dawi/subscriptions","organizations_url":"https://api.github.com/users/dawi/orgs","repos_url":"https://api.github.com/users/dawi/repos","events_url":"https://api.github.com/users/dawi/events{/privacy}","received_events_url":"https://api.github.com/users/dawi/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"assignees":[{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2020-02-19T08:22:49Z","updated_at":"2020-11-11T21:54:39Z","closed_at":"2020-02-21T13:47:51Z","author_association":"NONE","active_lock_reason":null,"body":"Starting with version 7.6.0 Elasticsearch cannot be started as service in a Gitlab pipeline anymore.\r\n\r\nGitlab sets a `CI_SERVER_TLS_CA_FILE` variable which contains a path to a file.\r\nIt seems that this variable is now expanded to contain the content of the file.\r\n\r\n```\r\nService container logs:\r\n2020-02-19T06:52:56.510497268Z ERROR: File -----BEGIN CERTIFICATE-----\r\n2020-02-19T06:52:56.510521348Z ....\r\n2020-02-19T06:52:56.510608065Z -----END CERTIFICATE-----\r\n2020-02-19T06:52:56.510610718Z  from CI_SERVER_TLS_CA_FILE does not exist\r\n```\r\n\r\nI am not completely sure if this is an Elasticsearch issue or not, but I figured out that Elasticsearch [does some environment variable processing](https://github.com/elastic/elasticsearch/commit/2bd3a0589259ffda6caf27bf23bb8ed8813bc4e9) and it could very well be the cause of this issue:\r\n\r\n> Also extract the support for `_FILE` env vars into a separate script, so\r\n> that it can be called from more than once place (the behaviour is\r\n> idempotent).\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/v7.6.0/distribution/src/bin/elasticsearch-env-from-file\r\n","closed_by":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"performed_via_github_app":null}