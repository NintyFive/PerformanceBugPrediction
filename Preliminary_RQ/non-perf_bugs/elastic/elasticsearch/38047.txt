{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38047","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38047/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38047/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38047/events","html_url":"https://github.com/elastic/elasticsearch/issues/38047","id":404909834,"node_id":"MDU6SXNzdWU0MDQ5MDk4MzQ=","number":38047,"title":"ILM refactor to enable dynamic step plan execution","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"labels":[{"id":912828538,"node_id":"MDU6TGFiZWw5MTI4Mjg1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/ILM+SLM","name":":Core/Features/ILM+SLM","color":"0e8a16","default":false,"description":"Index and Snapshot lifecycle management"},{"id":837440720,"node_id":"MDU6TGFiZWw4Mzc0NDA3MjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Erefactoring","name":">refactoring","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-01-30T18:43:52Z","updated_at":"2019-08-13T22:29:14Z","closed_at":"2019-08-13T22:29:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Currently, Lifecycle Actions generate static step lists that are intended to \r\nbe executed in sequence. This sequence is hardcoded into the action and \r\ncannot be changed based on runtime state conditions. To bypass this \r\nconstraint, #37953 introduced a type of step called BranchingStep that\r\neffectively behaves like a runtime branching in step plan execution. It enables\r\nexecuting one of two different steps next, based on some condition. Although\r\nthis works, it relies on an implicit contract between the IndexLifecycleRunner\r\nand ExecuteStepsUpdateTask to never call `getNextStepKey` on the branching \r\nstep until after it runs `performAction`. This is very fragile. If ILM intends to \r\nsupport more branching in the future, or certain refactorings break this \r\ncontract, then a new strategy must be implemented.\r\n\r\nThis issue exists as a reminder that it may be worth thinking about further \r\nrefactoring to ExecuteStepsUpdateTask/IndexLifecycleRunner to enable \r\ndynamic execution plans.","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}