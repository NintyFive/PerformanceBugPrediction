{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32580","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32580/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32580/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32580/events","html_url":"https://github.com/elastic/elasticsearch/issues/32580","id":346959298,"node_id":"MDU6SXNzdWUzNDY5NTkyOTg=","number":32580,"title":"[TEST-FAILURE] org.elasticsearch.client.documentation.LicensingDocumentationIT fails on release-tests CI","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2018-08-02T10:49:24Z","updated_at":"2018-08-03T18:59:52Z","closed_at":"2018-08-03T18:59:52Z","author_association":"MEMBER","active_lock_reason":null,"body":"Build URL: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+release-tests/855/console\r\n\r\nI have tried to reproduce this locally without any luck, although I was not able to run with `-Dbuild.snapshot=false` locally so this bug might be specific to release builds.\r\n\r\nReproduce command (as lifted from CI failure, locally I removed the `-Dbuild.snapshot=false`):\r\n```\r\nREPRODUCE WITH: ./gradlew :client:rest-high-level:integTestRunner \\\r\n  -Dtests.seed=6B866F493C3B7898 \\\r\n  -Dtests.class=org.elasticsearch.client.documentation.LicensingDocumentationIT \\\r\n  -Dtests.method=\"testPutLicense\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dbuild.snapshot=false \\\r\n  -Dtests.jvm.argline=\"-Dbuild.snapshot=false\" \\\r\n  -Dtests.locale=el-GR \\\r\n  -Dtests.timezone=Africa/Khartoum\r\n```\r\n\r\nIt looks like the test is trying to put an invalid license and expecting ES to return an exception saying the license is valid but the server is returning that the licence is invalid. Maybe the way the test is creating an valid licence might be wrong:\r\n```\r\n  1> [2018-08-02T10:45:24,332][INFO ][o.e.c.d.LicensingDocumentationIT] [testPutLicense] before test\r\n  2> NOTE: leaving temporary files on disk at: /var/lib/jenkins/workspace/elastic+elasticsearch+master+release-tests/client/rest-high-level/build/testrun/integTestRunner/J0/temp/org.elasticsearch.client.documentation.LicensingDocumentationIT_6B866F493C3B7898-001\r\n  2> NOTE: test params are: codec=Asserting(Lucene70): {}, docValues:{}, maxPointsInLeafNode=1403, maxMBSortInHeap=7.8940949346565645, sim=RandomSimilarity(queryNorm=false): {}, locale=el-GR, timezone=Africa/Khartoum\r\n  2> NOTE: Linux 4.4.0-1061-aws amd64/Oracle Corporation 1.8.0_181 (64-bit)/cpus=16,threads=1,free=360450152,total=516947968\r\n  1> [2018-08-02T10:45:24,333][INFO ][o.e.c.d.LicensingDocumentationIT] [testPutLicense] initializing REST clients against [http://[::1]:39337]\r\n  2> NOTE: All tests run in this JVM: [SnapshotClientDocumentationIT, TasksClientDocumentationIT, WatcherDocumentationIT, TasksIT, PingAndInfoIT, IndicesClientDocumentationIT, MigrationDocumentationIT, SearchDocumentationIT, WatcherIT, CRUDDocumentationIT, ClusterClientDocumentationIT, IngestClientIT, IndicesClientIT, SnapshotIT, BulkProcessorIT, IngestClientDocumentationIT, RankEvalIT, StoredScriptsIT, StoredScriptsDocumentationIT, BulkProcessorRetryIT, ClusterClientIT, CrudIT, SearchIT, LicensingDocumentationIT]\r\n  1> [2018-08-02T10:45:24,352][INFO ][o.e.c.d.LicensingDocumentationIT] [testPutLicense] after test\r\nFAILURE 0.03s | LicensingDocumentationIT.testPutLicense <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: expected:<invalid> but was:<valid>\r\n   > \tat __randomizedtesting.SeedInfo.seed([6B866F493C3B7898:8EDA9690B7D4DA9F]:0)\r\n   > \tat org.elasticsearch.client.documentation.LicensingDocumentationIT.testPutLicense(LicensingDocumentationIT.java:68)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}