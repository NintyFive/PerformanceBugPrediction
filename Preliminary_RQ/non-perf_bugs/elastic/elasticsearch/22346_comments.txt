[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269140541","html_url":"https://github.com/elastic/elasticsearch/issues/22346#issuecomment-269140541","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22346","id":269140541,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTE0MDU0MQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-12-25T22:49:14Z","updated_at":"2016-12-25T22:49:14Z","author_association":"MEMBER","body":"I'd create a recreation script without ingest as I think it does not play any role here. Can you do that?\r\n\r\nThen can you test what is the output of the _analyze API when using your analyzer? That might give some clues. BTW what is exactly your index settings when you switch to Portuguese?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269145001","html_url":"https://github.com/elastic/elasticsearch/issues/22346#issuecomment-269145001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22346","id":269145001,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTE0NTAwMQ==","user":{"login":"evertramos","id":905951,"node_id":"MDQ6VXNlcjkwNTk1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/905951?v=4","gravatar_id":"","url":"https://api.github.com/users/evertramos","html_url":"https://github.com/evertramos","followers_url":"https://api.github.com/users/evertramos/followers","following_url":"https://api.github.com/users/evertramos/following{/other_user}","gists_url":"https://api.github.com/users/evertramos/gists{/gist_id}","starred_url":"https://api.github.com/users/evertramos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evertramos/subscriptions","organizations_url":"https://api.github.com/users/evertramos/orgs","repos_url":"https://api.github.com/users/evertramos/repos","events_url":"https://api.github.com/users/evertramos/events{/privacy}","received_events_url":"https://api.github.com/users/evertramos/received_events","type":"User","site_admin":false},"created_at":"2016-12-26T01:09:10Z","updated_at":"2016-12-26T01:09:10Z","author_association":"NONE","body":"Hello @dadoonet,\r\n\r\nI did the test and without the ingest the results are the same. Here is the scripts:\r\n```\r\nPUT 127.0.0.1:9200/my_index\r\n{\r\n  \"settings\" : {\r\n        \"index\" : {\r\n            \"number_of_shards\" : 1\r\n        }\r\n    },\r\n    \"mappings\" : {\r\n        \"my_type\" : {\r\n          \"_source\" : {\r\n            \"enabled\" : true\r\n        },\r\n            \"properties\" : {\r\n                \"name\" : { \r\n                  \"type\" : \"string\",\r\n                  \"store\" : true\r\n              },\r\n                \"content\" : { \r\n                  \"type\" : \"text\",\r\n                  \"analyzer\" : \"english\",\r\n                  \"term_vector\" : \"with_positions_offsets\",\r\n                  \"store\" : true\r\n              }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n```\r\nPUT 127.0.0.1:9200/my_index/my_type/1\r\n{\r\n  \"name\" : \"English the name\",\r\n  \"content\" : \"we are the english team\"\r\n}\r\n```\r\n\r\n```\r\nGET 127.0.0.1:9200/my_index/_search?pretty=true\r\n{\r\n    \"size\" : 15,\r\n    \"stored_fields\" : [\"name\"],\r\n\r\n\t\"query\" : {\r\n        \"simple_query_string\" : {\r\n            \"query\" : \"\\\"we are the english team\\\"\",\r\n            \"fields\" : [\"content\"],\r\n            \"default_operator\" : \"and\"\r\n        }\r\n\t},\r\n\t\r\n\t\"highlight\" : {\r\n\t    \"number_of_fragments\" : 3,\r\n\t    \"fragment_size\" : 50,\r\n\t    \"fields\" : {\r\n\t\t\t\"content\" : {\r\n\t\t\t    \"highlight_query\" : {\r\n\t\t\t        \"simple_query_string\" : {\r\n\t\t\t            \"query\" : \"\\\"we are the english team\\\"\",\r\n\t\t\t            \"fields\" : [\"content\"],\r\n\t\t\t            \"default_operator\" : \"and\"\r\n\t\t\t        }\r\n\t\t\t    }\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\nHere is the analyzers:\r\n\r\n1. English\r\n```\r\nGET 127.0.0.1:9200/_analyze\r\n{\r\n  \"analyzer\" : \"english\",\r\n  \"text\" : \"\\\"we are the english team\\\"\"\r\n}'\r\n```\r\nResults:\r\n```\r\n{\r\n  \"tokens\": [\r\n    {\r\n      \"token\": \"we\",\r\n      \"start_offset\": 1,\r\n      \"end_offset\": 3,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 0\r\n    },\r\n    {\r\n      \"token\": \"english\",\r\n      \"start_offset\": 12,\r\n      \"end_offset\": 19,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 3\r\n    },\r\n    {\r\n      \"token\": \"team\",\r\n      \"start_offset\": 20,\r\n      \"end_offset\": 24,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 4\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n2. Brazilian Portuguese:\r\n```\r\nGET 127.0.0.1:9200/_analyze\r\n{\r\n  \"analyzer\" : \"brazilian\",\r\n  \"text\" : \"\\\"Paulo de Tarso\\\"\"\r\n}\r\n```\r\nResults: \r\n```\r\n{\r\n  \"tokens\": [\r\n    {\r\n      \"token\": \"paul\",\r\n      \"start_offset\": 1,\r\n      \"end_offset\": 6,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 0\r\n    },\r\n    {\r\n      \"token\": \"tars\",\r\n      \"start_offset\": 10,\r\n      \"end_offset\": 15,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 2\r\n    }\r\n  ]\r\n}\r\n```\r\nP.S.: Somehow it takes the last letter off from the analyze, but it comes out right in the query results as of: **Paulo** and **Tarso**.\r\n\r\nAnd here is my full mapping:\r\n```\r\n{\r\n  \"settings\" : {\r\n        \"index\" : {\r\n            \"number_of_shards\" : 1\r\n        }\r\n    },\r\n    \"mappings\" : {\r\n        \"Livros\" : {\r\n          \"_source\" : {\r\n            \"enabled\" : true\r\n        },\r\n            \"properties\" : {\r\n                \"name\" : { \r\n                  \"type\" : \"string\",\r\n                  \"analyzer\" : \"brazilian\",\r\n                  \"store\" : true\r\n              },\r\n                \"author\" : { \r\n                  \"type\" : \"string\",\r\n                  \"analyzer\" : \"brazilian\",\r\n                  \"store\" : true\r\n              },\r\n                \"editor\" : { \r\n                  \"type\" : \"string\",\r\n                  \"analyzer\" : \"brazilian\",\r\n                  \"store\" : true\r\n              },\r\n                \"url\" : { \r\n                  \"type\" : \"string\", \r\n                  \"store\" : true\r\n              },\r\n                \"attachment.content\" : { \r\n                  \"type\" : \"text\",\r\n                  \"analyzer\" : \"brazilian\",\r\n                  \"term_vector\" : \"with_positions_offsets\",\r\n                  \"store\" : true\r\n              }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThat simple!\r\n\r\nAny further information that would help?\r\n\r\nThanks for your prompt reply.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269195269","html_url":"https://github.com/elastic/elasticsearch/issues/22346#issuecomment-269195269","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22346","id":269195269,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTE5NTI2OQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-12-26T10:06:19Z","updated_at":"2016-12-26T10:06:19Z","author_association":"MEMBER","body":"@evertramos thanks for the report. This is known bug in Lucene:\r\nhttps://issues.apache.org/jira/browse/LUCENE-7551\r\nThe only workaround for the time being is to remove the stop word filter from the analyzers that are used for highlighting. \r\nWe have a plan for a new highlighter called `unified` in 5.x, this highlighter does not have this issue and works with `fast_vectors` so I am going to close this issue and you should probably switch to this new highlighter when it's available (probably in 5.2).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269200904","html_url":"https://github.com/elastic/elasticsearch/issues/22346#issuecomment-269200904","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22346","id":269200904,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTIwMDkwNA==","user":{"login":"evertramos","id":905951,"node_id":"MDQ6VXNlcjkwNTk1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/905951?v=4","gravatar_id":"","url":"https://api.github.com/users/evertramos","html_url":"https://github.com/evertramos","followers_url":"https://api.github.com/users/evertramos/followers","following_url":"https://api.github.com/users/evertramos/following{/other_user}","gists_url":"https://api.github.com/users/evertramos/gists{/gist_id}","starred_url":"https://api.github.com/users/evertramos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evertramos/subscriptions","organizations_url":"https://api.github.com/users/evertramos/orgs","repos_url":"https://api.github.com/users/evertramos/repos","events_url":"https://api.github.com/users/evertramos/events{/privacy}","received_events_url":"https://api.github.com/users/evertramos/received_events","type":"User","site_admin":false},"created_at":"2016-12-26T11:08:52Z","updated_at":"2016-12-26T11:08:52Z","author_association":"NONE","body":"Thanks @jimczi\r\n\r\nI will try to set it up as you said. Hope to get this UH soon, once project should be live in a few days now.\r\n\r\nCheers! Happy New Year!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269209231","html_url":"https://github.com/elastic/elasticsearch/issues/22346#issuecomment-269209231","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22346","id":269209231,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTIwOTIzMQ==","user":{"login":"evertramos","id":905951,"node_id":"MDQ6VXNlcjkwNTk1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/905951?v=4","gravatar_id":"","url":"https://api.github.com/users/evertramos","html_url":"https://github.com/evertramos","followers_url":"https://api.github.com/users/evertramos/followers","following_url":"https://api.github.com/users/evertramos/following{/other_user}","gists_url":"https://api.github.com/users/evertramos/gists{/gist_id}","starred_url":"https://api.github.com/users/evertramos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evertramos/subscriptions","organizations_url":"https://api.github.com/users/evertramos/orgs","repos_url":"https://api.github.com/users/evertramos/repos","events_url":"https://api.github.com/users/evertramos/events{/privacy}","received_events_url":"https://api.github.com/users/evertramos/received_events","type":"User","site_admin":false},"created_at":"2016-12-26T12:58:21Z","updated_at":"2016-12-26T12:58:21Z","author_association":"NONE","body":"Well, maybe not the best solutions, but I got around with the below settings, only for the record:\r\n\r\n1. Mapping the highlight with multi-field:\r\n```\r\n{\r\n  \"settings\" : {\r\n        \"index\" : {\r\n            \"number_of_shards\" : 1\r\n        }\r\n    },\r\n    \"mappings\" : {\r\n        \"Livros\" : {\r\n          \"_source\" : {\r\n            \"enabled\" : true\r\n        },\r\n            \"properties\" : {\r\n                \"name\" : { \r\n                  \"type\" : \"string\",\r\n                  \"analyzer\" : \"brazilian\",\r\n                  \"store\" : true\r\n              },\r\n                \"attachment.content\" : { \r\n                  \"type\" : \"text\",\r\n                  \"analyzer\" : \"brazilian\",\r\n                  \"term_vector\" : \"with_positions_offsets\",\r\n                  \"store\" : true,\r\n                  \"fields\" : {\r\n\t\t\t\t\t\"general\" : {\r\n\t\t\t\t\t\t\"type\" : \"text\",\r\n\t\t\t\t\t\t\"analyzer\" : \"standard\",\r\n\t\t\t\t\t\t\"term_vector\" : \"with_positions_offsets\",\r\n\t\t\t\t\t\t\"store\" : true\r\n\t\t\t\t\t}\r\n                  }\r\n              }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n2. In search query I use:\r\n```\r\n{\r\n    \"stored_fields\" : [\"name\", \"author\", \"editor\", \"content\", \"url\"],\r\n    \"size\" : 15,\r\n  \"query\" : {\r\n        \"simple_query_string\" : {\r\n            \"query\" : \"\\\"paulo de tarso\\\" +prodigo -dileto\",\r\n            \"fields\" : [\"attachment.content\"],\r\n            \"default_operator\" : \"and\"\r\n        }\r\n  },\r\n  \r\n  \"highlight\" : {\r\n      \"number_of_fragments\" : 3,\r\n      \"fragment_size\" : 50,\r\n      \"fields\" : {\r\n      \"attachment.content\" : {\r\n          \"highlight_query\" : {\r\n\t\t\t\"multi_match\": {\r\n\t\t\t\t\"query\": \"\\\"paulo de tarso\\\" +prodigo -dileto\",\r\n\t\t\t\t\"fields\": [ \r\n\t\t\t\t\t\"attachment.content\",\r\n\t\t\t\t\t\"attachment.content.general\"\r\n\t\t\t\t],\r\n\t\t\t\t\"type\": \"most_fields\" \r\n\t\t\t}\r\n          }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nSo I could merge the highlight as probably how the UnifiedHighlight will do it, but a lot better. I understand that my index will be probably doble sized because of the multi-field, as I expect, but right now it solved the situation.\r\n\r\nThanks to all you folks for the great job and the attention.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299310572","html_url":"https://github.com/elastic/elasticsearch/issues/22346#issuecomment-299310572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22346","id":299310572,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTMxMDU3Mg==","user":{"login":"evertramos","id":905951,"node_id":"MDQ6VXNlcjkwNTk1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/905951?v=4","gravatar_id":"","url":"https://api.github.com/users/evertramos","html_url":"https://github.com/evertramos","followers_url":"https://api.github.com/users/evertramos/followers","following_url":"https://api.github.com/users/evertramos/following{/other_user}","gists_url":"https://api.github.com/users/evertramos/gists{/gist_id}","starred_url":"https://api.github.com/users/evertramos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evertramos/subscriptions","organizations_url":"https://api.github.com/users/evertramos/orgs","repos_url":"https://api.github.com/users/evertramos/repos","events_url":"https://api.github.com/users/evertramos/events{/privacy}","received_events_url":"https://api.github.com/users/evertramos/received_events","type":"User","site_admin":false},"created_at":"2017-05-04T21:12:14Z","updated_at":"2017-05-04T21:12:14Z","author_association":"NONE","body":"Hello @jimczi,\r\n\r\nSorry for bothering... any chances to have ````unified```` really integrated with ES? \r\n\r\nAs it seems it´s still in experimental mode as of: \r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/5.4/search-request-highlighting.html#_unified_highlighter\r\n\r\nThanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299400652","html_url":"https://github.com/elastic/elasticsearch/issues/22346#issuecomment-299400652","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22346","id":299400652,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTQwMDY1Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-05-05T07:31:40Z","updated_at":"2017-05-05T07:31:40Z","author_association":"MEMBER","body":"@evertramos when we add a new functionality we often mark it as `experimental`. This is just a warning that says that this is new and that we reserve the right to change it completely in a future release if necessary. This does not prevent you from using it, quite the contrary ;).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299915855","html_url":"https://github.com/elastic/elasticsearch/issues/22346#issuecomment-299915855","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22346","id":299915855,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTkxNTg1NQ==","user":{"login":"evertramos","id":905951,"node_id":"MDQ6VXNlcjkwNTk1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/905951?v=4","gravatar_id":"","url":"https://api.github.com/users/evertramos","html_url":"https://github.com/evertramos","followers_url":"https://api.github.com/users/evertramos/followers","following_url":"https://api.github.com/users/evertramos/following{/other_user}","gists_url":"https://api.github.com/users/evertramos/gists{/gist_id}","starred_url":"https://api.github.com/users/evertramos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evertramos/subscriptions","organizations_url":"https://api.github.com/users/evertramos/orgs","repos_url":"https://api.github.com/users/evertramos/repos","events_url":"https://api.github.com/users/evertramos/events{/privacy}","received_events_url":"https://api.github.com/users/evertramos/received_events","type":"User","site_admin":false},"created_at":"2017-05-08T16:21:10Z","updated_at":"2017-05-08T16:21:10Z","author_association":"NONE","body":"All right @jimczi!\r\n\r\nThanks again for your attention.\r\n\r\nCheers","performed_via_github_app":null}]