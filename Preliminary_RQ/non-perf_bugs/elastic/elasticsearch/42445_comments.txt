[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495252092","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-495252092","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":495252092,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTI1MjA5Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-05-23T14:50:34Z","updated_at":"2019-05-23T14:50:34Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495252109","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-495252109","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":495252109,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTI1MjEwOQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-05-23T14:50:36Z","updated_at":"2019-05-23T14:50:36Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495268003","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-495268003","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":495268003,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTI2ODAwMw==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2019-05-23T15:29:35Z","updated_at":"2019-05-23T15:29:35Z","author_association":"MEMBER","body":"> Should we trim/clean translog and force-merge when closing an index? These actions can be done via the verifying-before-close step.\r\n\r\nI definitely don't think we should do this by default. Imagine having a cluster that's experiencing heavy load, so badly that you need to close some indices to bring it back from the edge. If we were to force-merge when an index was closed, that introduces more load into the cluster (not to mention a potential wait time depending on the number of segments we force merge to) when it is in a precarious state.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/496968131","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-496968131","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":496968131,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Njk2ODEzMQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-05-29T14:45:21Z","updated_at":"2019-05-29T14:50:10Z","author_association":"CONTRIBUTOR","body":"We discussed this today as a team and agreed with @dakrone about not force-merging while closing an index because this would make closing an index far too heavyweight an operation. The discussion also touched again on the idea of being able to force-merge a read-only index (#41624):\r\n\r\n- one might want to force-merge a closed index by re-opening it, force-merging it, and closing it again, but today we can't guarantee that nothing else is indexed into it during that process.\r\n\r\n- ILM may also want to be able to block writes to an index before force-merging it.\r\n\r\nHowever, we concluded that trimming the translog on close is a reasonable thing to do:\r\n\r\n- we'd like a closed index to consume as few resources as possible, and a translog can consume considerable disk space\r\n\r\n- trimming the translog is a fairly lightweight operation\r\n\r\n- the stats on a closed index make it look like there is no translog anyway, even if it is present and consuming disk space\r\n\r\n- if a closed shard copy is moved elsewhere then the resulting copy has no translog\r\n\r\n- keeping the translog around might occasionally help recover an out-of-sync replica with an operations-based recovery when the index is re-opened, but this is a pretty rare situation and not one we felt to be important\r\n\r\nWe noted that it may not be trivial to trim the translog at close, because there may be something still holding onto the generations that we want to trim (e.g. an ongoing peer recovery).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/497839583","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-497839583","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":497839583,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzgzOTU4Mw==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2019-05-31T19:51:41Z","updated_at":"2019-05-31T19:51:41Z","author_association":"MEMBER","body":"> ILM may also want to be able to block writes to an index before force-merging it.\r\n\r\nILM does this automatically currently.\r\n\r\n@DaveCTurner I think after the discussions this can drop the ILM tag, is that right? Since we would automatically trim the translog on close?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/497873614","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-497873614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":497873614,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Nzg3MzYxNA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-05-31T22:01:16Z","updated_at":"2019-05-31T22:01:16Z","author_association":"CONTRIBUTOR","body":"Yes, I think so. ILM's force-merge action sets `index.blocks.write` first (but not `index.blocks.read_only`).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500839549","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-500839549","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":500839549,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDgzOTU0OQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2019-06-11T13:25:13Z","updated_at":"2019-06-11T13:25:13Z","author_association":"CONTRIBUTOR","body":"> keeping the translog around might occasionally help recover an out-of-sync replica with an operations-based recovery when the index is re-opened, but this is a pretty rare situation and not one we felt to be important\r\n\r\njust for clarification, we don't use the translog anymore for primary replica sync, right? do you mean something else?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500858493","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-500858493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":500858493,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDg1ODQ5Mw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-06-11T14:09:30Z","updated_at":"2019-06-11T14:09:30Z","author_association":"CONTRIBUTOR","body":"Today we read operations from the translog on the primary during peer recovery. For a while we had moved to reading them from Lucene but we reverted that in #38904.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/507259662","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-507259662","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":507259662,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzI1OTY2Mg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-07-01T13:15:35Z","updated_at":"2019-07-01T13:15:35Z","author_association":"CONTRIBUTOR","body":"@tlrx can this be closed now?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/507966392","html_url":"https://github.com/elastic/elasticsearch/issues/42445#issuecomment-507966392","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42445","id":507966392,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzk2NjM5Mg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2019-07-03T06:57:39Z","updated_at":"2019-07-03T06:57:39Z","author_association":"MEMBER","body":"Translog files are now trimmed for closed indices (#43156) and translog stats are now correctly exposed (#43752, #43825).","performed_via_github_app":null}]