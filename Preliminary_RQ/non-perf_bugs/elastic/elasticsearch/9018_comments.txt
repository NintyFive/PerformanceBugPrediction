[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68342199","html_url":"https://github.com/elastic/elasticsearch/issues/9018#issuecomment-68342199","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9018","id":68342199,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MzQyMTk5","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-12-30T09:39:00Z","updated_at":"2014-12-30T09:39:00Z","author_association":"MEMBER","body":"do you still have by chance the OOM exception in the logs? maybe we didn't catch it properly somewhere?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68387090","html_url":"https://github.com/elastic/elasticsearch/issues/9018#issuecomment-68387090","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9018","id":68387090,"node_id":"MDEyOklzc3VlQ29tbWVudDY4Mzg3MDkw","user":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"created_at":"2014-12-30T19:14:15Z","updated_at":"2014-12-30T19:14:15Z","author_association":"MEMBER","body":"FYI, OOM stacktrace:\n\n```\njava.lang.OutOfMemoryError: Java heap space\n    at org.elasticsearch.common.compress.BufferRecycler.allocInputBuffer(BufferRecycler.java:119)\n    at org.elasticsearch.common.compress.lzf.LZFCompressedStreamInput.<init>(LZFCompressedStreamInput.java:47)\n    at org.elasticsearch.common.compress.lzf.LZFCompressor.streamInput(LZFCompressor.java:118)\n    at org.elasticsearch.common.io.stream.CachedStreamInput.cachedHandlesCompressed(CachedStreamInput.java:69)\n    at org.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(MessageChannelHandler.java:104)\n    at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:303)\n    at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:74)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n    at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n    at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n    at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n    at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68388049","html_url":"https://github.com/elastic/elasticsearch/issues/9018#issuecomment-68388049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9018","id":68388049,"node_id":"MDEyOklzc3VlQ29tbWVudDY4Mzg4MDQ5","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-12-30T19:23:48Z","updated_at":"2014-12-30T19:23:48Z","author_association":"MEMBER","body":"sadly, when this OOM happens on the netty side of things, the result is that the worker responsible for handling TCP events is broken, causing problems in general handling of remote transport level invocations, it might explain things, specifically if this worker was responsible for the channel opened to publish cluster state events...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87767608","html_url":"https://github.com/elastic/elasticsearch/issues/9018#issuecomment-87767608","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9018","id":87767608,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NzY3NjA4","user":{"login":"aswan","id":3308522,"node_id":"MDQ6VXNlcjMzMDg1MjI=","avatar_url":"https://avatars0.githubusercontent.com/u/3308522?v=4","gravatar_id":"","url":"https://api.github.com/users/aswan","html_url":"https://github.com/aswan","followers_url":"https://api.github.com/users/aswan/followers","following_url":"https://api.github.com/users/aswan/following{/other_user}","gists_url":"https://api.github.com/users/aswan/gists{/gist_id}","starred_url":"https://api.github.com/users/aswan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aswan/subscriptions","organizations_url":"https://api.github.com/users/aswan/orgs","repos_url":"https://api.github.com/users/aswan/repos","events_url":"https://api.github.com/users/aswan/events{/privacy}","received_events_url":"https://api.github.com/users/aswan/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T17:43:58Z","updated_at":"2015-03-30T17:43:58Z","author_association":"NONE","body":"I just ran into something that sounds similar, stack trace below.  This is followed by a variety of warnings in the logs, all of which seem to be variants of \"my connection with this other node is broken\".  Sorry for the dumb question, I'm unfamiliar with the internals here, is there any hope of making this more resilient?\n\n```\n[2015-03-26 00:22:52,695][DEBUG][action.search.type       ] [node-984cdcf3-a8ed-4fd2-87b1-c3965a60e9d3] [events-default@2015.03.19][1], node[IZDRTRixQ823AXpcGm7KNg], [P], s[STARTE\nD]: Failed to execute [org.elasticsearch.action.search.SearchRequest@37e55556] lastShard [true]\norg.elasticsearch.transport.RemoteTransportException: Failed to deserialize response of type [org.elasticsearch.search.query.QuerySearchResult]\nCaused by: org.elasticsearch.transport.TransportSerializationException: Failed to deserialize response of type [org.elasticsearch.search.query.QuerySearchResult]\n        at org.elasticsearch.transport.netty.MessageChannelHandler.handleResponse(MessageChannelHandler.java:152)\n        at org.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(MessageChannelHandler.java:127)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:310)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n        at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.OutOfMemoryError: Java heap space\n[2015-03-26 00:22:52,702][WARN ][transport.netty          ] [node-984cdcf3-a8ed-4fd2-87b1-c3965a60e9d3] exception caught on transport layer [[id: 0xc69b3bd8, /172.31.9.100:46763 => /172.31.10.126:9300]], closing connection\njava.lang.OutOfMemoryError: Java heap space\n[2015-03-26 00:22:52,696][WARN ][netty.channel.socket.nio.AbstractNioSelector] Unexpected exception in the selector loop.\njava.lang.OutOfMemoryError: Java heap space\n[2015-03-26 00:22:52,696][WARN ][netty.channel.socket.nio.AbstractNioSelector] Unexpected exception in the selector loop.\njava.lang.OutOfMemoryError: Java heap space\n        at java.util.HashMap.newKeyIterator(HashMap.java:968)\n        at java.util.HashMap$KeySet.iterator(HashMap.java:1002)\n        at java.util.HashSet.iterator(HashSet.java:170)\n        at sun.nio.ch.Util$2.iterator(Util.java:303)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:102)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n        at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/99584529","html_url":"https://github.com/elastic/elasticsearch/issues/9018#issuecomment-99584529","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9018","id":99584529,"node_id":"MDEyOklzc3VlQ29tbWVudDk5NTg0NTI5","user":{"login":"mjball","id":378111,"node_id":"MDQ6VXNlcjM3ODExMQ==","avatar_url":"https://avatars1.githubusercontent.com/u/378111?v=4","gravatar_id":"","url":"https://api.github.com/users/mjball","html_url":"https://github.com/mjball","followers_url":"https://api.github.com/users/mjball/followers","following_url":"https://api.github.com/users/mjball/following{/other_user}","gists_url":"https://api.github.com/users/mjball/gists{/gist_id}","starred_url":"https://api.github.com/users/mjball/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mjball/subscriptions","organizations_url":"https://api.github.com/users/mjball/orgs","repos_url":"https://api.github.com/users/mjball/repos","events_url":"https://api.github.com/users/mjball/events{/privacy}","received_events_url":"https://api.github.com/users/mjball/received_events","type":"User","site_admin":false},"created_at":"2015-05-06T19:45:24Z","updated_at":"2015-05-06T19:47:24Z","author_association":"NONE","body":"I'm also running into OOMs leaving nodes in something of a zombie state. Stack traces:\n\n```\n[2015-05-06 14:38:35,028][WARN ][action.index             ] [constance.iad02.hubspot-networks.net] Failed to perform indices:data/write/index on remote replica [slushpond.iad02.hubspot-networks.net][OFjx5P7iSE-YLi4AVf76tg][slushpond][inet[/172.16.12.59:9300]]{availability_zone=us-east-1a, aws_availability_zone=us-east-1a, master=true}[company-event-1][4]\norg.elasticsearch.transport.RemoteTransportException: Failed to deserialize exception response from stream\nCaused by: org.elasticsearch.transport.TransportSerializationException: Failed to deserialize exception response from stream\n    at org.elasticsearch.transport.netty.MessageChannelHandler.handlerResponseError(MessageChannelHandler.java:173)\n    at org.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(MessageChannelHandler.java:125)\n    at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:303)\n    at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n    at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n    at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n    at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n    at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:48:14,151][WARN ][action.index             ] [constance.iad02.hubspot-networks.net] Failed to send response for indices:data/write/index\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:43:09,828][WARN ][transport.netty          ] [constance.iad02.hubspot-networks.net] Failed to send error message back to client for action [indices:data/write/index[r]]\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:42:11,943][WARN ][index.engine.internal    ] [constance.iad02.hubspot-networks.net] [company-event-1][3] failed engine [out of memory]\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:39:02,693][WARN ][transport.netty          ] [constance.iad02.hubspot-networks.net] Failed to send error message back to client for action [indices:data/write/index[r]]\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:48:33,749][WARN ][index.engine.internal    ] [constance.iad02.hubspot-networks.net] [biden-company-3][4] failed engine [indices:data/write/bulk[s] failed on replica]\norg.elasticsearch.index.engine.IndexFailedEngineException: [biden-company-3][4] Index failed for [company#swisstrades.ch]\n    at org.elasticsearch.index.engine.internal.InternalEngine.index(InternalEngine.java:530)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.index(InternalIndexShard.java:425)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnReplica(TransportShardBulkAction.java:590)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$ReplicaOperationTransportHandler.messageReceived(TransportShardReplicationOperationAction.java:246)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$ReplicaOperationTransportHandler.messageReceived(TransportShardReplicationOperationAction.java:225)\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.run(MessageChannelHandler.java:275)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.lucene.store.AlreadyClosedException: this IndexWriter is closed\n    at org.apache.lucene.index.IndexWriter.ensureOpen(IndexWriter.java:698)\n    at org.apache.lucene.index.IndexWriter.ensureOpen(IndexWriter.java:712)\n    at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:1507)\n    at org.elasticsearch.index.engine.internal.InternalEngine.innerIndex(InternalEngine.java:603)\n    at org.elasticsearch.index.engine.internal.InternalEngine.index(InternalEngine.java:522)\n    ... 8 more\nCaused by: java.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:48:33,745][WARN ][action.index             ] [constance.iad02.hubspot-networks.net] Failed to perform indices:data/write/index on remote replica [slushpond.iad02.hubspot-networks.net][OFjx5P7iSE-YLi4AVf76tg][slushpond][inet[/172.16.12.59:9300]]{availability_zone=us-east-1a, aws_availability_zone=us-east-1a, master=true}[company-event-1][4]\norg.elasticsearch.transport.RemoteTransportException: Failed to deserialize exception response from stream\nCaused by: org.elasticsearch.transport.TransportSerializationException: Failed to deserialize exception response from stream\n    at org.elasticsearch.transport.netty.MessageChannelHandler.handlerResponseError(MessageChannelHandler.java:173)\n    at org.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(MessageChannelHandler.java:125)\n    at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443)\n    at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:303)\n    at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n    at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n    at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n    at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n    at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n    at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n    at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:50:23,521][WARN ][cluster.action.shard     ] [constance.iad02.hubspot-networks.net] [company-event-1][4] sending failed shard for [company-event-1][4], node[OFjx5P7iSE-YLi4AVf76tg], [R], s[STARTED], indexUUID [yevQ6omxSmiyjZZKjy1lUw], reason [Failed to perform [indices:data/write/index] on replica, message [RemoteTransportException[Failed to deserialize exception response from stream]; nested: TransportSerializationException[Failed to deserialize exception response from stream]; nested: OutOfMemoryError[Java heap space]; ]]\n[2015-05-06 14:50:23,521][WARN ][cluster.action.shard     ] [constance.iad02.hubspot-networks.net] [company-event-1][4] received shard failed for [company-event-1][4], node[OFjx5P7iSE-YLi4AVf76tg], [R], s[STARTED], indexUUID [yevQ6omxSmiyjZZKjy1lUw], reason [Failed to perform [indices:data/write/index] on replica, message [RemoteTransportException[Failed to deserialize exception response from stream]; nested: TransportSerializationException[Failed to deserialize exception response from stream]; nested: OutOfMemoryError[Java heap space]; ]]\n[2015-05-06 14:48:33,745][DEBUG][action.bulk              ] [constance.iad02.hubspot-networks.net] [biden-company-3][2], node[O-FiNl4vSJ2qtETa3gqrig], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.bulk.BulkShardRequest@776cc9ab]\njava.lang.OutOfMemoryError: Java heap space\n    at java.lang.AbstractStringBuilder.<init>(AbstractStringBuilder.java:64)\n    at java.lang.StringBuilder.<init>(StringBuilder.java:97)\n    at org.elasticsearch.common.logging.support.LoggerMessageFormat.format(LoggerMessageFormat.java:52)\n    at org.elasticsearch.common.logging.support.AbstractESLogger.debug(AbstractESLogger.java:71)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:220)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction.performOnPrimary(TransportShardReplicationOperationAction.java:512)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$1.run(TransportShardReplicationOperationAction.java:419)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n[2015-05-06 14:48:14,617][WARN ][transport.netty          ] [constance.iad02.hubspot-networks.net] Actual Exception\norg.elasticsearch.index.engine.VersionConflictEngineException: [company-event-1][3] [twitterevent][595957573871915008]: version conflict, current [3], provided [2]\n    at org.elasticsearch.index.engine.internal.InternalEngine.innerIndex(InternalEngine.java:582)\n    at org.elasticsearch.index.engine.internal.InternalEngine.index(InternalEngine.java:522)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.index(InternalIndexShard.java:425)\n    at org.elasticsearch.action.index.TransportIndexAction.shardOperationOnReplica(TransportIndexAction.java:234)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$ReplicaOperationTransportHandler.messageReceived(TransportShardReplicationOperationAction.java:246)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$ReplicaOperationTransportHandler.messageReceived(TransportShardReplicationOperationAction.java:225)\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.run(MessageChannelHandler.java:275)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n[2015-05-06 14:48:14,616][DEBUG][action.admin.indices.stats] [constance.iad02.hubspot-networks.net] [company-event-1][1], node[O-FiNl4vSJ2qtETa3gqrig], [P], s[STARTED]: failed to execute [org.elasticsearch.action.admin.indices.stats.IndicesStatsRequest@40fc59d1]\njava.lang.OutOfMemoryError: Java heap space\n    at java.util.HashMap.createEntry(HashMap.java:897)\n    at java.util.HashMap.addEntry(HashMap.java:884)\n    at java.util.HashMap.put(HashMap.java:505)\n    at java.util.HashSet.add(HashSet.java:217)\n    at org.apache.lucene.store.FileSwitchDirectory.listAll(FileSwitchDirectory.java:88)\n    at org.apache.lucene.store.FilterDirectory.listAll(FilterDirectory.java:48)\n    at org.elasticsearch.index.store.DistributorDirectory.listAll(DistributorDirectory.java:88)\n    at org.apache.lucene.store.FilterDirectory.listAll(FilterDirectory.java:48)\n    at org.elasticsearch.common.lucene.Directories.estimateSize(Directories.java:40)\n    at org.elasticsearch.index.store.Store.stats(Store.java:216)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.storeStats(InternalIndexShard.java:540)\n    at org.elasticsearch.action.admin.indices.stats.CommonStats.<init>(CommonStats.java:134)\n    at org.elasticsearch.action.admin.indices.stats.ShardStats.<init>(ShardStats.java:49)\n    at org.elasticsearch.action.admin.indices.stats.TransportIndicesStatsAction.shardOperation(TransportIndicesStatsAction.java:205)\n    at org.elasticsearch.action.admin.indices.stats.TransportIndicesStatsAction.shardOperation(TransportIndicesStatsAction.java:56)\n    at org.elasticsearch.action.support.broadcast.TransportBroadcastOperationAction$AsyncBroadcastAction$1.run(TransportBroadcastOperationAction.java:171)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n[2015-05-06 14:48:14,156][WARN ][action.index             ] [constance.iad02.hubspot-networks.net] Failed to send response for indices:data/write/index\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:48:14,153][WARN ][cluster.action.shard     ] [constance.iad02.hubspot-networks.net] [company-event-1][4] sending failed shard for [company-event-1][4], node[OFjx5P7iSE-YLi4AVf76tg], [R], s[STARTED], indexUUID [yevQ6omxSmiyjZZKjy1lUw], reason [Failed to perform [indices:data/write/index] on replica, message [RemoteTransportException[Failed to deserialize exception response from stream]; nested: TransportSerializationException[Failed to deserialize exception response from stream]; nested: OutOfMemoryError[Java heap space]; ]]\n[2015-05-06 15:07:25,948][WARN ][cluster.action.shard     ] [constance.iad02.hubspot-networks.net] [company-event-1][4] received shard failed for [company-event-1][4], node[OFjx5P7iSE-YLi4AVf76tg], [R], s[STARTED], indexUUID [yevQ6omxSmiyjZZKjy1lUw], reason [Failed to perform [indices:data/write/index] on replica, message [RemoteTransportException[Failed to deserialize exception response from stream]; nested: TransportSerializationException[Failed to deserialize exception response from stream]; nested: OutOfMemoryError[Java heap space]; ]]\n[2015-05-06 15:07:25,948][WARN ][transport.netty          ] [constance.iad02.hubspot-networks.net] Message not fully read (response) for [20311418] handler org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$4@18821df1, error [true], resetting\n[2015-05-06 15:07:25,945][WARN ][http.netty               ] [constance.iad02.hubspot-networks.net] Caught exception while handling client http traffic, closing connection [id: 0x7230c876, /63.139.127.4:45729 => /172.16.45.251:9200]\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 15:07:25,815][WARN ][index.engine.internal    ] [constance.iad02.hubspot-networks.net] [biden-company-3][1] failed engine [out of memory]\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 15:07:25,810][WARN ][netty.channel.socket.nio.AbstractNioSelector] Unexpected exception in the selector loop.\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 15:07:25,805][WARN ][netty.channel.socket.nio.AbstractNioSelector] Unexpected exception in the selector loop.\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:59:32,277][WARN ][http.netty               ] [constance.iad02.hubspot-networks.net] Caught exception while handling client http traffic, closing connection [id: 0xa850e05b, /63.139.127.4:28283 => /172.16.45.251:9200]\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:57:48,450][WARN ][http.netty               ] [constance.iad02.hubspot-networks.net] Caught exception while handling client http traffic, closing connection [id: 0x9ea64b72, /63.139.127.4:54841 => /172.16.45.251:9200]\njava.lang.OutOfMemoryError: Java heap space\n[2015-05-06 14:57:39,919][WARN ][index.search.slowlog.query] [constance.iad02.hubspot-networks.net] [biden-company-3][3] took[29.9m], took_millis[1794652], types[company], stats[], search_type[QUERY_THEN_FETCH], total_shards[5], source[{\"from\":0,\"size\":15,\"query\":{\"bool\":{\"must\":{\"bool\":{\"should\":{\"bool\":{\"must\":[{\"terms\":{\"countrycode\":[\"SE\"]}},{\"terms\":{\"industrycode\":[\"95\"]}}]}}}}}},\"fields\":[],\"sort\":[{\"numcontacts\":{\"order\":\"desc\",\"missing\":\"_last\"}},{\"domain\":{\"order\":\"desc\",\"missing\":\"_last\"}}]}], extra_source[], \n[2015-05-06 14:52:15,181][WARN ][transport.netty          ] [constance.iad02.hubspot-networks.net] Message not fully read (response) for [20311347] handler org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$4@38f80dd, error [true], resetting\n[2015-05-06 14:51:53,118][WARN ][index.shard.service      ] [constance.iad02.hubspot-networks.net] [biden-company-3][4] Failed to perform scheduled engine refresh\norg.elasticsearch.index.engine.RefreshFailedEngineException: [biden-company-3][4] Refresh failed\n    at org.elasticsearch.index.engine.internal.InternalEngine.refresh(InternalEngine.java:831)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.refresh(InternalIndexShard.java:498)\n    at org.elasticsearch.index.shard.service.InternalIndexShard$EngineRefresher$1.run(InternalIndexShard.java:960)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.OutOfMemoryError: Java heap space\n```\n\nFull logs: https://gist.github.com/mjball/d9dd9ebd44c49306bc1d\nUnfortunately I don't have `pending_task` output for this case.\n\nI also took a heap dump but it was not particularly revealing. Happy to send it along if it would be useful. All I saw were 4 ~391 mb `QuerySearchResult` instances. Despite setting `-XX:+HeapDumpOnOutOfMemoryError` it looks like a heap dump was not actually created; I'm not sure why.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/126855075","html_url":"https://github.com/elastic/elasticsearch/issues/9018#issuecomment-126855075","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9018","id":126855075,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNjg1NTA3NQ==","user":{"login":"Srinathc","id":1152327,"node_id":"MDQ6VXNlcjExNTIzMjc=","avatar_url":"https://avatars1.githubusercontent.com/u/1152327?v=4","gravatar_id":"","url":"https://api.github.com/users/Srinathc","html_url":"https://github.com/Srinathc","followers_url":"https://api.github.com/users/Srinathc/followers","following_url":"https://api.github.com/users/Srinathc/following{/other_user}","gists_url":"https://api.github.com/users/Srinathc/gists{/gist_id}","starred_url":"https://api.github.com/users/Srinathc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Srinathc/subscriptions","organizations_url":"https://api.github.com/users/Srinathc/orgs","repos_url":"https://api.github.com/users/Srinathc/repos","events_url":"https://api.github.com/users/Srinathc/events{/privacy}","received_events_url":"https://api.github.com/users/Srinathc/received_events","type":"User","site_admin":false},"created_at":"2015-08-01T03:21:56Z","updated_at":"2015-08-01T03:27:57Z","author_association":"NONE","body":"Have been hitting up a lot of OOM issues even with release 1.7.0.\nDiscussions and test results available on the discussion thread\nhttps://discuss.elastic.co/t/merging-of-segments-results-in-java-lang-outofmemoryerror-java-heap-space/26301\n\nLogs at https://gist.github.com/Srinathc/e22237b578fcfd73d57b#file-oom-log\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161747942","html_url":"https://github.com/elastic/elasticsearch/issues/9018#issuecomment-161747942","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9018","id":161747942,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTc0Nzk0Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-12-03T19:00:47Z","updated_at":"2015-12-03T19:00:47Z","author_association":"CONTRIBUTOR","body":"The zombie nodes problem originally reported here was fixed back in 1.4 I believe. Closing\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161748806","html_url":"https://github.com/elastic/elasticsearch/issues/9018#issuecomment-161748806","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9018","id":161748806,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTc0ODgwNg==","user":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"created_at":"2015-12-03T19:04:10Z","updated_at":"2015-12-03T19:04:10Z","author_association":"MEMBER","body":"(It was with respect to this issue and I have not seen it since. The issue posted just above is unrelated.)\n","performed_via_github_app":null}]