{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48222","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48222/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48222/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48222/events","html_url":"https://github.com/elastic/elasticsearch/issues/48222","id":508797182,"node_id":"MDU6SXNzdWU1MDg3OTcxODI=","number":48222,"title":"jvm.options after upgrade experience","user":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-10-18T01:06:46Z","updated_at":"2019-10-28T11:45:57Z","closed_at":"2019-10-28T11:45:57Z","author_association":"MEMBER","active_lock_reason":null,"body":"When installing Elasticsearch, regardless of how you choose to install it, the `jvm.options` comes along and users are expected to modify it to change the heap settings (at least).\r\n\r\nWhenever an upgrade happens where the `jvm.options` has changed, it is then on the end user to merge the two.\r\n\r\nThis is a straight-forward process: copy/paste your changes into the new file, then save. In practice, even in upgrades where the difference is called out (e.g., `.rpmnew`) variants, I have noticed end users missing that the file has changed and after discussing it with @jasontedor, he noted that he has observed the issue too.\r\n\r\nThe result is that the end user may run into OOM issues, DNS issues, or performance issues that they could have avoided if they simply had the \"right\" JVM settings for their version.\r\n\r\nAs a very simple example, imagine upgrading to [Elasticsearch 6.8](https://github.com/elastic/elasticsearch/blob/6.8/distribution/src/config/jvm.options) (122 lines) from [Elasticsearch 6.2](https://github.com/elastic/elasticsearch/blob/6.2/distribution/src/main/resources/config/jvm.options) (99 lines), but not picking up the new `jvm.options` along the way. You would be missing the DNS changes that came along in 6.6, as well as this critical workaround:\r\n\r\n```\r\n# temporary workaround for C2 bug with JDK 10 on hardware with AVX-512\r\n10-:-XX:UseAVX=2\r\n```\r\n\r\nThis gets even worse if you then upgrade that same node to 7.4.\r\n\r\nJason and I discussed it and I brought up the potential of forcing the version into the file so that it does not start if it does not match, thus forcing attention to it changing, and he mentioned the possibility of a `system_jvm.options` file (or similar).\r\n\r\nI'm opening the issue so this does not get lost, but I am not saying either or both of those options are the best.","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}