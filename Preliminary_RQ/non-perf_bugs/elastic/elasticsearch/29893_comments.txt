[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385644740","html_url":"https://github.com/elastic/elasticsearch/issues/29893#issuecomment-385644740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29893","id":385644740,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTY0NDc0MA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-05-01T10:45:42Z","updated_at":"2018-05-01T10:45:42Z","author_association":"CONTRIBUTOR","body":"https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.3+multijob-unix-compatibility/os=debian/18/console looks like another instance of this","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495772051","html_url":"https://github.com/elastic/elasticsearch/issues/29893#issuecomment-495772051","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29893","id":495772051,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTc3MjA1MQ==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T20:02:55Z","updated_at":"2019-05-24T20:02:55Z","author_association":"CONTRIBUTOR","body":"Un-muted this test on PR #42409 to obtain additional logs. \r\n\r\nIf (when?) this test fails again please obtain the following information before muting the test:\r\n\r\n* Copy of the relevant failure\r\n* Copy of the reproduce line\r\n* The Jenkins build link \r\n* The Gradle scan link\r\n* The relevant cluster logs from \"Google Cloud Storage Upload Report\" (link found in Jenkins build)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/497741418","html_url":"https://github.com/elastic/elasticsearch/issues/29893#issuecomment-497741418","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29893","id":497741418,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Nzc0MTQxOA==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2019-05-31T15:01:18Z","updated_at":"2019-05-31T15:01:18Z","author_association":"CONTRIBUTOR","body":"### Copy of the relevant failure\r\n\r\n<details>\r\n<summary>Expected: is \"execution_not_needed\" but: was \"not_executed_already_queued\"</summary>\r\n\r\nStacktrace\r\n\r\njava.lang.AssertionError: \r\nExpected: is \"execution_not_needed\"\r\n     but: was \"not_executed_already_queued\"\r\n\tat __randomizedtesting.SeedInfo.seed([8C6B46A3AC22313C:23031A56A5F39232]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.testSearchInputWithInsufficientPrivileges(SmokeTestWatcherWithSecurityIT.java:184)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1750)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:938)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:974)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:988)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:947)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:832)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:883)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:894)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n\r\nStandard Output\r\n\r\n[2019-05-31T07:04:45,233][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchInputWithInsufficientPrivileges] before test\r\n[2019-05-31T07:04:45,437][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchInputWithInsufficientPrivileges] initializing REST clients against [http://[::1]:36713]\r\n[2019-05-31T07:04:51,872][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchInputWithInsufficientPrivileges] after test\r\n[2019-05-31T07:04:51,920][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchTransformInsufficientPermissions] before test\r\n[2019-05-31T07:04:55,001][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchTransformInsufficientPermissions] after test\r\n[2019-05-31T07:04:55,018][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testIndexActionInsufficientPrivileges] before test\r\n[2019-05-31T07:04:58,013][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testIndexActionInsufficientPrivileges] after test\r\n[2019-05-31T07:04:58,029][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchInputHasPermissions] before test\r\n[2019-05-31T07:05:00,990][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchInputHasPermissions] after test\r\n[2019-05-31T07:05:01,007][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchTransformHasPermissions] before test\r\n[2019-05-31T07:05:03,976][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testSearchTransformHasPermissions] after test\r\n[2019-05-31T07:05:03,991][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testIndexActionHasPermissions] before test\r\n[2019-05-31T07:05:06,897][INFO ][o.e.s.SmokeTestWatcherWithSecurityIT] [testIndexActionHasPermissions] after test\r\n\r\n</details>\r\n\r\n### Copy of the reproduce line\r\n```\r\n./gradlew :x-pack:qa:smoke-test-watcher-with-security:integTestRunner --tests \"org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.testSearchInputWithInsufficientPrivileges\" -Dtests.seed=8C6B46A3AC22313C -Dtests.security.manager=true -Dtests.locale=ha -Dtests.timezone=Asia/Omsk -Dcompiler.java=12 -Druntime.java=11\r\n```\r\n(does not reproduce)\r\n### The Jenkins build link\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/3818/testReport/junit/org.elasticsearch.smoketest/SmokeTestWatcherWithSecurityIT/testSearchInputWithInsufficientPrivileges/\r\n### The Gradle scan link\r\nhttps://gradle.com/s/kgzehspj7rn22\r\n### The relevant cluster logs from \"Google Cloud Storage Upload Report\" (link found in Jenkins build)\r\nLink to full logs: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/3818/gcsObjects\r\nServer log file for this failure: [x-pack_qa_smoke-test-watcher-with-security_integTestCluster.log](https://github.com/elastic/elasticsearch/files/3241768/x-pack_qa_smoke-test-watcher-with-security_integTestCluster.log)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/497742655","html_url":"https://github.com/elastic/elasticsearch/issues/29893#issuecomment-497742655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29893","id":497742655,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Nzc0MjY1NQ==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2019-05-31T15:04:37Z","updated_at":"2019-05-31T15:04:37Z","author_association":"CONTRIBUTOR","body":"I have a fix for this on https://github.com/elastic/elasticsearch/pull/42764 \r\n\r\nNote - the \"fix\" does not guarantee this won't happen again, it just greatly reduces the odds of it happening by triggering fewer watches (to prevent concurrent watches) and adds a busy wait for expected state. ","performed_via_github_app":null}]