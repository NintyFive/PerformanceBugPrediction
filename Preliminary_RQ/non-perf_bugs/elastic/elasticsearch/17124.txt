{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17124","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17124/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17124/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17124/events","html_url":"https://github.com/elastic/elasticsearch/issues/17124","id":141114843,"node_id":"MDU6SXNzdWUxNDExMTQ4NDM=","number":17124,"title":"Transient and/or persistent threadpool index queue size configuration is not taken into account when updating them using the cluster update API.","user":{"login":"petitout","id":12103790,"node_id":"MDQ6VXNlcjEyMTAzNzkw","avatar_url":"https://avatars1.githubusercontent.com/u/12103790?v=4","gravatar_id":"","url":"https://api.github.com/users/petitout","html_url":"https://github.com/petitout","followers_url":"https://api.github.com/users/petitout/followers","following_url":"https://api.github.com/users/petitout/following{/other_user}","gists_url":"https://api.github.com/users/petitout/gists{/gist_id}","starred_url":"https://api.github.com/users/petitout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/petitout/subscriptions","organizations_url":"https://api.github.com/users/petitout/orgs","repos_url":"https://api.github.com/users/petitout/repos","events_url":"https://api.github.com/users/petitout/events{/privacy}","received_events_url":"https://api.github.com/users/petitout/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-03-15T22:15:23Z","updated_at":"2016-03-16T12:58:08Z","closed_at":"2016-03-15T23:54:04Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 1.7.5\n\n**JVM version**: 1.8.0_66\n\n**OS version**: CentOS Linux release 7.1.1503\nLinux localhost 3.10.0-229.20.1.el7.x86_64\n\n**Description of the problem including expected versus actual behavior**:\n\nI've the following error when trying to delete a huge amount of documents :\n\n```\n....\n\"myIndexName\": {\n        \"_shards\": {\n            \"total\": 1,\n            \"successful\": 0,\n            \"failed\": 1,\n            \"failures\": [\n                {\n                    \"index\": \"myIndexName\",\n                    \"shard\": 0,\n                    \"reason\": \"EsRejectedExecutionException[rejected execution (queue capacity 100) on org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$PrimaryPhase$1@4d215e4]\"\n                }\n            ]\n        }\n    }\n....\n```\n\nI know what this error means so I tried to execute the following command to resolve the issue :\n\n```\ncurl -XPUT localhost:9200/_cluster/settings -d '{\"transient\" : {\"threadpool.index.queue_size\":500}, \"persistent\": {\"threadpool.index.queue_size\":500} }'\n```\n\nand I got the following response :\n\n```\n{\"acknowledged\":true,\"persistent\":{\"threadpool\":{\"index\":{\"queue_size\":\"500\"}}},\"transient\":{\"threadpool\":{\"index\":{\"queue_size\":\"500\"}}}}\n```\n\nBut unfortunately when trying to delete again the documents, I still get the exact same error.\n\nThen I manually updated elasticsearch.yml to add the following line :\n\n```\n...\nthreadpool.index.queue_size: 500\n...\n```\n\nI restarted elasticsearch and the delete query was working fine.\n\n**Steps to reproduce**:\n1. manage to get a \"EsRejectedExecutionException\" error when indexing or deleting documents (you may do it by voluntarily set a very small threadpool.index.queue_size value in the configuration file)\n2. Update this threadpool.index.queue_size using the cluster update api :\n\n```\ncurl -XPUT localhost:9200/_cluster/settings -d '{\"transient\" : {\"threadpool.index.queue_size\":500}, \"persistent\": {\"threadpool.index.queue_size\":500} }'\n```\n1. try to index or delete the documents again\n\n**Provide logs (if relevant)**:\nNo error in logs only this logs appear when executing the cluster update query :\n\n```\n[2016-03-15 15:09:52,234][DEBUG][cluster.service          ] [Living Monolith] processing [cluster_update_settings]: execute\n[2016-03-15 15:09:52,240][DEBUG][cluster.service          ] [Living Monolith] cluster state updated, version [343], source [cluster_update_settings]\n[2016-03-15 15:09:52,240][DEBUG][cluster.service          ] [Living Monolith] publishing cluster state version 343\n[2016-03-15 15:09:52,240][DEBUG][cluster.service          ] [Living Monolith] set local cluster state to version 343\n[2016-03-15 15:09:52,250][DEBUG][river.cluster            ] [Living Monolith] processing [reroute_rivers_node_changed]: execute\n[2016-03-15 15:09:52,250][DEBUG][river.cluster            ] [Living Monolith] processing [reroute_rivers_node_changed]: no change in cluster_state\n[2016-03-15 15:09:52,253][DEBUG][cluster.service          ] [Living Monolith] processing [cluster_update_settings]: took 19ms done applying updated cluster_state (version: 343)\n[2016-03-15 15:09:52,254][DEBUG][cluster.service          ] [Living Monolith] processing [reroute_after_cluster_update_settings]: execute\n[2016-03-15 15:09:52,256][DEBUG][cluster.service          ] [Living Monolith] processing [reroute_after_cluster_update_settings]: took 2ms no change in cluster_state\n```\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}