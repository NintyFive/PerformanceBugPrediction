{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23257","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23257/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23257/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23257/events","html_url":"https://github.com/elastic/elasticsearch/issues/23257","id":208828661,"node_id":"MDU6SXNzdWUyMDg4Mjg2NjE=","number":23257,"title":"SpanOrQuery Problem ","user":{"login":"sumirian","id":8498106,"node_id":"MDQ6VXNlcjg0OTgxMDY=","avatar_url":"https://avatars2.githubusercontent.com/u/8498106?v=4","gravatar_id":"","url":"https://api.github.com/users/sumirian","html_url":"https://github.com/sumirian","followers_url":"https://api.github.com/users/sumirian/followers","following_url":"https://api.github.com/users/sumirian/following{/other_user}","gists_url":"https://api.github.com/users/sumirian/gists{/gist_id}","starred_url":"https://api.github.com/users/sumirian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sumirian/subscriptions","organizations_url":"https://api.github.com/users/sumirian/orgs","repos_url":"https://api.github.com/users/sumirian/repos","events_url":"https://api.github.com/users/sumirian/events{/privacy}","received_events_url":"https://api.github.com/users/sumirian/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-02-20T09:44:21Z","updated_at":"2017-02-20T13:43:27Z","closed_at":"2017-02-20T13:43:27Z","author_association":"NONE","active_lock_reason":null,"body":" I have a field (navigation.path) using whitespace analyzer to analyze.\r\n\r\nWhen the value is \"P1 P2 P3 P4 P5\", \r\nI hope the query which has the meaning similar to P1 (slop 5) (P2 or P4) (slop 0) P5 can match it. It failed.\r\nI use P1 (slop 5) P4 (slop 0) P5, and it matched.\r\n\r\nHere is my confuse. When using the spanOrQuery, is elasticsearch just match one condition and continue to match remaining query, and will not go back to match other span or conditions even the previous match failed?\r\nIf it is true, is the spanOrQuery can only be the last item in span queries?\r\n\r\nBelow is my query dsl.\r\n{\r\n\"span_near\" : {\r\n\"clauses\" : [ {\r\n\"span_near\" : {\r\n\"clauses\" : [ {\r\n\"span_or\" : {\r\n\"clauses\" : [ {\r\n\"span_term\" : {\r\n\"navigation.path\" : {\r\n\"value\" : \"P1\"\r\n}\r\n}\r\n} ]\r\n}\r\n}, {\r\n\"span_first\" : {\r\n\"match\" : {\r\n\"span_or\" : {\r\n\"clauses\" : [ {\r\n\"span_term\" : {\r\n\"navigation.path\" : {\r\n\"value\" : \"P4\"\r\n}\r\n}\r\n}, {\r\n\"span_term\" : {\r\n\"navigation.path\" : {\r\n\"value\" : \"P2\"\r\n}\r\n}\r\n} ]\r\n}\r\n},\r\n\"end\" : 10\r\n}\r\n} ],\r\n\"slop\" : 5,\r\n\"in_order\" : true\r\n}\r\n}, {\r\n\"span_or\" : {\r\n\"clauses\" : [ {\r\n\"span_term\" : {\r\n\"navigation.path\" : {\r\n\"value\" : \"P5\"\r\n}\r\n}\r\n} ]\r\n}\r\n} ],\r\n\"slop\" : 0,\r\n\"in_order\" : true\r\n}\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}