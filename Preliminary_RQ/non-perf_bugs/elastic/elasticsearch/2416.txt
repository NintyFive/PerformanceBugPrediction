{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2416","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2416/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2416/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2416/events","html_url":"https://github.com/elastic/elasticsearch/issues/2416","id":8413689,"node_id":"MDU6SXNzdWU4NDEzNjg5","number":2416,"title":"Indices filter parsed for indices to which it should not apply","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":65649829,"node_id":"MDU6TGFiZWw2NTY0OTgyOQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.8","name":"v0.90.8","color":"DDDDDD","default":false,"description":null},{"id":64607794,"node_id":"MDU6TGFiZWw2NDYwNzc5NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta2","name":"v1.0.0.Beta2","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"assignees":[{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2012-11-16T08:40:53Z","updated_at":"2013-11-14T17:33:01Z","closed_at":"2013-11-14T17:30:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"A used in the forum is trying to apply a nested filter to just one index, while querying more than one index, some of which don't have the nested mapping.\n\nThe query is complaining about a missing nested mapping, but on the indices to which the query should not apply.\n\nCreate two indices: `test_1` with a nested mapping, and `test_2` without a nested mapping:\n\n```\ncurl -XPUT 'http://127.0.0.1:9200/test_1/?pretty=1'  -d '\n{\n   \"mappings\" : {\n      \"foo\" : {\n         \"properties\" : {\n            \"authors\" : {\n               \"type\" : \"nested\",\n               \"properties\" : {\n                  \"name\" : {\n                     \"type\" : \"string\"\n                  }\n               }\n            },\n            \"title\" : {\n               \"type\" : \"string\"\n            }\n         }\n      }\n   }\n}\n'\n\ncurl -XPUT 'http://127.0.0.1:9200/test_2/?pretty=1'  -d '\n{\n   \"mappings\" : {\n      \"bar\" : {\n         \"properties\" : {\n            \"title\" : {\n               \"type\" : \"string\"\n            }\n         }\n      }\n   }\n}\n'\n```\n\nIndex some data:\n\n```\ncurl -XPOST 'http://127.0.0.1:9200/test_1/foo?pretty=1'  -d '\n{\n   \"author\" : {\n      \"name\" : \"john smith\"\n   },\n   \"title\" : \"test 1 doc\"\n}\n'\n\ncurl -XPOST 'http://127.0.0.1:9200/test_2/bar?pretty=1'  -d '\n{\n   \"title\" : \"test 2 doc\"\n}\n'\n```\n\nQuery `test_1` and `test_2` but limit the nested filter to just `test_1`:\n\n```\ncurl -XGET 'http://127.0.0.1:9200/test_1%2Ctest_2/_search?pretty=1'  -d '\n{\n   \"query\" : {\n      \"filtered\" : {\n         \"filter\" : {\n            \"indices\" : {\n               \"no_match_filter\" : \"none\",\n               \"filter\" : {\n                  \"nested\" : {\n                     \"filter\" : {\n                        \"term\" : {\n                           \"author.name\" : \"john\"\n                        }\n                     },\n                     \"path\" : \"author\"\n                  }\n               },\n               \"indices\" : [\n                  \"test_1\"\n               ]\n            }\n         },\n         \"query\" : {\n            \"match\" : {\n               \"title\" : \"test\"\n            }\n         }\n      }\n   }\n}\n'\n```\n\nThrows this error:\n\n```\nSearchPhaseExecutionException[Failed to execute phase [query], total failure; shardFailures {[Yit05d94RgiUwMg9vzMOgw][test_1][1]: SearchParseException[[test_1][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n   \"query\" : {\n      \"filtered\" : {\n         \"filter\" : {\n            \"indices\" : {\n               \"no_match_filter\" : \"none\",\n               \"filter\" : {\n                  \"nested\" : {\n                     \"filter\" : {\n                        \"term\" : {\n                           \"author.name\" : \"john\"\n                        }\n                     },\n                     \"path\" : \"author\"\n                  }\n               },\n               \"indices\" : [\n                  \"test_1\"\n               ]\n            }\n         },\n         \"query\" : {\n            \"match\" : {\n               \"title\" : \"test\"\n            }\n         }\n      }\n   }\n}\n```\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}