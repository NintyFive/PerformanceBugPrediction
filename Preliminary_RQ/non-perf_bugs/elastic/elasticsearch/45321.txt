{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45321","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45321/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45321/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45321/events","html_url":"https://github.com/elastic/elasticsearch/issues/45321","id":478339959,"node_id":"MDU6SXNzdWU0NzgzMzk5NTk=","number":45321,"title":"_cat/plugins threw NullPointerException","user":{"login":"shoulian-zhao","id":38655500,"node_id":"MDQ6VXNlcjM4NjU1NTAw","avatar_url":"https://avatars2.githubusercontent.com/u/38655500?v=4","gravatar_id":"","url":"https://api.github.com/users/shoulian-zhao","html_url":"https://github.com/shoulian-zhao","followers_url":"https://api.github.com/users/shoulian-zhao/followers","following_url":"https://api.github.com/users/shoulian-zhao/following{/other_user}","gists_url":"https://api.github.com/users/shoulian-zhao/gists{/gist_id}","starred_url":"https://api.github.com/users/shoulian-zhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoulian-zhao/subscriptions","organizations_url":"https://api.github.com/users/shoulian-zhao/orgs","repos_url":"https://api.github.com/users/shoulian-zhao/repos","events_url":"https://api.github.com/users/shoulian-zhao/events{/privacy}","received_events_url":"https://api.github.com/users/shoulian-zhao/received_events","type":"User","site_admin":false},"labels":[{"id":165912659,"node_id":"MDU6TGFiZWwxNjU5MTI2NTk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/CAT%20APIs","name":":Core/Features/CAT APIs","color":"0e8a16","default":false,"description":"Text APIs behind /_cat"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-08-08T09:01:54Z","updated_at":"2020-02-24T17:42:07Z","closed_at":"2020-02-24T17:42:07Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** : 6.7.0\r\n\r\n**Plugins installed**: [\r\n{\"analysis-icu\",\"version\":\"6.7.0\"},\r\n{\"analysis-ik\",\"version\":\"6.7.0-rc1\"},\r\n{\"analysis-kuromoji\",\"version\":\"6.7.0\"},\r\n{\"analysis-phonetic\",\"version\":\"6.7.0\"},\r\n{\"analysis-pinyin\",\"version\":\"6.7.0\"},\r\n{\"analysis-smartcn\",\"version\":\"6.7.0\"},\r\n{\"elasticsearch-repository-oss\",\"version\":\"6.7.0\"},\r\n{\"ingest-attachment\",\"version\":\"6.7.0\"},\r\n{\"mapper-murmur3\",\"version\":\"6.7.0\"},\r\n{\"mapper-size\",\"version\":\"6.7.0\"},\r\n{\"repository-hdfs\",\"version\":\"6.7.0\"}]\r\n\r\n**JVM version** : OpenJDK 64-Bit Server VM (11.0.3-AJDK+26-Alibabaï¼‰\r\n\r\n**OS version** : Linux 3.10.0-327.ali2010.rc6.alios7.x86_64 # x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nSometimes there is `NullPointerException` error when *_cat/plugins* was executed and according to class *org/elasticsearch/rest/action/cat/RestPluginsAction.java*, this may happen when *ClusterStateResponse state* or *NodesInfoResponse nodesInfo* can't be retrieved. \r\n\r\nLooking at the code it seems that a node present in the `ClusterStateResponse` can be missing in the `NodesInfoResponse` since they are retrieved in order (first the cluster state then the nodes infos). It's not really clear to me why we need to retrieve the cluster state since we have all the infos that we need in the `NodesInfoResponse` response. I guess we could remove the cluster state entirely or protect against missing nodes in the nodes info response in order to avoid the NPE.\r\n\r\nBut it's expected to be handled more properly instead of throwing **NullPointerException**.\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n[2019-07-17T18:04:38,301][WARN ][r.suppressed             ] [nodeName] path: /_cat/plugins, params: {format=json}\r\njava.lang.NullPointerException: null\r\n\tat org.elasticsearch.rest.action.cat.RestPluginsAction.buildTable(RestPluginsAction.java:99) ~[elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.rest.action.cat.RestPluginsAction.access$000(RestPluginsAction.java:41) ~[elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.rest.action.cat.RestPluginsAction$1$1.buildResponse(RestPluginsAction.java:72) ~[elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.rest.action.cat.RestPluginsAction$1$1.buildResponse(RestPluginsAction.java:69) ~[elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.rest.action.RestResponseListener.processResponse(RestResponseListener.java:37) ~[elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.rest.action.RestActionListener.onResponse(RestActionListener.java:47) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:85) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:81) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.finishHim(TransportNodesAction.java:251) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onOperation(TransportNodesAction.java:228) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$100(TransportNodesAction.java:151) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleResponse(TransportNodesAction.java:205) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleResponse(TransportNodesAction.java:195) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1098) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.transport.TcpTransport$1.doRun(TcpTransport.java:985) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$DirectExecutorService.execute(EsExecutors.java:192) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.transport.TcpTransport.handleResponse(TcpTransport.java:977) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:952) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:763) [elasticsearch-6.7.0.jar:6.7.0]\r\n\tat org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:53) [transport-netty4-client-6.7.0.jar:6.7.0]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323) [netty-codec-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:297) [netty-codec-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.logging.LoggingHandler.channelRead(LoggingHandler.java:241) [netty-handler-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1436) [netty-handler-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1203) [netty-handler-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1247) [netty-handler-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:502) [netty-codec-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:441) [netty-codec-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:278) [netty-codec-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:656) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:556) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:510) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) [netty-transport-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) [netty-common-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n```","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}