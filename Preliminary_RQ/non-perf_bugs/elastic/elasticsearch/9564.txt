{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9564","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9564/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9564/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9564/events","html_url":"https://github.com/elastic/elasticsearch/issues/9564","id":56555037,"node_id":"MDU6SXNzdWU1NjU1NTAzNw==","number":9564,"title":"IllegalStateException with some 'min-to-max' regexp queries after upgrade to 1.4.2","user":{"login":"wkf","id":2183550,"node_id":"MDQ6VXNlcjIxODM1NTA=","avatar_url":"https://avatars3.githubusercontent.com/u/2183550?v=4","gravatar_id":"","url":"https://api.github.com/users/wkf","html_url":"https://github.com/wkf","followers_url":"https://api.github.com/users/wkf/followers","following_url":"https://api.github.com/users/wkf/following{/other_user}","gists_url":"https://api.github.com/users/wkf/gists{/gist_id}","starred_url":"https://api.github.com/users/wkf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wkf/subscriptions","organizations_url":"https://api.github.com/users/wkf/orgs","repos_url":"https://api.github.com/users/wkf/repos","events_url":"https://api.github.com/users/wkf/events{/privacy}","received_events_url":"https://api.github.com/users/wkf/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-02-04T16:59:47Z","updated_at":"2015-02-28T04:43:22Z","closed_at":"2015-02-28T04:43:22Z","author_association":"NONE","active_lock_reason":null,"body":"Hey there. \n\nAfter upgrading from elasticsearch 1.3.4 to 1.4.2, I noticed some odd behavior with a particular regexp my application was making. It seems related to the 'min-to-max' qualifier. Also, someone in IRC recommend I mention @mikemccand here. Thanks!\n\nThe following works fine:\n\n```\ncurl -XPOST 127.0.0.1:9200/_search -d '{\"sort\":[\"path\"],\"query\":{\"regexp\":{\"path\":\"0(.[0-9]*){0,1}\"}}}'\n```\n\nThe following causes an exception, notice the change from `1` to `2`:\n\n```\ncurl -XPOST 127.0.0.1:9200/_search -d '{\"sort\":[\"path\"],\"query\":{\"regexp\":{\"path\":\"0(.[0-9]*){0,2}\"}}}'\n```\n\nHere's the response:\n\n```\n{\"error\": \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; hardFailures {[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.1][0]: SearchParseException[[catalog_0.1][0]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@39c8716>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.2][0]: SearchParseException[[catalog_0.2][0]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@511653fa>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.1][1]: SearchParseException[[catalog_0.1][1]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@525169ca>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.2][1]: SearchParseException[[catalog_0.2][1]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@2e31771f>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.1][2]: SearchParseException[[catalog_0.1][2]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@7a434645>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.2][2]: SearchParseException[[catalog_0.2][2]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@5641b256>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.1][3]: SearchParseException[[catalog_0.1][3]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@56bcf6a7>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.2][3]: SearchParseException[[catalog_0.2][3]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@16fdf9f4>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.1][4]: SearchParseException[[catalog_0.1][4]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@484338f9>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }{[0f-WyJPsQSGVoGRSCAH1-w][catalog_0.2][4]: SearchParseException[[catalog_0.2][4]: from[-1],size[-1],sort[<custom:\\\"path\\\": org.elasticsearch.index.fielddata.fieldcomparator.BytesRefFieldComparatorSource@711adf93>]: Parse Failure [Failed to parse source [{\\\"sort\\\":[\\\"path\\\"],\\\"query\\\":{\\\"regexp\\\":{\\\"path\\\":\\\"0(.[0-9]*){0,3}\\\"}}}]]]; nested: IllegalStateException[from state (2) already had transitions added]; }]\", \"status\": 400}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}