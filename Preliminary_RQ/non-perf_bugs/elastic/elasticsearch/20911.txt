{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20911","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20911/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20911/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20911/events","html_url":"https://github.com/elastic/elasticsearch/issues/20911","id":182778550,"node_id":"MDU6SXNzdWUxODI3Nzg1NTA=","number":20911,"title":"Parsing of \"ZZZ\" component in date formats fails","user":{"login":"yrodiere","id":412878,"node_id":"MDQ6VXNlcjQxMjg3OA==","avatar_url":"https://avatars1.githubusercontent.com/u/412878?v=4","gravatar_id":"","url":"https://api.github.com/users/yrodiere","html_url":"https://github.com/yrodiere","followers_url":"https://api.github.com/users/yrodiere/followers","following_url":"https://api.github.com/users/yrodiere/following{/other_user}","gists_url":"https://api.github.com/users/yrodiere/gists{/gist_id}","starred_url":"https://api.github.com/users/yrodiere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yrodiere/subscriptions","organizations_url":"https://api.github.com/users/yrodiere/orgs","repos_url":"https://api.github.com/users/yrodiere/repos","events_url":"https://api.github.com/users/yrodiere/events{/privacy}","received_events_url":"https://api.github.com/users/yrodiere/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-10-13T12:41:04Z","updated_at":"2018-02-13T20:47:42Z","closed_at":"2016-11-10T16:32:46Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.4.1 \nUsed to work in 2.3.1.\n\n**Plugins installed**: none\n\n**JVM version**: java version \"1.8.0_101\"\nJava(TM) SE Runtime Environment (build 1.8.0_101-b13)\nJava HotSpot(TM) 64-Bit Server VM (build 25.101-b13, mixed mode)\n\n**OS version**: Fedora 24\n\n**Description of the problem including expected versus actual behavior**:\n\nParsing of \"ZZZ\" component in date formats seems to fail for some formats. I don't know what exactly triggers the issue, but having a literal just before the \"ZZZ\" component seems to be enough.\n\nI managed to reproduce the bug in Joda-time 2.9.4 directly. There seems to be a [fix in master](https://github.com/yrodiere/joda-time/commit/eaaff1d0687fc86a745ca8f3ea0b069b3cf54233), but it has not been released yet.\n\nThe next release of Elasticsearch on the 2.4 branch should upgrade the Joda dependency to fix this bug.\n\n**Steps to reproduce**:\n1. Launch an Elasticsearch node on localhost:9200\n2. Execute the following bash script:\n\n```\ncurl -XPUT 'localhost:9200/testindex/?pretty'\ncurl -XPUT 'localhost:9200/testindex/testtype/_mapping?pretty' -d'{\"properties\":{\"zonedDate\":{\"type\":\"date\",\"store\":true,\"format\":\"yyyy-MM-dd'['ZZZ']'\"}}}'\ncurl -XPUT 'localhost:9200/testindex/testtype/1?pretty' -d'{\"zonedDate\":\"2016-10-13[CET]\"}'\n```\n\n**Provide logs (if relevant)**:\nElasticsearch response for the last command:\n\n```\n{\n  \"error\" : {\n    \"root_cause\" : [ {\n      \"type\" : \"mapper_parsing_exception\",\n      \"reason\" : \"failed to parse [zonedDate]\"\n    } ],\n    \"type\" : \"mapper_parsing_exception\",\n    \"reason\" : \"failed to parse [zonedDate]\",\n    \"caused_by\" : {\n      \"type\" : \"illegal_argument_exception\",\n      \"reason\" : \"Invalid format: \\\"2016-10-13[CET]\\\" is malformed at \\\"CET]\\\"\"\n    }\n  },\n  \"status\" : 400\n}\n```\n","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}