{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28086","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28086/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28086/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28086/events","html_url":"https://github.com/elastic/elasticsearch/issues/28086","id":286109022,"node_id":"MDU6SXNzdWUyODYxMDkwMjI=","number":28086,"title":"Upgrade from 6.0.1 to 6.1.1 breaks use of ENV variables in elasticsearch.yml","user":{"login":"hatdropper1977","id":3123188,"node_id":"MDQ6VXNlcjMxMjMxODg=","avatar_url":"https://avatars1.githubusercontent.com/u/3123188?v=4","gravatar_id":"","url":"https://api.github.com/users/hatdropper1977","html_url":"https://github.com/hatdropper1977","followers_url":"https://api.github.com/users/hatdropper1977/followers","following_url":"https://api.github.com/users/hatdropper1977/following{/other_user}","gists_url":"https://api.github.com/users/hatdropper1977/gists{/gist_id}","starred_url":"https://api.github.com/users/hatdropper1977/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hatdropper1977/subscriptions","organizations_url":"https://api.github.com/users/hatdropper1977/orgs","repos_url":"https://api.github.com/users/hatdropper1977/repos","events_url":"https://api.github.com/users/hatdropper1977/events{/privacy}","received_events_url":"https://api.github.com/users/hatdropper1977/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-01-04T20:49:31Z","updated_at":"2018-01-04T20:52:26Z","closed_at":"2018-01-04T20:52:26Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: \r\n\r\n6.1.1\r\n\r\n**Plugins installed**:\r\n\r\ns3-repository\r\n\r\n**JVM version** (`java -version`):  \r\n\r\nopenjdk version \"1.8.0_151\"\r\nOpenJDK Runtime Environment (build 1.8.0_151-b12)\r\nOpenJDK 64-Bit Server VM (build 25.151-b12, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\nLinux d3c9376aeb5e 3.10.0-693.5.2.el7.x86_64 #1 SMP Fri Oct 20 20:32:50 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen I upgrade from 6.0.1 to 6.1.1, Elasticsearch no longer recognizes environment variables in the **discovery.zen.ping.unicast.hosts**  stanza.  It tries to use the literal environment variable string as the hostname.\r\n\r\n**Steps to reproduce**:\r\n\r\nI have the following ENV variables set on my OS:\r\n```bash\r\n[elasticsearch@c29d12af3062 ~]$ env | grep FQDN\r\nLOCAL_BARE_METAL_FQDN=ip-10-0-0-33.ec2.internal\r\nREMOTE_BARE_METAL_FQDN_1=ip-10-0-0-37.ec2.internal\r\nREMOTE_BARE_METAL_FQDN_2=ip-10-0-0-28.ec2.internal\r\n```\r\nMy **elasticsearch.yml** file includes the following line:\r\n```yaml\r\ndiscovery.zen.ping.unicast.hosts:\r\n  - ${REMOTE_BARE_METAL_FQDN_1}\r\n  - ${REMOTE_BARE_METAL_FQDN_2}\r\n```\r\nWhen I start the service on Elasticsearch 6.0.1 I can use the environment variables in **elasticsearch.yml** without issue.  This shows Node 2 succesfully joining the master.\r\n```syslog\r\n[2018-01-04T20:45:05,841][INFO ][o.e.b.BootstrapChecks    ] [ip-10-0-0-33.ec2.internal] bound or publishing to a non-loopback or non-link-local address, enforcing bootstrap checks\r\n[2018-01-04T20:45:09,074][INFO ][o.e.c.s.ClusterApplierService] [ip-10-0-0-33.ec2.internal] detected_master {ip-10-0-0-28.ec2.internal}{BAq5Pdi4S0SLRWWDFK5kkw}{W2KQc8xkS4SafNkXPbRLlg}{ip-10-0-0-28.ec2.internal}{10.0.0.28:9300}{ml.max_open_jobs=10, ml.enabled=true}, added {{ip-10-0-0-28.ec2.internal}{BAq5Pdi4S0SLRWWDFK5kkw}{W2KQc8xkS4SafNkXPbRLlg}{ip-10-0-0-28.ec2.internal}{10.0.0.28:9300}{ml.max_open_jobs=10, ml.enabled=true},}, reason: apply cluster state (from master [master {ip-10-0-0-28.ec2.internal}{BAq5Pdi4S0SLRWWDFK5kkw}{W2KQc8xkS4SafNkXPbRLlg}{ip-10-0-0-28.ec2.internal}{10.0.0.28:9300}{ml.max_open_jobs=10, ml.enabled=true} committed version [38]])\r\n```\r\nHowever - when I start the service on Elasticsearch 6.1.1 I receive the following **error** logs.  I receive this log on all three nodes, I just picked node one for an example:\r\n```syslog\r\n[2018-01-04T19:43:52,682][WARN ][o.e.d.z.UnicastZenPing   ] [ip-10-0-0-28.ec2.internal] failed to resolve host [${REMOTE_BARE_METAL_FQDN_1}]\r\njava.net.UnknownHostException: ${REMOTE_BARE_METAL_FQDN_1}: Name or service not known\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}