{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23579","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23579/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23579/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23579/events","html_url":"https://github.com/elastic/elasticsearch/issues/23579","id":214054316,"node_id":"MDU6SXNzdWUyMTQwNTQzMTY=","number":23579,"title":"Empty geo_point being treated as [-180, -90]?","user":{"login":"magrossi","id":15252464,"node_id":"MDQ6VXNlcjE1MjUyNDY0","avatar_url":"https://avatars0.githubusercontent.com/u/15252464?v=4","gravatar_id":"","url":"https://api.github.com/users/magrossi","html_url":"https://github.com/magrossi","followers_url":"https://api.github.com/users/magrossi/followers","following_url":"https://api.github.com/users/magrossi/following{/other_user}","gists_url":"https://api.github.com/users/magrossi/gists{/gist_id}","starred_url":"https://api.github.com/users/magrossi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/magrossi/subscriptions","organizations_url":"https://api.github.com/users/magrossi/orgs","repos_url":"https://api.github.com/users/magrossi/repos","events_url":"https://api.github.com/users/magrossi/events{/privacy}","received_events_url":"https://api.github.com/users/magrossi/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2017-03-14T12:18:38Z","updated_at":"2018-05-07T17:56:40Z","closed_at":"2018-05-07T17:56:40Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\n\r\nI'm migrating an ES cluster from v1.7.5 to v5.1.2 and noticed that in v5.1.2 empy geo_point fields are being treated as if they were valid points with coordinates [-180, -90] within geo_xxx queries (used to work fine in v1.7.5). I'm trying to simply get the geo_bounds of my geo_point field to determine the area it covers. Previously I used \"max\" and \"min\" aggs on each coordinate (lat and lon) to accomplish this (this is just for our own ease of implementation) and now this is not even working (returns \"null\" for every coordinates max and min).\r\nHas anyone experienced this? How do I get the geo_bounds without the empty points being considered? I've tried \"bool\" > \"must\" > \"exists\" without success.\r\nPlease see below some examples of what I just reported.\r\n### Mapping\r\n```json\r\n          \"Location\": {\r\n            \"type\": \"geo_point\"\r\n          },\r\n```\r\n### Data Samples\r\n```json\r\n\"Location\": \"-0.533218, 34.5575\", << non-empty valid point\r\n\"Location\": \"\",                   << empty invalid point\r\n```\r\n### Query\r\n```json\r\nGET _search\r\n{\r\n    \"query\": {\r\n        \"bool\" : {\r\n            \"must\" : {\r\n                \"exists\": { \"field\": \"Location\" }\r\n            }\r\n        }\r\n    },\r\n    \"size\": 0,\r\n    \"aggs\": {\r\n      \"Location_bounds\": {\r\n        \"geo_bounds\": {\r\n            \"field\": \"Location\"\r\n        }\r\n      },\r\n      \"Location_lon_min\": {\r\n        \"min\": {\r\n          \"field\": \"Location.lon\"\r\n        }\r\n      },\r\n      \"Location_lon_max\": {\r\n        \"max\": {\r\n          \"field\": \"Location.lon\"\r\n        }\r\n      },\r\n      \"Location_lat_min\": {\r\n        \"min\": {\r\n          \"field\": \"Location.lat\"\r\n        }\r\n      },\r\n      \"Location_lat_max\": {\r\n        \"max\": {\r\n          \"field\": \"Location.lat\"\r\n        }\r\n      }\r\n    }\r\n}\r\n```\r\n### Query result\r\n```json\r\n{\r\n  \"took\": 3,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 66000,\r\n    \"max_score\": 0,\r\n    \"hits\": []\r\n  },\r\n  \"aggregations\": {\r\n    \"Location_lat_min\": {\r\n      \"value\": null\r\n    },\r\n    \"Location_lat_max\": {\r\n      \"value\": null\r\n    },\r\n    \"Location_lon_min\": {\r\n      \"value\": null\r\n    },\r\n    \"Location_lon_max\": {\r\n      \"value\": null\r\n    },\r\n    \"Location_bounds\": {\r\n      \"bounds\": {\r\n        \"top_left\": {\r\n          \"lat\": 0.5858219834044576,\r\n          \"lon\": 34.09869999624789\r\n        },\r\n        \"bottom_right\": {\r\n          \"lat\": -90,\r\n          \"lon\": -180\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nAnd I can confirm I have no geo_point in the [-180, -90] coordinate.\r\n\r\nThank you very much.","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}