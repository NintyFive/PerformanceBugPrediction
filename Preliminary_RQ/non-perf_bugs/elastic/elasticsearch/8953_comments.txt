[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66994791","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-66994791","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":66994791,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTk0Nzkx","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2014-12-15T13:39:02Z","updated_at":"2014-12-15T13:39:02Z","author_association":"MEMBER","body":"the messages means that the ping responses comes in too late. By default we wait up to 3s for multicast ping responses to come back. Anything above that will indeed be ignored. This is the nature of a ping - you use to discover what's out there, so you can't wait forever.  As a side note - try using unicast in production environment - it's more reliable. \n\nI'm not sure what you're doing exactly, as you seem to be connecting EC2 based nodes with Azure? This is not a good idea because ES needs a good low latency network between nodes. Depending on what you are trying to achieve, there might be better ways to achieve this. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67120740","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-67120740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":67120740,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MTIwNzQw","user":{"login":"yaronr","id":6322020,"node_id":"MDQ6VXNlcjYzMjIwMjA=","avatar_url":"https://avatars3.githubusercontent.com/u/6322020?v=4","gravatar_id":"","url":"https://api.github.com/users/yaronr","html_url":"https://github.com/yaronr","followers_url":"https://api.github.com/users/yaronr/followers","following_url":"https://api.github.com/users/yaronr/following{/other_user}","gists_url":"https://api.github.com/users/yaronr/gists{/gist_id}","starred_url":"https://api.github.com/users/yaronr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yaronr/subscriptions","organizations_url":"https://api.github.com/users/yaronr/orgs","repos_url":"https://api.github.com/users/yaronr/repos","events_url":"https://api.github.com/users/yaronr/events{/privacy}","received_events_url":"https://api.github.com/users/yaronr/received_events","type":"User","site_admin":false},"created_at":"2014-12-16T07:09:07Z","updated_at":"2014-12-16T07:09:07Z","author_association":"NONE","body":"Hey @bleskes, thanks for the quick response.\nI've increased --discovery.zen.ping_timeout=15, let's see how that goes.\n\nBut implementation-wise, isn't discovery a continuous process? IMO, at any time another node of the same cluster is discovered (for whichever reason), that needs to be processed the same way.\n\nRegarding your suggestions:\nI am working on a multi-cloud cluster. I'm running ElasticSearch on top of Docker, on top of CoreOS, over a SDN. It's currently used for logs / metric aggregation and experimentation. I am setting --node.cluster.name=${CLUSTER_NAME} and --cluster.routing.allocation.awareness.attributes=cluster.name which seems to affect the shading (routing) exactly as I would expect. \n\nI have to say that I am VERY impressed with the resilience of ES, it is truly an example of a 'just works' implementation, hiding some very complex issues and handling them very well. The things I have done to it should have caused data loss and more - which never happened. \"no data was harmed during the making of this experiment\" :). I know that's very hard to do, so kudos.\n\nI have the following questions:\n1) Why is it not a good idea to have high-latency between sub-clusters (as per my described config) ?\n2) I read the 'why not use multicast' comment on your site, and although I understand and agree - in my case, 'everything is ephemeral' - hosts can come and go, services definitely - and their IPs may change at any time. I could employ some clever discovery mechanism, but multicast works great (except for the ping timeout thing)\n\nCheers,\nYaron\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67130034","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-67130034","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":67130034,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MTMwMDM0","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2014-12-16T09:03:02Z","updated_at":"2014-12-16T09:03:02Z","author_association":"MEMBER","body":"> But implementation-wise, isn't discovery a continuous process? IMO, at any time another node of the same cluster is discovered (for whichever reason), that needs to be processed the same way.\n\nIt works a bit differently. Every time a node needs to find the cluster or a new master in pings in search. Once it find the cluster or other nodes they elect a master if not there already and then all nodes join that master. From that point on, no discovery pinging is needed any more (we do have fault detection pings but those are different).\n\nSettings the ping timeout to 15s will slow down cluster forming and master (re) election. FYI.\n\n>  I know that's very hard to do, so kudos.\n\nThx :)\n\n> 1) Why is it not a good idea to have high-latency between sub-clusters (as per my described config) ?\n\nIn our experience the network between data centers (and certainly between providers) is not as stable as  the local one. Although a properly configured cluster should be resilient to this, it doesn't end up giving you a good experience as requests time out or the cluster becomes un available until it reforms (you saw a taste of it in your pinging process). \n\nI would recommend that you look at other alternatives, like setting up a cluster per cloud provider and use things like the tribe nodes to do cross cluster querying. \n\n> 2) I read the 'why not use multicast' comment on your site...hosts can come and go, services definitely \n\nWith multi cast there are less guarantees about delivery and at the moment less gossiping and knowledge sharing on the ES side as well. It is really meant for development environments where nodes can easily find each other. Regarding the nodes go and come remark - we have plugins for all the common cloud providers that use the prover APIs to tell you which nodes are out there and what to ping. Note that you don't need all the nodes to be listed but a few (typically the dedicated master nodes in big deployments). Not all of them need to be available all the time as well. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76510836","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-76510836","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":76510836,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NTEwODM2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-02-28T04:59:42Z","updated_at":"2015-02-28T04:59:42Z","author_association":"CONTRIBUTOR","body":"Sounds like this has been resolved, so closing. Feel free to reopen\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76763758","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-76763758","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":76763758,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzYzNzU4","user":{"login":"ajhalani","id":1163503,"node_id":"MDQ6VXNlcjExNjM1MDM=","avatar_url":"https://avatars3.githubusercontent.com/u/1163503?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhalani","html_url":"https://github.com/ajhalani","followers_url":"https://api.github.com/users/ajhalani/followers","following_url":"https://api.github.com/users/ajhalani/following{/other_user}","gists_url":"https://api.github.com/users/ajhalani/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhalani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhalani/subscriptions","organizations_url":"https://api.github.com/users/ajhalani/orgs","repos_url":"https://api.github.com/users/ajhalani/repos","events_url":"https://api.github.com/users/ajhalani/events{/privacy}","received_events_url":"https://api.github.com/users/ajhalani/received_events","type":"User","site_admin":false},"created_at":"2015-03-02T18:00:50Z","updated_at":"2015-03-02T18:01:00Z","author_association":"NONE","body":"Since upgrading to v1.3.7(few months ago) from v1.2.2, our master re-elect time has gone from few milliseconds to 3seconds pause, plus ~0.5 seconds.. \n\nDuring this time, we sometimes see failures in ES request on other machines than the master and get error - {\"error\":\"ClusterBlockException[blocked by: [SERVICE_UNAVAILABLE/2/no master];]\",\"status\":503}\n\nWe don't use multicast, but unicast. I think it's related to this ticket, but if not I will open a new issue. Thanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76828647","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-76828647","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":76828647,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODI4NjQ3","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-03-02T21:26:47Z","updated_at":"2015-03-02T21:26:47Z","author_association":"MEMBER","body":"@ajhalani this shouldn't be the behavior in 1.3.7 but is in 1.4.0 where we added a pinging round of 3s by default  - see http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-discovery-zen.html#master-election for more info. Can you double check your ES version?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76829120","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-76829120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":76829120,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODI5MTIw","user":{"login":"ajhalani","id":1163503,"node_id":"MDQ6VXNlcjExNjM1MDM=","avatar_url":"https://avatars3.githubusercontent.com/u/1163503?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhalani","html_url":"https://github.com/ajhalani","followers_url":"https://api.github.com/users/ajhalani/followers","following_url":"https://api.github.com/users/ajhalani/following{/other_user}","gists_url":"https://api.github.com/users/ajhalani/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhalani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhalani/subscriptions","organizations_url":"https://api.github.com/users/ajhalani/orgs","repos_url":"https://api.github.com/users/ajhalani/repos","events_url":"https://api.github.com/users/ajhalani/events{/privacy}","received_events_url":"https://api.github.com/users/ajhalani/received_events","type":"User","site_admin":false},"created_at":"2015-03-02T21:28:54Z","updated_at":"2015-03-02T21:29:53Z","author_association":"NONE","body":"You are right, it's v1.4.1.. I would love some guidance if I am misreading it as an issue, or if it's really an issue should I open a new ticket? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76829460","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-76829460","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":76829460,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODI5NDYw","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-03-02T21:30:35Z","updated_at":"2015-03-02T21:30:35Z","author_association":"MEMBER","body":"@ajhalani cool thx. If you have a timeout <~3s on the requests it will explain what you see. I suggest you  increase it a bit.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76831629","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-76831629","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":76831629,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODMxNjI5","user":{"login":"ajhalani","id":1163503,"node_id":"MDQ6VXNlcjExNjM1MDM=","avatar_url":"https://avatars3.githubusercontent.com/u/1163503?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhalani","html_url":"https://github.com/ajhalani","followers_url":"https://api.github.com/users/ajhalani/followers","following_url":"https://api.github.com/users/ajhalani/following{/other_user}","gists_url":"https://api.github.com/users/ajhalani/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhalani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhalani/subscriptions","organizations_url":"https://api.github.com/users/ajhalani/orgs","repos_url":"https://api.github.com/users/ajhalani/repos","events_url":"https://api.github.com/users/ajhalani/events{/privacy}","received_events_url":"https://api.github.com/users/ajhalani/received_events","type":"User","site_admin":false},"created_at":"2015-03-02T21:41:10Z","updated_at":"2015-03-02T21:45:09Z","author_association":"NONE","body":"Well the request (_bulk index) didn't timeout, it failed immediately. We don't set any timeout setting, using the default settings.. \n\nI feel the issue here is new version takes by default atleast 3 seconds to choose a new master (ping_interval \\* ping_retries), during which there is no master and write requests fail.. In our installation pre v1.4, it used to be much faster.. So seems like an issue to me, am I missing something? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76924368","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-76924368","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":76924368,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTI0MzY4","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-03-03T10:51:24Z","updated_at":"2015-03-03T10:51:24Z","author_association":"MEMBER","body":"@ajhalani write requests shouldn't fail but wait for the 3s to complete (read requests are not blocked). The default timeout is 1m, did you change it? I also suggest that page I referred to - it explains why added the 3s gossiping round.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76994932","html_url":"https://github.com/elastic/elasticsearch/issues/8953#issuecomment-76994932","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8953","id":76994932,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTk0OTMy","user":{"login":"ajhalani","id":1163503,"node_id":"MDQ6VXNlcjExNjM1MDM=","avatar_url":"https://avatars3.githubusercontent.com/u/1163503?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhalani","html_url":"https://github.com/ajhalani","followers_url":"https://api.github.com/users/ajhalani/followers","following_url":"https://api.github.com/users/ajhalani/following{/other_user}","gists_url":"https://api.github.com/users/ajhalani/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhalani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhalani/subscriptions","organizations_url":"https://api.github.com/users/ajhalani/orgs","repos_url":"https://api.github.com/users/ajhalani/repos","events_url":"https://api.github.com/users/ajhalani/events{/privacy}","received_events_url":"https://api.github.com/users/ajhalani/received_events","type":"User","site_admin":false},"created_at":"2015-03-03T17:41:19Z","updated_at":"2015-03-03T17:41:19Z","author_association":"NONE","body":"We didn't change the timeout. The indexing request didn't wait for timeout, so it looks like a timing issue \n\"Timeline\" - \n\n> [2015-02-25 04:03:31,926][DEBUG][transport.netty          ] [ny1.node] disconnecting from [[nj2.node][RGXiGOUIQYSkaGhPX1dDDg][nj2][inet[/10.126.159.169:9301]]{datacenter=nj, master=true}] due to explicit disconnect call\n> [2015-02-25 04:03:31,927][DEBUG][cluster.service          ] [ny1.node] processing [zen-disco-master_failed ([nj2.node][RGXiGOUIQYSkaGhPX1dDDg][nj2][inet[/10.126.159.169:9301]]{datacenter=nj, master=true})]: done applying updated cluster_state (version: 30470)\n> \n> > 25FEB2015_04:03:33.989 - index request is sent and fails in 1-2 ms(no timeout) with http status code 503, response: {\"error\":\"ClusterBlockException[blocked by: [SERVICE_UNAVAILABLE/2/no master];]\",\"status\":503}\n> \n> [2015-02-25 04:03:34,951][DEBUG][cluster.service          ] [ny1.node] processing [zen-disco-receive(join from node[[nj1.node][aTvj8H3bQhuWoNfXikr78Q][nj1][inet[/10.126.151.178:9301]]{datacenter=nj, master=true}])]: execute\n> [2015-02-25 04:03:34,951][DEBUG][cluster.service          ] [ny1.node] failing [zen-disco-receive(join from node[[nj1.node][aTvj8H3bQhuWoNfXikr78Q][nj1][inet[/10.126.151.178:9301]]{datacenter=nj, master=true}])]: local node is no longer master\n> [2015-02-25 04:03:34,952][DEBUG][cluster.service          ] [ny1.node] processing [zen-disco-join (elected_as_master)]: execute\n> [2015-02-25 04:03:35,594][DEBUG][cluster.service          ] [ny1.node] cluster state updated, version [30471], source [zen-disco-join (elected_as_master)]\n> [2015-02-25 04:03:35,594][INFO ][cluster.service          ] [ny1.node] new_master [ny1.node][PoLRwDtNTw2gEgV9Uz3cuA][ny1][inet[/10.126.23.55:9301]]{datacenter=ny, master=true}, reason: zen-disco-join (elected_as_master)\n\nI will create a separate thread for this, I feel like hijacking a closed thread.. \n","performed_via_github_app":null}]