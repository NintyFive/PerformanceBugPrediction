[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131261","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-384131261","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":384131261,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTI2MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-01-08T11:18:27Z","updated_at":"2018-04-25T01:25:21Z","author_association":"COLLABORATOR","body":"*Original comment by @tvernum:*\n\nI added a task for CI as well.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131264","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-384131264","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":384131264,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTI2NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-01-10T21:52:07Z","updated_at":"2018-04-25T01:25:22Z","author_association":"COLLABORATOR","body":"*Original comment by @jaymode:*\n\nI am not sure that we should promote a specific provider for FIPS compliance. We currently depend on bouncycastle for:\r\n\r\n* Certificate generation\r\n* Reading PEM files\r\n\r\nI'd like to see if we can remove our dependency on bouncycastle in the running of our plugin and limit our usage to CLI tools. There are a few reasons for this, but my main driver is to keep bouncy castle out of our codebase so the the bcfips provider can be installed by a user. Currently our use of bouncycastle results in jar hell with the bcfips jars.\r\n\r\nIn order to generate certificates, we will need to use bouncycastle as there is no Java API for doing so yet (LINK REDACTED). However for reading PEM files, we could look at other options.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131265","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-384131265","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":384131265,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTI2NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-02-02T16:39:09Z","updated_at":"2018-04-25T01:25:22Z","author_association":"COLLABORATOR","body":"*Original comment by @jkakavas:*\n\n>  We currently depend on bouncycastle for:\r\n     * Certificate generation\r\n     * Reading PEM files\r\n\r\nAnother thing we can't do AFAICT is read pem encoded password protected private key files, as we do almost transparently in \r\nLINK REDACTED\r\nwith BouncyCastle. An option would be to write the code to read  PKCS#8 encoded keys but I would lean towards using libraries as much as we can compared to \"rolling our own crypto\" ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131266","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-384131266","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":384131266,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTI2Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-02-02T22:08:22Z","updated_at":"2018-04-25T01:25:22Z","author_association":"COLLABORATOR","body":"*Original comment by @rjernst:*\n\nIoannis, can you expand on what the restriction is in FIPS which disallows\nus from reading pem encoded key files?\n\nOn Fri, Feb 2, 2018 at 9:48 AM Ioannis Kakavas EMAIL REDACTED\nwrote:\n\n> Another thing we can't do AFAICT is read pem encoded password protected\n> private key files, as we do almost transparently in\n>\n> LINK REDACTED\n> with BouncyCastle. An option would be to write the code to read PKCS#8\n> encoded keys but I would lean towards using libraries as much as we can\n> compared to \"rolling our own crypto\"\n>\n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <LINK REDACTED\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AARqhOlH_Gy7_fNVa6YEbBV4-sbWiX5jks5tQzougaJpZM4RWOFU>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131267","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-384131267","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":384131267,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTI2Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-02-03T08:27:14Z","updated_at":"2018-04-25T01:25:22Z","author_association":"COLLABORATOR","body":"*Original comment by @jkakavas:*\n\n> Ioannis, can you expand on what the restriction is in FIPS which disallows us from reading pem encoded key files?\r\n\r\nNone, probably I was not clear above. What I meant to say is that we can't read password protected ( that is to say encrypted) private keys stored in PEM format  _without_ using BouncyCastle, as we do now, or without reimplementing a large part of LINK REDACTED so that we can deal with PKCS#5 encrypted, PKCS#8 encoded ones.\r\n\r\nIt was meant as an addition to Jay's list as to what we currently depend on BC for. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131269","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-384131269","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":384131269,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTI2OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-02-07T23:18:08Z","updated_at":"2018-04-25T01:25:22Z","author_association":"COLLABORATOR","body":"*Original comment by @jaymode:*\n\nWe currently do not support PKCS#8 encoded PEM files, see this LINK REDACTED. The encrypted private keys that we support is fairly limited in scope:\r\n\r\n```java\r\n        if (parsed instanceof PEMEncryptedKeyPair) {\r\n            char[] keyPassword = passwordSupplier.get();\r\n            if (keyPassword == null) {\r\n                throw new IllegalArgumentException(\"cannot read encrypted key without a password\");\r\n            }\r\n            // we have an encrypted key pair so we need to decrypt it\r\n            PEMEncryptedKeyPair encryptedKeyPair = (PEMEncryptedKeyPair) parsed;\r\n            privateKeyInfo = encryptedKeyPair\r\n                    .decryptKeyPair(new JcePEMDecryptorProviderBuilder().setProvider(BC_PROV).build(keyPassword))\r\n                    .getPrivateKeyInfo();\r\n        } else if (parsed instanceof PEMKeyPair) {\r\n            privateKeyInfo = ((PEMKeyPair) parsed).getPrivateKeyInfo();\r\n        } else if (parsed instanceof PrivateKeyInfo) {\r\n            privateKeyInfo = (PrivateKeyInfo) parsed;\r\n        } else if (parsed instanceof ASN1ObjectIdentifier) {\r\n            // skip this object and recurse into this method again to read the next object\r\n            return innerReadPrivateKey(parser, passwordSupplier);\r\n        } else {\r\n            String msg = \"parsed an unsupported object [\" + parsed.getClass().getSimpleName() + \"]\";\r\n            if (parsed instanceof X509CertificateHolder || parsed instanceof X509TrustedCertificateBlock) {\r\n                msg = msg + \". Encountered a PEM Certificate while expecting a PEM Key.\";\r\n            }\r\n            throw new IllegalArgumentException(msg);\r\n        }\r\n```\r\n\r\n@jkakavas what do you think now that the scope of what we'd need to do is fairly contained?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131270","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-384131270","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":384131270,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTI3MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-02-08T15:19:12Z","updated_at":"2018-04-25T01:25:23Z","author_association":"COLLABORATOR","body":"*Original comment by @jkakavas:*\n\nWe do support PKCS#8 private keys, but we do not support PKCS#5 encrypted PKCS#8  private keys in PEM format. We also support PKCS#1 private keys, both PKCS#5 encrypted and not, again in PEM format.\r\n\r\nSo in summary our CertUtils needs to be able to read ( from PEM formatted files):\r\n* PKCS#8 private keys, unencrypted. ( Those start with `----- BEGIN PRIVATE KEY -----` ) \r\n* PKCS#1 (RSA) private keys unencrypted ( Those start with `----- BEGIN RSA PRIVATE KEY -----` )\r\n* PKCS#1 (RSA) private keys, PKCS#5 encrypted ( Those start with \r\n   ```\r\n   ----- BEGIN RSA PRIVATE KEY -----\r\n   Proc-Type: 4,ENCRYPTED\r\n   DEK-Info: <ALGORITHM>,<HEX ENCODED IV>\r\n   ```\r\n\r\nIt narrows the scope, I think the only one that would need extra implementation is the latter, parsing the algorithm and IV from the header. I'll get to it","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131272","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-384131272","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":384131272,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTI3Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-04T14:04:39Z","updated_at":"2018-04-25T01:25:23Z","author_association":"COLLABORATOR","body":"*Original comment by @jkakavas:*\n\nFYI BCFIPS 1.0.1. was recently certified : LINK REDACTED","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418187284","html_url":"https://github.com/elastic/elasticsearch/issues/29851#issuecomment-418187284","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29851","id":418187284,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODE4NzI4NA==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-09-03T20:16:12Z","updated_at":"2018-09-03T20:16:12Z","author_association":"CONTRIBUTOR","body":"Closing this as all subtasks have been concluded. ","performed_via_github_app":null}]