{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37551","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37551/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37551/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37551/events","html_url":"https://github.com/elastic/elasticsearch/issues/37551","id":399938277,"node_id":"MDU6SXNzdWUzOTk5MzgyNzc=","number":37551,"title":"A multi match `cross_fields` query omits field boosts if there is only one field in that group","user":{"login":"reupen","id":12693549,"node_id":"MDQ6VXNlcjEyNjkzNTQ5","avatar_url":"https://avatars1.githubusercontent.com/u/12693549?v=4","gravatar_id":"","url":"https://api.github.com/users/reupen","html_url":"https://github.com/reupen","followers_url":"https://api.github.com/users/reupen/followers","following_url":"https://api.github.com/users/reupen/following{/other_user}","gists_url":"https://api.github.com/users/reupen/gists{/gist_id}","starred_url":"https://api.github.com/users/reupen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reupen/subscriptions","organizations_url":"https://api.github.com/users/reupen/orgs","repos_url":"https://api.github.com/users/reupen/repos","events_url":"https://api.github.com/users/reupen/events{/privacy}","received_events_url":"https://api.github.com/users/reupen/received_events","type":"User","site_admin":false},"labels":[{"id":418189364,"node_id":"MDU6TGFiZWw0MTgxODkzNjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Ranking","name":":Search/Ranking","color":"0e8a16","default":false,"description":"Scoring, rescoring, rank evaluation."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-01-16T18:26:32Z","updated_at":"2019-01-18T11:05:15Z","closed_at":"2019-01-18T11:05:15Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): \r\n\r\n`Version: 6.5.4, Build: default/deb/d2ef93d/2018-12-17T21:17:40.758843Z, JVM: 1.8.0_191`\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): \r\n```\r\nopenjdk version \"1.8.0_191\"\r\nOpenJDK Runtime Environment (build 1.8.0_191-8u191-b12-0ubuntu0.18.04.1-b12)\r\nOpenJDK 64-Bit Server VM (build 25.191-b12, mixed mode)\r\n```\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\n`Linux xxx 4.15.0-43-generic #46-Ubuntu SMP Thu Dec 6 14:45:28 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux`\r\n\r\n**Description of the problem including expected versus actual behaviour**:\r\n\r\nA multi match `cross_fields` query omits field boosts if there is only one field in that analyser group.\r\n\r\n**Steps to reproduce**:\r\n\r\nSet up an index with a couple of documents:\r\n```\r\ncurl -XPUT \"localhost:9200/cross-fields-test?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"name\": {\r\n          \"type\": \"text\"\r\n        },\r\n        \"category\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"grouping\": {\r\n          \"type\": \"keyword\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n'\r\n\r\ncurl -XPUT \"localhost:9200/cross-fields-test/_doc/1?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"name\" : \"red red\",\r\n    \"category\" : \"blue\",\r\n    \"grouping\" : \"green\"\r\n}\r\n'\r\n\r\ncurl -XPUT \"localhost:9200/cross-fields-test/_doc/2?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"name\" : \"blue\",\r\n    \"category\" : \"red\",\r\n    \"grouping\" : \"green\"\r\n}\r\n'\r\n```\r\n\r\nWait for the index to be refreshed, and run these two queries:\r\n\r\n```\r\ncurl -XGET \"localhost:9200/cross-fields-test/_search?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"query\": {\r\n        \"multi_match\": {\r\n            \"query\": \"red\",\r\n            \"fields\" : [\"name\", \"category^100\"],\r\n            \"type\": \"cross_fields\",\r\n            \"operator\": \"and\"\r\n        }\r\n    }\r\n}\r\n'\r\n\r\n\r\ncurl -XGET \"localhost:9200/cross-fields-test/_search?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"query\": {\r\n        \"multi_match\": {\r\n            \"query\": \"red\",\r\n            \"fields\" : [\"name\", \"grouping\", \"category^100\"],\r\n            \"type\": \"cross_fields\",\r\n            \"operator\": \"and\"\r\n        }\r\n    }\r\n}\r\n'\r\n```\r\n\r\n\r\nIn the first case, the result is similar to the following:\r\n\r\n```json\r\n{\r\n  \"took\" : 9,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"skipped\" : 0,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 2,\r\n    \"max_score\" : 0.39556286,\r\n    \"hits\" : [\r\n      {\r\n        \"_index\" : \"cross-fields-test\",\r\n        \"_type\" : \"_doc\",\r\n        \"_id\" : \"1\",\r\n        \"_score\" : 0.39556286,\r\n        \"_source\" : {\r\n          \"name\" : \"red red\",\r\n          \"category\" : \"blue\",\r\n          \"grouping\" : \"green\"\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"cross-fields-test\",\r\n        \"_type\" : \"_doc\",\r\n        \"_id\" : \"2\",\r\n        \"_score\" : 0.2876821,\r\n        \"_source\" : {\r\n          \"name\" : \"blue\",\r\n          \"category\" : \"red\",\r\n          \"grouping\" : \"green\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nAnd in the second case:\r\n\r\n```json\r\n{\r\n  \"took\" : 1,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"skipped\" : 0,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 2,\r\n    \"max_score\" : 28.76821,\r\n    \"hits\" : [\r\n      {\r\n        \"_index\" : \"cross-fields-test\",\r\n        \"_type\" : \"_doc\",\r\n        \"_id\" : \"2\",\r\n        \"_score\" : 28.76821,\r\n        \"_source\" : {\r\n          \"name\" : \"blue\",\r\n          \"category\" : \"red\",\r\n          \"grouping\" : \"green\"\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"cross-fields-test\",\r\n        \"_type\" : \"_doc\",\r\n        \"_id\" : \"1\",\r\n        \"_score\" : 0.39556286,\r\n        \"_source\" : {\r\n          \"name\" : \"red red\",\r\n          \"category\" : \"blue\",\r\n          \"grouping\" : \"green\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nAdding a second keyword field (which does not contain the search term) has changed the scores significantly and the second document is now ranked higher (as was desired). Adding `&explain=true` to the URL in first query appears to confirm that the boost is ignored in that case.\r\n\r\nPerhaps there is some rationale in that there is only one field in the group? However, as you can see, the boost would still have an effect on the order of the results.","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}