{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21033","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21033/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21033/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21033/events","html_url":"https://github.com/elastic/elasticsearch/issues/21033","id":184127799,"node_id":"MDU6SXNzdWUxODQxMjc3OTk=","number":21033,"title":"Reindex from remote can break mappings","user":{"login":"aleph-zero","id":452273,"node_id":"MDQ6VXNlcjQ1MjI3Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/452273?v=4","gravatar_id":"","url":"https://api.github.com/users/aleph-zero","html_url":"https://github.com/aleph-zero","followers_url":"https://api.github.com/users/aleph-zero/followers","following_url":"https://api.github.com/users/aleph-zero/following{/other_user}","gists_url":"https://api.github.com/users/aleph-zero/gists{/gist_id}","starred_url":"https://api.github.com/users/aleph-zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aleph-zero/subscriptions","organizations_url":"https://api.github.com/users/aleph-zero/orgs","repos_url":"https://api.github.com/users/aleph-zero/repos","events_url":"https://api.github.com/users/aleph-zero/events{/privacy}","received_events_url":"https://api.github.com/users/aleph-zero/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-10-20T03:39:01Z","updated_at":"2018-02-13T19:42:43Z","closed_at":"2016-10-20T12:57:31Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version**:\n2.4 and 5.0-RC1\n\n**Plugins installed**: []\nOn 2.4 cluster:\n\n```\ntiebreaker-0000000082 analysis-icu         2.4.1                j  \ntiebreaker-0000000082 analysis-kuromoji    2.4.1                j  \ntiebreaker-0000000082 analysis-smartcn     2.4.1                j  \ntiebreaker-0000000082 cloud-aws            2.4.1                j  \ntiebreaker-0000000082 found-elasticsearch  1.2.23-2.4.1-c67dc32 j  \ntiebreaker-0000000082 found-license-plugin 2.4.1                j  \ntiebreaker-0000000082 graph                2.4.1                j  \ntiebreaker-0000000082 marvel-agent         2.4.1                j  \ntiebreaker-0000000082 shield               2.4.1                j  \ntiebreaker-0000000082 watcher              2.4.1                j  \ninstance-0000000086   analysis-icu         2.4.1                j  \ninstance-0000000086   analysis-kuromoji    2.4.1                j  \ninstance-0000000086   analysis-smartcn     2.4.1                j  \ninstance-0000000086   cloud-aws            2.4.1                j  \ninstance-0000000086   found-elasticsearch  1.2.23-2.4.1-c67dc32 j  \ninstance-0000000086   found-license-plugin 2.4.1                j  \ninstance-0000000086   graph                2.4.1                j  \ninstance-0000000086   marvel-agent         2.4.1                j  \ninstance-0000000086   shield               2.4.1                j  \ninstance-0000000086   watcher              2.4.1                j  \ninstance-0000000083   analysis-icu         2.4.1                j  \ninstance-0000000083   analysis-kuromoji    2.4.1                j  \ninstance-0000000083   analysis-smartcn     2.4.1                j  \ninstance-0000000083   cloud-aws            2.4.1                j  \ninstance-0000000083   found-elasticsearch  1.2.23-2.4.1-c67dc32 j  \ninstance-0000000083   found-license-plugin 2.4.1                j  \ninstance-0000000083   graph                2.4.1                j  \ninstance-0000000083   marvel-agent         2.4.1                j  \ninstance-0000000083   shield               2.4.1                j  \ninstance-0000000083   watcher              2.4.1                j  \n```\n\nOn 5.0-RC1 cluster:\n\n```\ntiebreaker-0000000003 found-elasticsearch 5.0.0-rc1\ntiebreaker-0000000003 repository-s3       5.0.0-rc1\ntiebreaker-0000000003 x-pack              5.0.0-rc1\ninstance-0000000005   found-elasticsearch 5.0.0-rc1\ninstance-0000000005   repository-s3       5.0.0-rc1\ninstance-0000000005   x-pack              5.0.0-rc1\ninstance-0000000004   found-elasticsearch 5.0.0-rc1\ninstance-0000000004   repository-s3       5.0.0-rc1\ninstance-0000000004   x-pack              5.0.0-rc1\n```\n\n**JVM version**:\nUnknown. Both clusters are running on Elastic Cloud.\n\n**OS version**:\nUnknown. Both clusters are running on Elastic Cloud.\n\n**Description of the problem including expected versus actual behavior**:\nWhen reindexing from a remote 2.4 cluster on to a new 5.0-RC1 cluster, some field mappings were incorrectly set on the new index. Specifically, I noticed that a field of type `geo_point` was created as type `text` on the new index on the 5.0-RC1 cluster.\n\nLook at the **location** field on the mappings.\n\nIndex mapping on 2.4:\n\n```\n{\n  \"ncedc-earthquakes\": {\n    \"mappings\": {\n      \"earthquake\": {\n        \"properties\": {\n          \"@timestamp\": {\n            \"type\": \"date\",\n            \"format\": \"strict_date_optional_time||epoch_millis\"\n          },\n          \"@version\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"depth\": {\n            \"type\": \"double\"\n          },\n          \"dmin\": {\n            \"type\": \"double\"\n          },\n          \"event_id\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"gap\": {\n            \"type\": \"double\"\n          },\n          \"host\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"location\": {\n            \"type\": \"geo_point\"\n          },\n          \"mag\": {\n            \"type\": \"double\"\n          },\n          \"magType\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"message\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"nst\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"rms\": {\n            \"type\": \"double\"\n          },\n          \"source\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"tags\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"timestamp\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          },\n          \"type\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nIndex mapping on 5.0-RC1 (automatically created during reindex-from-remote):\n\n```\n{\n  \"ncedc-earthquakes\": {\n    \"mappings\": {\n      \"earthquake\": {\n        \"properties\": {\n          \"@timestamp\": {\n            \"type\": \"date\"\n          },\n          \"@version\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"depth\": {\n            \"type\": \"float\"\n          },\n          \"dmin\": {\n            \"type\": \"float\"\n          },\n          \"event_id\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"gap\": {\n            \"type\": \"float\"\n          },\n          \"host\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"location\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"mag\": {\n            \"type\": \"float\"\n          },\n          \"magType\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"message\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"nst\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"rms\": {\n            \"type\": \"float\"\n          },\n          \"source\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"tags\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"timestamp\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"type\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n**Steps to reproduce**:\n1. Create an index with a `geo_point` field in a 2.4 cluster.\n2. Reindex from the 2.4 cluster into the 5.0-RC1 cluster.\n3. Look at the mappings for the `geo_point` field.\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}