{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14413","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14413/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14413/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14413/events","html_url":"https://github.com/elastic/elasticsearch/issues/14413","id":114399536,"node_id":"MDU6SXNzdWUxMTQzOTk1MzY=","number":14413,"title":"Deduplicate search sections parsing code","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-10-31T09:10:42Z","updated_at":"2018-02-14T13:41:21Z","closed_at":"2016-09-08T08:50:53Z","author_association":"MEMBER","active_lock_reason":null,"body":"When we moved query parsing on the coordinating node (see #10217), we added a new `SearchSourceBuilder#fromXContent` method that given an `XContentParser` and the current `QueryParseContext` parses and creates a new `SearchSourceBuilder` object. The parse code ends up duplicating what we already have in our `SearchParseElement` classes. We made a choice not to refactor these initially as they depend on `SearchContext` and there are still apis that use them to parse lucene queries straight-away and set them to the search context rather than going through our intermediate query representation.\n\nThis solution can only be temporary though, as we are currently duplicating parsing code. What we should do ideally instead, is move over parsing code to the new solution (either `SearchSourceBuilder#fromXContent` or an updated version of `SearchParseElement` that doesn't depend on `SearchContext`) and get rid of the previous parsing code. I realize how this becomes hard to do given that we have not moved yet all of the search sections over. Maybe we should wait till the search refactoring is completed, but after that  we should clean this up and have only one way to parse search sections, with code in one single place, otherwise it becomes hard to understand how each api parses search sections.\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}