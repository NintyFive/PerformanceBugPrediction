[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272131297","html_url":"https://github.com/elastic/elasticsearch/issues/18551#issuecomment-272131297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18551","id":272131297,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjEzMTI5Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T10:42:59Z","updated_at":"2017-01-12T10:42:59Z","author_association":"CONTRIBUTOR","body":"@abeyad is this still valid?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272175273","html_url":"https://github.com/elastic/elasticsearch/issues/18551#issuecomment-272175273","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18551","id":272175273,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjE3NTI3Mw==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T14:23:01Z","updated_at":"2017-01-12T14:23:01Z","author_association":"CONTRIBUTOR","body":"The `deleteSnapshot` call is now safe (https://github.com/elastic/elasticsearch/pull/22313), but we still have potential issues with getting snapshots and snapshot status as outlined above.  I believe we can solve the issue of create snapshots temporarily creating a duplicate entry in the cluster state by maintaining some internal data structures on the master node containing the current snapshots, and that list is updated in a synchronized manner.  During master failover, the new master will populate its own internal data structures with the snapshot info.  This will be tricky to get right with various edge cases, but its an option for solving this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/513465441","html_url":"https://github.com/elastic/elasticsearch/issues/18551#issuecomment-513465441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18551","id":513465441,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMzQ2NTQ0MQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-07-20T12:57:38Z","updated_at":"2019-07-20T12:57:38Z","author_association":"MEMBER","body":"This is not an issue anymore for creating snapshots either now. We look into the repository's `index-${N}` blob before submitting any task to create a snapshot now. If we have two concurrently arriving requests only one will succeed in updating the cluster state and only after getting added to the cluster state will anything be written to the repository.\r\nAll the various efforts that eventually resulted in `org.elasticsearch.snapshots.SnapshotResiliencyTests` (and it passing) got us here -> closing.","performed_via_github_app":null}]