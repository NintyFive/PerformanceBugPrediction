{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/62207","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62207/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62207/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62207/events","html_url":"https://github.com/elastic/elasticsearch/issues/62207","id":697715048,"node_id":"MDU6SXNzdWU2OTc3MTUwNDg=","number":62207,"title":"Range query with date_time field does not parse \"lte\" correctly","user":{"login":"go-ive","id":5303199,"node_id":"MDQ6VXNlcjUzMDMxOTk=","avatar_url":"https://avatars0.githubusercontent.com/u/5303199?v=4","gravatar_id":"","url":"https://api.github.com/users/go-ive","html_url":"https://github.com/go-ive","followers_url":"https://api.github.com/users/go-ive/followers","following_url":"https://api.github.com/users/go-ive/following{/other_user}","gists_url":"https://api.github.com/users/go-ive/gists{/gist_id}","starred_url":"https://api.github.com/users/go-ive/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/go-ive/subscriptions","organizations_url":"https://api.github.com/users/go-ive/orgs","repos_url":"https://api.github.com/users/go-ive/repos","events_url":"https://api.github.com/users/go-ive/events{/privacy}","received_events_url":"https://api.github.com/users/go-ive/received_events","type":"User","site_admin":false},"labels":[{"id":1142254209,"node_id":"MDU6TGFiZWwxMTQyMjU0MjA5","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Features","name":":Core/Features/Features","color":"0e8a16","default":false,"description":"A catch-all label for :Core/Features that don't fit in any other bucket."},{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"},{"id":1967498216,"node_id":"MDU6TGFiZWwxOTY3NDk4MjE2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Search","name":"Team:Search","color":"fef2c0","default":false,"description":"Meta label for search team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-09-10T10:07:19Z","updated_at":"2020-09-18T08:54:49Z","closed_at":"2020-09-18T08:54:49Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.9.1\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): openjdk 14.0.1 2020-04-14\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux elasticsearch-0 4.19.76-linuxkit #1 SMP Tue May 26 11:42:35 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nExecuting a range query against an index with a field of type \"date\" and format \"date_time\" behaves inconsistently with certain date formats.\r\n\r\nThe format 2020-09-01T00:00:00.000+0200 works for \"gte\", but not for \"lte\". Changing the timezone to Z or +/-02:00 (including colon) works for both.\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Create an index:\r\n```\r\nPUT myindex\r\n{\r\n  \"mappings\": {\r\n    \"_source\": {\r\n      \"enabled\": true\r\n    },\r\n    \"dynamic\": \"strict\",\r\n    \"properties\": {\r\n      \"@type\": {\r\n        \"type\": \"keyword\",\r\n        \"index\": \"false\"\r\n      },\r\n      \"@version\": {\r\n        \"type\": \"integer\",\r\n        \"index\": \"false\"\r\n      },\r\n      \"creationDate\": {\r\n        \"type\": \"date\",\r\n        \"format\": \"date_time\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n2. Run query\r\n```\r\n{\r\n  \"query\": {\r\n    \"range\": {\r\n      \"creationDate\": {\r\n        \"gte\": \"2020-09-01T00:00:00.000+0200\",\r\n        \"lte\": \"2020-09-30T23:59:59.000+0200\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nResult:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"parse_exception\",\r\n        \"reason\": \"failed to parse date field [2020-09-30T23:59:59.000+0200] with format [date_time]: [failed to parse date field [2020-09-30T23:59:59.000+0200] with format [date_time]]\"\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"range_problem\",\r\n        \"node\": \"45sllSW0SEmR7iErUZGpOg\",\r\n        \"reason\": {\r\n          \"type\": \"parse_exception\",\r\n          \"reason\": \"failed to parse date field [2020-09-30T23:59:59.000+0200] with format [date_time]: [failed to parse date field [2020-09-30T23:59:59.000+0200] with format [date_time]]\",\r\n          \"caused_by\": {\r\n            \"type\": \"illegal_argument_exception\",\r\n            \"reason\": \"failed to parse date field [2020-09-30T23:59:59.000+0200] with format [date_time]\",\r\n            \"caused_by\": {\r\n              \"type\": \"date_time_parse_exception\",\r\n              \"reason\": \"Text '2020-09-30T23:59:59.000+0200' could not be parsed at index 23\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"status\": 400\r\n}\r\n```","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}