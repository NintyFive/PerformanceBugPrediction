{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19124","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19124/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19124/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19124/events","html_url":"https://github.com/elastic/elasticsearch/issues/19124","id":162680479,"node_id":"MDU6SXNzdWUxNjI2ODA0Nzk=","number":19124,"title":"Valid IPs giving \"not a valid ip address\" error","user":{"login":"esamudio","id":6547184,"node_id":"MDQ6VXNlcjY1NDcxODQ=","avatar_url":"https://avatars0.githubusercontent.com/u/6547184?v=4","gravatar_id":"","url":"https://api.github.com/users/esamudio","html_url":"https://github.com/esamudio","followers_url":"https://api.github.com/users/esamudio/followers","following_url":"https://api.github.com/users/esamudio/following{/other_user}","gists_url":"https://api.github.com/users/esamudio/gists{/gist_id}","starred_url":"https://api.github.com/users/esamudio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/esamudio/subscriptions","organizations_url":"https://api.github.com/users/esamudio/orgs","repos_url":"https://api.github.com/users/esamudio/repos","events_url":"https://api.github.com/users/esamudio/events{/privacy}","received_events_url":"https://api.github.com/users/esamudio/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-06-28T13:03:04Z","updated_at":"2016-06-28T15:30:02Z","closed_at":"2016-06-28T15:28:13Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**:  2.3.3\n\n**JVM version**: 1.8.0_91\n\n**OS version**: Ubuntu 14.04\n\n**Description of the problem including expected versus actual behavior**:\n\n@jpountz I think I might have found a problem as a result of the quick fix from [issue #18740](https://github.com/elastic/elasticsearch/issues/18740). It doesn't give me the \"Mixing up field types\" error anymore but it tells me that the IPs are not valid:\n\n**Provide logs (if relevant)**:\n`source[{\"@version\":\"1\",\"@timestamp\":\"2016-06-27T21:16:52.085Z\",\"domain_name\":\"2667500489.MARS.ORDERBOX-DNS.COM.\",\"type\":\"A\",\"ip_address\":\"162.251.82.124,162.251.82.125,162.251.82.252,162.251.82.253\",\"domain_name_exact\":\"2667500489.MARS.ORDERBOX-DNS.COM.\",\"domain_name_length\":33,\"ip_address_exact\":\"162.251.82.124,162.251.82.125,162.251.82.252,162.251.82.253\",\"domain_name_segmented\":[\"2667500489mars\",\"order\",\"box\",\"dns\"],\"last_registered\":\"2016-05-01T10:00:00.000-0500\"}]} MapperParsingException[failed to parse [ip_address]]; nested: IllegalArgumentException[failed to parse ip [162.251.82.124,162.251.82.125,162.251.82.252,162.251.82.253], not a valid ip address]; at org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:329) at org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:309) at org.elasticsearch.index.mapper.DocumentParser.parseValue(DocumentParser.java:436) at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:262) at org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:122) at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:309) at org.elasticsearch.index.shard.IndexShard.prepareIndex(IndexShard.java:580) at org.elasticsearch.index.shard.IndexShard.prepareIndexOnPrimary(IndexShard.java:559) at org.elasticsearch.action.index.TransportIndexAction.prepareIndexOperationOnPrimary(TransportIndexAction.java:212) at org.elasticsearch.action.index.TransportIndexAction.executeIndexRequestOnPrimary(TransportIndexAction.java:224) at org.elasticsearch.action.bulk.TransportShardBulkAction.shardIndexOperation(TransportShardBulkAction.java:326) at org.elasticsearch.action.bulk.TransportShardBulkAction.shardUpdateOperation(TransportShardBulkAction.java:389) at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:191) at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:68) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.doRun(TransportReplicationAction.java:639) at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:279) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:271) at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75) at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376) at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.Thread.run(Thread.java:745) Caused by: java.lang.IllegalArgumentException: failed to parse ip [162.251.82.124,162.251.82.125,162.251.82.252,162.251.82.253], not a valid ip address at org.elasticsearch.index.mapper.ip.IpFieldMapper.ipToLong(IpFieldMapper.java:84) at org.elasticsearch.index.mapper.ip.IpFieldMapper.innerParseCreateField(IpFieldMapper.java:351) at org.elasticsearch.index.mapper.core.NumberFieldMapper.parseCreateField(NumberFieldMapper.java:241) at org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:321) ... 23 more\n`\nHere's the mapping:\n\n```\n{\n    \"settings\": {\n        \"number_of_shards\": {{ num_shards }},\n        \"number_of_replicas\": 2,\n        \"index\":{\n            \"analysis\":{\n               \"analyzer\":{\n                  \"keylower\":{\n                     \"tokenizer\":\"keyword\",\n                     \"filter\":\"lowercase\"\n                  }\n               }\n            }\n        }\n    },\n    \"mappings\": {\n        \"_default_\": {\n            \"properties\": {\n                \"ip_address\":{\n                    \"type\":\"ip\"\n                }\n            }\n        },\n        \"NS\": {\n            \"properties\": {\n                \"domain_name\": {\n                    \"type\": \"string\",\n                    \"index\": \"analyzed\",\n                    \"analyzer\":\"keylower\"\n                },\n                \"domain_name_exact\": {\n                    \"type\": \"string\",\n                    \"index\":\"not_analyzed\"\n                },\n                \"domain_name_length\": {\n                    \"type\": \"integer\"\n                },\n                \"type\": {\n                    \"type\": \"string\",\n                    \"index\": \"not_analyzed\"\n                },\n                \"is_registered\": {\n                    \"type\": \"boolean\"\n                },\n                \"last_registered\": {\n                    \"type\":   \"date\"\n                },\n                \"last_deregistered\": {\n                    \"type\":   \"date\"\n                },\n                \"registered_history\": {\n                    \"type\":   \"date\"\n                },\n                \"deregistered_history\": {\n                    \"type\":   \"date\"\n                },\n                \"name_servers\": {\n                    \"type\": \"string\",\n                    \"index\": \"analyzed\"\n                },\n                \"name_servers_exact\": {\n                    \"type\": \"string\",\n                    \"index\":\"not_analyzed\"\n                },\n                \"past_name_servers\": {\n                    \"type\": \"string\",\n                    \"index\": \"analyzed\"\n                },\n                \"past_name_servers_exact\": {\n                    \"type\": \"string\",\n                    \"index\":\"not_analyzed\"\n                },\n                \"domain_name_segmented\": {\n                    \"type\": \"string\",\n                    \"index\": \"not_analyzed\"\n                },\n                \"domain_name_exact_pronounceability\": {\n                    \"type\": \"integer\"\n                },\n                \"domain_name_segmented_pronounceability\": {\n                    \"type\": \"integer\"\n                }\n            }\n        },\n        \"A\": {\n            \"properties\": {\n                \"domain_name\": {\n                    \"type\": \"string\",\n                    \"index\": \"analyzed\",\n                    \"analyzer\":\"keylower\"\n                },\n                \"domain_name_exact\": {\n                    \"type\": \"string\",\n                    \"index\":\"not_analyzed\"\n                },\n                \"domain_name_length\": {\n                    \"type\": \"integer\"\n                },\n                \"type\": {\n                    \"type\": \"string\",\n                    \"index\": \"not_analyzed\"\n                },\n                \"ip_address\": {\n                    \"type\": \"ip\"\n                },\n                \"ip_address_exact\": {\n                    \"type\": \"string\",\n                    \"index\": \"not_analyzed\"\n                }\n            }\n        }\n    }\n}\n```\n\nI'm not sure if this is unrelated but I've exhausted the docs and discussion at this point. I'm dealing with 20 shards(also 20 nodes), 2 replicas, 16GB of ram(8GB to heap), mlockall set to true, ran \"sudo swapoff -a\" on all the machines and still have problems with the GB not doing its job and nodes becoming unresponsive. Looking at the logs, I was getting errors like the one above before the GC warnings appeared, can they be related?\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}