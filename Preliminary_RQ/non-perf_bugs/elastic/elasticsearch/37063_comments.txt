[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/450781682","html_url":"https://github.com/elastic/elasticsearch/issues/37063#issuecomment-450781682","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37063","id":450781682,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDc4MTY4Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-01-02T03:28:39Z","updated_at":"2019-01-02T03:28:39Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/450785512","html_url":"https://github.com/elastic/elasticsearch/issues/37063#issuecomment-450785512","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37063","id":450785512,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDc4NTUxMg==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-01-02T04:27:40Z","updated_at":"2019-01-02T04:27:40Z","author_association":"CONTRIBUTOR","body":"Another failure.\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=fedora/155/consoleFull\r\n```\r\n./gradlew :x-pack:plugin:security:unitTest -Dtests.seed=A48F36938E17E1F2 \\\r\n-Dtests.class=org.elasticsearch.xpack.security.authc.TokenAuthIntegTests \\\r\n-Dtests.method=\"testExpiredTokensDeletedAfterExpiration\" \\\r\n-Dtests.security.manager=true -Dtests.locale=da -Dtests.timezone=Africa/Lome -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n\r\nIn this case it seems to be caused by scenario 1, but it doesn't reproduce.\r\n\r\n```\r\n02:29:56 FAILURE 36.0s J7 | TokenAuthIntegTests.testExpiredTokensDeletedAfterExpiration <<< FAILURES!\r\n02:29:56    > Throwable #1: java.lang.AssertionError: \r\n02:29:56    > Expected: <0L>\r\n02:29:56    >      but: was <1L>\r\n02:29:56    > \tat __randomizedtesting.SeedInfo.seed([A48F36938E17E1F2:A5AE228AB551AEE3]:0)\r\n02:29:56    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n02:29:56    > \tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:189)\r\n02:29:56    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:847)\r\n02:29:56    > \tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.testExpiredTokensDeletedAfterExpiration(TokenAuthIntegTests.java:171)\r\n02:29:56    > \tat java.lang.Thread.run(Thread.java:748)\r\n02:29:56    > \tSuppressed: org.junit.ComparisonFailure: expected:<[token malformed]> but was:<[invalid_grant]>\r\n02:29:56    > \t\tat \r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/450812604","html_url":"https://github.com/elastic/elasticsearch/issues/37063#issuecomment-450812604","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37063","id":450812604,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDgxMjYwNA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-01-02T08:59:33Z","updated_at":"2019-01-02T08:59:33Z","author_association":"CONTRIBUTOR","body":"And again. I'm going to mute this.\r\n@jkakavas Can you have a look, I guess something in #36893 or #36766 made this fragile.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/450997496","html_url":"https://github.com/elastic/elasticsearch/issues/37063#issuecomment-450997496","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37063","id":450997496,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk5NzQ5Ng==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2019-01-02T21:55:35Z","updated_at":"2019-01-02T21:55:35Z","author_association":"CONTRIBUTOR","body":"I got it to reproduce \"consistently\" (after 4-8 consecutive runs with `-Dtest.iters`). My initial thinking was that the issue is a race condition in the test and that the delete by query at https://github.com/elastic/elasticsearch/blob/265fdce312fbe8301d7f563eeaf9c0b8da6bfd61/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/ExpiredTokenRemover.java#L65\r\n\r\ndoesn't get executed before the subsequent search request in the test at \r\nhttps://github.com/elastic/elasticsearch/blob/0cae979dfe14274e3d9a277a7ad20872f3c29d26/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java#L152\r\n\r\nbut that would be taken care of by the retries in the assertBusy block. It turns out that the issue is with \r\n\r\nhttps://github.com/elastic/elasticsearch/blob/0cae979dfe14274e3d9a277a7ad20872f3c29d26/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/TokenService.java#L1076\r\n\r\nand the fact that we submit an invalidation request also a little further up on the same test. This has the effect that the two invalidation requests are executed with ~1s interval and as the `deleteInterval` is set to 1s, this fails often. (The ones that pass, pass because the second invalidation request happens to be executed after 1001 to 1200 milliseconds )\r\n\r\nThis manifests now as we removed the bwc invalidation logic and this made the invalidation duration much shorter\r\n\r\nWhat doesn't fit with this theory is the \r\n```\r\nSuppressed: org.junit.ComparisonFailure: expected:<[token malformed]> but was:<[invalid_grant]>\r\n```\r\n\r\nthat was seen in CI as the only way to get an `invalid_grant` Exception during invalidation of a specific token is to attempt and invalidate a token that doesn't exist or hit the max attempt counter\r\n\r\n> Setting it back 36 hours would be more reliable. \r\n\r\nI adjusted this and it didn't make a difference but this is a very good suggestion regardless of the issue at hand.\r\n\r\nI adjusted the `deleteInterval` to 200 ms for these tests so that we don't encounter this anymore","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467802866","html_url":"https://github.com/elastic/elasticsearch/issues/37063#issuecomment-467802866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37063","id":467802866,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzgwMjg2Ng==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T10:08:35Z","updated_at":"2019-02-27T11:10:59Z","author_association":"MEMBER","body":"This test failed on `6.7` today:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.7+multijob-unix-compatibility/os=oraclelinux-6/42/consoleFull\r\n\r\n\r\n<details>\r\n\r\n(edited by @jkakavas to add formatting)\r\n\r\n```\r\njava.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\tat __randomizedtesting.SeedInfo.seed([6E90AD157E24A0E8:6FB1B90C4562EFF9]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:858)\r\n\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.testExpiredTokensDeletedAfterExpiration(TokenAuthIntegTests.java:176)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1750)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:938)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:974)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:988)\r\n\tat org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:947)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:832)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:883)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:894)\r\n\tat org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\tSuppressed: org.junit.ComparisonFailure: expected:<[token malformed]> but was:<[invalid_grant]>\r\n\t\tat org.junit.Assert.assertEquals(Assert.java:115)\r\n\t\tat org.junit.Assert.assertEquals(Assert.java:144)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:185)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <0L>\r\n     but: was <1L>\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.security.authc.TokenAuthIntegTests.lambda$testExpiredTokensDeletedAfterExpiration$1(TokenAuthIntegTests.java:195)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 40 more\r\n```\r\n\r\n</details>\r\n\r\n\r\nI'm reopening this issue to raise your attention @jkakavas (maybe just a fix to backport?) since I muted the test on 6.7 in 00022032f6ccdeb500ad11669c718db54726dffb","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467828258","html_url":"https://github.com/elastic/elasticsearch/issues/37063#issuecomment-467828258","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37063","id":467828258,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzgyODI1OA==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T11:32:48Z","updated_at":"2019-02-27T11:32:48Z","author_association":"CONTRIBUTOR","body":"Resolved in c7a193f925338435d4d334798845e49ae147e85c by backporting the fix, thanks @tlrx  !","performed_via_github_app":null}]