{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1799","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1799/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1799/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1799/events","html_url":"https://github.com/elastic/elasticsearch/issues/1799","id":3745282,"node_id":"MDU6SXNzdWUzNzQ1Mjgy","number":1799,"title":"Nodes give up trying to discover another node after 3x30s and never try again","user":{"login":"avar","id":45301,"node_id":"MDQ6VXNlcjQ1MzAx","avatar_url":"https://avatars3.githubusercontent.com/u/45301?v=4","gravatar_id":"","url":"https://api.github.com/users/avar","html_url":"https://github.com/avar","followers_url":"https://api.github.com/users/avar/followers","following_url":"https://api.github.com/users/avar/following{/other_user}","gists_url":"https://api.github.com/users/avar/gists{/gist_id}","starred_url":"https://api.github.com/users/avar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avar/subscriptions","organizations_url":"https://api.github.com/users/avar/orgs","repos_url":"https://api.github.com/users/avar/repos","events_url":"https://api.github.com/users/avar/events{/privacy}","received_events_url":"https://api.github.com/users/avar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2012-03-21T13:20:16Z","updated_at":"2014-07-08T14:31:14Z","closed_at":"2014-07-08T14:31:14Z","author_association":"NONE","active_lock_reason":null,"body":"Yesterday we had some network upgrades which made 1/3 of our nodes unavailable for some time. We're using unicast discovery with a manual host list on 0.18.7.\n\nI think if a node can't discover its peer nodes it should try them again periodically to re-establish contact with the rest of the cluster, as-is it seems that if the network is having problems for 3x30s the cluster might split completely without any attempt to re-establish itself.\n\nHere's the relevant logs from the node that got disconnected from the rest:\n\n```\n$ zgrep removed /var/log/elasticsearch/elasticsearch.log-20120320.gz\n[2012-03-19 15:31:46,039][INFO ][cluster.service          ] [dc01search-02] removed {[dc01search-03][i_Dqb2XLRi-CqqZgOIpSdA][inet[/10.149.206.44:9300]],}, reason: zen-disco-node_failed([dc01search-03][i_Dqb2XLRi-CqqZgOIpSdA][inet[/10.149.206.44:9300]]), reason failed to ping, tried [3] times, each with maximum [30s] timeout\n[2012-03-19 15:31:46,451][INFO ][cluster.service          ] [dc01search-02] removed {[dc01search-01][SGsefxoKSX2EdFYS2cku_w][inet[/10.149.206.41:9300]],}, reason: zen-disco-node_failed([dc01search-01][SGsefxoKSX2EdFYS2cku_w][inet[/10.149.206.41:9300]]), reason failed to ping, tried [3] times, each with maximum [30s] timeout\n```\n\nAnd here's logs from one of the other nodes:\n\n```\n$ zcat /var/log/elasticsearch/elasticsearch.log-20120320.gz\n[2012-03-19 15:31:46,038][INFO ][discovery.zen            ] [dc01search-03] master_left [[dc01search-02][drJcyXbfSr687MW4PSN7Fg][inet[/10.149.208.42:9300]]], reason [failed to ping, tried [3] times, each with  maximum [30s] timeout]\n[2012-03-19 15:31:46,039][INFO ][cluster.service          ] [dc01search-03] master {new [dc01search-01][SGsefxoKSX2EdFYS2cku_w][inet[/10.149.206.41:9300]], previous [dc01search-02][drJcyXbfSr687MW4PSN7Fg][inet[/10.149.208.42:9300]]}, removed {[dc01search-02][drJcyXbfSr687MW4PSN7Fg][inet[/10.149.208.42:9300]],}, reason: zen-disco-master_failed ([dc01search-02][drJcyXbfSr687MW4PSN7Fg][inet[/10.149.208.42:9300]])\n```\n\nSo at the time dc01search-02 was the master, it became unavailable due\nto network issues, dc01search-01 was elected the master, and until I\nmanually restarted ES on dc01search-02 today the cluster was in a\nsplit brain state.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}