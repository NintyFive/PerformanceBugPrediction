{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30469","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30469/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30469/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30469/events","html_url":"https://github.com/elastic/elasticsearch/issues/30469","id":321353380,"node_id":"MDU6SXNzdWUzMjEzNTMzODA=","number":30469,"title":"Elasticsearch cluster zen.discovery.fd.ping_retries and zen.discovery.fd.ping_timeout not behaving as expected","user":{"login":"krshnmr4","id":34561059,"node_id":"MDQ6VXNlcjM0NTYxMDU5","avatar_url":"https://avatars0.githubusercontent.com/u/34561059?v=4","gravatar_id":"","url":"https://api.github.com/users/krshnmr4","html_url":"https://github.com/krshnmr4","followers_url":"https://api.github.com/users/krshnmr4/followers","following_url":"https://api.github.com/users/krshnmr4/following{/other_user}","gists_url":"https://api.github.com/users/krshnmr4/gists{/gist_id}","starred_url":"https://api.github.com/users/krshnmr4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krshnmr4/subscriptions","organizations_url":"https://api.github.com/users/krshnmr4/orgs","repos_url":"https://api.github.com/users/krshnmr4/repos","events_url":"https://api.github.com/users/krshnmr4/events{/privacy}","received_events_url":"https://api.github.com/users/krshnmr4/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-05-08T21:28:15Z","updated_at":"2018-05-09T03:49:01Z","closed_at":"2018-05-09T03:04:08Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (2.4):\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (1.8.0_162):\r\n\r\n**OS version** (Alpine 4.1.20 container):\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\nI have a 2 node cluster master_nodes = 2 and minimum master nodes=1 with zen.discovery.fd.ping_retries set to 12000 in order to tolerate extended network outages. \r\n\r\nI understand that setting zen.discovery.fd.ping_retries to 12000 should provide a network failure tolerance of `zen.discovery.fd.ping_retries` times `zen.discovery.fd.ping_timeout` (which is 30s by default). This should be 4 days of tolerance to allow the nodes to re-cluster.\r\n\r\nHowever, ES cluster fails with master left (reason = transport disconnected) error within 15-20 minutes.\r\n\r\n\r\n**Logs**:\r\n`[2018-05-08 20:48:33,674][INFO ][cluster.service          ] [5.50.50.2] detected_master {5.50.50.1}{Ng9_u-jgSvOBhYV3ZHRGHw}{5.50.50.1}{5.50.50.1:9310}{master=true}, added {{5.50.50.1}{Ng9_u-jgSvOBhYV3ZHRGHw}{5.50.50.1}{5.50.50.1:9310}{master=true},}, reason: zen-disco-receive(from master [{5.50.50.1}{Ng9_u-jgSvOBhYV3ZHRGHw}{5.50.50.1}{5.50.50.1:9310}{master=true}])\r\n\r\n[2018-05-08 20:48:34,181][INFO ][http                     ] [5.50.50.2] publish_address {5.50.50.2:9210}, bound_addresses {192.170.0.5:9210}\r\n\r\n[2018-05-08 20:48:34,182][INFO ][node                     ] [5.50.50.2] started\r\n\r\n[2018-05-08 21:06:14,162][INFO ][discovery.zen            ] [5.50.50.2] master_left [{5.50.50.1}{Ng9_u-jgSvOBhYV3ZHRGHw}{5.50.50.1}{5.50.50.1:9310}{master=true}], reason [transport disconnected]\r\n\r\n[2018-05-08 21:06:14,163][WARN ][discovery.zen            ] [5.50.50.2] master left (reason = transport disconnected), current nodes: {{5.50.50.2}{--zAxTyNRHqWcFG0CdDwYw}{5.50.50.2}{5.50.50.2:9310}{master=true},}\r\n\r\n[2018-05-08 21:06:14,163][INFO ][cluster.service          ] [5.50.50.2] removed {{5.50.50.1}{Ng9_u-jgSvOBhYV3ZHRGHw}{5.50.50.1}{5.50.50.1:9310}{master=true},}, reason: zen-disco-master_failed ({5.50.50.1}{Ng9_u-jgSvOBhYV3ZHRGHw}{5.50.50.1}{5.50.50.1:9310}{master=true})\r\n\r\n[2018-05-08 21:06:44,200][WARN ][cluster.service          ] [5.50.50.2] cluster state update task [zen-disco-master_failed ({5.50.50.1}{Ng9_u-jgSvOBhYV3ZHRGHw}{5.50.50.1}{5.50.50.1:9310}{master=true})] took 30s above the warn threshold of 30s\r\n\r\n[2018-05-08 21:06:44,207][INFO ][cluster.routing.allocation] [5.50.50.2] Cluster health status changed from [GREEN] to [YELLOW] (reason: [nodes joined]).\r\n\r\n[2018-05-08 21:06:44,207][INFO ][cluster.service          ] [5.50.50.2] new_master {5.50.50.2}{--zAxTyNRHqWcFG0CdDwYw}{5.50.50.2}{5.50.50.2:9310}{master=true}, reason: zen-disco-join(elected_as_master, [0] joins received)\r\n\r\n[2018-05-08 21:06:44,208][INFO ][cluster.routing          ] [5.50.50.2] delaying allocation for [8] unassigned shards, next check in [1m]`\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}