[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411280165","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-411280165","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":411280165,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTI4MDE2NQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-08-08T04:23:43Z","updated_at":"2018-08-08T04:23:51Z","author_association":"CONTRIBUTOR","body":"Even with SPEGO enabled, the reserved realm (`elastic`, `kibana`, etc) will still use+support username/password basic auth.\r\n\r\nI'll leave @bizybot to evaluate the precise circumstances & behaviour here, but it's not possible/intended to remove basic auth & exclusively support SPNego in current versions.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411280230","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-411280230","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":411280230,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTI4MDIzMA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-08T04:24:13Z","updated_at":"2018-08-08T04:24:13Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411280309","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-411280309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":411280309,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTI4MDMwOQ==","user":{"login":"robgil","id":1257843,"node_id":"MDQ6VXNlcjEyNTc4NDM=","avatar_url":"https://avatars1.githubusercontent.com/u/1257843?v=4","gravatar_id":"","url":"https://api.github.com/users/robgil","html_url":"https://github.com/robgil","followers_url":"https://api.github.com/users/robgil/followers","following_url":"https://api.github.com/users/robgil/following{/other_user}","gists_url":"https://api.github.com/users/robgil/gists{/gist_id}","starred_url":"https://api.github.com/users/robgil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robgil/subscriptions","organizations_url":"https://api.github.com/users/robgil/orgs","repos_url":"https://api.github.com/users/robgil/repos","events_url":"https://api.github.com/users/robgil/events{/privacy}","received_events_url":"https://api.github.com/users/robgil/received_events","type":"User","site_admin":false},"created_at":"2018-08-08T04:24:49Z","updated_at":"2018-08-08T04:24:49Z","author_association":"NONE","body":"@tvernum makes sense, but perhaps its possible to change the order / priority? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412128486","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412128486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412128486,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjEyODQ4Ng==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T16:03:30Z","updated_at":"2018-08-10T16:03:30Z","author_association":"MEMBER","body":"Order should not matter; it is on the client to select the strongest mechanism that it supports. From https://tools.ietf.org/html/rfc2617#section-4.6\r\n\r\n> An HTTP/1.1 server may return multiple challenges with a 401\r\n(Authenticate) response, and each challenge may use a different\r\nauth-scheme. A user agent MUST choose to use the strongest auth-\r\nscheme it understands and request credentials from the user based\r\nupon that challenge.\r\n\r\n@bizybot have you reproduced this behavior?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412130185","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412130185","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412130185,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjEzMDE4NQ==","user":{"login":"robgil","id":1257843,"node_id":"MDQ6VXNlcjEyNTc4NDM=","avatar_url":"https://avatars1.githubusercontent.com/u/1257843?v=4","gravatar_id":"","url":"https://api.github.com/users/robgil","html_url":"https://github.com/robgil","followers_url":"https://api.github.com/users/robgil/followers","following_url":"https://api.github.com/users/robgil/following{/other_user}","gists_url":"https://api.github.com/users/robgil/gists{/gist_id}","starred_url":"https://api.github.com/users/robgil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robgil/subscriptions","organizations_url":"https://api.github.com/users/robgil/orgs","repos_url":"https://api.github.com/users/robgil/repos","events_url":"https://api.github.com/users/robgil/events{/privacy}","received_events_url":"https://api.github.com/users/robgil/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T16:09:50Z","updated_at":"2018-08-10T16:09:50Z","author_association":"NONE","body":"@jaymode that makes sense. I'll try to reproduce and see what the 401 header looks like on first request.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412137745","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412137745","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412137745,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjEzNzc0NQ==","user":{"login":"robgil","id":1257843,"node_id":"MDQ6VXNlcjEyNTc4NDM=","avatar_url":"https://avatars1.githubusercontent.com/u/1257843?v=4","gravatar_id":"","url":"https://api.github.com/users/robgil","html_url":"https://github.com/robgil","followers_url":"https://api.github.com/users/robgil/followers","following_url":"https://api.github.com/users/robgil/following{/other_user}","gists_url":"https://api.github.com/users/robgil/gists{/gist_id}","starred_url":"https://api.github.com/users/robgil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robgil/subscriptions","organizations_url":"https://api.github.com/users/robgil/orgs","repos_url":"https://api.github.com/users/robgil/repos","events_url":"https://api.github.com/users/robgil/events{/privacy}","received_events_url":"https://api.github.com/users/robgil/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T16:37:41Z","updated_at":"2018-08-10T16:42:24Z","author_association":"NONE","body":"@jaymode with kerberos enabled, I'm seeing the following in the browser. This results in 2 calls which is strange. With SPNEGO it should be sending the `Negotiate` on the _first_ call which is what happens with other SPNEGO services I use. \r\n\r\n<details>\r\n<pre>\r\n{\r\n  \"log\": {\r\n    \"version\": \"1.1\",\r\n    \"creator\": {\r\n      \"name\": \"Firefox\",\r\n      \"version\": \"61.0.2\"\r\n    },\r\n    \"browser\": {\r\n      \"name\": \"Firefox\",\r\n      \"version\": \"61.0.2\"\r\n    },\r\n    \"pages\": [\r\n      {\r\n        \"startedDateTime\": \"2018-08-10T12:31:50.874-04:00\",\r\n        \"id\": \"page_1\",\r\n        \"title\": \"elasticsearch.test:9200/_cluster/health\",\r\n        \"pageTimings\": {\r\n          \"onContentLoad\": 2045,\r\n          \"onLoad\": 2047\r\n        }\r\n      }\r\n    ],\r\n    \"entries\": [\r\n      {\r\n        \"pageref\": \"page_1\",\r\n        \"startedDateTime\": \"2018-08-10T12:31:50.874-04:00\",\r\n        \"request\": {\r\n          \"bodySize\": 0,\r\n          \"method\": \"GET\",\r\n          \"url\": \"http://elasticsearch.test:9200/_cluster/health\",\r\n          \"httpVersion\": \"HTTP/1.1\",\r\n          \"headers\": [\r\n            {\r\n              \"name\": \"Host\",\r\n              \"value\": \"elasticsearch.test:9200\"\r\n            },\r\n            {\r\n              \"name\": \"User-Agent\",\r\n              \"value\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:61.0) Gecko/20100101 Firefox/61.0\"\r\n            },\r\n            {\r\n              \"name\": \"Accept\",\r\n              \"value\": \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\"\r\n            },\r\n            {\r\n              \"name\": \"Accept-Language\",\r\n              \"value\": \"en-US,en;q=0.5\"\r\n            },\r\n            {\r\n              \"name\": \"Accept-Encoding\",\r\n              \"value\": \"gzip, deflate\"\r\n            },\r\n            {\r\n              \"name\": \"Connection\",\r\n              \"value\": \"keep-alive\"\r\n            },\r\n            {\r\n              \"name\": \"Upgrade-Insecure-Requests\",\r\n              \"value\": \"1\"\r\n            },\r\n            {\r\n              \"name\": \"Pragma\",\r\n              \"value\": \"no-cache\"\r\n            },\r\n            {\r\n              \"name\": \"Cache-Control\",\r\n              \"value\": \"no-cache\"\r\n            }\r\n          ],\r\n          \"cookies\": [],\r\n          \"queryString\": [],\r\n          \"headersSize\": 395\r\n        },\r\n        \"response\": {\r\n          \"status\": 401,\r\n          \"statusText\": \"Unauthorized\",\r\n          \"httpVersion\": \"HTTP/1.1\",\r\n          \"headers\": [\r\n            {\r\n              \"name\": \"WWW-Authenticate\",\r\n              \"value\": \"Negotiate oR**REDACTED**\"\r\n            },\r\n            {\r\n              \"name\": \"content-type\",\r\n              \"value\": \"application/json; charset=UTF-8\"\r\n            },\r\n            {\r\n              \"name\": \"content-encoding\",\r\n              \"value\": \"gzip\"\r\n            },\r\n            {\r\n              \"name\": \"content-length\",\r\n              \"value\": \"223\"\r\n            }\r\n          ],\r\n          \"cookies\": [],\r\n          \"content\": {\r\n            \"mimeType\": \"application/vnd.mozilla.json.view; charset=UTF-8\",\r\n            \"size\": 380,\r\n            \"encoding\": \"base64\",\r\n            \"text\": \"**REDACTED**\"\r\n          },\r\n          \"redirectURL\": \"\",\r\n          \"headersSize\": 189,\r\n          \"bodySize\": 412\r\n        },\r\n        \"cache\": {},\r\n        \"timings\": {\r\n          \"blocked\": 1,\r\n          \"dns\": 0,\r\n          \"connect\": 0,\r\n          \"ssl\": 0,\r\n          \"send\": 0,\r\n          \"wait\": 4,\r\n          \"receive\": 0\r\n        },\r\n        \"time\": 5,\r\n        \"_securityState\": \"insecure\",\r\n        \"serverIPAddress\": \"::1\",\r\n        \"connection\": \"9200\"\r\n      },\r\n      {\r\n        \"pageref\": \"page_1\",\r\n        \"startedDateTime\": \"2018-08-10T12:31:52.874-04:00\",\r\n        \"request\": {\r\n          \"bodySize\": 0,\r\n          \"method\": \"GET\",\r\n          \"url\": \"http://elasticsearch.test:9200/_cluster/health\",\r\n          \"httpVersion\": \"HTTP/1.1\",\r\n          \"headers\": [\r\n            {\r\n              \"name\": \"Host\",\r\n              \"value\": \"elasticsearch.test:9200\"\r\n            },\r\n            {\r\n              \"name\": \"User-Agent\",\r\n              \"value\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:61.0) Gecko/20100101 Firefox/61.0\"\r\n            },\r\n            {\r\n              \"name\": \"Accept\",\r\n              \"value\": \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\"\r\n            },\r\n            {\r\n              \"name\": \"Accept-Language\",\r\n              \"value\": \"en-US,en;q=0.5\"\r\n            },\r\n            {\r\n              \"name\": \"Accept-Encoding\",\r\n              \"value\": \"gzip, deflate\"\r\n            },\r\n            {\r\n              \"name\": \"Connection\",\r\n              \"value\": \"keep-alive\"\r\n            },\r\n            {\r\n              \"name\": \"Upgrade-Insecure-Requests\",\r\n              \"value\": \"1\"\r\n            },\r\n            {\r\n              \"name\": \"Pragma\",\r\n              \"value\": \"no-cache\"\r\n            },\r\n            {\r\n              \"name\": \"Cache-Control\",\r\n              \"value\": \"no-cache\"\r\n            },\r\n            {\r\n              \"name\": \"Authorization\",\r\n              \"value\": \"Negotiate YIIFUgYGKw **REDACTED**\"\r\n            }\r\n          ],\r\n          \"cookies\": [],\r\n          \"queryString\": [],\r\n          \"headersSize\": 2246\r\n        },\r\n        \"response\": {\r\n          \"status\": 200,\r\n          \"statusText\": \"OK\",\r\n          \"httpVersion\": \"HTTP/1.1\",\r\n          \"headers\": [],\r\n          \"cookies\": [],\r\n          \"content\": {\r\n            \"mimeType\": \"application/vnd.mozilla.json.view; charset=UTF-8\",\r\n            \"size\": 380,\r\n            \"encoding\": \"base64\",\r\n            \"text\": \"**REDACTED**\"\r\n          },\r\n          \"redirectURL\": \"\",\r\n          \"headersSize\": 173,\r\n          \"bodySize\": 396\r\n        },\r\n        \"cache\": {},\r\n        \"timings\": {\r\n          \"blocked\": 0,\r\n          \"dns\": 0,\r\n          \"connect\": 0,\r\n          \"ssl\": 0,\r\n          \"send\": 0,\r\n          \"wait\": 19,\r\n          \"receive\": 0\r\n        },\r\n        \"time\": 19,\r\n        \"_securityState\": \"insecure\",\r\n        \"serverIPAddress\": \"::1\",\r\n        \"connection\": \"9200\"\r\n      }\r\n    ]\r\n  }\r\n}\r\n</pre>\r\n</details>","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412143370","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412143370","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412143370,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjE0MzM3MA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T16:59:00Z","updated_at":"2018-08-10T16:59:00Z","author_association":"MEMBER","body":"@robgil I am not seeing anything unusual there. The initial GET request is made, a 401 response is returned with WWW-Authenticate: Negotiate to challenge the client to provide authentication, browser makes GET request again with Authorization header and Negotiate token which the server authenticates and returns the cluster health. \r\n\r\nIf you're saying the first request made to the server should have the Negotiate token, I am not aware of a browser that does pre-emptive SPNEGO before being challenged by the server. Also, did you still get a basic auth prompt?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412144614","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412144614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412144614,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjE0NDYxNA==","user":{"login":"robgil","id":1257843,"node_id":"MDQ6VXNlcjEyNTc4NDM=","avatar_url":"https://avatars1.githubusercontent.com/u/1257843?v=4","gravatar_id":"","url":"https://api.github.com/users/robgil","html_url":"https://github.com/robgil","followers_url":"https://api.github.com/users/robgil/followers","following_url":"https://api.github.com/users/robgil/following{/other_user}","gists_url":"https://api.github.com/users/robgil/gists{/gist_id}","starred_url":"https://api.github.com/users/robgil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robgil/subscriptions","organizations_url":"https://api.github.com/users/robgil/orgs","repos_url":"https://api.github.com/users/robgil/repos","events_url":"https://api.github.com/users/robgil/events{/privacy}","received_events_url":"https://api.github.com/users/robgil/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T17:03:46Z","updated_at":"2018-08-10T17:03:46Z","author_association":"NONE","body":"@jaymode yeah still getting the basic auth prompt. I thought SPNEGO was automatically sent on every request which is why you needed to specify a whitelist of domains to send negotiate to. \r\n\r\n<img width=\"929\" alt=\"screen shot 2018-08-10 at 12 36 28 pm\" src=\"https://user-images.githubusercontent.com/1257843/43971073-c3b50d5a-9c9d-11e8-94d8-4dfb9651f834.png\">\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412161728","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412161728","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412161728,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjE2MTcyOA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T18:07:39Z","updated_at":"2018-08-10T18:07:39Z","author_association":"MEMBER","body":"The negotiate authentication is only sent when challenged **and** the challenging host is in the `network.negotiate-auth.trusted-uris` value. Other browsers do something a little different https://bugzilla.mozilla.org/show_bug.cgi?id=729496.\r\n\r\nYour configuration looks correct to me, so I am not sure why firefox is prompting you for basic auth; what OS and FF version? I'd also be interested in the FF logs for negotiate auth. From a command line:\r\n\r\n```\r\nexport NSPR_LOG_MODULES=negotiateauth:5\r\nexport NSPR_LOG_FILE=/tmp/moz.log\r\n```\r\n\r\nThen start firefox from that terminal. Maybe that will reveal something.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412279750","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412279750","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412279750,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjI3OTc1MA==","user":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"created_at":"2018-08-11T14:47:04Z","updated_at":"2018-08-11T14:47:04Z","author_association":"CONTRIBUTOR","body":"From my findings, the behavior is browser specific.\r\nI think Chrome does what Jay mentioned to select most secure auth scheme whereas Firefox is using the sequence in `WWW-Authenticate` header. Note: We send multiple `WWW-Authenticate` headers, so that might also cause this behavior on Firefox.\r\n\r\nFollowing were the findings when I checked in my environment:\r\n\r\n||Firefox|Firefox-PrivateMode|Chrome|Chrome-IncognitoMode|\r\n|---|---|---|---|---|\r\n|SchemeSeq: [Basic, Negotiate]|:heavy_check_mark: basic auth prompt needs cancellation, then negotiate works|:x: negotiate does not work|:white_check_mark: no basic auth prompt, negotiate works|:white_check_mark: no basic auth prompt, negotiate works|\r\n|SchemeSeq: [Negotiate, Basic]|:white_check_mark: no basic auth prompt, negotiate works|:x: negotiate does not work|:white_check_mark: no basic auth prompt, negotiate works|:white_check_mark: no basic auth prompt, negotiate works|\r\n\r\nPrivate/Incognito mode, the behavior is different between these two browsers.\r\nFirefox: [Bug - Fixed - Do not allow Kerberos authenticate in private mode ](https://bugzilla.mozilla.org/show_bug.cgi?id=1248564)\r\nChrome: [Bug - Closed with no fix - Do not allow Kerberos Http negotiate in Incognito](https://bugs.chromium.org/p/chromium/issues/detail?id=232011)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412526375","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412526375","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412526375,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjUyNjM3NQ==","user":{"login":"robgil","id":1257843,"node_id":"MDQ6VXNlcjEyNTc4NDM=","avatar_url":"https://avatars1.githubusercontent.com/u/1257843?v=4","gravatar_id":"","url":"https://api.github.com/users/robgil","html_url":"https://github.com/robgil","followers_url":"https://api.github.com/users/robgil/followers","following_url":"https://api.github.com/users/robgil/following{/other_user}","gists_url":"https://api.github.com/users/robgil/gists{/gist_id}","starred_url":"https://api.github.com/users/robgil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robgil/subscriptions","organizations_url":"https://api.github.com/users/robgil/orgs","repos_url":"https://api.github.com/users/robgil/repos","events_url":"https://api.github.com/users/robgil/events{/privacy}","received_events_url":"https://api.github.com/users/robgil/received_events","type":"User","site_admin":false},"created_at":"2018-08-13T13:55:32Z","updated_at":"2018-08-13T13:55:52Z","author_association":"NONE","body":"Thanks @bizybot @jaymode. It looks like we now know how it behaves in each browser (great job!). Would changing the order in the WWW-Authenticate header ensure it works consistently in all browsers? We should probably also test IE, but I don't have any windows set up. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412569639","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412569639","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412569639,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjU2OTYzOQ==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-08-13T16:00:18Z","updated_at":"2018-08-13T16:00:18Z","author_association":"MEMBER","body":"@bizybot correct me if I am wrong, but I do not believe it is trivial to add ordering due to the way we add headers to the response. I'd rather like to see this raised as an issue with firefox and see if they will address it; @bizybot can you open that issue?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412763576","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-412763576","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":412763576,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjc2MzU3Ng==","user":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T06:02:12Z","updated_at":"2018-08-14T06:02:12Z","author_association":"CONTRIBUTOR","body":"@jaymode you are right, as we collect headers for each realm and they can contain other headers as well. We do that iterating realm in the order defined to collect header values. I think you right in filing issue with FF, the issue is already filed and open after 7 years [Multiple Proxy-Authenticate headers order-dependency bug causes login popup with NTLM + Basic](https://bugzilla.mozilla.org/show_bug.cgi?id=650091).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413780545","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-413780545","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":413780545,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzc4MDU0NQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-08-17T07:21:45Z","updated_at":"2018-08-17T07:21:45Z","author_association":"CONTRIBUTOR","body":"Given that browsers are not doing what they should (and seem unlikely to do so), I think we ought (at some priority) sort the header values ourselves based on the same ordering that browsers are supposed to implement.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/415628032","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-415628032","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":415628032,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNTYyODAzMg==","user":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"created_at":"2018-08-24T02:02:05Z","updated_at":"2018-08-24T02:02:05Z","author_association":"CONTRIBUTOR","body":"Hi, @tvernum @jaymode,\r\n\r\nBased on our above discussions I am leaning towards Tim's suggestion to sort the header values ourselves as this explicitly states server's intent.\r\n\r\nI am considering following options, more towards option 2 as it allows custom behavior\r\n**option 1)** to define the sort order implicitly based on more secure to less secure (the way we expect browsers to handle).In case of custom auth schemes, they will be considered less secure which may not be true and if someone wants that custom auth scheme to be treated at higher priority this can be limiting.\r\n\r\n**option 2)** we could expose an optional setting which allows for specifying the auth schemes in the custom order as what customers want the behavior to be, by default it will be a list of auth schemes from more secure to less secure where custom auth schemes are treated less secure.\r\nFor example, `xpack.security.http.auth.schemes.preference=oauth,negotiate,bearer,scram-sha-256,digest,basic,mutual,hoba,custom`\r\n\r\nPlease suggest if you think we could do something different here and which option would be more preferrable.\r\nThank you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/415649103","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-415649103","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":415649103,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNTY0OTEwMw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-08-24T04:41:26Z","updated_at":"2018-08-24T04:41:36Z","author_association":"CONTRIBUTOR","body":"I don't think this is a high priority, and I'm not sure there's really any demand for making it configurable (especially since browsers are supposed to handle this themselves).\r\nI'd keep it simple and go with option 1. We can make it configurable if there are requests, but we have real requests from users that would have a higher priority right now.\r\n ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/415765168","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-415765168","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":415765168,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNTc2NTE2OA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-08-24T13:51:52Z","updated_at":"2018-08-24T13:51:52Z","author_association":"MEMBER","body":"I'm good with option one with a specific handling for sorting WWW-Authenticate headers that is not configurable.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/415864475","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-415864475","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":415864475,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNTg2NDQ3NQ==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-08-24T19:49:31Z","updated_at":"2018-08-24T19:49:31Z","author_association":"MEMBER","body":"I removed the team-discuss from this issue since we have a way forward. I also removed the 6.5 label as we typically don't use version labels on issues but more on PRs.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419435049","html_url":"https://github.com/elastic/elasticsearch/issues/32699#issuecomment-419435049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32699","id":419435049,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTQzNTA0OQ==","user":{"login":"robgil","id":1257843,"node_id":"MDQ6VXNlcjEyNTc4NDM=","avatar_url":"https://avatars1.githubusercontent.com/u/1257843?v=4","gravatar_id":"","url":"https://api.github.com/users/robgil","html_url":"https://github.com/robgil","followers_url":"https://api.github.com/users/robgil/followers","following_url":"https://api.github.com/users/robgil/following{/other_user}","gists_url":"https://api.github.com/users/robgil/gists{/gist_id}","starred_url":"https://api.github.com/users/robgil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robgil/subscriptions","organizations_url":"https://api.github.com/users/robgil/orgs","repos_url":"https://api.github.com/users/robgil/repos","events_url":"https://api.github.com/users/robgil/events{/privacy}","received_events_url":"https://api.github.com/users/robgil/received_events","type":"User","site_admin":false},"created_at":"2018-09-07T13:13:32Z","updated_at":"2018-09-07T13:13:32Z","author_association":"NONE","body":"@tvernum @jaymode @bizybot thanks folks! Looks great!","performed_via_github_app":null}]