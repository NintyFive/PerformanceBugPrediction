{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17956","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17956/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17956/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17956/events","html_url":"https://github.com/elastic/elasticsearch/issues/17956","id":150866833,"node_id":"MDU6SXNzdWUxNTA4NjY4MzM=","number":17956,"title":"Allow adding additional child types referring to the same parent","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2016-04-25T13:55:12Z","updated_at":"2018-02-14T13:28:34Z","closed_at":"2016-05-19T09:36:13Z","author_association":"MEMBER","active_lock_reason":null,"body":"Originates from: https://discuss.elastic.co/t/how-to-create-a-child-type-when-its-parent-type-is-already-exist-in-elasticsearch-2-x\n\nIn cases when a parent type already has child mappings we can potentially relax the constraint that forbids adding more child type. \n\nThe constraint as is today was designed to avoid the following scenario:\n\n```\nPUT /index\n{\n  \"mappings\": {\n    \"parent\" : {\n    }\n  }\n}\n\n// some time later:\n\nPUT /index/child1/_mapping\n{\n  \"child1\" : {\n    \"_parent\": {\n        \"type\": \"parent\"\n      }  \n  }\n}\n```\n\nThe put mapping call fails with:  `can't add a _parent field that points to an already existing type`\nThe reason we can't allow is this, is that otherwise for already existing parent docs the ids wouldn't be stored in the doc values join field (which the _paren field controls)\n\nHowever this constraint also prevents adding additional child types:\n\n```\nPUT /index\n{\n  \"mappings\": {\n    \"parent\" : {\n    },\n    \"child1\" : {\n      \"_parent\": {\n        \"type\": \"parent\"\n      }\n    }\n  }\n}\n\nPUT /index/child2/_mapping\n{\n  \"child2\" : {\n    \"_parent\": {\n        \"type\": \"parent\"\n      }  \n  }\n}\n```\n\nIn this case adding the second child type fails. This is too strict and we can allow this, because for the parent type we already store the ids in the doc values join field.\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}