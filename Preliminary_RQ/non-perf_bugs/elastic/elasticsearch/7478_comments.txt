[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53548295","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53548295","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53548295,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTQ4Mjk1","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-08-27T09:50:35Z","updated_at":"2014-08-27T09:50:35Z","author_association":"CONTRIBUTOR","body":"this does look like the bug you are referring to. thanks for reporting this!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53548845","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53548845","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53548845,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTQ4ODQ1","user":{"login":"maf23","id":1116021,"node_id":"MDQ6VXNlcjExMTYwMjE=","avatar_url":"https://avatars2.githubusercontent.com/u/1116021?v=4","gravatar_id":"","url":"https://api.github.com/users/maf23","html_url":"https://github.com/maf23","followers_url":"https://api.github.com/users/maf23/followers","following_url":"https://api.github.com/users/maf23/following{/other_user}","gists_url":"https://api.github.com/users/maf23/gists{/gist_id}","starred_url":"https://api.github.com/users/maf23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maf23/subscriptions","organizations_url":"https://api.github.com/users/maf23/orgs","repos_url":"https://api.github.com/users/maf23/repos","events_url":"https://api.github.com/users/maf23/events{/privacy}","received_events_url":"https://api.github.com/users/maf23/received_events","type":"User","site_admin":false},"created_at":"2014-08-27T09:56:06Z","updated_at":"2014-08-27T09:56:06Z","author_association":"NONE","body":"An additional note, we have noted that this seems to happen (at least more frequently) when we post multiple parallel scan queries. Which seems to make sense from what I can see in the stack trace.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53565244","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53565244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53565244,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTY1MjQ0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-08-27T12:29:39Z","updated_at":"2014-08-27T12:29:39Z","author_association":"MEMBER","body":"@maf23 Were you using the same scroll id multiple times in the parallel scan queries? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53568309","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53568309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53568309,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTY4MzA5","user":{"login":"maf23","id":1116021,"node_id":"MDQ6VXNlcjExMTYwMjE=","avatar_url":"https://avatars2.githubusercontent.com/u/1116021?v=4","gravatar_id":"","url":"https://api.github.com/users/maf23","html_url":"https://github.com/maf23","followers_url":"https://api.github.com/users/maf23/followers","following_url":"https://api.github.com/users/maf23/following{/other_user}","gists_url":"https://api.github.com/users/maf23/gists{/gist_id}","starred_url":"https://api.github.com/users/maf23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maf23/subscriptions","organizations_url":"https://api.github.com/users/maf23/orgs","repos_url":"https://api.github.com/users/maf23/repos","events_url":"https://api.github.com/users/maf23/events{/privacy}","received_events_url":"https://api.github.com/users/maf23/received_events","type":"User","site_admin":false},"created_at":"2014-08-27T13:00:10Z","updated_at":"2014-08-27T13:00:10Z","author_association":"NONE","body":"The scroll id should be different. But we will check our code to make sure\nthis is actually the case.\n\nOn Wed, Aug 27, 2014 at 2:30 PM, Martijn van Groningen <\nnotifications@github.com> wrote:\n\n> @maf23 https://github.com/maf23 Were you using the same scroll id\n> multiple times in the parallel scan queries?\n> \n> â€”\n> Reply to this email directly or view it on GitHub\n> https://github.com/elasticsearch/elasticsearch/issues/7478#issuecomment-53565244\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53571094","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53571094","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53571094,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTcxMDk0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-08-27T13:23:42Z","updated_at":"2014-08-27T13:23:42Z","author_association":"MEMBER","body":"I can see how this situation can occur if multiple scroll requests are scrolling in parallel with the same scroll id (or same scroll id prefix), the scroll api was never designed to support this. I think we need proper validation if two search requests try to access the same scan context that is open on a node.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53578267","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53578267","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53578267,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTc4MjY3","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-08-27T14:15:38Z","updated_at":"2014-08-27T14:15:38Z","author_association":"MEMBER","body":"Also running the clear scoll api during a scroll session can cause this bug.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53699612","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53699612","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53699612,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNjk5NjEy","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-08-28T10:05:20Z","updated_at":"2014-08-28T10:05:20Z","author_association":"MEMBER","body":"@maf23 Can you share what jvm version and vendor you're using?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53700763","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53700763","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53700763,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNzAwNzYz","user":{"login":"maf23","id":1116021,"node_id":"MDQ6VXNlcjExMTYwMjE=","avatar_url":"https://avatars2.githubusercontent.com/u/1116021?v=4","gravatar_id":"","url":"https://api.github.com/users/maf23","html_url":"https://github.com/maf23","followers_url":"https://api.github.com/users/maf23/followers","following_url":"https://api.github.com/users/maf23/following{/other_user}","gists_url":"https://api.github.com/users/maf23/gists{/gist_id}","starred_url":"https://api.github.com/users/maf23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maf23/subscriptions","organizations_url":"https://api.github.com/users/maf23/orgs","repos_url":"https://api.github.com/users/maf23/repos","events_url":"https://api.github.com/users/maf23/events{/privacy}","received_events_url":"https://api.github.com/users/maf23/received_events","type":"User","site_admin":false},"created_at":"2014-08-28T10:12:50Z","updated_at":"2014-08-28T10:12:50Z","author_association":"NONE","body":"Sure, Oracle JVM 1.7.0_25\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53711013","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53711013","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53711013,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNzExMDEz","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-08-28T12:09:30Z","updated_at":"2014-08-28T12:09:30Z","author_association":"MEMBER","body":"Ok thanks, like you mentioned the ConcurrentHashMap should be used here since the map in question is accessed by different threads during the entire scroll.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53729049","html_url":"https://github.com/elastic/elasticsearch/issues/7478#issuecomment-53729049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7478","id":53729049,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNzI5MDQ5","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-08-28T14:38:40Z","updated_at":"2014-08-28T14:38:40Z","author_association":"MEMBER","body":"@maf23 Pushed a fix for this bug, which will be included in the next release. Thanks for reporting this!\n","performed_via_github_app":null}]