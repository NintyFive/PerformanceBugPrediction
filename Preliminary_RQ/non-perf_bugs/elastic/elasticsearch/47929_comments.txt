[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/541573067","html_url":"https://github.com/elastic/elasticsearch/issues/47929#issuecomment-541573067","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47929","id":541573067,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTU3MzA2Nw==","user":{"login":"fedde-s","id":4929431,"node_id":"MDQ6VXNlcjQ5Mjk0MzE=","avatar_url":"https://avatars3.githubusercontent.com/u/4929431?v=4","gravatar_id":"","url":"https://api.github.com/users/fedde-s","html_url":"https://github.com/fedde-s","followers_url":"https://api.github.com/users/fedde-s/followers","following_url":"https://api.github.com/users/fedde-s/following{/other_user}","gists_url":"https://api.github.com/users/fedde-s/gists{/gist_id}","starred_url":"https://api.github.com/users/fedde-s/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fedde-s/subscriptions","organizations_url":"https://api.github.com/users/fedde-s/orgs","repos_url":"https://api.github.com/users/fedde-s/repos","events_url":"https://api.github.com/users/fedde-s/events{/privacy}","received_events_url":"https://api.github.com/users/fedde-s/received_events","type":"User","site_admin":false},"created_at":"2019-10-14T09:21:14Z","updated_at":"2019-10-14T09:21:14Z","author_association":"NONE","body":"Since the Elasticsearch images [are based on CentOS 7](https://github.com/elastic/elasticsearch/blob/v7.4.0/distribution/docker/src/docker/Dockerfile#L38), they use [a chroot version feature-frozen since 2013](https://centos.pkgs.org/7/centos-x86_64/coreutils-8.22-24.el7.x86_64.rpm.html). chroot only [has only started applying user-associated groups in 2014](https://git.savannah.gnu.org/cgit/coreutils.git/tree/NEWS?h=v8.23#n140). I believe that to be the cause of this bug in the Elasticsearch images; [recent documentation for chroot](https://www.gnu.org/software/coreutils/manual/html_node/chroot-invocation.html#index-_002d_002duserspec) will say that `--userspec` will look up the groups for the user, but [that is not the case in 8.22](https://git.savannah.gnu.org/cgit/coreutils.git/tree/doc/coreutils.texi?h=v8.22#n16065).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/542097352","html_url":"https://github.com/elastic/elasticsearch/issues/47929#issuecomment-542097352","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47929","id":542097352,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MjA5NzM1Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-10-15T08:21:11Z","updated_at":"2019-10-15T08:21:11Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Core)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/552864107","html_url":"https://github.com/elastic/elasticsearch/issues/47929#issuecomment-552864107","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47929","id":552864107,"node_id":"MDEyOklzc3VlQ29tbWVudDU1Mjg2NDEwNw==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2019-11-12T11:59:52Z","updated_at":"2019-11-12T11:59:52Z","author_association":"CONTRIBUTOR","body":"> [The documentation on bind-mounting configuration into an Elasticsearch Docker container](https://www.elastic.co/guide/en/elasticsearch/reference/7.4/docker.html#_b_bind_mounted_configuration) claims that the container will run Elasticsearch as a user with group ID 1000\r\n\r\n@fedde-s This is indeed something that should be addressed in the docs, given that as you [correctly mentioned](https://github.com/elastic/elasticsearch/issues/47929#issuecomment-541573067) the `chroot` version available in `centos:7` doesn't apply supplemental groups of the specified user. The current behavior, i.e. running with `gid:0` is somewhat desired to enable running on Openshift/OKD and is a rather common pattern (e.g. also used in [gocd](https://www.gocd.org/2019/06/25/GoCD-non-root-containers.html)).\r\n\r\nPractically speaking I think we should adjust the docs in the [linked section](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_configuration_files_must_be_readable_by_the_elasticsearch_user) to:\r\n\r\n1. Mention that Elasticsearch runs with `uid:1000` and not claim that gid is 1000.\r\n2. For bind mounting, recommend the [Openshift guidelines#SUPPORT ARBITRARY USER IDS](https://docs.openshift.com/container-platform/4.2/openshift_images/create-images.html#images-create-guide-general_create-images) to ensure bind mounted directories with different UIDs to `uid:1000` are `gid:0`.\r\n\r\nFor your use case you'd use something like (I chose a random `uid:1500` -- `uid:0` will work too ):\r\n\r\n```\r\nsudo -- sh -c 'mkdir esdatadir && chmod g+rwx esdatadir && chgrp 0 esdatadir && chown 1500 esdatadir'\r\n```\r\n\r\nwhich allows the docker image to run using:\r\n\r\n```\r\ndocker run --rm -e \"discovery.type=single-node\" -v \"$PWD/esdatadir:/usr/share/elasticsearch/data\" docker.elastic.co/elasticsearch/elasticsearch-oss:7.4.0\r\n```\r\n\r\nIn the future when we switch to a newer base image with a newer `chown` that applies supplementary groups we can still readjust the docs from that version onwards.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/558995355","html_url":"https://github.com/elastic/elasticsearch/issues/47929#issuecomment-558995355","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47929","id":558995355,"node_id":"MDEyOklzc3VlQ29tbWVudDU1ODk5NTM1NQ==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2019-11-27T09:03:58Z","updated_at":"2019-11-27T09:03:58Z","author_association":"CONTRIBUTOR","body":"Updates to the docs have been done in #49529 . I've also opened https://github.com/elastic/elasticsearch/pull/49632 to backport the changes to version 7.6.","performed_via_github_app":null}]