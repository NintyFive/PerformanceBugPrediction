[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/571054545","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-571054545","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":571054545,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTA1NDU0NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-06T08:43:48Z","updated_at":"2020-01-06T08:43:48Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Packaging)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/572137700","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-572137700","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":572137700,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjEzNzcwMA==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-08T16:05:01Z","updated_at":"2020-01-08T16:05:01Z","author_association":"CONTRIBUTOR","body":"I'll look into this and raise the issue with the dev team if necessary.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/573900808","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-573900808","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":573900808,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzkwMDgwOA==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T22:22:08Z","updated_at":"2020-01-13T22:22:08Z","author_association":"CONTRIBUTOR","body":"I'm having a tough time reproducing this in a clean environment. In particular, I can't see how the file `.elasticsearch.keystore.initial_md5sum` would have a size zero.\r\n\r\nThe relevant script is `posttrans`:\r\n\r\n```\r\nif [ ! -f /etc/elasticsearch/elasticsearch.keystore ]; then\r\n    /usr/share/elasticsearch/bin/elasticsearch-keystore create\r\n    chown root:elasticsearch /etc/elasticsearch/elasticsearch.keystore\r\n    chmod 660 /etc/elasticsearch/elasticsearch.keystore\r\n    md5sum /etc/elasticsearch/elasticsearch.keystore > /etc/elasticsearch/.elasticsearch.keystore.initial_md5sum\r\nelse\r\n    /usr/share/elasticsearch/bin/elasticsearch-keystore upgrade\r\nfi\r\n```\r\n\r\nIf the file exists and md5sum can read it, md5sum will be able to calculate a checksum. We'd get a size of `0` if md5sum hit an error reading `/etc/elasticsearch/elasticsearch.keystore`, but from the lines just above, I can't see how that would happen.\r\n\r\nAre you running your RPM commands as root, or do you have a different permissions scheme in place? Are you using the keystore for secure settings for your cluster?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/573908958","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-573908958","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":573908958,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzkwODk1OA==","user":{"login":"erempel","id":8525120,"node_id":"MDQ6VXNlcjg1MjUxMjA=","avatar_url":"https://avatars3.githubusercontent.com/u/8525120?v=4","gravatar_id":"","url":"https://api.github.com/users/erempel","html_url":"https://github.com/erempel","followers_url":"https://api.github.com/users/erempel/followers","following_url":"https://api.github.com/users/erempel/following{/other_user}","gists_url":"https://api.github.com/users/erempel/gists{/gist_id}","starred_url":"https://api.github.com/users/erempel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erempel/subscriptions","organizations_url":"https://api.github.com/users/erempel/orgs","repos_url":"https://api.github.com/users/erempel/repos","events_url":"https://api.github.com/users/erempel/events{/privacy}","received_events_url":"https://api.github.com/users/erempel/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T22:45:10Z","updated_at":"2020-01-13T22:45:10Z","author_association":"NONE","body":"I am equally confused by the zero size of the md5sum file. The update was done with a standard root initiated \"yum update\".\r\n\r\n% ls -l /var/log/yum.log \r\n-rw------- 1 root root 113867 Jan  8 12:05 /var/log/yum.log\r\n\r\n% sudo fgrep elasticsearch /var/log/yum.log\r\nNov 26 10:05:37 Installed: elasticsearch-7.4.2-1.x86_64\r\nJan 01 04:40:51 Updated: elasticsearch-7.5.1-1.x86_64\r\n\r\nonly root can write to the yum log, and the update was recorded by the yum update process.\r\n\r\nI also agree that the relevant script is posttrans \r\n\r\nThe only way that the md5sum could be zero is if the keystore file did not exist and the command \r\n\r\nmd5sum /etc/elasticsearch/elasticsearch.keystore > /etc/elasticsearch/.elasticsearch.keystore.initial_md5sum\r\n\r\nwas run.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/574840962","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-574840962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":574840962,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NDg0MDk2Mg==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-15T20:25:02Z","updated_at":"2020-01-15T20:25:02Z","author_association":"CONTRIBUTOR","body":"I've tried a number of different combinations of keystore modifications and Elasticsearch upgrades, and I'm unable to reproduce this behavior on an RHEL 7 Vagrant image.\r\n\r\nAre you able to find a series of steps to reproduce the problem?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/574969436","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-574969436","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":574969436,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NDk2OTQzNg==","user":{"login":"Daych","id":52278989,"node_id":"MDQ6VXNlcjUyMjc4OTg5","avatar_url":"https://avatars3.githubusercontent.com/u/52278989?v=4","gravatar_id":"","url":"https://api.github.com/users/Daych","html_url":"https://github.com/Daych","followers_url":"https://api.github.com/users/Daych/followers","following_url":"https://api.github.com/users/Daych/following{/other_user}","gists_url":"https://api.github.com/users/Daych/gists{/gist_id}","starred_url":"https://api.github.com/users/Daych/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Daych/subscriptions","organizations_url":"https://api.github.com/users/Daych/orgs","repos_url":"https://api.github.com/users/Daych/repos","events_url":"https://api.github.com/users/Daych/events{/privacy}","received_events_url":"https://api.github.com/users/Daych/received_events","type":"User","site_admin":false},"created_at":"2020-01-16T03:49:41Z","updated_at":"2020-01-16T03:49:41Z","author_association":"NONE","body":"Jan 16 11:45:53 test206 systemd[1]: Starting Elasticsearch...\r\n-- Subject: Unit elasticsearch.service has begun start-up\r\n-- Defined-By: systemd\r\n-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel\r\n--\r\n-- Unit elasticsearch.service has begun starting up.\r\nJan 16 11:45:54 test206 elasticsearch[10611]: OpenJDK 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.\r\nJan 16 11:45:55 test206 elasticsearch[10611]: Exception in thread \"main\" org.elasticsearch.bootstrap.BootstrapException: org.elasticsearch.cli.UserException: unable to create temporary keystore at [/etc/elasticsearch/elasticsearch.keystore.tmp], write permissions required for [/etc/elasticsearch] or run [elasticsearch-keystore upgrade]\r\nJan 16 11:45:55 test206 elasticsearch[10611]: Likely root cause: java.nio.file.AccessDeniedException: /etc/elasticsearch/elasticsearch.keystore.tmp\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:90)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at java.base/sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:219)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:478)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at java.base/java.nio.file.Files.newOutputStream(Files.java:223)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.apache.lucene.store.FSDirectory$FSIndexOutput.<init>(FSDirectory.java:410)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.apache.lucene.store.FSDirectory$FSIndexOutput.<init>(FSDirectory.java:406)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.apache.lucene.store.FSDirectory.createOutput(FSDirectory.java:254)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.common.settings.KeyStoreWrapper.save(KeyStoreWrapper.java:484)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.bootstrap.Bootstrap.loadSecureSettings(Bootstrap.java:242)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:305)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.cli.Command.main(Command.java:90)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:115)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92)\r\nJan 16 11:45:55 test206 elasticsearch[10611]: Refer to the log for complete error details.\r\nJan 16 11:45:55 test206 systemd[1]: elasticsearch.service: main process exited, code=exited, status=1/FAILURE\r\nJan 16 11:45:55 test206 systemd[1]: Failed to start Elasticsearch.\r\n-- Subject: Unit elasticsearch.service has failed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/574969592","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-574969592","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":574969592,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NDk2OTU5Mg==","user":{"login":"Daych","id":52278989,"node_id":"MDQ6VXNlcjUyMjc4OTg5","avatar_url":"https://avatars3.githubusercontent.com/u/52278989?v=4","gravatar_id":"","url":"https://api.github.com/users/Daych","html_url":"https://github.com/Daych","followers_url":"https://api.github.com/users/Daych/followers","following_url":"https://api.github.com/users/Daych/following{/other_user}","gists_url":"https://api.github.com/users/Daych/gists{/gist_id}","starred_url":"https://api.github.com/users/Daych/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Daych/subscriptions","organizations_url":"https://api.github.com/users/Daych/orgs","repos_url":"https://api.github.com/users/Daych/repos","events_url":"https://api.github.com/users/Daych/events{/privacy}","received_events_url":"https://api.github.com/users/Daych/received_events","type":"User","site_admin":false},"created_at":"2020-01-16T03:50:28Z","updated_at":"2020-01-16T03:50:28Z","author_association":"NONE","body":"I got the same issue that installed es 7.5.1 by \"yum install elasticsearch\" when starting the service","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/575176366","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-575176366","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":575176366,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NTE3NjM2Ng==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-16T14:28:57Z","updated_at":"2020-01-16T14:28:57Z","author_association":"CONTRIBUTOR","body":"@Daych Was this a fresh installation, or was it an upgrade from a previous version of Elasticsearch?\r\n\r\nAssuming Elasticsearch has been installed to `/usr/share/elasticsearch`, does the command `sudo /usr/share/elasticsearch/bin/elasticsearch-keystore upgrade` fix the problem for you?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/575524023","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-575524023","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":575524023,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NTUyNDAyMw==","user":{"login":"Daych","id":52278989,"node_id":"MDQ6VXNlcjUyMjc4OTg5","avatar_url":"https://avatars3.githubusercontent.com/u/52278989?v=4","gravatar_id":"","url":"https://api.github.com/users/Daych","html_url":"https://github.com/Daych","followers_url":"https://api.github.com/users/Daych/followers","following_url":"https://api.github.com/users/Daych/following{/other_user}","gists_url":"https://api.github.com/users/Daych/gists{/gist_id}","starred_url":"https://api.github.com/users/Daych/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Daych/subscriptions","organizations_url":"https://api.github.com/users/Daych/orgs","repos_url":"https://api.github.com/users/Daych/repos","events_url":"https://api.github.com/users/Daych/events{/privacy}","received_events_url":"https://api.github.com/users/Daych/received_events","type":"User","site_admin":false},"created_at":"2020-01-17T08:18:49Z","updated_at":"2020-01-17T08:18:49Z","author_association":"NONE","body":"@williamrandolph Hi William, I had installed the elasticsearch 6.8.5 before, then I just remove all the file related to the elasticsearch before I install the 7.5.1 version","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580460738","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-580460738","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":580460738,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDQ2MDczOA==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-30T21:08:54Z","updated_at":"2020-01-30T21:08:54Z","author_association":"CONTRIBUTOR","body":"This issue is continuing to come up in various environments, and I still haven't traced down why.\r\n\r\nThe intention is for the RPM scripts to handle all of the keystore setup so that the Elasticsearch application will not try to do any writing in the configuration directory. Our work in this direction fell under #28928 and #41755.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580768355","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-580768355","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":580768355,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDc2ODM1NQ==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-31T15:01:02Z","updated_at":"2020-01-31T15:01:02Z","author_association":"CONTRIBUTOR","body":"A summary of where we are right now:\r\n\r\nThe intended workaround for this problem is running `sudo /usr/share/elasticsearch/bin/elasticsearch-keystore upgrade` and then restart Elasticsearch, but I would still like to understand how the RPM upgrade failure is happening in the first place.\r\n\r\nWhen you're running Elasticsearch as a `systemd` service, your keystore needs to be set up correctly before you start the Elasticsearch service. It needs to be in the latest keystore format, and it needs to have a value for `keystore.seed`. The `elasticsearch-keystore upgrade` command will take care of both of these things if you run it before starting Elasticsearch. Otherwise, the Elasticsearch service will try to upgrade the keystore on startup, and will likely fail because we have deliberately restricted its write permissions during runtime.\r\n\r\nThus, it's easy to create a situation where you get a `unable to create temporary keystore` error on startup by either (1) deleting the keystore after upgrading the RPM but before starting Elasticsearch or (2) removing the `keystore.seed` value from the keystore. In either case, the fix is to run `sudo /usr/share/elasticsearch/bin/elasticsearch-keystore upgrade`.\r\n\r\nWhen we upgrade the RPM, we intend to have the `posttrans` scriptlet take care of the keystore situation. This scriptlet should be the [very last scriptlet to run during the upgrade process](https://docs.fedoraproject.org/en-US/packaging-guidelines/Scriptlets/#ordering) If the keystore exists as a regular file, then we run the upgrade command; if it doesn't exist, we create it.\r\n\r\nIn the case above where the `.elasticsearch.keystore.initial_md5sum` had size 0, there likely would have been an error displayed in the stdout of the yum upgrade process. Unfortunately, it doesn't seem like that error would be logged anywhere under a default setup. I managed to force this outcome by removing `md5sum` from the root shell path. Although this change didn't replicate the error, it did create error output in the yum stdout:\r\n\r\n```\r\nRunning transaction check\r\nRunning transaction test\r\nTransaction test succeeded\r\nRunning transaction\r\n  Updating   : elasticsearch-7.5.1-1.x86_64 \r\n/var/tmp/rpm-tmp.1sqM6w: line 75: md5sum: command not found  # <-- this is the error message\r\n  Cleanup    : elasticsearch-7.4.2-1.x86_64\r\n  Verifying  : elasticsearch-7.5.1-1.x86_64\r\n  Verifying  : elasticsearch-7.4.2-1.x86_64\r\n\r\nUpdated:\r\n  elasticsearch.x86_64 0:7.5.1-1\r\n```\r\n\r\nIf anyone runs into this problem and is able to view output from the `yum upgrade` command, there might be helpful information there.\r\n\r\nSince one way the `posttrans` script could fail and leave a md5sum file with size 0 is if the `posttrans` script doesn't have the `md5sum` utility on its path, on a system where this upgrade fails, I'd be curious to know the output of `sudo sh -c 'echo %PATH'` and `which md5sum`.\r\n\r\nI would like to fix this problem for our users, but I need enough information to reproduce it first.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580795208","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-580795208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":580795208,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDc5NTIwOA==","user":{"login":"erempel","id":8525120,"node_id":"MDQ6VXNlcjg1MjUxMjA=","avatar_url":"https://avatars3.githubusercontent.com/u/8525120?v=4","gravatar_id":"","url":"https://api.github.com/users/erempel","html_url":"https://github.com/erempel","followers_url":"https://api.github.com/users/erempel/followers","following_url":"https://api.github.com/users/erempel/following{/other_user}","gists_url":"https://api.github.com/users/erempel/gists{/gist_id}","starred_url":"https://api.github.com/users/erempel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erempel/subscriptions","organizations_url":"https://api.github.com/users/erempel/orgs","repos_url":"https://api.github.com/users/erempel/repos","events_url":"https://api.github.com/users/erempel/events{/privacy}","received_events_url":"https://api.github.com/users/erempel/received_events","type":"User","site_admin":false},"created_at":"2020-01-31T16:06:50Z","updated_at":"2020-01-31T16:06:50Z","author_association":"NONE","body":"reinstalling the same 7.5.1 RPM I get the following issue that prevents the posttrans from running correctly.\r\n\r\nRunning transaction\r\n  Installing : elasticsearch-7.5.1-1.x86_64                                                                                                                                                         1/1 \r\nES_PATH_CONF must be set to the configuration path\r\nwarning: %posttrans(elasticsearch-0:7.5.1-1.x86_64) scriptlet failed, exit status 1\r\nNon-fatal POSTTRANS scriptlet failure in rpm package elasticsearch-7.5.1-1.x86_64\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580809194","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-580809194","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":580809194,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDgwOTE5NA==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-31T16:36:57Z","updated_at":"2020-01-31T16:36:57Z","author_association":"CONTRIBUTOR","body":"@erempel Ah, that's very interesting. The `ES_PATH_CONF` value is supposed to be set in the `/etc/sysconfig/elasticsearch` script, which gets loaded when `posttrans` runs `elasticsearch-keystore`. Does your `/etc/sysconfig/elasticsearch` file have the line `ES_PATH_CONF=/etc/elasticsearch`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580825230","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-580825230","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":580825230,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDgyNTIzMA==","user":{"login":"erempel","id":8525120,"node_id":"MDQ6VXNlcjg1MjUxMjA=","avatar_url":"https://avatars3.githubusercontent.com/u/8525120?v=4","gravatar_id":"","url":"https://api.github.com/users/erempel","html_url":"https://github.com/erempel","followers_url":"https://api.github.com/users/erempel/followers","following_url":"https://api.github.com/users/erempel/following{/other_user}","gists_url":"https://api.github.com/users/erempel/gists{/gist_id}","starred_url":"https://api.github.com/users/erempel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erempel/subscriptions","organizations_url":"https://api.github.com/users/erempel/orgs","repos_url":"https://api.github.com/users/erempel/repos","events_url":"https://api.github.com/users/erempel/events{/privacy}","received_events_url":"https://api.github.com/users/erempel/received_events","type":"User","site_admin":false},"created_at":"2020-01-31T17:15:55Z","updated_at":"2020-01-31T17:15:55Z","author_association":"NONE","body":"No, it does not.\r\nI guess that is an oversight on our configuration of elasticsearch. We were getting ready to abandon that in favor of the systemd unit.service file configuration structures (/etc/systemd/system/elasticsearch.conf.d/XXX)\r\n\r\nI thought that we had included all of the un-commented settings from the original elasticsearch.conf file and set any settings in our ansible deploy tasks.\r\n\r\nI guess I will be adding this one back in.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580886291","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-580886291","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":580886291,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDg4NjI5MQ==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-31T19:54:09Z","updated_at":"2020-01-31T19:54:09Z","author_association":"CONTRIBUTOR","body":"@erempel I'm able to reproduce the error now. I hope that adding `ES_PATH_CONF=/etc/elasticsearch` to `/etc/sysconfig/elasticsearch` can be a workaround in the short term. But I think it's strange and certainly not obvious that this setting needs to be in place for RPM upgrades to work correctly.\r\n\r\nI'm going to see if I can put out a fix so that if an error like this happens in the scriptlet, the RPM upgrade will fail with a reasonable message, and to make sure that `ES_PATH_CONF` gets a default setting during RPM upgrades.\r\n\r\nThank you for reporting this issue and helping me figure out how to reproduce it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580923024","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-580923024","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":580923024,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDkyMzAyNA==","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"created_at":"2020-01-31T21:41:25Z","updated_at":"2020-01-31T21:41:25Z","author_association":"CONTRIBUTOR","body":"It looks like we've already done something to address this problem on the development branch. See #50158 and #50246.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/712378854","html_url":"https://github.com/elastic/elasticsearch/issues/50631#issuecomment-712378854","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","id":712378854,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMjM3ODg1NA==","user":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","site_admin":false},"created_at":"2020-10-19T19:01:08Z","updated_at":"2020-10-19T19:01:08Z","author_association":"NONE","body":"FWIW I ran into similar problems because a elasticsearch 5.6 version of /etc/sysconfig/elasticsearch (which does not have ES_PATH_CONF) was placed into an elasticsearch 6.8 install. Upgrading to 7.5.2 reported a lot of errors and I had to manually fix the keystore.","performed_via_github_app":null}]