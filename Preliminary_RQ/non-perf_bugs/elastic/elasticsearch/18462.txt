{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18462","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18462/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18462/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18462/events","html_url":"https://github.com/elastic/elasticsearch/issues/18462","id":155734356,"node_id":"MDU6SXNzdWUxNTU3MzQzNTY=","number":18462,"title":"Heap_size error when network.host is set","user":{"login":"TonyRode","id":4587307,"node_id":"MDQ6VXNlcjQ1ODczMDc=","avatar_url":"https://avatars1.githubusercontent.com/u/4587307?v=4","gravatar_id":"","url":"https://api.github.com/users/TonyRode","html_url":"https://github.com/TonyRode","followers_url":"https://api.github.com/users/TonyRode/followers","following_url":"https://api.github.com/users/TonyRode/following{/other_user}","gists_url":"https://api.github.com/users/TonyRode/gists{/gist_id}","starred_url":"https://api.github.com/users/TonyRode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TonyRode/subscriptions","organizations_url":"https://api.github.com/users/TonyRode/orgs","repos_url":"https://api.github.com/users/TonyRode/repos","events_url":"https://api.github.com/users/TonyRode/events{/privacy}","received_events_url":"https://api.github.com/users/TonyRode/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":13,"created_at":"2016-05-19T13:17:40Z","updated_at":"2016-07-15T18:31:14Z","closed_at":"2016-05-19T13:26:08Z","author_association":"NONE","active_lock_reason":null,"body":"Hello everyone,\n\n**Elasticsearch version**:\n\n```\n  \"version\" : {\n    \"number\" : \"5.0.0-alpha2\"\n```\n\n**JVM version**:\n`openjdk version \"1.8.0_91\"`\n\n**OS version**:\n\n```\nDistributor ID: Ubuntu\nDescription:    Ubuntu 14.04.3 LTS\nRelease:    14.04\nCodename:   trusty\n```\n\n**Description of the problem including expected versus actual behavior**:\n\nI'm trying to set up a cluster of 2 Elasticsearch nodes.\nI'm experimenting a bug when I try to set the network.host setting in elasticsearch.yml.\nWhen I let it commented no problem, Elasticsearch starts normally, but I believe that I need to set it in the config file of each node in order to make the nodes visible.\n\nSo the problem is that the log message concerns the HEAP_SIZE, (parameter that I tried to modify in /etc/default/elasticsearch), whereas my action is to set the network.host parameter.\n\n**Steps to reproduce**:\n1. Given 2 VMs with the same configuration (Java / Elasticsearch). Each machine can ping the other one. The problem happens when I try to start Elasticsearch on a node (each of both, same problem).\n2. /etc/elasticsearch/elasticsearch.yml on machine 1 :\n\n```\ncluster.name: graylog\nnode.name: elasticsearch1\n#network.host: [\"IP.OF.NODE.1\", \"127.0.0.1\"]\ndiscovery.zen.ping.unicast.hosts: [\"IP.OF.NODE.2\"]\ndiscovery.zen.minimum_master_nodes: 1\n```\n1. Elasticsearch starts just fine. Now if we uncomment network.host\n\n```\ncluster.name: graylog\nnode.name: elasticsearch1\nnetwork.host: [\"IP.OF.NODE.1\", \"127.0.0.1\"]\ndiscovery.zen.ping.unicast.hosts: [\"IP.OF.NODE.2\"]\ndiscovery.zen.minimum_master_nodes: 1\n```\n1. Now Elasticsearch refuses to start properly, with the following error message in the logs.\n\n**Provide logs (if relevant)**:\n\n```\n[2016-05-19 14:58:16,436][INFO ][node                     ] [elasticsearch1] version[5.0.0-alpha2], pid[5762], build[e3126df/2016-04-26T12:08:58.960Z]\n[2016-05-19 14:58:16,437][INFO ][node                     ] [elasticsearch1] initializing ...\n[2016-05-19 14:58:16,819][INFO ][plugins                  ] [elasticsearch1] modules [lang-mustache, lang-painless, ingest-grok, reindex, lang-expression, lang-groovy], plugins []\n[2016-05-19 14:58:16,836][INFO ][env                      ] [elasticsearch1] using [1] data paths, mounts [[/ (/dev/sda1)]], net usable_space [21.9gb], net total_space [27.4gb], spins? [possibly], types [ext4]\n[2016-05-19 14:58:16,837][INFO ][env                      ] [elasticsearch1] heap size [1007.3mb], compressed ordinary object pointers [true]\n[2016-05-19 14:58:18,701][INFO ][node                     ] [elasticsearch1] initialized\n[2016-05-19 14:58:18,702][INFO ][node                     ] [elasticsearch1] starting ...\n[2016-05-19 14:58:18,808][INFO ][transport                ] [elasticsearch1] publish_address {IP.OF.NODE.1:9300}, bound_addresses {127.0.0.1:9300}, {IP.OF.NODE.1:9300}\n[2016-05-19 14:58:18,812][ERROR][bootstrap                ] [elasticsearch1] Exception\njava.lang.RuntimeException: bootstrap checks failed\ninitial heap size [268435456] not equal to maximum heap size [1073741824]; this can cause resize pauses and prevents mlockall from locking the entire heap\nat org.elasticsearch.bootstrap.BootstrapCheck.check(BootstrapCheck.java:93)\nat org.elasticsearch.bootstrap.BootstrapCheck.check(BootstrapCheck.java:66)\nat org.elasticsearch.bootstrap.Bootstrap$5.validateNodeBeforeAcceptingRequests(Bootstrap.java:191)\nat org.elasticsearch.node.Node.start(Node.java:323)\nat org.elasticsearch.bootstrap.Bootstrap.start(Bootstrap.java:206)\nat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:269)\nat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:111)\nat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:106)\nat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:91)\nat org.elasticsearch.cli.Command.main(Command.java:53)\nat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:74)\nat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:67)\nSuppressed: java.lang.IllegalStateException: initial heap size [268435456] not equal to maximum heap size [1073741824]; this can cause resize pauses and prevents mlockall from locking the entire heap\nat java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\nat java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1374)\nat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\nat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\nat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\nat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\nat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\nat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)\nat org.elasticsearch.bootstrap.BootstrapCheck.check(BootstrapCheck.java:94)\n... 11 more\n[2016-05-19 14:58:18,814][INFO ][node                     ] [elasticsearch1] stopping ...\n[2016-05-19 14:58:18,827][INFO ][node                     ] [elasticsearch1] stopped\n[2016-05-19 14:58:18,827][INFO ][node                     ] [elasticsearch1] closing ...\n[2016-05-19 14:58:18,842][INFO ][node                     ] [elasticsearch1] closed\n\n```\n\n**Describe the feature**:\nAny help or enlightenment would be appreciated :)\n\nThanks !\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}