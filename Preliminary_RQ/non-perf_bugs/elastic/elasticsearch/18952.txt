{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18952","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18952/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18952/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18952/events","html_url":"https://github.com/elastic/elasticsearch/issues/18952","id":161013462,"node_id":"MDU6SXNzdWUxNjEwMTM0NjI=","number":18952,"title":"Allow to run elasticsearch queries as \"raw json\" string like in curl requests","user":{"login":"cforce","id":393286,"node_id":"MDQ6VXNlcjM5MzI4Ng==","avatar_url":"https://avatars0.githubusercontent.com/u/393286?v=4","gravatar_id":"","url":"https://api.github.com/users/cforce","html_url":"https://github.com/cforce","followers_url":"https://api.github.com/users/cforce/followers","following_url":"https://api.github.com/users/cforce/following{/other_user}","gists_url":"https://api.github.com/users/cforce/gists{/gist_id}","starred_url":"https://api.github.com/users/cforce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cforce/subscriptions","organizations_url":"https://api.github.com/users/cforce/orgs","repos_url":"https://api.github.com/users/cforce/repos","events_url":"https://api.github.com/users/cforce/events{/privacy}","received_events_url":"https://api.github.com/users/cforce/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-06-18T08:16:12Z","updated_at":"2016-06-20T07:04:31Z","closed_at":"2016-06-18T15:31:24Z","author_association":"NONE","active_lock_reason":null,"body":"Allow to run elasticsearch queries as \"raw json\" strings .\n\n```\n{\n    ...,\n\n    \"aggs\" : {\n        \"grades_count\" : {\n            \"value_count\" : {\n                \"script\" : {\n                    \"file\": \"my_script\",\n                    \"params\" : {\n                        \"field\" : \"grade\"\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\n Currently to run them through spring data es, i have to rebuild them with a builder pattern. But i just want to load some external ready to use query in form as json that used on the low level api as you would do with curl. The jest client ( https://github.com/spring-projects/spring-data-elasticsearch/pull/147 ) does not work on local embeeded elasticsearch. Thats the reason the ElasticSearchTemplate does not provide the needed API to run that kind of raw query (like for exmaple the SearchSourceBuilder in Jest) . In https://github.com/elastic/elasticsearch/pull/18735 it was created a new pull request, but does it support this requirement?\nThe following restrictions have to get solved:\n- JestElasticsearchTemplate() does not implement the getClient() method.\n\n```\npublic class JestElasticsearchTemplate implements ElasticsearchOperations, ApplicationContextAware {...\n@Override\n    public Client getClient() {\n        throw new UnsupportedOperationException();\n    }\n```\n- Spring data \"ElasticsearchTemplate\" does not implement raw string query feature like the example query (with aggs!!!) from above. \n- The base class \"ElasticsearchOperations\" does not provide the raw string query feature from JestElasticsearchTemplate()\n\nHer i tried to make use of a snapshot of https://github.com/spring-projects/spring-data-elasticsearch/pull/147\n\n```\n@Bean\n    public ElasticsearchOperations elasticsearchTemplate() {\n\n        ElasticsearchOperations elasticsearchOperations;\n        if (connection.isEmbedded()) {\n            Client client = NodeBuilder.nodeBuilder().local(true).node().client();\n            elasticsearchOperations = new ElasticsearchTemplate(client);\n        } else {\n            JestClientFactory factory = new JestClientFactory();\n            factory.setHttpClientConfig(new HttpClientConfig.Builder(connection.getUrl())\n                    .multiThreaded(connection.isMultiThreaded()).build());\n            JestClient client = factory.getObject();\n            elasticsearchOperations = new JestElasticsearchTemplate(client);\n        }\n        return elasticsearchOperations;\n    }\n```\n","closed_by":{"login":"cforce","id":393286,"node_id":"MDQ6VXNlcjM5MzI4Ng==","avatar_url":"https://avatars0.githubusercontent.com/u/393286?v=4","gravatar_id":"","url":"https://api.github.com/users/cforce","html_url":"https://github.com/cforce","followers_url":"https://api.github.com/users/cforce/followers","following_url":"https://api.github.com/users/cforce/following{/other_user}","gists_url":"https://api.github.com/users/cforce/gists{/gist_id}","starred_url":"https://api.github.com/users/cforce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cforce/subscriptions","organizations_url":"https://api.github.com/users/cforce/orgs","repos_url":"https://api.github.com/users/cforce/repos","events_url":"https://api.github.com/users/cforce/events{/privacy}","received_events_url":"https://api.github.com/users/cforce/received_events","type":"User","site_admin":false},"performed_via_github_app":null}