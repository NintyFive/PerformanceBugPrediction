[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426397159","html_url":"https://github.com/elastic/elasticsearch/issues/34232#issuecomment-426397159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","id":426397159,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjM5NzE1OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T19:17:13Z","updated_at":"2018-10-02T19:17:13Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426397196","html_url":"https://github.com/elastic/elasticsearch/issues/34232#issuecomment-426397196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","id":426397196,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjM5NzE5Ng==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T19:17:22Z","updated_at":"2018-10-02T19:17:22Z","author_association":"CONTRIBUTOR","body":"@jimczi, could you have a look at this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426405945","html_url":"https://github.com/elastic/elasticsearch/issues/34232#issuecomment-426405945","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","id":426405945,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjQwNTk0NQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T19:47:22Z","updated_at":"2018-10-02T19:47:22Z","author_association":"MEMBER","body":"This is the expected behavior. The sort values are used to filter documents that compare smaller (or greater depending on the order of the sort). If you want to ensure that the response starts exactly at the `search_after` values you'll need to check the first hit in the response and compare the `sort` values from those provided in the query. However the values used in a `search_after` query are usually  extracted from the last hit of the previous search so you shouldn't deal with partial values at all. Can you explain what you're trying to achieve with `search_after`? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427383133","html_url":"https://github.com/elastic/elasticsearch/issues/34232#issuecomment-427383133","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","id":427383133,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzM4MzEzMw==","user":{"login":"patrykk21","id":39259934,"node_id":"MDQ6VXNlcjM5MjU5OTM0","avatar_url":"https://avatars1.githubusercontent.com/u/39259934?v=4","gravatar_id":"","url":"https://api.github.com/users/patrykk21","html_url":"https://github.com/patrykk21","followers_url":"https://api.github.com/users/patrykk21/followers","following_url":"https://api.github.com/users/patrykk21/following{/other_user}","gists_url":"https://api.github.com/users/patrykk21/gists{/gist_id}","starred_url":"https://api.github.com/users/patrykk21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/patrykk21/subscriptions","organizations_url":"https://api.github.com/users/patrykk21/orgs","repos_url":"https://api.github.com/users/patrykk21/repos","events_url":"https://api.github.com/users/patrykk21/events{/privacy}","received_events_url":"https://api.github.com/users/patrykk21/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T14:22:51Z","updated_at":"2018-10-05T14:22:51Z","author_association":"CONTRIBUTOR","body":"Sorry for the late reply! And thank you for answering so quickly\r\n\r\nYes, the reason I was encountering confusion and/or issues is that the same module is being included into multiple classes.\r\n\r\nIt wasn't an issue as long as the models we were using were only relying on a primary key. However it became one as soon as we introduced an elasticsearch index for a model using a composite key (DynamoDB).\r\n\r\nLet's say those keys are called `id` and `owner_id`, the uniqueness on DynamoDB is maintained as the composite key is made of both `id` and `owner_id`. That means there can be documents with the same `id` but not documents with the same `id` AND the same `owner_id`. Therefore I started saving those documents not with `_id = id` but with `_id = composite_id`, where `_id` represents the elasticsearch document id.\r\n\r\nThe common module we were using was running the `search_after` API using the `id` key.\r\n\r\nAll tests were passing since it was correctly paginating even though the actual `_id` value in the elasticsearch index was actually representing the composite key (`id` + `owner_id`) since it was matching the first part of the `_id` (`id` + `owner_id`) with `id`.\r\n\r\nNot long after I noticed reviewing the code that I was using `id` instead of the composite_id in the search_after API and I wondered and played around trying to understand why all tests were passing anyway.\r\n\r\nIn fact it was because the `search_after` API seems to return all results after a document with a partial match on the `_id` value. \r\n\r\nSo if we had a document like:\r\n\r\n```\r\n_id: 'testid_testownerid',\r\n_source: {\r\n  id: 'testid',\r\n  owner_id: 'testownerid'\r\n}\r\n```\r\n\r\nand we ran a `search_after` with a sort on `_id` for the value of 'testid', it would still return all results after that document even though the two strings weren't completely matching ('testid_testownerid' != 'testid')\r\n\r\nI'm not saying this behaviour is wrong, but It would have saved me so much time if it was documented. I don't feel it as a straightforward and obvious way of working. I think there should be a couple of words regarding it.\r\n\r\nOverall I think you did a great job with elastcisearch and it's within my intentions to try to help you improve it, even by a little margin, if possible.\r\n\r\nAlso, sorry if I sound so repetitive and specific, I'm just trying to give you the best explanation of the situation to help you understand.\r\n\r\nThank you and let me know!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427387958","html_url":"https://github.com/elastic/elasticsearch/issues/34232#issuecomment-427387958","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","id":427387958,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzM4Nzk1OA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T14:37:18Z","updated_at":"2018-10-05T14:37:18Z","author_association":"MEMBER","body":"> Overall I think you did a great job with elastcisearch and it's within my intentions to try to help you improve it, even by a little margin, if possible\r\n\r\nThanks, your help is welcome !  I agree that we could add a small note regarding how we handle the provided sort values in `search_after`. Would you like to contribute with improving the documentation ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427394035","html_url":"https://github.com/elastic/elasticsearch/issues/34232#issuecomment-427394035","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","id":427394035,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzM5NDAzNQ==","user":{"login":"patrykk21","id":39259934,"node_id":"MDQ6VXNlcjM5MjU5OTM0","avatar_url":"https://avatars1.githubusercontent.com/u/39259934?v=4","gravatar_id":"","url":"https://api.github.com/users/patrykk21","html_url":"https://github.com/patrykk21","followers_url":"https://api.github.com/users/patrykk21/followers","following_url":"https://api.github.com/users/patrykk21/following{/other_user}","gists_url":"https://api.github.com/users/patrykk21/gists{/gist_id}","starred_url":"https://api.github.com/users/patrykk21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/patrykk21/subscriptions","organizations_url":"https://api.github.com/users/patrykk21/orgs","repos_url":"https://api.github.com/users/patrykk21/repos","events_url":"https://api.github.com/users/patrykk21/events{/privacy}","received_events_url":"https://api.github.com/users/patrykk21/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T14:55:27Z","updated_at":"2018-10-05T14:55:27Z","author_association":"CONTRIBUTOR","body":"I think the most fitting place for such information would be [this doc page](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-search-after.html). Do you think it would be possible?\r\n\r\nHowever, if we are talking about this repo I'll create a PR in the next couple of days if I find a fitting place.\r\n\r\nThank you","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427447075","html_url":"https://github.com/elastic/elasticsearch/issues/34232#issuecomment-427447075","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","id":427447075,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzQ0NzA3NQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T17:50:44Z","updated_at":"2018-10-05T17:50:44Z","author_association":"MEMBER","body":"> I think the most fitting place for such information would be this doc page. Do you think it would be possible?\r\n\r\nYes that's possible, the doc page is in this repo, you can find it [here](https://github.com/elastic/elasticsearch/blob/master/docs/reference/search/request/search-after.asciidoc) and create a PR to modify it.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/443185059","html_url":"https://github.com/elastic/elasticsearch/issues/34232#issuecomment-443185059","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","id":443185059,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MzE4NTA1OQ==","user":{"login":"patrykk21","id":39259934,"node_id":"MDQ6VXNlcjM5MjU5OTM0","avatar_url":"https://avatars1.githubusercontent.com/u/39259934?v=4","gravatar_id":"","url":"https://api.github.com/users/patrykk21","html_url":"https://github.com/patrykk21","followers_url":"https://api.github.com/users/patrykk21/followers","following_url":"https://api.github.com/users/patrykk21/following{/other_user}","gists_url":"https://api.github.com/users/patrykk21/gists{/gist_id}","starred_url":"https://api.github.com/users/patrykk21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/patrykk21/subscriptions","organizations_url":"https://api.github.com/users/patrykk21/orgs","repos_url":"https://api.github.com/users/patrykk21/repos","events_url":"https://api.github.com/users/patrykk21/events{/privacy}","received_events_url":"https://api.github.com/users/patrykk21/received_events","type":"User","site_admin":false},"created_at":"2018-11-30T12:08:24Z","updated_at":"2018-11-30T12:08:24Z","author_association":"CONTRIBUTOR","body":"I created a [PR](https://github.com/elastic/elasticsearch/pull/36111)\r\n\r\nLet me know.","performed_via_github_app":null}]