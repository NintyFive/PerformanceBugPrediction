[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346795191","html_url":"https://github.com/elastic/elasticsearch/issues/27502#issuecomment-346795191","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27502","id":346795191,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Njc5NTE5MQ==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2017-11-24T10:26:03Z","updated_at":"2017-11-24T10:26:03Z","author_association":"CONTRIBUTOR","body":"> As Far as I knew doc count includes both the primaries and replicas.\r\n\r\nDocs count from replicas are not counted.\r\n\r\nDocs count is very similar. Most likely an automatic [refresh](https://www.elastic.co/guide/en/elasticsearch/reference/5.4/indices-refresh.html) triggered on some of the shards in between the `_cluster/stats` and `_nodes/stats` operations (which are asynchronous and composite).\r\n\r\n\r\nPlease first visit the [forum](https://discuss.elastic.co/c/elasticsearch) for questions. We try to keep github for issues only. For example you should make sure indexing is disabled (by making the index [read-only](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-stats.html)), then issue a `_refresh` and run the stats commands. If then they differ, then it might be an issue worth of github :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346800671","html_url":"https://github.com/elastic/elasticsearch/issues/27502#issuecomment-346800671","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27502","id":346800671,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NjgwMDY3MQ==","user":{"login":"SKumarMN","id":2056311,"node_id":"MDQ6VXNlcjIwNTYzMTE=","avatar_url":"https://avatars2.githubusercontent.com/u/2056311?v=4","gravatar_id":"","url":"https://api.github.com/users/SKumarMN","html_url":"https://github.com/SKumarMN","followers_url":"https://api.github.com/users/SKumarMN/followers","following_url":"https://api.github.com/users/SKumarMN/following{/other_user}","gists_url":"https://api.github.com/users/SKumarMN/gists{/gist_id}","starred_url":"https://api.github.com/users/SKumarMN/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SKumarMN/subscriptions","organizations_url":"https://api.github.com/users/SKumarMN/orgs","repos_url":"https://api.github.com/users/SKumarMN/repos","events_url":"https://api.github.com/users/SKumarMN/events{/privacy}","received_events_url":"https://api.github.com/users/SKumarMN/received_events","type":"User","site_admin":false},"created_at":"2017-11-24T10:51:55Z","updated_at":"2017-11-24T10:54:38Z","author_association":"NONE","body":"@albertzaharovits \r\nThanks for your reply. When I took the snap, I had made sure there wasn't any indexing happening and I saw the same stats for hours together. Hence raised it an issue here.  \r\nI did manually invoke _refresh and when i execute the stats command i still same results. \r\nCluster doc count matches the  sum of all the primaries obtained via _cat/indices api.  sum of doc count obtained using _node/stats is not matching sum of all the primaries obtained via _cat/indices api or Cluster doc count obtained using _cluster/stats API. \r\nThe issue is clearly reproducible. Can you please recheck this issue at you side too.\r\n\r\nEvery index is made read only and _refresh is manually called. One of the index settings are as shown below to confirm that the index is made read only\r\n`catalog: {\r\nsettings: {\r\nindex: {\r\nmapping: {\r\ntotal_fields: {\r\nlimit: \"2000\"\r\n}\r\n},\r\nrefresh_interval: \"10s\",\r\nnumber_of_shards: \"5\",\r\n**blocks: {\r\nread_only: \"true\"**\r\n}`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346830986","html_url":"https://github.com/elastic/elasticsearch/issues/27502#issuecomment-346830986","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27502","id":346830986,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NjgzMDk4Ng==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2017-11-24T13:40:29Z","updated_at":"2017-11-24T13:41:49Z","author_association":"CONTRIBUTOR","body":"@SKumarMN \r\nYou are right, the two metrics do differ.\r\n`_cluster/stats` and `_cat/indices` return stats from lucene internals.\r\n`_node/stats` and `my_index/_count` return documents from the ES perspective, by doing a search.\r\nThe two values can be different if, for example, there are nested documents; Nested documents are counted by lucene but not by ES.\r\nThis is not a bug, see also: https://github.com/elastic/elasticsearch/issues/25868 . ","performed_via_github_app":null}]