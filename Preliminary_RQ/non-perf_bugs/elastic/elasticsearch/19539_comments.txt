[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/235569863","html_url":"https://github.com/elastic/elasticsearch/issues/19539#issuecomment-235569863","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19539","id":235569863,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNTU2OTg2Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-07-27T12:27:01Z","updated_at":"2016-07-27T12:27:01Z","author_association":"MEMBER","body":"> My assumption is that the names of the clauses that matched each doc accompany it as it is collected so that they can be displayed in top hits. If correct, this means a new bucket agg could route docs into buckets based on these query names. I don't think this would require any special parameters in the DSL so would look something like this:\n\nThe named queries are applied during the fetch phase on the top documents only. They are not extracted during the search phase since it's cheaper to replay the named queries on the top documents as long as the number of top hits is small. \n\n> An interesting twist is that a named_queries agg could be nested under another named_queries agg and the results effectively represent a weighted graph showing if poultry or meat was a more common ingredient with pasta dishes.\n\nAre `filters` aggs not enough for this use case ?\n\n```\n{\n   \"aggs\": {\n      \"clauses\": {\n         \"filters\": {\n            \"filters\": {\n               \"poultry\": {\n                  \"term\": {\n                     \"body\": \"chicken turkey\"\n                  }\n               },\n               \"meat\": {\n                  \"term\": {\n                     \"body\": \"spaghetti penne linguine\"\n                  }\n               }\n            }\n         },\n         \"aggs\": {\n            \"cooccurrence\": {\n               \"filters\": {\n                  \"filters\": {\n                     \"pasta\": {\n                        \"term\": {\n                           \"body\": \"spaghetti penne linguine\"\n                        }\n                     }\n                  }\n               }\n            }\n         }\n      }\n   }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/235594723","html_url":"https://github.com/elastic/elasticsearch/issues/19539#issuecomment-235594723","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19539","id":235594723,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNTU5NDcyMw==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-07-27T14:03:18Z","updated_at":"2016-07-27T14:03:18Z","author_association":"CONTRIBUTOR","body":"> The named queries are applied during the fetch phase on the top documents only\n\nAh - thanks, @jimferenczi that clears up some of the mystery on how the names appear :)\n\n> Are filters aggs not enough for this use case ?\n\nYes, but I had assumed that the names were context in the search phase so offering them in aggs felt like a cheap by-product of running an existing query - so you could run a search for the top N docs and also get some overview of how your search concepts inter-relate.\nI can see now that this isn't query data that is cheaply recycled for use in aggs so will close the issue.\n","performed_via_github_app":null}]