[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/639324644","html_url":"https://github.com/elastic/elasticsearch/issues/57711#issuecomment-639324644","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57711","id":639324644,"node_id":"MDEyOklzc3VlQ29tbWVudDYzOTMyNDY0NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-06-05T08:03:24Z","updated_at":"2020-06-05T08:03:24Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security (:Security/Authentication)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/639518858","html_url":"https://github.com/elastic/elasticsearch/issues/57711#issuecomment-639518858","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57711","id":639518858,"node_id":"MDEyOklzc3VlQ29tbWVudDYzOTUxODg1OA==","user":{"login":"ywangd","id":2344308,"node_id":"MDQ6VXNlcjIzNDQzMDg=","avatar_url":"https://avatars3.githubusercontent.com/u/2344308?v=4","gravatar_id":"","url":"https://api.github.com/users/ywangd","html_url":"https://github.com/ywangd","followers_url":"https://api.github.com/users/ywangd/followers","following_url":"https://api.github.com/users/ywangd/following{/other_user}","gists_url":"https://api.github.com/users/ywangd/gists{/gist_id}","starred_url":"https://api.github.com/users/ywangd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywangd/subscriptions","organizations_url":"https://api.github.com/users/ywangd/orgs","repos_url":"https://api.github.com/users/ywangd/repos","events_url":"https://api.github.com/users/ywangd/events{/privacy}","received_events_url":"https://api.github.com/users/ywangd/received_events","type":"User","site_admin":false},"created_at":"2020-06-05T14:09:35Z","updated_at":"2020-06-05T14:11:25Z","author_association":"MEMBER","body":"First of all, changes of #53453 can be [reverted cleanly](https://github.com/ywangd/elasticsearch/commit/9df869755662c8716990fd0e57ebb8c8ce29312a) on `7.8` branch.\r\n\r\nNow after some digging, the behaviour is a bit more involved.\r\n> In 7.7, if user with no other roles authenticated and created a new Watch, we would serialize an Authentication object with no roles\r\n> \r\n1. If the user is an _anonymous user_, i.e. incoming request without any credentials, we would actual serialise the anonymous role. Because the authentication process recognise the anonymous user and resolves its roles before authorization. That is, if watcher is setup with an anonymous user, it will continue to work in `7.8`.\r\n\r\n2. If, however, the user is a named user with no roles, then yes the Authentication object would be serialised with no roles. If a watcher is setup this way, it will break in `7.8`.\r\n\r\nWhen anonymous roles are relied on to setup and execute things like watchers, it is likley that the entire cluster runs with anonymous `superuser` roles. As I understand it, this is userful to users for approximating a \"security-less\" cluster for ECE where security is always on (or troublesome to disable). This corresponds to the above scenario 1 and things would continue working for `7.8`. \r\n\r\nScenario 2, in my opinion, is probably unlikely out there? But this is just my guess, because it does not seem to be a great use of anonymous roles. This setup also has some more difference between `7.7` and current `7.8`. \r\n* For `7.7`, if a new watcher is created with anonymous roles enabled, it will **stop** working when anonymous roles are disabled. \r\n* But for `7.8`, if a new watcher is created with anonymous roles enabled, it will **keep** working when anonymous roles are disabled. \r\nI am not sure which behaviour is more correct. It could be they are both correct from different perspective.\r\n\r\nSo overall I think the issue is not as bad. But it is an issue nonetheless (behaviour changes including what is [previously discussed](https://github.com/elastic/elasticsearch/issues/47195#issuecomment-601027310)). Given the revert is straightforward, I am happy to go ahead with it which also buys us some more time to think this through.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/641034684","html_url":"https://github.com/elastic/elasticsearch/issues/57711#issuecomment-641034684","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57711","id":641034684,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTAzNDY4NA==","user":{"login":"ywangd","id":2344308,"node_id":"MDQ6VXNlcjIzNDQzMDg=","avatar_url":"https://avatars3.githubusercontent.com/u/2344308?v=4","gravatar_id":"","url":"https://api.github.com/users/ywangd","html_url":"https://github.com/ywangd","followers_url":"https://api.github.com/users/ywangd/followers","following_url":"https://api.github.com/users/ywangd/following{/other_user}","gists_url":"https://api.github.com/users/ywangd/gists{/gist_id}","starred_url":"https://api.github.com/users/ywangd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywangd/subscriptions","organizations_url":"https://api.github.com/users/ywangd/orgs","repos_url":"https://api.github.com/users/ywangd/repos","events_url":"https://api.github.com/users/ywangd/events{/privacy}","received_events_url":"https://api.github.com/users/ywangd/received_events","type":"User","site_admin":false},"created_at":"2020-06-09T05:19:08Z","updated_at":"2020-06-09T05:19:08Z","author_association":"MEMBER","body":"Done revert (#57857) for `7.8`.","performed_via_github_app":null}]