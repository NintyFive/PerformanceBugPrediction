{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/46694","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46694/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46694/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46694/events","html_url":"https://github.com/elastic/elasticsearch/issues/46694","id":493201288,"node_id":"MDU6SXNzdWU0OTMyMDEyODg=","number":46694,"title":"[Transform] Can not group_by on field alias","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1434538947,"node_id":"MDU6TGFiZWwxNDM0NTM4OTQ3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.4.0","name":"v7.4.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-09-13T08:32:49Z","updated_at":"2019-09-17T07:48:14Z","closed_at":"2019-09-16T11:31:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"found by @wwang500 \r\n\r\nIf group_by or certain aggregations use field aliases the mapping deduction does not resolve the alias to a concrete type but tries to create another alias in the destination index. As a result of wrong deduction the transform will fail on start when trying to create the destination index, see error below. \r\n\r\n**Workaround 1**: Use the concrete fieldname instead of the alias\r\n**Workaround 2**: Create the destination index manually\r\n\r\n**Solution**: Deduction should use the proper type. The get mapping api does not support resolving the type, however [field caps](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-field-caps.html) resolve the type correctly.\r\n\r\nThe wip PR for CCS support has a fix (so using field caps is the way to go for other reasons as well):\r\n\r\nhttps://github.com/elastic/elasticsearch/pull/46075/files#diff-cbb75ff448d44acf01292ad7a635b22a\r\n\r\nI suggest we cut out the mapping deduction change from this PR (@benwtrent)\r\n\r\nError:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"runtime_exception\",\r\n        \"reason\": \"Could not create destination index [t2] for transform [t2]\"\r\n      }\r\n    ],\r\n    \"type\": \"runtime_exception\",\r\n    \"reason\": \"Could not create destination index [t2] for transform [t2]\",\r\n    \"caused_by\": {\r\n      \"type\": \"mapper_parsing_exception\",\r\n      \"reason\": \"Failed to parse mapping [_doc]: The [path] property must be specified for field [hostname].\",\r\n      \"caused_by\": {\r\n        \"type\": \"mapper_parsing_exception\",\r\n        \"reason\": \"The [path] property must be specified for field [hostname].\"\r\n      }\r\n    }\r\n  },\r\n  \"status\": 500\r\n}\r\n```","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}