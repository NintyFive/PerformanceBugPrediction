{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6373","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6373/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6373/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6373/events","html_url":"https://github.com/elastic/elasticsearch/issues/6373","id":34756898,"node_id":"MDU6SXNzdWUzNDc1Njg5OA==","number":6373,"title":"Dataloss after timedout fixindex on master node","user":{"login":"bluelu","id":339893,"node_id":"MDQ6VXNlcjMzOTg5Mw==","avatar_url":"https://avatars1.githubusercontent.com/u/339893?v=4","gravatar_id":"","url":"https://api.github.com/users/bluelu","html_url":"https://github.com/bluelu","followers_url":"https://api.github.com/users/bluelu/followers","following_url":"https://api.github.com/users/bluelu/following{/other_user}","gists_url":"https://api.github.com/users/bluelu/gists{/gist_id}","starred_url":"https://api.github.com/users/bluelu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluelu/subscriptions","organizations_url":"https://api.github.com/users/bluelu/orgs","repos_url":"https://api.github.com/users/bluelu/repos","events_url":"https://api.github.com/users/bluelu/events{/privacy}","received_events_url":"https://api.github.com/users/bluelu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-06-02T09:21:21Z","updated_at":"2014-06-02T17:04:25Z","closed_at":"2014-06-02T17:04:25Z","author_association":"NONE","active_lock_reason":null,"body":"We had one shard which couldn't be started because of a corrupt index.\n\nWe added the setting to the node to check for corrupt indexes and restarted. As the node was one of our back nodes, with more data, checking the indexes took more time.\n\nAn exception turned up on the master:\n\n[2014-05-28 01:39:36,779][DEBUG][cluster.service          ] [server5N16] processing [shard-failed ([2014.04.20.0000_000][1], node[pDQlF6xWSW2X4npbfqKEoQ], [R], s[INITIALIZING]), reason [Failed to start shard, message [RecoveryFailedException[[2014.04.20.0000_000][1]: Recovery failed from [I61N3][y0f8jdjkTDe4fyeaY1BwOw][i61n3][inet[/10.20.39.3:9300]]{_cluster=HR61, service=searchdata, _scluster=SEARCH1, max_local_storage_nodes=1, master=false, river=_none_} into [I59N7][pDQlF6xWSW2X4npbfqKEoQ][i59n7][inet[/10.20.34.7:9300]]{_cluster=HR59, service=searchdata, _scluster=SEARCH1, max_local_storage_nodes=1, master=false, river=_none_}]; nested: RemoteTransportException[[I61N3][inet[/10.20.39.3:9300]][index/shard/recovery/startRecovery]]; nested: RecoveryEngineException[[2014.04.20.0000_000][1] Phase[2] Execution failed]; nested: ReceiveTimeoutTransportException[[I59N7][inet[/10.20.34.7:9300]][index/shard/recovery/prepareTranslog] request_id [2828908] timed out after [900000ms]]; ]]]: done applying updated cluster_state (version: 2220) {elasticsearch[server5N16][clusterService#updateTask][T#1]}\n\nI think we tried to open/close the index a few times afterwards, and then restarted the node 2 times.We didn't restart the master node afterwards.\n\nThe second restart lead the node to delete the shard (deleting unneeded shard message), causing the shard to be completely lost.\n\nMaybe the master node thought that no node would have the shard anymore because of the exception above?\n\nUnfortunately I don't have more information on this.\n","closed_by":{"login":"bluelu","id":339893,"node_id":"MDQ6VXNlcjMzOTg5Mw==","avatar_url":"https://avatars1.githubusercontent.com/u/339893?v=4","gravatar_id":"","url":"https://api.github.com/users/bluelu","html_url":"https://github.com/bluelu","followers_url":"https://api.github.com/users/bluelu/followers","following_url":"https://api.github.com/users/bluelu/following{/other_user}","gists_url":"https://api.github.com/users/bluelu/gists{/gist_id}","starred_url":"https://api.github.com/users/bluelu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluelu/subscriptions","organizations_url":"https://api.github.com/users/bluelu/orgs","repos_url":"https://api.github.com/users/bluelu/repos","events_url":"https://api.github.com/users/bluelu/events{/privacy}","received_events_url":"https://api.github.com/users/bluelu/received_events","type":"User","site_admin":false},"performed_via_github_app":null}