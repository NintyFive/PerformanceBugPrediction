{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29152","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29152/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29152/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29152/events","html_url":"https://github.com/elastic/elasticsearch/issues/29152","id":306709161,"node_id":"MDU6SXNzdWUzMDY3MDkxNjE=","number":29152,"title":"org.elasticsearch.xpack.notification.email.Account$1.run(Account.java:55) should cast to CommandMap not javax.activation.MailcapCommandMap","user":{"login":"david-sitsky","id":4575489,"node_id":"MDQ6VXNlcjQ1NzU0ODk=","avatar_url":"https://avatars3.githubusercontent.com/u/4575489?v=4","gravatar_id":"","url":"https://api.github.com/users/david-sitsky","html_url":"https://github.com/david-sitsky","followers_url":"https://api.github.com/users/david-sitsky/followers","following_url":"https://api.github.com/users/david-sitsky/following{/other_user}","gists_url":"https://api.github.com/users/david-sitsky/gists{/gist_id}","starred_url":"https://api.github.com/users/david-sitsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-sitsky/subscriptions","organizations_url":"https://api.github.com/users/david-sitsky/orgs","repos_url":"https://api.github.com/users/david-sitsky/repos","events_url":"https://api.github.com/users/david-sitsky/events{/privacy}","received_events_url":"https://api.github.com/users/david-sitsky/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-20T02:47:01Z","updated_at":"2018-03-20T09:25:15Z","closed_at":"2018-03-20T09:25:15Z","author_association":"NONE","active_lock_reason":null,"body":"Kibana version: 5.5.0\r\n\r\nElasticsearch version: 5.5.0\r\n\r\nServer OS version: Linux 4.4.0-93-generic #116-Ubuntu SMP Fri Aug 11 21:17:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nBrowser version: Chrome\r\n\r\nBrowser OS version: Linux\r\n\r\nOriginal install method (e.g. download page, yum, from source, etc.): download\r\n\r\nDescription of the problem including expected versus actual behavior:\r\n\r\nWhen ES cluster was in a bad state (single master in test cluster was in heavy GC loop) the transport client could not initialise XPackPlugin due to an incorrect cast in the X-PACK code. We have registered a custom CommandMap called UnmodifiableMailcapCommandMap as can be seen in the logs below.\r\n\r\nSteps to reproduce:\r\n\r\nGet cluster into bad state.\r\nInstall a custom CommandMap into the JVM.\r\nTry to connect with transport client and X-PACK.\r\nErrors in browser console (if relevant):\r\n\r\nProvide logs and/or server output (if relevant):\r\n```\r\njava.lang.ExceptionInInitializerError: null\r\nat org.elasticsearch.xpack.XPackPlugin.<clinit>(XPackPlugin.java:183) ~[x-pack-api-5.5.0.jar:5.5.0]\r\nat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[?:1.8.0_92]\r\nat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) ~[?:1.8.0_92]\r\nat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) ~[?:1.8.0_92]\r\nat java.lang.reflect.Constructor.newInstance(Constructor.java:423) ~[?:1.8.0_92]\r\nat org.elasticsearch.plugins.PluginsService.loadPlugin(PluginsService.java:423) ~[elasticsearch-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.plugins.PluginsService.<init>(PluginsService.java:103) ~[elasticsearch-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.client.transport.TransportClient.newPluginService(TransportClient.java:101) ~[elasticsearch-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.client.transport.TransportClient.buildTemplate(TransportClient.java:126) ~[elasticsearch-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.client.transport.TransportClient.<init>(TransportClient.java:265) ~[elasticsearch-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.transport.client.PreBuiltTransportClient.<init>(PreBuiltTransportClient.java:130) ~[transport-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.xpack.client.PreBuiltXPackTransportClient.<init>(PreBuiltXPackTransportClient.java:55) ~[x-pack-transport-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.xpack.client.PreBuiltXPackTransportClient.<init>(PreBuiltXPackTransportClient.java:50) ~[x-pack-transport-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.xpack.client.PreBuiltXPackTransportClient.<init>(PreBuiltXPackTransportClient.java:46) ~[x-pack-transport-5.5.0.jar:5.5.0]\r\n...\r\nCaused by: java.lang.ClassCastException: com.xxxx.xxxx.UnmodifiableMailcapCommandMap cannot be cast to javax.activation.MailcapCommandMap\r\nat org.elasticsearch.xpack.notification.email.Account$1.run(Account.java:55) ~[x-pack-api-5.5.0.jar:5.5.0]\r\nat org.elasticsearch.xpack.notification.email.Account$1.run(Account.java:51) ~[x-pack-api-5.5.0.jar:5.5.0]\r\nat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_92]\r\nat org.elasticsearch.xpack.notification.email.Account.<clinit>(Account.java:51) ~[x-pack-api-5.5.0.jar:5.5.0]\r\n... 35 more\r\n```","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}