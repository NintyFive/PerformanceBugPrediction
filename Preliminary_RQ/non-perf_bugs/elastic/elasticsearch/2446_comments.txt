[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/10714713","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-10714713","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":10714713,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzE0NzEz","user":{"login":"mrvisser","id":102265,"node_id":"MDQ6VXNlcjEwMjI2NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/102265?v=4","gravatar_id":"","url":"https://api.github.com/users/mrvisser","html_url":"https://github.com/mrvisser","followers_url":"https://api.github.com/users/mrvisser/followers","following_url":"https://api.github.com/users/mrvisser/following{/other_user}","gists_url":"https://api.github.com/users/mrvisser/gists{/gist_id}","starred_url":"https://api.github.com/users/mrvisser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrvisser/subscriptions","organizations_url":"https://api.github.com/users/mrvisser/orgs","repos_url":"https://api.github.com/users/mrvisser/repos","events_url":"https://api.github.com/users/mrvisser/events{/privacy}","received_events_url":"https://api.github.com/users/mrvisser/received_events","type":"User","site_admin":false},"created_at":"2012-11-26T13:10:28Z","updated_at":"2012-11-26T13:10:28Z","author_association":"NONE","body":"Here is the trace logging for the resources created in the index at the time of this failure. Note that **the parent and child resources are created in the same bulk set of index operations**:\n\n```\n[2012-11-26T13:04:44.289Z] TRACE: elasticsearchclient/55300 on branden-macbook.local: Performing a bulk set of 2 operations.\n    operations: [\n      {\n        \"index\": {\n          \"_type\": \"resource\",\n          \"_id\": \"c:camtest:PV6D_se0MM\",\n          \"_index\": \"oaetest\"\n        }\n      },\n      {\n        \"resourceSubType\": \"link\",\n        \"id\": \"c:camtest:PV6D_se0MM\",\n        \"tenantId\": \"camtest\",\n        \"title\": \"Test Content 1\",\n        \"visibility\": \"public\",\n        \"general\": \"Test Content 1 Test content description 1\",\n        \"sort\": \"Test Content 1 Test content description 1\",\n        \"_type\": \"resource\",\n        \"resourceType\": \"content\"\n      },\n      {\n        \"index\": {\n          \"_type\": \"resource_members\",\n          \"_id\": \"c:camtest:PV6D_se0MM#members\",\n          \"_parent\": \"c:camtest:PV6D_se0MM\",\n          \"_index\": \"oaetest\"\n        }\n      },\n      {\n        \"_parent\": \"c:camtest:PV6D_se0MM\",\n        \"_type\": \"resource_members\",\n        \"id\": \"c:camtest:PV6D_se0MM#members\",\n        \"direct_members\": [\n          \"g:camtest:random-group-eeCDD_cT1fJ\",\n          \"u:camtest:ePKA3kTNJM\"\n        ]\n      }\n    ]\n[2012-11-26T13:04:44.295Z] TRACE: elasticsearchclient/55300 on branden-macbook.local: Search execution completed. (call=bulk)\n    data: {\n      \"took\": 3,\n      \"items\": [\n        {\n          \"index\": {\n            \"_index\": \"oaetest\",\n            \"_type\": \"resource\",\n            \"_id\": \"c:camtest:PV6D_se0MM\",\n            \"_version\": 1,\n            \"ok\": true\n          }\n        },\n        {\n          \"index\": {\n            \"_index\": \"oaetest\",\n            \"_type\": \"resource_members\",\n            \"_id\": \"c:camtest:PV6D_se0MM#members\",\n            \"_version\": 1,\n            \"ok\": true\n          }\n        }\n      ]\n    }\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/10714750","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-10714750","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":10714750,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzE0NzUw","user":{"login":"mrvisser","id":102265,"node_id":"MDQ6VXNlcjEwMjI2NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/102265?v=4","gravatar_id":"","url":"https://api.github.com/users/mrvisser","html_url":"https://github.com/mrvisser","followers_url":"https://api.github.com/users/mrvisser/followers","following_url":"https://api.github.com/users/mrvisser/following{/other_user}","gists_url":"https://api.github.com/users/mrvisser/gists{/gist_id}","starred_url":"https://api.github.com/users/mrvisser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrvisser/subscriptions","organizations_url":"https://api.github.com/users/mrvisser/orgs","repos_url":"https://api.github.com/users/mrvisser/repos","events_url":"https://api.github.com/users/mrvisser/events{/privacy}","received_events_url":"https://api.github.com/users/mrvisser/received_events","type":"User","site_admin":false},"created_at":"2012-11-26T13:11:56Z","updated_at":"2012-11-26T13:11:56Z","author_association":"NONE","body":"And the elasticsearch server-side error log:\n\n```\n[2012-11-26 08:04:44,508][DEBUG][action.search.type       ] [Shiver Man] [oaetest][0], node[H81AnrrxTaef_Rz3UrpCrA], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@24367013]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [oaetest][0]: query[filtered(general:content)->++cache(_type:resource) +child_filter[resource_members/resource](filtered(direct_members:u:gttest:VTydFcP2JM)->cache(_type:resource_members)) +cache(visibility:public) cache(joinable:request joinable:yes) +cache(tenantId:gttest) +cache(visibility:loggedin)],from[0],size[1],sort[<custom:\"sort\": org.elasticsearch.index.field.data.strings.StringFieldDataType$1@4f19c297>]: Query Failed [Failed to refresh id cache for child queries]\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:89)\n    at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:308)\n    at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteFetch(SearchServiceTransportAction.java:242)\n    at org.elasticsearch.action.search.type.TransportSearchQueryAndFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryAndFetchAction.java:75)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:205)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:192)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:178)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n    at java.lang.Thread.run(Thread.java:680)\nCaused by: java.lang.StringIndexOutOfBoundsException: String index out of range: -1\n    at java.lang.String.substring(String.java:1937)\n    at org.elasticsearch.index.mapper.Uid.createUid(Uid.java:87)\n    at org.elasticsearch.index.cache.id.simple.SimpleIdCache.refresh(SimpleIdCache.java:171)\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:87)\n    ... 9 more\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/10714781","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-10714781","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":10714781,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzE0Nzgx","user":{"login":"mrvisser","id":102265,"node_id":"MDQ6VXNlcjEwMjI2NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/102265?v=4","gravatar_id":"","url":"https://api.github.com/users/mrvisser","html_url":"https://github.com/mrvisser","followers_url":"https://api.github.com/users/mrvisser/followers","following_url":"https://api.github.com/users/mrvisser/following{/other_user}","gists_url":"https://api.github.com/users/mrvisser/gists{/gist_id}","starred_url":"https://api.github.com/users/mrvisser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrvisser/subscriptions","organizations_url":"https://api.github.com/users/mrvisser/orgs","repos_url":"https://api.github.com/users/mrvisser/repos","events_url":"https://api.github.com/users/mrvisser/events{/privacy}","received_events_url":"https://api.github.com/users/mrvisser/received_events","type":"User","site_admin":false},"created_at":"2012-11-26T13:13:09Z","updated_at":"2012-11-26T13:13:09Z","author_association":"NONE","body":"This appears to impact 0.9.11 as well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/10715309","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-10715309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":10715309,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzE1MzA5","user":{"login":"mrvisser","id":102265,"node_id":"MDQ6VXNlcjEwMjI2NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/102265?v=4","gravatar_id":"","url":"https://api.github.com/users/mrvisser","html_url":"https://github.com/mrvisser","followers_url":"https://api.github.com/users/mrvisser/followers","following_url":"https://api.github.com/users/mrvisser/following{/other_user}","gists_url":"https://api.github.com/users/mrvisser/gists{/gist_id}","starred_url":"https://api.github.com/users/mrvisser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrvisser/subscriptions","organizations_url":"https://api.github.com/users/mrvisser/orgs","repos_url":"https://api.github.com/users/mrvisser/repos","events_url":"https://api.github.com/users/mrvisser/events{/privacy}","received_events_url":"https://api.github.com/users/mrvisser/received_events","type":"User","site_admin":false},"created_at":"2012-11-26T13:30:57Z","updated_at":"2012-11-26T13:30:57Z","author_association":"NONE","body":"I noticed in Uid.java that a `#` might be a special ID character. I changed my _id's to use `_` and it doesn't solve the problem.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/10718761","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-10718761","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":10718761,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzE4NzYx","user":{"login":"mrvisser","id":102265,"node_id":"MDQ6VXNlcjEwMjI2NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/102265?v=4","gravatar_id":"","url":"https://api.github.com/users/mrvisser","html_url":"https://github.com/mrvisser","followers_url":"https://api.github.com/users/mrvisser/followers","following_url":"https://api.github.com/users/mrvisser/following{/other_user}","gists_url":"https://api.github.com/users/mrvisser/gists{/gist_id}","starred_url":"https://api.github.com/users/mrvisser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrvisser/subscriptions","organizations_url":"https://api.github.com/users/mrvisser/orgs","repos_url":"https://api.github.com/users/mrvisser/repos","events_url":"https://api.github.com/users/mrvisser/events{/privacy}","received_events_url":"https://api.github.com/users/mrvisser/received_events","type":"User","site_admin":false},"created_at":"2012-11-26T15:11:04Z","updated_at":"2012-11-26T15:11:04Z","author_association":"NONE","body":"I've resolved my errors, it appears there was bug where documents were being index as type `resource` that referenced other `resource` documents as their `_parent`. Fixing this bug such that those rogue documents don't get indexed allows the has_child filter to work without this error.\n\nIf there was some work to do on this ticket, it would be to either validate the parent-child relationship types when indexing, or to better handle this particular error.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/10718859","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-10718859","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":10718859,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzE4ODU5","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2012-11-26T15:13:20Z","updated_at":"2012-11-26T15:13:20Z","author_association":"MEMBER","body":"@mrvisser will have a look, is there a chance for a repro to speed this up. I mean, a curl repro that setup an index with the mappings, index some sample data, and then executes a search that shows the failure? (we are close with what you provided up until now, missing sample data and a curl based repro).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/10719050","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-10719050","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":10719050,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzE5MDUw","user":{"login":"mrvisser","id":102265,"node_id":"MDQ6VXNlcjEwMjI2NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/102265?v=4","gravatar_id":"","url":"https://api.github.com/users/mrvisser","html_url":"https://github.com/mrvisser","followers_url":"https://api.github.com/users/mrvisser/followers","following_url":"https://api.github.com/users/mrvisser/following{/other_user}","gists_url":"https://api.github.com/users/mrvisser/gists{/gist_id}","starred_url":"https://api.github.com/users/mrvisser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrvisser/subscriptions","organizations_url":"https://api.github.com/users/mrvisser/orgs","repos_url":"https://api.github.com/users/mrvisser/repos","events_url":"https://api.github.com/users/mrvisser/events{/privacy}","received_events_url":"https://api.github.com/users/mrvisser/received_events","type":"User","site_admin":false},"created_at":"2012-11-26T15:18:23Z","updated_at":"2012-11-26T15:18:23Z","author_association":"NONE","body":"@kimchy I have an idea how it could be reproduced now. I'll post some commands that hopefully accomplish this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/10721648","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-10721648","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":10721648,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzIxNjQ4","user":{"login":"mrvisser","id":102265,"node_id":"MDQ6VXNlcjEwMjI2NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/102265?v=4","gravatar_id":"","url":"https://api.github.com/users/mrvisser","html_url":"https://github.com/mrvisser","followers_url":"https://api.github.com/users/mrvisser/followers","following_url":"https://api.github.com/users/mrvisser/following{/other_user}","gists_url":"https://api.github.com/users/mrvisser/gists{/gist_id}","starred_url":"https://api.github.com/users/mrvisser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrvisser/subscriptions","organizations_url":"https://api.github.com/users/mrvisser/orgs","repos_url":"https://api.github.com/users/mrvisser/repos","events_url":"https://api.github.com/users/mrvisser/events{/privacy}","received_events_url":"https://api.github.com/users/mrvisser/received_events","type":"User","site_admin":false},"created_at":"2012-11-26T16:19:33Z","updated_at":"2012-11-26T16:19:33Z","author_association":"NONE","body":"@kimchy Sorry, I've been unable to set up a case where this can be demonstrated. I created a parent mapping and a child mapping. Then indexed documents that are of the type of the parent mapping, and have _parent mapping to a parent document. ElasticSearch allowed this indexing to happen (perhaps it shouldn't?), but then a query was successful (returned 0 elements), rather than the StringOutOfBoundsException I encountered before.\n\nPerhaps the exception is a result of some particular query mechanics.\n\nI hope that what I've posted above provides enough clues.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/20983665","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-20983665","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":20983665,"node_id":"MDEyOklzc3VlQ29tbWVudDIwOTgzNjY1","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2013-07-15T16:57:28Z","updated_at":"2013-07-15T16:57:28Z","author_association":"MEMBER","body":"Hey,\n\ndo you still have problems on 0.90 with this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/20984530","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-20984530","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":20984530,"node_id":"MDEyOklzc3VlQ29tbWVudDIwOTg0NTMw","user":{"login":"mrvisser","id":102265,"node_id":"MDQ6VXNlcjEwMjI2NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/102265?v=4","gravatar_id":"","url":"https://api.github.com/users/mrvisser","html_url":"https://github.com/mrvisser","followers_url":"https://api.github.com/users/mrvisser/followers","following_url":"https://api.github.com/users/mrvisser/following{/other_user}","gists_url":"https://api.github.com/users/mrvisser/gists{/gist_id}","starred_url":"https://api.github.com/users/mrvisser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrvisser/subscriptions","organizations_url":"https://api.github.com/users/mrvisser/orgs","repos_url":"https://api.github.com/users/mrvisser/repos","events_url":"https://api.github.com/users/mrvisser/events{/privacy}","received_events_url":"https://api.github.com/users/mrvisser/received_events","type":"User","site_admin":false},"created_at":"2013-07-15T17:10:51Z","updated_at":"2013-07-15T17:10:51Z","author_association":"NONE","body":"Hi @spinscale , the bug in our application that manifested this error has been fixed for a long time so we wouldn't know if it still exists in 0.90\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21026469","html_url":"https://github.com/elastic/elasticsearch/issues/2446#issuecomment-21026469","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2446","id":21026469,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDI2NDY5","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2013-07-16T07:51:20Z","updated_at":"2013-07-16T07:51:20Z","author_association":"MEMBER","body":"@mrvisser thanks for the fast reply! I will close this one for due to its age and see if it pops up again.\n","performed_via_github_app":null}]