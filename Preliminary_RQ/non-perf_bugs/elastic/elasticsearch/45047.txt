{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45047","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45047/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45047/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45047/events","html_url":"https://github.com/elastic/elasticsearch/issues/45047","id":475152569,"node_id":"MDU6SXNzdWU0NzUxNTI1Njk=","number":45047,"title":"[ML] find_file_structure not detecting CSV header with many long and highly variable field values","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-07-31T13:41:49Z","updated_at":"2019-08-01T19:07:56Z","closed_at":"2019-08-01T19:07:56Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"elastic/kibana#42114 contains an example of a CSV file where the find_file_structure endpoint didn't detect that the first row contained the column names.\r\n\r\nThe explanation is:\r\n\r\n```\r\n    \"First row is not unusual based on length test: [1347.0] and [count=313, min=1231.000000, average=4363.025559, max=8911.000000]\",\r\n    \"First row is not unusual based on Levenshtein test [count=100, min=1871.000000, average=4357.270000, max=8512.000000] and [count=100, min=1711.000000, average=3648.230000, max=5914.000000]\"\r\n```\r\n\r\nIn other words:\r\n\r\n1. The first row length is 1347 and other rows vary in length between 1231 and 8911 characters.\r\n2. The average Levenshtein distance between the first row and each of the next 100 rows is 4357.27 while the average distance between 100 other pairs of rows is 3648.23.\r\n\r\nThe file in question contains AirBNB listings data.  Some owners have written huge amounts about their properties and other owners have written very little, and the two current tests are confused by this.\r\n\r\nTo a human it's flagrantly obvious that the first row is a header row, so we should be able to improve this.\r\n\r\nOne idea is to extend `_excluding_ the biggest difference` from:\r\n\r\n```\r\n/**\r\n     * Sum of the Levenshtein distances between corresponding elements\r\n     * in the two supplied lists _excluding_ the biggest difference.\r\n     * The reason the biggest difference is excluded is that sometimes\r\n     * there's a \"message\" field that is much longer than any of the other\r\n     * fields, varies enormously between rows, and skews the comparison.\r\n     */\r\n```\r\n\r\nto exclude all fields that are over a certain length in _any_ row, as this indicates likely freeform text fields (and the AirBNB data has more than 1 such field per row).\r\n\r\nAnother idea would be to look at the number of distinct characters in each row.  In the AirBNB data this could well notice a difference between the first row and others because the first row is all commas, lowercase letters and underscores whereas the other lines have many other characters.","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}