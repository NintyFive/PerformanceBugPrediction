{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247/events","html_url":"https://github.com/elastic/elasticsearch/issues/45247","id":477465843,"node_id":"MDU6SXNzdWU0Nzc0NjU4NDM=","number":45247,"title":"New rollup jobs are invisible and unusable","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"labels":[{"id":912843355,"node_id":"MDU6TGFiZWw5MTI4NDMzNTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Rollup","name":":Analytics/Rollup","color":"0e8a16","default":false,"description":"Turn fine-grained time-based data into coarser-grained data"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2019-08-06T16:00:54Z","updated_at":"2020-02-20T16:08:34Z","closed_at":"2019-10-14T18:03:25Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.3 (cloud)\r\n\r\n**JVM version** (`java -version`): Cloud\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Cloud\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nSince upgrading to 7.3 on my cloud cluster I have been unable to create working rollup jobs. If I create one via API I get a success beck, but then the job does not show up when I try to GET it and I'm told the task doesn't exist if I try to delete it. At the same time if I try to create it again I'm told one with that id already exists, if I delete that I'm then told the metadata exists, if I delete the rollup index I'm then still told a task with that id exists. I've found not way to view or delete the task if that's separate from the job. Trying again with a new id \"works\" and then repeats this pattern of being invisible and unable to start because it \"doesn't exist\" even though it \"already exists\" when creating anew.\r\n\r\nI've also tried to create the job via Kibana with problems. I get an error on creation \"Request failed with a error. An internal server error occurred.\" followed by the same issues about the job already existing while it's also not showing up on the list of jobs. I did once or twice get a job with no terms or metrics to create, but even then that seems to mostly fail. The log shows the following error when creating via kibana (note that this happens even with most \"empty\" jobs that don't mention the heat_set_point field, which is one I am trying to target with the real job).\r\n\r\n[instance-0000000004] failed to notify ClusterStateListener java.lang.IllegalArgumentException: Two sibling aggregations cannot have the same name: [heat_set_point.avg._count] at org.elasticsearch.search.aggregations.AggregatorFactories$Builder.addAggregator(AggregatorFactories.java:298) ~[elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.search.aggregations.AbstractAggregationBuilder.subAggregation(AbstractAggregationBuilder.java:80) ~[elasticsearch-7.3.0.jar:7.3.0] at java.util.ArrayList.forEach(ArrayList.java:1540) ~[?:?] at java.util.Collections$UnmodifiableCollection.forEach(Collections.java:1083) ~[?:?] at org.elasticsearch.xpack.rollup.job.RollupIndexer.createCompositeBuilder(RollupIndexer.java:166) ~[?:?] at org.elasticsearch.xpack.rollup.job.RollupIndexer.<init>(RollupIndexer.java:94) ~[?:?] at org.elasticsearch.xpack.rollup.job.RollupIndexer.<init>(RollupIndexer.java:78) ~[?:?] at org.elasticsearch.xpack.rollup.job.RollupJobTask$ClientRollupPageManager.<init>(RollupJobTask.java:103) ~[?:?] at org.elasticsearch.xpack.rollup.job.RollupJobTask.<init>(RollupJobTask.java:210) ~[?:?] at org.elasticsearch.xpack.rollup.job.RollupJobTask$RollupJobPersistentTasksExecutor.createTask(RollupJobTask.java:85) ~[?:?] at org.elasticsearch.persistent.PersistentTasksNodeService$1.createTask(PersistentTasksNodeService.java:163) ~[elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.tasks.TaskManager.register(TaskManager.java:114) ~[elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.persistent.PersistentTasksNodeService.startTask(PersistentTasksNodeService.java:166) ~[elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.persistent.PersistentTasksNodeService.clusterChanged(PersistentTasksNodeService.java:115) ~[elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.cluster.service.ClusterApplierService.lambda$callClusterStateListeners$6(ClusterApplierService.java:503) [elasticsearch-7.3.0.jar:7.3.0] at java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:948) [?:?] at java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734) [?:?] at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:658) [?:?] at org.elasticsearch.cluster.service.ClusterApplierService.callClusterStateListeners(ClusterApplierService.java:500) [elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.cluster.service.ClusterApplierService.applyChanges(ClusterApplierService.java:477) [elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:418) [elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:165) [elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:688) [elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:252) [elasticsearch-7.3.0.jar:7.3.0] at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:215) [elasticsearch-7.3.0.jar:7.3.0] at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?] at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?] at java.lang.Thread.run(Thread.java:834) [?:?]\r\n\r\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}