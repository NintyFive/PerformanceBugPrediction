{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53360","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53360/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53360/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53360/events","html_url":"https://github.com/elastic/elasticsearch/issues/53360","id":578813209,"node_id":"MDU6SXNzdWU1Nzg4MTMyMDk=","number":53360,"title":"[CI] AsyncSearchActionTests fails unpredictably","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":10,"created_at":"2020-03-10T19:33:46Z","updated_at":"2020-04-01T02:15:55Z","closed_at":"2020-04-01T02:15:54Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"We've had a couple of test failures from `AsyncSearchActionTests` today. The failures haven't reproduced locally for me.\r\n\r\nFailure on `master`: https://gradle-enterprise.elastic.co/s/asvh7ted2nfvy/\r\n\r\n```\r\norg.elasticsearch.xpack.search.AsyncSearchActionTests > testInvalidId FAILED |  \r\n-- | --\r\n  | java.lang.AssertionError: Values should be different. Actual: 2 |  \r\n  | at org.junit.Assert.fail(Assert.java:88) |  \r\n  | at org.junit.Assert.failEquals(Assert.java:185) |  \r\n  | at org.junit.Assert.assertNotEquals(Assert.java:199) |  \r\n  | at org.junit.Assert.assertNotEquals(Assert.java:211) |  \r\n  | at org.elasticsearch.xpack.search.AsyncSearchIntegTestCase$2.lambda$doNext$0(AsyncSearchIntegTestCase.java:214) |  \r\n  | at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:881) |  \r\n  | at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:854) |  \r\n  | at org.elasticsearch.xpack.search.AsyncSearchIntegTestCase$2.doNext(AsyncSearchIntegTestCase.java:209) |  \r\n  | at org.elasticsearch.xpack.search.AsyncSearchIntegTestCase$2.next(AsyncSearchIntegTestCase.java:187) |  \r\n  | at org.elasticsearch.xpack.search.AsyncSearchIntegTestCase$2.next(AsyncSearchIntegTestCase.java:172) |  \r\n  | at org.elasticsearch.xpack.search.AsyncSearchActionTests.testInvalidId(AsyncSearchActionTests.java:234) |  \r\n  |   |  \r\n  | java.lang.AssertionError: Accounting breaker not reset to 0 on node: node_sd3, are there still Lucene indices around? |  \r\n  | Expected: <0L> |  \r\n  | but: was <11134L> |  \r\n  | at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18) |  \r\n  | at org.junit.Assert.assertThat(Assert.java:956) |  \r\n  | at org.elasticsearch.test.InternalTestCluster.lambda$ensureEstimatedStats$37(InternalTestCluster.java:2195) |  \r\n  | at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:881) |  \r\n  | at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:854) |  \r\n  | at org.elasticsearch.test.InternalTestCluster.ensureEstimatedStats(InternalTestCluster.java:2193) |  \r\n  | at org.elasticsearch.test.TestCluster.assertAfterTest(TestCluster.java:90) |  \r\n  | at org.elasticsearch.test.InternalTestCluster.assertAfterTest(InternalTestCluster.java:2235) |  \r\n  | at org.elasticsearch.test.ESIntegTestCase.afterInternal(ESIntegTestCase.java:550) |  \r\n  | at org.elasticsearch.test.ESIntegTestCase.cleanUpCluster(ESIntegTestCase.java:1936) |  \r\n  […]\r\n```\r\n\r\nEarlier failure on ~7.x~ master: https://gradle-enterprise.elastic.co/s/3pjzmjjxc66wi\r\n```\r\norg.elasticsearch.xpack.search.AsyncSearchActionTests > testCleanupOnFailure FAILED |  \r\n-- | --\r\n  | java.lang.AssertionError: |  \r\n  | Expected: <6> |  \r\n  | but: was <5> |  \r\n  | at __randomizedtesting.SeedInfo.seed([43B69EECA92F38A8:C8A2BFFE0F2A2760]:0) |  \r\n  | at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18) |  \r\n  | at org.junit.Assert.assertThat(Assert.java:956) |  \r\n  | at org.junit.Assert.assertThat(Assert.java:923) |  \r\n  | at org.elasticsearch.xpack.search.AsyncSearchActionTests.testCleanupOnFailure(AsyncSearchActionTests.java:221)\r\n```\r\n\r\nI believe @jimczi is working on this actively, but I'm going to go ahead and mute while he's in progress.\r\n\r\nRelates #49931","closed_by":{"login":"ywangd","id":2344308,"node_id":"MDQ6VXNlcjIzNDQzMDg=","avatar_url":"https://avatars3.githubusercontent.com/u/2344308?v=4","gravatar_id":"","url":"https://api.github.com/users/ywangd","html_url":"https://github.com/ywangd","followers_url":"https://api.github.com/users/ywangd/followers","following_url":"https://api.github.com/users/ywangd/following{/other_user}","gists_url":"https://api.github.com/users/ywangd/gists{/gist_id}","starred_url":"https://api.github.com/users/ywangd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywangd/subscriptions","organizations_url":"https://api.github.com/users/ywangd/orgs","repos_url":"https://api.github.com/users/ywangd/repos","events_url":"https://api.github.com/users/ywangd/events{/privacy}","received_events_url":"https://api.github.com/users/ywangd/received_events","type":"User","site_admin":false},"performed_via_github_app":null}