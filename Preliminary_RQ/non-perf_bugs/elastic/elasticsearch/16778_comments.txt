[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/187585464","html_url":"https://github.com/elastic/elasticsearch/issues/16778#issuecomment-187585464","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16778","id":187585464,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NzU4NTQ2NA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-02-23T07:38:47Z","updated_at":"2016-02-23T07:38:47Z","author_association":"MEMBER","body":"can you please post your queries, what works and what doesn't?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/187754433","html_url":"https://github.com/elastic/elasticsearch/issues/16778#issuecomment-187754433","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16778","id":187754433,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Nzc1NDQzMw==","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"created_at":"2016-02-23T15:42:53Z","updated_at":"2016-02-23T15:49:31Z","author_association":"NONE","body":"@javanna here is one query that used to work in 1.x but does not work now. \n\n``` javascript\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"match\": {\n            \"search\": {\n              \"query\": \"fraud\",\n              \"operator\": \"and\"\n            }\n          }\n        }\n      ],\n      \"should\": [\n        {\n          \"match\": {\n            \"search\": {\n              \"query\": \"fraud\",\n              \"type\": \"phrase\",\n              \"slop\": 1,\n              \"boost\": 1.2\n            }\n          }\n        },\n        {\n          \"match\": {\n            \"search_shingle\": {\n              \"query\": \"fraud\",\n              \"operator\": \"or\",\n              \"boost\": 1.2\n            }\n          }\n        },\n        {\n          \"match\": {\n            \"search_keys\": {\n              \"query\": \"fraud\",\n              \"operator\": \"or\",\n              \"boost\": 10\n            }\n          }\n        }\n      ]\n    }\n  },\n  \"from\": 0,\n  \"size\": 20,\n  \"highlight\": {\n    \"number_of_fragments\": 0,\n    \"type\": \"postings\",\n    \"require_field_match\": false,\n    \"fields\": {\n      \"additionalInfo\": {},\n      \"advisor.team.acronym\": {},\n      \"comments\": {},\n      \"description\": {},\n      \"engagements.jobCode.text\": {},\n      \"engagements.title\": {},\n      \"engagements.productNumber.text\": {},\n      \"mandateAuthority.authorityNumber.text\": {},\n      \"mandateAuthority.title\": {},\n      \"notes.content\": {},\n      \"parties.position.member.name\": {},\n      \"parties.position.orgUnit.acronym\": {},\n      \"parties.position.orgUnit.compositeName\": {},\n      \"sourceIdentifier.text\": {},\n      \"summary\": {},\n      \"teams.stakeholders.appointment.team.acronym\": {},\n      \"teams.team.acronym\": {}\n    }\n  },\n  \"suggest\": {\n    \"text\": \"fraud\",\n    \"phrase\": {\n      \"phrase\": {\n        \"field\": \"search_shingle\",\n        \"size\": 4,\n        \"max_errors\": 3,\n        \"gram_size\": 2,\n        \"direct_generator\": [\n          {\n            \"field\": \"search\",\n            \"suggest_mode\": \"popular\",\n            \"min_word_length\": 3\n          }\n        ],\n        \"highlight\": {\n          \"pre_tag\": \"<em>\",\n          \"post_tag\": \"</em>\"\n        }\n      }\n    }\n  },\n  \"sort\": [\n    {\n      \"_score\": {\n        \"order\": \"desc\",\n        \"missing\": \"_last\"\n      }\n    },\n    {\n      \"sourceDate\": {\n        \"order\": \"desc\",\n        \"missing\": \"_last\"\n      }\n    },\n    {\n      \"id\": {\n        \"order\": \"desc\",\n        \"missing\": \"_last\"\n      }\n    }\n  ]\n}\n```\n\nif I switch to `plain` highlighter it works\nif is switch field in first match statement from `search` (my composite copy_to field without offsets) to `summary` (one of the fields contributing to the `search` field) it will highlight that one field\n\nis it possible that postings does not honor `require_field_match`?\n\nplease let me know if it all looks fine to you and you can't pinpoint the issue and I will try to find time to have a recreation today (pain to do on windows with curl parameters not working properly)\n\nAlex\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/187774369","html_url":"https://github.com/elastic/elasticsearch/issues/16778#issuecomment-187774369","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16778","id":187774369,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Nzc3NDM2OQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-02-23T16:29:19Z","updated_at":"2016-02-23T16:29:19Z","author_association":"MEMBER","body":"> is it possible that postings does not honor require_field_match?\n\nYes that is definitely the problem. Here is the original PR that caused this breaking change: https://github.com/elastic/elasticsearch/pull/11077#issuecomment-102494447 . We also listed the breaking change in the migration guide here: https://github.com/elastic/elasticsearch/blob/master/docs/reference/migration/migrate_2_0/search.asciidoc#postings-highlighter-doesnt-support-match_phrase_prefix .\n\nI suggest either searching and highlighting the same fields, or providing a specific highlight query that differs from the search one. Otherwise use the plain highlighter instead, which still supports `require_field_match`.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/187785877","html_url":"https://github.com/elastic/elasticsearch/issues/16778#issuecomment-187785877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16778","id":187785877,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Nzc4NTg3Nw==","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"created_at":"2016-02-23T16:49:59Z","updated_at":"2016-02-23T16:49:59Z","author_association":"NONE","body":"@javanna I created a recreation https://gist.github.com/roytmana/a2d6efd307c5aa86210e but I see it is a feature not a bug :-( Any chance it will be relaxed on Lucene side or it is pretty much done deal and I need to look for a work around? I guess I could add these fields to should portion of my query using fastest type of match query keeping everything else intact\n\nthis is such a common case when searching \"most\" of your data :-( when you need to search over dozens of fields and combine it with shingles etc queries get very heavy and keeping track of all fileds involved labor intensive and spread across several layers. \n\nplain highlighter is good deal slower \n\nnot being able to highlight make copy_to even less useful (no boosting of contributing fields, no control over offset gaps for contributing fields, no highlighting ...) \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/187938996","html_url":"https://github.com/elastic/elasticsearch/issues/16778#issuecomment-187938996","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16778","id":187938996,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NzkzODk5Ng==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-02-23T22:10:35Z","updated_at":"2016-02-23T22:10:35Z","author_association":"MEMBER","body":"hi @roytmana I am sorry to bring you bad news, but I don't see `require_field_match` being supported by the lucene postings highlighter. I think it was wrong to support in the first place in the elasticsearch postings highlighter, it made things slow and a lot more complicated. There are easy workarounds though, either search and highlight the same fields, or provide a specific highlight query against the fields that need to be highlighted. Can you let us know if these are good enough please?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/187957370","html_url":"https://github.com/elastic/elasticsearch/issues/16778#issuecomment-187957370","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16778","id":187957370,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Nzk1NzM3MA==","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"created_at":"2016-02-23T23:08:40Z","updated_at":"2016-02-23T23:08:40Z","author_association":"NONE","body":"Thank you @javanna I am closing it then...\n","performed_via_github_app":null}]