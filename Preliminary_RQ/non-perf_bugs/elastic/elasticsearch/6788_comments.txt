[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48441158","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-48441158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":48441158,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDQxMTU4","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-07-09T08:08:50Z","updated_at":"2014-07-09T08:08:50Z","author_association":"MEMBER","body":"Did you specify sorting? The `track_scores` feature only has effect when defining `sort` in the search request.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48447622","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-48447622","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":48447622,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDQ3NjIy","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-09T09:21:50Z","updated_at":"2014-07-09T09:21:50Z","author_association":"CONTRIBUTOR","body":"Could you provide a short curl recreation of what you are seeing to demonstrate the issue?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48517297","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-48517297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":48517297,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NTE3Mjk3","user":{"login":"afoucret","id":529238,"node_id":"MDQ6VXNlcjUyOTIzOA==","avatar_url":"https://avatars0.githubusercontent.com/u/529238?v=4","gravatar_id":"","url":"https://api.github.com/users/afoucret","html_url":"https://github.com/afoucret","followers_url":"https://api.github.com/users/afoucret/followers","following_url":"https://api.github.com/users/afoucret/following{/other_user}","gists_url":"https://api.github.com/users/afoucret/gists{/gist_id}","starred_url":"https://api.github.com/users/afoucret/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/afoucret/subscriptions","organizations_url":"https://api.github.com/users/afoucret/orgs","repos_url":"https://api.github.com/users/afoucret/repos","events_url":"https://api.github.com/users/afoucret/events{/privacy}","received_events_url":"https://api.github.com/users/afoucret/received_events","type":"User","site_admin":false},"created_at":"2014-07-09T18:47:15Z","updated_at":"2014-07-09T18:47:15Z","author_association":"NONE","body":"Here is a simple test that demonstrate the \"bug\" :\n\nFirst create a doc :\n\n<pre><code>\ncurl -XPOST http://localhost:9200/test/content?pretty -d '{\n  position: 2\n}'\n</code></pre>\n\nThen try to rescore without specific sort order (so score is used) : \n\n<pre><code>\ncurl -XPOST http://localhost:9200/test/content/_search?pretty -d '{\n  rescore : {\n    window_size: 10,\n    query : {\n      rescore_query : {\n        function_score: {\n          boost_factor : 10\n        }\n      }\n    }\n  }\n}'\n</code></pre>\n\nInto the result the score is 11 just as expected : \n\n<pre><code>\n{\n  \"took\" : 1,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 11.0,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"content\",\n      \"_id\" : \"pgd5f6KEST-VPQ5-CZmXbw\",\n      \"_score\" : 11.0,\n      \"_source\":{\n          position: 2,\n       }\n    } ]\n  }\n}\n</code></pre>\n\nNow trying to executes the rescore with position as sort order :\n<code><pre>\ncurl -XPOST http://localhost:9200/test/content/_search?pretty -d '{\n  sort : {position: \"asc\"},\n  track_scores: true,\n  rescore : {\n    window_size: 10,\n    query : {\n      rescore_query : {\n        function_score: {\n          boost_factor : 10\n        }\n      }\n    }\n  }\n}'\n</code></pre>\n\nI was expected the same behavior than previously but the score into the result the score is now 1 :\n\n<code><pre>\n{\n  \"took\" : 0,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 1.0,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"content\",\n      \"_id\" : \"pgd5f6KEST-VPQ5-CZmXbw\",\n      \"_score\" : 1.0,\n      \"_source\":{\n          position: 2,\n          count_views: 3\n      },\n      \"sort\" : [ 2 ]\n    } ]\n  }\n}\n</code></pre>\n\nMy real use cases is more complicated but the idea is to apply a rescore on a small subset of document and get a secondary sort order for docs at the same position. It is not possible even when adding. In my opinion the track_scores param should be applied to the full chain of the query including rescores.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48576721","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-48576721","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":48576721,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NTc2NzIx","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-07-10T08:16:20Z","updated_at":"2014-07-10T08:16:20Z","author_association":"MEMBER","body":"The rescorer only is active when sorting by relevancy. In your second search request you're not sorting by relevancy and therefore your boost isn't applied. The `track_score` is active since the score is being kept track off in the hit, but because the rescorer isn't active the score isn't what you're expecting.\n\nThe rescorer isn't active, because it makes no sense relevancy wise to apply a rescorer on the top hits if the results aren't sorted by relevancy. I think ES needs to perhaps return a parse error if rescorer is being specified and sort isn't relevancy. Also the documentation can be clearer about this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48581875","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-48581875","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":48581875,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NTgxODc1","user":{"login":"afoucret","id":529238,"node_id":"MDQ6VXNlcjUyOTIzOA==","avatar_url":"https://avatars0.githubusercontent.com/u/529238?v=4","gravatar_id":"","url":"https://api.github.com/users/afoucret","html_url":"https://github.com/afoucret","followers_url":"https://api.github.com/users/afoucret/followers","following_url":"https://api.github.com/users/afoucret/following{/other_user}","gists_url":"https://api.github.com/users/afoucret/gists{/gist_id}","starred_url":"https://api.github.com/users/afoucret/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/afoucret/subscriptions","organizations_url":"https://api.github.com/users/afoucret/orgs","repos_url":"https://api.github.com/users/afoucret/repos","events_url":"https://api.github.com/users/afoucret/events{/privacy}","received_events_url":"https://api.github.com/users/afoucret/received_events","type":"User","site_admin":false},"created_at":"2014-07-10T09:14:55Z","updated_at":"2014-07-10T13:34:12Z","author_association":"NONE","body":"My first test was with this query (same result as previously :\n\n<code><pre>\ncurl -XPOST http://localhost:9200/test/content/_search?pretty -d '{\n  sort : [{position: \"asc\"}, {_score: \"desc\"}]\n  track_scores: true,\n  rescore : {\n    window_size: 10,\n    query : {\n      rescore_query : {\n        function_score: {\n          boost_factor : 10\n        }\n      }\n    }\n  }\n}\n'</code></pre>\n\nAs you can see the \"secondary sort is on the score. So if I get your point rescorer should be active since I sort by score even not as a primary sort order (at least it make sense from my point of view). \nBut it is does not work. And I don't think ES should raise an error in this precise case (since score is specified as one of the sort order).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48728495","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-48728495","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":48728495,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzI4NDk1","user":{"login":"afoucret","id":529238,"node_id":"MDQ6VXNlcjUyOTIzOA==","avatar_url":"https://avatars0.githubusercontent.com/u/529238?v=4","gravatar_id":"","url":"https://api.github.com/users/afoucret","html_url":"https://github.com/afoucret","followers_url":"https://api.github.com/users/afoucret/followers","following_url":"https://api.github.com/users/afoucret/following{/other_user}","gists_url":"https://api.github.com/users/afoucret/gists{/gist_id}","starred_url":"https://api.github.com/users/afoucret/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/afoucret/subscriptions","organizations_url":"https://api.github.com/users/afoucret/orgs","repos_url":"https://api.github.com/users/afoucret/repos","events_url":"https://api.github.com/users/afoucret/events{/privacy}","received_events_url":"https://api.github.com/users/afoucret/received_events","type":"User","site_admin":false},"created_at":"2014-07-11T13:16:15Z","updated_at":"2014-07-11T13:16:15Z","author_association":"NONE","body":"Any news about this ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49140691","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49140691","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49140691,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTQwNjkx","user":{"login":"afoucret","id":529238,"node_id":"MDQ6VXNlcjUyOTIzOA==","avatar_url":"https://avatars0.githubusercontent.com/u/529238?v=4","gravatar_id":"","url":"https://api.github.com/users/afoucret","html_url":"https://github.com/afoucret","followers_url":"https://api.github.com/users/afoucret/followers","following_url":"https://api.github.com/users/afoucret/following{/other_user}","gists_url":"https://api.github.com/users/afoucret/gists{/gist_id}","starred_url":"https://api.github.com/users/afoucret/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/afoucret/subscriptions","organizations_url":"https://api.github.com/users/afoucret/orgs","repos_url":"https://api.github.com/users/afoucret/repos","events_url":"https://api.github.com/users/afoucret/events{/privacy}","received_events_url":"https://api.github.com/users/afoucret/received_events","type":"User","site_admin":false},"created_at":"2014-07-16T09:23:10Z","updated_at":"2014-07-16T09:23:10Z","author_association":"NONE","body":"Hi,\n\nI really need a response about my last comment.\n\nThanks by advance\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49145512","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49145512","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49145512,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTQ1NTEy","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-16T10:09:33Z","updated_at":"2014-07-16T10:09:33Z","author_association":"CONTRIBUTOR","body":"@afoucret please don't keep asking for a response. we have this on the list of issues to discuss, but you will see that there are many issues on this list.\n\n@martijnvg i can see the use case for rescoring when not sorting by `_score`, eg give me the most recent tweets, and then rescore the top 100 by some other value. i realise there are other ways to achieve the same thing but I could understand wanting to use the rescore phase for this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49147849","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49147849","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49147849,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTQ3ODQ5","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-07-16T10:33:05Z","updated_at":"2014-07-16T10:33:05Z","author_association":"MEMBER","body":"The rescorer only works if no sort is specified at all. In that case the hits are ordered by relevancy (_score desc). I think we should allow rescoring if the sort contains `_score`? @s1monw What do you think?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49147954","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49147954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49147954,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTQ3OTU0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-16T10:34:05Z","updated_at":"2014-07-16T10:34:05Z","author_association":"CONTRIBUTOR","body":"@martijnvg even if it doesn't include `_score`, no?  why not allow it?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49148150","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49148150","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49148150,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTQ4MTUw","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-07-16T10:35:58Z","updated_at":"2014-07-16T10:35:58Z","author_association":"MEMBER","body":"@clintongormley I think rescoring only makes sense if the regular sort is _score based? Otherwise the reordering that the rescore performs for the top N docs doesn't make sense?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49148363","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49148363","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49148363,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTQ4MzYz","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-07-16T10:38:01Z","updated_at":"2014-07-16T10:38:01Z","author_association":"CONTRIBUTOR","body":"@martijnvg I think it could make sense if you want for instance the latest results but then also rank them by another factory like geo distance or importance? so ++ to allow rescorer here\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49148566","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49148566","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49148566,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTQ4NTY2","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-07-16T10:39:56Z","updated_at":"2014-07-16T10:39:56Z","author_association":"MEMBER","body":"@s1monw Ok, yes that make sense, then +1 on allowing rescore if any kind of sort is defined.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49417432","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49417432","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49417432,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NDE3NDMy","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-07-18T10:35:19Z","updated_at":"2014-07-18T10:35:19Z","author_association":"CONTRIBUTOR","body":"after thinking about this I think the only thing we can do here is to change the score but we can't reorder the results. The problem here is that we would need to rescore before we sort inorder to get the correct sort order. I wonder if this is the expected behavior or if we should just not do it at all. If we do it it will be inconsistent since if you sort by score the actual score after rescore will be different to the score used for sorting and if you are on a multi shard index it will again be different to a single shard.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49420167","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49420167","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49420167,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NDIwMTY3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-18T11:16:13Z","updated_at":"2014-07-18T11:16:13Z","author_association":"CONTRIBUTOR","body":"@s1monw not sure i understand? if the use case is:\n- select the 1000 most recent tweets\n- then sort them by _score / geo location / whatever\n\nthen you would first sort, then only rescore (and resort) the `window_size`, no?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49422303","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-49422303","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":49422303,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NDIyMzAz","user":{"login":"afoucret","id":529238,"node_id":"MDQ6VXNlcjUyOTIzOA==","avatar_url":"https://avatars0.githubusercontent.com/u/529238?v=4","gravatar_id":"","url":"https://api.github.com/users/afoucret","html_url":"https://github.com/afoucret","followers_url":"https://api.github.com/users/afoucret/followers","following_url":"https://api.github.com/users/afoucret/following{/other_user}","gists_url":"https://api.github.com/users/afoucret/gists{/gist_id}","starred_url":"https://api.github.com/users/afoucret/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/afoucret/subscriptions","organizations_url":"https://api.github.com/users/afoucret/orgs","repos_url":"https://api.github.com/users/afoucret/repos","events_url":"https://api.github.com/users/afoucret/events{/privacy}","received_events_url":"https://api.github.com/users/afoucret/received_events","type":"User","site_admin":false},"created_at":"2014-07-18T11:49:13Z","updated_at":"2014-07-18T11:49:13Z","author_association":"NONE","body":"@clintongormley \n\nI was thinking exactly the same. Sort have to be applied before rescore (easy to understand why) to get the n first doc and after rescore to resort. I don't see what is difficult but I can believe it is.\n\nAbout rescoring being inconsistent in multi-shard environments it seems to me this is consubstantial of the way rescoring works even without this sort order problem. The window_size per shard implies that the number of rescored docs depends the number of shards ... and therefore the final ordering depends the number of shards. Not shocking from a functional point of view !!!\n\nAbout the need, order is more important to me than score value.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65256653","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-65256653","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":65256653,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjU2NjUz","user":{"login":"afoucret","id":529238,"node_id":"MDQ6VXNlcjUyOTIzOA==","avatar_url":"https://avatars0.githubusercontent.com/u/529238?v=4","gravatar_id":"","url":"https://api.github.com/users/afoucret","html_url":"https://github.com/afoucret","followers_url":"https://api.github.com/users/afoucret/followers","following_url":"https://api.github.com/users/afoucret/following{/other_user}","gists_url":"https://api.github.com/users/afoucret/gists{/gist_id}","starred_url":"https://api.github.com/users/afoucret/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/afoucret/subscriptions","organizations_url":"https://api.github.com/users/afoucret/orgs","repos_url":"https://api.github.com/users/afoucret/repos","events_url":"https://api.github.com/users/afoucret/events{/privacy}","received_events_url":"https://api.github.com/users/afoucret/received_events","type":"User","site_admin":false},"created_at":"2014-12-02T16:17:24Z","updated_at":"2014-12-02T16:17:24Z","author_association":"NONE","body":"Hi everyone,\n\nAny news about this feature ?\n\nThank you very much\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65260385","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-65260385","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":65260385,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjYwMzg1","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-12-02T16:38:30Z","updated_at":"2014-12-02T16:38:30Z","author_association":"CONTRIBUTOR","body":"@afoucret I think the last time I tried to implemented this there were lots of problems that I couldn't solve easily. I try to find the branch somewhere but no promise\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65266792","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-65266792","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":65266792,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjY2Nzky","user":{"login":"afoucret","id":529238,"node_id":"MDQ6VXNlcjUyOTIzOA==","avatar_url":"https://avatars0.githubusercontent.com/u/529238?v=4","gravatar_id":"","url":"https://api.github.com/users/afoucret","html_url":"https://github.com/afoucret","followers_url":"https://api.github.com/users/afoucret/followers","following_url":"https://api.github.com/users/afoucret/following{/other_user}","gists_url":"https://api.github.com/users/afoucret/gists{/gist_id}","starred_url":"https://api.github.com/users/afoucret/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/afoucret/subscriptions","organizations_url":"https://api.github.com/users/afoucret/orgs","repos_url":"https://api.github.com/users/afoucret/repos","events_url":"https://api.github.com/users/afoucret/events{/privacy}","received_events_url":"https://api.github.com/users/afoucret/received_events","type":"User","site_admin":false},"created_at":"2014-12-02T17:13:19Z","updated_at":"2014-12-02T17:16:22Z","author_association":"NONE","body":"@s1monw : Hi thank you for your quick response. I am very sad to heard this since I meet an issues I don't see any substitution for the rescore feature to get resolved.\n\nAnother option to get a similar feature would be to allow query into the function_score and to use the nested query score to compute the final score. It would be something like : \n\n<code><pre>\nquery : {\n   function_score : {\n      query : MY_FULLTEXT_QUERY,\n      query_score : {\n        has_child : {\n        }\n      }\n   }  \n}\n</pre></code>\n\nAs you can see the main use case is to act on the final score by using the scoring of chlidren doc (or nested) as a component of the scoring (sum, multiplication, ...)\n\nWe would lose the windowing feature (which is not optimal for the biggest datasets) but it is a choice in my use case where the dataset is not huge and we prefer computation of the boost factor for the popularity to be done at the query time rather than computing it at indexing (since changing the parameter can be done live).\n\nFrom my POV, it could be a good idea to refactor rescore into function_score and append : \n- the query_score I described as rescore function just like weight, decay or script\n- a windowing method\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/95629853","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-95629853","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":95629853,"node_id":"MDEyOklzc3VlQ29tbWVudDk1NjI5ODUz","user":{"login":"Wedjaa","id":6388662,"node_id":"MDQ6VXNlcjYzODg2NjI=","avatar_url":"https://avatars1.githubusercontent.com/u/6388662?v=4","gravatar_id":"","url":"https://api.github.com/users/Wedjaa","html_url":"https://github.com/Wedjaa","followers_url":"https://api.github.com/users/Wedjaa/followers","following_url":"https://api.github.com/users/Wedjaa/following{/other_user}","gists_url":"https://api.github.com/users/Wedjaa/gists{/gist_id}","starred_url":"https://api.github.com/users/Wedjaa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Wedjaa/subscriptions","organizations_url":"https://api.github.com/users/Wedjaa/orgs","repos_url":"https://api.github.com/users/Wedjaa/repos","events_url":"https://api.github.com/users/Wedjaa/events{/privacy}","received_events_url":"https://api.github.com/users/Wedjaa/received_events","type":"User","site_admin":false},"created_at":"2015-04-23T15:46:44Z","updated_at":"2015-04-23T15:46:44Z","author_association":"NONE","body":" Hi - any news on this feature? \n Is there another way of using rescoring and sorting in the same query?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96394595","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-96394595","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":96394595,"node_id":"MDEyOklzc3VlQ29tbWVudDk2Mzk0NTk1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T14:59:10Z","updated_at":"2015-04-26T14:59:10Z","author_association":"CONTRIBUTOR","body":"Hi @Wedjaa \n\nYou may find the `terminate_after` parameter in http://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-body.html a useful alternative to rescoring.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96398681","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-96398681","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":96398681,"node_id":"MDEyOklzc3VlQ29tbWVudDk2Mzk4Njgx","user":{"login":"Wedjaa","id":6388662,"node_id":"MDQ6VXNlcjYzODg2NjI=","avatar_url":"https://avatars1.githubusercontent.com/u/6388662?v=4","gravatar_id":"","url":"https://api.github.com/users/Wedjaa","html_url":"https://github.com/Wedjaa","followers_url":"https://api.github.com/users/Wedjaa/followers","following_url":"https://api.github.com/users/Wedjaa/following{/other_user}","gists_url":"https://api.github.com/users/Wedjaa/gists{/gist_id}","starred_url":"https://api.github.com/users/Wedjaa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Wedjaa/subscriptions","organizations_url":"https://api.github.com/users/Wedjaa/orgs","repos_url":"https://api.github.com/users/Wedjaa/repos","events_url":"https://api.github.com/users/Wedjaa/events{/privacy}","received_events_url":"https://api.github.com/users/Wedjaa/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T15:12:22Z","updated_at":"2015-04-26T15:12:22Z","author_association":"NONE","body":"Hi @clintongormley,\n\nlooked into it, but I don't seem to be able to figure out how it substitutes rescoring. Am I missing something here?\n\nThe use case: search for some inexpensive query, rescore using expensive queries and then sort by relevance scoring and - for example - item name. I don't think is such an extreme case, considering that rescoring is targeted to exactly this use case - minus the sorting.\n\nI'm at a loss on why the score is not added to the hits; especially considering that enabling \"explain\" the hits will contain the rescored value in the explanation; which means is somehow available when the hits are merged together to be given out as a response.\n\n  cheers\n  Fabio\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96417522","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-96417522","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":96417522,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDE3NTIy","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T18:14:15Z","updated_at":"2015-04-26T18:14:15Z","author_association":"CONTRIBUTOR","body":"@Wedjaa I don't know the details of why this change is complex - just taking it on trust.\n\nActually, ignore my comments about `terminate_after` - I realise that it doesn't fit here at all.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/112737437","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-112737437","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":112737437,"node_id":"MDEyOklzc3VlQ29tbWVudDExMjczNzQzNw==","user":{"login":"tvarvadoukas","id":1948926,"node_id":"MDQ6VXNlcjE5NDg5MjY=","avatar_url":"https://avatars0.githubusercontent.com/u/1948926?v=4","gravatar_id":"","url":"https://api.github.com/users/tvarvadoukas","html_url":"https://github.com/tvarvadoukas","followers_url":"https://api.github.com/users/tvarvadoukas/followers","following_url":"https://api.github.com/users/tvarvadoukas/following{/other_user}","gists_url":"https://api.github.com/users/tvarvadoukas/gists{/gist_id}","starred_url":"https://api.github.com/users/tvarvadoukas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvarvadoukas/subscriptions","organizations_url":"https://api.github.com/users/tvarvadoukas/orgs","repos_url":"https://api.github.com/users/tvarvadoukas/repos","events_url":"https://api.github.com/users/tvarvadoukas/events{/privacy}","received_events_url":"https://api.github.com/users/tvarvadoukas/received_events","type":"User","site_admin":false},"created_at":"2015-06-17T09:39:52Z","updated_at":"2015-06-17T09:39:52Z","author_association":"NONE","body":"Hey all! I would also agree that this is a very common usecase. It's a must-feature on our side as well. Are there any news on this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/314706809","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-314706809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":314706809,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNDcwNjgwOQ==","user":{"login":"silashansen","id":969596,"node_id":"MDQ6VXNlcjk2OTU5Ng==","avatar_url":"https://avatars3.githubusercontent.com/u/969596?v=4","gravatar_id":"","url":"https://api.github.com/users/silashansen","html_url":"https://github.com/silashansen","followers_url":"https://api.github.com/users/silashansen/followers","following_url":"https://api.github.com/users/silashansen/following{/other_user}","gists_url":"https://api.github.com/users/silashansen/gists{/gist_id}","starred_url":"https://api.github.com/users/silashansen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/silashansen/subscriptions","organizations_url":"https://api.github.com/users/silashansen/orgs","repos_url":"https://api.github.com/users/silashansen/repos","events_url":"https://api.github.com/users/silashansen/events{/privacy}","received_events_url":"https://api.github.com/users/silashansen/received_events","type":"User","site_admin":false},"created_at":"2017-07-12T09:24:48Z","updated_at":"2017-07-12T09:25:42Z","author_association":"NONE","body":"I've just done a simple test and it seems that this issue has been fixed and that sort is not disabling rescoring anymore.\r\n\r\nI'm on ES 5.3.2\r\n\r\nFirst create some documents:\r\n```\r\nPOST test/rescores\r\n{\r\n  \"Title\": \"Document A\"\r\n}\r\n\r\nPOST test/rescores\r\n{\r\n  \"Title\": \"Document B\"\r\n}\r\n```\r\n\r\nQuery the index to see the what the response looks like without any sorting and rescoring:\r\n\r\n```\r\nGET test/rescores/_search\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"fields\": [\"Title\"], \r\n      \"query\": \"Document B\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n  \"took\": 1,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 2,\r\n    \"max_score\": 0.78549397,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"test\",\r\n        \"_type\": \"rescores\",\r\n        \"_id\": \"AV02FVaYJKvO25AaxC0D\",\r\n        \"_score\": 0.78549397,\r\n        \"_source\": {\r\n          \"Title\": \"Document B\"\r\n        }\r\n      },\r\n      {\r\n        \"_index\": \"test\",\r\n        \"_type\": \"rescores\",\r\n        \"_id\": \"AV02FQv7JKvO25AaxC0C\",\r\n        \"_score\": 0.16358379,\r\n        \"_source\": {\r\n          \"Title\": \"Document A\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nNow issue a request that includes both rescoring and sorting.\r\n\r\n```\r\nGET test/rescores/_search\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"fields\": [\"Title\"], \r\n      \"query\": \"Document B\"\r\n    }\r\n  },\r\n  \"sort\": [\r\n    {\r\n      \"_score\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    }\r\n  ],\r\n    \"rescore\": {\r\n    \"window_size\": 100,\r\n    \"query\": {\r\n      \"rescore_query\": {\r\n        \"function_score\": {\r\n          \"script_score\": {\r\n            \"script\": {\r\n              \"inline\": \"return 10\"\r\n            }\r\n          },\r\n          \"boost_mode\": \"multiply\"\r\n        }\r\n      },\r\n      \"query_weight\": 1,\r\n      \"rescore_query_weight\": 1\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nResponse:\r\n\r\n```\r\n{\r\n  \"took\": 1,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 2,\r\n    \"max_score\": 10.785494,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"test\",\r\n        \"_type\": \"rescores\",\r\n        \"_id\": \"AV02FVaYJKvO25AaxC0D\",\r\n        \"_score\": 10.785494,\r\n        \"_source\": {\r\n          \"Title\": \"Document B\"\r\n        }\r\n      },\r\n      {\r\n        \"_index\": \"test\",\r\n        \"_type\": \"rescores\",\r\n        \"_id\": \"AV02FQv7JKvO25AaxC0C\",\r\n        \"_score\": 10.163584,\r\n        \"_source\": {\r\n          \"Title\": \"Document A\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n\r\n```\r\n\r\nNow, it's obvious that the rescoring is in fact active, as the scores are clearly factored by the boost in the rescore query.\r\n\r\nSo, what is the status from Elastic on this? Should the docs be updated or am I misunderstanding something?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/314899594","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-314899594","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":314899594,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNDg5OTU5NA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-12T21:16:36Z","updated_at":"2017-07-12T21:16:36Z","author_association":"MEMBER","body":"hi @silashansen unfortunately this issue wasn't solved. I can still reproduce the initial recreation above. I suspect everything works in your case because your sort clause is the default one, as you are sorting by score descending which is the same as leaving the sort clause out of the request.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/315021606","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-315021606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":315021606,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNTAyMTYwNg==","user":{"login":"silashansen","id":969596,"node_id":"MDQ6VXNlcjk2OTU5Ng==","avatar_url":"https://avatars3.githubusercontent.com/u/969596?v=4","gravatar_id":"","url":"https://api.github.com/users/silashansen","html_url":"https://github.com/silashansen","followers_url":"https://api.github.com/users/silashansen/followers","following_url":"https://api.github.com/users/silashansen/following{/other_user}","gists_url":"https://api.github.com/users/silashansen/gists{/gist_id}","starred_url":"https://api.github.com/users/silashansen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/silashansen/subscriptions","organizations_url":"https://api.github.com/users/silashansen/orgs","repos_url":"https://api.github.com/users/silashansen/repos","events_url":"https://api.github.com/users/silashansen/events{/privacy}","received_events_url":"https://api.github.com/users/silashansen/received_events","type":"User","site_admin":false},"created_at":"2017-07-13T09:16:56Z","updated_at":"2017-07-13T09:16:56Z","author_association":"NONE","body":"You are absolutely right - what a shame!\r\nIs it anywhere on the roadmap to get this fixed?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/315065083","html_url":"https://github.com/elastic/elasticsearch/issues/6788#issuecomment-315065083","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6788","id":315065083,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNTA2NTA4Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-07-13T12:37:45Z","updated_at":"2017-07-13T12:37:45Z","author_association":"MEMBER","body":"The issue reported here is not a bug and cannot be \"fixed\". The rescorer by design should always rescore top hits sorted by `_score`. It's the only way to have the correct behavior because rescoring is done at the shard level. In the recreation of this issue the rescorer is used on a result sorted by something else than `_score`, a field named `position`. To get the N best documents sorted by `position` we need to fetch the N best results for all shards. \r\nThough the rescoring reorders the top N+M with a function score at the shard level and returns a new top N. So it's not returning the best N documents per shard sorted by position but the best N documents sorted by the function score among the N+M best documents sorted by position. \r\nTo be accurate the rescoring should be applied to the N best documents  globally, not per shard, otherwise the returned documents may not represent the first sort.\r\n\r\nI am closing this issue because this is a known limitation. Rescoring works only when _score is the first sort criteria.","performed_via_github_app":null}]