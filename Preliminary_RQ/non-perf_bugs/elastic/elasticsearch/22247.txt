{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22247","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22247/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22247/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22247/events","html_url":"https://github.com/elastic/elasticsearch/issues/22247","id":196218919,"node_id":"MDU6SXNzdWUxOTYyMTg5MTk=","number":22247,"title":"Find no. of Buckets entering an Aggregation Pipeline","user":{"login":"singhvijayy","id":8468345,"node_id":"MDQ6VXNlcjg0NjgzNDU=","avatar_url":"https://avatars0.githubusercontent.com/u/8468345?v=4","gravatar_id":"","url":"https://api.github.com/users/singhvijayy","html_url":"https://github.com/singhvijayy","followers_url":"https://api.github.com/users/singhvijayy/followers","following_url":"https://api.github.com/users/singhvijayy/following{/other_user}","gists_url":"https://api.github.com/users/singhvijayy/gists{/gist_id}","starred_url":"https://api.github.com/users/singhvijayy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singhvijayy/subscriptions","organizations_url":"https://api.github.com/users/singhvijayy/orgs","repos_url":"https://api.github.com/users/singhvijayy/repos","events_url":"https://api.github.com/users/singhvijayy/events{/privacy}","received_events_url":"https://api.github.com/users/singhvijayy/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-12-17T12:08:30Z","updated_at":"2016-12-19T15:18:34Z","closed_at":"2016-12-19T15:18:34Z","author_association":"NONE","active_lock_reason":null,"body":"Let me explain with the help of an example -\r\n\r\nLets say we have a `laces` index:\r\n```\r\n    \"shoeid\": {\r\n            \"type\": \"string\",\r\n            \"index\": \"not_analyzed\"\r\n    },\r\n\r\n    \"shoetimestamp\": {\r\n            \"type\": \"date\",\r\n            \"format\": \"epoch_millis\",\r\n    },\r\n\r\n    \"laceindex\": {\r\n            \"type\": \"string\",\r\n            \"index\": \"not_analyzed\"\r\n    },\r\n\r\n    \"lacetimestamp\": {\r\n            \"type\": \"date\",\r\n            \"format\": \"epoch_millis\",\r\n    },\r\n\r\n    \"info\": {\r\n            \"type\": \"string\",\r\n            \"analyzer\": \"whitespace\"\r\n    }\r\n```\r\n\r\nAll `laceindex` and `lacetimestamp` are unique, but `shoeid` and `shoetimestamp` are shared. If I want to get all laces with same `shoeid` and then do a calculation with `shoetimestamp` and `no. of buckets coming out of the terms aggr on shoeid` i.e.` laces with same shoeid`, I cannot do that! \r\n\r\nBecause when I run an aggregation, I do not have no. of buckets entering the pipeline!\r\n\r\nFollowing aggregation query doesn't solve the purpose -\r\n\r\n    \"aggs\": {\r\n            \"one\": {\r\n                    \"terms\": {\r\n                            \"field\": \"shoeid\",\r\n                            \"size\": 10000\r\n                    },\r\n\r\n                    \"aggs\": {\r\n                            \r\n                            // IDEALLY I WOULD LIKE TO DO -\r\n                            // no. of buckets entering this pipeline * shoetimestamp\r\n                            // (shoetimestamp will be same for all buckets here)\r\n\r\n                            \"count\": {\r\n                                    \"value_count\": {\r\n                                            \"field\": \"shoetimestamp\"\r\n                                    }\r\n\r\n                                    // I have lost shoetimestamp here :(\r\n                            }\r\n                    }\r\n            }\r\n    }","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}