{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32357","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32357/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32357/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32357/events","html_url":"https://github.com/elastic/elasticsearch/issues/32357","id":344382471,"node_id":"MDU6SXNzdWUzNDQzODI0NzE=","number":32357,"title":"20+ whitespace chars in bulk insert makes index unsearchable","user":{"login":"ifo20","id":7935805,"node_id":"MDQ6VXNlcjc5MzU4MDU=","avatar_url":"https://avatars0.githubusercontent.com/u/7935805?v=4","gravatar_id":"","url":"https://api.github.com/users/ifo20","html_url":"https://github.com/ifo20","followers_url":"https://api.github.com/users/ifo20/followers","following_url":"https://api.github.com/users/ifo20/following{/other_user}","gists_url":"https://api.github.com/users/ifo20/gists{/gist_id}","starred_url":"https://api.github.com/users/ifo20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ifo20/subscriptions","organizations_url":"https://api.github.com/users/ifo20/orgs","repos_url":"https://api.github.com/users/ifo20/repos","events_url":"https://api.github.com/users/ifo20/events{/privacy}","received_events_url":"https://api.github.com/users/ifo20/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":11,"created_at":"2018-07-25T10:17:57Z","updated_at":"2018-08-07T09:30:51Z","closed_at":"2018-08-07T09:30:51Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 6.3.2 (this doesn't occur in 6.3.1)\r\n\r\nA bulk insert request with 20 or more consecutive whitespace chars returns a successful response but makes index unsearchable. \r\n\r\nThe repro steps below do not require any 'initialise index' step (the issue remains whether you specify an index mapping  or use the default inferred mapping).\r\n\r\n**Steps to reproduce**:\r\n 1. POST request to `localhost:9200/this_index_name/_doc/_bulk`\r\nHeaders: \"Content-Type\" : \"application/json\" (have also tried \"applciation/x-ndjson\")\r\n Body:\r\n```\r\n{\"index\":{\"_id\":\"1\"}}\r\n{\"Name\":\"Adam\"}\r\n{\"index\":{\"_id\":\"2\"}}\r\n{\"Name\":\"Bob\"}\r\n{\"index\":{\"_id\":\"3\"}}\r\n                    {\"Name\":\"Charlie\"}\r\n\r\n```\r\nThis gives an apparently successful response:\r\n```\r\n{\r\n    \"took\": 583,\r\n    \"errors\": false,\r\n    \"items\": [\r\n        {\r\n            \"index\": {\r\n                \"_index\": \"this_index_name\",\r\n                \"_type\": \"_doc\",\r\n                \"_id\": \"1\",\r\n                \"_version\": 1,\r\n                \"result\": \"created\",\r\n                \"_shards\": {\r\n                    \"total\": 2,\r\n                    \"successful\": 1,\r\n                    \"failed\": 0\r\n                },\r\n                \"_seq_no\": 0,\r\n                \"_primary_term\": 1,\r\n                \"status\": 201\r\n            }\r\n        },\r\n        {\r\n            \"index\": {\r\n                \"_index\": \"this_index_name\",\r\n                \"_type\": \"_doc\",\r\n                \"_id\": \"2\",\r\n                \"_version\": 1,\r\n                \"result\": \"created\",\r\n                \"_shards\": {\r\n                    \"total\": 2,\r\n                    \"successful\": 1,\r\n                    \"failed\": 0\r\n                },\r\n                \"_seq_no\": 0,\r\n                \"_primary_term\": 1,\r\n                \"status\": 201\r\n            }\r\n        },\r\n        {\r\n            \"index\": {\r\n                \"_index\": \"this_index_name\",\r\n                \"_type\": \"_doc\",\r\n                \"_id\": \"3\",\r\n                \"_version\": 1,\r\n                \"result\": \"created\",\r\n                \"_shards\": {\r\n                    \"total\": 2,\r\n                    \"successful\": 1,\r\n                    \"failed\": 0\r\n                },\r\n                \"_seq_no\": 0,\r\n                \"_primary_term\": 1,\r\n                \"status\": 201\r\n            }\r\n        }\r\n    ]\r\n}\r\n\r\n```\r\n2. Try and search the index : `localhost:9200/this_index_name/_search`\r\nGet the following error response:\r\n```\r\n{\r\n    \"error\": {\r\n        \"root_cause\": [\r\n        {\r\n            \"type\": \"illegal_argument_exception\",\r\n            \"reason\": \"Can't write raw bytes whose xcontent-type can't be guessed\"\r\n        }\r\n        ],\r\n    \"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"Can't write raw bytes whose xcontent-type can't be guessed\"\r\n},\r\n    \"status\": 400\r\n}\r\n\r\n```\r\n\r\nThere don't appear to be any relevant logs but here they are:\r\n```[2018-07-25T10:53:51,278][INFO ][o.e.n.Node               ] [] initializing ...\r\n[2018-07-25T10:53:51,348][INFO ][o.e.e.NodeEnvironment    ] [9kDaYeG] using [1] data paths, mounts [[OS (C:)]], net usable_space [84.6gb], net total_space [232.3gb], types [NTFS]\r\n[2018-07-25T10:53:51,348][INFO ][o.e.e.NodeEnvironment    ] [9kDaYeG] heap size [989.8mb], compressed ordinary object pointers [unknown]\r\n[2018-07-25T10:53:51,351][INFO ][o.e.n.Node               ] [9kDaYeG] node name derived from node ID [9kDaYeGGTL-IO9TLc4IfUw]; set [node.name] to override\r\n[2018-07-25T10:53:51,352][INFO ][o.e.n.Node               ] [9kDaYeG] version[6.3.2], pid[19936], build[default/zip/053779d/2018-07-20T05:20:23.451332Z], OS[Windows 10/10.0/x86], JVM[Oracle Corporation/Java HotSpot(TM) Client VM/1.8.0_171/25.171-b11]\r\n[2018-07-25T10:53:51,352][INFO ][o.e.n.Node               ] [9kDaYeG] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=C:\\Users\\IOlliver\\AppData\\Local\\Temp\\elasticsearch, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -Delasticsearch, -Des.path.home=C:\\Users\\IOlliver\\Downloads\\elasticsearch-6.3.2\\elasticsearch-6.3.2, -Des.path.conf=C:\\Users\\IOlliver\\Downloads\\elasticsearch-6.3.2\\elasticsearch-6.3.2\\config, -Des.distribution.flavor=default, -Des.distribution.type=zip]\r\n[2018-07-25T10:53:53,933][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [aggs-matrix-stats]\r\n[2018-07-25T10:53:53,933][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [analysis-common]\r\n[2018-07-25T10:53:53,933][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [ingest-common]\r\n[2018-07-25T10:53:53,933][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [lang-expression]\r\n[2018-07-25T10:53:53,934][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [lang-mustache]\r\n[2018-07-25T10:53:53,934][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [lang-painless]\r\n[2018-07-25T10:53:53,934][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [mapper-extras]\r\n[2018-07-25T10:53:53,934][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [parent-join]\r\n[2018-07-25T10:53:53,934][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [percolator]\r\n[2018-07-25T10:53:53,934][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [rank-eval]\r\n[2018-07-25T10:53:53,934][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [reindex]\r\n[2018-07-25T10:53:53,935][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [repository-url]\r\n[2018-07-25T10:53:53,935][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [transport-netty4]\r\n[2018-07-25T10:53:53,935][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [tribe]\r\n[2018-07-25T10:53:53,935][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-core]\r\n[2018-07-25T10:53:53,935][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-deprecation]\r\n[2018-07-25T10:53:53,935][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-graph]\r\n[2018-07-25T10:53:53,936][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-logstash]\r\n[2018-07-25T10:53:53,936][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-ml]\r\n[2018-07-25T10:53:53,937][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-monitoring]\r\n[2018-07-25T10:53:53,937][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-rollup]\r\n[2018-07-25T10:53:53,938][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-security]\r\n[2018-07-25T10:53:53,939][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-sql]\r\n[2018-07-25T10:53:53,939][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-upgrade]\r\n[2018-07-25T10:53:53,940][INFO ][o.e.p.PluginsService     ] [9kDaYeG] loaded module [x-pack-watcher]\r\n[2018-07-25T10:53:53,941][INFO ][o.e.p.PluginsService     ] [9kDaYeG] no plugins loaded\r\n[2018-07-25T10:53:58,884][INFO ][o.e.x.s.a.s.FileRolesStore] [9kDaYeG] parsed [0] roles from file [C:\\Users\\IOlliver\\Downloads\\elasticsearch-6.3.2\\elasticsearch-6.3.2\\config\\roles.yml]\r\n[2018-07-25T10:53:59,551][DEBUG][o.e.a.ActionModule       ] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security\r\n[2018-07-25T10:53:59,743][INFO ][o.e.d.DiscoveryModule    ] [9kDaYeG] using discovery type [zen]\r\n[2018-07-25T10:54:00,359][INFO ][o.e.n.Node               ] [9kDaYeG] initialized\r\n[2018-07-25T10:54:00,360][INFO ][o.e.n.Node               ] [9kDaYeG] starting ...\r\n[2018-07-25T10:54:00,726][INFO ][o.e.t.TransportService   ] [9kDaYeG] publish_address {127.0.0.1:9300}, bound_addresses {127.0.0.1:9300}, {[::1]:9300}\r\n[2018-07-25T10:54:00,746][WARN ][o.e.b.BootstrapChecks    ] [9kDaYeG] JVM is using the client VM [Java HotSpot(TM) Client VM] but should be using a server VM for the best performance\r\n[2018-07-25T10:54:03,791][INFO ][o.e.c.s.MasterService    ] [9kDaYeG] zen-disco-elected-as-master ([0] nodes joined)[, ], reason: new_master {9kDaYeG}{9kDaYeGGTL-IO9TLc4IfUw}{lupi21suR0GclAZR-fjSZQ}{127.0.0.1}{127.0.0.1:9300}{xpack.installed=true}\r\n[2018-07-25T10:54:03,798][INFO ][o.e.c.s.ClusterApplierService] [9kDaYeG] new_master {9kDaYeG}{9kDaYeGGTL-IO9TLc4IfUw}{lupi21suR0GclAZR-fjSZQ}{127.0.0.1}{127.0.0.1:9300}{xpack.installed=true}, reason: apply cluster state (from master [master {9kDaYeG}{9kDaYeGGTL-IO9TLc4IfUw}{lupi21suR0GclAZR-fjSZQ}{127.0.0.1}{127.0.0.1:9300}{xpack.installed=true} committed version [1] source [zen-disco-elected-as-master ([0] nodes joined)[, ]]])\r\n[2018-07-25T10:54:03,842][WARN ][o.e.x.s.a.s.m.NativeRoleMappingStore] [9kDaYeG] Failed to clear cache for realms [[]]\r\n[2018-07-25T10:54:03,883][INFO ][o.e.g.GatewayService     ] [9kDaYeG] recovered [0] indices into cluster_state\r\n[2018-07-25T10:54:03,951][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [9kDaYeG] publish_address {127.0.0.1:9200}, bound_addresses {127.0.0.1:9200}, {[::1]:9200}\r\n[2018-07-25T10:54:03,952][INFO ][o.e.n.Node               ] [9kDaYeG] started\r\n[2018-07-25T10:54:03,999][INFO ][o.e.c.m.MetaDataIndexTemplateService] [9kDaYeG] adding template [.triggered_watches] for index patterns [.triggered_watches*]\r\n[2018-07-25T10:54:04,042][INFO ][o.e.c.m.MetaDataIndexTemplateService] [9kDaYeG] adding template [.watch-history-7] for index patterns [.watcher-history-7*]\r\n[2018-07-25T10:54:04,067][INFO ][o.e.c.m.MetaDataIndexTemplateService] [9kDaYeG] adding template [.watches] for index patterns [.watches*]\r\n[2018-07-25T10:54:04,103][INFO ][o.e.c.m.MetaDataIndexTemplateService] [9kDaYeG] adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-6-*]\r\n[2018-07-25T10:54:04,154][INFO ][o.e.c.m.MetaDataIndexTemplateService] [9kDaYeG] adding template [.monitoring-es] for index patterns [.monitoring-es-6-*]\r\n[2018-07-25T10:54:04,178][INFO ][o.e.c.m.MetaDataIndexTemplateService] [9kDaYeG] adding template [.monitoring-beats] for index patterns [.monitoring-beats-6-*]\r\n[2018-07-25T10:54:04,201][INFO ][o.e.c.m.MetaDataIndexTemplateService] [9kDaYeG] adding template [.monitoring-alerts] for index patterns [.monitoring-alerts-6]\r\n[2018-07-25T10:54:04,225][INFO ][o.e.c.m.MetaDataIndexTemplateService] [9kDaYeG] adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-6-*]\r\n[2018-07-25T10:54:04,267][INFO ][o.e.l.LicenseService     ] [9kDaYeG] license [48f1088e-a83e-4126-9751-e5f75956d7e7] mode [basic] - valid\r\n[2018-07-25T10:54:36,424][INFO ][o.e.c.m.MetaDataCreateIndexService] [9kDaYeG] [autocomplete_tenant_test] creating index, cause [auto(bulk api)], templates [], shards [5]/[1], mappings []\r\n[2018-07-25T10:54:36,905][INFO ][o.e.c.m.MetaDataMappingService] [9kDaYeG] [autocomplete_tenant_test/Pm8y5s4hQLCPfMFldTxQ3g] create_mapping [_doc]```\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}