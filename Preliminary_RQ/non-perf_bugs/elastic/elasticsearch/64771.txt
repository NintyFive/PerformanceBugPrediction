{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/64771","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64771/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64771/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64771/events","html_url":"https://github.com/elastic/elasticsearch/issues/64771","id":739006408,"node_id":"MDU6SXNzdWU3MzkwMDY0MDg=","number":64771,"title":"LambdaConversionException Invalid receiver type interface org.apache.http.Header -from RestHighLevelClient in Logstash plugin","user":{"login":"panchuanzhi","id":12722208,"node_id":"MDQ6VXNlcjEyNzIyMjA4","avatar_url":"https://avatars0.githubusercontent.com/u/12722208?v=4","gravatar_id":"","url":"https://api.github.com/users/panchuanzhi","html_url":"https://github.com/panchuanzhi","followers_url":"https://api.github.com/users/panchuanzhi/followers","following_url":"https://api.github.com/users/panchuanzhi/following{/other_user}","gists_url":"https://api.github.com/users/panchuanzhi/gists{/gist_id}","starred_url":"https://api.github.com/users/panchuanzhi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/panchuanzhi/subscriptions","organizations_url":"https://api.github.com/users/panchuanzhi/orgs","repos_url":"https://api.github.com/users/panchuanzhi/repos","events_url":"https://api.github.com/users/panchuanzhi/events{/privacy}","received_events_url":"https://api.github.com/users/panchuanzhi/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-11-09T12:57:14Z","updated_at":"2020-11-10T13:58:15Z","closed_at":"2020-11-10T13:58:15Z","author_association":"NONE","active_lock_reason":null,"body":"I have encounter the same issue in the logstash java plugin enviroment. The RestHighLevelClient can run well in IDEA enviroment for testing, but when I \"gradlew gem\"  the gem package, and run it in logstash-plugin enviroment, there\r\nwill be:\r\n\r\n[2020-11-10T00:09:04,077][INFO ][logstash.agent           ] Successfully started Logstash API endpoint {:port=>9600}\r\nwarning: thread \"[main]>worker1\" terminated with exception (report_on_exception is true):\r\njava.lang.BootstrapMethodError: bootstrap method initialization exception\r\n\tat java.lang.invoke.BootstrapMethodInvoker.invoke(java/lang/invoke/BootstrapMethodInvoker.java:194)\r\n\tat java.lang.invoke.CallSite.makeSite(java/lang/invoke/CallSite.java:315)\r\n\tat java.lang.invoke.MethodHandleNatives.linkCallSiteImpl(java/lang/invoke/MethodHandleNatives.java:259)\r\n\tat java.lang.invoke.MethodHandleNatives.linkCallSite(java/lang/invoke/MethodHandleNatives.java:249)\r\n\tat org.elasticsearch.client.RestClient.convertResponse(org/elasticsearch/client/RestClient.java:288)\r\n\tat org.elasticsearch.client.RestClient.performRequest(org/elasticsearch/client/RestClient.java:272)\r\n\tat org.elasticsearch.client.RestClient.performRequest(org/elasticsearch/client/RestClient.java:246)\r\n\tat org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(org/elasticsearch/client/RestHighLevelClient.java:1613)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequest(org/elasticsearch/client/RestHighLevelClient.java:1583)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(org/elasticsearch/client/RestHighLevelClient.java:1553)\r\n\tat org.elasticsearch.client.RestHighLevelClient.bulk(org/elasticsearch/client/RestHighLevelClient.java:533)\r\n\tat org.logstashplugins.OutputLogstashPlugin.bulkWriteES(org/logstashplugins/OutputLogstashPlugin.java:75)\r\n\tat org.logstashplugins.OutputLogstashPlugin.process(org/logstashplugins/OutputLogstashPlugin.java:617)\r\n\tat org.logstashplugins.JavaOutputExample.output(org/logstashplugins/JavaOutputExample.java:104)\r\n\tat org.logstash.config.ir.compiler.JavaOutputDelegatorExt.outputRubyEvents(org/logstash/config/ir/compiler/JavaOutputDelegatorExt.java:92)\r\n\tat org.logstash.config.ir.compiler.JavaOutputDelegatorExt.doOutput(org/logstash/config/ir/compiler/JavaOutputDelegatorExt.java:115)\r\n\tat org.logstash.config.ir.compiler.AbstractOutputDelegatorExt.multi_receive(org/logstash/config/ir/compiler/AbstractOutputDelegatorExt.java:121)\r\n\tat org.logstash.generated.CompiledDataset1.compute(org/logstash/generated/CompiledDataset1)\r\n\tat org.logstash.config.ir.CompiledPipeline$CompiledUnorderedExecution.compute(org/logstash/config/ir/CompiledPipeline.java:343)\r\n\tat org.logstash.config.ir.CompiledPipeline$CompiledUnorderedExecution.compute(org/logstash/config/ir/CompiledPipeline.java:333)\r\n\tat org.logstash.execution.WorkerLoop.run(org/logstash/execution/WorkerLoop.java:83)\r\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke(jdk/internal/reflect/NativeMethodAccessorImpl.java:62)\r\n\tat jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(jdk/internal/reflect/DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(java/lang/reflect/Method.java:564)\r\n\tat org.jruby.javasupport.JavaMethod.invokeDirectWithExceptionHandling(org/jruby/javasupport/JavaMethod.java:426)\r\n\tat org.jruby.javasupport.JavaMethod.invokeDirect(org/jruby/javasupport/JavaMethod.java:293)\r\n\tat usr.local.logstash.logstash_minus_core.lib.logstash.java_pipeline.start_workers(/usr/local/logstash/logstash-core/lib/logstash/java_pipeline.rb:293)\r\n\tat org.jruby.RubyProc.call(org/jruby/RubyProc.java:318)\r\n\tat java.lang.Thread.run(java/lang/Thread.java:832)\r\nCaused by: java.lang.invoke.LambdaConversionException: Invalid receiver type interface org.apache.http.Header; not a subtype of implementation type interface org.apache.http.NameValuePair\r\n\tat java.base/java.lang.invoke.AbstractValidatingLambdaMetafactory.validateMetafactoryArgs(AbstractValidatingLambdaMetafactory.java:254)\r\n\tat java.base/java.lang.invoke.LambdaMetafactory.metafactory(LambdaMetafactory.java:327)\r\n\tat java.base/java.lang.invoke.BootstrapMethodInvoker.invoke(BootstrapMethodInvoker.java:127)\r\n\tat java.base/java.lang.invoke.CallSite.makeSite(CallSite.java:315)\r\n\tat java.base/java.lang.invoke.MethodHandleNatives.linkCallSiteImpl(MethodHandleNatives.java:259)\r\n\tat java.base/java.lang.invoke.MethodHandleNatives.linkCallSite(MethodHandleNatives.java:249)\r\n\tat org.elasticsearch.client.RestClient.convertResponse(RestClient.java:288)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:272)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:246)\r\n\tat org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1613)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1583)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1553)\r\n\tat org.elasticsearch.client.RestHighLevelClient.bulk(RestHighLevelClient.java:533)\r\n\tat org.logstashplugins.OutputLogstashPlugin.bulkWriteES(OutputLogstashPlugin.java:75)\r\n\tat org.logstashplugins.OutputLogstashPlugin.process(OutputLogstashPlugin.java:617)\r\n\tat org.logstashplugins.JavaOutputExample.output(JavaOutputExample.java:104)\r\n\tat org.logstash.config.ir.compiler.JavaOutputDelegatorExt.outputRubyEvents(JavaOutputDelegatorExt.java:92)\r\n\tat org.logstash.config.ir.compiler.JavaOutputDelegatorExt.doOutput(JavaOutputDelegatorExt.java:115)\r\n\tat org.logstash.config.ir.compiler.AbstractOutputDelegatorExt.multiReceive(AbstractOutputDelegatorExt.java:121)\r\n\tat org.logstash.generated.CompiledDataset1.compute(Unknown Source)\r\n\tat org.logstash.config.ir.CompiledPipeline$CompiledUnorderedExecution.compute(CompiledPipeline.java:343)\r\n\tat org.logstash.config.ir.CompiledPipeline$CompiledUnorderedExecution.compute(CompiledPipeline.java:333)\r\n\tat org.logstash.execution.WorkerLoop.run(WorkerLoop.java:83)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\r\nThe linux jvm enviroment version is jdk 11, the same as the IDEA windows enviroment.  There is no http httpcore.jar class path issue. httpclient is in the  httpasyncclient-4.1.4.jar' related version like below:\r\n\r\n compile fileTree(dir: 'D:\\\\project\\\\logELK\\\\logstash-output-java_output_example\\\\locallib\\\\httpclient', include: 'httpasyncclient-4.1.4.jar')\r\n    compile fileTree(dir: 'D:\\\\project\\\\logELK\\\\logstash-output-java_output_example\\\\locallib\\\\httpclient', include: 'httpclient-4.5.6.jar')\r\n    compile fileTree(dir: 'D:\\\\project\\\\logELK\\\\logstash-output-java_output_example\\\\locallib\\\\httpclient', include: 'httpcore-4.4.10.jar')\r\n    compile fileTree(dir: 'D:\\\\project\\\\logELK\\\\logstash-output-java_output_example\\\\locallib\\\\httpclient', include: 'httpcore-nio-4.4.10.jar')\r\n\r\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}