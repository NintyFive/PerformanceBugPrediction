{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29222","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29222/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29222/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29222/events","html_url":"https://github.com/elastic/elasticsearch/issues/29222","id":308053211,"node_id":"MDU6SXNzdWUzMDgwNTMyMTE=","number":29222,"title":"Disallow querying a context suggester without context","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-03-23T14:34:47Z","updated_at":"2018-05-31T14:09:49Z","closed_at":"2018-05-31T14:09:49Z","author_association":"MEMBER","active_lock_reason":null,"body":"When querying a context aware`completion` field it is possible to omit the `context` and search for **all** possible contexts for the suggestions. This has the advantage to be flexible, you don't need to know all possible contexts at query time but it also makes the suggester very slow since the `context` of the suggestions are added as a prefix at indexing time. When no context is given, the completion suggester needs to follow all possible context paths and starts the real suggestion query from all the leaves of these paths. It works ok if you have a small number of contexts but degrades quickly. One solution could be to limit the number of context values that you can add in a suggestion at indexing time but that would only count the number of contexts per document not the total number of unique contexts in an index/shard/segments. Another solution would be to limit the number of paths that a query without context can follow and ignores the other if it reaches the limit but this would be weird to return only some results and not all. IMO the best solution would be to require a context on query that targets a context completion field. This would be a breaking change but we already advise in the documentation to add contexts only if you're planning to also query with a context:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/6.2/suggester-context.html#_category_query","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}