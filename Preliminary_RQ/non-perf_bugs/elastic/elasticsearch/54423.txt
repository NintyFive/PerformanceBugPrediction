{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/54423","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54423/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54423/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54423/events","html_url":"https://github.com/elastic/elasticsearch/issues/54423","id":590300838,"node_id":"MDU6SXNzdWU1OTAzMDA4Mzg=","number":54423,"title":"SamlIdentityProviderTests.testIdPInitiatedSsoFailsWithoutSecondaryAuthentication fails with doc version conflict","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1967499607,"node_id":"MDU6TGFiZWwxOTY3NDk5NjA3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Security","name":"Team:Security","color":"fef2c0","default":false,"description":"Meta label for security team"}],"state":"closed","locked":false,"assignee":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"assignees":[{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-03-30T13:41:27Z","updated_at":"2020-08-03T01:26:38Z","closed_at":"2020-08-03T01:26:38Z","author_association":"MEMBER","active_lock_reason":null,"body":"Build: https://gradle-enterprise.elastic.co/s/bcgyqo6mdefs4\r\nFailure:\r\n```\r\norg.elasticsearch.xpack.idp.action.SamlIdentityProviderTests > testSpInitiatedSsoFailsForMalformedRequest FAILED\r\n    org.elasticsearch.client.ResponseException: method [PUT], host [http://127.0.0.1:64813], URI [/_idp/saml/sp/ec%3Aabcdef%3A123456?refresh=true], status line [HTTP/1.1 409 Conflict]\r\n    {\"error\":{\"root_cause\":[{\"type\":\"illegal_state_exception\",\"reason\":\"Channel is already closed\"}],\"type\":\"illegal_state_exception\",\"reason\":\"Channel is already closed\"},\"status\":500}on [1])\",\"index_uuid\":\"-bUFzBzmScic6Oy8cq0c9Q\",\"shard\":\"0\",\"index\":\"saml-service-provider-v1\"}],\"type\":\"version_conflict_engine_exception\",\"reason\":\"[6zgtpNNEST_bjkJRm06zQy7FqHwYnFLkVu5TOqZxr1M]: version conflict, document already exists (current version [1])\",\"index_uuid\":\"-bUFzBzmScic6Oy8cq0c9Q\",\"shard\":\"0\",\"index\":\"saml-service-provider-v1\"},\"status\":409}\r\n        at __randomizedtesting.SeedInfo.seed([F9663F9EA5DE15F7:E943364D2A4E62F8]:0)\r\n        at org.elasticsearch.client.RestClient.convertResponse(RestClient.java:283)\r\n        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:261)\r\n        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:235)\r\n        at org.elasticsearch.xpack.idp.action.SamlIdentityProviderTests.registerServiceProvider(SamlIdentityProviderTests.java:259)\r\n        at org.elasticsearch.xpack.idp.action.SamlIdentityProviderTests.testSpInitiatedSsoFailsForMalformedRequest(SamlIdentityProviderTests.java:214)\r\n```\r\n\r\nReproduction line: \r\n```\r\n./gradlew ':x-pack:plugin:identity-provider:test' --tests \"org.elasticsearch.xpack.idp.action.SamlIdentityProviderTests.testIdPInitiatedSsoFailsWithoutSecondaryAuthentication\" -Dtests.seed=F6EB6482544DCC79 -Dtests.security.manager=true -Dtests.locale=es-NI -Dtests.timezone=SystemV/HST10 -Dcompiler.java=13\r\n```\r\n\r\nThere are also references to channel already closed failures in the after test phase:\r\n```\r\nSamlIdentityProviderTests#testIdPInitiatedSsoFailsWithoutSecondaryAuthentication]: cleaning up after test\r\n  1> [2020-03-30T03:27:29,867][INFO ][o.e.c.m.MetaDataDeleteIndexService] [node_s0] [saml-service-provider-v1/qzqQM4gVRAuiWXeelJzDVg] deleting index\r\n  1> [2020-03-30T03:27:29,854][WARN ][r.suppressed             ] [node_s0] path: /_idp/saml/sp/ec%3Aabcdef%3A123456, params: {refresh=true, sp_entity_id=ec:abcdef:123456}\r\n  1> java.lang.IllegalStateException: Channel is already closed\r\n  1> \tat org.elasticsearch.rest.RestController$ResourceHandlingHttpChannel.close(RestController.java:511) ~[elasticsearch-7.8.0-SNAPSHOT.jar:7.8.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.rest.RestController$ResourceHandlingHttpChannel.sendResponse(RestController.java:504) ~[elasticsearch-7.8.0-SNAPSHOT.jar:7.8.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.rest.action.RestResponseListener.processResponse(RestResponseListener.java:37) ~[elasticsearch-7.8.0-SNAPSHOT.jar:7.8.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.rest.action.RestActionListener.onResponse(RestActionListener.java:47) ~[elasticsearch-7.8.0-SNAPSHOT.jar:7.8.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:70) ~[elasticsearch-7.8.0-SNAPSHOT.jar:7.8.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64) ~[elasticsearch-7.8.0-SNAPSHOT.jar:7.8.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43) ~[elasticsearch-7.8.0-SNAPSHOT.jar:7.8.0-SNAPSHOT]\r\n```\r\n\r\nMaybe related to https://github.com/elastic/elasticsearch/issues/54285 ?","closed_by":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"performed_via_github_app":null}