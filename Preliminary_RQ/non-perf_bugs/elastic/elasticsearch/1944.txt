{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1944","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1944/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1944/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1944/events","html_url":"https://github.com/elastic/elasticsearch/issues/1944","id":4548931,"node_id":"MDU6SXNzdWU0NTQ4OTMx","number":1944,"title":"Geo query keeps failing on a specific type/table","user":{"login":"rufuspollock","id":180658,"node_id":"MDQ6VXNlcjE4MDY1OA==","avatar_url":"https://avatars1.githubusercontent.com/u/180658?v=4","gravatar_id":"","url":"https://api.github.com/users/rufuspollock","html_url":"https://github.com/rufuspollock","followers_url":"https://api.github.com/users/rufuspollock/followers","following_url":"https://api.github.com/users/rufuspollock/following{/other_user}","gists_url":"https://api.github.com/users/rufuspollock/gists{/gist_id}","starred_url":"https://api.github.com/users/rufuspollock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rufuspollock/subscriptions","organizations_url":"https://api.github.com/users/rufuspollock/orgs","repos_url":"https://api.github.com/users/rufuspollock/repos","events_url":"https://api.github.com/users/rufuspollock/events{/privacy}","received_events_url":"https://api.github.com/users/rufuspollock/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"assignees":[{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2012-05-12T19:33:04Z","updated_at":"2013-07-15T16:20:10Z","closed_at":"2013-07-15T16:20:10Z","author_association":"NONE","active_lock_reason":null,"body":"Using v0.18.7. Problem is that for a given type/table in an index geo search keeps failing. I can load the same data in another type/table and all is fine but even if I delete the type/table and then reload the query fails. Here's the stack trace\n\n<pre>\n... node[FA1mzqRITkCwHB_hw6Faxw], [R], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3c02e8fe]\norg.elasticsearch.transport.RemoteTransportException: [Death][inet[/193.34.146.144:9300]][search/phase/query]\nCaused by: org.elasticsearch.search.query.QueryPhaseExecutionException: [...][0]: query[filtered(ConstantScore(org.elasticsearch.index.search.geo.GeoDistanceFilter@d40d7f57))->FilterCacheFilterWrapper(_type:30d6d9aa-0f07-4db3-9ddd-ba615d00ec21)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:221)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:238)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:447)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:438)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.run(MessageChannelHandler.java:358)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:636)\nCaused by: java.lang.StringIndexOutOfBoundsException: String index out of range: -1\n        at java.lang.String.substring(String.java:1949)\n        at org.elasticsearch.index.mapper.geo.GeoPointFieldData$StringTypeLoader.collectTerm(GeoPointFieldData.java:177)\n        at org.elasticsearch.index.field.data.support.FieldDataLoader.load(FieldDataLoader.java:55)\n        at org.elasticsearch.index.mapper.geo.GeoPointFieldData.load(GeoPointFieldData.java:160)\n        at org.elasticsearch.index.mapper.geo.GeoPointFieldDataType.load(GeoPointFieldDataType.java:51)\n        at org.elasticsearch.index.mapper.geo.GeoPointFieldDataType.load(GeoPointFieldDataType.java:34)\n        at org.elasticsearch.index.field.data.FieldData.load(FieldData.java:110)\n        at org.elasticsearch.index.cache.field.data.support.AbstractConcurrentMapFieldDataCache.cache(AbstractConcurrentMapFieldDataCache.java:119)\n        at org.elasticsearch.index.search.geo.GeoDistanceFilter.getDocIdSet(GeoDistanceFilter.java:114)\n        at org.apache.lucene.search.DeletionAwareConstantScoreQuery$DeletionConstantWeight.scorer(DeletionAwareConstantScoreQuery.java:53)\n        at org.apache.lucene.search.FilteredQuery.getFilteredScorer(FilteredQuery.java:149)\n        at org.apache.lucene.search.FilteredQuery$1.scorer(FilteredQuery.java:117)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:577)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:199)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:445)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:426)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:342)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:330)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:217)\n        ... 7 more\n</pre>\n\n\nAny ideas what causes this problem and how it could be fixed (it's a real pain for us to renames types/tables ...)\n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}