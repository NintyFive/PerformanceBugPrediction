[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142293424","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-142293424","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":142293424,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjI5MzQyNA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-22T13:44:28Z","updated_at":"2015-09-22T13:44:28Z","author_association":"CONTRIBUTOR","body":"Hi @mrdotnic \n\nThis is pretty much a duplicate of #9971. In particular see https://github.com/elastic/elasticsearch/issues/9971#issuecomment-89589856. The trick is to use multi-fields with different analysis chains\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142599502","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-142599502","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":142599502,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjU5OTUwMg==","user":{"login":"mrdotnic","id":11489835,"node_id":"MDQ6VXNlcjExNDg5ODM1","avatar_url":"https://avatars3.githubusercontent.com/u/11489835?v=4","gravatar_id":"","url":"https://api.github.com/users/mrdotnic","html_url":"https://github.com/mrdotnic","followers_url":"https://api.github.com/users/mrdotnic/followers","following_url":"https://api.github.com/users/mrdotnic/following{/other_user}","gists_url":"https://api.github.com/users/mrdotnic/gists{/gist_id}","starred_url":"https://api.github.com/users/mrdotnic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrdotnic/subscriptions","organizations_url":"https://api.github.com/users/mrdotnic/orgs","repos_url":"https://api.github.com/users/mrdotnic/repos","events_url":"https://api.github.com/users/mrdotnic/events{/privacy}","received_events_url":"https://api.github.com/users/mrdotnic/received_events","type":"User","site_admin":false},"created_at":"2015-09-23T13:27:46Z","updated_at":"2015-09-24T08:23:51Z","author_association":"NONE","body":"Hi @clintongormley\n\nI just tried the multi fields approach mentioned by @rmuir but without success.\n\nThe suggestion works for a search term like \"jay\" that would be ignored by p.e. a four-gram analyzer but is now considered thanks to the standard analyzer used on top of the four-gram analyzer.\nSee Search # 2 of this new and smaller gist:\nhttps://www.found.no/play/gist/b593300c94524603f73b\n\nHowever the problem persists when searching for \"jay smith\" (Search # 1 of the new gist). \nThe four-gram analyzer ignores \"jay\" but keeps \"smith\", resulting in the unwanted match \"john smith\".\n\nMaybe I am doing something wrong with my implementation?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143180422","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-143180422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":143180422,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzE4MDQyMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-25T10:10:25Z","updated_at":"2015-09-25T10:10:58Z","author_association":"CONTRIBUTOR","body":"Hi @mrdotnic \n\nAs soon as you stray into the territory of ngrams, you leave exact matches behind you.  Ngrams help you to expand the search to include more potential matches but, for that same reason, you end up with matches which are false positives.\n\nHowever, the more ngrams that match the better - so the best results should float to the top.  Usually you'd combine this with e.g. `minimum_should_match: 80%` to trim the long tail of poorly matching results.  Combining a query on an ngram field with a query on a full-word (standard analyzer) field is a good way of bumping up the relevance of words that match exactly.\n\nHere's a potential approach that you can use to satisfy your own requirements: make words shorter than your ngrams required matches on the standard field:\n\n(Note: the syntax used below is for 2.0)\n\n```\nPUT t\n{\n  \"settings\": {\n    \"analysis\": {\n      \"tokenizer\": {\n        \"4grams\": {\n          \"type\": \"ngram\",\n          \"min_gram\": 4,\n          \"max_gram\": 4,\n          \"token_chars\": [\n            \"letter\",\n            \"digit\"\n          ]\n        }\n      },\n      \"analyzer\": {\n        \"4grams\": {\n          \"tokenizer\": \"4grams\",\n          \"filter\": [\n            \"lowercase\"\n          ]\n        },\n        \"short_std\": {\n          \"tokenizer\": \"standard\",\n          \"filter\": [\n            \"short\",\n            \"lowercase\"\n          ]\n        }\n      },\n      \"filter\": {\n        \"short\": {\n          \"type\": \"length\",\n          \"min\": 1,\n          \"max\": 3\n        }\n      }\n    }\n  },\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\",\n          \"analyzer\": \"standard\",\n          \"fields\": {\n            \"ngrams\": {\n              \"type\": \"string\",\n              \"analyzer\": \"4grams\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\nPUT t/t/1\n{\"name\": \"Jay Smith\"}\n\nPUT t/t/2\n{\"name\": \"John Smith\"}\n\nPUT t/t/3\n{\n  \"name\": \"Jay Smithson\"\n}\n\nGET /_search\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"match\": {\n            \"name\": {\n              \"query\": \"Jay Smith\",\n              \"analyzer\": \"short_std\",\n              \"operator\": \"and\"\n            }\n          }\n        },\n        {\n          \"match\": {\n            \"name.ngrams\": {\n              \"query\": \"Jay Smith\",\n              \"operator\": \"or\"\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157324047","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-157324047","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":157324047,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzMyNDA0Nw==","user":{"login":"felixbarny","id":2163464,"node_id":"MDQ6VXNlcjIxNjM0NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/2163464?v=4","gravatar_id":"","url":"https://api.github.com/users/felixbarny","html_url":"https://github.com/felixbarny","followers_url":"https://api.github.com/users/felixbarny/followers","following_url":"https://api.github.com/users/felixbarny/following{/other_user}","gists_url":"https://api.github.com/users/felixbarny/gists{/gist_id}","starred_url":"https://api.github.com/users/felixbarny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixbarny/subscriptions","organizations_url":"https://api.github.com/users/felixbarny/orgs","repos_url":"https://api.github.com/users/felixbarny/repos","events_url":"https://api.github.com/users/felixbarny/events{/privacy}","received_events_url":"https://api.github.com/users/felixbarny/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T09:56:35Z","updated_at":"2015-11-17T09:56:35Z","author_association":"NONE","body":"Thank you very much for the detailed suggestion. I have some trouble with this approach. If you are searching for `smith` only, you don't get any results. Probably because the must query essentially is empty. This is the relevant gist: https://www.found.no/play/gist/2715cdd064250352fd23\n\nOne approach would be to merge the two queries into one like this: https://www.found.no/play/gist/64f63fe1fd99f4580ca7\nThat way I can find all Smiths and Smithsons when searching for 'smith' but searching for 'jay smith' also returns 'john smith' because jay is removed from the .ngram field.\n\nI really think that an optional parameter like `keep_shorter_terms` would solve a lot and since it's optional it can't harm either. But I'm also open for other suggestions.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161666982","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-161666982","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":161666982,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTY2Njk4Mg==","user":{"login":"felixbarny","id":2163464,"node_id":"MDQ6VXNlcjIxNjM0NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/2163464?v=4","gravatar_id":"","url":"https://api.github.com/users/felixbarny","html_url":"https://github.com/felixbarny","followers_url":"https://api.github.com/users/felixbarny/followers","following_url":"https://api.github.com/users/felixbarny/following{/other_user}","gists_url":"https://api.github.com/users/felixbarny/gists{/gist_id}","starred_url":"https://api.github.com/users/felixbarny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixbarny/subscriptions","organizations_url":"https://api.github.com/users/felixbarny/orgs","repos_url":"https://api.github.com/users/felixbarny/repos","events_url":"https://api.github.com/users/felixbarny/events{/privacy}","received_events_url":"https://api.github.com/users/felixbarny/received_events","type":"User","site_admin":false},"created_at":"2015-12-03T15:02:41Z","updated_at":"2015-12-03T15:02:41Z","author_association":"NONE","body":"any ideas?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/174512170","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-174512170","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":174512170,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NDUxMjE3MA==","user":{"login":"felixbarny","id":2163464,"node_id":"MDQ6VXNlcjIxNjM0NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/2163464?v=4","gravatar_id":"","url":"https://api.github.com/users/felixbarny","html_url":"https://github.com/felixbarny","followers_url":"https://api.github.com/users/felixbarny/followers","following_url":"https://api.github.com/users/felixbarny/following{/other_user}","gists_url":"https://api.github.com/users/felixbarny/gists{/gist_id}","starred_url":"https://api.github.com/users/felixbarny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixbarny/subscriptions","organizations_url":"https://api.github.com/users/felixbarny/orgs","repos_url":"https://api.github.com/users/felixbarny/repos","events_url":"https://api.github.com/users/felixbarny/events{/privacy}","received_events_url":"https://api.github.com/users/felixbarny/received_events","type":"User","site_admin":false},"created_at":"2016-01-25T13:39:41Z","updated_at":"2016-01-25T13:40:44Z","author_association":"NONE","body":"Am I doing something wrong or is that a use case that can't be handled with Elasticsearch? Any chance you can reopen this issue until it gets resolved or we find a working workaround?\n\nThanks a lot :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/204922591","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-204922591","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":204922591,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNDkyMjU5MQ==","user":{"login":"felixbarny","id":2163464,"node_id":"MDQ6VXNlcjIxNjM0NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/2163464?v=4","gravatar_id":"","url":"https://api.github.com/users/felixbarny","html_url":"https://github.com/felixbarny","followers_url":"https://api.github.com/users/felixbarny/followers","following_url":"https://api.github.com/users/felixbarny/following{/other_user}","gists_url":"https://api.github.com/users/felixbarny/gists{/gist_id}","starred_url":"https://api.github.com/users/felixbarny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixbarny/subscriptions","organizations_url":"https://api.github.com/users/felixbarny/orgs","repos_url":"https://api.github.com/users/felixbarny/repos","events_url":"https://api.github.com/users/felixbarny/events{/privacy}","received_events_url":"https://api.github.com/users/felixbarny/received_events","type":"User","site_admin":false},"created_at":"2016-04-03T09:08:51Z","updated_at":"2016-04-03T09:08:51Z","author_association":"NONE","body":"Again, this issue is still _not_ fixed for me and I hope you reconsider opening it again as I'm still eagerly waiting for a `keep_shorter_terms` option.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/209246975","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-209246975","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":209246975,"node_id":"MDEyOklzc3VlQ29tbWVudDIwOTI0Njk3NQ==","user":{"login":"felixbarny","id":2163464,"node_id":"MDQ6VXNlcjIxNjM0NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/2163464?v=4","gravatar_id":"","url":"https://api.github.com/users/felixbarny","html_url":"https://github.com/felixbarny","followers_url":"https://api.github.com/users/felixbarny/followers","following_url":"https://api.github.com/users/felixbarny/following{/other_user}","gists_url":"https://api.github.com/users/felixbarny/gists{/gist_id}","starred_url":"https://api.github.com/users/felixbarny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixbarny/subscriptions","organizations_url":"https://api.github.com/users/felixbarny/orgs","repos_url":"https://api.github.com/users/felixbarny/repos","events_url":"https://api.github.com/users/felixbarny/events{/privacy}","received_events_url":"https://api.github.com/users/felixbarny/received_events","type":"User","site_admin":false},"created_at":"2016-04-13T06:17:37Z","updated_at":"2016-04-13T06:17:37Z","author_association":"NONE","body":"To summarize this issue: Small terms just disappear in the index as well as in the search string. So more documents as expected match because some criteria in the query is just lost. Combining queries on ngram fields in combination with normal fields does not work either. When using an or, I still get more results as expected from the ngram part of the query. When using an and conjunction, I get less results, because the sub words are not matched by the non ngram part of the query. \n\nSo please, reopen this issue. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/209376356","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-209376356","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":209376356,"node_id":"MDEyOklzc3VlQ29tbWVudDIwOTM3NjM1Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-13T11:23:24Z","updated_at":"2016-04-13T11:23:24Z","author_association":"CONTRIBUTOR","body":"@felixbarny using `and`|`or` with ngrams doesn't make much sense... ngrams spread the net wide, and you can use `minimum_should_match` to reduce the long tail of poorly matching documents.  Either way, we use the ngram tokenizer and token filter from lucene, which doesn't have support for this.  If you want to convince Lucene to support it, then I'd open a ticket there.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/507626129","html_url":"https://github.com/elastic/elasticsearch/issues/13710#issuecomment-507626129","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13710","id":507626129,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzYyNjEyOQ==","user":{"login":"sameerkattel","id":6128234,"node_id":"MDQ6VXNlcjYxMjgyMzQ=","avatar_url":"https://avatars2.githubusercontent.com/u/6128234?v=4","gravatar_id":"","url":"https://api.github.com/users/sameerkattel","html_url":"https://github.com/sameerkattel","followers_url":"https://api.github.com/users/sameerkattel/followers","following_url":"https://api.github.com/users/sameerkattel/following{/other_user}","gists_url":"https://api.github.com/users/sameerkattel/gists{/gist_id}","starred_url":"https://api.github.com/users/sameerkattel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sameerkattel/subscriptions","organizations_url":"https://api.github.com/users/sameerkattel/orgs","repos_url":"https://api.github.com/users/sameerkattel/repos","events_url":"https://api.github.com/users/sameerkattel/events{/privacy}","received_events_url":"https://api.github.com/users/sameerkattel/received_events","type":"User","site_admin":false},"created_at":"2019-07-02T10:58:19Z","updated_at":"2019-07-02T10:58:53Z","author_association":"NONE","body":"I was also looking for solution to the same problem. And for  ES > 6.5 can be achieved  using [conditional filter](https://www.elastic.co/guide/en/elasticsearch/reference/6.6/analysis-condition-tokenfilter.html)","performed_via_github_app":null}]