[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/39773272","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-39773272","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":39773272,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzczMjcy","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-04-07T19:32:39Z","updated_at":"2014-04-07T19:32:39Z","author_association":"MEMBER","body":"This might be related to #5623.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40416655","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40416655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40416655,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDE2NjU1","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-04-14T20:52:38Z","updated_at":"2014-04-14T20:52:38Z","author_association":"CONTRIBUTOR","body":"@imotov can you try to verify with @alexeymedved that this is fixed now?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40433031","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40433031","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40433031,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDMzMDMx","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T00:16:31Z","updated_at":"2014-04-15T00:16:31Z","author_association":"MEMBER","body":"@alexeymedved could you try reproducing this issue to see if it was fixed in the latest [nightly build](https://oss.sonatype.org/content/repositories/snapshots/org/elasticsearch/elasticsearch/1.1.1-SNAPSHOT/)? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40449931","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40449931","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40449931,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDQ5OTMx","user":{"login":"alexey-medvedchikov","id":65190,"node_id":"MDQ6VXNlcjY1MTkw","avatar_url":"https://avatars0.githubusercontent.com/u/65190?v=4","gravatar_id":"","url":"https://api.github.com/users/alexey-medvedchikov","html_url":"https://github.com/alexey-medvedchikov","followers_url":"https://api.github.com/users/alexey-medvedchikov/followers","following_url":"https://api.github.com/users/alexey-medvedchikov/following{/other_user}","gists_url":"https://api.github.com/users/alexey-medvedchikov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexey-medvedchikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexey-medvedchikov/subscriptions","organizations_url":"https://api.github.com/users/alexey-medvedchikov/orgs","repos_url":"https://api.github.com/users/alexey-medvedchikov/repos","events_url":"https://api.github.com/users/alexey-medvedchikov/events{/privacy}","received_events_url":"https://api.github.com/users/alexey-medvedchikov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T06:32:14Z","updated_at":"2014-04-15T06:32:14Z","author_association":"NONE","body":"@s1monw @imotov With elasticsearch-1.1.1-20140415.001904-55.deb seems everything works fine. Thank you!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40463094","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40463094","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40463094,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDYzMDk0","user":{"login":"alexey-medvedchikov","id":65190,"node_id":"MDQ6VXNlcjY1MTkw","avatar_url":"https://avatars0.githubusercontent.com/u/65190?v=4","gravatar_id":"","url":"https://api.github.com/users/alexey-medvedchikov","html_url":"https://github.com/alexey-medvedchikov","followers_url":"https://api.github.com/users/alexey-medvedchikov/followers","following_url":"https://api.github.com/users/alexey-medvedchikov/following{/other_user}","gists_url":"https://api.github.com/users/alexey-medvedchikov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexey-medvedchikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexey-medvedchikov/subscriptions","organizations_url":"https://api.github.com/users/alexey-medvedchikov/orgs","repos_url":"https://api.github.com/users/alexey-medvedchikov/repos","events_url":"https://api.github.com/users/alexey-medvedchikov/events{/privacy}","received_events_url":"https://api.github.com/users/alexey-medvedchikov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T09:42:15Z","updated_at":"2014-04-15T09:57:30Z","author_association":"NONE","body":"I can break it again:\n- run long-running query like\n\n```\n/_all/_search {\n    \"facets\": {\n      \"terms\": {\n          \"terms\": {\n             \"script_field\": \"doc['request_time'].value <= 0.5 ? true : false\",\n             \"size\": 10\n          }\n      }\n    }\n}\n```\n- Insert big bunch of new items (by logstash for example)\n- Send SIGTERM\n\nVoila:\n\n```\nPOST /logstash-2014.04.15.08/_search\n{\n    \"script_fields\": {\n       \"s_request_time\": {\n          \"script\": \"doc['request_time'].getValues()\"\n       }\n    }\n}\n...\n         {\n            \"_index\": \"logstash-2014.04.15.08\",\n            \"_type\": \"nginx_accesslog\",\n            \"_id\": \"tjZ9fIqLQWedynr4mBhdEw\",\n            \"_score\": 1,\n            \"fields\": {\n               \"s_request_time\": [\n                  [\n                     \" \\u0001?Kc)}ymHZ\",\n                     \"$\\u000b|^\\u001aOoNlE\",\n                     \"(_eqT~|vd\",\n                     \",\\u0005~/\\r'wg6\",\n                     \"0/rxj?>;\",\n                     \"4\\u0002\\u0017FS{s\",\n                     \"8\\u0017y<5\\u001f_\",\n                     \"<\\u0001?Kc)}\",\n                     \"@\\u000b|^\\u001aO\",\n                     \"D_eqT\",\n                     \"H\\u0005~/\\r\",\n                     \"L/rx\",\n                     \"P\\u0002\\u0017\",\n                     \"T\\u0017y\",\n                     \"X\\u0001?\",\n                     \"\\\\\\u000b\"\n                  ]\n               ]\n            }\n         },\n...\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40469442","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40469442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40469442,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDY5NDQy","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T11:03:27Z","updated_at":"2014-04-15T11:03:27Z","author_association":"MEMBER","body":"@alexeymedved do you see any exceptions in the log files?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40471153","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40471153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40471153,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDcxMTUz","user":{"login":"alexey-medvedchikov","id":65190,"node_id":"MDQ6VXNlcjY1MTkw","avatar_url":"https://avatars0.githubusercontent.com/u/65190?v=4","gravatar_id":"","url":"https://api.github.com/users/alexey-medvedchikov","html_url":"https://github.com/alexey-medvedchikov","followers_url":"https://api.github.com/users/alexey-medvedchikov/followers","following_url":"https://api.github.com/users/alexey-medvedchikov/following{/other_user}","gists_url":"https://api.github.com/users/alexey-medvedchikov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexey-medvedchikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexey-medvedchikov/subscriptions","organizations_url":"https://api.github.com/users/alexey-medvedchikov/orgs","repos_url":"https://api.github.com/users/alexey-medvedchikov/repos","events_url":"https://api.github.com/users/alexey-medvedchikov/events{/privacy}","received_events_url":"https://api.github.com/users/alexey-medvedchikov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T11:29:41Z","updated_at":"2014-04-15T11:29:41Z","author_association":"NONE","body":"Exception for query like mentioned in my prev comment:\n\n```\n[2014-04-15 17:05:24,563][DEBUG][action.search.type       ] [Hobgoblin] [logstash-2014.04.14.10][3], node[JrhBvFHpRgyT5RXv8O9HwA], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.\norg.elasticsearch.search.query.QueryPhaseExecutionException: [logstash-2014.04.14.10][3]: query[ConstantScore(*:*)],from[0],size[0]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:127)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:257)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:202)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:80)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:216)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:203)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:186)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:724)\nCaused by: java.lang.RuntimeException: uncomparable values << ^A?WoNlEPrX>> and <<0.05>>\n        at org.elasticsearch.common.mvel2.math.MathProcessor.doOperationNonNumeric(MathProcessor.java:321)\n        at org.elasticsearch.common.mvel2.math.MathProcessor._doOperations(MathProcessor.java:234)\n        at org.elasticsearch.common.mvel2.math.MathProcessor.doOperations(MathProcessor.java:79)\n        at org.elasticsearch.common.mvel2.ast.BinaryOperation.getReducedValueAccelerated(BinaryOperation.java:114)\n        at org.elasticsearch.common.mvel2.MVELRuntime.execute(MVELRuntime.java:86)\n        at org.elasticsearch.common.mvel2.compiler.CompiledExpression.getDirectValue(CompiledExpression.java:123)\n        at org.elasticsearch.common.mvel2.compiler.CompiledExpression.getValue(CompiledExpression.java:119)\n        at org.elasticsearch.script.mvel.MvelScriptEngineService$MvelSearchScript.run(MvelScriptEngineService.java:191)\n        at org.elasticsearch.search.facet.terms.strings.ScriptTermsStringFieldFacetExecutor$Collector.collect(ScriptTermsStringFieldFacetExecutor.java:147)\n        at org.elasticsearch.common.lucene.search.FilteredCollector.collect(FilteredCollector.java:61)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Scorer.score(Scorer.java:65)\n        at org.apache.lucene.search.ConstantScoreQuery$ConstantScorer.score(ConstantScoreQuery.java:256)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:173)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:309)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:111)\n        ... 9 more\nCaused by: java.lang.ClassCastException: java.lang.Double cannot be cast to java.lang.String\n        at java.lang.String.compareTo(String.java:108)\n        at org.elasticsearch.common.mvel2.math.MathProcessor.doOperationNonNumeric(MathProcessor.java:318)\n        ... 25 more\n```\n\nExceptions appeared on restart mentioned in prev comment:\n\n```\n[2014-04-15 15:45:45,129][WARN ][index.engine.internal    ] [Condor] [logstash-2014.04.14.11][0] Searcher was released twice\norg.elasticsearch.ElasticsearchIllegalStateException: Double release\n        at org.elasticsearch.index.engine.internal.InternalEngine$EngineSearcher.release(InternalEngine.java:1510)\n        at org.elasticsearch.search.internal.DefaultSearchContext.release(DefaultSearchContext.java:212)\n        at org.elasticsearch.search.SearchService.freeContext(SearchService.java:551)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:268)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:202)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:80)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:216)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:203)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:186)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:724)\n```\n\nMaybe I can provide you a trace of execution or broken index file somehow?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40472467","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40472467","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40472467,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDcyNDY3","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T11:48:41Z","updated_at":"2014-04-15T11:48:41Z","author_association":"MEMBER","body":"@alexeymedved was index logstash-2014.04.15.08 created with the nightly build or before you upgraded? Could you run `curl localhost:9200/logstash-2014.04.15.08/_mapping` and post the result here? Are you using percolator on this cluster?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40475899","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40475899","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40475899,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDc1ODk5","user":{"login":"alexey-medvedchikov","id":65190,"node_id":"MDQ6VXNlcjY1MTkw","avatar_url":"https://avatars0.githubusercontent.com/u/65190?v=4","gravatar_id":"","url":"https://api.github.com/users/alexey-medvedchikov","html_url":"https://github.com/alexey-medvedchikov","followers_url":"https://api.github.com/users/alexey-medvedchikov/followers","following_url":"https://api.github.com/users/alexey-medvedchikov/following{/other_user}","gists_url":"https://api.github.com/users/alexey-medvedchikov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexey-medvedchikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexey-medvedchikov/subscriptions","organizations_url":"https://api.github.com/users/alexey-medvedchikov/orgs","repos_url":"https://api.github.com/users/alexey-medvedchikov/repos","events_url":"https://api.github.com/users/alexey-medvedchikov/events{/privacy}","received_events_url":"https://api.github.com/users/alexey-medvedchikov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T12:35:25Z","updated_at":"2014-04-15T12:35:25Z","author_association":"NONE","body":"@imotov \n- index was created by nightly build\n- https://gist.github.com/alexeymedved/dc7a3fb376e6f3c80f23#file-logstash-2014-04-15-08_mapping\n- no, i'm not using percolator\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40482396","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40482396","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40482396,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDgyMzk2","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T13:43:22Z","updated_at":"2014-04-15T13:43:22Z","author_association":"MEMBER","body":"@alexeymedved your mapping looks fine after restart, so I am thinking it might be actually an MVEL issue. For some reason MVEL thinks that it should compare two doubles as strings in your case. I tried to reproduce this issue locally but didn't succeed so far. Any chance you can try reproducing it using [javascript](https://github.com/elasticsearch/elasticsearch-lang-javascript) instead of MVEL?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40496572","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40496572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40496572,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDk2NTcy","user":{"login":"alexey-medvedchikov","id":65190,"node_id":"MDQ6VXNlcjY1MTkw","avatar_url":"https://avatars0.githubusercontent.com/u/65190?v=4","gravatar_id":"","url":"https://api.github.com/users/alexey-medvedchikov","html_url":"https://github.com/alexey-medvedchikov","followers_url":"https://api.github.com/users/alexey-medvedchikov/followers","following_url":"https://api.github.com/users/alexey-medvedchikov/following{/other_user}","gists_url":"https://api.github.com/users/alexey-medvedchikov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexey-medvedchikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexey-medvedchikov/subscriptions","organizations_url":"https://api.github.com/users/alexey-medvedchikov/orgs","repos_url":"https://api.github.com/users/alexey-medvedchikov/repos","events_url":"https://api.github.com/users/alexey-medvedchikov/events{/privacy}","received_events_url":"https://api.github.com/users/alexey-medvedchikov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T15:35:04Z","updated_at":"2014-04-15T15:37:40Z","author_association":"NONE","body":"MVEL just helps me to show what data actually we operating on. Sorry for misleading queries. It's not an MVEL issue for sure because of:\n\n> Another thing is when I'm using data_histogram facet (in kibana) I got ClassCastException[org.elasticsearch.index.fielddata.plain.PagedBytesIndexFieldData cannot be cast to org.elasticsearch.index.fielddata.IndexNumericFieldData.\n\nException for this kind of query:\n\n```\n[2014-04-15 15:02:49,538][DEBUG][action.search.type       ] [Condor] [logstash-2014.04.14.09][0], node[OS96wzBvT5WTcPgzKrAHlw], [P], s[STARTED]: Failed to execute [org.el\nasticsearch.action.search.SearchRequest@906a63f] lastShard [true]\norg.elasticsearch.search.SearchParseException: [logstash-2014.04.14.09][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\"facets\":{\"0\":{\"date_histogram\":{\"k\ney_field\":\"@timestamp\",\"value_field\":\"request_time\",\"interval\":\"10m\"},\"global\":true,\"facet_filter\":{\"fquery\":{\"query\":{\"filtered\":{\"query\":{\"query_string\":{\"query\":\"type:\nnginx_accesslog  AND request:\\\\/search\\\\?*\"}},\"filter\":{\"bool\":{\"must\":[{\"range\":{\"@timestamp\":{\"from\":1397462569513,\"to\":1397548969513}}}]}}}}}}}},\"size\":0}]]\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:634)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:507)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:480)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:252)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:202)\n        at org.elasticsearch.action.search.type.TransportSearchCountAction$AsyncAction.sendExecuteFirstPhase(TransportSearchCountAction.java:70)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:216)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:203)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:186)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:724)\nCaused by: java.lang.ClassCastException: org.elasticsearch.index.fielddata.plain.PagedBytesIndexFieldData cannot be cast to org.elasticsearch.index.fielddata.IndexNumericFieldData\n        at org.elasticsearch.search.facet.datehistogram.DateHistogramFacetParser.parse(DateHistogramFacetParser.java:188)\n        at org.elasticsearch.search.facet.FacetParseElement.parse(FacetParseElement.java:93)\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:622)\n        ... 11 more\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40499942","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40499942","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40499942,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDk5OTQy","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-04-15T16:00:56Z","updated_at":"2014-04-15T16:00:56Z","author_association":"MEMBER","body":"@alexeymedved this is different. Here you are searching the yesterday's index `logstash-2014.04.14.09` that most likely contains data indexed while mapping for this index was messed up due to #5623. So you have numbers indexed as numbers and as strings. I would also suspect that mapping for this index is still messed up. Can you run `curl localhost:9200/logstash-2014.04.14.09/_mapping` to see if fields are mapped correctly? Can you also try reproducing this failure while searching only indices created with the nightly build and without using MVEL?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40811053","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40811053","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40811053,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODExMDUz","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-04-18T14:09:32Z","updated_at":"2014-04-18T14:09:32Z","author_association":"MEMBER","body":"That looks like a duplicate of #5623 after all. Please, feel free to reopen if you have any additional data points.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40919715","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-40919715","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":40919715,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTE5NzE1","user":{"login":"alexey-medvedchikov","id":65190,"node_id":"MDQ6VXNlcjY1MTkw","avatar_url":"https://avatars0.githubusercontent.com/u/65190?v=4","gravatar_id":"","url":"https://api.github.com/users/alexey-medvedchikov","html_url":"https://github.com/alexey-medvedchikov","followers_url":"https://api.github.com/users/alexey-medvedchikov/followers","following_url":"https://api.github.com/users/alexey-medvedchikov/following{/other_user}","gists_url":"https://api.github.com/users/alexey-medvedchikov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexey-medvedchikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexey-medvedchikov/subscriptions","organizations_url":"https://api.github.com/users/alexey-medvedchikov/orgs","repos_url":"https://api.github.com/users/alexey-medvedchikov/repos","events_url":"https://api.github.com/users/alexey-medvedchikov/events{/privacy}","received_events_url":"https://api.github.com/users/alexey-medvedchikov/received_events","type":"User","site_admin":false},"created_at":"2014-04-21T06:52:07Z","updated_at":"2014-04-21T06:52:07Z","author_association":"NONE","body":"Well, I fixed this problem for myself by using long for time fields :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/78903583","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-78903583","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":78903583,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTAzNTgz","user":{"login":"UnderGreen","id":2656737,"node_id":"MDQ6VXNlcjI2NTY3Mzc=","avatar_url":"https://avatars1.githubusercontent.com/u/2656737?v=4","gravatar_id":"","url":"https://api.github.com/users/UnderGreen","html_url":"https://github.com/UnderGreen","followers_url":"https://api.github.com/users/UnderGreen/followers","following_url":"https://api.github.com/users/UnderGreen/following{/other_user}","gists_url":"https://api.github.com/users/UnderGreen/gists{/gist_id}","starred_url":"https://api.github.com/users/UnderGreen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UnderGreen/subscriptions","organizations_url":"https://api.github.com/users/UnderGreen/orgs","repos_url":"https://api.github.com/users/UnderGreen/repos","events_url":"https://api.github.com/users/UnderGreen/events{/privacy}","received_events_url":"https://api.github.com/users/UnderGreen/received_events","type":"User","site_admin":false},"created_at":"2015-03-13T10:22:28Z","updated_at":"2015-03-13T10:22:28Z","author_association":"NONE","body":"Have same problem with Elastic 1.4.4. Query result without scripting:\n\n```\n{\n    \"took\": 7,\n    \"timed_out\": false,\n    \"_shards\": {\n        \"total\": 2,\n        \"successful\": 2,\n        \"failed\": 0\n    },\n    \"hits\": {\n        \"total\": 33,\n        \"max_score\": null,\n        \"hits\": [{\n            \"_index\": \"logstash-2015.03.13\",\n            \"_type\": \"gelf_photo\",\n            \"_id\": \"AUwSeR5Mf_J86mgo9hKZ\",\n            \"_score\": null,\n            \"_source\": {\n                \"version\": \"1.0\",\n                \"type\": \"gelf_photo\",\n                \"time_done_full\": \"0.0009758472442627\",\n                \"time_done\": 0.0,\n                \"@version\": \"1\",\n                \"@timestamp\": \"2015-03-13T09:31:09.067Z\",\n                \"_class__\": \"\",\n                \"_method__\": \"\",\n                \"_extra__\": \"null\",\n                \"_request_id__\": \"45e21fc5e190de6269567c57c5f2177f0009e188\"\n            },\n            \"sort\": [1426239069067]\n        }]\n    }\n}\n\n```\n\nQuery result with scripting:\n\n```\n{\n    \"took\": 11,\n    \"timed_out\": false,\n    \"_shards\": {\n        \"total\": 2,\n        \"successful\": 2,\n        \"failed\": 0\n    },\n    \"hits\": {\n        \"total\": 33,\n        \"max_score\": null,\n        \"hits\": [{\n            \"_index\": \"logstash-2015.03.13\",\n            \"_type\": \"gelf_photo\",\n            \"_id\": \"AUwSeR5Mf_J86mgo9hKZ\",\n            \"_score\": null,\n            \"fields\": {\n                \"s_time_done\": [\" \\u0001\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\"]\n            },\n            \"sort\": [1426239069067]\n        }]\n    }\n}\n```\n\nResult of`http://logstash.test:9200/logstash-2015.03.13/_mappings`:\n\n```\n...\n\"time_done\": {\n\"type\": \"double\"\n},\n...\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89841436","html_url":"https://github.com/elastic/elasticsearch/issues/5705#issuecomment-89841436","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","id":89841436,"node_id":"MDEyOklzc3VlQ29tbWVudDg5ODQxNDM2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T19:54:12Z","updated_at":"2015-04-05T19:54:12Z","author_association":"CONTRIBUTOR","body":"@UnderGreen please can you open a new issue with all the details.  Although I have a sneaking suspicion that this is an issue with dynamic mappings being applied asynchronously. See https://github.com/elastic/elasticsearch/issues/8688 for more\n","performed_via_github_app":null}]