{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37120","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37120/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37120/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37120/events","html_url":"https://github.com/elastic/elasticsearch/issues/37120","id":395628734,"node_id":"MDU6SXNzdWUzOTU2Mjg3MzQ=","number":37120,"title":"ingest: only compile templates if the value is templated","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-01-03T16:06:06Z","updated_at":"2019-01-09T20:47:48Z","closed_at":"2019-01-09T20:47:48Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Many of the ingest node processors support [template snippets](https://www.elastic.co/guide/en/elasticsearch/reference/current/accessing-data-in-pipelines.html#accessing-template-fields) (mustache).  Each field that supports [template snippets](https://www.elastic.co/guide/en/elasticsearch/reference/current/accessing-data-in-pipelines.html#accessing-template-fields) requires compilation the first time the pipeline is used. \r\n\r\nElasticsearch has circuit breaker such that no more than 75 scripts per 5 minutes may be compiled. Every script (not only ingest node scripts) is subject to this ([configurable](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-using.html#prefer-params)) limit. A moderate number of processors can trip this limit, even if no templated values are defined. \r\n\r\nFor example, a single [set processor](https://www.elastic.co/guide/en/elasticsearch/reference/current/set-processor.html) always counts as 2 compilations since the `field` and `value` both support [template snippets](https://www.elastic.co/guide/en/elasticsearch/reference/current/accessing-data-in-pipelines.html#accessing-template-fields).  The compilation happens even if the `field` and `value` do _not_ define a `{{ }}` template. \r\n\r\nThis issue is to address the unnecessary compilation for fields that support [template snippets](https://www.elastic.co/guide/en/elasticsearch/reference/current/accessing-data-in-pipelines.html#accessing-template-fields). The goal to reduce the number of compilations to only the minimum number actually required. \r\n\r\nThis issue is more likely on newer versions of Elasticsearch since in 6.4 additional fields were added to support template snippets and 6.5 the `if` condition was added, which also requires a script complication (if defined).  ","closed_by":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}