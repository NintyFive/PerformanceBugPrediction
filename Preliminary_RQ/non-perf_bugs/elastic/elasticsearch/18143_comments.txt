[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216969257","html_url":"https://github.com/elastic/elasticsearch/issues/18143#issuecomment-216969257","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18143","id":216969257,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjk2OTI1Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-04T19:07:33Z","updated_at":"2016-05-04T19:07:33Z","author_association":"MEMBER","body":"The retry counts get reset to zero on every successful reply from a node that is answering a fault detection request but I guess that you mean monitoring when it increases from zero? But then aggregated stats are not what you would want because it doesn't tell you which nodes the master failed to reply to (for `MasterFaultDetection`), and it doesn't tell you which nodes failed to reply to the master (for `NodeFaultDetection`). It also doesn't tell you which side of the partition a node is on (i.e., if the master fails to reply to a node, is it because the master is partitioned away, or is it because the node is partitioned away?). So I question the usefulness of this. I'm especially cautious about adding an endpoint that dives down into the discovery layer (especially since different discovery implementations might not even have a notion of pings). I'm -1 but I await feedback that could convince me otherwise?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/217188712","html_url":"https://github.com/elastic/elasticsearch/issues/18143#issuecomment-217188712","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18143","id":217188712,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNzE4ODcxMg==","user":{"login":"amreshakim","id":10282335,"node_id":"MDQ6VXNlcjEwMjgyMzM1","avatar_url":"https://avatars0.githubusercontent.com/u/10282335?v=4","gravatar_id":"","url":"https://api.github.com/users/amreshakim","html_url":"https://github.com/amreshakim","followers_url":"https://api.github.com/users/amreshakim/followers","following_url":"https://api.github.com/users/amreshakim/following{/other_user}","gists_url":"https://api.github.com/users/amreshakim/gists{/gist_id}","starred_url":"https://api.github.com/users/amreshakim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amreshakim/subscriptions","organizations_url":"https://api.github.com/users/amreshakim/orgs","repos_url":"https://api.github.com/users/amreshakim/repos","events_url":"https://api.github.com/users/amreshakim/events{/privacy}","received_events_url":"https://api.github.com/users/amreshakim/received_events","type":"User","site_admin":false},"created_at":"2016-05-05T15:37:39Z","updated_at":"2016-05-05T15:37:39Z","author_association":"NONE","body":"Jason,\n\nThanks for the reply and I agree it is not easy to make these stats useful. But I hope I don't have to argue about usefulness of having this information proactively.\n\n> I'm especially cautious about adding an endpoint that dives down into the discovery layer (especially since different discovery implementations might not even have a notion of pings)\n\nAgreed w.r.t. exposing specifics of the implementations. How about just a mechanism to register a listener able to subscribe to generic events (similar to ShardBitsetFilterCache)?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/217190329","html_url":"https://github.com/elastic/elasticsearch/issues/18143#issuecomment-217190329","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18143","id":217190329,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNzE5MDMyOQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-05T15:43:50Z","updated_at":"2016-05-05T15:44:12Z","author_association":"MEMBER","body":"> Thanks for the reply and I agree it is not easy to make these stats useful. But I hope I don't have to argue about usefulness of having this information proactively.\n\nI wouldn't call it an argument as much as a discussion. ðŸ˜„\n\nBut we do need to discuss it because of my thoughts above (and especially since you seem to agree the stats aren't immediately useful), I don't see the point?\n\n> How about just a mechanism to register a listener able to subscribe to generic events (similar to ShardBitsetFilterCache)?\n\nYeah, that's roughly how we'd do it _if_ there is a compelling reason for doing it. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/217218325","html_url":"https://github.com/elastic/elasticsearch/issues/18143#issuecomment-217218325","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18143","id":217218325,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNzIxODMyNQ==","user":{"login":"amreshakim","id":10282335,"node_id":"MDQ6VXNlcjEwMjgyMzM1","avatar_url":"https://avatars0.githubusercontent.com/u/10282335?v=4","gravatar_id":"","url":"https://api.github.com/users/amreshakim","html_url":"https://github.com/amreshakim","followers_url":"https://api.github.com/users/amreshakim/followers","following_url":"https://api.github.com/users/amreshakim/following{/other_user}","gists_url":"https://api.github.com/users/amreshakim/gists{/gist_id}","starred_url":"https://api.github.com/users/amreshakim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amreshakim/subscriptions","organizations_url":"https://api.github.com/users/amreshakim/orgs","repos_url":"https://api.github.com/users/amreshakim/repos","events_url":"https://api.github.com/users/amreshakim/events{/privacy}","received_events_url":"https://api.github.com/users/amreshakim/received_events","type":"User","site_admin":false},"created_at":"2016-05-05T17:29:51Z","updated_at":"2016-05-05T17:29:51Z","author_association":"NONE","body":"Here is why I would love to have an ability to expose ping related stats/events from the discovery module. This is based solely on my experience with using ES 1.7 on AWS.\n\nKicking a machine out of cluster (and moving shards around as a consequence) is useful only if the issue is completely isolated and has nothing to do with ES itself, e.g., hardware, network. However, in many cases ping failures are just an indication of a bigger problem (CPU spikes, Java GC stalls, OOM), and there is no one-size-fits-it-all policy to handle it. Sometimes, it is enough to shutdown the misbehaving machine but often it requires a more comprehensive involvement. More importantly, moving shards as a reaction is (1) already too late and (2) will most likely aggravate the problem. I believe, human would be in a much better position to make an appropriate action to such failures and minimize potential outages (red cluster state).\n\nIn our production setup we have increased ping_retries to a much higher value to prevent a default reaction to ping failures. And it would have been very useful to get notified on these events as soon as possible.\n\nWe are quite happy with zen discovery in general and would consider implementing our own discovery plugin (which would be a pretty much copy&paste of the existing one + ping failures listener) as our last resort.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/217648218","html_url":"https://github.com/elastic/elasticsearch/issues/18143#issuecomment-217648218","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18143","id":217648218,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNzY0ODIxOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-07T16:16:55Z","updated_at":"2016-05-07T16:18:26Z","author_association":"MEMBER","body":"> Kicking a machine out of cluster (and moving shards around as a consequence) is useful only if the issue is completely isolated and has nothing to do with ES itself, e.g., hardware, network.\n\n[Delayed allocation](https://www.elastic.co/guide/en/elasticsearch/reference/current/delayed-allocation.html) can help you here.\n\n> However, in many cases ping failures are just an indication of a bigger problem (CPU spikes, Java GC stalls, OOM), and there is no one-size-fits-it-all policy to handle it.\n\nA broad alert (a node missed a ping) where the first step is checking these metrics likely to be less useful than just having fine-grained alerting on these specific metrics.\n\n> In our production setup we have increased ping_retries to a much higher value to prevent a default reaction to ping failures.\n\nThis is generally not a good idea. This will allow hung or dead nodes to stick around far longer than is ideal which will impact querying and indexing.\n\nI'm sorry that I'm continuing to miss the usefulness of this.\n","performed_via_github_app":null}]