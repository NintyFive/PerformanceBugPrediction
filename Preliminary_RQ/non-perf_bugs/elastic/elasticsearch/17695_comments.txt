[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/209281692","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-209281692","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":209281692,"node_id":"MDEyOklzc3VlQ29tbWVudDIwOTI4MTY5Mg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-04-13T07:36:42Z","updated_at":"2016-04-13T07:36:42Z","author_association":"MEMBER","body":"> none of its index files are deleted\n\nTo be clear - shard level folders are deleted and the index metadata is deleted as well. The problem is that we leave an empty folder behind.\n\nRe No 2.:\n\nDo we have specific issue with master nodes or is it specifically about nodes that do not host a shard of the shard from the shadow index? (i.e., master nodes but also some data nodes)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/209525625","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-209525625","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":209525625,"node_id":"MDEyOklzc3VlQ29tbWVudDIwOTUyNTYyNQ==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-04-13T16:07:05Z","updated_at":"2016-04-13T16:07:05Z","author_association":"CONTRIBUTOR","body":"> To be clear - shard level folders are deleted and the index metadata is deleted as well. The problem is that we leave an empty folder behind.\n\nYes, that is correct.  I changed the description to be more clear on this.\n\n> Do we have specific issue with master nodes or is it specifically about nodes that do not host a shard of the shard from the shadow index? (i.e., master nodes but also some data nodes)\n\nI think our tests prove that this isn't a specific issue, but only a general one as it relates to index folders not getting cleaned up.  Since we are dropping the `testDeletingIndexWithDedicatedMasterNodes`, I will remove this point from the description as well.\n\nI believe the fundamental problems with shadow replica deletion are 1. the leaving behind of these (empty) index folders and 2. when a shadow replica has been closed and then deleted, all nodes try to delete the same shared shard data folder, in which case, the first node succeeds, but the remaining nodes try to delete already deleted files (with the potential for race conditions here if multiple nodes are deleting at the same time).  This throws a warning in the logs and puts the delete in the pending queue.  \n\nI will update the description of this issue accordingly.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/218713755","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-218713755","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":218713755,"node_id":"MDEyOklzc3VlQ29tbWVudDIxODcxMzc1NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-05-12T10:03:09Z","updated_at":"2016-05-12T10:03:09Z","author_association":"MEMBER","body":"@abeyad was there any discussion on this ? if not we should pick it and make a plan.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/218757655","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-218757655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":218757655,"node_id":"MDEyOklzc3VlQ29tbWVudDIxODc1NzY1NQ==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-05-12T13:31:39Z","updated_at":"2016-05-12T13:31:39Z","author_association":"CONTRIBUTOR","body":"@bleskes nothing further has been done on this, its worth a discussion to see how best to handle the aforementioned scenarios.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/218775181","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-218775181","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":218775181,"node_id":"MDEyOklzc3VlQ29tbWVudDIxODc3NTE4MQ==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-05-12T14:30:35Z","updated_at":"2016-05-12T14:30:35Z","author_association":"CONTRIBUTOR","body":"Upon discussion with Boaz, these issues are known and have been there for a long time.  They don't cause incorrect behavior, they just prevent shadow replicas from deleting cleanly.  It remains to be discussed if this is important to tackle and if so, what the appropriate solutions are.\n\n@bleskes @clintongormley FYI\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238355950","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-238355950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":238355950,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM1NTk1MA==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T19:53:44Z","updated_at":"2016-08-08T19:53:44Z","author_association":"MEMBER","body":"@abeyad @clintongormley how do we feel about this being a blocker for 5.0? It's currently marked as a blocker due to a `// norelease` in `IndexWithShadowReplicasIT` pointing to this issue\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238362862","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-238362862","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":238362862,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM2Mjg2Mg==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T20:16:57Z","updated_at":"2016-08-08T20:17:19Z","author_association":"CONTRIBUTOR","body":"I'm inclined to say these are not blockers, because they result in improper full cleanup (empty directories laying around) or simultaneous deletes that are logged as such without tripping any errors.  Also, adding the failed deletes to the pending queue just means they will get executed later and essentially be no-ops because there will be nothing to delete (as the deletion was already done successfully by one of the nodes).  \n\nSo, its not great form, but given that shadow replicas aren't a ubiquitous feature and this issue doesn't actually cause incorrect behavior, I don't feel its a blocker.\n\nIf @clintongormley agrees, I can remove the the `// norelease` from the test.\n\n@dakrone what do you think?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239224557","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-239224557","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":239224557,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTIyNDU1Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-08-11T17:04:09Z","updated_at":"2016-08-11T17:04:09Z","author_association":"CONTRIBUTOR","body":"+1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239226089","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-239226089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":239226089,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTIyNjA4OQ==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-08-11T17:09:53Z","updated_at":"2016-08-11T17:09:53Z","author_association":"CONTRIBUTOR","body":"I removed the blocker label and removed the `//norelease` in 50b31ce6202683917bd007fde022d5019a501453\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/331484946","html_url":"https://github.com/elastic/elasticsearch/issues/17695#issuecomment-331484946","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17695","id":331484946,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMTQ4NDk0Ng==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-09-22T15:47:39Z","updated_at":"2017-09-22T15:47:39Z","author_association":"MEMBER","body":"I would close this now that shadow replicas have been removed. I do not think we will go back to old branches and fix this problem.","performed_via_github_app":null}]