[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296943962","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-296943962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":296943962,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Njk0Mzk2Mg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T07:39:41Z","updated_at":"2017-04-25T07:39:41Z","author_association":"CONTRIBUTOR","body":"Just skipping phase 1 would leave replicas in an inconsistent state. There are better solutions though:\r\n[Synced flush](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-synced-flush.html) should give you instant recoveries if there is no write activity on the indices. For indices that continuously receive writes, Elasticsearch 6 will have fast replica recoveries that also guarantee data consistency (see https://github.com/elastic/elasticsearch/issues/10708).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296976864","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-296976864","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":296976864,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Njk3Njg2NA==","user":{"login":"johnyannj","id":8110450,"node_id":"MDQ6VXNlcjgxMTA0NTA=","avatar_url":"https://avatars3.githubusercontent.com/u/8110450?v=4","gravatar_id":"","url":"https://api.github.com/users/johnyannj","html_url":"https://github.com/johnyannj","followers_url":"https://api.github.com/users/johnyannj/followers","following_url":"https://api.github.com/users/johnyannj/following{/other_user}","gists_url":"https://api.github.com/users/johnyannj/gists{/gist_id}","starred_url":"https://api.github.com/users/johnyannj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnyannj/subscriptions","organizations_url":"https://api.github.com/users/johnyannj/orgs","repos_url":"https://api.github.com/users/johnyannj/repos","events_url":"https://api.github.com/users/johnyannj/events{/privacy}","received_events_url":"https://api.github.com/users/johnyannj/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T09:43:42Z","updated_at":"2017-04-25T09:44:31Z","author_association":"NONE","body":"hi, synced flush dont resolve problem.\r\n\r\nfirst:\r\n\r\nWhen cluster fail for machine、network、power etc,  there is no chance for you to execute Synced Flush.\r\n\r\n\r\n\r\nSecond:  \r\n\r\nwhen shard is too large, the document num is  often inconsistent. \r\nalthough the syncid is same but document num is different.  source node recovery will return error, and target node will remove local data and recovery whole shard from primary shard:\r\n\r\nRecoverySourceHandler.java\r\n\r\n ```\r\n          String recoverySourceSyncId = recoverySourceMetadata.getSyncId();\r\n            String recoveryTargetSyncId = request.metadataSnapshot().getSyncId();\r\n            final boolean recoverWithSyncId = recoverySourceSyncId != null &&\r\n                    recoverySourceSyncId.equals(recoveryTargetSyncId);\r\n            if (recoverWithSyncId) {\r\n                final long numDocsTarget = request.metadataSnapshot().getNumDocs();\r\n                final long numDocsSource = recoverySourceMetadata.getNumDocs();\r\n                if (numDocsTarget != numDocsSource) {\r\n                    throw new IllegalStateException(\"try to recover \" + request.shardId() + \" from primary shard with sync id but number \" +\r\n                            \"of docs differ: \" + numDocsSource + \" (\" + request.sourceNode().getName() + \", primary) vs \" + numDocsTarget\r\n                            + \"(\" + request.targetNode().getName() + \")\");\r\n                }\r\n                // we shortcut recovery here because we have nothing to copy. but we must still start the engine on the target.\r\n                // so we don't return here\r\n                logger.trace(\"skipping [phase1]- identical sync id [{}] found on both source and target\", recoverySourceSyncId);\r\n} else {\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297016381","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297016381","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297016381,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzAxNjM4MQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T12:37:17Z","updated_at":"2017-04-25T12:37:17Z","author_association":"CONTRIBUTOR","body":"> when shard is too large, the document num is often inconsistent.\r\n\r\nNo, this has nothing to do with shard size. It should only happen in the scenario described [here (Section \"Replicas can fall out of sync when a primary shard fails\")](https://www.elastic.co/guide/en/elasticsearch/resiliency/master/index.html).\r\nThis will be properly fixed by the work mentioned above (#10708) in Elasticsearch 6 and should lead to very quick recovery times.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297330128","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297330128","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297330128,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzMzMDEyOA==","user":{"login":"johnyannj","id":8110450,"node_id":"MDQ6VXNlcjgxMTA0NTA=","avatar_url":"https://avatars3.githubusercontent.com/u/8110450?v=4","gravatar_id":"","url":"https://api.github.com/users/johnyannj","html_url":"https://github.com/johnyannj","followers_url":"https://api.github.com/users/johnyannj/followers","following_url":"https://api.github.com/users/johnyannj/following{/other_user}","gists_url":"https://api.github.com/users/johnyannj/gists{/gist_id}","starred_url":"https://api.github.com/users/johnyannj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnyannj/subscriptions","organizations_url":"https://api.github.com/users/johnyannj/orgs","repos_url":"https://api.github.com/users/johnyannj/repos","events_url":"https://api.github.com/users/johnyannj/events{/privacy}","received_events_url":"https://api.github.com/users/johnyannj/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T10:02:18Z","updated_at":"2017-04-26T10:02:43Z","author_association":"NONE","body":"@ywelsch \r\n\r\nbut when we synced flush and restart , we found many errors:\r\n\r\nCaused by: java.lang.IllegalStateException: try to recover [xxxx][1196] from primary shard with sync id but number of docs differ: 66923216 (xxxxxx_9400, primary) vs 66923302(xxxxxx_9200)\r\n    at org.elasticsearch.indices.recovery.RecoverySourceHandler.phase1(RecoverySourceHandler.java:176)\r\n    ... 11 more\r\n\r\nwhich lead to many replica shards be removed and re create again....\r\n\r\nwhy?\r\n\r\n\r\n\r\nversion 1.7.1","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297338887","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297338887","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297338887,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzMzODg4Nw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T10:21:36Z","updated_at":"2017-04-26T10:21:36Z","author_association":"CONTRIBUTOR","body":"> why?\r\n\r\nCan you be more specific what you don't understand? I provided you the link to the explanation. Let me copy-paste the text here:\r\n\r\n> When a primary shard fails, a replica shard will be promoted to be the primary shard. If there is more than one replica shard, it is possible for the remaining replicas to be out of sync with the new primary shard. This is caused by operations that were in-flight when the primary shard failed and may not have been processed on all replica shards. Currently, the discrepancies are not repaired on primary promotion but instead would be repaired if replica shards are relocated (e.g., from hot to cold nodes); this does mean that the length of time which replicas can be out of sync with the primary shard is unbounded. Sequence numbers #10708 will provide a mechanism for syncing the remaining replicas with the newly-promoted primary shard.\r\n\r\nPart of the recovery is to repair discrepancies between primary and replicas. We won't allow a way to opt out of this behavior. ES 6 will provide fast recoveries when there are discrepancies between shard copies and also do the repair on primary promotion.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297387127","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297387127","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297387127,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzM4NzEyNw==","user":{"login":"johnyannj","id":8110450,"node_id":"MDQ6VXNlcjgxMTA0NTA=","avatar_url":"https://avatars3.githubusercontent.com/u/8110450?v=4","gravatar_id":"","url":"https://api.github.com/users/johnyannj","html_url":"https://github.com/johnyannj","followers_url":"https://api.github.com/users/johnyannj/followers","following_url":"https://api.github.com/users/johnyannj/following{/other_user}","gists_url":"https://api.github.com/users/johnyannj/gists{/gist_id}","starred_url":"https://api.github.com/users/johnyannj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnyannj/subscriptions","organizations_url":"https://api.github.com/users/johnyannj/orgs","repos_url":"https://api.github.com/users/johnyannj/repos","events_url":"https://api.github.com/users/johnyannj/events{/privacy}","received_events_url":"https://api.github.com/users/johnyannj/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T12:18:50Z","updated_at":"2017-04-26T12:18:50Z","author_association":"NONE","body":"thank you for your patience.\r\n\r\nfrom your help:\r\n\r\nI now know the reason of the discrepancies between replica and primary shards。  we have 2 replica shards now.   sometimes disk error, we will stop and replace the node.  one replica shard will become primary shard. then discrepancies appear.\r\n\r\nI also know part of the recovery is to repair discrepancies. and ES 6 will provide fast recoveries  base on Sequence numbers\r\n\r\nis right?\r\n\r\n\r\n\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297400230","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297400230","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297400230,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzQwMDIzMA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T13:03:44Z","updated_at":"2017-04-26T13:03:44Z","author_association":"CONTRIBUTOR","body":"correct 👍 ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297582171","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297582171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297582171,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzU4MjE3MQ==","user":{"login":"johnyannj","id":8110450,"node_id":"MDQ6VXNlcjgxMTA0NTA=","avatar_url":"https://avatars3.githubusercontent.com/u/8110450?v=4","gravatar_id":"","url":"https://api.github.com/users/johnyannj","html_url":"https://github.com/johnyannj","followers_url":"https://api.github.com/users/johnyannj/followers","following_url":"https://api.github.com/users/johnyannj/following{/other_user}","gists_url":"https://api.github.com/users/johnyannj/gists{/gist_id}","starred_url":"https://api.github.com/users/johnyannj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnyannj/subscriptions","organizations_url":"https://api.github.com/users/johnyannj/orgs","repos_url":"https://api.github.com/users/johnyannj/repos","events_url":"https://api.github.com/users/johnyannj/events{/privacy}","received_events_url":"https://api.github.com/users/johnyannj/received_events","type":"User","site_admin":false},"created_at":"2017-04-27T01:00:37Z","updated_at":"2017-04-27T01:00:37Z","author_association":"NONE","body":"Thank you again~\r\n\r\nThe last question：\r\n\r\nI know the importance of repair discrepancies for recovery。but...\r\nSince the cluster has discrepancies before restart，  Why do we have to fix it when we restart the whole cluster?   \r\n\r\ncan we  quick recoveries when restart the whole cluster.  after restart，we can modify it back?\r\n\r\nI think taking many  hours to restart the whole cluster is a disaster for users。\r\n\r\nand \r\n\r\nIt will take a long time before ES6 releases\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297583115","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297583115","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297583115,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzU4MzExNQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-27T01:07:44Z","updated_at":"2017-04-27T01:07:44Z","author_association":"MEMBER","body":"> Why do we have to fix it when we restart the whole cluster?\r\n\r\n> can we quick recoveries when restart the whole cluster. after restart，we can modify it back?\r\n\r\nA point of a replica is resiliency, if you lose the primary the replica is there as a valid copy of the acknowledged writes. If a discrepancy arises, it should be repaired as soon as possible to minimize the amount of time that a replica is not a valid copy thus increasing the overall resiliency of the system.\r\n\r\n> I think taking many hours to restart the whole cluster is a disaster for users。\r\n\r\nEvery engineering decision involves tradeoffs. We think decreasing resiliency and increasing the risk of data loss is a worse disaster. As @ywelsch mentioned, we have fast replica recoveries in master today to ship with 6.0.0.\r\n\r\n> It will take a long time before ES6 releases\r\n\r\nGood things come to those who wait.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297630861","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297630861","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297630861,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzYzMDg2MQ==","user":{"login":"johnyannj","id":8110450,"node_id":"MDQ6VXNlcjgxMTA0NTA=","avatar_url":"https://avatars3.githubusercontent.com/u/8110450?v=4","gravatar_id":"","url":"https://api.github.com/users/johnyannj","html_url":"https://github.com/johnyannj","followers_url":"https://api.github.com/users/johnyannj/followers","following_url":"https://api.github.com/users/johnyannj/following{/other_user}","gists_url":"https://api.github.com/users/johnyannj/gists{/gist_id}","starred_url":"https://api.github.com/users/johnyannj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnyannj/subscriptions","organizations_url":"https://api.github.com/users/johnyannj/orgs","repos_url":"https://api.github.com/users/johnyannj/repos","events_url":"https://api.github.com/users/johnyannj/events{/privacy}","received_events_url":"https://api.github.com/users/johnyannj/received_events","type":"User","site_admin":false},"created_at":"2017-04-27T07:10:15Z","updated_at":"2017-04-27T07:10:15Z","author_association":"NONE","body":"hi @jasontedor, Thank you~\r\n\r\nWhere can I get the roadmap for ES 6.0? \r\n\r\nES 6.0 can be released this year?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297688822","html_url":"https://github.com/elastic/elasticsearch/issues/24302#issuecomment-297688822","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24302","id":297688822,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzY4ODgyMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-27T11:34:35Z","updated_at":"2017-04-27T11:34:35Z","author_association":"MEMBER","body":"> Where can I get the roadmap for ES 6.0?\r\n\r\nWe do not provide a roadmap yet you can track the PRs here on GitHub with the label [v6.0.0](https://github.com/elastic/elasticsearch/pulls?utf8=✓&q=label%3Av6.0.0%20). There is some taste of what's coming in the talk [What's evolving in Elasticsearch](https://www.elastic.co/elasticon/conf/2017/sf/what-is-evolving-in-elasticsearch).\r\n\r\n> ES 6.0 can be released this year?\r\n\r\nWe do not provide release dates/estimates.","performed_via_github_app":null}]