[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/462289317","html_url":"https://github.com/elastic/elasticsearch/issues/38707#issuecomment-462289317","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38707","id":462289317,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MjI4OTMxNw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-02-11T11:02:39Z","updated_at":"2019-02-11T11:02:39Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/462324424","html_url":"https://github.com/elastic/elasticsearch/issues/38707#issuecomment-462324424","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38707","id":462324424,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MjMyNDQyNA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-02-11T13:20:13Z","updated_at":"2019-02-11T13:20:13Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/462687485","html_url":"https://github.com/elastic/elasticsearch/issues/38707#issuecomment-462687485","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38707","id":462687485,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MjY4NzQ4NQ==","user":{"login":"synFK","id":42768670,"node_id":"MDQ6VXNlcjQyNzY4Njcw","avatar_url":"https://avatars2.githubusercontent.com/u/42768670?v=4","gravatar_id":"","url":"https://api.github.com/users/synFK","html_url":"https://github.com/synFK","followers_url":"https://api.github.com/users/synFK/followers","following_url":"https://api.github.com/users/synFK/following{/other_user}","gists_url":"https://api.github.com/users/synFK/gists{/gist_id}","starred_url":"https://api.github.com/users/synFK/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synFK/subscriptions","organizations_url":"https://api.github.com/users/synFK/orgs","repos_url":"https://api.github.com/users/synFK/repos","events_url":"https://api.github.com/users/synFK/events{/privacy}","received_events_url":"https://api.github.com/users/synFK/received_events","type":"User","site_admin":false},"created_at":"2019-02-12T09:38:38Z","updated_at":"2019-02-12T09:38:38Z","author_association":"NONE","body":"By the way this issue applies also for `boolean` and all other numeric types.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/488273881","html_url":"https://github.com/elastic/elasticsearch/issues/38707#issuecomment-488273881","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38707","id":488273881,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4ODI3Mzg4MQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-05-01T12:48:45Z","updated_at":"2019-05-01T12:52:39Z","author_association":"CONTRIBUTOR","body":"@synFK , thanks for your interest in elasticsearch.\r\n\r\nI have tried to reproduce this, but have not been successful in doing so. The type of a field generally cannot be modified once the mapping has been established so this should not be possible. It could be that the behaviour will not manifest itself except under specific conditions.\r\n\r\nI would like to get a little closer to the actual steps you took. My best guess at this time is that the_index-000001 was created before the template or at least that something prevented the template from being applied.\r\n\r\nThe steps I did are given below (notice that these instructions will permanently delete the indices used in the example and that I used that names you supplied so be careful where you run this). Notice that I did a reindex from localhost for simplicity (I find it very unlikely to be something inflicted by the remote source).\r\n\r\n```\r\nDELETE old_searches\r\n\r\nDELETE _template/template_1\r\n\r\nDELETE the_index-000001\r\n\r\nPUT old_searches\r\n{\r\n  \"mappings\" : {\r\n  \"_doc\" : {\r\n   \"properties\": {\r\n    \"result\": {\r\n      \"properties\": {\r\n        \"user\": {\r\n          \"properties\": {\r\n            \"id\": {\r\n              \"type\": \"text\",\r\n              \"fields\": {\r\n                \"raw\": {\r\n                  \"type\": \"keyword\",\r\n                  \"ignore_above\": 256\r\n                }\r\n              },\r\n              \"norms\": false\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n}\r\n}\r\n\r\nPUT old_searches/_doc/1\r\n{\r\n  \"result\" : { \"user\": { \"id\" : \"12345\" } }\r\n}\r\n\r\nPUT _template/template_1\r\n{\r\n  \"order\": 0,\r\n  \"index_patterns\": [ \"the_index-*\" ],\r\n  \"settings\": {\r\n    \"number_of_replicas\": 0,\r\n    \"number_of_shards\": 1,\r\n    \"refresh_interval\": \"5s\",\r\n    \"index.lifecycle.name\": \"default_lifecycle_policy\",\r\n    \"index.lifecycle.rollover_alias\": \"new_searches\"\r\n  },\r\n  \"mappings\": {\r\n  \"_doc\" : {\r\n      \"properties\": {\r\n        \"result\": {\r\n          \"properties\": {\r\n            \"user\": {\r\n              \"properties\": {\r\n                \"id\": {\r\n                  \"type\": \"long\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n}\r\n}\r\n\r\nPUT the_index-000001\r\n\r\nPOST _reindex\r\n{\r\n  \"size\": 100,\r\n  \"source\": {\r\n    \"remote\": {\r\n      \"host\": \"http://localhost:9200\"\r\n    },\r\n    \"index\": \"old_searches\"\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"new_searches\"\r\n  }\r\n}\r\n\r\n```\r\n\r\nAfterwards, the mapping was defined like this, ie. type long as expected:\r\n\r\n```\r\nGET the_index-000001\r\n{\"the_index-000001\":{\"aliases\":{},\"mappings\":{\"_doc\":{\"properties\":{\"result\":{\"properties\":{\"user\":{\"properties\":{\"id\":{\"type\":\"long\"}}}}}}}},\"settings\":{\"index\":{\"lifecycle\":{\"name\":\"default_lifecycle_policy\",\"rollover_alias\":\"new_searches\"},\"refresh_interval\":\"5s\",\"number_of_shards\":\"1\",\"provided_name\":\"the_index-000001\",\"creation_date\":\"1556714472477\",\"number_of_replicas\":\"0\",\"uuid\":\"V1nr5CgLTzCoXt5wDtAUkw\",\"version\":{\"created\":\"6060299\"}}}}}\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/507650611","html_url":"https://github.com/elastic/elasticsearch/issues/38707#issuecomment-507650611","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38707","id":507650611,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzY1MDYxMQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-07-02T12:15:15Z","updated_at":"2019-07-02T12:15:15Z","author_association":"CONTRIBUTOR","body":"@synFK given that we have not heard back from you on this, I will close this issue. Please reopen with clarification if you think there is still something to improve here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/507680889","html_url":"https://github.com/elastic/elasticsearch/issues/38707#issuecomment-507680889","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38707","id":507680889,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzY4MDg4OQ==","user":{"login":"synFK","id":42768670,"node_id":"MDQ6VXNlcjQyNzY4Njcw","avatar_url":"https://avatars2.githubusercontent.com/u/42768670?v=4","gravatar_id":"","url":"https://api.github.com/users/synFK","html_url":"https://github.com/synFK","followers_url":"https://api.github.com/users/synFK/followers","following_url":"https://api.github.com/users/synFK/following{/other_user}","gists_url":"https://api.github.com/users/synFK/gists{/gist_id}","starred_url":"https://api.github.com/users/synFK/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synFK/subscriptions","organizations_url":"https://api.github.com/users/synFK/orgs","repos_url":"https://api.github.com/users/synFK/repos","events_url":"https://api.github.com/users/synFK/events{/privacy}","received_events_url":"https://api.github.com/users/synFK/received_events","type":"User","site_admin":false},"created_at":"2019-07-02T13:38:40Z","updated_at":"2019-07-02T13:38:40Z","author_association":"NONE","body":"Hi @henningandersen,\r\nthe issue still exists, but I guess it is a cosmetic one. Of course the mapping shows us a field of type long. But when you request the actual data the reindexed string value is still double quoted, whereas the hard coded and thus successfully autoconverted value is not.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/507688781","html_url":"https://github.com/elastic/elasticsearch/issues/38707#issuecomment-507688781","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38707","id":507688781,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzY4ODc4MQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-07-02T13:57:23Z","updated_at":"2019-07-02T13:57:39Z","author_association":"CONTRIBUTOR","body":"@synFK thanks for clarifying. This is the way it works, also if you simply put a document with a string for a long field:\r\n```\r\nPUT xxx/_doc/1\r\n{\r\n  \"data\" : \"17\"\r\n}\r\n```\r\ngives:\r\n```\r\nGET xxx/_doc/1\r\n{\"_index\":\"xxx\",\"_type\":\"_doc\",\"_id\":\"1\",\"_version\":3,\"_seq_no\":2,\"_primary_term\":1,\"found\":true,\"_source\":{\r\n  \"data\" : \"17\"\r\n}\r\n}\r\n```\r\nwhereas:\r\n```\r\nPUT xxx/_doc/1\r\n{\r\n  \"data\" : 17\r\n}\r\n```\r\nresults in:\r\n```\r\n{\"_index\":\"xxx\",\"_type\":\"_doc\",\"_id\":\"1\",\"_version\":2,\"_seq_no\":1,\"_primary_term\":1,\"found\":true,\"_source\":{\r\n  \"data\" : 17\r\n}\r\n}\r\n```\r\nI suspect that the auto-conversion with painless happens in the script, not during reindex.","performed_via_github_app":null}]