{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31830","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31830/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31830/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31830/events","html_url":"https://github.com/elastic/elasticsearch/issues/31830","id":338613909,"node_id":"MDU6SXNzdWUzMzg2MTM5MDk=","number":31830,"title":"High CPU usage while bulk indexing","user":{"login":"motherhubbard","id":3320683,"node_id":"MDQ6VXNlcjMzMjA2ODM=","avatar_url":"https://avatars0.githubusercontent.com/u/3320683?v=4","gravatar_id":"","url":"https://api.github.com/users/motherhubbard","html_url":"https://github.com/motherhubbard","followers_url":"https://api.github.com/users/motherhubbard/followers","following_url":"https://api.github.com/users/motherhubbard/following{/other_user}","gists_url":"https://api.github.com/users/motherhubbard/gists{/gist_id}","starred_url":"https://api.github.com/users/motherhubbard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/motherhubbard/subscriptions","organizations_url":"https://api.github.com/users/motherhubbard/orgs","repos_url":"https://api.github.com/users/motherhubbard/repos","events_url":"https://api.github.com/users/motherhubbard/events{/privacy}","received_events_url":"https://api.github.com/users/motherhubbard/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-07-05T15:05:05Z","updated_at":"2018-07-05T17:14:10Z","closed_at":"2018-07-05T17:14:10Z","author_association":"NONE","active_lock_reason":null,"body":"### Environment\r\n\r\nElasticsearch version (bin/elasticsearch --version):\r\nVersion: 5.5.1, Build: 19c13d0/2017-07-18T20:44:24.823Z, JVM: 1.8.0_141\r\n\r\nJVM version (java -version):\r\nopenjdk version \"1.8.0_141\"\r\nOpenJDK Runtime Environment (build 1.8.0_141-b16)\r\nOpenJDK 64-Bit Server VM (build 25.141-b16, mixed mode)\r\n\r\nOS version (uname -a if on a Unix-like system):\r\nLinux kyc-demo 2.6.32-696.10.1.el6.x86_64 #1 SMP Tue Aug 22 18:51:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nWe have 9 servers each with 132G RAM. We allocate 30G to the Elastic VM. There are other processes on this box also. Each box has 16 CPUs. The CPUs are generally under utilised.\r\n\r\nWe use Spinny disks.\r\n\r\nWe have approximately 300 date based indices with a total of 1550 primary shards with 1 replica for each shard (so 3000 shards in total).\r\n\r\n### Schema\r\n\r\nSchema is available on request but due to size limits I could not upload it here.\r\n\r\n### More details\r\n\r\nhotthreads show traces along the lines of:\r\n```\r\n103.2% (516.2ms out of 500ms) cpu usage by thread 'elasticsearch[server3-3][management][T#4]\r\n     3/10 snapshots sharing following 15 elements\r\n       org.elasticsearch.index.shard.IndexShard.segmentStats(IndexShard.java:723)\r\n       org.elasticsearch.action.admin.indices.stats.CommonStats.<init>(CommonStats.java:210)\r\n    org.elasticsearch.action.admin.indices.stats.TransportIndicesStatsAction.shardOperation(TransportIndicesStatsAction.java:163)\r\n```\r\n\r\nI have provided more details over at https://discuss.elastic.co/t/high-cpu-usage-while-bulk-indexing/135023","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}