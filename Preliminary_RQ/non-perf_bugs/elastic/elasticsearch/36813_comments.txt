[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448458770","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-448458770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":448458770,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODQ1ODc3MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-12-19T03:38:24Z","updated_at":"2018-12-19T03:38:24Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448703335","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-448703335","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":448703335,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODcwMzMzNQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2018-12-19T18:48:07Z","updated_at":"2018-12-19T18:48:07Z","author_association":"MEMBER","body":"This looks like the test may have just been very slow for some reason. Looking at the fact that it polled 10 times (so more than half a second) for the `AcknowledgedResponse` when locally this this busy assert takes me less than 10ms.\r\nAlso, there's this in the logs:\r\n\r\n```\r\nERROR: JVM J0 ended with an exception: Forked process returned with error code: 137. Very likely a JVM crash.  See process stderr at: /var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic/server/build/testrun/integTest/temp/junit4-J0-20181219_015515_2601288045382664915697.syserr\r\n\tat com.carrotsearch.ant.tasks.junit4.JUnit4.executeSlave(JUnit4.java:1542)\r\n\tat com.carrotsearch.ant.tasks.junit4.JUnit4.access$000(JUnit4.java:123)\r\n\tat com.carrotsearch.ant.tasks.junit4.JUnit4$2.call(JUnit4.java:997)\r\n\tat com.carrotsearch.ant.tasks.junit4.JUnit4$2.call(JUnit4.java:994)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n```\r\n\r\n=> seems like the kernel OOM killer killed a test JVM? ... hard to tell but maybe the system was so overloaded that the JVM process almost froze (from swapping or so) and simply timed out.\r\nI also can't find anything obviously wrong in the cluster logs (and the logging is set to globally debug here). \r\n\r\nThis is not the same failure as in other failing runs of this test that email threads reference. In those a non-polling ack assert failed, this one:\r\n\r\n```java\r\n        assertAcked(client().admin().indices().prepareUpdateSettings(\"index\").setSettings(Settings.builder()\r\n                .put(\"index.routing.allocation.include._name\", \"\")).get());\r\n```\r\n\r\n=> I'd close this and reopen if it comes up again, since a timeout in a test run that eventually ran into the OOM killer is really suspicious? :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/451683116","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-451683116","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":451683116,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTY4MzExNg==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-01-05T19:18:02Z","updated_at":"2019-01-05T19:23:36Z","author_association":"MEMBER","body":"The missing ack failure mode linked to in the initial issue description is happening here still though:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=openjdk12,ES_RUNTIME_JAVA=java8fips,nodes=virtual&&linux/162/consoleText\r\n\r\n=> looking into this.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458176771","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-458176771","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":458176771,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODE3Njc3MQ==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2019-01-28T15:31:14Z","updated_at":"2019-01-28T15:31:14Z","author_association":"CONTRIBUTOR","body":"I observed this failure on a Centos 7 VM after ~ 1 hour of running internal cluster tests in a loop. Stack trace is different not sure if it's related. I haven't experienced slowness on CentOS in CI so far.\r\n```\r\n2> REPRODUCE WITH: ./gradlew :server:integTest -Dtests.seed=BD345D2CF064C409 -Dtests.class=org.elasticsearch.indices.state.RareClusterStateIT -Dtests.method=\"testDelayedMappingPropagationOnReplica\" -Dtests.security.manager=true -Dtests.locale=br-FR -Dtests.timezone=Asia/Jerusalem -Dcompiler.java=11 -Druntime.java=11\r\nFAILURE 3.55s J2 | RareClusterStateIT.testDelayedMappingPropagationOnReplica <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: AcknowledgedResponse failed - not acked\r\n   > Expected: <true>\r\n   >      but: was <false>\r\n   >    at __randomizedtesting.SeedInfo.seed([BD345D2CF064C409:C14A9CE3A083FFEA]:0)\r\n   >    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   >    at org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked(ElasticsearchAssertions.java:112)\r\n   >    at org.elasticsearch.indices.state.RareClusterStateIT.testDelayedMappingPropagationOnReplica(RareClusterStateIT.java:340)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n   >    at java.base/java.lang.Thread.run(Thread.java:834)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458177353","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-458177353","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":458177353,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODE3NzM1Mw==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2019-01-28T15:32:47Z","updated_at":"2019-01-28T15:32:47Z","author_association":"CONTRIBUTOR","body":"Here's another recent repro for the one in the description: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+intake/1209/","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458887133","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-458887133","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":458887133,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODg4NzEzMw==","user":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"created_at":"2019-01-30T10:10:26Z","updated_at":"2019-01-30T10:10:26Z","author_association":"CONTRIBUTOR","body":"another failure. does not reproduce for me locally as well\r\n`\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/131/console\r\n`\r\n\r\n```\r\n./gradlew :server:integTest \\\r\n  -Dtests.seed=37FF28E573A0046A \\\r\n  -Dtests.class=org.elasticsearch.indices.state.RareClusterStateIT \\\r\n  -Dtests.method=\"testDelayedMappingPropagationOnReplica\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ga \\\r\n  -Dtests.timezone=Atlantic/Faeroe \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460275993","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-460275993","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":460275993,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDI3NTk5Mw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T14:49:26Z","updated_at":"2019-02-04T14:49:26Z","author_association":"MEMBER","body":"Still seems to fail on master:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/499/console\r\n\r\n```\r\n ./gradlew :server:integTest \\\r\n  -Dtests.seed=7F2D32832D1B9B3B \\\r\n  -Dtests.class=org.elasticsearch.cluster.coordination.RareClusterStateIT \\\r\n  -Dtests.method=\"testDelayedMappingPropagationOnReplica\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=en-SG \\\r\n  -Dtests.timezone=Australia/NSW \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\n```\r\n15:28:12 FAILURE 10.5s J0 | RareClusterStateIT.testDelayedMappingPropagationOnReplica <<< FAILURES!\r\n15:28:12    > Throwable #1: java.lang.AssertionError\r\n15:28:12    > \tat __randomizedtesting.SeedInfo.seed([7F2D32832D1B9B3B:353F34C7DFCA0D8]:0)\r\n15:28:12    > \tat org.elasticsearch.cluster.coordination.RareClusterStateIT.lambda$testDelayedMappingPropagationOnReplica$4(RareClusterStateIT.java:346)\r\n15:28:12    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:858)\r\n15:28:12    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:832)\r\n15:28:12    > \tat org.elasticsearch.cluster.coordination.RareClusterStateIT.testDelayedMappingPropagationOnReplica(RareClusterStateIT.java:340)\r\n15:28:12    > \tat java.lang.Thread.run(Thread.java:748)\r\n15:28:12    > \tSuppressed: java.lang.AssertionError\r\n15:28:12    > \t\tat org.elasticsearch.cluster.coordination.RareClusterStateIT.lambda$testDelayedMappingPropagationOnReplica$4(RareClusterStateIT.java:346)\r\n15:28:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n15:28:12    > \t\t... 39 more\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460276585","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-460276585","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":460276585,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDI3NjU4NQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T14:51:02Z","updated_at":"2019-02-04T14:51:02Z","author_association":"MEMBER","body":"Some more failures over the weekend that look related to me:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/392/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/306/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460380157","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-460380157","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":460380157,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDM4MDE1Nw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T19:30:59Z","updated_at":"2019-02-04T19:30:59Z","author_association":"MEMBER","body":"Another one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/513/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460420641","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-460420641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":460420641,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDQyMDY0MQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T21:30:54Z","updated_at":"2019-02-04T21:30:54Z","author_association":"MEMBER","body":"Muted with  0ced775.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/461919013","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-461919013","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":461919013,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MTkxOTAxMw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-02-08T19:31:48Z","updated_at":"2019-02-08T19:31:48Z","author_association":"MEMBER","body":"I could reproduce this one with the seed from https://github.com/elastic/elasticsearch/issues/36813#issuecomment-460275993 (hundreds of runs though). Attached the logs of the failure here +  working on it now.\r\n[full-logs.txt](https://github.com/elastic/elasticsearch/files/2846581/full-logs.txt)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/461956787","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-461956787","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":461956787,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MTk1Njc4Nw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-02-08T21:42:22Z","updated_at":"2019-02-08T21:42:22Z","author_association":"MEMBER","body":"Figured out what's causing this.\r\nThe `assertBusy` in `org.elasticsearch.cluster.coordination.RareClusterStateIT#executeAndCancelCommittedPublication` randomly (every few 100 runs) takes 15s (pretty much exactly 15s every time) to pass.\r\n\r\nEvery time this happens the following is logged:\r\n\r\n```sh\r\n[2019-02-09T08:36:21,673][DEBUG][o.e.c.c.ElectionSchedulerFactory] [node_t0] scheduleNextElection{gracePeriod=500ms, thisAttempt=1, maxDelayMillis=200, delayMillis=697, ElectionScheduler{attempt=2, ElectionSchedulerFactory{initialTimeout=100ms, backoffTime=100ms, maxTimeout=10s}}} not starting election\r\n[2019-02-09T08:36:37,588][DEBUG][o.e.c.s.ClusterApplierService] [node_t0] processing [Publication{term=1, version=9}]: execute\r\n```\r\n\r\nwill figure where we're hanging tomorrow, but upping the timeout to say 1 minute would fix this test for sure as far as I can see already.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463963572","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-463963572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":463963572,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Mzk2MzU3Mg==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2019-02-15T09:13:33Z","updated_at":"2019-02-15T09:13:33Z","author_association":"CONTRIBUTOR","body":"It seems the test is still failing in master:\r\n\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/1213/console\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :server:integTest \\\r\n  -Dtests.seed=A69C259BE17CC12C \\\r\n  -Dtests.class=org.elasticsearch.cluster.coordination.RareClusterStateIT \\\r\n  -Dtests.method=\"testDelayedMappingPropagationOnReplica\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ms \\\r\n  -Dtests.timezone=America/Creston \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=openjdk12,ES_RUNTIME_JAVA=java11,nodes=immutable&&linux&&docker/243/console\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :server:integTest \\\r\n  -Dtests.seed=9F5F7DA15796856F \\\r\n  -Dtests.class=org.elasticsearch.cluster.coordination.RareClusterStateIT \\\r\n  -Dtests.method=\"testDelayedMappingPropagationOnReplica\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=fr-NE \\\r\n  -Dtests.timezone=Africa/Brazzaville \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n```\r\n\r\nThey don't reproduce locally.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463965377","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-463965377","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":463965377,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Mzk2NTM3Nw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-02-15T09:19:44Z","updated_at":"2019-02-15T09:19:44Z","author_association":"MEMBER","body":"Hmpf ... it's a different failure now though it seems. We're now failing on a different step => I'm on it again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/465027033","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-465027033","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":465027033,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NTAyNzAzMw==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2019-02-19T08:03:17Z","updated_at":"2019-02-19T08:03:17Z","author_association":"CONTRIBUTOR","body":"another one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/1485/consoleFull","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/465082778","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-465082778","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":465082778,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NTA4Mjc3OA==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2019-02-19T10:49:32Z","updated_at":"2019-02-19T10:49:32Z","author_association":"CONTRIBUTOR","body":"again: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/1498/console\r\n\r\nI will mute this test for now","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/468738097","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-468738097","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":468738097,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODczODA5Nw==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2019-03-01T17:09:33Z","updated_at":"2019-03-01T17:09:33Z","author_association":"CONTRIBUTOR","body":"This popped up again today: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+internalClusterTest/1491/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470928599","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-470928599","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":470928599,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDkyODU5OQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-03-08T13:29:58Z","updated_at":"2019-03-08T13:29:58Z","author_association":"CONTRIBUTOR","body":"Another one in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+intake/483/consoleText:\r\n\r\n```\r\nFAILURE 10.5s J0 | RareClusterStateIT.testDelayedMappingPropagationOnReplica <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError\r\n   > \tat __randomizedtesting.SeedInfo.seed([EAED3B7AC230EC8E:9693FAB592D7D76D]:0)\r\n   > \tat org.elasticsearch.cluster.coordination.RareClusterStateIT.lambda$testDelayedMappingPropagationOnReplica$4(RareClusterStateIT.java:340)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:862)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:836)\r\n   > \tat org.elasticsearch.cluster.coordination.RareClusterStateIT.testDelayedMappingPropagationOnReplica(RareClusterStateIT.java:334)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > \tSuppressed: java.lang.AssertionError\r\n   > \t\tat org.elasticsearch.cluster.coordination.RareClusterStateIT.lambda$testDelayedMappingPropagationOnReplica$4(RareClusterStateIT.java:340)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:850)\r\n   > \t\t... 39 more\r\n```\r\n\r\nA little bit higher up is:\r\n\r\n```\r\n  1> java.lang.IllegalStateException: transport has been stopped\r\n  1> \tat org.elasticsearch.transport.TcpTransport.ensureOpen(TcpTransport.java:1123) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.TcpTransport.openConnection(TcpTransport.java:291) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.ConnectionManager.internalOpenConnection(ConnectionManager.java:206) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.ConnectionManager.openConnection(ConnectionManager.java:80) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.TransportService.openConnection(TransportService.java:367) ~[main/:?]\r\n  1> \tat org.elasticsearch.discovery.HandshakingTransportAddressConnector$1.doRun(HandshakingTransportAddressConnector.java:82) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:747) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_202]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_202]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_202]\r\n```\r\n\r\nI have no idea if that's the same as the other failures that have been seen in the last month as nobody has said in this issue what the failures in the last month were (beyond the name of the test).\r\n\r\nIt doesn't reproduce locally using:\r\n\r\n```\r\n./gradlew :server:integTest \\\r\n  -Dtests.seed=EAED3B7AC230EC8E \\\r\n  -Dtests.class=org.elasticsearch.cluster.coordination.RareClusterStateIT \\\r\n  -Dtests.method=\"testDelayedMappingPropagationOnReplica\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=sr-Latn \\\r\n  -Dtests.timezone=UCT \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nI muted the test for 7.x in aec2db78eafa3447e86528b65f3fb296fd29e137 (and it was already muted in master)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490042590","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-490042590","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":490042590,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDA0MjU5MA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-05-07T11:35:41Z","updated_at":"2019-05-07T11:35:41Z","author_association":"CONTRIBUTOR","body":"@original-brownbear as this test has been muted for a while and there is no recent failures with logs, and I can't reproduce  this locally, should we enable the test again on master to get a recent failure? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490045800","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-490045800","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":490045800,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDA0NTgwMA==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-05-07T11:47:00Z","updated_at":"2019-05-07T11:47:00Z","author_association":"MEMBER","body":"Sure I opened https://github.com/elastic/elasticsearch/pull/41884 ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/494673472","html_url":"https://github.com/elastic/elasticsearch/issues/36813#issuecomment-494673472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36813","id":494673472,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NDY3MzQ3Mg==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-05-22T06:42:01Z","updated_at":"2019-05-22T06:42:01Z","author_association":"MEMBER","body":"This just failed again on `master` https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/3639/testReport/junit/org.elasticsearch.cluster.coordination/RareClusterStateIT/testDelayedMappingPropagationOnReplica/ looking into it now","performed_via_github_app":null}]