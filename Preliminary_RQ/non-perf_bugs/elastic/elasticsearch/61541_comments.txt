[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/680125792","html_url":"https://github.com/elastic/elasticsearch/issues/61541#issuecomment-680125792","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61541","id":680125792,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MDEyNTc5Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-08-25T16:16:43Z","updated_at":"2020-08-25T16:16:43Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/Snapshot/Restore)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/680137659","html_url":"https://github.com/elastic/elasticsearch/issues/61541#issuecomment-680137659","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61541","id":680137659,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MDEzNzY1OQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2020-08-25T16:37:51Z","updated_at":"2020-08-25T16:37:51Z","author_association":"MEMBER","body":"Interesting, this used to only come up with `WindowsFS` because that FS was really slow and we were doing some massively concurrent writes to disk in this test. Seems it's still failing with other FS at a lower rate :( (the linked build is just busy doing disk writes). I'll see what I can do to speed this up (and will audit this build some more for why it's so absurdly expensive relative to other builds that should have similar complexity ...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/682587854","html_url":"https://github.com/elastic/elasticsearch/issues/61541#issuecomment-682587854","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61541","id":682587854,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MjU4Nzg1NA==","user":{"login":"fcofdez","id":1033457,"node_id":"MDQ6VXNlcjEwMzM0NTc=","avatar_url":"https://avatars1.githubusercontent.com/u/1033457?v=4","gravatar_id":"","url":"https://api.github.com/users/fcofdez","html_url":"https://github.com/fcofdez","followers_url":"https://api.github.com/users/fcofdez/followers","following_url":"https://api.github.com/users/fcofdez/following{/other_user}","gists_url":"https://api.github.com/users/fcofdez/gists{/gist_id}","starred_url":"https://api.github.com/users/fcofdez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fcofdez/subscriptions","organizations_url":"https://api.github.com/users/fcofdez/orgs","repos_url":"https://api.github.com/users/fcofdez/repos","events_url":"https://api.github.com/users/fcofdez/events{/privacy}","received_events_url":"https://api.github.com/users/fcofdez/received_events","type":"User","site_admin":false},"created_at":"2020-08-28T13:53:53Z","updated_at":"2020-08-28T13:53:53Z","author_association":"CONTRIBUTOR","body":"I've been taking a look into this and as Armin pointed out the build that was linked\r\nwas busy waiting for some disk operations to complete. Maybe it's worth mentioning\r\nthat this build was running on Mac machines, so I'm not sure if those machines might \r\nbe over-subscribed. \r\n\r\nI went ahead and took a look into past failures and it seems that there are\r\nother problems related to slow disks.\r\n\r\n\r\n### SharedClusterSnapshotRestoreIT#testGetSnapshotsRequest\r\n\r\n-   [SharedClusterSnapshotRestoreIT#testGetSnapshotsRequest 1](https://gradle-enterprise.elastic.co/s/fxea7bn4a33yu/tests/:server:internalClusterTest/org.elasticsearch.snapshots.SharedClusterSnapshotRestoreIT/testGetSnapshotsRequest#1)\r\n-   [SharedClusterSnapshotRestoreIT#testGetSnapshotsRequest 2](https://gradle-enterprise.elastic.co/s/447t4hhzljz3m/tests/:server:internalClusterTest/org.elasticsearch.snapshots.SharedClusterSnapshotRestoreIT/testGetSnapshotsRequest#1)\r\n\r\nThis is one of the test that is prone to races if the disk is slow.\r\n\r\nIn this test we block operations on the `BlobStore`, create a snapshot, wait for\r\nthe first blob store operation to be [blocked](https://github.com/elastic/elasticsearch/blob/8c44e0d13a206dced5368b6e75c01ce2b881d4bc/server/src/internalClusterTest/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java#L2811) in some node and later on get the\r\nSnapshot. That scenario is prone to races and it manifest in the two failing\r\ntests linked above. \r\n\r\nThe problem with the test is that it's possible that the ClusterState including\r\nthe new Snapshot is published to the node we're waiting for the first operation\r\nto be blocked before the master node, so when we get the snapshot, it might not\r\nbe there yet. This can be reproduced adding an artificial delay to the cluster\r\nstate disk write on master. I'm not sure if we should use `assertBusy` for that \r\nscenario, or somehow wait until all nodes have the same `ClusterState`?\r\n\r\nAn additional problem that arises in these tests is that once an assertion fails\r\nwe don't clean up the blocked `BlobStore` and when we try to clean up the indices,\r\nrepositories, etc. those operations fail as there's a snapshot in progress, that\r\nintroduces a lot of noise as all the tests from that suite that are executed after\r\na failing test, fail during their own clean up phase. I'll open a PR to fix this \r\nissue.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/701544798","html_url":"https://github.com/elastic/elasticsearch/issues/61541#issuecomment-701544798","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61541","id":701544798,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMTU0NDc5OA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2020-09-30T17:50:07Z","updated_at":"2020-09-30T17:50:07Z","author_association":"CONTRIBUTOR","body":"I think maybe this is back! https://gradle-enterprise.elastic.co/s/4ivkdingbaqyc","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/701588836","html_url":"https://github.com/elastic/elasticsearch/issues/61541#issuecomment-701588836","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61541","id":701588836,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMTU4ODgzNg==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2020-09-30T19:12:37Z","updated_at":"2020-09-30T19:12:37Z","author_association":"MEMBER","body":"Seems like in this one `WindowsFS` struck again ... I'll look into this in more detail tomorrow, but we should probably just disable it again for this test suite (after making sure that it's the only issue here). ","performed_via_github_app":null}]