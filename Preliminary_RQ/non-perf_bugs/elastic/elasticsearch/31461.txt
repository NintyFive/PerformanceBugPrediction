{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31461","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31461/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31461/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31461/events","html_url":"https://github.com/elastic/elasticsearch/issues/31461","id":334076998,"node_id":"MDU6SXNzdWUzMzQwNzY5OTg=","number":31461,"title":"Add new Script Score Query","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"labels":[{"id":418189364,"node_id":"MDU6TGFiZWw0MTgxODkzNjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Ranking","name":":Search/Ranking","color":"0e8a16","default":false,"description":"Scoring, rescoring, rank evaluation."},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"assignees":[{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-06-20T13:28:50Z","updated_at":"2019-03-28T17:26:39Z","closed_at":"2019-03-28T15:29:30Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Replace Function Score Query with a new Script Score Query that will compute custom score through painless scripting.\r\n\r\n```json\r\nGET /_search\r\n{\r\n    \"query\": {\r\n        \"script_score\" : {\r\n            \"query\": {\r\n                \"match\": { \"message\": \"elasticsearch\" }\r\n            },\r\n            \"script\" : {\r\n              \"source\": \"Math.log(2 + doc['likes'].value)\"\r\n            },\r\n            \"min_score\" : 2\r\n        }\r\n    }\r\n}\r\n```\r\nTasks:\r\n- [x]  Introduce a new Script Score Query \r\n- [x]  Develop documentation and tests for it (partially done)\r\n- [x] Handle missing and multiple values in Script \r\n       -  addressed through #29286 (PR submitted)\r\n- [x]  Introduce a new Script context in the painless\r\n- [x]  Add random score function to the Script context (done in #40186)\r\n       - java's Random method should be sufficient\r\n       - make random function that uses Lucene doc ids\r\n      - ScriptScoreBuilder#doToQuery - investigate if we can dd salt - IndexName/ShardID to context manually\r\n- [x]  Add math functions to the Script context \r\n       - rational and sigmoid functions were added\r\n       - other functions can be implemented through Java's Math module\r\n       - later we will be able to drop \"Math\" prefix in Script context\r\n- [x]  Add decay functions to the Script context \r\n- [x]  Add cosine similarity functions on dense and sparse vector fields\r\n- [ ]  ~~Add normalization functions to the Script context~~\r\n       - will not be implemented as the implementation can be very slow, and values can be normalized through log, rational, sigmoid and other functions\r\n\r\n\r\nrelates to #27588, #30303","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}