[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/310760253","html_url":"https://github.com/elastic/elasticsearch/issues/25385#issuecomment-310760253","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25385","id":310760253,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMDc2MDI1Mw==","user":{"login":"meash-nrel","id":7649432,"node_id":"MDQ6VXNlcjc2NDk0MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/7649432?v=4","gravatar_id":"","url":"https://api.github.com/users/meash-nrel","html_url":"https://github.com/meash-nrel","followers_url":"https://api.github.com/users/meash-nrel/followers","following_url":"https://api.github.com/users/meash-nrel/following{/other_user}","gists_url":"https://api.github.com/users/meash-nrel/gists{/gist_id}","starred_url":"https://api.github.com/users/meash-nrel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meash-nrel/subscriptions","organizations_url":"https://api.github.com/users/meash-nrel/orgs","repos_url":"https://api.github.com/users/meash-nrel/repos","events_url":"https://api.github.com/users/meash-nrel/events{/privacy}","received_events_url":"https://api.github.com/users/meash-nrel/received_events","type":"User","site_admin":false},"created_at":"2017-06-23T20:04:07Z","updated_at":"2017-06-23T20:04:07Z","author_association":"NONE","body":"For now i have worked around this issue in the init.d file, with this line right before the end of start() function:\r\n\r\n`sleep 10 && pgrep -f $prog | sed '$!d' > $pidfile`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/310763351","html_url":"https://github.com/elastic/elasticsearch/issues/25385#issuecomment-310763351","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25385","id":310763351,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMDc2MzM1MQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-06-23T20:19:03Z","updated_at":"2017-06-23T20:19:03Z","author_association":"CONTRIBUTOR","body":"I just tested in a fresh VM and it wrote the pidfile just fine. I didn't try and make a 1.7.6 node running in opt.\r\n\r\nI wonder if you got anything in the logs when the 5.6.1 node started up that might hint what is up.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/310813001","html_url":"https://github.com/elastic/elasticsearch/issues/25385#issuecomment-310813001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25385","id":310813001,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMDgxMzAwMQ==","user":{"login":"meash-nrel","id":7649432,"node_id":"MDQ6VXNlcjc2NDk0MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/7649432?v=4","gravatar_id":"","url":"https://api.github.com/users/meash-nrel","html_url":"https://github.com/meash-nrel","followers_url":"https://api.github.com/users/meash-nrel/followers","following_url":"https://api.github.com/users/meash-nrel/following{/other_user}","gists_url":"https://api.github.com/users/meash-nrel/gists{/gist_id}","starred_url":"https://api.github.com/users/meash-nrel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meash-nrel/subscriptions","organizations_url":"https://api.github.com/users/meash-nrel/orgs","repos_url":"https://api.github.com/users/meash-nrel/repos","events_url":"https://api.github.com/users/meash-nrel/events{/privacy}","received_events_url":"https://api.github.com/users/meash-nrel/received_events","type":"User","site_admin":false},"created_at":"2017-06-24T04:22:05Z","updated_at":"2017-06-24T04:22:05Z","author_association":"NONE","body":"Nothing at all unusual in the log file starting up - bootstrap check ok and node starts as normal.\r\n\r\nSome odd behavior - On a whim, I moved PID_DIR to CONF_DIR in /etc/init.d/elasticsearch.  I started the service in init.d and it worked as intended (wrote the pid) -- but only the one time.  I stopped the service & started it again through _service_ calls, changing nothing in init.d, and it failed on the subsequent (and every other) attempt -- did not write the pid.  Happened with or without me removing the 0-byte pid file that init.d creates.\r\n\r\nCan you try repeatedly calling _service elasticsearch start_ and _stop_?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/310833180","html_url":"https://github.com/elastic/elasticsearch/issues/25385#issuecomment-310833180","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25385","id":310833180,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMDgzMzE4MA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-06-24T11:29:05Z","updated_at":"2017-06-24T11:29:05Z","author_association":"MEMBER","body":"This does not reproduce for me, even after repeatedly calling `service elasticsearch start` and `service elasticsearch stop`\r\n\r\n> however */bin/elasticsearch* is never writing the process id to that provided pidfile\r\n\r\nIt's not the startup script that writes the PID file, it's Elasticsearch itself. And if Elasticsearch fails to write the PID file, we abort startup. Is something in your environment killing this file after it's written?\r\n\r\nYou can `strace` startup to see the write:\r\n\r\n```bash\r\n$ strace -e open,write -f bin/elasticsearch -p /tmp/es.pid\r\n[pid 13243] open(\"/tmp/es.pid\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 45\r\n[pid 13243] write(45, \"13205\", 5)       = 5\r\n```\r\n\r\nAgain, if *any* portion of writing this file fails, we abort startup. So if your process is starting successfully (are you sure that it is?) then this PID file is correctly being written. If it's not there and the process is running, some external force on your system is removing it.\r\n\r\nI'm closing this as not a bug. If you need additional help debugging, please ask on the [forum](https://discuss.elastic.co), we reserve GitHub for verified bug reports and feature requests. I'm happy to reopen this is a bug is verified here.","performed_via_github_app":null}]