{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9823","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9823/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9823/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9823/events","html_url":"https://github.com/elastic/elasticsearch/issues/9823","id":58606536,"node_id":"MDU6SXNzdWU1ODYwNjUzNg==","number":9823,"title":"Aggs: breadth_first does not work on several levels","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2015-02-23T16:05:02Z","updated_at":"2015-04-09T10:09:48Z","closed_at":"2015-04-09T10:09:48Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Probably introduced in #9544 since I can reproduce the issue on master but not 1.x. The following recreation generates an error: `Deferred collectors cannot be collected directly. They must be collected through the recording wrapper`.\n\n```\nDELETE test\n\nPUT test\n{\n  \"mappings\": {\n    \"test\": {\n      \"properties\": {\n        \"a\": {\n          \"type\": \"string\",\n          \"index\": \"no\",\n          \"doc_values\": \"yes\"\n        },\n        \"b\": {\n          \"type\": \"string\",\n          \"index\": \"no\",\n          \"doc_values\": \"yes\"\n        },\n        \"c\": {\n          \"type\": \"string\",\n          \"index\": \"no\",\n          \"doc_values\": \"yes\"\n        }\n      }\n    }\n  }\n}\n\nPUT test/test/1\n{\n  \"a\": \"foo\",\n  \"b\": \"bar\",\n  \"c\": \"baz\"\n}\n\nGET test/_search\n{\n  \"aggs\": {\n    \"a_terms\": {\n      \"terms\": {\n        \"field\": \"a\",\n        \"collect_mode\": \"breadth_first\"\n      },\n      \"aggs\": {\n        \"b_terms\": {\n          \"terms\": {\n            \"field\": \"b\",\n            \"collect_mode\": \"breadth_first\"\n          },\n          \"aggs\": {\n            \"c_terms\": {\n              \"terms\": {\n                \"field\": \"c\"\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}