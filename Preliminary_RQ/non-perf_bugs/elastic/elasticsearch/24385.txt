{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24385","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24385/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24385/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24385/events","html_url":"https://github.com/elastic/elasticsearch/issues/24385","id":225008935,"node_id":"MDU6SXNzdWUyMjUwMDg5MzU=","number":24385,"title":"not able to fetch 2 level nested data in elasticsearch","user":{"login":"abhishek5678","id":27953347,"node_id":"MDQ6VXNlcjI3OTUzMzQ3","avatar_url":"https://avatars1.githubusercontent.com/u/27953347?v=4","gravatar_id":"","url":"https://api.github.com/users/abhishek5678","html_url":"https://github.com/abhishek5678","followers_url":"https://api.github.com/users/abhishek5678/followers","following_url":"https://api.github.com/users/abhishek5678/following{/other_user}","gists_url":"https://api.github.com/users/abhishek5678/gists{/gist_id}","starred_url":"https://api.github.com/users/abhishek5678/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abhishek5678/subscriptions","organizations_url":"https://api.github.com/users/abhishek5678/orgs","repos_url":"https://api.github.com/users/abhishek5678/repos","events_url":"https://api.github.com/users/abhishek5678/events{/privacy}","received_events_url":"https://api.github.com/users/abhishek5678/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-04-28T08:08:00Z","updated_at":"2017-04-28T10:14:28Z","closed_at":"2017-04-28T10:04:07Z","author_association":"NONE","active_lock_reason":null,"body":"@martijnvg\r\nI am also running the same nested example but it's not working.In this data when i am trying with one level nested data then it's working fine but when i am adding one more nested data then it's not working if anybody will be knows about that then please reply me.I am sending my document data and mapping file also.\r\n\r\nPUT /icd10_codes\r\n{\r\n  \"mappings\": {\r\n    \"doc\": { \r\n      \"properties\": {\r\n        \"name\":            { \"type\": \"string\" },\r\n        \"depth\":           {\"type\":\"long\"},\r\n        \"children\": { \r\n          \"type\":             \"nested\",\r\n          \"properties\": {\r\n            \"name\":       { \"type\": \"string\" },\r\n            \"depth\":          { \"type\": \"long\"   },\r\n            \"children\":   { \r\n              \"type\":         \"nested\",\r\n              \"properties\": {\r\n                \"code\":     { \"type\": \"string\" },\r\n                \"name\":    { \"type\": \"string\" },\r\n                \"depth\":     { \"type\": \"long\" }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n}\r\n}\r\n\r\n\r\n\r\n\r\nPOST /icd10_codes/doc/1\r\n{\r\n    \"name\": \"Diseases of the blood and blood-forming organs and certain disorders involving the immune mechanism (D50-D89)\",\r\n    \"depth\": 1,\r\n    \"children\": [{\r\n\t\t\"name\": \"Nutritional anemias (D50-D53)\",\r\n\t\t\"depth\": 2,\r\n\t\t\t\"children\": [{\r\n\t\t\t\t\"code\": \"D50.0\",\r\n\t\t\t\t\"name\": \"Iron deficiency anemia secondary to blood loss (chronic)\",\r\n\t\t\t\t\"depth\": 4\r\n\t\t\t}, {\r\n\t\t\t\t\"code\": \"D50.1\",\r\n\t\t\t\t\"name\": \"Sideropenic dysphagia\",\r\n\t\t\t\t\"depth\": 4\r\n\t\t\t}, {\r\n\t\t\t\t\"code\": \"D50.8\",\r\n\t\t\t\t\"name\": \"Other iron deficiency anemias\",\r\n\t\t\t\t\"depth\": 4\r\n\t\t\t}, {\r\n\t\t\t\t\"code\": \"D50.9\",\r\n\t\t\t\t\"name\": \"Iron deficiency anemia, unspecified\",\r\n\t\t\t\t\"depth\": 4\r\n\t\t\t}]\r\n\t}]\r\n}\r\n\r\nplease tell me what is the query i am applying here.i applied the query like this:\r\nGET /icd10_codes/doc/_search?_source=false\r\n{\r\n  \"query\": {\r\n    \"nested\": {\r\n      \"path\": \"children\",\r\n      \"query\": {\r\n        \"bool\": {\r\n          \"must\": [\r\n            {\r\n              \"match\": {\r\n                \"children.name\": \"Nutritional anemias (D50-D53)\"\r\n              }\r\n            },\r\n            {\r\n              \"nested\": {\r\n                \"path\": \"children.children\",\r\n                \"query\": {\r\n                  \"match\": {\r\n                    \"children.children.name\": \"Sideropenic dysphagia\"\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"inner_hits\": {\r\n    \"kids\": {\r\n      \"path\": {\r\n        \"children\": {\r\n          \"query\": {\r\n            \"match\": {\r\n              \"children.name\": \"Nutritional anemias (D50-D53)\"\r\n            }\r\n          },\r\n          \"inner_hits\": {\r\n            \"grand_kids\": {\r\n              \"path\": {\r\n                \"children.children\": {\r\n                  \"query\": {\r\n                    \"match\": {\r\n                      \"children.children.name\": \"Sideropenic dysphagia\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}