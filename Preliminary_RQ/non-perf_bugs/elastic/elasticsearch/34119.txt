{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34119","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34119/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34119/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34119/events","html_url":"https://github.com/elastic/elasticsearch/issues/34119","id":364569844,"node_id":"MDU6SXNzdWUzNjQ1Njk4NDQ=","number":34119,"title":"[HLRC] GetPipelineResponse.isFound() is useless","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-09-27T17:05:32Z","updated_at":"2018-10-06T15:00:13Z","closed_at":"2018-10-06T14:25:16Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.4.1\r\n\r\nI wanted to test the existence of an ingest pipeline with:\r\n\r\n```java\r\nreturn client.ingest().getPipeline(new GetPipelineRequest(pipelineName), RequestOptions.DEFAULT).isFound();\r\n```\r\n\r\nThis sadly does not work when the pipeline does not exist as an `ElasticsearchStatusException` is thrown instead:\r\n\r\n```\r\nElasticsearchStatusException[Unable to parse response body\r\n]; nested: ResponseException[method [GET], host [http://localhost:9200], URI [/_ingest/pipeline/fscrawler_elasticsearch_client_i_t_test_pipeline_foo?master_timeout=30s], status line [HTTP/1.1 404 Not Found]\r\n{}]; nested: ResponseException[method [GET], host [http://localhost:9200], URI [/_ingest/pipeline/fscrawler_elasticsearch_client_i_t_test_pipeline_foo?master_timeout=30s], status line [HTTP/1.1 404 Not Found]\r\n{}];\r\n\tat __randomizedtesting.SeedInfo.seed([15212568BCF52185:5EB9DA33ECB6D90F]:0)\r\n\tat org.elasticsearch.client.RestHighLevelClient.parseResponseException(RestHighLevelClient.java:1386)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1269)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1231)\r\n\tat org.elasticsearch.client.IngestClient.getPipeline(IngestClient.java:85)\r\n\tat fr.pilato.elasticsearch.crawler.fs.client.v6.ElasticsearchClientV6.isExistingPipeline(ElasticsearchClientV6.java:231)\r\n\tat fr.pilato.elasticsearch.crawler.fs.test.integration.ElasticsearchClientIT.testPipeline(ElasticsearchClientIT.java:148)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1737)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:934)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:970)\r\n\tat org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:943)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:829)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:879)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:890)\r\n\tat org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\tSuppressed: java.lang.IllegalStateException: Failed to parse elasticsearch status exception: no exception was found\r\n\t\tat org.elasticsearch.rest.BytesRestResponse.errorFromXContent(BytesRestResponse.java:174)\r\n\t\tat org.elasticsearch.client.RestHighLevelClient.parseEntity(RestHighLevelClient.java:1406)\r\n\t\tat org.elasticsearch.client.RestHighLevelClient.parseResponseException(RestHighLevelClient.java:1382)\r\n\t\t... 25 more\r\nCaused by: org.elasticsearch.client.ResponseException: method [GET], host [http://localhost:9200], URI [/_ingest/pipeline/fscrawler_elasticsearch_client_i_t_test_pipeline_foo?master_timeout=30s], status line [HTTP/1.1 404 Not Found]\r\n{}\r\n\tat org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:920)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:227)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1256)\r\n\t... 24 more\r\nCaused by: org.elasticsearch.client.ResponseException: method [GET], host [http://localhost:9200], URI [/_ingest/pipeline/fscrawler_elasticsearch_client_i_t_test_pipeline_foo?master_timeout=30s], status line [HTTP/1.1 404 Not Found]\r\n{}\r\n\tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:540)\r\n\tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:529)\r\n\tat org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n\tat org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n\tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n\tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n\tat org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n\tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n\tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n\tat org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n\tat org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n\tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n\tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n\tat org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n\tat org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n\tat org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n\t... 1 more\r\n```\r\n\r\nTo work around this, I need to write:\r\n\r\n```java\r\n        try {\r\n            return client.ingest().getPipeline(new GetPipelineRequest(pipelineName), RequestOptions.DEFAULT).isFound();\r\n        } catch (ElasticsearchStatusException e) {\r\n            if (e.status().getStatus() == 404) {\r\n                return false;\r\n            }\r\n            throw new IOException(e);\r\n        }\r\n```\r\n\r\nIf this is the expected behavior, may be we should document it in the REST documentation?","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}