{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633/events","html_url":"https://github.com/elastic/elasticsearch/issues/2633","id":10774280,"node_id":"MDU6SXNzdWUxMDc3NDI4MA==","number":2633,"title":"NullPointerException failed to dynamically refresh the mapping in cluster_state from shard","user":{"login":"Filirom1","id":295554,"node_id":"MDQ6VXNlcjI5NTU1NA==","avatar_url":"https://avatars1.githubusercontent.com/u/295554?v=4","gravatar_id":"","url":"https://api.github.com/users/Filirom1","html_url":"https://github.com/Filirom1","followers_url":"https://api.github.com/users/Filirom1/followers","following_url":"https://api.github.com/users/Filirom1/following{/other_user}","gists_url":"https://api.github.com/users/Filirom1/gists{/gist_id}","starred_url":"https://api.github.com/users/Filirom1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Filirom1/subscriptions","organizations_url":"https://api.github.com/users/Filirom1/orgs","repos_url":"https://api.github.com/users/Filirom1/repos","events_url":"https://api.github.com/users/Filirom1/events{/privacy}","received_events_url":"https://api.github.com/users/Filirom1/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2013-02-08T10:29:30Z","updated_at":"2013-11-08T07:05:47Z","closed_at":"2013-08-09T12:26:34Z","author_association":"NONE","active_lock_reason":null,"body":"For a maintenance operation we disabled allocation and restart one node.\n\n```\n$ curl -XPUT localhost:9023/_cluster/settings -d '{\"transient\":{\"cluster.routing.allocation.disable_allocation\":\"true\"}}\n# stop the node tpsmdt03s\n# start the node tpsmdt03s\n$ curl -XPUT localhost:9023/_cluster/settings -d '{\"transient\": \"cluster.routing.allocation.disable_allocation\":\"false\"}}\n```\n\nUnfortunately, something went wrong with ES: \n\n```\n[2012-11-28 11:02:02,324][INFO ][cluster.routing.allocation.decider] [tpsmdt01s] updating [cluster.routing.allocation.disable_allocation] from [false] to [true]\n[2012-11-28 11:08:13,170][INFO ][discovery.zen            ] [tpsmdt01s] master_left [[tpsmdt03s][6Sd72NOiTOayO8nPtlH9dg][inet[/10.26.165.12:9027]]], reason [transport disconnected (with verified connect)]\n[2012-11-28 11:08:13,177][INFO ][cluster.service          ] [tpsmdt01s] master {new [tpsmdt01s][JIjtYHpkQBa8_GnvcLM4Nw][inet[/10.26.165.10:9027]], previous [tpsmdt03s][6Sd72NOiTOayO8nPtlH9dg][inet[/10.26.165.12:9027]]}, removed {[tpsmdt03s][6Sd72NOiTOayO8nPtlH9dg][inet[/10.26.165.12:9027]],}, reason: zen-disco-master_failed ([tpsmdt03s][6Sd72NOiTOayO8nPtlH9dg][inet[/10.26.165.12:9027]])\n...\n[2012-11-28 11:10:02,449][INFO ][cluster.metadata         ] [tpsmdt01s] [4f072ea3a623374256000001] update_mapping [50b5e2f946b88e97370000e5] (dynamic)\n[2012-11-28 11:17:12,867][INFO ][cluster.service          ] [tpsmdt01s] added {[tpsmdt03s][m8ckMTZlQ1Kuvd8P7RJtfg][inet[/10.26.165.12:9027]],}, reason: zen-disco-receive(join from node[[tpsmdt03s][m8ckMTZlQ1Kuvd8P7RJtfg][inet[/10.26.165.12:9027]]])\n[2012-11-28 11:18:23,379][INFO ][cluster.routing.allocation.decider] [tpsmdt01s] updating [cluster.routing.allocation.disable_allocation] from [true] to [false]\n...\n2012-11-28 14:40:02,615][INFO ][cluster.metadata         ] [tpsmdt01s] [4f072ea3a623374256000001] update_mapping [50b6143246b88e9737000172] (dynamic)\n[2012-11-28 14:40:04,885][INFO ][cluster.metadata         ] [tpsmdt01s] [[4f072ea3a623374256000001]] remove_mapping [50b6143246b88e9737000172]\n[2012-11-28 14:45:02,056][INFO ][cluster.metadata         ] [tpsmdt01s] \n...\n[4f072ea3a623374256000001] update_mapping [50b6155d46b88e9737000185] (dynamic)\n[2012-11-28 14:45:04,359][INFO ][cluster.metadata         ] [tpsmdt01s] [[4f072ea3a623374256000001]] remove_mapping [50b6155d46b88e9737000185]\n[2012-11-28 14:45:04,482][WARN ][cluster.metadata         ] [tpsmdt01s] failed to dynamically refresh the mapping in cluster_state from shard\njava.lang.NullPointerException\n        at org.elasticsearch.cluster.metadata.MetaDataMappingService$1.execute(MetaDataMappingService.java:130)\n        at org.elasticsearch.cluster.service.InternalClusterService$2.run(InternalClusterService.java:208)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\n```\n\nAnd now, I have a lot of WARN\n\n```\n[2013-02-08 10:45:04,324][INFO ][cluster.metadata         ] [tpsmdt01s] [[4f072ea3a623374256000001]] remove_mapping [5114c91de5c0e0950f0000d2]\n[2013-02-08 10:45:04,459][INFO ][cluster.metadata         ] [tpsmdt01s] [[4f072ea3a623374256000001]] remove_mapping [5114c91d511a3418550000d4]\n[2013-02-08 10:45:06,599][WARN ][cluster.metadata         ] [tpsmdt01s] failed to dynamically refresh the mapping in cluster_state from shard\njava.lang.NullPointerException\n[2013-02-08 10:45:06,964][WARN ][cluster.metadata         ] [tpsmdt01s] failed to dynamically refresh the mapping in cluster_state from shard\njava.lang.NullPointerException\n```\n\nWhen I say a lot, I mean it ;)\n\n```\n$ grep 'failed to dynamically refresh the mapping in cluster_state from shard' search-0.19* | wc -l\n58051\n```\n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}