{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/55385","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55385/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55385/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55385/events","html_url":"https://github.com/elastic/elasticsearch/issues/55385","id":601906715,"node_id":"MDU6SXNzdWU2MDE5MDY3MTU=","number":55385,"title":"Elasticsearch container indices are not sync after docker stack deploy","user":{"login":"yuchen9459","id":8820341,"node_id":"MDQ6VXNlcjg4MjAzNDE=","avatar_url":"https://avatars3.githubusercontent.com/u/8820341?v=4","gravatar_id":"","url":"https://api.github.com/users/yuchen9459","html_url":"https://github.com/yuchen9459","followers_url":"https://api.github.com/users/yuchen9459/followers","following_url":"https://api.github.com/users/yuchen9459/following{/other_user}","gists_url":"https://api.github.com/users/yuchen9459/gists{/gist_id}","starred_url":"https://api.github.com/users/yuchen9459/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yuchen9459/subscriptions","organizations_url":"https://api.github.com/users/yuchen9459/orgs","repos_url":"https://api.github.com/users/yuchen9459/repos","events_url":"https://api.github.com/users/yuchen9459/events{/privacy}","received_events_url":"https://api.github.com/users/yuchen9459/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-04-17T11:28:25Z","updated_at":"2020-04-17T15:57:01Z","closed_at":"2020-04-17T15:57:01Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** : elasticsearch: 7.0.1\r\n\r\n**Kibana version**: kibana:7.0.1\r\n\r\n**Expected behavior**:\r\nThe Elasticsearch and Kibana docker container can be successfully deployed after `docker stack deploy`, and index pattern can be created based on the incoming data.\r\n\r\n**Actual behavior**: \r\nTwo containers are created for the elasticsearch service, and the indices are not sync even though the Elasticsearch indices folder are already mounted from local driver. Therefore, the Kibana dashboard cannot successfully retrieved the correct index from Elasticsearch to create the index pattern.\r\n\r\n\r\n**Steps to reproduce**:\r\n1. `Docker-compose.yml`\r\n```\r\nversion: '3.2'\r\nservices:\r\n  elasticsearch:\r\n    image: elastic/elasticsearch:7.0.1\r\n    networks:\r\n      - elastic\r\n    ports:\r\n      - target: 9200\r\n        published: 9200\r\n        protocol: tcp\r\n        mode: host\r\n    volumes:\r\n      - data_es:/usr/share/elasticsearch/data\r\n    deploy:\r\n      mode: global\r\n      endpoint_mode: dnsrr\r\n    environment:\r\n      # Use single node discovery in order to disable production mode and avoid bootstrap checks\r\n      discovery.type: single-node\r\n\r\n  kibana:\r\n    image: elastic/kibana:7.0.1\r\n    networks:\r\n      - elastic\r\n    ports:\r\n      - 5601:5601\r\n    deploy:\r\n      mode: global\r\n    depends_on:\r\n      - elasticsearch\r\n\r\nvolumes:\r\n  data_es:\r\n    driver: local\r\n\r\nnetworks:\r\n  elastic:\r\n    external: true\r\n\r\n```\r\n2. Run command to start the es-stack:\r\n` docker stack deploy -c docker-compose.yml es-stack`","closed_by":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"performed_via_github_app":null}