[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/573619276","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-573619276","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":573619276,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzYxOTI3Ng==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T11:28:13Z","updated_at":"2020-01-13T11:28:13Z","author_association":"CONTRIBUTOR","body":"I don't think this is the case in more recent versions, but there's not enough detail in this issue to be sure. You've not even shared the whole stack trace, let alone any instructions for reproducing it, and my attempts to reproduce this in a more recent version have all failed. I am closing this. If you can demonstrate that this is still an issue in a more up-to-date version and can provide instructions to help us see the problem too then we can reopen it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/573620026","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-573620026","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":573620026,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzYyMDAyNg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-13T11:30:18Z","updated_at":"2020-01-13T11:30:18Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/Allocation)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640422338","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-640422338","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":640422338,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDQyMjMzOA==","user":{"login":"mohit0193","id":15984024,"node_id":"MDQ6VXNlcjE1OTg0MDI0","avatar_url":"https://avatars2.githubusercontent.com/u/15984024?v=4","gravatar_id":"","url":"https://api.github.com/users/mohit0193","html_url":"https://github.com/mohit0193","followers_url":"https://api.github.com/users/mohit0193/followers","following_url":"https://api.github.com/users/mohit0193/following{/other_user}","gists_url":"https://api.github.com/users/mohit0193/gists{/gist_id}","starred_url":"https://api.github.com/users/mohit0193/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohit0193/subscriptions","organizations_url":"https://api.github.com/users/mohit0193/orgs","repos_url":"https://api.github.com/users/mohit0193/repos","events_url":"https://api.github.com/users/mohit0193/events{/privacy}","received_events_url":"https://api.github.com/users/mohit0193/received_events","type":"User","site_admin":false},"created_at":"2020-06-08T07:32:47Z","updated_at":"2020-06-08T08:43:57Z","author_association":"NONE","body":"### **Problem:** Too much logging of long exception stack traces results in log files getting rotated every few mins\r\n\r\nWe would like to know your early thoughts to fix it.\r\n\r\nPrinting same stack-trace for each shards doesn't seems to be beneficial so are thinking of using sampling based logging. And on other thought since, this stack-trace is not much useful for debugging so we can trim it also\r\n\r\nRepro cluster configuration:\r\nES version : 7.7\r\nData nodes = 3\r\nMaster nodes = 3\r\nNumber of shards  = 110950\r\nNumber of primary shards  = 38949\r\nAll shards has data ~10-20 KB\r\n \r\n**Repro Steps:**\r\nEnabled Trace logs in the cluster to see when shard fetching is started\r\nRepeatedly killed one of the data node, so that AsyncFetch enter into exception state\r\n\r\n**Replica**\r\n`[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][762] processing failure FailedNodeException[Failed node [AGjLbt01ShOlykPZjz8_Cw]]; nested: NodeDisconnectedException[[f58fa56a9f0968ad07c38dc9b75ed022][10.212.61.242:9300][internal:cluster/nodes/indices/shard/store[n]] disconnected]; for [shard_store]\r\n[2020-06-04T22:33:36,085][WARN ][o.e.g.G.InternalReplicaShardAllocator] **[c063a0601ff59493187b8174cf1d7674] [testlogidx13][762]: failed to list shard for shard_store on node [AGjLbt01ShOlykPZjz8_Cw]\r\norg.elasticsearch.action.FailedNodeException: Failed node [AGjLbt01ShOlykPZjz8_Cw]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onFailure(TransportNodesAction.java:221) [elasticsearch-7.7.0.jar:7.7.0]**\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$100(TransportNodesAction.java:142) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleException(TransportNodesAction.java:196) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1139) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$8.run(TransportService.java:1001) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:633) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: org.elasticsearch.transport.NodeDisconnectedException: [f58fa56a9f0968ad07c38dc9b75ed022][10.212.61.242:9300][internal:cluster/nodes/indices/shard/store[n]] disconnected\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][762] scheduling reroute for post_response\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][399] processing fetched [shard_store] results\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][399] marking 3wNzT0dRR22Wi9gvk98grg as done for [shard_store], result is [[[{b887cbe25aba74d84a656996812582bd}{3wNzT0dRR22Wi9gvk98grg}{FdlhqFXUQR-5_JdMcNBMEg}{10.212.68.117}{10.212.68.117:9300}{dir}{di_number=0, zone=us-east-1d}][StoreFilesMetaData{, shardId=[testlogidx13][399], metadataSnapshot{size=7, syncId=null}}]]]\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][399] marking MowY2Vj5T4mJ2buZo4k8Wg as done for [shard_store], result is [[[{d4694e2b17768ef86d7a97d68f8d1fc8}{MowY2Vj5T4mJ2buZo4k8Wg}{9GKZz7LmQhaHvf9aCeEfTQ}{10.212.18.205}{10.212.18.205:9300}{dir}{di_number=0, zone=us-east-1a}][StoreFilesMetaData{, shardId=[testlogidx13][399], metadataSnapshot{size=7, syncId=null}}]]]\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][399] processing failure **FailedNodeException[Failed node [AGjLbt01ShOlykPZjz8_Cw]]; nested: NodeDisconnectedException[[f58fa56a9f0968ad07c38dc9b75ed022][10.212.61.242:9300][internal:cluster/nodes/indices/shard/store[n]] disconnected]; for [shard_store]\r\n[2020-06-04T22:33:36,085][WARN ][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][399]: failed to list shard for shard_store on node [AGjLbt01ShOlykPZjz8_Cw]\r\norg.elasticsearch.action.FailedNodeException: Failed node [AGjLbt01ShOlykPZjz8_Cw]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onFailure(TransportNodesAction.java:221) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$100(TransportNodesAction.java:142) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat** org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleException(TransportNodesAction.java:196) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1139) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$8.run(TransportService.java:1001) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:633) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: org.elasticsearch.transport.NodeDisconnectedException: [f58fa56a9f0968ad07c38dc9b75ed022][10.212.61.242:9300][internal:cluster/nodes/indices/shard/store[n]] disconnected\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][399] scheduling reroute for post_response\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][651] processing fetched [shard_store] results\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][651] marking 3wNzT0dRR22Wi9gvk98grg as done for [shard_store], result is [[[{b887cbe25aba74d84a656996812582bd}{3wNzT0dRR22Wi9gvk98grg}{FdlhqFXUQR-5_JdMcNBMEg}{10.212.68.117}{10.212.68.117:9300}{dir}{di_number=0, zone=us-east-1d}][StoreFilesMetaData{, shardId=[testlogidx13][651], metadataSnapshot{size=7, syncId=null}}]]]\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][651] marking MowY2Vj5T4mJ2buZo4k8Wg as done for [shard_store], result is [[[{d4694e2b17768ef86d7a97d68f8d1fc8}{MowY2Vj5T4mJ2buZo4k8Wg}{9GKZz7LmQhaHvf9aCeEfTQ}{10.212.18.205}{10.212.18.205:9300}{dir}{di_number=0, zone=us-east-1a}][StoreFilesMetaData{, shardId=[testlogidx13][651], metadataSnapshot{size=7, syncId=null}}]]]\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][651] processing failure FailedNodeException[Failed node [AGjLbt01ShOlykPZjz8_Cw]]; nested: NodeDisconnectedException[[f58fa56a9f0968ad07c38dc9b75ed022][10.212.61.242:9300][internal:cluster/nodes/indices/shard/store[n]] disconnected]; for [shard_store]\r\n[2020-06-04T22:33:36,085][WARN ][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][651]: failed to list shard for shard_store on node [AGjLbt01ShOlykPZjz8_Cw]\r\norg.elasticsearch.action.FailedNodeException: Failed node [AGjLbt01ShOlykPZjz8_Cw]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onFailure(TransportNodesAction.java:221) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$100(TransportNodesAction.java:142) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleException(TransportNodesAction.java:196) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1139) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$8.run(TransportService.java:1001) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:633) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: org.elasticsearch.transport.NodeDisconnectedException: [f58fa56a9f0968ad07c38dc9b75ed022][10.212.61.242:9300][internal:cluster/nodes/indices/shard/store[n]] disconnected\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][651] scheduling reroute for post_response\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][957] processing fetched [shard_store] results\r\n[2020-06-04T22:33:36,085][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][957] marking 3wNzT0dRR22Wi9gvk98grg as done for [shard_store], result is [[[{b887cbe25aba74d84a656996812582bd}{3wNzT0dRR22Wi9gvk98grg}{FdlhqFXUQR-5_JdMcNBMEg}{10.212.68.117}{10.212.68.117:9300}{dir}{di_number=0, zone=us-east-1d}][StoreFilesMetaData{, shardId=[testlogidx13][957], metadataSnapshot{size=7, syncId=null}}]]]\r\n[2020-06-04T22:33:36,086][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][957] marking MowY2Vj5T4mJ2buZo4k8Wg as done for [shard_store], result is **[[[{d4694e2b17768ef86d7a97d68f8d1fc8}{MowY2Vj5T4mJ2buZo4k8Wg}{9GKZz7LmQhaHvf9aCeEfTQ}{10.212.18.205}{10.212.18.205:9300}{dir}{di_number=0, zone=us-east-1a}][StoreFilesMetaData{, shardId=[testlogidx13][957], metadataSnapshot{size=7, syncId=null}}]]]\r\n[2020-06-04T22:33:36,086][TRACE][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][957] processing failure FailedNodeException[Failed node [AGjLbt01ShOlykPZjz8_Cw]]; nested: NodeDisconnectedException[[f58fa56a9f0968ad07c38dc9b75ed022][10.212.61.242:9300][internal:cluster/nodes/indices/shard/store[n]] disconnected]; for [shard_store]\r\n[2020-06-04T22:33:36,086][WARN ][o.e.g.G.InternalReplicaShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx13][957]: failed to list shard for shard_store on node [AGjLbt01ShOlykPZjz8_Cw]\r\norg.elasticsearch.action.FailedNodeException: Failed node [AGjLbt01ShOlykPZjz8_Cw]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onFailure(TransportNodesAction.java:221) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$100(TransportNodesAction.java:142) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat** org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleException(TransportNodesAction.java:196) [elasticsearch-7.7.0.jar:7.7.0]`\r\n\r\n-------------------------------------------------\r\n\r\nshard_started Logs\r\n`\r\n[2020-06-04T21:03:39,921][WARN ][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx6][526]: failed to list shard for shard_started on node [MowY2Vj5T4mJ2buZo4k8Wg]\r\n**org.elasticsearch.action.FailedNodeException: Failed node [MowY2Vj5T4mJ2buZo4k8Wg]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onFailure(TransportNodesAction.java:221) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$100(TransportNodesAction.java:142) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat** org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleException(TransportNodesAction.java:196) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1139) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$8.run(TransportService.java:1001) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:633) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: org.elasticsearch.transport.NodeDisconnectedException: [d4694e2b17768ef86d7a97d68f8d1fc8][10.212.18.205:9300][internal:gateway/local/started_shards[n]] disconnected\r\n[2020-06-04T21:03:39,921][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [[testlogidx9][118], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.064Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], allocation_status[fetching_shard_data]]] on node [{b887cbe25aba74d84a656996812582bd}{3wNzT0dRR22Wi9gvk98grg}{60eqbTeUSZuResWx4CUVsw}{10.212.68.117}{10.212.68.117:9300}{dir}{di_number=0, zone=us-east-1d}] has no shard state information\r\n[2020-06-04T21:03:39,921][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx6][526] scheduling reroute for post_response\r\n[2020-06-04T21:03:39,921][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx9][118], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.064Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], allocation_status[fetching_shard_data]] candidates for allocation: d4694e2b17768ef86d7a97d68f8d1fc8\r\n[2020-06-04T21:03:39,921][DEBUG][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [[testlogidx9/mLDd6VhnShOibalk-FYPbw]][118]: found 1 allocation candidates of [testlogidx9][118], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.064Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], allocation_status[fetching_shard_data]] based on allocation ids: [[JWcDy93qS3ivXat8RL5TCg]]\r\n[2020-06-04T21:03:39,921][DEBUG][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [[testlogidx9/mLDd6VhnShOibalk-FYPbw]][118]: throttling allocation [[testlogidx9][118], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.064Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], **allocation_status[fetching_shard_data]]] to [[org.elasticsearch.gateway.PrimaryShardAllocator$DecidedNode@76c75d37]] on primary allocation\r\n[2020-06-04T21:03:39,921][DEBUG][o.e.g.TransportNodesListGatewayStartedShards] [c063a0601ff59493187b8174cf1d7674] #[org.elasticsearch.transport.NodeDisconnectedException]#failed to execute on node [MowY2Vj5T4mJ2buZo4k8Wg]**\r\norg.elasticsearch.transport.NodeDisconnectedException: [d4694e2b17768ef86d7a97d68f8d1fc8][10.212.18.205:9300][internal:gateway/local/started_shards[n]] disconnected\r\n[2020-06-04T21:03:39,921][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx6][215] processing fetched [shard_started] results\r\n[2020-06-04T21:03:39,921][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx6][215] marking AGjLbt01ShOlykPZjz8_Cw as done for [shard_started], result is [NodeGatewayStartedShards[allocationId=OsnACVHOQl2v5BuzX6Pnhw,primary=true]]\r\n[2020-06-04T21:03:39,921][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [[testlogidx9][630], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.065Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], allocation_status[fetching_shard_data]]] on node [{f58fa56a9f0968ad07c38dc9b75ed022}{AGjLbt01ShOlykPZjz8_Cw}{T8BAdEqkQtyPUYvi-xUD1w}{10.212.61.242}{10.212.61.242:9300}{dir}{di_number=0, zone=us-east-1c}] has no shard state information\r\n[2020-06-04T21:03:39,921][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx6][215] processing failure FailedNodeException[Failed node [MowY2Vj5T4mJ2buZo4k8Wg]]; nested: NodeDisconnectedException[[d4694e2b17768ef86d7a97d68f8d1fc8][10.212.18.205:9300][internal:gateway/local/started_shards[n]] disconnected]; for [shard_started]\r\n[2020-06-04T21:03:39,922][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [[testlogidx9][630], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.065Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], allocation_status[fetching_shard_data]]] on node [{d4694e2b17768ef86d7a97d68f8d1fc8}{MowY2Vj5T4mJ2buZo4k8Wg}{yw4pWVNgRZ-glnetZOldgA}{10.212.18.205}{10.212.18.205:9300}{dir}{di_number=0, zone=us-east-1a}] has allocation id [otViUmS2TpyZ_kJcyllZKA]\r\n[2020-06-04T21:03:39,922][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [[testlogidx9][630], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.065Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], allocation_status[fetching_shard_data]]] on node [{b887cbe25aba74d84a656996812582bd}{3wNzT0dRR22Wi9gvk98grg}{60eqbTeUSZuResWx4CUVsw}{10.212.68.117}{10.212.68.117:9300}{dir}{di_number=0, zone=us-east-1d}] has no shard state information\r\n[2020-06-04T21:03:39,922][TRACE][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx9][630], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.065Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], allocation_status[fetching_shard_data]] candidates for allocation: d4694e2b17768ef86d7a97d68f8d1fc8\r\n[2020-06-04T21:03:39,922][DEBUG][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [[testlogidx9/mLDd6VhnShOibalk-FYPbw]][630]: found 1 allocation candidates of [testlogidx9][630], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2020-06-05T04:01:02.065Z], delayed=false, details[node_left [MowY2Vj5T4mJ2buZo4k8Wg]], allocation_status[fetching_shard_data]] based on allocation ids: [[otViUmS2TpyZ_kJcyllZKA]]\r\n**[2020-06-04T21:03:39,922][WARN ][o.e.g.G.InternalPrimaryShardAllocator] [c063a0601ff59493187b8174cf1d7674] [testlogidx6][215]: failed to list shard for shard_started on node [MowY2Vj5T4mJ2buZo4k8Wg]\r\norg.elasticsearch.action.FailedNodeException: Failed node [MowY2Vj5T4mJ2buZo4k8Wg]\r\n\tat org.elasticsear**ch.action.support.nodes.TransportNodesAction$AsyncAction.onFailure(TransportNodesAction.java:221) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$100(TransportNodesAction.java:142) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleException(TransportNodesAction.java:196) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1139) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.transport.TransportService$8.run(TransportService.java:1001) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:633) [elasticsearch-7.7.0.jar:7.7.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]`\r\n@DaveCTurner ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640473114","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-640473114","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":640473114,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDQ3MzExNA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2020-06-08T09:05:53Z","updated_at":"2020-06-08T09:05:53Z","author_association":"CONTRIBUTOR","body":"@mohit0193 I agree that a stack trace on a `NodeDisconnectedException` is not helpful here. Since this looks unrelated to the original issue (`NodeDisconnectedException` vs `CorruptIndexException`) would you open a new issue instead?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640479467","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-640479467","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":640479467,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDQ3OTQ2Nw==","user":{"login":"Bukhtawar","id":12809319,"node_id":"MDQ6VXNlcjEyODA5MzE5","avatar_url":"https://avatars0.githubusercontent.com/u/12809319?v=4","gravatar_id":"","url":"https://api.github.com/users/Bukhtawar","html_url":"https://github.com/Bukhtawar","followers_url":"https://api.github.com/users/Bukhtawar/followers","following_url":"https://api.github.com/users/Bukhtawar/following{/other_user}","gists_url":"https://api.github.com/users/Bukhtawar/gists{/gist_id}","starred_url":"https://api.github.com/users/Bukhtawar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bukhtawar/subscriptions","organizations_url":"https://api.github.com/users/Bukhtawar/orgs","repos_url":"https://api.github.com/users/Bukhtawar/repos","events_url":"https://api.github.com/users/Bukhtawar/events{/privacy}","received_events_url":"https://api.github.com/users/Bukhtawar/received_events","type":"User","site_admin":false},"created_at":"2020-06-08T09:15:40Z","updated_at":"2020-06-08T09:18:58Z","author_association":"CONTRIBUTOR","body":">When a node goes bad due to hardware failure(checksum errors) or network disconnections\r\n\r\nThanks @DaveCTurner if you read the first line its related. I'm fine with a new issue as well\r\n\r\n\r\nThe verbose logging is anyways the problem either case and the issue is about that, howsoever it manifests.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640528946","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-640528946","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":640528946,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDUyODk0Ng==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2020-06-08T10:52:20Z","updated_at":"2020-06-08T10:52:20Z","author_association":"CONTRIBUTOR","body":"Yeah the outer exception is the same, but the root cause is a `CorruptIndexException` which we don't see happening often enough to cause problems with log volume. `NodeDisconnectedException` is another matter.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640533482","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-640533482","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":640533482,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDUzMzQ4Mg==","user":{"login":"Bukhtawar","id":12809319,"node_id":"MDQ6VXNlcjEyODA5MzE5","avatar_url":"https://avatars0.githubusercontent.com/u/12809319?v=4","gravatar_id":"","url":"https://api.github.com/users/Bukhtawar","html_url":"https://github.com/Bukhtawar","followers_url":"https://api.github.com/users/Bukhtawar/followers","following_url":"https://api.github.com/users/Bukhtawar/following{/other_user}","gists_url":"https://api.github.com/users/Bukhtawar/gists{/gist_id}","starred_url":"https://api.github.com/users/Bukhtawar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bukhtawar/subscriptions","organizations_url":"https://api.github.com/users/Bukhtawar/orgs","repos_url":"https://api.github.com/users/Bukhtawar/repos","events_url":"https://api.github.com/users/Bukhtawar/events{/privacy}","received_events_url":"https://api.github.com/users/Bukhtawar/received_events","type":"User","site_admin":false},"created_at":"2020-06-08T11:02:19Z","updated_at":"2020-06-08T11:02:19Z","author_association":"CONTRIBUTOR","body":"I had seen the same problem on both the cases node disconnections and otherwise but had only the `CorruptIndexException ` at that point in time so couldn't come back. Glad you replied.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640535247","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-640535247","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":640535247,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDUzNTI0Nw==","user":{"login":"mohit0193","id":15984024,"node_id":"MDQ6VXNlcjE1OTg0MDI0","avatar_url":"https://avatars2.githubusercontent.com/u/15984024?v=4","gravatar_id":"","url":"https://api.github.com/users/mohit0193","html_url":"https://github.com/mohit0193","followers_url":"https://api.github.com/users/mohit0193/followers","following_url":"https://api.github.com/users/mohit0193/following{/other_user}","gists_url":"https://api.github.com/users/mohit0193/gists{/gist_id}","starred_url":"https://api.github.com/users/mohit0193/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohit0193/subscriptions","organizations_url":"https://api.github.com/users/mohit0193/orgs","repos_url":"https://api.github.com/users/mohit0193/repos","events_url":"https://api.github.com/users/mohit0193/events{/privacy}","received_events_url":"https://api.github.com/users/mohit0193/received_events","type":"User","site_admin":false},"created_at":"2020-06-08T11:06:23Z","updated_at":"2020-06-08T11:06:23Z","author_association":"NONE","body":"Thanks @DaveCTurner I have already started working on this. I would be interested in picking this up and open PR. I will create a new Github issue. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640540360","html_url":"https://github.com/elastic/elasticsearch/issues/50900#issuecomment-640540360","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50900","id":640540360,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDU0MDM2MA==","user":{"login":"mohit0193","id":15984024,"node_id":"MDQ6VXNlcjE1OTg0MDI0","avatar_url":"https://avatars2.githubusercontent.com/u/15984024?v=4","gravatar_id":"","url":"https://api.github.com/users/mohit0193","html_url":"https://github.com/mohit0193","followers_url":"https://api.github.com/users/mohit0193/followers","following_url":"https://api.github.com/users/mohit0193/following{/other_user}","gists_url":"https://api.github.com/users/mohit0193/gists{/gist_id}","starred_url":"https://api.github.com/users/mohit0193/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohit0193/subscriptions","organizations_url":"https://api.github.com/users/mohit0193/orgs","repos_url":"https://api.github.com/users/mohit0193/repos","events_url":"https://api.github.com/users/mohit0193/events{/privacy}","received_events_url":"https://api.github.com/users/mohit0193/received_events","type":"User","site_admin":false},"created_at":"2020-06-08T11:17:49Z","updated_at":"2020-06-08T11:17:49Z","author_association":"NONE","body":"created new Github issue: https://github.com/elastic/elasticsearch/issues/57804","performed_via_github_app":null}]