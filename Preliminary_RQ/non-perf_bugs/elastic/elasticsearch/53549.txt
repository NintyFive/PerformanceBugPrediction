{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53549","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53549/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53549/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53549/events","html_url":"https://github.com/elastic/elasticsearch/issues/53549","id":580634494,"node_id":"MDU6SXNzdWU1ODA2MzQ0OTQ=","number":53549,"title":"elasticsearch-node fails when parsing persistent tasks","user":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"assignees":[{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-03-13T14:24:20Z","updated_at":"2020-03-24T16:21:40Z","closed_at":"2020-03-24T16:21:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"It seems that elasticsearch-node is failing when parsing ML tasks - this possibly applies to other tasks defined in plugins\r\n\r\n**Elasticsearch version** 7.6\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen running a `elasticsearch-node unsafe-bootstrap` or `elasticsearch-node remove-customs persistent_tasks` an exception is thrown.\r\n```\r\nException in thread \"main\" org.elasticsearch.common.xcontent.XContentParseException: [-1:27033] [persistent_tasks] failed to parse field [tasks]\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:429)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseArray(ObjectParser.java:421)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseSub(ObjectParser.java:453)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parse(ObjectParser.java:284)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parse(ObjectParser.java:246)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.apply(ObjectParser.java:295)\r\n\tat org.elasticsearch.persistent.PersistentTasksCustomMetaData.fromXContent(PersistentTasksCustomMetaData.java:206)\r\n\tat org.elasticsearch.common.xcontent.NamedXContentRegistry$Entry.lambda$new$0(NamedXContentRegistry.java:63)\r\n\tat org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141)\r\n\tat org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:385)\r\n\tat org.elasticsearch.cluster.metadata.MetaData$Builder.fromXContent(MetaData.java:1403)\r\n\tat org.elasticsearch.gateway.PersistedClusterStateService.lambda$loadOnDiskState$1(PersistedClusterStateService.java:385)\r\n\tat org.elasticsearch.gateway.PersistedClusterStateService.consumeFromType(PersistedClusterStateService.java:442)\r\n\tat org.elasticsearch.gateway.PersistedClusterStateService.loadOnDiskState(PersistedClusterStateService.java:383)\r\n\tat org.elasticsearch.gateway.PersistedClusterStateService.loadBestOnDiskState(PersistedClusterStateService.java:331)\r\n\tat org.elasticsearch.cluster.coordination.ElasticsearchNodeCommand.loadTermAndClusterState(ElasticsearchNodeCommand.java:101)\r\n\tat org.elasticsearch.cluster.coordination.RemoveCustomsCommand.processNodePaths(RemoveCustomsCommand.java:68)\r\n\tat org.elasticsearch.cluster.coordination.ElasticsearchNodeCommand.processNodePaths(ElasticsearchNodeCommand.java:120)\r\n\tat org.elasticsearch.cluster.coordination.ElasticsearchNodeCommand.execute(ElasticsearchNodeCommand.java:138)\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125)\r\n\tat org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:91)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125)\r\n\tat org.elasticsearch.cli.Command.main(Command.java:90)\r\n\tat org.elasticsearch.cluster.coordination.NodeToolCli.main(NodeToolCli.java:49)\r\nCaused by: org.elasticsearch.common.xcontent.XContentParseException: [-1:27033] [tasks] failed to parse field [task]\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:429)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseSub(ObjectParser.java:439)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parse(ObjectParser.java:284)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parse(ObjectParser.java:246)\r\n\tat org.elasticsearch.common.xcontent.AbstractObjectParser.lambda$declareObjectArray$7(AbstractObjectParser.java:183)\r\n\tat org.elasticsearch.common.xcontent.AbstractObjectParser.lambda$declareFieldArray$13(AbstractObjectParser.java:211)\r\n\tat org.elasticsearch.common.xcontent.AbstractObjectParser.parseArray(AbstractObjectParser.java:229)\r\n\tat org.elasticsearch.common.xcontent.AbstractObjectParser.lambda$declareFieldArray$14(AbstractObjectParser.java:211)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.lambda$declareField$9(ObjectParser.java:326)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:427)\r\n\t... 24 more\r\nCaused by: org.elasticsearch.common.xcontent.XContentParseException: [-1:27033] [task] failed to parse field [xpack/ml/data_frame/analytics]\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.lambda$declareNamedObjects$11(ObjectParser.java:357)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.lambda$declareNamedObjects$12(ObjectParser.java:369)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:427)\r\n\t... 33 more\r\nCaused by: org.elasticsearch.common.xcontent.XContentParseException: [-1:27033] [named] failed to parse field [params]\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:429)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseSub(ObjectParser.java:439)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parse(ObjectParser.java:284)\r\n\tat org.elasticsearch.persistent.PersistentTasksCustomMetaData.lambda$static$9(PersistentTasksCustomMetaData.java:97)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.lambda$declareNamedObjects$11(ObjectParser.java:355)\r\n\t... 35 more\r\nCaused by: org.elasticsearch.common.xcontent.NamedObjectNotFoundException: unknown named object category [org.elasticsearch.persistent.PersistentTaskParams]\r\n\tat org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:128)\r\n\tat org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:385)\r\n\tat org.elasticsearch.persistent.PersistentTasksCustomMetaData.lambda$static$6(PersistentTasksCustomMetaData.java:94)\r\n\tat org.elasticsearch.common.xcontent.AbstractObjectParser.lambda$declareObject$1(AbstractObjectParser.java:146)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.lambda$declareField$9(ObjectParser.java:326)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:427)\r\n\t... 39 more\r\n```\r\n\r\n\r\n**Steps to reproduce**:\r\nTo Reproduce:\r\n\r\n1. Create and run a ml job on any data it doesn't matter.\r\n2. When the job finishes click on Start job running in real time this will leave the job task in cluster state\r\n3. kill -9 the node. This must be done as a graceful shutdown will close the job orderly and remove the persistent task\r\n4. Now you have a stopped node with clusterstate containing a persistent task.\r\n6. bin/elasticsearch-node remove-customs persistent_tasks\r\n\r\n\r\nrelates https://github.com/elastic/elasticsearch/pull/48390","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}