{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52105","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52105/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52105/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52105/events","html_url":"https://github.com/elastic/elasticsearch/issues/52105","id":562134265,"node_id":"MDU6SXNzdWU1NjIxMzQyNjU=","number":52105,"title":"bulk of thread_pool should also limit memory usage","user":{"login":"kkewwei","id":16730433,"node_id":"MDQ6VXNlcjE2NzMwNDMz","avatar_url":"https://avatars1.githubusercontent.com/u/16730433?v=4","gravatar_id":"","url":"https://api.github.com/users/kkewwei","html_url":"https://github.com/kkewwei","followers_url":"https://api.github.com/users/kkewwei/followers","following_url":"https://api.github.com/users/kkewwei/following{/other_user}","gists_url":"https://api.github.com/users/kkewwei/gists{/gist_id}","starred_url":"https://api.github.com/users/kkewwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kkewwei/subscriptions","organizations_url":"https://api.github.com/users/kkewwei/orgs","repos_url":"https://api.github.com/users/kkewwei/repos","events_url":"https://api.github.com/users/kkewwei/events{/privacy}","received_events_url":"https://api.github.com/users/kkewwei/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-02-09T07:04:12Z","updated_at":"2020-02-09T16:06:16Z","closed_at":"2020-02-09T16:06:16Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**ES_VERSION**: 5.6.8\r\n**JVM version**: java 1.8.0_112\r\n**Description of the problem including actual versus:**\r\nwe know that ES limits bulk by limiting the size of thread pools regardless of memory usage, this is not perfect. sometimes content of bulk is so big that it  causes OOM.\r\n\r\nIn product, we set the bulk of thread_pool is 5000, and there comes a source data, in which average size of every document is 70kb, when the source data is written in batches, memory usage of the some data node will soon reach 90%+, and ES will become unavailable. Even if we use the default value of 200, It can also occur this case.\r\n\r\n**expected versus:**\r\nIf we could add checking memory usage of bulk thread pools, not only the count of bulk thread pools.\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}