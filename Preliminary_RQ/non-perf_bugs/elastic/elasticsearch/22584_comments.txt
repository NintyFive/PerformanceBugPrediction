[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272180144","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272180144","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272180144,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjE4MDE0NA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T14:42:23Z","updated_at":"2017-01-12T14:42:23Z","author_association":"CONTRIBUTOR","body":"That stacktrace looks cut off. If that is how it is logged then we have another problem in addition to whatever you've found with ips. Also look out for #22393.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272192317","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272192317","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272192317,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjE5MjMxNw==","user":{"login":"josephDunne","id":1827457,"node_id":"MDQ6VXNlcjE4Mjc0NTc=","avatar_url":"https://avatars0.githubusercontent.com/u/1827457?v=4","gravatar_id":"","url":"https://api.github.com/users/josephDunne","html_url":"https://github.com/josephDunne","followers_url":"https://api.github.com/users/josephDunne/followers","following_url":"https://api.github.com/users/josephDunne/following{/other_user}","gists_url":"https://api.github.com/users/josephDunne/gists{/gist_id}","starred_url":"https://api.github.com/users/josephDunne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephDunne/subscriptions","organizations_url":"https://api.github.com/users/josephDunne/orgs","repos_url":"https://api.github.com/users/josephDunne/repos","events_url":"https://api.github.com/users/josephDunne/events{/privacy}","received_events_url":"https://api.github.com/users/josephDunne/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T15:26:55Z","updated_at":"2017-01-12T15:26:55Z","author_association":"NONE","body":"That is indeed how it is logged :) if I mess around with the script I abitni can sometimes get a longer stack trace which shows the source of the out of bounds in the UTF8 code","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272192674","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272192674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272192674,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjE5MjY3NA==","user":{"login":"josephDunne","id":1827457,"node_id":"MDQ6VXNlcjE4Mjc0NTc=","avatar_url":"https://avatars0.githubusercontent.com/u/1827457?v=4","gravatar_id":"","url":"https://api.github.com/users/josephDunne","html_url":"https://github.com/josephDunne","followers_url":"https://api.github.com/users/josephDunne/followers","following_url":"https://api.github.com/users/josephDunne/following{/other_user}","gists_url":"https://api.github.com/users/josephDunne/gists{/gist_id}","starred_url":"https://api.github.com/users/josephDunne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephDunne/subscriptions","organizations_url":"https://api.github.com/users/josephDunne/orgs","repos_url":"https://api.github.com/users/josephDunne/repos","events_url":"https://api.github.com/users/josephDunne/events{/privacy}","received_events_url":"https://api.github.com/users/josephDunne/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T15:28:14Z","updated_at":"2017-01-12T15:28:14Z","author_association":"NONE","body":"Funny you should mention #22393 as I had run into the string escape issue and I have seen that ticket. It does not seem to solve this issue","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272194757","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272194757","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272194757,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjE5NDc1Nw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T15:35:42Z","updated_at":"2017-01-12T15:35:42Z","author_association":"CONTRIBUTOR","body":"> That is indeed how it is logged :)\r\n\r\nGreat! We play some tricks with those stacktraces in an effort to make them a bit more useable but it looks like we've gone a bit too far.\r\n\r\n\r\n> Funny you should mention #22393 as I had run into the string escape issue and I have seen that ticket. It does not seem to solve this issue\r\n\r\nYeah. I just meant that you would have to work around that issue in addition to any workaround we find for this one.\r\n\r\nI'll start in on this as soon as I can get finished replying to other github issues.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272201124","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272201124","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272201124,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjIwMTEyNA==","user":{"login":"josephDunne","id":1827457,"node_id":"MDQ6VXNlcjE4Mjc0NTc=","avatar_url":"https://avatars0.githubusercontent.com/u/1827457?v=4","gravatar_id":"","url":"https://api.github.com/users/josephDunne","html_url":"https://github.com/josephDunne","followers_url":"https://api.github.com/users/josephDunne/followers","following_url":"https://api.github.com/users/josephDunne/following{/other_user}","gists_url":"https://api.github.com/users/josephDunne/gists{/gist_id}","starred_url":"https://api.github.com/users/josephDunne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephDunne/subscriptions","organizations_url":"https://api.github.com/users/josephDunne/orgs","repos_url":"https://api.github.com/users/josephDunne/repos","events_url":"https://api.github.com/users/josephDunne/events{/privacy}","received_events_url":"https://api.github.com/users/josephDunne/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T15:56:54Z","updated_at":"2017-01-12T15:56:54Z","author_association":"NONE","body":"thank you @nik9000! My hunch is that there needs to be a specific subclass in `ScriptDocValues` for IP fields. Here is a longer trace:\r\n\r\n```org.elasticsearch.transport.RemoteTransportException: [Z8qG7Y5][127.0.0.1:9300][indices:data/read/search[phase/query+fetch]]\r\nCaused by: org.elasticsearch.script.ScriptException: runtime error\r\n        at org.elasticsearch.painless.ScriptImpl.convertToScriptException(ScriptImpl.java:177) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:124) ~[?:?]\r\n        at org.elasticsearch.search.fetch.subphase.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:52) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:161) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:358) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$9(SearchTransportService.java:291) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_101]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_101]\r\n        at java.lang.Thread.run(Thread.java:745) [?:1.8.0_101]\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 16\r\n        at org.apache.lucene.util.UnicodeUtil.UTF8toUTF16(UnicodeUtil.java:598) ~[lucene-core-6.2.0.jar:6.2.0 764d0f19151dbff6f5fcd9fc4b2682cf934590c5 - mike - 2016-08-20 05:39:36]\r\n        at org.apache.lucene.util.BytesRef.utf8ToString(BytesRef.java:152) ~[lucene-core-6.2.0.jar:6.2.0 764d0f19151dbff6f5fcd9fc4b2682cf934590c5 - mike - 2016-08-20 05:39:36]\r\n        at org.elasticsearch.index.fielddata.ScriptDocValues$Strings.getValue(ScriptDocValues.java:84) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:627) ~[?:1.8.0_101]\r\n        at org.elasticsearch.painless.DefBootstrap$PIC.fallback(DefBootstrap.java:204) ~[?:?]\r\n        at org.elasticsearch.painless.Executable$Script.execute(def json = '{'; ... @ <inline script>:332) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:121) ~[?:?]\r\n        at org.elasticsearch.search.fetch.subphase.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:52) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:161) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:358) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$9(SearchTransportService.java:291) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_101]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_101]\r\n        at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_101]\r\n[2017-01-12T12:14:30,913][DEBUG][o.e.a.s.TransportSearchAction] [Z8qG7Y5] All shards failed for phase: [query_fetch]\r\norg.elasticsearch.transport.RemoteTransportException: [Z8qG7Y5][127.0.0.1:9300][indices:data/read/search[phase/query+fetch]]\r\nCaused by: org.elasticsearch.script.ScriptException: runtime error\r\n        at org.elasticsearch.painless.ScriptImpl.convertToScriptException(ScriptImpl.java:177) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:124) ~[?:?]\r\n        at org.elasticsearch.search.fetch.subphase.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:52) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:161) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:358) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$9(SearchTransportService.java:291) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_101]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_101]\r\n        at java.lang.Thread.run(Thread.java:745) [?:1.8.0_101]\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 16\r\n        at org.apache.lucene.util.UnicodeUtil.UTF8toUTF16(UnicodeUtil.java:598) ~[lucene-core-6.2.0.jar:6.2.0 764d0f19151dbff6f5fcd9fc4b2682cf934590c5 - mike - 2016-08-20 05:39:36]\r\n        at org.apache.lucene.util.BytesRef.utf8ToString(BytesRef.java:152) ~[lucene-core-6.2.0.jar:6.2.0 764d0f19151dbff6f5fcd9fc4b2682cf934590c5 - mike - 2016-08-20 05:39:36]\r\n        at org.elasticsearch.index.fielddata.ScriptDocValues$Strings.getValue(ScriptDocValues.java:84) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:627) ~[?:1.8.0_101]\r\n        at org.elasticsearch.painless.DefBootstrap$PIC.fallback(DefBootstrap.java:204) ~[?:?]\r\n        at org.elasticsearch.painless.Executable$Script.execute(def json = '{'; ... @ <inline script>:332) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:121) ~[?:?]\r\n        at org.elasticsearch.search.fetch.subphase.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:52) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:161) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:358) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$9(SearchTransportService.java:291) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_101]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_101]\r\n        at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_101]\r\n```\r\n\r\nI got that with this script and don't understand really what makes it different :-) :\r\n\r\n```\r\n String ip = doc['IP_SRC'].getValue();\r\n```\r\n\r\nAlso I am not sure if it helps or if this is a different issue but if I do the following script I get a NoSuchElement exception (I thought maybe its because the field is null but even if i wrap it in a if statement i get the same issue):\r\n\r\n```\r\ndef mystring = 'myip:';\r\nmystring += doc['IP_SRC'];\r\n```\r\n\r\n```\r\norg.elasticsearch.transport.RemoteTransportException: [Z8qG7Y5][127.0.0.1:9300][indices:data/read/search[phase/query+fetch]]\r\nCaused by: org.elasticsearch.script.ScriptException: runtime error\r\n        at org.elasticsearch.painless.ScriptImpl.convertToScriptException(ScriptImpl.java:177) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:124) ~[?:?]\r\n        at org.elasticsearch.search.fetch.subphase.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:52) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:161) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:358) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$9(SearchTransportService.java:291) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_101]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_101]\r\n        at java.lang.Thread.run(Thread.java:745) [?:1.8.0_101]\r\nCaused by: java.util.NoSuchElementException\r\n        at java.util.AbstractList$Itr.next(AbstractList.java:364) ~[?:1.8.0_101]\r\n        at java.util.AbstractCollection.toString(AbstractCollection.java:461) ~[?:1.8.0_101]\r\n        at java.lang.String.valueOf(String.java:2994) ~[?:1.8.0_101]\r\n        at java.lang.StringBuilder.append(StringBuilder.java:131) ~[?:1.8.0_101]\r\n        at org.elasticsearch.painless.Executable$Script.execute(def json = '{'; ... @ <inline script>:325) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:121) ~[?:?]\r\n        at org.elasticsearch.search.fetch.subphase.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:52) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:161) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:358) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$9(SearchTransportService.java:291) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_101]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_101]\r\n        at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_101]\r\n[2017-01-12T15:07:50,668][DEBUG][o.e.a.s.TransportSearchAction] [Z8qG7Y5] All shards failed for phase: [query_fetch]\r\norg.elasticsearch.transport.RemoteTransportException: [Z8qG7Y5][127.0.0.1:9300][indices:data/read/search[phase/query+fetch]]\r\nCaused by: org.elasticsearch.script.ScriptException: runtime error\r\n        at org.elasticsearch.painless.ScriptImpl.convertToScriptException(ScriptImpl.java:177) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:124) ~[?:?]\r\n        at org.elasticsearch.search.fetch.subphase.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:52) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:161) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:358) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$9(SearchTransportService.java:291) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_101]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_101]\r\n        at java.lang.Thread.run(Thread.java:745) [?:1.8.0_101]\r\nCaused by: java.util.NoSuchElementException\r\n        at java.util.AbstractList$Itr.next(AbstractList.java:364) ~[?:1.8.0_101]\r\n        at java.util.AbstractCollection.toString(AbstractCollection.java:461) ~[?:1.8.0_101]\r\n        at java.lang.String.valueOf(String.java:2994) ~[?:1.8.0_101]\r\n        at java.lang.StringBuilder.append(StringBuilder.java:131) ~[?:1.8.0_101]\r\n        at org.elasticsearch.painless.Executable$Script.execute(def json = '{'; ... @ <inline script>:325) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:121) ~[?:?]\r\n        at org.elasticsearch.search.fetch.subphase.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:52) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:161) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:358) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$9(SearchTransportService.java:291) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.0.0.jar:5.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_101]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_101]\r\n        at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_101]\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272203938","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272203938","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272203938,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjIwMzkzOA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T16:06:35Z","updated_at":"2017-01-12T16:06:35Z","author_association":"CONTRIBUTOR","body":"> My hunch is that there needs to be a specific subclass in ScriptDocValues for IP fields.\r\n\r\nLooks like @jpountz already got it: https://github.com/elastic/elasticsearch/commit/cbd43401300a76e6f4431654f8b32beb94938897\r\n\r\n\r\n*but* there still is an issue in master:\r\n```\r\nUnable to find dynamic method [getValue] with [0] arguments for class [org.elasticsearch.index.mapper.IpFieldMapper.IpFieldType.IpScriptDocValues]\r\n```\r\n\r\nIt looks like we're missing a whitelist entry for painless. Digging....","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272216606","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272216606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272216606,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjIxNjYwNg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T16:50:04Z","updated_at":"2017-01-12T16:50:04Z","author_association":"CONTRIBUTOR","body":"Ok - I've almost got it but I can't figure out why painless can't find a class. I'm going to take a break and come back in a bit.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272228712","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272228712","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272228712,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjIyODcxMg==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T17:34:22Z","updated_at":"2017-01-12T17:34:22Z","author_association":"CONTRIBUTOR","body":"@nik9000 I'm not seeing this in the whitelist in master.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272253743","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272253743","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272253743,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjI1Mzc0Mw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T19:12:38Z","updated_at":"2017-01-12T19:12:38Z","author_association":"CONTRIBUTOR","body":"> @nik9000 I'm not seeing this in the whitelist in master.\r\n\r\nYeah, I'm whitelisting it now and making a test for them all. But I'm having trouble with class not found exceptions.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272253947","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272253947","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272253947,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjI1Mzk0Nw==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T19:13:15Z","updated_at":"2017-01-12T19:13:15Z","author_association":"CONTRIBUTOR","body":"Ahh, sorry I misunderstood.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272284803","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272284803","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272284803,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjI4NDgwMw==","user":{"login":"josephDunne","id":1827457,"node_id":"MDQ6VXNlcjE4Mjc0NTc=","avatar_url":"https://avatars0.githubusercontent.com/u/1827457?v=4","gravatar_id":"","url":"https://api.github.com/users/josephDunne","html_url":"https://github.com/josephDunne","followers_url":"https://api.github.com/users/josephDunne/followers","following_url":"https://api.github.com/users/josephDunne/following{/other_user}","gists_url":"https://api.github.com/users/josephDunne/gists{/gist_id}","starred_url":"https://api.github.com/users/josephDunne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephDunne/subscriptions","organizations_url":"https://api.github.com/users/josephDunne/orgs","repos_url":"https://api.github.com/users/josephDunne/repos","events_url":"https://api.github.com/users/josephDunne/events{/privacy}","received_events_url":"https://api.github.com/users/josephDunne/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T21:11:52Z","updated_at":"2017-01-12T21:11:52Z","author_association":"NONE","body":"Thank you @nik9000","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272285183","html_url":"https://github.com/elastic/elasticsearch/issues/22584#issuecomment-272285183","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22584","id":272285183,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjI4NTE4Mw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T21:13:24Z","updated_at":"2017-01-12T21:13:24Z","author_association":"CONTRIBUTOR","body":"> Thank you @nik9000\r\n\r\nYou are quite welcome! You'll get it in 5.2.0 which isn't quite ready yet, but is coming soonish.","performed_via_github_app":null}]