{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16958","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16958/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16958/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16958/events","html_url":"https://github.com/elastic/elasticsearch/issues/16958","id":138548620,"node_id":"MDU6SXNzdWUxMzg1NDg2MjA=","number":16958,"title":"Option to remove indices from target cluster for previously deleted indices upon snapshot restore","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-03-04T18:28:28Z","updated_at":"2018-03-22T15:30:02Z","closed_at":"2018-03-22T15:30:01Z","author_association":"MEMBER","active_lock_reason":null,"body":"<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n\n**Describe the feature**:\n\nProvide an option for target cluster to be aware of previously deleted indices when restoring snapshots so that deleted indices from the source cluster will cause the target cluster to also remove its indices upon restoring.   This is helpful when attempting to \"mirror\" clusters without having to keep track of deleted indices outside of the snapshot restore process.  The following is one such use case:\n\n```\n1. Take snapshot 1 in Active cluster\n\n2. Close all indices in Passive cluster\n\n3. Passive cluster restores from snapshot 1\n\n4. Remove index1 from alias1 in Active cluster\n\n5. Delete index1 from Active cluster\n\n6. Take snapshot 2 in Active cluster\n\n7. Close all indices in Passive cluster\n\n8. Passive cluster restores from snapshot 2\n```\n\nThe result is that index1 is closed and remains in alias1 in the Passive cluster after step 8, which would cause problem when the Passive cluster becomes the Active cluster (DR) for if someone then tries to query using alias1 (this will result in an IndexClosedException).  The obvious workaround here will be to manually manage deleted indices by keeping track of what indices have been deleted from Active and delete same indices from the Passive cluster.\n\nThe request here is to provide a configurable option for admins to specify whether they want the snapshot restore to automatically remove previously-deleted indices from the target cluster.\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}