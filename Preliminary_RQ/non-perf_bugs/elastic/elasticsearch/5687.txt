{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5687","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5687/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5687/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5687/events","html_url":"https://github.com/elastic/elasticsearch/issues/5687","id":30861581,"node_id":"MDU6SXNzdWUzMDg2MTU4MQ==","number":5687,"title":"Problems with field resolution in significant terms aggregations","user":{"login":"hkorte","id":839805,"node_id":"MDQ6VXNlcjgzOTgwNQ==","avatar_url":"https://avatars2.githubusercontent.com/u/839805?v=4","gravatar_id":"","url":"https://api.github.com/users/hkorte","html_url":"https://github.com/hkorte","followers_url":"https://api.github.com/users/hkorte/followers","following_url":"https://api.github.com/users/hkorte/following{/other_user}","gists_url":"https://api.github.com/users/hkorte/gists{/gist_id}","starred_url":"https://api.github.com/users/hkorte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hkorte/subscriptions","organizations_url":"https://api.github.com/users/hkorte/orgs","repos_url":"https://api.github.com/users/hkorte/repos","events_url":"https://api.github.com/users/hkorte/events{/privacy}","received_events_url":"https://api.github.com/users/hkorte/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-04-04T13:44:44Z","updated_at":"2014-12-30T15:15:35Z","closed_at":"2014-12-30T15:15:35Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hi,\n\nI noticed (at least for me) unexpected behavior in the field resolution of the significant terms aggregations when prepending the document type to the field name:\n\n```\n\"significant_terms\" : { \"field\" : \"report.crime_type\" }\n```\n\ninstead of\n\n```\n\"significant_terms\" : { \"field\" : \"crime_type\" }\n```\n\nleads to an NPE in ES 1.1.0:\n\n```\njava.lang.NullPointerException\n        at org.elasticsearch.search.aggregations.bucket.significant.SignificantTermsAggregatorFactory.getBackgroundFrequency(SignificantTermsAggregatorFactory.java:190)\n        at org.elasticsearch.search.aggregations.bucket.significant.SignificantStringTermsAggregator.buildAggregation(SignificantStringTermsAggregator.java:87)\n        at org.elasticsearch.search.aggregations.bucket.significant.SignificantStringTermsAggregator$WithOrdinals.buildAggregation(SignificantStringTermsAggregator.java:129)\n        at org.elasticsearch.search.aggregations.AggregationPhase.execute(AggregationPhase.java:135)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:136)\n...\n```\n\nand in the current master this leads to \"Infinity\" scores:\n\n```\n\"aggregations\" : {\n    \"contentTerms\" : {\n      \"doc_count\" : 5,\n      \"buckets\" : [ {\n        \"key\" : \"of\",\n        \"doc_count\" : 4,\n        \"score\" : \"Infinity\",\n        \"bg_count\" : 0\n      }, {\n        \"key\" : \"a\",\n        \"doc_count\" : 3,\n        \"score\" : \"Infinity\",\n        \"bg_count\" : 0\n      }, {\n        \"key\" : \"metals\",\n        \"doc_count\" : 5,\n        \"score\" : \"Infinity\",\n        \"bg_count\" : 0\n      }\n...\n```\n\nWithout the document type it works fine in both ES versions. Here is a gist to reproduce it: https://gist.github.com/hkorte/9974567\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}