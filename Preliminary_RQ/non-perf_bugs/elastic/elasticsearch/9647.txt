{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9647","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9647/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9647/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9647/events","html_url":"https://github.com/elastic/elasticsearch/issues/9647","id":57296738,"node_id":"MDU6SXNzdWU1NzI5NjczOA==","number":9647,"title":"Search behavior over all types is inconsistent","user":{"login":"tobigue","id":1560152,"node_id":"MDQ6VXNlcjE1NjAxNTI=","avatar_url":"https://avatars2.githubusercontent.com/u/1560152?v=4","gravatar_id":"","url":"https://api.github.com/users/tobigue","html_url":"https://github.com/tobigue","followers_url":"https://api.github.com/users/tobigue/followers","following_url":"https://api.github.com/users/tobigue/following{/other_user}","gists_url":"https://api.github.com/users/tobigue/gists{/gist_id}","starred_url":"https://api.github.com/users/tobigue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tobigue/subscriptions","organizations_url":"https://api.github.com/users/tobigue/orgs","repos_url":"https://api.github.com/users/tobigue/repos","events_url":"https://api.github.com/users/tobigue/events{/privacy}","received_events_url":"https://api.github.com/users/tobigue/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-02-11T10:08:40Z","updated_at":"2015-02-12T11:32:53Z","closed_at":"2015-02-12T11:27:55Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When searching over all types the search behavior is inconsistent in the case when a type, object and field have the same name.\n\n```\n# Insert a document with type a\ncurl -XPUT \"http://localhost:9200/test/a/1\" -d '{\"a\": {\"a\": \"asdf\"}, \"x\": {\"a\": \"asdf\"}}'\n\n# Insert a document with type b\ncurl -XPUT \"http://localhost:9200/test/b/1\" -d '{\"a\": {\"a\": \"asdf\"}, \"x\": {\"a\": \"asdf\"}}'\n\n# We search in all types in field a.a and get 1 result\ncurl -XPOST \"http://localhost:9200/test/_search\" -d '{\"query\": {\"term\": {\"a.a\": \"asdf\"}}}' | python -mjson.tool\n\n{\n    \"hits\": {\n        \"hits\": [\n            {\n                \"_id\": \"1\", \n                \"_index\": \"test\", \n                \"_score\": 0.5945348, \n                \"_source\": {\n                    \"a\": {\n                        \"a\": \"asdf\"\n                    }, \n                    \"x\": {\n                        \"a\": \"asdf\"\n                    }\n                }, \n                \"_type\": \"a\"\n            }\n        ], \n        \"max_score\": 0.5945348, \n        \"total\": 1\n    }\n}\n\n# We search in all types in field x.a and get 2 results\ncurl -XPOST \"http://localhost:9200/test/_search\" -d '{\"query\": {\"term\": {\"x.a\": \"asdf\"}}}' | python -mjson.tool\n\n{\n    \"hits\": {\n        \"hits\": [\n            {\n                \"_id\": \"1\", \n                \"_index\": \"test\", \n                \"_score\": 0.5945348, \n                \"_source\": {\n                    \"a\": {\n                        \"a\": \"asdf\"\n                    }, \n                    \"x\": {\n                        \"a\": \"asdf\"\n                    }\n                }, \n                \"_type\": \"a\"\n            }, \n            {\n                \"_id\": \"1\", \n                \"_index\": \"test\", \n                \"_score\": 0.5945348, \n                \"_source\": {\n                    \"a\": {\n                        \"a\": \"asdf\"\n                    }, \n                    \"x\": {\n                        \"a\": \"asdf\"\n                    }\n                }, \n                \"_type\": \"b\"\n            }\n        ], \n        \"max_score\": 0.5945348, \n        \"total\": 2\n    }\n}\n```\n\nThe problem seems to be, that in the first case the first a in the path a.a seems to be interpreted as type (which leads to the same search result as searching in path a.a.a).\n\nA temporary workaround is to search in specific types, if possible:\n\n```\ncurl -XPOST \"http://localhost:9200/test/a,b/_search\" -d '{\"query\": {\"term\": {\"x.a\": \"asdf\"}}}'\n```\n\nThe **expected behavior** would be that the first search query also returns both documents.\n\nTested against version: 1.4.2\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}