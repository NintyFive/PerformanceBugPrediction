[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32222609","html_url":"https://github.com/elastic/elasticsearch/issues/4703#issuecomment-32222609","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4703","id":32222609,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjIyNjA5","user":{"login":"deverton","id":287143,"node_id":"MDQ6VXNlcjI4NzE0Mw==","avatar_url":"https://avatars1.githubusercontent.com/u/287143?v=4","gravatar_id":"","url":"https://api.github.com/users/deverton","html_url":"https://github.com/deverton","followers_url":"https://api.github.com/users/deverton/followers","following_url":"https://api.github.com/users/deverton/following{/other_user}","gists_url":"https://api.github.com/users/deverton/gists{/gist_id}","starred_url":"https://api.github.com/users/deverton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deverton/subscriptions","organizations_url":"https://api.github.com/users/deverton/orgs","repos_url":"https://api.github.com/users/deverton/repos","events_url":"https://api.github.com/users/deverton/events{/privacy}","received_events_url":"https://api.github.com/users/deverton/received_events","type":"User","site_admin":false},"created_at":"2014-01-13T23:12:16Z","updated_at":"2014-01-13T23:18:39Z","author_association":"CONTRIBUTOR","body":"I've written this up as a an integration test and used git bisect to try and track down where this broke between 0.90.5 and 0.90.6. It looks like this commit 9950e4440aeea76fc71b5ee534e15d4bfb1d73ed seems to be the culprit.\n\nThis is the test method I'm using.\n\n``` java\n    @Test\n    public void simpleScrolledHasChildFilteredQuery() throws Exception {\n        client().admin().indices().prepareCreate(\"test\")\n                .setSettings(ImmutableSettings.settingsBuilder().put(\"index.number_of_shards\", 1).put(\"index.number_of_replicas\", 0))\n                .execute().actionGet();\n        client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();\n        client().admin()\n                .indices()\n                .preparePutMapping(\"test\")\n                .setType(\"child\")\n                .setSource(\n                        jsonBuilder().startObject().startObject(\"child\").startObject(\"_parent\").field(\"type\", \"parent\").endObject()\n                                .endObject().endObject()).execute().actionGet();\n\n\n        for (int i = 0; i < 10; i++) {\n            client().prepareIndex(\"test\", \"parent\", \"p\" + i).setSource(\"{}\").execute().actionGet();\n            client().prepareIndex(\"test\", \"child\", \"c\" + i).setSource(\"{}\").setParent(\"p\" + i).execute().actionGet();\n        }\n\n        client().admin().indices().prepareRefresh().execute().actionGet();\n\n        final SearchResponse scrollResponse = client().prepareSearch(\"test\")\n                .setScroll(TimeValue.timeValueSeconds(30))\n                .setSize(1)\n                .addField(\"_id\")\n                .setTypes(\"parent\")\n                .setQuery(filteredQuery(matchAllQuery(), FilterBuilders.hasChildFilter(\"child\", matchAllQuery())))\n                .execute()\n                .actionGet();\n\n        final SearchResponse firstScroll = client().prepareSearchScroll(scrollResponse.getScrollId()).setScroll(TimeValue.timeValueSeconds(30)).execute().actionGet();\n        final SearchResponse secondScroll = client().prepareSearchScroll(firstScroll.getScrollId()).setScroll(TimeValue.timeValueSeconds(30)).execute().actionGet();\n\n        client().prepareClearScroll().addScrollId(secondScroll.getScrollId()).execute().actionGet();\n\n        assertThat(scrollResponse.getFailedShards(), equalTo(0));\n        assertThat(scrollResponse.getHits().totalHits(), equalTo(10l));\n\n        assertThat(firstScroll.getFailedShards(), equalTo(0));\n        assertThat(firstScroll.getHits().getHits().length, equalTo(1));\n\n        assertThat(secondScroll.getFailedShards(), equalTo(0));\n        assertThat(secondScroll.getHits().getHits().length, equalTo(1));\n    }\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32317041","html_url":"https://github.com/elastic/elasticsearch/issues/4703#issuecomment-32317041","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4703","id":32317041,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzE3MDQx","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-01-14T22:57:05Z","updated_at":"2014-01-14T22:57:05Z","author_association":"MEMBER","body":"Nice catch! \n\nI further looked into this issue and this error only seems to occur with the has_child or has_parent filter, but not with the has_child / has_parent query.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32420481","html_url":"https://github.com/elastic/elasticsearch/issues/4703#issuecomment-32420481","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4703","id":32420481,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDIwNDgx","user":{"login":"govindm","id":3537896,"node_id":"MDQ6VXNlcjM1Mzc4OTY=","avatar_url":"https://avatars1.githubusercontent.com/u/3537896?v=4","gravatar_id":"","url":"https://api.github.com/users/govindm","html_url":"https://github.com/govindm","followers_url":"https://api.github.com/users/govindm/followers","following_url":"https://api.github.com/users/govindm/following{/other_user}","gists_url":"https://api.github.com/users/govindm/gists{/gist_id}","starred_url":"https://api.github.com/users/govindm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/govindm/subscriptions","organizations_url":"https://api.github.com/users/govindm/orgs","repos_url":"https://api.github.com/users/govindm/repos","events_url":"https://api.github.com/users/govindm/events{/privacy}","received_events_url":"https://api.github.com/users/govindm/received_events","type":"User","site_admin":false},"created_at":"2014-01-15T22:05:56Z","updated_at":"2014-01-15T22:05:56Z","author_association":"NONE","body":"Thanks for fixing it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/396994970","html_url":"https://github.com/elastic/elasticsearch/issues/4703#issuecomment-396994970","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4703","id":396994970,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Njk5NDk3MA==","user":{"login":"gcabero","id":3518604,"node_id":"MDQ6VXNlcjM1MTg2MDQ=","avatar_url":"https://avatars2.githubusercontent.com/u/3518604?v=4","gravatar_id":"","url":"https://api.github.com/users/gcabero","html_url":"https://github.com/gcabero","followers_url":"https://api.github.com/users/gcabero/followers","following_url":"https://api.github.com/users/gcabero/following{/other_user}","gists_url":"https://api.github.com/users/gcabero/gists{/gist_id}","starred_url":"https://api.github.com/users/gcabero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gcabero/subscriptions","organizations_url":"https://api.github.com/users/gcabero/orgs","repos_url":"https://api.github.com/users/gcabero/repos","events_url":"https://api.github.com/users/gcabero/events{/privacy}","received_events_url":"https://api.github.com/users/gcabero/received_events","type":"User","site_admin":false},"created_at":"2018-06-13T16:07:50Z","updated_at":"2018-06-13T16:08:39Z","author_association":"NONE","body":"This issue seems to still happening in 6.2? Different API but not results are fetched when combining post filter with scrolling","performed_via_github_app":null}]