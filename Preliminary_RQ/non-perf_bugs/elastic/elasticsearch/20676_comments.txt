[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252418164","html_url":"https://github.com/elastic/elasticsearch/issues/20676#issuecomment-252418164","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20676","id":252418164,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjQxODE2NA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T10:53:24Z","updated_at":"2016-10-08T10:53:24Z","author_association":"CONTRIBUTOR","body":"@dsem the highlight query is not used for filtering, that's the job of the main query (which in this case is match_all).  Highlighting just extracts a bag of words from the terms and highlights those.  If you had the same query with bool-must as your main query, then the document wouldn't have been included in the hits at all.  This is just the way that highlighting works.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252430240","html_url":"https://github.com/elastic/elasticsearch/issues/20676#issuecomment-252430240","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20676","id":252430240,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjQzMDI0MA==","user":{"login":"dsem","id":2773346,"node_id":"MDQ6VXNlcjI3NzMzNDY=","avatar_url":"https://avatars2.githubusercontent.com/u/2773346?v=4","gravatar_id":"","url":"https://api.github.com/users/dsem","html_url":"https://github.com/dsem","followers_url":"https://api.github.com/users/dsem/followers","following_url":"https://api.github.com/users/dsem/following{/other_user}","gists_url":"https://api.github.com/users/dsem/gists{/gist_id}","starred_url":"https://api.github.com/users/dsem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dsem/subscriptions","organizations_url":"https://api.github.com/users/dsem/orgs","repos_url":"https://api.github.com/users/dsem/repos","events_url":"https://api.github.com/users/dsem/events{/privacy}","received_events_url":"https://api.github.com/users/dsem/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T15:23:16Z","updated_at":"2016-10-08T15:23:16Z","author_association":"NONE","body":"Thanks for your reply.\n\nI understand that highlight_query isn't used for filtering.  My use case has a query returning all documents in a thread (e.g., a list of emails in an email thread), while highlighting certain terms found in the documents.  Therefore the filtering and highlighting queries are completely different.\n\nIs there a way to make this issue an enhancement request?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252479309","html_url":"https://github.com/elastic/elasticsearch/issues/20676#issuecomment-252479309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20676","id":252479309,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjQ3OTMwOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-10-09T10:50:40Z","updated_at":"2016-10-09T10:50:40Z","author_association":"CONTRIBUTOR","body":"> Is there a way to make this issue an enhancement request?\n\nI don't think we can make this work unless Lucene completely changes how their highlighters work.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/282048290","html_url":"https://github.com/elastic/elasticsearch/issues/20676#issuecomment-282048290","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20676","id":282048290,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MjA0ODI5MA==","user":{"login":"ps23","id":699423,"node_id":"MDQ6VXNlcjY5OTQyMw==","avatar_url":"https://avatars0.githubusercontent.com/u/699423?v=4","gravatar_id":"","url":"https://api.github.com/users/ps23","html_url":"https://github.com/ps23","followers_url":"https://api.github.com/users/ps23/followers","following_url":"https://api.github.com/users/ps23/following{/other_user}","gists_url":"https://api.github.com/users/ps23/gists{/gist_id}","starred_url":"https://api.github.com/users/ps23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ps23/subscriptions","organizations_url":"https://api.github.com/users/ps23/orgs","repos_url":"https://api.github.com/users/ps23/repos","events_url":"https://api.github.com/users/ps23/events{/privacy}","received_events_url":"https://api.github.com/users/ps23/received_events","type":"User","site_admin":false},"created_at":"2017-02-23T16:44:10Z","updated_at":"2017-02-23T16:44:10Z","author_association":"NONE","body":"I have the same issue. The documentation says:\r\n\"It is also possible to highlight against a query other than the search query by setting highlight_query. This is especially useful if you use a rescore query because those are not taken into account by highlighting by default. Elasticsearch does not validate that highlight_query contains the search query in any way so it is possible to define it so legitimate query results arenâ€™t highlighted at all. Generally it is better to include the search query in the highlight_query. Here is an example of including both the search query and the rescore query in highlight_query.\"\r\n\r\nIt also gives the following example:\r\n\r\n```\r\n\"highlight\" : {\r\n        \"order\" : \"score\",\r\n        \"fields\" : {\r\n            \"content\" : {\r\n                \"fragment_size\" : 150,\r\n                \"number_of_fragments\" : 3,\r\n                \"highlight_query\": {\r\n                    \"bool\": {\r\n                        \"must\": {\r\n                            \"match\": {\r\n                                \"content\": {\r\n                                    \"query\": \"foo bar\"\r\n                                }\r\n                            }\r\n                        },\r\n                        \"should\": {\r\n                            \"match_phrase\": {\r\n                                \"content\": {\r\n                                    \"query\": \"foo bar\",\r\n                                    \"slop\": 1,\r\n                                    \"boost\": 10.0\r\n                                }\r\n                            }\r\n                        },\r\n                        \"minimum_should_match\": 0\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\nWhat is the purpose of having a separate query in the first place then when all that the highlighter does is to extract all terms as a list of terms to match?\r\n\r\nThe currently behaviour treats all terms as OR and highlights anything that it finds no matter if it was defined through bool must, should, query_string AND, |(value1 + value2).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308999837","html_url":"https://github.com/elastic/elasticsearch/issues/20676#issuecomment-308999837","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20676","id":308999837,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODk5OTgzNw==","user":{"login":"aslamy","id":11768586,"node_id":"MDQ6VXNlcjExNzY4NTg2","avatar_url":"https://avatars3.githubusercontent.com/u/11768586?v=4","gravatar_id":"","url":"https://api.github.com/users/aslamy","html_url":"https://github.com/aslamy","followers_url":"https://api.github.com/users/aslamy/followers","following_url":"https://api.github.com/users/aslamy/following{/other_user}","gists_url":"https://api.github.com/users/aslamy/gists{/gist_id}","starred_url":"https://api.github.com/users/aslamy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aslamy/subscriptions","organizations_url":"https://api.github.com/users/aslamy/orgs","repos_url":"https://api.github.com/users/aslamy/repos","events_url":"https://api.github.com/users/aslamy/events{/privacy}","received_events_url":"https://api.github.com/users/aslamy/received_events","type":"User","site_admin":false},"created_at":"2017-06-16T11:12:48Z","updated_at":"2017-06-16T11:12:48Z","author_association":"NONE","body":"I have the same issue. It does not matter if you use highlight_query or not. The result is always the same.","performed_via_github_app":null}]