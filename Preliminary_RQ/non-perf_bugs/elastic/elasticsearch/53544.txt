{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53544","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53544/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53544/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53544/events","html_url":"https://github.com/elastic/elasticsearch/issues/53544","id":580603277,"node_id":"MDU6SXNzdWU1ODA2MDMyNzc=","number":53544,"title":"[CI] Timeout failure in class CloseWhileRelocatingShardsIT, test testCloseWhileRelocatingShards","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"labels":[{"id":152510590,"node_id":"MDU6TGFiZWwxNTI1MTA1OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Recovery","name":":Distributed/Recovery","color":"0e8a16","default":false,"description":"Anything around constructing a new shard, either from a local or a remote source."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-03-13T13:32:16Z","updated_at":"2020-03-23T15:23:09Z","closed_at":"2020-03-23T15:23:09Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I see three CI test failures on `master` that seem to share a pattern. I can't reproduce the failure locally.\r\n\r\nThere is a lot of failure output, including three distinct exceptions. The first is an `AssertionError` about a timeout:\r\n\r\n```\r\norg.elasticsearch.indices.state.CloseWhileRelocatingShardsIT > testCloseWhileRelocatingShards FAILED\r\n  java.lang.AssertionError: timed out waiting for green state\r\n  at org.junit.Assert.fail(Assert.java:88)\r\n  at org.elasticsearch.test.ESIntegTestCase.ensureColor(ESIntegTestCase.java:887) \r\n  at org.elasticsearch.test.ESIntegTestCase.ensureGreen(ESIntegTestCase.java:840) \r\n  at org.elasticsearch.test.ESIntegTestCase.ensureGreen(ESIntegTestCase.java:829) \r\n  at org.elasticsearch.indices.state.CloseWhileRelocatingShardsIT.testCloseWhileRelocatingShards(CloseWhileRelocatingShardsIT.java:120)\r\n```\r\n\r\nThe second is an assertion error about pending shard operations:\r\n\r\n```\r\njava.lang.AssertionError: shard [index-3][0] on node [node_sd1] has pending operations:\r\n  --> BulkShardRequest [[index-3][0]] containing [5] requests\r\n  at org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:233)\r\n  at org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationPermit(IndexShard.java:2689)\r\n  at org.elasticsearch.action.support.replication.TransportReplicationAction.acquirePrimaryOperationPermit(TransportReplicationAction.java:835)\r\n  at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.doRun(TransportReplicationAction.java:292)\r\n  at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  at org.elasticsearch.action.support.replication.TransportReplicationAction.handlePrimaryRequest(TransportReplicationAction.java:255)\r\n  at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63)\r\n  at org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:696)\r\n  at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:747)\r\n  at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n  at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n  at java.base/java.lang.Thread.run(Thread.java:834)\r\n  at org.elasticsearch.test.InternalTestCluster.lambda$assertNoPendingIndexOperations$11(InternalTestCluster.java:1157)\r\n  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:887)\r\n  at org.elasticsearch.test.InternalTestCluster.assertNoPendingIndexOperations(InternalTestCluster.java:1148)\r\n  at org.elasticsearch.test.InternalTestCluster.beforeIndexDeletion(InternalTestCluster.java:1142) \r\n  at org.elasticsearch.test.ESIntegTestCase.beforeIndexDeletion(ESIntegTestCase.java:575) \r\n  at org.elasticsearch.test.ESIntegTestCase.afterInternal(ESIntegTestCase.java:545)\r\n  at org.elasticsearch.test.ESIntegTestCase.cleanUpCluster(ESIntegTestCase.java:1936)\r\n  […]\r\n```\r\n\r\nFinally, there's a thread leak error:\r\n```\r\norg.elasticsearch.indices.state.CloseWhileRelocatingShardsIT > classMethod FAILED\r\n    com.carrotsearch.randomizedtesting.ThreadLeakError: 3 threads leaked from SUITE scope at org.elasticsearch.indices.state.CloseWhileRelocatingShardsIT: \r\n       1) Thread[id=1114, name=Thread-6, state=RUNNABLE, group=TGRP-CloseWhileRelocatingShardsIT]\r\n            at java.base@11.0.2/java.util.Spliterators$ArraySpliterator.tryAdvance(Spliterators.java:958)\r\n            at java.base@11.0.2/java.util.Spliterators$1Adapter.hasNext(Spliterators.java:681)\r\n            at app//org.elasticsearch.test.BackgroundIndexer$1.run(BackgroundIndexer.java:160)\r\n       2) Thread[id=1109, name=Thread-5, state=WAITING, group=TGRP-CloseWhileRelocatingShardsIT]\r\n            at java.base@11.0.2/jdk.internal.misc.Unsafe.park(Native Method)\r\n            at java.base@11.0.2/java.util.concurrent.locks.LockSupport.park(LockSupport.java:194)\r\n            at java.base@11.0.2/java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:885)\r\n            at java.base@11.0.2/java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1039)\r\n            at java.base@11.0.2/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1345)\r\n            at app//org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n            at app//org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:87)\r\n            at app//org.elasticsearch.common.util.concurrent.FutureUtils.get(FutureUtils.java:56)\r\n            at app//org.elasticsearch.action.support.AdapterActionFuture.actionGet(AdapterActionFuture.java:37)\r\n            at app//org.elasticsearch.action.ActionRequestBuilder.get(ActionRequestBuilder.java:52)\r\n            at app//org.elasticsearch.test.BackgroundIndexer$1.run(BackgroundIndexer.java:159)\r\n       3) Thread[id=1090, name=Thread-4, state=WAITING, group=TGRP-CloseWhileRelocatingShardsIT]\r\n            at java.base@11.0.2/jdk.internal.misc.Unsafe.park(Native Method)\r\n            at java.base@11.0.2/java.util.concurrent.locks.LockSupport.park(LockSupport.java:194)\r\n            at java.base@11.0.2/java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:885)\r\n            at java.base@11.0.2/java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1039)\r\n            at java.base@11.0.2/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1345)\r\n            at app//org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n            at app//org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:87)\r\n            at app//org.elasticsearch.common.util.concurrent.FutureUtils.get(FutureUtils.java:56)\r\n            at app//org.elasticsearch.action.support.AdapterActionFuture.actionGet(AdapterActionFuture.java:37)\r\n            at app//org.elasticsearch.action.ActionRequestBuilder.get(ActionRequestBuilder.java:52)\r\n            at app//org.elasticsearch.test.BackgroundIndexer$1.run(BackgroundIndexer.java:159)\r\n        at __randomizedtesting.SeedInfo.seed([6350B3BE3F809D73]:0)\r\n```\r\n\r\nThere is a **lot** of other log output in the build logs.\r\n\r\nLinks to build scans:\r\n* March 13: https://gradle-enterprise.elastic.co/s/tbjuwp756ed54\r\n* March 2: https://gradle-enterprise.elastic.co/s/5dfhpzpdukz32\r\n* February 25: https://gradle-enterprise.elastic.co/s/3ks6xx6vpt4ls\r\n\r\nIt looks like the last time we addressed a test failure here was #49403.","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}