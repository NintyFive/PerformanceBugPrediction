{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15174","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15174/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15174/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15174/events","html_url":"https://github.com/elastic/elasticsearch/issues/15174","id":119891330,"node_id":"MDU6SXNzdWUxMTk4OTEzMzA=","number":15174,"title":"`phase_slop` question","user":{"login":"feifeiiiiiiiiiii","id":3310967,"node_id":"MDQ6VXNlcjMzMTA5Njc=","avatar_url":"https://avatars0.githubusercontent.com/u/3310967?v=4","gravatar_id":"","url":"https://api.github.com/users/feifeiiiiiiiiiii","html_url":"https://github.com/feifeiiiiiiiiiii","followers_url":"https://api.github.com/users/feifeiiiiiiiiiii/followers","following_url":"https://api.github.com/users/feifeiiiiiiiiiii/following{/other_user}","gists_url":"https://api.github.com/users/feifeiiiiiiiiiii/gists{/gist_id}","starred_url":"https://api.github.com/users/feifeiiiiiiiiiii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/feifeiiiiiiiiiii/subscriptions","organizations_url":"https://api.github.com/users/feifeiiiiiiiiiii/orgs","repos_url":"https://api.github.com/users/feifeiiiiiiiiiii/repos","events_url":"https://api.github.com/users/feifeiiiiiiiiiii/events{/privacy}","received_events_url":"https://api.github.com/users/feifeiiiiiiiiiii/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-12-02T08:31:36Z","updated_at":"2015-12-02T13:12:44Z","closed_at":"2015-12-02T13:12:44Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I add `phase_slop` in `query_string`, the query dsl as follow:\n\n```\n{\n   \"query\": {\n      \"bool\": {\n         \"must\": [\n           {\n             \"term\": {\n               \"platform\": 0\n             }\n           },\n            {\n               \"query_string\": {\n                  \"default_field\": \"text\",\n\n                  \"query\": \"\\\"美丽的蓝色多瑙河\\\"\",\n                 \"phrase_slop\": 1\n               }\n            }\n         ]\n      }\n   },\n  \"highlight\": {\n    \"fields\": {\n      \"text\": {\n        \"fragment_size\": 150\n      }\n    }\n  }\n}\n```\n\nBut I get shard failures result as follows:\n\n```\n{\n    \"took\": 528,\n    \"timed_out\": false,\n    \"_shards\": {\n        \"total\": 30,\n        \"successful\": 29,\n        \"failed\": 1,\n        \"failures\": [\n            {\n                \"index\": \"listening_v2_201511\",\n                \"shard\": 7,\n                \"status\": 500,\n                \"reason\": \"RemoteTransportException[[es13][inet[/10.10.3.98:9300]][indices:data/read/search[phase/fetch/id]]]; nested: FetchPhaseExecutionException[[listening_v2_201511][7]: query[filtered(+platform:[0 TO 0] +(text:\\\"美丽 丽 蓝色 蓝 色 多瑙河 河\\\"~1))->cache(org.elasticsearch.index.search.nested.NonNestedDocsFilter@b5b6c454)],from[0],size[10]: Fetch Failed [Failed to highlight field [text]]]; nested: StringIndexOutOfBoundsException[String index out of range: -1]; \"\n            }\n        ]\n    },\n    \"hits\": {\n        \"total\": 117,\n        \"max_score\": 87.00564\n    ...\n```\n\nHow solve it?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}