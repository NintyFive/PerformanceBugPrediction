[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/365071293","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-365071293","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":365071293,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTA3MTI5Mw==","user":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"created_at":"2018-02-12T21:39:56Z","updated_at":"2018-02-12T21:41:19Z","author_association":"CONTRIBUTOR","body":"Hi @tdoman - Since this is a NPE on a request I feel like it's worth investigating further. Could you include any other information about the clients accessing your cluster (Kibana, Logstash, etc..). \r\n\r\nIt looks like specifically a client is executing a Multi Term Vectors request ([docs here](https://www.elastic.co/guide/en/elasticsearch/reference/6.2/docs-multi-termvectors.html)), which pulls information about term fields from multiple documents and how they are tokenized. Hopefully that use case highlights any potential usage from your side of the client code.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/365097573","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-365097573","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":365097573,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTA5NzU3Mw==","user":{"login":"tdoman","id":11098266,"node_id":"MDQ6VXNlcjExMDk4MjY2","avatar_url":"https://avatars1.githubusercontent.com/u/11098266?v=4","gravatar_id":"","url":"https://api.github.com/users/tdoman","html_url":"https://github.com/tdoman","followers_url":"https://api.github.com/users/tdoman/followers","following_url":"https://api.github.com/users/tdoman/following{/other_user}","gists_url":"https://api.github.com/users/tdoman/gists{/gist_id}","starred_url":"https://api.github.com/users/tdoman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdoman/subscriptions","organizations_url":"https://api.github.com/users/tdoman/orgs","repos_url":"https://api.github.com/users/tdoman/repos","events_url":"https://api.github.com/users/tdoman/events{/privacy}","received_events_url":"https://api.github.com/users/tdoman/received_events","type":"User","site_admin":false},"created_at":"2018-02-12T23:22:31Z","updated_at":"2018-02-12T23:22:31Z","author_association":"NONE","body":"@jbaiera Thanks!  Sure, the only clients really hitting this system (an occasional kibana dev tools usage but not accessing this stuff) are via our Web App which uses NEST 6.0.  The errors seem to be sporadic and I have not been able to determine which requests cause it.  My best guess right now is that it is a periodically ephemeral issue cuz doing the same actions as reported by our QA, I can't dupe it and neither can they at this time.  When the exception is logged, it is always surrounding our \"user content\" indexes that are defined something like this:\r\n```\r\nPUT my_index_v1\r\n{\r\n  \"settings\": {\r\n    \"number_of_shards\": 20\r\n  },\r\n  \"mappings\": {\r\n    \"my_type\": {\r\n      \"dynamic\": \"strict\",\r\n```\r\nwithin these, we have regular fields, nested fields, object fields, multi-fields, etc. but nothing I'd expect is too crazy.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375817807","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-375817807","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":375817807,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTgxNzgwNw==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-03-23T22:46:04Z","updated_at":"2018-03-23T22:46:04Z","author_association":"CONTRIBUTOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375818275","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-375818275","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":375818275,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTgxODI3NQ==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-03-23T22:48:51Z","updated_at":"2018-03-23T22:48:51Z","author_association":"CONTRIBUTOR","body":"@tdoman this is interesting, indeed.\r\n\r\nWould you mind sharing your full mapping\r\n\r\nand an appropriately redacted source of your document `my_index_v1/my_type/3288128`\r\n\r\nI am having trouble seeing how it is possible that we picked up this field as if it had a terms vector, but \r\nturned out not to.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376720471","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-376720471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":376720471,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjcyMDQ3MQ==","user":{"login":"tdoman","id":11098266,"node_id":"MDQ6VXNlcjExMDk4MjY2","avatar_url":"https://avatars1.githubusercontent.com/u/11098266?v=4","gravatar_id":"","url":"https://api.github.com/users/tdoman","html_url":"https://github.com/tdoman","followers_url":"https://api.github.com/users/tdoman/followers","following_url":"https://api.github.com/users/tdoman/following{/other_user}","gists_url":"https://api.github.com/users/tdoman/gists{/gist_id}","starred_url":"https://api.github.com/users/tdoman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdoman/subscriptions","organizations_url":"https://api.github.com/users/tdoman/orgs","repos_url":"https://api.github.com/users/tdoman/repos","events_url":"https://api.github.com/users/tdoman/events{/privacy}","received_events_url":"https://api.github.com/users/tdoman/received_events","type":"User","site_admin":false},"created_at":"2018-03-28T00:36:16Z","updated_at":"2018-03-28T00:36:16Z","author_association":"NONE","body":"Yeah, I'd be willing to provide you a non-redacted version of our template, one of our mappings that's involved in this problem, and a sample source document if I can send it directly to your e-mail instead of including them here.  Meanwhile, let me give you some additional detail from what I'm seeing.  The indexes involved in this are always our \"user\" indexes (as opposed to other indexes) and have 20 shards each instead of the default 5.  Also, sometimes we'll search these indexes w/ a routing argument and sometimes not.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/378107151","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-378107151","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":378107151,"node_id":"MDEyOklzc3VlQ29tbWVudDM3ODEwNzE1MQ==","user":{"login":"tdoman","id":11098266,"node_id":"MDQ6VXNlcjExMDk4MjY2","avatar_url":"https://avatars1.githubusercontent.com/u/11098266?v=4","gravatar_id":"","url":"https://api.github.com/users/tdoman","html_url":"https://github.com/tdoman","followers_url":"https://api.github.com/users/tdoman/followers","following_url":"https://api.github.com/users/tdoman/following{/other_user}","gists_url":"https://api.github.com/users/tdoman/gists{/gist_id}","starred_url":"https://api.github.com/users/tdoman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdoman/subscriptions","organizations_url":"https://api.github.com/users/tdoman/orgs","repos_url":"https://api.github.com/users/tdoman/repos","events_url":"https://api.github.com/users/tdoman/events{/privacy}","received_events_url":"https://api.github.com/users/tdoman/received_events","type":"User","site_admin":false},"created_at":"2018-04-03T02:22:55Z","updated_at":"2018-04-03T02:22:55Z","author_association":"NONE","body":"@talevy Can I e-mail you the details?  We're seeing some intermittent problems that I wonder if they are related to this.  As I was mentioning, I'd be happy to provide unredacted files directly to you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383403082","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-383403082","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":383403082,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzQwMzA4Mg==","user":{"login":"tdoman","id":11098266,"node_id":"MDQ6VXNlcjExMDk4MjY2","avatar_url":"https://avatars1.githubusercontent.com/u/11098266?v=4","gravatar_id":"","url":"https://api.github.com/users/tdoman","html_url":"https://github.com/tdoman","followers_url":"https://api.github.com/users/tdoman/followers","following_url":"https://api.github.com/users/tdoman/following{/other_user}","gists_url":"https://api.github.com/users/tdoman/gists{/gist_id}","starred_url":"https://api.github.com/users/tdoman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdoman/subscriptions","organizations_url":"https://api.github.com/users/tdoman/orgs","repos_url":"https://api.github.com/users/tdoman/repos","events_url":"https://api.github.com/users/tdoman/events{/privacy}","received_events_url":"https://api.github.com/users/tdoman/received_events","type":"User","site_admin":false},"created_at":"2018-04-22T18:43:27Z","updated_at":"2018-04-22T18:43:38Z","author_association":"NONE","body":"@talevy @jbaiera anything I can do to move this investigation along and get you the information you need for this issue?  These `TransportShardMultiTermsVectorAction` severely clutter our logs and I'm not still sure of the impact but, as I've said, it only happens on our \"user\" indexes which have 20 shards each.  I did a little more research into `_termvectors` which looks like a pretty cool feature but alas, we do not use them in our application unless the C# .NET NEST library does something w/ them under the covers.  I tried some manual `_termvectors` and `_mtermvectors` queries which worked just fine (ie. they returned results which looked fine, no exceptions).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400713112","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-400713112","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":400713112,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDcxMzExMg==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-06-27T15:19:35Z","updated_at":"2018-06-27T15:19:35Z","author_association":"CONTRIBUTOR","body":"hi @tdoman, apologies for letting this fall through the cracks for such a long time. How has your usage changed since this experience; are you still running into this issue?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400865237","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-400865237","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":400865237,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDg2NTIzNw==","user":{"login":"tdoman","id":11098266,"node_id":"MDQ6VXNlcjExMDk4MjY2","avatar_url":"https://avatars1.githubusercontent.com/u/11098266?v=4","gravatar_id":"","url":"https://api.github.com/users/tdoman","html_url":"https://github.com/tdoman","followers_url":"https://api.github.com/users/tdoman/followers","following_url":"https://api.github.com/users/tdoman/following{/other_user}","gists_url":"https://api.github.com/users/tdoman/gists{/gist_id}","starred_url":"https://api.github.com/users/tdoman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdoman/subscriptions","organizations_url":"https://api.github.com/users/tdoman/orgs","repos_url":"https://api.github.com/users/tdoman/repos","events_url":"https://api.github.com/users/tdoman/events{/privacy}","received_events_url":"https://api.github.com/users/tdoman/received_events","type":"User","site_admin":false},"created_at":"2018-06-27T23:46:32Z","updated_at":"2018-06-27T23:46:32Z","author_association":"NONE","body":"Thanks @talevy, I just reviewed my logs and I haven't seen that occur for over a month.  That is as mysterious as the source of the exception in the first place.  Perhaps a process we had accessing ES has changed but our version of ES hasn't.  For now, I'll go ahead and close this issue and reopen it if I discover it happening again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400866030","html_url":"https://github.com/elastic/elasticsearch/issues/28642#issuecomment-400866030","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28642","id":400866030,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDg2NjAzMA==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-06-27T23:51:22Z","updated_at":"2018-06-27T23:51:22Z","author_association":"CONTRIBUTOR","body":"glad to hear it hasn't been an issue for you! 👍 ","performed_via_github_app":null}]