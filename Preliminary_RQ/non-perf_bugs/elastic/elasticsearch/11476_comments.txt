[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109214654","html_url":"https://github.com/elastic/elasticsearch/issues/11476#issuecomment-109214654","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11476","id":109214654,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTIxNDY1NA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-06-05T09:19:29Z","updated_at":"2015-06-05T09:19:29Z","author_association":"MEMBER","body":"hey there,\n\na couple of questions here:\n- Does this also happen, when you dont run it on a scripted field?\n- Can you share the queries, that kibana executes (kibana allows you to show the full query)?\n- Most importantly, do you have the chance to provide us the data which causes this problem? Can you provide a snapshot if the data is not too sensitive or help us creating a dataset that reproduces the problem?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109260991","html_url":"https://github.com/elastic/elasticsearch/issues/11476#issuecomment-109260991","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11476","id":109260991,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTI2MDk5MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-05T11:21:35Z","updated_at":"2015-06-05T11:21:35Z","author_association":"CONTRIBUTOR","body":"Also wondering if some documents have multiple values in one field?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109745238","html_url":"https://github.com/elastic/elasticsearch/issues/11476#issuecomment-109745238","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11476","id":109745238,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTc0NTIzOA==","user":{"login":"yehosef","id":149253,"node_id":"MDQ6VXNlcjE0OTI1Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/149253?v=4","gravatar_id":"","url":"https://api.github.com/users/yehosef","html_url":"https://github.com/yehosef","followers_url":"https://api.github.com/users/yehosef/followers","following_url":"https://api.github.com/users/yehosef/following{/other_user}","gists_url":"https://api.github.com/users/yehosef/gists{/gist_id}","starred_url":"https://api.github.com/users/yehosef/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yehosef/subscriptions","organizations_url":"https://api.github.com/users/yehosef/orgs","repos_url":"https://api.github.com/users/yehosef/repos","events_url":"https://api.github.com/users/yehosef/events{/privacy}","received_events_url":"https://api.github.com/users/yehosef/received_events","type":"User","site_admin":false},"created_at":"2015-06-07T12:07:06Z","updated_at":"2015-06-07T13:26:50Z","author_association":"NONE","body":"@spinscale \n1) - I don't know if it's happens on a non-scripted field - I don't have any fields that are always the same ratio of another field for comparison\n\n2)  https://gist.github.com/yehosef/f96dc491bcd5ee9bf7d3 is the query\nI also included the index template - perhaps it's related to doc_values.  \n\n3) I'm not sure if I can share the data right now - if you contact me at my name at gmail, I can probably give you temp access to the marvel/kibana install. Because store is off for everything, you can't see the values but it might help in the debug.  If that doesn't help we can look at giving access to the data.\n\nTo give some background - this is a testing server to test load/capabilities for a server.  We have storing all fields to \"off\" and are using doc_values.  It's a single 16G machine with 8G heap - 220M rows, ~60G storage.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109756246","html_url":"https://github.com/elastic/elasticsearch/issues/11476#issuecomment-109756246","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11476","id":109756246,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTc1NjI0Ng==","user":{"login":"yehosef","id":149253,"node_id":"MDQ6VXNlcjE0OTI1Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/149253?v=4","gravatar_id":"","url":"https://api.github.com/users/yehosef","html_url":"https://github.com/yehosef","followers_url":"https://api.github.com/users/yehosef/followers","following_url":"https://api.github.com/users/yehosef/following{/other_user}","gists_url":"https://api.github.com/users/yehosef/gists{/gist_id}","starred_url":"https://api.github.com/users/yehosef/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yehosef/subscriptions","organizations_url":"https://api.github.com/users/yehosef/orgs","repos_url":"https://api.github.com/users/yehosef/repos","events_url":"https://api.github.com/users/yehosef/events{/privacy}","received_events_url":"https://api.github.com/users/yehosef/received_events","type":"User","site_admin":false},"created_at":"2015-06-07T13:25:14Z","updated_at":"2015-06-07T13:25:14Z","author_association":"NONE","body":"@clintongormley  - I'm pretty sure that it doesn't.  We're importing Mixpanel data and you don't have arrays in that data set.  We have found chunks of our import data that was truncated - but I think that would result in broken json and just wouldn't import those lines.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/111500581","html_url":"https://github.com/elastic/elasticsearch/issues/11476#issuecomment-111500581","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11476","id":111500581,"node_id":"MDEyOklzc3VlQ29tbWVudDExMTUwMDU4MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-12T13:54:28Z","updated_at":"2015-06-12T13:54:28Z","author_association":"CONTRIBUTOR","body":"@yehosef broken JSON can well end up with bad results.  Our JSON parser is too lenient (fixed in 2.0) so only part of the JSON document might have been indexed.  It'd be worth comparing doc counts for the buckets with funny averages with buckets with good averages.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/111740687","html_url":"https://github.com/elastic/elasticsearch/issues/11476#issuecomment-111740687","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11476","id":111740687,"node_id":"MDEyOklzc3VlQ29tbWVudDExMTc0MDY4Nw==","user":{"login":"yehosef","id":149253,"node_id":"MDQ6VXNlcjE0OTI1Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/149253?v=4","gravatar_id":"","url":"https://api.github.com/users/yehosef","html_url":"https://github.com/yehosef","followers_url":"https://api.github.com/users/yehosef/followers","following_url":"https://api.github.com/users/yehosef/following{/other_user}","gists_url":"https://api.github.com/users/yehosef/gists{/gist_id}","starred_url":"https://api.github.com/users/yehosef/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yehosef/subscriptions","organizations_url":"https://api.github.com/users/yehosef/orgs","repos_url":"https://api.github.com/users/yehosef/repos","events_url":"https://api.github.com/users/yehosef/events{/privacy}","received_events_url":"https://api.github.com/users/yehosef/received_events","type":"User","site_admin":false},"created_at":"2015-06-13T19:01:11Z","updated_at":"2015-06-13T19:01:11Z","author_association":"NONE","body":"It's hard for me to think that's the problem. There would have been one broken record per day (the last one) and even if it's broken how could that affect a computed field?  Whatever bad value there was would have been doubled.  And how would it only affect avg but not sum?  \n\nBut I'll investigated further and check with other data sources. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/111830289","html_url":"https://github.com/elastic/elasticsearch/issues/11476#issuecomment-111830289","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11476","id":111830289,"node_id":"MDEyOklzc3VlQ29tbWVudDExMTgzMDI4OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-14T14:21:13Z","updated_at":"2015-06-14T14:21:13Z","author_association":"CONTRIBUTOR","body":"OK. I've indexed 100,000 documents with a timestamp and a number, and repeated your experiment.  The avg and sum lines are exactly equal. Then I added 10,000 documents with just a timestamp.  The sum line remains flat and the avg line shows differences.  So the difference that you are seeing is a result of your broken JSON, where some documents are missing values for this field (but the doc count is still taken into account when calculating the average).\n\nThis is not a bug.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/111841185","html_url":"https://github.com/elastic/elasticsearch/issues/11476#issuecomment-111841185","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11476","id":111841185,"node_id":"MDEyOklzc3VlQ29tbWVudDExMTg0MTE4NQ==","user":{"login":"yehosef","id":149253,"node_id":"MDQ6VXNlcjE0OTI1Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/149253?v=4","gravatar_id":"","url":"https://api.github.com/users/yehosef","html_url":"https://github.com/yehosef","followers_url":"https://api.github.com/users/yehosef/followers","following_url":"https://api.github.com/users/yehosef/following{/other_user}","gists_url":"https://api.github.com/users/yehosef/gists{/gist_id}","starred_url":"https://api.github.com/users/yehosef/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yehosef/subscriptions","organizations_url":"https://api.github.com/users/yehosef/orgs","repos_url":"https://api.github.com/users/yehosef/repos","events_url":"https://api.github.com/users/yehosef/events{/privacy}","received_events_url":"https://api.github.com/users/yehosef/received_events","type":"User","site_admin":false},"created_at":"2015-06-14T15:27:56Z","updated_at":"2015-06-14T15:27:56Z","author_association":"NONE","body":"thanks for looking into this - interesting.    \n","performed_via_github_app":null}]