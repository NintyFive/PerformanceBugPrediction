{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/62891","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62891/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62891/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62891/events","html_url":"https://github.com/elastic/elasticsearch/issues/62891","id":708305487,"node_id":"MDU6SXNzdWU3MDgzMDU0ODc=","number":62891,"title":"Default lifecycle policy affects system indices","user":{"login":"mutt13y","id":39803837,"node_id":"MDQ6VXNlcjM5ODAzODM3","avatar_url":"https://avatars3.githubusercontent.com/u/39803837?v=4","gravatar_id":"","url":"https://api.github.com/users/mutt13y","html_url":"https://github.com/mutt13y","followers_url":"https://api.github.com/users/mutt13y/followers","following_url":"https://api.github.com/users/mutt13y/following{/other_user}","gists_url":"https://api.github.com/users/mutt13y/gists{/gist_id}","starred_url":"https://api.github.com/users/mutt13y/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mutt13y/subscriptions","organizations_url":"https://api.github.com/users/mutt13y/orgs","repos_url":"https://api.github.com/users/mutt13y/repos","events_url":"https://api.github.com/users/mutt13y/events{/privacy}","received_events_url":"https://api.github.com/users/mutt13y/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-09-24T16:19:18Z","updated_at":"2020-09-28T15:43:09Z","closed_at":"2020-09-28T15:43:09Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n7.9.1\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version “14.0.1” 2020-04-14\r\nOpenJDK Runtime Environment AdoptOpenJDK (build 14.0.1+7)\r\nOpenJDK 64-Bit Server VM AdoptOpenJDK (build 14.0.1+7, mixed mode, sharing)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nCentos7\r\n3.10.0-957.27.2.el7.x86_6\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nDefault index template with lifecycle policy applies to system indices\r\n\r\n**Steps to reproduce**:\r\n1. Create lifecycle policy with delete after N days\r\n2. Create index template to apply lifecycle and match '\\*'\r\n3. In reality perform some upgrade which creates a new system index, to test delete .kibana\r\n\r\nnow the new lifecycle policy is applied to .kibana and settings will be lost every N days\r\n\r\nThis is a latent issue since most system indices will be created before the template in normal operation but after an upgrade the index can be replaced and so the policy is applied.\r\n\r\nI think that '\\*' should not match indices that start with a '.' we should have to explicitly use '.\\*' or have a flag to indicate if it applies to system indices.\r\n\r\nCertianly from an end user perspective there seems to be nothing obviously wrong with defining a catchall template with an aggressive lifecycle policy\r\n![Screenshot 2020-09-24 at 16 14 20](https://user-images.githubusercontent.com/39803837/94171776-957a0d00-fe89-11ea-8f6e-2aa05252bb12.png)\r\n![Screenshot 2020-09-24 at 17 13 20](https://user-images.githubusercontent.com/39803837/94171804-9ca11b00-fe89-11ea-854a-ec599b2e0a06.png)\r\n\r\n\r\nP.S.\r\nWork around is to create a policy matching \".\\*\" with a lower priority","closed_by":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"performed_via_github_app":null}