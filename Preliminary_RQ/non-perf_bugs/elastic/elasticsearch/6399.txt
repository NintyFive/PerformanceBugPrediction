{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6399","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6399/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6399/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6399/events","html_url":"https://github.com/elastic/elasticsearch/issues/6399","id":34892023,"node_id":"MDU6SXNzdWUzNDg5MjAyMw==","number":6399,"title":"Completion mapping type throws a misleading error on null value","user":{"login":"metysj","id":2246218,"node_id":"MDQ6VXNlcjIyNDYyMTg=","avatar_url":"https://avatars1.githubusercontent.com/u/2246218?v=4","gravatar_id":"","url":"https://api.github.com/users/metysj","html_url":"https://github.com/metysj","followers_url":"https://api.github.com/users/metysj/followers","following_url":"https://api.github.com/users/metysj/following{/other_user}","gists_url":"https://api.github.com/users/metysj/gists{/gist_id}","starred_url":"https://api.github.com/users/metysj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/metysj/subscriptions","organizations_url":"https://api.github.com/users/metysj/orgs","repos_url":"https://api.github.com/users/metysj/repos","events_url":"https://api.github.com/users/metysj/events{/privacy}","received_events_url":"https://api.github.com/users/metysj/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111540092,"node_id":"MDU6TGFiZWwxMTE1NDAwOTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.4.0.Beta1","name":"v1.4.0.Beta1","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"assignees":[{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2014-06-03T18:39:27Z","updated_at":"2014-08-01T19:26:08Z","closed_at":"2014-08-01T19:26:08Z","author_association":"NONE","active_lock_reason":null,"body":"When a field is null, the completion mapping parser throws an error but it refers to the next field in the document, not the field with the completion type.\n\nAnother user had the same issue and reported it on your google group, but I don't see it here in the bug tracker. Here's the link he provided to reproduce the issue: \n\nhttps://gist.github.com/glade-at-gigwell/6408e0e4b69ddf2e8856\n\nAnd the stack trace:\n\n```\n {\"acknowledged\":true}[2014-05-18 13:40:24,150][INFO ][cluster.metadata         ] [Aelfyre Whitemane] [completion_type_cant_handle_the_null_truth] creating index, cause [api], shards [1]/[0], mappings []\n {\"acknowledged\":true}[2014-05-18 13:40:24,224][INFO ][cluster.metadata         ] [Aelfyre Whitemane] [completion_type_cant_handle_the_null_truth] create_mapping [object]\n {\"acknowledged\":true}[2014-05-18 13:40:24,245][INFO ][cluster.metadata         ] [Aelfyre Whitemane] [completion_type_cant_handle_the_null_truth] update_mapping [object] (dynamic)\n {\"_index\":\"completion_type_cant_handle_the_null_truth\",\"_type\":\"object\",\"_id\":\"1\",\"_version\":1,\"created\":true}[2014-05-18 13:40:24,265][DEBUG][action.index             ] [Aelfyre Whitemane] [completion_type_cant_handle_the_null_truth][0], node[k4lbsgzYSlWzynQkVGqMaw], [P], s[STARTED]: Failed to execute [index      {[completion_type_cant_handle_the_null_truth][object][2], source[{\"field1\" : null,\"field2\" : \"nulls make me sad\"}]}]\n org.elasticsearch.index.mapper.MapperParsingException: failed to parse\nat org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:540)\nat org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:462)\nat      org.elasticsearch.index.shard.service.InternalIndexShard.prepareIndex(InternalIndexShard.java:384)\nat      org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:203)\nat      org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction.performOnPrimary(TransportShardReplicationOperationAction.java:556)\nat      org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$1.run(TransportShardReplicationOperationAction.java:426)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\nat java.lang.Thread.run(Thread.java:744)\n Caused by: org.elasticsearch.ElasticsearchIllegalArgumentException: Unknown field name[field2], must be one of [payload, input, weight, output]\nat      org.elasticsearch.index.mapper.core.CompletionFieldMapper.parse(CompletionFieldMapper.java:237)\nat      org.elasticsearch.index.mapper.object.ObjectMapper.serializeNullValue(ObjectMapper.java:505)\nat org.elasticsearch.index.mapper.object.ObjectMapper.parse(ObjectMapper.java:465)\nat org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:515)\n... 8 more\n```\n","closed_by":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}