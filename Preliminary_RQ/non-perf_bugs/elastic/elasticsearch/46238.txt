{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/46238","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46238/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46238/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46238/events","html_url":"https://github.com/elastic/elasticsearch/issues/46238","id":488201375,"node_id":"MDU6SXNzdWU0ODgyMDEzNzU=","number":46238,"title":"Java HighLevelRestClient back-compatibility issue for type, auto_generate_synonyms_phrase_query","user":{"login":"Kabhal","id":6772693,"node_id":"MDQ6VXNlcjY3NzI2OTM=","avatar_url":"https://avatars3.githubusercontent.com/u/6772693?v=4","gravatar_id":"","url":"https://api.github.com/users/Kabhal","html_url":"https://github.com/Kabhal","followers_url":"https://api.github.com/users/Kabhal/followers","following_url":"https://api.github.com/users/Kabhal/following{/other_user}","gists_url":"https://api.github.com/users/Kabhal/gists{/gist_id}","starred_url":"https://api.github.com/users/Kabhal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kabhal/subscriptions","organizations_url":"https://api.github.com/users/Kabhal/orgs","repos_url":"https://api.github.com/users/Kabhal/repos","events_url":"https://api.github.com/users/Kabhal/events{/privacy}","received_events_url":"https://api.github.com/users/Kabhal/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-09-02T13:52:15Z","updated_at":"2019-09-02T15:08:46Z","closed_at":"2019-09-02T15:08:46Z","author_association":"NONE","active_lock_reason":null,"body":"Reopening of https://github.com/elastic/elasticsearch/issues/29374\r\n\r\nelasticsearch-rest-high-level-client is not back-compatible with older version **5.6.13** of ES (still used by OpenShift)  for at least 2 unsupported attributes :\r\n* `type` : `org.elasticsearch.client.ResponseException: method [POST], host [***], URI [/.kibana.*/_search?typed_keys=true&ignore_unavailable=false&expand_wildcards=open&allow_no_indices=true&ignore_throttled=true&scroll=20s&search_type=query_then_fetch&batched_reduce_size=512&ccs_minimize_roundtrips=true], status line [HTTP/1.1 400 Bad Request]\r\n{\"error\":{\"root_cause\":[{\"type\":\"parsing_exception\",\"reason\":\"[query_string] query does not support [type]\",\"line\":1,\"col\":287}],\"type\":\"parsing_exception\",\"reason\":\"[query_string] query does not support [type]\",\"line\":1,\"col\":287},\"status\":400}`\r\n* `auto_generate_synonyms_phrase_query` : `org.elasticsearch.client.ResponseException: method [POST], host [***], URI [/.kibana.*/_search?typed_keys=true&ignore_unavailable=false&expand_wildcards=open&allow_no_indices=true&ignore_throttled=true&scroll=20s&search_type=query_then_fetch&batched_reduce_size=512&ccs_minimize_roundtrips=true], status line [HTTP/1.1 400 Bad Request]\r\n{\"error\":{\"root_cause\":[{\"type\":\"parsing_exception\",\"reason\":\"[query_string] query does not support [auto_generate_synonyms_phrase_query]\",\"line\":1,\"col\":533}],\"type\":\"parsing_exception\",\"reason\":\"[query_string] query does not support [auto_generate_synonyms_phrase_query]\",\"line\":1,\"col\":533},\"status\":400}`\r\n\r\nAt least the following clients are not compatible :\r\n* 'org.elasticsearch.client:elasticsearch-rest-high-level-client:6.7.0'\r\n* 'org.elasticsearch.client:elasticsearch-rest-high-level-client:7.3.1'\r\n\r\nElasticSearch server version : 5.6.13\r\n\r\nCode extract to make the request with client 7.3.1 : \r\n```\r\nSearchSourceBuilder searchBuilder = new SearchSourceBuilder();\r\n\r\n      searchBuilder.sort(SEARCH_INDEX, SortOrder.ASC);\r\n      searchBuilder.query(boolQuery()\r\n                                .must(rangeQuery(SEARCH_INDEX)\r\n                                            .format(DATE_FORMAT)\r\n                                            .from(formattedDate(fromDate, DATE_FORMAT))\r\n                                            .to(formattedDate(toDate, DATE_FORMAT)))\r\n                                .must(queryStringQuery(query)\r\n                                            .analyzeWildcard(true)\r\n                                            .defaultField(\"*\")\r\n                                            .defaultOperator(Operator.AND)));\r\n      searchBuilder.size(PAGE_SIZE);\r\n\r\n      return new SearchRequest(INDEX).source(searchBuilder).scroll(SCROLL_TIMEOUT);\r\n```","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}