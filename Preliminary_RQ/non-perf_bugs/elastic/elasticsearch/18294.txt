{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18294","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18294/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18294/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18294/events","html_url":"https://github.com/elastic/elasticsearch/issues/18294","id":154523629,"node_id":"MDU6SXNzdWUxNTQ1MjM2Mjk=","number":18294,"title":"Cluster will not automatically assign shards","user":{"login":"alicegoldfuss","id":4809374,"node_id":"MDQ6VXNlcjQ4MDkzNzQ=","avatar_url":"https://avatars3.githubusercontent.com/u/4809374?v=4","gravatar_id":"","url":"https://api.github.com/users/alicegoldfuss","html_url":"https://github.com/alicegoldfuss","followers_url":"https://api.github.com/users/alicegoldfuss/followers","following_url":"https://api.github.com/users/alicegoldfuss/following{/other_user}","gists_url":"https://api.github.com/users/alicegoldfuss/gists{/gist_id}","starred_url":"https://api.github.com/users/alicegoldfuss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alicegoldfuss/subscriptions","organizations_url":"https://api.github.com/users/alicegoldfuss/orgs","repos_url":"https://api.github.com/users/alicegoldfuss/repos","events_url":"https://api.github.com/users/alicegoldfuss/events{/privacy}","received_events_url":"https://api.github.com/users/alicegoldfuss/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":33,"created_at":"2016-05-12T16:18:02Z","updated_at":"2018-02-13T19:28:06Z","closed_at":"2016-05-12T23:23:34Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.2.1\n\n**JVM version**:  java version \"1.8.0_31\"\nJava(TM) SE Runtime Environment (build 1.8.0_31-b13)\nJava HotSpot(TM) 64-Bit Server VM (build 25.31-b07, mixed mode)\n\n**OS version**: CentOS release 6.7 (Final)\n\n**Description of the problem including expected versus actual behavior**:\n\nThanks in advance for your help.\n\nI inherited a poorly-behaving Elasticsearch cluster that I've been tuning on and off for a few months. Some things have improved, others have not.\n\nAbout a month ago, another team needed to reboot the (AWS hosted) nodes. I turned off shard allocation in the cluster with an API call and got a success response. However, it didn't take. So I also turned off allocation in kopf. But, rebooting a node caused shards to be allocated anyway. So we rebooted one box per day and let the cluster rebalance each time.\n\nSome time after the reboots, I noticed the cluster was still yellow. It had stopped allocating shards. I figured the API call had finally taken, so I turned allocation back on (and got another success message). According to kopf, allocation is enabled. But the cluster did not automatically assign shards.\n\nI tried toggling shard allocation on and off with both kopf and the API. But the cluster would not allocate shards.\n\nI complained about this on Twitter and an Elastic employee recommended upgrading. So, I upgraded the cluster from 1.5.2 to 2.2.1. However, the behavior persists.\n\nIf I assign shards manually with the API, they allocate just fine.\n\n**Steps to reproduce**:\n1. Turn off shard allocation with API call and kopf\n2. Turn on shard allocation with API call and kopf\n3. Cry a lot\n\n**Provide logs (if relevant)**: I didn't see any relevant logs, but if you tell me what to look for I can grep. I'm happy to gather diagnostics for you, but please note that I no longer own this cluster as of 3pm PDT Friday.\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}