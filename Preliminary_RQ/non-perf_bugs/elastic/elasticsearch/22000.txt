{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22000","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22000/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22000/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22000/events","html_url":"https://github.com/elastic/elasticsearch/issues/22000","id":193807097,"node_id":"MDU6SXNzdWUxOTM4MDcwOTc=","number":22000,"title":"Snapshot in ABORTED state after rolling restart of nodes","user":{"login":"desagar","id":18707115,"node_id":"MDQ6VXNlcjE4NzA3MTE1","avatar_url":"https://avatars3.githubusercontent.com/u/18707115?v=4","gravatar_id":"","url":"https://api.github.com/users/desagar","html_url":"https://github.com/desagar","followers_url":"https://api.github.com/users/desagar/followers","following_url":"https://api.github.com/users/desagar/following{/other_user}","gists_url":"https://api.github.com/users/desagar/gists{/gist_id}","starred_url":"https://api.github.com/users/desagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/desagar/subscriptions","organizations_url":"https://api.github.com/users/desagar/orgs","repos_url":"https://api.github.com/users/desagar/repos","events_url":"https://api.github.com/users/desagar/events{/privacy}","received_events_url":"https://api.github.com/users/desagar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2016-12-06T15:47:49Z","updated_at":"2016-12-06T23:27:33Z","closed_at":"2016-12-06T23:27:33Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**: 2.3.1\r\n\r\n**Plugins installed**: [a custom repository plugin]\r\n\r\n**JVM version**: 1.8.0_101\r\n\r\n**OS version**: Oracle Enterprise Linux 6 with Redhat kernel\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWe have a 2 node Elasticsearch cluster, and we have installed a custom repository plugin that is used for storing Elasticsearch snapshots. The custom plugin has a bug that occasionally causes it to hang indefinitely waiting for a connection to the back-end store for our snapshots. When this happened, we performed a rolling restart of the Elasticsearch cluster to clear the hanging thread. After the restart, we ended up with a state where the snapshot is in ABORTED status according to ES cluster state.  However when querying the snapshot using the snapshot API, it reports that the snapshot is still in progress. As a result we are unable to take any further snapshots.\r\nAccording to [this link](https://github.com/elastic/elasticsearch/pull/11450), snapshots in ABORTED status should be cleaned up when the master node is restarted. \r\n\r\n**Steps to reproduce**:\r\nWorking on a reproducer - will provide I have one.\r\n\r\n**Provide logs (if relevant)**:\r\nPlease see attached files of cluster state and snapshot status.\r\n[snapshot_status.txt](https://github.com/elastic/elasticsearch/files/634279/snapshot_status.txt) : output of /_snapshot/ppmgmt1645/snapshot_20161130_042001?pretty=true\r\n\r\n\r\n","closed_by":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"performed_via_github_app":null}