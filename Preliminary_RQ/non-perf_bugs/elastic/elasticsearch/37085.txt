{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37085","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37085/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37085/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37085/events","html_url":"https://github.com/elastic/elasticsearch/issues/37085","id":395351939,"node_id":"MDU6SXNzdWUzOTUzNTE5Mzk=","number":37085,"title":"Document and/or gracefully fail creating invalid ILM policies in mixed-cluster","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"labels":[{"id":912828538,"node_id":"MDU6TGFiZWw5MTI4Mjg1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/ILM+SLM","name":":Core/Features/ILM+SLM","color":"0e8a16","default":false,"description":"Index and Snapshot lifecycle management"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"assignees":[{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-01-02T19:24:54Z","updated_at":"2019-02-05T01:00:40Z","closed_at":"2019-02-05T01:00:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Problem Context**\r\n\r\nWhile operating a mixed-version cluster where the master node version contains new lifecycle actions \r\nthat previously didn't exist, there can be non-friendly failures.\r\n\r\nCreating policies with newly introduced actions will result in success on the master, but then \r\ncan either fail when hitting ILM apis from older coordinating nodes, or running unsupported actions \r\non other nodes.\r\n\r\nTwo scenarios:\r\n\r\n1. Requesting policy from older node:\r\n\r\n```\r\n{\"error\":{\"root_cause\":[{\"type\":\"transport_serialization_exception\",\"reason\":\"Failed to deserialize response from handler [org.elasticsearch.transport.TransportService$Con\r\ntextRestoreResponseHandler]\"}],\"type\":\"transport_serialization_exception\",\"reason\":\"Failed to deserialize response from handler [org.elasticsearch.transport.TransportServi\r\nce$ContextRestoreResponseHandler]\",\"caused_by\":{\"type\":\"illegal_argument_exception\",\"reason\":\"Unknown NamedWriteable [org.elasticsearch.xpack.core.indexlifecycle.Lifecycle\r\nAction][freeze]\"}},\"status\":500}\r\n```\r\n\r\n2. Executing new lifecycle action that hits APIs that do not exist in older nodes\r\n\r\n**Solution**\r\n\r\nThere needs to be more guidance on how to best manage new policies while operating mixed clusters. It should be recommended to disable ILM while a rolling-upgrade is in progress. This would avoid these unintuitive errors.\r\n\r\nIn addition to better guidance in documentation, it may make sense to disallow creation of these invalid policies while in mixed-clusters and explain the situation to the user.","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}