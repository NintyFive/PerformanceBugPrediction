{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10317","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10317/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10317/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10317/events","html_url":"https://github.com/elastic/elasticsearch/issues/10317","id":65207118,"node_id":"MDU6SXNzdWU2NTIwNzExOA==","number":10317,"title":"Catch exceptions from cluster state listeners when they are notified?","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-03-30T13:05:41Z","updated_at":"2015-12-08T17:15:47Z","closed_at":"2015-12-08T17:15:47Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When the cluster state service is closed then all listeners are notified. We currently do not handle unchecked Exceptions that are thrown when `ObserverClusterStateListener.onClose()` is called, see for example https://github.com/elastic/elasticsearch/blob/master/src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java#L167 . This might be trappy because it means that all listeners that come after one that caused an exception will not be notified and code after listener notification will not be executed as well. I ran into this in https://github.com/elastic/elasticsearch/pull/10172 : custom implementation of `onClose()` caused a `EsRejectedExecutionException` which then caused thread leaks in tests because the exception was not caught. \n\nShould we always handle unchecked exceptions in general when we notify listeners?\n","closed_by":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"performed_via_github_app":null}