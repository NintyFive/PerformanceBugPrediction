{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53687","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53687/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53687/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53687/events","html_url":"https://github.com/elastic/elasticsearch/issues/53687","id":583212277,"node_id":"MDU6SXNzdWU1ODMyMTIyNzc=","number":53687,"title":"[ML] Writing Results Retries Continue After Analytics Job Stopped","user":{"login":"blaklaybul","id":3654928,"node_id":"MDQ6VXNlcjM2NTQ5Mjg=","avatar_url":"https://avatars1.githubusercontent.com/u/3654928?v=4","gravatar_id":"","url":"https://api.github.com/users/blaklaybul","html_url":"https://github.com/blaklaybul","followers_url":"https://api.github.com/users/blaklaybul/followers","following_url":"https://api.github.com/users/blaklaybul/following{/other_user}","gists_url":"https://api.github.com/users/blaklaybul/gists{/gist_id}","starred_url":"https://api.github.com/users/blaklaybul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blaklaybul/subscriptions","organizations_url":"https://api.github.com/users/blaklaybul/orgs","repos_url":"https://api.github.com/users/blaklaybul/repos","events_url":"https://api.github.com/users/blaklaybul/events{/privacy}","received_events_url":"https://api.github.com/users/blaklaybul/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"assignees":[{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-03-17T18:26:33Z","updated_at":"2020-03-19T15:15:56Z","closed_at":"2020-03-19T15:15:56Z","author_association":"NONE","active_lock_reason":null,"body":"This was found on a recent 7.7 build. I created a classification analysis that became stuck in the `writing_results` phase. \r\n\r\n```\r\n[2020-03-17T12:58:57,528][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [reba.lan] [openml-kr-vs-kp-classifier-0] [data_frame_analyzer/8755] [CBoostedTreeImpl.cc@241] Training finished after 18 iterations. Time per iteration in ms mean: 1287.84 std. dev:  2697.19\r\n[2020-03-17T12:58:57,626][INFO ][o.e.x.m.d.p.AnalyticsResultProcessor] [reba.lan] [openml-kr-vs-kp-classifier-0] Started writing results\r\n[2020-03-17T12:58:57,882][INFO ][o.e.c.m.MetaDataMappingService] [reba.lan] [openml-kr-vs-kp-classified-0/h_cT5mm3QSWfTv6b3ZBlTQ] update_mapping [_doc]\r\n[2020-03-17T12:58:58,149][WARN ][o.e.x.m.u.p.ResultsPersisterService] [reba.lan] [openml-kr-vs-kp-classifier-0] failed to index after [1] attempts. Will attempt again in [50ms].\r\n[2020-03-17T12:58:58,361][WARN ][o.e.x.m.u.p.ResultsPersisterService] [reba.lan] [openml-kr-vs-kp-classifier-0] failed to index after [2] attempts. Will attempt again in [75ms].\r\n[2020-03-17T12:58:58,570][WARN ][o.e.x.m.u.p.ResultsPersisterService] [reba.lan] [openml-kr-vs-kp-classifier-0] failed to index after [3] attempts. Will attempt again in [276ms].\r\n...lots more retires here...\r\n[2020-03-17T13:16:19,080][WARN ][o.e.x.m.u.p.ResultsPersisterService] [reba.lan] [openml-kr-vs-kp-classifier-0] failed to index after [15] attempts. Will attempt again in [846433ms]\r\n```\r\n\r\nStopping the job via the UI removed the job from the jobs list, but the job remains in a `stopping` state. The retires continue even after stopping the job:\r\n\r\n```\r\n[2020-03-17T13:44:24,643][INFO ][o.e.x.m.a.TransportStopDataFrameAnalyticsAction] [reba.lan] [openml-kr-vs-kp-classifier-0] Stopping task with force [true]\r\n[2020-03-17T13:44:24,668][INFO ][o.e.x.m.a.TransportStopDataFrameAnalyticsAction] [reba.lan] [openml-kr-vs-kp-classifier-0] Stopping task with force [true]\r\n[2020-03-17T13:44:24,669][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [reba.lan] [controller/6507] [CDetachedProcessSpawner.cc@177] Child process with PID 8755 was terminated by signal 15\r\n[2020-03-17T13:44:24,670][ERROR][o.e.x.m.p.l.CppLogMessageHandler] [reba.lan] [controller/6507] [CDetachedProcessSpawner.cc@99] Will not attempt to kill process 8755: not a child process\r\n[2020-03-17T13:44:24,670][ERROR][o.e.x.m.p.l.CppLogMessageHandler] [reba.lan] [controller/6507] [CCommandProcessor.cc@96] Failed to kill process with PID 8755\r\n[2020-03-17T13:45:13,300][WARN ][o.e.x.m.u.p.ResultsPersisterService] [reba.lan] [openml-kr-vs-kp-classifier-0] failed to index after [17] attempts. Will attempt again in [884782ms]\r\n.\r\n.\r\n.\r\n[2020-03-17T14:14:48,971][WARN ][o.e.x.m.u.p.ResultsPersisterService] [reba.lan] [openml-kr-vs-kp-classifier-0] failed to index after [19] attempts. Will attempt again in [850734ms]\r\n```\r\n\r\njob config:\r\n\r\n```\r\n{\r\n      \"id\" : \"openml-kr-vs-kp-classifier-0\",\r\n      \"source\" : {\r\n        \"index\" : [\r\n          \"openml-kr-vs-kp\"\r\n        ],\r\n        \"query\" : {\r\n          \"match_all\" : { }\r\n        }\r\n      },\r\n      \"dest\" : {\r\n        \"index\" : \"openml-kr-vs-kp-classified-0\",\r\n        \"results_field\" : \"ml\"\r\n      },\r\n      \"analysis\" : {\r\n        \"classification\" : {\r\n          \"dependent_variable\" : \"class\",\r\n          \"class_assignment_objective\" : \"maximize_accuracy\",\r\n          \"num_top_classes\" : 2,\r\n          \"prediction_field_name\" : \"class_prediction\",\r\n          \"training_percent\" : 90.0,\r\n          \"randomize_seed\" : 7077816937788972687\r\n        }\r\n      },\r\n      \"model_memory_limit\" : \"512mb\",\r\n      \"create_time\" : 1584464253331,\r\n      \"version\" : \"7.7.0\",\r\n      \"allow_lazy_start\" : false\r\n    }\r\n```","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}