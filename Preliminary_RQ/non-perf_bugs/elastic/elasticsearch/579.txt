{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/579","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/579/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/579/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/579/events","html_url":"https://github.com/elastic/elasticsearch/issues/579","id":498235,"node_id":"MDU6SXNzdWU0OTgyMzU=","number":579,"title":"Non-data master nodes and non-master data nodes fail to store data","user":{"login":"theborg","id":540617,"node_id":"MDQ6VXNlcjU0MDYxNw==","avatar_url":"https://avatars0.githubusercontent.com/u/540617?v=4","gravatar_id":"","url":"https://api.github.com/users/theborg","html_url":"https://github.com/theborg","followers_url":"https://api.github.com/users/theborg/followers","following_url":"https://api.github.com/users/theborg/following{/other_user}","gists_url":"https://api.github.com/users/theborg/gists{/gist_id}","starred_url":"https://api.github.com/users/theborg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theborg/subscriptions","organizations_url":"https://api.github.com/users/theborg/orgs","repos_url":"https://api.github.com/users/theborg/repos","events_url":"https://api.github.com/users/theborg/events{/privacy}","received_events_url":"https://api.github.com/users/theborg/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":66466,"node_id":"MDU6TGFiZWw2NjQ2Ng==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.14.2","name":"v0.14.2","color":"DDDDDD","default":false,"description":null},{"id":65354,"node_id":"MDU6TGFiZWw2NTM1NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.15.0","name":"v0.15.0","color":"ededed","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2010-12-30T03:29:34Z","updated_at":"2010-12-30T10:10:54Z","closed_at":"2010-12-30T10:10:54Z","author_association":"NONE","active_lock_reason":null,"body":"A non-master data node can successfully join a cluster, but fails on index creation.\nA non-data master is unable to store state between restarts.\n\nThe local gateway init seems to have a bug here:\ngateway/local/LocalGateway.java: lazyInitialize():\n        if (!clusterService.localNode().masterNode() || !clusterService.localNode().dataNode())\n==>\n        if (!clusterService.localNode().masterNode() &&!clusterService.localNode().dataNode()) \n\nThe second change involves more settings, and I am unsure what other implications it may have (and if things need to change elsewhere).  But at least this if statement cause problems:\n\nenv/NodeEnvironment.java: NodeEnvironment constructor:\nif (!settings.getAsBoolean(\"node.data\", true) || settings.getAsBoolean(\"node.client\", false) ||\n !settings.getAsBoolean(\"node.master\", true)) {  \n\nShould this just be  if(settings.getAsBoolean(\"node.client\", false))  instead  ?\n","closed_by":null,"performed_via_github_app":null}