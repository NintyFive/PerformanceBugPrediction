[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67949502","html_url":"https://github.com/elastic/elasticsearch/issues/9038#issuecomment-67949502","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9038","id":67949502,"node_id":"MDEyOklzc3VlQ29tbWVudDY3OTQ5NTAy","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-23T13:13:06Z","updated_at":"2014-12-23T13:13:06Z","author_association":"CONTRIBUTOR","body":"Hi @kaniini \n\nI'm completely out of my depth here, so I'll mark this ticket for discussion by others who may know a lot more than me about the topic, but could you provide more background info to help us? Why is linux's handling incorrect? How does the problem manifest itself in Elasticsearch? What changes should be made to Elasticsearch to fix it?\n\nthanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67971186","html_url":"https://github.com/elastic/elasticsearch/issues/9038#issuecomment-67971186","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9038","id":67971186,"node_id":"MDEyOklzc3VlQ29tbWVudDY3OTcxMTg2","user":{"login":"kaniini","id":1522444,"node_id":"MDQ6VXNlcjE1MjI0NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522444?v=4","gravatar_id":"","url":"https://api.github.com/users/kaniini","html_url":"https://github.com/kaniini","followers_url":"https://api.github.com/users/kaniini/followers","following_url":"https://api.github.com/users/kaniini/following{/other_user}","gists_url":"https://api.github.com/users/kaniini/gists{/gist_id}","starred_url":"https://api.github.com/users/kaniini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaniini/subscriptions","organizations_url":"https://api.github.com/users/kaniini/orgs","repos_url":"https://api.github.com/users/kaniini/repos","events_url":"https://api.github.com/users/kaniini/events{/privacy}","received_events_url":"https://api.github.com/users/kaniini/received_events","type":"User","site_admin":false},"created_at":"2014-12-23T16:42:17Z","updated_at":"2014-12-23T16:50:34Z","author_association":"NONE","body":"hello,\n\nso linux basically doesn't care about `somaxconn`, instead doing it's own thing.  `somaxconn` is the parameter you provide to listen(2), so in C you do something like this:\n\n``` c\nint s = socket(AF_INET, SOCK_STREAM, 0);\nbind(s, ...);\nlisten(s, 5);\n```\n\nthis creates a listener with a backlog length of 5.  this means that if the code is busy processing other things, and doesn't `accept()` the new connections fast enough, then the backlog is exceeded and the OS _might_ return `Connection refused` to the client.\n\nlinux just ignores the backlog and does some special stuff.  other OS like freebsd and solaris however use the backlog as a hard limit of allowed connections in the queue, which you can monitor using `netstat -La`.\n\nthe problem is manifested in elasticsearch when you cannot connect to elasticsearch anymore because the listen queue length was exceeded.  most likely you just need to change some parameters you are passing to netty, but i am unfamiliar with how netty works.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161749209","html_url":"https://github.com/elastic/elasticsearch/issues/9038#issuecomment-161749209","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9038","id":161749209,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTc0OTIwOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-12-03T19:05:49Z","updated_at":"2015-12-03T19:05:49Z","author_association":"CONTRIBUTOR","body":"@spinscale or any ideas about configuring the listener backlog via netty?  This looks related: https://github.com/netty/netty/issues/2407\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161788500","html_url":"https://github.com/elastic/elasticsearch/issues/9038#issuecomment-161788500","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9038","id":161788500,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTc4ODUwMA==","user":{"login":"kaniini","id":1522444,"node_id":"MDQ6VXNlcjE1MjI0NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522444?v=4","gravatar_id":"","url":"https://api.github.com/users/kaniini","html_url":"https://github.com/kaniini","followers_url":"https://api.github.com/users/kaniini/followers","following_url":"https://api.github.com/users/kaniini/following{/other_user}","gists_url":"https://api.github.com/users/kaniini/gists{/gist_id}","starred_url":"https://api.github.com/users/kaniini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaniini/subscriptions","organizations_url":"https://api.github.com/users/kaniini/orgs","repos_url":"https://api.github.com/users/kaniini/repos","events_url":"https://api.github.com/users/kaniini/events{/privacy}","received_events_url":"https://api.github.com/users/kaniini/received_events","type":"User","site_admin":false},"created_at":"2015-12-03T21:22:21Z","updated_at":"2015-12-03T21:22:21Z","author_association":"NONE","body":"that's interesting.  in this case, it may be possible to modify netty to check the sysctl table for the value, as it does on linux.\n\nin the meantime, http://turtle.dereferenced.org/~kaniini/freebsd-somaxconn.patch is a patch that can be applied to enforce a desired SOMAXCONN for all processes on freebsd 10...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/162458766","html_url":"https://github.com/elastic/elasticsearch/issues/9038#issuecomment-162458766","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9038","id":162458766,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MjQ1ODc2Ng==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-12-07T09:24:13Z","updated_at":"2015-12-07T09:24:13Z","author_association":"MEMBER","body":"setting the backlog seems to be a netty 4.0/1 feature only. I dont see anything that makes this work with netty 3.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/249872983","html_url":"https://github.com/elastic/elasticsearch/issues/9038#issuecomment-249872983","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9038","id":249872983,"node_id":"MDEyOklzc3VlQ29tbWVudDI0OTg3Mjk4Mw==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2016-09-27T13:59:03Z","updated_at":"2016-09-27T13:59:03Z","author_association":"MEMBER","body":"Now that we're on Netty 4 it sounds like this is possibly something we can accomplish, @spinscale do you know how to set it for Netty 4?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/249901924","html_url":"https://github.com/elastic/elasticsearch/issues/9038#issuecomment-249901924","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9038","id":249901924,"node_id":"MDEyOklzc3VlQ29tbWVudDI0OTkwMTkyNA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2016-09-27T15:33:01Z","updated_at":"2016-09-27T15:33:12Z","author_association":"MEMBER","body":"So, what can be set is the `ChannelOption.SO_BACKLOG` setting, but not the somaxconn setting, as it is read by netty4 either from the proc file system or assumed 128 to be by default, but there is no explicit possibility to set this. Closing\n","performed_via_github_app":null}]