[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255347430","html_url":"https://github.com/elastic/elasticsearch/issues/21061#issuecomment-255347430","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21061","id":255347430,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTM0NzQzMA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-10-21T10:24:59Z","updated_at":"2016-10-21T10:24:59Z","author_association":"MEMBER","body":"I can reproduce this on 2.4.1 but it seems to be fixed in 5.0. The NPE I see in the log with the above example on 2.4.1 is:\n\n```\n[...]\n    at org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:386)\n    at org.elasticsearch.action.search.SearchPhaseExecutionException.guessRootCauses(SearchPhaseExecutionException.java:152)\n    at org.elasticsearch.action.search.SearchPhaseExecutionException.getCause(SearchPhaseExecutionException.java:99)\n    at java.lang.Throwable.printStackTrace(Throwable.java:665)\n    at java.lang.Throwable.printStackTrace(Throwable.java:721)\n    at org.apache.log4j.DefaultThrowableRenderer.render(DefaultThrowableRenderer.java:60)\n    at org.apache.log4j.spi.ThrowableInformation.getThrowableStrRep(ThrowableInformation.java:87)\n    at org.apache.log4j.spi.LoggingEvent.getThrowableStrRep(LoggingEvent.java:413)\n    at org.apache.log4j.WriterAppender.subAppend(WriterAppender.java:313)\n    at org.apache.log4j.WriterAppender.append(WriterAppender.java:162)\n    at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:251)\n    at org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:66)\n    at org.apache.log4j.Category.callAppenders(Category.java:206)\n    at org.apache.log4j.Category.forcedLog(Category.java:391)\n    at org.apache.log4j.Category.log(Category.java:856)\n    at org.elasticsearch.common.logging.log4j.Log4jESLogger.internalWarn(Log4jESLogger.java:135)\n    at org.elasticsearch.common.logging.support.AbstractESLogger.warn(AbstractESLogger.java:109)\n    at org.elasticsearch.rest.BytesRestResponse.convert(BytesRestResponse.java:134)\n    at org.elasticsearch.rest.BytesRestResponse.<init>(BytesRestResponse.java:96)\n    at org.elasticsearch.rest.BytesRestResponse.<init>(BytesRestResponse.java:87)\n    at org.elasticsearch.rest.action.support.RestActionListener.onFailure(RestActionListener.java:60)\n    at org.elasticsearch.action.support.TransportAction$1.onFailure(TransportAction.java:95)\n    at org.elasticsearch.action.search.AbstractSearchAsyncAction.raiseEarlyFailure(AbstractSearchAsyncAction.java:294)\n    ... 10 more\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:251)\n    at org.elasticsearch.index.query.IndexQueryParserService.innerParse(IndexQueryParserService.java:320)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:223)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:218)\n    at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:856)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:667)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:633)\n    at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:472)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryFetchTransportHandler.messageReceived(SearchServiceTransportAction.java:392)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryFetchTransportHandler.messageReceived(SearchServiceTransportAction.java:389)\n    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:77)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    ... 3 more\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255444211","html_url":"https://github.com/elastic/elasticsearch/issues/21061#issuecomment-255444211","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21061","id":255444211,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTQ0NDIxMQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-10-21T19:14:01Z","updated_at":"2016-10-21T19:14:01Z","author_association":"MEMBER","body":"This is fixed now on the 2.4 branch with #21065. On 5.0 the problem doesn't appear any more due to a large change in the query parsing infrastructure.\n","performed_via_github_app":null}]