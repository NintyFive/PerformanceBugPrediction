[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321592531","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321592531","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321592531,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTU5MjUzMQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-08-10T15:49:33Z","updated_at":"2017-08-10T15:49:33Z","author_association":"MEMBER","body":"Also got a similar type of error with:\r\n\r\n```\r\n            SearchResponse response = elasticsearchClient.search(new SearchRequest(\"foo\").source(\r\n                    new SearchSourceBuilder()\r\n                            .size(0)\r\n                            .aggregation(AggregationBuilders.terms(\"folders\").field(\"path.virtual.tree\"))));\r\n```\r\n\r\nWhich gives once executed on a 5.5.1 cluster:\r\n\r\n```\r\n\tSuppressed: org.elasticsearch.client.ResponseException: GET http://127.0.0.1:9200/fscrawler_test_subdirs_deep_tree/_search?typed_keys=true&ignore_unavailable=false&expand_wildcards=open&allow_no_indices=true&search_type=query_then_fetch&batched_reduce_size=512: HTTP/1.1 500 Internal Server Error\r\n{\"error\":{\"root_cause\":[{\"type\":\"aggregation_execution_exception\",\"reason\":\"Invalid term-aggregator order path [_key]. Unknown aggregation [_key]\"}],\"type\":\"search_phase_execution_exception\",\"reason\":\"all shards failed\",\"phase\":\"query\",\"grouped\":true,\"failed_shards\":[{\"shard\":0,\"index\":\"fscrawler_test_subdirs_deep_tree\",\"node\":\"SvuZnFMQTKC37-QoAdB0ww\",\"reason\":{\"type\":\"aggregation_execution_exception\",\"reason\":\"Invalid term-aggregator order path [_key]. Unknown aggregation [_key]\"}}]},\"status\":500}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321780089","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321780089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321780089,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTc4MDA4OQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T10:34:19Z","updated_at":"2017-08-11T10:34:19Z","author_association":"MEMBER","body":"What is the purpose of using the 6.0 client to communicate with a 5.5 cluster? I think that is because we haven't released yet 5.6 hence the 5.6 client is not out yet?\r\n\r\nIn general, when upgrading a cluster one would upgrade all the nodes and then the client last, so forward compatibility is important, which is the opposite: 5.6 client that talks to 6.x cluster. Forward comp also works up to a certain point, the client cannot know about breaking changes made and new APIs that are added in 6.x.\r\n\r\nI suspect that if you try the same with any of our language clients, you would hit the same problem. A new client version is usually released with each major version of Elasticsearch, to address breaking changes and make the client 100% compatible with the new major.\r\n\r\nThe purpose of the high-level client is not building a client that works against any version of Elasticsearch (that is rather the purpose of the low-level client). The expectation is that version x.y of the high-level client works against w.z version of Elasticsearch where x==w (same major version) and y<=z (client in lower or same minor version). Things should also work with y>z although it is not a situation that we test nor strongly guarantee, as it doesn't make much sense to upgrade a client before the application that it talks to.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321783886","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321783886","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321783886,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTc4Mzg4Ng==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T10:58:59Z","updated_at":"2017-08-11T10:58:59Z","author_association":"MEMBER","body":"> What is the purpose of using the 6.0 client to communicate with a 5.5 cluster?\r\n\r\nLet say I'm building an application which communicates with an elasticsearch 5.6 cluster.\r\nI'm using the 5.6 Rest Client. So good so far.\r\n\r\nThen, I know that elasticsearch 6.1 has been released and I want to prepare my application to be ready for it.\r\nSo, I take the 6.1 Rest Client, update my application and deploy it in production. As for now my cluster is still 5.6.\r\n\r\nI'm now ready to upgrade my 5.6 cluster to 6.1.\r\n\r\n> it doesn't make much sense to upgrade a client before the application that it talks to.\r\n\r\nBut here is my real use case. I'm building a tool which can be used with whatever version of elasticsearch the end user wants to use or have in production already. My tool does not embed elasticsearch which is may be the problem here. So I'm expecting that the REST Client I'm using to be able to automatically adapt itself to the version I'm using.\r\n\r\nNow I understand why it is so complicated to do it here as we depend on elasticsearch core objects and not on a public API (rest api specs) which is independent from the implementation.\r\nAlso we don't use versions in our objects like package name \"o.e.api.v5.SearchRequest\".\r\nThe REST endpoints are not using any version either like http://localhost:9200/v5/_search and http://localhost:9200/v2/_search... I'm calling that \"a la Twitter\" versioning system: https://api.twitter.com/1.1/search/tweets.json (note the API spec version in the URL).\r\nWhich makes all that thing super hard to solve IMO.\r\n\r\nI'm fine saying that we don't want to complicate things. But at least we can't say something like:\r\n\r\n> The High Level Client is backwards compatible but can only communicate with Elasticsearch version 5.5 and onwards.\r\n\r\n(from https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.x/java-rest-high-compatibility.html)\r\n\r\nI just proved I think that the 6.0 client is not \"fully\" backwards compatible with Elasticsearch version 5.5.\r\nSo at the very least if we don't want or if we can't solve that issue, we need to say that a REST client major version is only compatible with the same major version of an elasticsearch cluster.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321808283","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321808283","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321808283,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTgwODI4Mw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T13:11:44Z","updated_at":"2017-08-11T13:11:44Z","author_association":"MEMBER","body":"As I said before, the client should be the last piece to be upgraded when a cluster is upgraded and not the first like in your usecase. Ppgrading the app in production to prepare for a cluster upgrade is not the way to do it. Things should be tested on the new major version first, with both sides upgraded, in a test/acceptance environment. Then the move should be done in production, upgrading the client last.\r\n\r\nThis is also the sentence in the docs that's right after what you mentioned above:\r\n\r\n>  It is recommended to upgrade the High Level Client when upgrading the Elasticsearch cluster to a new major version, as REST API breaking changes may cause unexpected results, and newly added APIs will only be supported by the newer version of the client. The client should be updated last, once all of the nodes in the cluster have been upgraded.\r\n\r\nWhat you encountered is in fact a change that is causing an incompatibility, which requires upgrading, probably same happens if you try the 5.6 client against 6.0.0-beta1 with the same request.\r\n\r\nWe can certainly clarify what backwards compatible means in that sentence, although I thought that the following sentence woulda already clarify things. What I meant is that we guarantee bw comp within the same major version, and we do it as a best-effort between different majors (if there are no breaking changes involved for sure everything works). The case where the client is in a lower version compared to the cluster is uncommon, so if you go that route, you may run into problems and there isn't much that we can do about it.\r\n\r\nWe never meant nor promised to build a conversion layer so that the client would automagically work against every Elasticsearch version. None of our language clients do. Users will still have to upgrade their clients, but they will only have to do it at least once per major version, which is reasonable.\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321812554","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321812554","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321812554,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTgxMjU1NA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T13:31:07Z","updated_at":"2017-08-11T13:31:07Z","author_association":"MEMBER","body":"Let's close this issue then as the behavior is expected.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321813008","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321813008","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321813008,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTgxMzAwOA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T13:33:10Z","updated_at":"2017-08-11T13:33:10Z","author_association":"CONTRIBUTOR","body":"I wanna repurpose this issue so we make sure that the docs are updated.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321813081","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321813081","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321813081,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTgxMzA4MQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T13:33:28Z","updated_at":"2017-08-11T13:33:28Z","author_association":"MEMBER","body":"good call @nik9000 I am on it, will open a PR later today.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321833039","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321833039","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321833039,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTgzMzAzOQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T14:44:47Z","updated_at":"2017-08-11T14:44:47Z","author_association":"MEMBER","body":"I was thinking of a workaround for that kind of problem. LMK what you think.\r\n\r\nLet say you have a 5.6 cluster running and want to use a 6.0 HL Client. As the binary protocol (transport) is aware of versions, we can imagine starting a local coordinating node only running 6.0. It will be able to join the 5.6 cluster.\r\nThen a HL Rest Client 6.0 just has to speak with this local coordinating node.\r\n\r\nWould that work or is there anything bad with this temporary workaround design?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321839363","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321839363","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321839363,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTgzOTM2Mw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T15:08:38Z","updated_at":"2017-08-11T15:08:38Z","author_association":"MEMBER","body":"This should work @dadoonet . Just not sure what it buys. I still think that upgrading the client last is the best way. I guess I also would need to have a better feeling of how many of these incompatibilities there are, to understand whether it's just a few edge cases or a more serious problem.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321974299","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-321974299","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":321974299,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTk3NDI5OQ==","user":{"login":"frekele","id":2288215,"node_id":"MDQ6VXNlcjIyODgyMTU=","avatar_url":"https://avatars2.githubusercontent.com/u/2288215?v=4","gravatar_id":"","url":"https://api.github.com/users/frekele","html_url":"https://github.com/frekele","followers_url":"https://api.github.com/users/frekele/followers","following_url":"https://api.github.com/users/frekele/following{/other_user}","gists_url":"https://api.github.com/users/frekele/gists{/gist_id}","starred_url":"https://api.github.com/users/frekele/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/frekele/subscriptions","organizations_url":"https://api.github.com/users/frekele/orgs","repos_url":"https://api.github.com/users/frekele/repos","events_url":"https://api.github.com/users/frekele/events{/privacy}","received_events_url":"https://api.github.com/users/frekele/received_events","type":"User","site_admin":false},"created_at":"2017-08-12T11:03:11Z","updated_at":"2017-08-12T11:03:11Z","author_association":"NONE","body":"Any prediction for elasticsearch 5.6? We waiting to be able to use the RestHighLevelClient.\r\n\r\nThak you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322125943","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-322125943","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":322125943,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjEyNTk0Mw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2017-08-14T08:09:46Z","updated_at":"2017-08-14T08:09:46Z","author_association":"MEMBER","body":"@frekele great to hear. And sorry, we don't give dates. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322129869","html_url":"https://github.com/elastic/elasticsearch/issues/26142#issuecomment-322129869","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26142","id":322129869,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjEyOTg2OQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-08-14T08:30:41Z","updated_at":"2017-08-14T08:30:41Z","author_association":"CONTRIBUTOR","body":"@frekele if you look at our previous release cycles you should get a pretty good estimate when it will come. we just don't give promises or anything along those lines.","performed_via_github_app":null}]