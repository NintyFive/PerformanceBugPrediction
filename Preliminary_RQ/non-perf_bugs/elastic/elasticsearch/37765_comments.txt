[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/456811459","html_url":"https://github.com/elastic/elasticsearch/issues/37765#issuecomment-456811459","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37765","id":456811459,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NjgxMTQ1OQ==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2019-01-23T14:01:10Z","updated_at":"2019-01-23T14:01:10Z","author_association":"CONTRIBUTOR","body":"The bulk indexing payload will be split up among however many shards you have in your index, and if you're using dynamic mappings then each shard will end up generating its own set, which then have to be combined.  So if one shard sees `dose-value` as a float value and another then sees it as a string you'll get a mismatch.  The different mappings are racing with each other, which would explain the randomness of whether or not something is accepted.  You should be able to fix this by defining your mappings up-front.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/456811810","html_url":"https://github.com/elastic/elasticsearch/issues/37765#issuecomment-456811810","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37765","id":456811810,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NjgxMTgxMA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-01-23T14:02:12Z","updated_at":"2019-01-23T14:02:12Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/456827101","html_url":"https://github.com/elastic/elasticsearch/issues/37765#issuecomment-456827101","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37765","id":456827101,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NjgyNzEwMQ==","user":{"login":"HenryQW","id":5896343,"node_id":"MDQ6VXNlcjU4OTYzNDM=","avatar_url":"https://avatars2.githubusercontent.com/u/5896343?v=4","gravatar_id":"","url":"https://api.github.com/users/HenryQW","html_url":"https://github.com/HenryQW","followers_url":"https://api.github.com/users/HenryQW/followers","following_url":"https://api.github.com/users/HenryQW/following{/other_user}","gists_url":"https://api.github.com/users/HenryQW/gists{/gist_id}","starred_url":"https://api.github.com/users/HenryQW/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HenryQW/subscriptions","organizations_url":"https://api.github.com/users/HenryQW/orgs","repos_url":"https://api.github.com/users/HenryQW/repos","events_url":"https://api.github.com/users/HenryQW/events{/privacy}","received_events_url":"https://api.github.com/users/HenryQW/received_events","type":"User","site_admin":false},"created_at":"2019-01-23T14:44:13Z","updated_at":"2019-01-23T14:44:13Z","author_association":"NONE","body":"@romseygeek if I set `bulkSize` to 1, and ingest only one document, it will fail/succeed randomly. That's the part puzzles me","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/456934323","html_url":"https://github.com/elastic/elasticsearch/issues/37765#issuecomment-456934323","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37765","id":456934323,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NjkzNDMyMw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-01-23T19:28:07Z","updated_at":"2019-01-23T19:28:07Z","author_association":"MEMBER","body":"> if I set `bulkSize` to 1, and ingest only one document, it will fail/succeed randomly. That's the part puzzles me\r\n\r\nDo you mean a single document into an empty exist without a pre-defined mapping? Would you provide a full reproduction of this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/457180061","html_url":"https://github.com/elastic/elasticsearch/issues/37765#issuecomment-457180061","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37765","id":457180061,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NzE4MDA2MQ==","user":{"login":"HenryQW","id":5896343,"node_id":"MDQ6VXNlcjU4OTYzNDM=","avatar_url":"https://avatars2.githubusercontent.com/u/5896343?v=4","gravatar_id":"","url":"https://api.github.com/users/HenryQW","html_url":"https://github.com/HenryQW","followers_url":"https://api.github.com/users/HenryQW/followers","following_url":"https://api.github.com/users/HenryQW/following{/other_user}","gists_url":"https://api.github.com/users/HenryQW/gists{/gist_id}","starred_url":"https://api.github.com/users/HenryQW/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HenryQW/subscriptions","organizations_url":"https://api.github.com/users/HenryQW/orgs","repos_url":"https://api.github.com/users/HenryQW/repos","events_url":"https://api.github.com/users/HenryQW/events{/privacy}","received_events_url":"https://api.github.com/users/HenryQW/received_events","type":"User","site_admin":false},"created_at":"2019-01-24T12:30:01Z","updated_at":"2019-01-24T12:30:01Z","author_association":"NONE","body":"> > if I set `bulkSize` to 1, and ingest only one document, it will fail/succeed randomly. That's the part puzzles me\r\n> \r\n> Do you mean a single document into an empty exist without a pre-defined mapping? Would you provide a full reproduction of this?\r\n\r\nI've never pre-defined a mapping for index as the structure of documents being ingested is unpredictable.\r\n\r\nI've tried the followings for both single document and multiple documents:\r\n\r\n| Existing Index  | Pre-defined Mapping  | Uniform Format for Documents| \r\n|---|---|---|\r\n| Yes  | No  |No|\r\n| No| No  |No|\r\n| Yes| No  |Yes|\r\n| No| No  |Yes|\r\n\r\nBy `Uniform Format for Documents` I mean objects in the list\r\n1. have the same count of key-value pair.\r\n1. are in the same data type.\r\n1. empty values are filled with `\"null\"` or `0`\r\n\r\nThe full reproduction is described in my issue, can you please point out what the missing ones are so I can add them?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508158821","html_url":"https://github.com/elastic/elasticsearch/issues/37765#issuecomment-508158821","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37765","id":508158821,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODE1ODgyMQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-07-03T16:11:51Z","updated_at":"2019-07-03T16:11:51Z","author_association":"CONTRIBUTOR","body":"I think this is the same problems as: #40409. In case two shards try to update the mapping (when a new field is discovered), one of them could fail when the auto-discovered type differs (in your case float vs long).\r\n\r\nI would like to ask for a couple of clarifications:\r\n\r\n1. when you wrote:\r\n> if I set bulkSize to 1, and ingest only one document, it will fail/succeed randomly\r\nyou were supposedly still ingesting all documents using the .NET program above, only you had bulkSize=1? Or is it really the case that indexing just one document using bulk with no parallel activity randomly rejects the document?\r\n\r\n2. Does this also reproduce if you have bulkSize=1 and use MaxDegreeOfParallelism(1)?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508777200","html_url":"https://github.com/elastic/elasticsearch/issues/37765#issuecomment-508777200","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37765","id":508777200,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODc3NzIwMA==","user":{"login":"HenryQW","id":5896343,"node_id":"MDQ6VXNlcjU4OTYzNDM=","avatar_url":"https://avatars2.githubusercontent.com/u/5896343?v=4","gravatar_id":"","url":"https://api.github.com/users/HenryQW","html_url":"https://github.com/HenryQW","followers_url":"https://api.github.com/users/HenryQW/followers","following_url":"https://api.github.com/users/HenryQW/following{/other_user}","gists_url":"https://api.github.com/users/HenryQW/gists{/gist_id}","starred_url":"https://api.github.com/users/HenryQW/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HenryQW/subscriptions","organizations_url":"https://api.github.com/users/HenryQW/orgs","repos_url":"https://api.github.com/users/HenryQW/repos","events_url":"https://api.github.com/users/HenryQW/events{/privacy}","received_events_url":"https://api.github.com/users/HenryQW/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T14:30:56Z","updated_at":"2019-07-05T14:30:56Z","author_association":"NONE","body":"@henningandersen Thanks for looking into this. I've set `bulkSize=200` and `MaxDegreeOfParallelism(4)` it's been stable in production. The edge case of ingesting only 1 document only occurs during dev stage, therefore the product owner was happy about putting this into production.\r\n\r\nI've tested with `MaxDegreeOfParallelism(1)` and it seems to avoid this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508784177","html_url":"https://github.com/elastic/elasticsearch/issues/37765#issuecomment-508784177","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37765","id":508784177,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODc4NDE3Nw==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T14:53:54Z","updated_at":"2019-07-05T14:53:54Z","author_association":"CONTRIBUTOR","body":"Thanks for trying this out @HenryQW. I think we can safely conclude that this is a duplicate of #40409 and since that contains tech discussion on the solution I will close this issue.","performed_via_github_app":null}]