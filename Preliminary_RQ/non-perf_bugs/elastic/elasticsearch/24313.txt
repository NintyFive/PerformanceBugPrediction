{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24313","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24313/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24313/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24313/events","html_url":"https://github.com/elastic/elasticsearch/issues/24313","id":224156194,"node_id":"MDU6SXNzdWUyMjQxNTYxOTQ=","number":24313,"title":"GceDiscoverTests fails with thread leak","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":160579278,"node_id":"MDU6TGFiZWwxNjA1NzkyNzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Discovery-Plugins","name":":Distributed/Discovery-Plugins","color":"0e8a16","default":false,"description":"Anything related to our integration plugins with EC2, GCP and Azure"},{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2017-04-25T14:23:59Z","updated_at":"2018-02-20T08:38:23Z","closed_at":"2018-02-20T08:38:23Z","author_association":"MEMBER","active_lock_reason":null,"body":"build URL:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.3+multijob-unix-compatibility/os=opensuse/144/consoleFull\r\n\r\nReproduce command:\r\n```\r\ngradle :plugins:discovery-gce:test -Dtests.seed=AD2321B05BCFD7A9 -Dtests.class=org.elasticsearch.discovery.gce.GceDiscoverTests -Dtests.security.manager=true -Dtests.locale=en-US -Dtests.timezone=Etc/UTC\r\n```\r\n\r\nstack trace:\r\n```\r\n  2> REPRODUCE WITH: gradle :plugins:discovery-gce:test -Dtests.seed=AD2321B05BCFD7A9 -Dtests.class=org.elasticsearch.discovery.gce.GceDiscoverTests -Dtests.security.manager=true -Dtests.locale=en-US -Dtests.timezone=Etc/UTC\r\n  2> REPRODUCE WITH: gradle :plugins:discovery-gce:test -Dtests.seed=AD2321B05BCFD7A9 -Dtests.class=org.elasticsearch.discovery.gce.GceDiscoverTests -Dtests.security.manager=true -Dtests.locale=en-US -Dtests.timezone=Etc/UTC\r\n  2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=1668, maxMBSortInHeap=6.040847236532724, sim=RandomSimilarity(queryNorm=false,coord=crazy): {}, locale=en-MT, timezone=America/Cordoba\r\n  2> NOTE: Linux 3.16.7-53-default amd64/Oracle Corporation 1.8.0_111 (64-bit)/cpus=4,threads=2,free=369534272,total=514850816\r\n  2> NOTE: All tests run in this JVM: [GceDiscoverTests]\r\nERROR   0.00s J0 | GceDiscoverTests (suite) <<< FAILURES!\r\n   > Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.elasticsearch.discovery.gce.GceDiscoverTests: \r\n   >    1) Thread[id=41, name=elasticsearch[node_s0][generic][T#2], state=RUNNABLE, group=TGRP-GceDiscoverTests]\r\n   >         at java.net.SocketInputStream.socketRead0(Native Method)\r\n   >         at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)\r\n   >         at java.net.SocketInputStream.read(SocketInputStream.java:170)\r\n   >         at java.net.SocketInputStream.read(SocketInputStream.java:141)\r\n   >         at sun.security.ssl.InputRecord.readFully(InputRecord.java:465)\r\n   >         at sun.security.ssl.InputRecord.read(InputRecord.java:503)\r\n   >         at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:973)\r\n   >         at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1375)\r\n   >         at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1403)\r\n   >         at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1387)\r\n   >         at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:559)\r\n   >         at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:185)\r\n   >         at sun.net.www.protocol.https.HttpsURLConnectionImpl.connect(HttpsURLConnectionImpl.java:153)\r\n   >         at com.google.api.client.http.javanet.NetHttpRequest.execute(NetHttpRequest.java:93)\r\n   >         at com.google.api.client.http.HttpRequest.execute(HttpRequest.java:972)\r\n   >         at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeUnparsed(AbstractGoogleClientRequest.java:419)\r\n   >         at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeUnparsed(AbstractGoogleClientRequest.java:352)\r\n   >         at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.execute(AbstractGoogleClientRequest.java:469)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl$1.run(GceInstancesServiceImpl.java:79)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl$1.run(GceInstancesServiceImpl.java:75)\r\n   >         at java.security.AccessController.doPrivileged(Native Method)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl.lambda$instances$1(GceInstancesServiceImpl.java:75)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl$$Lambda$1288/1577691077.apply(Unknown Source)\r\n   >         at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\r\n   >         at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1374)\r\n   >         at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\r\n   >         at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\r\n   >         at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)\r\n   >         at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n   >         at java.util.stream.ReferencePipeline.reduce(ReferencePipeline.java:474)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl.instances(GceInstancesServiceImpl.java:91)\r\n   >         at org.elasticsearch.discovery.gce.GceUnicastHostsProvider.buildDynamicNodes(GceUnicastHostsProvider.java:134)\r\n   >         at org.elasticsearch.discovery.zen.UnicastZenPing.ping(UnicastZenPing.java:302)\r\n   >         at org.elasticsearch.discovery.zen.UnicastZenPing.ping(UnicastZenPing.java:279)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery.pingAndWait(ZenDiscovery.java:1007)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery.findMaster(ZenDiscovery.java:874)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery.innerJoinCluster(ZenDiscovery.java:383)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery.access$3800(ZenDiscovery.java:81)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery$JoinThreadControl$1.run(ZenDiscovery.java:1190)\r\n   >         at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569)\r\n   >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n   >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n   >         at java.lang.Thread.run(Thread.java:745)\r\n   > \tat __randomizedtesting.SeedInfo.seed([AD2321B05BCFD7A9]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn't be terminated:\r\n   >    1) Thread[id=41, name=elasticsearch[node_s0][generic][T#2], state=RUNNABLE, group=TGRP-GceDiscoverTests]\r\n   >         at java.net.SocketInputStream.socketRead0(Native Method)\r\n   >         at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)\r\n   >         at java.net.SocketInputStream.read(SocketInputStream.java:170)\r\n   >         at java.net.SocketInputStream.read(SocketInputStream.java:141)\r\n   >         at sun.security.ssl.InputRecord.readFully(InputRecord.java:465)\r\n   >         at sun.security.ssl.InputRecord.read(InputRecord.java:503)\r\n   >         at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:973)\r\n   >         at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1375)\r\n   >         at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1403)\r\n   >         at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1387)\r\n   >         at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:559)\r\n   >         at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:185)\r\n   >         at sun.net.www.protocol.https.HttpsURLConnectionImpl.connect(HttpsURLConnectionImpl.java:153)\r\n   >         at com.google.api.client.http.javanet.NetHttpRequest.execute(NetHttpRequest.java:93)\r\n   >         at com.google.api.client.http.HttpRequest.execute(HttpRequest.java:972)\r\n   >         at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeUnparsed(AbstractGoogleClientRequest.java:419)\r\n   >         at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeUnparsed(AbstractGoogleClientRequest.java:352)\r\n   >         at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.execute(AbstractGoogleClientRequest.java:469)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl$1.run(GceInstancesServiceImpl.java:79)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl$1.run(GceInstancesServiceImpl.java:75)\r\n   >         at java.security.AccessController.doPrivileged(Native Method)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl.lambda$instances$1(GceInstancesServiceImpl.java:75)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl$$Lambda$1288/1577691077.apply(Unknown Source)\r\n   >         at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\r\n   >         at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1374)\r\n   >         at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\r\n   >         at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\r\n   >         at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)\r\n   >         at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n   >         at java.util.stream.ReferencePipeline.reduce(ReferencePipeline.java:474)\r\n   >         at org.elasticsearch.cloud.gce.GceInstancesServiceImpl.instances(GceInstancesServiceImpl.java:91)\r\n   >         at org.elasticsearch.discovery.gce.GceUnicastHostsProvider.buildDynamicNodes(GceUnicastHostsProvider.java:134)\r\n   >         at org.elasticsearch.discovery.zen.UnicastZenPing.ping(UnicastZenPing.java:302)\r\n   >         at org.elasticsearch.discovery.zen.UnicastZenPing.ping(UnicastZenPing.java:279)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery.pingAndWait(ZenDiscovery.java:1007)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery.findMaster(ZenDiscovery.java:874)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery.innerJoinCluster(ZenDiscovery.java:383)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery.access$3800(ZenDiscovery.java:81)\r\n   >         at org.elasticsearch.discovery.zen.ZenDiscovery$JoinThreadControl$1.run(ZenDiscovery.java:1190)\r\n   >         at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569)\r\n   >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n   >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n   >         at java.lang.Thread.run(Thread.java:745)\r\n   > \tat __randomizedtesting.SeedInfo.seed([AD2321B05BCFD7A9]:0)\r\n```","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}