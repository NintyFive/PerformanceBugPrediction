[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/668735794","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-668735794","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":668735794,"node_id":"MDEyOklzc3VlQ29tbWVudDY2ODczNTc5NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-08-04T17:47:05Z","updated_at":"2020-08-04T17:47:05Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo (:Analytics/Aggregations)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/670162590","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-670162590","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":670162590,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MDE2MjU5MA==","user":{"login":"wylieconlon","id":666475,"node_id":"MDQ6VXNlcjY2NjQ3NQ==","avatar_url":"https://avatars2.githubusercontent.com/u/666475?v=4","gravatar_id":"","url":"https://api.github.com/users/wylieconlon","html_url":"https://github.com/wylieconlon","followers_url":"https://api.github.com/users/wylieconlon/followers","following_url":"https://api.github.com/users/wylieconlon/following{/other_user}","gists_url":"https://api.github.com/users/wylieconlon/gists{/gist_id}","starred_url":"https://api.github.com/users/wylieconlon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wylieconlon/subscriptions","organizations_url":"https://api.github.com/users/wylieconlon/orgs","repos_url":"https://api.github.com/users/wylieconlon/repos","events_url":"https://api.github.com/users/wylieconlon/events{/privacy}","received_events_url":"https://api.github.com/users/wylieconlon/received_events","type":"User","site_admin":false},"created_at":"2020-08-06T19:59:04Z","updated_at":"2020-08-06T19:59:04Z","author_association":"MEMBER","body":"I'm not sure that it's a good idea to combine this function, which is the \"average event rate\", and the other function \"positive rate\". The main reason is that the \"event rate\" calculation is much simpler.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/671475450","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-671475450","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":671475450,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MTQ3NTQ1MA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2020-08-10T17:05:28Z","updated_at":"2020-08-17T15:45:33Z","author_association":"MEMBER","body":"The date histogram can support fixed, calendar and legacy intervals. These interval need to work with the rate calculator used by the rate aggregation. In order to remove ambiguity I would like to propose the following limitations:\r\n\r\n1. If the date histogram is defined using fixed_interval, the `unit` parameter in the aggregation will be treated as a fixed interval and only values allowed in the fixed interval parameters in a date histogram will be supported. The actual rate division ratio will be calculated based by converting both intervals into milliseconds during parse time.\r\n2. If the date histogram is defined using calendar_interval the `unit` parameter will be treated as calendar intervals. Some rate ratios will be calculated during parse time but some will have to be calculated during query time (QT) based on the actual size of the buckets as following:\r\n\r\n|          | minute | hour | day  | week  | month | quarter | year |\r\n| -------- | ------ | ---- | ---- | ----- | ----- | ------- | ---- |\r\n|  minute  |    1   |  60  | 1440 | 10080 |   QT  |    QT   |  QT  |\r\n|  hour    |  1/60  |  1   |  24  | 168   |   QT  |    QT   |  QT  |\r\n|  day     | 1/1440 | 1/24 |  1   |   7   |   QT  |    QT   |  QT  |\r\n|  week    | 1/10080|1/1440| 1/60 |   1   |   QT  |    QT   |  QT  |\r\n|  month   |   N/A  | N/A  | N/A  | N/A   |   1   |    3    |  12  |\r\n|  quarter |   N/A  | N/A  | N/A  | N/A   |  1/3  |    1    |   4  |\r\n|  year    |   N/A  | N/A  | N/A  | N/A   |  1/12 |  1/4    |   1  |\r\n\r\n3. If the date histogram is defined using legacy interval the rate histogram will throw an exception. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/671778942","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-671778942","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":671778942,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MTc3ODk0Mg==","user":{"login":"dgieselaar","id":352732,"node_id":"MDQ6VXNlcjM1MjczMg==","avatar_url":"https://avatars2.githubusercontent.com/u/352732?v=4","gravatar_id":"","url":"https://api.github.com/users/dgieselaar","html_url":"https://github.com/dgieselaar","followers_url":"https://api.github.com/users/dgieselaar/followers","following_url":"https://api.github.com/users/dgieselaar/following{/other_user}","gists_url":"https://api.github.com/users/dgieselaar/gists{/gist_id}","starred_url":"https://api.github.com/users/dgieselaar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgieselaar/subscriptions","organizations_url":"https://api.github.com/users/dgieselaar/orgs","repos_url":"https://api.github.com/users/dgieselaar/repos","events_url":"https://api.github.com/users/dgieselaar/events{/privacy}","received_events_url":"https://api.github.com/users/dgieselaar/received_events","type":"User","site_admin":false},"created_at":"2020-08-11T07:28:35Z","updated_at":"2020-08-11T07:28:35Z","author_association":"CONTRIBUTOR","body":"Will this support histogram fields as well? ie, will it use `.counts`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/671781712","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-671781712","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":671781712,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MTc4MTcxMg==","user":{"login":"dgieselaar","id":352732,"node_id":"MDQ6VXNlcjM1MjczMg==","avatar_url":"https://avatars2.githubusercontent.com/u/352732?v=4","gravatar_id":"","url":"https://api.github.com/users/dgieselaar","html_url":"https://github.com/dgieselaar","followers_url":"https://api.github.com/users/dgieselaar/followers","following_url":"https://api.github.com/users/dgieselaar/following{/other_user}","gists_url":"https://api.github.com/users/dgieselaar/gists{/gist_id}","starred_url":"https://api.github.com/users/dgieselaar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgieselaar/subscriptions","organizations_url":"https://api.github.com/users/dgieselaar/orgs","repos_url":"https://api.github.com/users/dgieselaar/repos","events_url":"https://api.github.com/users/dgieselaar/events{/privacy}","received_events_url":"https://api.github.com/users/dgieselaar/received_events","type":"User","site_admin":false},"created_at":"2020-08-11T07:35:01Z","updated_at":"2020-08-11T07:36:03Z","author_association":"CONTRIBUTOR","body":"Just wanted to add that we do various manual rate calculations in APM and we also have a manual implementation of a monotonically increasing counter for our garbage collection charts. We combine a `max`, `derivative`, and `bucket_script` aggregation to achieve the latter. Would love to get rid of these ðŸ˜€","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/671972381","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-671972381","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":671972381,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MTk3MjM4MQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2020-08-11T14:14:03Z","updated_at":"2020-08-11T14:14:03Z","author_association":"MEMBER","body":"> Will this support histogram fields as well? ie, will it use .counts?\r\n\r\nI was thinking to use count by default if the `field` parameter is not present. Do you see a need for a special value that should be supported by the field parameter to represent count?\r\n\r\n> Just wanted to add that we do various manual rate calculations in APM and we also have a manual implementation of a monotonically increasing counter for our garbage collection charts.\r\n\r\nWe decided to handle monotonically increasing counters as a separate aggregation, which is tracked by #60619. Could you take a look and comment on this issue if you see some functionality that is currently missing?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/672837864","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-672837864","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":672837864,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MjgzNzg2NA==","user":{"login":"dgieselaar","id":352732,"node_id":"MDQ6VXNlcjM1MjczMg==","avatar_url":"https://avatars2.githubusercontent.com/u/352732?v=4","gravatar_id":"","url":"https://api.github.com/users/dgieselaar","html_url":"https://github.com/dgieselaar","followers_url":"https://api.github.com/users/dgieselaar/followers","following_url":"https://api.github.com/users/dgieselaar/following{/other_user}","gists_url":"https://api.github.com/users/dgieselaar/gists{/gist_id}","starred_url":"https://api.github.com/users/dgieselaar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgieselaar/subscriptions","organizations_url":"https://api.github.com/users/dgieselaar/orgs","repos_url":"https://api.github.com/users/dgieselaar/repos","events_url":"https://api.github.com/users/dgieselaar/events{/privacy}","received_events_url":"https://api.github.com/users/dgieselaar/received_events","type":"User","site_admin":false},"created_at":"2020-08-12T12:22:01Z","updated_at":"2020-08-12T12:22:08Z","author_association":"CONTRIBUTOR","body":"@imotov To clarify, considering the following document type:\r\n\r\n```json\r\n{\r\n\t\"@timestamp\": {\r\n\t\t\"type\": \"date\"\r\n\t},\r\n\t\"duration\": {\r\n\t\t\"type\": \"histogram\"\r\n\t}\r\n}\r\n```\r\n\r\nI would like to be able to use a `rate` aggregation as:\r\n\r\n```\r\n{\r\n\t\"aggs\": {\r\n\t\t\"by_date\": {\r\n\t\t\t\"date_histogram\": {\r\n\t\t\t\t\"field\": \"@timestamp\"\r\n\t\t\t},\r\n\t\t\t\"aggs\": {\r\n\t\t\t\t\"rate\": {\r\n\t\t\t\t\t\"rate\": {\r\n\t\t\t\t\t\t\"field\": \"duration\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\nAnd have the rate based on the count of values stored in the histogram field `duration`. Would that work out of the box?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/673011189","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-673011189","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":673011189,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzAxMTE4OQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2020-08-12T17:32:22Z","updated_at":"2020-08-12T17:32:22Z","author_association":"MEMBER","body":"@dgieselaar in that scenario, I'm assuming it'd be the total sum of the histo counts in that bucket?\r\n\r\n- an hour bucket\r\n- two documents with histograms:\r\n  - doc1 histo counts: [1,2,3,4]\r\n  - doc2 histo counts: [5,6,7]\r\n\r\nIn this case, the total count would be (1+2+3+4+5+6+7)==28 for the two histos, and so the rate would be 28/hr in that bucket.\r\n\r\nIs that what you'd expect to happen, or something else?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/673016586","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-673016586","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":673016586,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzAxNjU4Ng==","user":{"login":"dgieselaar","id":352732,"node_id":"MDQ6VXNlcjM1MjczMg==","avatar_url":"https://avatars2.githubusercontent.com/u/352732?v=4","gravatar_id":"","url":"https://api.github.com/users/dgieselaar","html_url":"https://github.com/dgieselaar","followers_url":"https://api.github.com/users/dgieselaar/followers","following_url":"https://api.github.com/users/dgieselaar/following{/other_user}","gists_url":"https://api.github.com/users/dgieselaar/gists{/gist_id}","starred_url":"https://api.github.com/users/dgieselaar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgieselaar/subscriptions","organizations_url":"https://api.github.com/users/dgieselaar/orgs","repos_url":"https://api.github.com/users/dgieselaar/repos","events_url":"https://api.github.com/users/dgieselaar/events{/privacy}","received_events_url":"https://api.github.com/users/dgieselaar/received_events","type":"User","site_admin":false},"created_at":"2020-08-12T17:43:38Z","updated_at":"2020-08-12T17:43:38Z","author_association":"CONTRIBUTOR","body":"@polyfractal that's right, I should have said sum of counts, not count of values. Thanks for catching that ðŸ˜ƒ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/673063380","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-673063380","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":673063380,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzA2MzM4MA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2020-08-12T19:23:10Z","updated_at":"2020-08-12T19:23:10Z","author_association":"MEMBER","body":":+1: awesome, sounds good.  I started to type out one thing and then confused myself... so figured it'd be good to make sure we were talking about the same thing :)\r\n\r\nI'll defer to Igor whose much more deeper in the weeds working on this than me, but that doesn't _sound_ like it would be impossible to implement.  Might end up being a separate PR just to keep things simple though since the histo implementation is a little different from other fields.  But","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/673689194","html_url":"https://github.com/elastic/elasticsearch/issues/60674#issuecomment-673689194","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60674","id":673689194,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzY4OTE5NA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2020-08-13T20:17:22Z","updated_at":"2020-08-13T20:17:22Z","author_association":"MEMBER","body":"I think the original plan was to add all values, the way Zach described it.","performed_via_github_app":null}]