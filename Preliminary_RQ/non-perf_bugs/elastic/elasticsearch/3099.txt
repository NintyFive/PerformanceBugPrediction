{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3099","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3099/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3099/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3099/events","html_url":"https://github.com/elastic/elasticsearch/issues/3099","id":14800136,"node_id":"MDU6SXNzdWUxNDgwMDEzNg==","number":3099,"title":"Changed faceting behavior from 0.20.6 to 0.90.0","user":{"login":"astathopoulos","id":827828,"node_id":"MDQ6VXNlcjgyNzgyOA==","avatar_url":"https://avatars1.githubusercontent.com/u/827828?v=4","gravatar_id":"","url":"https://api.github.com/users/astathopoulos","html_url":"https://github.com/astathopoulos","followers_url":"https://api.github.com/users/astathopoulos/followers","following_url":"https://api.github.com/users/astathopoulos/following{/other_user}","gists_url":"https://api.github.com/users/astathopoulos/gists{/gist_id}","starred_url":"https://api.github.com/users/astathopoulos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astathopoulos/subscriptions","organizations_url":"https://api.github.com/users/astathopoulos/orgs","repos_url":"https://api.github.com/users/astathopoulos/repos","events_url":"https://api.github.com/users/astathopoulos/events{/privacy}","received_events_url":"https://api.github.com/users/astathopoulos/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2013-05-27T14:23:13Z","updated_at":"2013-06-03T09:08:59Z","closed_at":"2013-06-03T09:08:59Z","author_association":"NONE","active_lock_reason":null,"body":"When faceting on a field that does not exist on the mapping raises SearchPhaseExecutionException on 0.90.0. This behavior was different in previous elasticsearch versions where the faceting was just not applied.\n\n```\ncurl -XPUT 'http://localhost:9200/test/'\n\n{\"ok\":true,\"acknowledged\":true}\n\ncurl -XPUT 'http://localhost:9200/test/blog_post/1' -d '{\n  \"title\" : \"Some interesting title\",\n  \"body\" : \"Some interesting body\"\n}'\n\n{\"ok\":true,\"_index\":\"test\",\"_type\":\"blog_post\",\"_id\":\"1\",\"_version\":1}\n\ncurl -XGET 'http://localhost:9200/test/blog_post/_search?pretty' -d '{\n\"query\" : {\n        \"match_all\" : {  }\n    },\n    \"facets\" : {\n        \"tag\" : {\n            \"terms\" : {\n                \"field\" : \"tag\",\n                \"size\" : 10\n            }\n        }\n    }\n}'\n\n{\n  \"error\" : \"SearchPhaseExecutionException[Failed to execute phase [query_fetch], total failure; shardFailures {[Frj_DRabTvabCbjN1rim-w][test][0]: SearchParseException[[test][0]: query[ConstantScore(*:*)],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n\\\"query\\\" : {\\n        \\\"match_all\\\" : {  }\\n    },\\n    \\\"facets\\\" : {\\n        \\\"tag\\\" : {\\n            \\\"terms\\\" : {\\n                \\\"field\\\" : \\\"tag\\\",\\n                \\\"size\\\" : 10\\n            }\\n        }\\n    }\\n}]]]; nested: FacetPhaseExecutionException[Facet [tag]: failed to find mapping for [tag]]; }]\",\n  \"status\" : 500\n}\n```\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}