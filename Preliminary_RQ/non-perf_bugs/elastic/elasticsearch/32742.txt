{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32742","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32742/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32742/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32742/events","html_url":"https://github.com/elastic/elasticsearch/issues/32742","id":349100132,"node_id":"MDU6SXNzdWUzNDkxMDAxMzI=","number":32742,"title":"[Transport client] TC returns \"an exception occurred formatting a trace message\"  when logging level is set to TRACE","user":{"login":"narph","id":1900090,"node_id":"MDQ6VXNlcjE5MDAwOTA=","avatar_url":"https://avatars1.githubusercontent.com/u/1900090?v=4","gravatar_id":"","url":"https://api.github.com/users/narph","html_url":"https://github.com/narph","followers_url":"https://api.github.com/users/narph/followers","following_url":"https://api.github.com/users/narph/following{/other_user}","gists_url":"https://api.github.com/users/narph/gists{/gist_id}","starred_url":"https://api.github.com/users/narph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narph/subscriptions","organizations_url":"https://api.github.com/users/narph/orgs","repos_url":"https://api.github.com/users/narph/repos","events_url":"https://api.github.com/users/narph/events{/privacy}","received_events_url":"https://api.github.com/users/narph/received_events","type":"User","site_admin":false},"labels":[{"id":146829143,"node_id":"MDU6TGFiZWwxNDY4MjkxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Transport%20API","name":":Core/Infra/Transport API","color":"0e8a16","default":false,"description":"Transport client API"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-08-09T12:09:55Z","updated_at":"2018-10-15T17:15:22Z","closed_at":"2018-10-15T17:15:22Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.3.2\r\n\r\n**Plugins installed**: [xpack]\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\nWhen connecting to the cluster through the transport client we get the following in the elastic\r\n\r\n```\r\n2018-08-03 10:54:37.079 TRACE 11932 --- [ost-startStop-1] o.elasticsearch.indices.breaker.request  : [request] Adjusted breaker by [16440] bytes, now [16440]\r\n2018-08-03 10:54:37.110 TRACE 11932 --- [ient_boss][T#1]] o.e.transport.netty4.ESLoggingHandler    : [id: 0x5b556509, L:/10.10.61.53:58833 - ...  ACTIVE\r\n2018-08-03 10:54:37.110 TRACE 11932 --- [ient_boss][T#1]] o.e.transport.netty4.ESLoggingHandler    : an exception occurred formatting a trace message\r\n\r\njava.io.EOFException: null\r\n\tat org.elasticsearch.common.io.stream.InputStreamStreamInput.readByte(InputStreamStreamInput.java:59) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n\tat org.elasticsearch.common.io.stream.StreamInput.readString(StreamInput.java:378) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n\tat org.elasticsearch.common.io.stream.StreamInput.readStringArray(StreamInput.java:465) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n\tat org.elasticsearch.transport.netty4.ESLoggingHandler.format(ESLoggingHandler.java:109) ~[transport-netty4-client-6.3.2.jar:6.3.2]\r\n\tat org.elasticsearch.transport.netty4.ESLoggingHandler.format(ESLoggingHandler.java:50) ~[transport-netty4-client-6.3.2.jar:6.3.2]\r\n\tat io.netty.handler.logging.LoggingHandler.write(LoggingHandler.java:247) [netty-handler-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeWrite0(AbstractChannelHandlerContext.java:738) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeWrite(AbstractChannelHandlerContext.java:730) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:816) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:723) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.ChannelDuplexHandler.write(ChannelDuplexHandler.java:106) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeWrite0(AbstractChannelHandlerContext.java:738) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeWrite(AbstractChannelHandlerContext.java:730) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.access$1900(AbstractChannelHandlerContext.java:38) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext$AbstractWriteTask.write(AbstractChannelHandlerContext.java:1081) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext$WriteAndFlushTask.write(AbstractChannelHandlerContext.java:1128) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext$AbstractWriteTask.run(AbstractChannelHandlerContext.java:1070) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) [netty-common-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404) [netty-common-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:464) [netty-transport-4.1.27.Final.jar:4.1.27.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:884) [netty-common-4.1.27.Final.jar:4.1.27.Final]\r\n\tat java.base/java.lang.Thread.run(Thread.java:844) [na:na]\r\n```\r\n\r\nLogging set to:\r\n```\r\nlogging.level.org.elasticsearch=TRACE\r\n```\r\n \r\n\r\nDependency:\r\n```\r\n<dependency>\r\n<groupId>org.apache.logging.log4j</groupId>\r\n<artifactId>log4j-api</artifactId>\r\n</dependency>\r\n<dependency>\r\n<groupId>org.apache.logging.log4j</groupId>\r\n<artifactId>log4j-core</artifactId>\r\n</dependency>\r\n```\r\n\r\nWhen changing the logging level, the exceptions disappear and the transport client is able to connect to the cluster.\r\ncc @tlrx ","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}