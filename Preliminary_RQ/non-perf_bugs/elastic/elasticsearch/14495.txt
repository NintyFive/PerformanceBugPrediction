{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14495","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14495/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14495/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14495/events","html_url":"https://github.com/elastic/elasticsearch/issues/14495","id":114897491,"node_id":"MDU6SXNzdWUxMTQ4OTc0OTE=","number":14495,"title":"Awkward Load Average on ES","user":{"login":"mehmetgunturkun","id":3748385,"node_id":"MDQ6VXNlcjM3NDgzODU=","avatar_url":"https://avatars2.githubusercontent.com/u/3748385?v=4","gravatar_id":"","url":"https://api.github.com/users/mehmetgunturkun","html_url":"https://github.com/mehmetgunturkun","followers_url":"https://api.github.com/users/mehmetgunturkun/followers","following_url":"https://api.github.com/users/mehmetgunturkun/following{/other_user}","gists_url":"https://api.github.com/users/mehmetgunturkun/gists{/gist_id}","starred_url":"https://api.github.com/users/mehmetgunturkun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehmetgunturkun/subscriptions","organizations_url":"https://api.github.com/users/mehmetgunturkun/orgs","repos_url":"https://api.github.com/users/mehmetgunturkun/repos","events_url":"https://api.github.com/users/mehmetgunturkun/events{/privacy}","received_events_url":"https://api.github.com/users/mehmetgunturkun/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-11-03T20:00:33Z","updated_at":"2015-11-08T20:29:09Z","closed_at":"2015-11-08T20:29:09Z","author_association":"NONE","active_lock_reason":null,"body":"Hello everyone,\n\nI have already created couple of threads on discuss.elastic.co but nobody replied and still couldn't find the main reason of that much high load average.\n\nThreads are as follows, you can check all scenerio:\nhttps://discuss.elastic.co/t/ngram-analyzer-and-huge-cpu-usage-under-50-req-sec/32797\nhttps://discuss.elastic.co/t/many-slow-queries-and-high-cpu-load-on-load-test-50req-sec/32624\n\nHowever to explain briefly I have two fields one is analyzed with standard tokenizer with ngram filter and other is only standard tokenizer. \n\nThe problem is revelaed during load test.\nWhen I run a load test on the field with standard tokenized it can reach to 600-700 rps\nHowever, when I tested on with field which is analyzed with ngram filtering I cannot evet see 70 rps.\n\nI was expecting decrease on query performance but load average and cpu load is awkward or I am missing something.\n\nI have 24 cores on the server and when I ran \"top\" command I can see that %CPU is around 2200.\nIs that normal? If not the possible reasons I can think:\n1. Mistaken configuration.\n2. Complex Query\n3. Wrong architecture and Scaling \n\n**Btw, that is really huge problem that blocks us to make production deploy. I mean due to the fact that I am not sure if query causes this awkward behaviour, I cannot start using that on production. If any additional information is required I can create.**\n\nMehmet-\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}