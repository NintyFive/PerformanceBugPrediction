{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23010","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23010/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23010/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23010/events","html_url":"https://github.com/elastic/elasticsearch/issues/23010","id":205786390,"node_id":"MDU6SXNzdWUyMDU3ODYzOTA=","number":23010,"title":"NoNodeAvailableException (None of the configured nodes are available) error when trying to push data to Elastic from a Spark job","user":{"login":"dgoldenberg1234","id":17676310,"node_id":"MDQ6VXNlcjE3Njc2MzEw","avatar_url":"https://avatars1.githubusercontent.com/u/17676310?v=4","gravatar_id":"","url":"https://api.github.com/users/dgoldenberg1234","html_url":"https://github.com/dgoldenberg1234","followers_url":"https://api.github.com/users/dgoldenberg1234/followers","following_url":"https://api.github.com/users/dgoldenberg1234/following{/other_user}","gists_url":"https://api.github.com/users/dgoldenberg1234/gists{/gist_id}","starred_url":"https://api.github.com/users/dgoldenberg1234/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgoldenberg1234/subscriptions","organizations_url":"https://api.github.com/users/dgoldenberg1234/orgs","repos_url":"https://api.github.com/users/dgoldenberg1234/repos","events_url":"https://api.github.com/users/dgoldenberg1234/events{/privacy}","received_events_url":"https://api.github.com/users/dgoldenberg1234/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-02-07T04:54:17Z","updated_at":"2017-02-07T15:23:18Z","closed_at":"2017-02-07T10:37:22Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:\r\n2.3.1\r\n\r\n**Plugins installed**: [Kibana 4.5.4]\r\n\r\n**JVM version**:\r\nJava (TM) SE Runtime Environment (build 1.8.0_112-b15)\r\n\r\n**OS version**:\r\nRed Hat Enterprise Linux Server release 6.7 (Santiago)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nAttempting to connect to Elastic programmatically within a Spark job, by getting a TransportClient, then performing a health check before ingesting any documents:\r\n\r\n`ClusterHealthResponse chr = client.admin().cluster().prepareHealth().setWaitForGreenStatus().setTimeout(TimeValue.timeValueSeconds(10)).get();`\r\n\r\nThis code works perfectly fine when the call is issued inside a standalone Java application. However, when this code runs inside a Spark job, we get the error NoNodesAvailable.\r\n\r\nFull stack trace is available in the discussion forum [here](https://discuss.elastic.co/t/nonodeavailableexception-none-of-the-configured-nodes-are-available-error-when-trying-to-push-data-to-elastic-from-a-spark-job/73904). \r\n\r\n**Steps to reproduce**:\r\n 1. Implement a Spark job with a driver that connects to Elastic and checks the health and publishes documents, as mentioned above.\r\n\r\n**Provide logs (if relevant)**:\r\n[2017-02-06 22:53:19,688][TRACE][transport.tracer         ] [test-node-1] [208][indices:data/read/search[phase/query+fetch]] received response from [{test-node-1}{GGiOFd08SRqte42P93v0vQ}{XX.XXX.XXX.XX}{XX.XXX.XXX.XX:9300}]\r\n\r\n(Around this time we got on Spark side:\r\nNoNodeAvailableException[None of the configured nodes are available: [{#transport#-1}{XX.XXX.XXX.XX}{XX.XXX.XXX.XX:9300}]])\r\n\r\n[2017-02-06 22:53:19,775][TRACE][transport.netty          ] [test-node-1] channel opened: [id: 0x9aa97215, /XX.XXX.XXX.XX:39476 => /XX.XXX.XXX.XX:9300]\r\n[2017-02-06 22:53:19,904][TRACE][transport.netty          ] [test-node-1] channel closed: [id: 0x9aa97215, /XX.XXX.XXX.XX:39476 => /XX.XXX.XXX.XX:9300]\r\n \r\n[2017-02-06 22:53:22,202][TRACE][transport.tracer         ] [test-node-1] [209][cluster:monitor/nodes/info[n]] received response from [{di-test-node-1}{GGiOFd08SRqte42P93v0vQ}{XX.XXX.XXX.XX}{XX.XXX.XXX.XX:9300}]\r\n\r\nNot much in the log. We set   **transport: TRACE**  in logging.yml but didn't seem to get much tracing from such classes as TransportClientNodesService.  We were hoping to trace how the nodes get validated and added. Not seeing that info in the logs.\r\n\r\n**Things we have tried**:\r\n\r\n1. Checked the cluster status, all good, green. Side note: this is a single node cluster.\r\n2. Tried making the TransportClient be a singleton. No help.\r\n3. Tried setting and increasing **client.transport.ping_timeout** and **client.transport.nodes_sampler_interval** to 60seconds. No help.\r\n4. The timeout on the cluster health check increased to 60 seconds. No help.\r\n5. Tried setting the network.host as the host's IP address  or  [\\_eth0\\_, \\_local\\_].  No help.\r\n\r\nAny info or recommendations would be appreciated as we haven't yet seen any feedback to the forum post. Thanks.\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}