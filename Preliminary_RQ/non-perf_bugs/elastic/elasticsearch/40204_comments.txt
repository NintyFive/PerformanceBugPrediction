[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/475309038","html_url":"https://github.com/elastic/elasticsearch/issues/40204#issuecomment-475309038","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40204","id":475309038,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTMwOTAzOA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-21T16:42:34Z","updated_at":"2019-03-21T16:42:34Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476147181","html_url":"https://github.com/elastic/elasticsearch/issues/40204#issuecomment-476147181","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40204","id":476147181,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjE0NzE4MQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2019-03-25T10:58:54Z","updated_at":"2019-03-25T10:58:54Z","author_association":"MEMBER","body":"Can you elaborate on your choice around sniff interval (60 seconds) and sniff after failure delay (30 seconds)? Have you tried increasing the maxRetryTimeout even further? Have you tried sending requests later, do you keep on getting those timeouts or do requests at some point go back to normal? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476468434","html_url":"https://github.com/elastic/elasticsearch/issues/40204#issuecomment-476468434","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40204","id":476468434,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjQ2ODQzNA==","user":{"login":"saiergong","id":4198386,"node_id":"MDQ6VXNlcjQxOTgzODY=","avatar_url":"https://avatars1.githubusercontent.com/u/4198386?v=4","gravatar_id":"","url":"https://api.github.com/users/saiergong","html_url":"https://github.com/saiergong","followers_url":"https://api.github.com/users/saiergong/followers","following_url":"https://api.github.com/users/saiergong/following{/other_user}","gists_url":"https://api.github.com/users/saiergong/gists{/gist_id}","starred_url":"https://api.github.com/users/saiergong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saiergong/subscriptions","organizations_url":"https://api.github.com/users/saiergong/orgs","repos_url":"https://api.github.com/users/saiergong/repos","events_url":"https://api.github.com/users/saiergong/events{/privacy}","received_events_url":"https://api.github.com/users/saiergong/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T04:11:50Z","updated_at":"2019-03-26T04:14:28Z","author_association":"NONE","body":"```\r\npublic void bulk(String values, final String index, final String type) {\r\n        final Request request = new Request(\"POST\", index + \"/\" + type + \"/_bulk\");\r\n        request.setJsonEntity(values);\r\n\r\n        restClient.performRequestAsync(request, new ResponseListener() {\r\n            @Override\r\n            public void onSuccess(Response response) {\r\n                LOG.info(\"success.\");\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Exception exception)  {\r\n                if(exception instanceof ResponseException){\r\n\r\n                }else {\r\n                    int retry = 1;\r\n                    while(true){\r\n                        try{\r\n                            if(retry >= 30){\r\n                                LOG.error(\"failed after 30 retries, will fail this task.\");\r\n                                break;\r\n                            }\r\n                            //use sync method to resent request\r\n                            Response response = restClient.performRequest(request);\r\n                            LOG.info(\"resent request succeed\");\r\n                            return;\r\n                        }catch (Exception e){\r\n                            LOG.error(\"retry failed.\");\r\n                            LOG.error(\"\",e);\r\n                            retry++;\r\n                            try{\r\n                                //sleep if failed again\r\n                                Thread.sleep(3000);\r\n                            }catch (Exception ee){\r\n\r\n                            }\r\n\r\n                        }\r\n\r\n                    }\r\n                }\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n        int count = 0;\r\n        while(count < 40){\r\n            StringBuilder value = new StringBuilder();\r\n            for (int i = 0; i < 10; i++){\r\n\r\n                value.append(metaData);\r\n                value.append(String.format(data, i));\r\n                value.append(\"\\n\");\r\n            }\r\n\r\n            value.append(metaData);\r\n            value.append(\"{\\\"f1\\\":\\\"fff\\\"}\");\r\n            value.append(\"\\n\");\r\n\r\n            //System.out.println(value.toString());\r\n            writer.bulk(value.toString(), \"test\", \"test\");\r\n            count++;\r\n\r\n            try{\r\n                Thread.sleep(10000);\r\n            }catch (Exception e){\r\n\r\n            }\r\n\r\n        }\r\n```\r\n\r\nhere is the code i testd,  i shutdown es when i sent several request,  then when i restart es, no request can be success.  And \"java.io.IOException: listener timeout after waiting for [60000] ms\" error repeated all the time.\r\n\r\ni guess maybe the reason is  i use performRequest function in performRequestAsync function.  because it has no problem when i only use performRequest function.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476679208","html_url":"https://github.com/elastic/elasticsearch/issues/40204#issuecomment-476679208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40204","id":476679208,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjY3OTIwOA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T14:43:51Z","updated_at":"2019-03-26T14:43:51Z","author_association":"MEMBER","body":"I don't think that retrying from the onFailure callback makes sense, especially using a sync call and putting sleep in there as well. I would not be surprised if this causes unexpected results. If you want to test that the client starts sending successful requests after the node it's pointing to was restarted, I would recommend that you have independent calls, rather than from a listener. Say you can schedule a request every 5/10 seconds and see when things go back to normal. Note that you are also using sniffing, and sniff on failure. What state is your cluster in once those two nodes that you shut down are back up? Have you tried sending curl requests to them?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478210328","html_url":"https://github.com/elastic/elasticsearch/issues/40204#issuecomment-478210328","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40204","id":478210328,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODIxMDMyOA==","user":{"login":"saiergong","id":4198386,"node_id":"MDQ6VXNlcjQxOTgzODY=","avatar_url":"https://avatars1.githubusercontent.com/u/4198386?v=4","gravatar_id":"","url":"https://api.github.com/users/saiergong","html_url":"https://github.com/saiergong","followers_url":"https://api.github.com/users/saiergong/followers","following_url":"https://api.github.com/users/saiergong/following{/other_user}","gists_url":"https://api.github.com/users/saiergong/gists{/gist_id}","starred_url":"https://api.github.com/users/saiergong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saiergong/subscriptions","organizations_url":"https://api.github.com/users/saiergong/orgs","repos_url":"https://api.github.com/users/saiergong/repos","events_url":"https://api.github.com/users/saiergong/events{/privacy}","received_events_url":"https://api.github.com/users/saiergong/received_events","type":"User","site_admin":false},"created_at":"2019-03-30T05:45:10Z","updated_at":"2019-03-30T05:45:10Z","author_association":"NONE","body":"Es cluster state is green after the two nodes come back, and i can send curl request to the them. the reason i use sync request in onFailure callback is that i want to retry my request until es cluster become green if es is down.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478487084","html_url":"https://github.com/elastic/elasticsearch/issues/40204#issuecomment-478487084","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40204","id":478487084,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODQ4NzA4NA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2019-04-01T08:34:13Z","updated_at":"2019-04-01T08:34:13Z","author_association":"MEMBER","body":"Note that retrying is built-in, meaning a failed request will be retried on other nodes.  There is no automatic retry though against the same node that failed. As I said, making blocking calls in a listener callback is a bad idea and will likely cause problems. I'd recommend that you try and rely on retries on different nodes that is built-in, otherwise, if all nodes are down, you should have some kind of queue mechanism in your app rather than retrying from a listener callback.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/492633128","html_url":"https://github.com/elastic/elasticsearch/issues/40204#issuecomment-492633128","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40204","id":492633128,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MjYzMzEyOA==","user":{"login":"ebadyano","id":26631211,"node_id":"MDQ6VXNlcjI2NjMxMjEx","avatar_url":"https://avatars0.githubusercontent.com/u/26631211?v=4","gravatar_id":"","url":"https://api.github.com/users/ebadyano","html_url":"https://github.com/ebadyano","followers_url":"https://api.github.com/users/ebadyano/followers","following_url":"https://api.github.com/users/ebadyano/following{/other_user}","gists_url":"https://api.github.com/users/ebadyano/gists{/gist_id}","starred_url":"https://api.github.com/users/ebadyano/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebadyano/subscriptions","organizations_url":"https://api.github.com/users/ebadyano/orgs","repos_url":"https://api.github.com/users/ebadyano/repos","events_url":"https://api.github.com/users/ebadyano/events{/privacy}","received_events_url":"https://api.github.com/users/ebadyano/received_events","type":"User","site_admin":false},"created_at":"2019-05-15T12:26:54Z","updated_at":"2019-05-15T12:26:54Z","author_association":"CONTRIBUTOR","body":"Closing the issue as no further feedback received. @saiergong if you have any further comments please and we can look at re-opening this issue.","performed_via_github_app":null}]