{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4759","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4759/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4759/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4759/events","html_url":"https://github.com/elastic/elasticsearch/issues/4759","id":25725946,"node_id":"MDU6SXNzdWUyNTcyNTk0Ng==","number":4759,"title":"Improve result ordering logic for completion suggester to account for quality of match","user":{"login":"timbunce","id":62403,"node_id":"MDQ6VXNlcjYyNDAz","avatar_url":"https://avatars2.githubusercontent.com/u/62403?v=4","gravatar_id":"","url":"https://api.github.com/users/timbunce","html_url":"https://github.com/timbunce","followers_url":"https://api.github.com/users/timbunce/followers","following_url":"https://api.github.com/users/timbunce/following{/other_user}","gists_url":"https://api.github.com/users/timbunce/gists{/gist_id}","starred_url":"https://api.github.com/users/timbunce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timbunce/subscriptions","organizations_url":"https://api.github.com/users/timbunce/orgs","repos_url":"https://api.github.com/users/timbunce/repos","events_url":"https://api.github.com/users/timbunce/events{/privacy}","received_events_url":"https://api.github.com/users/timbunce/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"assignees":[{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2014-01-16T13:53:38Z","updated_at":"2014-12-11T20:37:11Z","closed_at":"2014-12-11T20:37:11Z","author_association":"NONE","active_lock_reason":null,"body":"We're using shingles for the inputs and we have many inputs per suggestion, plus synonyms (for [postal address abbreviations](https://www.usps.com/send/official-abbreviations.htm)) and we'd like to use fuzzy searching as well.\n\nWhat we're finding is that short inputs will match many suggestions which are then ordered only by `weight`, regardless of the 'quality' of the input match. So the top `size` results _often don't include items that are much closer to the actual input_, and sometimes don't include the item that's an exact match! This understandably causes confusion, especially when users know that an exact match exists.\n\nWe're working around it by requesting suggestions with a much larger `size` value, then reordering the results with extra code before returning the 'top N' to the client.\n\nI'm still working out the best logic to use for the reordering but we're limited in what we can achieve on the client-side. We'll probably put prefix matches first, then substring matches, then everything else.\n\nObviously we'd rather ES did this for us because it would do a better job (it has more information, such as synonyms and fuzzy edit distance), would apply to all matching results not just the top `size`, and would be faster.\n\nPossibly related to #3791.\n","closed_by":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}