[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518738001","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518738001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518738001,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODczODAwMQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T16:11:19Z","updated_at":"2019-08-06T16:11:19Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518742153","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518742153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518742153,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc0MjE1Mw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T16:22:26Z","updated_at":"2019-08-06T16:22:26Z","author_association":"MEMBER","body":"Hmm.  Could you paste the output of `GET /_rollup/data/_all` ?  I'd like to see what jobs are on the cluster currently.  I'm thinking one of them might have invalid syntax (which we missed when the job was created) which is breaking things later.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518768655","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518768655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518768655,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc2ODY1NQ==","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:33:40Z","updated_at":"2019-08-06T17:33:40Z","author_association":"NONE","body":"Ah, I was unaware of that endpoint. I had been doing GET /_rollup/job/* to list jobs and was seeing nothing. This list however is a bit big and includes data from a bunch of deleted jobs. The rollup indexes are deleted too. Is there a way to clean these out?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518773154","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518773154","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518773154,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3MzE1NA==","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:45:58Z","updated_at":"2019-08-06T17:45:58Z","author_association":"NONE","body":"I may have to retract my previous statement. At the time I got that list there were rollup indexes in place. I deleted them and the list emptied. However, I am still told that a job exists with the id even though GET /_rollup/job/* and GET /_rollup/data/_all both return empty results. I also noticed that after getting the \"already exists\" error I then see data in GET /_rollup/data/_all but still none in GET /_rollup/job/*","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518775237","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518775237","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518775237,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3NTIzNw==","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:51:45Z","updated_at":"2019-08-06T17:51:45Z","author_association":"NONE","body":"Ok, I got the \"sibling aggregation\" error to happen again. the /_rollup/data/_all endpoint gave an empty list before I created a new rollup job in kibana. I then got the internal error message and saw that \"sibling aggregation\" error in the log. GET /_rollup/data/_all now returns:\r\n`{\r\n    \"analytics-thermostat-*\": {\r\n        \"rollup_jobs\": [\r\n            {\r\n                \"job_id\": \"thermostat-hourly-notpreexisting\",\r\n                \"rollup_index\": \"rollup-thermostat-hourly-notpreexisting\",\r\n                \"index_pattern\": \"analytics-thermostat-*\",\r\n                \"fields\": {\r\n                    \"building_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"device_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"thermostat_mode\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"cool_set_point\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"dehumidify_cycles\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"cool_cycles\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"internal_temperature\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"device_online\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"heat_cycles\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"property_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"thermostat_running_status\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"outside_humidity\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"@timestamp\": [\r\n                        {\r\n                            \"agg\": \"date_histogram\",\r\n                            \"delay\": \"1h\",\r\n                            \"time_zone\": \"UTC\",\r\n                            \"calendar_interval\": \"1h\"\r\n                        }\r\n                    ],\r\n                    \"device_update_received\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"thermostat_fan_status\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"device_update_sent\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"humidity\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"heat_set_point\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"app_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"unit_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"outside_weather\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ]\r\n                }\r\n            }\r\n        ]\r\n    }\r\n}`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518776421","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518776421","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518776421,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3NjQyMQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:54:51Z","updated_at":"2019-08-06T17:54:51Z","author_association":"MEMBER","body":"Ah yeah, so to explain a bit, `GET /_rollup/job/<job_id>` returns \"active\" jobs that are still alive and able to actively index (although they might currently be paused)\r\n\r\nThe `GET /_rollup/data/_all` api is the [Rollup Capabilities](https://www.elastic.co/guide/en/elasticsearch/reference/master/rollup-get-rollup-caps.html) API. This also includes all \"historical\" jobs and their data. It basically shows you what \"capabilities\" your cluster has for running rollups (e.g. what fields are available, what aggregations for each field, intervals, etc).\r\n\r\nThe two APIs are separate because it's common to run a job for a while, then delete it because that job is done (no more data), but you want to keep the data itself around.\r\n\r\nCan you paste the output of: `GET /rollup-thermostat-hourly-notpreexisting/_rollup/data`?  This is a related api ([Get Rollup Index Capabiltiies](https://www.elastic.co/guide/en/elasticsearch/reference/master/rollup-get-rollup-index-caps.html)) which will show the config on that specific index.  Perhaps Kibana is sending malformed configurations or something, not sure.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518777289","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518777289","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518777289,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3NzI4OQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:57:18Z","updated_at":"2019-08-06T17:57:18Z","author_association":"MEMBER","body":"Was the \"sibling aggregation\" error on `heat_set_point` field again?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518777299","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518777299","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518777299,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3NzI5OQ==","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:57:20Z","updated_at":"2019-08-06T17:57:20Z","author_association":"NONE","body":"Ah, hm. So when I go to create the job it somehow starts in the \"historical\" state where it has generated the /data metadata, but not the new actual job?\r\n\r\nGET /rollup-thermostat-hourly-notpreexisting/_rollup/data: `{\r\n    \"rollup-thermostat-hourly-notpreexisting\": {\r\n        \"rollup_jobs\": [\r\n            {\r\n                \"job_id\": \"thermostat-hourly-notpreexisting\",\r\n                \"rollup_index\": \"rollup-thermostat-hourly-notpreexisting\",\r\n                \"index_pattern\": \"analytics-thermostat-*\",\r\n                \"fields\": {\r\n                    \"building_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"device_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"thermostat_mode\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"cool_set_point\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"dehumidify_cycles\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"cool_cycles\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"internal_temperature\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"device_online\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"heat_cycles\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"property_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"thermostat_running_status\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"outside_humidity\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"@timestamp\": [\r\n                        {\r\n                            \"agg\": \"date_histogram\",\r\n                            \"delay\": \"1h\",\r\n                            \"time_zone\": \"UTC\",\r\n                            \"calendar_interval\": \"1h\"\r\n                        }\r\n                    ],\r\n                    \"device_update_received\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"thermostat_fan_status\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"device_update_sent\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"humidity\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"heat_set_point\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ],\r\n                    \"app_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"unit_id\": [\r\n                        {\r\n                            \"agg\": \"terms\"\r\n                        }\r\n                    ],\r\n                    \"outside_weather\": [\r\n                        {\r\n                            \"agg\": \"avg\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"max\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"min\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"sum\"\r\n                        },\r\n                        {\r\n                            \"agg\": \"value_count\"\r\n                        }\r\n                    ]\r\n                }\r\n            }\r\n        ]\r\n    }\r\n}`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518777623","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518777623","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518777623,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3NzYyMw==","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:58:13Z","updated_at":"2019-08-06T17:58:13Z","author_association":"NONE","body":"and yes, the sibling error is complaining about heat_set_point.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518778815","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518778815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518778815,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3ODgxNQ==","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T18:01:08Z","updated_at":"2019-08-06T18:01:08Z","author_association":"NONE","body":"If it help, here is the json version of the job that kibana claims it is sending: `{\r\n  \"id\": \"thermostat-hourly-notpreexisting\",\r\n  \"index_pattern\": \"analytics-thermostat-*\",\r\n  \"rollup_index\": \"rollup-thermostat-hourly-notpreexisting\",\r\n  \"cron\": \"0 0 * * * ?\",\r\n  \"page_size\": 1000,\r\n  \"groups\": {\r\n    \"date_histogram\": {\r\n      \"interval\": \"1h\",\r\n      \"delay\": \"1h\",\r\n      \"time_zone\": \"UTC\",\r\n      \"field\": \"@timestamp\"\r\n    },\r\n    \"terms\": {\r\n      \"fields\": [\r\n        \"app_id\",\r\n        \"building_id\",\r\n        \"device_id\",\r\n        \"property_id\",\r\n        \"thermostat_fan_status\",\r\n        \"thermostat_mode\",\r\n        \"thermostat_running_status\",\r\n        \"unit_id\"\r\n      ]\r\n    }\r\n  },\r\n  \"metrics\": [\r\n    {\r\n      \"field\": \"cool_cycles\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"cool_set_point\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"dehumidify_cycles\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"device_online\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"device_update_received\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"device_update_sent\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"heat_cycles\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"heat_set_point\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"humidity\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"internal_temperature\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"outside_humidity\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    },\r\n    {\r\n      \"field\": \"outside_weather\",\r\n      \"metrics\": [\r\n        \"avg\",\r\n        \"max\",\r\n        \"min\",\r\n        \"sum\",\r\n        \"value_count\"\r\n      ]\r\n    }\r\n  ]\r\n}`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518780459","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518780459","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518780459,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc4MDQ1OQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T18:05:21Z","updated_at":"2019-08-06T18:05:21Z","author_association":"MEMBER","body":":+1: Thanks!  Going to look over these responses and poke through the code a bit.\r\n\r\n> Ah, hm. So when I go to create the job it somehow starts in the \"historical\" state where it has generated the /data metadata, but not the new actual job?\r\n\r\nKinda, yeah.  When a new job is created, a few things happen:\r\n\r\n1. Validate the config, make sure everything is OK\r\n2. Create a new `rollup_index` with the appropriate settings/mappings.  If the `rollup_index` already exists, update its mappings to include the new job\r\n3. Create the persistent task that runs the indexer\r\n\r\nRollup stores it's config in the `_meta` mapping field of an index (you can look at it via the `GET foo/_mapping` API).  We store it there so it's available after the job has long since stopped.  And this is where the Rollup Capability api finds the data, to show historical stuff.\r\n\r\nSo what's happening is that step 2) succeeds, creates the index and writes into the `_meta` field. But for some reason step 3) is failing because of that \"sibling\" error, which means the task is never created and the indexer never becomes active.  You're instead left in a sort of zombie state where the destination exists but not the indexer, and trying to recreate it yells at you because the metadata has already been written.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518780637","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518780637","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518780637,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc4MDYzNw==","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T18:05:48Z","updated_at":"2019-08-06T18:06:35Z","author_association":"NONE","body":"The job config seems irrelevant though. I just tried creating a much simpler rollup with only one term and one metric (specifically not including the heat_set_point!) after confirming the there are no jobs and no job data, and I still get the error complaining about heat_set_point anyways.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518782616","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518782616","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518782616,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc4MjYxNg==","user":{"login":"kandelon","id":20399737,"node_id":"MDQ6VXNlcjIwMzk5NzM3","avatar_url":"https://avatars0.githubusercontent.com/u/20399737?v=4","gravatar_id":"","url":"https://api.github.com/users/kandelon","html_url":"https://github.com/kandelon","followers_url":"https://api.github.com/users/kandelon/followers","following_url":"https://api.github.com/users/kandelon/following{/other_user}","gists_url":"https://api.github.com/users/kandelon/gists{/gist_id}","starred_url":"https://api.github.com/users/kandelon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kandelon/subscriptions","organizations_url":"https://api.github.com/users/kandelon/orgs","repos_url":"https://api.github.com/users/kandelon/repos","events_url":"https://api.github.com/users/kandelon/events{/privacy}","received_events_url":"https://api.github.com/users/kandelon/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T18:11:27Z","updated_at":"2019-08-06T18:11:27Z","author_association":"NONE","body":"I also confirmed that I get the same heat_set_point sibling complaint when creating the simple rollup with no heat_set_point via api instead of kibana. It does feel like some bad job is lodged in the system somehow, but not visible via either endpoint.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518841329","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-518841329","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":518841329,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODg0MTMyOQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T20:58:03Z","updated_at":"2019-08-06T20:58:03Z","author_association":"MEMBER","body":"Yeah agreed, that does seem strange.  Not sure what's up, chasing down some ideas.\r\n\r\nWould you mind shooting me an email at zach@elastic.co ?  Have some debug info I'd like to collect but don't want to keep cluttering up this ticket with long responses :)  Thanks!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/519267459","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-519267459","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":519267459,"node_id":"MDEyOklzc3VlQ29tbWVudDUxOTI2NzQ1OQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-08-07T21:01:29Z","updated_at":"2019-08-07T21:01:29Z","author_association":"MEMBER","body":"Update for anyone following along. We've been debugging this and I believe this is the situation:\r\n\r\n1. A bad rollup configuration made it past the validation (two metrics are defined on the same field) and was added the cluster state as a persistent_task\r\n2. Rollup tasks create a composite agg builder in the constructor.  This fails when it tries to add the same aggregations twice (due to the duplicate metric in the config)\r\n3. This failure percolates up to the persistent task service but isn't caught, which means the task initialization loop exits early\r\n4. Now any time the cluster state changes, the node attempts to re-allocate the task (because it is in the CS but not locally), and it fails again due to the same problem\r\n5. Any subsequent tasks (rollup or otherwise) which are after the \"poisoned\" task will fail to start because the initialization loop exits early.  This is why all the other jobs failed to start\r\n\r\nI've opened a PR (https://github.com/elastic/elasticsearch/pull/45300) to make the task initialization procedure more robust to task failures, which would mitigate a problem like this in the future.  I'm now investigating how we can remedy the current cluster situation, and how the config got past the validations.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/521757250","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-521757250","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":521757250,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMTc1NzI1MA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-08-15T19:00:24Z","updated_at":"2019-08-15T19:00:24Z","author_association":"MEMBER","body":"#45300 has merged, which should help make things a bit more robust against this sort of failure in the future.\r\n\r\nI'm going to start working on some fixes for validations, so that Rollup doesn't get itself into this particular issue again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/589157840","html_url":"https://github.com/elastic/elasticsearch/issues/45247#issuecomment-589157840","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45247","id":589157840,"node_id":"MDEyOklzc3VlQ29tbWVudDU4OTE1Nzg0MA==","user":{"login":"BlakeWills","id":8128694,"node_id":"MDQ6VXNlcjgxMjg2OTQ=","avatar_url":"https://avatars1.githubusercontent.com/u/8128694?v=4","gravatar_id":"","url":"https://api.github.com/users/BlakeWills","html_url":"https://github.com/BlakeWills","followers_url":"https://api.github.com/users/BlakeWills/followers","following_url":"https://api.github.com/users/BlakeWills/following{/other_user}","gists_url":"https://api.github.com/users/BlakeWills/gists{/gist_id}","starred_url":"https://api.github.com/users/BlakeWills/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BlakeWills/subscriptions","organizations_url":"https://api.github.com/users/BlakeWills/orgs","repos_url":"https://api.github.com/users/BlakeWills/repos","events_url":"https://api.github.com/users/BlakeWills/events{/privacy}","received_events_url":"https://api.github.com/users/BlakeWills/received_events","type":"User","site_admin":false},"created_at":"2020-02-20T16:08:33Z","updated_at":"2020-02-20T16:08:33Z","author_association":"NONE","body":"@polyfractal Sorry to ping you on an old issue but I think I'm running into the same issue on 7.5.1.\r\nHow do I remove the old jobs?","performed_via_github_app":null}]