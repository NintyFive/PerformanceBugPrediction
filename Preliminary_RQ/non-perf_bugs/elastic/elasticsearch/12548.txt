{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12548","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12548/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12548/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12548/events","html_url":"https://github.com/elastic/elasticsearch/issues/12548","id":98069726,"node_id":"MDU6SXNzdWU5ODA2OTcyNg==","number":12548,"title":"Elasticsearch's CPU usage rate lasts high when no search request even","user":{"login":"Judyccb","id":12627595,"node_id":"MDQ6VXNlcjEyNjI3NTk1","avatar_url":"https://avatars1.githubusercontent.com/u/12627595?v=4","gravatar_id":"","url":"https://api.github.com/users/Judyccb","html_url":"https://github.com/Judyccb","followers_url":"https://api.github.com/users/Judyccb/followers","following_url":"https://api.github.com/users/Judyccb/following{/other_user}","gists_url":"https://api.github.com/users/Judyccb/gists{/gist_id}","starred_url":"https://api.github.com/users/Judyccb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Judyccb/subscriptions","organizations_url":"https://api.github.com/users/Judyccb/orgs","repos_url":"https://api.github.com/users/Judyccb/repos","events_url":"https://api.github.com/users/Judyccb/events{/privacy}","received_events_url":"https://api.github.com/users/Judyccb/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-07-30T02:08:40Z","updated_at":"2016-01-26T17:09:43Z","closed_at":"2016-01-26T17:09:43Z","author_association":"NONE","active_lock_reason":null,"body":"The elasticsearch node's CPU usage rate lasts 60% for 3 weeks which  connects to kibana as a search node.In the meantime,there is no any request, so weird.\n\nThe hot thread is as follow,\n\ncurl XX:9200/_nodes/XX/hot_threads\n::[RPRiDE6mRTOZclpQ8hTP9A][XX]]{data=false, master=false}\n\n   100.2% (500.8ms out of 500ms) cpu usage by thread 'elasticsearch[][search][T#1]'\n     7/10 snapshots sharing following 12 elements\n       java.util.TreeMap.getEntryUsingComparator(TreeMap.java:376)\n       java.util.TreeMap.getEntry(TreeMap.java:340)\n       java.util.TreeMap.remove(TreeMap.java:595)\n       java.util.TreeSet.remove(TreeSet.java:276)\n       org.elasticsearch.common.collect.BoundedTreeSet.rebound(BoundedTreeSet.java:60)\n       org.elasticsearch.common.collect.BoundedTreeSet.add(BoundedTreeSet.java:47)\n       org.elasticsearch.search.facet.terms.strings.InternalStringTermsFacet.reduce(InternalStringTermsFacet.java:214)\n       org.elasticsearch.search.controller.SearchPhaseController.merge(SearchPhaseController.java:314)\n       org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$2.run(TransportSearchQueryThenFetchAction.java:145)\n       java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n       java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n       java.lang.Thread.run(Thread.java:745)\n     3/10 snapshots sharing following 11 elements\n       java.util.TreeMap.getLastEntry(TreeMap.java:1977)\n       java.util.TreeMap.lastKey(TreeMap.java:292)\n       java.util.TreeSet.last(TreeSet.java:401)\n       org.elasticsearch.common.collect.BoundedTreeSet.rebound(BoundedTreeSet.java:60)\n       org.elasticsearch.common.collect.BoundedTreeSet.add(BoundedTreeSet.java:47)\n       org.elasticsearch.search.facet.terms.strings.InternalStringTermsFacet.reduce(InternalStringTermsFacet.java:214)\n       org.elasticsearch.search.controller.SearchPhaseController.merge(SearchPhaseController.java:314)\n       org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$2.run(TransportSearchQueryThenFetchAction.java:145)\n       java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n       java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n       java.lang.Thread.run(Thread.java:745)\n\n```\n0.1% (326.7micros out of 500ms) cpu usage by thread 'elasticsearch[][[transport_server_worker.default]][T#2]{New I/O worker #7}'\n 10/10 snapshots sharing following 15 elements\n   sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)\n   sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)\n   sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:79)\n   sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:87)\n   sun.nio.ch.SelectorImpl.select(SelectorImpl.java:98)\n   org.elasticsearch.common.netty.channel.socket.nio.SelectorUtil.select(SelectorUtil.java:68)\n   org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.select(AbstractNioSelector.java:415)\n   org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:212)\n   org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n   org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n   org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n   org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n   java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n   java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n   java.lang.Thread.run(Thread.java:745)\n\n0.0% (77.2micros out of 500ms) cpu usage by thread 'elasticsearch[][transport_client_timer][T#1]{Hashed wheel timer #1}'\n 10/10 snapshots sharing following 5 elements\n   java.lang.Thread.sleep(Native Method)\n   org.elasticsearch.common.netty.util.HashedWheelTimer$Worker.waitForNextTick(HashedWheelTimer.java:445)\n   org.elasticsearch.common.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:364)\n   org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n   java.lang.Thread.run(Thread.java:745)\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}