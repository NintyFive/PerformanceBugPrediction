[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134549668","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-134549668","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":134549668,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDU0OTY2OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-08-25T10:34:03Z","updated_at":"2015-08-25T10:41:57Z","author_association":"CONTRIBUTOR","body":"~~This looks a lot like file corruption, presumably related to the RAID error that you mentioned in~~ #13012\n\n```\nfinal int BUFFER_SIZE = (int) recoverySettings.fileChunkSize().bytes();\nfinal byte[] buf = new byte[BUFFER_SIZE];\n```\n\nHmmm, that's a setting, not the file size...\n\n@mikemccand @bleskes any ideas?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134555542","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-134555542","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":134555542,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDU1NTU0Mg==","user":{"login":"kjelle","id":598905,"node_id":"MDQ6VXNlcjU5ODkwNQ==","avatar_url":"https://avatars2.githubusercontent.com/u/598905?v=4","gravatar_id":"","url":"https://api.github.com/users/kjelle","html_url":"https://github.com/kjelle","followers_url":"https://api.github.com/users/kjelle/followers","following_url":"https://api.github.com/users/kjelle/following{/other_user}","gists_url":"https://api.github.com/users/kjelle/gists{/gist_id}","starred_url":"https://api.github.com/users/kjelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kjelle/subscriptions","organizations_url":"https://api.github.com/users/kjelle/orgs","repos_url":"https://api.github.com/users/kjelle/repos","events_url":"https://api.github.com/users/kjelle/events{/privacy}","received_events_url":"https://api.github.com/users/kjelle/received_events","type":"User","site_admin":false},"created_at":"2015-08-25T11:05:12Z","updated_at":"2015-08-25T11:05:12Z","author_association":"NONE","body":"@clintongormley I'v decomissioned our node with the faulty RAID0 and wiped indices and reloading all the data to see if the problem will go away. It seems to be that if an index has resided on the faulty RAID0 all seems well unit this shard is relocated, or I try to generate a replica from it. Let's see if removing one of my nodes reveals anything new.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134557030","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-134557030","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":134557030,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDU1NzAzMA==","user":{"login":"kjelle","id":598905,"node_id":"MDQ6VXNlcjU5ODkwNQ==","avatar_url":"https://avatars2.githubusercontent.com/u/598905?v=4","gravatar_id":"","url":"https://api.github.com/users/kjelle","html_url":"https://github.com/kjelle","followers_url":"https://api.github.com/users/kjelle/followers","following_url":"https://api.github.com/users/kjelle/following{/other_user}","gists_url":"https://api.github.com/users/kjelle/gists{/gist_id}","starred_url":"https://api.github.com/users/kjelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kjelle/subscriptions","organizations_url":"https://api.github.com/users/kjelle/orgs","repos_url":"https://api.github.com/users/kjelle/repos","events_url":"https://api.github.com/users/kjelle/events{/privacy}","received_events_url":"https://api.github.com/users/kjelle/received_events","type":"User","site_admin":false},"created_at":"2015-08-25T11:16:04Z","updated_at":"2015-08-25T11:16:04Z","author_association":"NONE","body":"We'll at the same time remove RAID0 and stripe using multi path in ES yaml.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134558678","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-134558678","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":134558678,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDU1ODY3OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-08-25T11:25:03Z","updated_at":"2015-08-25T11:25:03Z","author_association":"CONTRIBUTOR","body":"@kjelle note that there is a big change in multi-path coming in 2.0.  In 1.x, the files from a single shard are striped across multiple paths, which means that failure on any one path can corrupt all shards on that node.  In 2.0, each shard is written to a single data path only, so failure of that path will only affect the shards on that path.  When first upgrading to 2.0, segment files are moved around to ensure that each shard lives in a single path.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134559102","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-134559102","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":134559102,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDU1OTEwMg==","user":{"login":"kjelle","id":598905,"node_id":"MDQ6VXNlcjU5ODkwNQ==","avatar_url":"https://avatars2.githubusercontent.com/u/598905?v=4","gravatar_id":"","url":"https://api.github.com/users/kjelle","html_url":"https://github.com/kjelle","followers_url":"https://api.github.com/users/kjelle/followers","following_url":"https://api.github.com/users/kjelle/following{/other_user}","gists_url":"https://api.github.com/users/kjelle/gists{/gist_id}","starred_url":"https://api.github.com/users/kjelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kjelle/subscriptions","organizations_url":"https://api.github.com/users/kjelle/orgs","repos_url":"https://api.github.com/users/kjelle/repos","events_url":"https://api.github.com/users/kjelle/events{/privacy}","received_events_url":"https://api.github.com/users/kjelle/received_events","type":"User","site_admin":false},"created_at":"2015-08-25T11:27:33Z","updated_at":"2015-08-25T11:27:33Z","author_association":"NONE","body":"@clintongormley thanks for that info. I decided on RAID0 to be able to utilize the whole IOPS of 6 disks as one, instead one by one (as you mention for 2.x). We'll see how it performance, and switch back if necessary\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134961215","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-134961215","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":134961215,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDk2MTIxNQ==","user":{"login":"kjelle","id":598905,"node_id":"MDQ6VXNlcjU5ODkwNQ==","avatar_url":"https://avatars2.githubusercontent.com/u/598905?v=4","gravatar_id":"","url":"https://api.github.com/users/kjelle","html_url":"https://github.com/kjelle","followers_url":"https://api.github.com/users/kjelle/followers","following_url":"https://api.github.com/users/kjelle/following{/other_user}","gists_url":"https://api.github.com/users/kjelle/gists{/gist_id}","starred_url":"https://api.github.com/users/kjelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kjelle/subscriptions","organizations_url":"https://api.github.com/users/kjelle/orgs","repos_url":"https://api.github.com/users/kjelle/repos","events_url":"https://api.github.com/users/kjelle/events{/privacy}","received_events_url":"https://api.github.com/users/kjelle/received_events","type":"User","site_admin":false},"created_at":"2015-08-26T11:49:33Z","updated_at":"2015-08-26T11:49:33Z","author_association":"NONE","body":"@clintongormley the problem is with the code in v1.7.1. If you set equal to or higher than 2048mb (2147483648 bytes) you go pass max int for a _32bit Java int_ (2147483647) which results in _-2147483648_.\n\nAn interesting observation is that the Exception hits after a while (5minutes+ and after 15ish percent) and not initially\n\nI see that in the [v2.0 branch of RecoverySourceHandler](https://github.com/elastic/elasticsearch/blob/2.0/core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java#L296) it has been fixed;\n\n```\nfinal int BUFFER_SIZE = (int) Math.max(1, recoverySettings.fileChunkSize().bytes()); // at least one!\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134982750","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-134982750","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":134982750,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDk4Mjc1MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-08-26T12:25:20Z","updated_at":"2015-08-26T12:25:20Z","author_association":"CONTRIBUTOR","body":"OK, that was changed in https://github.com/elastic/elasticsearch/pull/12919\n\nAccording to the settings you provided in the description, you'd only set `indices.recovery.file_chunk_size` to `512kb`. Did you try setting it to a different too-high value?\n\nEither way, we should probably add some validation around that setting.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134983143","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-134983143","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":134983143,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDk4MzE0Mw==","user":{"login":"kjelle","id":598905,"node_id":"MDQ6VXNlcjU5ODkwNQ==","avatar_url":"https://avatars2.githubusercontent.com/u/598905?v=4","gravatar_id":"","url":"https://api.github.com/users/kjelle","html_url":"https://github.com/kjelle","followers_url":"https://api.github.com/users/kjelle/followers","following_url":"https://api.github.com/users/kjelle/following{/other_user}","gists_url":"https://api.github.com/users/kjelle/gists{/gist_id}","starred_url":"https://api.github.com/users/kjelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kjelle/subscriptions","organizations_url":"https://api.github.com/users/kjelle/orgs","repos_url":"https://api.github.com/users/kjelle/repos","events_url":"https://api.github.com/users/kjelle/events{/privacy}","received_events_url":"https://api.github.com/users/kjelle/received_events","type":"User","site_admin":false},"created_at":"2015-08-26T12:27:56Z","updated_at":"2015-08-26T12:28:45Z","author_association":"NONE","body":"@clintongormley yes, i was setting it up to 2048mb. I guess the reason for error while i had it at 512kb was that some other recovery handler had the 2048mb set from a previous run?\n\nAfter the clean install it was much clearer that setting this to 2048mb was the cause of the problem.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/176171862","html_url":"https://github.com/elastic/elasticsearch/issues/13095#issuecomment-176171862","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13095","id":176171862,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NjE3MTg2Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-28T13:00:44Z","updated_at":"2016-01-28T13:00:44Z","author_association":"CONTRIBUTOR","body":"Nothing more to do here. Closing\n","performed_via_github_app":null}]