{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/58651","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58651/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58651/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58651/events","html_url":"https://github.com/elastic/elasticsearch/issues/58651","id":647221224,"node_id":"MDU6SXNzdWU2NDcyMjEyMjQ=","number":58651,"title":"[CI] SamlAuthenticatorTests.testSuccessfullyParseContentFromEncryptedAssertion failure","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1967499607,"node_id":"MDU6TGFiZWwxOTY3NDk5NjA3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Security","name":"Team:Security","color":"fef2c0","default":false,"description":"Meta label for security team"}],"state":"closed","locked":false,"assignee":{"login":"ywangd","id":2344308,"node_id":"MDQ6VXNlcjIzNDQzMDg=","avatar_url":"https://avatars3.githubusercontent.com/u/2344308?v=4","gravatar_id":"","url":"https://api.github.com/users/ywangd","html_url":"https://github.com/ywangd","followers_url":"https://api.github.com/users/ywangd/followers","following_url":"https://api.github.com/users/ywangd/following{/other_user}","gists_url":"https://api.github.com/users/ywangd/gists{/gist_id}","starred_url":"https://api.github.com/users/ywangd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywangd/subscriptions","organizations_url":"https://api.github.com/users/ywangd/orgs","repos_url":"https://api.github.com/users/ywangd/repos","events_url":"https://api.github.com/users/ywangd/events{/privacy}","received_events_url":"https://api.github.com/users/ywangd/received_events","type":"User","site_admin":false},"assignees":[{"login":"ywangd","id":2344308,"node_id":"MDQ6VXNlcjIzNDQzMDg=","avatar_url":"https://avatars3.githubusercontent.com/u/2344308?v=4","gravatar_id":"","url":"https://api.github.com/users/ywangd","html_url":"https://github.com/ywangd","followers_url":"https://api.github.com/users/ywangd/followers","following_url":"https://api.github.com/users/ywangd/following{/other_user}","gists_url":"https://api.github.com/users/ywangd/gists{/gist_id}","starred_url":"https://api.github.com/users/ywangd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywangd/subscriptions","organizations_url":"https://api.github.com/users/ywangd/orgs","repos_url":"https://api.github.com/users/ywangd/repos","events_url":"https://api.github.com/users/ywangd/events{/privacy}","received_events_url":"https://api.github.com/users/ywangd/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-06-29T08:31:05Z","updated_at":"2020-06-29T13:36:19Z","closed_at":"2020-06-29T13:36:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Build scan**: https://gradle-enterprise.elastic.co/s/yczk6f2jiwbbu\r\n\r\n**Repro line**: ./gradlew ':x-pack:plugin:security:test' --tests \"org.elasticsearch.xpack.security.authc.saml.SamlAuthenticatorTests.testSuccessfullyParseContentFromEncryptedAssertion\" -Dtests.seed=81B483E734DC92DB -Dtests.security.manager=true -Dtests.locale=de -Dtests.timezone=BET -Druntime.java=11 -Dtests.fips.enabled=true\r\n\r\n**Reproduces locally?**: Yes \r\n\r\n**Applicable branches**: master\r\n\r\n**Failure history**:\r\nThe test failed for the first time but we also got a similar failure in https://gradle-enterprise.elastic.co/s/t5ncm7jvhfo3k where the `testSigningWhenIdpHasMultipleKeys` test  failed similarly. I think those 2 are the same issue.\r\n\r\n[See in Kibana](https://build-stats.elastic.co/app/kibana#/visualize/edit/4f8401f0-5a22-11e9-b23c-9f9b3d85000a?_g=(refreshInterval:(pause:!f,value:10000),time:(from:now-7d%2Fd,mode:relative,to:now-0d%2Fd))&_a=(filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:e58bf320-7efd-11e8-bf69-63c8ef516157,key:project.keyword,negate:!f,params:(query:elasticsearch,type:phrase),type:phrase,value:elasticsearch),query:(match:(project.keyword:(query:elasticsearch,type:phrase)))),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:e58bf320-7efd-11e8-bf69-63c8ef516157,key:branch.keyword,negate:!f,params:!(master,'7.x','7.0','6.7'),type:phrases,value:'master,%207.x,%207.0,%206.7'),query:(bool:(minimum_should_match:1,should:!((match_phrase:(branch.keyword:master)),(match_phrase:(branch.keyword:'7.x')),(match_phrase:(branch.keyword:'7.0')),(match_phrase:(branch.keyword:'6.7'))))))),linked:!f,query:(language:lucene,query:SamlAuthenticatorTests),uiState:(),vis:(aggs:!((enabled:!t,id:'1',params:(customLabel:'Impacted%20Builds',field:build-id),schema:metric,type:cardinality),(enabled:!t,id:'2',params:(customLabel:Test,field:test.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!f,otherBucketLabel:Other,size:20),schema:segment,type:terms),(enabled:!t,id:'3',params:(customLabel:Class,field:class.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderAgg:(enabled:!t,id:'3-orderAgg',params:(),schema:orderAgg,type:count),orderBy:custom,otherBucket:!f,otherBucketLabel:Other,size:1),schema:group,type:terms)),params:(addLegend:!t,addTimeMarker:!f,addTooltip:!t,categoryAxes:!((id:CategoryAxis-1,labels:(filter:!f,rotate:75,show:!t,truncate:100),position:bottom,scale:(type:linear),show:!t,style:(),title:(),type:category)),grid:(categoryLines:!f,style:(color:%23eee)),legendPosition:right,orderBucketsBySum:!t,seriesParams:!((data:(id:'1',label:'Impacted%20Builds'),drawLinesBetweenPoints:!t,mode:stacked,show:true,showCircles:!t,type:histogram,valueAxis:ValueAxis-1)),times:!(),type:histogram,valueAxes:!((id:ValueAxis-1,labels:(filter:!f,rotate:0,show:!t,truncate:100),name:LeftAxis-1,position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'Impacted%20Builds'),type:value))),title:'Gordon:%20Top%20failing%20ES%20tests%20by%20%23%20of%20impacted%20builds',type:histogram)))\r\n**Failure excerpt**:\r\n\r\n```\r\norg.bouncycastle.crypto.IllegalKeyException: Attempt to encrypt/decrypt with RSA modulus already used for sign/verify.\t\r\nat __randomizedtesting.SeedInfo.seed([81B483E734DC92DB:1848D24F26D988C7]:0)\t\r\nat org.bouncycastle.crypto.general.RSA$KeyWrapOperatorFactory$KeyWrapper.<init>(Unknown Source)\t\r\nat org.bouncycastle.crypto.general.RSA$KeyWrapOperatorFactory.createKeyWrapper(Unknown Source)\t\r\nat org.bouncycastle.crypto.general.RSA$KeyWrapOperatorFactory.createKeyWrapper(Unknown Source)\t\r\nat org.bouncycastle.jcajce.provider.BaseSingleBlockCipher.engineInit(Unknown Source)\t\r\nat org.bouncycastle.jcajce.provider.BaseSingleBlockCipher.engineInit(Unknown Source)\t\r\nat javax.crypto.Cipher.implInit(Cipher.java:839)\t\r\nat javax.crypto.Cipher.chooseProvider(Cipher.java:901)\t\r\nat javax.crypto.Cipher.init(Cipher.java:1286)\t\r\nat javax.crypto.Cipher.init(Cipher.java:1223)\t\r\nat org.apache.xml.security.encryption.XMLCipher.encryptKey(XMLCipher.java:1384)\t\r\nat org.apache.xml.security.encryption.XMLCipher.encryptKey(XMLCipher.java:1322)\t\r\nat org.apache.xml.security.encryption.XMLCipher.encryptKey(XMLCipher.java:1302)\t\r\nat org.opensaml.xmlsec.encryption.support.Encrypter.encryptKey(Encrypter.java:362)\t\r\nat org.opensaml.xmlsec.encryption.support.Encrypter.encryptKey(Encrypter.java:297)\t\r\nat org.opensaml.xmlsec.encryption.support.Encrypter.encryptKey(Encrypter.java:274)\t\r\nat org.opensaml.saml.saml2.encryption.Encrypter.encrypt(Encrypter.java:378)\t\r\nat org.opensaml.saml.saml2.encryption.Encrypter.encrypt(Encrypter.java:256)\t\r\nat org.elasticsearch.xpack.security.authc.saml.SamlAuthenticatorTests.encryptAssertions(SamlAuthenticatorTests.java:1206)\t\r\nat org.elasticsearch.xpack.security.authc.saml.SamlAuthenticatorTests.testSuccessfullyParseContentFromEncryptedAssertion(SamlAuthenticatorTests.java:226)\t\r\n```\r\n","closed_by":{"login":"ywangd","id":2344308,"node_id":"MDQ6VXNlcjIzNDQzMDg=","avatar_url":"https://avatars3.githubusercontent.com/u/2344308?v=4","gravatar_id":"","url":"https://api.github.com/users/ywangd","html_url":"https://github.com/ywangd","followers_url":"https://api.github.com/users/ywangd/followers","following_url":"https://api.github.com/users/ywangd/following{/other_user}","gists_url":"https://api.github.com/users/ywangd/gists{/gist_id}","starred_url":"https://api.github.com/users/ywangd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywangd/subscriptions","organizations_url":"https://api.github.com/users/ywangd/orgs","repos_url":"https://api.github.com/users/ywangd/repos","events_url":"https://api.github.com/users/ywangd/events{/privacy}","received_events_url":"https://api.github.com/users/ywangd/received_events","type":"User","site_admin":false},"performed_via_github_app":null}