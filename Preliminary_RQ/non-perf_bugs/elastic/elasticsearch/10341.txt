{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10341","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10341/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10341/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10341/events","html_url":"https://github.com/elastic/elasticsearch/issues/10341","id":65439713,"node_id":"MDU6SXNzdWU2NTQzOTcxMw==","number":10341,"title":"adding irrelevant document change order of result","user":{"login":"esmaeilzadeh","id":4282424,"node_id":"MDQ6VXNlcjQyODI0MjQ=","avatar_url":"https://avatars1.githubusercontent.com/u/4282424?v=4","gravatar_id":"","url":"https://api.github.com/users/esmaeilzadeh","html_url":"https://github.com/esmaeilzadeh","followers_url":"https://api.github.com/users/esmaeilzadeh/followers","following_url":"https://api.github.com/users/esmaeilzadeh/following{/other_user}","gists_url":"https://api.github.com/users/esmaeilzadeh/gists{/gist_id}","starred_url":"https://api.github.com/users/esmaeilzadeh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/esmaeilzadeh/subscriptions","organizations_url":"https://api.github.com/users/esmaeilzadeh/orgs","repos_url":"https://api.github.com/users/esmaeilzadeh/repos","events_url":"https://api.github.com/users/esmaeilzadeh/events{/privacy}","received_events_url":"https://api.github.com/users/esmaeilzadeh/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-03-31T12:34:13Z","updated_at":"2015-04-05T13:35:35Z","closed_at":"2015-03-31T12:42:53Z","author_association":"NONE","active_lock_reason":null,"body":"I started with a clean instance of elasticsearch\nand add these documents:\n\n```\nPOST index_for_test/business/201778816\n{\n               \"name\": \"pizza perperook\",\n               \"categories\": \"food italian\"\n}\nPOST index_for_test/business/126949399\n{\n               \"name\": \"bono italian resturant\",\n               \"categories\": \"pizza\"\n}\nPOST _refresh\n```\n\nand run this query:\n\n```\nGET index_for_test/business/_search\n{\n\n    \"query\": {\n            \"multi_match\": {\n            \"query\":       \"italian\",\n            \"type\":        \"most_fields\",\n            \"fields\":      [ \"name^2\", \"categories\" ]\n          }\n    }\n}\n```\n\nresult is this (as expected):\n\n```\n{\n   \"took\": 3,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 2,\n      \"max_score\": 0.04012554,\n      \"hits\": [\n         {\n            \"_index\": \"index_for_test\",\n            \"_type\": \"business\",\n            \"_id\": \"126949399\",\n            \"_score\": 0.04012554,\n            \"_source\": {\n               \"name\": \"bono italian resturant\",\n               \"categories\": \"pizza\"\n            }\n         },\n         {\n            \"_index\": \"index_for_test\",\n            \"_type\": \"business\",\n            \"_id\": \"201778816\",\n            \"_score\": 0.014542127,\n            \"_source\": {\n               \"name\": \"pizza perperook\",\n               \"categories\": \"food italian\"\n            }\n         }\n      ]\n   }\n}\n```\n\nafter that I add another document:\n\n```\nPOST index_for_test/business/125697759\n{\n               \"name\": \"valid id\",\n               \"categories\": \"pizza\"\n}\nPOST _refresh\n```\n\nthen I run again the query:\n\n```\nGET index_for_test/business/_search\n{\n\n    \"query\": {\n            \"multi_match\": {\n            \"query\":       \"italian\",\n            \"type\":        \"most_fields\",\n            \"fields\":      [ \"name^2\", \"categories\" ]\n          }\n    }\n}\n```\n\nand result is : (as expected)\n\n```\n{\n   \"took\": 5,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 2,\n      \"max_score\": 0.04012554,\n      \"hits\": [\n         {\n            \"_index\": \"index_for_test\",\n            \"_type\": \"business\",\n            \"_id\": \"126949399\",\n            \"_score\": 0.04012554,\n            \"_source\": {\n               \"name\": \"bono italian resturant\",\n               \"categories\": \"pizza\"\n            }\n         },\n         {\n            \"_index\": \"index_for_test\",\n            \"_type\": \"business\",\n            \"_id\": \"201778816\",\n            \"_score\": 0.014542127,\n            \"_source\": {\n               \"name\": \"pizza perperook\",\n               \"categories\": \"food italian\"\n            }\n         }\n      ]\n   }\n}\n```\n\nthen I add another document (id is important)\n\n```\nPOST index_for_test/business/108493874\n{\n               \"name\": \"invalid id\",\n               \"categories\": \"pizza\"\n}\n\nPOST _refresh\n```\n\nand run the query again:\n\n```\nGET index_for_test/business/_search\n{\n\n    \"query\": {\n            \"multi_match\": {\n            \"query\":       \"italian\",\n            \"type\":        \"most_fields\",\n            \"fields\":      [ \"name^2\", \"categories\" ]\n          }\n    }\n}\n```\n\nand result is :(order and scores is not as expected)\n\n```\n{\n   \"took\": 2,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 2,\n      \"max_score\": 0.08850529,\n      \"hits\": [\n         {\n            \"_index\": \"index_for_test\",\n            \"_type\": \"business\",\n            \"_id\": \"201778816\",\n            \"_score\": 0.08850529,\n            \"_source\": {\n               \"name\": \"pizza perperook\",\n               \"categories\": \"food italian\"\n            }\n         },\n         {\n            \"_index\": \"index_for_test\",\n            \"_type\": \"business\",\n            \"_id\": \"126949399\",\n            \"_score\": 0.04012554,\n            \"_source\": {\n               \"name\": \"bono italian resturant\",\n               \"categories\": \"pizza\"\n            }\n         }\n      ]\n   }\n}\n```\n\nit is completely magical :)\nit seems if I add a document with these id it corrupts index of elasticsearch:\n120365673\n407572830\n108493874\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}