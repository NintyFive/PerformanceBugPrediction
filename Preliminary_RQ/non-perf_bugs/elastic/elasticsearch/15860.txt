{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15860","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15860/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15860/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15860/events","html_url":"https://github.com/elastic/elasticsearch/issues/15860","id":125648180,"node_id":"MDU6SXNzdWUxMjU2NDgxODA=","number":15860,"title":"multi_match query gives java.lang.IllegalArgumentException: Illegal shift value, must be 0..63; got shift=2147483647","user":{"login":"jreinke","id":598419,"node_id":"MDQ6VXNlcjU5ODQxOQ==","avatar_url":"https://avatars2.githubusercontent.com/u/598419?v=4","gravatar_id":"","url":"https://api.github.com/users/jreinke","html_url":"https://github.com/jreinke","followers_url":"https://api.github.com/users/jreinke/followers","following_url":"https://api.github.com/users/jreinke/following{/other_user}","gists_url":"https://api.github.com/users/jreinke/gists{/gist_id}","starred_url":"https://api.github.com/users/jreinke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jreinke/subscriptions","organizations_url":"https://api.github.com/users/jreinke/orgs","repos_url":"https://api.github.com/users/jreinke/repos","events_url":"https://api.github.com/users/jreinke/events{/privacy}","received_events_url":"https://api.github.com/users/jreinke/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2016-01-08T16:52:27Z","updated_at":"2016-01-15T14:54:59Z","closed_at":"2016-01-15T14:54:59Z","author_association":"NONE","active_lock_reason":null,"body":"Hi team,\n\nI get an error using a `multi_match` query with `cross_fields` type and a numeric query.\nI'm using v2.1.1 on OSX, installed via Homebrew.\n\n**Index basic data**\n\n```\ncurl -XPUT http://localhost:9200/blog/post/1?pretty=1 -d '{\"foo\":123, \"bar\":\"xyzzy\", \"baz\":456}'\n```\n\n**Use a `multi_match` query with `cross_fields` type and a numeric query**\n\n```\ncurl -XGET http://localhost:9200/blog/post/_search?pretty=1 -d '{\"query\": {\"multi_match\": {\"type\": \"cross_fields\", \"query\": \"100\", \"lenient\": true, \"fields\": [\"foo\", \"bar\", \"baz\"]}}}'\n```\n\n**Error**\n\n```\n{\n  \"error\" : {\n    \"root_cause\" : [ {\n      \"type\" : \"illegal_argument_exception\",\n      \"reason\" : \"Illegal shift value, must be 0..63; got shift=2147483647\"\n    } ],\n    \"type\" : \"search_phase_execution_exception\",\n    \"reason\" : \"all shards failed\",\n    \"phase\" : \"query\",\n    \"grouped\" : true,\n    \"failed_shards\" : [ {\n      \"shard\" : 0,\n      \"index\" : \"blog\",\n      \"node\" : \"0TxGVVWsSu2qX63hZdOv2w\",\n      \"reason\" : {\n        \"type\" : \"illegal_argument_exception\",\n        \"reason\" : \"Illegal shift value, must be 0..63; got shift=2147483647\"\n      }\n    } ]\n  },\n  \"status\" : 400\n}\n```\n\n**Note that the error does not appear if I specify only 1 numeric field in search.**\n\n**Stack trace**\n\n```\nCaused by: java.lang.IllegalArgumentException: Illegal shift value, must be 0..63; got shift=2147483647\n    at org.apache.lucene.util.NumericUtils.longToPrefixCodedBytes(NumericUtils.java:147)\n    at org.apache.lucene.util.NumericUtils.longToPrefixCoded(NumericUtils.java:121)\n    at org.apache.lucene.analysis.NumericTokenStream$NumericTermAttributeImpl.getBytesRef(NumericTokenStream.java:163)\n    at org.apache.lucene.analysis.NumericTokenStream$NumericTermAttributeImpl.clone(NumericTokenStream.java:217)\n    at org.apache.lucene.analysis.NumericTokenStream$NumericTermAttributeImpl.clone(NumericTokenStream.java:148)\n    at org.apache.lucene.util.AttributeSource$State.clone(AttributeSource.java:54)\n    at org.apache.lucene.util.AttributeSource.captureState(AttributeSource.java:281)\n    at org.apache.lucene.analysis.CachingTokenFilter.fillCache(CachingTokenFilter.java:96)\n    at org.apache.lucene.analysis.CachingTokenFilter.incrementToken(CachingTokenFilter.java:70)\n    at org.apache.lucene.util.QueryBuilder.createFieldQuery(QueryBuilder.java:223)\n    at org.apache.lucene.util.QueryBuilder.createBooleanQuery(QueryBuilder.java:87)\n    at org.elasticsearch.index.search.MatchQuery.parse(MatchQuery.java:178)\n    at org.elasticsearch.index.search.MultiMatchQuery.parseAndApply(MultiMatchQuery.java:55)\n    at org.elasticsearch.index.search.MultiMatchQuery.access$000(MultiMatchQuery.java:42)\n    at org.elasticsearch.index.search.MultiMatchQuery$QueryBuilder.parseGroup(MultiMatchQuery.java:118)\n    at org.elasticsearch.index.search.MultiMatchQuery$CrossFieldsQueryBuilder.buildGroupedQueries(MultiMatchQuery.java:198)\n    at org.elasticsearch.index.search.MultiMatchQuery.parse(MultiMatchQuery.java:86)\n    at org.elasticsearch.index.query.MultiMatchQueryParser.parse(MultiMatchQueryParser.java:163)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:257)\n    at org.elasticsearch.index.query.IndexQueryParserService.innerParse(IndexQueryParserService.java:303)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:206)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:201)\n    at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:831)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:651)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:617)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:368)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:368)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:365)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:350)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n```\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}