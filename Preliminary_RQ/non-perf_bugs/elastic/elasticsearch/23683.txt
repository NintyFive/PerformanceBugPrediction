{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23683","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23683/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23683/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23683/events","html_url":"https://github.com/elastic/elasticsearch/issues/23683","id":215857453,"node_id":"MDU6SXNzdWUyMTU4NTc0NTM=","number":23683,"title":"Normalizer Settings Validation","user":{"login":"DustinChaloupka","id":1587451,"node_id":"MDQ6VXNlcjE1ODc0NTE=","avatar_url":"https://avatars2.githubusercontent.com/u/1587451?v=4","gravatar_id":"","url":"https://api.github.com/users/DustinChaloupka","html_url":"https://github.com/DustinChaloupka","followers_url":"https://api.github.com/users/DustinChaloupka/followers","following_url":"https://api.github.com/users/DustinChaloupka/following{/other_user}","gists_url":"https://api.github.com/users/DustinChaloupka/gists{/gist_id}","starred_url":"https://api.github.com/users/DustinChaloupka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DustinChaloupka/subscriptions","organizations_url":"https://api.github.com/users/DustinChaloupka/orgs","repos_url":"https://api.github.com/users/DustinChaloupka/repos","events_url":"https://api.github.com/users/DustinChaloupka/events{/privacy}","received_events_url":"https://api.github.com/users/DustinChaloupka/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2017-03-21T19:49:22Z","updated_at":"2017-04-11T07:03:09Z","closed_at":"2017-04-11T07:03:09Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.2.2\r\n\r\n**Plugins installed**: Just the defaults\r\n\r\n**JVM version**: openjdk `1.8.0_111-8u111-b14-3~14.04.1-b14`\r\n\r\n**OS version**: Ubuntu 14.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWas trying to migrate an analyzed `string` field (from ES 2.4) to a better field setup. I hadn't found anything super clear on how to go about doing this, so one of the things I had tried was adding a normalizer. However, I mistakenly used a `tokenizer` parameter as apart of the normalizer, which it does not support. This addition was after closing the index. But, since it's not possible to \"remove\" a parameter from a normalizer (at least that I could find), the `tokenizer` parameter is now permanently part of the normalizer. Now, I have no way of opening the index since ES gives back a `500` when trying to open a badly configured index.\r\n\r\nI would expect that if there is index validation on opening an index, that any settings that get added to an index would get validated as well so that this state cannot happen. Instead I was given a `200` back when misconfiguring the closed index.\r\n\r\nNot specifically part of the \"bug\" part of this, but now I'm wondering if it's possible to even open this index at all now?\r\n\r\n**Steps to reproduce**:\r\n 1. Close an index\r\n 2. Add a `\"tokenizer\": \"my_tokenizer\"` field to a normalizer in the closed index\r\n 3. Try to open the index\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n➜  ~ curl -XPOST 'http://localhost:9200/my_index/_close'\r\n{\"acknowledged\":true}\r\n➜  ~ curl -XPUT 'http://localhost:9200/my_index/_settings' -d '{\"analysis\": {\"normalizer\": {\"my_normalizer\": {\"type\": \"custom\",\"tokenizer\": \"my_tokenizer\"}}}}'\r\n{\"acknowledged\":true}\r\n➜  ~ curl -XPOST 'http://localhost:9200/my_index/_open'\r\n{\"error\":{\"root_cause\":[{\"type\":\"exception\",\"reason\":\"Failed to verify index [my_index/w_VhFiSWRhiIz-z9AGOoPQ]\"}],\"type\":\"exception\",\"reason\":\"Failed to verify index [my_index/w_VhFiSWRhiIz-z9AGOoPQ]\",\"caused_by\":{\"type\":\"illegal_argument_exception\",\"reason\":\"Custom normalizer [my_normalizer] cannot configure a tokenizer\"}},\"status\":500}\r\n```\r\n\r\nNote: The tokenizer that was trying to be used was already created in the index.","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}