{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41742","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41742/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41742/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41742/events","html_url":"https://github.com/elastic/elasticsearch/issues/41742","id":439552806,"node_id":"MDU6SXNzdWU0Mzk1NTI4MDY=","number":41742,"title":"[CI] BasicDistributedJobsIT#testFailOverBasics_withDataFeeder times out","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-05-02T11:55:53Z","updated_at":"2019-06-17T08:26:37Z","closed_at":"2019-06-17T08:26:37Z","author_association":"MEMBER","active_lock_reason":null,"body":"This is on 6.7: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.7+multijob-darwin-compatibility/142/console\r\n\r\nCould not reproduce locally so far:\r\n```\r\n./gradlew :x-pack:plugin:ml:internalClusterTest \\\r\n  -Dtests.seed=4C44E5E21479B1F6 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ml.integration.BasicDistributedJobsIT \\\r\n  -Dtests.method=\"testFailOverBasics_withDataFeeder\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=be-BY \\\r\n  -Dtests.timezone=Iceland \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=8\r\n```\r\n```\r\njava.lang.AssertionError: timed out waiting for green state\r\n\tat __randomizedtesting.SeedInfo.seed([4C44E5E21479B1F6:A3F1B919D37EAF7B]:0)\r\n\tat org.junit.Assert.fail(Assert.java:88)\r\n\tat org.elasticsearch.test.ESIntegTestCase.ensureColor(ESIntegTestCase.java:975)\r\n\tat org.elasticsearch.test.ESIntegTestCase.ensureGreen(ESIntegTestCase.java:931)\r\n\tat org.elasticsearch.test.ESIntegTestCase.ensureGreen(ESIntegTestCase.java:920)\r\n\tat org.elasticsearch.xpack.ml.integration.BasicDistributedJobsIT.testFailOverBasics_withDataFeeder(BasicDistributedJobsIT.java:124)\r\n```\r\nEarlier the master leaves the test cluster and there are connection errors in the logs following this:\r\n```\r\nxpack.installed=true, ml.max_open_jobs=20, ml.enabled=true}, local\r\n  1> [2019-05-02T11:02:18,100][INFO ][o.e.t.d.MockZenPing      ] [node_t1] pinging using mock zen ping\r\n  1> [2019-05-02T11:02:18,100][INFO ][o.e.t.d.MockZenPing      ] [node_t2] pinging using mock zen ping\r\n  1> [2019-05-02T11:02:18,105][WARN ][o.e.t.OutboundHandler    ] [node_t0] send message failed [channel: MockChannel{profile='default', isOpen=false, localAddress=/127.0.0.1:59660, isServerSocket=false}]\r\n  1> java.net.SocketException: Socket is closed\r\n  1> \tat java.net.Socket.getOutputStream(Socket.java:943) ~[?:1.8.0_212]\r\n  1> \tat org.elasticsearch.transport.MockTcpTransport$MockChannel.sendMessage(MockTcpTransport.java:437) [framework-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.OutboundHandler.internalSendMessage(OutboundHandler.java:80) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.OutboundHandler.sendMessage(OutboundHandler.java:70) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.TcpTransport.sendErrorResponse(TcpTransport.java:716) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.TcpTransportChannel.sendResponse(TcpTransportChannel.java:73) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:60) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.action.support.replication.TransportReplicationAction$OperationTransportHandler$1.onFailure(TransportReplicationAction.java:296) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase.finishAsFailed(TransportReplicationAction.java:945) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase$1.handleException(TransportReplicationAction.java:903) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1114) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:665) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n  1> [2019-05-02T11:02:18,119][INFO ][o.e.n.Node               ] [testFailOverBasics_withDataFeeder] stopped\r\n  1> [2019-05-02T11:02:18,119][INFO ][o.e.n.Node               ] [testFailOverBasics_withDataFeeder] closing ...\r\n  1> [2019-05-02T11:02:18,122][INFO ][o.e.n.Node               ] [testFailOverBasics_withDataFeeder] closed\r\n  1> [2019-05-02T11:02:21,253][INFO ][o.e.c.s.MasterService    ] [node_t3] zen-disco-elected-as-master ([1] nodes joined)[{node_t2}{ukuNaOABRY-ROr1VHZoecQ}{IyBV5B2aTt-d--Vz5UISmA}{127.0.0.1}{127.0.0.1:59656}{ml.machine_memory=34359738368, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}], reason: new_master {node_t3}{cnjj9MlKQOmUbruhDHORpA}{1XuyG_aVQhSggAsbR_UR0Q}{127.0.0.1}{127.0.0.1:59657}{ml.machine_memory=34359738368, xpack.installed=true, ml.max_open_jobs=20, ml.enabled=true}\r\n  1> [2019-05-02T11:02:21,254][INFO ][o.e.c.s.ClusterApplierService] [node_t2] detected_master {node_t3}{cnjj9MlKQOmUbruhDHORpA}{1XuyG_aVQhSggAsbR_UR0Q}{127.0.0.1}{127.0.0.1:59657}{ml.machine_memory=34359738368, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}, reason: apply cluster state (from master [master {node_t3}{cnjj9MlKQOmUbruhDHORpA}{1XuyG_aVQhSggAsbR_UR0Q}{127.0.0.1}{127.0.0.1:59657}{ml.machine_memory=34359738368, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true} committed version [31]])\r\n  1> [2019-05-02T11:02:21,254][INFO ][o.e.c.s.ClusterApplierService] [node_t1] detected_master {node_t3}{cnjj9MlKQOmUbruhDHORpA}{1XuyG_aVQhSggAsbR_UR0Q}{127.0.0.1}{127.0.0.1:59657}{ml.machine_memory=34359738368, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}, reason: apply cluster state (from master [master {node_t3}{cnjj9MlKQOmUbruhDHORpA}{1XuyG_aVQhSggAsbR_UR0Q}{127.0.0.1}{127.0.0.1:59657}{ml.machine_memory=34359738368, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true} committed version [31]])\r\n  1> [2019-05-02T11:02:21,255][WARN ][o.e.c.NodeConnectionsService] [node_t2] failed to connect to node {node_t0}{bvTYSYCbRuyN07MlTgZOzA}{V-fLnWAxRUCcHPO3Ih5Tkw}{127.0.0.1}{127.0.0.1:59651}{ml.machine_memory=34359738368, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true} (tried [1] times)\r\n  1> org.elasticsearch.transport.ConnectTransportException: [node_t0][127.0.0.1:59651] connect_exception\r\n  1> \tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onFailure(TcpTransport.java:1309) ~[elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.action.ActionListener.lambda$toBiConsumer$2(ActionListener.java:100) ~[elasticsearch-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.common.concurrent.CompletableContext.lambda$addListener$0(CompletableContext.java:42) ~[elasticsearch-core-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_212]\r\n  1> \tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_212]\r\n  1> \tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_212]\r\n  1> \tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_212]\r\n  1> \tat org.elasticsearch.common.concurrent.CompletableContext.completeExceptionally(CompletableContext.java:57) ~[elasticsearch-core-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.MockTcpTransport.lambda$initiateChannel$0(MockTcpTransport.java:195) ~[framework-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_212]\r\n  1> \tat java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_212]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n  1> Caused by: java.net.ConnectException: Connection refused (Connection refused)\r\n  1> \tat java.net.PlainSocketImpl.socketConnect(Native Method) ~[?:1.8.0_212]\r\n  1> \tat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350) ~[?:1.8.0_212]\r\n  1> \tat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206) ~[?:1.8.0_212]\r\n  1> \tat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188) ~[?:1.8.0_212]\r\n  1> \tat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392) ~[?:1.8.0_212]\r\n  1> \tat java.net.Socket.connect(Socket.java:589) ~[?:1.8.0_212]\r\n  1> \tat org.elasticsearch.mocksocket.MockSocket.access$101(MockSocket.java:32) ~[mocksocket-1.2.jar:?]\r\n  1> \tat org.elasticsearch.mocksocket.MockSocket.lambda$connect$0(MockSocket.java:66) ~[mocksocket-1.2.jar:?]\r\n  1> \tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_212]\r\n  1> \tat org.elasticsearch.mocksocket.MockSocket.connect(MockSocket.java:65) ~[mocksocket-1.2.jar:?]\r\n  1> \tat org.elasticsearch.mocksocket.MockSocket.connect(MockSocket.java:59) ~[mocksocket-1.2.jar:?]\r\n  1> \tat org.elasticsearch.transport.MockTcpTransport.lambda$initiateChannel$0(MockTcpTransport.java:190) ~[framework-6.7.2-SNAPSHOT.jar:6.7.2-SNAPSHOT]\r\n  1> \t... 5 more\r\n```\r\n","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}