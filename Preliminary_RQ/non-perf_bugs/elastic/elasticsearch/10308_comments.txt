[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87470224","html_url":"https://github.com/elastic/elasticsearch/issues/10308#issuecomment-87470224","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10308","id":87470224,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NDcwMjI0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-03-29T20:29:16Z","updated_at":"2015-03-29T20:29:16Z","author_association":"MEMBER","body":"@damienbod inner_hits in a nested filter should work. I quickly tried to verified that `inner_hits` works in a `nested` filter. If it doesn't work in your case can you share your reproduction of the issue?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87476101","html_url":"https://github.com/elastic/elasticsearch/issues/10308#issuecomment-87476101","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10308","id":87476101,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NDc2MTAx","user":{"login":"damienbod","id":3442158,"node_id":"MDQ6VXNlcjM0NDIxNTg=","avatar_url":"https://avatars3.githubusercontent.com/u/3442158?v=4","gravatar_id":"","url":"https://api.github.com/users/damienbod","html_url":"https://github.com/damienbod","followers_url":"https://api.github.com/users/damienbod/followers","following_url":"https://api.github.com/users/damienbod/following{/other_user}","gists_url":"https://api.github.com/users/damienbod/gists{/gist_id}","starred_url":"https://api.github.com/users/damienbod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/damienbod/subscriptions","organizations_url":"https://api.github.com/users/damienbod/orgs","repos_url":"https://api.github.com/users/damienbod/repos","events_url":"https://api.github.com/users/damienbod/events{/privacy}","received_events_url":"https://api.github.com/users/damienbod/received_events","type":"User","site_admin":false},"created_at":"2015-03-29T21:05:03Z","updated_at":"2015-03-30T04:14:05Z","author_association":"NONE","body":"Hi Thanks for your reply. Here's my data:\n\nMapping:\n\n```\nPUT http://localhost:9200/nestedcollectiontests/nestedcollectiontest/_mappings HTTP/1.1\nContent-Type: application/json\nHost: localhost:9200\nContent-Length: 616\nExpect: 100-continue\n\n{\"nestedcollectiontest\":{\"properties\":{\"id\":{ \"type\" : \"long\" },\"nameskillparent\":{ \"type\" : \"string\" },\"descriptionskillparent\":{ \"type\" : \"string\" },\"createdskillparent\":{ \"type\" : \"date\", \"format\": \"dateOptionalTime\"},\"updatedskillparent\":{ \"type\" : \"date\", \"format\": \"dateOptionalTime\"},\"skillchildren\":{\"type\":\"nested\",\"include_in_parent\":true,\"properties\":{\"id\":{ \"type\" : \"long\" },\"nameskillchild\":{ \"type\" : \"string\" },\"descriptionskillchild\":{ \"type\" : \"string\" },\"createdskillchild\":{ \"type\" : \"date\", \"format\": \"dateOptionalTime\"},\"updatedskillchild\":{ \"type\" : \"date\", \"format\": \"dateOptionalTime\"}}}}}}\n\n```\n\nTest Data:\n\n```\nPOST http://localhost:9200/_bulk HTTP/1.1\nContent-Type: application/json\nHost: localhost:9200\nContent-Length: 906\nExpect: 100-continue\n\n{\"index\":{\"_index\":\"nestedcollectiontests\",\"_type\":\"nestedcollectiontest\",\"_id\":8}}\n{\"id\":8,\"nameskillparent\":\"cool\",\"descriptionskillparent\":\"A test entity description\",\"createdskillparent\":\"2015-03-29T20:59:51.0179334+00:00\",\"updatedskillparent\":\"2015-03-29T20:59:51.0179334+00:00\",\"skillchildren\":[{\"id\":0,\"nameskillchild\":\"cool\",\"descriptionskillchild\":\"A test SkillChild description\",\"createdskillchild\":\"2015-03-29T20:59:51.0159335+00:00\",\"updatedskillchild\":\"2015-03-29T20:59:51.0159335+00:00\"},{\"id\":1,\"nameskillchild\":\"cool\",\"descriptionskillchild\":\"A test SkillChild description\",\"createdskillchild\":\"2015-03-29T20:59:51.0159335+00:00\",\"updatedskillchild\":\"2015-03-29T20:59:51.0159335+00:00\"},{\"id\":2,\"nameskillchild\":\"cool\",\"descriptionskillchild\":\"A test SkillChild description\",\"createdskillchild\":\"2015-03-29T20:59:51.0159335+00:00\",\"updatedskillchild\":\"2015-03-29T20:59:51.0159335+00:00\"}]}\n```\n\nSearch Request:\n\n```\nPOST http://localhost:9200/nestedcollectiontests/nestedcollectiontest/_search HTTP/1.1\nContent-Type: application/json\nHost: localhost:9200\nContent-Length: 88\nExpect: 100-continue\n\n{\"filter\":{\"nested\":{\"path\":\"skillchildren\",\"filter\":{\"match_all\":{}},\"inner_hits\":{}}}}\n```\n\nResponse:\n\n```\nHTTP/1.1 400 Bad Request\nContent-Type: application/json; charset=UTF-8\nContent-Length: 1997\n\n{\"error\":\"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[g6ANIIX0SieBnVvi3jhjJA][nestedcollectiontests][0]: SearchParseException[[nestedcollectiontests][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"filter\\\":{\\\"nested\\\":{\\\"path\\\":\\\"skillchildren\\\",\\\"filter\\\":{\\\"match_all\\\":{}},\\\"inner_hits\\\":{}}}}]]]; nested: QueryParsingException[[nestedcollectiontests] [nested] requires either 'query' or 'filter' field]; }{[g6ANIIX0SieBnVvi3jhjJA][nestedcollectiontests][1]: SearchParseException[[nestedcollectiontests][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"filter\\\":{\\\"nested\\\":{\\\"path\\\":\\\"skillchildren\\\",\\\"filter\\\":{\\\"match_all\\\":{}},\\\"inner_hits\\\":{}}}}]]]; nested: QueryParsingException[[nestedcollectiontests] [nested] requires either 'query' or 'filter' field]; }{[g6ANIIX0SieBnVvi3jhjJA][nestedcollectiontests][2]: SearchParseException[[nestedcollectiontests][2]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"filter\\\":{\\\"nested\\\":{\\\"path\\\":\\\"skillchildren\\\",\\\"filter\\\":{\\\"match_all\\\":{}},\\\"inner_hits\\\":{}}}}]]]; nested: QueryParsingException[[nestedcollectiontests] [nested] requires either 'query' or 'filter' field]; }{[g6ANIIX0SieBnVvi3jhjJA][nestedcollectiontests][3]: SearchParseException[[nestedcollectiontests][3]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"filter\\\":{\\\"nested\\\":{\\\"path\\\":\\\"skillchildren\\\",\\\"filter\\\":{\\\"match_all\\\":{}},\\\"inner_hits\\\":{}}}}]]]; nested: QueryParsingException[[nestedcollectiontests] [nested] requires either 'query' or 'filter' field]; }{[g6ANIIX0SieBnVvi3jhjJA][nestedcollectiontests][4]: SearchParseException[[nestedcollectiontests][4]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"filter\\\":{\\\"nested\\\":{\\\"path\\\":\\\"skillchildren\\\",\\\"filter\\\":{\\\"match_all\\\":{}},\\\"inner_hits\\\":{}}}}]]]; nested: QueryParsingException[[nestedcollectiontests] [nested] requires either 'query' or 'filter' field]; }]\",\"status\":400}\n```\n\nElasticsearch version:\n\n```\n{\n\n    \"status\": 200,\n    \"name\": \"Shen Kuei\",\n    \"cluster_name\": \"elasticsearch\",\n    \"version\": \n\n    {\n        \"number\": \"1.5.0\",\n        \"build_hash\": \"544816042d40151d3ce4ba4f95399d7860dc2e92\",\n        \"build_timestamp\": \"2015-03-23T14:30:58Z\",\n        \"build_snapshot\": false,\n        \"lucene_version\": \"4.10.4\"\n    },\n    \"tagline\": \"You Know, for Search\"\n\n}\n```\n\nThanks for your help.\n\nGreetings Damien\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87486692","html_url":"https://github.com/elastic/elasticsearch/issues/10308#issuecomment-87486692","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10308","id":87486692,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NDg2Njky","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-03-29T21:58:21Z","updated_at":"2015-03-29T21:58:21Z","author_association":"MEMBER","body":"Hey @damienbod this is a bug. Thanks for sharing your data!\n\nIt only manifest if a inner filter is used in the nested filter. If a inner query is used instead then the issue doesn't occur, so the following works:\n\n```\n{\n    \"filter\": {\n        \"nested\": {\n            \"path\": \"skillchildren\",\n            \"query\": {\n                \"match_all\": { }\n            },\n            \"inner_hits\": { }\n        }\n    }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87536466","html_url":"https://github.com/elastic/elasticsearch/issues/10308#issuecomment-87536466","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10308","id":87536466,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NTM2NDY2","user":{"login":"damienbod","id":3442158,"node_id":"MDQ6VXNlcjM0NDIxNTg=","avatar_url":"https://avatars3.githubusercontent.com/u/3442158?v=4","gravatar_id":"","url":"https://api.github.com/users/damienbod","html_url":"https://github.com/damienbod","followers_url":"https://api.github.com/users/damienbod/followers","following_url":"https://api.github.com/users/damienbod/following{/other_user}","gists_url":"https://api.github.com/users/damienbod/gists{/gist_id}","starred_url":"https://api.github.com/users/damienbod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/damienbod/subscriptions","organizations_url":"https://api.github.com/users/damienbod/orgs","repos_url":"https://api.github.com/users/damienbod/repos","events_url":"https://api.github.com/users/damienbod/events{/privacy}","received_events_url":"https://api.github.com/users/damienbod/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T04:14:50Z","updated_at":"2015-03-30T04:14:50Z","author_association":"NONE","body":"No problem\nThanks for looking \ngreetings Damien\n","performed_via_github_app":null}]