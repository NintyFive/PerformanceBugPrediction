{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21714","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21714/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21714/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21714/events","html_url":"https://github.com/elastic/elasticsearch/issues/21714","id":190805191,"node_id":"MDU6SXNzdWUxOTA4MDUxOTE=","number":21714,"title":"max_doc_count doesn't work?","user":{"login":"k2xl","id":965260,"node_id":"MDQ6VXNlcjk2NTI2MA==","avatar_url":"https://avatars3.githubusercontent.com/u/965260?v=4","gravatar_id":"","url":"https://api.github.com/users/k2xl","html_url":"https://github.com/k2xl","followers_url":"https://api.github.com/users/k2xl/followers","following_url":"https://api.github.com/users/k2xl/following{/other_user}","gists_url":"https://api.github.com/users/k2xl/gists{/gist_id}","starred_url":"https://api.github.com/users/k2xl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/k2xl/subscriptions","organizations_url":"https://api.github.com/users/k2xl/orgs","repos_url":"https://api.github.com/users/k2xl/repos","events_url":"https://api.github.com/users/k2xl/events{/privacy}","received_events_url":"https://api.github.com/users/k2xl/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-11-21T18:56:37Z","updated_at":"2016-11-25T16:06:06Z","closed_at":"2016-11-25T16:06:06Z","author_association":"NONE","active_lock_reason":null,"body":"I'm using Elasticsearch 5 to monitor systems, and I'm trying to query for all the systems that in the past hour haven't much data.\r\n\r\nMy query is as follows:\r\n\r\n```\r\n{\r\n  \"aggs\": {\r\n    \r\n    \"filtered\": {\r\n      \"filter\": {\r\n        \"bool\": {\r\n          \"must\": [{\r\n            \"range\": {\r\n              \"@timestamp\": {\r\n                \"from\": \"now-1h\",\r\n                \"to\": \"now\"\r\n              }\r\n            }\r\n          }]\r\n        }\r\n      },\r\n      \"aggs\": {\r\n        \"hosts\": {\r\n          \"terms\": {\r\n            \"field\": \"hostname\",\r\n            \"size\": 30\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"size\": 0\r\n}\r\n```\r\nBut this just returns all the systems that have sent data.\r\n\r\nThere is a ```min_doc_count``` which will return buckets that have a count of at least ```min_doc_count```, but surprisingly, there doesn't appear to be a ```max_doc_count```?\r\n\r\nIs there are a workaround for returning results with low counts? The use case is if a system is expected to send a log every minute, and in the last hour less than 60 documents are in the system (or some other threshold, like 30) then it could mean there is an issue with that system.\r\n\r\nI've been reading the Pipeline aggregation doc, but I can't seem to figure out how to access doc_count","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}