{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/40983","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40983/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40983/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40983/events","html_url":"https://github.com/elastic/elasticsearch/issues/40983","id":430623948,"node_id":"MDU6SXNzdWU0MzA2MjM5NDg=","number":40983,"title":"Add back support for negative epoch values for time fields in Elasticsearch","user":{"login":"hanoch","id":1561905,"node_id":"MDQ6VXNlcjE1NjE5MDU=","avatar_url":"https://avatars0.githubusercontent.com/u/1561905?v=4","gravatar_id":"","url":"https://api.github.com/users/hanoch","html_url":"https://github.com/hanoch","followers_url":"https://api.github.com/users/hanoch/followers","following_url":"https://api.github.com/users/hanoch/following{/other_user}","gists_url":"https://api.github.com/users/hanoch/gists{/gist_id}","starred_url":"https://api.github.com/users/hanoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hanoch/subscriptions","organizations_url":"https://api.github.com/users/hanoch/orgs","repos_url":"https://api.github.com/users/hanoch/repos","events_url":"https://api.github.com/users/hanoch/events{/privacy}","received_events_url":"https://api.github.com/users/hanoch/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2019-04-08T19:40:41Z","updated_at":"2020-08-19T18:06:33Z","closed_at":"2019-08-29T18:04:56Z","author_association":"NONE","active_lock_reason":null,"body":"Testing with Elasticsearch v7.0.0-rc2, we can't seem to be able to write negative date epoch long values anymore using the `epoch_millis` date field format. This means that any date value before 1/1/1970 is a problem.\r\nWe are seeing the following error message:\r\n`...failed to parse date field [-12321] with format [epoch_millis]...`\r\n\r\nUsing the following GA versions of Elasticsearch we were and are able to write documents with negative date epoch long values using the `epoch_millis` date field format - v1.6.x, v1.7.x, v2.3.2, v5.5.0, v5.6.5, v6.4.2, v6.6.1, v6.6.2, v6.7.0, v6.7.1.\r\n\r\nWe are aware of the workaround to switch to use the ISO8601 string representation of the date values and set the field value to use that date field format rather than the `epoch_millis` format, but we are concerned about the need to change our code-bases and products from using the epoch long values to the ISO8601 string values because of:\r\n1. Performance hit needing to convert between Java/Scala Date/Instant objects and the ISO8601 strings. Having the Java/Scala implementation use the epoch long is more performing than having the need to parse (and generate) strings.\r\n2. We will need to change our implementations and APIs anywhere we need to write and read date field values, as well as query against date fields (see also #39375).\r\n3. Need to write new special logic to upgrade existing user's data that was created by an older version of Elasticsearch (e.g. v6.4.2, v5.5.0, etc.).\r\n\r\n__Relates to:__\r\n- #36793\r\n- #39375\r\n\r\n\r\n#### Logs:\r\n\r\n##### Error Message:\r\n`\r\nInsert operation failed. Error: \"WrappedArray([UpsertFieldValue:null]:Map(type -> mapper_parsing_exception, reason -> failed to parse field [IntervalStart] of type [date] in document with id 'XTYw5WkBP1AXtllM8BvD', caused_by -> Map(type -> illegal_argument_exception, reason -> failed to parse date field [-12321] with format [epoch_millis], caused_by -> Map(type -> date_time_parse_exception, reason -> Failed to parse with all enclosed parsers))),[UpsertFieldValue:null]:Map(type -> mapper_parsing_exception, reason -> failed to parse field [IntervalStart] of type [date] in document with id 'XjYw5WkBP1AXtllM8BvD', caused_by -> Map(type -> illegal_argument_exception, reason -> failed to parse date field [-5718] with format [epoch_millis], caused_by -> Map(type -> date_time_parse_exception, reason -> Failed to parse with all enclosed parsers))))\".\r\n`\r\n\r\n##### Stacktrace:\r\n`\r\ncom.esri.rf.HttpException: Insert operation failed. Error: \"WrappedArray([UpsertFieldValue:null]:Map(type -> mapper_parsing_exception, reason -> failed to parse field [IntervalStart] of type [date] in document with id 'XTYw5WkBP1AXtllM8BvD', caused_by -> Map(type -> illegal_argument_exception, reason -> failed to parse date field [-12321] with format [epoch_millis], caused_by -> Map(type -> date_time_parse_exception, reason -> Failed to parse with all enclosed parsers))),[UpsertFieldValue:null]:Map(type -> mapper_parsing_exception, reason -> failed to parse field [IntervalStart] of type [date] in document with id 'XjYw5WkBP1AXtllM8BvD', caused_by -> Map(type -> illegal_argument_exception, reason -> failed to parse date field [-5718] with format [epoch_millis], caused_by -> Map(type -> date_time_parse_exception, reason -> Failed to parse with all enclosed parsers))))\".\r\nat com.esri.bds.dialect.elasticsearch.editor.MultiPointEditorDialectTester.addFeatures(EditorDIalectTester.scala:49)\r\n`\r\n\r\n##### Standard Output:\r\n`\r\n2019-04-04T06:53:03,470 | INFO | c.e.b.d.e.e.MultiPointEditorDialectTester:342 | before test\r\n2019-04-04T06:53:03,703 | ERROR | c.e.a.b.e.HttpBDSClient$:2167 | Data source \"Wind_Forecast\" failed to create or update new documents. Failed to execute the bulk request. Error: {\"took\":15,\"errors\":true,\"items\":[{\"index\":{\"_index\":\"esri-ds-data_5da50ee9-9c9b-4352-93a0-919cf645d577_es-6-4-2_20190403\",\"_type\":\"_doc\",\"_id\":\"WjYw5WkBP1AXtllM8BvD\",\"_version\":1,\"result\":\"created\",\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"_seq_no\":141,\"_primary_term\":1,\"status\":201}},{\"index\":{\"_index\":\"esri-ds-data_5da50ee9-9c9b-4352-93a0-919cf645d577_es-6-4-2_20190403\",\"_type\":\"_doc\",\"_id\":\"WzYw5WkBP1AXtllM8BvD\",\"_version\":1,\"result\":\"created\",\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"_seq_no\":142,\"_primary_term\":1,\"status\":201}},{\"index\":{\"_index\":\"esri-ds-data_5da50ee9-9c9b-4352-93a0-919cf645d577_es-6-4-2_20190403\",\"_type\":\"_doc\",\"_id\":\"XDYw5WkBP1AXtllM8BvD\",\"_version\":1,\"result\":\"created\",\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"_seq_no\":143,\"_primary_term\":1,\"status\":201}},{\"index\":{\"_index\":\"esri-ds-data_5da50ee9-9c9b-4352-93a0-919cf645d577_es-6-4-2_20190403\",\"_type\":\"_doc\",\"_id\":\"XTYw5WkBP1AXtllM8BvD\",\"status\":400,\"error\":{\"type\":\"mapper_parsing_exception\",\"reason\":\"failed to parse field [IntervalStart] of type [date] in document with id 'XTYw5WkBP1AXtllM8BvD'\",\"caused_by\":{\"type\":\"illegal_argument_exception\",\"reason\":\"failed to parse date field [-12321] with format [epoch_millis]\",\"caused_by\":{\"type\":\"date_time_parse_exception\",\"reason\":\"Failed to parse with all enclosed parsers\"}}}}},{\"index\":{\"_index\":\"esri-ds-data_5da50ee9-9c9b-4352-93a0-919cf645d577_es-6-4-2_20190403\",\"_type\":\"_doc\",\"_id\":\"XjYw5WkBP1AXtllM8BvD\",\"status\":400,\"error\":{\"type\":\"mapper_parsing_exception\",\"reason\":\"failed to parse field [IntervalStart] of type [date] in document with id 'XjYw5WkBP1AXtllM8BvD'\",\"caused_by\":{\"type\":\"illegal_argument_exception\",\"reason\":\"failed to parse date field [-5718] with format [epoch_millis]\",\"caused_by\":{\"type\":\"date_time_parse_exception\",\"reason\":\"Failed to parse with all enclosed parsers\"}}}}}]}\r\n2019-04-04T06:53:03,705 | INFO | c.e.b.d.e.e.MultiPointEditorDialectTester:371 | after test\r\nStandard Error\r\nREPRODUCE WITH: gradlew null -Dtests.seed=FEC706F81CEFF67D -Dtests.class=com.esri.bds.dialect.elasticsearch.editor.MultiPointEditorDialectTester -Dtests.method=\"deleteFeaturesByExtent\" -Dtests.security.manager=false -Dtests.locale=sr-RS -Dtests.timezone=Asia/Yakutsk\r\n`","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}