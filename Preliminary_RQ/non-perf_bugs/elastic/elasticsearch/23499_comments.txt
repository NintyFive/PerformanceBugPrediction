[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/284812547","html_url":"https://github.com/elastic/elasticsearch/issues/23499#issuecomment-284812547","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23499","id":284812547,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NDgxMjU0Nw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-03-07T18:29:00Z","updated_at":"2017-03-07T18:29:00Z","author_association":"MEMBER","body":"> (because of the no of scripts that are being run)\r\n> This isn't happening if I run queries without scripts, no matter with what concurrency.\r\n\r\nThat query is quite complicated so I think it would helpful to try to reproduce with a smaller one. Can you double check it's not the terms agg (the size 10000 is obviously dangerous):\r\n\r\n```\r\n      \"terms\": {\r\n        \"field\": \"locations\",\r\n        \"size\": 10000,\r\n        \"order\": {\r\n          \"_term\": \"asc\"\r\n        }\r\n      },\r\n```\r\n\r\nWhat happens if you run your script (`latestByTimeStamp__f7BedzrFUQ__test_meta__WMk4jA0bd24 `) as a single top level agg?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/284920562","html_url":"https://github.com/elastic/elasticsearch/issues/23499#issuecomment-284920562","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23499","id":284920562,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NDkyMDU2Mg==","user":{"login":"vanga","id":5126396,"node_id":"MDQ6VXNlcjUxMjYzOTY=","avatar_url":"https://avatars3.githubusercontent.com/u/5126396?v=4","gravatar_id":"","url":"https://api.github.com/users/vanga","html_url":"https://github.com/vanga","followers_url":"https://api.github.com/users/vanga/followers","following_url":"https://api.github.com/users/vanga/following{/other_user}","gists_url":"https://api.github.com/users/vanga/gists{/gist_id}","starred_url":"https://api.github.com/users/vanga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanga/subscriptions","organizations_url":"https://api.github.com/users/vanga/orgs","repos_url":"https://api.github.com/users/vanga/repos","events_url":"https://api.github.com/users/vanga/events{/privacy}","received_events_url":"https://api.github.com/users/vanga/received_events","type":"User","site_admin":false},"created_at":"2017-03-08T01:47:50Z","updated_at":"2017-03-08T05:36:18Z","author_association":"NONE","body":"@bleskes that query results in about 110 terms. And, based on testing, removing the reduce script made a significant difference(memory increase is negligible as mentioned in my above comment). \r\nDo you still think it's because of the aggregation?\r\n\r\n\r\n> What happens if you run your script (latestByTimeStamp__f7BedzrFUQ__test_meta__WMk4jA0bd24) as a single top level agg?\r\nI will check this","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/285035963","html_url":"https://github.com/elastic/elasticsearch/issues/23499#issuecomment-285035963","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23499","id":285035963,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NTAzNTk2Mw==","user":{"login":"vanga","id":5126396,"node_id":"MDQ6VXNlcjUxMjYzOTY=","avatar_url":"https://avatars3.githubusercontent.com/u/5126396?v=4","gravatar_id":"","url":"https://api.github.com/users/vanga","html_url":"https://github.com/vanga","followers_url":"https://api.github.com/users/vanga/followers","following_url":"https://api.github.com/users/vanga/following{/other_user}","gists_url":"https://api.github.com/users/vanga/gists{/gist_id}","starred_url":"https://api.github.com/users/vanga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanga/subscriptions","organizations_url":"https://api.github.com/users/vanga/orgs","repos_url":"https://api.github.com/users/vanga/repos","events_url":"https://api.github.com/users/vanga/events{/privacy}","received_events_url":"https://api.github.com/users/vanga/received_events","type":"User","site_admin":false},"created_at":"2017-03-08T13:09:05Z","updated_at":"2017-03-08T13:09:05Z","author_association":"NONE","body":"I have tested the query with various sizes\r\n100, 200, 500, 1000, 10000.\r\n\r\nExcept with 100, all other cases have caused the memory(old gc pool) to increase. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289328265","html_url":"https://github.com/elastic/elasticsearch/issues/23499#issuecomment-289328265","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23499","id":289328265,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTMyODI2NQ==","user":{"login":"jdoss","id":8195,"node_id":"MDQ6VXNlcjgxOTU=","avatar_url":"https://avatars0.githubusercontent.com/u/8195?v=4","gravatar_id":"","url":"https://api.github.com/users/jdoss","html_url":"https://github.com/jdoss","followers_url":"https://api.github.com/users/jdoss/followers","following_url":"https://api.github.com/users/jdoss/following{/other_user}","gists_url":"https://api.github.com/users/jdoss/gists{/gist_id}","starred_url":"https://api.github.com/users/jdoss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdoss/subscriptions","organizations_url":"https://api.github.com/users/jdoss/orgs","repos_url":"https://api.github.com/users/jdoss/repos","events_url":"https://api.github.com/users/jdoss/events{/privacy}","received_events_url":"https://api.github.com/users/jdoss/received_events","type":"User","site_admin":false},"created_at":"2017-03-27T00:16:55Z","updated_at":"2017-03-27T00:16:55Z","author_association":"NONE","body":"We are seeing the same problem with 5.2.2 with our aggregations. Tons of Old GCs when we have many aggregations running at the same time from our users. Everything was fine in 2.4 before we upgraded. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/291011074","html_url":"https://github.com/elastic/elasticsearch/issues/23499#issuecomment-291011074","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23499","id":291011074,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MTAxMTA3NA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-04-02T20:04:51Z","updated_at":"2017-04-02T20:04:51Z","author_association":"MEMBER","body":"@jdoss it would be great if you can give specific examples of the aggregations you use, trying to pin pointing the ones that started using more information.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298316848","html_url":"https://github.com/elastic/elasticsearch/issues/23499#issuecomment-298316848","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23499","id":298316848,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODMxNjg0OA==","user":{"login":"vanga","id":5126396,"node_id":"MDQ6VXNlcjUxMjYzOTY=","avatar_url":"https://avatars3.githubusercontent.com/u/5126396?v=4","gravatar_id":"","url":"https://api.github.com/users/vanga","html_url":"https://github.com/vanga","followers_url":"https://api.github.com/users/vanga/followers","following_url":"https://api.github.com/users/vanga/following{/other_user}","gists_url":"https://api.github.com/users/vanga/gists{/gist_id}","starred_url":"https://api.github.com/users/vanga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanga/subscriptions","organizations_url":"https://api.github.com/users/vanga/orgs","repos_url":"https://api.github.com/users/vanga/repos","events_url":"https://api.github.com/users/vanga/events{/privacy}","received_events_url":"https://api.github.com/users/vanga/received_events","type":"User","site_admin":false},"created_at":"2017-05-01T10:35:13Z","updated_at":"2017-05-01T10:35:13Z","author_association":"NONE","body":"An update: Memory increase issue is gone after we brought down the number of indices\r\n`70 indices with 5 shards, 1 replica` => `< 10 indices, 5 shards, 1 replica`\r\n","performed_via_github_app":null}]