[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416867814","html_url":"https://github.com/elastic/elasticsearch/issues/33229#issuecomment-416867814","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33229","id":416867814,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjg2NzgxNA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-29T08:20:54Z","updated_at":"2018-08-29T08:20:54Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419730819","html_url":"https://github.com/elastic/elasticsearch/issues/33229#issuecomment-419730819","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33229","id":419730819,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTczMDgxOQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-09-09T17:19:53Z","updated_at":"2018-09-09T17:19:53Z","author_association":"MEMBER","body":"@xgwu from your discreption it sounds like things are working as they should but that your indexing rate is very very high. The recovery mechanism takes a snapshot of the primary's lucene index, copies it over to the replica and then performs all the operations that were indexed while the lucene files were copied. In order to do that we need to retain those operations somewhere and that's why the translog grows. \r\n\r\nIn theory, there are some things we can do to improve the second phase (replaying of so many operations) but they will take quite a major refactoring. I don't think we'll get to it soon.\r\n\r\nUntil that is done, I suggest you make sure that your recovery has enough resources and is configured to copy over the lucene files faster. You can look at options [here](https://www.elastic.co/guide/en/elasticsearch/reference/current/recovery.html). If you need more help here please open up a discuss post in our [forums](https://discuss.elastic.co).\r\n\r\nI'm closing this for now. Feel free to reopen if I missed something above.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419780174","html_url":"https://github.com/elastic/elasticsearch/issues/33229#issuecomment-419780174","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33229","id":419780174,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTc4MDE3NA==","user":{"login":"xgwu","id":10510416,"node_id":"MDQ6VXNlcjEwNTEwNDE2","avatar_url":"https://avatars2.githubusercontent.com/u/10510416?v=4","gravatar_id":"","url":"https://api.github.com/users/xgwu","html_url":"https://github.com/xgwu","followers_url":"https://api.github.com/users/xgwu/followers","following_url":"https://api.github.com/users/xgwu/following{/other_user}","gists_url":"https://api.github.com/users/xgwu/gists{/gist_id}","starred_url":"https://api.github.com/users/xgwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xgwu/subscriptions","organizations_url":"https://api.github.com/users/xgwu/orgs","repos_url":"https://api.github.com/users/xgwu/repos","events_url":"https://api.github.com/users/xgwu/events{/privacy}","received_events_url":"https://api.github.com/users/xgwu/received_events","type":"User","site_admin":false},"created_at":"2018-09-10T03:54:18Z","updated_at":"2018-09-10T03:54:18Z","author_association":"NONE","body":"@bleskes  Thanks for the reply and it's OK to close the issue.  I'll open up a post in elastic forums if I need further assistance.\r\n\r\nFYI,  some background information why I raised an issue here:\r\nBased on my limited knowledge, early ES version involves three phases during recovery, ieï¼š\r\n1. snapshot the Lucene files and copy over \r\n2. snapshot the Translog files and copy over\r\n3. block writes for a while until Translog operations in sync between primary and replica.\r\n\r\nIn this process, it's understandable step 2 could generate a lot of Translog files as indexing is not blocked and all new operations need to kept somewhere.\r\n\r\nHowever I learned that starting from some version 5.x (or 6.x? I can't remember exactly),  there is no more write blocking phase. Once the snapshot of Translog transfer completes, replica can immediately start indexing new docs as well as replaying Translog files transferred from primary, concurrently.  So my understanding is that once the Translog recovery phase begin, there shouldn't be necessary to keep a lot of Translog files for holding all the new indexing requests. \r\n\r\nI am not sure if there is some practical considerations that these Translog files still need to be kept around in this situation.  Probably relates to other features such as seq number, new translog retention policies, etc introduced in new version,  I  don't know.\r\n\r\nI appreciate the recovery processes is very complex in a distributed environment and I could misunderstand the process.  I raised it here just in case it's a bug.\r\n\r\nThanks again for the explanation!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/420425723","html_url":"https://github.com/elastic/elasticsearch/issues/33229#issuecomment-420425723","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33229","id":420425723,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDQyNTcyMw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-09-11T21:06:55Z","updated_at":"2018-09-11T21:06:55Z","author_association":"MEMBER","body":"@xgwu your understanding is correct. There is no blocking phase any more. The translog file grow during phase 1 in your description. I theory we could release them as we go through them in phase 2 but right now, for simplicity, we don't. We only clean the at the end.","performed_via_github_app":null}]