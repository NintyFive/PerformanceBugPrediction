[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222562064","html_url":"https://github.com/elastic/elasticsearch/issues/18644#issuecomment-222562064","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18644","id":222562064,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjU2MjA2NA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-30T22:36:27Z","updated_at":"2016-05-31T01:51:10Z","author_association":"MEMBER","body":"I assume that you're doing this with `GREP_OPTIONS=--color=always` instead of via an alias? I'm assuming this because bash does not expand aliases by default in scripts, and we do not `shopt -s expand_aliases`.  In general, the use of global `--color=always` is going to lead to trouble; this is not the first time that I've seen it break something. In fact, the use of `GREP_OPTIONS` is discouraged and deprecated and will be remove in a future version of GNU `grep` exactly because it causes problems for otherwise portable scripts. A slightly better choice is `--color=auto` because then the coloring is only applied when the output is going directly to a terminal.\n\n> I can fix this by temporarily changing my grep settings, but it did cost me an hour or so tracking down what was happening.\n\nI think that `bash -x ./bin/elasticsearch` would have helped quickly here. It does help to have seen this problem before though, sorry.\n\n> Therefore - for other users like me - you might want to modify the script: `grep color=never` should do the trick.\n\nThis requires GNU `grep`. Maybe this is something that we should require, but it is not something that we require today; note that [POSIX `grep` does not support `--color`](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/grep.html) and thus adding `--color=never` to our script is not a decision to be made lightly. Personally, I'm opposed, but I am just one voice.\n\n> Also I see that there is a mix of grep and egrep in the script.\n\nThis is a consequence of needing extended regular expressions in some places, and some `grep`s (non POSIX-compliant `grep`s on OS that we do _not_ support so I'm in favor of removing) do not support `grep -E`.\n\nIn general, I'm inclined to recommend that you change something on your end. As I mentioned, I've seen other scripts break because of global `grep` options of `--color=always`. At a minimum, you could change to an alias instead of `GREP_OPTIONS` but you should also consider `--color=auto`.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222573347","html_url":"https://github.com/elastic/elasticsearch/issues/18644#issuecomment-222573347","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18644","id":222573347,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjU3MzM0Nw==","user":{"login":"JnBrymn-EB","id":11304245,"node_id":"MDQ6VXNlcjExMzA0MjQ1","avatar_url":"https://avatars1.githubusercontent.com/u/11304245?v=4","gravatar_id":"","url":"https://api.github.com/users/JnBrymn-EB","html_url":"https://github.com/JnBrymn-EB","followers_url":"https://api.github.com/users/JnBrymn-EB/followers","following_url":"https://api.github.com/users/JnBrymn-EB/following{/other_user}","gists_url":"https://api.github.com/users/JnBrymn-EB/gists{/gist_id}","starred_url":"https://api.github.com/users/JnBrymn-EB/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JnBrymn-EB/subscriptions","organizations_url":"https://api.github.com/users/JnBrymn-EB/orgs","repos_url":"https://api.github.com/users/JnBrymn-EB/repos","events_url":"https://api.github.com/users/JnBrymn-EB/events{/privacy}","received_events_url":"https://api.github.com/users/JnBrymn-EB/received_events","type":"User","site_admin":false},"created_at":"2016-05-31T01:23:15Z","updated_at":"2016-05-31T01:23:15Z","author_association":"NONE","body":"Fair 'nuf. Close this ticket if you'd like. Perhaps I'm in the minority;\nI'll change my grep to just use an alias.\n\n-John\n\nOn Mon, May 30, 2016 at 5:37 PM, Jason Tedor notifications@github.com\nwrote:\n\n> I assume that you're doing this with GREP_OPTIONS=--color=always instead\n> of via an alias? I'm assuming this because we bash does not expand aliases\n> by default in scripts, and we do not shopt -s expand_aliases. In general,\n> the use of global --color=always is going to lead to trouble; this is not\n> the first time that I've seen it break something. In fact, the use of\n> GREP_OPTIONS is discouraged and deprecated and will be remove in a future\n> version of grep exactly because it causes problems for otherwise portable\n> scripts. A slightly better choice is --color=auto because then the\n> coloring is only applied when the output is going directly to a terminal.\n> \n> I can fix this by temporarily changing my grep settings, but it did cost\n> me an hour or so tracking down what was happening.\n> \n> I think that bash -x ./bin/elasticsearch would have helped quickly here.\n> It does help to have seen this problem before though, sorry.\n> \n> Therefore - for other users like me - you might want to modify the script: grep\n> color=never should do the trick.\n> \n> This requires GNU grep. Maybe this is something that we should require,\n> but it is not something that we require today; note that POSIX grep does\n> not support --color http://pubs.opengroup.org/onlinepubs/9699919799/\n> and thus adding it to our script is not a decision to be made lightly.\n> \n> Also I see that there is a mix of grep and egrep in the script.\n> \n> This is a consequence of needing extended regular expressions in some\n> places, and some greps (non POSIX-compliant greps on OS that we do _not_\n> support so I'm in favor of removing) do not support grep -E.\n> \n> In general, I'm inclined to recommend that you to change something on your\n> end. As I mentioned, I've seen other scripts break because of global grep\n> options of --color=always.\n> \n> â€”\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/elastic/elasticsearch/issues/18644#issuecomment-222562064,\n> or mute the thread\n> https://github.com/notifications/unsubscribe/AKx9NWZDiOTUk4Nv7yQxoiu2D_MID7LDks5qG2azgaJpZM4IqBPd\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222573659","html_url":"https://github.com/elastic/elasticsearch/issues/18644#issuecomment-222573659","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18644","id":222573659,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjU3MzY1OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-31T01:26:35Z","updated_at":"2016-05-31T01:26:35Z","author_association":"MEMBER","body":"Thanks for understanding @JnBrymn-EB. :smile:\n","performed_via_github_app":null}]