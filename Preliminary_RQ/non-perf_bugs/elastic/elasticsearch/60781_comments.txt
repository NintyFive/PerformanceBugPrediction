[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/669354796","html_url":"https://github.com/elastic/elasticsearch/issues/60781#issuecomment-669354796","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60781","id":669354796,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTM1NDc5Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-08-05T18:15:14Z","updated_at":"2020-08-05T18:15:14Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml/Transform)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/669759312","html_url":"https://github.com/elastic/elasticsearch/issues/60781#issuecomment-669759312","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60781","id":669759312,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTc1OTMxMg==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2020-08-06T07:30:28Z","updated_at":"2020-08-06T07:30:28Z","author_association":"CONTRIBUTOR","body":"This test has been added in #60469. \r\n\r\nIt's an integration test which covers a broad range of features in the stack, failures are expected (a lucene bug discovered by this test is in investigation). As long as the failure rate is low (as of writing 14 in the last 24 hours) I ask to not mute/silence it to discover hard to find bugs in the stack.\r\n\r\nI looked at the logs of this and other failures, the problem seems to be:\r\n\r\n```\r\n[2020-08-05T17:16:18,242][ERROR][o.e.x.t.t.ClientTransformIndexer] [integTest-0] [continuous-terms-pivot-test] updating stats of transform failed.\r\njava.lang.RuntimeException: Failed to persist transform statistics for transform [continuous-terms-pivot-test]\r\n\tat org.elasticsearch.xpack.transform.persistence.IndexBasedTransformConfigManager.lambda$putOrUpdateTransformStoredDoc$14(IndexBasedTransformConfigManager.java:527) [transform-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:71) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.ContextPreservingActionListener.onFailure(ContextPreservingActionListener.java:50) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.client.node.NodeClient.lambda$executeLocally$1(NodeClient.java:91) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.tasks.TaskManager$1.onFailure(TaskManager.java:184) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.ContextPreservingActionListener.onFailure(ContextPreservingActionListener.java:50) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportSingleItemBulkWriteAction.lambda$wrapBulkResponse$0(TransportSingleItemBulkWriteAction.java:64) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\r\n...\r\n\r\nCaused by: org.elasticsearch.index.engine.VersionConflictEngineException: [data_frame_transform_state_and_stats-continuous-terms-pivot-test]: version conflict, required seqNo [6], primary term [1]. current document has seqNo [11] and primary term [1]\r\n\tat org.elasticsearch.index.engine.InternalEngine.planIndexingAsPrimary(InternalEngine.java:1014) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.engine.InternalEngine.indexingStrategyForOperation(InternalEngine.java:977) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:866) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.index(IndexShard.java:815) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.applyIndexOperation(IndexShard.java:787) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.applyIndexOperationOnPrimary(IndexShard.java:752) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.executeBulkItemRequest(TransportShardBulkAction.java:279) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction$2.doRun(TransportShardBulkAction.java:168) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\t... 10 more\r\n[2020-08-05T17:16:18,250][DEBUG][o.e.x.t.t.TransformTask  ] [integTest-0] [continuous-terms-pivot-test] shutdown of transform requested\r\n\r\n```\r\n\r\nI need to find out where this conflict is coming from.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/669853413","html_url":"https://github.com/elastic/elasticsearch/issues/60781#issuecomment-669853413","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60781","id":669853413,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTg1MzQxMw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2020-08-06T10:42:02Z","updated_at":"2020-08-06T10:42:02Z","author_association":"CONTRIBUTOR","body":"This is failing quite often; I discussed with Hendrik and we decided to mute it for now:\r\n\r\nmaster: 2499d6b97b3e9cb52b0a526a82445f1a2e7c96ca\r\n7.x: f24a3a4e814f0d57c54d61895bd434d3bf635aa7","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/669867109","html_url":"https://github.com/elastic/elasticsearch/issues/60781#issuecomment-669867109","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60781","id":669867109,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTg2NzEwOQ==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2020-08-06T11:16:56Z","updated_at":"2020-08-06T11:16:56Z","author_association":"CONTRIBUTOR","body":"I suspect the root cause to be the same as in:\r\n\r\nhttps://github.com/elastic/elasticsearch/issues/52035\r\nhttps://github.com/elastic/elasticsearch/issues/51629\r\n(and likely https://github.com/elastic/elasticsearch/issues/52931)\r\n\r\nI think that the state is saved from 2 different threads, the indexer thread and the thread that runs the `_stop` action.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/669872688","html_url":"https://github.com/elastic/elasticsearch/issues/60781#issuecomment-669872688","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60781","id":669872688,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTg3MjY4OA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2020-08-06T11:30:39Z","updated_at":"2020-08-06T11:30:39Z","author_association":"CONTRIBUTOR","body":"Having muted this test a different one in this suite now failed. I'm muting that one too:\r\n\r\nmaster: f86d51d6ebef2716427e9e25ba1eeab420eb12e4\r\n7.x: 05b2a2db8b170d882132793b60a5a4e898803cd6","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/669938614","html_url":"https://github.com/elastic/elasticsearch/issues/60781#issuecomment-669938614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60781","id":669938614,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTkzODYxNA==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2020-08-06T13:50:07Z","updated_at":"2020-08-06T13:50:07Z","author_association":"CONTRIBUTOR","body":"> Having muted this test a different one in this suite now failed. I'm muting that one too:\r\n\r\n:+1: The logs indicate a problem in the infrastructure, so the problem applies to both. There are only 2 test cases, so you have muted all of them now.\r\n","performed_via_github_app":null}]