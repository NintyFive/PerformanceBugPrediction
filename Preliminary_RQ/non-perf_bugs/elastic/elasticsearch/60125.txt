{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/60125","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60125/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60125/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60125/events","html_url":"https://github.com/elastic/elasticsearch/issues/60125","id":664510546,"node_id":"MDU6SXNzdWU2NjQ1MTA1NDY=","number":60125,"title":"[Transform] Regression: continuous transform fails after start with [composite] failed to parse field [sources]","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913658,"node_id":"MDU6TGFiZWw5MjkxMzY1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/blocker","name":"blocker","color":"e11d21","default":false,"description":null},{"id":2040343033,"node_id":"MDU6TGFiZWwyMDQwMzQzMDMz","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.9.0","name":"v7.9.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"assignees":[{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-07-23T14:17:01Z","updated_at":"2020-07-27T12:27:30Z","closed_at":"2020-07-27T12:27:30Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Creating a continuous transform with 1 histogram or date histogram succeeds but fails after `_start`. This is a regression introduced by #55287.\r\n\r\nRepro:\r\n\r\n```\r\nPUT _transform/histogram-pivot\r\n{\r\n  \"source\": {\r\n    \"index\": \"kibana_sample_data_logs\"\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"kibana_sample_data_logs-pivot\"\r\n  },\r\n  \"sync\": {\r\n    \"time\": {\r\n      \"field\": \"timestamp\"\r\n    }\r\n  }, \r\n  \"pivot\": {\r\n    \"group_by\": {\r\n      \"h\": {\r\n        \"histogram\": {\r\n          \"field\": \"bytes\",\r\n          \"interval\": 50\r\n          }\r\n      }\r\n    },\r\n    \"aggregations\": {\r\n      \"max\": {\r\n        \"max\": {\r\n          \"field\": \"bytes\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nfailure:\r\n\r\n```\r\norg.elasticsearch.common.xcontent.XContentParseException: [1:13] [composite] failed to parse field [sources]\r\n        at org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:531) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ObjectParser.parseArray(ObjectParser.java:523) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ObjectParser.parseSub(ObjectParser.java:555) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ObjectParser.parse(ObjectParser.java:324) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser.parse(ConstructingObjectParser.java:171) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.transform.transforms.pivot.Pivot.createCompositeAggregationSources(Pivot.java:361) ~[?:?]\r\n        at org.elasticsearch.xpack.transform.transforms.pivot.Pivot.buildChangeCollector(Pivot.java:219) ~[?:?]\r\n        at org.elasticsearch.xpack.transform.transforms.TransformIndexer.initializeFunction(TransformIndexer.java:349) ~[?:?]\r\n        at org.elasticsearch.xpack.transform.transforms.TransformIndexer.lambda$onStart$10(TransformIndexer.java:249) ~[?:?]\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.transform.transforms.TransformIndexer.lambda$onStart$11(TransformIndexer.java:300) [transform-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.transform.persistence.IndexBasedTransformConfigManager.parseTransformLenientlyFromSource(IndexBasedTransformConfigManager.java:666) [transform-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.transform.persistence.IndexBasedTransformConfigManager.lambda$getTransformConfiguration$7(IndexBasedTransformConfigManager.java:355) [transform-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:89) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:83) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.sendSearchResponse(AbstractSearchAsyncAction.java:545) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:117) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:350) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:344) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:231) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$1(FetchSearchPhase.java:119) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:125) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.FetchSearchPhase.access$000(FetchSearchPhase.java:47) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:95) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:710) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) [?:?]\r\n        at java.lang.Thread.run(Thread.java:832) [?:?]\r\nCaused by: org.elasticsearch.common.xcontent.XContentParseException: Failed to build [composite] after last required field arrived\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser$Target.buildTarget(ConstructingObjectParser.java:534) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser$Target.constructorArg(ConstructingObjectParser.java:460) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser$Target.access$900(ConstructingObjectParser.java:408) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser.lambda$declareField$3(ConstructingObjectParser.java:220) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ObjectParser.lambda$declareField$9(ObjectParser.java:386) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:529) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        ... 33 more\r\nCaused by: java.lang.IllegalArgumentException: Composite [sources] cannot be null or empty\r\n        at org.elasticsearch.search.aggregations.bucket.composite.CompositeAggregationBuilder.validateSources(CompositeAggregationBuilder.java:177) ~[elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.search.aggregations.bucket.composite.CompositeAggregationBuilder.<init>(CompositeAggregationBuilder.java:70) ~[elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.search.aggregations.bucket.composite.CompositeAggregationBuilder.lambda$static$0(CompositeAggregationBuilder.java:55) ~[elasticsearch-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser$Target.buildTarget(ConstructingObjectParser.java:521) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser$Target.constructorArg(ConstructingObjectParser.java:460) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser$Target.access$900(ConstructingObjectParser.java:408) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ConstructingObjectParser.lambda$declareField$3(ConstructingObjectParser.java:220) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ObjectParser.lambda$declareField$9(ObjectParser.java:386) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        at org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:529) ~[elasticsearch-x-content-7.9.0-SNAPSHOT.jar:7.9.0-SNAPSHOT]\r\n        ... 33 more\r\n\r\n```","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}