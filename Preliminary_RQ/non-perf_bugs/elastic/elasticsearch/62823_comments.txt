[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/697321406","html_url":"https://github.com/elastic/elasticsearch/issues/62823#issuecomment-697321406","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62823","id":697321406,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NzMyMTQwNg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-09-23T12:09:06Z","updated_at":"2020-09-23T12:09:06Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/700745151","html_url":"https://github.com/elastic/elasticsearch/issues/62823#issuecomment-700745151","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62823","id":700745151,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDc0NTE1MQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-09-29T14:31:07Z","updated_at":"2020-09-29T14:31:07Z","author_association":"CONTRIBUTOR","body":"Probably the biggest problem with making this change is coordination of changes between C++ and Java without breaking every ML test that uses native processes.\r\n\r\nThere are basically two ways it could be done:\r\n\r\n1. Muting tests\r\n2. Sequence of PRs that start by adding leniency\r\n\r\nThe first option would look like this:\r\n\r\n1. Prepare the full C++ and Java changes on branches, testing locally on a machine where both are built together\r\n2. Mute every single ML test that uses native processes\r\n3. Merge the C++ PR and wait for a snapshot build\r\n4. Merge the Java PR\r\n5. Unmute all the ML tests that use native processes\r\n\r\nThe second option would look like this:\r\n\r\n1. Change C++ to optionally take a command ID - if first token is numeric it's the command ID; if not present that's OK\r\n2. Change Java so that timeout on connecting results pipe isn't fatal initially if there is a command pipe (hack to be removed later)\r\n3. Change Java to try to connect a results pipe to the controller, and if it works listen for responses to commands\r\n4. Change Java to send command IDs with each command\r\n5. Change C++ to make the command ID compulsory\r\n6. Change C++ to connect a results pipe in `controller` and reply to commands when they are completed\r\n7. Change Java to wait for responses before moving on from requesting a process be started to the next stages during actions that require a process be started\r\n8. Change Java to require that `controller` successfully connects a results pipe\r\n\r\nGiven the complexity of the second option I am favouring the first.  The risk is that while the ML tests are muted somebody else breaks something.  This risk could be mitigated by merging the changes over a weekend.  The PRs would need to be approved in advance, then the merge steps could be done with very little time spent during the weekend itself, and if everything went to plan the tests would be unmuted by Monday morning.","performed_via_github_app":null}]