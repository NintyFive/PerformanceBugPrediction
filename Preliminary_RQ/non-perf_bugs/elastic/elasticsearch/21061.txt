{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21061","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21061/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21061/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21061/events","html_url":"https://github.com/elastic/elasticsearch/issues/21061","id":184442490,"node_id":"MDU6SXNzdWUxODQ0NDI0OTA=","number":21061,"title":"Setting highlight query on Inner Hits throwing NullPointerException","user":{"login":"AliNield","id":2786580,"node_id":"MDQ6VXNlcjI3ODY1ODA=","avatar_url":"https://avatars2.githubusercontent.com/u/2786580?v=4","gravatar_id":"","url":"https://api.github.com/users/AliNield","html_url":"https://github.com/AliNield","followers_url":"https://api.github.com/users/AliNield/followers","following_url":"https://api.github.com/users/AliNield/following{/other_user}","gists_url":"https://api.github.com/users/AliNield/gists{/gist_id}","starred_url":"https://api.github.com/users/AliNield/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AliNield/subscriptions","organizations_url":"https://api.github.com/users/AliNield/orgs","repos_url":"https://api.github.com/users/AliNield/repos","events_url":"https://api.github.com/users/AliNield/events{/privacy}","received_events_url":"https://api.github.com/users/AliNield/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":430111440,"node_id":"MDU6TGFiZWw0MzAxMTE0NDA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.4.1","name":"v2.4.1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"assignees":[{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2016-10-21T09:39:59Z","updated_at":"2016-10-21T19:14:01Z","closed_at":"2016-10-21T19:14:01Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.4.1\n\n**Description of the problem including expected versus actual behavior**:\nWhen setting a Highlight query on an Inner Hits query, it throws a NullPointerException. We want to be able to set a different highlight query for the Inner hits than the main query. \n\nThis is a bit of a forced example, but it is similar to what we need it to do. The documentation describes that Inner Hits support highlighting, so I would expect it to support setting the highlight query. https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-inner-hits.html\n\n**Steps to reproduce**:\n1. Add a parent/child mapping\n\n```\ncurl -XPOST localhost:9200/test_index -d '{\n    \"settings\" : {\n        \"number_of_shards\" : 1\n    },\n    \"mappings\": {\n    \"profile\": {\n      \"properties\": {\n          \"id\": {\n          \"type\": \"string\",\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },        \n        \"summary\": {\n          \"type\": \"string\"\n        }\n      }\n    },\n    \"tweet\": {\n      \"_parent\": {\n        \"type\": \"profile\"\n      },\n      \"properties\": {\n        \"id\": {\n          \"type\": \"string\",\n        },        \n        \"body\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}'\n\n```\n1. Add some data\n\n```\ncurl -XPUT localhost:9200/test_index/profile/1 -d '{\n  \"name\" : \"Bob\",\n  \"summary\" : \"The quick brown fox\"\n}'\n\n\ncurl -XPUT localhost:9200/test_index/tweet/100?parent=1 -d '{\n  \"body\" : \"I like lego\"\n}'\n\ncurl -XPUT localhost:9200/test_index/tweet/200?parent=1 -d '{\n  \"body\" : \"going to build some lego\"\n}'\n```\n1. Make the search\n\n```\ncurl -XPOST localhost:9200/test_index/_search -d '{\n   \"query\":{\n      \"has_child\":{\n         \"type\":\"tweet\",\n         \"query\":{\n            \"match\":{\n              \"body\" : \"build\"\n            }\n         },\n         \"inner_hits\":{\n            \"highlight\":{\n               \"fields\":{\n                  \"body\":{\n                     \"highlight_query\":{\n                        \"match\":{\n                           \"body\":\"lego\"\n                        }\n                     }\n                  }\n               }\n            }\n         }\n      }\n   }\n}'\n```\n\n**Provide logs (if relevant)**:\n\n```\n{\n  \"error\": {\n    \"root_cause\": [\n      {\n        \"type\": \"null_pointer_exception\",\n        \"reason\": null\n      }\n    ],\n    \"type\": \"search_phase_execution_exception\",\n    \"reason\": \"all shards failed\",\n    \"phase\": \"query_fetch\",\n    \"grouped\": true,\n    \"failed_shards\": [\n      {\n        \"shard\": 0,\n        \"index\": \"test_index\",\n        \"node\": \"kQJBHiijQCW_3FsdFssnrQ\",\n        \"reason\": {\n          \"type\": \"null_pointer_exception\",\n          \"reason\": null\n        }\n      }\n    ]\n  },\n  \"status\": 500\n}\n```\n\nThanks\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}