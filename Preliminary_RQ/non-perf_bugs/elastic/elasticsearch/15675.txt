{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15675","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15675/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15675/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15675/events","html_url":"https://github.com/elastic/elasticsearch/issues/15675","id":124002933,"node_id":"MDU6SXNzdWUxMjQwMDI5MzM=","number":15675,"title":"Phrase Suggester breaks in 2.0","user":{"login":"JnBrymn-EB","id":11304245,"node_id":"MDQ6VXNlcjExMzA0MjQ1","avatar_url":"https://avatars1.githubusercontent.com/u/11304245?v=4","gravatar_id":"","url":"https://api.github.com/users/JnBrymn-EB","html_url":"https://github.com/JnBrymn-EB","followers_url":"https://api.github.com/users/JnBrymn-EB/followers","following_url":"https://api.github.com/users/JnBrymn-EB/following{/other_user}","gists_url":"https://api.github.com/users/JnBrymn-EB/gists{/gist_id}","starred_url":"https://api.github.com/users/JnBrymn-EB/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JnBrymn-EB/subscriptions","organizations_url":"https://api.github.com/users/JnBrymn-EB/orgs","repos_url":"https://api.github.com/users/JnBrymn-EB/repos","events_url":"https://api.github.com/users/JnBrymn-EB/events{/privacy}","received_events_url":"https://api.github.com/users/JnBrymn-EB/received_events","type":"User","site_admin":false},"labels":[{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-12-28T00:29:45Z","updated_at":"2016-01-05T08:27:18Z","closed_at":"2016-01-05T08:27:18Z","author_association":"NONE","active_lock_reason":null,"body":"_overview_: a phrase suggester query that works in 1.5.1 breaks in 2.0.0-beta2 and 2.1.1 an it shouldn't be related to the new \"everything's a phrase\" approach to queries and filters.\n\nThe following uses the python elasticsearch client.\n\n``` python\nbody = {\n    \"mappings\": {\n      \"movie\": {\n        \"properties\": {\n          \"genres\": {\n            \"properties\": {\n              \"name\": { \n                \"type\": \"string\",\n                \"index\": \"not_analyzed\"}}},\n          \"title\": {\n            \"type\": \"string\",\n            \"analyzer\": \"english\",\n            \"copy_to\":[\"suggestion\"]},\n          \"suggestion\": {\n            \"type\": \"string\"}}}}}\nes.indices.create(\"tmdb\",body=body)\n```\n\nThen index some documents. Then:\n\n```\nquery_body = { \n  \"fields\": [\"title\"],\n  \"query\": {\n    \"match\": {\"title\":\"star trec\"}},\n  \"suggest\": { \"title_completion\": {\n    \"text\": \"star trec\",\n    \"phrase\": {\n      \"field\": \"suggestion\",\n      \"max_errors\": 2,\n      \"collate\": {\n        \"query\": { \n          \"match_phrase\": {\n            \"title\" : \"{{suggestion}}\"\n          }\n        }}}}}}\n\nes.search(index=\"tmdb\",body=query_body,size=2)\n```\n\nThe above works in 1.5.1 but not 2.0.0-beta2 or 2.1.1. The 2.1 documentation is roughly the same as 1.5 and indicates that this should work.\n\nThe error I get is\n\n```\nTransportError: TransportError(500, {u'failed_shards': [{u'node': u'nHzvQPtVR2KW7NMeOuvQLg', u'index': u'tmdb', u'reason': {u'reason': u'unexpected field [match_phrase]', u'type': u'script_parse_exception'}, u'shard': 0}], u'root_cause': [{u'reason': u'unexpected field [match_phrase]', u'type': u'script_parse_exception'}], u'grouped': True, u'reason': u'all shards failed', u'phase': u'query_fetch', u'type': u'search_phase_execution_exception'})\n```\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}