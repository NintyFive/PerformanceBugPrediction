[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353076019","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-353076019","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":353076019,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzA3NjAxOQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-20T14:24:05Z","updated_at":"2017-12-20T14:24:05Z","author_association":"MEMBER","body":"On its face this looks like an X-Pack issue which we do not handle here as this is for open source Elasticsearch only. However, this is a core feature implemented in open source Elasticsearch.\r\n\r\nHave you set `ELASTICSEARCH_CONFIG_PATH`? What does \r\n\r\n```\r\n$ echo $ELASTICSEARCH_CONFIG_PATH\r\n```\r\n\r\nshow? Are you sure that you exported the environment variable? If you start the process (suspend it before it fails) and get its pid, does `/proc/<PID>/environ` show that environment variable as being exposed to Elasticsearch?\r\n\r\nAre you sure that you did not mean `ES_CONF_PATH`?\r\n\r\n> I am quite surprised this bug passed release testing cycle so I tried to find if this is a feature but it seems it is not.\r\n\r\nI am not sure what this mean. Bugs happen. So does user error. Let's figure it out together.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353081472","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-353081472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":353081472,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzA4MTQ3Mg==","user":{"login":"vbohata","id":20965804,"node_id":"MDQ6VXNlcjIwOTY1ODA0","avatar_url":"https://avatars0.githubusercontent.com/u/20965804?v=4","gravatar_id":"","url":"https://api.github.com/users/vbohata","html_url":"https://github.com/vbohata","followers_url":"https://api.github.com/users/vbohata/followers","following_url":"https://api.github.com/users/vbohata/following{/other_user}","gists_url":"https://api.github.com/users/vbohata/gists{/gist_id}","starred_url":"https://api.github.com/users/vbohata/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vbohata/subscriptions","organizations_url":"https://api.github.com/users/vbohata/orgs","repos_url":"https://api.github.com/users/vbohata/repos","events_url":"https://api.github.com/users/vbohata/events{/privacy}","received_events_url":"https://api.github.com/users/vbohata/received_events","type":"User","site_admin":false},"created_at":"2017-12-20T14:45:34Z","updated_at":"2017-12-20T14:45:34Z","author_association":"NONE","body":"I run ES in docker. I use my entrypoint script which exports ELASTICSEARCH_CONFIG_PATH variable before starting elasticsearch. I know the variable is exported (even see it in environ). To fix the issue I just need to build the docker image with older ES - 6.0.1 (not 6.1.0 or 6.1.1). The issue can be easily replicated by very simple installation of elasticsearch + x-pack without the docker. I do not know if this is elasticsearch or x-pack problem or their integration issue, but in pure elasticsearch var substition works (for example for path.data).\r\n\r\n> I am not sure what this mean. Bugs happen. So does user error. Let's figure it out together.\r\n\r\nI wanted to say it looked like a feature for the first time - no one reported it, I expected a lot of people will be affected by this.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353082739","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-353082739","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":353082739,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzA4MjczOQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-20T14:50:10Z","updated_at":"2017-12-20T14:50:10Z","author_association":"MEMBER","body":"Would you share a Dockerfile including entrypoint and reproduction of this issue please?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353094471","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-353094471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":353094471,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzA5NDQ3MQ==","user":{"login":"vbohata","id":20965804,"node_id":"MDQ6VXNlcjIwOTY1ODA0","avatar_url":"https://avatars0.githubusercontent.com/u/20965804?v=4","gravatar_id":"","url":"https://api.github.com/users/vbohata","html_url":"https://github.com/vbohata","followers_url":"https://api.github.com/users/vbohata/followers","following_url":"https://api.github.com/users/vbohata/following{/other_user}","gists_url":"https://api.github.com/users/vbohata/gists{/gist_id}","starred_url":"https://api.github.com/users/vbohata/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vbohata/subscriptions","organizations_url":"https://api.github.com/users/vbohata/orgs","repos_url":"https://api.github.com/users/vbohata/repos","events_url":"https://api.github.com/users/vbohata/events{/privacy}","received_events_url":"https://api.github.com/users/vbohata/received_events","type":"User","site_admin":false},"created_at":"2017-12-20T15:30:50Z","updated_at":"2017-12-20T15:30:50Z","author_association":"NONE","body":"Dockerfile:\r\n```\r\nFROM myrepository/elastic/common\r\n\r\nARG APP_VERSION\r\nARG FILES_REPOSITORY\r\n\r\nRUN yum install -y java-1.8.0-openjdk && yum clean all\r\n\r\n# install elasticsearch\r\nRUN cd /opt && \\\r\n    wget -q \"${FILES_REPOSITORY}/elasticsearch/elasticsearch-${APP_VERSION}.tar.gz\" && \\\r\n    tar -zxf elasticsearch-${APP_VERSION}.tar.gz && \\\r\n    rm -f elasticsearch-${APP_VERSION}.tar.gz && \\\r\n    mv /opt/elasticsearch* /opt/elasticsearch && \\\r\n    chmod 755 -- /opt/elasticsearch/bin/*\r\n\r\n# set required env vars\r\nENV PATH=/opt/elasticsearch/bin:$PATH \\\r\n    JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk\r\n\r\n# install plugins\r\nRUN for plugin in ingest-geoip ingest-user-agent x-pack; do elasticsearch-plugin install --batch \"${FILES_REPOSITORY}/elasticsearch/plugins/${plugin}-${APP_VERSION}.zip\"; done\r\n\r\nCOPY files/app /app\r\nRUN chmod 755 /app/init/entrypoint.sh\r\n\r\nCMD [ \"/app/init/entrypoint.sh\" ]\r\n```\r\nPart of the entrypoint.sh (without comments, var, ... checking):\r\n```\r\n#!/bin/bash\r\n\r\n. /app/init/libs/bootstrap-all.inc.sh\r\n\r\n. /app/init/vars.inc.sh\r\n\r\n\r\n# check users, set stdin/out perms, set TZ, ...\r\ninit_base_environment\r\n\r\nes_opts=\"\\\r\n-Enetwork.host=0.0.0.0 \\\r\n-Enetwork.bind_host=0.0.0.0 \\\r\n-Etransport.bind_host=0.0.0.0 \\\r\n-Ehttp.bind_host=0.0.0.0 \\\r\n-Epath.data=${_ELASTICSEARCH_DATA_PATH} \\\r\n-Epath.logs=${_ELASTICSEARCH_LOGS_PATH} \\\r\n-Ehttp.port=${ELASTICSEARCH_CLIENTS_HTTP_PORT} \\\r\n-Etransport.tcp.port=${ELASTICSEARCH_NODES_TRANSPORT_PORT} \\\r\n-Etransport.profiles.client.port=${ELASTICSEARCH_CLIENTS_TRANSPORT_PORT} \\\r\n-Etransport.profiles.client.xpack.security.type=client \\\r\n-Ebootstrap.memory_lock=true \\\r\n\"\r\n\r\n[[ -n \"$ELASTICSEARCH_PUBLIC_HOST\" ]] && es_opts=\"-Enetwork.publish_host=\\\"${ELASTICSEARCH_PUBLIC_HOST}\\\" -Etransport.profiles.client.publish_host=\\\"${ELASTICSEARCH_PUBLIC_HOST}\\\" $es_opts\"\r\n[[ -n \"$ELASTICSEARCH_INTERNODE_HOST\" ]] && es_opts=\"-Etransport.publish_host=\\\"${ELASTICSEARCH_INTERNODE_HOST}\\\" -Ehttp.publish_host=\\\"${ELASTICSEARCH_INTERNODE_HOST}\\\" $es_opts\"\r\n[[ -n \"$ELASTICSEARCH_CLUSTER_NAME\" ]] && es_opts=\"-Ecluster.name=${ELASTICSEARCH_CLUSTER_NAME} $es_opts\"\r\n[[ -n \"$ELASTICSEARCH_NODE_NAME\" ]] && es_opts=\"-Enode.name=${ELASTICSEARCH_NODE_NAME} $es_opts\"\r\n\r\n\r\n# security overrides\r\nif is_true \"$ELASTICSEARCH_DISABLE_SECURITY_OVERRIDES\"; then\r\n  log_warn \"!!! WARNING: BASIC SECURITY OVERRIDES ARE DISABLED !!!\"\r\nelse\r\n  log_info \"Setting basic security overrides\"\r\n\r\nes_opts=\"$es_opts \\\r\n-Expack.ssl.key=${_ELASTICSEARCH_CLIENTS_SSL_KEY_FILE} \\\r\n-Expack.ssl.certificate=${_ELASTICSEARCH_CLIENTS_SSL_CERT_FILE} \\\r\n-Expack.ssl.certificate_authorities=${_ELASTICSEARCH_CLIENTS_SSL_CA_FILE} \\\r\n-Expack.ssl.supported_protocols=TLSv1.2 \\\r\n-Expack.ssl.client_authentication=required \\\r\n-Expack.security.enabled=true \\\r\n-Expack.security.http.ssl.enabled=true \\\r\n-Expack.security.http.ssl.client_authentication=optional \\\r\n-Expack.security.http.ssl.supported_protocols=TLSv1.2 \\\r\n-Expack.security.transport.ssl.enabled=true \\\r\n-Expack.security.transport.ssl.key=${_ELASTICSEARCH_NODES_SSL_KEY_FILE} \\\r\n-Expack.security.transport.ssl.certificate=${_ELASTICSEARCH_NODES_SSL_CERT_FILE} \\\r\n-Expack.security.transport.ssl.certificate_authorities=${_ELASTICSEARCH_NODES_SSL_CA_FILE} \\\r\n-Expack.security.transport.ssl.supported_protocols=TLSv1.2 \\\r\n-Expack.security.transport.ssl.client_authentication=required \\\r\n-Etransport.profiles.client.xpack.security.ssl.key=${_ELASTICSEARCH_CLIENTS_SSL_KEY_FILE} \\\r\n-Etransport.profiles.client.xpack.security.ssl.certificate=${_ELASTICSEARCH_CLIENTS_SSL_CERT_FILE} \\\r\n-Etransport.profiles.client.xpack.security.ssl.certificate_authorities=${_ELASTICSEARCH_CLIENTS_SSL_CA_FILE} \\\r\n-Etransport.profiles.client.xpack.security.ssl.supported_protocols=TLSv1.2 \\\r\n-Etransport.profiles.client.xpack.security.ssl.client_authentication=optional \\\r\n-Expack.security.authc.token.enabled=true \\\r\n\"\r\nfi\r\n\r\n\r\n# defaults\r\nELASTICSEARCH_HEAP_SIZE=\"${ELASTICSEARCH_HEAP_SIZE:-1g}\"\r\n\r\n\r\nES_JAVA_OPTS=\"-Xms${ELASTICSEARCH_HEAP_SIZE} -Xmx${ELASTICSEARCH_HEAP_SIZE} $ES_JAVA_OPTS\"\r\nexport ES_JAVA_OPTS=\"-Des.cgroups.hierarchy.override=/ -Dlog4j2.disable.jmx=true $ES_JAVA_OPTS\"\r\n\r\nexport ES_HOME=\"/opt/elasticsearch\"\r\n\r\nexport ES_PATH_CONF=\"${_ELASTICSEARCH_CONFIG_PATH}\"\r\n\r\n# useful for path reference in config files, where we can use this variable ... useful - this is independent of ES own ES_PATH_CONF var which could be renamed in future versions again\r\nexport ELASTICSEARCH_CONFIG_PATH=\"$_ELASTICSEARCH_CONFIG_PATH\"\r\n\r\n\r\ncd /opt/elasticsearch\r\nswitch_app \"./bin/elasticsearch --verbose -p /var/run/elastic/elasticsearch.pid $es_opts\"\r\n\r\n\r\n\r\n\r\n\r\n... where switch_app is:\r\nfunction switch_app {\r\n  log_info \"Switching to application process\"\r\n  eval \"exec gosu elastic $*\" \r\n}\r\n```\r\nTo reproduce the issue just try to use ${ELASTICSEARCH_CONFIG_PATH} in the arbitrary place under xpack: configuration. For example to set certificate_authorities.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353249563","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-353249563","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":353249563,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzI0OTU2Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-21T03:34:10Z","updated_at":"2017-12-21T03:35:28Z","author_association":"MEMBER","body":"I want to help you but this is too far from a useable reproduction. For example, you are trying to switch to the `elastic` user yet you never created this user. Yes, I could do this, but this is the Nth hurdle in trying to get a working reproduction from what you've provided where now N is too large (I do not know your base image but `gosu` is not installed, `wget` is not installed, you have referenced several scripts in the entrypoint that are not provided here, etc. (really, there's more)). I need to put this back on you: please provide a simple reproduction that I can use to debug this. It should not take me more than a few minutes from what you provide to have a working reproduction of the issue that I can iterate on.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353255770","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-353255770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":353255770,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzI1NTc3MA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2017-12-21T04:31:00Z","updated_at":"2017-12-21T04:42:03Z","author_association":"CONTRIBUTOR","body":"I can reproduce, it seems to be exclusively a problem with array settings, so my guess is that it's a by-product of #26878\r\n\r\nIn 6.0.1 running with this config file:\r\n```\r\ndiscovery.zen.ping.unicast.hosts: [ \"${THIS_DOES_NOT_EXIST}\" ]\r\n```\r\nwould fail to start with:\r\n```\r\nException in thread \"main\" java.lang.IllegalArgumentException: Could not resolve placeholder 'THIS_DOES_NOT_EXIST'\r\n```\r\n\r\nIn 6.1, it starts, but logs:\r\n```\r\n[WARN ][o.e.d.z.UnicastZenPing   ] failed to resolve host [${THIS_DOES_NOT_EXIST}]\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353257388","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-353257388","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":353257388,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzI1NzM4OA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2017-12-21T04:47:28Z","updated_at":"2017-12-21T04:47:28Z","author_association":"CONTRIBUTOR","body":"It seems to have been a somewhat consious decision in #26878\r\nhttps://github.com/elastic/elasticsearch/pull/26878/files#diff-ec9e18970c4ce90d89639c46bb07218eR1206\r\n\r\nAssigning to @s1monw to comment.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353506599","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-353506599","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":353506599,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzUwNjU5OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-22T02:24:15Z","updated_at":"2017-12-22T02:24:15Z","author_association":"MEMBER","body":"Thanks for triaging this one @tvernum.\r\n\r\nThanks for the report @vbohata, no further action is needed from you, we will take it from here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355400241","html_url":"https://github.com/elastic/elasticsearch/issues/27926#issuecomment-355400241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27926","id":355400241,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTQwMDI0MQ==","user":{"login":"hatdropper1977","id":3123188,"node_id":"MDQ6VXNlcjMxMjMxODg=","avatar_url":"https://avatars1.githubusercontent.com/u/3123188?v=4","gravatar_id":"","url":"https://api.github.com/users/hatdropper1977","html_url":"https://github.com/hatdropper1977","followers_url":"https://api.github.com/users/hatdropper1977/followers","following_url":"https://api.github.com/users/hatdropper1977/following{/other_user}","gists_url":"https://api.github.com/users/hatdropper1977/gists{/gist_id}","starred_url":"https://api.github.com/users/hatdropper1977/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hatdropper1977/subscriptions","organizations_url":"https://api.github.com/users/hatdropper1977/orgs","repos_url":"https://api.github.com/users/hatdropper1977/repos","events_url":"https://api.github.com/users/hatdropper1977/events{/privacy}","received_events_url":"https://api.github.com/users/hatdropper1977/received_events","type":"User","site_admin":false},"created_at":"2018-01-04T21:13:24Z","updated_at":"2018-01-04T21:13:24Z","author_association":"NONE","body":"@jasontedor thank you.  I will wait until this is fixed to upgrade.","performed_via_github_app":null}]