{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57614","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57614/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57614/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57614/events","html_url":"https://github.com/elastic/elasticsearch/issues/57614","id":630127773,"node_id":"MDU6SXNzdWU2MzAxMjc3NzM=","number":57614,"title":"ES Kuromoji Tokenizer removes (株) if present in katakana writing system","user":{"login":"HarshadRanganathan","id":32612787,"node_id":"MDQ6VXNlcjMyNjEyNzg3","avatar_url":"https://avatars3.githubusercontent.com/u/32612787?v=4","gravatar_id":"","url":"https://api.github.com/users/HarshadRanganathan","html_url":"https://github.com/HarshadRanganathan","followers_url":"https://api.github.com/users/HarshadRanganathan/followers","following_url":"https://api.github.com/users/HarshadRanganathan/following{/other_user}","gists_url":"https://api.github.com/users/HarshadRanganathan/gists{/gist_id}","starred_url":"https://api.github.com/users/HarshadRanganathan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HarshadRanganathan/subscriptions","organizations_url":"https://api.github.com/users/HarshadRanganathan/orgs","repos_url":"https://api.github.com/users/HarshadRanganathan/repos","events_url":"https://api.github.com/users/HarshadRanganathan/events{/privacy}","received_events_url":"https://api.github.com/users/HarshadRanganathan/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-06-03T16:05:28Z","updated_at":"2020-06-03T19:42:32Z","closed_at":"2020-06-03T19:42:31Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.1.1\r\n\r\n**Plugins installed**: [analysis-icu, analysis-kuromoji, discovery-ec2, repository-s3]\r\n\r\n**JVM version** (`java -version`): 12.0.1 (bundled jdk)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux amzn2.x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nES Kuromoji Tokenizer removes (株) if present in katakana writing system.\r\n\r\nSample text: （株）巴商会\r\nExpected tokens: （株）, 巴商会\r\nActual tokens: 巴商会\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Create an index e.g. kuromoji with below settings to use kuromoji_tokenizer in search mode:\r\n\r\n```\r\n{\r\n\t\"settings\": {\r\n\t\t\"analysis\": {\r\n\t\t\t\"analyzer\": {\r\n\t\t\t\t\"kuromoji_analyzer_search_mode\": {\r\n\t\t\t\t\t\"type\": \"custom\",\r\n\t\t\t\t\t\"tokenizer\": \"kuromoji_tokenizer_search_mode\"\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\"tokenizer\": {\r\n\t\t\t\t\"kuromoji_tokenizer_search_mode\": {\r\n\t\t\t\t\t\"type\": \"kuromoji_tokenizer\",\r\n\t\t\t\t\t\"mode\": \"search\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\n 2. Send below request to analyze API for the index created previously\r\n```\r\nGET /kuromoji/_analyze\r\n{\r\n \"text\": [\"（株）巴商会\"],\r\n \"analyzer\": \"kuromoji\",\r\n \"explain\": true\r\n}\r\n```\r\n\r\n3. Analyse API returns one token where (株) in the input text is missing\r\n\r\n```\r\n{\r\n  \"detail\" : {\r\n    \"custom_analyzer\" : false,\r\n    \"analyzer\" : {\r\n      \"name\" : \"kuromoji\",\r\n      \"tokens\" : [\r\n        {\r\n          \"token\" : \"巴商会\",\r\n          \"start_offset\" : 3,\r\n          \"end_offset\" : 6,\r\n          \"type\" : \"word\",\r\n          \"position\" : 0,\r\n          \"baseForm\" : null,\r\n          \"bytes\" : \"[e5 b7 b4 e5 95 86 e4 bc 9a]\",\r\n          \"inflectionForm\" : null,\r\n          \"inflectionForm (en)\" : null,\r\n          \"inflectionType\" : null,\r\n          \"inflectionType (en)\" : null,\r\n          \"keyword\" : false,\r\n          \"partOfSpeech\" : \"名詞-固有名詞-組織\",\r\n          \"partOfSpeech (en)\" : \"noun-proper-organization\",\r\n          \"positionLength\" : 1,\r\n          \"pronunciation\" : \"トモエショーカイ\",\r\n          \"pronunciation (en)\" : \"tomoeshokai\",\r\n          \"reading\" : \"トモエショウカイ\",\r\n          \"reading (en)\" : \"tomoeshōkai\",\r\n          \"termFrequency\" : 1\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n4. Provide the same text as input at https://www.atilika.org/ where you can test kuromoji analyzer.\r\n\r\nIt provides two tokens （株）, 巴商会.\r\n\r\nSeems the kuromoji analyzer is working as expected but the corresponding ES plugin is having an issue processing this text.\r\n\r\nOther text samples for testing:\r\n栃木金属工業（株）\r\nミマスクリーンケア（株）\r\n\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}