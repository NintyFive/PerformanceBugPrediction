[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307429991","html_url":"https://github.com/elastic/elasticsearch/issues/25156#issuecomment-307429991","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25156","id":307429991,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzQyOTk5MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-06-09T16:03:17Z","updated_at":"2017-06-09T16:03:21Z","author_association":"MEMBER","body":"The status in the response is per bulk item, so each bulk item can have a separate status. The actual HTTP status of 200 OK means that the coordinating node that received the request successfully processed the request handling each bulk item as expected. To know if there are failures, you have to check the `errors` key.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307432109","html_url":"https://github.com/elastic/elasticsearch/issues/25156#issuecomment-307432109","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25156","id":307432109,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzQzMjEwOQ==","user":{"login":"grasmanek94","id":595329,"node_id":"MDQ6VXNlcjU5NTMyOQ==","avatar_url":"https://avatars3.githubusercontent.com/u/595329?v=4","gravatar_id":"","url":"https://api.github.com/users/grasmanek94","html_url":"https://github.com/grasmanek94","followers_url":"https://api.github.com/users/grasmanek94/followers","following_url":"https://api.github.com/users/grasmanek94/following{/other_user}","gists_url":"https://api.github.com/users/grasmanek94/gists{/gist_id}","starred_url":"https://api.github.com/users/grasmanek94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grasmanek94/subscriptions","organizations_url":"https://api.github.com/users/grasmanek94/orgs","repos_url":"https://api.github.com/users/grasmanek94/repos","events_url":"https://api.github.com/users/grasmanek94/events{/privacy}","received_events_url":"https://api.github.com/users/grasmanek94/received_events","type":"User","site_admin":false},"created_at":"2017-06-09T16:11:27Z","updated_at":"2017-06-09T16:14:43Z","author_association":"NONE","body":"Alright, that explains it I think. But what is the suggestion then? Report this as a bug to elasticsearch-php, or to the package maintainer that uses elasticsearch-php? We have no access to the http output in our application. And it's debatable that a 200-OK (everything OK) response is acceptable when 100% of the items fail to update, especially when an exception occurs...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307436389","html_url":"https://github.com/elastic/elasticsearch/issues/25156#issuecomment-307436389","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25156","id":307436389,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzQzNjM4OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-06-09T16:29:14Z","updated_at":"2017-06-09T16:29:14Z","author_association":"MEMBER","body":"> But what is the suggestion then? Report this as a bug to elasticsearch-php, or to the package maintainer that uses elasticsearch-php?\r\n\r\n@polyfractal Does the PHP client expose the `errors` key in a bulk response?\r\n\r\n> And it's debatable that a 200-OK (everything OK) response when 100% of the items fail to update is the correct response, especially when a exception occurs...\r\n\r\nI will try to explain again. The 200 OK means that the coordinating node did its job. The only time in which a 200 OK is not acceptable here is if the coordinating node fails to do its job, either because of a client error in the request, or because of a server error handling the request. A 200 OK means: I took your requests, I parsed the body, I sent the bulk items to the responsible shards, I waited for their replies, I received their replies, here are the aggregated responses.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307806954","html_url":"https://github.com/elastic/elasticsearch/issues/25156#issuecomment-307806954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25156","id":307806954,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzgwNjk1NA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2017-06-12T14:31:07Z","updated_at":"2017-06-12T14:34:17Z","author_association":"MEMBER","body":"Sorry for delay, was out of town friday/weekend.\r\n\r\n@jasontedor @grasmanek94 Yes, the `errors` key is available in the response.  The PHP client returns the entire JSON body of the response (encoded as a associative array), so you can access it like this:\r\n\r\n```php\r\n$responses = $client->bulk($params);\r\nprint_r($responses['errors']);  // Print out the error array\r\nprint_r($responses['items']);   // Print out the individual bulk item responses\r\n```\r\n\r\nFor example, this snippet will cause an error because only the first document can be indexed due to the `create` operation.  The other two documents will fail since the initial document already exists and they all share the same ID:\r\n\r\n```php\r\n$client = Elasticsearch\\ClientBuilder::create()->build();\r\n$params = [];\r\nfor($i = 0; $i < 3; $i++) {\r\n    $params['body'][] = [\r\n        'create' => [\r\n            '_index' => 'my_index',\r\n            '_type' => 'my_type',\r\n            '_id' => 1\r\n        ]\r\n    ];\r\n\r\n    $params['body'][] = [\r\n        'my_field' => 'my_value',\r\n        'second_field' => 'some more values'\r\n    ];\r\n}\r\n\r\n$responses = $client->bulk($params);\r\nif (isset($responses['errors']) === true && $responses['errors'] === true) {\r\n    echo \"There was one or more errors in the bulk response.\\n\\n\";\r\n}\r\nforeach ($responses['items'] as $item) {\r\n    echo \"Status: {$item['create']['status']}\\n\";\r\n    if (isset($item['create']['error']) === true) {\r\n        print_r($item['create']['error']);\r\n    }\r\n    echo \"\\n\";\r\n}\r\n```\r\nWhich will output the following values:\r\n\r\n```\r\nThere was one or more errors in the bulk response.\r\n\r\nStatus: 201\r\n\r\nStatus: 409\r\nArray\r\n(\r\n    [type] => version_conflict_engine_exception\r\n    [reason] => [my_type][1]: version conflict, document already exists (current version [1])\r\n    [index_uuid] => maU4iW15SmyoZadsmRiNWw\r\n    [shard] => 3\r\n    [index] => my_index\r\n)\r\n\r\nStatus: 409\r\nArray\r\n(\r\n    [type] => version_conflict_engine_exception\r\n    [reason] => [my_type][1]: version conflict, document already exists (current version [1])\r\n    [index_uuid] => maU4iW15SmyoZadsmRiNWw\r\n    [shard] => 3\r\n    [index] => my_index\r\n)\r\n```\r\n\r\nYou can see that at the top level of the response, we can check if the `errors` element is set and if it's true/false.  This lets you know that you need to check for errors in the individual responses.\r\n\r\nThen, when iterating over the response items, you can check to see if there is a `error` element.  If it exists, it will list the exception that caused the item to fail.  There is also a per-item status code which corresponds to that individual item's failure (`409` in this case)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307809262","html_url":"https://github.com/elastic/elasticsearch/issues/25156#issuecomment-307809262","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25156","id":307809262,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzgwOTI2Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-06-12T14:38:49Z","updated_at":"2017-06-12T14:38:49Z","author_association":"MEMBER","body":"@grasmanek94 Given that the PHP client does expose the `errors` key, I do not think there's anything to change here. Do you concur?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307811470","html_url":"https://github.com/elastic/elasticsearch/issues/25156#issuecomment-307811470","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25156","id":307811470,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzgxMTQ3MA==","user":{"login":"grasmanek94","id":595329,"node_id":"MDQ6VXNlcjU5NTMyOQ==","avatar_url":"https://avatars3.githubusercontent.com/u/595329?v=4","gravatar_id":"","url":"https://api.github.com/users/grasmanek94","html_url":"https://github.com/grasmanek94","followers_url":"https://api.github.com/users/grasmanek94/followers","following_url":"https://api.github.com/users/grasmanek94/following{/other_user}","gists_url":"https://api.github.com/users/grasmanek94/gists{/gist_id}","starred_url":"https://api.github.com/users/grasmanek94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grasmanek94/subscriptions","organizations_url":"https://api.github.com/users/grasmanek94/orgs","repos_url":"https://api.github.com/users/grasmanek94/repos","events_url":"https://api.github.com/users/grasmanek94/events{/privacy}","received_events_url":"https://api.github.com/users/grasmanek94/received_events","type":"User","site_admin":false},"created_at":"2017-06-12T14:45:37Z","updated_at":"2017-06-12T14:45:37Z","author_association":"NONE","body":"@jasontedor that's quite clear and I agree with the statements made here, I'll forward this info to the package maintainer ( https://github.com/ErickTamayo/laravel-scout-elastic/issues/37 ) and discuss possible solutions.","performed_via_github_app":null}]