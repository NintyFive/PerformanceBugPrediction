[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159884876","html_url":"https://github.com/elastic/elasticsearch/issues/15040#issuecomment-159884876","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15040","id":159884876,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTg4NDg3Ng==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2015-11-26T11:13:00Z","updated_at":"2015-11-26T11:13:00Z","author_association":"CONTRIBUTOR","body":"Looks to me like filesystem error.\n\nWe have threads hanging in sun.nio.ch.FileDispatcherImpl.force0(Native Method).\n\nInteresting bits in log:\n\n```\n[2015-11-26 01:54:03,961][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,961][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,961][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,964][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,964][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,964][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,965][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,965][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,965][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,965][DEBUG][netty.channel.socket.nio.AbstractNioSelector] Selector.select() returned prematurely because the I/O thread has been interrupted. Use shutdown() to shut the NioSelector down.\n[2015-11-26 01:54:03,965][WARN ][gateway                  ] [node_s0] [_global]: failed to write global state\norg.apache.lucene.util.ThreadInterruptedException: java.lang.InterruptedException: sleep interrupted\n    at org.apache.lucene.util.IOUtils.fsync(IOUtils.java:406)\n    at org.elasticsearch.gateway.MetaDataStateFormat.write(MetaDataStateFormat.java:133)\n    at org.elasticsearch.gateway.MetaStateService.writeGlobalState(MetaStateService.java:149)\n    at org.elasticsearch.gateway.GatewayMetaState.clusterChanged(GatewayMetaState.java:148)\n    at org.elasticsearch.gateway.Gateway.clusterChanged(Gateway.java:185)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:494)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:231)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:194)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n    Suppressed: java.nio.channels.ClosedByInterruptException\n        at java.nio.channels.spi.AbstractInterruptibleChannel.end(AbstractInterruptibleChannel.java:202)\n        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:391)\n        at org.apache.lucene.util.IOUtils.fsync(IOUtils.java:396)\n        ... 10 more\nCaused by: java.lang.InterruptedException: sleep interrupted\n    at java.lang.Thread.sleep(Native Method)\n    at org.apache.lucene.util.IOUtils.fsync(IOUtils.java:404)\n    ... 10 more\n```\n\nComment in Netty code regarding the `Selector.select()` warning: http://netty.io/3.9/xref/org/jboss/netty/channel/socket/nio/AbstractNioSelector.html\n\n```\n// Thread was interrupted but NioSelector was not shutdown.\n239                                 // As this is most likely a bug in the handler of the user or it's client\n240                                 // library we will log it.\n241                                 //\n242                                 // See https://github.com/netty/netty/issues/2426\n```\n\nInteresting threads in stack dump:\n\n```\n    elasticsearch[node_s2][snapshot][T#1]\" ID=7457 RUNNABLE\n    at sun.nio.ch.FileDispatcherImpl.force0(Native Method)\n    at sun.nio.ch.FileDispatcherImpl.force(FileDispatcherImpl.java:76)\n    at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:387)\n    at org.apache.lucene.util.IOUtils.fsync(IOUtils.java:396)\n    at org.elasticsearch.common.blobstore.fs.FsBlobContainer.writeBlob(FsBlobContainer.java:99)\n    at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$SnapshotContext.snapshotFile(BlobStoreIndexShardRepository.java:659)\n    at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$SnapshotContext.snapshot(BlobStoreIndexShardRepository.java:604)\n    at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository.snapshot(BlobStoreIndexShardRepository.java:191)\n    at org.elasticsearch.snapshots.SnapshotShardsService.snapshot(SnapshotShardsService.java:340)\n    at org.elasticsearch.snapshots.SnapshotShardsService.access$200(SnapshotShardsService.java:76)\n    at org.elasticsearch.snapshots.SnapshotShardsService$1.doRun(SnapshotShardsService.java:296)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n    Locked synchronizers:\n    - java.util.concurrent.ThreadPoolExecutor$Worker@3d035ed2\n\n\"elasticsearch[node_s1][snapshot][T#1]\" ID=7456 RUNNABLE\n    at sun.nio.ch.FileDispatcherImpl.force0(Native Method)\n    at sun.nio.ch.FileDispatcherImpl.force(FileDispatcherImpl.java:76)\n    at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:387)\n    at org.apache.lucene.util.IOUtils.fsync(IOUtils.java:396)\n    at org.elasticsearch.common.blobstore.fs.FsBlobContainer.writeBlob(FsBlobContainer.java:98)\n    at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$SnapshotContext.snapshotFile(BlobStoreIndexShardRepository.java:659)\n    at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$SnapshotContext.snapshot(BlobStoreIndexShardRepository.java:604)\n    at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository.snapshot(BlobStoreIndexShardRepository.java:191)\n    at org.elasticsearch.snapshots.SnapshotShardsService.snapshot(SnapshotShardsService.java:340)\n    at org.elasticsearch.snapshots.SnapshotShardsService.access$200(SnapshotShardsService.java:76)\n    at org.elasticsearch.snapshots.SnapshotShardsService$1.doRun(SnapshotShardsService.java:296)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n    Locked synchronizers:\n    - java.util.concurrent.ThreadPoolExecutor$Worker@4a066cec\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159884955","html_url":"https://github.com/elastic/elasticsearch/issues/15040#issuecomment-159884955","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15040","id":159884955,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTg4NDk1NQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2015-11-26T11:13:23Z","updated_at":"2015-11-26T11:13:23Z","author_association":"CONTRIBUTOR","body":"@s1monw Looking at org.apache.lucene.util.IOUtils.fsync, I'm wondering though why the force operation is retried in case of a ClosedChannelException (of which the thrown ClosedByInterruptException is one).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159890641","html_url":"https://github.com/elastic/elasticsearch/issues/15040#issuecomment-159890641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15040","id":159890641,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTg5MDY0MQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2015-11-26T11:34:30Z","updated_at":"2015-11-26T11:34:30Z","author_association":"CONTRIBUTOR","body":"might be related to this:\n\nhttps://issues.apache.org/jira/browse/LUCENE-6902\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183938832","html_url":"https://github.com/elastic/elasticsearch/issues/15040#issuecomment-183938832","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15040","id":183938832,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzkzODgzMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-14T17:59:02Z","updated_at":"2016-02-14T17:59:02Z","author_association":"CONTRIBUTOR","body":"@ywelsch can this be closed?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/201202308","html_url":"https://github.com/elastic/elasticsearch/issues/15040#issuecomment-201202308","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15040","id":201202308,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMTIwMjMwOA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2016-03-25T08:41:03Z","updated_at":"2016-03-25T08:41:03Z","author_association":"CONTRIBUTOR","body":"With the fix in Lucene an no further reoccurrences I'm aware of, I'm closing this.\n","performed_via_github_app":null}]