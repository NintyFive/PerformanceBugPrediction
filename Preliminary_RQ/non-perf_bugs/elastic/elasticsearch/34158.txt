{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34158","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34158/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34158/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34158/events","html_url":"https://github.com/elastic/elasticsearch/issues/34158","id":365022923,"node_id":"MDU6SXNzdWUzNjUwMjI5MjM=","number":34158,"title":"ElasticSearch upgrade from 6.4.0 to 6.4.1 breaks keystore and gcs plugin setup","user":{"login":"orlandoescalante","id":10523494,"node_id":"MDQ6VXNlcjEwNTIzNDk0","avatar_url":"https://avatars1.githubusercontent.com/u/10523494?v=4","gravatar_id":"","url":"https://api.github.com/users/orlandoescalante","html_url":"https://github.com/orlandoescalante","followers_url":"https://api.github.com/users/orlandoescalante/followers","following_url":"https://api.github.com/users/orlandoescalante/following{/other_user}","gists_url":"https://api.github.com/users/orlandoescalante/gists{/gist_id}","starred_url":"https://api.github.com/users/orlandoescalante/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orlandoescalante/subscriptions","organizations_url":"https://api.github.com/users/orlandoescalante/orgs","repos_url":"https://api.github.com/users/orlandoescalante/repos","events_url":"https://api.github.com/users/orlandoescalante/events{/privacy}","received_events_url":"https://api.github.com/users/orlandoescalante/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-09-28T20:04:45Z","updated_at":"2018-11-09T08:10:49Z","closed_at":"2018-11-09T08:10:48Z","author_association":"NONE","active_lock_reason":null,"body":"We recently upgraded to Elastic 6.4.0 and included into the configuration the steps suggested to use GCS plugin for Google Clous Storage snaphots for the backup/restore process. Following what is publish here: https://www.elastic.co/guide/en/elasticsearch/plugins/6.x/repository-gcs-client.html. All was working fine, Elastic starting without problem and backups working as expected on the buckets,\r\n\r\nToday I was testing the upgrade to 6.4.1, doing the rolling upgrade suggested: https://www.elastic.co/guide/en/elasticsearch/reference/6.4/rolling-upgrades.html\r\n\r\nAfter the install of Elastic, Plugins updates too, the server started showing some errors like this:\r\n\r\n`[2018-09-28T12:50:35,588][ERROR][o.e.b.Bootstrap          ] Exception\r\njava.lang.IllegalArgumentException: unknown secure setting [gcs.client.default.credentials_file] please check that any required plugins are installed, or check the breaking changes documentation for removed settings\r\n`\r\nAs action plan for the validation I removed/reset the keystore again to see if error can be skipped, and in fact it worked but a new warning appeared:\r\n\r\n`[2018-09-28T12:52:36,881][WARN ][o.e.r.RepositoriesService] [node-1] failed to create repository [es-core-backup]\r\norg.elasticsearch.repositories.RepositoryException: [es-core-backup] repository type [gcs] does not exist\r\n`\r\n\r\nMy doubt is that Upgrade was not as clean as expected, and it evidently broke the GCS/Elastic Keystore setup and the snapshot previous bucket configuration. Is there something I was missing in the process to perform the upgrade?  \r\n\r\nI've done other versions upgrade for Elastic in the past and this type of issues never happened on our environments. \r\n\r\n\r\n","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}