{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33798","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33798/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33798/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33798/events","html_url":"https://github.com/elastic/elasticsearch/issues/33798","id":361184198,"node_id":"MDU6SXNzdWUzNjExODQxOTg=","number":33798,"title":"Clearing cache for specific fields always clears cache for all fields","user":{"login":"geekpete","id":2070843,"node_id":"MDQ6VXNlcjIwNzA4NDM=","avatar_url":"https://avatars2.githubusercontent.com/u/2070843?v=4","gravatar_id":"","url":"https://api.github.com/users/geekpete","html_url":"https://github.com/geekpete","followers_url":"https://api.github.com/users/geekpete/followers","following_url":"https://api.github.com/users/geekpete/following{/other_user}","gists_url":"https://api.github.com/users/geekpete/gists{/gist_id}","starred_url":"https://api.github.com/users/geekpete/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geekpete/subscriptions","organizations_url":"https://api.github.com/users/geekpete/orgs","repos_url":"https://api.github.com/users/geekpete/repos","events_url":"https://api.github.com/users/geekpete/events{/privacy}","received_events_url":"https://api.github.com/users/geekpete/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":958803250,"node_id":"MDU6TGFiZWw5NTg4MDMyNTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.6.11","name":"v5.6.11","color":"DDDDDD","default":false,"description":""},{"id":1009148120,"node_id":"MDU6TGFiZWwxMDA5MTQ4MTIw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.4.1","name":"v6.4.1","color":"DDDDDD","default":false,"description":""},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"assignees":[{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-09-18T08:09:24Z","updated_at":"2019-02-07T08:20:02Z","closed_at":"2018-09-20T06:59:54Z","author_association":"MEMBER","active_lock_reason":null,"body":"\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): Tested with version 5.2.2 and 6.4.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): Java HotSpot(TM) 64-Bit Server VM (build 25.172-b11, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Tested on OSX: Darwin Kernel Version 17.7.0: Thu Jun 21 22:53:14 PDT 2018; root:xnu-4570.71.2~1/RELEASE_X86_64 x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nAttempting to clear the cache for a specific field or fields always clears for all fields.\r\n\r\n**Steps to reproduce**:\r\n\r\nTesting consists of creating an index with a number of fields that would use field data, populate the index and then run an aggregation on different fields that will populate the fielddata cache.\r\n\r\nThen try to clear the cache for only one of the the fields but show that the cache is cleared for all fields.\r\n\r\n```\r\n# ensure test index doesn't exist\r\nDELETE my_index\r\n\r\n# create index with 3 fielddata enabled fields\r\nPUT my_index/\r\n{\r\n  \"mappings\": {\r\n    \"doc\": {\r\n      \"properties\": {\r\n        \"test1\": {\r\n          \"type\": \"text\",\r\n          \"fielddata\": true\r\n        },\r\n        \"test2\": {\r\n          \"type\": \"text\",\r\n          \"fielddata\": true\r\n        },\r\n        \"bob3\": {\r\n          \"type\": \"text\",\r\n          \"fielddata\": true\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\n# populate with data\r\nPOST /my_index/doc\r\n{\r\n  \"test1\": \"testing 123 123 123\",\r\n  \"test2\": \"test123\",\r\n  \"bob3\": \"this is a test sentence that's longer than the rest\"\r\n}\r\n\r\n# run an agg on one field to populate fielddata cache\r\nGET /my_index/_search\r\n{\r\n  \"aggs\": {\r\n    \"test\": {\r\n      \"terms\": {\r\n        \"field\": \"test1\",\r\n        \"size\": 100\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n# run same agg on another field\r\nGET /my_index/_search\r\n{\r\n  \"aggs\": {\r\n    \"test\": {\r\n      \"terms\": {\r\n        \"field\": \"bob3\",\r\n        \"size\": 100\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n# view fielddata usage\r\nGET /_cat/fielddata?v\r\n\r\n# do either of the following to attempt to clear the cache for only one of the fields\r\nPOST /my_index/_cache/clear?fielddata=true&fields=bob3\r\nPOST /my_index/_cache/clear?fields=bob3\r\n\r\n# check caches again and all fields have been zeroed not just the one field.\r\nGET /_cat/fielddata?v\r\n```\r\n\r\n\r\n","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}