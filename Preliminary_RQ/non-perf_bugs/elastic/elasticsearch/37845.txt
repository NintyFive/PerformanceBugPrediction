{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37845","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37845/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37845/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37845/events","html_url":"https://github.com/elastic/elasticsearch/issues/37845","id":402970801,"node_id":"MDU6SXNzdWU0MDI5NzA4MDE=","number":37845,"title":"Deprecation Info API cannot check filtered settings","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"labels":[{"id":1142254209,"node_id":"MDU6TGFiZWwxMTQyMjU0MjA5","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Features","name":":Core/Features/Features","color":"0e8a16","default":false,"description":"A catch-all label for :Core/Features that don't fit in any other bucket."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"assignees":[{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-01-25T01:47:03Z","updated_at":"2019-02-02T00:07:01Z","closed_at":"2019-02-02T00:07:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"As noted in https://github.com/elastic/elasticsearch/pull/37793#issuecomment-457067601, the Deprecation Info API uses the NodeInfo API to check for problems with settings.  This means that issues involving filtered settings cannot be detected by the Deprecation Info API.\r\n\r\nThis issue was masked by the fact that we only have unit tests for the node deprecation checks, which do not go through the filtering process.\r\n\r\nThis impacts a few different checks:\r\n* `watcherNotificationsSecureSettingsCheck`, introduced in https://github.com/elastic/elasticsearch/pull/36907\r\n* `defaultSSLSettingsRemoved`, introduced in https://github.com/elastic/elasticsearch/pull/36847\r\n* `tlsv1ProtocolDisabled`, introduced in https://github.com/elastic/elasticsearch/pull/37793 (not yet merged)\r\n\r\nWe do not want to allow filtered settings to be accessed via the NodeInfo API, as there is a reason these settings are filtered: they typically contain sensitive information.\r\n\r\nOne possible solution is to change how the Deprecation API operates: instead of retrieving the settings from the nodes and performing the checks on the master node, we could have each node perform the checks on its own settings and send the results back to the master.  This would allow filtered settings to be examined in deprecation checks, but add significant complexity and create problems in mixed clusters unless it is done carefully.\r\n\r\nAnother possible solution is to simply say that these issues cannot be detected via the Deprecation Info API, and the user will have to check the deprecation log to find out about these issues.  We have done this for one potential issue, the changed file path for file-based discovery, which is not detectable through the NodeInfo API: https://github.com/elastic/elasticsearch/pull/36190.  If we go this route, we may want to consider returning a `WARNING` level issue (or resurrecting `INFO`) if Watcher/Security are enabled reminding users to check the deprecation logs and informing them of these changes we cannot detect.\r\n\r\n/cc @bleskes for awareness","closed_by":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"performed_via_github_app":null}