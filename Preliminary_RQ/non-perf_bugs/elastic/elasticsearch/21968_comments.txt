[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264806631","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-264806631","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":264806631,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDgwNjYzMQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-12-05T09:34:14Z","updated_at":"2016-12-05T09:34:14Z","author_association":"MEMBER","body":"Do you really intend to generate a bucket for every `50ms`?\r\nWhy not using BTW a `date_histogram` here?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264807107","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-264807107","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":264807107,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDgwNzEwNw==","user":{"login":"yaronuliel","id":5229872,"node_id":"MDQ6VXNlcjUyMjk4NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/5229872?v=4","gravatar_id":"","url":"https://api.github.com/users/yaronuliel","html_url":"https://github.com/yaronuliel","followers_url":"https://api.github.com/users/yaronuliel/followers","following_url":"https://api.github.com/users/yaronuliel/following{/other_user}","gists_url":"https://api.github.com/users/yaronuliel/gists{/gist_id}","starred_url":"https://api.github.com/users/yaronuliel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yaronuliel/subscriptions","organizations_url":"https://api.github.com/users/yaronuliel/orgs","repos_url":"https://api.github.com/users/yaronuliel/repos","events_url":"https://api.github.com/users/yaronuliel/events{/privacy}","received_events_url":"https://api.github.com/users/yaronuliel/received_events","type":"User","site_admin":false},"created_at":"2016-12-05T09:36:31Z","updated_at":"2016-12-05T09:37:05Z","author_association":"NONE","body":"No, I didn't - it was part of a training session, but still - I didn't expect it to crash\r\nIf, as you say, this isn't a reasonable query - it shouldn't be possible, especially when considering that `date_histogram` exists\r\n(eventually I realized where my problem was - but still...)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264807483","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-264807483","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":264807483,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDgwNzQ4Mw==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2016-12-05T09:38:15Z","updated_at":"2016-12-05T09:38:15Z","author_association":"CONTRIBUTOR","body":"@dadoonet I believe the issue here is that it crashed, not that it failed to generate the buckets :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264808135","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-264808135","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":264808135,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDgwODEzNQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-12-05T09:41:20Z","updated_at":"2016-12-05T09:41:20Z","author_association":"MEMBER","body":"Yeah I agree. I did not close the issue :)\r\nI was just surprised by the request itself...\r\n\r\nIt crashes with OOM and we could expect probably to have a circuit breaker here...\r\n\r\n@jpountz WDYT?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264817203","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-264817203","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":264817203,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDgxNzIwMw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-12-05T10:21:48Z","updated_at":"2016-12-05T10:21:48Z","author_association":"CONTRIBUTOR","body":"To me the problem here is not related to the circuit breakers but more to the fact that running aggs on such a small dataset (22 records) should allocate very little memory, yet this managed to trigger an OOME. We should dig...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264825967","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-264825967","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":264825967,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDgyNTk2Nw==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2016-12-05T11:03:42Z","updated_at":"2016-12-05T11:03:42Z","author_association":"CONTRIBUTOR","body":"@jpountz this is because the amount of buckets that's being generated is immense. You can reproduce this with date_histogram for example and 2 documents, one with a 2000 date and one with 2010 date. Then run with monthly interval. The threshold on number of buckets counts the ones with values, and ignores the empty ones.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264830920","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-264830920","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":264830920,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDgzMDkyMA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-12-05T11:28:16Z","updated_at":"2016-12-05T11:28:16Z","author_association":"CONTRIBUTOR","body":"Oh I see, thanks @synhershko. I was confused because I thought the OOME occurred when computing the buckets, in spite of the fact we use a sparse encoding. But the OOME actually occurs when generating the response, since we fill gaps with empty buckets.\r\n\r\nRelates to #10904","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/354058779","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-354058779","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":354058779,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NDA1ODc3OQ==","user":{"login":"zjxlinux","id":16369233,"node_id":"MDQ6VXNlcjE2MzY5MjMz","avatar_url":"https://avatars1.githubusercontent.com/u/16369233?v=4","gravatar_id":"","url":"https://api.github.com/users/zjxlinux","html_url":"https://github.com/zjxlinux","followers_url":"https://api.github.com/users/zjxlinux/followers","following_url":"https://api.github.com/users/zjxlinux/following{/other_user}","gists_url":"https://api.github.com/users/zjxlinux/gists{/gist_id}","starred_url":"https://api.github.com/users/zjxlinux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zjxlinux/subscriptions","organizations_url":"https://api.github.com/users/zjxlinux/orgs","repos_url":"https://api.github.com/users/zjxlinux/repos","events_url":"https://api.github.com/users/zjxlinux/events{/privacy}","received_events_url":"https://api.github.com/users/zjxlinux/received_events","type":"User","site_admin":false},"created_at":"2017-12-27T06:10:40Z","updated_at":"2017-12-27T06:10:40Z","author_association":"NONE","body":"Is it possible that the query cache(indices.breaker.request.limit which default to 40% of the heap space) plus the used segment memory already over 100% of the heap space,  that is why there is no circuit breaker here","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372670800","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-372670800","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":372670800,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjY3MDgwMA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T13:48:21Z","updated_at":"2018-03-13T13:48:21Z","author_association":"MEMBER","body":"https://github.com/elastic/elasticsearch/pull/27581 has fixed this issue and the above recreation now (since 6.2.0) results in the following response to the client and no OOME on the server:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"\",\r\n    \"phase\": \"fetch\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [],\r\n    \"caused_by\": {\r\n      \"type\": \"too_many_buckets_exception\",\r\n      \"reason\": \"Trying to create too many buckets. Must be less than or equal to: [10000] but was [10001]. This limit can be set by changing the [search.max_buckets] cluster level setting.\",\r\n      \"max_buckets\": 10000\r\n    }\r\n  },\r\n  \"status\": 503\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372678678","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-372678678","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":372678678,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjY3ODY3OA==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T14:11:52Z","updated_at":"2018-03-13T14:11:52Z","author_association":"CONTRIBUTOR","body":"@colings86 thanks! wouldn't it make sense to backport this to 5.x and 6.0/6.1?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372959539","html_url":"https://github.com/elastic/elasticsearch/issues/21968#issuecomment-372959539","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21968","id":372959539,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjk1OTUzOQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T09:37:53Z","updated_at":"2018-03-14T09:37:53Z","author_association":"MEMBER","body":"@synhershko 6.0 and 6.1 are not maintained as of the release of 6.2 and therefore do not receive bug fixes. \r\n\r\nThe 5.6 branch is maintained but only to receive critical bug fixes. Although this enhancement is a big improvement the change for it was not straight-forward and back-porting this change to 5.6 would be tricky and high risk and we don't back port enhancements to bug fix releases as a rule. Additionally the enhancement is a breaking change which is not something we include in bug fix releases.","performed_via_github_app":null}]