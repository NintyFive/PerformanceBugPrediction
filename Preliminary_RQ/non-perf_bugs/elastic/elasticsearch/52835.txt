{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52835","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52835/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52835/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52835/events","html_url":"https://github.com/elastic/elasticsearch/issues/52835","id":571524014,"node_id":"MDU6SXNzdWU1NzE1MjQwMTQ=","number":52835,"title":"[CI] RemoveCorruptedShardDataCommandIT.testCorruptIndex failure","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-02-26T16:54:49Z","updated_at":"2020-02-29T11:27:43Z","closed_at":"2020-02-29T11:27:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Failed on 7.x.\r\n\r\nBuild log: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+multijob+fast+part1/3581/console\r\n\r\nBuild scan: https://gradle-enterprise.elastic.co/s/kqmna7aoemr3o\r\n\r\nFailure:\r\n```\r\n No text input configured for prompt [Confirm [y/N] ]Close stacktrace\r\nat __randomizedtesting.SeedInfo.seed([E6E73F63F51FEC69:90E32898CDEDDF0C]:0)\r\nat org.elasticsearch.cli.MockTerminal.readText(MockTerminal.java:60)\r\nat org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.confirm(RemoveCorruptedShardDataCommand.java:235)\r\nat org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.dropCorruptMarkerFiles(RemoveCorruptedShardDataCommand.java:208)\r\nat org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.lambda$processNodePaths$2(RemoveCorruptedShardDataCommand.java:377)\r\nat org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.findAndProcessShardPath(RemoveCorruptedShardDataCommand.java:183)\r\nat org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.processNodePaths(RemoveCorruptedShardDataCommand.java:258)\r\nat org.elasticsearch.cluster.coordination.ElasticsearchNodeCommand.processNodePaths(ElasticsearchNodeCommand.java:120)\r\n```\r\n\r\nAlso in the stack:\r\n```\r\norg.apache.lucene.index.CorruptIndexException: checksum failed (hardware problem?) : expected=1e1ff2b7 actual=e817cfb1 (resource=BufferedChecksumIndexInput(MMapIndexInput(path=\"/dev/shm/elastic+elasticsearch+7.x+multijob+fast+part1/server/build/testrun/integTest/temp/org.elasticsearch.index.shard.RemoveCorruptedShardDataCommandIT_E6E73F63F51FEC69-001/tempDir-003/node_t0/nodes/0/indices/7KPUop-fTHSb8Y-NmZmqHg/0/index/_8.cfs\")))\r\n\tat org.apache.lucene.codecs.CodecUtil.checkFooter(CodecUtil.java:419)\r\n\tat org.apache.lucene.codecs.CodecUtil.checksumEntireFile(CodecUtil.java:526)\r\n\tat org.elasticsearch.index.store.Store.checkIntegrity(Store.java:522)\r\n\tat org.elasticsearch.index.shard.IndexShard.doCheckIndex(IndexShard.java:2498)\r\n\tat org.elasticsearch.index.shard.IndexShard.checkIndex(IndexShard.java:2474)\r\n\tat org.elasticsearch.index.shard.IndexShard.maybeCheckIndex(IndexShard.java:2464)\r\n\tat org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1589)\r\n\tat org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:431)\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:97)\r\n\tat org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:325)\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:95)\r\n\tat org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:1873)\r\n\tat org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73)\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nchecksum passed: _c.cfe\r\nchecksum passed: _8.si\r\n[2020-02-26T07:15:34,108][WARN ][o.e.i.c.IndicesClusterStateService] [node_t0] [index42][0] marking and sending shard failed due to [failed recovery]\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [index42][0]: Recovery failed on {node_t0}{-uaTgAO2SdO65AjRKFu92A}{tUjKl9flR2iMhYrQYw4fkw}{127.0.0.1}{127.0.0.1:40836}{dim}\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$executeRecovery$21(IndexShard.java:2640) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:71) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoveryListener$6(StoreRecovery.java:361) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:71) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:328) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:95) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:1873) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73) [main/:?]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692) [main/:?]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [main/:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_241]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_241]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_241]\r\nCaused by: org.elasticsearch.index.shard.IndexShardRecoveryException: failed recovery\r\n\t... 11 more\r\nCaused by: org.elasticsearch.indices.recovery.RecoveryFailedException: [index42][0]: Recovery failed on {node_t0}{-uaTgAO2SdO65AjRKFu92A}{tUjKl9flR2iMhYrQYw4fkw}{127.0.0.1}{127.0.0.1:40836}{dim} (check index failed)\r\n\tat org.elasticsearch.index.shard.IndexShard.maybeCheckIndex(IndexShard.java:2466) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1589) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:431) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:97) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:325) ~[main/:?]\r\n\t... 8 more\r\nCaused by: org.apache.lucene.index.CorruptIndexException: checksum failed (hardware problem?) : expected=1e1ff2b7 actual=e817cfb1 (resource=BufferedChecksumIndexInput(MMapIndexInput(path=\"/dev/shm/elastic+elasticsearch+7.x+multijob+fast+part1/server/build/testrun/integTest/temp/org.elasticsearch.index.shard.RemoveCorruptedShardDataCommandIT_E6E73F63F51FEC69-001/tempDir-003/node_t0/nodes/0/indices/7KPUop-fTHSb8Y-NmZmqHg/0/index/_8.cfs\")))\r\n\tat org.apache.lucene.codecs.CodecUtil.checkFooter(CodecUtil.java:419) ~[lucene-core-8.5.0-snapshot-b01d7cb.jar:8.5.0-snapshot-b01d7cb b01d7cb79a00aae89c108cdf3185971ee68ecda6 - jpountz - 2020-02-19 09:20:02]\r\n\tat org.apache.lucene.codecs.CodecUtil.checksumEntireFile(CodecUtil.java:526) ~[lucene-core-8.5.0-snapshot-b01d7cb.jar:8.5.0-snapshot-b01d7cb b01d7cb79a00aae89c108cdf3185971ee68ecda6 - jpountz - 2020-02-19 09:20:02]\r\n\tat org.elasticsearch.index.store.Store.checkIntegrity(Store.java:522) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.doCheckIndex(IndexShard.java:2498) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.checkIndex(IndexShard.java:2474) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.maybeCheckIndex(IndexShard.java:2464) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1589) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:431) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:97) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:325) ~[main/:?]\r\n\t... 8 more\r\n[2020-02-26T07:15:34,122][WARN ][o.e.c.r.a.AllocationService] [node_t0] failing shard [failed shard, shard [index42][0], node[-uaTgAO2SdO65AjRKFu92A], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[INITIALIZING], a[id=-yGTkijeSByRIvYfscntVQ], unassigned_info[[reason=CLUSTER_RECOVERED], at[2020-02-26T15:15:34.007Z], delayed=false, allocation_status[fetching_shard_data]], message [failed recovery], failure [RecoveryFailedException[[index42][0]: Recovery failed on {node_t0}{-uaTgAO2SdO65AjRKFu92A}{tUjKl9flR2iMhYrQYw4fkw}{127.0.0.1}{127.0.0.1:40836}{dim}]; nested: IndexShardRecoveryException[failed recovery]; nested: RecoveryFailedException[[index42][0]: Recovery failed on {node_t0}{-uaTgAO2SdO65AjRKFu92A}{tUjKl9flR2iMhYrQYw4fkw}{127.0.0.1}{127.0.0.1:40836}{dim} (check index failed)]; nested: CorruptIndexException[checksum failed (hardware problem?) : expected=1e1ff2b7 actual=e817cfb1 (resource=BufferedChecksumIndexInput(MMapIndexInput(path=\"/dev/shm/elastic+elasticsearch+7.x+multijob+fast+part1/server/build/testrun/integTest/temp/org.elasticsearch.index.shard.RemoveCorruptedShardDataCommandIT_E6E73F63F51FEC69-001/tempDir-003/node_t0/nodes/0/indices/7KPUop-fTHSb8Y-NmZmqHg/0/index/_8.cfs\")))]; ], markAsStale [true]]\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [index42][0]: Recovery failed on {node_t0}{-uaTgAO2SdO65AjRKFu92A}{tUjKl9flR2iMhYrQYw4fkw}{127.0.0.1}{127.0.0.1:40836}{dim}\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$executeRecovery$21(IndexShard.java:2640) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:71) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoveryListener$6(StoreRecovery.java:361) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:71) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:328) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:95) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:1873) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73) ~[main/:?]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692) ~[main/:?]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[main/:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_241]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_241]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_241]\r\nCaused by: org.elasticsearch.index.shard.IndexShardRecoveryException: failed recovery\r\n\t... 11 more\r\nCaused by: org.elasticsearch.indices.recovery.RecoveryFailedException: [index42][0]: Recovery failed on {node_t0}{-uaTgAO2SdO65AjRKFu92A}{tUjKl9flR2iMhYrQYw4fkw}{127.0.0.1}{127.0.0.1:40836}{dim} (check index failed)\r\n\tat org.elasticsearch.index.shard.IndexShard.maybeCheckIndex(IndexShard.java:2466) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1589) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:431) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:97) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:325) ~[main/:?]\r\n\t... 8 more\r\nCaused by: org.apache.lucene.index.CorruptIndexException: checksum failed (hardware problem?) : expected=1e1ff2b7 actual=e817cfb1 (resource=BufferedChecksumIndexInput(MMapIndexInput(path=\"/dev/shm/elastic+elasticsearch+7.x+multijob+fast+part1/server/build/testrun/integTest/temp/org.elasticsearch.index.shard.RemoveCorruptedShardDataCommandIT_E6E73F63F51FEC69-001/tempDir-003/node_t0/nodes/0/indices/7KPUop-fTHSb8Y-NmZmqHg/0/index/_8.cfs\")))\r\n\tat org.apache.lucene.codecs.CodecUtil.checkFooter(CodecUtil.java:419) ~[lucene-core-8.5.0-snapshot-b01d7cb.jar:8.5.0-snapshot-b01d7cb b01d7cb79a00aae89c108cdf3185971ee68ecda6 - jpountz - 2020-02-19 09:20:02]\r\n\tat org.apache.lucene.codecs.CodecUtil.checksumEntireFile(CodecUtil.java:526) ~[lucene-core-8.5.0-snapshot-b01d7cb.jar:8.5.0-snapshot-b01d7cb b01d7cb79a00aae89c108cdf3185971ee68ecda6 - jpountz - 2020-02-19 09:20:02]\r\n\tat org.elasticsearch.index.store.Store.checkIntegrity(Store.java:522) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.doCheckIndex(IndexShard.java:2498) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.checkIndex(IndexShard.java:2474) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.maybeCheckIndex(IndexShard.java:2464) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1589) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:431) ~[main/:?]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:97) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:325) ~[main/:?]\r\n\t... 8 more\r\n```\r\n\r\nReproduce with:\r\n```\r\n./gradlew ':server:integTest' --tests \"org.elasticsearch.index.shard.RemoveCorruptedShardDataCommandIT.testCorruptIndex\" -Dtests.seed=E6E73F63F51FEC69 -Dtests.security.manager=true -Dtests.locale=hu -Dtests.timezone=America/Dawson -Dcompiler.java=13\r\n```\r\n\r\nCould not reproduce locally.\r\n\r\nCould be a timing issue but I wasn't sure so raising it for a deeper look.","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}