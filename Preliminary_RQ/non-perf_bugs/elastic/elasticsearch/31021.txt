{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31021","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31021/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31021/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31021/events","html_url":"https://github.com/elastic/elasticsearch/issues/31021","id":328366328,"node_id":"MDU6SXNzdWUzMjgzNjYzMjg=","number":31021,"title":"Application using ElasticSearch 6.2.x fails to deploy on TomEE 7.0.4 when 6.1.x deploys flawlessly","user":{"login":"djr4488","id":4404338,"node_id":"MDQ6VXNlcjQ0MDQzMzg=","avatar_url":"https://avatars3.githubusercontent.com/u/4404338?v=4","gravatar_id":"","url":"https://api.github.com/users/djr4488","html_url":"https://github.com/djr4488","followers_url":"https://api.github.com/users/djr4488/followers","following_url":"https://api.github.com/users/djr4488/following{/other_user}","gists_url":"https://api.github.com/users/djr4488/gists{/gist_id}","starred_url":"https://api.github.com/users/djr4488/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djr4488/subscriptions","organizations_url":"https://api.github.com/users/djr4488/orgs","repos_url":"https://api.github.com/users/djr4488/repos","events_url":"https://api.github.com/users/djr4488/events{/privacy}","received_events_url":"https://api.github.com/users/djr4488/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2018-06-01T03:16:15Z","updated_at":"2019-10-30T12:32:29Z","closed_at":"2018-06-01T15:58:53Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.2.4\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 1.8.0_171\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): (Official Docker image)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nFails to deploy on TomEE 7.0.x\r\n\r\n**Steps to reproduce**:\r\nI am using Java EE 7, using my own EE producer for a RestHighLevelClient\r\n\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. No issues with 6.1.x code it deploys and app works fine\r\n 2. When attempting to use 6.2.x code it fails to deploy with stack trace below\r\n 3.\r\n\r\n**Provide logs (if relevant)**:\r\n01-Jun-2018 03:12:44.497 INFO [localhost-startStop-1] org.apache.openejb.util.JarExtractor.extract Extracted path: /usr/local/tomee/webapps/ROOT\r\n01-Jun-2018 03:12:46.428 SEVERE [localhost-startStop-1] sun.reflect.NativeMethodAccessorImpl.invoke ContainerBase.addChild: start: \r\n org.apache.catalina.LifecycleException: Failed to start component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[]]\r\nat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:167)\r\nat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:752)\r\nat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:728)\r\nat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:734)\r\nat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:988)\r\nat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1860)\r\nat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\nat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\nat java.lang.Thread.run(Thread.java:748)\r\nCaused by: org.apache.tomee.catalina.TomEERuntimeException: org.apache.openejb.OpenEJBException: Unable to create annotation scanner for web module : null\r\nat org.apache.tomee.catalina.TomcatWebAppBuilder.loadApplication(TomcatWebAppBuilder.java:2305)\r\nat org.apache.tomee.catalina.TomcatWebAppBuilder.startInternal(TomcatWebAppBuilder.java:1188)\r\nat org.apache.tomee.catalina.TomcatWebAppBuilder.configureStart(TomcatWebAppBuilder.java:1125)\r\nat org.apache.tomee.catalina.GlobalListenerSupport.lifecycleEvent(GlobalListenerSupport.java:133)\r\nat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:94)\r\nat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5105)\r\nat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\r\n... 10 more\r\nCaused by: org.apache.openejb.OpenEJBException: Unable to create annotation scanner for web module : null\r\nat org.apache.openejb.config.DeploymentLoader.addWebModule(DeploymentLoader.java:886)\r\nat org.apache.openejb.config.DeploymentLoader.load(DeploymentLoader.java:233)\r\nat org.apache.tomee.catalina.TomcatWebAppBuilder.loadApplication(TomcatWebAppBuilder.java:2303)\r\n... 16 more\r\nCaused by: java.lang.IllegalArgumentException\r\nat org.apache.xbean.asm5.ClassReader.<init>(Unknown Source)\r\nat org.apache.xbean.asm5.ClassReader.<init>(Unknown Source)\r\nat org.apache.xbean.asm5.ClassReader.<init>(Unknown Source)\r\nat org.apache.xbean.finder.AnnotationFinder.readClassDef(AnnotationFinder.java:1169)\r\nat org.apache.xbean.finder.AnnotationFinder.<init>(AnnotationFinder.java:147)\r\nat org.apache.xbean.finder.AnnotationFinder.<init>(AnnotationFinder.java:160)\r\nat org.apache.openejb.config.FinderFactory$OpenEJBAnnotationFinder.<init>(FinderFactory.java:546)\r\nat org.apache.openejb.config.FinderFactory.newFinder(FinderFactory.java:267)\r\nat org.apache.openejb.config.FinderFactory.create(FinderFactory.java:80)\r\nat org.apache.openejb.config.FinderFactory.createFinder(FinderFactory.java:69)\r\nat org.apache.openejb.config.DeploymentLoader.addWebModule(DeploymentLoader.java:878)\r\n... 18 more\r\n2018-06-01T03:12:46.490200800Z \r\n01-Jun-2018 03:12:46.428 SEVERE [localhost-startStop-1] sun.reflect.NativeMethodAccessorImpl.invoke Error deploying web application archive [/usr/local/tomee/webapps/ROOT.war]\r\n java.lang.IllegalStateException: ContainerBase.addChild: start: org.apache.catalina.LifecycleException: Failed to start component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[]]\r\nat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:756)\r\nat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:728)\r\nat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:734)\r\nat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:988)\r\nat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1860)\r\nat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\nat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\nat java.lang.Thread.run(Thread.java:748)\r\n2018-06-01T03:12:46.507613900Z \r\n\r\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}