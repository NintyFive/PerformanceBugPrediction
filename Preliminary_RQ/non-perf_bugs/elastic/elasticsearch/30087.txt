{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30087","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30087/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30087/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30087/events","html_url":"https://github.com/elastic/elasticsearch/issues/30087","id":317454855,"node_id":"MDU6SXNzdWUzMTc0NTQ4NTU=","number":30087,"title":"X-pack Security + tribe documentation has incorrect syntax and is based on file-based implementation","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"labels":[{"id":912838209,"node_id":"MDU6TGFiZWw5MTI4MzgyMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authorization","name":":Security/Authorization","color":"0e8a16","default":false,"description":"Roles, Privileges, DLS/FLS, RBAC/ABAC"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":{"login":"lcawl","id":26471269,"node_id":"MDQ6VXNlcjI2NDcxMjY5","avatar_url":"https://avatars0.githubusercontent.com/u/26471269?v=4","gravatar_id":"","url":"https://api.github.com/users/lcawl","html_url":"https://github.com/lcawl","followers_url":"https://api.github.com/users/lcawl/followers","following_url":"https://api.github.com/users/lcawl/following{/other_user}","gists_url":"https://api.github.com/users/lcawl/gists{/gist_id}","starred_url":"https://api.github.com/users/lcawl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lcawl/subscriptions","organizations_url":"https://api.github.com/users/lcawl/orgs","repos_url":"https://api.github.com/users/lcawl/repos","events_url":"https://api.github.com/users/lcawl/events{/privacy}","received_events_url":"https://api.github.com/users/lcawl/received_events","type":"User","site_admin":false},"assignees":[{"login":"lcawl","id":26471269,"node_id":"MDQ6VXNlcjI2NDcxMjY5","avatar_url":"https://avatars0.githubusercontent.com/u/26471269?v=4","gravatar_id":"","url":"https://api.github.com/users/lcawl","html_url":"https://github.com/lcawl","followers_url":"https://api.github.com/users/lcawl/followers","following_url":"https://api.github.com/users/lcawl/following{/other_user}","gists_url":"https://api.github.com/users/lcawl/gists{/gist_id}","starred_url":"https://api.github.com/users/lcawl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lcawl/subscriptions","organizations_url":"https://api.github.com/users/lcawl/orgs","repos_url":"https://api.github.com/users/lcawl/repos","events_url":"https://api.github.com/users/lcawl/events{/privacy}","received_events_url":"https://api.github.com/users/lcawl/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2017-09-08T00:20:24Z","updated_at":"2019-09-26T00:58:11Z","closed_at":"2019-09-26T00:58:11Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"*Original comment by @ppf2:*\n\n https://www.elastic.co/guide/en/x-pack/5.5/tribe-node-configuring.html\r\n\r\nThe statement at the top is not entirely true:\r\n\r\n\"The tribe node itself also must be configured to grant access to actions and indices on all of the connected clusters, as security checks on incoming requests are primarily done on the tribe node itself.\"\r\n\r\nMy setup has 2 downstream clusters backing a tribe, both with the same user named toolsUser defined with the kibana_user and tc_role:\r\n\r\n```\r\n{\r\n  \"toolsUser\": {\r\n    \"username\": \"toolsUser\",\r\n    \"roles\": [\r\n      \"tc_role\",\r\n      \"kibana_user\"\r\n    ],\r\n    \"full_name\": \"toolsUser\"\r\n...\r\n...\r\n}\r\n}\r\n```\r\n\r\ntc_role definition:\r\n\r\n```\r\n{\r\n  \"tc_role\": {\r\n    \"cluster\": [\r\n      \"transport_client\"\r\n    ],\r\n    \"indices\": [\r\n      {\r\n        \"names\": [\r\n          \"logstash-*\"\r\n        ],\r\n        \"privileges\": [\r\n          \"read\"\r\n        ],\r\n        \"field_security\": {\r\n          \"grant\": [\r\n            \"*\"\r\n          ]\r\n        }\r\n      }\r\n    ],\r\n    \"run_as\": [],\r\n    \"metadata\": {},\r\n    \"transient_metadata\": {\r\n      \"enabled\": true\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nIf I use the user \"toolsUser\" to connect to the tribe node (where the tribe node does not have a toolsUser defined locally), then the tribe node will see the toolsUser (and its associated roles, in this case, tc_role and kibana_user) from the preferred downstream cluster and be able to use that for authentication.  So if all downstream clusters have the same toolsUser with the same roles associated to them (that allows querying the logstash-* indices, then everything will work fine even if Step 5 is not followed from the documentation.\r\n\r\nPer Jay, this is likely because the documentation was written against the file based realm (before we implemented the native realm as the default).  Because on 5.x the default is native realm, it may still be helpful to clarify the above.\r\n\r\nAt the least though, we will want to fix the syntax error in Step 5a of the documentation where it uses the old roles definition which doesn't work anymore:\r\n\r\n```\r\ntribe_user:\r\n  indices:\r\n    'index*': search\r\n```\r\n\r\nShould now be:\r\n\r\n```\r\ntribe_user:\r\n  indices:\r\n    - names: [ 'index*' ]\r\n      privileges: [ 'read' ]\r\n```\r\n\r\n","closed_by":{"login":"debadair","id":362578,"node_id":"MDQ6VXNlcjM2MjU3OA==","avatar_url":"https://avatars1.githubusercontent.com/u/362578?v=4","gravatar_id":"","url":"https://api.github.com/users/debadair","html_url":"https://github.com/debadair","followers_url":"https://api.github.com/users/debadair/followers","following_url":"https://api.github.com/users/debadair/following{/other_user}","gists_url":"https://api.github.com/users/debadair/gists{/gist_id}","starred_url":"https://api.github.com/users/debadair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/debadair/subscriptions","organizations_url":"https://api.github.com/users/debadair/orgs","repos_url":"https://api.github.com/users/debadair/repos","events_url":"https://api.github.com/users/debadair/events{/privacy}","received_events_url":"https://api.github.com/users/debadair/received_events","type":"User","site_admin":false},"performed_via_github_app":null}