{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41679","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41679/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41679/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41679/events","html_url":"https://github.com/elastic/elasticsearch/issues/41679","id":438748351,"node_id":"MDU6SXNzdWU0Mzg3NDgzNTE=","number":41679,"title":"[CI] CcrRetentionLeaseIT suite failures","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"labels":[{"id":912824565,"node_id":"MDU6TGFiZWw5MTI4MjQ1NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CCR","name":":Distributed/CCR","color":"0e8a16","default":false,"description":"Issues around the Cross Cluster State Replication features"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-04-30T12:17:53Z","updated_at":"2019-05-28T01:44:38Z","closed_at":"2019-05-28T01:44:38Z","author_association":"MEMBER","active_lock_reason":null,"body":"There were many failures in CcrRetentionLeaseIT on the 6.7 branch\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.7+release-tests/335/console\r\n\r\nVarious error messages:\r\n\r\n```\r\ncom.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=184, name=elasticsearch[followerd3][__mock_network_thread][T#5], state=RUNNABLE, group=TGRP-CcrRetentionLeaseIT]\r\n\tat __randomizedtesting.SeedInfo.seed([6BDFE1BABE983352:EB2FA70CA1831917]:0)\r\nCaused by: java.lang.AssertionError\r\n\tat __randomizedtesting.SeedInfo.seed([6BDFE1BABE983352]:0)\r\n\tat org.elasticsearch.xpack.ccr.action.ShardFollowTasksExecutor$1.lambda$scheduleBackgroundRetentionLeaseRenewal$12(ShardFollowTasksExecutor.java:320)\r\n\tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:69)\r\n\tat org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:59)\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1114)\r\n\tat org.elasticsearch.transport.TcpTransport.lambda$handleException$24(TcpTransport.java:1011)\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$DirectExecutorService.execute(EsExecutors.java:192)\r\n\tat org.elasticsearch.transport.TcpTransport.handleException(TcpTransport.java:1009)\r\n\tat org.elasticsearch.transport.TcpTransport.handlerResponseError(TcpTransport.java:1001)\r\n\tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:950)\r\n\tat org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:763)\r\n\tat org.elasticsearch.transport.TcpTransport.consumeNetworkReads(TcpTransport.java:790)\r\n\tat org.elasticsearch.transport.MockTcpTransport.readMessage(MockTcpTransport.java:166)\r\n\tat org.elasticsearch.transport.MockTcpTransport.access$800(MockTcpTransport.java:75)\r\n\tat org.elasticsearch.transport.MockTcpTransport$MockChannel$2.lambda$doRun$0(MockTcpTransport.java:349)\r\n\tat org.elasticsearch.common.util.CancellableThreads.executeIO(CancellableThreads.java:108)\r\n\tat org.elasticsearch.transport.MockTcpTransport$MockChannel$2.doRun(MockTcpTransport.java:349)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n```\r\njava.lang.AssertionError: \r\nExpected: a collection with size <1>\r\n     but: collection size was <0>\r\n\tat __randomizedtesting.SeedInfo.seed([6BDFE1BABE983352:BB28D41D6109A1F0]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT.lambda$testRetentionLeaseIsTakenAtTheStartOfRecovery$0(CcrRetentionLeaseIT.java:193)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:858)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:832)\r\n\tat org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT.testRetentionLeaseIsTakenAtTheStartOfRecovery(CcrRetentionLeaseIT.java:185)\r\n```\r\n\r\n```\r\njava.lang.AssertionError: [leader][1], node[TBDUup3aSiWA1FAvDw30vA], [P], s[STARTED], a[id=1eichRG8TZOTWpipkDMHXg] has unreleased snapshotted index commits\r\n\tat __randomizedtesting.SeedInfo.seed([6BDFE1BABE983352:D24A7885A3A8073B]:0)\r\n\tat org.junit.Assert.fail(Assert.java:88)\r\n\tat org.junit.Assert.assertTrue(Assert.java:41)\r\n\tat org.junit.Assert.assertFalse(Assert.java:64)\r\n\tat org.elasticsearch.test.InternalTestCluster.lambda$assertNoSnapshottedIndexCommit$8(InternalTestCluster.java:1281)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:858)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:832)\r\n\tat org.elasticsearch.test.InternalTestCluster.assertNoSnapshottedIndexCommit(InternalTestCluster.java:1272)\r\n\tat org.elasticsearch.test.InternalTestCluster.beforeIndexDeletion(InternalTestCluster.java:1200)\r\n\tat org.elasticsearch.xpack.CcrIntegTestCase.afterTest(CcrIntegTestCase.java:202)\r\n```\r\n\r\n```\r\njava.lang.AssertionError: \r\nExpected: <{0=[DocIdSeqNoAndTerm{id='0 seqNo=0 primaryTerm=1}, DocIdSeqNoAndTerm{id='100 seqNo=21 primaryTerm=1}, DocIdSeqNoAndTerm{id='1009 seqNo=249 primaryTerm=1}, DocIdSeqNoAndTerm{id='101 seqNo=22 primaryTerm=1}, DocIdSeqNoAndTerm{id='1010 seqNo=250 primaryTerm=1}, DocIdSeqNoAndTerm{id='1012 seqNo=251 primaryTerm=1}, DocIdSeqNoAndTerm{id='1019 seqNo=252 primaryTerm=1}, DocIdSeqNoAndTerm{id='1022 seqNo=253 primaryTerm=1}, DocIdSeqNoAndTerm{id='1024 seqNo=254 primaryTerm=1}, DocIdSeqNoAndTerm{id='1026 seqNo=255 primaryTerm=1}, \r\n.... a very long message ....\r\n\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.CcrIntegTestCase.lambda$assertIndexFullyReplicatedToFollower$4(CcrIntegTestCase.java:499)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n\t\t... 39 more\r\n```\r\n\r\n```\r\njava.lang.AssertionError: \r\nExpected: a collection with size <1>\r\n     but: collection size was <0>\r\n\tat __randomizedtesting.SeedInfo.seed([6BDFE1BABE983352:BB28D41D6109A1F0]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT.lambda$testRetentionLeaseIsTakenAtTheStartOfRecovery$0(CcrRetentionLeaseIT.java:193)\r\n```\r\n\r\n```\r\njava.lang.AssertionError: \r\nExpected: a collection with size <1>\r\n     but: collection size was <0>\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT.lambda$assertRetentionLeaseRenewal$16(CcrRetentionLeaseIT.java:983)\r\n``` \r\n\r\nPlus a busy GC\r\n```\r\n  1> [2562-04-30T05:56:14,279][INFO ][o.e.m.j.JvmGcMonitorService] [followerm0] [gc][3] overhead, spent [377ms] collecting in the last [1.3s]\r\n  1> [2562-04-30T05:56:14,280][INFO ][o.e.m.j.JvmGcMonitorService] [followerm2] [gc][3] overhead, spent [377ms] collecting in the last [1.3s]\r\n  1> [2562-04-30T05:56:14,280][INFO ][o.e.m.j.JvmGcMonitorService] [followerd3] [gc][3] overhead, spent [377ms] collecting in the last [1.3s]\r\n  1> [2562-04-30T05:56:14,280][INFO ][o.e.m.j.JvmGcMonitorService] [followerd4] [gc][3] overhead, spent [377ms] collecting in the last [1.3s]\r\n  1> [2562-04-30T05:56:14,281][INFO ][o.e.m.j.JvmGcMonitorService] [leaderm1] [gc][6] overhead, spent [377ms] collecting in the last [1s]\r\n  1> [2562-04-30T05:56:14,281][INFO ][o.e.m.j.JvmGcMonitorService] [leaderd4] [gc][6] overhead, spent [377ms] collecting in the last [1s]\r\n  1> [2562-04-30T05:56:14,282][INFO ][o.e.m.j.JvmGcMonitorService] [leaderm2] [gc][6] overhead, spent [377ms] collecting in the last [1s]\r\n  1> [2562-04-30T05:56:14,272][INFO ][o.e.m.j.JvmGcMonitorService] [leaderm0] [gc][6] overhead, spent [377ms] collecting in the last [1s]\r\n  1> [2562-04-30T05:56:14,279][INFO ][o.e.m.j.JvmGcMonitorService] [leaderd3] [gc][6] overhead, spent [377ms] collecting in the last [1s]\r\n```\r\n\r\nDoes not reproduce \r\n```\r\n./gradlew :x-pack:plugin:ccr:internalClusterTest \\\r\n  -Dtests.seed=6BDFE1BABE983352 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT \\\r\n  -Dtests.security.manager=true \\\r\n  -Dbuild.snapshot=false \\\r\n  -Dtests.jvm.argline=\"-Dbuild.snapshot=false\" \\\r\n  -Dtests.locale=en-US \\\r\n  -Dtests.timezone=Etc/UTC \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nPossibly related to the timeout errors described in #41428","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}