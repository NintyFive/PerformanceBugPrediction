[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347527337","html_url":"https://github.com/elastic/elasticsearch/issues/27556#issuecomment-347527337","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27556","id":347527337,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzUyNzMzNw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T13:44:13Z","updated_at":"2017-11-28T13:44:13Z","author_association":"MEMBER","body":">  Also hits.total field in response displays total count of documents before they was collapsed. It would be nice add something like hits.total_collapsed for getting count of total collapsed documents.\r\n\r\nRetrieving the total number of group that match a query in a distributed system is not trivial and can be very costly.\r\nThe field collapsing is applied on the top documents, not **all** documents, this is why it **only** returns the number of documents that match and not the number of group. It does not need this costly computation to provide accurate results on the top hits.\r\nIf you really want to compute this number you can use the `cardinality` aggregation which was designed to handle this case more efficiently:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cardinality-aggregation.html#_counts_are_approximate\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347554435","html_url":"https://github.com/elastic/elasticsearch/issues/27556#issuecomment-347554435","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27556","id":347554435,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzU1NDQzNQ==","user":{"login":"Koc","id":191082,"node_id":"MDQ6VXNlcjE5MTA4Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/191082?v=4","gravatar_id":"","url":"https://api.github.com/users/Koc","html_url":"https://github.com/Koc","followers_url":"https://api.github.com/users/Koc/followers","following_url":"https://api.github.com/users/Koc/following{/other_user}","gists_url":"https://api.github.com/users/Koc/gists{/gist_id}","starred_url":"https://api.github.com/users/Koc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Koc/subscriptions","organizations_url":"https://api.github.com/users/Koc/orgs","repos_url":"https://api.github.com/users/Koc/repos","events_url":"https://api.github.com/users/Koc/events{/privacy}","received_events_url":"https://api.github.com/users/Koc/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T15:13:39Z","updated_at":"2017-11-28T15:13:39Z","author_association":"NONE","body":"Thank you for such detail explanation.\r\n\r\nYes, as workaround for now I am using `cardinality` aggregation. But it requires a lot of changes from application side. Is it possible use this aggrregation under the hood when end user queries count of collapsed field? According to account that result will approximate.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347563758","html_url":"https://github.com/elastic/elasticsearch/issues/27556#issuecomment-347563758","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27556","id":347563758,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzU2Mzc1OA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T15:41:15Z","updated_at":"2017-11-28T15:41:15Z","author_association":"MEMBER","body":"It is costly to compute even with the `cardinality` aggregation so I think it's import to keep the computation explicit. Also this number is not really necessary for field collapsing, you don't need it to paginate so I am reluctant to add a slow mode in field collapsing. Sorry but as I said if you really want to compute this number you should use aggregations.","performed_via_github_app":null}]