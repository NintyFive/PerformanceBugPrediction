{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28965","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28965/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28965/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28965/events","html_url":"https://github.com/elastic/elasticsearch/issues/28965","id":303863653,"node_id":"MDU6SXNzdWUzMDM4NjM2NTM=","number":28965,"title":"composite aggregation with filtered terms sources","user":{"login":"edovac","id":37216785,"node_id":"MDQ6VXNlcjM3MjE2Nzg1","avatar_url":"https://avatars1.githubusercontent.com/u/37216785?v=4","gravatar_id":"","url":"https://api.github.com/users/edovac","html_url":"https://github.com/edovac","followers_url":"https://api.github.com/users/edovac/followers","following_url":"https://api.github.com/users/edovac/following{/other_user}","gists_url":"https://api.github.com/users/edovac/gists{/gist_id}","starred_url":"https://api.github.com/users/edovac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edovac/subscriptions","organizations_url":"https://api.github.com/users/edovac/orgs","repos_url":"https://api.github.com/users/edovac/repos","events_url":"https://api.github.com/users/edovac/events{/privacy}","received_events_url":"https://api.github.com/users/edovac/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-03-09T14:43:47Z","updated_at":"2019-11-21T15:42:36Z","closed_at":"2018-03-15T14:33:59Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, \r\nI'm working on a project requiring something like an heat map between named entities, starting from most frequent values of these entities. \r\n\r\nI.E.: We need to calculate document count for people to places document occurrences, or even people to people document occurrences.\r\n\r\nI tried different kind of aggregations, but I think the composite aggregation is fit for the problem, using terms value source. \r\nScrolling is not an option, since the combinations number could be very high, and I only need an NxM matrix for which the entry points are fixed terms values and the cells are document counts. Usually N and M are usually between 3 and 10.\r\nI know in advance the values needed for each terms value source, so it would be easier to have an include parameter (like in the terms aggregation) to specify which values are to be combined and then counted.\r\n\r\nThe resulting syntax could be something like this:\r\n\r\n```\r\n{\r\n    \"size\": 0,\r\n    \"aggs\": {\r\n        \"heat_map\": {\r\n            \"composite\": {\r\n                \"sources\": [\r\n                    {\r\n                        \"people\": {\r\n                            \"terms\": {\r\n                            \t\"field\": \"people\",\r\n                            \t\"include\": [\"John Smith\", \"Alice White\", \"Jay\", \"Silent Bob\"]\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        \"places\": {\r\n                            \"terms\": {\r\n                            \t\"field\": \"places\",\r\n                            \t\"include\": [\"London\", \"Rome\", \"New York\", \"Berlin\"]\r\n                            }\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nObviuosly, included terms are user generated or previously loaded with a terms aggregation.\r\n\r\n\r\nThanks for the support and any insight.\r\n\r\n\r\n","closed_by":{"login":"edovac","id":37216785,"node_id":"MDQ6VXNlcjM3MjE2Nzg1","avatar_url":"https://avatars1.githubusercontent.com/u/37216785?v=4","gravatar_id":"","url":"https://api.github.com/users/edovac","html_url":"https://github.com/edovac","followers_url":"https://api.github.com/users/edovac/followers","following_url":"https://api.github.com/users/edovac/following{/other_user}","gists_url":"https://api.github.com/users/edovac/gists{/gist_id}","starred_url":"https://api.github.com/users/edovac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edovac/subscriptions","organizations_url":"https://api.github.com/users/edovac/orgs","repos_url":"https://api.github.com/users/edovac/repos","events_url":"https://api.github.com/users/edovac/events{/privacy}","received_events_url":"https://api.github.com/users/edovac/received_events","type":"User","site_admin":false},"performed_via_github_app":null}