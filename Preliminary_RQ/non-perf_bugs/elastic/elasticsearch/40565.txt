{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/40565","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40565/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40565/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40565/events","html_url":"https://github.com/elastic/elasticsearch/issues/40565","id":426221432,"node_id":"MDU6SXNzdWU0MjYyMjE0MzI=","number":40565,"title":"Calling some ILM APIs during rolling 6.5 to 6.6/6.7 upgrades causes 6.5 nodes to fail to join the cluster","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"labels":[{"id":912828538,"node_id":"MDU6TGFiZWw5MTI4Mjg1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/ILM+SLM","name":":Core/Features/ILM+SLM","color":"0e8a16","default":false,"description":"Index and Snapshot lifecycle management"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-03-27T23:06:05Z","updated_at":"2019-04-03T23:37:57Z","closed_at":"2019-04-03T23:37:57Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Calling the ILM Start, Stop, or Put Lifecycle APIs in a mixed 6.5 and 6.6/6.7 cluster will cause the 6.5 nodes to fail to join the cluster with this error:\r\n```\r\njava.lang.IllegalArgumentException: Unknown NamedWriteable [org.elasticsearch.cluster.metadata.MetaData$Custom][index_lifecycle]\r\n```\r\n\r\nThe cause of this is that the ILM custom metadata states that the minimum supported version is 6.5.0 (this constant was never updated when ILM was pushed back to 6.6):\r\nhttps://github.com/elastic/elasticsearch/blob/47390589d9025e335a2566c48a432ab777e568fb/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexlifecycle/IndexLifecycleMetadata.java#L108-L110\r\n\r\nThis causes the 6.5 nodes to try to read the custom metadata, but because ILM is not present in 6.5, this fails.\r\n\r\nA full cluster restart upgrade to the new version appears to be the only way to resolve the issue if a cluster gets into this state.","closed_by":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"performed_via_github_app":null}