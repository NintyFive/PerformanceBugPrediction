{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/61863","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61863/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61863/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61863/events","html_url":"https://github.com/elastic/elasticsearch/issues/61863","id":691148451,"node_id":"MDU6SXNzdWU2OTExNDg0NTE=","number":61863,"title":"ILM history rollover missing alias","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"labels":[{"id":912828538,"node_id":"MDU6TGFiZWw5MTI4Mjg1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/ILM+SLM","name":":Core/Features/ILM+SLM","color":"0e8a16","default":false,"description":"Index and Snapshot lifecycle management"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-09-02T16:02:58Z","updated_at":"2020-09-03T18:49:14Z","closed_at":"2020-09-03T18:49:14Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I've encountered a problem with the rollover of the ilm history index: \r\n```\r\n[2020-09-02T18:11:43,428][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [ilm-history-3-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"wait-for-follow-shard-tasks\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"pause-follower-index\"}] in policy [ilm-history-ilm-policy]\r\n[2020-09-02T18:11:43,485][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [auditbeat-7.9.0-2020.09.02-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"wait-for-follow-shard-tasks\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"pause-follower-index\"}] in policy [auditbeat]\r\n[2020-09-02T18:11:43,554][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [ilm-history-3-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"pause-follower-index\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"close-follower-index\"}] in policy [ilm-history-ilm-policy]\r\n[2020-09-02T18:11:43,610][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [auditbeat-7.9.0-2020.09.02-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"pause-follower-index\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"close-follower-index\"}] in policy [auditbeat]\r\n[2020-09-02T18:11:43,656][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [ilm-history-3-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"close-follower-index\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"unfollow-follower-index\"}] in policy [ilm-history-ilm-policy]\r\n[2020-09-02T18:11:43,708][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [auditbeat-7.9.0-2020.09.02-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"close-follower-index\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"unfollow-follower-index\"}] in policy [auditbeat]\r\n[2020-09-02T18:11:43,757][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [ilm-history-3-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"unfollow-follower-index\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"open-follower-index\"}] in policy [ilm-history-ilm-policy]\r\n[2020-09-02T18:11:43,804][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [auditbeat-7.9.0-2020.09.02-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"unfollow-follower-index\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"open-follower-index\"}] in policy [auditbeat]\r\n[2020-09-02T18:11:43,858][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [ilm-history-3-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"open-follower-index\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"wait-for-yellow-step\"}] in policy [ilm-history-ilm-policy]\r\n[2020-09-02T18:11:43,912][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [auditbeat-7.9.0-2020.09.02-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"open-follower-index\"}] to [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"wait-for-yellow-step\"}] in policy [auditbeat]\r\n[2020-09-02T18:11:43,963][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [ilm-history-3-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"wait-for-yellow-step\"}] to [{\"phase\":\"hot\",\"action\":\"rollover\",\"name\":\"check-rollover-ready\"}] in policy [ilm-history-ilm-policy]\r\n[2020-09-02T18:11:44,028][INFO ][o.e.x.i.IndexLifecycleTransition] [ElasticMBP.local] moving index [auditbeat-7.9.0-2020.09.02-000001] from [{\"phase\":\"hot\",\"action\":\"unfollow\",\"name\":\"wait-for-yellow-step\"}] to [{\"phase\":\"hot\",\"action\":\"rollover\",\"name\":\"check-rollover-ready\"}] in policy [auditbeat]\r\n[2020-09-02T18:21:43,436][ERROR][o.e.x.i.IndexLifecycleRunner] [ElasticMBP.local] policy [ilm-history-ilm-policy] for index [ilm-history-3-000001] failed on step [{\"phase\":\"hot\",\"action\":\"rollover\",\"name\":\"check-rollover-ready\"}]. Moving to ERROR step\r\njava.lang.IllegalArgumentException: setting [index.lifecycle.rollover_alias] for index [ilm-history-3-000001] is empty or not defined\r\n        at org.elasticsearch.xpack.core.ilm.WaitForRolloverReadyStep.evaluateCondition(WaitForRolloverReadyStep.java:65) [x-pack-core-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.ilm.IndexLifecycleRunner.runPeriodicStep(IndexLifecycleRunner.java:174) [x-pack-ilm-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.ilm.IndexLifecycleService.triggerPolicies(IndexLifecycleService.java:327) [x-pack-ilm-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.ilm.IndexLifecycleService.triggered(IndexLifecycleService.java:265) [x-pack-ilm-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.core.scheduler.SchedulerEngine.notifyListeners(SchedulerEngine.java:183) [x-pack-core-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.core.scheduler.SchedulerEngine$ActiveSchedule.run(SchedulerEngine.java:211) [x-pack-core-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) [?:?]\r\n        at java.lang.Thread.run(Thread.java:832) [?:?]\r\n```\r\nwhile simply using an audit beat which I believe just triggered its own rollover.\r\n\r\n@andreidan suggested this was introduced in https://github.com/elastic/elasticsearch/pull/61457","closed_by":{"login":"probakowski","id":3896475,"node_id":"MDQ6VXNlcjM4OTY0NzU=","avatar_url":"https://avatars1.githubusercontent.com/u/3896475?v=4","gravatar_id":"","url":"https://api.github.com/users/probakowski","html_url":"https://github.com/probakowski","followers_url":"https://api.github.com/users/probakowski/followers","following_url":"https://api.github.com/users/probakowski/following{/other_user}","gists_url":"https://api.github.com/users/probakowski/gists{/gist_id}","starred_url":"https://api.github.com/users/probakowski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/probakowski/subscriptions","organizations_url":"https://api.github.com/users/probakowski/orgs","repos_url":"https://api.github.com/users/probakowski/repos","events_url":"https://api.github.com/users/probakowski/events{/privacy}","received_events_url":"https://api.github.com/users/probakowski/received_events","type":"User","site_admin":false},"performed_via_github_app":null}