{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12649","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12649/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12649/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12649/events","html_url":"https://github.com/elastic/elasticsearch/issues/12649","id":99040677,"node_id":"MDU6SXNzdWU5OTA0MDY3Nw==","number":12649,"title":"Changed pid file path causes init script to fail to restart ES after upgrade","user":{"login":"magnusbaeck","id":9032797,"node_id":"MDQ6VXNlcjkwMzI3OTc=","avatar_url":"https://avatars0.githubusercontent.com/u/9032797?v=4","gravatar_id":"","url":"https://api.github.com/users/magnusbaeck","html_url":"https://github.com/magnusbaeck","followers_url":"https://api.github.com/users/magnusbaeck/followers","following_url":"https://api.github.com/users/magnusbaeck/following{/other_user}","gists_url":"https://api.github.com/users/magnusbaeck/gists{/gist_id}","starred_url":"https://api.github.com/users/magnusbaeck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/magnusbaeck/subscriptions","organizations_url":"https://api.github.com/users/magnusbaeck/orgs","repos_url":"https://api.github.com/users/magnusbaeck/repos","events_url":"https://api.github.com/users/magnusbaeck/events{/privacy}","received_events_url":"https://api.github.com/users/magnusbaeck/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-08-04T19:12:03Z","updated_at":"2020-11-11T21:59:55Z","closed_at":"2016-01-26T17:43:58Z","author_association":"NONE","active_lock_reason":null,"body":"With RESTART_ON_UPGRADE disabled (default for at least 1.5.2), the init script of ES 1.7.x will be unable to restart ES after a Debian package upgrade from 1.5.x or earlier.\n\nThis is because the pid file path changed in 1.6.0 (IIRC), so when a user invokes e.g. `/etc/init.d/elasticsearch restart` after the package has been upgraded no pid file is found and ES is deemed to not be running. The subsequent start will then fail since it can't bind to any ports as they're still busy by the running ES process.\n\nThis broke my automated upgrade from 1.5.2 to 1.7.1, requiring a manual shutdown of ES on affected machines and/or a package rollback. Could we try a little harder to find the pid file by e.g. introducing a fallback pid file in the 1.7.x series? Perhaps migrating the old pid file with something as simple as\n\n```\nLEGACY_PID_FILE=\"/var/run/elasticsearch.pid\"\nif [ -f \"$LEGACY_PID_FILE\" -a \"$LEGACY_PID_FILE\" != \"$PID_FILE\" ] ; then \n        mv \"$LEGACY_PID_FILE\" \"$PID_FILE\" || exit 1\nfi\n```\n\nright after the PID_DIR creation in /etc/init.d/elasticsearch would do?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}