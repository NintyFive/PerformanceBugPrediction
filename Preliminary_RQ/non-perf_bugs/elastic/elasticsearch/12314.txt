{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12314","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12314/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12314/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12314/events","html_url":"https://github.com/elastic/elasticsearch/issues/12314","id":95635394,"node_id":"MDU6SXNzdWU5NTYzNTM5NA==","number":12314,"title":"Shutting down a node stops the transport layer despite of ongoing indexing operations","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-07-17T10:57:34Z","updated_at":"2018-03-20T12:41:19Z","closed_at":"2018-03-20T12:41:19Z","author_association":"MEMBER","active_lock_reason":null,"body":"The current shutdown order is as follows:\n\n```\n        injector.getInstance(RestController.class).stop();\n        injector.getInstance(TransportService.class).stop();\n\n        for (Class<? extends LifecycleComponent> plugin : pluginsService.services()) {\n            injector.getInstance(plugin).stop();\n        }\n        // we should stop this last since it waits for resources to get released\n        // if we had scroll searchers etc or recovery going on we wait for to finish.\n        injector.getInstance(IndicesService.class).stop();\n        logger.info(\"stopped\");\n```\n\nThe means that the transport service is stopped before indices services, meaning that any ongoing write operation in IndicesService are blocked from the network and can't send requests. This can trigger #7572 . \n\nIMHO we should do a best effort in flushing on going operations in IndicesService, block new one from starting and then and only then close the transport service. These days we have mechanics to do so.  This does require careful thought. \n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}