{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24932","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24932/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24932/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24932/events","html_url":"https://github.com/elastic/elasticsearch/issues/24932","id":231976643,"node_id":"MDU6SXNzdWUyMzE5NzY2NDM=","number":24932,"title":"[CI] ClusterDisruptionIT.testAckedIndexing fails","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"labels":[{"id":160579278,"node_id":"MDU6TGFiZWwxNjA1NzkyNzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Discovery-Plugins","name":":Distributed/Discovery-Plugins","color":"0e8a16","default":false,"description":"Anything related to our integration plugins with EC2, GCP and Azure"},{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":675650443,"node_id":"MDU6TGFiZWw2NzU2NTA0NDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.0-beta2","name":"v6.0.0-beta2","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2017-05-29T09:48:57Z","updated_at":"2017-08-24T12:52:47Z","closed_at":"2017-08-20T19:35:09Z","author_association":"MEMBER","active_lock_reason":null,"body":"The test `ClusterDisruptionIT.testAckedIndexing` fails today on CI: \r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+java9-periodic/2689/consoleFull\r\n\r\nNote that the test used java 9. I didn't manage to reproduce it locally, it seems that the test is correctly executed but fails in the after test cleaning method:\r\n\r\n```\r\nERROR   20.1s J1 | ClusterDisruptionIT.testAckedIndexing <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: expected index shard counter on shard [test][2] on node node_t1 to be 0 but was 1. Current replication tasks on node:\r\n   > {\r\n   >   \"tasks\" : { }\r\n   > }\r\n   > \tat org.elasticsearch.test.InternalTestCluster.lambda$assertShardIndexCounter$5(InternalTestCluster.java:1158)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:726)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:700)\r\n   > \tat org.elasticsearch.test.InternalTestCluster.assertShardIndexCounter(InternalTestCluster.java:1139)\r\n   > \tat org.elasticsearch.test.InternalTestCluster.beforeIndexDeletion(InternalTestCluster.java:1109)\r\n   > \tat org.elasticsearch.test.ESIntegTestCase.beforeIndexDeletion(ESIntegTestCase.java:611)\r\n   > \tat org.elasticsearch.discovery.AbstractDisruptionTestCase.beforeIndexDeletion(AbstractDisruptionTestCase.java:111)\r\n   > \tat org.elasticsearch.test.ESIntegTestCase.afterInternal(ESIntegTestCase.java:581)\r\n   > \tat org.elasticsearch.test.ESIntegTestCase.cleanUpCluster(ESIntegTestCase.java:2058)\r\n```\r\n\r\nReproduce with:\r\n```\r\ngradle :core:integTest -Dtests.seed=3372D7F1BE882873 -Dtests.class=org.elasticsearch.discovery.ClusterDisruptionIT -Dtests.method=\"testAckedIndexing\" -Dtests.security.manager=true -Dtests.jvm.argline=\"--add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.nio=ALL-UNNAMED --add-opens=java.base/java.nio.file=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.base/java.util.concurrent=ALL-UNNAMED --add-opens=java.base/java.util.concurrent.locks=ALL-UNNAMED --add-opens=java.base/java.util.regex=ALL-UNNAMED\" -Dtests.locale=ar-KW -Dtests.timezone=Indian/Maldives\r\n```\r\n\r\n[consoleText.txt](https://github.com/elastic/elasticsearch/files/1035443/consoleText.txt)\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}