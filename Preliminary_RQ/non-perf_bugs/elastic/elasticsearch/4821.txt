{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4821","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4821/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4821/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4821/events","html_url":"https://github.com/elastic/elasticsearch/issues/4821","id":25970556,"node_id":"MDU6SXNzdWUyNTk3MDU1Ng==","number":4821,"title":"Node can't join cluster after another node restart","user":{"login":"maxcom","id":69385,"node_id":"MDQ6VXNlcjY5Mzg1","avatar_url":"https://avatars3.githubusercontent.com/u/69385?v=4","gravatar_id":"","url":"https://api.github.com/users/maxcom","html_url":"https://github.com/maxcom","followers_url":"https://api.github.com/users/maxcom/followers","following_url":"https://api.github.com/users/maxcom/following{/other_user}","gists_url":"https://api.github.com/users/maxcom/gists{/gist_id}","starred_url":"https://api.github.com/users/maxcom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxcom/subscriptions","organizations_url":"https://api.github.com/users/maxcom/orgs","repos_url":"https://api.github.com/users/maxcom/repos","events_url":"https://api.github.com/users/maxcom/events{/privacy}","received_events_url":"https://api.github.com/users/maxcom/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-01-21T08:00:34Z","updated_at":"2014-12-24T19:50:26Z","closed_at":"2014-12-24T18:46:19Z","author_association":"NONE","active_lock_reason":null,"body":"We are running ES 0.90.10 on 4 node cluster. One our node was restarted (killed by OOM killer), another node lost its connection to cluster and stuck in that state until we restart it.\n\nHere is log from node that lost its membership in cluster (10.31.10.154):\n\n```\n[2014-01-20 20:40:18,550][WARN ][transport.netty          ] [main] exception caught on transport layer [[id: 0xd9dc9013, /10.31.10.15\n4:46234 :> /10.31.10.150:9201]], closing connection\njava.io.IOException: Соединение сброшено другой стороной\n  at sun.nio.ch.FileDispatcherImpl.read0(Native Method)\n  at sun.nio.ch.SocketDispatcher.read(SocketDispatcher.java:39)\n  at sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:218)\n  at sun.nio.ch.IOUtil.read(IOUtil.java:186)\n  at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:359)\n  at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:64)\n  at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n  at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n  at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n  at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n  at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n  at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n  at java.lang.Thread.run(Thread.java:722)\n[2014-01-20 20:40:18,554][WARN ][discovery.zen            ] [main] not enough master nodes, current nodes: {[main][fnZZN_rgTEyczC7H_hX6sA][inet[/10.31.10.154:9201]]{max_local_storage_nodes=1},[97c87465-6ec2-429a-8c17-b06ea8739748][Ngb-aDzPQ7KTaivrb10OKA][inet[/10.31.10.151:9201]]{max_local_storage_nodes=1},}\n[2014-01-20 20:40:18,554][INFO ][cluster.service          ] [main] removed {[daeb5096-5cd1-4c9c-80c2-354031206176][b-LgzNuiR7uc1gGAjUS_YA][inet[/10.31.10.150:9201]]{max_local_storage_nodes=1},[97c87465-6ec2-429a-8c17-b06ea8739748][Ngb-aDzPQ7KTaivrb10OKA][inet[/10.31.10.151:9201]]{max_local_storage_nodes=1},}, reason: zen-disco-node_failed([daeb5096-5cd1-4c9c-80c2-354031206176][b-LgzNuiR7uc1gGAjUS_YA][inet[/10.31.10.150:9201]]{max_local_storage_nodes=1}), reason transport disconnected (with verified connect)\n[2014-01-20 20:40:22,641][INFO ][discovery.zen            ] [main] master_left [[2fe7ca69-61af-49b8-8390-6c565ab185e2][3ZdVtdrZQlScQKoiC7Dj2g][inet[/10.31.10.152:9201]]{max_local_storage_nodes=1}], reason [do not exists on master, act as master failure]\n[2014-01-21 11:06:32,462][INFO ][node                     ] [main] stopping ...\n```\n\n(IOException message in stack trace is 'Connection reset by peer')\n\nWe manually restarted that node at 2014-01-21 11:06, and after restart it successfully joined the cluster. Before starts node returned only MasterNotDiscoveredException.\n\nES configuration:\n\n```\ndiscovery.zen.minimum_master_nodes: 3\ncluster.name: jet\nnode.name: main\nnode.max_local_storage_nodes: 1\nindex.number_of_shards: 6\nindex.number_of_replicas: 0\nnetwork.host: 0.0.0.0\ndiscovery.zen.ping.unicast.hosts: \n  - 10.31.10.154:9201\n  - 10.31.10.150:9201\n  - 10.31.10.151:9201\n  - 10.31.10.152:9201\ndiscovery.zen.ping.multicast.enabled: false\nhttp.max_content_length: 500mb\nhttp.port: 9200\ntransport.tcp.port: 9201\ngateway.local.auto_import_dangled: no\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}