{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/61677","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61677/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61677/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61677/events","html_url":"https://github.com/elastic/elasticsearch/issues/61677","id":688561295,"node_id":"MDU6SXNzdWU2ODg1NjEyOTU=","number":61677,"title":"The parameter rest_total_hits_as_int in HLRC in the next scroll request iteration is missing","user":{"login":"silvinalucero","id":4911449,"node_id":"MDQ6VXNlcjQ5MTE0NDk=","avatar_url":"https://avatars2.githubusercontent.com/u/4911449?v=4","gravatar_id":"","url":"https://api.github.com/users/silvinalucero","html_url":"https://github.com/silvinalucero","followers_url":"https://api.github.com/users/silvinalucero/followers","following_url":"https://api.github.com/users/silvinalucero/following{/other_user}","gists_url":"https://api.github.com/users/silvinalucero/gists{/gist_id}","starred_url":"https://api.github.com/users/silvinalucero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/silvinalucero/subscriptions","organizations_url":"https://api.github.com/users/silvinalucero/orgs","repos_url":"https://api.github.com/users/silvinalucero/repos","events_url":"https://api.github.com/users/silvinalucero/events{/privacy}","received_events_url":"https://api.github.com/users/silvinalucero/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"}],"state":"closed","locked":false,"assignee":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-08-29T16:17:27Z","updated_at":"2020-08-31T23:01:21Z","closed_at":"2020-08-31T23:01:20Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.8.0\r\n\r\n**HLRC version ** : 6.8.12\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):   \"1.8.0_171\"\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): macOs Catalina 10.15.4\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nThe scroll search request has the parameter rest_total_hits_as_int ([#46076](https://github.com/elastic/elasticsearch/pull/46076)) but in the next scroll iterations the parameter is missing.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1.  Start a 7.8.0 ES cluster\r\n 2. Using the version 6.8 HLRC  in your code\r\n <dependency>\r\n            <groupId>org.elasticsearch</groupId>\r\n            <artifactId>elasticsearch</artifactId>\r\n            <version>6.8.4</version>\r\n  </dependency>\r\n\r\n 3. Write the next test:\r\n\r\n```\r\nimport com.google.common.collect.ImmutableMap;\r\nimport org.apache.http.HttpHost;\r\nimport org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;\r\nimport org.elasticsearch.action.admin.indices.refresh.RefreshRequest;\r\nimport org.elasticsearch.action.index.IndexRequest;\r\nimport org.elasticsearch.action.search.SearchRequest;\r\nimport org.elasticsearch.action.search.SearchResponse;\r\nimport org.elasticsearch.action.search.SearchScrollRequest;\r\nimport org.elasticsearch.client.RequestOptions;\r\nimport org.elasticsearch.client.RestClient;\r\nimport org.elasticsearch.client.RestHighLevelClient;\r\nimport org.elasticsearch.common.unit.TimeValue;\r\nimport org.elasticsearch.index.query.QueryBuilders;\r\nimport org.elasticsearch.search.builder.SearchSourceBuilder;\r\nimport org.junit.Test;\r\n\r\n@Test\r\n    public void testTotalHitsInScrollSearch() throws IOException {\r\n        String indexName = \"users\";\r\n        RestHighLevelClient client = new RestHighLevelClient(RestClient.builder(new HttpHost(\"localhost\", 9200, \"http\")));\r\n\r\n        client.indices().delete(new DeleteIndexRequest(indexName), RequestOptions.DEFAULT);\r\n\r\n        for (int i = 0; i < 100; i++) {\r\n            Map<String, Object> json = ImmutableMap.of(\"id\", i, \"status\", \"active\");\r\n            client.index(new IndexRequest(indexName, indexName).source(json), RequestOptions.DEFAULT);\r\n        }\r\n        client.indices().refresh(new RefreshRequest(indexName), RequestOptions.DEFAULT);\r\n\r\n        SearchRequest request = new SearchRequest(indexName);\r\n        SearchSourceBuilder source = new SearchSourceBuilder();\r\n        source.size(5);\r\n        source.query(QueryBuilders.termQuery(\"status\", \"active\"));\r\n        request.scroll(TimeValue.timeValueMinutes(1));\r\n        request.source(source);\r\n        SearchResponse response = client.search(request, RequestOptions.DEFAULT);\r\n        assertEquals(5, response.getHits().getHits().length);\r\n        assertEquals(100, response.getHits().getTotalHits());\r\n\r\n        SearchScrollRequest request2 = new SearchScrollRequest(response.getScrollId());\r\n        response = client.scroll(request2, RequestOptions.DEFAULT);\r\n        assertEquals(5, response.getHits().getHits().length);\r\n        assertEquals(100, response.getHits().getTotalHits());\r\n\r\n    }\r\n```\r\n\r\n**Provide logs (if relevant)**:  Test output\r\n```\r\njava.lang.AssertionError: \r\nExpected :100\r\nActual   :0\r\n```\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}