{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196/events","html_url":"https://github.com/elastic/elasticsearch/issues/32196","id":342734333,"node_id":"MDU6SXNzdWUzNDI3MzQzMzM=","number":32196,"title":"[CI] Connection issues in BasicDistributedJobsIT","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"assignees":[{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2018-07-19T13:44:12Z","updated_at":"2018-10-26T09:19:26Z","closed_at":"2018-10-25T16:37:57Z","author_association":"MEMBER","active_lock_reason":null,"body":"https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/1767/consoleFull\r\n\r\nDoes not reproduce with:\r\n```\r\nREPRODUCE WITH: gradlew :x-pack:plugin:ml:internalClusterTest \\\r\n  -Dtests.seed=98AB1BDCBBCE6890 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ml.integration.BasicDistributedJobsIT \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=en-US \\\r\n  -Dtests.timezone=UTC\r\n\r\nREPRODUCE WITH: gradlew :x-pack:plugin:ml:internalClusterTest \\\r\n  -Dtests.seed=98AB1BDCBBCE6890 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ml.integration.BasicDistributedJobsIT \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=en-US \\\r\n  -Dtests.timezone=UTC\r\n```\r\n\r\nI found https://github.com/elastic/elasticsearch/issues/29897 but this looks different in that I don't see an assertion failure in the logs. Rather something in the test cluster formation seems to be getting off track. Cluster starts up, then one node is shut down ([2018-07-19T10:11:05,813][INFO ][o.e.t.InternalTestCluster] Closing random node [node_t0], looks like this is done on purpose). After that I see socket failures and refused connections. Not sure if they are related to the test running of some general test cluster problem:\r\n\r\n```\r\n15:12:15   1> java.net.SocketException: Socket is closed\r\n15:12:15   1> \tat java.net.Socket.getOutputStream(Socket.java:943) ~[?:1.8.0_172]\r\n15:12:15   1> \tat org.elasticsearch.transport.MockTcpTransport$MockChannel.sendMessage(MockTcpTransport.java:412) [framework-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.transport.TcpTransport.internalSendMessage(TcpTransport.java:1163) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.transport.TcpTransport.sendResponse(TcpTransport.java:1252) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.transport.TcpTransport.sendResponse(TcpTransport.java:1220) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.transport.TcpTransportChannel.sendResponse(TcpTransportChannel.java:66) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.transport.TcpTransportChannel.sendResponse(TcpTransportChannel.java:60) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:54) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.discovery.zen.MembershipAction$LeaveRequestRequestHandler.messageReceived(MembershipAction.java:287) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.discovery.zen.MembershipAction$LeaveRequestRequestHandler.messageReceived(MembershipAction.java:282) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1679) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n15:12:15   1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_172]\r\n15:12:15   1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_172]\r\n15:12:15   1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_172]\r\n15:12:15   1> [2018-07-19T10:11:05,835][WARN ][o.e.t.MockTcpTransport   ] [node_t3] send message failed [channel: MockChannel{profile='default', isOpen=false, localAddress=/127.0.0.1:56400, isServerSocket=false}]\r\n```\r\n\r\n","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}