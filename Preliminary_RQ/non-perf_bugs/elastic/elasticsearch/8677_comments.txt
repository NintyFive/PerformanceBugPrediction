[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64718648","html_url":"https://github.com/elastic/elasticsearch/issues/8677#issuecomment-64718648","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8677","id":64718648,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NzE4NjQ4","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-11-26T22:16:36Z","updated_at":"2014-11-26T22:16:36Z","author_association":"CONTRIBUTOR","body":"what version is this on?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64720313","html_url":"https://github.com/elastic/elasticsearch/issues/8677#issuecomment-64720313","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8677","id":64720313,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NzIwMzEz","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2014-11-26T22:32:18Z","updated_at":"2014-11-26T22:32:18Z","author_association":"MEMBER","body":"1.3.4\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64757817","html_url":"https://github.com/elastic/elasticsearch/issues/8677#issuecomment-64757817","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8677","id":64757817,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NzU3ODE3","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T08:12:07Z","updated_at":"2014-11-27T08:13:39Z","author_association":"MEMBER","body":"I think I see what's going on. Normally, the client nodes receive a bulk request, splits it in shard bulks and send it on to the node where the primary is hosted. If the primary is not yet ready, the client node will wait for it to start. It does so by registering a listener for a cluster state update. Problem is that by registering the listener, it frees up a bulk thread which happily accepts another bulk request and so forth. We need to find a way to apply some back pressure in this case. \n\nIn the past we had the idea of having a central listener for all shard related issues - that would help here too.\n\nAn alternative is to limit the amount of \"transient\" cluster state listener which will throttle this but also other similar requests (like waiting for a master nodes).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96964627","html_url":"https://github.com/elastic/elasticsearch/issues/8677#issuecomment-96964627","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8677","id":96964627,"node_id":"MDEyOklzc3VlQ29tbWVudDk2OTY0NjI3","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T07:43:04Z","updated_at":"2015-04-28T07:43:04Z","author_association":"MEMBER","body":"@bleskes I think that potentially adding a circuit breaker on \"public\" actions, count towards it and down it when we send the response back through the channel might help in a more generic fashion, for most use cases.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/102964887","html_url":"https://github.com/elastic/elasticsearch/issues/8677#issuecomment-102964887","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8677","id":102964887,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMjk2NDg4Nw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-05-18T08:15:19Z","updated_at":"2015-05-18T08:15:19Z","author_association":"MEMBER","body":"@kimchy yeah, that's another more generic solution. I wonder if we shouldn't just add indexing request to the current request circuit breaker, which is currently only used for big arrays, i.e., per requests aggs. We might want to split it into \"bigarrays\" and \"indexing\" sub breakers so it will be easy to monitor. I briefly looked at the code and it seems doable.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263062194","html_url":"https://github.com/elastic/elasticsearch/issues/8677#issuecomment-263062194","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8677","id":263062194,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzA2MjE5NA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-11-26T12:58:51Z","updated_at":"2016-11-26T12:58:51Z","author_association":"CONTRIBUTOR","body":"Fixed by the inflight circuit breaker https://github.com/elastic/elasticsearch/pull/17133","performed_via_github_app":null}]