[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/351499072","html_url":"https://github.com/elastic/elasticsearch/issues/27796#issuecomment-351499072","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27796","id":351499072,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MTQ5OTA3Mg==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2017-12-13T19:37:57Z","updated_at":"2017-12-13T19:37:57Z","author_association":"CONTRIBUTOR","body":"This was one of the items in the Elasticsearch roadmap.\r\n\r\nBut looks like we may not need an extra limit, as fuzzy queries and wild card queries use one of the [multi term query rewrite methods ](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-term-rewrite.html#query-dsl-multi-term-rewrite) that already safeguard against too much expansion. For example:\r\n\r\n* `constant_score` - tries disjunction of boolean clauses; and if there are too many of them builds a bitset of matching docs\r\n* `scoring_boolean`  - will hit too many clauses failure if it exceeds the boolean query limit (1024), and produce the following error:\r\n```\r\n\"error\":{  \r\n   \"root_cause\":[  \r\n      {  \r\n         \"type\":\"too_many_clauses\",\r\n         \"reason\":\"maxClauseCount is set to 1024\"\r\n      }\r\n   ]\r\n```\r\n* `constant_score_boolean`  -  similar to `scoring_boolean` will hit too many clauses failure if it exceeds the boolean query limit (1024).\r\n* `top_terms_N` - the `N` controls the size of the top scoring terms to use.\r\n* `top_terms_boost_N` -  the `N` controls the size of the top scoring terms to use.\r\n* `top_terms_blended_freqs_N` -  the `N` controls the size of the top scoring terms to use.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352029508","html_url":"https://github.com/elastic/elasticsearch/issues/27796#issuecomment-352029508","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27796","id":352029508,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjAyOTUwOA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2017-12-15T15:12:03Z","updated_at":"2017-12-15T15:12:03Z","author_association":"CONTRIBUTOR","body":"As discussed in the FixitFriday, we still will have a limit on the number of expanded terms equal to 1024, as all other Lucene checks are done later.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352271486","html_url":"https://github.com/elastic/elasticsearch/issues/27796#issuecomment-352271486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27796","id":352271486,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjI3MTQ4Ng==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2017-12-17T17:28:59Z","updated_at":"2017-12-17T17:28:59Z","author_association":"CONTRIBUTOR","body":"After further investigation, looks like this feature is  **NOT necessary**, as there are already safeguards on the Lucene level.\r\n\r\nFor example, in the case of the wildquery, the algorithm is following:\r\n1. Collect all the terms for the field\r\n2. Compute the intersection of the WildQuery automaton with the field terms \r\n3. Rewrite query:\r\n    * `constant_score` -> MultiTermQueryConstantScoreWrapper attempts to rewrite as a boolean query, but changes to the bitset of docs, if too many terms\r\n    * `scoring_boolean` -> ScoringRewrite:rewrite  before adding boolean clauses tries to collect terms in TermCollector; fails as soon as No. of terms exceeds 1024\r\n    * `constant_score_boolean` -> ScoringRewrite, similar to scoring_boolean\r\n    * `top_terms_N` and other top terms methods -> TopTermsRewrite uses minimum between `N` and 1024 for rewriting the query\r\n\r\n","performed_via_github_app":null}]