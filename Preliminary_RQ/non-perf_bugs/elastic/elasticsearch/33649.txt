{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33649","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33649/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33649/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33649/events","html_url":"https://github.com/elastic/elasticsearch/issues/33649","id":359640785,"node_id":"MDU6SXNzdWUzNTk2NDA3ODU=","number":33649,"title":"Monitoring: Transform script in elasticsearch_cluster_status.json results in ArrayOutOfBoundsException","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-09-12T20:30:58Z","updated_at":"2019-10-06T21:17:17Z","closed_at":"2019-10-06T21:17:17Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"With monitoring enabled, when a cluster becomes yellow/red there is the possibility of the transform script in the monitoring watch elasticsearch_cluster_status.json resulting in an ArrayOutOfBoundsException.  Two indices are searched against .monitoring-es-* and .monitoring-alerts-6 for information required to use watcher to send an appropriate email related to changes in cluster status.  The condition script ensures that the searches contain results prior to being accessed, but the transform script does not.  Guards should be added to ensure the exception does not occur in the transform script.  However, this is not necessarily simple because without information from the es index it's not possible to know whether the cluster is red/yellow.\r\n\r\nThis is being seen in production for a number of customers.  But it should be noted that if a cluster is yellow/red this is only a symptom and not the actual problem the cluster may be experiencing.","closed_by":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}