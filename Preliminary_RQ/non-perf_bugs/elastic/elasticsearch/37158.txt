{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37158","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37158/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37158/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37158/events","html_url":"https://github.com/elastic/elasticsearch/issues/37158","id":396089850,"node_id":"MDU6SXNzdWUzOTYwODk4NTA=","number":37158,"title":"[CI] NoMasterNodeIT.testNoMasterActions failures","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-01-04T22:33:11Z","updated_at":"2019-02-07T08:08:39Z","closed_at":"2019-01-11T10:54:01Z","author_association":"MEMBER","active_lock_reason":null,"body":"I have seen this both in a PR and several jenkins runs today:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+pull-request-1/3643/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/1065/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=java11,ES_RUNTIME_JAVA=java8,nodes=virtual&&linux/156/console\r\n\r\nIt doesn't reproduce for me locally so far, but here is a reproduce output:\r\n```\r\n./gradlew :server:integTest -Dtests.seed=9B242048CDCF445E -Dtests.class=org.elasticsearch.cluster.NoMasterNodeIT -Dtests.method=\"testNoMasterActions\" -Dtests.security.manager=true -Dtests.locale=lt-LT -Dtests.timezone=AST -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n\r\nI see several warnings in the log like this:\r\n```\r\n22:05:36   1> [2019-01-04T12:05:04,321][WARN ][o.e.c.s.MasterService    ] [node_t0] failing [elected-as-master ([1] nodes joined)[{node_t1}{GqYC_Nu8Q0mFMbrIg85I0w}{eN9G1ElBRh-21DUgCFaTHw}{127.0.0.1}{127.0.0.1:43436} elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_]]: failed to commit cluster state version [1]\r\n22:05:36   1> org.elasticsearch.cluster.coordination.FailedToCommitClusterStateException: node stepped down as leader during publication\r\n22:05:37   1> \tat org.elasticsearch.cluster.coordination.Coordinator.publish(Coordinator.java:862) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.MasterService.publish(MasterService.java:253) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:239) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:143) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:660) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207) [main/:?]\r\n22:05:37   1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_192]\r\n22:05:37   1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_192]\r\n22:05:37   1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_192]\r\n```\r\n\r\nFollowed by the following:\r\n```\r\n22:05:37   1> [2019-01-04T12:05:05,579][ERROR][o.e.c.c.Coordinator      ] [node_t0] unexpected failure during [node-left]\r\n22:05:37   1> org.elasticsearch.cluster.coordination.FailedToCommitClusterStateException: publication failed\r\n22:05:37   1> \tat org.elasticsearch.cluster.coordination.Coordinator$CoordinatorPublication$2.onFailure(Coordinator.java:1153) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.ListenableFuture$1.run(ListenableFuture.java:95) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:140) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.ListenableFuture.notifyListener(ListenableFuture.java:86) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.ListenableFuture.addListener(ListenableFuture.java:54) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.coordination.Coordinator$CoordinatorPublication.onCompletion(Coordinator.java:1107) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.coordination.Publication.onPossibleCompletion(Publication.java:116) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.coordination.Publication.onPossibleCommitFailure(Publication.java:164) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.coordination.Publication.start(Publication.java:70) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.coordination.Coordinator.publish(Coordinator.java:912) ~[main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.MasterService.publish(MasterService.java:253) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:239) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:143) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:660) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244) [main/:?]\r\n22:05:37   1> \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207) [main/:?]\r\n22:05:37   1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_192]\r\n22:05:37   1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_192]\r\n22:05:37   1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_192]\r\n```","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}