[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/173664539","html_url":"https://github.com/elastic/elasticsearch/issues/16139#issuecomment-173664539","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16139","id":173664539,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzY2NDUzOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-21T18:26:15Z","updated_at":"2016-01-21T18:26:15Z","author_association":"CONTRIBUTOR","body":"Hi @sombut \n\nThanks for the report - I've spent a few hours playing with the example and so far have been unable to get the shard failures that you're seeing.  I've tried with a cluster of two and three nodes.  What does your cluster look like?\n\nAre you sure that it is ES 2.1.1?  I've seen this happen on 2.1.0, but that was supposed to be fixed in 2.1.1.  (There are a number of other mapping fixes coming in 2.2 and 2.3 as well.)\n\nSomething else I've seen on 2.1.1 while running your recreation (which I can't replicate on 2.2.0) is that the bulk request will sometimes hang indefinitely.\n\nBtw, you can make your dynamic mappings better to avoid this issue by deleting the `match_mapping_type` parameter from the template for `message_field`, and you can delete all of the templates for double/float/integer/date/etc - those fields default to use doc_values already.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/173664728","html_url":"https://github.com/elastic/elasticsearch/issues/16139#issuecomment-173664728","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16139","id":173664728,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzY2NDcyOA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-21T18:27:00Z","updated_at":"2016-01-21T18:27:00Z","author_association":"CONTRIBUTOR","body":"Recreation here:\n\n```\nDELETE *\nDELETE _template/*\nPUT _template/logstash\n{\n  \"order\": 0,\n  \"template\": \"logstash-*\",\n  \"settings\": {\n    \"index\": {\n      \"mapping\": {\n        \"ignore_malformed\": \"true\"\n      },\n      \"refresh_interval\": \"30s\"\n    }\n  },\n  \"mappings\": {\n    \"_default_\": {\n      \"dynamic_templates\": [\n        {\n          \"message_field\": {\n            \"mapping\": {\n              \"fielddata\": {\n                \"format\": \"disabled\"\n              },\n              \"index\": \"analyzed\",\n              \"omit_norms\": true,\n              \"type\": \"string\"\n            },\n            \"match_mapping_type\": \"string\",\n            \"match\": \"message\"\n          }\n        },\n        {\n          \"string_fields\": {\n            \"mapping\": {\n              \"fielddata\": {\n                \"format\": \"disabled\"\n              },\n              \"index\": \"analyzed\",\n              \"omit_norms\": true,\n              \"type\": \"string\",\n              \"fields\": {\n                \"raw\": {\n                  \"ignore_above\": 256,\n                  \"index\": \"not_analyzed\",\n                  \"type\": \"string\",\n                  \"doc_values\": true\n                }\n              }\n            },\n            \"match_mapping_type\": \"string\",\n            \"match\": \"*\"\n          }\n        },\n        {\n          \"float_fields\": {\n            \"mapping\": {\n              \"type\": \"float\",\n              \"doc_values\": true\n            },\n            \"match_mapping_type\": \"float\",\n            \"match\": \"*\"\n          }\n        },\n        {\n          \"double_fields\": {\n            \"mapping\": {\n              \"type\": \"double\",\n              \"doc_values\": true\n            },\n            \"match_mapping_type\": \"double\",\n            \"match\": \"*\"\n          }\n        },\n        {\n          \"byte_fields\": {\n            \"mapping\": {\n              \"type\": \"byte\",\n              \"doc_values\": true\n            },\n            \"match_mapping_type\": \"byte\",\n            \"match\": \"*\"\n          }\n        },\n        {\n          \"short_fields\": {\n            \"mapping\": {\n              \"type\": \"short\",\n              \"doc_values\": true\n            },\n            \"match_mapping_type\": \"short\",\n            \"match\": \"*\"\n          }\n        },\n        {\n          \"integer_fields\": {\n            \"mapping\": {\n              \"type\": \"integer\",\n              \"doc_values\": true\n            },\n            \"match_mapping_type\": \"integer\",\n            \"match\": \"*\"\n          }\n        },\n        {\n          \"long_fields\": {\n            \"mapping\": {\n              \"type\": \"long\",\n              \"doc_values\": true\n            },\n            \"match_mapping_type\": \"long\",\n            \"match\": \"*\"\n          }\n        },\n        {\n          \"date_fields\": {\n            \"mapping\": {\n              \"type\": \"date\",\n              \"doc_values\": true\n            },\n            \"match_mapping_type\": \"date\",\n            \"match\": \"*\"\n          }\n        },\n        {\n          \"geo_point_fields\": {\n            \"mapping\": {\n              \"type\": \"geo_point\",\n              \"doc_values\": true\n            },\n            \"match_mapping_type\": \"geo_point\",\n            \"match\": \"*\"\n          }\n        }\n      ],\n      \"_all\": {\n        \"omit_norms\": true,\n        \"enabled\": true\n      },\n      \"properties\": {\n        \"@timestamp\": {\n          \"type\": \"date\",\n          \"doc_values\": true\n        },\n        \"geoip\": {\n          \"dynamic\": true,\n          \"type\": \"object\",\n          \"properties\": {\n            \"ip\": {\n              \"type\": \"ip\",\n              \"doc_values\": true\n            },\n            \"latitude\": {\n              \"type\": \"float\",\n              \"doc_values\": true\n            },\n            \"location\": {\n              \"type\": \"geo_point\",\n              \"doc_values\": true\n            },\n            \"longitude\": {\n              \"type\": \"float\",\n              \"doc_values\": true\n            }\n          }\n        },\n        \"@version\": {\n          \"index\": \"not_analyzed\",\n          \"type\": \"string\",\n          \"doc_values\": true\n        }\n      }\n    },\n    \"tornado_iis_advanced\": {\n      \"properties\": {\n        \"args\": {\n          \"properties\": {\n            \"version\": {\n              \"norms\": {\n                \"enabled\": false\n              },\n              \"type\": \"string\",\n              \"fields\": {\n                \"raw\": {\n                  \"ignore_above\": 256,\n                  \"index\": \"not_analyzed\",\n                  \"type\": \"string\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"aliases\": {}\n}\n\nDELETE *\nPOST /_bulk\n{\"index\":{\"_index\":\"logstash-2016.02.01\",\"_type\":\"tweet\"}}\n{\"message\":0,\"test\":20,\"status\":0}\n{\"index\":{\"_index\":\"logstash-2016.02.01\",\"_type\":\"tweet\"}}\n{\"message\":\"value1\",\"test\":\"test\",\"status\":\"0\"}\n{\"index\":{\"_index\":\"logstash-2016.02.01\",\"_type\":\"twoot\"}}\n{\"message\":\"value1\",\"test\":\"test\",\"status\":\"0\"}\n{\"index\":{\"_index\":\"logstash-2016.02.01\",\"_type\":\"twaat\"}}\n{\"message\":\"value1\",\"test\":\"test\",\"status\":\"0\"}\n\nGET _mapping/field/message,status\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/173787876","html_url":"https://github.com/elastic/elasticsearch/issues/16139#issuecomment-173787876","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16139","id":173787876,"node_id":"MDEyOklzc3VlQ29tbWVudDE3Mzc4Nzg3Ng==","user":{"login":"sombut","id":11056237,"node_id":"MDQ6VXNlcjExMDU2MjM3","avatar_url":"https://avatars0.githubusercontent.com/u/11056237?v=4","gravatar_id":"","url":"https://api.github.com/users/sombut","html_url":"https://github.com/sombut","followers_url":"https://api.github.com/users/sombut/followers","following_url":"https://api.github.com/users/sombut/following{/other_user}","gists_url":"https://api.github.com/users/sombut/gists{/gist_id}","starred_url":"https://api.github.com/users/sombut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sombut/subscriptions","organizations_url":"https://api.github.com/users/sombut/orgs","repos_url":"https://api.github.com/users/sombut/repos","events_url":"https://api.github.com/users/sombut/events{/privacy}","received_events_url":"https://api.github.com/users/sombut/received_events","type":"User","site_admin":false},"created_at":"2016-01-22T02:54:46Z","updated_at":"2016-01-22T05:06:15Z","author_association":"NONE","body":"Hi @clintongormley \n\nThanks for your help.\n\nMy cluster has 1 master and 2 data nodes. I'm sure it is the 2.1.1 version. You can see the full log since start the elasticsearch until getting this error.\n[compass-dev-esmn-01.zip](https://github.com/elastic/elasticsearch/files/100208/compass-dev-esmn-01.zip)\nYou recreation steps is right and I can recreate the issue using yours too.\n\nBelow is my new template after match_mapping_type removed. It really helps avoid this issue but only when the conflicted field name is the `message`.\n\n```\nPUT _template/logstash\n{\n  \"order\": 0,\n  \"template\": \"logstash-*\",\n  \"settings\": {\n    \"index\": {\n      \"mapping\": {\n        \"ignore_malformed\": \"true\"\n      },\n      \"refresh_interval\": \"30s\"\n    }\n  },\n  \"mappings\": {\n    \"_default_\": {\n      \"dynamic_templates\": [\n        {\n          \"message_field\": {\n            \"mapping\": {\n              \"fielddata\": {\n                \"format\": \"disabled\"\n              },\n              \"index\": \"analyzed\",\n              \"omit_norms\": true,\n              \"type\": \"string\"\n            },\n            \"match\": \"message\"\n          }\n        }\n      ],\n      \"_all\": {\n        \"omit_norms\": true,\n        \"enabled\": true\n      },\n      \"properties\": {\n        \"@timestamp\": {\n          \"type\": \"date\",\n          \"doc_values\": true\n        },\n        \"geoip\": {\n          \"dynamic\": true,\n          \"type\": \"object\",\n          \"properties\": {\n            \"ip\": {\n              \"type\": \"ip\",\n              \"doc_values\": true\n            },\n            \"latitude\": {\n              \"type\": \"float\",\n              \"doc_values\": true\n            },\n            \"location\": {\n              \"type\": \"geo_point\",\n              \"doc_values\": true\n            },\n            \"longitude\": {\n              \"type\": \"float\",\n              \"doc_values\": true\n            }\n          }\n        },\n        \"@version\": {\n          \"index\": \"not_analyzed\",\n          \"type\": \"string\",\n          \"doc_values\": true\n        }\n      }\n    },\n    \"tornado_iis_advanced\": {\n      \"properties\": {\n        \"args\": {\n          \"properties\": {\n            \"version\": {\n              \"norms\": {\n                \"enabled\": false\n              },\n              \"type\": \"string\",\n              \"fields\": {\n                \"raw\": {\n                  \"ignore_above\": 256,\n                  \"index\": \"not_analyzed\",\n                  \"type\": \"string\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"aliases\": {}\n}\n```\n\nBut when I change the field `message` to something else for example `size`, the problem happens again.\n\n```\n{\"index\":{\"_index\":\"logstash-2016.02.01\",\"_type\":\"tweet\"}}\n{\"size\":0,\"test\":20,\"status\":0}\n{\"index\":{\"_index\":\"logstash-2016.02.01\",\"_type\":\"tweet\"}}\n{\"size\":\"value1\",\"test\":\"test\",\"status\":\"0\"}\n{\"index\":{\"_index\":\"logstash-2016.02.01\",\"_type\":\"twoot\"}}\n{\"size\":\"value1\",\"test\":\"test\",\"status\":\"0\"}\n{\"index\":{\"_index\":\"logstash-2016.02.01\",\"_type\":\"twaat\"}}\n{\"size\":\"value1\",\"test\":\"test\",\"status\":\"0\"}\n```\n\n![image](https://cloud.githubusercontent.com/assets/11056237/12502801/c62eede8-c0ff-11e5-9694-cceedadb5074.png)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/173902616","html_url":"https://github.com/elastic/elasticsearch/issues/16139#issuecomment-173902616","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16139","id":173902616,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzkwMjYxNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-22T12:19:01Z","updated_at":"2016-01-22T12:19:01Z","author_association":"CONTRIBUTOR","body":"Thanks @sombut - with one master and two data nodes I'm able to recreate this issue in 2.1.1 and in 2.1.2..  The good news is that I can't recreate it on 2.2.0 (which we are close to releasing).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/174866010","html_url":"https://github.com/elastic/elasticsearch/issues/16139#issuecomment-174866010","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16139","id":174866010,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NDg2NjAxMA==","user":{"login":"sombut","id":11056237,"node_id":"MDQ6VXNlcjExMDU2MjM3","avatar_url":"https://avatars0.githubusercontent.com/u/11056237?v=4","gravatar_id":"","url":"https://api.github.com/users/sombut","html_url":"https://github.com/sombut","followers_url":"https://api.github.com/users/sombut/followers","following_url":"https://api.github.com/users/sombut/following{/other_user}","gists_url":"https://api.github.com/users/sombut/gists{/gist_id}","starred_url":"https://api.github.com/users/sombut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sombut/subscriptions","organizations_url":"https://api.github.com/users/sombut/orgs","repos_url":"https://api.github.com/users/sombut/repos","events_url":"https://api.github.com/users/sombut/events{/privacy}","received_events_url":"https://api.github.com/users/sombut/received_events","type":"User","site_admin":false},"created_at":"2016-01-26T07:09:39Z","updated_at":"2016-01-26T07:09:39Z","author_association":"NONE","body":"Thank you @clintongormley for the good news. I'll wait for the 2.2.0 release. Do you know when will it be release please?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/175109802","html_url":"https://github.com/elastic/elasticsearch/issues/16139#issuecomment-175109802","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16139","id":175109802,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NTEwOTgwMg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-01-26T16:48:01Z","updated_at":"2016-01-26T16:48:01Z","author_association":"CONTRIBUTOR","body":"This seems to be fixed by #15142.\n\n> I'll wait for the 2.2.0 release. Do you know when will it be release please?\n\nIt will be out \"soon\" after we fix the last remaining issues: https://github.com/elastic/elasticsearch/labels/v2.2.0\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/175456062","html_url":"https://github.com/elastic/elasticsearch/issues/16139#issuecomment-175456062","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16139","id":175456062,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NTQ1NjA2Mg==","user":{"login":"sombut","id":11056237,"node_id":"MDQ6VXNlcjExMDU2MjM3","avatar_url":"https://avatars0.githubusercontent.com/u/11056237?v=4","gravatar_id":"","url":"https://api.github.com/users/sombut","html_url":"https://github.com/sombut","followers_url":"https://api.github.com/users/sombut/followers","following_url":"https://api.github.com/users/sombut/following{/other_user}","gists_url":"https://api.github.com/users/sombut/gists{/gist_id}","starred_url":"https://api.github.com/users/sombut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sombut/subscriptions","organizations_url":"https://api.github.com/users/sombut/orgs","repos_url":"https://api.github.com/users/sombut/repos","events_url":"https://api.github.com/users/sombut/events{/privacy}","received_events_url":"https://api.github.com/users/sombut/received_events","type":"User","site_admin":false},"created_at":"2016-01-27T07:13:19Z","updated_at":"2016-01-27T07:13:19Z","author_association":"NONE","body":"Thank you @jpountz \n","performed_via_github_app":null}]