[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252418563","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-252418563","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":252418563,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjQxODU2Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T11:03:06Z","updated_at":"2016-10-08T11:03:06Z","author_association":"CONTRIBUTOR","body":"@polyfractal could you take a look at this please?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254327234","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-254327234","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":254327234,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDMyNzIzNA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2016-10-17T20:40:55Z","updated_at":"2016-10-17T20:40:55Z","author_association":"MEMBER","body":"Hey @l8liu, sorry for the delay in responding.  We've been chatting internally about this a bit.  I'll start with the easy one:\n\n> Also, could you please consider add a 'Moving Standard deviation' in the future? \n\nDefinitely!  We've talked about this a few times and I know I'd personally like one.  We're currently trying to determine the best way to add it (dedicated agg, or rename `moving_average` to `moving_function` and implement std dev as a \"function, etc).  I think it'll end up as a dedicated `moving_stddev` agg since that's the simplest.\n\n> I expect the moving average equals the average of the current day and previous 2 days, but the results are the average of previous 3 days, and not including the current day.\n\nSo we've been chatting about why we did this, and I think the behavior is \"correct\" because we are using a \"left\" moving average commonly used in financial and other non-signal use-cases (e.g. the value of today is the result of previous values).  For example, financial moving averages use closing prices, and today's value is intrinsically incalculable because today hasn't \"closed\" yet.  Which means that you can only calculate moving averages on previous data points, not today's. This mirrors wiki's definition for a financial SMA:\n\n> In financial applications a simple moving average (SMA) is the unweighted mean of the previous n data\n> For a number of applications, it is advantageous to avoid the shifting induced by using only 'past' data. Hence a central moving average can be computed, using data equally spaced on either side of the point in the series where the mean is calculated\n\nAlso, if today's values were included, the value of today's movavg would change each time you execute the aggregation since the bucket continues \"filling\".\n\nThis is quite a bit different from more science/engineering/signal processing use-cases where you take \"centered\" moving averages (the movavg of a point is the average of `n/2` on each side) in which case it makes sense to include the bucket in it's own movavg.  But since we only support one orientation at the moment, I think the current behavior is \"correct\".\n\nLots of \"scare quotes\" above, because I agree it's more a matter of perspective and how you want to use the moving average.  We still haven't come to a final decision, but I think so far we've at least agreed the current implementation isn't _wrong_ per se. :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254523981","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-254523981","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":254523981,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDUyMzk4MQ==","user":{"login":"l8liu","id":7715960,"node_id":"MDQ6VXNlcjc3MTU5NjA=","avatar_url":"https://avatars0.githubusercontent.com/u/7715960?v=4","gravatar_id":"","url":"https://api.github.com/users/l8liu","html_url":"https://github.com/l8liu","followers_url":"https://api.github.com/users/l8liu/followers","following_url":"https://api.github.com/users/l8liu/following{/other_user}","gists_url":"https://api.github.com/users/l8liu/gists{/gist_id}","starred_url":"https://api.github.com/users/l8liu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/l8liu/subscriptions","organizations_url":"https://api.github.com/users/l8liu/orgs","repos_url":"https://api.github.com/users/l8liu/repos","events_url":"https://api.github.com/users/l8liu/events{/privacy}","received_events_url":"https://api.github.com/users/l8liu/received_events","type":"User","site_admin":false},"created_at":"2016-10-18T14:25:47Z","updated_at":"2016-10-18T14:25:47Z","author_association":"NONE","body":"@polyfractal Thank you very much for your detail explanation and I agree with your consideration of the current moving average implementation.  In the future, are you possible to add a shift parameter so users can have options to choose where they want to output the movavg?  We do want it align to the current day but not the previous day when we do the statistical control.\n\nAlso it's glad to know that you will have the moving standard deviation feature in future. Thank you very much for the great job and we are expecting your new work!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255382626","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-255382626","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":255382626,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTM4MjYyNg==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2016-10-21T13:52:15Z","updated_at":"2016-10-21T13:52:15Z","author_association":"MEMBER","body":"I think a shift parameter could be useful, although I'm curious about it's scope.  Would it only allow shifting one day forward to align the average, or should we allow arbitrary shifting (e.g. 10 buckets)?  From a code perspective, movavg is already rather complicated so we'd like to not introduce too much additional complexity.\n\nPerhaps we could add a dedicated shift pipeline agg which sits \"before\" the movavg?  Not sure, haven't thought it through very carefully :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/304396505","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-304396505","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":304396505,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDM5NjUwNQ==","user":{"login":"mpaduada","id":448739,"node_id":"MDQ6VXNlcjQ0ODczOQ==","avatar_url":"https://avatars1.githubusercontent.com/u/448739?v=4","gravatar_id":"","url":"https://api.github.com/users/mpaduada","html_url":"https://github.com/mpaduada","followers_url":"https://api.github.com/users/mpaduada/followers","following_url":"https://api.github.com/users/mpaduada/following{/other_user}","gists_url":"https://api.github.com/users/mpaduada/gists{/gist_id}","starred_url":"https://api.github.com/users/mpaduada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpaduada/subscriptions","organizations_url":"https://api.github.com/users/mpaduada/orgs","repos_url":"https://api.github.com/users/mpaduada/repos","events_url":"https://api.github.com/users/mpaduada/events{/privacy}","received_events_url":"https://api.github.com/users/mpaduada/received_events","type":"User","site_admin":false},"created_at":"2017-05-26T21:57:33Z","updated_at":"2017-05-26T21:57:33Z","author_association":"NONE","body":"+1 on adding a parameter to the Moving Average Aggregation to allow arbitrary shifting. A lagged moving average can be quite useful, such as when dealing with seasonalities.\r\n\r\nFor what it's worth, there's an ugly workaround using one or two Moving Average Aggregations and a Bucket Script Aggregation. For what @l8liu was trying to do, use a Bucket Script Aggregation to add the current bucket's value to the moving average result. And to calculate a moving average with a window of 5 and a lag of 3, use:\r\n```\r\n{\r\n  \"aggs\": {\r\n    ...\r\n      },\r\n      \"aggs\": {\r\n        \"my_metric\" :{\r\n          ...\r\n        },\r\n        \"ma_window_plus_shift\": {\r\n          \"moving_avg\": {\r\n            \"buckets_path\": \"my_metric\",\r\n            \"window\": 8\r\n          }\r\n        },\r\n        \"ma_shift\": {\r\n          \"moving_avg\": {\r\n            \"buckets_path\": \"my_metric\",\r\n            \"window\": 3\r\n          }\r\n        },\r\n        \"lagged_ma\" : {\r\n          \"bucket_script\": {\r\n            \"buckets_path\": {\r\n              \"var1\" : \"ma_window_plus_shift\",\r\n              \"var2\" : \"ma_shift\"\r\n            },\r\n            \"script\": \"(params.var1 - params.var2*3/8)*8/5\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nI would rather have a shift parameter than use three pipeline aggregations to get one result.\r\n\r\nIn any case, I think it's worth adding a note in the documentation indicating the moving average assumes a lag of 1 bucket.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373756666","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-373756666","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":373756666,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mzc1NjY2Ng==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T15:50:28Z","updated_at":"2018-03-16T15:50:28Z","author_association":"CONTRIBUTOR","body":"Revisiting - looks like added docs needed and/or a new `shift` param.\r\n\r\ncc @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393886811","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-393886811","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":393886811,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Mzg4NjgxMQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-06-01T13:51:04Z","updated_at":"2018-06-01T13:51:04Z","author_association":"MEMBER","body":"@l8liu Heya!  Sorry for the long radio silence, but I have some news.  We recently implemented a [Moving Function pipeline agg](https://www.elastic.co/guide/en/elasticsearch/reference/6.x/search-aggregations-pipeline-movfn-aggregation.html), which is going to replace the MovAvg agg eventually. \r\n\r\nI think the behavior you want should now be doable, since we're opening the calculation up to general scripting.  The script is given the array of values from the window, so you should be able to pick/choose the values you want to pass into the `MovingFunctions.unweightedAvg()` function.\r\n\r\nWe also implemented a stdDev function, so that request should be doable now too.\r\n\r\nDo you think this will work for you?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393895778","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-393895778","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":393895778,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Mzg5NTc3OA==","user":{"login":"l8liu","id":7715960,"node_id":"MDQ6VXNlcjc3MTU5NjA=","avatar_url":"https://avatars0.githubusercontent.com/u/7715960?v=4","gravatar_id":"","url":"https://api.github.com/users/l8liu","html_url":"https://github.com/l8liu","followers_url":"https://api.github.com/users/l8liu/followers","following_url":"https://api.github.com/users/l8liu/following{/other_user}","gists_url":"https://api.github.com/users/l8liu/gists{/gist_id}","starred_url":"https://api.github.com/users/l8liu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/l8liu/subscriptions","organizations_url":"https://api.github.com/users/l8liu/orgs","repos_url":"https://api.github.com/users/l8liu/repos","events_url":"https://api.github.com/users/l8liu/events{/privacy}","received_events_url":"https://api.github.com/users/l8liu/received_events","type":"User","site_admin":false},"created_at":"2018-06-01T14:21:29Z","updated_at":"2018-06-01T14:21:29Z","author_association":"NONE","body":"Hi Zachary,\n\n\nThank you very much for your update,. I believe it is a great feature and will be benefit to many people and projects.\n\n\nLi\n\n\n________________________________\nFrom: Zachary Tong <notifications@github.com>\nSent: June 1, 2018 9:52 AM\nTo: elastic/elasticsearch\nCc: l8liu; Mention\nSubject: Re: [elastic/elasticsearch] Moving average shifted (#20667)\n\n\n@l8liu<https://github.com/l8liu> Heya! Sorry for the long radio silence, but I have some news. We recently implemented a Moving Function pipeline agg<https://www.elastic.co/guide/en/elasticsearch/reference/6.x/search-aggregations-pipeline-movfn-aggregation.html>, which is going to replace the MovAvg agg eventually.\n\nI think the behavior you want should now be doable, since we're opening the calculation up to general scripting. The script is given the array of values from the window, so you should be able to pick/choose the values you want to pass into the MovingFunctions.unweightedAvg() function.\n\nWe also implemented a stdDev function, so that request should be doable now too.\n\nDo you think this will work for you?\n\nâ€”\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub<https://github.com/elastic/elasticsearch/issues/20667#issuecomment-393886811>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AHW8eIXbS2-AnzlSmC0Xwjm4vb3UL3G8ks5t4UcggaJpZM4KHnDt>.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393921530","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-393921530","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":393921530,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MzkyMTUzMA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-06-01T15:45:46Z","updated_at":"2018-06-01T15:45:46Z","author_association":"MEMBER","body":"Great!  I'm going to close this issue, since it looks like MovFn will work :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/492716035","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-492716035","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":492716035,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MjcxNjAzNQ==","user":{"login":"jcornez","id":3865253,"node_id":"MDQ6VXNlcjM4NjUyNTM=","avatar_url":"https://avatars2.githubusercontent.com/u/3865253?v=4","gravatar_id":"","url":"https://api.github.com/users/jcornez","html_url":"https://github.com/jcornez","followers_url":"https://api.github.com/users/jcornez/followers","following_url":"https://api.github.com/users/jcornez/following{/other_user}","gists_url":"https://api.github.com/users/jcornez/gists{/gist_id}","starred_url":"https://api.github.com/users/jcornez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcornez/subscriptions","organizations_url":"https://api.github.com/users/jcornez/orgs","repos_url":"https://api.github.com/users/jcornez/repos","events_url":"https://api.github.com/users/jcornez/events{/privacy}","received_events_url":"https://api.github.com/users/jcornez/received_events","type":"User","site_admin":false},"created_at":"2019-05-15T15:58:59Z","updated_at":"2019-05-15T15:58:59Z","author_association":"NONE","body":"I'm not clear how the new moving_fn solves this.  The `values` array that is passed to the function still only include the *prior* values, and not the current.  So if I want a moving average of 3 to be the current and prior two, then how can this be accomplished?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/492753869","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-492753869","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":492753869,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Mjc1Mzg2OQ==","user":{"login":"jcornez","id":3865253,"node_id":"MDQ6VXNlcjM4NjUyNTM=","avatar_url":"https://avatars2.githubusercontent.com/u/3865253?v=4","gravatar_id":"","url":"https://api.github.com/users/jcornez","html_url":"https://github.com/jcornez","followers_url":"https://api.github.com/users/jcornez/followers","following_url":"https://api.github.com/users/jcornez/following{/other_user}","gists_url":"https://api.github.com/users/jcornez/gists{/gist_id}","starred_url":"https://api.github.com/users/jcornez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcornez/subscriptions","organizations_url":"https://api.github.com/users/jcornez/orgs","repos_url":"https://api.github.com/users/jcornez/repos","events_url":"https://api.github.com/users/jcornez/events{/privacy}","received_events_url":"https://api.github.com/users/jcornez/received_events","type":"User","site_admin":false},"created_at":"2019-05-15T17:44:01Z","updated_at":"2019-05-15T17:44:01Z","author_association":"NONE","body":"Same question was asked and not answered here\r\nhttps://discuss.elastic.co/t/get-current-bucket-value-in-a-moving-function-agg/174034","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/493062601","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-493062601","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":493062601,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzA2MjYwMQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-05-16T13:14:49Z","updated_at":"2019-05-16T13:14:49Z","author_association":"MEMBER","body":"On the run so I've only thought about this briefly, but I think the idea was that you request a slightly larger window, and then pick out the values you want.  So you ask for four, then use the prior three.\r\n\r\nBut thinking about it, that doesn't help because it actually shifts the values forward.  We might need to tweak the mov_fn to allow left/right/center alignment as originally proposed.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/493076843","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-493076843","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":493076843,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzA3Njg0Mw==","user":{"login":"jcornez","id":3865253,"node_id":"MDQ6VXNlcjM4NjUyNTM=","avatar_url":"https://avatars2.githubusercontent.com/u/3865253?v=4","gravatar_id":"","url":"https://api.github.com/users/jcornez","html_url":"https://github.com/jcornez","followers_url":"https://api.github.com/users/jcornez/followers","following_url":"https://api.github.com/users/jcornez/following{/other_user}","gists_url":"https://api.github.com/users/jcornez/gists{/gist_id}","starred_url":"https://api.github.com/users/jcornez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcornez/subscriptions","organizations_url":"https://api.github.com/users/jcornez/orgs","repos_url":"https://api.github.com/users/jcornez/repos","events_url":"https://api.github.com/users/jcornez/events{/privacy}","received_events_url":"https://api.github.com/users/jcornez/received_events","type":"User","site_admin":false},"created_at":"2019-05-16T13:53:16Z","updated_at":"2019-05-16T13:53:16Z","author_association":"NONE","body":"Thanks - so perhaps we can re-open this issue?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/493131135","html_url":"https://github.com/elastic/elasticsearch/issues/20667#issuecomment-493131135","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20667","id":493131135,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzEzMTEzNQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-05-16T16:06:51Z","updated_at":"2019-05-16T16:06:51Z","author_association":"MEMBER","body":"I've opened https://github.com/elastic/elasticsearch/issues/42181 to track, since we'll just want to modify the moving function agg since movavg is deprecated/removed.\r\n\r\nThanks for poking this issue and bringing it back up! :)","performed_via_github_app":null}]