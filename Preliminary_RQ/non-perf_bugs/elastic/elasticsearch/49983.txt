{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/49983","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49983/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49983/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49983/events","html_url":"https://github.com/elastic/elasticsearch/issues/49983","id":534933178,"node_id":"MDU6SXNzdWU1MzQ5MzMxNzg=","number":49983,"title":"Elasticsearch debian packaging: Pre-Depends: java8-runtime-headless missing, apt-get install fails","user":{"login":"minfrin","id":1331788,"node_id":"MDQ6VXNlcjEzMzE3ODg=","avatar_url":"https://avatars1.githubusercontent.com/u/1331788?v=4","gravatar_id":"","url":"https://api.github.com/users/minfrin","html_url":"https://github.com/minfrin","followers_url":"https://api.github.com/users/minfrin/followers","following_url":"https://api.github.com/users/minfrin/following{/other_user}","gists_url":"https://api.github.com/users/minfrin/gists{/gist_id}","starred_url":"https://api.github.com/users/minfrin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/minfrin/subscriptions","organizations_url":"https://api.github.com/users/minfrin/orgs","repos_url":"https://api.github.com/users/minfrin/repos","events_url":"https://api.github.com/users/minfrin/events{/privacy}","received_events_url":"https://api.github.com/users/minfrin/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-12-09T13:30:50Z","updated_at":"2020-11-11T21:54:56Z","closed_at":"2019-12-09T21:31:49Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.8.5\r\n\r\n**Plugins installed**: [elasticsearch-analysis-icu]\r\n\r\n**JVM version** (`java -version`): openjdk version \"11.0.4\" 2019-07-16\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux x-jm-unstable-black-els01 4.15.0-1056-aws #58-Ubuntu SMP Tue Nov 26 15:14:34 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nThe elasticsearch Debian packaging does not following the Debian packaging guidelines at\r\n\r\nhttps://www.debian.org/doc/debian-policy/ch-relationships.html#binary-dependencies-depends-recommends-suggests-enhances-pre-depends\r\n\r\nnor the Java packaging guideline at\r\n\r\nhttps://wiki.debian.org/Java#Java_and_Debian\r\n\r\nMost specifically:\r\n\r\n\"Pre-Depends are also required if the preinst script depends on the named package. It is best to avoid this situation if possible.\"\r\n\r\nand\r\n\r\n\"There are several virtual packages used in Debian for Java. These cover runtime compatibility and come in two flavours; headless (omits graphical interfaces) and normal. A dependency on javaX-runtime means that the package can work with any runtime which implements version X.\"\r\n\r\nTo fix this, the elasticsearch package must add a Pre-Depends with the virtual package for Java as follows:\r\n\r\n    Pre-Depends: java8-runtime-headless\r\n\r\nAny JDK that follows the Debian packaging guidelines will then work.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Deploy elasticsearch debian package to any apt repository.\r\n 2. Attempt to install elasticsearch using apt.\r\n 3. apt fails as follows, and apt is broken from this point on until elasticsearch is manually removed:\r\n\r\n    Errors were encountered while processing:\r\n     /tmp/apt-dpkg-install-EqsMZQ/21-elasticsearch_6.8.5_all.deb\r\n    E: Sub-process /usr/bin/dpkg returned an error code (1)\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}