{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/47473","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47473/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47473/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47473/events","html_url":"https://github.com/elastic/elasticsearch/issues/47473","id":501711927,"node_id":"MDU6SXNzdWU1MDE3MTE5Mjc=","number":47473,"title":"BREAKING CHANGE - Range Query by Date Year returns no results","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"assignees":[{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false}],"milestone":null,"comments":23,"created_at":"2019-10-02T20:34:25Z","updated_at":"2019-12-03T14:14:48Z","closed_at":"2019-10-10T16:05:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.4.0\r\n\r\n**Plugins installed**: [\"mapper-size\"]\r\n\r\n**JVM version** (`java -version`): using official docker image.\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):using official docker image.\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nDate range queries that were working in 5.x latest are no longer when we upgraded to Elastic 7.x\r\n \r\n# Here are the exact scripts needed to create the sample for 5.x\r\n```\r\nPUT /test\r\n{\r\n    \"mappings\" : {\r\n        \"doc\": {\r\n          \"properties\" : {\r\n              \"mydate\" : { \"type\" : \"date\" }\r\n          }\r\n        }\r\n    }\r\n}\r\n\r\nPOST /test/doc/\r\n{\r\n  \"mydate\": \"2016-07-23T00:00:00\"\r\n}\r\n\r\nGET /test/_search\r\n\r\nPOST /test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"bool\": {\r\n            \"must\": [\r\n              {\r\n                \"range\": {\r\n                  \"mydate\": {\r\n                    \"gte\": \"2015\",\r\n                    \"lte\": \"2017\"\r\n                  }\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n\r\n# This seems to be a bug as well. specifying any value in GTE returns the document.\r\nPOST /test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"bool\": {\r\n            \"must\": [\r\n              {\r\n                \"range\": {\r\n                  \"mydate\": {\r\n                    \"gte\": \"201555\",\r\n                    \"lte\": \"2019\"\r\n                  }\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n# Here are the exact scripts needed to create the sample for 7.x\r\n\r\n```\r\nPUT /test\r\n{\r\n    \"mappings\" : {\r\n        \"properties\" : {\r\n            \"mydate\" : { \"type\" : \"date\" }\r\n        }\r\n    }\r\n}\r\n\r\nPOST /test/_doc/\r\n{\r\n  \"mydate\": \"2016-07-23T00:00:00\"\r\n}\r\n\r\nGET /test/_search\r\n\r\nPOST /test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"bool\": {\r\n            \"must\": [\r\n              {\r\n                \"range\": {\r\n                  \"mydate\": {\r\n                    \"gte\": \"2015\",\r\n                    \"lte\": \"2017\"\r\n                  }\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThe query returns no results on 7.x but returns results on 5.x. Also as shown in the query example above, it seems like you can put any numeric value in 5.x on the `gte` query and it will return results.\r\n\r\nChanging the Elasticsearch 7.x query to include the full date format for `lte` returns results (along with invalid `gte` values)\r\n\r\n```\r\nPOST /test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"bool\": {\r\n            \"must\": [\r\n              {\r\n                \"range\": {\r\n                  \"mydate\": {\r\n                    \"gte\": \"2015\",\r\n                    \"lte\": \"2017-01-01\"\r\n                  }\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\nor\r\n```\r\nPOST /test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"bool\": {\r\n            \"must\": [\r\n              {\r\n                \"range\": {\r\n                  \"mydate\": {\r\n                    \"gte\": \"2015-01-01\",\r\n                    \"lte\": \"2017-01-01\"\r\n                  }\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n``` \r\n\r\nor \r\n```\r\nPOST /test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"bool\": {\r\n            \"must\": [\r\n              {\r\n                \"range\": {\r\n                  \"mydate\": {\r\n                    \"gte\": \"2015555\",\r\n                    \"lte\": \"2017-01-01\"\r\n                  }\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nI started digging into the formats and all breaking changes and all looks ok...  Interesting enough I noticed the following docs changed a bit and no longer talk as much about date range queries (between 6.x and 7.x\r\n- https://www.elastic.co/guide/en/elasticsearch/reference/6.0/query-dsl-range-query.html\r\n- https://www.elastic.co/guide/en/elasticsearch/reference/7.0/query-dsl-range-query.html","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}