{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9059","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9059/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9059/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9059/events","html_url":"https://github.com/elastic/elasticsearch/issues/9059","id":52818337,"node_id":"MDU6SXNzdWU1MjgxODMzNw==","number":9059,"title":"Input validation","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"labels":[{"id":152517143,"node_id":"MDU6TGFiZWwxNTI1MTcxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/REST%20API","name":":Core/Infra/REST API","color":"0e8a16","default":false,"description":"REST infrastructure and utilities"},{"id":33660,"node_id":"MDU6TGFiZWwzMzY2MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebreaking","name":">breaking","color":"d93f0b","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"assignees":[{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false}],"milestone":null,"comments":11,"created_at":"2014-12-24T13:12:02Z","updated_at":"2019-08-01T23:08:38Z","closed_at":"2018-03-13T09:38:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In #6736 I started trying to define specs for valid IDs, index names, field names etc, to avoid problems such as conflicts created by having an ID called `_mapping`.\n\nI think this is the wrong approach - a significant number of users will find that they have used identifiers which are no longer illegal.  Instead, we should identify where conflicts are possible and implement escaping to allow the unambiguous avoidance of conflict.\n\nPossible conflicts can arise in:\n- directory or file names (eg index \"C:/\")\n- URL paths (eg an ID called `_mapping` or `_create`)\n- query string (eg a routing value containing a comma)\n- field paths (eg a field containing a `.`)\n- scripting (eg a fieldname called `_id`)\n\nWe should provide a simple consistent escaping mechanism with minimal restrictions on allowable characters.\n## Directory or file names\n\nToday we use the actual index name to create a directory on the filesystem.  Instead, the original index name should be stored in the index metadata, and the directory name should be escaped as printable ASCII only (eg percent encoding?).\n\nThere are more restrictions that need to be applied to filesystem names, most of which are already enforced today:\n- must be lowercase\n- must NOT start with an underscore, a `+` or a `-`\n- index names starting with '.' are reserved\n- . and .. are forbidden, though they can occur in the name\n-  `\\`, `/`, `*`, `?`, `\"`, `<`, `>`, `|`, ` `,`,` are forbidden\n- illegal windows filenames are forbidden: CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, and LPT9. Also avoid these names followed immediately by an extension; for example, NUL.txt is not recommended.\n\nThe same should apply to snapshot names.\n\nFilename length should be checked after escaping, not before.\n## URL paths and query strings\n\nUnicode characters and `/` are already handled by standard URI encoding.  The only special characters are:\n- a leading underscore `_`\n- a comma `,`\n\nThese can be escaped automatically by prepending `\\` (so we would need to escape literal `\\`'s as well).\n\nThe `*` is used as a wildcard for various URL parameters, eg index and type names.  We cannot automatically escape the wildcard (because usually it should be a plain wildcard).  Similarly, the user can't escape it as `my_literal_\\*`, because the `\\` would itself be escaped as: `my_literal_\\\\*`, meaning that the wildcard would still function as a wildcard.\n\nThe `*` should not be allowed in any identifiers which support wildcards (eg index, type, node names etc).\n\nIndex wildcards can use a leading `+` or `-` to include/exclude patterns, but these characters should already be excluded by the index naming rules above.\n## Field paths and Scripting\n\nA field containing a `.` can be escaped as `foo\\.bar` (and a field containing `\\` as `foo\\\\bar`).\n\nFields beginning with `_` can clash with metadata fields like `_id` or `_timestamp`, both in queries, aggregations, sorting, and scripting.\n\nThere are four options:\n- Forbid fieldnames beginning with an underscore - this is too stringent and will impact existing data\n- Reserve existing metadata field names - this makes it difficult to add more\n- Allow `\\` escaping to distinguish the metadata `_id` field from the body `\\_id` field\n- Add a single namespace for metadata fields, eg `_root._id` or `_doc._id` (`_meta` is already taken unfortunately)\n\nAlso see https://github.com/elasticsearch/elasticsearch/issues/5558\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}