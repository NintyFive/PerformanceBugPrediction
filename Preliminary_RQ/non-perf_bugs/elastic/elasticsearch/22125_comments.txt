[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267691599","html_url":"https://github.com/elastic/elasticsearch/issues/22125#issuecomment-267691599","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22125","id":267691599,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzY5MTU5OQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T20:44:31Z","updated_at":"2016-12-16T20:44:31Z","author_association":"CONTRIBUTOR","body":"I played with this a little and it is actually an instance of our APIs returning `OK` responses for partial successes. Have a look at this example:\r\n```\r\npublic class TmpIT extends ESIntegTestCase {\r\n    @Override\r\n    protected Collection<Class<? extends Plugin>> nodePlugins() {\r\n        List<Class<? extends Plugin>> plugins = new ArrayList<>(super.nodePlugins());\r\n        plugins.add(PainlessPlugin.class);\r\n        return plugins;\r\n    }\r\n\r\n    public void testMap() throws InterruptedException, ExecutionException {\r\n        indexRandom(true, client().prepareIndex(\"test\", \"test\", \"test\").setSource(\"test\", \"test\"));\r\n        try {\r\n            SearchResponse response = client().prepareSearch()\r\n                    .setIndices(\"test\")\r\n                    .addAggregation(AggregationBuilders.scriptedMetric(\"agg\")\r\n                            .mapScript(new Script(\"Debug.explain('foo')\")))\r\n                    .get();\r\n            for (ShardSearchFailure failures: response.getShardFailures()) {\r\n                XContentBuilder builder = JsonXContent.contentBuilder().prettyPrint();\r\n                builder.startObject();\r\n                ElasticsearchException.toXContent(builder, ToXContent.EMPTY_PARAMS, failures.getCause());\r\n                builder.endObject();\r\n                System.err.println(builder.string());\r\n            }\r\n            assertThat(response.getShardFailures(), arrayWithSize(greaterThanOrEqualTo(1)));\r\n        } catch (Exception ignored) {\r\n            ignored.printStackTrace();\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThat always passes. The shards with no data succeed and the shards with the document fail, printing the correct failure information in the for loop.","performed_via_github_app":null}]