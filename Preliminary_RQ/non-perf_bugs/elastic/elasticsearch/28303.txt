{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28303","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28303/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28303/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28303/events","html_url":"https://github.com/elastic/elasticsearch/issues/28303","id":289789348,"node_id":"MDU6SXNzdWUyODk3ODkzNDg=","number":28303,"title":"Eagerly fetch future results while scrolling","user":{"login":"scottsom","id":23276852,"node_id":"MDQ6VXNlcjIzMjc2ODUy","avatar_url":"https://avatars1.githubusercontent.com/u/23276852?v=4","gravatar_id":"","url":"https://api.github.com/users/scottsom","html_url":"https://github.com/scottsom","followers_url":"https://api.github.com/users/scottsom/followers","following_url":"https://api.github.com/users/scottsom/following{/other_user}","gists_url":"https://api.github.com/users/scottsom/gists{/gist_id}","starred_url":"https://api.github.com/users/scottsom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottsom/subscriptions","organizations_url":"https://api.github.com/users/scottsom/orgs","repos_url":"https://api.github.com/users/scottsom/repos","events_url":"https://api.github.com/users/scottsom/events{/privacy}","received_events_url":"https://api.github.com/users/scottsom/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-01-18T21:55:35Z","updated_at":"2018-02-14T13:30:57Z","closed_at":"2018-01-19T14:14:46Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"From looking over the logic for scrolling, I suspect that there should be a decent optimization opportunity by having scrolls eagerly retrieve results before they are requested. It seems that after Elasticsearch returns the scroll results, it isn't doing any work (related to the scroll) until the client makes the next request at which point it runs the query then fetches the results.\r\n\r\nInstead of sitting idle, each node involved in the scroll could do the query then buffer future results and when the client asks for the next batch, it flushes them from memory. This is possible since the scroll is a point-in-time snapshot, so whether the client asks for the next batch in 1s or 10s, they'll get the same response (no need to worry about invalidating stale buffered data).\r\n\r\nThis would be analogous to how an operating system might populate a readahead buffer of subsequent files on disk in anticipation of them being used. In this situation, it is highly likely that the buffered data will be used since you are probably looking for an exhaustive result set when scrolling.\r\n\r\nThis could be opt-in with a configurable buffer size and not require any API changes.\r\n\r\nHas this been considered / prototyped in the past? \r\n\r\nWould there be any interest in accepting a pull request that implements this? (provided it actually improves scroll benchmarks)","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}