{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6025","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6025/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6025/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6025/events","html_url":"https://github.com/elastic/elasticsearch/issues/6025","id":32714004,"node_id":"MDU6SXNzdWUzMjcxNDAwNA==","number":6025,"title":"Delete By Query under heavy indexing load causes OOM errors","user":{"login":"xyu","id":373804,"node_id":"MDQ6VXNlcjM3MzgwNA==","avatar_url":"https://avatars1.githubusercontent.com/u/373804?v=4","gravatar_id":"","url":"https://api.github.com/users/xyu","html_url":"https://github.com/xyu","followers_url":"https://api.github.com/users/xyu/followers","following_url":"https://api.github.com/users/xyu/following{/other_user}","gists_url":"https://api.github.com/users/xyu/gists{/gist_id}","starred_url":"https://api.github.com/users/xyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xyu/subscriptions","organizations_url":"https://api.github.com/users/xyu/orgs","repos_url":"https://api.github.com/users/xyu/repos","events_url":"https://api.github.com/users/xyu/events{/privacy}","received_events_url":"https://api.github.com/users/xyu/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2014-05-02T18:26:10Z","updated_at":"2015-05-29T17:24:14Z","closed_at":"2015-05-28T16:59:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hello,\n\nWe are running an ES 1.1.1 cluster and when we bulk index into it with a high write load we have found that it can trigger OOM errors if we run deletebyquery calls. The symptoms of the problems appears to be the following:\n1. Index into the cluster with a heavy write load, this will cause merges to pile up. During the pileup the merge thread pool queue goes up and stays at ~120 per node. (Maybe related to #5779?)\n2. Merges are no longer able to keep up with new segments created from indexing operations and segments per node shoots up. (We have seen over 30k segments per node.)\n3. Long GC cycles are triggered which may or may not cause the node to drop out of the cluster.\n4. When a Delete By Query call is issued an internal refresh is triggered (#3593) which fails due to an out of memory error and causes the node to be removed from the cluster for not responding. (See [gist](https://gist.github.com/xyu/4ca1ddb56200479a07d7) for logs. In this example es13.iad sends a call to es13.sat which experiences OOM causing es13.iad to remove it from the cluster.)\n\nPlease let me know if there are any other info I can provide that may be helpful.\n","closed_by":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"performed_via_github_app":null}