[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/310700568","html_url":"https://github.com/elastic/elasticsearch/issues/25378#issuecomment-310700568","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25378","id":310700568,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMDcwMDU2OA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-06-23T15:43:40Z","updated_at":"2017-06-23T15:43:40Z","author_association":"CONTRIBUTOR","body":"Highlighting doesn't work like this. But it is *so* close to possible. So here is what I think you are doing:\r\n```\r\nDELETE /test\r\n\r\nPUT /test/doc/1?refresh\r\n{\r\n  \"test\": \"gas was has\"\r\n}\r\n\r\nPOST /test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"should\": [\r\n        {\"match\": {\"test\": \"gas\"}},\r\n        {\"fuzzy\": {\"test\": \"gas\"}}\r\n      ]\r\n    }\r\n  },\r\n  \"highlight\": {\r\n    \"fields\": {\r\n      \"test\": {}\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThat gets you `<em>gas</em> <em>was</em> <em>has</em>` which isn't what you wanted.\r\n\r\nMy instinct was to try:\r\n```\r\nPOST /test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"should\": [\r\n        {\"match\": {\"test\": \"gas\"}},\r\n        {\"fuzzy\": {\"test\": \"gas\"}}\r\n      ]\r\n    }\r\n  },\r\n  \"highlight\": {\r\n    \"fields\": [\r\n      {\r\n        \"test\": {\r\n          \"highlight_query\": {\"match\": {\"test\": \"gas\"}}\r\n        }\r\n      },\r\n      {\r\n        \"test\": {\r\n          \"highlight_query\": {\"fuzzy\": {\"test\": \"gas\"}}\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nWhich *almost* works. It doesn't *quite* work because of the way highlighting returns results. Internally, the highlighter executes this to produce the right results but it throws away the first one. If you reorder the list in `fields` you can see that.\r\n\r\nNow, we *could* fix this. And maybe we should for completeness sake. But it is often a better choice to use the term or phrase suggester and run the query without any fuzziness. Then you can present a \"did you mean\" style prompt. As compared to running with a fuzzy and non-fuzzy query. I don't know for sure what you are trying to do, but the reason I've never needed this feature before is because I've used the phrase suggester for \"did you mean\" instead of doing this.\r\n\r\nI suppose the question is, \"is it worth changing the response in the highlighting API so you can do this?\" I don't know the answer to that so I've marked the issue as `discuss`. I expect @jimczi to have some opinions about it but he is away.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312277100","html_url":"https://github.com/elastic/elasticsearch/issues/25378#issuecomment-312277100","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25378","id":312277100,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjI3NzEwMA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-06-30T14:09:06Z","updated_at":"2017-06-30T14:09:06Z","author_association":"CONTRIBUTOR","body":"Discussed in FixItFriday.  The highlighter is actually doing the same thing the query is doing.  For instance, a query on the field `gas has` would match both terms with both fuzzy and non-fuzzy, and the highlighter reflects that.\r\n\r\n@nik9000 while we could change the format to handle multiple highlights on the same field, we prefer the idea you implemented for wikipedia of prioritised/fallback highlighting.  That's obviously a big project though, but I think it would be widely useful","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372973292","html_url":"https://github.com/elastic/elasticsearch/issues/25378#issuecomment-372973292","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25378","id":372973292,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjk3MzI5Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T10:26:04Z","updated_at":"2018-03-14T10:26:04Z","author_association":"MEMBER","body":"Closing this in favor of https://github.com/elastic/elasticsearch/issues/5172 which has a different scope but I assumed that this is what @clintongormley had in mind in the previous comment.\r\nRegarding the original issue to **not** highlight some part of the query, the `highlight_query` option should work fine as long as you don't need to highlight the same field multiple times (with different `highlight_query` as @nik9000 pointed out).\r\n\r\n","performed_via_github_app":null}]