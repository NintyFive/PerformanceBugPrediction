{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4798","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4798/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4798/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4798/events","html_url":"https://github.com/elastic/elasticsearch/issues/4798","id":25886500,"node_id":"MDU6SXNzdWUyNTg4NjUwMA==","number":4798,"title":"IndexShardGatewayRecoveryException: [<index name>][4] failed to fetch index version after copying it over","user":{"login":"karol-gwaj","id":1188157,"node_id":"MDQ6VXNlcjExODgxNTc=","avatar_url":"https://avatars3.githubusercontent.com/u/1188157?v=4","gravatar_id":"","url":"https://api.github.com/users/karol-gwaj","html_url":"https://github.com/karol-gwaj","followers_url":"https://api.github.com/users/karol-gwaj/followers","following_url":"https://api.github.com/users/karol-gwaj/following{/other_user}","gists_url":"https://api.github.com/users/karol-gwaj/gists{/gist_id}","starred_url":"https://api.github.com/users/karol-gwaj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karol-gwaj/subscriptions","organizations_url":"https://api.github.com/users/karol-gwaj/orgs","repos_url":"https://api.github.com/users/karol-gwaj/repos","events_url":"https://api.github.com/users/karol-gwaj/events{/privacy}","received_events_url":"https://api.github.com/users/karol-gwaj/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-01-19T19:31:29Z","updated_at":"2019-02-18T05:57:57Z","closed_at":"2014-01-19T19:53:20Z","author_association":"NONE","active_lock_reason":null,"body":"I started getting this warning/error after full cluster restart:\n\n```\n[2014-01-19 19:15:15,239][WARN ][cluster.action.shard     ] [<node name>] [<index name>][4] sending failed shard for [<index name>][4], node[FgQg7A4HRdSuCKK-EHjNdQ], [P], s[INITIALIZING], indexUUID [gRKAbB7AQYGhgZRfi6pgzQ], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[<index name>][4] failed to fetch index version after copying it over]; nested: IndexShardGatewayRecoveryException[[<index name>][4] shard allocated for local recovery (post api), should exist, but doesn't, current files: [_7cn.fdx, _agr_es090_0.tim, _agr.nvm, _b4g.nvd, _b4g.fdt, _7cn.nvd, _7cn_es090_0.pos, _b4g.fdx, _agr.nvd, _b4g_es090_0.pay, _b4g_es090_0.pos, _b4g.nvm, _b4g.si, _checksums-1390157207161, _91s_es090_0.tim, _b4g_es090_0.doc, _7cn.nvm, _7cn_es090_0.tip, _agr_es090_0.pos, _7cn.si, _7cn_es090_0.blm, _7cn.fnm, _agr_es090_0.pay, _7cn_12.del, _b4g_es090_0.tip, _91s.si, _91s.nvm, _agr.fnm, _agr_es090_0.doc, _7cn_es090_0.pay, _91s_es090_0.tip, _agr.fdt, _91s_es090_0.blm, _agr.fdx, _agr_es090_0.tip, _7cn_es090_0.doc, _91s.fdt, segments_7i, _91s_d.del, _91s_es090_0.doc, _7cn_es090_0.tim, segments.gen, _91s_es090_0.pay, _agr.si, _7cn.fdt, _91s.fdx, _91s.fnm, _b4g_es090_0.tim, _b4g.fnm, _agr_d.del, _b4g_es090_0.blm, _91s.nvd, _agr_es090_0.blm, _91s_es090_0.pos]]; nested: FileNotFoundException[segments_7k]; ]]\n[2014-01-19 19:15:15,437][WARN ][indices.cluster          ] [<node name>] [<index name>][4] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [<index name>][4] failed to fetch index version after copying it over\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:136)\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:174)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\nCaused by: org.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [<index name>][4] shard allocated for local recovery (post api), should exist, but doesn't, current files: [_7cn.fdx, _agr_es090_0.tim, _agr.nvm, _b4g.nvd, _b4g.fdt, _7cn.nvd, _7cn_es090_0.pos, _b4g.fdx, _agr.nvd, _b4g_es090_0.pay, _b4g_es090_0.pos, _b4g.nvm, _b4g.si, _checksums-1390157207161, _91s_es090_0.tim, _b4g_es090_0.doc, _7cn.nvm, _7cn_es090_0.tip, _agr_es090_0.pos, _7cn.si, _7cn_es090_0.blm, _7cn.fnm, _agr_es090_0.pay, _7cn_12.del, _b4g_es090_0.tip, _91s.si, _91s.nvm, _agr.fnm, _agr_es090_0.doc, _7cn_es090_0.pay, _91s_es090_0.tip, _agr.fdt, _91s_es090_0.blm, _agr.fdx, _agr_es090_0.tip, _7cn_es090_0.doc, _91s.fdt, segments_7i, _91s_d.del, _91s_es090_0.doc, _7cn_es090_0.tim, segments.gen, _91s_es090_0.pay, _agr.si, _7cn.fdt, _91s.fdx, _91s.fnm, _b4g_es090_0.tim, _b4g.fnm, _agr_d.del, _b4g_es090_0.blm, _91s.nvd, _agr_es090_0.blm, _91s_es090_0.pos]\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:115)\n        ... 4 more\nCaused by: java.io.FileNotFoundException: segments_7k\n        at org.elasticsearch.index.store.Store$StoreDirectory.openInput(Store.java:469)\n        at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:324)\n        at org.apache.lucene.index.SegmentInfos$1.doBody(SegmentInfos.java:404)\n        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:843)\n        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:694)\n        at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:400)\n        at org.elasticsearch.common.lucene.Lucene.readSegmentInfos(Lucene.java:114)\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:106)\n        ... 4 more\n[2014-01-19 19:15:15,438][WARN ][cluster.action.shard     ] [<node name>] [<index name>][4] sending failed shard for [<index name>][4], node[FgQg7A4HRdSuCKK-EHjNdQ], [P], s[INITIALIZING], indexUUID [gRKAbB7AQYGhgZRfi6pgzQ], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[<index name>][4] failed to fetch index version after copying it over]; nested: IndexShardGatewayRecoveryException[[<index name>][4] shard allocated for local recovery (post api), should exist, but doesn't, current files: [_7cn.fdx, _agr_es090_0.tim, _agr.nvm, _b4g.nvd, _b4g.fdt, _7cn.nvd, _7cn_es090_0.pos, _b4g.fdx, _agr.nvd, _b4g_es090_0.pay, _b4g_es090_0.pos, _b4g.nvm, _b4g.si, _checksums-1390157207161, _91s_es090_0.tim, _b4g_es090_0.doc, _7cn.nvm, _7cn_es090_0.tip, _agr_es090_0.pos, _7cn.si, _7cn_es090_0.blm, _7cn.fnm, _agr_es090_0.pay, _7cn_12.del, _b4g_es090_0.tip, _91s.si, _91s.nvm, _agr.fnm, _agr_es090_0.doc, _7cn_es090_0.pay, _91s_es090_0.tip, _agr.fdt, _91s_es090_0.blm, _agr.fdx, _agr_es090_0.tip, _7cn_es090_0.doc, _91s.fdt, segments_7i, _91s_d.del, _91s_es090_0.doc, _7cn_es090_0.tim, segments.gen, _91s_es090_0.pay, _agr.si, _7cn.fdt, _91s.fdx, _91s.fnm, _b4g_es090_0.tim, _b4g.fnm, _agr_d.del, _b4g_es090_0.blm, _91s.nvd, _agr_es090_0.blm, _91s_es090_0.pos]]; nested: FileNotFoundException[segments_7k]; ]]\n[2014-01-19 19:15:15,512][WARN ][indices.cluster          ] [<node name>] [<index name>][4] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [<index name>][4] failed to fetch index version after copying it over\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:136)\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:174)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\nCaused by: org.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [<index name>][4] shard allocated for local recovery (post api), should exist, but doesn't, current files: [_7cn.fdx, _agr_es090_0.tim, _agr.nvm, _b4g.nvd, _b4g.fdt, _7cn.nvd, _7cn_es090_0.pos, _b4g.fdx, _agr.nvd, _b4g_es090_0.pay, _b4g_es090_0.pos, _b4g.nvm, _b4g.si, _checksums-1390157207161, _91s_es090_0.tim, _b4g_es090_0.doc, _7cn.nvm, _7cn_es090_0.tip, _agr_es090_0.pos, _7cn.si, _7cn_es090_0.blm, _7cn.fnm, _agr_es090_0.pay, _7cn_12.del, _b4g_es090_0.tip, _91s.si, _91s.nvm, _agr.fnm, _agr_es090_0.doc, _7cn_es090_0.pay, _91s_es090_0.tip, _agr.fdt, _91s_es090_0.blm, _agr.fdx, _agr_es090_0.tip, _7cn_es090_0.doc, _91s.fdt, segments_7i, _91s_d.del, _91s_es090_0.doc, _7cn_es090_0.tim, segments.gen, _91s_es090_0.pay, _agr.si, _7cn.fdt, _91s.fdx, _91s.fnm, _b4g_es090_0.tim, _b4g.fnm, _agr_d.del, _b4g_es090_0.blm, _91s.nvd, _agr_es090_0.blm, _91s_es090_0.pos]\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:115)\n        ... 4 more\nCaused by: java.io.FileNotFoundException: segments_7k\n        at org.elasticsearch.index.store.Store$StoreDirectory.openInput(Store.java:469)\n        at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:324)\n        at org.apache.lucene.index.SegmentInfos$1.doBody(SegmentInfos.java:404)\n        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:843)\n        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:694)\n        at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:400)\n        at org.elasticsearch.common.lucene.Lucene.readSegmentInfos(Lucene.java:114)\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:106)\n        ... 4 more\n[2014-01-19 19:15:15,515][WARN ][cluster.action.shard     ] [<node name>] [<index name>][4] sending failed shard for [<index name>][4], node[FgQg7A4HRdSuCKK-EHjNdQ], [P], s[INITIALIZING], indexUUID [gRKAbB7AQYGhgZRfi6pgzQ], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[<index name>][4] failed to fetch index version after copying it over]; nested: IndexShardGatewayRecoveryException[[<index name>][4] shard allocated for local recovery (post api), should exist, but doesn't, current files: [_7cn.fdx, _agr_es090_0.tim, _agr.nvm, _b4g.nvd, _b4g.fdt, _7cn.nvd, _7cn_es090_0.pos, _b4g.fdx, _agr.nvd, _b4g_es090_0.pay, _b4g_es090_0.pos, _b4g.nvm, _b4g.si, _checksums-1390157207161, _91s_es090_0.tim, _b4g_es090_0.doc, _7cn.nvm, _7cn_es090_0.tip, _agr_es090_0.pos, _7cn.si, _7cn_es090_0.blm, _7cn.fnm, _agr_es090_0.pay, _7cn_12.del, _b4g_es090_0.tip, _91s.si, _91s.nvm, _agr.fnm, _agr_es090_0.doc, _7cn_es090_0.pay, _91s_es090_0.tip, _agr.fdt, _91s_es090_0.blm, _agr.fdx, _agr_es090_0.tip, _7cn_es090_0.doc, _91s.fdt, segments_7i, _91s_d.del, _91s_es090_0.doc, _7cn_es090_0.tim, segments.gen, _91s_es090_0.pay, _agr.si, _7cn.fdt, _91s.fdx, _91s.fnm, _b4g_es090_0.tim, _b4g.fnm, _agr_d.del, _b4g_es090_0.blm, _91s.nvd, _agr_es090_0.blm, _91s_es090_0.pos]]; nested: FileNotFoundException[segments_7k]; ]]\n[2014-01-19 19:15:15,549][WARN ][indices.cluster          ] [<node name>] [<index name>][4] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [<index name>][4] failed to fetch index version after copying it over\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:136)\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:174)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\nCaused by: org.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [<index name>][4] shard allocated for local recovery (post api), should exist, but doesn't, current files: [_7cn.fdx, _agr_es090_0.tim, _agr.nvm, _b4g.nvd, _b4g.fdt, _7cn.nvd, _7cn_es090_0.pos, _b4g.fdx, _agr.nvd, _b4g_es090_0.pay, _b4g_es090_0.pos, _b4g.nvm, _b4g.si, _checksums-1390157207161, _91s_es090_0.tim, _b4g_es090_0.doc, _7cn.nvm, _7cn_es090_0.tip, _agr_es090_0.pos, _7cn.si, _7cn_es090_0.blm, _7cn.fnm, _agr_es090_0.pay, _7cn_12.del, _b4g_es090_0.tip, _91s.si, _91s.nvm, _agr.fnm, _agr_es090_0.doc, _7cn_es090_0.pay, _91s_es090_0.tip, _agr.fdt, _91s_es090_0.blm, _agr.fdx, _agr_es090_0.tip, _7cn_es090_0.doc, _91s.fdt, segments_7i, _91s_d.del, _91s_es090_0.doc, _7cn_es090_0.tim, segments.gen, _91s_es090_0.pay, _agr.si, _7cn.fdt, _91s.fdx, _91s.fnm, _b4g_es090_0.tim, _b4g.fnm, _agr_d.del, _b4g_es090_0.blm, _91s.nvd, _agr_es090_0.blm, _91s_es090_0.pos]\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:115)\n        ... 4 more\nCaused by: java.io.FileNotFoundException: segments_7k\n        at org.elasticsearch.index.store.Store$StoreDirectory.openInput(Store.java:469)\n        at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:324)\n        at org.apache.lucene.index.SegmentInfos$1.doBody(SegmentInfos.java:404)\n        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:843)\n        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:694)\n        at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:400)\n        at org.elasticsearch.common.lucene.Lucene.readSegmentInfos(Lucene.java:114)\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:106)\n        ... 4 more\n\n```\n\nthe problem i have with this warning is, that it **never stops** (obviously it goes into some infinite loop trying to recover broken shard and it cant)\ni have logging level set to WARN, so my log files are growing very fast (this warning is logged like 10 times per second on every node)\n\ncontext:\n- es version 0.90.9\n- 3 nodes cluster\n- 10 shards per index with 2 replicas\n- local gateway\n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}