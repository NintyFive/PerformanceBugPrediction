{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17541","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17541/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17541/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17541/events","html_url":"https://github.com/elastic/elasticsearch/issues/17541","id":146015084,"node_id":"MDU6SXNzdWUxNDYwMTUwODQ=","number":17541,"title":"Check for EmptyQueryBuilder at parse time","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":381894283,"node_id":"MDU6TGFiZWwzODE4OTQyODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.0.0-alpha4","name":"v5.0.0-alpha4","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-04-05T14:56:19Z","updated_at":"2018-02-14T13:29:45Z","closed_at":"2016-06-17T10:00:42Z","author_association":"MEMBER","active_lock_reason":null,"body":"At the moment if `{}` is specified as a query we convert it to an `EmptyQueryBuilder` object and expect whatever calls `QueryBuilder#toQuery` to check for null and handle it appropriately. There are bugs such as https://github.com/elastic/elasticsearch/issues/17518 where we did not realise/remember to add this check. Depending on the outcome of https://github.com/elastic/elasticsearch/issues/17540 and at the very least during the deprecation period if it is accepted, it would be good to improve the handling by moving this check to the parsing stage.\n\nWhen parsing compound queries and when parsing the top level query object we should check whether the inner query is an instance of `EmptyQueryBuilder` and ignore it, convert it or throw an exception at that point. We should also then make `EmptyQueryBuilder#toQuery()` throw an `UnsupportedOperationException` with an appropriate message so it is easy to see what the problem is if it does get called\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}