{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18805","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18805/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18805/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18805/events","html_url":"https://github.com/elastic/elasticsearch/issues/18805","id":159443074,"node_id":"MDU6SXNzdWUxNTk0NDMwNzQ=","number":18805,"title":"Clarify that using time zones for date rounding (e.g. histograms) can lead to buckets that are not equally sized ","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-06-09T15:51:38Z","updated_at":"2018-02-13T20:47:46Z","closed_at":"2016-11-16T08:40:07Z","author_association":"MEMBER","active_lock_reason":null,"body":"I think we should clarify in our documentation that when using arbitrary time intervals together with time zones (e.g. in `date_histogram`), we cannot guarantee that the resulting buckets have exactly the specified interval width when DST changes (or other time zone offset changes) happen. \n\nAs a simple example, when you specify an `interval` like e.g. 12h in a `date_histogram` together with a time zone (e.g. \"CET\") and then use extended bounds, we get nice buckets that align with 00:00 and 12:00 in local time in that time zone:\n\n```\nGET test/doc/_search\n{\n  \"query\": { \"match\": {\n    \"foo\": \"some_text\"\n  }}, \n  \"aggs\" : {\n        \"my_hist\" : {\n            \"date_histogram\" : {\n                \"field\" : \"event_date\",\n                \"interval\" : \"12h\",\n                \"time_zone\": \"CET\",\n                \"extended_bounds\" : {\n                    \"min\" : \"2016-03-26\",\n                    \"max\" : \"2016-03-29\"\n                }\n            }\n        }\n    }\n}\n```\n\n```\n\"buckets\": [\n        {\n          \"key_as_string\": \"2016-03-26T00:00:00.000+01:00\",\n          \"key\": 1458946800000,\n          \"doc_count\": 0\n        },\n        {\n          \"key_as_string\": \"2016-03-26T12:00:00.000+01:00\",\n          \"key\": 1458990000000,\n          \"doc_count\": 0\n        },\n        {\n          \"key_as_string\": \"2016-03-27T00:00:00.000+01:00\",\n          \"key\": 1459033200000,\n          \"doc_count\": 0\n        },\n        {\n          \"key_as_string\": \"2016-03-27T12:00:00.000+02:00\",\n          \"key\": 1459072800000,   <--- note: 1459072800000 - 1459033200000 = 39600000ms, thats 11h\n          \"doc_count\": 0\n        },\n        {\n          \"key_as_string\": \"2016-03-28T00:00:00.000+02:00\",\n          \"key\": 1459116000000,\n          \"doc_count\": 0\n        },\n        {\n          \"key_as_string\": \"2016-03-28T12:00:00.000+02:00\",\n          \"key\": 1459159200000,\n          \"doc_count\": 0\n        }\n```\n\nHowever, this example covers the day DST starts in CET (27 Mar 2016, +1h at 02:00) so the \"2016-03-27T00:00:00.000+01:00\" bucket is only 11h \"wide\". On DST start we would have the reverse situation where the bucket covers 13h. \n\nThis is something that cannot be avoided when at the same time we want e.g. 6h/12h intervals to align nicely with local time, but I think it is not really clear for every user and they might (incorrectly) rely on the assumption that buckets are equal-sized in their further processing. Maybe this should just be stated in the docs clearly, at least for these relatively simple cases. Otherwise we can only really guarantee fixed-size buckets for fixed UTC offset time zones (like +01:00, -06:00).\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}