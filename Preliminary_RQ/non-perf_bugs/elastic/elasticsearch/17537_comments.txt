[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206313197","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-206313197","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":206313197,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjMxMzE5Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T11:08:13Z","updated_at":"2016-04-06T11:08:13Z","author_association":"CONTRIBUTOR","body":"@jaksmid could you provide some documents and the stack trace that is produced when you see this exception please?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206313641","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-206313641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":206313641,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjMxMzY0MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T11:09:22Z","updated_at":"2016-04-06T11:09:22Z","author_association":"CONTRIBUTOR","body":"@jpountz given that this only happens with `size` > 0, I'm wondering if this highlighting trying to highlight the geo field? Perhaps with no documents on a particular shard?\n\n/cc @nknize \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206731331","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-206731331","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":206731331,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjczMTMzMQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-04-07T07:17:50Z","updated_at":"2016-04-07T07:17:50Z","author_association":"CONTRIBUTOR","body":"I can reproduce something that looks just like this with a lucene test if you apply the patch on https://issues.apache.org/jira/browse/LUCENE-7185\n\nI suspect it may happen with extreme values such as latitude = 90 or longitude = 180 which are used much more in tests with the patch. See seed:\n\n```\n  [junit4] Suite: org.apache.lucene.spatial.geopoint.search.TestGeoPointQuery\n   [junit4] IGNOR/A 0.01s J1 | TestGeoPointQuery.testRandomBig\n   [junit4]    > Assumption #1: 'nightly' test group is disabled (@Nightly())\n   [junit4] IGNOR/A 0.00s J1 | TestGeoPointQuery.testRandomDistanceHuge\n   [junit4]    > Assumption #1: 'nightly' test group is disabled (@Nightly())\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestGeoPointQuery -Dtests.method=testAllLonEqual -Dtests.seed=4ABB96AB44F4796E -Dtests.locale=id-ID -Dtests.timezone=Pacific/Fakaofo -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n   [junit4] ERROR   0.35s J1 | TestGeoPointQuery.testAllLonEqual <<<\n   [junit4]    > Throwable #1: java.lang.IllegalArgumentException: Illegal shift value, must be 32..63; got shift=0\n   [junit4]    >    at __randomizedtesting.SeedInfo.seed([4ABB96AB44F4796E:DBB16756B45E397A]:0)\n   [junit4]    >    at org.apache.lucene.spatial.util.GeoEncodingUtils.geoCodedToPrefixCodedBytes(GeoEncodingUtils.java:109)\n   [junit4]    >    at org.apache.lucene.spatial.util.GeoEncodingUtils.geoCodedToPrefixCoded(GeoEncodingUtils.java:89)\n   [junit4]    >    at org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum$Range.fillBytesRef(GeoPointPrefixTermsEnum.java:236)\n   [junit4]    >    at org.apache.lucene.spatial.geopoint.search.GeoPointTermsEnum.nextRange(GeoPointTermsEnum.java:71)\n   [junit4]    >    at org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum.nextRange(GeoPointPrefixTermsEnum.java:171)\n   [junit4]    >    at org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum.nextSeekTerm(GeoPointPrefixTermsEnum.java:190)\n   [junit4]    >    at org.apache.lucene.index.FilteredTermsEnum.next(FilteredTermsEnum.java:212)\n   [junit4]    >    at org.apache.lucene.spatial.geopoint.search.GeoPointTermQueryConstantScoreWrapper$1.scorer(GeoPointTermQueryConstantScoreWrapper.java:110)\n   [junit4]    >    at org.apache.lucene.search.Weight.bulkScorer(Weight.java:135)\n   [junit4]    >    at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.bulkScorer(LRUQueryCache.java:644)\n   [junit4]    >    at org.apache.lucene.search.AssertingWeight.bulkScorer(AssertingWeight.java:68)\n   [junit4]    >    at org.apache.lucene.search.BooleanWeight.optionalBulkScorer(BooleanWeight.java:231)\n   [junit4]    >    at org.apache.lucene.search.BooleanWeight.booleanScorer(BooleanWeight.java:297)\n   [junit4]    >    at org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:364)\n   [junit4]    >    at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.bulkScorer(LRUQueryCache.java:644)\n   [junit4]    >    at org.apache.lucene.search.AssertingWeight.bulkScorer(AssertingWeight.java:68)\n   [junit4]    >    at org.apache.lucene.search.AssertingWeight.bulkScorer(AssertingWeight.java:68)\n   [junit4]    >    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:666)\n   [junit4]    >    at org.apache.lucene.search.AssertingIndexSearcher.search(AssertingIndexSearcher.java:91)\n   [junit4]    >    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:473)\n   [junit4]    >    at org.apache.lucene.spatial.util.BaseGeoPointTestCase.verifyRandomRectangles(BaseGeoPointTestCase.java:835)\n   [junit4]    >    at org.apache.lucene.spatial.util.BaseGeoPointTestCase.verify(BaseGeoPointTestCase.java:763)\n   [junit4]    >    at org.apache.lucene.spatial.util.BaseGeoPointTestCase.testAllLonEqual(BaseGeoPointTestCase.java:495)\n\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206732544","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-206732544","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":206732544,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjczMjU0NA==","user":{"login":"jaksmid","id":3618465,"node_id":"MDQ6VXNlcjM2MTg0NjU=","avatar_url":"https://avatars1.githubusercontent.com/u/3618465?v=4","gravatar_id":"","url":"https://api.github.com/users/jaksmid","html_url":"https://github.com/jaksmid","followers_url":"https://api.github.com/users/jaksmid/followers","following_url":"https://api.github.com/users/jaksmid/following{/other_user}","gists_url":"https://api.github.com/users/jaksmid/gists{/gist_id}","starred_url":"https://api.github.com/users/jaksmid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaksmid/subscriptions","organizations_url":"https://api.github.com/users/jaksmid/orgs","repos_url":"https://api.github.com/users/jaksmid/repos","events_url":"https://api.github.com/users/jaksmid/events{/privacy}","received_events_url":"https://api.github.com/users/jaksmid/received_events","type":"User","site_admin":false},"created_at":"2016-04-07T07:20:27Z","updated_at":"2016-04-07T07:20:27Z","author_association":"NONE","body":"Hi @clintongormley, thank you for your message. \n\nThe stack trace is as follows:\n`RemoteTransportException[[elasticsearch_4][172.17.0.2:9300][indices:data/read/search[phase/fetch/id]]]; nested: FetchPhaseExecutionException[Fetch Failed [Failed to highlight field [cyberdyne_metadata.ner.mitie.model.DISEASE.tag]]]; nested: NumberFormatException[Invalid shift value (65) in prefixCoded bytes (is encoded value really a geo point?)];\nCaused by: FetchPhaseExecutionException[Fetch Failed [Failed to highlight field [cyberdyne_metadata.ner.mitie.model.DISEASE.tag]]]; nested: NumberFormatException[Invalid shift value (65) in prefixCoded bytes (is encoded value really a geo point?)];\n    at org.elasticsearch.search.highlight.PlainHighlighter.highlight(PlainHighlighter.java:123)\n    at org.elasticsearch.search.highlight.HighlightPhase.hitExecute(HighlightPhase.java:126)\n    at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:188)\n    at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:592)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$FetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:408)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$FetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:405)\n    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:300)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NumberFormatException: Invalid shift value (65) in prefixCoded bytes (is encoded value really a geo point?)\n    at org.apache.lucene.spatial.util.GeoEncodingUtils.getPrefixCodedShift(GeoEncodingUtils.java:134)\n    at org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum.accept(GeoPointPrefixTermsEnum.java:219)\n    at org.apache.lucene.index.FilteredTermsEnum.next(FilteredTermsEnum.java:232)\n    at org.apache.lucene.search.TermCollectingRewrite.collectTerms(TermCollectingRewrite.java:67)\n    at org.apache.lucene.search.ScoringRewrite.rewrite(ScoringRewrite.java:108)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.extract(WeightedSpanTermExtractor.java:220)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.extract(WeightedSpanTermExtractor.java:227)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.extract(WeightedSpanTermExtractor.java:113)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.extract(WeightedSpanTermExtractor.java:113)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.getWeightedSpanTerms(WeightedSpanTermExtractor.java:505)\n    at org.apache.lucene.search.highlight.QueryScorer.initExtractor(QueryScorer.java:218)\n    at org.apache.lucene.search.highlight.QueryScorer.init(QueryScorer.java:186)\n    at org.apache.lucene.search.highlight.Highlighter.getBestTextFragments(Highlighter.java:195)\n    at org.elasticsearch.search.highlight.PlainHighlighter.highlight(PlainHighlighter.java:108)\n    ... 12 more`\n\nThe field cyberdyne_metadata.ner.mitie.model.DISEASE.tag should not be a geopoint according to the dynamic template.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206738984","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-206738984","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":206738984,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjczODk4NA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-04-07T07:33:06Z","updated_at":"2016-04-07T07:33:06Z","author_association":"CONTRIBUTOR","body":"@rmuir oh, good catch\n@clintongormley The stack trace indeed suggests that the issue is with highlighting on the geo field. Regardless of this bug, I wonder that we should fail early when highlighting on anything but text fields and/or exclude non-text fields from wildcard matching.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206761380","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-206761380","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":206761380,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjc2MTM4MA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-04-07T08:40:43Z","updated_at":"2016-04-07T08:40:43Z","author_association":"MEMBER","body":"> I wonder that we should fail early when highlighting on anything but text fields and/or exclude non-text fields from wildcard matching.\n\n+1 to fail early if the user explicitly defined a non text field to highlight on and exclude non text fields when using wildcards\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/210972692","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-210972692","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":210972692,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDk3MjY5Mg==","user":{"login":"rodgermoore","id":12231719,"node_id":"MDQ6VXNlcjEyMjMxNzE5","avatar_url":"https://avatars2.githubusercontent.com/u/12231719?v=4","gravatar_id":"","url":"https://api.github.com/users/rodgermoore","html_url":"https://github.com/rodgermoore","followers_url":"https://api.github.com/users/rodgermoore/followers","following_url":"https://api.github.com/users/rodgermoore/following{/other_user}","gists_url":"https://api.github.com/users/rodgermoore/gists{/gist_id}","starred_url":"https://api.github.com/users/rodgermoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rodgermoore/subscriptions","organizations_url":"https://api.github.com/users/rodgermoore/orgs","repos_url":"https://api.github.com/users/rodgermoore/repos","events_url":"https://api.github.com/users/rodgermoore/events{/privacy}","received_events_url":"https://api.github.com/users/rodgermoore/received_events","type":"User","site_admin":false},"created_at":"2016-04-17T08:09:07Z","updated_at":"2016-04-17T08:09:07Z","author_association":"NONE","body":"I was running into this bug during a live demo... Yes I know, I've should have tested all demo scenario's after updating ES :grimacing: . Anyway, +1 for fixing this!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/211595595","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-211595595","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":211595595,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMTU5NTU5NQ==","user":{"login":"fclotet","id":765280,"node_id":"MDQ6VXNlcjc2NTI4MA==","avatar_url":"https://avatars0.githubusercontent.com/u/765280?v=4","gravatar_id":"","url":"https://api.github.com/users/fclotet","html_url":"https://github.com/fclotet","followers_url":"https://api.github.com/users/fclotet/followers","following_url":"https://api.github.com/users/fclotet/following{/other_user}","gists_url":"https://api.github.com/users/fclotet/gists{/gist_id}","starred_url":"https://api.github.com/users/fclotet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fclotet/subscriptions","organizations_url":"https://api.github.com/users/fclotet/orgs","repos_url":"https://api.github.com/users/fclotet/repos","events_url":"https://api.github.com/users/fclotet/events{/privacy}","received_events_url":"https://api.github.com/users/fclotet/received_events","type":"User","site_admin":false},"created_at":"2016-04-18T21:45:45Z","updated_at":"2016-04-18T21:45:45Z","author_association":"NONE","body":"-I´m having the same error. It's happends with doc having location and trying to use \n\"highlight\": {... \"require_field_match\": false ...}\n\nthanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216414709","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-216414709","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":216414709,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjQxNDcwOQ==","user":{"login":"dellis23","id":1346302,"node_id":"MDQ6VXNlcjEzNDYzMDI=","avatar_url":"https://avatars2.githubusercontent.com/u/1346302?v=4","gravatar_id":"","url":"https://api.github.com/users/dellis23","html_url":"https://github.com/dellis23","followers_url":"https://api.github.com/users/dellis23/followers","following_url":"https://api.github.com/users/dellis23/following{/other_user}","gists_url":"https://api.github.com/users/dellis23/gists{/gist_id}","starred_url":"https://api.github.com/users/dellis23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dellis23/subscriptions","organizations_url":"https://api.github.com/users/dellis23/orgs","repos_url":"https://api.github.com/users/dellis23/repos","events_url":"https://api.github.com/users/dellis23/events{/privacy}","received_events_url":"https://api.github.com/users/dellis23/received_events","type":"User","site_admin":false},"created_at":"2016-05-03T01:52:24Z","updated_at":"2016-05-03T01:52:24Z","author_association":"NONE","body":"I'm unclear as to what exactly is going on here, but I'm running into the same issue.  I'm attempting to do a geo bounding box in Kibana while viewing the results in the Discover tab.  Disabling highlighting in Kibana fixes the issue, but I would actually like to keep highlighting enabled, since it's super useful otherwise.\n\nIt sounds from what others are saying that this should fail when querying on _any_ non-string field, but I am not getting the same failure on numeric fields.  Is it just an issue with geoip fields?  I suppose another nice thing would be to explicitly allow for configuration of which fields should be highlighted in Kibana.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216492263","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-216492263","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":216492263,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjQ5MjI2Mw==","user":{"login":"vingrad","id":2070323,"node_id":"MDQ6VXNlcjIwNzAzMjM=","avatar_url":"https://avatars1.githubusercontent.com/u/2070323?v=4","gravatar_id":"","url":"https://api.github.com/users/vingrad","html_url":"https://github.com/vingrad","followers_url":"https://api.github.com/users/vingrad/followers","following_url":"https://api.github.com/users/vingrad/following{/other_user}","gists_url":"https://api.github.com/users/vingrad/gists{/gist_id}","starred_url":"https://api.github.com/users/vingrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vingrad/subscriptions","organizations_url":"https://api.github.com/users/vingrad/orgs","repos_url":"https://api.github.com/users/vingrad/repos","events_url":"https://api.github.com/users/vingrad/events{/privacy}","received_events_url":"https://api.github.com/users/vingrad/received_events","type":"User","site_admin":false},"created_at":"2016-05-03T10:40:19Z","updated_at":"2016-05-03T10:40:19Z","author_association":"NONE","body":"Please fix this issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216946525","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-216946525","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":216946525,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjk0NjUyNQ==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-04T17:50:50Z","updated_at":"2016-05-19T18:13:21Z","author_association":"CONTRIBUTOR","body":"I wrote two tests so that everyone can reproduce what happens easily: https://github.com/brwe/elasticsearch/commit/ffa242941e4ede34df67301f7b9d46ea8719cc22\n\nIn brief:\nThe plain highlighter tries to highlight whatever the BBQuery provides as terms in the text \"60,120\" if that is how the `geo_point` was indexed (if the point was indexed with `{\"lat\": 60, \"lon\": 120}` nothing will happen because we cannot even extract anything from the source). The terms in the text are provided to Lucene as a token steam with a keyword analyzer.\nIn Lucene, this token stream is converted this via a longish call stack into a terms enum. But this terms enum is pulled from the query that contains the terms that are to be highlighted. In this case we call `GeoPointMultiTermQuery.getTermsEnum(terms)` which wraps the term in a `GeoPointTermsEnum`. This enum tries to convert a prefix coded geo term back to something else but because it is really just the string  \"60,120\" it throws the exception we see. \n\nI am unsure yet how a correct fix would look like but do wonder why we try highlingting on numeric and geo fields at all? If anyone has an opinion let me know.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216948517","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-216948517","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":216948517,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjk0ODUxNw==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-04T17:57:01Z","updated_at":"2016-05-04T17:57:01Z","author_association":"CONTRIBUTOR","body":"I missed @jpountz comment:\n\n> Regardless of this bug, I wonder that we should fail early when highlighting on anything but text fields and/or exclude non-text fields from wildcard matching.\n\nI agree. Will make a pr for that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/217100888","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-217100888","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":217100888,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNzEwMDg4OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-05T08:17:58Z","updated_at":"2016-05-05T08:17:58Z","author_association":"CONTRIBUTOR","body":"@brwe you did something similar before: https://github.com/elastic/elasticsearch/pull/11364 - i would have thought that that PR should have fixed this issue?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/217109572","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-217109572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":217109572,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNzEwOTU3Mg==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-05T09:15:10Z","updated_at":"2016-05-05T09:15:10Z","author_association":"CONTRIBUTOR","body":"@clintongormley Yes you are right. #11364 only addresses problems one gets when the way text is indexed is not compatible with the highlighter used. I do not remember why I did not exclude numeric fields then. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/217634314","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-217634314","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":217634314,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNzYzNDMxNA==","user":{"login":"rodgermoore","id":12231719,"node_id":"MDQ6VXNlcjEyMjMxNzE5","avatar_url":"https://avatars2.githubusercontent.com/u/12231719?v=4","gravatar_id":"","url":"https://api.github.com/users/rodgermoore","html_url":"https://github.com/rodgermoore","followers_url":"https://api.github.com/users/rodgermoore/followers","following_url":"https://api.github.com/users/rodgermoore/following{/other_user}","gists_url":"https://api.github.com/users/rodgermoore/gists{/gist_id}","starred_url":"https://api.github.com/users/rodgermoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rodgermoore/subscriptions","organizations_url":"https://api.github.com/users/rodgermoore/orgs","repos_url":"https://api.github.com/users/rodgermoore/repos","events_url":"https://api.github.com/users/rodgermoore/events{/privacy}","received_events_url":"https://api.github.com/users/rodgermoore/received_events","type":"User","site_admin":false},"created_at":"2016-05-07T13:15:25Z","updated_at":"2016-05-07T13:16:01Z","author_association":"NONE","body":"Great work. Tnx \n\n:sunglasses: \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220244710","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220244710","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220244710,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDI0NDcxMA==","user":{"login":"rodgermoore","id":12231719,"node_id":"MDQ6VXNlcjEyMjMxNzE5","avatar_url":"https://avatars2.githubusercontent.com/u/12231719?v=4","gravatar_id":"","url":"https://api.github.com/users/rodgermoore","html_url":"https://github.com/rodgermoore","followers_url":"https://api.github.com/users/rodgermoore/followers","following_url":"https://api.github.com/users/rodgermoore/following{/other_user}","gists_url":"https://api.github.com/users/rodgermoore/gists{/gist_id}","starred_url":"https://api.github.com/users/rodgermoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rodgermoore/subscriptions","organizations_url":"https://api.github.com/users/rodgermoore/orgs","repos_url":"https://api.github.com/users/rodgermoore/repos","events_url":"https://api.github.com/users/rodgermoore/events{/privacy}","received_events_url":"https://api.github.com/users/rodgermoore/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T07:09:10Z","updated_at":"2016-05-19T07:09:10Z","author_association":"NONE","body":"This is not fixed in 2.3.3 yet, correct?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220245373","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220245373","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220245373,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDI0NTM3Mw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T07:13:30Z","updated_at":"2016-05-19T07:13:30Z","author_association":"CONTRIBUTOR","body":"@rodgermoore It should be fixed in 2.3.3, can you still reproduce the problem?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220300797","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220300797","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220300797,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMwMDc5Nw==","user":{"login":"rodgermoore","id":12231719,"node_id":"MDQ6VXNlcjEyMjMxNzE5","avatar_url":"https://avatars2.githubusercontent.com/u/12231719?v=4","gravatar_id":"","url":"https://api.github.com/users/rodgermoore","html_url":"https://github.com/rodgermoore","followers_url":"https://api.github.com/users/rodgermoore/followers","following_url":"https://api.github.com/users/rodgermoore/following{/other_user}","gists_url":"https://api.github.com/users/rodgermoore/gists{/gist_id}","starred_url":"https://api.github.com/users/rodgermoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rodgermoore/subscriptions","organizations_url":"https://api.github.com/users/rodgermoore/orgs","repos_url":"https://api.github.com/users/rodgermoore/repos","events_url":"https://api.github.com/users/rodgermoore/events{/privacy}","received_events_url":"https://api.github.com/users/rodgermoore/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T11:44:32Z","updated_at":"2016-05-19T11:44:32Z","author_association":"NONE","body":"Ubuntu 14.04-04\nElasticsearch 2.3.3\nKibana 4.5.1\nJVM 1.8.0_66\n\nI am still able to reproduce this error in Kibana 4.5.1. I have a dashboard with a search panel with highlighting enabled. On the same Dashboard I have a tile map and after selecting an area in this map using the select function (draw a rectangle) I got the \"Invalid shift value (xx) in prefixCoded bytes (is encoded value really a geo point?)\" error.\n\nWhen I alter the json settings file of the search panel and remove highlighting the error does not pop-up.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220318549","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220318549","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220318549,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMxODU0OQ==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T13:07:51Z","updated_at":"2016-05-19T13:07:51Z","author_association":"CONTRIBUTOR","body":"@rodgermoore I cannot reproduce this but I might do something different from you. Here is my dashboard:\n\n![image](https://cloud.githubusercontent.com/assets/4320215/15393472/bd2b4cf2-1dcd-11e6-8ac1-cf6ba5e995b7.png)\n\nIs that what you did?\nCan you attach the whole stacktrace from the elasticsearch logs again? If you did not change the logging config the full search request should be in there. Also, if you can please add an example document.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220319750","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220319750","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220319750,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMxOTc1MA==","user":{"login":"rodgermoore","id":12231719,"node_id":"MDQ6VXNlcjEyMjMxNzE5","avatar_url":"https://avatars2.githubusercontent.com/u/12231719?v=4","gravatar_id":"","url":"https://api.github.com/users/rodgermoore","html_url":"https://github.com/rodgermoore","followers_url":"https://api.github.com/users/rodgermoore/followers","following_url":"https://api.github.com/users/rodgermoore/following{/other_user}","gists_url":"https://api.github.com/users/rodgermoore/gists{/gist_id}","starred_url":"https://api.github.com/users/rodgermoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rodgermoore/subscriptions","organizations_url":"https://api.github.com/users/rodgermoore/orgs","repos_url":"https://api.github.com/users/rodgermoore/repos","events_url":"https://api.github.com/users/rodgermoore/events{/privacy}","received_events_url":"https://api.github.com/users/rodgermoore/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T13:12:50Z","updated_at":"2016-05-19T13:12:50Z","author_association":"NONE","body":"I see you used \"text:blah\". I did not enter a search at all (so used the default wildcard) and then did the aggregation on the tile map. This resulted in the error. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220320747","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220320747","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220320747,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMyMDc0Nw==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T13:16:46Z","updated_at":"2016-05-19T13:16:46Z","author_association":"CONTRIBUTOR","body":"I can remove the query and still get a result. Can you please attach the relevant part of the elasticsearch log? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220326277","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220326277","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220326277,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMyNjI3Nw==","user":{"login":"rodgermoore","id":12231719,"node_id":"MDQ6VXNlcjEyMjMxNzE5","avatar_url":"https://avatars2.githubusercontent.com/u/12231719?v=4","gravatar_id":"","url":"https://api.github.com/users/rodgermoore","html_url":"https://github.com/rodgermoore","followers_url":"https://api.github.com/users/rodgermoore/followers","following_url":"https://api.github.com/users/rodgermoore/following{/other_user}","gists_url":"https://api.github.com/users/rodgermoore/gists{/gist_id}","starred_url":"https://api.github.com/users/rodgermoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rodgermoore/subscriptions","organizations_url":"https://api.github.com/users/rodgermoore/orgs","repos_url":"https://api.github.com/users/rodgermoore/repos","events_url":"https://api.github.com/users/rodgermoore/events{/privacy}","received_events_url":"https://api.github.com/users/rodgermoore/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T13:37:15Z","updated_at":"2016-05-19T13:45:06Z","author_association":"NONE","body":"Here you go:\n\n```\n[2016-05-19 15:23:08,270][DEBUG][action.search            ] [Black King] All shards failed for phase: [query_fetch]\nRemoteTransportException[[Black King][192.168.48.18:9300][indices:data/read/search[phase/query+fetch]]]; nested: FetchPhaseExecutionException[Fetch Failed [Failed to highlight field [tags.nl]]]; nested: NumberFormatException[Invalid shift value (115) in prefixCoded bytes (is encoded value really a geo point?)];\nCaused by: FetchPhaseExecutionException[Fetch Failed [Failed to highlight field [tags.nl]]]; nested: NumberFormatException[Invalid shift value (115) in prefixCoded bytes (is encoded value really a geo point?)];\n    at org.elasticsearch.search.highlight.PlainHighlighter.highlight(PlainHighlighter.java:123)\n    at org.elasticsearch.search.highlight.HighlightPhase.hitExecute(HighlightPhase.java:140)\n    at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:188)\n    at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:480)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryFetchTransportHandler.messageReceived(SearchServiceTransportAction.java:392)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryFetchTransportHandler.messageReceived(SearchServiceTransportAction.java:389)\n    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NumberFormatException: Invalid shift value (115) in prefixCoded bytes (is encoded value really a geo point?)\n    at org.apache.lucene.spatial.util.GeoEncodingUtils.getPrefixCodedShift(GeoEncodingUtils.java:134)\n    at org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum.accept(GeoPointPrefixTermsEnum.java:219)\n    at org.apache.lucene.index.FilteredTermsEnum.next(FilteredTermsEnum.java:232)\n    at org.apache.lucene.search.TermCollectingRewrite.collectTerms(TermCollectingRewrite.java:67)\n    at org.apache.lucene.search.ScoringRewrite.rewrite(ScoringRewrite.java:108)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.extract(WeightedSpanTermExtractor.java:220)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.extract(WeightedSpanTermExtractor.java:227)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.extract(WeightedSpanTermExtractor.java:113)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.extract(WeightedSpanTermExtractor.java:113)\n    at org.apache.lucene.search.highlight.WeightedSpanTermExtractor.getWeightedSpanTerms(WeightedSpanTermExtractor.java:505)\n    at org.apache.lucene.search.highlight.QueryScorer.initExtractor(QueryScorer.java:218)\n    at org.apache.lucene.search.highlight.QueryScorer.init(QueryScorer.java:186)\n    at org.apache.lucene.search.highlight.Highlighter.getBestTextFragments(Highlighter.java:195)\n    at org.elasticsearch.search.highlight.PlainHighlighter.highlight(PlainHighlighter.java:108)\n    ... 12 more\n```\n\nWe are using dynamic mapping and we dynamically analyse all string fields using the Dutch language analyzer. All string fields get a non analyzed field: \"field.raw\" and a Dutch analyzed field \"field.nl\". \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220328929","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220328929","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220328929,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMyODkyOQ==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T13:46:59Z","updated_at":"2016-05-19T13:46:59Z","author_association":"CONTRIBUTOR","body":"Ah...I was hoping to get the actual request but it is not in the stacktrace after all. Can you also add the individual requests from the panels in your dashboard (in the spy tab) and a screenshot so I can see what the geo bounding box filter filters on? I could then try to reconstruct the request.\n\nAlso, are you sure you upgraded all nodes in the cluster? Check with `curl -XGET \"http://hostname:port/_nodes\"`. Would be great if you could add the output of that here too just to be sure. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220337833","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220337833","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220337833,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMzNzgzMw==","user":{"login":"lemig","id":78766,"node_id":"MDQ6VXNlcjc4NzY2","avatar_url":"https://avatars1.githubusercontent.com/u/78766?v=4","gravatar_id":"","url":"https://api.github.com/users/lemig","html_url":"https://github.com/lemig","followers_url":"https://api.github.com/users/lemig/followers","following_url":"https://api.github.com/users/lemig/following{/other_user}","gists_url":"https://api.github.com/users/lemig/gists{/gist_id}","starred_url":"https://api.github.com/users/lemig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lemig/subscriptions","organizations_url":"https://api.github.com/users/lemig/orgs","repos_url":"https://api.github.com/users/lemig/repos","events_url":"https://api.github.com/users/lemig/events{/privacy}","received_events_url":"https://api.github.com/users/lemig/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T14:17:36Z","updated_at":"2016-05-19T14:17:36Z","author_association":"NONE","body":"I have got the exact same issue. I am running 2.3.3. All my nodes (1) are upgraded.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220345434","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220345434","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220345434,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDM0NTQzNA==","user":{"login":"lemig","id":78766,"node_id":"MDQ6VXNlcjc4NzY2","avatar_url":"https://avatars1.githubusercontent.com/u/78766?v=4","gravatar_id":"","url":"https://api.github.com/users/lemig","html_url":"https://github.com/lemig","followers_url":"https://api.github.com/users/lemig/followers","following_url":"https://api.github.com/users/lemig/following{/other_user}","gists_url":"https://api.github.com/users/lemig/gists{/gist_id}","starred_url":"https://api.github.com/users/lemig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lemig/subscriptions","organizations_url":"https://api.github.com/users/lemig/orgs","repos_url":"https://api.github.com/users/lemig/repos","events_url":"https://api.github.com/users/lemig/events{/privacy}","received_events_url":"https://api.github.com/users/lemig/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T14:42:02Z","updated_at":"2016-05-19T14:42:02Z","author_association":"NONE","body":"<img width=\"1676\" alt=\"screen shot 2016-05-19 at 16 29 15\" src=\"https://cloud.githubusercontent.com/assets/78766/15397413/7858191c-1de0-11e6-802b-773f4a7ecf79.png\">\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220345495","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220345495","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220345495,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDM0NTQ5NQ==","user":{"login":"rodgermoore","id":12231719,"node_id":"MDQ6VXNlcjEyMjMxNzE5","avatar_url":"https://avatars2.githubusercontent.com/u/12231719?v=4","gravatar_id":"","url":"https://api.github.com/users/rodgermoore","html_url":"https://github.com/rodgermoore","followers_url":"https://api.github.com/users/rodgermoore/followers","following_url":"https://api.github.com/users/rodgermoore/following{/other_user}","gists_url":"https://api.github.com/users/rodgermoore/gists{/gist_id}","starred_url":"https://api.github.com/users/rodgermoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rodgermoore/subscriptions","organizations_url":"https://api.github.com/users/rodgermoore/orgs","repos_url":"https://api.github.com/users/rodgermoore/repos","events_url":"https://api.github.com/users/rodgermoore/events{/privacy}","received_events_url":"https://api.github.com/users/rodgermoore/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T14:42:12Z","updated_at":"2016-05-19T14:42:12Z","author_association":"NONE","body":"Here you go.\n\nTile Map Query:\n\n```\n{\n  \"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"query_string\": {\n          \"analyze_wildcard\": true,\n          \"query\": \"*\"\n        }\n      },\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"geo_bounding_box\": {\n                \"SomeGeoField\": {\n                  \"top_left\": {\n                    \"lat\": REMOVED,\n                    \"lon\": REMOVED\n                  },\n                  \"bottom_right\": {\n                    \"lat\": REMOVED,\n                    \"lon\": REMOVED\n                  }\n                }\n              },\n              \"$state\": {\n                \"store\": \"appState\"\n              }\n            },\n            {\n              \"query\": {\n                \"query_string\": {\n                  \"query\": \"*\",\n                  \"analyze_wildcard\": true\n                }\n              }\n            },\n            {\n              \"range\": {\n                \"@timestamp\": {\n                  \"gte\": 1458485686484,\n                  \"lte\": 1463666086484,\n                  \"format\": \"epoch_millis\"\n                }\n              }\n            }\n          ],\n          \"must_not\": []\n        }\n      }\n    }\n  },\n  \"size\": 0,\n  \"aggs\": {\n    \"2\": {\n      \"geohash_grid\": {\n        \"field\": \"SomeGeoField\",\n        \"precision\": 5\n      }\n    }\n  }\n}\n```\n\nI'm using a single node cluster, here's the info:\n\n```\n{\n  \"cluster_name\": \"elasticsearch\",\n  \"nodes\": {\n    \"RtBthRfeSOSud1XfRRAkSA\": {\n      \"name\": \"Black King\",\n      \"transport_address\": \"192.168.48.18:9300\",\n      \"host\": \"192.168.48.18\",\n      \"ip\": \"192.168.48.18\",\n      \"version\": \"2.3.3\",\n      \"build\": \"218bdf1\",\n      \"http_address\": \"192.168.48.18:9200\",\n      \"settings\": {\n        \"pidfile\": \"/var/run/elasticsearch/elasticsearch.pid\",\n        \"cluster\": {\n          \"name\": \"elasticsearch\"\n        },\n        \"path\": {\n          \"conf\": \"/etc/elasticsearch\",\n          \"data\": \"/var/lib/elasticsearch\",\n          \"logs\": \"/var/log/elasticsearch\",\n          \"home\": \"/usr/share/elasticsearch\",\n          \"repo\": [\n            \"/home/somename/es_backups\"\n          ]\n        },\n        \"name\": \"Black King\",\n        \"client\": {\n          \"type\": \"node\"\n        },\n        \"foreground\": \"false\",\n        \"config\": {\n          \"ignore_system_properties\": \"true\"\n        },\n        \"network\": {\n          \"host\": \"0.0.0.0\"\n        }\n      },\n      \"os\": {\n        \"refresh_interval_in_millis\": 1000,\n        \"name\": \"Linux\",\n        \"arch\": \"amd64\",\n        \"version\": \"3.19.0-59-generic\",\n        \"available_processors\": 8,\n        \"allocated_processors\": 8\n      },\n      \"process\": {\n        \"refresh_interval_in_millis\": 1000,\n        \"id\": 1685,\n        \"mlockall\": false\n      },\n      \"jvm\": {\n        \"pid\": 1685,\n        \"version\": \"1.8.0_66\",\n        \"vm_name\": \"Java HotSpot(TM) 64-Bit Server VM\",\n        \"vm_version\": \"25.66-b17\",\n        \"vm_vendor\": \"Oracle Corporation\",\n        \"start_time_in_millis\": 1463663018422,\n        \"mem\": {\n          \"heap_init_in_bytes\": 6442450944,\n          \"heap_max_in_bytes\": 6372720640,\n          \"non_heap_init_in_bytes\": 2555904,\n          \"non_heap_max_in_bytes\": 0,\n          \"direct_max_in_bytes\": 6372720640\n        },\n        \"gc_collectors\": [\n          \"ParNew\",\n          \"ConcurrentMarkSweep\"\n        ],\n        \"memory_pools\": [\n          \"Code Cache\",\n          \"Metaspace\",\n          \"Compressed Class Space\",\n          \"Par Eden Space\",\n          \"Par Survivor Space\",\n          \"CMS Old Gen\"\n        ],\n        \"using_compressed_ordinary_object_pointers\": \"true\"\n      },\n      \"thread_pool\": {\n        \"force_merge\": {\n          \"type\": \"fixed\",\n          \"min\": 1,\n          \"max\": 1,\n          \"queue_size\": -1\n        },\n        \"percolate\": {\n          \"type\": \"fixed\",\n          \"min\": 8,\n          \"max\": 8,\n          \"queue_size\": 1000\n        },\n        \"fetch_shard_started\": {\n          \"type\": \"scaling\",\n          \"min\": 1,\n          \"max\": 16,\n          \"keep_alive\": \"5m\",\n          \"queue_size\": -1\n        },\n        \"listener\": {\n          \"type\": \"fixed\",\n          \"min\": 4,\n          \"max\": 4,\n          \"queue_size\": -1\n        },\n        \"index\": {\n          \"type\": \"fixed\",\n          \"min\": 8,\n          \"max\": 8,\n          \"queue_size\": 200\n        },\n        \"refresh\": {\n          \"type\": \"scaling\",\n          \"min\": 1,\n          \"max\": 4,\n          \"keep_alive\": \"5m\",\n          \"queue_size\": -1\n        },\n        \"suggest\": {\n          \"type\": \"fixed\",\n          \"min\": 8,\n          \"max\": 8,\n          \"queue_size\": 1000\n        },\n        \"generic\": {\n          \"type\": \"cached\",\n          \"keep_alive\": \"30s\",\n          \"queue_size\": -1\n        },\n        \"warmer\": {\n          \"type\": \"scaling\",\n          \"min\": 1,\n          \"max\": 4,\n          \"keep_alive\": \"5m\",\n          \"queue_size\": -1\n        },\n        \"search\": {\n          \"type\": \"fixed\",\n          \"min\": 13,\n          \"max\": 13,\n          \"queue_size\": 1000\n        },\n        \"flush\": {\n          \"type\": \"scaling\",\n          \"min\": 1,\n          \"max\": 4,\n          \"keep_alive\": \"5m\",\n          \"queue_size\": -1\n        },\n        \"fetch_shard_store\": {\n          \"type\": \"scaling\",\n          \"min\": 1,\n          \"max\": 16,\n          \"keep_alive\": \"5m\",\n          \"queue_size\": -1\n        },\n        \"management\": {\n          \"type\": \"scaling\",\n          \"min\": 1,\n          \"max\": 5,\n          \"keep_alive\": \"5m\",\n          \"queue_size\": -1\n        },\n        \"get\": {\n          \"type\": \"fixed\",\n          \"min\": 8,\n          \"max\": 8,\n          \"queue_size\": 1000\n        },\n        \"bulk\": {\n          \"type\": \"fixed\",\n          \"min\": 8,\n          \"max\": 8,\n          \"queue_size\": 50\n        },\n        \"snapshot\": {\n          \"type\": \"scaling\",\n          \"min\": 1,\n          \"max\": 4,\n          \"keep_alive\": \"5m\",\n          \"queue_size\": -1\n        }\n      },\n      \"transport\": {\n        \"bound_address\": [\n          \"[::]:9300\"\n        ],\n        \"publish_address\": \"192.168.48.18:9300\",\n        \"profiles\": {}\n      },\n      \"http\": {\n        \"bound_address\": [\n          \"[::]:9200\"\n        ],\n        \"publish_address\": \"192.168.48.18:9200\",\n        \"max_content_length_in_bytes\": 104857600\n      },\n      \"plugins\": [],\n      \"modules\": [\n        {\n          \"name\": \"lang-expression\",\n          \"version\": \"2.3.3\",\n          \"description\": \"Lucene expressions integration for Elasticsearch\",\n          \"jvm\": true,\n          \"classname\": \"org.elasticsearch.script.expression.ExpressionPlugin\",\n          \"isolated\": true,\n          \"site\": false\n        },\n        {\n          \"name\": \"lang-groovy\",\n          \"version\": \"2.3.3\",\n          \"description\": \"Groovy scripting integration for Elasticsearch\",\n          \"jvm\": true,\n          \"classname\": \"org.elasticsearch.script.groovy.GroovyPlugin\",\n          \"isolated\": true,\n          \"site\": false\n        },\n        {\n          \"name\": \"reindex\",\n          \"version\": \"2.3.3\",\n          \"description\": \"_reindex and _update_by_query APIs\",\n          \"jvm\": true,\n          \"classname\": \"org.elasticsearch.index.reindex.ReindexPlugin\",\n          \"isolated\": true,\n          \"site\": false\n        }\n      ]\n    }\n  }\n}\n```\n\nScreenshot, I had to clear out the data:\n\n![error_es](https://cloud.githubusercontent.com/assets/12231719/15397399/668a374c-1de0-11e6-903d-f929a2d9f0b2.PNG)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220346518","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220346518","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220346518,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDM0NjUxOA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T14:45:25Z","updated_at":"2016-05-19T14:45:25Z","author_association":"CONTRIBUTOR","body":"@rodgermoore does the query you provided work correctly? You said that it started working once you deleted the highlighting and this query doesn't contain highlighting.  Could you provide the query that doesn't work?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220348346","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220348346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220348346,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDM0ODM0Ng==","user":{"login":"rodgermoore","id":12231719,"node_id":"MDQ6VXNlcjEyMjMxNzE5","avatar_url":"https://avatars2.githubusercontent.com/u/12231719?v=4","gravatar_id":"","url":"https://api.github.com/users/rodgermoore","html_url":"https://github.com/rodgermoore","followers_url":"https://api.github.com/users/rodgermoore/followers","following_url":"https://api.github.com/users/rodgermoore/following{/other_user}","gists_url":"https://api.github.com/users/rodgermoore/gists{/gist_id}","starred_url":"https://api.github.com/users/rodgermoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rodgermoore/subscriptions","organizations_url":"https://api.github.com/users/rodgermoore/orgs","repos_url":"https://api.github.com/users/rodgermoore/repos","events_url":"https://api.github.com/users/rodgermoore/events{/privacy}","received_events_url":"https://api.github.com/users/rodgermoore/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T14:51:27Z","updated_at":"2016-05-19T14:59:11Z","author_association":"NONE","body":"It does has highlighting enabled. This is the json for the search panel: \n\n```\n{\n  \"index\": \"someindex\",\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"*\",\n      \"analyze_wildcard\": true\n    }\n  },\n  \"filter\": [],\n  \"highlight\": {\n    \"pre_tags\": [\n      \"@kibana-highlighted-field@\"\n    ],\n    \"post_tags\": [\n      \"@/kibana-highlighted-field@\"\n    ],\n    \"fields\": {\n      \"*\": {}\n    },\n    \"require_field_match\": false,\n    \"fragment_size\": 2147483647\n  }\n}\n```\n\nI can't show the actual data so I selected to show only the timestamp field in the search panel in the screenshot...\n\nWhen I change the json of the search panel to:\n\n```\n{\n  \"index\": \"someindex\",\n  \"filter\": [],\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"*\",\n      \"analyze_wildcard\": true\n    }\n  }\n}\n```\n\nThe error disappears.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220349441","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220349441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220349441,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDM0OTQ0MQ==","user":{"login":"dellis23","id":1346302,"node_id":"MDQ6VXNlcjEzNDYzMDI=","avatar_url":"https://avatars2.githubusercontent.com/u/1346302?v=4","gravatar_id":"","url":"https://api.github.com/users/dellis23","html_url":"https://github.com/dellis23","followers_url":"https://api.github.com/users/dellis23/followers","following_url":"https://api.github.com/users/dellis23/following{/other_user}","gists_url":"https://api.github.com/users/dellis23/gists{/gist_id}","starred_url":"https://api.github.com/users/dellis23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dellis23/subscriptions","organizations_url":"https://api.github.com/users/dellis23/orgs","repos_url":"https://api.github.com/users/dellis23/repos","events_url":"https://api.github.com/users/dellis23/events{/privacy}","received_events_url":"https://api.github.com/users/dellis23/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T14:54:44Z","updated_at":"2016-05-19T14:54:44Z","author_association":"NONE","body":"If my understanding of the patch is correct, it shouldn't matter whether Kibana is including the highlighting field.  Elasticsearch should only be trying to highlight string fields, even if a wildcard is being used.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220377621","html_url":"https://github.com/elastic/elasticsearch/issues/17537#issuecomment-220377621","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17537","id":220377621,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDM3NzYyMQ==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T16:23:44Z","updated_at":"2016-05-19T16:23:44Z","author_association":"CONTRIBUTOR","body":"Ok, I managed to reproduce it on 2.3.3. It happens with `\"geohash\": true` in the mapping. \n\nSteps are:\n\n```\nDELETE test\nPUT test \n{\n  \"mappings\": {\n    \"doc\": {\n      \"properties\": {\n        \"point\": {\n          \"type\": \"geo_point\",\n          \"geohash\": true\n        }\n      }\n    }\n  }\n}\n\nPUT test/doc/1\n{\n  \"point\": \"60.12,100.34\"\n}\n\nPOST test/_search\n{\n  \"query\": {\n    \"geo_bounding_box\": {\n      \"point\": {\n        \"top_left\": {\n          \"lat\": 61.10078883158897,\n          \"lon\": -170.15625\n        },\n        \"bottom_right\": {\n          \"lat\": -64.92354174306496,\n          \"lon\": 118.47656249999999\n        }\n      }\n    }\n  },\n  \"highlight\": {\n    \"fields\": {\n      \"*\": {}\n    }\n  }\n}\n```\n\nSorry, I did not think of that. I work on another fix.\n","performed_via_github_app":null}]