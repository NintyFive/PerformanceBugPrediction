[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/331196058","html_url":"https://github.com/elastic/elasticsearch/issues/25335#issuecomment-331196058","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25335","id":331196058,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMTE5NjA1OA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2017-09-21T15:39:40Z","updated_at":"2017-09-21T15:39:40Z","author_association":"CONTRIBUTOR","body":"The same problem happened on a different test in the same suite today: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+g1gc/4361/consoleFull\r\n\r\nThe test this time was `testAutoExpandNumberReplicas2`.  The failure was:\r\n\r\n```\r\n04:55:03 ERROR   1.68s J1 | UpdateNumberOfReplicasIT.testAutoExpandNumberReplicas2 <<< FAILURES!\r\n04:55:03    > Throwable #1: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=2626, name=elasticsearch[node_s0][clusterApplierService#updateTask][T#1], state=RUNNABLE, group=TGRP-UpdateNumberOfReplicasIT]\r\n04:55:03    > \tat __randomizedtesting.SeedInfo.seed([EAE177A5D6508A23:4C02AB482A80D621]:0)\r\n04:55:03    > Caused by: java.lang.AssertionError\r\n04:55:03    > \tat __randomizedtesting.SeedInfo.seed([EAE177A5D6508A23]:0)\r\n04:55:03    > \tat org.elasticsearch.env.NodeEnvironment.deleteShardDirectoryUnderLock(NodeEnvironment.java:460)\r\n04:55:03    > \tat org.elasticsearch.env.NodeEnvironment.deleteShardDirectorySafe(NodeEnvironment.java:400)\r\n04:55:03    > \tat org.elasticsearch.indices.IndicesService.deleteShardStore(IndicesService.java:710)\r\n04:55:03    > \tat org.elasticsearch.indices.store.IndicesStore$ShardActiveResponseHandler.lambda$allNodesResponded$2(IndicesStore.java:289)\r\n04:55:03    > \tat org.elasticsearch.cluster.service.ClusterApplierService.lambda$runOnApplierThread$0(ClusterApplierService.java:304)\r\n04:55:03    > \tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.apply(ClusterApplierService.java:153)\r\n04:55:03    > \tat org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:397)\r\n04:55:03    > \tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:158)\r\n04:55:03    > \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569)\r\n04:55:03    > \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:247)\r\n04:55:03    > \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:210)\r\n04:55:03    > \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n04:55:03    > \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n04:55:03    > \tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\nSo the assertion that's failing is in the core code rather than the test code, and it's the same as the one that failed when this issue was first raised.\r\n\r\nThe REPRO command is this:\r\n\r\n```\r\ngradle :core:integTest \\\r\n  -Dtests.seed=EAE177A5D6508A23 \\\r\n  -Dtests.class=org.elasticsearch.indices.settings.UpdateNumberOfReplicasIT \\\r\n  -Dtests.method=\"testAutoExpandNumberReplicas2\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.jvm.argline=\"-XX:-UseConcMarkSweepGC -XX:+UseG1GC\" \\\r\n  -Dtests.locale=uk \\\r\n  -Dtests.timezone=America/Mexico_City\r\n```\r\n\r\nThis doesn't reproduce locally for me.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/345868212","html_url":"https://github.com/elastic/elasticsearch/issues/25335#issuecomment-345868212","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25335","id":345868212,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NTg2ODIxMg==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2017-11-20T23:41:43Z","updated_at":"2017-11-20T23:41:43Z","author_association":"CONTRIBUTOR","body":"Another one from testAutoExpandNumberReplicas2 on 6.0\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.0+multijob-unix-compatibility/os=opensuse/359/console\r\n\r\n```\r\nERROR   2.19s J2 | UpdateNumberOfReplicasIT.testAutoExpandNumberReplicas2 <<< FAILURES!\r\n   > Throwable #1: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=682, name=elasticsearch[node_s1][clusterApplierService#updateTask][T#1], state=RUNNABLE, group=TGRP-UpdateNumberOfReplicasIT]\r\n   > \tat __randomizedtesting.SeedInfo.seed([18D24BC80C255C3E:BE319725F0F5003C]:0)\r\n   > Caused by: java.lang.AssertionError\r\n   > \tat __randomizedtesting.SeedInfo.seed([18D24BC80C255C3E]:0)\r\n   > \tat org.elasticsearch.env.NodeEnvironment.deleteShardDirectoryUnderLock(NodeEnvironment.java:460)\r\n   > \tat org.elasticsearch.env.NodeEnvironment.deleteShardDirectorySafe(NodeEnvironment.java:400)\r\n   > \tat org.elasticsearch.indices.IndicesService.deleteShardStore(IndicesService.java:715)\r\n   > \tat org.elasticsearch.indices.store.IndicesStore$ShardActiveResponseHandler.lambda$allNodesResponded$2(IndicesStore.java:289)\r\n   > \tat org.elasticsearch.cluster.service.ClusterApplierService.lambda$runOnApplierThread$0(ClusterApplierService.java:304)\r\n   > \tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.apply(ClusterApplierService.java:153)\r\n   > \tat org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:397)\r\n   > \tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:158)\r\n   > \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569)\r\n   > \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:247)\r\n   > \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:210)\r\n   > \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n   > \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n```\r\ngradle :core:integTest -Dtests.seed=18D24BC80C255C3E -Dtests.class=org.elasticsearch.indices.settings.UpdateNumberOfReplicasIT -Dtests.method=\"testAutoExpandNumberReplicas2\" -Dtests.security.manager=true -Dtests.locale=ga-IE -Dtests.timezone=America/Grand_Turk\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/354297612","html_url":"https://github.com/elastic/elasticsearch/issues/25335#issuecomment-354297612","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25335","id":354297612,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NDI5NzYxMg==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2017-12-28T14:33:41Z","updated_at":"2017-12-28T14:33:41Z","author_association":"CONTRIBUTOR","body":"Another one on master in testAutoExpandNumberReplicas2\r\n\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+arm/839/console\r\n\r\n```\r\n2> java.lang.AssertionError\r\n  2> \tat __randomizedtesting.SeedInfo.seed([ABD1E6FBF4F6DAD6]:0)\r\n  2> \tat org.elasticsearch.env.NodeEnvironment.deleteShardDirectoryUnderLock(NodeEnvironment.java:453)\r\n  2> \tat org.elasticsearch.env.NodeEnvironment.deleteShardDirectorySafe(NodeEnvironment.java:393)\r\n  2> \tat org.elasticsearch.indices.IndicesService.deleteShardStore(IndicesService.java:719)\r\n  2> \tat org.elasticsearch.indices.store.IndicesStore$ShardActiveResponseHandler.lambda$allNodesResponded$2(IndicesStore.java:289)\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService.lambda$runOnApplierThread$0(ClusterApplierService.java:307)\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.apply(ClusterApplierService.java:156)\r\n  1> [2017-12-28T08:17:25,569][INFO ][o.e.n.Node               ] [node_s4] node name [node_s4], node ID [-alex1kJQbaFz0oBIOx0jA]\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:400)\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:161)\r\n  2> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:566)\r\n  1> [2017-12-28T08:17:25,570][INFO ][o.e.n.Node               ] [node_s4] version[7.0.0-alpha1-SNAPSHOT], pid[24476], build[Unknown/Unknown], OS[Linux/4.12.13/aarch64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_151/25.151-b12]\r\n  2> \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244)\r\n  2> \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207)\r\n  1> [2017-12-28T08:17:25,570][INFO ][o.e.n.Node               ] [node_s4] JVM arguments [-Dfile.encoding=UTF8, -ea, -esa, -Xmx512m, -Xms512m, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=/var/lib/jenkins/workspace/elastic+elasticsearch+master+arm/core/build/heapdump, -Dtests.prefix=tests, -Dtests.seed=ABD1E6FBF4F6DAD6, -Dtests.security.manager=true, -Djava.io.tmpdir=./temp, -Dtests.gradle=true, -Dtests.artifact=core, -Dtests.jvms=48, -Djava.awt.headless=true, -Dtests.ifNoTests=fail, -Dtests.task=:core:integTest, -Djna.nosys=true, -Dtests.logger.level=WARN, -Djunit4.childvm.cwd=/var/lib/jenkins/workspace/elastic+elasticsearch+master+arm/core/build/testrun/integTest/J31, -Djunit4.childvm.id=31, -Djunit4.childvm.count=48]\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n  1> [2017-12-28T08:17:25,570][WARN ][o.e.n.Node               ] [node_s4] version [7.0.0-alpha1-SNAPSHOT] is a pre-release version of Elasticsearch and is not suitable for production\r\n  2> \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nReproduce with:\r\n`gradle :core:integTest -Dtests.seed=ABD1E6FBF4F6DAD6 -Dtests.class=org.elasticsearch.indices.settings.UpdateNumberOfReplicasIT -Dtests.method=\"testAutoExpandNumberReplicas2\" -Dtests.security.manager=true -Dtests.jvms=48 -Dtests.locale=da-DK -Dtests.timezone=Mexico/General`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/360827711","html_url":"https://github.com/elastic/elasticsearch/issues/25335#issuecomment-360827711","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25335","id":360827711,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDgyNzcxMQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2018-01-26T16:09:57Z","updated_at":"2018-01-26T16:09:57Z","author_association":"MEMBER","body":"While I wasn't able to reproduce this even running it hundreds of times, I did push a commit to add better assert messages to figure out which path is not being deleted correctly in hopes that it will provide more information if this fails again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/360911693","html_url":"https://github.com/elastic/elasticsearch/issues/25335#issuecomment-360911693","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25335","id":360911693,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDkxMTY5Mw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-01-26T21:40:08Z","updated_at":"2018-01-26T21:40:08Z","author_association":"CONTRIBUTOR","body":"This is a known issue and a duplicate of https://github.com/elastic/elasticsearch/issues/21463\r\nI suggested a fix 18 months ago (https://github.com/elastic/elasticsearch/pull/19338), noone liked it, so we are doomed to struggle with these failures forever.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386872605","html_url":"https://github.com/elastic/elasticsearch/issues/25335#issuecomment-386872605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25335","id":386872605,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Njg3MjYwNQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-05-06T11:29:23Z","updated_at":"2018-05-06T11:29:23Z","author_association":"MEMBER","body":"closing in favour of https://github.com/elastic/elasticsearch/pull/29140","performed_via_github_app":null}]