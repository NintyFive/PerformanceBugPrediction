{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3209","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3209/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3209/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3209/events","html_url":"https://github.com/elastic/elasticsearch/issues/3209","id":15785312,"node_id":"MDU6SXNzdWUxNTc4NTMxMg==","number":3209,"title":"Statistical facet ignores nested documents","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2013-06-20T07:43:52Z","updated_at":"2013-06-20T18:37:18Z","closed_at":"2013-06-20T18:37:18Z","author_association":"MEMBER","active_lock_reason":null,"body":"To reproduce, create a mapping:\n\n```\ncurl -XPUT \"http://localhost:9200/bar/\" -d'\n{\n   \"mappings\": {\n      \"foo\": {\n         \"properties\": {\n            \"accounts\": {\n               \"type\": \"nested\"\n            }\n         }\n      }\n   }\n}'\n```\n\nIndex an object:\n\n```\ncurl -XPOST \"http://localhost:9200/bar/foo\" -d'\n{\n   \"accounts\": [\n      {\n         \"amount\": 1\n      }\n   ]\n}'\n```\n\nAnd run a search:\n\n```\ncurl -XPOST \"http://localhost:9200/bar/_search\" -d'\n{\n   \"facets\": {\n      \"test\": {\n         \"statistical\": {\n            \"field\": \"accounts.amount\"\n         }\n      }\n   },\n   \"size\":0\n}'\n```\n\nThis is the output (note that it did find one document, but not stats on it):\n\n```\n{\n   \"took\": 90,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 1,\n      \"max_score\": 1,\n      \"hits\": []\n   },\n   \"facets\": {\n      \"test\": {\n         \"_type\": \"statistical\",\n         \"count\": 0,\n         \"total\": 0,\n         \"min\": \"Infinity\",\n         \"max\": \"-Infinity\",\n         \"mean\": 0,\n         \"sum_of_squares\": 0,\n         \"variance\": \"NaN\",\n         \"std_deviation\": \"NaN\"\n      }\n   }\n}\n```\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}