{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/49970","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49970/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49970/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49970/events","html_url":"https://github.com/elastic/elasticsearch/issues/49970","id":534525763,"node_id":"MDU6SXNzdWU1MzQ1MjU3NjM=","number":49970,"title":"Too many translog files open, and reach ulimit setting(65535)","user":{"login":"seeIT-52","id":16160751,"node_id":"MDQ6VXNlcjE2MTYwNzUx","avatar_url":"https://avatars1.githubusercontent.com/u/16160751?v=4","gravatar_id":"","url":"https://api.github.com/users/seeIT-52","html_url":"https://github.com/seeIT-52","followers_url":"https://api.github.com/users/seeIT-52/followers","following_url":"https://api.github.com/users/seeIT-52/following{/other_user}","gists_url":"https://api.github.com/users/seeIT-52/gists{/gist_id}","starred_url":"https://api.github.com/users/seeIT-52/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seeIT-52/subscriptions","organizations_url":"https://api.github.com/users/seeIT-52/orgs","repos_url":"https://api.github.com/users/seeIT-52/repos","events_url":"https://api.github.com/users/seeIT-52/events{/privacy}","received_events_url":"https://api.github.com/users/seeIT-52/received_events","type":"User","site_admin":false},"labels":[{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"assignees":[{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2019-12-08T11:08:38Z","updated_at":"2020-02-10T13:26:02Z","closed_at":"2020-02-10T13:26:02Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\nHi, \r\nI found 'too many files open' problem in my ES enviroment.  And I use the commad `ls -al /proc/ES_PID/fd` , found that ES opened particularly large number of translog files.  \r\nAfter some search on this problem , I tried to restart  a runing normally ES (6.6.1).  I found that ，**every time ES is restarted, there will be one more translog file on some shards**. And all the translogs have no operation data, like  below( The server time is incorrect，but I don't think it's concern ):\r\n\r\n![image](https://user-images.githubusercontent.com/16160751/70388387-0419d700-19ec-11ea-8699-6da28123a33f.png)\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 6.6.1, Build: default/tar/1fd8f69/2019-02-13T17:10:04.160291Z, JVM: 1.8.0_60\r\n**Plugins installed**: []\r\nNo Plugins\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_60\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_60-b27)\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nCentos 7.6\r\nLinux 3.10.0-957.5.1.el7.x86_64 #1 SMP Fri Feb 1 14:54:57 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n**Description of the problem including expected versus actual behavior**:\r\nEmpty translog files(no operation data) keep increasing.\r\nOld translog exist beyond 12 hours(index.translog.retention.age = 12h).\r\nI think empty translog files should be deleted or don't creat new translog files.\r\n**Steps to reproduce**:\r\nrestart ES node\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1.  defautl index setting as follow:\r\n`\"settings\":{  \r\n              \"index.number_of_replicas\":\"0\",\r\n              \"index.refresh_interval\":\"10s\",\r\n              \"index.number_of_shards\":\"1\",\r\n              \"index.routing.allocation.require.tag\":\"hot\",\r\n              \"index.indexing.slowlog.level\": \"info\",\r\n              \"index.indexing.slowlog.threshold.index.trace\": \"500ms\",\r\n              \"index.indexing.slowlog.threshold.index.debug\": \"2s\",\r\n              \"index.indexing.slowlog.threshold.index.info\": \"5s\",\r\n              \"index.indexing.slowlog.threshold.index.warn\": \"10s\",\r\n              \"index.search.slowlog.level\": \"info\",\r\n              \"index.search.slowlog.threshold.fetch.trace\": \"200ms\",\r\n              \"index.search.slowlog.threshold.fetch.debug\": \"500ms\",\r\n              \"index.search.slowlog.threshold.fetch.info\": \"800ms\",\r\n              \"index.search.slowlog.threshold.fetch.warn\": \"1s\",\r\n              \"index.search.slowlog.threshold.query.trace\": \"500ms\",\r\n              \"index.search.slowlog.threshold.query.debug\": \"2s\",\r\n              \"index.search.slowlog.threshold.query.info\": \"5s\",\r\n              \"index.search.slowlog.threshold.query.warn\": \"10s\",\r\n               \"index.translog.durability\": \"async\",\r\n               \"index.translog.flush_threshold_size\": \"5000mb\",\r\n               \"index.translog.sync_interval\": \"120s\",\r\n               \"index.mapping.ignore_malformed\": true\r\n   }\r\n`\r\n 2.  Auto create index use the dynamic mapping, and index name is created by date, only the index created today is active. Indices  created before today have no data to index.\r\n 3.  Restart ES, the translog of indices  created before today (no data to index) keep increasing\r\n\r\nIf I missed some configuration， please let me know.\r\nI'd be happy to provide additional details, whatever is needed.\r\n\r\nThanks!\r\n\r\n","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}