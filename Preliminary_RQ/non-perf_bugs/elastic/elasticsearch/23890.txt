{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23890","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23890/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23890/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23890/events","html_url":"https://github.com/elastic/elasticsearch/issues/23890","id":219155423,"node_id":"MDU6SXNzdWUyMTkxNTU0MjM=","number":23890,"title":"Streaming aggregation results on a per shard or segment basis","user":{"login":"hijakk","id":2235149,"node_id":"MDQ6VXNlcjIyMzUxNDk=","avatar_url":"https://avatars1.githubusercontent.com/u/2235149?v=4","gravatar_id":"","url":"https://api.github.com/users/hijakk","html_url":"https://github.com/hijakk","followers_url":"https://api.github.com/users/hijakk/followers","following_url":"https://api.github.com/users/hijakk/following{/other_user}","gists_url":"https://api.github.com/users/hijakk/gists{/gist_id}","starred_url":"https://api.github.com/users/hijakk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hijakk/subscriptions","organizations_url":"https://api.github.com/users/hijakk/orgs","repos_url":"https://api.github.com/users/hijakk/repos","events_url":"https://api.github.com/users/hijakk/events{/privacy}","received_events_url":"https://api.github.com/users/hijakk/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":110557212,"node_id":"MDU6TGFiZWwxMTA1NTcyMTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/high%20hanging%20fruit","name":"high hanging fruit","color":"fc6149","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-04-04T06:49:25Z","updated_at":"2017-04-10T08:15:20Z","closed_at":"2017-04-10T08:15:20Z","author_association":"NONE","active_lock_reason":null,"body":"I am a data scientist working with relatively large volumes of data. One of the consistent complaints I've heard from my colleagues about Elasticsearch is the aggregations interface and the inability to scan/scroll for large volumes of results from, say, a terms aggregation.\r\n\r\nIf it's possible, I think a low level interface that would allow users to get complete results back from individual shards or segments, providing the users the ability to script their own offline \"reduce\" function would be extremely valuable. \r\n\r\nThe primary issue I've seen is, say I've got a year's worth of the twitter 1% stream - maybe a billion tweets. I want to get a list of everybody that's spoken more than one language where one of the languages is English. \r\n\r\nAs it is, this aggregation is too large to run in an exhaustive fashion. If I was able to get back that for segment XYZ, users Bob, Fred and Jerry spoke languages English, French and Tamil at rates A, B and C, I can write that to disk for later analysis offline - I don't truly need ES to crunch all the results down for me, but it can get me summaries of chunks of information much more quickly than moving through the data one record at a time.\r\n\r\nCurrently, when we have a question like this and the data is in Elasticsearch, we have to set up a scan/scroll and manually aggregate in Python or similar. This takes a long time. Is access to the component results of an aggregation, on a very low level before the final \"reduce\" operation something that would be possible?","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}