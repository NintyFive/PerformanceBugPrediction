{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36177","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36177/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36177/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36177/events","html_url":"https://github.com/elastic/elasticsearch/issues/36177","id":386991399,"node_id":"MDU6SXNzdWUzODY5OTEzOTk=","number":36177,"title":"Watcher payload possibly broken in master","user":{"login":"andrewvc","id":131427,"node_id":"MDQ6VXNlcjEzMTQyNw==","avatar_url":"https://avatars2.githubusercontent.com/u/131427?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewvc","html_url":"https://github.com/andrewvc","followers_url":"https://api.github.com/users/andrewvc/followers","following_url":"https://api.github.com/users/andrewvc/following{/other_user}","gists_url":"https://api.github.com/users/andrewvc/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewvc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewvc/subscriptions","organizations_url":"https://api.github.com/users/andrewvc/orgs","repos_url":"https://api.github.com/users/andrewvc/repos","events_url":"https://api.github.com/users/andrewvc/events{/privacy}","received_events_url":"https://api.github.com/users/andrewvc/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-12-03T20:28:12Z","updated_at":"2019-02-07T10:28:56Z","closed_at":"2018-12-18T09:11:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"[This watch](https://gist.github.com/andrewvc/0f94d6a9635672a3524cfd7d609d7be5) works in `6.5.1`, but does not work on master. The key issue seems to be that iterating over aggregations is broken in master. The log output should contain a list of all matched bucket keys when it fires, but instead logs nothing in the space where the data should be.\r\n\r\nPlease see the watch linked above.  I've included a sample Heartbeat event that triggers the watch below:\r\n\r\n```\r\n{\r\n  \"_index\": \"heartbeat-6.5.0-2018.12.03\",\r\n  \"_type\": \"doc\",\r\n  \"_id\": \"3pfCdWcBzOHIWwLnTiHd\",\r\n  \"_version\": 1,\r\n  \"_score\": null,\r\n  \"_source\": {\r\n    \"@timestamp\": \"2018-12-03T20:28:46.472Z\",\r\n    \"resolve\": {\r\n      \"host\": \"www.elastic.co\",\r\n      \"ip\": \"151.101.194.217\",\r\n      \"rtt\": {\r\n        \"us\": 1667\r\n      }\r\n    },\r\n    \"tcp\": {\r\n      \"port\": 443,\r\n      \"rtt\": {\r\n        \"connect\": {\r\n          \"us\": 6037\r\n        }\r\n      }\r\n    },\r\n    \"tls\": {\r\n      \"certificate_not_valid_before\": \"2018-11-13T14:03:14.000Z\",\r\n      \"certificate_not_valid_after\": \"2019-10-12T00:32:18.000Z\",\r\n      \"rtt\": {\r\n        \"handshake\": {\r\n          \"us\": 15432\r\n        }\r\n      }\r\n    },\r\n    \"beat\": {\r\n      \"name\": \"avce.local\",\r\n      \"hostname\": \"avce.local\",\r\n      \"version\": \"6.5.0\"\r\n    },\r\n    \"host\": {\r\n      \"name\": \"avce.local\",\r\n      \"architecture\": \"x86_64\",\r\n      \"os\": {\r\n        \"platform\": \"darwin\",\r\n        \"version\": \"10.14.1\",\r\n        \"family\": \"darwin\",\r\n        \"build\": \"18B75\"\r\n      }\r\n    },\r\n    \"http\": {\r\n      \"url\": \"https://www.elastic.co\",\r\n      \"rtt\": {\r\n        \"write_request\": {\r\n          \"us\": 46\r\n        },\r\n        \"response_header\": {\r\n          \"us\": 209424\r\n        },\r\n        \"validate\": {\r\n          \"us\": 209439\r\n        },\r\n        \"content\": {\r\n          \"us\": 14\r\n        },\r\n        \"total\": {\r\n          \"us\": 231018\r\n        }\r\n      },\r\n      \"response\": {\r\n        \"status_code\": 200\r\n      }\r\n    },\r\n    \"monitor\": {\r\n      \"name\": \"http\",\r\n      \"type\": \"http\",\r\n      \"host\": \"www.elastic.co\",\r\n      \"ip\": \"151.101.194.217\",\r\n      \"duration\": {\r\n        \"us\": 232856\r\n      },\r\n      \"status\": \"up\",\r\n      \"scheme\": \"https\",\r\n      \"id\": \"http@https://www.elastic.co\"\r\n    }\r\n  },\r\n  \"fields\": {\r\n    \"tls.certificate_not_valid_after\": [\r\n      \"2019-10-12T00:32:18.000Z\"\r\n    ],\r\n    \"tls.certificate_not_valid_before\": [\r\n      \"2018-11-13T14:03:14.000Z\"\r\n    ],\r\n    \"@timestamp\": [\r\n      \"2018-12-03T20:28:46.472Z\"\r\n    ]\r\n  },\r\n  \"sort\": [\r\n    1543868926472\r\n  ]\r\n}\r\n```","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}