{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3340","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3340/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3340/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3340/events","html_url":"https://github.com/elastic/elasticsearch/issues/3340","id":16809333,"node_id":"MDU6SXNzdWUxNjgwOTMzMw==","number":3340,"title":"Analysis: Add the pattern_capture token filter","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"labels":[{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":45109570,"node_id":"MDU6TGFiZWw0NTEwOTU3MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.3","name":"v0.90.3","color":"DDDDDD","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2013-07-16T13:30:42Z","updated_at":"2013-08-11T07:04:10Z","closed_at":"2013-07-16T16:20:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The `pattern_capture` token filter, unlike the `pattern` tokenizer, emits a token for every capture group in the regular expression.  Patterns are not anchored to the beginning and end of the string, so each pattern can match multiple times, and matches are allowed to overlap.\n\nFor instance a pattern like :\n\n```\n\"(([a-z]+)(\\d*))\"\n```\n\nwhen matched against: \n\n```\n\"abc123def456\"\n```\n\nwould produce the tokens: [ `abc123`, `abc`, `123`, `def456`, `def`, `456` ]\n\nIf `preserve_original` is set to `true` then it would also emit the original token: `abc123def456`.\n\nThis is particularly useful for indexing text like camel-case code, eg `stripHTML` where a user may search for `\"strip html\"` or `\"striphtml\"`:\n\n```\ncurl -XPUT localhost:9200/test/  -d '\n{\n   \"settings\" : {\n      \"analysis\" : {\n         \"filter\" : {\n            \"code\" : {\n               \"type\" : \"pattern_capture\",\n               \"preserve_original\" : 1,\n               \"patterns\" : [\n                  \"(\\\\p{Ll}+|\\\\p{Lu}\\\\p{Ll}+|\\\\p{Lu}+)\",\n                  \"(\\\\d+)\"\n               ]\n            }\n         },\n         \"analyzer\" : {\n            \"code\" : {\n               \"tokenizer\" : \"pattern\",\n               \"filter\" : [ \"code\", \"lowercase\" ]\n            }\n         }\n      }\n   }\n}\n'\n```\n\nWhen used to analyze the text `\"import static org.apache.commons.lang.StringEscapeUtils.escapeHtml\"`, this emits the tokens: [  `import`, `static`, `org`, `apache`, `commons`, `lang`, `stringescapeutils`, `string`, `escape`, `utils`, `escapehtml`, `escape`, `html` ]\n\nAnother example is analyzing email addresses:\n\n```\ncurl -XPUT localhost:9200/test/  -d '\n{\n   \"settings\" : {\n      \"analysis\" : {\n         \"filter\" : {\n            \"email\" : {\n               \"type\" : \"pattern_capture\",\n               \"preserve_original\" : 1,\n               \"patterns\" : [\n                  \"(\\\\w+)\",\n                  \"(\\\\p{L}+)\",\n                  \"(\\\\d+)\",\n                  \"@(.+)\"\n               ]\n            }\n         },\n         \"analyzer\" : {\n            \"email\" : {\n               \"tokenizer\" : \"uax_url_email\",\n               \"filter\" : [ \"email\", \"lowercase\",  \"unique\" ]\n            }\n         }\n      }\n   }\n}\n'\n```\n\nWhen the above analyzer is used on an email address like `john-smith_123@foo-bar.com` it would produce the following tokens: [`john-smith_123@foo-bar.com`, `john`, `smith_123`, `smith`, `123`, `foo`, `foo-bar.com`, `bar`, `com`]\n\nMultiple patterns are required to allow overlapping captures, but also means that patterns are less dense and easier to understand.\n\nNote: All tokens are emitted in the same position, and with the same character offsets, so when combined with highlighting, the whole original token will be highlighted, not just the matching subset.  For instance, querying the above email address for `\"smith\"` would highlight `\"<em>john-smith_123@foo-bar.com</em>\"`, not `\"john-<em>smith</em>_123@foo-bar.com\"`\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}