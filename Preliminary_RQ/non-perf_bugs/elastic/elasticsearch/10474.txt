{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10474","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10474/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10474/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10474/events","html_url":"https://github.com/elastic/elasticsearch/issues/10474","id":67095451,"node_id":"MDU6SXNzdWU2NzA5NTQ1MQ==","number":10474,"title":"[ELK] Elasticsearch errors when i add a scripted field in Kibana 4","user":{"login":"Nurza","id":1944215,"node_id":"MDQ6VXNlcjE5NDQyMTU=","avatar_url":"https://avatars3.githubusercontent.com/u/1944215?v=4","gravatar_id":"","url":"https://api.github.com/users/Nurza","html_url":"https://github.com/Nurza","followers_url":"https://api.github.com/users/Nurza/followers","following_url":"https://api.github.com/users/Nurza/following{/other_user}","gists_url":"https://api.github.com/users/Nurza/gists{/gist_id}","starred_url":"https://api.github.com/users/Nurza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Nurza/subscriptions","organizations_url":"https://api.github.com/users/Nurza/orgs","repos_url":"https://api.github.com/users/Nurza/repos","events_url":"https://api.github.com/users/Nurza/events{/privacy}","received_events_url":"https://api.github.com/users/Nurza/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-04-08T10:08:10Z","updated_at":"2015-04-08T10:58:05Z","closed_at":"2015-04-08T10:58:05Z","author_association":"NONE","active_lock_reason":null,"body":"Hello, I'm using ELK with kibana 4.0.2 and elasticsearch 1.4.4 on ubuntu 14.04 and java version \"1.8.0_40\"\nJava(TM) SE Runtime Environment (build 1.8.0_40-b25).\n\nWhen I want to create a scripted field (example: `doc['status'].value+42`) the web ui displays the message: `Discover: An error occurred with your request. Reset your inputs and try again.`\n\nAnd in `/var/log/elasticsearch/elasticsearch.log`:\n\n```\n[2015-04-08 11:59:16,294][DEBUG][action.search.type       ] [Moonstone] [logstash-2015.04.08][4], node[3hsQHmeVRo2hGHdFbiG_-Q], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@45f7b369] lastShard [true]\norg.elasticsearch.search.SearchParseException: [logstash-2015.04.08][4]: query[ConstantScore(BooleanFilter(+QueryWrapperFilter(host:codemanager) +QueryWrapperFilter(ConstantScore(cache(_type:nginx))) +cache(@timestamp:[1428486256162 TO 1428487156162])))],from[-1],size[500],sort[<custom:\"@timestamp\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@51d592b6>!]: Parse Failure [Failed to parse source [{\"query\":{\"filtered\":{\"query\":{\"query_string\":{\"analyze_wildcard\":true,\"query\":\"*\"}},\"filter\":{\"bool\":{\"must\":[{\"query\":{\"match\":{\"host\":{\"query\":\"codemanager\",\"type\":\"phrase\"}}}},{\"query\":{\"match\":{\"_type\":{\"query\":\"nginx\",\"type\":\"phrase\"}}}},{\"range\":{\"@timestamp\":{\"gte\":1428486256162,\"lte\":1428487156162}}}],\"must_not\":[]}}}},\"highlight\":{\"pre_tags\":[\"@kibana-highlighted-field@\"],\"post_tags\":[\"@/kibana-highlighted-field@\"],\"fields\":{\"*\":{}}},\"size\":500,\"sort\":{\"@timestamp\":\"desc\"},\"aggs\":{\"2\":{\"date_histogram\":{\"field\":\"@timestamp\",\"interval\":\"30s\",\"pre_zone\":\"+02:00\",\"pre_zone_adjust_large_interval\":true,\"min_doc_count\":0,\"extended_bounds\":{\"min\":1428486256161,\"max\":1428487156161}}}},\"fields\":[\"*\",\"_source\"],\"script_fields\":{\"lala\":{\"script\":\"doc['status'].value+42\",\"lang\":\"expression\"}},\"fielddata_fields\":[\"@timestamp\",\"time\"]}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:687)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:543)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:515)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:277)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.expression.ExpressionScriptCompilationException: Field [status] used in expression must be numeric\n    at org.elasticsearch.script.expression.ExpressionScriptEngineService.search(ExpressionScriptEngineService.java:131)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:511)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:515)\n    at org.elasticsearch.search.fetch.script.ScriptFieldsParseElement.parse(ScriptFieldsParseElement.java:82)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:671)\n    ... 9 more\n[2015-04-08 11:59:16,295][DEBUG][action.search.type       ] [Moonstone] [logstash-2015.04.08][1], node[3hsQHmeVRo2hGHdFbiG_-Q], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@45f7b369]\norg.elasticsearch.search.SearchParseException: [logstash-2015.04.08][1]: query[ConstantScore(BooleanFilter(+QueryWrapperFilter(host:codemanager) +QueryWrapperFilter(ConstantScore(cache(_type:nginx))) +cache(@timestamp:[1428486256162 TO 1428487156162])))],from[-1],size[500],sort[<custom:\"@timestamp\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@210e49a>!]: Parse Failure [Failed to parse source [{\"query\":{\"filtered\":{\"query\":{\"query_string\":{\"analyze_wildcard\":true,\"query\":\"*\"}},\"filter\":{\"bool\":{\"must\":[{\"query\":{\"match\":{\"host\":{\"query\":\"codemanager\",\"type\":\"phrase\"}}}},{\"query\":{\"match\":{\"_type\":{\"query\":\"nginx\",\"type\":\"phrase\"}}}},{\"range\":{\"@timestamp\":{\"gte\":1428486256162,\"lte\":1428487156162}}}],\"must_not\":[]}}}},\"highlight\":{\"pre_tags\":[\"@kibana-highlighted-field@\"],\"post_tags\":[\"@/kibana-highlighted-field@\"],\"fields\":{\"*\":{}}},\"size\":500,\"sort\":{\"@timestamp\":\"desc\"},\"aggs\":{\"2\":{\"date_histogram\":{\"field\":\"@timestamp\",\"interval\":\"30s\",\"pre_zone\":\"+02:00\",\"pre_zone_adjust_large_interval\":true,\"min_doc_count\":0,\"extended_bounds\":{\"min\":1428486256161,\"max\":1428487156161}}}},\"fields\":[\"*\",\"_source\"],\"script_fields\":{\"lala\":{\"script\":\"doc['status'].value+42\",\"lang\":\"expression\"}},\"fielddata_fields\":[\"@timestamp\",\"time\"]}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:687)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:543)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:515)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:277)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.expression.ExpressionScriptCompilationException: Field [status] used in expression must be numeric\n    at org.elasticsearch.script.expression.ExpressionScriptEngineService.search(ExpressionScriptEngineService.java:131)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:511)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:515)\n    at org.elasticsearch.search.fetch.script.ScriptFieldsParseElement.parse(ScriptFieldsParseElement.java:82)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:671)\n    ... 9 more\n[2015-04-08 11:59:16,295][DEBUG][action.search.type       ] [Moonstone] All shards failed for phase: [query]\n[2015-04-08 11:59:16,296][DEBUG][action.search.type       ] [Moonstone] [logstash-2015.04.08][3], node[3hsQHmeVRo2hGHdFbiG_-Q], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@45f7b369] lastShard [true]\norg.elasticsearch.search.SearchParseException: [logstash-2015.04.08][3]: query[ConstantScore(BooleanFilter(+QueryWrapperFilter(host:codemanager) +QueryWrapperFilter(ConstantScore(cache(_type:nginx))) +cache(@timestamp:[1428486256162 TO 1428487156162])))],from[-1],size[500],sort[<custom:\"@timestamp\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@1598a69f>!]: Parse Failure [Failed to parse source [{\"query\":{\"filtered\":{\"query\":{\"query_string\":{\"analyze_wildcard\":true,\"query\":\"*\"}},\"filter\":{\"bool\":{\"must\":[{\"query\":{\"match\":{\"host\":{\"query\":\"codemanager\",\"type\":\"phrase\"}}}},{\"query\":{\"match\":{\"_type\":{\"query\":\"nginx\",\"type\":\"phrase\"}}}},{\"range\":{\"@timestamp\":{\"gte\":1428486256162,\"lte\":1428487156162}}}],\"must_not\":[]}}}},\"highlight\":{\"pre_tags\":[\"@kibana-highlighted-field@\"],\"post_tags\":[\"@/kibana-highlighted-field@\"],\"fields\":{\"*\":{}}},\"size\":500,\"sort\":{\"@timestamp\":\"desc\"},\"aggs\":{\"2\":{\"date_histogram\":{\"field\":\"@timestamp\",\"interval\":\"30s\",\"pre_zone\":\"+02:00\",\"pre_zone_adjust_large_interval\":true,\"min_doc_count\":0,\"extended_bounds\":{\"min\":1428486256161,\"max\":1428487156161}}}},\"fields\":[\"*\",\"_source\"],\"script_fields\":{\"lala\":{\"script\":\"doc['status'].value+42\",\"lang\":\"expression\"}},\"fielddata_fields\":[\"@timestamp\",\"time\"]}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:687)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:543)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:515)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:277)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.expression.ExpressionScriptCompilationException: Field [status] used in expression must be numeric\n    at org.elasticsearch.script.expression.ExpressionScriptEngineService.search(ExpressionScriptEngineService.java:131)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:511)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:515)\n    at org.elasticsearch.search.fetch.script.ScriptFieldsParseElement.parse(ScriptFieldsParseElement.java:82)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:671)\n    ... 9 more\n[2015-04-08 11:59:16,295][DEBUG][action.search.type       ] [Moonstone] [logstash-2015.04.08][2], node[3hsQHmeVRo2hGHdFbiG_-Q], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@45f7b369] lastShard [true]\norg.elasticsearch.search.SearchParseException: [logstash-2015.04.08][2]: query[ConstantScore(BooleanFilter(+QueryWrapperFilter(host:codemanager) +QueryWrapperFilter(ConstantScore(cache(_type:nginx))) +cache(@timestamp:[1428486256162 TO 1428487156162])))],from[-1],size[500],sort[<custom:\"@timestamp\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@7d035eda>!]: Parse Failure [Failed to parse source [{\"query\":{\"filtered\":{\"query\":{\"query_string\":{\"analyze_wildcard\":true,\"query\":\"*\"}},\"filter\":{\"bool\":{\"must\":[{\"query\":{\"match\":{\"host\":{\"query\":\"codemanager\",\"type\":\"phrase\"}}}},{\"query\":{\"match\":{\"_type\":{\"query\":\"nginx\",\"type\":\"phrase\"}}}},{\"range\":{\"@timestamp\":{\"gte\":1428486256162,\"lte\":1428487156162}}}],\"must_not\":[]}}}},\"highlight\":{\"pre_tags\":[\"@kibana-highlighted-field@\"],\"post_tags\":[\"@/kibana-highlighted-field@\"],\"fields\":{\"*\":{}}},\"size\":500,\"sort\":{\"@timestamp\":\"desc\"},\"aggs\":{\"2\":{\"date_histogram\":{\"field\":\"@timestamp\",\"interval\":\"30s\",\"pre_zone\":\"+02:00\",\"pre_zone_adjust_large_interval\":true,\"min_doc_count\":0,\"extended_bounds\":{\"min\":1428486256161,\"max\":1428487156161}}}},\"fields\":[\"*\",\"_source\"],\"script_fields\":{\"lala\":{\"script\":\"doc['status'].value+42\",\"lang\":\"expression\"}},\"fielddata_fields\":[\"@timestamp\",\"time\"]}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:687)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:543)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:515)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:277)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.expression.ExpressionScriptCompilationException: Field [status] used in expression must be numeric\n    at org.elasticsearch.script.expression.ExpressionScriptEngineService.search(ExpressionScriptEngineService.java:131)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:511)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:515)\n    at org.elasticsearch.search.fetch.script.ScriptFieldsParseElement.parse(ScriptFieldsParseElement.java:82)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:671)\n    ... 9 more\n[2015-04-08 11:59:16,296][DEBUG][action.search.type       ] [Moonstone] [logstash-2015.04.08][0], node[3hsQHmeVRo2hGHdFbiG_-Q], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@45f7b369] lastShard [true]\norg.elasticsearch.search.SearchParseException: [logstash-2015.04.08][0]: query[ConstantScore(BooleanFilter(+QueryWrapperFilter(host:codemanager) +QueryWrapperFilter(ConstantScore(cache(_type:nginx))) +cache(@timestamp:[1428486256162 TO 1428487156162])))],from[-1],size[500],sort[<custom:\"@timestamp\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@3ce90bce>!]: Parse Failure [Failed to parse source [{\"query\":{\"filtered\":{\"query\":{\"query_string\":{\"analyze_wildcard\":true,\"query\":\"*\"}},\"filter\":{\"bool\":{\"must\":[{\"query\":{\"match\":{\"host\":{\"query\":\"codemanager\",\"type\":\"phrase\"}}}},{\"query\":{\"match\":{\"_type\":{\"query\":\"nginx\",\"type\":\"phrase\"}}}},{\"range\":{\"@timestamp\":{\"gte\":1428486256162,\"lte\":1428487156162}}}],\"must_not\":[]}}}},\"highlight\":{\"pre_tags\":[\"@kibana-highlighted-field@\"],\"post_tags\":[\"@/kibana-highlighted-field@\"],\"fields\":{\"*\":{}}},\"size\":500,\"sort\":{\"@timestamp\":\"desc\"},\"aggs\":{\"2\":{\"date_histogram\":{\"field\":\"@timestamp\",\"interval\":\"30s\",\"pre_zone\":\"+02:00\",\"pre_zone_adjust_large_interval\":true,\"min_doc_count\":0,\"extended_bounds\":{\"min\":1428486256161,\"max\":1428487156161}}}},\"fields\":[\"*\",\"_source\"],\"script_fields\":{\"lala\":{\"script\":\"doc['status'].value+42\",\"lang\":\"expression\"}},\"fielddata_fields\":[\"@timestamp\",\"time\"]}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:687)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:543)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:515)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:277)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.expression.ExpressionScriptCompilationException: Field [status] used in expression must be numeric\n    at org.elasticsearch.script.expression.ExpressionScriptEngineService.search(ExpressionScriptEngineService.java:131)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:511)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:515)\n    at org.elasticsearch.search.fetch.script.ScriptFieldsParseElement.parse(ScriptFieldsParseElement.java:82)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:671)\n    ... 9 more\n```\n\nWhat can I do please?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}