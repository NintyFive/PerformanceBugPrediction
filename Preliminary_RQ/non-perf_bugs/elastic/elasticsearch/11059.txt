{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11059","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11059/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11059/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11059/events","html_url":"https://github.com/elastic/elasticsearch/issues/11059","id":74368991,"node_id":"MDU6SXNzdWU3NDM2ODk5MQ==","number":11059,"title":"Order by sum aggregation throws error in elastic search","user":{"login":"yaskamal","id":8902002,"node_id":"MDQ6VXNlcjg5MDIwMDI=","avatar_url":"https://avatars1.githubusercontent.com/u/8902002?v=4","gravatar_id":"","url":"https://api.github.com/users/yaskamal","html_url":"https://github.com/yaskamal","followers_url":"https://api.github.com/users/yaskamal/followers","following_url":"https://api.github.com/users/yaskamal/following{/other_user}","gists_url":"https://api.github.com/users/yaskamal/gists{/gist_id}","starred_url":"https://api.github.com/users/yaskamal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yaskamal/subscriptions","organizations_url":"https://api.github.com/users/yaskamal/orgs","repos_url":"https://api.github.com/users/yaskamal/repos","events_url":"https://api.github.com/users/yaskamal/events{/privacy}","received_events_url":"https://api.github.com/users/yaskamal/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-05-08T13:43:54Z","updated_at":"2015-05-08T14:23:40Z","closed_at":"2015-05-08T14:20:25Z","author_association":"NONE","active_lock_reason":null,"body":"I am trying to sort the aggregated result by applying another aggregation that does the summing and then applying order by descending to that sum.\n\nif I try like below, the aggregation result get sorted by doc count.\n\n```\n\"order\": {\n    \"revrsenestedowners\": \"desc\"\n}\n```\n\nBelow code explains the problem am facing. (field names are changed just to illustrate the problem)\n\n\"machines\" is my nested object but the \"owners\" is not nested and it belongs to parent object.\n\nI need to get the top 10 machines name by owners machine count (require sum as the owners object are list and can have more than one value).\n\n```\n{\n  \"query\": {\n    \"range\": {\n      \"createdDate\": {\n        \"gte\": \"2015-04-28T00:00:00\",\n        \"lte\": \"2015-05-01T23:59:59\"\n      }\n    }\n  },\n  \"aggs\": {\n    \"nestedagg\": {\n      \"nested\": {\n        \"path\": \"machines\"\n      },\n      \"aggs\": {\n        \"terms\": {\n          \"terms\": {\n            \"field\": \"machines.machineName\",\n            \"size\": 10,\n              \"order\": {\n                  \"sumowners\": \"desc\"\n               }\n          },\n          \"aggs\": {\n            \"revrsenestedowners\": {\n              \"reverse_nested\": {},\n              \"aggs\": {\n                \"sumowners\": {\n                  \"sum\": {\n                    \"field\": \"owners.machinesCount\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nI require the sum ordering and not the doc count ordering.\nfor it to work I may require something like :\n\n```\n\"order\": {\n    \"revrsenestedowners.sumowners\": \"desc\"\n}\n```\n\nIs there a way to achieve what I'm looking for.\n\nOr Is this the limitation with elastic search? or a bug?\n\nI'm stuck and really appreciate any help\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}