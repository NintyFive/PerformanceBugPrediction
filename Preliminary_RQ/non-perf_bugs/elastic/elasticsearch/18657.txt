{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18657","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18657/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18657/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18657/events","html_url":"https://github.com/elastic/elasticsearch/issues/18657","id":157667458,"node_id":"MDU6SXNzdWUxNTc2Njc0NTg=","number":18657,"title":"Getting a null_pointer_exception when executing suggest","user":{"login":"Popo-lth","id":3389962,"node_id":"MDQ6VXNlcjMzODk5NjI=","avatar_url":"https://avatars0.githubusercontent.com/u/3389962?v=4","gravatar_id":"","url":"https://api.github.com/users/Popo-lth","html_url":"https://github.com/Popo-lth","followers_url":"https://api.github.com/users/Popo-lth/followers","following_url":"https://api.github.com/users/Popo-lth/following{/other_user}","gists_url":"https://api.github.com/users/Popo-lth/gists{/gist_id}","starred_url":"https://api.github.com/users/Popo-lth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Popo-lth/subscriptions","organizations_url":"https://api.github.com/users/Popo-lth/orgs","repos_url":"https://api.github.com/users/Popo-lth/repos","events_url":"https://api.github.com/users/Popo-lth/events{/privacy}","received_events_url":"https://api.github.com/users/Popo-lth/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":651957037,"node_id":"MDU6TGFiZWw2NTE5NTcwMzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.4.7","name":"v2.4.7","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-05-31T13:09:21Z","updated_at":"2018-03-19T18:22:51Z","closed_at":"2018-03-19T18:22:51Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**:\n2.3.2\n**JVM version**:\n1.8.0_73\n**OS version**:\nCentOS release 6.6 (Final)\n**Description of the problem including expected versus actual behavior**:\n\n**Steps to reproduce**:\nhttps://www.elastic.co/guide/en/elasticsearch/reference/2.3/suggester-context.html\n 1.\n\n```\nPUT services/_mapping/service\n{\n    \"service\": {\n        \"properties\": {\n            \"name\": {\n                \"type\" : \"string\"\n            },\n            \"tag\": {\n                \"type\" : \"string\"\n            },\n            \"suggest_field\": {\n                \"type\": \"completion\",\n                \"context\": {\n                    \"color\": { \n                        \"type\": \"category\",\n                        \"path\": \"color_field\",\n                        \"default\": [\"red\", \"green\", \"blue\"]\n                    },\n                    \"location\": { \n                        \"type\": \"geo\",\n                        \"precision\": \"5m\",\n                        \"neighbors\": true,\n                        \"default\": \"u33\"\n                    }\n            }\n        }\n    }\n    }\n}\n```\n\n 2.\n\n```\nPUT services/service/1\n{\n    \"name\": \"knapsack\",\n    \"suggest_field\": {\n        \"input\": [\"knacksack\", \"backpack\", \"daypack\"],\n        \"context\": {\n            \"color\": [\"red\", \"yellow\"]\n            }\n        }\n}\n```\n\n 3.\n\n```\nPOST services/_suggest?pretty'\n{\n    \"suggest\" : {\n        \"text\" : \"m\",\n        \"completion\" : {\n            \"field\" : \"suggest_field\",\n            \"size\": 10,\n            \"context\": {\n                \"color\": \"red\"\n            }\n        }\n    }\n}\n```\n\n**The response I'm getting is:**\n\n```\n{\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 4,\n    \"failed\": 1,\n    \"failures\": [\n      {\n        \"shard\": 3,\n        \"index\": \"services\",\n        \"status\": \"INTERNAL_SERVER_ERROR\",\n        \"reason\": {\n          \"type\": \"exception\",\n          \"reason\": \"failed to execute suggest\",\n          \"caused_by\": {\n            \"type\": \"null_pointer_exception\",\n            \"reason\": null\n          }\n        }\n      }\n    ]\n  }\n}\n```\n\n**Provide logs (if relevant)**:\n\n```\nRemoteTransportException[[192.168.1.100-node2][192.168.1.100:29300][indices:data/read/suggest[s]]]; nested: ElasticsearchException[failed to execute suggest]; nested: NullPointerException;\nCaused by: ElasticsearchException[failed to execute suggest]; nested: NullPointerException;\n        at org.elasticsearch.action.suggest.TransportSuggestAction.shardOperation(TransportSuggestAction.java:152)\n        at org.elasticsearch.action.suggest.TransportSuggestAction.shardOperation(TransportSuggestAction.java:61)\n        at org.elasticsearch.action.support.broadcast.TransportBroadcastAction$ShardTransportHandler.messageReceived(TransportBroadcastAction.java:282)\n        at org.elasticsearch.action.support.broadcast.TransportBroadcastAction$ShardTransportHandler.messageReceived(TransportBroadcastAction.java:278)\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:300)\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NullPointerException\n        at org.elasticsearch.search.suggest.context.ContextMapping$ContextQuery.toAutomaton(ContextMapping.java:264)\n        at org.elasticsearch.search.suggest.completion.AnalyzingCompletionLookupProvider$2.getLookup(AnalyzingCompletionLookupProvider.java:279)\n        at org.elasticsearch.search.suggest.completion.Completion090PostingsFormat$CompletionTerms.getLookup(Completion090PostingsFormat.java:264)\n        at org.elasticsearch.search.suggest.completion.CompletionSuggester.innerExecute(CompletionSuggester.java:69)\n        at org.elasticsearch.search.suggest.completion.CompletionSuggester.innerExecute(CompletionSuggester.java:44)\n        at org.elasticsearch.search.suggest.Suggester.execute(Suggester.java:41)\n        at org.elasticsearch.search.suggest.SuggestPhase.execute(SuggestPhase.java:85)\n        at org.elasticsearch.action.suggest.TransportSuggestAction.shardOperation(TransportSuggestAction.java:147)\n        ... 9 more\n\n```\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n\nhttps://github.com/elastic/elasticsearch/blob/v2.3.2/core/src/main/java/org/elasticsearch/search/suggest/context/ContextMapping.java : 308\n\n```\n            List<ContextQuery> queries = new ArrayList<>(mappings.size());\n            for (ContextMapping mapping : mappings.values()) {\n                queries.add(querySet.get(mapping.name));\n            }\n```\n\nNot checked  \"querySet.get(mapping.name)\" equal to null\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}