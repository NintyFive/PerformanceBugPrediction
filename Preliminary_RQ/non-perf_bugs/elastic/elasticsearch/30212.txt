{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30212","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30212/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30212/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30212/events","html_url":"https://github.com/elastic/elasticsearch/issues/30212","id":318484822,"node_id":"MDU6SXNzdWUzMTg0ODQ4MjI=","number":30212,"title":"ElasticSeach cluster - Error while adding new node to cluster.","user":{"login":"rajbuddha","id":18016870,"node_id":"MDQ6VXNlcjE4MDE2ODcw","avatar_url":"https://avatars1.githubusercontent.com/u/18016870?v=4","gravatar_id":"","url":"https://api.github.com/users/rajbuddha","html_url":"https://github.com/rajbuddha","followers_url":"https://api.github.com/users/rajbuddha/followers","following_url":"https://api.github.com/users/rajbuddha/following{/other_user}","gists_url":"https://api.github.com/users/rajbuddha/gists{/gist_id}","starred_url":"https://api.github.com/users/rajbuddha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rajbuddha/subscriptions","organizations_url":"https://api.github.com/users/rajbuddha/orgs","repos_url":"https://api.github.com/users/rajbuddha/repos","events_url":"https://api.github.com/users/rajbuddha/events{/privacy}","received_events_url":"https://api.github.com/users/rajbuddha/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-04-27T17:12:42Z","updated_at":"2018-04-27T18:06:59Z","closed_at":"2018-04-27T18:06:58Z","author_association":"NONE","active_lock_reason":null,"body":"Hi Team,\r\n\r\nI am working on containerizing existing elastic cluster and I am planning to have setup like 2 server with multiple containers of elasticsearch & kibana within those servers using docker.\r\n\r\nI am attaching design & compose files ( for server1 & server2) for creating different types of nodes and settings. So far I am able to create a 5 containers on server1 (being one for kibana) and I am trying to add few more nodes (as containers) to the existing cluster from different server. I am getting below error during adding of node ( from server2) .\r\n\r\n\r\nNote: On server1 HOST = HOSTA, HOST2=HOSTB \r\nOn Server2 HOST=HOSTB, HOST2=HOSTA\r\n\r\nBelow are my docker-compose file snippets \r\n\r\n**Server-1:**\r\nservices: \r\n  ess_elasticsearch1: \r\n    container_name: ess_elasticsearch1\r\n    environment: \r\n      - cluster.name=\"ess_elasticsearch_cluster\"\r\n      - bootstrap.memory_lock=true\r\n      - \"ES_JAVA_OPTS=-Xms2g -Xmx2g\"\r\n      - \"node.name=ess_elasticsearch1_${HOST}\"\r\n      - \"network.bind_host=0.0.0.0\"\r\n      - \"network.publish_host=${HOST}\"\r\n      - \"discovery.zen.ping.unicast.hosts=${HOST}:9300, ${HOST}:9320, ${HOST}:9330, ${HOST}:9340\"\r\n      - \"transport.host=${HOST}\"\r\n      - \"transport.tcp.port=9300\"\r\n      - \"index.number_of_shards: 5\"\r\n      - \"index.number_of_replicas: 1\"\r\n      - \"node.master=true\"\r\n      - \"node.data=false\"\r\n      - \"node.ingest=true\"\r\n    image: \"docker.elastic.co/elasticsearch/elasticsearch:6.2.4\"\r\n    ports: \r\n      - \"9200:9200\"\r\n      - \"9300:9300\"\r\n    ulimits: \r\n      memlock: \r\n        hard: -1\r\n        soft: -1\r\n    volumes: \r\n      - \"/usr/share/elasticsearch/data:/home/mwciuser/mw_modernization/elastic/data\"\r\n    network_mode: host\r\n  ess_elasticsearch2: \r\n    container_name: ess_elasticsearch2\r\n    environment: \r\n      - cluster.name=\"ess_elasticsearch_cluster\"\r\n      - bootstrap.memory_lock=true\r\n      - \"ES_JAVA_OPTS=-Xms2g -Xmx2g\"\r\n      - \"ES_CONNECT_RETRY=30\"\r\n      - \"node.name=ess_elasticsearch2_${HOST}\"\r\n      - \"network.bind_host=0.0.0.0\"\r\n      - \"network.publish_host=${HOST}\"\r\n      - \"discovery.zen.ping.unicast.hosts=${HOST}:9300, ${HOST}:9320, ${HOST}:9330, ${HOST}:9340\"\r\n      - \"transport.host=${HOST}\"\r\n      - \"transport.tcp.port=9320\"\r\n      - \"node.master=false\"\r\n      - \"node.data=true\"\r\n      - \"node.ingest=false\"\r\n    image: \"docker.elastic.co/elasticsearch/elasticsearch:6.2.4\"\r\n    ports: \r\n      - \"9200:9220\"\r\n      - \"9300:9320\"\r\n    ulimits: \r\n      memlock: \r\n        hard: -1\r\n        soft: -1\r\n    volumes: \r\n      - \"/usr/share/elasticsearch/data:/home/mwciuser/mw_modernization/elastic/data\"\r\n    network_mode: host\r\n\r\n**Server-2**\r\n--- \r\nservices: \r\n  ess_elasticsearch3: \r\n    container_name: ess_elasticsearch3\r\n    environment: \r\n      - cluster.name=\"ess_elasticsearch_cluster\"\r\n      - bootstrap.memory_lock=true\r\n      - \"ES_JAVA_OPTS=-Xms2g -Xmx2g\"\r\n      - \"ES_CONNECT_RETRY=60\"\r\n      - \"node.name=ess_elasticsearch3_${HOST}\"\r\n      - \"network.bind_host=0.0.0.0\"\r\n      - \"network.publish_host=${HOST}\"\r\n      - \"discovery.zen.ping.unicast.hosts=${HOST2}:9300, ${HOST2}:9320, ${HOST2}:9330, ${HOST2}:9340\"\r\n      - \"transport.host=${HOST}\"\r\n      - \"transport.tcp.port=9330\"\r\n      - \"node.master=true\"\r\n      - \"node.data=false\"\r\n      - \"node.ingest=true\"\r\n    image: \"docker.elastic.co/elasticsearch/elasticsearch:6.2.4\"\r\n    ports: \r\n      - \"9200:9230\"\r\n      - \"9300:9330\"\r\n    ulimits: \r\n      memlock: \r\n        hard: -1\r\n        soft: -1\r\n    volumes: \r\n      - \"/usr/share/elasticsearch/data:/home/mwciuser/mw_modernization/elastic/data\"\r\n    network_mode: host\r\nversion: \"2.2\"\r\n\r\n\r\nI was able to add 4 elasticsearch nodes of all containers sitting on same server, when I am trying to add 5th node from different server I am getting below error, Please see if anyone can help me on this?\r\n\r\n--------------------------------------------------------------------------\r\n[ess_elasticsearch3_labvlnx20.xxx.xxx.com] failed to send join request to master [{ess_elasticsearch4_labvlnx130.xxx.xxx.com}{6N6MMkndQWKO3PgxVsuqig}{4ELng_YgTrOz_W9TPGEEyQ}{labvlnx130.xxx.xxx.com}{10.64.4.xxx:9340}{ml.machine_memory=33569316864, ml.max_open_jobs=20, ml.enabled=true}], reason [RemoteTransportException[[ess_elasticsearch4_labvlnx130.xxx.xxx.com][10.64.4.xxx:9340][internal:discovery/zen/join]]; nested: ConnectTransportException[[ess_elasticsearch3_labvlnx20.xxx.xxx.com][10.64.4.xxx:9330] connect_exception]; nested: IOException[No route to host: labvlnx20.xxx.xxx.com/10.64.4.xxx:9330]; nested: IOException[No route to host]; ]\r\n\r\n--------------------------------------------------------------------------\r\n\r\nhere is  server-1 : labvlnx130.xxx.xxx.com is server-1 with 4 node working cluster\r\n             server-2 : labvlnx20.xxx.xxx.com is server-2 with a node adding and giving above error\r\n\r\nI am able ping from both the servers each other on given ports.\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}