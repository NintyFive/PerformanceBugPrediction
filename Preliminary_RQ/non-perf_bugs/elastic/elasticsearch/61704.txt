{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/61704","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61704/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61704/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61704/events","html_url":"https://github.com/elastic/elasticsearch/issues/61704","id":689044971,"node_id":"MDU6SXNzdWU2ODkwNDQ5NzE=","number":61704,"title":"[CI] ML ClassificationIT.testTooLowConfiguredMemoryStillStarts failure","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":2205552170,"node_id":"MDU6TGFiZWwyMjA1NTUyMTcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.10.0","name":"v7.10.0","color":"dddddd","default":false,"description":""},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"assignees":[{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-08-31T09:02:11Z","updated_at":"2020-09-02T16:45:06Z","closed_at":"2020-09-02T16:45:05Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Build scan**:\r\nhttps://gradle-enterprise.elastic.co/s/xxiunoj23mvfy\r\n\r\n**Repro line**:\r\n```\r\n./gradlew ':x-pack:plugin:ml:qa:native-multi-node-tests:integTest' --tests \"org.elasticsearch.xpack.ml.integration.ClassificationIT.testTooLowConfiguredMemoryStillStarts\" \\\r\n  -Dtests.seed=7B412D508A8B006F \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es-UY \\\r\n  -Dtests.timezone=Canada/Yukon \\\r\n  -Druntime.java=11\r\n```\r\n\r\n**Reproduces locally?**:\r\nIt did reproduce something though a different assertion failure:\r\n\r\n```\r\norg.elasticsearch.xpack.ml.integration.ClassificationIT > testTooLowConfiguredMemoryStillStarts FAILED\r\n    java.lang.AssertionError: Stats were: {\"id\":\"low_memory_analysis\",\"state\":\"analyzing\",\"progress\":[{\"phase\":\"reindexing\",\"progress_percent\":100},{\"phase\":\"loading_data\",\"progress_percent\":0},{\"phase\":\"feature_selection\",\"progress_percent\":0},{\"phase\":\"coarse_parameter_search\",\"progress_percent\":0},{\"phase\":\"fine_tuning_parameters\",\"progress_percent\":0},{\"phase\":\"final_training\",\"progress_percent\":0},{\"phase\":\"writing_results\",\"progress_percent\":0},{\"phase\":\"inference\",\"progress_percent\":0}],\"data_counts\":{\"training_docs_count\":0,\"test_docs_count\":0,\"skipped_docs_count\":0},\"memory_usage\":{\"peak_usage_bytes\":0,\"status\":\"ok\"},\"node\":{\"id\":\"3KdHUcK_RpqLjHhXJDHjvg\",\"name\":\"integTest-2\",\"ephemeral_id\":\"n5isiXUMQYCJxK0_ypRujA\",\"transport_address\":\"127.0.0.1:35541\",\"attributes\":{\"testattr\":\"test\",\"ml.machine_memory\":\"67459010560\",\"ml.max_open_jobs\":\"20\",\"xpack.installed\":\"true\",\"transform.node\":\"true\"}},\"assignment_explanation\":\"\"}\r\n    Expected: <failed>\r\n         but: was <analyzing>\r\n        at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\r\n        at org.junit.Assert.assertThat(Assert.java:956)\r\n        at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.assertIsFailed(MlNativeDataFrameAnalyticsIntegTestCase.java:216)\r\n        at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.lambda$waitUntilAnalyticsIsFailed$1(MlNativeDataFrameAnalyticsIntegTestCase.java:161)\r\n        at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:923)\r\n        at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.waitUntilAnalyticsIsFailed(MlNativeDataFrameAnalyticsIntegTestCase.java:161)\r\n        at org.elasticsearch.xpack.ml.integration.ClassificationIT.testTooLowConfiguredMemoryStillStarts(ClassificationIT.java:793)\r\n\r\n```\r\n\r\nBuild-stats does indicate a number of different failure.\r\n\r\n**Applicable branches**:\r\nmaster and 7.x\r\n\r\n**Failure history**:\r\nhttps://build-stats.elastic.co/goto/8942e4faac3b7916cf4ca2e0433f82cf\r\n\r\nLooks like failures started August 27th, with around 7 failures per day.\r\n\r\nThis test was also previously reported failing in: #61561\r\n\r\n**Failure excerpt**:\r\n```\r\norg.elasticsearch.xpack.ml.integration.ClassificationIT > testTooLowConfiguredMemoryStillStarts FAILED\r\n    java.lang.AssertionError: \r\n    Expected: <0L>\r\n         but: was <1L>\r\n        at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\r\n        at org.junit.Assert.assertThat(Assert.java:956)\r\n        at org.junit.Assert.assertThat(Assert.java:923)\r\n        at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.cleanUpAnalytics(MlNativeDataFrameAnalyticsIntegTestCase.java:96)\r\n        at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.cleanUpResources(MlNativeDataFrameAnalyticsIntegTestCase.java:87)\r\n        at org.elasticsearch.xpack.ml.integration.MlNativeIntegTestCase.cleanUp(MlNativeIntegTestCase.java:181)\r\n        at org.elasticsearch.xpack.ml.integration.ClassificationIT.cleanup(ClassificationIT.java:111)\r\n\r\n    java.lang.AssertionError: test leaves transient cluster metadata behind\r\n    Expected: an empty collection\r\n         but: <[logger.org.elasticsearch.xpack.ml.dataframe.inference, logger.org.elasticsearch.xpack.core.ml.inference]>\r\n        at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\r\n```\r\n\r\n","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}