{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19458","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19458/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19458/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19458/events","html_url":"https://github.com/elastic/elasticsearch/issues/19458","id":165875903,"node_id":"MDU6SXNzdWUxNjU4NzU5MDM=","number":19458,"title":"Vanilla Elasticsearch 5.0.0alpha4 unable to start in LXD container","user":{"login":"naisanza","id":1614425,"node_id":"MDQ6VXNlcjE2MTQ0MjU=","avatar_url":"https://avatars1.githubusercontent.com/u/1614425?v=4","gravatar_id":"","url":"https://api.github.com/users/naisanza","html_url":"https://github.com/naisanza","followers_url":"https://api.github.com/users/naisanza/followers","following_url":"https://api.github.com/users/naisanza/following{/other_user}","gists_url":"https://api.github.com/users/naisanza/gists{/gist_id}","starred_url":"https://api.github.com/users/naisanza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/naisanza/subscriptions","organizations_url":"https://api.github.com/users/naisanza/orgs","repos_url":"https://api.github.com/users/naisanza/repos","events_url":"https://api.github.com/users/naisanza/events{/privacy}","received_events_url":"https://api.github.com/users/naisanza/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2016-07-15T20:55:47Z","updated_at":"2017-05-09T08:15:27Z","closed_at":"2016-07-15T21:01:26Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: [5.0.0alpha4](https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/5.0.0-alpha4/elasticsearch-5.0.0-alpha4.tar.gz)\n\n**JVM version**: [Oracle Java JRE Version 8 Update 91](http://javadl.oracle.com/webapps/download/AutoDL?BundleId=207765)\n\n**OS version**: Ubuntu 16.04 LXD (Ubuntu 16.04 LTS amd64 image fingerprint: f452cda3bccb)\n\n**Description of the problem including expected versus actual behavior**:\n\nRunning 5.0.0alpha4 `elasticsearch` fails. \nRunning 2.3.4 `elasticsearch` succeeds.\n\n**Steps to reproduce**:\n1. Launch LXD container\n2. Install [Java ](http://javadl.oracle.com/webapps/download/AutoDL?BundleId=207765)\\+ [Elasticsearch 5.0.0alpha4](https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/5.0.0-alpha4/elasticsearch-5.0.0-alpha4.tar.gz) \n3. Run Elasticsearch\n\n**Provide logs (if relevant)**:\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n\n5.0.0alpha4 elasticsearch.yml:\n\n```\nroot@base-elasticsearch-5-0-0-alpha4:~# grep -v '#' /opt/elasticsearch/elasticsearch-5.0.0-alpha4/config/elasticsearch.yml\ncluster.name: beta\nnetwork.host: _site_\n```\n\n2.3.4 elasticsearch.yml:\n\n```\nroot@base-elasticsearch-2-3-4:~# grep -v '#' /opt/elasticsearch/elasticsearch-2.3.4/config/elasticsearch.yml\ncluster.name: waldo\nnetwork.host: _site_\n```\n\n5.0.0alpha4 startup log:\n\n```\nelasticsearch@base-elasticsearch-5-0-0-alpha4:~$ elasticsearch 2>>elasticsearch5.0.0.log 1>>elasticsearch5.0.0.log\nelasticsearch@base-elasticsearch-5-0-0-alpha4:~$ cat elasticsearch5.0.0.log\n[2016-07-15 20:50:14,763][INFO ][node                     ] [Raa of the Caves] version[5.0.0-alpha4], pid[694], build[3f5b994/2016-06-27T16:23:46.861Z], OS[Linux/4.4.0-28-generic/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_91/25.91-b14]\n[2016-07-15 20:50:14,763][INFO ][node                     ] [Raa of the Caves] initializing ...\n[2016-07-15 20:50:15,833][INFO ][plugins                  ] [Raa of the Caves] modules [percolator, lang-mustache, lang-painless, reindex, aggs-matrix-stats, lang-expression, ingest-common, lang-groovy], plugins []\n[2016-07-15 20:50:16,608][INFO ][env                      ] [Raa of the Caves] using [1] data paths, mounts [[/ (turtle/_lxd/containers/base-elasticsearch-5-0-0-alpha4)]], net usable_space [8.7tb], net total_space [8.7tb], spins? [possibly], types [zfs]\n[2016-07-15 20:50:16,608][INFO ][env                      ] [Raa of the Caves] heap size [1.9gb], compressed ordinary object pointers [true]\n[2016-07-15 20:50:18,062][INFO ][node                     ] [Raa of the Caves] initialized\n[2016-07-15 20:50:18,062][INFO ][node                     ] [Raa of the Caves] starting ...\n[2016-07-15 20:50:18,231][INFO ][transport                ] [Raa of the Caves] publish_address {10.10.1.67:9300}, bound_addresses {10.10.1.67:9300}\nException in thread \"main\" java.lang.RuntimeException: bootstrap checks failed\ninitial heap size [268435456] not equal to maximum heap size [2147483648]; this can cause resize pauses and prevents mlockall from locking the entire heap\nplease set [discovery.zen.minimum_master_nodes] to a majority of the number of master eligible nodes in your cluster\nmax virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]\n        at org.elasticsearch.bootstrap.BootstrapCheck.check(BootstrapCheck.java:125)\n        at org.elasticsearch.bootstrap.BootstrapCheck.check(BootstrapCheck.java:85)\n        at org.elasticsearch.bootstrap.BootstrapCheck.check(BootstrapCheck.java:65)\n        at org.elasticsearch.bootstrap.Bootstrap$5.validateNodeBeforeAcceptingRequests(Bootstrap.java:178)\n        at org.elasticsearch.node.Node.start(Node.java:373)\n        at org.elasticsearch.bootstrap.Bootstrap.start(Bootstrap.java:193)\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:252)\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:96)\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:91)\n        at org.elasticsearch.cli.SettingCommand.execute(SettingCommand.java:54)\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:91)\n        at org.elasticsearch.cli.Command.main(Command.java:53)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:70)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:63)\nRefer to the log for complete error details.\n[2016-07-15 20:50:18,244][INFO ][node                     ] [Raa of the Caves] stopping ...\n[2016-07-15 20:50:18,267][INFO ][node                     ] [Raa of the Caves] stopped\n[2016-07-15 20:50:18,267][INFO ][node                     ] [Raa of the Caves] closing ...\n[2016-07-15 20:50:18,278][INFO ][node                     ] [Raa of the Caves] closed\nelasticsearch@base-elasticsearch-5-0-0-alpha4:~$\n```\n\n5.0.0alpha4 vm.max_map_count value is 65530:\n\n```\nroot@base-elasticsearch-5-0-0-alpha4:~# sysctl -a | grep vm.max_map_count\nsysctl: permission denied on key 'fs.protected_hardlinks'\nsysctl: permission denied on key 'fs.protected_symlinks'\nsysctl: permission denied on key 'kernel.cad_pid'\nsysctl: permission denied on key 'kernel.unprivileged_userns_apparmor_policy'\nsysctl: permission denied on key 'kernel.usermodehelper.bset'\nsysctl: permission denied on key 'kernel.usermodehelper.inheritable'\nsysctl: reading key \"net.ipv6.conf.all.stable_secret\"\nsysctl: reading key \"net.ipv6.conf.default.stable_secret\"\nsysctl: reading key \"net.ipv6.conf.eth0.stable_secret\"\nsysctl: reading key \"net.ipv6.conf.lo.stable_secret\"\nvm.max_map_count = 65530\n```\n\n2.3.4 vm.max_map_count value is 65530:\n\n```\nroot@base-elasticsearch-2-3-4:~# sysctl -a | grep vm.max_map_count\nsysctl: permission denied on key 'fs.protected_hardlinks'\nsysctl: permission denied on key 'fs.protected_symlinks'\nsysctl: permission denied on key 'kernel.cad_pid'\nsysctl: permission denied on key 'kernel.unprivileged_userns_apparmor_policy'\nsysctl: permission denied on key 'kernel.usermodehelper.bset'\nsysctl: permission denied on key 'kernel.usermodehelper.inheritable'\nsysctl: reading key \"net.ipv6.conf.all.stable_secret\"\nsysctl: reading key \"net.ipv6.conf.default.stable_secret\"\nsysctl: reading key \"net.ipv6.conf.eth0.stable_secret\"\nsysctl: reading key \"net.ipv6.conf.lo.stable_secret\"\nvm.max_map_count = 65530\n```\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}