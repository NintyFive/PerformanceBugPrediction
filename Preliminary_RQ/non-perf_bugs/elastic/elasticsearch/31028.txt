{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31028","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31028/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31028/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31028/events","html_url":"https://github.com/elastic/elasticsearch/issues/31028","id":328466849,"node_id":"MDU6SXNzdWUzMjg0NjY4NDk=","number":31028,"title":"[TEST] IndexAuditTrailTests.testRunAsDenied failing","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"labels":[{"id":912837734,"node_id":"MDU6TGFiZWw5MTI4Mzc3MzQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Audit","name":":Security/Audit","color":"0e8a16","default":false,"description":"X-Pack Audit logging"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"assignees":[{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-06-01T10:33:35Z","updated_at":"2019-02-05T08:49:09Z","closed_at":"2019-02-05T08:49:09Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.3+multijob-unix-compatibility/os=opensuse/99/console\r\n\r\nRelevant output:\r\n\r\n```\r\n> Throwable #1: java.lang.AssertionError: timed out waiting for yellow\r\n   > Expected: <false>\r\n   >      but: was <true>\r\n   > \tat __randomizedtesting.SeedInfo.seed([671FC3F9520DD1BE:E3A26B8E4ACC5E11]:0)\r\n   > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   > \tat org.elasticsearch.xpack.security.audit.index.IndexAuditTrailTests.ensureYellowAndNoInitializingShards(IndexAuditTrailTests.java:949)\r\n   > \tat org.elasticsearch.xpack.security.audit.index.IndexAuditTrailTests.getIndexedAuditMessage(IndexAuditTrailTests.java:903)\r\n   > \tat org.elasticsearch.xpack.security.audit.index.IndexAuditTrailTests.testRunAsDenied(IndexAuditTrailTests.java:754)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n\r\n1> [2018-06-01T07:15:16,636][INFO ][o.e.x.s.a.i.IndexAuditTrailTests] ensureYellow timed out, cluster state:\r\n  1> cluster uuid: uiuS3NTuTBC12HAyoPVuzA\r\n  1> version: 6\r\n  1> state uuid: oZxE__XXSpKbd2tKUfiPYA\r\n  1> from_diff: false\r\n  1> meta data version: 4\r\n  1> nodes: \r\n  1>    {remote_node_s1}{dPbAW8RNTNq97oXdTCBfCQ}{JMrucCOtSSa2EKGr-HYoYg}{127.0.0.1}{127.0.0.1:30457}{xpack.installed=true}\r\n  1>    {remote_node_s0}{VvPtBZOZTAugGgWtU3m6aw}{hQslfoPKTg6e5o54-OMFyg}{127.0.0.1}{127.0.0.1:30456}{xpack.installed=true}, local, master\r\n  1> routing_table (version 1):\r\n  1> routing_nodes:\r\n  1> -----node_id[dPbAW8RNTNq97oXdTCBfCQ][V]\r\n  1> -----node_id[VvPtBZOZTAugGgWtU3m6aw][V]\r\n  1> ---- unassigned\r\n  1> customs:\r\n  1>    snapshot_deletions: SnapshotDeletionsInProgress[]   snapshots: SnapshotsInProgress[]   restore: RestoreInProgress[]\r\n  1> tasks: (0):\r\n```\r\n\r\n\r\nProbable cause:\r\n\r\n```\r\n[2018-06-01T07:14:46,632][ERROR][o.e.x.s.a.i.IndexAuditTrailTests$2] failed to get remote cluster state\r\n  1> org.elasticsearch.transport.RemoteTransportException: [remote_node_s1][127.0.0.1:30457][cluster:monitor/state]\r\n  1> Caused by: org.elasticsearch.ElasticsearchSecurityException: unable to authenticate user [test_user] for action [cluster:monitor/state]\r\n  1> \tat org.elasticsearch.xpack.core.security.support.Exceptions.authenticationError(Exceptions.java:24) ~[x-pack-core-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.xpack.core.security.authc.DefaultAuthenticationFailureHandler.failedAuthentication(DefaultAuthenticationFailureHandler.java:31) ~[x-pack-core-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$AuditableTransportRequest.authenticationFailed(AuthenticationService.java:518) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.consumeUser(AuthenticationService.java:356) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$consumeToken$14(AuthenticationService.java:294) ~[main/:?]\r\n  1> \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.xpack.core.common.IteratingActionListener.onResponse(IteratingActionListener.java:96) ~[x-pack-core-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.xpack.core.common.IteratingActionListener.run(IteratingActionListener.java:76) ~[x-pack-core-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.consumeToken(AuthenticationService.java:298) ~[main/:?]\r\n  2> REPRODUCE WITH: ./gradlew :x-pack:plugin:security:test -Dtests.seed=671FC3F9520DD1BE -Dtests.class=org.elasticsearch.xpack.security.audit.index.IndexAuditTrailTests -Dtests.method=\"testRunAsDenied\" -Dtests.security.manager=true -Dtests.locale=ar-SY -Dtests.timezone=America/Argentina/Rio_Gallegos\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$extractToken$9(AuthenticationService.java:234) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.extractToken(AuthenticationService.java:244) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$0(AuthenticationService.java:178) ~[main/:?]\r\n  1> \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.xpack.security.authc.TokenService.getAndValidateToken(TokenService.java:287) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:174) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:205) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:216) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:170) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:131) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:101) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.inbound(ServerTransportFilter.java:130) ~[main/:?]\r\n  1> \tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:302) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1542) ~[elasticsearch-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:135) ~[elasticsearch-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.TcpTransport.handleRequest(TcpTransport.java:1501) ~[elasticsearch-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:1371) ~[elasticsearch-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:64) ~[transport-netty4-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:297) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:413) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.logging.LoggingHandler.channelRead(LoggingHandler.java:241) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1359) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:935) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:134) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:545) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:499) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459) ~[netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) ~[netty-common-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_172]\r\n```","closed_by":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"performed_via_github_app":null}