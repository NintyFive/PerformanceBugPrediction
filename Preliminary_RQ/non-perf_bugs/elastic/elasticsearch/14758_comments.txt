[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157022694","html_url":"https://github.com/elastic/elasticsearch/issues/14758#issuecomment-157022694","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14758","id":157022694,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzAyMjY5NA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-11-16T13:03:30Z","updated_at":"2015-11-16T13:03:30Z","author_association":"MEMBER","body":"> There is no shard 2, seems that routing was just ignored. Can anybody confirm that it is a bug? Or I have wrong expectation?\n\nI think you have wrong expectation: the `routing` parameter is not supposed to be used to indicate which shard id you want to target. Instead, it can be used as index time to pass an arbitrary value that will be used to determine in which shard the document will be indexed (see [Routing a document to a shard](https://www.elastic.co/guide/en/elasticsearch/guide/current/routing-value.html) in The Definitive Guide). \n\nThen, various API accept the `routing` parameter in order to limit the number of shards that will be queried to find the document.\n\nIn case I'm not clear, here a sample how to use routing with Delete-By-Query plugin:\n\n```\n# creating index with 2 shards and 0 replicas\ncurl -XPUT 'http://localhost:9200/books' -d '{\n    \"settings\" : {\n        \"number_of_shards\" : 2,\n        \"number_of_replicas\" : 0\n    }\n}'\n\n# Indexing a first document with routing \"key1\"\ncurl -XPOST 'http://localhost:9200/books/book/1?routing=key1' -d '{\"author\":\"Hemingway\"}'\n\n# Indexing a second document with routing \"key2\"\ncurl -XPOST 'http://localhost:9200/books/book/2?routing=key2' -d '{\"author\":\"Twain\"}'\n\n# Refresh\ncurl -XGET 'http://localhost:9200/books/_refresh'\n\n# Deleting Hemingway with the routing value \"key2\"\ncurl -XDELETE 'http://localhost:9200/books/_query?routing=key2' -d '{\"query\":{\"match\":{\"author\":\"Hemingway\"}}}'\n\n# No documents deleted\n{\"took\":0,\"timed_out\":false,\"_indices\":{\"_all\":{\"found\":0,\"deleted\":0,\"missing\":0,\"failed\":0}},\"failures\":[]}\n\n# Deleting Hemingway with the right routing value \"key1\"\ncurl -XDELETE 'http://localhost:9200/books/_query?routing=key1' -d '{\"query\":{\"match\":{\"author\":\"Hemingway\"}}}'\n\n# 1 document deleted\n{\"took\":0,\"timed_out\":false,\"_indices\":{\"_all\":{\"found\":1,\"deleted\":1,\"missing\":0,\"failed\":0},\"books\":{\"found\":1,\"deleted\":1,\"missing\":0,\"failed\":0}},\"failures\":[]}\n```\n\nNote that the [Search Shards API](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-shards.html?q=search%20shard) is very useful to know the indices & shards a search request would be executed against. \n\nI'm closing this for now since I don't think there's a real issue. Please feel free to reopen if needed.\n","performed_via_github_app":null}]