[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311904413","html_url":"https://github.com/elastic/elasticsearch/issues/25467#issuecomment-311904413","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25467","id":311904413,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTkwNDQxMw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-29T08:52:54Z","updated_at":"2017-06-29T08:52:54Z","author_association":"MEMBER","body":"Another similar failure that also shows a timeout when waiting to get in a green state:\r\n\r\n(sys out and error out get mixed together....)\r\n\r\n```\r\nWARNING: Uncaught exception in thread: Thread[elasticsearch[node_s1][generic][T#6],5,TGRP-SearchWithRandomIOExceptionsIT]\r\n  2> java.lang.AssertionError: local checkpoint [-2] for allocation ID [WpXAFOO4R1qco1_j4RzTZg] violates being at least the global checkpoint [15]\r\n  1> [2017-06-29T05:49:06,412][WARN ][o.e.d.i.m.UidFieldMapper ] Fielddata access on the _uid field is deprecated, use _id instead\r\n  1> [2017-06-29T05:49:06,417][INFO ][o.e.s.b.SearchWithRandomIOExceptionsIT] Match all Successful shards: [9]  numShards: [9]\r\n  1> [2017-06-29T05:49:06,418][INFO ][o.e.c.m.MetaDataIndexStateService] [node_s1] closing indices [[[test/U4rCROC5Q4iaAMZlIBDh7Q]]]\r\n  1> [2017-06-29T05:49:06,429][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s2] [test][0] start check index\r\n  1> [2017-06-29T05:49:06,431][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s0] [test][1] start check index\r\n  1> [2017-06-29T05:49:06,439][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s2] [test][0] end check index\r\n  1> [2017-06-29T05:49:06,439][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s0] [test][1] end check index\r\n  1> [2017-06-29T05:49:06,447][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s2] [test][2] start check index\r\n  1> [2017-06-29T05:49:06,449][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s0] [test][3] start check index\r\n  1> [2017-06-29T05:49:06,455][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s2] [test][2] end check index\r\n  1> [2017-06-29T05:49:06,464][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s0] [test][3] end check index\r\n  1> [2017-06-29T05:49:06,465][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s2] [test][3] start check index\r\n  2> \tat __randomizedtesting.SeedInfo.seed([1C7E3EB249EDF639]:0)\r\n  2> \tat org.elasticsearch.index.seqno.GlobalCheckpointTracker.updateAllocationIdsFromPrimaryContext(GlobalCheckpointTracker.java:411)\r\n  1> [2017-06-29T05:49:06,474][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s0] [test][5] start check index\r\n  2> \tat org.elasticsearch.index.seqno.SequenceNumbersService.updateAllocationIdsFromPrimaryContext(SequenceNumbersService.java:186)\r\n  2> \tat org.elasticsearch.index.shard.IndexShard.updateAllocationIdsFromPrimaryContext(IndexShard.java:1707)\r\n  1> [2017-06-29T05:49:06,475][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s2] [test][3] end check index\r\n  1> [2017-06-29T05:49:06,483][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s2] [test][4] start check index\r\n  2> \tat org.elasticsearch.indices.recovery.RecoveryTarget.handoffPrimaryContext(RecoveryTarget.java:383)\r\n  1> [2017-06-29T05:49:06,483][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s0] [test][5] end check index\r\n  1> [2017-06-29T05:49:06,490][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s2] [test][4] end check index\r\n  1> [2017-06-29T05:49:06,493][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s0] [test][6] start check index\r\n  2> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$HandoffPrimaryContextRequestHandler.messageReceived(PeerRecoveryTargetService.java:425)\r\n  1> [2017-06-29T05:49:06,505][INFO ][o.e.t.s.MockFSIndexStore$Listener] [node_s0] [test][6] end check index\r\n  2> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$HandoffPrimaryContextRequestHandler.messageReceived(PeerRecoveryTargetService.java:420)\r\n  2> \tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30)\r\n  2> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66)\r\n  2> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1525)\r\n  2> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638)\r\n  2> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n  2> \tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\nI also saw this in the log that may be helpful:\r\n\r\n```\r\n[2017-06-29T05:49:36,744][WARN ][o.e.i.c.IndicesClusterStateService] [node_s1] [[test][0]] marking and sending shard failed due to [failed recovery]\r\n  1> org.elasticsearch.indices.recovery.RecoveryFailedException: [test][0]: Recovery failed from {node_s2}{_Hxlo9MVRLeWjBpKP4zWTA}{pzt94GY9RbOVpIDwvVX1Kw}{127.0.0.1}{127.0.0.1:9581} into {node_s1}{TRUI9CxQRoi7_KNVgnhhQg}{ynucPtglSdmGkzv3LAR8jw}{127.0.0.1}{127.0.0.1:9582} (failed to retry recovery)\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveriesCollection.resetRecovery(RecoveriesCollection.java:122) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.retryRecovery(PeerRecoveryTargetService.java:153) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.retryRecovery(PeerRecoveryTargetService.java:149) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:256) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:75) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:616) ~[main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_60]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_60]\r\n  1> \tat java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_60]\r\n  1> Caused by: java.lang.IllegalStateException: cannot reset recovery as previous attempt made it past finalization step\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveryTarget.resetRecovery(RecoveryTarget.java:216) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveriesCollection.resetRecovery(RecoveriesCollection.java:108) ~[main/:?]\r\n  1> \t... 10 more\r\n  1> [2017-06-29T05:49:36,745][WARN ][o.e.c.a.s.ShardStateAction] [node_s1] [test][0] received shard failed for shard id [[test][0]], allocation id [7sMj5hryQZiudlEshYF9mg], primary term [0], message [failed recovery], failure [RecoveryFailedException[[test][0]: Recovery failed from {node_s2}{_Hxlo9MVRLeWjBpKP4zWTA}{pzt94GY9RbOVpIDwvVX1Kw}{127.0.0.1}{127.0.0.1:9581} into {node_s1}{TRUI9CxQRoi7_KNVgnhhQg}{ynucPtglSdmGkzv3LAR8jw}{127.0.0.1}{127.0.0.1:9582} (failed to retry recovery)]; nested: IllegalStateException[cannot reset recovery as previous attempt made it past finalization step]; ]\r\n  1> org.elasticsearch.indices.recovery.RecoveryFailedException: [test][0]: Recovery failed from {node_s2}{_Hxlo9MVRLeWjBpKP4zWTA}{pzt94GY9RbOVpIDwvVX1Kw}{127.0.0.1}{127.0.0.1:9581} into {node_s1}{TRUI9CxQRoi7_KNVgnhhQg}{ynucPtglSdmGkzv3LAR8jw}{127.0.0.1}{127.0.0.1:9582} (failed to retry recovery)\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveriesCollection.resetRecovery(RecoveriesCollection.java:122) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.retryRecovery(PeerRecoveryTargetService.java:153) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.retryRecovery(PeerRecoveryTargetService.java:149) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:256) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:75) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:616) ~[main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_60]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_60]\r\n  1> \tat java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_60]\r\n  1> Caused by: java.lang.IllegalStateException: cannot reset recovery as previous attempt made it past finalization step\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveryTarget.resetRecovery(RecoveryTarget.java:216) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveriesCollection.resetRecovery(RecoveriesCollection.java:108) ~[main/:?]\r\n  1> \t... 10 more\r\n```\r\n\r\nBuild url: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-darwin-compatibility/846/consoleFull","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312132585","html_url":"https://github.com/elastic/elasticsearch/issues/25467#issuecomment-312132585","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25467","id":312132585,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjEzMjU4NQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-06-29T23:12:13Z","updated_at":"2017-06-29T23:12:13Z","author_association":"MEMBER","body":"Duplicates #25415","performed_via_github_app":null}]