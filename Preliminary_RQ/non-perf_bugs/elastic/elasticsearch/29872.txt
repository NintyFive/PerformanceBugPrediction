{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29872","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29872/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29872/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29872/events","html_url":"https://github.com/elastic/elasticsearch/issues/29872","id":317448847,"node_id":"MDU6SXNzdWUzMTc0NDg4NDc=","number":29872,"title":"SQL: Add initial geo support","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"labels":[{"id":912794284,"node_id":"MDU6TGFiZWw5MTI3OTQyODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/SQL","name":":Query Languages/SQL","color":"0e8a16","default":false,"description":"SQL querying"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null},{"id":1222918656,"node_id":"MDU6TGFiZWwxMjIyOTE4NjU2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.0","name":"v7.2.0","color":"DDDDDD","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2018-03-08T17:08:45Z","updated_at":"2019-06-18T19:49:56Z","closed_at":"2019-05-18T04:29:20Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"## Introduction\r\n\r\nThis is a meta issue for tracking initial iteration of adding geo features to SQL. Our implementation will be based on the [OpenGISÂ® Implementation Standard for Geographic information - Simple feature access](http://www.opengeospatial.org/standards/sfs), which is the current standard for GIS system implementation. This effort will concentrate on SQL option AKA ISO 19125-2. Later on we might also consider adding support for SQL/MM (ISO 13249-3), which extends Simple Feature Access with circular interpolations. \r\n\r\nThe current work can be found in the [geosql](https://github.com/elastic/elasticsearch/tree/geosql) branch.\r\n\r\n## Initial Implementation plan\r\n\r\nThis effort will be divided in the following sub-issues\r\n\r\n- [X] Identify a minimal viable set of SQL queries that can already be supported by ES with minimal or no changes\r\n- [X] Figure out the best way to load [Blue Lake](https://github.com/opengeospatial/ets-wms13/tree/master/src/main/resources/data) dataset into elasticsearch. This dataset is a part of the standard and can be used for integration testing. LINK REDACTED\r\n- [x] Make sure that WKT ([Well-known text](http://docs.opengeospatial.org/is/12-063r5/12-063r5.html))  parsing functions are available to SQL plugin. Simple Features are using WKT for geo shape representation and SQL will need to be able to translate between different shape representations\r\n- [x] Add support for returning geo shapes columns in SELECT clauses\r\n- [x] Whitelist WKT and other geo function so they can be called from painless in case they appear in the WHERE clause expressions\r\n- [X] Add support for basic geometry property functions such as `ST_X` and `ST_Y` #35698 \r\n- [X] Add support for geo queries in WHERE clauses #40595\r\n- [X] ~~Add support for geo aggregations~~ (aggregation are not supported for geo-shapes, so they are out of the initial scope)\r\n- [X] Upgrade H2 to 1.5.0 if it is ready or move all geo tests into a separate project where we can use JTS 1.14 as dependency #40461\r\n- [x] Add support for Geometry to JDBC client #35767 \r\n- [x] Switch server side processing from ShapeBuilder to libs/geo #41692\r\n- [x] Add support for `ST_Z` #41772\r\n- [x] Add ODBC support https://github.com/elastic/elasticsearch-sql-odbc/pull/154\r\n\r\n\r\n## Queries that will be supported in the initial implementation\r\n\r\n### Initial minimal release should support the following commands:\r\n\r\n###  Metadata commands\r\n\r\n- `DESCRIBE table`  - returns the correct column type `GEOMETRY` for geo shapes\r\n- ~~`SYS_SPATIAL_REF`  - returns a table with a single spatial reference system WGS84~~\r\n- ~~`SYS_GEOMETRY_COLUMNS`  - returns a list of all geometry columns in all tables~~\r\n\r\n### Returning geoshapes and geopoints from elasticsearch\r\n\r\n- `SELECT * FROM table` - returns the geoshapes in their _source representation;\r\n- `SELECT ST_AsWKT(geom) FROM table;` and `SELECT ST_AsText(geom) FROM table;`- returns the geoshapes in their WKT representation;\r\n\r\n### Using geopoints to elasticsearch\r\n\r\n- The following functions will be supported for geopoints in queries and aggregations: `ST_GeomFromText`, \"ST_X`, `ST_Y`, `ST_Z`, `ST_Distance`.\r\n- `SELECT * FROM table WHERE ST_Distance(ST_GeomFromText(POINT(1 2), point) < 10;` - returns all records for which `point` is located within 10m from the `POINT(1 2)` by using query.\r\n\r\n### Limitations:\r\n\r\nGeoshapes cannot be used in queries, sorting and aggregations as part of this initial effort. In order to fully take advantage of geoshapes we would need to have access to geoshape doc values, which is coming in #37206. `ST_Z` cannot be used on geopoints in queries, sorting and aggregations since we don't store altitude in geo_point doc values.\r\n","closed_by":{"login":"bpintea","id":1562801,"node_id":"MDQ6VXNlcjE1NjI4MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1562801?v=4","gravatar_id":"","url":"https://api.github.com/users/bpintea","html_url":"https://github.com/bpintea","followers_url":"https://api.github.com/users/bpintea/followers","following_url":"https://api.github.com/users/bpintea/following{/other_user}","gists_url":"https://api.github.com/users/bpintea/gists{/gist_id}","starred_url":"https://api.github.com/users/bpintea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bpintea/subscriptions","organizations_url":"https://api.github.com/users/bpintea/orgs","repos_url":"https://api.github.com/users/bpintea/repos","events_url":"https://api.github.com/users/bpintea/events{/privacy}","received_events_url":"https://api.github.com/users/bpintea/received_events","type":"User","site_admin":false},"performed_via_github_app":null}