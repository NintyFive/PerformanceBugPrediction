{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14584","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14584/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14584/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14584/events","html_url":"https://github.com/elastic/elasticsearch/issues/14584","id":115502689,"node_id":"MDU6SXNzdWUxMTU1MDI2ODk=","number":14584,"title":"NPE onNodeFailure ","user":{"login":"bangert","id":73190,"node_id":"MDQ6VXNlcjczMTkw","avatar_url":"https://avatars0.githubusercontent.com/u/73190?v=4","gravatar_id":"","url":"https://api.github.com/users/bangert","html_url":"https://github.com/bangert","followers_url":"https://api.github.com/users/bangert/followers","following_url":"https://api.github.com/users/bangert/following{/other_user}","gists_url":"https://api.github.com/users/bangert/gists{/gist_id}","starred_url":"https://api.github.com/users/bangert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bangert/subscriptions","organizations_url":"https://api.github.com/users/bangert/orgs","repos_url":"https://api.github.com/users/bangert/repos","events_url":"https://api.github.com/users/bangert/events{/privacy}","received_events_url":"https://api.github.com/users/bangert/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2015-11-06T13:15:38Z","updated_at":"2015-11-09T13:05:00Z","closed_at":"2015-11-06T17:10:36Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nwe may have tried something stupid here:\n\n```\n$ curl 192.168.8.180:9200/_cat/nodes?h=name,version,jdk,ip,master,node.role\nrobocop      2.0.0 1.7.0_79 192.168.8.237 - d\nDet Røde Lyn 2.0.0 1.8.0_65 192.168.8.180 * -\nstuart       2.0.0 1.8.0_65 192.168.8.13  - d\nGulle        2.0.0 1.7.0_85 192.168.8.21  m d \n```\n\n\"Det Røde Lyn\" is a windows machine.\n\nall nodes have \"Gulle\" configured as unicast host\n\n```\ndiscovery.zen.ping.unicast.hosts: [\"192.168.8.21\"]\n```\n\nwhen Gulle shutdown the cluster broke down and the following shows up in the log of the stuart node. The logfile of the other nodes in the cluster dont show a similar NPE.\n\nWe have been unable to reproduce this, but thought you might be interested in this anyway.\n\n```\n[2015-11-06 13:28:07,710][INFO ][cluster.routing.allocation.decider] [stuart] updating [cluster.routing.allocation.enable] from [ALL] to [NONE]\n[2015-11-06 13:28:47,859][INFO ][discovery.zen            ] [stuart] master_left [{Gulle}{F4pDMpoOSG6U0fBuxUzFWg}{192.168.8.21}{192.168.8.21:9300}], reason [transport disconnected]\n[2015-11-06 13:28:47,859][WARN ][discovery.zen            ] [stuart] master left (reason = transport disconnected), current nodes: {{robocop}{LHRwN1SYTMC05oPnrnlhVg}{192.168.8.237}{192.168.8.237:9300}{rack=robo-desk, max_local_storage_nodes=1, master=false},{Det Røde Lyn}{DmoJNBpOR8m1WKBPQojwag}{192.168.8.180}{192.168.8.180:9300}{data=false},{stuart}{TYWtWR00Q6Kv8pG6Fi09Yw}{192.168.8.13}{192.168.8.13:9300}{master=false},}\n[2015-11-06 13:28:47,859][INFO ][cluster.service          ] [stuart] removed {{Gulle}{F4pDMpoOSG6U0fBuxUzFWg}{192.168.8.21}{192.168.8.21:9300},}, reason: zen-disco-master_failed ({Gulle}{F4pDMpoOSG6U0fBuxUzFWg}{192.168.8.21}{192.168.8.21:9300})\n[2015-11-06 13:28:50,397][DEBUG][action.admin.cluster.state] [stuart] no known master node, scheduling a retry\n[2015-11-06 13:28:50,398][DEBUG][action.admin.cluster.state] [stuart] no known master node, scheduling a retry\n[2015-11-06 13:28:50,398][INFO ][rest.suppressed          ] /_stats/docs,store Params: {metric=docs,store}\njava.lang.NullPointerException\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction$AsyncAction.onNodeFailure(TransportBroadcastByNodeAction.java:332)\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction$AsyncAction.sendNodeRequest(TransportBroadcastByNodeAction.java:314)\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction$AsyncAction.start(TransportBroadcastByNodeAction.java:284)\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction.doExecute(TransportBroadcastByNodeAction.java:217)\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction.doExecute(TransportBroadcastByNodeAction.java:77)\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:70)\n        at org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:58)\n        at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:347)\n        at org.elasticsearch.client.FilterClient.doExecute(FilterClient.java:52)\n        at org.elasticsearch.rest.BaseRestHandler$HeadersAndContextCopyClient.doExecute(BaseRestHandler.java:83)\n        at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:347)\n        at org.elasticsearch.client.support.AbstractClient$IndicesAdmin.execute(AbstractClient.java:1177)\n        at org.elasticsearch.client.support.AbstractClient$IndicesAdmin.stats(AbstractClient.java:1482)\n        at org.elasticsearch.rest.action.admin.indices.stats.RestIndicesStatsAction.handleRequest(RestIndicesStatsAction.java:102)\n        at org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:54)\n        at org.elasticsearch.rest.RestController.executeHandler(RestController.java:207)\n        at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:166)\n        at org.elasticsearch.http.HttpServer.internalDispatchRequest(HttpServer.java:128)\n        at org.elasticsearch.http.HttpServer$Dispatcher.dispatchRequest(HttpServer.java:86)\n        at org.elasticsearch.http.netty.NettyHttpServerTransport.dispatchRequest(NettyHttpServerTransport.java:348)\n        at org.elasticsearch.http.netty.HttpRequestHandler.messageReceived(HttpRequestHandler.java:63)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.http.netty.pipelining.HttpPipeliningHandler.messageReceived(HttpPipeliningHandler.java:60)\n        at org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.jboss.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.jboss.netty.handler.codec.http.HttpContentDecoder.messageReceived(HttpContentDecoder.java:108)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n        at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459)\n        at org.jboss.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536)\n        at org.jboss.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:75)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n        at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n        at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337)\n        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n        at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n        at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n[2015-11-06 13:28:50,398][DEBUG][action.admin.indices.get ] [stuart] no known master node, scheduling a retry\n[2015-11-06 13:28:50,399][DEBUG][action.admin.cluster.health] [stuart] no known master node, scheduling a retry\n[2015-11-06 13:28:51,291][INFO ][cluster.service          ] [stuart] detected_master {Det Røde Lyn}{DmoJNBpOR8m1WKBPQojwag}{192.168.8.180}{192.168.8.180:9300}{data=false}, reason: zen-disco-receive(from master [{Det Røde Lyn}{DmoJNBpOR8m1WKBPQojwag}{192.168.8.180}{192.168.8.180:9300}{data=false}])\n[2015-11-06 13:29:13,992][INFO ][cluster.service          ] [stuart] added {{Gulle}{vDbnkAfsT96NnX_Q3cN1oA}{192.168.8.21}{192.168.8.21:9300},}, reason: zen-disco-receive(from master [{Det Røde Lyn}{DmoJNBpOR8m1WKBPQojwag}{192.168.8.180}{192.168.8.180:9300}{data=false}])\n[2015-11-06 13:29:55,312][INFO ][cluster.routing.allocation.decider] [stuart] updating [cluster.routing.allocation.enable] from [NONE] to [ALL]\n```\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}