[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/250576733","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-250576733","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":250576733,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MDU3NjczMw==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-09-29T20:08:37Z","updated_at":"2016-09-29T20:08:37Z","author_association":"CONTRIBUTOR","body":"I guess the docs should be updated to say don't specify version in insert, and is there a breaking change noted someplace about this as this is working on 1.7.5\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/250576944","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-250576944","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":250576944,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MDU3Njk0NA==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-09-29T20:09:32Z","updated_at":"2016-09-29T20:09:32Z","author_association":"CONTRIBUTOR","body":"I think it could be a bug, that if I specify a version of 1 on insert and it matches the internal implementation it shouldn't throw an error.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/250779188","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-250779188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":250779188,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MDc3OTE4OA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-09-30T15:44:47Z","updated_at":"2016-09-30T15:44:47Z","author_association":"MEMBER","body":"@niemyjski can you give an example of the concrete indexing requests you use? NEST , Sense or just curl style are all fine.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/250811116","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-250811116","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":250811116,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MDgxMTExNg==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-09-30T17:59:24Z","updated_at":"2016-09-30T17:59:24Z","author_association":"CONTRIBUTOR","body":"```\nPUT http://127.0.0.1:9200/employees \n{\"mappings\":{\"employee\":{\"dynamic\":false,\"properties\":{\"id\":{\"type\":\"keyword\"},\"isDeleted\":{\"type\":\"boolean\"},\"createdUtc\":{\"type\":\"date\"},\"updatedUtc\":{\"type\":\"date\"},\"companyId\":{\"type\":\"keyword\"},\"companyName\":{\"type\":\"keyword\"},\"name\":{\"type\":\"text\"},\"age\":{\"type\":\"float\"}}}}}\n```\n\nVersion 0 previously worked in 1.x\n\n```\nPUT http://127.0.0.1:9200/employees/employee/57eea70cf8a1031bb0f54895?version=0 \n{\"createdUtc\":\"2016-09-30T17:55:24.2736658Z\",\"id\":\"57eea70cf8a1031bb0f54895\",\"companyId\":\"57eea70cf8a1031bb0f54894\",\"age\":20,\"yearsEmployed\":0,\"updatedUtc\":\"2016-09-30T17:55:24.2736658Z\",\"isDeleted\":false}\n```\n\nthis returns\n\n```\nHTTP/1.1 400 Bad Request\n\n{\"error\":{\"root_cause\":[{\"type\":\"action_request_validation_exception\",\"reason\":\"Validation Failed: 1: illegal version value [0] for version type [INTERNAL];\"}],\"type\":\"action_request_validation_exception\",\"reason\":\"Validation Failed: 1: illegal version value [0] for version type [INTERNAL];\"},\"status\":400}\n```\n\nVersion 1 (same as the default for internal versioning):\n\n```\nPUT http://127.0.0.1:9200/employees/employee/57eea70cf8a1031bb0f54895?version=1 \n{\"createdUtc\":\"2016-09-30T17:55:24.2736658Z\",\"id\":\"57eea70cf8a1031bb0f54895\",\"companyId\":\"57eea70cf8a1031bb0f54894\",\"age\":20,\"yearsEmployed\":0,\"updatedUtc\":\"2016-09-30T17:55:24.2736658Z\",\"isDeleted\":false}\n```\n\nreturns \n\n```\nHTTP/1.1 409 Conflict\n{\"error\":{\"root_cause\":[{\"type\":\"version_conflict_engine_exception\",\"reason\":\"[employee][57eea70cf8a1031bb0f54895]: version conflict, current version [-1] is different than the one provided [1]\",\"index_uuid\":\"sjlQ4NwrT1-sBrc0_sIkGA\",\"shard\":\"0\",\"index\":\"employees\"}],\"type\":\"version_conflict_engine_exception\",\"reason\":\"[employee][57eea70cf8a1031bb0f54895]: version conflict, current version [-1] is different than the one provided [1]\",\"index_uuid\":\"sjlQ4NwrT1-sBrc0_sIkGA\",\"shard\":\"0\",\"index\":\"employees\"},\"status\":409}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251065334","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251065334","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251065334,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTA2NTMzNA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T09:39:17Z","updated_at":"2016-10-03T09:39:17Z","author_association":"MEMBER","body":"@niemyjski thx.  Somewhat in reverse order:\n\n> Version 1 (same as the default for internal versioning):\n\nThe use of default here is not really right. Adding a version to the index API means - \"only index it if the documents _current_ version is set to this\". In your call it means it has been indexed before and never changed. If the document doesn't exist, the version checks throw a conflict, which is good.\n\n> Version 0 previously worked in 1.x\n\nA version value of 0 is invalid indeed. I think it's good we signal that now?\n\nGoing back to the original comment:\n\n> We were inserting a document with version 0 (the model default),\n\nIt seems like you are trying to model a document and you want it have the 0 version when first created. Instead of using the index API in the case, you should use the `_create` one. This will give you the guarantees you are looking for. I'm going to close this now as it seems like everything works as intended.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251118164","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251118164","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251118164,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTExODE2NA==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T14:19:40Z","updated_at":"2016-10-03T14:19:40Z","author_association":"CONTRIBUTOR","body":"Can you link me to the docs for `_create`. I still think this is a bug. I have a generic library for indexing elasticsearch and I don't know if it was called from Add or Save method. I just pass along the index version on the document which worked before. If the default value after add is 1 and I pass in 1, that shouldn't throw an error (as it didn't previously). I do see why you made the change, but when it comes to concurrency, any update will change the version, so specifying the initial default value can only happen once...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251122760","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251122760","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251122760,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTEyMjc2MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T14:36:56Z","updated_at":"2016-10-03T21:31:08Z","author_association":"MEMBER","body":"@niemyjski I suggest you read up on the versioning scheme - it's not specified the version of the written doc but rather that on the previous one. Also, here are the `_create` docs, straight out of google - https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#operation-type\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251124816","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251124816","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251124816,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTEyNDgxNg==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T14:44:17Z","updated_at":"2016-10-03T14:44:17Z","author_association":"CONTRIBUTOR","body":"Yes, I get that 100% but there isn't a previous version when the doc is first written! My unit test wipes out the cluster and creates the mappings and writes a single doc with a version and it fails... The version I'm specifying is the same version that elasticsearch returns after the doc is created (without specifying the version). I logged this as it was working before and I don't think indexing should fail if the internal version number will be the EXACT same as the version specified for creation.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251125001","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251125001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251125001,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTEyNTAwMQ==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T14:44:57Z","updated_at":"2016-10-03T14:44:57Z","author_association":"CONTRIBUTOR","body":"That link sends me to a 404\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251128159","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251128159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251128159,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTEyODE1OQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T14:53:51Z","updated_at":"2016-10-03T14:53:51Z","author_association":"MEMBER","body":"> That link sends me to a 404\n\nGithub mangles it up - here is a workable version [https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#operation-type](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#operation-type)\n\n> it was working before\n\nThat doesn't mean it should keep working. I tried to explain, but I think something is still not clear - as I said before - I strongly suggest you read up on versioning. Docs are [here](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-versioning) and a blog post is [here](https://www.elastic.co/blog/elasticsearch-versioning-support). I also request you try out my suggestion before further discussing. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251171120","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251171120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251171120,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTE3MTEyMA==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T17:33:40Z","updated_at":"2016-10-03T18:04:18Z","author_association":"CONTRIBUTOR","body":"I reread all the documents to ensure I wasn't missing anything... I'm not saying that something should never change due to backwards compatibility. I just think the docs here and announcements don't correlate to the actual behavior that occurs now nor the fact it was a breaking change (which is okay as long as it's stated someplace).\n\n> By default, internal versioning is used that starts at 1 and increments with each update, deletes included. Optionally, the version number can be supplemented with an external value (for example, if maintained in a database). To enable this functionality, version_type should be set to external. The value provided must be a numeric, long value greater or equal to 0, and less than around 9.2e+18. \n\n..\n\n> When you index a document for the very first time, it gets the version 1 and you can see that in the response Elasticsearch returns. \n\n..\n\n> Consider the indexing command above. With internal versioning, it means \"only index this document update if its current version is equal to 526\". If the version matches, Elasticsearch will increase it by one and store the document. However, with an external versioning system this will be a requirement we can't enforce. Maybe that versioning system doesn't increment by one every time.\n\n..\n\n> internal\n> only index the document if the given version is identical to the version of the stored document.\n\n**updated** No where does it say you shouldn't specify a version on create. It also doesn't make sense that I can't specify `0` for a newly inserted doc, this simplifies indexing on the client without having extra rules (generic code). As pointed out this would make deletes a bit trickier.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251377550","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251377550","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251377550,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTM3NzU1MA==","user":{"login":"russcam","id":208231,"node_id":"MDQ6VXNlcjIwODIzMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/208231?v=4","gravatar_id":"","url":"https://api.github.com/users/russcam","html_url":"https://github.com/russcam","followers_url":"https://api.github.com/users/russcam/followers","following_url":"https://api.github.com/users/russcam/following{/other_user}","gists_url":"https://api.github.com/users/russcam/gists{/gist_id}","starred_url":"https://api.github.com/users/russcam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russcam/subscriptions","organizations_url":"https://api.github.com/users/russcam/orgs","repos_url":"https://api.github.com/users/russcam/repos","events_url":"https://api.github.com/users/russcam/events{/privacy}","received_events_url":"https://api.github.com/users/russcam/received_events","type":"User","site_admin":false},"created_at":"2016-10-04T12:46:19Z","updated_at":"2016-10-04T12:46:19Z","author_association":"CONTRIBUTOR","body":"@niemyjski, specifying a version on a create call makes no sense though; because there is no current  version of the document when performing a create, there is no version that can be specified on the create call. To allow optimistic concurrency control when creating a document, you can use `.OpType(OpType.Create)` on an index call in NEST.\n\n[I wrote a blog post about using Optimistic Concurrency Control with NEST and Elasticsearch](http://forloop.co.uk/blog/optimistic-concurrency-with-elasticsearch-and-nest); hope it helps.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251389618","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-251389618","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":251389618,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTM4OTYxOA==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-10-04T13:37:11Z","updated_at":"2016-10-04T13:37:11Z","author_association":"CONTRIBUTOR","body":"I'm not calling the create api, just bulk index generically for both create and save.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271101422","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-271101422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":271101422,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTEwMTQyMg==","user":{"login":"arakelian","id":1766075,"node_id":"MDQ6VXNlcjE3NjYwNzU=","avatar_url":"https://avatars3.githubusercontent.com/u/1766075?v=4","gravatar_id":"","url":"https://api.github.com/users/arakelian","html_url":"https://github.com/arakelian","followers_url":"https://api.github.com/users/arakelian/followers","following_url":"https://api.github.com/users/arakelian/following{/other_user}","gists_url":"https://api.github.com/users/arakelian/gists{/gist_id}","starred_url":"https://api.github.com/users/arakelian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arakelian/subscriptions","organizations_url":"https://api.github.com/users/arakelian/orgs","repos_url":"https://api.github.com/users/arakelian/repos","events_url":"https://api.github.com/users/arakelian/events{/privacy}","received_events_url":"https://api.github.com/users/arakelian/received_events","type":"User","site_admin":false},"created_at":"2017-01-07T18:37:33Z","updated_at":"2017-01-07T18:37:33Z","author_association":"NONE","body":"@russcam Following up @niemyjski comment.  Either there is a bug, or the document is wrong.\r\n\r\nUsing a new index, I make the following bulk API request (using curl):\r\n```\r\n{\"index\":{\"_index\":\"test\",\"_type\":\"default\",\"_id\":\"100\",\"_version\":1483813028207}}\r\n{\"id\":\"100\",\"firstName\":\"John\",\"lastName\":\"Doe\"}\r\n```\r\n\r\nNote that I'm using the \"index\" operation, NOT \"create\".  Per the docs [Bulk API docs](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html) \"index and create expect a source on the next line, and have the same semantics as the op_type parameter to the standard index API (i.e. create will fail if a document with the same index and type exists already, **whereas index will add or replace a document as necessary**).\r\n\r\nYet, I get back an error like this:\r\n```\r\n      \"index\" : {\r\n        \"_index\" : \"test\",\r\n        \"_type\" : \"default\",\r\n        \"_id\" : \"100\",\r\n        \"status\" : 409,\r\n        \"error\" : {\r\n          \"type\" : \"version_conflict_engine_exception\",\r\n          \"reason\" : \"[default][100]: version conflict, current version [-1] is different than the one provided [1483813028207]\",\r\n  ....\r\n        }\r\n      }\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271114253","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-271114253","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":271114253,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTExNDI1Mw==","user":{"login":"arakelian","id":1766075,"node_id":"MDQ6VXNlcjE3NjYwNzU=","avatar_url":"https://avatars3.githubusercontent.com/u/1766075?v=4","gravatar_id":"","url":"https://api.github.com/users/arakelian","html_url":"https://github.com/arakelian","followers_url":"https://api.github.com/users/arakelian/followers","following_url":"https://api.github.com/users/arakelian/following{/other_user}","gists_url":"https://api.github.com/users/arakelian/gists{/gist_id}","starred_url":"https://api.github.com/users/arakelian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arakelian/subscriptions","organizations_url":"https://api.github.com/users/arakelian/orgs","repos_url":"https://api.github.com/users/arakelian/repos","events_url":"https://api.github.com/users/arakelian/events{/privacy}","received_events_url":"https://api.github.com/users/arakelian/received_events","type":"User","site_admin":false},"created_at":"2017-01-07T22:22:17Z","updated_at":"2017-01-07T22:22:17Z","author_association":"NONE","body":"@russcam Disregard my last message. Realized that I needed to pass \"version_type\":\"external\". Everything worked fine then.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386283716","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-386283716","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":386283716,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjI4MzcxNg==","user":{"login":"erdalceylan","id":4347677,"node_id":"MDQ6VXNlcjQzNDc2Nzc=","avatar_url":"https://avatars1.githubusercontent.com/u/4347677?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalceylan","html_url":"https://github.com/erdalceylan","followers_url":"https://api.github.com/users/erdalceylan/followers","following_url":"https://api.github.com/users/erdalceylan/following{/other_user}","gists_url":"https://api.github.com/users/erdalceylan/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalceylan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalceylan/subscriptions","organizations_url":"https://api.github.com/users/erdalceylan/orgs","repos_url":"https://api.github.com/users/erdalceylan/repos","events_url":"https://api.github.com/users/erdalceylan/events{/privacy}","received_events_url":"https://api.github.com/users/erdalceylan/received_events","type":"User","site_admin":false},"created_at":"2018-05-03T12:47:46Z","updated_at":"2018-05-03T12:47:46Z","author_association":"NONE","body":"https://www.elastic.co/blog/elasticsearch-versioning-support\r\n\r\n['retry_on_conflict'] = (number) Specify how many times should the operation be retried when a conflict\r\n\r\nworks for me","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/405753904","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-405753904","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":405753904,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTc1MzkwNA==","user":{"login":"wangyankuku","id":9457576,"node_id":"MDQ6VXNlcjk0NTc1NzY=","avatar_url":"https://avatars1.githubusercontent.com/u/9457576?v=4","gravatar_id":"","url":"https://api.github.com/users/wangyankuku","html_url":"https://github.com/wangyankuku","followers_url":"https://api.github.com/users/wangyankuku/followers","following_url":"https://api.github.com/users/wangyankuku/following{/other_user}","gists_url":"https://api.github.com/users/wangyankuku/gists{/gist_id}","starred_url":"https://api.github.com/users/wangyankuku/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangyankuku/subscriptions","organizations_url":"https://api.github.com/users/wangyankuku/orgs","repos_url":"https://api.github.com/users/wangyankuku/repos","events_url":"https://api.github.com/users/wangyankuku/events{/privacy}","received_events_url":"https://api.github.com/users/wangyankuku/received_events","type":"User","site_admin":false},"created_at":"2018-07-17T22:53:56Z","updated_at":"2018-07-17T22:53:56Z","author_association":"NONE","body":"@niemyjski Is this issue solved? I was also troubled by this -1 version problem. I cannot delete the doc from es","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427754944","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-427754944","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":427754944,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzc1NDk0NA==","user":{"login":"Ad4mJ","id":4152222,"node_id":"MDQ6VXNlcjQxNTIyMjI=","avatar_url":"https://avatars3.githubusercontent.com/u/4152222?v=4","gravatar_id":"","url":"https://api.github.com/users/Ad4mJ","html_url":"https://github.com/Ad4mJ","followers_url":"https://api.github.com/users/Ad4mJ/followers","following_url":"https://api.github.com/users/Ad4mJ/following{/other_user}","gists_url":"https://api.github.com/users/Ad4mJ/gists{/gist_id}","starred_url":"https://api.github.com/users/Ad4mJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ad4mJ/subscriptions","organizations_url":"https://api.github.com/users/Ad4mJ/orgs","repos_url":"https://api.github.com/users/Ad4mJ/repos","events_url":"https://api.github.com/users/Ad4mJ/events{/privacy}","received_events_url":"https://api.github.com/users/Ad4mJ/received_events","type":"User","site_admin":false},"created_at":"2018-10-08T08:24:08Z","updated_at":"2018-10-08T08:35:47Z","author_association":"NONE","body":"Also, upgraded to 5.5.6 and using the _bulk method with the version type external_gte returns this conflict error\r\n\r\n```\r\n \"type\": \"version_conflict_engine_exception\",\r\n\"reason\": \"[indexname][12701]: version conflict, current version [33321437] is higher than the one provided [33321434]\"\r\n```\r\n\r\nDo we know if this bug has been fixed in later versions?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427760246","html_url":"https://github.com/elastic/elasticsearch/issues/20702#issuecomment-427760246","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20702","id":427760246,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzc2MDI0Ng==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-10-08T08:45:36Z","updated_at":"2018-10-08T08:45:36Z","author_association":"CONTRIBUTOR","body":"@Ad4mJ this seems unrelated to the discussion above (which was about internal versioning). Can you open a topic on `discuss.elastic.co` so that we can better understand your case before we escalate this to a Github issue? Thank you.","performed_via_github_app":null}]