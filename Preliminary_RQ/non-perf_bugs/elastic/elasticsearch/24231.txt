{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24231","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24231/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24231/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24231/events","html_url":"https://github.com/elastic/elasticsearch/issues/24231","id":223293743,"node_id":"MDU6SXNzdWUyMjMyOTM3NDM=","number":24231,"title":"Cannot remove plugin from docker container","user":{"login":"tback","id":83432,"node_id":"MDQ6VXNlcjgzNDMy","avatar_url":"https://avatars0.githubusercontent.com/u/83432?v=4","gravatar_id":"","url":"https://api.github.com/users/tback","html_url":"https://github.com/tback","followers_url":"https://api.github.com/users/tback/followers","following_url":"https://api.github.com/users/tback/following{/other_user}","gists_url":"https://api.github.com/users/tback/gists{/gist_id}","starred_url":"https://api.github.com/users/tback/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tback/subscriptions","organizations_url":"https://api.github.com/users/tback/orgs","repos_url":"https://api.github.com/users/tback/repos","events_url":"https://api.github.com/users/tback/events{/privacy}","received_events_url":"https://api.github.com/users/tback/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2017-04-21T06:51:50Z","updated_at":"2017-04-23T14:12:06Z","closed_at":"2017-04-21T19:50:45Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"It seems uninstalling plugins from the official docker image is broken.\r\n\r\nMy colleagues were unable to reproduce this error on debian stretch with btrfs. \r\n\r\nI'm opening this issue in response to @jasontedor https://github.com/elastic/elasticsearch/pull/23548#issuecomment-295793139\r\n\r\n**Elasticsearch version**:\r\n5.3.1\r\n\r\n**Plugins installed**: [x-pack]\r\n\r\n**JVM version**:\r\n```\r\ndocker run -ti --rm --name es docker.elastic.co/elasticsearch/elasticsearch:5.3.1 /usr/lib/jvm/java-1.8-openjdk/bin/java -version\r\nopenjdk version \"1.8.0_121\"\r\nOpenJDK Runtime Environment (IcedTea 3.3.0) (Alpine 8.121.13-r0)\r\nOpenJDK 64-Bit Server VM (build 25.121-b13, mixed mode)\r\n```\r\n\r\n**OS version**:\r\nmacos sierra 10.12.3 (16D32)\r\nDocker Version 17.03.1-ce-mac5 (16048, b18e2a50cc)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI expect to successfully remove x-pack like any other plugin from the official docker image. I get an error instead.\r\nI'd much rather get an official image without x-pack altogether, but thats a business decision I guess. Making x-pack hard to uninstall will drive me to community images for sure.\r\n\r\n**Steps to reproduce**:\r\n 1. Create a Dockerfile\r\n```FROM docker.elastic.co/elasticsearch/elasticsearch:5.3.1\r\n\r\nRUN eval ${ES_JAVA_OPTS:-} && \\\r\n    elasticsearch-plugin remove --silent x-pack\r\n```\r\n 2. Try to build it\r\n```docker build .```\r\n 3. Trace\r\n```docker build .\r\nSending build context to Docker daemon 2.048 kB\r\nStep 1/2 : FROM docker.elastic.co/elasticsearch/elasticsearch:5.3.1\r\n5.3.1: Pulling from elasticsearch/elasticsearch\r\nec37562cf8fa: Pull complete\r\n3f5b02e577c3: Pull complete\r\ne4c7c0eb9289: Pull complete\r\ne8008e68933d: Pull complete\r\n1cfca4b45f64: Pull complete\r\n77148a7a523b: Pull complete\r\nc93eabd5eff3: Pull complete\r\nd82d8a15579f: Pull complete\r\n0f2b8d9540a0: Pull complete\r\n5c9aa0d9a460: Pull complete\r\nDigest: sha256:94ebca9d6316902596ceef6934161be39cca04885fcf07c8ab3feb04c02b4933\r\nStatus: Downloaded newer image for docker.elastic.co/elasticsearch/elasticsearch:5.3.1\r\n ---> 94062e7e850e\r\nStep 2/2 : RUN eval ${ES_JAVA_OPTS:-} &&     elasticsearch-plugin remove --silent x-pack\r\n ---> Running in c7a27bb18817\r\nException in thread \"main\" java.nio.file.DirectoryNotEmptyException: /usr/share/elasticsearch/plugins/x-pack\r\n\tat sun.nio.fs.UnixCopyFile.move(UnixCopyFile.java:498)\r\n\tat sun.nio.fs.UnixFileSystemProvider.move(UnixFileSystemProvider.java:262)\r\n\tat java.nio.file.Files.move(Files.java:1395)\r\n\tat org.elasticsearch.plugins.RemovePluginCommand.execute(RemovePluginCommand.java:91)\r\n\tat org.elasticsearch.plugins.RemovePluginCommand.execute(RemovePluginCommand.java:56)\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:58)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)\r\n\tat org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:69)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)\r\n\tat org.elasticsearch.cli.Command.main(Command.java:88)\r\n\tat org.elasticsearch.plugins.PluginCli.main(PluginCli.java:47)\r\nThe command '/bin/sh -c eval ${ES_JAVA_OPTS:-} &&     elasticsearch-plugin remove --silent x-pack' returned a non-zero code: 1\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}