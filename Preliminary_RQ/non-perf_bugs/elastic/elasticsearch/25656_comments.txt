[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/314792634","html_url":"https://github.com/elastic/elasticsearch/issues/25656#issuecomment-314792634","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25656","id":314792634,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNDc5MjYzNA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-12T14:46:39Z","updated_at":"2017-07-12T14:46:39Z","author_association":"MEMBER","body":"hi @yazaddaruvala ,\r\nwhen using the nested type, you submit a single document that contains all of its nested documents. The nested ones get extracted and indexed as separate lucene documents, but the whole structure is stored in the same lucene segment block. Parent and all its nested are stored contiguously, which is what makes nested documents the fastest way to do \"joins\" within Elasticsearch.\r\n\r\nLucene segments are immutable, which is why updating a single nested document in the whole tree structure requires reindexing the parent with all of its nested docs.\r\n\r\nDue to the way nested docs are stored in lucene and the immutability of segments, I do not think that what you are asking is possible. You can't have a new document referencing an existing nested document that is stored in some other segment. The assumption that the whole structure is stored in the same segment block wouldn't hold anymore.\r\n\r\nSame wouldn't be possible using parent-child either, which tends to be a bit more flexible than nested, but it allows to specify only one parent id per document. One document can't have multiple parents.\r\n\r\n@martijnvg @jimczi do you have anything to add?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/314817064","html_url":"https://github.com/elastic/elasticsearch/issues/25656#issuecomment-314817064","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25656","id":314817064,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNDgxNzA2NA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-07-12T16:04:53Z","updated_at":"2017-07-12T16:04:53Z","author_association":"MEMBER","body":"> Same wouldn't be possible using parent-child either, which tends to be a bit more flexible than nested, but it allows to specify only one parent id per document. One document can't have multiple parents.\r\n\r\nNothing to add, that's a limitation of the parent-child and there is nothing we can do about it at the moment.\r\n\r\nSince the number of child documents per parent is small (an house cannot have thousands of windows) I think that using `nested` is a good solution. You have fast joins but you have to pay the price of child duplications on disk. That's a good trade off considering how slow another type of join could be.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/314817833","html_url":"https://github.com/elastic/elasticsearch/issues/25656#issuecomment-314817833","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25656","id":314817833,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNDgxNzgzMw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-12T16:07:34Z","updated_at":"2017-07-12T16:07:34Z","author_association":"MEMBER","body":"Thanks @jimczi . Given that we cannot support this feature, I am going to close this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/314853938","html_url":"https://github.com/elastic/elasticsearch/issues/25656#issuecomment-314853938","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25656","id":314853938,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNDg1MzkzOA==","user":{"login":"yazaddaruvala","id":812652,"node_id":"MDQ6VXNlcjgxMjY1Mg==","avatar_url":"https://avatars0.githubusercontent.com/u/812652?v=4","gravatar_id":"","url":"https://api.github.com/users/yazaddaruvala","html_url":"https://github.com/yazaddaruvala","followers_url":"https://api.github.com/users/yazaddaruvala/followers","following_url":"https://api.github.com/users/yazaddaruvala/following{/other_user}","gists_url":"https://api.github.com/users/yazaddaruvala/gists{/gist_id}","starred_url":"https://api.github.com/users/yazaddaruvala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yazaddaruvala/subscriptions","organizations_url":"https://api.github.com/users/yazaddaruvala/orgs","repos_url":"https://api.github.com/users/yazaddaruvala/repos","events_url":"https://api.github.com/users/yazaddaruvala/events{/privacy}","received_events_url":"https://api.github.com/users/yazaddaruvala/received_events","type":"User","site_admin":false},"created_at":"2017-07-12T18:18:48Z","updated_at":"2017-07-12T18:18:48Z","author_association":"NONE","body":"Interesting. Its good to know more about how nested docs in Lucene work.\r\n\r\nThanks for the quick turn around time and for eliminating this option early. We will focus on other ways to optimize our clusters.\r\n","performed_via_github_app":null}]