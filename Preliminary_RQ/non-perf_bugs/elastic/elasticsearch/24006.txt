{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24006","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24006/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24006/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24006/events","html_url":"https://github.com/elastic/elasticsearch/issues/24006","id":220580656,"node_id":"MDU6SXNzdWUyMjA1ODA2NTY=","number":24006,"title":"YAML config file parsing behaviour changed between 5.x and master","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"},{"id":151933706,"node_id":"MDU6TGFiZWwxNTE5MzM3MDY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eupgrade","name":">upgrade","color":"c7def8","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-04-10T09:05:35Z","updated_at":"2017-04-10T14:59:30Z","closed_at":"2017-04-10T14:58:59Z","author_association":"MEMBER","active_lock_reason":null,"body":"The root of this change is https://github.com/elastic/elasticsearch/pull/22225\r\n\r\nThe following configuration file works in 5.x (tested with a 5.4 snapshot from https://oss.sonatype.org/content/repositories/snapshots/org/elasticsearch/distribution/zip/elasticsearch/5.4.0-SNAPSHOT/), but throws an exception in master, tested with a snapshot from https://oss.sonatype.org/content/repositories/snapshots/org/elasticsearch/distribution/zip/elasticsearch/6.0.0-alpha1-SNAPSHOT/\r\n\r\n```YAML\r\nnode:\r\n  name: node1\r\n\r\nnode:\r\n  attr:\r\n    rack: r1\r\n```\r\n\r\nThis stacktrace is shown on master\r\n\r\n\r\n```\r\nException in thread \"main\" SettingsException[Failed to load settings from /tmp/test-nesting/elasticsearch-6.0.0-alpha1-SNAPSHOT/config/elasticsearch.yml]; nested: JsonParseException[Duplicate field 'node'\r\n...\r\n; line: 4, column: 5]];\r\n\tat org.elasticsearch.node.InternalSettingsPreparer.prepareEnvironment(InternalSettingsPreparer.java:104)\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.createEnv(EnvironmentAwareCommand.java:63)\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:58)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)\r\n\tat org.elasticsearch.cli.Command.main(Command.java:88)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:91)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:84)\r\nCaused by: com.fasterxml.jackson.core.JsonParseException: Duplicate field 'node'\r\n at [Source: node:\r\n  name: node1\r\n\r\nnode:\r\n  attr:\r\n    rack: r1\r\n...\r\n; line: 4, column: 5]\r\n\tat com.fasterxml.jackson.core.json.JsonReadContext._checkDup(JsonReadContext.java:204)\r\n\tat com.fasterxml.jackson.core.json.JsonReadContext.setCurrentName(JsonReadContext.java:198)\r\n\tat com.fasterxml.jackson.dataformat.yaml.YAMLParser.nextToken(YAMLParser.java:372)\r\n\tat org.elasticsearch.common.xcontent.json.JsonXContentParser.nextToken(JsonXContentParser.java:52)\r\n\tat org.elasticsearch.common.settings.loader.XContentSettingsLoader.serializeObject(XContentSettingsLoader.java:105)\r\n\tat org.elasticsearch.common.settings.loader.XContentSettingsLoader.load(XContentSettingsLoader.java:75)\r\n\tat org.elasticsearch.common.settings.loader.XContentSettingsLoader.load(XContentSettingsLoader.java:52)\r\n\tat org.elasticsearch.common.settings.loader.YamlSettingsLoader.load(YamlSettingsLoader.java:50)\r\n\tat org.elasticsearch.common.settings.Settings$Builder.loadFromStream(Settings.java:1046)\r\n\tat org.elasticsearch.common.settings.Settings$Builder.loadFromPath(Settings.java:1035)\r\n\tat org.elasticsearch.node.InternalSettingsPreparer.prepareEnvironment(InternalSettingsPreparer.java:102)\r\n\t... 6 more\r\n```\r\n\r\nI do consider this a good thing, just something we should be aware of that needs to be kept in mind when upgrading (part of the upgrade docs, as it is hard to warn about before the upgrade I suppose).\r\n\r\nFeel free to close without comment if not considered an issue.","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}