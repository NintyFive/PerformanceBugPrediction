{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51956","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51956/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51956/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51956/events","html_url":"https://github.com/elastic/elasticsearch/issues/51956","id":560517253,"node_id":"MDU6SXNzdWU1NjA1MTcyNTM=","number":51956,"title":"[ML] Inform user when persistent task allocation is disabled when creating or executing jobs","user":{"login":"inqueue","id":6099128,"node_id":"MDQ6VXNlcjYwOTkxMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/6099128?v=4","gravatar_id":"","url":"https://api.github.com/users/inqueue","html_url":"https://github.com/inqueue","followers_url":"https://api.github.com/users/inqueue/followers","following_url":"https://api.github.com/users/inqueue/following{/other_user}","gists_url":"https://api.github.com/users/inqueue/gists{/gist_id}","starred_url":"https://api.github.com/users/inqueue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/inqueue/subscriptions","organizations_url":"https://api.github.com/users/inqueue/orgs","repos_url":"https://api.github.com/users/inqueue/repos","events_url":"https://api.github.com/users/inqueue/events{/privacy}","received_events_url":"https://api.github.com/users/inqueue/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"}],"state":"closed","locked":false,"assignee":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"assignees":[{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2020-02-05T17:21:09Z","updated_at":"2020-02-11T15:22:22Z","closed_at":"2020-02-11T15:22:22Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.5.2\r\n**Platform:** ESS and on-prem\r\n\r\nIf persistent task allocation has been disabled with cluster setting `\"cluster.persistent_tasks.allocation.enable\": \"none\"`, the job creation UI informs the user with:\r\n\r\n```\r\nJob creation error\r\n\r\n[status_exception] Could not open job because no ML nodes with sufficient capacity were found\r\n```\r\n\r\n<img width=\"342\" alt=\"Screen Shot 2020-02-05 at 11 32 53 AM\" src=\"https://user-images.githubusercontent.com/6099128/73862997-5ec58880-480d-11ea-90f5-d2485b02e4dd.png\">\r\n\r\nThe job is left with status:\r\n\r\n```\r\nNo node found to open job. Reasons [persistent task [xpack/ml/job] cannot be assigned [no persistent task assignments are allowed due to cluster settings]]\r\n```\r\n\r\n<img width=\"1280\" alt=\"Screen Shot 2020-02-05 at 11 33 41 AM\" src=\"https://user-images.githubusercontent.com/6099128/73863444-15296d80-480e-11ea-9ae1-7e56dd902bf0.png\">\r\n\r\nThe initial `[status_exception] Could not open job because no ML nodes with sufficient capacity were found` error is especially misleading if the user knows ML nodes are available. Couple that with Kibana indicating there are no active ML nodes:\r\n\r\n![image](https://user-images.githubusercontent.com/6099128/73865053-a994cf80-4810-11ea-9291-b16e249ea3e9.png)\r\n\r\nIt would be a usability enhancement if these errors could point to the persistent tasks cluster setting as the culprit. \r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Disable allocation of persistent tasks.\r\n\r\n    ```\r\n    PUT /_cluster/settings\r\n    {\r\n      \"transient\": {\r\n        \"cluster.persistent_tasks.allocation.enable\": \"none\"\r\n      }\r\n    }\r\n    ```\r\n\r\n1. Create an ML job.\r\n1. Observe UI errors.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\n[2020-02-05T15:12:58.168Z][WARN][org.elasticsearch.xpack.ml.action.TransportOpenJobAction] [instance-0000000310] [test] Could not open job because no suitable nodes were found, allocation explanation [persistent task [xpack/ml/job] cannot be assigned [no persistent task assignments are allowed due to cluster settings]]\r\n```","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}