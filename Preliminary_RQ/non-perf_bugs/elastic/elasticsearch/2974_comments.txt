[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48466691","html_url":"https://github.com/elastic/elasticsearch/issues/2974#issuecomment-48466691","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2974","id":48466691,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDY2Njkx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-09T13:05:04Z","updated_at":"2014-07-09T13:05:04Z","author_association":"CONTRIBUTOR","body":"Similar to #6133 and #5887.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54116622","html_url":"https://github.com/elastic/elasticsearch/issues/2974#issuecomment-54116622","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2974","id":54116622,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTE2NjIy","user":{"login":"cfontes","id":507924,"node_id":"MDQ6VXNlcjUwNzkyNA==","avatar_url":"https://avatars2.githubusercontent.com/u/507924?v=4","gravatar_id":"","url":"https://api.github.com/users/cfontes","html_url":"https://github.com/cfontes","followers_url":"https://api.github.com/users/cfontes/followers","following_url":"https://api.github.com/users/cfontes/following{/other_user}","gists_url":"https://api.github.com/users/cfontes/gists{/gist_id}","starred_url":"https://api.github.com/users/cfontes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfontes/subscriptions","organizations_url":"https://api.github.com/users/cfontes/orgs","repos_url":"https://api.github.com/users/cfontes/repos","events_url":"https://api.github.com/users/cfontes/events{/privacy}","received_events_url":"https://api.github.com/users/cfontes/received_events","type":"User","site_admin":false},"created_at":"2014-09-02T07:13:30Z","updated_at":"2014-09-02T07:40:12Z","author_association":"CONTRIBUTOR","body":"From the very basic knowledge I have about this, it looks like this kind of validation is spread among several classes for each type of call (Mappings rest API, CRUD API, etc...)\n\nSo it will probably need to be fixed on several places. Just like #6133 fixed only one instance of this.\n\nOr we could create/update a possible abstraction on the main REST API entry point validating empty arrays and rejecting them before they get any further into the logic. (too much overhead???)\n\nPlease correct me, as I am probably completely wrong about it.\n\nShould this be worked as a single case or should I wait for a definition for a broader fix for this empty array problem?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54713903","html_url":"https://github.com/elastic/elasticsearch/issues/2974#issuecomment-54713903","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2974","id":54713903,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzEzOTAz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-09-06T14:34:19Z","updated_at":"2014-09-06T14:34:19Z","author_association":"CONTRIBUTOR","body":"@jpountz what do you think about ^^ ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59483195","html_url":"https://github.com/elastic/elasticsearch/issues/2974#issuecomment-59483195","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2974","id":59483195,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDgzMTk1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T08:33:51Z","updated_at":"2014-10-17T08:33:51Z","author_association":"CONTRIBUTOR","body":"@polyfractal Do you have any idea whether PHP can distinguish between an empty associative array and an empty normal array? Apparently empty associative arrays are rendered in JSON as [] instead of as {}, which is causing these errors all over the place.\n\nOne other possibility would be to just delete all empty arrays...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/60104213","html_url":"https://github.com/elastic/elasticsearch/issues/2974#issuecomment-60104213","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2974","id":60104213,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMTA0MjEz","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2014-10-22T15:33:13Z","updated_at":"2014-10-22T15:33:13Z","author_association":"MEMBER","body":"@clintongormley @lphuberdeau Yeah, this a known (and irritating) problem with PHP.  The ES-PHP client has workarounds documented here:  \n\nhttp://www.elasticsearch.org/guide/en/elasticsearch/client/php-api/current/_dealing_with_json_arrays_and_objects_in_php.html\n\nThe default behavior of `json_encode()` will convert empty arrays into json arrays, while arrays holding other values will become an object.\n\nThis behavior can be changed with the `JSON_FORCE_OBJECT` flag:  `json_encode($myArray, JSON_FORCE_OBJECT)`, which will always convert empty arrays into objects.  However, this will break other parts of the ES DSL since empty arrays are sometimes desired.\n\nThe best solution is to explicitly mark empty objects with a native PHP object:\n\n``` php\n$myArray = array(\n    'query' => array(\n        'match' => array(\n            'content' => 'quick brown fox'\n        )\n    ),\n    'highlight' => array(\n        'fields' => array(\n            'content' => new \\stdClass()  // empty stdClass will convert into empty {}\n        )\n    )\n);\n\n$request = json_encode($myArray);\n```\n\nWhich is equivalent to:\n\n``` json\n{\n    \"query\" : {\n        \"match\" : {\n            \"content\" : \"quick brown fox\"\n        }\n    },\n    \"highlight\" : {\n        \"fields\" : {\n            \"content\" : {} \n        }\n    }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/60112886","html_url":"https://github.com/elastic/elasticsearch/issues/2974#issuecomment-60112886","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2974","id":60112886,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMTEyODg2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-22T16:25:24Z","updated_at":"2014-10-22T16:25:24Z","author_association":"CONTRIBUTOR","body":"@polyfractal thanks for the clarification.  Given that this can be handled client side, rather than having to add ambiguous checks all over the Elasticsearch parsing code, I'm going to close this issue.\n","performed_via_github_app":null}]