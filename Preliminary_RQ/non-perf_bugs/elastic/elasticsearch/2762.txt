{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2762","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2762/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2762/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2762/events","html_url":"https://github.com/elastic/elasticsearch/issues/2762","id":11918629,"node_id":"MDU6SXNzdWUxMTkxODYyOQ==","number":2762,"title":"Alias filters cached/type inferenced incorrectly","user":{"login":"dbertram","id":864848,"node_id":"MDQ6VXNlcjg2NDg0OA==","avatar_url":"https://avatars3.githubusercontent.com/u/864848?v=4","gravatar_id":"","url":"https://api.github.com/users/dbertram","html_url":"https://github.com/dbertram","followers_url":"https://api.github.com/users/dbertram/followers","following_url":"https://api.github.com/users/dbertram/following{/other_user}","gists_url":"https://api.github.com/users/dbertram/gists{/gist_id}","starred_url":"https://api.github.com/users/dbertram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbertram/subscriptions","organizations_url":"https://api.github.com/users/dbertram/orgs","repos_url":"https://api.github.com/users/dbertram/repos","events_url":"https://api.github.com/users/dbertram/events{/privacy}","received_events_url":"https://api.github.com/users/dbertram/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2013-03-12T10:47:37Z","updated_at":"2014-08-08T10:37:18Z","closed_at":"2014-08-08T10:37:18Z","author_association":"NONE","active_lock_reason":null,"body":"A while ago we started playing with alias filters, but initially ran into a confusing bug.\n\nOur environment creates our index along with its type mappings and aliases all at once, then proceeds to index documents into it.\n\nThe problem lies with using a numeric filter in an alias on a field that does not have an explicit type via its mapping. After indexing documents that match the alias' filter, no results are returned. This appears to be due to the alias being cached.\n\nThe following is a minimal reproduction of the issue:\n\n```\ncurl -XPUT 'http://localhost:9200/testindex/'\n\necho create alias that filters by numericField:1\ncurl -XPOST 'http://localhost:9200/_aliases' -d '{\n  \"actions\": [\n    {\n      \"add\": {\n        \"index\": \"testindex\",\n        \"alias\": \"testalias\",\n        \"filter\": { \"term\": { \"numericField\": 1 } }\n      }\n    }\n  ]\n}'\n\necho index a case that should match our filter\ncurl -XPUT 'http://localhost:9200/testindex/testtype/1' -d '{\n  \"name\": \"bob\",\n  \"numericField\": 1,\n  \"message\": \"testing numeric alias filters\"\n}'\n\necho confirm we can find the document via term filter\ncurl -XPOST 'http://localhost:9200/testindex/_search' -d '{\n  \"filter\": {\n    \"term\": { \"numericField\": 1 }\n  }\n}'\n\necho document not matched when filtering via the alias\ncurl -XPOST 'http://localhost:9200/testalias/_search' -d '{\n  \"query\": {\n    \"match_all\": {}\n  }\n}'\n```\n\nInspecting the alias via the _aliases endpoint doesn't reveal any information that would explain the lack of matching documents.\n\nIf you explicitly type the filtered field in the mapping before creating the alias, the alias filter works as expected.\n\n```\ncurl -XPOST 'http://localhost:9200/testindex/' -d '{\n  \"mappings\": {\n    \"testtype\": {\n      \"properties\": {\n        \"numericField\": { \"type\": \"long\" }\n      }\n    }\n  }\n}'\n```\n\nGiven that this was relatively tricky to figure out (nothing is mentioned about type inferencing in relation to alias filters in the docs), this struck us as being a bug in how alias filters are being stored/cached.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}