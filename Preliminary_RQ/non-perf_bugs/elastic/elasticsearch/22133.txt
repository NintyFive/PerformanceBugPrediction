{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22133","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22133/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22133/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22133/events","html_url":"https://github.com/elastic/elasticsearch/issues/22133","id":195190652,"node_id":"MDU6SXNzdWUxOTUxOTA2NTI=","number":22133,"title":"[code issue][discuss]should method innerJoinCluster of ZenDiscovery class loop certain times and quit rather than loop forever when join master fail?","user":{"login":"makeyang","id":13898618,"node_id":"MDQ6VXNlcjEzODk4NjE4","avatar_url":"https://avatars2.githubusercontent.com/u/13898618?v=4","gravatar_id":"","url":"https://api.github.com/users/makeyang","html_url":"https://github.com/makeyang","followers_url":"https://api.github.com/users/makeyang/followers","following_url":"https://api.github.com/users/makeyang/following{/other_user}","gists_url":"https://api.github.com/users/makeyang/gists{/gist_id}","starred_url":"https://api.github.com/users/makeyang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/makeyang/subscriptions","organizations_url":"https://api.github.com/users/makeyang/orgs","repos_url":"https://api.github.com/users/makeyang/repos","events_url":"https://api.github.com/users/makeyang/events{/privacy}","received_events_url":"https://api.github.com/users/makeyang/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-12-13T08:31:25Z","updated_at":"2016-12-21T02:37:23Z","closed_at":"2016-12-13T11:18:24Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"below is a abstract logic of innerJoinCluster:\r\n{\r\n    final boolean success = joinElectedMaster(masterNode);\r\n    clusterService.submitStateUpdateTask(\"finalize_join (\" + masterNode + \")\", new ClusterStateUpdateTask(){\r\n        public ClusterState execute(ClusterState currentState) throws Exception {\r\n                    if (!success) {\r\n                        // failed to join. Try again...\r\n                        joinThreadControl.markThreadAsDoneAndStartNew(currentThread);\r\n                        return currentState;\r\n                    }\r\n        }\r\n    }\r\n}\r\n//I ask a node whose id is same with current master to join the cluster and then, this node goes into this dead loop and can't quit. In my opinion, we should deal with this error and ask the node quit.","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}