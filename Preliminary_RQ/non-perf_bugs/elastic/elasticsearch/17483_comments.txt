[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/205303554","html_url":"https://github.com/elastic/elasticsearch/issues/17483#issuecomment-205303554","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17483","id":205303554,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNTMwMzU1NA==","user":{"login":"pciccarese","id":10923279,"node_id":"MDQ6VXNlcjEwOTIzMjc5","avatar_url":"https://avatars0.githubusercontent.com/u/10923279?v=4","gravatar_id":"","url":"https://api.github.com/users/pciccarese","html_url":"https://github.com/pciccarese","followers_url":"https://api.github.com/users/pciccarese/followers","following_url":"https://api.github.com/users/pciccarese/following{/other_user}","gists_url":"https://api.github.com/users/pciccarese/gists{/gist_id}","starred_url":"https://api.github.com/users/pciccarese/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pciccarese/subscriptions","organizations_url":"https://api.github.com/users/pciccarese/orgs","repos_url":"https://api.github.com/users/pciccarese/repos","events_url":"https://api.github.com/users/pciccarese/events{/privacy}","received_events_url":"https://api.github.com/users/pciccarese/received_events","type":"User","site_admin":false},"created_at":"2016-04-04T13:51:32Z","updated_at":"2016-04-04T14:12:45Z","author_association":"NONE","body":"I am afraid I will need to reopen this.\n\n**Elasticsearch version**: 2.3.0\n**JVM version**: 1.8.0_31\n**OS version**: MAC OS X 10.10.5\n\n**Use of custom header does not seem to work reliably.**\n\nHere is the CORS section of my configuration (elasticsearch.yml) file:\n\n```\nhttp.cors.enabled: true\nhttp.cors.allow-origin: \"*\"\nhttp.cors.allow-headers: \"X-Requested-With, Content-Type, Content-Length, X-User\"\n```\n\nThe client code is performing the following call:\n\n```\njQuery.ajax({\n    url: requrl,\n    data: reqdata,\n    type: 'POST',\n    headers: {\"X-User\": user},\n    success: function (result, status, xhr) {\n        resolve(result);\n    },\n    error: function (xhr, status, error) {\n        reject(error);\n    }\n});\n\n```\n\nNow, that request always goes through with Firefox 45.0.1.\nHowever, it does not work for:\n- Safari Version 9.1 (10601.5.17.4)\n- Chrome Version 49.0.2623.110 (64-bit) \n\nWhen inspecting with Chrome I get:\n\n```\nXMLHttpRequest cannot load http://localhost:9200/myindex/mytype/_search. \nRequest header field x-user is not allowed by Access-Control-Allow-Headers in preflight response.\n```\n\nThese are the headers details I see in Chrome:\n\n```\nGeneral\n-----------\nRequest URL:http://localhost:9200/myindex/mytype/_search\nRequest Method:OPTIONS\nStatus Code:200 OK\nRemote Address:[::1]:9200\n\nResponse Headers\n--------------------------\nAccess-Control-Allow-Methods:\nAccess-Control-Allow-Origin:*\nAccess-Control-Max-Age:1728000\ncontent-length:0\ndate:Mon, 04 Apr 2016 13:49:00 GMT\n\nRequest Headers\n-----------------------\nAccept:*/*\nAccept-Encoding:gzip, deflate, sdch\nAccept-Language:en-US,en;q=0.8,it;q=0.6\nAccess-Control-Request-Headers:accept, content-type, x-user\nAccess-Control-Request-Method:POST\nCache-Control:no-cache\nConnection:keep-alive\nHost:localhost:9200\nOrigin:http://localhost:3333\nPragma:no-cache\nReferer:http://localhost:3333/\nUser-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.110 Safari/537.36\n```\n\n**The very same configuration, index and client code works reliably in 2.2.0**.\nAfter seeing in the release notes the entry: “More robust handling of CORS HTTP Access Control” I am wondering if that has anything to do with it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/205409727","html_url":"https://github.com/elastic/elasticsearch/issues/17483#issuecomment-205409727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17483","id":205409727,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNTQwOTcyNw==","user":{"login":"skundrik","id":14072681,"node_id":"MDQ6VXNlcjE0MDcyNjgx","avatar_url":"https://avatars2.githubusercontent.com/u/14072681?v=4","gravatar_id":"","url":"https://api.github.com/users/skundrik","html_url":"https://github.com/skundrik","followers_url":"https://api.github.com/users/skundrik/followers","following_url":"https://api.github.com/users/skundrik/following{/other_user}","gists_url":"https://api.github.com/users/skundrik/gists{/gist_id}","starred_url":"https://api.github.com/users/skundrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skundrik/subscriptions","organizations_url":"https://api.github.com/users/skundrik/orgs","repos_url":"https://api.github.com/users/skundrik/repos","events_url":"https://api.github.com/users/skundrik/events{/privacy}","received_events_url":"https://api.github.com/users/skundrik/received_events","type":"User","site_admin":false},"created_at":"2016-04-04T17:40:17Z","updated_at":"2016-04-04T17:40:17Z","author_association":"NONE","body":"I have experienced same issue which now breaks Grafana UI.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/205449403","html_url":"https://github.com/elastic/elasticsearch/issues/17483#issuecomment-205449403","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17483","id":205449403,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNTQ0OTQwMw==","user":{"login":"skundrik","id":14072681,"node_id":"MDQ6VXNlcjE0MDcyNjgx","avatar_url":"https://avatars2.githubusercontent.com/u/14072681?v=4","gravatar_id":"","url":"https://api.github.com/users/skundrik","html_url":"https://github.com/skundrik","followers_url":"https://api.github.com/users/skundrik/followers","following_url":"https://api.github.com/users/skundrik/following{/other_user}","gists_url":"https://api.github.com/users/skundrik/gists{/gist_id}","starred_url":"https://api.github.com/users/skundrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skundrik/subscriptions","organizations_url":"https://api.github.com/users/skundrik/orgs","repos_url":"https://api.github.com/users/skundrik/repos","events_url":"https://api.github.com/users/skundrik/events{/privacy}","received_events_url":"https://api.github.com/users/skundrik/received_events","type":"User","site_admin":false},"created_at":"2016-04-04T19:02:28Z","updated_at":"2016-04-04T19:22:42Z","author_association":"NONE","body":"- The problem appears to be in `NettyHttpServerTransport.buildCorsConfig()` where first parameter to the `getAsArray()` function should be the setting name and not the value of the setting. \n- It affects `cors-allow-headers` as well.\n- It's also specific to `2.3 branch` as the whole settings system seems to have been reworked on `master`.\n\nThe following code\n\n``` java\n        String[] strMethods = settings.getAsArray(settings.get(SETTING_CORS_ALLOW_METHODS, DEFAULT_CORS_METHODS), new String[0]);\n        HttpMethod[] methods = new HttpMethod[strMethods.length];\n        for (int i = 0; i < methods.length; i++) {\n            methods[i] = HttpMethod.valueOf(strMethods[i]);\n        }\n        return builder.allowedRequestMethods(methods)\n                      .maxAge(settings.getAsInt(SETTING_CORS_MAX_AGE, DEFAULT_CORS_MAX_AGE))\n                      .allowedRequestHeaders(settings.getAsArray(settings.get(SETTING_CORS_ALLOW_HEADERS, DEFAULT_CORS_HEADERS), new String[0]))\n                      .shortCircuit()\n                      .build();\n```\n\nshould say\n\n``` java\n        String[] strMethods = settings.getAsArray(SETTING_CORS_ALLOW_METHODS, DEFAULT_CORS_METHODS);\n        HttpMethod[] methods = new HttpMethod[strMethods.length];\n        for (int i = 0; i < methods.length; i++) {\n            methods[i] = HttpMethod.valueOf(strMethods[i]);\n        }\n        return builder.allowedRequestMethods(methods)\n                      .maxAge(settings.getAsInt(SETTING_CORS_MAX_AGE, DEFAULT_CORS_MAX_AGE))\n                      .allowedRequestHeaders(settings.getAsArray(SETTING_CORS_ALLOW_HEADERS, DEFAULT_CORS_HEADERS))\n                      .shortCircuit()\n                      .build();\n\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/205806698","html_url":"https://github.com/elastic/elasticsearch/issues/17483#issuecomment-205806698","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17483","id":205806698,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNTgwNjY5OA==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-04-05T13:32:37Z","updated_at":"2016-04-05T13:32:37Z","author_association":"CONTRIBUTOR","body":"Thank you for reporting the issue.  We have PRs open to fix them for different versions.\n\n#17523 #17524 #17525 \n","performed_via_github_app":null}]