[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412903390","html_url":"https://github.com/elastic/elasticsearch/issues/32848#issuecomment-412903390","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32848","id":412903390,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjkwMzM5MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T15:01:49Z","updated_at":"2018-08-14T15:01:49Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413491760","html_url":"https://github.com/elastic/elasticsearch/issues/32848#issuecomment-413491760","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32848","id":413491760,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzQ5MTc2MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-08-16T10:00:22Z","updated_at":"2018-08-16T10:00:22Z","author_association":"MEMBER","body":"@jinhucheung I am not able to reproduce, can you add the analyzer definitions for `jcseg` and `jcseg_complex` ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413557487","html_url":"https://github.com/elastic/elasticsearch/issues/32848#issuecomment-413557487","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32848","id":413557487,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzU1NzQ4Nw==","user":{"login":"jinhucheung","id":19590194,"node_id":"MDQ6VXNlcjE5NTkwMTk0","avatar_url":"https://avatars1.githubusercontent.com/u/19590194?v=4","gravatar_id":"","url":"https://api.github.com/users/jinhucheung","html_url":"https://github.com/jinhucheung","followers_url":"https://api.github.com/users/jinhucheung/followers","following_url":"https://api.github.com/users/jinhucheung/following{/other_user}","gists_url":"https://api.github.com/users/jinhucheung/gists{/gist_id}","starred_url":"https://api.github.com/users/jinhucheung/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinhucheung/subscriptions","organizations_url":"https://api.github.com/users/jinhucheung/orgs","repos_url":"https://api.github.com/users/jinhucheung/repos","events_url":"https://api.github.com/users/jinhucheung/events{/privacy}","received_events_url":"https://api.github.com/users/jinhucheung/received_events","type":"User","site_admin":false},"created_at":"2018-08-16T14:06:10Z","updated_at":"2018-08-16T14:13:08Z","author_association":"NONE","body":"@jimczi  thanks, I highlighted the code_pieces fields cause this error. \r\n\r\ncode_pieces is array type, the following is an simple response of a query without highlight code_pieces\r\n\r\n```json\r\n{\r\n  \"took\" : 1,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 1,\r\n    \"successful\" : 1,\r\n    \"skipped\" : 0,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 46,\r\n    \"max_score\" : 921.8962,\r\n    \"hits\" : [\r\n      {\r\n        \"_index\" : \"code_index_production\",\r\n        \"_type\" : \"code\",\r\n        \"_id\" : \"45899\",\r\n        \"_score\" : 921.8962,\r\n        \"_source\" : {\r\n          \"id\" : 1,\r\n          \"public\" : 1,\r\n          \"user_id\" : 1,\r\n          \"lang_id\" : 2,\r\n          \"root_id\" : 0,\r\n          \"category_id\" : 3,\r\n          \"enterprise_id\" : 0,\r\n          \"stars_count\" : 0,\r\n          \"forks_count\" : 0,\r\n          \"notes_count\" : 0,\r\n          \"pieces_count\" : 1,\r\n          \"in_square\" : true,\r\n          \"lang_name\" : \"PHP\",\r\n          \"summary\" : \"layui分页\",\r\n          \"name_with_summary\" : \"jimcheung / layui分页\",\r\n          \"created_at\" : \"2017-11-25T13:53:45+08:00\",\r\n          \"updated_at\" : \"2017-11-25T13:53:45+08:00\",\r\n          \"code_pieces\" : [\r\n            {\r\n              \"id\" : 59766,\r\n              \"content_type\" : 0,\r\n              \"content\" : \"var title = $(\\\"input[name='title']\\\").val();\\r\\n\\tvar begin_time =$(\\\"input[name='begin_time']\\\").val();\\r\\n\\tvar end_time=$(\\\"input[name='end_time']\\\").val();\\r\\n    layui.use(['laypage', 'layer'], function(){\\r\\n        var laypage = layui.laypage\\r\\n            ,layer = layui.layer;\\r\\n        layui.use(['laypage', 'layer'], function() {\\r\\n            var laypage = layui.laypage\\r\\n                ,layer = layui.layer;\\r\\n            laypage.render({\\r\\n                elem: 'demo1',\\r\\n                count: {$count},\\r\\n                limit:15,\\r\\n                curr:{$curr},\\r\\n                jump: function(e, first){ //触发分页后的回调\\r\\n                    if(!first){ //一定要加此判断，否则初始时会无限刷新\\r\\n                        location.href = '?page='+e.curr+\\\"&title=\\\"+title+\\\"&begin_time=\\\"+begin_time+\\\"&end_time=\\\"+end_time;\\r\\n                    }\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n\\r\\n    });\",\r\n              \"title\" : \"分页\"\r\n            }\r\n          ]\r\n        },\r\n        \"highlight\" : {\r\n          \"name_with_summary\" : [\r\n            \"jimcheung / <em>layui</em>分页\"\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nhere is the jcseg analyzer and its elasticsearch plugin\r\n\r\n[jcseg analyzer](https://github.com/lionsoul2014/jcseg)\r\n\r\n[elasticsearch-jcseg-6.3.1.zip](https://github.com/elastic/elasticsearch/files/2293952/elasticsearch-jcseg-6.3.1.zip)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414604333","html_url":"https://github.com/elastic/elasticsearch/issues/32848#issuecomment-414604333","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32848","id":414604333,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDYwNDMzMw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-08-21T09:03:15Z","updated_at":"2018-08-21T09:03:15Z","author_association":"MEMBER","body":"@jinhucheung I am not able to reproduce with the example document. Could you please provide the document that is causing the exception ? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414667385","html_url":"https://github.com/elastic/elasticsearch/issues/32848#issuecomment-414667385","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32848","id":414667385,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDY2NzM4NQ==","user":{"login":"jinhucheung","id":19590194,"node_id":"MDQ6VXNlcjE5NTkwMTk0","avatar_url":"https://avatars1.githubusercontent.com/u/19590194?v=4","gravatar_id":"","url":"https://api.github.com/users/jinhucheung","html_url":"https://github.com/jinhucheung","followers_url":"https://api.github.com/users/jinhucheung/followers","following_url":"https://api.github.com/users/jinhucheung/following{/other_user}","gists_url":"https://api.github.com/users/jinhucheung/gists{/gist_id}","starred_url":"https://api.github.com/users/jinhucheung/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinhucheung/subscriptions","organizations_url":"https://api.github.com/users/jinhucheung/orgs","repos_url":"https://api.github.com/users/jinhucheung/repos","events_url":"https://api.github.com/users/jinhucheung/events{/privacy}","received_events_url":"https://api.github.com/users/jinhucheung/received_events","type":"User","site_admin":false},"created_at":"2018-08-21T13:08:14Z","updated_at":"2018-08-21T13:08:14Z","author_association":"NONE","body":"@jimczi I am sorry for the late response\r\n\r\nThe following is a document that is causing this exception\r\n\r\n```json\r\n \"_source\" : {\r\n  \"id\" : 46867,\r\n  \"public\" : 1,\r\n  \"user_id\" : 1619994,\r\n  \"lang_id\" : 3,\r\n  \"root_id\" : 0,\r\n  \"category_id\" : 89,\r\n  \"enterprise_id\" : 0,\r\n  \"stars_count\" : 0,\r\n  \"forks_count\" : 0,\r\n  \"notes_count\" : 0,\r\n  \"pieces_count\" : 3,\r\n  \"in_square\" : true,\r\n  \"lang_name\" : \"JavaScript\",\r\n  \"summary\" : \"Layui上传多附件材料代码\",\r\n  \"name_with_summary\" : \"LKBBD / Layui上传多附件材料代码\",\r\n  \"created_at\" : \"2017-12-03T13:56:06+08:00\",\r\n  \"updated_at\" : \"2017-12-03T13:59:33+08:00\",\r\n  \"code_pieces\" : [\r\n    {\r\n      \"id\" : 62466,\r\n      \"content_type\" : 0,\r\n      \"content\" : \"基于layui,引入layui.css,layui.js及jquery.js等\\r\\n<link rel=\\\"stylesheet\\\" href=\\\"/style/layui/css/layui.css\\\" type=\\\"text/css\\\" media=\\\"all\\\"></link>\\r\\n<script type=\\\"text/javascript\\\" src=\\\"/style/layui/layui.js\\\"></script>\",\r\n      \"title\" : \"js静态资源部分(主要)\"\r\n    },\r\n    {\r\n      \"id\" : 62467,\r\n      \"content_type\" : 0,\r\n      \"content\" : \"<div class=\\\"layui-upload\\\">\\r\\n    <button type=\\\"button\\\" class=\\\"layui-btn layui-btn-normal\\\" id=\\\"testList\\\">选择多文件</button> \\r\\n    <div class=\\\"layui-upload-list\\\">\\r\\n    <table class=\\\"layui-table\\\">\\r\\n        <thead>\\r\\n        <tr>\\r\\n        <th style=\\\"width:40%;text-align:left;padding:10px 20px;\\\">文件名</th>\\r\\n        <th style=\\\"width:20%;text-align:left;padding:10px 20px;\\\">大小</th>\\r\\n        <th style=\\\"width:20%;text-align:left;padding:10px 20px;\\\">状态</th>\\r\\n        <th style=\\\"width:20%;text-align:left;padding:10px 20px;\\\">操作</th>\\r\\n        </tr>\\r\\n        </thead>\\r\\n        <tbody id=\\\"demoList\\\"></tbody>\\r\\n    </table>\\r\\n    </div>\\r\\n    <button type=\\\"button\\\" class=\\\"layui-btn\\\" id=\\\"testListAction\\\">开始上传</button>\\r\\n</div> \",\r\n      \"title\" : \"html部分\"\r\n    },\r\n    {\r\n      \"id\" : 62468,\r\n      \"content_type\" : 0,\r\n      \"content\" : \"layui.use('upload', function(){\\r\\n    var $ = layui.jquery,\\r\\n    upload = layui.upload;\\r\\n    var files = [];\\r\\n    var demoListView = $('#demoList'),\\r\\n    uploadListIns = upload.render({\\r\\n    elem: '#testList',\\r\\n    url: '/file/ftp/upload/',//FTP上传 \\r\\n    accept: 'file',\\r\\n    multiple: true,\\r\\n    auto: false,\\r\\n    size: 6000, //限制文件大小，单位 KB\\r\\n    exts: 'jpg|png|xlsx|docx|pdf',//只允许上传文件类型\\r\\n    bindAction: '#testListAction',\\r\\n    choose: function(obj){   \\r\\n        files = obj.pushFile(); //将每次选择的文件追加到文件队列\\r\\n        //读取本地文件\\r\\n        obj.preview(function(index, file, result){\\r\\n        var tr = $(['<tr id=\\\"upload-'+ index +'\\\">',\\r\\n            '<td style=\\\\\\\"width:40%;padding:10px;text-align:left;font-size:14px;\\\\\\\">'+ file.name +'</td>',\\r\\n            '<td style=\\\\\\\"width:20%;padding:10px;text-align:left;font-size:14px;\\\\\\\">'+ (file.size/1014).toFixed(1) +'kb</td>',\\r\\n            '<td style=\\\\\\\"width:20%;padding:10px;text-align:left;font-size:14px;\\\\\\\">等待上传</td>',\\r\\n            '<td style=\\\\\\\"width:20%;padding:10px;text-align:left;font-size:14px;\\\\\\\">',\\r\\n            '<button class=\\\"layui-btn layui-btn-mini demo-reload layui-hide\\\">重传</button>',\\r\\n            '<button class=\\\"layui-btn layui-btn-mini layui-btn-danger demo-delete\\\">删除</button>',\\r\\n            '</td>',\\r\\n        '</tr>'].join(''));\\r\\n        //单个重传\\r\\n        tr.find('.demo-reload').on('click', function(){\\r\\n            obj.upload(index, file);\\r\\n        });\\r\\n        //删除\\r\\n        tr.find('.demo-delete').on('click', function(){\\r\\n            delete files[index]; //删除对应的文件\\r\\n            tr.remove();\\r\\n        });\\r\\n        demoListView.append(tr);\\r\\n        });\\r\\n    },\\r\\n    done: function(res, index, upload){\\r\\n        if(res.code == 0){ //上传成功\\r\\n        var tr = demoListView.find('tr#upload-'+ index),\\r\\n        tds = tr.children();\\r\\n        tds.eq(2).html('<span style=\\\"color: #5FB878;\\\">上传成功</span>');\\r\\n        tds.eq(3).html(''); //清空操作\\r\\n        var file_ids = $(\\\"input[name='dwyyzzsmj']\\\").val();\\r\\n        file_ids = file_ids + \\\"//\\\" + res.fileid;\\r\\n        $(\\\"input[name='dwyyzzsmj']\\\").val(\\\"\\\");\\r\\n        $(\\\"input[name='dwyyzzsmj']\\\").val(file_ids);\\r\\n        delete files[index]; //删除文件队列已经上传成功的文件\\r\\n        return;\\r\\n        }\\r\\n        this.error(index, upload);\\r\\n    },\\r\\n    error: function(index, upload){\\r\\n        var tr = demoListView.find('tr#upload-'+ index),\\r\\n        tds = tr.children();\\r\\n        tds.eq(2).html('<span style=\\\"color: #FF5722;\\\">上传失败</span>');\\r\\n        tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传\\r\\n    }\\r\\n  });\\r\\n});\",\r\n      \"title\" : \"js实现部分\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nhere is a [raw_code_pieces.zip](https://github.com/elastic/elasticsearch/files/2306293/raw_code_pieces.zip)\r\n\r\nI highlight the code_pieces content cause the exception.\r\n\r\nWhen I changed `jcseg` into another analyzer such as `standard`,  or changed `offsets-strategy` into  `plain-highlighter`,  it is work.\r\n\r\nI think that the exception is caused by `jcseg`\r\n\r\nthanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416243539","html_url":"https://github.com/elastic/elasticsearch/issues/32848#issuecomment-416243539","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32848","id":416243539,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjI0MzUzOQ==","user":{"login":"jinhucheung","id":19590194,"node_id":"MDQ6VXNlcjE5NTkwMTk0","avatar_url":"https://avatars1.githubusercontent.com/u/19590194?v=4","gravatar_id":"","url":"https://api.github.com/users/jinhucheung","html_url":"https://github.com/jinhucheung","followers_url":"https://api.github.com/users/jinhucheung/followers","following_url":"https://api.github.com/users/jinhucheung/following{/other_user}","gists_url":"https://api.github.com/users/jinhucheung/gists{/gist_id}","starred_url":"https://api.github.com/users/jinhucheung/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinhucheung/subscriptions","organizations_url":"https://api.github.com/users/jinhucheung/orgs","repos_url":"https://api.github.com/users/jinhucheung/repos","events_url":"https://api.github.com/users/jinhucheung/events{/privacy}","received_events_url":"https://api.github.com/users/jinhucheung/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T14:22:49Z","updated_at":"2018-08-27T14:22:49Z","author_association":"NONE","body":"@jimczi thanks,  I close this issue","performed_via_github_app":null}]