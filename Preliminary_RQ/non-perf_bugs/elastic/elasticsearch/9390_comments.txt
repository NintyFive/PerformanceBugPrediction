[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71135966","html_url":"https://github.com/elastic/elasticsearch/issues/9390#issuecomment-71135966","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390","id":71135966,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMTM1OTY2","user":{"login":"Jens-G","id":5834733,"node_id":"MDQ6VXNlcjU4MzQ3MzM=","avatar_url":"https://avatars2.githubusercontent.com/u/5834733?v=4","gravatar_id":"","url":"https://api.github.com/users/Jens-G","html_url":"https://github.com/Jens-G","followers_url":"https://api.github.com/users/Jens-G/followers","following_url":"https://api.github.com/users/Jens-G/following{/other_user}","gists_url":"https://api.github.com/users/Jens-G/gists{/gist_id}","starred_url":"https://api.github.com/users/Jens-G/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jens-G/subscriptions","organizations_url":"https://api.github.com/users/Jens-G/orgs","repos_url":"https://api.github.com/users/Jens-G/repos","events_url":"https://api.github.com/users/Jens-G/events{/privacy}","received_events_url":"https://api.github.com/users/Jens-G/received_events","type":"User","site_admin":false},"created_at":"2015-01-23T02:01:01Z","updated_at":"2015-01-23T02:01:01Z","author_association":"NONE","body":"Another remark: The \"hang\" does not refer to a specific call I made, Rather I see only a few entries being processed: I get something around 70 (!) newly added entries processed so I can query them. I had expected at least something around 1000, if that's the max queue size. But even after waiting > 20 minutes, which is very long for these small data pieces, I still have only the 70 entries. The full input would be something around 5300 messages.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71327056","html_url":"https://github.com/elastic/elasticsearch/issues/9390#issuecomment-71327056","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390","id":71327056,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMzI3MDU2","user":{"login":"Jens-G","id":5834733,"node_id":"MDQ6VXNlcjU4MzQ3MzM=","avatar_url":"https://avatars2.githubusercontent.com/u/5834733?v=4","gravatar_id":"","url":"https://api.github.com/users/Jens-G","html_url":"https://github.com/Jens-G","followers_url":"https://api.github.com/users/Jens-G/followers","following_url":"https://api.github.com/users/Jens-G/following{/other_user}","gists_url":"https://api.github.com/users/Jens-G/gists{/gist_id}","starred_url":"https://api.github.com/users/Jens-G/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jens-G/subscriptions","organizations_url":"https://api.github.com/users/Jens-G/orgs","repos_url":"https://api.github.com/users/Jens-G/repos","events_url":"https://api.github.com/users/Jens-G/events{/privacy}","received_events_url":"https://api.github.com/users/Jens-G/received_events","type":"User","site_admin":false},"created_at":"2015-01-24T17:01:41Z","updated_at":"2015-01-24T17:20:41Z","author_association":"NONE","body":"I throttled the Input and it still takes forever. It looks as if ES has problems with lots of indices. The more indices I have, the slower it becomes (LogStash creates one index per day, I have around 5300 of them). The JavaVM puts a permanent load around 75% (actually the curve goes up and down between 50% and 100% in a wave pattern) on the CPU but nothing happens. Eventually I get this:\n\n```\n[2015-01-24 18:08:36,859][INFO ][cluster.metadata         ] [Skein] [logstash-1994.07.25] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n[2015-01-24 18:08:40,515][INFO ][cluster.metadata         ] [Skein] [logstash-1994.07.26] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n[2015-01-24 18:08:44,750][INFO ][cluster.metadata         ] [Skein] [logstash-1994.08.17] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n[2015-01-24 18:08:50,281][DEBUG][action.admin.indices.create] [Skein] [logstash-1994.08.22] failed to create\norg.elasticsearch.cluster.metadata.ProcessClusterEventTimeoutException: failed to process cluster event (acquire index lock) within 1m\n        at org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$1.run(MetaDataCreateIndexService.java:148)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n        at java.lang.Thread.run(Unknown Source)\n[2015-01-24 18:08:50,766][INFO ][cluster.metadata         ] [Skein] [logstash-1994.07.05] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n[2015-01-24 18:08:50,281][DEBUG][action.admin.indices.create] [Skein] [logstash-1994.08.23] failed to create\norg.elasticsearch.cluster.metadata.ProcessClusterEventTimeoutException: failed to process cluster event (acquire index lock) within 1m\n        at org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$1.run(MetaDataCreateIndexService.java:148)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n        at java.lang.Thread.run(Unknown Source)\n[2015-01-24 18:08:50,281][DEBUG][action.admin.indices.create] [Skein] [logstash-1994.08.24] failed to create\norg.elasticsearch.cluster.metadata.ProcessClusterEventTimeoutException: failed to process cluster event (acquire index lock) within 1m\n        at org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$1.run(MetaDataCreateIndexService.java:148)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n        at java.lang.Thread.run(Unknown Source)\n[2015-01-24 18:08:58,375][INFO ][cluster.metadata         ] [Skein] [logstash-1994.07.27] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n[2015-01-24 18:09:04,875][INFO ][cluster.metadata         ] [Skein] [logstash-1994.08.16] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n[2015-01-24 18:09:08,844][DEBUG][action.admin.indices.create] [Skein] [logstash-1994.08.25] failed to create\norg.elasticsearch.cluster.metadata.ProcessClusterEventTimeoutException: failed to process cluster event (acquire index lock) within 1m\n        at org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$1.run(MetaDataCreateIndexService.java:148)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n        at java.lang.Thread.run(Unknown Source)\n[2015-01-24 18:09:13,766][INFO ][cluster.metadata         ] [Skein] [logstash-1994.07.06] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n[2015-01-24 18:09:14,687][INFO ][cluster.metadata         ] [Skein] [logstash-1994.07.28] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n[2015-01-24 18:09:18,953][INFO ][cluster.metadata         ] [Skein] [logstash-1994.08.19] creating index, cause [auto(bulk api)], shards [5]/[1], mappings [_default_]\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71341627","html_url":"https://github.com/elastic/elasticsearch/issues/9390#issuecomment-71341627","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390","id":71341627,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMzQxNjI3","user":{"login":"Jens-G","id":5834733,"node_id":"MDQ6VXNlcjU4MzQ3MzM=","avatar_url":"https://avatars2.githubusercontent.com/u/5834733?v=4","gravatar_id":"","url":"https://api.github.com/users/Jens-G","html_url":"https://github.com/Jens-G","followers_url":"https://api.github.com/users/Jens-G/followers","following_url":"https://api.github.com/users/Jens-G/following{/other_user}","gists_url":"https://api.github.com/users/Jens-G/gists{/gist_id}","starred_url":"https://api.github.com/users/Jens-G/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jens-G/subscriptions","organizations_url":"https://api.github.com/users/Jens-G/orgs","repos_url":"https://api.github.com/users/Jens-G/repos","events_url":"https://api.github.com/users/Jens-G/events{/privacy}","received_events_url":"https://api.github.com/users/Jens-G/received_events","type":"User","site_admin":false},"created_at":"2015-01-24T22:52:18Z","updated_at":"2015-01-24T22:52:18Z","author_association":"NONE","body":"I modified the data that go into ES to minimize index creation and it works like a charm, performant and all. So the question raises, whether this could that be related to memory or other per-index resources somehow? I'm on a Windows platform.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71521953","html_url":"https://github.com/elastic/elasticsearch/issues/9390#issuecomment-71521953","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390","id":71521953,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTIxOTUz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-26T19:31:29Z","updated_at":"2015-01-26T19:31:29Z","author_association":"CONTRIBUTOR","body":"Hi @Jens-G \n\nIt sounds like you are overloading a poorly configured Elasticsearch instance.  You say you're pretty much using factory defaults.  Quite possibly you haven't configured ES_HEAP_SIZE? Or mlockall (although with windows you'll probably need to disable the page file instead)? If not, then it is quite likely you're seeing slow garbage collections. Perhaps the file handle limit need attention too?\n\nIt also sounds like you're not checking the responses from bulk requests, or waiting for them to complete. You're just piling as much as you can into the node as fast as possible?\n\nYou say you have 5,300 indices, presumably with 5 shards each, so 25k shards (or is there more than one node, so you have replicas assigned giving you 50k shards), all on a box with poor resources.  To help explain why this is a bad idea, read this: http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/finite-scale.html#finite-scale\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71547041","html_url":"https://github.com/elastic/elasticsearch/issues/9390#issuecomment-71547041","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390","id":71547041,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTQ3MDQx","user":{"login":"Jens-G","id":5834733,"node_id":"MDQ6VXNlcjU4MzQ3MzM=","avatar_url":"https://avatars2.githubusercontent.com/u/5834733?v=4","gravatar_id":"","url":"https://api.github.com/users/Jens-G","html_url":"https://github.com/Jens-G","followers_url":"https://api.github.com/users/Jens-G/followers","following_url":"https://api.github.com/users/Jens-G/following{/other_user}","gists_url":"https://api.github.com/users/Jens-G/gists{/gist_id}","starred_url":"https://api.github.com/users/Jens-G/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jens-G/subscriptions","organizations_url":"https://api.github.com/users/Jens-G/orgs","repos_url":"https://api.github.com/users/Jens-G/repos","events_url":"https://api.github.com/users/Jens-G/events{/privacy}","received_events_url":"https://api.github.com/users/Jens-G/received_events","type":"User","site_admin":false},"created_at":"2015-01-26T21:57:40Z","updated_at":"2015-01-26T21:57:40Z","author_association":"NONE","body":"Thanks for the feedback and (especially) the link, I think you're right. I almost guessed it. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71611568","html_url":"https://github.com/elastic/elasticsearch/issues/9390#issuecomment-71611568","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390","id":71611568,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjExNTY4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T08:57:46Z","updated_at":"2015-01-27T08:57:46Z","author_association":"CONTRIBUTOR","body":"great - closing this then\n","performed_via_github_app":null}]