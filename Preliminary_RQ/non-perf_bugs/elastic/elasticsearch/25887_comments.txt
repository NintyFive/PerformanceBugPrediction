[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/317795069","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-317795069","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":317795069,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNzc5NTA2OQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-07-25T16:34:30Z","updated_at":"2017-07-25T16:34:30Z","author_association":"CONTRIBUTOR","body":"I think this is worth having a look at. A soft limit will catch anyone just playing around and give back an error so they know this can be problematic.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/318657717","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-318657717","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":318657717,"node_id":"MDEyOklzc3VlQ29tbWVudDMxODY1NzcxNw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-07-28T13:53:05Z","updated_at":"2017-07-28T13:53:05Z","author_association":"MEMBER","body":"We discussed during fixit friday and we all agreed on the fact that there should be a soft limit for the difference between the `min_size` and `max_size` settings. In case of the `ngram` tokenizer / token filter the soft limit should be 0 and the `shingle` token filter's soft limit should be 3. For the `edge_ngram` tokenizer / token filter there should be no soft limit.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320671954","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-320671954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":320671954,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDY3MTk1NA==","user":{"login":"matarrese","id":1400984,"node_id":"MDQ6VXNlcjE0MDA5ODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1400984?v=4","gravatar_id":"","url":"https://api.github.com/users/matarrese","html_url":"https://github.com/matarrese","followers_url":"https://api.github.com/users/matarrese/followers","following_url":"https://api.github.com/users/matarrese/following{/other_user}","gists_url":"https://api.github.com/users/matarrese/gists{/gist_id}","starred_url":"https://api.github.com/users/matarrese/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matarrese/subscriptions","organizations_url":"https://api.github.com/users/matarrese/orgs","repos_url":"https://api.github.com/users/matarrese/repos","events_url":"https://api.github.com/users/matarrese/events{/privacy}","received_events_url":"https://api.github.com/users/matarrese/received_events","type":"User","site_admin":false},"created_at":"2017-08-07T14:01:51Z","updated_at":"2017-08-14T13:10:01Z","author_association":"CONTRIBUTOR","body":"Hello guys,\r\nI was having a look at this issue.\r\nShould be raised a new IllegalArgumentException in case the conditions are not satisfied? \r\nIs the constructor of ShingleTokenFilter a good place to do these validations?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/339482652","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-339482652","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":339482652,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTQ4MjY1Mg==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2017-10-25T21:50:55Z","updated_at":"2017-10-25T21:51:18Z","author_association":"CONTRIBUTOR","body":"I guess we will raise `IllegalArgumentException` if conditions are not satisfied .\r\nI was thinking we can do a check at the level of `org.elasticsearch.index.analysis.ShingleTokenFilterFactory` and `org.elasticsearch.index.analysis.NGramTokenizerFactory`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/339581054","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-339581054","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":339581054,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTU4MTA1NA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-10-26T07:47:12Z","updated_at":"2017-10-26T07:47:12Z","author_association":"MEMBER","body":"@mayya-sharipova If we change the settings in those classes to use `org.elasticsearch.common.settings.Setting.intSetting(String, int, int, int, Property...)` instead of `Settings.getAsInt()` then we should be able to define and validate the min and max values using the Settings infrastructure and the exception will be consistent with other similar validation errors thrown form settings.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/339589490","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-339589490","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":339589490,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTU4OTQ5MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-10-26T08:21:28Z","updated_at":"2017-10-26T08:21:28Z","author_association":"MEMBER","body":"Analyzers use a group setting (`analysis.*`)  to register their settings. We don't check the inner setting for analyzers which is why we have to use `Settings.getAs...`. We should at some point move the analyzers options to checked settings (`org.elasticsearch.common.settings.Setting`) but that would be a breaking change for plugins devs and not a low hanging fruit.\r\nFor this issue I think it's fine to check the conditions in the factories directly and throw an `IllegalArgumentException` if conditions are not met as @mayya-sharipova suggests.\r\nI'll open an issue to discuss how we could validate inner settings for analyzers but that's not a low hanging fruit ;). \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/340111674","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-340111674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":340111674,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDExMTY3NA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2017-10-27T22:24:45Z","updated_at":"2017-10-29T13:51:47Z","author_association":"CONTRIBUTOR","body":"@jimczi  @colings86  Do we want to create a new Setting for the difference between  `min_size` and `max_size`?   If yes, where do keep this setting?   \r\nIf no,  does it mean that will always throw an exception for example when Ngram `min_gram != max_gram`?  \r\n\r\nWhen we say \" soft limit should be 0\" what do we mean?  Does it mean always throwing an exception when the limit is not 0?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/340438999","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-340438999","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":340438999,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDQzODk5OQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-10-30T13:11:25Z","updated_at":"2017-10-30T13:11:25Z","author_association":"MEMBER","body":"@mayya-sharipova I think the soft-limit for the difference between `min_size` and `max_size` should be a setting that is set on the index as a whole rather than a setting on each ngram token filter individually and its value should default to `0`. We should then check this in the constructor of `NGramTokenizerFactory` and throw an `IllegalArgumentException` if the difference exceeds the settings value.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375003159","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-375003159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":375003159,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTAwMzE1OQ==","user":{"login":"nealvale","id":7896888,"node_id":"MDQ6VXNlcjc4OTY4ODg=","avatar_url":"https://avatars3.githubusercontent.com/u/7896888?v=4","gravatar_id":"","url":"https://api.github.com/users/nealvale","html_url":"https://github.com/nealvale","followers_url":"https://api.github.com/users/nealvale/followers","following_url":"https://api.github.com/users/nealvale/following{/other_user}","gists_url":"https://api.github.com/users/nealvale/gists{/gist_id}","starred_url":"https://api.github.com/users/nealvale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nealvale/subscriptions","organizations_url":"https://api.github.com/users/nealvale/orgs","repos_url":"https://api.github.com/users/nealvale/repos","events_url":"https://api.github.com/users/nealvale/events{/privacy}","received_events_url":"https://api.github.com/users/nealvale/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T16:20:46Z","updated_at":"2018-03-21T16:21:49Z","author_association":"NONE","body":"I feel that this is going to cause issues because of the following:\r\n\r\nIf I need to do a contains search over something like \"AA-PP-001-002\"  I will be restricted by it.  For instance - min ngram = 3, max ngram = 4 \r\nWould result in - AA-, A-P, .....  AA-P, A-PP, ....\r\nI would not find a string like AA-PP - or P-001  \r\nAnd I don't see any suggested alternatives.  I saw the extreme case of max = 6000. Clearly, this should be a developer discretion.  Deprecating without an alternative is not a solution IMHO. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375006340","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-375006340","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":375006340,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTAwNjM0MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T16:29:20Z","updated_at":"2018-03-21T16:30:08Z","author_association":"MEMBER","body":">  Clearly, this should be a developer discretion\r\n\r\nThe solution implemented just adds a setting to limit the allowed diff between `min_ngram` and `max_ngram` to 1 by default. You can change this setting at your discretion ;)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375006417","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-375006417","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":375006417,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTAwNjQxNw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T16:29:33Z","updated_at":"2018-03-21T16:29:33Z","author_association":"MEMBER","body":"Note that as detailed in the linked PR (#27411), these limits are backed by an index level setting that can be changed if needed, in the case of ngrams the setting is `index.max_ngram_diff` which controls what the maximum difference between max_ngram and min_ngram can be. The intention with these limits is to help cluster administrators have limits on the usage of their cluster that are sensible for the resources available to the cluster. Use cases with a wide difference between min and max ngrams are few and far between and those use cases can still modify the setting from its default.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375007412","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-375007412","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":375007412,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTAwNzQxMg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T16:32:11Z","updated_at":"2018-03-21T16:32:11Z","author_association":"MEMBER","body":"Also note the in your example a query for say `AA-PP` would, after analysis of the query, search for `AA-`, `AA-P`, `A-P`, `A-PP`, `-PP` which would all be present in a document containing a field with `AA-PP-001-002` sincee the ngram analysis would be done at both index and search time","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375068740","html_url":"https://github.com/elastic/elasticsearch/issues/25887#issuecomment-375068740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25887","id":375068740,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTA2ODc0MA==","user":{"login":"nealvale","id":7896888,"node_id":"MDQ6VXNlcjc4OTY4ODg=","avatar_url":"https://avatars3.githubusercontent.com/u/7896888?v=4","gravatar_id":"","url":"https://api.github.com/users/nealvale","html_url":"https://github.com/nealvale","followers_url":"https://api.github.com/users/nealvale/followers","following_url":"https://api.github.com/users/nealvale/following{/other_user}","gists_url":"https://api.github.com/users/nealvale/gists{/gist_id}","starred_url":"https://api.github.com/users/nealvale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nealvale/subscriptions","organizations_url":"https://api.github.com/users/nealvale/orgs","repos_url":"https://api.github.com/users/nealvale/repos","events_url":"https://api.github.com/users/nealvale/events{/privacy}","received_events_url":"https://api.github.com/users/nealvale/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T19:33:26Z","updated_at":"2018-03-21T19:33:26Z","author_association":"NONE","body":"@colings86 - Thanks for your reply.  Ok thats great I was under the impression that the deprecation message indicated that the diff would eventually disappear and we would be forced into using the max diff of 1.  As long as this is just a cautionary message I am fine.","performed_via_github_app":null}]