{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14298","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14298/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14298/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14298/events","html_url":"https://github.com/elastic/elasticsearch/issues/14298","id":113521694,"node_id":"MDU6SXNzdWUxMTM1MjE2OTQ=","number":14298,"title":"Use NFS as FsRepository for snapshot meet java.nio.file.NoSuchFileException","user":{"login":"xuanyuanking","id":4833765,"node_id":"MDQ6VXNlcjQ4MzM3NjU=","avatar_url":"https://avatars0.githubusercontent.com/u/4833765?v=4","gravatar_id":"","url":"https://api.github.com/users/xuanyuanking","html_url":"https://github.com/xuanyuanking","followers_url":"https://api.github.com/users/xuanyuanking/followers","following_url":"https://api.github.com/users/xuanyuanking/following{/other_user}","gists_url":"https://api.github.com/users/xuanyuanking/gists{/gist_id}","starred_url":"https://api.github.com/users/xuanyuanking/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xuanyuanking/subscriptions","organizations_url":"https://api.github.com/users/xuanyuanking/orgs","repos_url":"https://api.github.com/users/xuanyuanking/repos","events_url":"https://api.github.com/users/xuanyuanking/events{/privacy}","received_events_url":"https://api.github.com/users/xuanyuanking/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-10-27T07:16:24Z","updated_at":"2015-11-06T08:12:36Z","closed_at":"2015-10-27T07:33:14Z","author_association":"NONE","active_lock_reason":null,"body":"My ES version is 1.5.2.\nWhen I use NFS as FsRepo for snapshot, while different shards of same index in different host and username(or even same username but in diffrent uid\\gid), \nI got the partial error:\n\n> {\n>   \"snapshots\": [\n>      {\n>         \"snapshot\": \"test\",\n>         \"repository\": \"test_snapshot\",\n>         ...\n>         \"indices\": {\n>            \"demo\": {\n>               \"shards_stats\": {\n>                  \"initializing\": 0,\n>                  \"started\": 0,\n>                  \"finalizing\": 0,\n>                  \"done\": 3,\n>                  \"failed\": 2,\n>                  \"total\": 5\n>               },\n>               ...\n>               \"shards\": {\n>                  \"0\": {\n>                     \"stage\": \"FAILURE\",\n>                     \"stats\": {\n>                        \"number_of_files\": 0,\n>                        \"processed_files\": 0,\n>                        \"total_size_in_bytes\": 0,\n>                        \"processed_size_in_bytes\": 0,\n>                        \"start_time_in_millis\": 0,\n>                        \"time_in_millis\": 0\n>                     },\n>                     \"reason\": \"IndexShardSnapshotFailedException[[demo][0] Failed to perform snapshot (index files)]; nested: FileNotFoundException[/home/nfs/test_snapshot/indices/demo/0/__0 (Permission denied)]; \"\n>                  },\n>                  \"1\": {\n>                     \"stage\": \"DONE\",\n>                     \"stats\": {\n>                        \"number_of_files\": 4,\n>                        \"processed_files\": 4,\n>                        \"total_size_in_bytes\": 2712,\n>                        \"processed_size_in_bytes\": 2712,\n>                        \"start_time_in_millis\": 1445929403979,\n>                        \"time_in_millis\": 9\n>                     }\n>                  },\n>                  ...\n\njava.nio.file.NoSuchFileException below in ES log:\n\n> Caused by: java.nio.file.NoSuchFileException: /home/nfs/test_snapshot/indices/demo/2\n>       at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)\n>        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\n>        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\n>        at sun.nio.fs.UnixFileSystemProvider.newDirectoryStream(UnixFileSystemProvider.java:426)\n>        at java.nio.file.Files.newDirectoryStream(Files.java:411)\n>        at java.nio.file.Files.newDirectoryStream(Files.java:468)\n>        at\n> org.elasticsearch.common.blobstore.fs.FsBlobContainer.listBlobsByPrefix(FsBlobContainer.java:65)\n>        at org.elasticsearch.common.blobstore.fs.FsBlobContainer.listBlobs(FsBlobContainer.java:56)\n>        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$SnapshotContext.snapsh>ot(BlobStoreIndexShardRepository.java:438)\n\nShould we need a write permission for other users to free user set the NFS user id mapping or make sure both client and server has same username.\n\nThanks \n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}