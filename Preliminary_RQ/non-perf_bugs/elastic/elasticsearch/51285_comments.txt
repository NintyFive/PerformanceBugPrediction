[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577041669","html_url":"https://github.com/elastic/elasticsearch/issues/51285#issuecomment-577041669","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51285","id":577041669,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzA0MTY2OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T07:15:34Z","updated_at":"2020-01-22T07:15:34Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577113913","html_url":"https://github.com/elastic/elasticsearch/issues/51285#issuecomment-577113913","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51285","id":577113913,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzExMzkxMw==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T10:24:24Z","updated_at":"2020-01-22T11:52:41Z","author_association":"CONTRIBUTOR","body":"@henningandersen how long did you sleep for to make it easily reproducible?  I tried a variety of values from 20ms to 9 seconds and none of them reproduced the problem.  (10 seconds or more causes an unrelated failure because an `assertBusy` wait would need extending with such a long sleep.)\r\n\r\nHaving said that I can see a theoretical flaw in the code, and a reason why adding a sleep would make it more likely to happen.  So I am happy to fix that today.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577120143","html_url":"https://github.com/elastic/elasticsearch/issues/51285#issuecomment-577120143","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51285","id":577120143,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzEyMDE0Mw==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T10:39:48Z","updated_at":"2020-01-22T10:39:48Z","author_association":"CONTRIBUTOR","body":"I _think_ #51302 will fix this, but it's hard to be certain as I couldn't reproduce it locally.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577145655","html_url":"https://github.com/elastic/elasticsearch/issues/51285#issuecomment-577145655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51285","id":577145655,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzE0NTY1NQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T11:51:19Z","updated_at":"2020-01-22T11:51:19Z","author_association":"CONTRIBUTOR","body":"Thanks @droberts195 , you are right, it is only surfaced due to the added assertion in my PR (sorry, should have double checked against master before reporting here). It looks like the resulting NPE is ignored in `AllocatedPersistentTask.completeAndNotifyIfNeeded` since the task is already completed.\r\n\r\nI used a sleep of 1 second.\r\n\r\nI checked after merging in your changes locally and it seems to work fine, thanks for fixing this.","performed_via_github_app":null}]