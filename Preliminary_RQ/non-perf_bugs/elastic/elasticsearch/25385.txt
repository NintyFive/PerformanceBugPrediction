{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25385","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25385/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25385/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25385/events","html_url":"https://github.com/elastic/elasticsearch/issues/25385","id":238240117,"node_id":"MDU6SXNzdWUyMzgyNDAxMTc=","number":25385,"title":"bin/elasticsearch is not setting pid in provided pidfile","user":{"login":"meash-nrel","id":7649432,"node_id":"MDQ6VXNlcjc2NDk0MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/7649432?v=4","gravatar_id":"","url":"https://api.github.com/users/meash-nrel","html_url":"https://github.com/meash-nrel","followers_url":"https://api.github.com/users/meash-nrel/followers","following_url":"https://api.github.com/users/meash-nrel/following{/other_user}","gists_url":"https://api.github.com/users/meash-nrel/gists{/gist_id}","starred_url":"https://api.github.com/users/meash-nrel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meash-nrel/subscriptions","organizations_url":"https://api.github.com/users/meash-nrel/orgs","repos_url":"https://api.github.com/users/meash-nrel/repos","events_url":"https://api.github.com/users/meash-nrel/events{/privacy}","received_events_url":"https://api.github.com/users/meash-nrel/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2017-06-23T20:02:46Z","updated_at":"2017-06-24T11:29:05Z","closed_at":"2017-06-24T11:29:05Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.4.1\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_121\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_121-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux xxxxxx 2.6.32-573.18.1.el6.x86_64 #1 SMP Tue Feb 9 22:46:17 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen running elasticsearch 5.4.1 as a service, via the installed init.d file, it is properly creating and passing in the pidfile to _/bin/elasticsearch_ via its -p parameter... however _/bin/elasticsearch_ is never writing the process id to that provided pidfile.  This lack of writing pid causes the init.d system to never see that the service is properly running, so you can not issue a `service elasticsearch stop` command. Another side effect is that you if you run `service elasticsearch start` multiple times, each creates a separate running instance (then causing whatever conflicts arise from having the same named node running multiple times).  Any 5.4.1 node process must be manually killed as service stop doesn't work.\r\n\r\nThis is not a permission issue. The PID_DIR (the default of /var/run/elasticsearch) is properly created and assigned to elasticsearch by the init.d file.  I have an 1.7.6 instance running on this machine and it is writing to its own pidfile as expected.  (FYI There is no conflict between my new 5.4.1 node and this 1.7.6 node, as the legacy node is entirely self-contained within /opt/elasticsearch/elasticsearch-1.7.6-legacy, and writes pid to a separate directory, whereas 5.4.1 was RPM installed and uses all default dirs.  1.7.6 used to be RPM installed as well, and was writing pid to default dir /var/run/elasticsearch just fine until it was moved to its own isolated dirs.)    \r\n\r\ninit.d is working as written and passing pidfile, and elasticsearch can write to that file, so it seems that _/bin/elasticsearch_ itself is not performing the write.\r\n\r\nBottom line: /bin/elasticsearch isn't writing the pid.  Dir and file are owned by elasticsearch user and are RW so it is not a permission issue (and as confirmation, this exact same pid path/file worked on a prior ES version).\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Installed latest elasticsearch 5.4.x via RPM from Elastic's [instructions](https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html)\r\n2. Run installed init.d service: `service elasticsearch start`\r\n3. Try to stop service, nothing happens:  `service elasticsearch stop`\r\n4. Can run init.d service again (multiple instances get started): `service elasticsearch start`\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}