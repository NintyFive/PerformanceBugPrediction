{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10927","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10927/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10927/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10927/events","html_url":"https://github.com/elastic/elasticsearch/issues/10927","id":72504334,"node_id":"MDU6SXNzdWU3MjUwNDMzNA==","number":10927,"title":"must filter is not working as expected","user":{"login":"mjspka","id":12202653,"node_id":"MDQ6VXNlcjEyMjAyNjUz","avatar_url":"https://avatars3.githubusercontent.com/u/12202653?v=4","gravatar_id":"","url":"https://api.github.com/users/mjspka","html_url":"https://github.com/mjspka","followers_url":"https://api.github.com/users/mjspka/followers","following_url":"https://api.github.com/users/mjspka/following{/other_user}","gists_url":"https://api.github.com/users/mjspka/gists{/gist_id}","starred_url":"https://api.github.com/users/mjspka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mjspka/subscriptions","organizations_url":"https://api.github.com/users/mjspka/orgs","repos_url":"https://api.github.com/users/mjspka/repos","events_url":"https://api.github.com/users/mjspka/events{/privacy}","received_events_url":"https://api.github.com/users/mjspka/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-05-01T19:31:00Z","updated_at":"2015-05-01T21:02:38Z","closed_at":"2015-05-01T19:50:05Z","author_association":"NONE","active_lock_reason":null,"body":"1. I have two types of documents indexed in elasticsearch. One is of type, \"SERVICE_OFFERING\" and the second one is of type, \"SUBSCRIPTION.\". You can see the screenshot of this in the below image.\n\n![image](https://cloud.githubusercontent.com/assets/12202653/7435879/b1af2718-effc-11e4-9543-431167c17c66.png)\n1. Now if I query based on catalogId I am getting results back.\n\nElasticsearch TRACE: 2015-05-01T19:25:00Z\n  -> POST http://localhost:9201/inventory/_search\n  {\n    \"query\": {\n      \"query_string\": {\n        \"fields\": [\n          \"serviceType\",\n          \"displayName\",\n          \"description\",\n          \"_.displayName\",\n          \"_.description\",\n          \"*.value\"\n        ],\n        \"query\": \"vm\"\n      }\n    },\n    \"filter\": {\n      \"bool\": {\n        \"should\": [\n          {\n            \"term\": {\n              \"catalogId\": \"90d9650a36988e5d0136988f03ab000f\"\n            }\n          },\n          {\n            \"term\": {\n              \"catalogId\": \"fb2881884b787853014b7ada21670004\"\n            }\n          }\n        ]\n      }\n    },\n    \"size\": \"1\",\n    \"from\": \"0\"\n  }\n  <- 200\n  {\n    \"took\": 4,\n    \"timed_out\": false,\n    \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n    },\n    \"hits\": {\n      \"total\": 8,\n      \"max_score\": 0.7508366,\n      \"hits\": [\n        {\n          \"_index\": \"inventory\",\n          \"_type\": \"subscription\",\n          \"_id\": \"90e72e034ce89baf014ce8c0f8d20140\",\n    .....\n    .....\n1. But if I am doing query based on catalogId and docType then I not seeing any results.\n\nElasticsearch TRACE: 2015-05-01T19:27:08Z\n  -> POST http://localhost:9201/inventory/_search\n  {\n    \"query\": {\n      \"query_string\": {\n        \"fields\": [\n          \"serviceType\",\n          \"displayName\",\n          \"description\",\n          \"_.displayName\",\n          \"_.description\",\n          \"*.value\"\n        ],\n        \"query\": \"vm\"\n      }\n    },\n    \"filter\": {\n      \"bool\": {\n        \"should\": [\n          {\n            \"term\": {\n              \"catalogId\": \"90d9650a36988e5d0136988f03ab000\n            }\n          },\n          {\n            \"term\": {\n              \"catalogId\": \"fb2881884b787853014b7ada2167000\n            }\n          }\n        ],\n        \"must\": [\n          {\n            \"term\": {\n              \"docType\": \"SUBSCRIPTION\"\n            }\n          }\n        ]\n      }\n    },\n    \"size\": \"1\",\n    \"from\": \"0\"\n  }\n  <- 200\n  {\n    \"took\": 3,\n    \"timed_out\": false,\n    \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n    },\n    \"hits\": {\n      \"total\": 0,\n      \"max_score\": null,\n      \"hits\": []\n    }\n  }\n\nElasticsearch DEBUG: 2015-05-01T19:27:08Z\n  Request complete\n\nAs per elasticsearch documentation, The must filter should return the documents where it matches along with should filter.\n1. Now I have used the query with must filter only as follows. I still do not see any results.\n\nElasticsearch TRACE: 2015-05-01T19:28:46Z\n  -> POST http://localhost:9201/inventory/_search\n  {\n    \"query\": {\n      \"query_string\": {\n        \"fields\": [\n          \"serviceType\",\n          \"displayName\",\n          \"description\",\n          \"_.displayName\",\n          \"_.description\",\n          \"*.value\"\n        ],\n        \"query\": \"vm\"\n      }\n    },\n    \"filter\": {\n      \"bool\": {\n        \"should\": [],\n        \"must\": [\n          {\n            \"term\": {\n              \"docType\": \"SUBSCRIPTION\"\n            }\n          }\n        ]\n      }\n    }\n  }\n  <- 200\n  {\n    \"took\": 2,\n    \"timed_out\": false,\n    \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n    },\n    \"hits\": {\n      \"total\": 0,\n      \"max_score\": null,\n      \"hits\": []\n    }\n  }\n\nElasticsearch DEBUG: 2015-05-01T19:28:46Z\n  Request complete\n\nFYI: The build information of elasticsearch that I am using is as follows,\n{\n  \"status\" : 200,\n  \"name\" : \"Human Torch\",\n  \"cluster_name\" : \"pmalla-lt-csa-c28\",\n  \"version\" : {\n    \"number\" : \"1.4.3\",\n    \"build_hash\" : \"36a29a7144cfde87a960ba039091d40856fcb9af\",\n    \"build_timestamp\" : \"2015-02-11T14:23:15Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.10.3\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n\nI would appreciate if you can get back to me at the earliest.\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}