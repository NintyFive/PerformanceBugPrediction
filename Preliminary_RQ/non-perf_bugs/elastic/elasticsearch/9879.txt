{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9879","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9879/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9879/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9879/events","html_url":"https://github.com/elastic/elasticsearch/issues/9879","id":58908994,"node_id":"MDU6SXNzdWU1ODkwODk5NA==","number":9879,"title":"No validation of custom analyzer when updating index setting on a closed index","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-02-25T14:28:20Z","updated_at":"2018-03-14T08:53:20Z","closed_at":"2018-03-14T08:53:20Z","author_association":"MEMBER","active_lock_reason":null,"body":"Steps to reproduce:\n\n``` javascript\nDELETE test_idx\n\n# create an index\nPUT test_idx\n{\n    \"settings\" : {\n        \"number_of_shards\" : 3,\n        \"number_of_replicas\" : 2\n    }\n}\n\n# Close the index to we can change non-dynamic settings\nPOST test_idx/_close\n\n# Add custom analyzer that points to a non-existant tokenizer\nPUT test_idx/_settings\n{\n        \"analysis\": {\n            \"analyzer\": {\n                \"my_custom_analyzer_1\": {\n                    \"tokenizer\": \"my_custom_tokenizer\"\n                }\n            }\n        }\n}\n\n# Open the index (no error)\nPOST test_idx/_open\n\n# Get the index settings (analyzer has been added)\nGET test_idx/_settings\n\n# Try to use the analyzer in a mapping (validation error here)\nPUT test_idx/_mapping/type\n{\n  \"doc\": {\n    \"properties\": {\n      \"field\": {\n        \"type\": \"string\",\n        \"analyzer\": \"my_custom_analyzer_1\"\n      }\n    }\n  }\n}\n```\n\nWe should validate the analyzer when the settings are updated so we don't have invalid analyzers defined in the index settings. Interestingly we actually do validate the analyzer if you try to add it when creating the index.\n\n``` javascript\nPUT test_idx\n{\n    \"settings\" : {\n        \"number_of_shards\" : 3,\n        \"number_of_replicas\" : 2,\n        \"analysis\": {\n            \"analyzer\": {\n                \"my_custom_analyzer_1\": {\n                    \"tokenizer\": \"my_custom_tokenizer\"\n                }\n            }\n        }\n    }\n}\n```\n\nErrors with: \n\n``` javascript\n{\n   \"error\": \"IndexCreationException[[test_idx] failed to create index]; nested: IllegalArgumentException[Custom Analyzer [my_custom_analyzer_1] failed to find tokenizer under name [my_custom_tokenizer]]; \",\n   \"status\": 400\n}\n```\n\nThis issue was raised in a mailing list post: https://groups.google.com/forum/#!topic/elasticsearch/roLINFQWfFc\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}