{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10914","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10914/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10914/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10914/events","html_url":"https://github.com/elastic/elasticsearch/issues/10914","id":72356899,"node_id":"MDU6SXNzdWU3MjM1Njg5OQ==","number":10914,"title":"Issue with highlighting on _all field with different analyzers","user":{"login":"joshuar","id":7401,"node_id":"MDQ6VXNlcjc0MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/7401?v=4","gravatar_id":"","url":"https://api.github.com/users/joshuar","html_url":"https://github.com/joshuar","followers_url":"https://api.github.com/users/joshuar/followers","following_url":"https://api.github.com/users/joshuar/following{/other_user}","gists_url":"https://api.github.com/users/joshuar/gists{/gist_id}","starred_url":"https://api.github.com/users/joshuar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshuar/subscriptions","organizations_url":"https://api.github.com/users/joshuar/orgs","repos_url":"https://api.github.com/users/joshuar/repos","events_url":"https://api.github.com/users/joshuar/events{/privacy}","received_events_url":"https://api.github.com/users/joshuar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-05-01T05:16:55Z","updated_at":"2015-05-01T16:15:54Z","closed_at":"2015-05-01T16:15:53Z","author_association":"MEMBER","active_lock_reason":null,"body":"Hey there,\n\nUsing 1.5.2, there seems to be some sort of issue, or at least confusion about how highlighting works on the `_all` field.\n\nFor example, when using dynamic mappings on fields, highlighting works as expected:\n\n``` json\nDELETE /testhighlightindexdynamic\n\nPOST testhighlightindexdynamic/type1/1\n{\n  \"field1\": \"organization\",\n  \"field2\": \"organization\"\n}\n\nPOST /testhighlightindexdynamic/_search\n{\n  \"query\": {\n    \"match\": {\n      \"_all\": \"organization\"\n    }\n  },\n  \"highlight\": {\n    \"fields\": {\n      \"*\": {}\n    }\n  }\n}\n```\n\nI get both fields highlighted as expected:\n\n``` json\n{\n   \"took\": 3,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 1,\n      \"max_score\": 0.2712221,\n      \"hits\": [\n         {\n            \"_index\": \"testhighlightindexdynamic\",\n            \"_type\": \"type1\",\n            \"_id\": \"1\",\n            \"_score\": 0.2712221,\n            \"_source\": {\n               \"field1\": \"organization\",\n               \"field2\": \"organization\"\n            },\n            \"highlight\": {\n               \"field1\": [\n                  \"<em>organization</em>\"\n               ],\n               \"field2\": [\n                  \"<em>organization</em>\"\n               ]\n            }\n         }\n      ]\n   }\n}\n```\n\nHowever if I use a different analyzer on one of the fields and perform the same search, I no longer get both fields highlighted:\n\n``` json\nDELETE testhighlightindex\n\nPUT /testhighlightindex\n{\n  \"mappings\": {\n    \"type1\": {\n      \"dynamic\": \"strict\",\n      \"properties\": {\n        \"field1\": {\n          \"type\": \"string\",\n          \"analyzer\": \"snowball\"\n        },\n        \"field2\": {\n          \"type\": \"string\",\n          \"analyzer\": \"standard\"\n        }\n      }\n    }\n  }\n}\n\nPOST testhighlightindex/type1/1\n{\n  \"field1\": \"organization\",\n  \"field2\": \"organization\"\n}\n\nPOST /testhighlightindex/_search\n{\n  \"query\": {\n    \"match\": {\n      \"_all\": \"organization\"\n      }\n  },\n  \"highlight\": {\n    \"fields\": {\n      \"*\": {}\n    }\n  }\n}\n```\n\nThis returns results with only `field2` highlighted (which is using the standard analyzer):\n\n``` json\n{\n   \"took\": 5,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 1,\n      \"max_score\": 0.2712221,\n      \"hits\": [\n         {\n            \"_index\": \"testhighlightindex\",\n            \"_type\": \"type1\",\n            \"_id\": \"1\",\n            \"_score\": 0.2712221,\n            \"_source\": {\n               \"field1\": \"organization\",\n               \"field2\": \"organization\"\n            },\n            \"highlight\": {\n               \"field2\": [\n                  \"<em>organization</em>\"\n               ]\n            }\n         }\n      ]\n   }\n}\n```\n\nIt looks like the highlighter code only applies the analyzer of the search field, not the analyzer for the field defined in the mapping?  You can reverse the field that is highlighted in this second case by setting the analyzer on the `_all` field to \"snowball\".\n\nIs this expected behaviour?\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}