{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53308","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53308/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53308/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53308/events","html_url":"https://github.com/elastic/elasticsearch/issues/53308","id":578166976,"node_id":"MDU6SXNzdWU1NzgxNjY5NzY=","number":53308,"title":"Add shard data to _nodes/stats, _nodes/_local/stats, and _stats endpoints","user":{"login":"chrisronline","id":56682,"node_id":"MDQ6VXNlcjU2Njgy","avatar_url":"https://avatars1.githubusercontent.com/u/56682?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisronline","html_url":"https://github.com/chrisronline","followers_url":"https://api.github.com/users/chrisronline/followers","following_url":"https://api.github.com/users/chrisronline/following{/other_user}","gists_url":"https://api.github.com/users/chrisronline/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisronline/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisronline/subscriptions","organizations_url":"https://api.github.com/users/chrisronline/orgs","repos_url":"https://api.github.com/users/chrisronline/repos","events_url":"https://api.github.com/users/chrisronline/events{/privacy}","received_events_url":"https://api.github.com/users/chrisronline/received_events","type":"User","site_admin":false},"labels":[{"id":912834056,"node_id":"MDU6TGFiZWw5MTI4MzQwNTY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Monitoring","name":":Core/Features/Monitoring","color":"0e8a16","default":false,"description":""},{"id":146836529,"node_id":"MDU6TGFiZWwxNDY4MzY1Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Stats","name":":Core/Features/Stats","color":"0e8a16","default":false,"description":"Statistics tracking and retrieval APIs"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-03-09T20:21:22Z","updated_at":"2020-04-07T16:24:20Z","closed_at":"2020-04-07T16:24:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The `_nodes/_local/stats`, `_nodes/stats`, and `_stats` API endpoints do not return any information about shards, specifically shards that live on either the node or compose an index. Shard data is exposed by the `_cluster/state/routing_table` API endpoint.\r\n\r\nI'm proposing we modify the above mentioned `stats` endpoints to include the shard data as well. I don't have an opinion on where the data should live in the structure, but it needs to include the following fields (which can all be found in the `_cluster/state/routing_table` response):\r\n```\r\n{\r\n  'index': <number>,\r\n  'state': <string>,\r\n  'primary': <boolean>\r\n}\r\n```\r\n\r\nFor the `_stats` endpoint, it should also include some simple aggregations as well, specifically `shards.total` and `shards.totalUnassigned` (where `unassigned` is any shard that is `state: \"UNASSIGNED\"` or `state: \"INITIALIZING\"`).\r\n\r\nThis change will alleviate some issues on the Stack Monitoring UI in Kibana with the queries we need to execute to show the shard data alongside the node or index data.\r\n\r\nThis will be a breaking change so 8.0 is the goal of this work.\r\n\r\n\r\n","closed_by":{"login":"chrisronline","id":56682,"node_id":"MDQ6VXNlcjU2Njgy","avatar_url":"https://avatars1.githubusercontent.com/u/56682?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisronline","html_url":"https://github.com/chrisronline","followers_url":"https://api.github.com/users/chrisronline/followers","following_url":"https://api.github.com/users/chrisronline/following{/other_user}","gists_url":"https://api.github.com/users/chrisronline/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisronline/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisronline/subscriptions","organizations_url":"https://api.github.com/users/chrisronline/orgs","repos_url":"https://api.github.com/users/chrisronline/repos","events_url":"https://api.github.com/users/chrisronline/events{/privacy}","received_events_url":"https://api.github.com/users/chrisronline/received_events","type":"User","site_admin":false},"performed_via_github_app":null}