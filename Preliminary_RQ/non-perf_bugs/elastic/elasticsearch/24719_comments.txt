[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301839632","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-301839632","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":301839632,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTgzOTYzMg==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-05-16T16:35:05Z","updated_at":"2017-05-16T16:35:05Z","author_association":"CONTRIBUTOR","body":"> I have already gone through https://discuss.elastic.co/t/out-of-memory-invoked-oom-killer/807951\r\n\r\nThis is an invalid page.  Did you mean https://discuss.elastic.co/t/out-of-memory-invoked-oom-killer/80795 (without the 1 at the end)?  That question refers to a 2.4 cluster.\r\n\r\nIts impossible to know what the problem is without a heap dump.\r\n\r\nYou might try disabling the netty pooled allocator, by starting ES with \r\n```\r\n-Dio.netty.allocator.type=unpooled\r\n```\r\nSee https://github.com/elastic/elasticsearch/pull/22452 for a history on this topic.\r\n\r\nYou may also be encountering heap spikes on certain aggregations, see https://github.com/elastic/elasticsearch/issues/24215\r\n\r\nBut without a heap dump, its impossible to tell exactly.  ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301841697","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-301841697","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":301841697,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTg0MTY5Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-05-16T16:41:58Z","updated_at":"2017-05-16T16:41:58Z","author_association":"CONTRIBUTOR","body":"I would also suggest upgrading to the latest version as a number of potential causes have already been fixed.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301845515","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-301845515","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":301845515,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTg0NTUxNQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-05-16T16:52:44Z","updated_at":"2017-05-16T16:52:44Z","author_association":"MEMBER","body":"This is being killed by the OOM killer, not a Java heap OOM so I'm not sure about disabling the pooled allocator or heaping because of aggregations. It could be that there is a native leak of which there have been a few bugs there recently. However, there is also a known native leak in the JDK that is fixed in 8u131 (e.g., https://bugs.openjdk.java.net/browse/JDK-8178124). So indeed, I think you should upgrade both Elasticsearch and your JDK to the latest and only if this continues to reproduce after should a closer inspection be made.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301845643","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-301845643","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":301845643,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTg0NTY0Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-05-16T16:53:12Z","updated_at":"2017-05-16T16:53:12Z","author_association":"MEMBER","body":"Also, in case it's not obvious, you should do these upgrades one at a time so that if the issue is resolved by one of these two steps you know which one it is.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301867880","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-301867880","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":301867880,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTg2Nzg4MA==","user":{"login":"jay-dihenkar","id":17760959,"node_id":"MDQ6VXNlcjE3NzYwOTU5","avatar_url":"https://avatars2.githubusercontent.com/u/17760959?v=4","gravatar_id":"","url":"https://api.github.com/users/jay-dihenkar","html_url":"https://github.com/jay-dihenkar","followers_url":"https://api.github.com/users/jay-dihenkar/followers","following_url":"https://api.github.com/users/jay-dihenkar/following{/other_user}","gists_url":"https://api.github.com/users/jay-dihenkar/gists{/gist_id}","starred_url":"https://api.github.com/users/jay-dihenkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay-dihenkar/subscriptions","organizations_url":"https://api.github.com/users/jay-dihenkar/orgs","repos_url":"https://api.github.com/users/jay-dihenkar/repos","events_url":"https://api.github.com/users/jay-dihenkar/events{/privacy}","received_events_url":"https://api.github.com/users/jay-dihenkar/received_events","type":"User","site_admin":false},"created_at":"2017-05-16T18:10:31Z","updated_at":"2017-05-16T18:10:48Z","author_association":"NONE","body":"@jasontedor: Upgrades are expensive in terms of time/resources. I'd prefer JDK upgrade first. \r\nCan you provide some assistance to dig into it further (key factors to check) before we decide and execute upgrades?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301872977","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-301872977","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":301872977,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTg3Mjk3Nw==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-05-16T18:28:45Z","updated_at":"2017-05-16T18:28:45Z","author_association":"CONTRIBUTOR","body":"> Can you provide some assistance to dig into it further (key factors to check) before we decide and execute upgrades?\r\n\r\nWhat do you mean?  If you upgrade the JDK and that doesn't solve the issue, then look to upgrading the ES version, because as @clintongormley and @jasontedor mentioned, several of these causes have been taken care of in the latest version.\r\n\r\nIf you have a heap dump, it should give an indication beforehand of whether the problem relates to those we've already seen or its something totally different.  Regardless, it seems trying to upgrade the one query node is simpler than trying to analyze a heap dump.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/305154363","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-305154363","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":305154363,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTE1NDM2Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-05-31T10:45:12Z","updated_at":"2017-05-31T10:45:12Z","author_association":"MEMBER","body":"No additional feedback, closing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/305155077","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-305155077","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":305155077,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTE1NTA3Nw==","user":{"login":"jay-dihenkar","id":17760959,"node_id":"MDQ6VXNlcjE3NzYwOTU5","avatar_url":"https://avatars2.githubusercontent.com/u/17760959?v=4","gravatar_id":"","url":"https://api.github.com/users/jay-dihenkar","html_url":"https://github.com/jay-dihenkar","followers_url":"https://api.github.com/users/jay-dihenkar/followers","following_url":"https://api.github.com/users/jay-dihenkar/following{/other_user}","gists_url":"https://api.github.com/users/jay-dihenkar/gists{/gist_id}","starred_url":"https://api.github.com/users/jay-dihenkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay-dihenkar/subscriptions","organizations_url":"https://api.github.com/users/jay-dihenkar/orgs","repos_url":"https://api.github.com/users/jay-dihenkar/repos","events_url":"https://api.github.com/users/jay-dihenkar/events{/privacy}","received_events_url":"https://api.github.com/users/jay-dihenkar/received_events","type":"User","site_admin":false},"created_at":"2017-05-31T10:48:48Z","updated_at":"2017-05-31T10:51:02Z","author_association":"NONE","body":"Hi Jason,\r\n\r\nWe upgraded JDK last week to 8u131 but do not see any improvements yet. Will let you know further if we have any improvements or we may look forward to ES Upgrade.\r\n\r\nThanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/305186427","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-305186427","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":305186427,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTE4NjQyNw==","user":{"login":"jay-dihenkar","id":17760959,"node_id":"MDQ6VXNlcjE3NzYwOTU5","avatar_url":"https://avatars2.githubusercontent.com/u/17760959?v=4","gravatar_id":"","url":"https://api.github.com/users/jay-dihenkar","html_url":"https://github.com/jay-dihenkar","followers_url":"https://api.github.com/users/jay-dihenkar/followers","following_url":"https://api.github.com/users/jay-dihenkar/following{/other_user}","gists_url":"https://api.github.com/users/jay-dihenkar/gists{/gist_id}","starred_url":"https://api.github.com/users/jay-dihenkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay-dihenkar/subscriptions","organizations_url":"https://api.github.com/users/jay-dihenkar/orgs","repos_url":"https://api.github.com/users/jay-dihenkar/repos","events_url":"https://api.github.com/users/jay-dihenkar/events{/privacy}","received_events_url":"https://api.github.com/users/jay-dihenkar/received_events","type":"User","site_admin":false},"created_at":"2017-05-31T13:28:40Z","updated_at":"2017-05-31T13:28:40Z","author_association":"NONE","body":"@jasontedor : Is this in any way related to issue being faced? - https://www.elastic.co/blog/tracking-down-native-memory-leaks-in-elasticsearch\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/305187188","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-305187188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":305187188,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTE4NzE4OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-05-31T13:31:33Z","updated_at":"2017-05-31T13:31:33Z","author_association":"MEMBER","body":"@jay-dihenkar The leaks discovered there were fixed in 5.2.1.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/325265851","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-325265851","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":325265851,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNTI2NTg1MQ==","user":{"login":"jay-dihenkar","id":17760959,"node_id":"MDQ6VXNlcjE3NzYwOTU5","avatar_url":"https://avatars2.githubusercontent.com/u/17760959?v=4","gravatar_id":"","url":"https://api.github.com/users/jay-dihenkar","html_url":"https://github.com/jay-dihenkar","followers_url":"https://api.github.com/users/jay-dihenkar/followers","following_url":"https://api.github.com/users/jay-dihenkar/following{/other_user}","gists_url":"https://api.github.com/users/jay-dihenkar/gists{/gist_id}","starred_url":"https://api.github.com/users/jay-dihenkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay-dihenkar/subscriptions","organizations_url":"https://api.github.com/users/jay-dihenkar/orgs","repos_url":"https://api.github.com/users/jay-dihenkar/repos","events_url":"https://api.github.com/users/jay-dihenkar/events{/privacy}","received_events_url":"https://api.github.com/users/jay-dihenkar/received_events","type":"User","site_admin":false},"created_at":"2017-08-28T05:51:30Z","updated_at":"2017-08-28T05:51:30Z","author_association":"NONE","body":"I have been randomly experimenting... Looks like if req circuit breaker limit is greater than parent circuit breaker and parent circuit breaker gets tripped multiple times causes memory to leak. ( tested on es 5.2.x and 5.3.x ). \r\n\r\nAlso adding to this... looks like heap size and stack size are also related, on an ES having 300gb data with 16gb heap and 1m stack size takes much more memory (28gb res mem) than the same setup with 12gb heap and 320kb (20 gb res mem). Both work well.\r\n\r\nPS: midnight experiments so I didn't document results. Feel free to ignore if this looks too vague.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/325414385","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-325414385","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":325414385,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNTQxNDM4NQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-08-28T17:09:26Z","updated_at":"2017-08-28T17:09:26Z","author_association":"MEMBER","body":"> Looks like if req circuit breaker limit is greater than parent circuit breaker and parent circuit breaker gets tripped multiple times causes memory to leak. ( tested on es 5.2.x and 5.3.x ).\r\n\r\nThis is interesting, can you provide more details here, preferably a reproduction? There was a circuit breaker leak in 5.x prior to 5.2.2 (#23310) but you seem to be claiming there's an issue beyond that.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356813333","html_url":"https://github.com/elastic/elasticsearch/issues/24719#issuecomment-356813333","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24719","id":356813333,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NjgxMzMzMw==","user":{"login":"TpClark","id":4727264,"node_id":"MDQ6VXNlcjQ3MjcyNjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/4727264?v=4","gravatar_id":"","url":"https://api.github.com/users/TpClark","html_url":"https://github.com/TpClark","followers_url":"https://api.github.com/users/TpClark/followers","following_url":"https://api.github.com/users/TpClark/following{/other_user}","gists_url":"https://api.github.com/users/TpClark/gists{/gist_id}","starred_url":"https://api.github.com/users/TpClark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TpClark/subscriptions","organizations_url":"https://api.github.com/users/TpClark/orgs","repos_url":"https://api.github.com/users/TpClark/repos","events_url":"https://api.github.com/users/TpClark/events{/privacy}","received_events_url":"https://api.github.com/users/TpClark/received_events","type":"User","site_admin":false},"created_at":"2018-01-11T03:25:55Z","updated_at":"2018-01-11T03:25:55Z","author_association":"NONE","body":"i use es with version 6.0, and i have the same question too, so what can i do with this?","performed_via_github_app":null}]