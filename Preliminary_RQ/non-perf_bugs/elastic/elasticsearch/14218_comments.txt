[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/149781870","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-149781870","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":149781870,"node_id":"MDEyOklzc3VlQ29tbWVudDE0OTc4MTg3MA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-10-21T04:44:44Z","updated_at":"2015-10-21T04:44:44Z","author_association":"MEMBER","body":"Just wondering what would happen if you have indexed a parent, some children and then you delete the parent...\n\nI did not test it but I guess the DELETE operation will be successful, so what will happen to the search parts you mentioned earlier?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/149847643","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-149847643","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":149847643,"node_id":"MDEyOklzc3VlQ29tbWVudDE0OTg0NzY0Mw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-10-21T10:19:33Z","updated_at":"2015-10-21T10:19:33Z","author_association":"CONTRIBUTOR","body":"I agree this can be an issue as well, but a different one? It is different to not have a value for the `_parent` field and to have a value that points to a document that does not exist.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/150185208","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-150185208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":150185208,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MDE4NTIwOA==","user":{"login":"bevans88","id":4851135,"node_id":"MDQ6VXNlcjQ4NTExMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/4851135?v=4","gravatar_id":"","url":"https://api.github.com/users/bevans88","html_url":"https://github.com/bevans88","followers_url":"https://api.github.com/users/bevans88/followers","following_url":"https://api.github.com/users/bevans88/following{/other_user}","gists_url":"https://api.github.com/users/bevans88/gists{/gist_id}","starred_url":"https://api.github.com/users/bevans88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bevans88/subscriptions","organizations_url":"https://api.github.com/users/bevans88/orgs","repos_url":"https://api.github.com/users/bevans88/repos","events_url":"https://api.github.com/users/bevans88/events{/privacy}","received_events_url":"https://api.github.com/users/bevans88/received_events","type":"User","site_admin":false},"created_at":"2015-10-22T11:24:58Z","updated_at":"2015-10-22T11:24:58Z","author_association":"NONE","body":"In a very simple Use Case that somewhat mirrors my current applications use of Parent/Child functionality:\n- 'Book' Type that is a Child of 'Author' Type.\n- 'Book' may, or may not have an Author. For instance we may have a 'Book' that we don't know the   author of .\n  \n  If it is enforced that all Child documents must have a Parent set then this becomes invalid.\n\nAs far as I'm aware having Child documents with no Parent set has also caused no problems with 'standard' search queries, with the current problem only arising due to the use of them in the recent Inner Hits functionality.\n\nAt the moment ElasticSearch actually allows for searching on Child documents that don't have a Parent set:\n\n```\n  \"query\": {\n    \"bool\": {\n      \"must_not\": [\n        {\n          \"has_parent\": {\n            \"parent_type\": \"Author\",\n            \"query\": {\n              \"match_all\": {}\n            }\n          }\n        }\n      ]\n    }\n  }\n```\n\nAlso, wouldn't the following cause problems (In the same way deleting a Parent would I assume):\n- Index Child document with Parent that has not yet been indexed. \n- Run search on child documents.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/150236191","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-150236191","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":150236191,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MDIzNjE5MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-10-22T14:09:09Z","updated_at":"2015-10-22T14:09:09Z","author_association":"CONTRIBUTOR","body":"This puts a burden on users to index parents then children in that order.  If you are (eg) taking a dump from a database then you may get documents in some random order.  This would also mean doing a real-time check for the existence of a parent any time we index a child doc.  Costly, no? \n\nAlso the point of deleting parent docs without also deleting child docs is a valid one.  Either we have to special case the deletion of parent docs to first delete children, or we have to guard against the case where a child doc may not have parents.  \n\nThe above is making me lean towards ensuring that we can always handle the case where corresponding parents don't exist.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/150237673","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-150237673","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":150237673,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MDIzNzY3Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-10-22T14:15:09Z","updated_at":"2015-10-22T14:15:09Z","author_association":"CONTRIBUTOR","body":"I think I may have misunderstood this - it's not about the existence of the parent document, but about whether the child has a parent specified...  in which case I agree, we should enforce this.\n\n> If it is enforced that all Child documents must have a Parent set then this becomes invalid.\n\nIn your example, you can simply have an UnknownAuthor parent document.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/150239960","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-150239960","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":150239960,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MDIzOTk2MA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-10-22T14:24:04Z","updated_at":"2015-10-22T14:24:04Z","author_association":"CONTRIBUTOR","body":"> I think I may have misunderstood this - it's not about the existence of the parent document, but about whether the child has a parent specified... in which case I agree, we should enforce this.\n\nExactly, this is what I meant.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/151027153","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-151027153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":151027153,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTAyNzE1Mw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-10-26T05:16:52Z","updated_at":"2015-10-26T05:16:52Z","author_association":"MEMBER","body":"@clintongormley @jpountz the index time check is insufficient. We only check if a routing value has been specified. When the parent id is specified at index we also set the routing value, so that passes the check. If no parent id is specified we fail, but if only a routing value is specified (like was reported in the forum) then we don't fail while we should.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375374317","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-375374317","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":375374317,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTM3NDMxNw==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T16:41:52Z","updated_at":"2018-03-22T16:41:52Z","author_association":"CONTRIBUTOR","body":"Closing this issue, as in 6.x we already don't allow to index child docs  where `parent` field  is not specified:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"mapper_parsing_exception\",\r\n        \"reason\": \"failed to parse\"\r\n      }\r\n    ],\r\n    \"type\": \"mapper_parsing_exception\",\r\n    \"reason\": \"failed to parse\",\r\n    \"caused_by\": {\r\n      \"type\": \"illegal_argument_exception\",\r\n      \"reason\": \"[parent] is missing for join field [jf]\"\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nWe still don't enforce that `parent` should be valid and existing, but it is a different issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/424813083","html_url":"https://github.com/elastic/elasticsearch/issues/14218#issuecomment-424813083","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14218","id":424813083,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNDgxMzA4Mw==","user":{"login":"jaddison","id":101148,"node_id":"MDQ6VXNlcjEwMTE0OA==","avatar_url":"https://avatars0.githubusercontent.com/u/101148?v=4","gravatar_id":"","url":"https://api.github.com/users/jaddison","html_url":"https://github.com/jaddison","followers_url":"https://api.github.com/users/jaddison/followers","following_url":"https://api.github.com/users/jaddison/following{/other_user}","gists_url":"https://api.github.com/users/jaddison/gists{/gist_id}","starred_url":"https://api.github.com/users/jaddison/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaddison/subscriptions","organizations_url":"https://api.github.com/users/jaddison/orgs","repos_url":"https://api.github.com/users/jaddison/repos","events_url":"https://api.github.com/users/jaddison/events{/privacy}","received_events_url":"https://api.github.com/users/jaddison/received_events","type":"User","site_admin":false},"created_at":"2018-09-26T18:01:19Z","updated_at":"2018-09-26T18:01:19Z","author_association":"NONE","body":"> We still don't enforce that parent should be valid and existing, but it is a different issue.\r\n\r\nI think if this is ever 'fixed', it will break valid scenarios (like one I have). I hope it is never considered something to fix. ğŸ™ğŸ¼","performed_via_github_app":null}]