{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30869","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30869/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30869/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30869/events","html_url":"https://github.com/elastic/elasticsearch/issues/30869","id":326531043,"node_id":"MDU6SXNzdWUzMjY1MzEwNDM=","number":30869,"title":"Several test failures in :x-pack:plugin:security:test in 6.3","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"labels":[{"id":912838879,"node_id":"MDU6TGFiZWw5MTI4Mzg4Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Security","name":":Security/Security","color":"0e8a16","default":false,"description":"Security issues without another label"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"assignees":[{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false}],"milestone":null,"comments":10,"created_at":"2018-05-25T13:46:57Z","updated_at":"2019-02-14T10:00:14Z","closed_at":"2019-02-14T10:00:14Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.3+multijob-unix-compatibility/os=sles/86/console the following tests failed:\r\n\r\n```\r\norg.elasticsearch.xpack.security.authc.esnative.NativeRealmIntegTests testAddUserAndRoleThenAuth\r\norg.elasticsearch.xpack.security.authz.IndexAliasesTests testGetAliasesCreateOnlyPermissionStrict\r\norg.elasticsearch.xpack.security.authz.IndexAliasesTests testGetAliasesCreateOnlyPermissionStrict\r\norg.elasticsearch.xpack.security.audit.logfile.AuditTrailSettingsUpdateTests testInvalidFilterSettings\r\norg.elasticsearch.xpack.security.transport.ssl.SslMultiPortTests testThatTransportClientWithOnlyTruststoreCanConnectToNoClientAuthProfile\r\norg.elasticsearch.xpack.security.transport.ssl.SslMultiPortTests testThatTransportClientWithOnlyTruststoreCannotConnectToDefaultProfile\r\norg.elasticsearch.xpack.security.transport.ssl.SslMultiPortTests testThatTransportClientWithOnlyTruststoreCannotConnectToDefaultProfile\r\n```\r\n\r\nNone of these reproduce individually.  These are the REPRO commands:\r\n\r\n```\r\n./gradlew :x-pack:plugin:security:test -Dtests.seed=22E2031847F1522 -Dtests.class=org.elasticsearch.xpack.security.audit.logfile.AuditTrailSettingsUpdateTests -Dtests.method=\"testInvalidFilterSettings\" -Dtests.security.manager=true -Dtests.locale=sr-Latn-RS -Dtests.timezone=America/Argentina/Rio_Gallegos\r\n./gradlew :x-pack:plugin:security:test -Dtests.seed=22E2031847F1522 -Dtests.class=org.elasticsearch.xpack.security.transport.ssl.SslMultiPortTests -Dtests.method=\"testThatTransportClientWithOnlyTruststoreCanConnectToNoClientAuthProfile\" -Dtests.security.manager=true -Dtests.locale=sr-Latn-BA -Dtests.timezone=Chile/Continental\r\n./gradlew :x-pack:plugin:security:test -Dtests.seed=22E2031847F1522 -Dtests.class=org.elasticsearch.xpack.security.transport.ssl.SslMultiPortTests -Dtests.method=\"testThatTransportClientWithOnlyTruststoreCannotConnectToDefaultProfile\" -Dtests.security.manager=true -Dtests.locale=sr-Latn-BA -Dtests.timezone=Chile/Continental\r\n./gradlew :x-pack:plugin:security:test -Dtests.seed=22E2031847F1522 -Dtests.class=org.elasticsearch.xpack.security.transport.ssl.SslMultiPortTests -Dtests.method=\"testThatTransportClientWithOnlyTruststoreCannotConnectToDefaultProfile\" -Dtests.security.manager=true -Dtests.locale=sr-Latn-BA -Dtests.timezone=Chile/Continental\r\n./gradlew :x-pack:plugin:security:test -Dtests.seed=22E2031847F1522 -Dtests.class=org.elasticsearch.xpack.security.authc.esnative.NativeRealmIntegTests -Dtests.method=\"testAddUserAndRoleThenAuth\" -Dtests.security.manager=true -Dtests.locale=el-CY -Dtests.timezone=Africa/Algiers\r\n./gradlew :x-pack:plugin:security:test -Dtests.seed=22E2031847F1522 -Dtests.class=org.elasticsearch.xpack.security.authz.IndexAliasesTests -Dtests.method=\"testGetAliasesCreateOnlyPermissionStrict\" -Dtests.security.manager=true -Dtests.locale=ru-RU -Dtests.timezone=Africa/Malabo\r\n./gradlew :x-pack:plugin:security:test -Dtests.seed=22E2031847F1522 -Dtests.class=org.elasticsearch.xpack.security.authz.IndexAliasesTests -Dtests.method=\"testGetAliasesCreateOnlyPermissionStrict\" -Dtests.security.manager=true -Dtests.locale=ru-RU -Dtests.timezone=Africa/Malabo\r\n```\r\n\r\nThere are some exceptions in the log file indicating SSL setup problems, for example:\r\n\r\n```\r\n  1> [2018-05-25T08:17:49,624][WARN ][o.e.x.s.t.n.SecurityNetty4ServerTransport] [node_sc2] exception caught on transport layer [NettyTcpChannel{localAddress=0.0.0.0/0.0.0.0:56147, remoteAddress=/127.0.0.1:51564}], closing connection\r\n  1> io.netty.handler.codec.DecoderException: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 455300000064000000000000000108004d3603010d417574686f72697a6174696f6e2e4261736963206447567a64463931633256794f6e67746347466a617931305a584e304c58426863334e3362334a6b0016696e7465726e616c3a7463702f68616e647368616b6500\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:459) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1359) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:935) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:134) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:545) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:499) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) [netty-common-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_172]\r\n  1> Caused by: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 455300000064000000000000000108004d3603010d417574686f72697a6174696f6e2e4261736963206447567a64463931633256794f6e67746347466a617931305a584e304c58426863334e3362334a6b0016696e7465726e616c3a7463702f68616e647368616b6500\r\n  1> \tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1106) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1162) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \t... 15 more\r\n```\r\n\r\nAlso:\r\n\r\n```\r\n  1> io.netty.handler.codec.DecoderException: javax.net.ssl.SSLHandshakeException: General SSLEngine problem\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:459) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1359) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:935) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:134) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:545) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:499) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) [netty-common-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_172]\r\n  1> Caused by: javax.net.ssl.SSLHandshakeException: General SSLEngine problem\r\n  1> \tat sun.security.ssl.Handshaker.checkThrown(Handshaker.java:1529) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.checkTaskThrown(SSLEngineImpl.java:535) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.readNetRecord(SSLEngineImpl.java:813) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.unwrap(SSLEngineImpl.java:781) ~[?:?]\r\n  1> \tat javax.net.ssl.SSLEngine.unwrap(SSLEngine.java:624) ~[?:1.8.0_172]\r\n  1> \tat io.netty.handler.ssl.SslHandler$SslEngineType$3.unwrap(SslHandler.java:281) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1215) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1127) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1162) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \t... 15 more\r\n  1> Caused by: javax.net.ssl.SSLHandshakeException: General SSLEngine problem\r\n  1> \tat sun.security.ssl.Alerts.getSSLException(Alerts.java:192) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.fatal(SSLEngineImpl.java:1728) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker.fatalSE(Handshaker.java:330) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker.fatalSE(Handshaker.java:322) ~[?:?]\r\n  1> \tat sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1614) ~[?:?]\r\n  1> \tat sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:216) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker.processLoop(Handshaker.java:1052) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker$1.run(Handshaker.java:992) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker$1.run(Handshaker.java:989) ~[?:?]\r\n  1> \tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_172]\r\n  1> \tat sun.security.ssl.Handshaker$DelegatedTask.run(Handshaker.java:1467) ~[?:?]\r\n  1> \tat io.netty.handler.ssl.SslHandler.runDelegatedTasks(SslHandler.java:1364) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1272) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1127) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1162) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \t... 15 more\r\n  1> Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\r\n  1> \tat sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:397) ~[?:?]\r\n  1> \tat sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:302) ~[?:?]\r\n  1> \tat sun.security.validator.Validator.validate(Validator.java:260) ~[?:?]\r\n  1> \tat sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:324) ~[?:?]\r\n  1> \tat sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:281) ~[?:?]\r\n  1> \tat sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:136) ~[?:?]\r\n  1> \tat org.elasticsearch.xpack.core.ssl.SSLService$ReloadableTrustManager.checkServerTrusted(SSLService.java:594) ~[x-pack-core-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1601) ~[?:?]\r\n  1> \tat sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:216) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker.processLoop(Handshaker.java:1052) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker$1.run(Handshaker.java:992) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker$1.run(Handshaker.java:989) ~[?:?]\r\n  1> \tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_172]\r\n  1> \tat sun.security.ssl.Handshaker$DelegatedTask.run(Handshaker.java:1467) ~[?:?]\r\n  1> \tat io.netty.handler.ssl.SslHandler.runDelegatedTasks(SslHandler.java:1364) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1272) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1127) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1162) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \t... 15 more\r\n  1> Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\r\n  1> \tat sun.security.provider.certpath.SunCertPathBuilder.build(SunCertPathBuilder.java:141) ~[?:?]\r\n  1> \tat sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:126) ~[?:?]\r\n  1> \tat java.security.cert.CertPathBuilder.build(CertPathBuilder.java:280) ~[?:1.8.0_172]\r\n  1> \tat sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:392) ~[?:?]\r\n  1> \tat sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:302) ~[?:?]\r\n  1> \tat sun.security.validator.Validator.validate(Validator.java:260) ~[?:?]\r\n  1> \tat sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:324) ~[?:?]\r\n  1> \tat sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:281) ~[?:?]\r\n  1> \tat sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:136) ~[?:?]\r\n  1> \tat org.elasticsearch.xpack.core.ssl.SSLService$ReloadableTrustManager.checkServerTrusted(SSLService.java:594) ~[x-pack-core-6.3.0-SNAPSHOT.jar:6.3.0-SNAPSHOT]\r\n  1> \tat sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1601) ~[?:?]\r\n  1> \tat sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:216) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker.processLoop(Handshaker.java:1052) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker$1.run(Handshaker.java:992) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker$1.run(Handshaker.java:989) ~[?:?]\r\n  1> \tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_172]\r\n  1> \tat sun.security.ssl.Handshaker$DelegatedTask.run(Handshaker.java:1467) ~[?:?]\r\n  1> \tat io.netty.handler.ssl.SslHandler.runDelegatedTasks(SslHandler.java:1364) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1272) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1127) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1162) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \t... 15 more\r\n```\r\n\r\nAnd:\r\n\r\n```\r\n  1> [2018-05-25T08:17:38,683][WARN ][o.e.x.s.t.n.SecurityNetty4ServerTransport] [node_s1] exception caught on transport layer [NettyTcpChannel{localAddress=0.0.0.0/0.0.0.0:30280, remoteAddress=/127.0.0.1:37174}], closing connection\r\n  1> io.netty.handler.codec.DecoderException: javax.net.ssl.SSLHandshakeException: null cert chain\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:459) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1359) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:935) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:134) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:545) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:499) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) [netty-common-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_172]\r\n  1> Caused by: javax.net.ssl.SSLHandshakeException: null cert chain\r\n  1> \tat sun.security.ssl.Handshaker.checkThrown(Handshaker.java:1529) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.checkTaskThrown(SSLEngineImpl.java:535) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.readNetRecord(SSLEngineImpl.java:813) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.unwrap(SSLEngineImpl.java:781) ~[?:?]\r\n  1> \tat javax.net.ssl.SSLEngine.unwrap(SSLEngine.java:624) ~[?:1.8.0_172]\r\n  1> \tat io.netty.handler.ssl.SslHandler$SslEngineType$3.unwrap(SslHandler.java:281) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1215) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1127) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1162) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \t... 15 more\r\n  1> Caused by: javax.net.ssl.SSLHandshakeException: null cert chain\r\n  1> \tat sun.security.ssl.Alerts.getSSLException(Alerts.java:192) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.fatal(SSLEngineImpl.java:1666) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker.fatalSE(Handshaker.java:330) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker.fatalSE(Handshaker.java:318) ~[?:?]\r\n  1> \tat sun.security.ssl.ServerHandshaker.clientCertificate(ServerHandshaker.java:1935) ~[?:?]\r\n  1> \tat sun.security.ssl.ServerHandshaker.processMessage(ServerHandshaker.java:237) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker.processLoop(Handshaker.java:1052) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker$1.run(Handshaker.java:992) ~[?:?]\r\n  1> \tat sun.security.ssl.Handshaker$1.run(Handshaker.java:989) ~[?:?]\r\n  1> \tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_172]\r\n  1> \tat sun.security.ssl.Handshaker$DelegatedTask.run(Handshaker.java:1467) ~[?:?]\r\n  1> \tat io.netty.handler.ssl.SslHandler.runDelegatedTasks(SslHandler.java:1364) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1272) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1127) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1162) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \t... 15 more\r\n  1> [2018-05-25T08:17:38,694][WARN ][o.e.x.c.s.t.n.SecurityNetty4Transport] [programmatic_transport_client] exception caught on transport layer [NettyTcpChannel{localAddress=0.0.0.0/0.0.0.0:37174, remoteAddress=/127.0.0.1:30280}], closing connection\r\n  1> io.netty.handler.codec.DecoderException: javax.net.ssl.SSLException: Received fatal alert: bad_certificate\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:459) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1359) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:935) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:134) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:545) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:499) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) [netty-common-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_172]\r\n  1> Caused by: javax.net.ssl.SSLException: Received fatal alert: bad_certificate\r\n  1> \tat sun.security.ssl.Alerts.getSSLException(Alerts.java:208) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.fatal(SSLEngineImpl.java:1666) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.fatal(SSLEngineImpl.java:1634) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.recvAlert(SSLEngineImpl.java:1800) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.readRecord(SSLEngineImpl.java:1083) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.readNetRecord(SSLEngineImpl.java:907) ~[?:?]\r\n  1> \tat sun.security.ssl.SSLEngineImpl.unwrap(SSLEngineImpl.java:781) ~[?:?]\r\n  1> \tat javax.net.ssl.SSLEngine.unwrap(SSLEngine.java:624) ~[?:1.8.0_172]\r\n  1> \tat io.netty.handler.ssl.SslHandler$SslEngineType$3.unwrap(SslHandler.java:281) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1215) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1127) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1162) ~[netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) ~[netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n  1> \t... 15 more\r\n```","closed_by":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"performed_via_github_app":null}