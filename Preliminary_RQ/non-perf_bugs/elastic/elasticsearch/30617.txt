{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30617","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30617/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30617/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30617/events","html_url":"https://github.com/elastic/elasticsearch/issues/30617","id":323214344,"node_id":"MDU6SXNzdWUzMjMyMTQzNDQ=","number":30617,"title":"cluster.routing.allocation.awareness.attributes setting does not accept an array of values","user":{"login":"abdonpijpelink","id":9715543,"node_id":"MDQ6VXNlcjk3MTU1NDM=","avatar_url":"https://avatars1.githubusercontent.com/u/9715543?v=4","gravatar_id":"","url":"https://api.github.com/users/abdonpijpelink","html_url":"https://github.com/abdonpijpelink","followers_url":"https://api.github.com/users/abdonpijpelink/followers","following_url":"https://api.github.com/users/abdonpijpelink/following{/other_user}","gists_url":"https://api.github.com/users/abdonpijpelink/gists{/gist_id}","starred_url":"https://api.github.com/users/abdonpijpelink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abdonpijpelink/subscriptions","organizations_url":"https://api.github.com/users/abdonpijpelink/orgs","repos_url":"https://api.github.com/users/abdonpijpelink/repos","events_url":"https://api.github.com/users/abdonpijpelink/events{/privacy}","received_events_url":"https://api.github.com/users/abdonpijpelink/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"assignees":[{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-05-15T13:19:18Z","updated_at":"2018-05-16T07:57:23Z","closed_at":"2018-05-16T07:57:23Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Not sure if this is a bug or a \"work as designed\", but I see a lot of students run into issues with this in training, so I figured more folks may have problems with this. We may want to make this a bit more user friendly.\r\n\r\nWhen configuring `cluster.routing.allocation.awareness.attributes` via `_cluster/settings`, the setting does not accept an array of values. If you do provide an array of values, the cluster will end up in a red status when creating a new index.\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n\r\nVersion: 6.2.4, Build: ccec39f/2018-04-12T20:37:28.497551Z, JVM: 1.8.0_77\r\n\r\n**Plugins installed**: []\r\n\r\n_none_\r\n\r\n**JVM version** (`java -version`):\r\n\r\njava version \"1.8.0_77\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_77-b03)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.77-b03, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\nDarwin MacBook-1265.local 17.4.0 Darwin Kernel Version 17.4.0: Sun Dec 17 09:19:54 PST 2017; root:xnu-4570.41.2~1/RELEASE_X86_64 x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nBecause the setting is named \"attributes\", folks expect to be able to provide an array of values for this setting (for example `[\"bar\",\"baz\"]`). However, if you do so, the cluster ends up in a red status when creating a new index. Even when configuring multiple values, these values have to be provided comma-separated as a single string (for example `\"bar,baz\"`).\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Start a one-node cluster and configure the node with: `node.attr.foo: bar`\r\n 2. Get the cluster's health and check the status is green or yellow: `GET _cluster/health`\r\n 3. Apply the following cluster setting:\r\n```\r\nPUT _cluster/settings\r\n{\r\n  \"persistent\": {\r\n    \"cluster.routing.allocation.awareness.attributes\": [\r\n      \"foo\"\r\n    ]\r\n  }\r\n}\r\n```\r\n 4. Create a new index: `PUT my_index`\r\n 5. The cluster status is now red: `GET _cluster/health`\r\n 6. Use `GET _cluster/allocation/explain` to find out why: \r\n```\r\n\"explanation\": \"node does not contain the awareness attribute [[foo]]; required attributes cluster setting [cluster.routing.allocation.awareness.attributes=[foo]]\"\r\n```\r\n 7. Change the cluster setting and provide a string value instead of an array:\r\n```\r\nPUT _cluster/settings\r\n{\r\n  \"persistent\": {\r\n    \"cluster.routing.allocation.awareness.attributes\": \"foo\"\r\n  }\r\n}\r\n```\r\n 8. The cluster is now yellow: `GET _cluster/health`\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\n[2018-05-15T15:07:10,668][INFO ][o.e.c.m.MetaDataCreateIndexService] [rGKXCKp] [my_index] creating index, cause [api], templates [], shards [5]/[1], mappings []\r\n[2018-05-15T15:07:10,672][INFO ][o.e.c.r.a.AllocationService] [rGKXCKp] Cluster health status changed from [YELLOW] to [RED] (reason: [index [my_index] created]).\r\n[2018-05-15T15:08:21,596][DEBUG][o.e.a.a.c.a.TransportClusterAllocationExplainAction] [rGKXCKp] explaining the allocation for [ClusterAllocationExplainRequest[useAnyUnassignedShard=true,includeYesDecisions?=false], found shard [[allblogs_us-en][2], node[null], [R], recovery_source[peer recovery], s[UNASSIGNED], unassigned_info[[reason=CLUSTER_RECOVERED], at[2018-05-15T13:05:26.878Z], delayed=false, allocation_status[no_attempt]]]\r\n[2018-05-15T15:09:51,178][INFO ][o.e.c.s.ClusterSettings  ] [rGKXCKp] updating [cluster.routing.allocation.awareness.attributes] from [[foo]] to [foo]\r\n[2018-05-15T15:09:51,178][INFO ][o.e.c.s.ClusterSettings  ] [rGKXCKp] updating [cluster.routing.allocation.awareness.attributes] from [[foo]] to [foo]\r\n[2018-05-15T15:09:51,246][INFO ][o.e.c.r.a.AllocationService] [rGKXCKp] Cluster health status changed from [RED] to [YELLOW] (reason: [shards started [[my_index][0]] ...]).\r\n```","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}