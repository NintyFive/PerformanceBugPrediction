{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17169","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17169/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17169/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17169/events","html_url":"https://github.com/elastic/elasticsearch/issues/17169","id":141596292,"node_id":"MDU6SXNzdWUxNDE1OTYyOTI=","number":17169,"title":"CI: CancellableTasksTests fails with uncaught exception","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-03-17T14:18:50Z","updated_at":"2016-03-17T18:34:12Z","closed_at":"2016-03-17T18:34:12Z","author_association":"MEMBER","active_lock_reason":null,"body":"Saw this several times in the last 12 hours on the 2.x and 2.3 branch:\n\n```\nSuite: org.elasticsearch.action.admin.cluster.node.tasks.CancellableTasksTests\n  2> mrt 17, 2016 3:53:26 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\n  2> WARNING: Uncaught exception in thread: Thread[elasticsearch[TransportTasksActionTests][generic][T#8],5,TGRP-CancellableTasksTests]\n  2> EsRejectedExecutionException[rejected execution of org.elasticsearch.transport.TransportService$3@2c0ff1dc on EsThreadPoolExecutor[generic, org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor@22c80a2d[Shutting down, pool size = 4, active threads = 4, queued tasks = 0, completed tasks = 62]]]\n  2>    at __randomizedtesting.SeedInfo.seed([D7BCB71B5D341091]:0)\n  2>    at org.elasticsearch.common.util.concurrent.EsAbortPolicy.rejectedExecution(EsAbortPolicy.java:50)\n  2>    at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:823)\n  2>    at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1369)\n  2>    at org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor.execute(EsThreadPoolExecutor.java:85)\n  2>    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:341)\n  2>    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:299)\n  2>    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction.sendRemoveBanRequest(TransportCancelTasksAction.java:205)\n  2>    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction.removeBanOnNodes(TransportCancelTasksAction.java:166)\n  2>    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction.access$000(TransportCancelTasksAction.java:63)\n  2>    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$3.accept(TransportCancelTasksAction.java:130)\n  2>    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$3.accept(TransportCancelTasksAction.java:127)\n  2>    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$BanLock.finish(TransportCancelTasksAction.java:238)\n  2>    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$BanLock.onBanSet(TransportCancelTasksAction.java:226)\n  2>    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$5.handleException(TransportCancelTasksAction.java:187)\n  2>    at org.elasticsearch.transport.TransportService$2.run(TransportService.java:206)\n  2>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n  2>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n  2>    at java.lang.Thread.run(Thread.java:745)\n  2> \n  2> REPRODUCE WITH: mvn test -Pdev -pl org.elasticsearch:elasticsearch -Dtests.seed=D7BCB71B5D341091 -Dtests.class=org.elasticsearch.action.admin.cluster.node.tasks.CancellableTasksTests -Des.logger.level=ERROR -Dtests.assertion.disabled=false -Dtests.security.manager=true -Dtests.heap.size=512m -Dtests.locale=en-US -Dtests.timezone=Etc/UTC\n  2> NOTE: test params are: codec=Asserting(Lucene54): {}, docValues:{}, sim=RandomSimilarity(queryNorm=true,coord=yes): {}, locale=nl-BE, timezone=Asia/Novosibirsk\n  2> NOTE: Linux 3.13.0-74-generic amd64/Oracle Corporation 1.8.0_72-internal (64-bit)/cpus=4,threads=1,free=451774008,total=530579456\n  2> NOTE: All tests run in this JVM: [NullValueObjectMappingTests, IndexSearcherWrapperTests, CompletionFieldMapperTests, VersionLookupTests, CommonTermsQueryParserTests, NamingConventionTests, ScriptContextRegistryTests, NettyTransportTests, TransportModuleTests, MustacheTests, AnalyzerBackwardsCompatTests, FileUtilsTests, TableTests, SettingsValidatorTests, FilterFieldDataTests, ExpectedShardSizeAllocationTests, ClusterStateHealthTests, IndexingMemoryControllerTests, DocumentFieldMapperTests, PluginManagerUnitTests, UniqueTokenFilterTests, SortedSetDVStringFieldDataTests, LuceneTests, TransportClientHeadersTests, DiskThresholdDeciderUnitTests, PrimaryNotRelocatedWhileBeingRecoveredTests, GatewayServiceTests, GeoUtilsTests, KeepTypesFilterFactoryTests, IndicesServiceTests, EsExecutorsTests, RetryTests, FileInfoTests, CustomBoostMappingTests, Base64Tests, TransportTasksActionTests, PreBuiltTokenFilterFactoryFactoryTests, IndexTypeMapperTests, IndexFieldDataServiceTests, PutWarmerRequestTests, PathMapperTests, ReplicaAllocatedAfterPrimaryTests, SourceFieldTypeTests, FilterPathGeneratorFilteringTests, MinScoreScorerTests, JsonXContentTests, UpdateRequestTests, RestApiParserTests, ClusterSerializationTests, ParentQueryTests, ShadowEngineTests, CodecTests, ScriptSortBuilderTests, XContentHelperTests, CompressSourceMappingTests, MetaDataTests, ThrottlingAllocationTests, FilterRoutingTests, StringFieldMapperPositionIncrementGapTests, BlacklistedPathPatternMatcherTests, RecoveriesCollectionTests, MetaStateServiceTests, ConcurrentRecyclerTests, TransportReplicationActionTests, SimpleDateMappingTests, XMoreLikeThisTests, NoisyChannelSpellCheckerTests, DeflateXContentTests, MemoryCircuitBreakerTests, IndexStoreBWCTests, TribeUnitTests, IndexRequestBuilderTests, InternalTestClusterTests, SnowballAnalyzerTests, PreferLocalPrimariesToRelocatingPrimariesTests, ParseDocumentTypeLevelsTests, ProfileTests, CountResponseTests, BinaryFieldTypeTests, StopTokenFilterTests, ZenFaultDetectionTests, BigArraysTests, ParseFieldTests, GeoShapeFieldTypeTests, LongHashTests, ChildrenConstantScoreQueryTests, PlainHighlighterTests, VectorHighlighterTests, LongFieldTypeTests, ClassPermissionTests, DynamicMappingTests, JacksonLocationTests, ShapeBuilderTests, RestAnalyzeActionTests, SeccompTests, BoundTransportAddressTests, SingleObjectCacheTests, CopyOnWriteHashMapTests, SetupSectionParserTests, TimeZoneRoundingTests, GeoPointFieldMapperTests, ScriptParameterParserTests, ProcessProbeTests, StringFieldTypeTests, UpdateThreadPoolSettingsTests, DiskUsageTests, SearchServiceTests, SmileFilteringGeneratorTests, TypeFieldTypeTests, ByteFieldTypeTests, NestedAggregatorTests, SloppyMathTests, NetworkAddressTests, SingleOrdinalsTests, NodeEnvironmentTests, DeadNodesAllocationTests, RoutingServiceTests, HppcMapsTests, NumericAnalyzerTests, IndicesOptionsTests, ZenDiscoveryUnitTests, ShardUtilsTests, DuelFieldDataTests, MergePolicySettingsTests, IndexQueryParserFilterDateRangeTimezoneTests, ThreadPoolSerializationTests, SimpleDynamicTemplatesTests, NetworkUtilsTests, LZFXContentTests, ESDirectoryReaderTests, SyncedFlushUnitTests, StoreTests, PathTests, CheckFileCommandTests, IndexAliasesServiceTests, CompoundAnalysisTests, ReplicaShardAllocatorTests, RefCountedTests, DistanceUnitTests, CustomPassageFormatterTests, CustomPostingsHighlighterTests, ExceptionSerializationTests, OriginalIndicesTests, ClusterHealthResponsesTests, CancellableTasksTests]\nERROR   0.00s J1 | CancellableTasksTests (suite) <<<\n   > Throwable #1: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=1259, name=elasticsearch[TransportTasksActionTests][generic][T#8], state=RUNNABLE, group=TGRP-CancellableTasksTests]\n   > Caused by: EsRejectedExecutionException[rejected execution of org.elasticsearch.transport.TransportService$3@2c0ff1dc on EsThreadPoolExecutor[generic, org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor@22c80a2d[Shutting down, pool size = 4, active threads = 4, queued tasks = 0, completed tasks = 62]]]\n   >    at __randomizedtesting.SeedInfo.seed([D7BCB71B5D341091]:0)\n   >    at org.elasticsearch.common.util.concurrent.EsAbortPolicy.rejectedExecution(EsAbortPolicy.java:50)\n   >    at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:823)\n   >    at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1369)\n   >    at org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor.execute(EsThreadPoolExecutor.java:85)\n   >    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:341)\n   >    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:299)\n   >    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction.sendRemoveBanRequest(TransportCancelTasksAction.java:205)\n   >    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction.removeBanOnNodes(TransportCancelTasksAction.java:166)\n   >    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction.access$000(TransportCancelTasksAction.java:63)\n   >    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$3.accept(TransportCancelTasksAction.java:130)\n   >    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$3.accept(TransportCancelTasksAction.java:127)\n   >    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$BanLock.finish(TransportCancelTasksAction.java:238)\n   >    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$BanLock.onBanSet(TransportCancelTasksAction.java:226)\n   >    at org.elasticsearch.action.admin.cluster.node.tasks.cancel.TransportCancelTasksAction$5.handleException(TransportCancelTasksAction.java:187)\n   >    at org.elasticsearch.transport.TransportService$2.run(TransportService.java:206)\n   >    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n   >    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n   >    at java.lang.Thread.run(Thread.java:745)\nCompleted [345/556 (1!)] on J1 in 0.36s, 2 tests, 1 error <<< FAILURES!\n```\n\nThis is from: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+2.3+multijob-os-compatibility/os=ubuntu/4/ \n\nbut it also happened earlier on 2.x, e.g.\n\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+2.x+periodic/96/\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+2.x+multijob-os-compatibility/os=fedora/42/\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+2.x+multijob-os-compatibility/os=ubuntu/42/\n\nI wasn't able to reproduce the failure locally yet. \n@imotov, @nik9000 is this something you could take a look at?\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}