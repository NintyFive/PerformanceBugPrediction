{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22117","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22117/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22117/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22117/events","html_url":"https://github.com/elastic/elasticsearch/issues/22117","id":194984414,"node_id":"MDU6SXNzdWUxOTQ5ODQ0MTQ=","number":22117,"title":"Ingest Node's grok can't set the same field from two patterns","user":{"login":"tsg","id":101817,"node_id":"MDQ6VXNlcjEwMTgxNw==","avatar_url":"https://avatars1.githubusercontent.com/u/101817?v=4","gravatar_id":"","url":"https://api.github.com/users/tsg","html_url":"https://github.com/tsg","followers_url":"https://api.github.com/users/tsg/followers","following_url":"https://api.github.com/users/tsg/following{/other_user}","gists_url":"https://api.github.com/users/tsg/gists{/gist_id}","starred_url":"https://api.github.com/users/tsg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsg/subscriptions","organizations_url":"https://api.github.com/users/tsg/orgs","repos_url":"https://api.github.com/users/tsg/repos","events_url":"https://api.github.com/users/tsg/events{/privacy}","received_events_url":"https://api.github.com/users/tsg/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"assignees":[{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2016-12-12T14:14:42Z","updated_at":"2018-01-18T23:48:06Z","closed_at":"2016-12-13T21:19:55Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.0.1\r\n\r\n**Plugins installed**: ingest-node-geoip, ingest-node-ua\r\n\r\n**JVM version**: 1.8\r\n\r\n**OS version**: macOS sierra\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nSee the following Ingest node simulate API call:\r\n\r\n```\r\nPOST _ingest/pipeline/_simulate\r\n{\r\n  \"pipeline\": {\r\n    \"description\": \"Pipeline for parsing MySQL slow logs.\",\r\n    \"processors\": [\r\n      {\r\n        \"grok\": {\r\n          \"field\": \"message\",\r\n          \"patterns\": [\r\n            \"%{DATA:mysql.error.timestamp} %{NUMBER:mysql.error.id} \\\\[%{DATA:mysql.error.level}\\\\] %{GREEDYDATA:mysql.error.message}\",\r\n            \"%{LOCALDATETIME:mysql.error.timestamp} %{DATA:mysql.error.name} %{GREEDYDATA:mysql.error.message}\"\r\n          ],\r\n          \"ignore_missing\": true,\r\n          \"pattern_definitions\": {\r\n            \"LOCALDATETIME\": \"[0-9]+ %{TIME}\"\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"docs\": [\r\n    {\r\n      \"_source\": {\r\n        \"message\": \"161209 13:08:33 mysqld_safe Starting mysqld daemon with databases from /usr/local/var/mysql\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nThere are two Grok patterns, and the provided doc should match the second one. This works fine, but the `mysql.error.message` is not created. If I rename it to `mysql.error.message1` in either of the two grok patterns, it works.\r\n\r\nA workaround I found is to define another grok pattern definition for GREEDYDATA, like this:\r\n\r\n```\r\nPOST _ingest/pipeline/_simulate\r\n{\r\n  \"pipeline\": {\r\n    \"description\": \"Pipeline for parsing MySQL slow logs.\",\r\n    \"processors\": [\r\n      {\r\n        \"grok\": {\r\n          \"field\": \"message\",\r\n          \"patterns\": [\r\n            \"%{DATA:mysql.error.timestamp} %{NUMBER:mysql.error.id} \\\\[%{DATA:mysql.error.level}\\\\] %{GREEDYDATA:mysql.error.message}\",\r\n            \"%{LOCALDATETIME:mysql.error.timestamp} %{DATA:mysql.error.name} %{GREEDYDATA1:mysql.error.message}\"\r\n          ],\r\n          \"ignore_missing\": true,\r\n          \"pattern_definitions\": {\r\n            \"LOCALDATETIME\": \"[0-9]+ %{TIME}\",\r\n            \"GREEDYDATA1\": \".*\"\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"docs\": [\r\n    {\r\n      \"_source\": {\r\n        \"message\": \"161209 13:08:33 mysqld_safe Starting mysqld daemon with databases from /usr/local/var/mysql\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}