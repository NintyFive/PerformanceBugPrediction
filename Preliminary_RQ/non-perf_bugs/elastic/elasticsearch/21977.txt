{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21977","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21977/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21977/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21977/events","html_url":"https://github.com/elastic/elasticsearch/issues/21977","id":193537721,"node_id":"MDU6SXNzdWUxOTM1Mzc3MjE=","number":21977,"title":"ip type returns garbage when queried as field","user":{"login":"burnstreet","id":13131442,"node_id":"MDQ6VXNlcjEzMTMxNDQy","avatar_url":"https://avatars2.githubusercontent.com/u/13131442?v=4","gravatar_id":"","url":"https://api.github.com/users/burnstreet","html_url":"https://github.com/burnstreet","followers_url":"https://api.github.com/users/burnstreet/followers","following_url":"https://api.github.com/users/burnstreet/following{/other_user}","gists_url":"https://api.github.com/users/burnstreet/gists{/gist_id}","starred_url":"https://api.github.com/users/burnstreet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burnstreet/subscriptions","organizations_url":"https://api.github.com/users/burnstreet/orgs","repos_url":"https://api.github.com/users/burnstreet/repos","events_url":"https://api.github.com/users/burnstreet/events{/privacy}","received_events_url":"https://api.github.com/users/burnstreet/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-12-05T16:02:52Z","updated_at":"2016-12-07T09:32:11Z","closed_at":"2016-12-07T09:32:11Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.0.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: openjdk version \"1.8.0_111\"\r\nOpenJDK Runtime Environment (build 1.8.0_111-8u111-b14-2ubuntu0.16.04.2-b14)\r\nOpenJDK 64-Bit Server VM (build 25.111-b14, mixed mode)\r\n\r\n**OS version**: Ubuntu 16.04  4.4.0-31-generic #50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nwhen querying for a field that is mapped as IP type, the result value is unicode garbage. \r\n\r\n**Steps to reproduce**:\r\n 1. upload mapping \r\nPOST /_template/test \r\n{\r\n    \"mappings\": {\r\n        \"logevent\": {\r\n            \"properties\": {\r\n                \"@fields\": {\r\n                    \"properties\": {\r\n                        \"IP\": {\r\n                            \"type\": \"ip\"\r\n                        }\r\n                    }\r\n                },\r\n                \"@logtype\": {\r\n                    \"index\": \"not_analyzed\",\r\n                    \"type\": \"keyword\"\r\n                },\r\n                \"@timestamp\": {\r\n                    \"format\": \"strict_date_optional_time||epoch_millis\",\r\n                    \"index\": \"not_analyzed\",\r\n                    \"type\": \"date\"\r\n                }\r\n            }\r\n\r\n        }\r\n    },\r\n    \"template\": \"test-bug\"\r\n}\r\n 2. upload doc / create index\r\nPOST /test-bug/logevent/\r\n{\r\n   \"@timestamp\": \"2016-12-05T06:59:41.393Z\",\r\n   \"@fields\": {\r\n       \"IP\": \"70.92.108.189\"\r\n   }\r\n}\r\n 3. query for field\r\nPOST /test-bug/logevent/_search\r\n{\r\n  \"docvalue_fields\" : [\r\n    \"@timestamp\",\r\n\t\"@fields.IP\"\r\n  ]\r\n}\r\n\r\n**Result:**\r\n{\r\n  \"took\": 1,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 1,\r\n    \"successful\": 1,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 1,\r\n    \"max_score\": 1,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"test-bug\",\r\n        \"_type\": \"logevent\",\r\n        \"_id\": \"AVjPswaq8VThoQGWfX4A\",\r\n        \"_score\": 1,\r\n        \"_source\": {\r\n          \"@timestamp\": \"2016-12-05T06:59:41.393Z\",\r\n          \"@fields\": {\r\n            \"IP\": \"70.92.108.189\"\r\n          }\r\n        },\r\n        \"fields\": {\r\n          \"@fields.IP\": [\r\n            **\"\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000��l½\"**\r\n          ],\r\n          \"@timestamp\": [\r\n            1480921181393\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}