{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30273","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30273/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30273/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30273/events","html_url":"https://github.com/elastic/elasticsearch/issues/30273","id":319023869,"node_id":"MDU6SXNzdWUzMTkwMjM4Njk=","number":30273,"title":"Cannot order by Group By aggregation results in SQL","user":{"login":"mustafaakin","id":803763,"node_id":"MDQ6VXNlcjgwMzc2Mw==","avatar_url":"https://avatars3.githubusercontent.com/u/803763?v=4","gravatar_id":"","url":"https://api.github.com/users/mustafaakin","html_url":"https://github.com/mustafaakin","followers_url":"https://api.github.com/users/mustafaakin/followers","following_url":"https://api.github.com/users/mustafaakin/following{/other_user}","gists_url":"https://api.github.com/users/mustafaakin/gists{/gist_id}","starred_url":"https://api.github.com/users/mustafaakin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mustafaakin/subscriptions","organizations_url":"https://api.github.com/users/mustafaakin/orgs","repos_url":"https://api.github.com/users/mustafaakin/repos","events_url":"https://api.github.com/users/mustafaakin/events{/privacy}","received_events_url":"https://api.github.com/users/mustafaakin/received_events","type":"User","site_admin":false},"labels":[{"id":912794284,"node_id":"MDU6TGFiZWw5MTI3OTQyODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/SQL","name":":Query Languages/SQL","color":"0e8a16","default":false,"description":"SQL querying"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"assignees":[{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2018-04-30T20:26:47Z","updated_at":"2018-06-13T14:53:23Z","closed_at":"2018-05-15T20:13:01Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): Version: 7.0.0-alpha1-SNAPSHOT, Build: default/zip/707ba28/2018-04-27T09:12:51.745354Z, JVM: 1.8.0_144\r\n\r\n**Plugins installed**: none\r\n\r\n**JVM version** (`java -version`): java version \"1.8.0_144\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_144-b01)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Darwin MustafaAkin.local 17.4.0 Darwin Kernel Version 17.4.0: Sun Dec 17 09:19:54 PST 2017; root:xnu-4570.41.2~1/RELEASE_X86_64 x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Setup metricbeat (or any data that you can take average + group by)\r\n 2. SELECT avg(x) as val, name FROM index GROUP BY val\r\n 3. See results not ordered\r\n\r\n--- \r\n\r\nFor reference, the query is as follows:\r\n\r\n```\r\nGET _xpack/sql?format=txt\r\n{\r\n    \"query\": \"SELECT avg(system.process.memory.rss.bytes) AS total, system.process.name FROM metricbeat* GROUP BY system.process.name ORDER BY total LIMIT 100\"\r\n}\r\n\r\n       total        |system.process.name\r\n--------------------+-------------------\r\n3.3009664E7         |CalendarAgent      \r\n3.3805892963265306E8|Google Chrome      \r\n2.754828747755102E8 |Google Chrome H    \r\n2.34139648E8        |Slack Helper       \r\n1.3305953523809524E8|Spotify            \r\n8.14535317979798E8  |Spotify Helper     \r\n1.3287424E7         |XprotectService    \r\n3.394526625185185E8 |goland             \r\n1.9761845169230768E8|iTerm2             \r\n1.0084054522828283E9|idea               \r\n1.5776596712727273E9|java               \r\n2.3113728E7         |metricbeat         \r\n2.38579712E8        |node               \r\n1.644544E7          |quicklookd         \r\n6209536.0           |zsh               \r\n``` \r\n\r\n\r\nBut the results is not ordered and it can be seen from translate API as well.\r\n\r\n```\r\n{\r\n  \"size\": 0,\r\n  \"_source\": false,\r\n  \"stored_fields\": \"_none_\",\r\n  \"aggregations\": {\r\n    \"groupby\": {\r\n      \"composite\": {\r\n        \"size\": 100,\r\n        \"sources\": [\r\n          {\r\n            \"123671\": {\r\n              \"terms\": {\r\n                \"field\": \"system.process.name\",\r\n                \"order\": \"asc\"\r\n              }\r\n            }\r\n          }\r\n        ]\r\n      },\r\n      \"aggregations\": {\r\n        \"123838\": {\r\n          \"avg\": {\r\n            \"field\": \"system.process.memory.rss.bytes\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n","closed_by":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}