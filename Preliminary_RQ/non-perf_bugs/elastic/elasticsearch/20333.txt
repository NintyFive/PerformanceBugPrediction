{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20333","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20333/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20333/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20333/events","html_url":"https://github.com/elastic/elasticsearch/issues/20333","id":175184444,"node_id":"MDU6SXNzdWUxNzUxODQ0NDQ=","number":20333,"title":"GeoPolygon Query: Illegal shift value, must be 32..63; got shift=0","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":404463067,"node_id":"MDU6TGFiZWw0MDQ0NjMwNjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.3.5","name":"v2.3.5","color":"dddddd","default":false,"description":null},{"id":342561351,"node_id":"MDU6TGFiZWwzNDI1NjEzNTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.4.0","name":"v2.4.0","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"assignees":[{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2016-09-06T08:05:33Z","updated_at":"2018-03-23T15:26:31Z","closed_at":"2018-03-23T15:26:31Z","author_association":"MEMBER","active_lock_reason":null,"body":"Raised on the Discuss forum: https://discuss.elastic.co/t/geopolygon-query-illegal-shift-value-must-be-32-63-got-shift-0/59850\n\nSteps to reproduce:\n\n```\n#curl -XPUT localhost:9200/test -d '{ \"mappings\" : { \"type1\" : { \"properties\" : { \"location\" : { \"type\" : \"geo_point\" }}}}}'\n{\"acknowledged\":true}\n\n #curl -XPOST localhost:9200/test/type1 -d ' { \"location\": \"52.2, 4.4\" } '\n{\"_index\":\"test\",\"_type\":\"type1\",\"_id\":\"AVb-QdVXXlFHU-ps0fRw\",\"_version\":1,\"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\"created\":true}\n\n#curl localhost:9200/test/type1/_search -d '{ \"query\": { \"geo_polygon\" : { \"location\" : { \"points\": [ \"-7.998047857222268, -71.00120202079853\", \"-7.999647520806379, -70.99417435493683\", \"-8.00600799977009, -70.99701389475712\", \"-7.998047857222268, -71.00120202079853\"] } } } } '\n{\"took\":60,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":4,\"failed\":1,\"failures\":[{\"shard\":4,\"index\":\"test\",\"node\":\"IzpxgmG3T3S29dr-t01Y3Q\",\"reason\":{\"type\":\"illegal_argument_exception\",\"reason\":\"Illegal shift value, must be 32..63; got shift=0\"}}]},\"hits\":{\"total\":0,\"max_score\":null,\"hits\":[]}}\n```\n\nThis is not an issue on master but can be reproduced on 2.3.5 and 2.4.0.\n\nStack trace:\n\n```\nRemoteTransportException[[Erik Killmonger][127.0.0.1:9300][indices:data/read/search[phase/query]]]; nested: QueryPhaseExecutionException[Query Failed [Failed to execute main query]]; nested: IllegalArgumentException[Illegal shift value, must be 32..63; got shift=0];\nCaused by: QueryPhaseExecutionException[Query Failed [Failed to execute main query]]; nested: IllegalArgumentException[Illegal shift value, must be 32..63; got shift=0];\nat org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:409)\nat org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:113)\nat org.elasticsearch.search.SearchService.loadOrExecuteQueryPhase(SearchService.java:366)\nat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:378)\nat org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:368)\nat org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:365)\nat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\nat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\nat org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\nat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\nat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.IllegalArgumentException: Illegal shift value, must be 32..63; got shift=0\nat org.apache.lucene.spatial.util.GeoEncodingUtils.geoCodedToPrefixCodedBytes(GeoEncodingUtils.java:114)\nat org.apache.lucene.spatial.util.GeoEncodingUtils.geoCodedToPrefixCoded(GeoEncodingUtils.java:92)\nat org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum$Range.fillBytesRef(GeoPointPrefixTermsEnum.java:234)\nat org.apache.lucene.spatial.geopoint.search.GeoPointTermsEnum.nextRange(GeoPointTermsEnum.java:71)\nat org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum.nextRange(GeoPointPrefixTermsEnum.java:169)\nat org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum.nextSeekTerm(GeoPointPrefixTermsEnum.java:188)\nat org.apache.lucene.index.FilteredTermsEnum.next(FilteredTermsEnum.java:212)\nat org.apache.lucene.spatial.geopoint.search.GeoPointTermQueryConstantScoreWrapper$1.scorer(GeoPointTermQueryConstantScoreWrapper.java:103)\nat org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:389)\nat org.apache.lucene.search.Weight.bulkScorer(Weight.java:135)\nat org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:370)\nat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:818)\nat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:535)\nat org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:384)\n... 12 more\n```\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}