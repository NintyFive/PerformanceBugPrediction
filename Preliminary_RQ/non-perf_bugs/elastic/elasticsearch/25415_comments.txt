[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312245881","html_url":"https://github.com/elastic/elasticsearch/issues/25415#issuecomment-312245881","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25415","id":312245881,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjI0NTg4MQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2017-06-30T11:40:45Z","updated_at":"2017-06-30T11:40:45Z","author_association":"CONTRIBUTOR","body":"Given that #25467 was closed as a duplicate of this, I think this test failure is probably due to this issue too: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/3369/console\r\n\r\nThe log contains:\r\n\r\n```\r\n  1> [2017-06-30T13:44:13,802][WARN ][o.e.i.c.IndicesClusterStateService] [node_s0] [[test][0]] marking and sending shard failed due to [failed recovery]\r\n  1> org.elasticsearch.indices.recovery.RecoveryFailedException: [test][0]: Recovery failed from {node_s1}{vZ1YOynsRFyd8glTybKDyQ}{41U494MHT5-rtjThD9JsHg}{127.0.0.1}{127.0.0.1:9601} into {node_s0}{44s7-YEXR22bpT5ZXVfzdw}{GUjuSoRfSH6cDgL05tevTw}{127.0.0.1}{127.0.0.1:9600} (failed to retry recovery)\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveriesCollection.resetRecovery(RecoveriesCollection.java:122) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.retryRecovery(PeerRecoveryTargetService.java:153) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.retryRecovery(PeerRecoveryTargetService.java:149) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:256) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:75) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:616) ~[main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_131]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_131]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_131]\r\n  1> Caused by: java.lang.IllegalStateException: cannot reset recovery as previous attempt made it past finalization step\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveryTarget.resetRecovery(RecoveryTarget.java:216) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveriesCollection.resetRecovery(RecoveriesCollection.java:108) ~[main/:?]\r\n```\r\n\r\nand:\r\n\r\n```\r\n  2> WARNING: Uncaught exception in thread: Thread[elasticsearch[node_s0][generic][T#1],5,TGRP-OpenCloseIndexIT]\r\n  2> java.lang.AssertionError: local checkpoint [-2] for allocation ID [aCk3bTylTs2tN5utGruRzw] violates being at least the global checkpoint [21]\r\n  2> \tat __randomizedtesting.SeedInfo.seed([4ECF08D198E60282]:0)\r\n  2> \tat org.elasticsearch.index.seqno.GlobalCheckpointTracker.updateAllocationIdsFromPrimaryContext(GlobalCheckpointTracker.java:411)\r\n  2> \tat org.elasticsearch.index.seqno.SequenceNumbersService.updateAllocationIdsFromPrimaryContext(SequenceNumbersService.java:186)\r\n  2> \tat org.elasticsearch.index.shard.IndexShard.updateAllocationIdsFromPrimaryContext(IndexShard.java:1707)\r\n  2> \tat org.elasticsearch.indices.recovery.RecoveryTarget.handoffPrimaryContext(RecoveryTarget.java:383)\r\n  2> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$HandoffPrimaryContextRequestHandler.messageReceived(PeerRecoveryTargetService.java:425)\r\n  2> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$HandoffPrimaryContextRequestHandler.messageReceived(PeerRecoveryTargetService.java:420)\r\n  2> \tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30)\r\n  2> \tat org.elasticsearch.transport.AssertingTransportInterceptor$1.messageReceived(AssertingTransportInterceptor.java:76)\r\n  2> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66)\r\n  2> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1525)\r\n  2> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638)\r\n  2> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n  2> \tat java.lang.Thread.run(Thread.java:748)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313792208","html_url":"https://github.com/elastic/elasticsearch/issues/25415#issuecomment-313792208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25415","id":313792208,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzc5MjIwOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T21:02:38Z","updated_at":"2017-07-07T21:02:38Z","author_association":"MEMBER","body":"Closed by #25468","performed_via_github_app":null}]