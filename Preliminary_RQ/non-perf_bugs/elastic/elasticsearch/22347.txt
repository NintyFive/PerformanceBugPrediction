{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22347","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22347/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22347/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22347/events","html_url":"https://github.com/elastic/elasticsearch/issues/22347","id":197527060,"node_id":"MDU6SXNzdWUxOTc1MjcwNjA=","number":22347,"title":"Elasticsearch bulk index failed","user":{"login":"lovelgw","id":24769812,"node_id":"MDQ6VXNlcjI0NzY5ODEy","avatar_url":"https://avatars3.githubusercontent.com/u/24769812?v=4","gravatar_id":"","url":"https://api.github.com/users/lovelgw","html_url":"https://github.com/lovelgw","followers_url":"https://api.github.com/users/lovelgw/followers","following_url":"https://api.github.com/users/lovelgw/following{/other_user}","gists_url":"https://api.github.com/users/lovelgw/gists{/gist_id}","starred_url":"https://api.github.com/users/lovelgw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lovelgw/subscriptions","organizations_url":"https://api.github.com/users/lovelgw/orgs","repos_url":"https://api.github.com/users/lovelgw/repos","events_url":"https://api.github.com/users/lovelgw/events{/privacy}","received_events_url":"https://api.github.com/users/lovelgw/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2016-12-26T02:48:56Z","updated_at":"2017-01-10T14:46:50Z","closed_at":"2017-01-10T14:46:50Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.1.1\r\n\r\n**Plugins installed**:  analysis-seunjeon, elasticsearch-analysis-mecab-ko, x-pack\r\n\r\n**JVM version**: openjdk version \"1.8.0_111\"\r\n\r\n**OS version**: CentOS release 6.8 (Final)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nbulk index fails \r\n\r\n**Steps to reproduce**:\r\n 1. curl -s -XPOST http://127.0.0.1:9200/data/_bulk --data-binary '@test.json'\r\n\r\n**Provide logs (if relevant)**:\r\n[2016-12-26T11:39:54,182][DEBUG][o.e.a.b.TransportShardBulkAction] [NODE_175] [data][4] failed to execute bulk item (index) index {[data][paper][1723759], source[{\"docSeq\":1723759,\"memberSeq\":801362,\"memberId\":\"kstudy\",\"docCategorySeq\":451,\"title\":\"\\uc81c 1 \\ubd80 \\ubab8\\uc9d3 \\uc5b8\\uc5b4\\uc640 \\uae30\\ud638\\ud559 : \\ud55c\\uad6d\\uc778\\uc758 \\uc5b8\\uc5b4 \\uc608\\uc808\\uacfc \\uc2e0\\uccb4 \\uc5b8\\uc5b4 (1 . Body Language and Semiotics : Korean Language - etiquettes and Body - language)\",\"titleNoSpace\":\"\\uc81c1\\ubd80\\ubab8\\uc9d3\\uc5b8\\uc5b4\\uc640\\uae30\\ud638\\ud559:\\ud55c\\uad6d\\uc778\\uc758\\uc5b8\\uc5b4\\uc608\\uc808\\uacfc\\uc2e0\\uccb4\\uc5b8\\uc5b4(1.BodyLanguageandSemiotics:KoreanLanguage-etiquettesandBody-language)\",\"tag\":[\"\\ud55c\\uad6d\\uc778\",\"\\uc5b8\\uc5b4\\uc608\\uc808\",\"\\uc2e0\\uccb4\\uc5b8\\uc5b4\",\"\\uc5b8\\uc5b4\\uc640\\uae30\",\"\\ubd80\\ubab8\\uc9d3\",\"\\ud638\\ud559\\ud55c\\uad6d\",\"\\uc808\\uacfc\\uc2e0\\uccb4\"],\"ext\":\"pdf\",\"price\":6800,\"page\":38,\"ratingPoint\":0,\"contents\":\"\",\"body\":\"  \\ud55c\\uad6d\\uae30\\ud638\\ud559\\ud68c \\uae30\\ud638\\ud559 \\uc5f0\\uad6c \\uc131\\uad11\\uc218(Kwang Su Sung),\\uae40\\uc131\\ub3c4(Sung Do Kim)\",\"sCategory\":2,\"bCategory\":439,\"category\":\"PP105\",\"uploadDate\":1057824810,\"regDate\":1057824810,\"changeDate\":0,\"originalCategory\":\"1057\",\"reference\":\"\",\"knouCourseSeq\":0,\"year\":0,\"knouExaminationSeq\":0,\"grade\":0,\"term\":0,\"courseCode\":0,\"knouDepartmentSeq\":0,\"viewCount\":0,\"scrapCount\":0,\"useMobile\":\"N\",\"knouReportTypeSeq\":0,\"knouReportTypeName\":\"\",\"knouDepartmentName\":\"\",\"knouCourseName\":\"\",\"lessonName\":\"\",\"keyword\":[],\"searchKeyword\":[\"\\uc81c 1 \\ubd80 \\ubab8\\uc9d3 \\uc5b8\\uc5b4\\uc640 \\uae30\\ud638\\ud559 : \\ud55c\\uad6d\\uc778\\uc758 \\uc5b8\\uc5b4 \\uc608\\uc808\\uacfc \\uc2e0\\uccb4 \\uc5b8\\uc5b4\"],\"matchKeyword\":[\"\\uc81c 1 \\ubd80 \\ubab8\\uc9d3 \\uc5b8\\uc5b4\\uc640 \\uae30\\ud638\\ud559 : \\ud55c\\uad6d\\uc778\\uc758 \\uc5b8\\uc5b4 \\uc608\\uc808\\uacfc \\uc2e0\\uccb4 \\uc5b8\\uc5b4\"],\"saleEventStartDate\":0,\"saleEventEndDate\":0,\"discountPercent\":0,\"discountPrice\":0}]}\r\njava.lang.IllegalArgumentException: automaton has cycles\r\n\tat org.apache.lucene.util.automaton.FiniteStringsIterator.next(FiniteStringsIterator.java:121) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.apache.lucene.util.automaton.LimitedFiniteStringsIterator.next(LimitedFiniteStringsIterator.java:69) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.apache.lucene.search.suggest.document.CompletionTokenStream.incrementToken(CompletionTokenStream.java:103) ~[lucene-suggest-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:48:02]\r\n\tat org.apache.lucene.index.DefaultIndexingChain$PerField.invert(DefaultIndexingChain.java:712) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.apache.lucene.index.DefaultIndexingChain.processField(DefaultIndexingChain.java:417) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.apache.lucene.index.DefaultIndexingChain.processDocument(DefaultIndexingChain.java:373) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.apache.lucene.index.DocumentsWriterPerThread.updateDocument(DocumentsWriterPerThread.java:231) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:478) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:1562) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.apache.lucene.index.IndexWriter.addDocument(IndexWriter.java:1307) ~[lucene-core-6.3.0.jar:6.3.0 a66a44513ee8191e25b477372094bfa846450316 - shalin - 2016-11-02 19:47:11]\r\n\tat org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:558) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.index.engine.InternalEngine.innerIndex(InternalEngine.java:520) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:409) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.index(IndexShard.java:556) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.index(IndexShard.java:546) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.index.TransportIndexAction.executeIndexRequestOnPrimary(TransportIndexAction.java:191) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.shardIndexOperation(TransportShardBulkAction.java:348) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.index(TransportShardBulkAction.java:155) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.handleItem(TransportShardBulkAction.java:134) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.onPrimaryShard(TransportShardBulkAction.java:120) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.onPrimaryShard(TransportShardBulkAction.java:73) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportWriteAction.shardOperationOnPrimary(TransportWriteAction.java:75) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportWriteAction.shardOperationOnPrimary(TransportWriteAction.java:48) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:905) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:875) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:113) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.onResponse(TransportReplicationAction.java:323) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.onResponse(TransportReplicationAction.java:258) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$1.onResponse(TransportReplicationAction.java:855) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$1.onResponse(TransportReplicationAction.java:852) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.index.shard.IndexShardOperationsLock.acquire(IndexShardOperationsLock.java:142) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationLock(IndexShard.java:1655) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.acquirePrimaryShardReference(TransportReplicationAction.java:864) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.access$400(TransportReplicationAction.java:90) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.doRun(TransportReplicationAction.java:275) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:254) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:246) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.lambda$messageReceived$1(SecurityServerTransportInterceptor.java:208) ~[x-pack-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:255) [x-pack-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:577) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:527) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_111]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_111]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_111]\r\n\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}