[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148658997","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148658997","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148658997,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODY1ODk5Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T08:57:46Z","updated_at":"2015-10-16T08:57:46Z","author_association":"CONTRIBUTOR","body":"`CLUSTER_RECOVERED` means that the shard was marked as unassigned when you started your cluster.  All shards start off like this.\n\nYou can use the `explain` parameter to a reroute command to get explanations of why your shards are unassigned.  In this case, you have disabled allocation.\n\nCheck your cluster settings.  You need to reenable allocation.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148799777","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148799777","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148799777,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODc5OTc3Nw==","user":{"login":"davidvgalbraith","id":2757844,"node_id":"MDQ6VXNlcjI3NTc4NDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/2757844?v=4","gravatar_id":"","url":"https://api.github.com/users/davidvgalbraith","html_url":"https://github.com/davidvgalbraith","followers_url":"https://api.github.com/users/davidvgalbraith/followers","following_url":"https://api.github.com/users/davidvgalbraith/following{/other_user}","gists_url":"https://api.github.com/users/davidvgalbraith/gists{/gist_id}","starred_url":"https://api.github.com/users/davidvgalbraith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidvgalbraith/subscriptions","organizations_url":"https://api.github.com/users/davidvgalbraith/orgs","repos_url":"https://api.github.com/users/davidvgalbraith/repos","events_url":"https://api.github.com/users/davidvgalbraith/events{/privacy}","received_events_url":"https://api.github.com/users/davidvgalbraith/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T18:37:27Z","updated_at":"2015-10-16T18:38:06Z","author_association":"CONTRIBUTOR","body":"That's a brave little theory, but it doesn't seem to be accurate. I did\n\n```\nroot@staging-llnw-de0:~$ curl -XPUT 'localhost:9200/_cluster/settings' -d '{\n  \"persistent\": {\n    \"cluster.routing.allocation.enable\": \"all\"\n  }\n}'\n```\n\nand checked the settings had made it with\n\n```\nroot@staging-llnw-de0:~$ curl localhost:9200/_cluster/settings\n{\"persistent\":{\"cluster\":{\"routing\":{\"allocation\":{\"enable\":\"all\"}}}},\"transient\":{}}\n```\n\nand checked the health again like so:\n\n```\nroot@staging-llnw-de0:/opt/jut# curl localhost:9200/_cluster/health?pretty\n{\n  \"cluster_name\" : \"campfire.production.local\",\n  \"status\" : \"red\",\n  \"timed_out\" : false,\n  \"number_of_nodes\" : 2,\n  \"number_of_data_nodes\" : 2,\n  \"active_primary_shards\" : 214,\n  \"active_shards\" : 214,\n  \"relocating_shards\" : 0,\n  \"initializing_shards\" : 0,\n  \"unassigned_shards\" : 18,\n  \"delayed_unassigned_shards\" : 0,\n  \"number_of_pending_tasks\" : 0,\n  \"number_of_in_flight_fetch\" : 0\n}\n```\n\nI then restarted Elasticsearch on both nodes, and the health stayed the same. Did I run the wrong command to enable allocation? Is there another possible cause of these unassigned shards?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148805340","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148805340","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148805340,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODgwNTM0MA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T18:51:19Z","updated_at":"2015-10-16T18:51:19Z","author_association":"CONTRIBUTOR","body":"can you run `GET /_cluster/reroute?explain=true` and paste the output? Can you actually tell if the shards that are not allocated exist on disk? like you have 2 nodes, do the nodes have a copy of that shard in their data dir? Can you also for the time being set logging level for `gateway` to `trace`?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148806642","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148806642","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148806642,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODgwNjY0Mg==","user":{"login":"davidvgalbraith","id":2757844,"node_id":"MDQ6VXNlcjI3NTc4NDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/2757844?v=4","gravatar_id":"","url":"https://api.github.com/users/davidvgalbraith","html_url":"https://github.com/davidvgalbraith","followers_url":"https://api.github.com/users/davidvgalbraith/followers","following_url":"https://api.github.com/users/davidvgalbraith/following{/other_user}","gists_url":"https://api.github.com/users/davidvgalbraith/gists{/gist_id}","starred_url":"https://api.github.com/users/davidvgalbraith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidvgalbraith/subscriptions","organizations_url":"https://api.github.com/users/davidvgalbraith/orgs","repos_url":"https://api.github.com/users/davidvgalbraith/repos","events_url":"https://api.github.com/users/davidvgalbraith/events{/privacy}","received_events_url":"https://api.github.com/users/davidvgalbraith/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T18:57:01Z","updated_at":"2015-10-16T18:57:01Z","author_association":"CONTRIBUTOR","body":"```\nroot@staging-llnw-de0:/opt/jut# curl localhost:9200/_cluster/reroute?explain=true\n{\"error\":\"ElasticsearchIllegalArgumentException[No feature for name [reroute]]\",\"status\":400}\n```\n\nDoesn't seem like GET on _cluster/reroute is a real API, I did a POST there in OP and pasted a relevant section of the 2.5 MB of output I got.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148810904","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148810904","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148810904,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODgxMDkwNA==","user":{"login":"davidvgalbraith","id":2757844,"node_id":"MDQ6VXNlcjI3NTc4NDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/2757844?v=4","gravatar_id":"","url":"https://api.github.com/users/davidvgalbraith","html_url":"https://github.com/davidvgalbraith","followers_url":"https://api.github.com/users/davidvgalbraith/followers","following_url":"https://api.github.com/users/davidvgalbraith/following{/other_user}","gists_url":"https://api.github.com/users/davidvgalbraith/gists{/gist_id}","starred_url":"https://api.github.com/users/davidvgalbraith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidvgalbraith/subscriptions","organizations_url":"https://api.github.com/users/davidvgalbraith/orgs","repos_url":"https://api.github.com/users/davidvgalbraith/repos","events_url":"https://api.github.com/users/davidvgalbraith/events{/privacy}","received_events_url":"https://api.github.com/users/davidvgalbraith/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T19:17:36Z","updated_at":"2015-10-16T19:17:36Z","author_association":"CONTRIBUTOR","body":"The shards are in fact missing from my data dir! What happened to my data?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148811174","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148811174","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148811174,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODgxMTE3NA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T19:19:00Z","updated_at":"2015-10-16T19:19:00Z","author_association":"CONTRIBUTOR","body":"ok so lemme ask you some more questions? Did you delete those indices by any chance and some shards didn't get deleted so we \"re-imported\" it on the restart? do you use multiple data paths by any chance? can you see some mentions of dangling indices in the logs?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148812663","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148812663","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148812663,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODgxMjY2Mw==","user":{"login":"davidvgalbraith","id":2757844,"node_id":"MDQ6VXNlcjI3NTc4NDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/2757844?v=4","gravatar_id":"","url":"https://api.github.com/users/davidvgalbraith","html_url":"https://github.com/davidvgalbraith","followers_url":"https://api.github.com/users/davidvgalbraith/followers","following_url":"https://api.github.com/users/davidvgalbraith/following{/other_user}","gists_url":"https://api.github.com/users/davidvgalbraith/gists{/gist_id}","starred_url":"https://api.github.com/users/davidvgalbraith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidvgalbraith/subscriptions","organizations_url":"https://api.github.com/users/davidvgalbraith/orgs","repos_url":"https://api.github.com/users/davidvgalbraith/repos","events_url":"https://api.github.com/users/davidvgalbraith/events{/privacy}","received_events_url":"https://api.github.com/users/davidvgalbraith/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T19:26:45Z","updated_at":"2015-10-16T19:26:45Z","author_association":"CONTRIBUTOR","body":"Ok so I have an index per day and a retention policy to keep the last 90 days, so the only time I delete indices is after their 90 days are up. Accordingly my indices go back to July 18, and I have the shards from July 18-30, then from July 31 to August 6 I'm missing shards, and from August 7 to today I have the shards again. There's no scenario in my application where I'd delete intermediate indices without deleting all the older indices too. What do you mean by multiple data paths? What would dangling indices look like in the logs? `grep -i dangl elasticsearch.log` returned no lines.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148815365","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148815365","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148815365,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODgxNTM2NQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T19:37:01Z","updated_at":"2015-10-16T19:37:01Z","author_association":"CONTRIBUTOR","body":"very hard to tell what's going on here.. do you have anything else in the logs that can help me to figure this out?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148822583","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148822583","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148822583,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODgyMjU4Mw==","user":{"login":"davidvgalbraith","id":2757844,"node_id":"MDQ6VXNlcjI3NTc4NDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/2757844?v=4","gravatar_id":"","url":"https://api.github.com/users/davidvgalbraith","html_url":"https://github.com/davidvgalbraith","followers_url":"https://api.github.com/users/davidvgalbraith/followers","following_url":"https://api.github.com/users/davidvgalbraith/following{/other_user}","gists_url":"https://api.github.com/users/davidvgalbraith/gists{/gist_id}","starred_url":"https://api.github.com/users/davidvgalbraith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidvgalbraith/subscriptions","organizations_url":"https://api.github.com/users/davidvgalbraith/orgs","repos_url":"https://api.github.com/users/davidvgalbraith/repos","events_url":"https://api.github.com/users/davidvgalbraith/events{/privacy}","received_events_url":"https://api.github.com/users/davidvgalbraith/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T20:14:10Z","updated_at":"2015-10-17T00:58:15Z","author_association":"CONTRIBUTOR","body":"I turned on TRACE level logging for gateway and shard recovery. Here's what I find when I search for an index name whose shards got assigned successfully:\n\n```\nroot@staging-llnw-de0:/opt/jut# grep events-jut_internal@2015.08.07 elasticsearch.log\n[2015-09-29 19:42:45,275][DEBUG][action.admin.indices.stats] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][1], node[j0qBnp6BSWmi8sEh9NCP4A], [P], s[STARTED]: failed to execute [org.elasticsearch.action.admin.indices.stats.IndicesStatsRequest@291f2e34]\n[2015-10-16 20:08:29,538][DEBUG][index.gateway            ] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][0] starting recovery from local ...\n[2015-10-16 20:08:29,539][TRACE][index.gateway.local      ] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][0] using existing shard data, translog id [1439439522375]\n[2015-10-16 20:08:29,539][TRACE][index.gateway.local      ] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][0] try recover from translog file translog-1439439522375 locations: [/mnt/elasticsearch/campfire.production.local/nodes/0/indices/events-jut_internal@2015.08.07/0/translog]\n[2015-10-16 20:08:29,539][TRACE][index.gateway.local      ] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][0] Translog file found in /mnt/elasticsearch/campfire.production.local/nodes/0/indices/events-jut_internal@2015.08.07/0/translog - renaming\n[2015-10-16 20:08:29,539][TRACE][index.gateway.local      ] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][0] Renamed translog from translog-1439439522375 to translog-1439439522375.recovering\n[2015-10-16 20:08:29,549][TRACE][index.gateway.local      ] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][0] recovering translog file: /mnt/elasticsearch/campfire.production.local/nodes/0/indices/events-jut_internal@2015.08.07/0/translog/translog-1439439522375.recovering length: 17\n[2015-10-16 20:08:29,550][TRACE][index.gateway.local      ] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][0] ignoring translog EOF exception, the last operation was not properly written\n[2015-10-16 20:08:29,552][TRACE][index.gateway            ] [node-e0c6f82d-5da6-4815-a6ed-0de785125481] [events-jut_internal@2015.08.07][0] recovery completed from local, took [13ms]\n```\n\nAnd here's what I find when I search for one whose shards did not get assigned:\n\n```\nroot@staging-llnw-de0:/opt/jut# grep events-jut_internal@2015.08.06 elasticsearch.log\nroot@staging-llnw-de0:/opt/jut#\n```\n\ni.e. nothing! So the gateway recovery never even thinks about my index whose shards didn't get assigned. Maybe that's something to go on?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148823134","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-148823134","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":148823134,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODgyMzEzNA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-10-16T20:17:07Z","updated_at":"2015-10-16T20:17:07Z","author_association":"CONTRIBUTOR","body":"man I don't know where your indices went.. I will talk to others if they can think of a bug that could have caused that...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/176035960","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-176035960","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":176035960,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NjAzNTk2MA==","user":{"login":"virHappy","id":1531360,"node_id":"MDQ6VXNlcjE1MzEzNjA=","avatar_url":"https://avatars0.githubusercontent.com/u/1531360?v=4","gravatar_id":"","url":"https://api.github.com/users/virHappy","html_url":"https://github.com/virHappy","followers_url":"https://api.github.com/users/virHappy/followers","following_url":"https://api.github.com/users/virHappy/following{/other_user}","gists_url":"https://api.github.com/users/virHappy/gists{/gist_id}","starred_url":"https://api.github.com/users/virHappy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/virHappy/subscriptions","organizations_url":"https://api.github.com/users/virHappy/orgs","repos_url":"https://api.github.com/users/virHappy/repos","events_url":"https://api.github.com/users/virHappy/events{/privacy}","received_events_url":"https://api.github.com/users/virHappy/received_events","type":"User","site_admin":false},"created_at":"2016-01-28T07:39:17Z","updated_at":"2016-01-28T07:39:17Z","author_association":"NONE","body":"so what is going on?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/176040957","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-176040957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":176040957,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NjA0MDk1Nw==","user":{"login":"davidvgalbraith","id":2757844,"node_id":"MDQ6VXNlcjI3NTc4NDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/2757844?v=4","gravatar_id":"","url":"https://api.github.com/users/davidvgalbraith","html_url":"https://github.com/davidvgalbraith","followers_url":"https://api.github.com/users/davidvgalbraith/followers","following_url":"https://api.github.com/users/davidvgalbraith/following{/other_user}","gists_url":"https://api.github.com/users/davidvgalbraith/gists{/gist_id}","starred_url":"https://api.github.com/users/davidvgalbraith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidvgalbraith/subscriptions","organizations_url":"https://api.github.com/users/davidvgalbraith/orgs","repos_url":"https://api.github.com/users/davidvgalbraith/repos","events_url":"https://api.github.com/users/davidvgalbraith/events{/privacy}","received_events_url":"https://api.github.com/users/davidvgalbraith/received_events","type":"User","site_admin":false},"created_at":"2016-01-28T07:53:11Z","updated_at":"2016-01-28T07:53:11Z","author_association":"CONTRIBUTOR","body":"Hey @virHappy! We never found out what happened here. I hope you haven't lost data too.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/177008974","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-177008974","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":177008974,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NzAwODk3NA==","user":{"login":"ksou1","id":16965871,"node_id":"MDQ6VXNlcjE2OTY1ODcx","avatar_url":"https://avatars3.githubusercontent.com/u/16965871?v=4","gravatar_id":"","url":"https://api.github.com/users/ksou1","html_url":"https://github.com/ksou1","followers_url":"https://api.github.com/users/ksou1/followers","following_url":"https://api.github.com/users/ksou1/following{/other_user}","gists_url":"https://api.github.com/users/ksou1/gists{/gist_id}","starred_url":"https://api.github.com/users/ksou1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ksou1/subscriptions","organizations_url":"https://api.github.com/users/ksou1/orgs","repos_url":"https://api.github.com/users/ksou1/repos","events_url":"https://api.github.com/users/ksou1/events{/privacy}","received_events_url":"https://api.github.com/users/ksou1/received_events","type":"User","site_admin":false},"created_at":"2016-01-29T22:57:12Z","updated_at":"2016-01-29T22:57:12Z","author_association":"NONE","body":"Hi @davidvgalbraith. I'm experiencing the same issue as we speak. Have a 3 node cluster (1 dedicated master, 2 master/data nodes, set for a primary and 1 replica shard). Set \"cluster.routing.allocation.enable\" to \"none\", restarted my nodes (dedicated master 1st). All 3 nodes joined cluster properly (status yellow), so I set \"cluster.routing.allocation.enable\" to \"all\".  However, I'm sitting here 1 hour later and all of my \"replica\" shards are still unassigned. And.. all of my primary shards are assigned to the master/data node that happened to join the cluster first. Reroute?explain shows \"CLUSTER RECOVERED\" as reason, just as in your case. Will give it a while but I think next time I'll leave routing enabled and live with the thrashing that happens upon cluster start. While I really like ES and what it can do, its difficult to really rely on it with all of the \"glitches\". \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/177601746","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-177601746","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":177601746,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NzYwMTc0Ng==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-01-31T20:26:15Z","updated_at":"2016-01-31T20:26:15Z","author_association":"MEMBER","body":"@ksou1 which ES version are you using?  Also, I'm a bit confused the \"CLUSTER RECOVERED\" output of reroute. Can you gist the exact output?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/177602035","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-177602035","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":177602035,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NzYwMjAzNQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-01-31T20:28:47Z","updated_at":"2016-01-31T20:28:47Z","author_association":"MEMBER","body":"scratch the last comment about `Cluster recovered`, re reading the ticket I get what you refer to (the unassigned_info part). Based on your ES version we'll see how to proceed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/177986120","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-177986120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":177986120,"node_id":"MDEyOklzc3VlQ29tbWVudDE3Nzk4NjEyMA==","user":{"login":"ksou1","id":16965871,"node_id":"MDQ6VXNlcjE2OTY1ODcx","avatar_url":"https://avatars3.githubusercontent.com/u/16965871?v=4","gravatar_id":"","url":"https://api.github.com/users/ksou1","html_url":"https://github.com/ksou1","followers_url":"https://api.github.com/users/ksou1/followers","following_url":"https://api.github.com/users/ksou1/following{/other_user}","gists_url":"https://api.github.com/users/ksou1/gists{/gist_id}","starred_url":"https://api.github.com/users/ksou1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ksou1/subscriptions","organizations_url":"https://api.github.com/users/ksou1/orgs","repos_url":"https://api.github.com/users/ksou1/repos","events_url":"https://api.github.com/users/ksou1/events{/privacy}","received_events_url":"https://api.github.com/users/ksou1/received_events","type":"User","site_admin":false},"created_at":"2016-02-01T14:06:09Z","updated_at":"2016-02-01T14:06:09Z","author_association":"NONE","body":"Hi @bleskes . ES version is 1.7.2. Replicated shards finally started to allocate about 8 hours after the cluster restart. I have an index deletion script that runs at 1am every morn (to delete indexes 31 days old) and it prints a view of all indexes after the deletions. I noticed in the output that only 7 of the 218 indexes had gone to \"green\" status even at that point. The rest were in \"yellow\" status. So... after restarting the cluster at 5pm, only 7 indexes had their replica shards allocated by 1am (8 hours). By 9am the next morning, all replica's were allocated. We will be upgrading to ES 2.1.1 in the next few weeks. Keeping my fingers crossed that we dont see this delay again.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/178558460","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-178558460","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":178558460,"node_id":"MDEyOklzc3VlQ29tbWVudDE3ODU1ODQ2MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-02-02T12:53:43Z","updated_at":"2016-02-02T12:53:43Z","author_association":"MEMBER","body":"@ksou1 thanks. During the period the cluster was yellow - do you know the replicas were initializing (i.e., recovering) or were they unassigned?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/178612237","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-178612237","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":178612237,"node_id":"MDEyOklzc3VlQ29tbWVudDE3ODYxMjIzNw==","user":{"login":"ksou1","id":16965871,"node_id":"MDQ6VXNlcjE2OTY1ODcx","avatar_url":"https://avatars3.githubusercontent.com/u/16965871?v=4","gravatar_id":"","url":"https://api.github.com/users/ksou1","html_url":"https://github.com/ksou1","followers_url":"https://api.github.com/users/ksou1/followers","following_url":"https://api.github.com/users/ksou1/following{/other_user}","gists_url":"https://api.github.com/users/ksou1/gists{/gist_id}","starred_url":"https://api.github.com/users/ksou1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ksou1/subscriptions","organizations_url":"https://api.github.com/users/ksou1/orgs","repos_url":"https://api.github.com/users/ksou1/repos","events_url":"https://api.github.com/users/ksou1/events{/privacy}","received_events_url":"https://api.github.com/users/ksou1/received_events","type":"User","site_admin":false},"created_at":"2016-02-02T14:52:05Z","updated_at":"2016-02-02T14:52:05Z","author_association":"NONE","body":"Up until the time the replicas started to allocate to the second data node, they were unassigned. There were 1086 active_primary_shards, and 1086 unassigned_shards (the replicas). There were 0 initializing_shards and, strangely, 0 delayed_unassigned_shards. Cluster health also showed 0 pending_tasks and 0 in_flight_fetch. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/178630645","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-178630645","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":178630645,"node_id":"MDEyOklzc3VlQ29tbWVudDE3ODYzMDY0NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-02-02T15:23:01Z","updated_at":"2016-02-02T15:23:01Z","author_association":"MEMBER","body":"I see. Do you happen to have a cluster health response ? I'm curious to see what the `number_of_in_flight_fetch` field had to say...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/178699651","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-178699651","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":178699651,"node_id":"MDEyOklzc3VlQ29tbWVudDE3ODY5OTY1MQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-02-02T17:24:37Z","updated_at":"2016-02-02T17:24:37Z","author_association":"MEMBER","body":"@ksou1 not sure whether you edited your comment or I just totally missed the fact that there are 0 in_flght_fetch. I this case my best guess is that you've hit https://github.com/elastic/elasticsearch/pull/14494  and something happened later on triggering another reroute..\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202928046","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-202928046","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":202928046,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjkyODA0Ng==","user":{"login":"jessabe","id":4947705,"node_id":"MDQ6VXNlcjQ5NDc3MDU=","avatar_url":"https://avatars0.githubusercontent.com/u/4947705?v=4","gravatar_id":"","url":"https://api.github.com/users/jessabe","html_url":"https://github.com/jessabe","followers_url":"https://api.github.com/users/jessabe/followers","following_url":"https://api.github.com/users/jessabe/following{/other_user}","gists_url":"https://api.github.com/users/jessabe/gists{/gist_id}","starred_url":"https://api.github.com/users/jessabe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jessabe/subscriptions","organizations_url":"https://api.github.com/users/jessabe/orgs","repos_url":"https://api.github.com/users/jessabe/repos","events_url":"https://api.github.com/users/jessabe/events{/privacy}","received_events_url":"https://api.github.com/users/jessabe/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T14:39:26Z","updated_at":"2016-03-29T14:39:26Z","author_association":"NONE","body":"@davidvgalbraith having a similar issue here as well. I'm guessing this has resulted in lost data and you've moved on, or? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202976962","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-202976962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":202976962,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjk3Njk2Mg==","user":{"login":"davidvgalbraith","id":2757844,"node_id":"MDQ6VXNlcjI3NTc4NDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/2757844?v=4","gravatar_id":"","url":"https://api.github.com/users/davidvgalbraith","html_url":"https://github.com/davidvgalbraith","followers_url":"https://api.github.com/users/davidvgalbraith/followers","following_url":"https://api.github.com/users/davidvgalbraith/following{/other_user}","gists_url":"https://api.github.com/users/davidvgalbraith/gists{/gist_id}","starred_url":"https://api.github.com/users/davidvgalbraith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidvgalbraith/subscriptions","organizations_url":"https://api.github.com/users/davidvgalbraith/orgs","repos_url":"https://api.github.com/users/davidvgalbraith/repos","events_url":"https://api.github.com/users/davidvgalbraith/events{/privacy}","received_events_url":"https://api.github.com/users/davidvgalbraith/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T16:06:52Z","updated_at":"2016-03-29T16:06:52Z","author_association":"CONTRIBUTOR","body":"That's right, @jessabe! Never figured out what exactly happened or what we should have done differently =\\\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203059220","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-203059220","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":203059220,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzA1OTIyMA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T19:15:41Z","updated_at":"2016-03-29T19:15:41Z","author_association":"MEMBER","body":"@jessabe you may have the same issue (whatever it is) but it may also be different . If you give us more details we can evaluate - these are important matters.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203139288","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-203139288","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":203139288,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzEzOTI4OA==","user":{"login":"maziyarpanahi","id":5762953,"node_id":"MDQ6VXNlcjU3NjI5NTM=","avatar_url":"https://avatars3.githubusercontent.com/u/5762953?v=4","gravatar_id":"","url":"https://api.github.com/users/maziyarpanahi","html_url":"https://github.com/maziyarpanahi","followers_url":"https://api.github.com/users/maziyarpanahi/followers","following_url":"https://api.github.com/users/maziyarpanahi/following{/other_user}","gists_url":"https://api.github.com/users/maziyarpanahi/gists{/gist_id}","starred_url":"https://api.github.com/users/maziyarpanahi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maziyarpanahi/subscriptions","organizations_url":"https://api.github.com/users/maziyarpanahi/orgs","repos_url":"https://api.github.com/users/maziyarpanahi/repos","events_url":"https://api.github.com/users/maziyarpanahi/events{/privacy}","received_events_url":"https://api.github.com/users/maziyarpanahi/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T22:30:42Z","updated_at":"2016-03-29T22:33:39Z","author_association":"NONE","body":"Hello,\n\nMine is the latest ES 2.2.1 and I did my upgrade while back when it came out so I am certain it has nothing to do with my upgrade. All the members are the same config and the same version and being restarted multiple times after upgrade. \nThis time I did restart each as a rollback cause I updated my elasticsearch.yml (adding repo.path which now is too late!) and 3 indexes has one unassigned shard (all the primary shards) each.\n\n```\n\"details\": \"engine failure, reason [corrupt file (source: [flush])], failure FlushFailedEngineException[Flush failed]; nested: CorruptIndexException[verification failed : calculated=p4rbbd stored=1yztcit (resource=VerifyingIndexInput(NIOFSIndexInput(path=\\\"/data/iscpif-es/nodes/0/indices/scientific/3/index/_f75.cfs\\\")))];\n```\n\nThese machines are KVM VM. I am not sure whether this is ext4 corruption and I should do fsck or a bug some where in Lucene/ES.\nps: these indexes are all static so no more index/update just query. It can't be corrupted by not flushing or unexpected shutdown, I'm guessing though!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/231291281","html_url":"https://github.com/elastic/elasticsearch/issues/14149#issuecomment-231291281","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14149","id":231291281,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMTI5MTI4MQ==","user":{"login":"nathan-zhu","id":1650457,"node_id":"MDQ6VXNlcjE2NTA0NTc=","avatar_url":"https://avatars3.githubusercontent.com/u/1650457?v=4","gravatar_id":"","url":"https://api.github.com/users/nathan-zhu","html_url":"https://github.com/nathan-zhu","followers_url":"https://api.github.com/users/nathan-zhu/followers","following_url":"https://api.github.com/users/nathan-zhu/following{/other_user}","gists_url":"https://api.github.com/users/nathan-zhu/gists{/gist_id}","starred_url":"https://api.github.com/users/nathan-zhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nathan-zhu/subscriptions","organizations_url":"https://api.github.com/users/nathan-zhu/orgs","repos_url":"https://api.github.com/users/nathan-zhu/repos","events_url":"https://api.github.com/users/nathan-zhu/events{/privacy}","received_events_url":"https://api.github.com/users/nathan-zhu/received_events","type":"User","site_admin":false},"created_at":"2016-07-08T07:11:48Z","updated_at":"2016-07-08T07:12:33Z","author_association":"NONE","body":"@davidvgalbraith i got same problem on ES 2.3 in docker, the issue is here #19323 it said i don't have enough disk space for allocation to reroute, not sure this will help something. https://www.elastic.co/guide/en/elasticsearch/reference/current/disk-allocator.html\n","performed_via_github_app":null}]