[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606119404","html_url":"https://github.com/elastic/elasticsearch/issues/54444#issuecomment-606119404","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54444","id":606119404,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjExOTQwNA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-03-30T16:57:48Z","updated_at":"2020-03-30T16:57:48Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606207354","html_url":"https://github.com/elastic/elasticsearch/issues/54444#issuecomment-606207354","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54444","id":606207354,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjIwNzM1NA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-03-30T19:46:27Z","updated_at":"2020-03-30T19:46:27Z","author_association":"CONTRIBUTOR","body":"There are two parts to this:\r\n\r\n1. What happens if the required cardinalities are missing?\r\n2. What happens if the required cardinalities are supplied but are zero?\r\n\r\nI will fix this as follows:\r\n\r\n```\r\nPOST _ml/anomaly_detectors/_estimate_model_memory\r\n{\r\n  \"analysis_config\": {\r\n    \"bucket_span\" : \"5m\",\r\n    \"detectors\" : [\r\n      {\r\n        \"function\" : \"sum\",\r\n        \"field_name\": \"cookies_eaten\",\r\n        \"by_field_name\": \"cookie_type\",\r\n        \"partition_field_name\": \"muppet\"\r\n      }\r\n    ]\r\n  },\r\n  \"overall_cardinality\": {\r\n    \"foo\": 0\r\n  }\r\n}\r\n```\r\n\r\nwill return:\r\n\r\n```\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"illegal_argument_exception\",\r\n        \"reason\" : \"[Overall] cardinality estimate required for [partition_field_name] [muppet] but not supplied\"\r\n      }\r\n    ],\r\n    \"type\" : \"illegal_argument_exception\",\r\n    \"reason\" : \"[Overall] cardinality estimate required for [partition_field_name] [muppet] but not supplied\"\r\n  },\r\n  \"status\" : 400\r\n}\r\n```\r\n\r\nbecause it doesn't supply the required cardinalities.\r\n\r\nBut:\r\n\r\n```\r\nPOST _ml/anomaly_detectors/_estimate_model_memory\r\n{\r\n  \"analysis_config\": {\r\n    \"bucket_span\" : \"5m\",\r\n    \"detectors\" : [\r\n      {\r\n        \"function\" : \"sum\",\r\n        \"field_name\": \"cookies_eaten\",\r\n        \"by_field_name\": \"cookie_type\",\r\n        \"partition_field_name\": \"muppet\"\r\n      }\r\n    ]\r\n  },\r\n  \"overall_cardinality\": {\r\n    \"cookie_type\": 0,\r\n    \"muppet\": 0\r\n  }\r\n}\r\n```\r\n\r\nwill return:\r\n\r\n```\r\n{\r\n  \"model_memory_estimate\" : \"10mb\"\r\n}\r\n```\r\n\r\nbecause it does supply the required cardinalities, but they are both zero (implying that the job will have no work to do so causing the base estimate of 10MB to be returned).","performed_via_github_app":null}]