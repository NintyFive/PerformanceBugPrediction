[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/648740513","html_url":"https://github.com/elastic/elasticsearch/issues/58482#issuecomment-648740513","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58482","id":648740513,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODc0MDUxMw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-06-24T10:35:04Z","updated_at":"2020-06-24T10:35:04Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/652861845","html_url":"https://github.com/elastic/elasticsearch/issues/58482#issuecomment-652861845","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58482","id":652861845,"node_id":"MDEyOklzc3VlQ29tbWVudDY1Mjg2MTg0NQ==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2020-07-02T08:19:48Z","updated_at":"2020-07-02T08:19:48Z","author_association":"CONTRIBUTOR","body":"We have discussed this issue and decided to improve the log message. For the permanent fix we follow up on #55267.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/718507717","html_url":"https://github.com/elastic/elasticsearch/issues/58482#issuecomment-718507717","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58482","id":718507717,"node_id":"MDEyOklzc3VlQ29tbWVudDcxODUwNzcxNw==","user":{"login":"kunisen","id":30574753,"node_id":"MDQ6VXNlcjMwNTc0NzUz","avatar_url":"https://avatars2.githubusercontent.com/u/30574753?v=4","gravatar_id":"","url":"https://api.github.com/users/kunisen","html_url":"https://github.com/kunisen","followers_url":"https://api.github.com/users/kunisen/followers","following_url":"https://api.github.com/users/kunisen/following{/other_user}","gists_url":"https://api.github.com/users/kunisen/gists{/gist_id}","starred_url":"https://api.github.com/users/kunisen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kunisen/subscriptions","organizations_url":"https://api.github.com/users/kunisen/orgs","repos_url":"https://api.github.com/users/kunisen/repos","events_url":"https://api.github.com/users/kunisen/events{/privacy}","received_events_url":"https://api.github.com/users/kunisen/received_events","type":"User","site_admin":false},"created_at":"2020-10-29T09:04:36Z","updated_at":"2020-10-29T09:04:36Z","author_association":"NONE","body":"Maybe we should also consider the ILM behavior.\r\nAfter reindex, we will get `.ml-state` which has `rollover_alias` to be `.ml-state-write`.\r\nBut we will also have an auto created `.ml-state-000001` which has the same `rollover_alias`.\r\nThus it could cause confliction and the previous index `.ml-state` (which we did via reindex), will report ILM error:\r\n\r\n```\r\n{\r\n  \"indices\" : {\r\n    \".ml-state\" : {\r\n      \"index\" : \".ml-state\",\r\n      \"managed\" : true,\r\n      \"policy\" : \"ml-size-based-ilm-policy\",\r\n      \"lifecycle_date_millis\" : 1603784027940,\r\n      \"age\" : \"2.06d\",\r\n      \"phase\" : \"hot\",\r\n      \"phase_time_millis\" : 1603960894945,\r\n      \"action\" : \"rollover\",\r\n      \"action_time_millis\" : 1603784495507,\r\n      \"step\" : \"ERROR\",\r\n      \"step_time_millis\" : 1603961494945,\r\n      \"failed_step\" : \"check-rollover-ready\",\r\n      \"is_auto_retryable_error\" : true,\r\n      \"failed_step_retry_count\" : 147,\r\n      \"step_info\" : {\r\n        \"type\" : \"illegal_argument_exception\",\r\n        \"reason\" : \"index.lifecycle.rollover_alias [.ml-state-write] does not point to index [.ml-state]\",\r\n        \"stack_trace\" : \"\"\"java.lang.IllegalArgumentException: index.lifecycle.rollover_alias [.ml-state-write] does not point to index [.ml-state]\r\n\tat org.elasticsearch.xpack.core.ilm.WaitForRolloverReadyStep.evaluateCondition(WaitForRolloverReadyStep.java:114)\r\n\tat org.elasticsearch.xpack.ilm.IndexLifecycleRunner.runPeriodicStep(IndexLifecycleRunner.java:174)\r\n\tat org.elasticsearch.xpack.ilm.IndexLifecycleService.triggerPolicies(IndexLifecycleService.java:329)\r\n\tat org.elasticsearch.xpack.ilm.IndexLifecycleService.triggered(IndexLifecycleService.java:267)\r\n\tat org.elasticsearch.xpack.core.scheduler.SchedulerEngine.notifyListeners(SchedulerEngine.java:183)\r\n\tat org.elasticsearch.xpack.core.scheduler.SchedulerEngine$ActiveSchedule.run(SchedulerEngine.java:211)\r\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)\r\n\tat java.base/java.lang.Thread.run(Thread.java:832)\r\n\"\"\"\r\n```\r\n\r\nTo work around this, we need to release the ILM settings from the index,\r\n\r\n```\r\nPUT .ml-state/_settings\r\n{\r\n  \"index.lifecycle.name\": null,\r\n  \"index.lifecycle.rollover_alias\": null\r\n}\r\n```\r\n\r\nThoughts?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/720381398","html_url":"https://github.com/elastic/elasticsearch/issues/58482#issuecomment-720381398","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58482","id":720381398,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMDM4MTM5OA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-11-02T10:24:42Z","updated_at":"2020-11-02T10:24:42Z","author_association":"CONTRIBUTOR","body":"> After reindex, we will get `.ml-state` which has `rollover_alias` to be `.ml-state-write`.\r\n\r\nYes, you are correct this is a problem.  After deleting the concrete `.ml-state-write` index the advice should be to create the `.ml-state-write` alias against `.ml-state-000001`, not `.ml-state`.  Also, like you say, the `.ml-state` index created for the repair needs to be released from ILM.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/721440261","html_url":"https://github.com/elastic/elasticsearch/issues/58482#issuecomment-721440261","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58482","id":721440261,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMTQ0MDI2MQ==","user":{"login":"kunisen","id":30574753,"node_id":"MDQ6VXNlcjMwNTc0NzUz","avatar_url":"https://avatars2.githubusercontent.com/u/30574753?v=4","gravatar_id":"","url":"https://api.github.com/users/kunisen","html_url":"https://github.com/kunisen","followers_url":"https://api.github.com/users/kunisen/followers","following_url":"https://api.github.com/users/kunisen/following{/other_user}","gists_url":"https://api.github.com/users/kunisen/gists{/gist_id}","starred_url":"https://api.github.com/users/kunisen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kunisen/subscriptions","organizations_url":"https://api.github.com/users/kunisen/orgs","repos_url":"https://api.github.com/users/kunisen/repos","events_url":"https://api.github.com/users/kunisen/events{/privacy}","received_events_url":"https://api.github.com/users/kunisen/received_events","type":"User","site_admin":false},"created_at":"2020-11-04T00:09:25Z","updated_at":"2020-11-04T00:09:25Z","author_association":"NONE","body":"Thanks @droberts195 !! for the comment! all clear now!","performed_via_github_app":null}]