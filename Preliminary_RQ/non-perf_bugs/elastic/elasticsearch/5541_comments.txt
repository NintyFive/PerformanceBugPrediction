[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38662170","html_url":"https://github.com/elastic/elasticsearch/issues/5541#issuecomment-38662170","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5541","id":38662170,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjYyMTcw","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-03-26T09:08:30Z","updated_at":"2014-03-26T09:08:30Z","author_association":"MEMBER","body":"I seems that the type is wrong in your percolate call? You should use the type of the document being percolated instead of the `.percolate` type.\n\nCan you share curl call instead of code samples? This makes it easier to see what your doing. I'm unfamiliar with the api calls / code that you're sharing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38758376","html_url":"https://github.com/elastic/elasticsearch/issues/5541#issuecomment-38758376","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5541","id":38758376,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzU4Mzc2","user":{"login":"Kinghack","id":1154775,"node_id":"MDQ6VXNlcjExNTQ3NzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1154775?v=4","gravatar_id":"","url":"https://api.github.com/users/Kinghack","html_url":"https://github.com/Kinghack","followers_url":"https://api.github.com/users/Kinghack/followers","following_url":"https://api.github.com/users/Kinghack/following{/other_user}","gists_url":"https://api.github.com/users/Kinghack/gists{/gist_id}","starred_url":"https://api.github.com/users/Kinghack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kinghack/subscriptions","organizations_url":"https://api.github.com/users/Kinghack/orgs","repos_url":"https://api.github.com/users/Kinghack/repos","events_url":"https://api.github.com/users/Kinghack/events{/privacy}","received_events_url":"https://api.github.com/users/Kinghack/received_events","type":"User","site_admin":false},"created_at":"2014-03-27T00:51:45Z","updated_at":"2014-03-27T00:51:45Z","author_association":"NONE","body":"Hi, martijnvg, Thanks for reply.\n\nI will try the curl call later.\n\nAnd maybe I could describe our situation more detail first.\n\nWe have an index named _info_ which includes a type name _message_.\n\nAll the content is built into _info_ with type _message_.\n\nNow the subscribe system needs to register query into a new index names _subscribe_  as a type _.percolator_. And this works fine.\n\nWhen we used percolator api, \n\nThe api \n\n`curl -XGET 'localhost:9200/indexname/typeThatDocWouldParsed/_percolate' -d '{\n    \"doc\" : {\n        \"message\" : \"A new bonsai tree in the office\"\n    }\n}'`\n\nThe second parameters I would regard it as _the type that the doc would parsed_. So here we set it as _message_.\n\nBut my question is , how the subscribe index know the type _message_ which includes in index _info_?\n\nIs that means that I should build index manually and set mapping with type _message_ into _subscribe_?\n\nThanks.\n\nAnd I will test curl call today.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38766061","html_url":"https://github.com/elastic/elasticsearch/issues/5541#issuecomment-38766061","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5541","id":38766061,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzY2MDYx","user":{"login":"Kinghack","id":1154775,"node_id":"MDQ6VXNlcjExNTQ3NzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1154775?v=4","gravatar_id":"","url":"https://api.github.com/users/Kinghack","html_url":"https://github.com/Kinghack","followers_url":"https://api.github.com/users/Kinghack/followers","following_url":"https://api.github.com/users/Kinghack/following{/other_user}","gists_url":"https://api.github.com/users/Kinghack/gists{/gist_id}","starred_url":"https://api.github.com/users/Kinghack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kinghack/subscriptions","organizations_url":"https://api.github.com/users/Kinghack/orgs","repos_url":"https://api.github.com/users/Kinghack/repos","events_url":"https://api.github.com/users/Kinghack/events{/privacy}","received_events_url":"https://api.github.com/users/Kinghack/received_events","type":"User","site_admin":false},"created_at":"2014-03-27T03:34:49Z","updated_at":"2014-03-27T03:34:49Z","author_association":"NONE","body":"Hi, I have process the curl call.\n\nFirst, create index:\n\nstep 1:\n`curl -XPUT http://192.168.2.14:9200/\"subscribe\" -d @es_metadata_basic.json`\n\n[es_metadata_basic.json](https://gist.github.com/Kinghack/9799101)\n\nget result: \n\n`{\"acknowledged\":true}`\n\nstep 2:\n\n`curl -XPUT http://192.168.2.14:9200/\"subscribe/Ad/_mapping\" -d @es_metadata_subscribe.json`\n\n[es_metadata_subscribe.json](https://gist.github.com/Kinghack/9799129)\n\nget result:\n\n{\"acknowledged\":true}\n\nstep 3:\n\nregister one query:\n\n`curl -XPOST http://192.168.2.14:9200/\"subscribe/.percolator/1111\" -d @query1.json`\n\n[query1.json](https://gist.github.com/Kinghack/9799283)\n\nget result:\n\n`{\"_index\":\"subscribe\",\"_type\":\".percolator\",\"_id\":\"1111\",\"_version\":1,\"created\":true}`\n\nstep 4:\n\npercolator:\n\n`curl -XPOST http://192.168.2.14:9200/\"subscribe/.percolator/_percolate?percolate_format=ids\" -d @doc1.json`\n\n[doc1.json](https://gist.github.com/Kinghack/9799479)\n\nresult:\n\n`{\"took\":2,\"_shards\":{\"total\":10,\"successful\":10,\"failed\":0},\"total”:1,\"matches\":[\"1111\"]}`\n\nstep 5:\n\nregister another query:\n\n`curl -XPOST http://192.168.2.14:9200/\"subscribe/.percolator/2222\" -d @query2.json`\n\n[query2.json](https://gist.github.com/Kinghack/9799541)\n\nget results:\n\n`{\"_index\":\"subscribe\",\"_type\":\".percolator\",\"_id\":\"2222\",\"_version\":1,\"created\":true}`\n\nstep 6:\n\npercolator:\n\n`curl -XPOST http://192.168.2.14:9200/\"subscribe/.percolator/_percolate?percolate_format=ids\" -d @doc2.json`\n\n[doc2.json](https://gist.github.com/Kinghack/9799563)\n\nresult:\n\n`{\"took\":2,\"_shards\":{\"total\":10,\"successful\":10,\"failed\":0},\"total”:1,\"matches\":[\"1111\"]}`\n\nThere is no 2222 matches. But the same query could work in search api.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/39179794","html_url":"https://github.com/elastic/elasticsearch/issues/5541#issuecomment-39179794","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5541","id":39179794,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTc5Nzk0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-04-01T08:03:09Z","updated_at":"2014-04-01T08:03:09Z","author_association":"MEMBER","body":"I just looked into this. Something isn't right, I would expect the second query to match as well. Not sure what is the cause yet.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40172225","html_url":"https://github.com/elastic/elasticsearch/issues/5541#issuecomment-40172225","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5541","id":40172225,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTcyMjI1","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-04-11T05:36:51Z","updated_at":"2014-04-11T05:36:51Z","author_association":"MEMBER","body":"The issue here is that the percolator api can't resolve the field type in the mapping for field `\\u4ef7\\u683c`, because for the type `.percolator` there is no such configured. What then happens is that ES tries to determine what type a field has and for floating point numbers a double field type is always picked\n\nHowever when indexing percolator query with id `2222`, the field `\\u4ef7\\u683c` can be resolved because it uses query parsing which under the hood uses smart field resolving and tries to find fields in other mappings of other types. The percolate api doesn't use smart field resolving, because the type can be specifically specified. In this case it finds the float field type you have configured. The root cause of the percolate query `2222` not matching is, that for the long field a sub query is generated that only works on a float, but in document being percolate for that particular field a long value is generated. This causes the range query not the match and therefore the entire percolator query doesn't match.  \n\nYou shouldn't use the `.percolator` type in the percolate api, because the mapping for your document being percolated doesn't exist there. Instead you should use the type `Ad` instead. So the last percolate request should look like this instead:\n`curl -XPOST http://192.168.2.14:9200/\"subscribe/Ad/_percolate?percolate_format=ids\" -d @doc2.json`\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/43602013","html_url":"https://github.com/elastic/elasticsearch/issues/5541#issuecomment-43602013","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5541","id":43602013,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjAyMDEz","user":{"login":"Kinghack","id":1154775,"node_id":"MDQ6VXNlcjExNTQ3NzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1154775?v=4","gravatar_id":"","url":"https://api.github.com/users/Kinghack","html_url":"https://github.com/Kinghack","followers_url":"https://api.github.com/users/Kinghack/followers","following_url":"https://api.github.com/users/Kinghack/following{/other_user}","gists_url":"https://api.github.com/users/Kinghack/gists{/gist_id}","starred_url":"https://api.github.com/users/Kinghack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kinghack/subscriptions","organizations_url":"https://api.github.com/users/Kinghack/orgs","repos_url":"https://api.github.com/users/Kinghack/repos","events_url":"https://api.github.com/users/Kinghack/events{/privacy}","received_events_url":"https://api.github.com/users/Kinghack/received_events","type":"User","site_admin":false},"created_at":"2014-05-20T09:03:13Z","updated_at":"2014-05-20T09:03:13Z","author_association":"NONE","body":"Thanks @martijnvg . I just check your kindly and helpful reply.\nI would look into this issue as you suggested. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68360981","html_url":"https://github.com/elastic/elasticsearch/issues/5541#issuecomment-68360981","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5541","id":68360981,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MzYwOTgx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-30T14:38:08Z","updated_at":"2014-12-30T14:38:08Z","author_association":"CONTRIBUTOR","body":"No more info.  Closing\n","performed_via_github_app":null}]