{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29618","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29618/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29618/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29618/events","html_url":"https://github.com/elastic/elasticsearch/issues/29618","id":315943011,"node_id":"MDU6SXNzdWUzMTU5NDMwMTE=","number":29618,"title":"bulk import unbalanced","user":{"login":"JackFazackerley","id":4931847,"node_id":"MDQ6VXNlcjQ5MzE4NDc=","avatar_url":"https://avatars1.githubusercontent.com/u/4931847?v=4","gravatar_id":"","url":"https://api.github.com/users/JackFazackerley","html_url":"https://github.com/JackFazackerley","followers_url":"https://api.github.com/users/JackFazackerley/followers","following_url":"https://api.github.com/users/JackFazackerley/following{/other_user}","gists_url":"https://api.github.com/users/JackFazackerley/gists{/gist_id}","starred_url":"https://api.github.com/users/JackFazackerley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JackFazackerley/subscriptions","organizations_url":"https://api.github.com/users/JackFazackerley/orgs","repos_url":"https://api.github.com/users/JackFazackerley/repos","events_url":"https://api.github.com/users/JackFazackerley/events{/privacy}","received_events_url":"https://api.github.com/users/JackFazackerley/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-04-19T16:05:07Z","updated_at":"2018-04-19T21:05:23Z","closed_at":"2018-04-19T21:05:23Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 6.2.3\r\n\r\n**JVM version**:\r\nopenjdk version \"1.8.0_162\"\r\nOpenJDK Runtime Environment (build 1.8.0_162-8u162-b12-0ubuntu0.16.04.2-b12)\r\nOpenJDK 64-Bit Server VM (build 25.162-b12, mixed mode\r\n\r\n**OS version**\r\nLinux elasticsearch-6-2-3-client-eu-0 4.13.0-1012-gcp #16-Ubuntu SMP Thu Mar 15 12:00:42 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nThe Instances are running within Google Cloud. Client and data node instances are both on n1-standard-16s (16 cpu and 60GB).\r\n\r\nI'm trying to optimise the indexing rate, which is currently 25k/sec but this needs to be much faster. It seems like one of the possible issues is that one data node is taking on most of the work when bulk importing.\r\n\r\nI bulk import in 10MB pieces and I have tried lowering that all the way to 3MB with no changes. A new connection is created to each client and I round robin between them when importing. I have also tried with a single connection rather than creating a new for each client with no difference.\r\n\r\nThe setup that I have is as follows:\r\nMaster Nodes: Three\r\nClient Nodes: Two\r\nData Nodes: Four\r\n\r\nThe bulk thread pool size is set to 17 on the client and data nodes.\r\n\r\n```\r\nnode_name                       name active queue rejected\r\nelasticsearch-6-2-3-data-eu-1   bulk      1     0        0\r\nelasticsearch-6-2-3-client-eu-1 bulk      0     0        0\r\nelasticsearch-6-2-3-master-eu-2 bulk      0     0        0\r\nelasticsearch-6-2-3-client-eu-0 bulk      0     0        0\r\nelasticsearch-6-2-3-master-eu-0 bulk      0     0        0\r\nelasticsearch-6-2-3-data-eu-3   bulk     17    15        0\r\nelasticsearch-6-2-3-master-eu-1 bulk      0     0        0\r\nelasticsearch-6-2-3-data-eu-2   bulk      1     0        0\r\nelasticsearch-6-2-3-data-eu-0   bulk      0     0        0\r\n```\r\n\r\n![screen shot 2018-04-19 at 16 53 09](https://user-images.githubusercontent.com/4931847/39003158-2c215ce0-43f2-11e8-831c-38fc0f4d8fb0.png)\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}