[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296070500","html_url":"https://github.com/elastic/elasticsearch/issues/24215#issuecomment-296070500","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24215","id":296070500,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjA3MDUwMA==","user":{"login":"vineet01","id":13980705,"node_id":"MDQ6VXNlcjEzOTgwNzA1","avatar_url":"https://avatars2.githubusercontent.com/u/13980705?v=4","gravatar_id":"","url":"https://api.github.com/users/vineet01","html_url":"https://github.com/vineet01","followers_url":"https://api.github.com/users/vineet01/followers","following_url":"https://api.github.com/users/vineet01/following{/other_user}","gists_url":"https://api.github.com/users/vineet01/gists{/gist_id}","starred_url":"https://api.github.com/users/vineet01/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vineet01/subscriptions","organizations_url":"https://api.github.com/users/vineet01/orgs","repos_url":"https://api.github.com/users/vineet01/repos","events_url":"https://api.github.com/users/vineet01/events{/privacy}","received_events_url":"https://api.github.com/users/vineet01/received_events","type":"User","site_admin":false},"created_at":"2017-04-21T05:18:41Z","updated_at":"2017-04-21T05:21:23Z","author_association":"NONE","body":"Another heap dump with a 1 day query in 5.2.2 on a time-series index with 6771187 docs. \r\nNo OOM/GC on the same in 2.3.3.\r\n\r\nhttps://www.dropbox.com/s/xxx5qopk51vhuly/java_pid8504.hprof.bz2?dl=0\r\n\r\nPS: Same worked as expected in 5.2.2 with {\"precision_threshold\":1} without any issues.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296136495","html_url":"https://github.com/elastic/elasticsearch/issues/24215#issuecomment-296136495","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24215","id":296136495,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjEzNjQ5NQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-04-21T09:09:40Z","updated_at":"2017-04-21T09:09:40Z","author_association":"CONTRIBUTOR","body":"This looks like a side-effect of #19215. I don't think there is anything to be fixed here, you are just running a very costly aggregation: the fact that you sort on the value of the cardinality aggregation forces Elasticsearch to compute the cardinality for every bucket. And since we changed the default to be more accurate, this uses more memory than before. I would just recommend that you set the `precision_threshold` to a low value (eg. 100) explicitly.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296139037","html_url":"https://github.com/elastic/elasticsearch/issues/24215#issuecomment-296139037","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24215","id":296139037,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjEzOTAzNw==","user":{"login":"vineet01","id":13980705,"node_id":"MDQ6VXNlcjEzOTgwNzA1","avatar_url":"https://avatars2.githubusercontent.com/u/13980705?v=4","gravatar_id":"","url":"https://api.github.com/users/vineet01","html_url":"https://github.com/vineet01","followers_url":"https://api.github.com/users/vineet01/followers","following_url":"https://api.github.com/users/vineet01/following{/other_user}","gists_url":"https://api.github.com/users/vineet01/gists{/gist_id}","starred_url":"https://api.github.com/users/vineet01/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vineet01/subscriptions","organizations_url":"https://api.github.com/users/vineet01/orgs","repos_url":"https://api.github.com/users/vineet01/repos","events_url":"https://api.github.com/users/vineet01/events{/privacy}","received_events_url":"https://api.github.com/users/vineet01/received_events","type":"User","site_admin":false},"created_at":"2017-04-21T09:18:54Z","updated_at":"2017-04-21T09:23:17Z","author_association":"NONE","body":"As mentioned above, would that also apply to short range queries  (1 day) ?\r\nI get same result on a 1 day query performed on a time-series index (on basis of @timestamp) field.\r\n\r\nEven with {\"precision_threshold\":1}, it only works on small ranges, with multiple visualizations on a dashboard it crashes again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/304600927","html_url":"https://github.com/elastic/elasticsearch/issues/24215#issuecomment-304600927","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24215","id":304600927,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDYwMDkyNw==","user":{"login":"almico","id":15247405,"node_id":"MDQ6VXNlcjE1MjQ3NDA1","avatar_url":"https://avatars2.githubusercontent.com/u/15247405?v=4","gravatar_id":"","url":"https://api.github.com/users/almico","html_url":"https://github.com/almico","followers_url":"https://api.github.com/users/almico/followers","following_url":"https://api.github.com/users/almico/following{/other_user}","gists_url":"https://api.github.com/users/almico/gists{/gist_id}","starred_url":"https://api.github.com/users/almico/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/almico/subscriptions","organizations_url":"https://api.github.com/users/almico/orgs","repos_url":"https://api.github.com/users/almico/repos","events_url":"https://api.github.com/users/almico/events{/privacy}","received_events_url":"https://api.github.com/users/almico/received_events","type":"User","site_admin":false},"created_at":"2017-05-29T08:13:21Z","updated_at":"2017-05-29T08:13:21Z","author_association":"NONE","body":"I think the real issue here is the circuit breaker.\r\nOn a use case I have, Elasticsearch dies after a single cardinality aggregation request.","performed_via_github_app":null}]