[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384133385","html_url":"https://github.com/elastic/elasticsearch/issues/29993#issuecomment-384133385","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993","id":384133385,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMzM4NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-27T12:25:29Z","updated_at":"2018-04-25T01:36:25Z","author_association":"COLLABORATOR","body":"*Original comment by @bleskes:*\n\n@droberts195 can you share more details about the issues that the data feeds cause? The ones I know about (i.e., index creation) don't seem relevant? Also, will the new setting to disable allocation of persistent task help here?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384133386","html_url":"https://github.com/elastic/elasticsearch/issues/29993#issuecomment-384133386","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993","id":384133386,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMzM4Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-27T13:54:24Z","updated_at":"2018-04-25T01:36:25Z","author_association":"COLLABORATOR","body":"*Original comment by @stevedodson:*\n\n++ on investigating this option in the short term - in particular for non-cloud customers who may not read docs... \r\n\r\nCouple of comments:\r\n\r\n- Do we need to check for other index states apart from recovering? Or can we check for index is readable?\r\n- Are there circumstances where indices will say recovering yet be ok? E.g. time based indices where historical indices being rolledup?\r\n ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384133387","html_url":"https://github.com/elastic/elasticsearch/issues/29993#issuecomment-384133387","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993","id":384133387,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMzM4Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-27T14:21:13Z","updated_at":"2018-04-25T01:36:25Z","author_association":"COLLABORATOR","body":"*Original comment by @droberts195:*\n\n@bleskes it's not so much the datafeed causing an issue, but potentially getting incorrect results.\r\n\r\n@pebrc and I were thinking through some situations earlier and one might be restarting a cluster.  In this case the nodes won't all start at exactly the same time.  So suppose the restart is at a point where all the master eligible nodes are running together with some ML nodes but many data nodes aren't.  What would the indices recovery API show for the unavailable indices in that situation?\r\n\r\nOr how about the situation where all the nodes are running but the data nodes are still loading indices from disk?  Would the indices recovery API show `\"type\": \"store\"` in that case?\r\n\r\nMaybe I've misunderstood what the indices recovery API can tell us though.\r\n\r\nMaybe another possibility would be to check for a minimum of yellow status on all the indices that the datafeed wants to search before searching them?  Do you think that would be more appropriate?\r\n\r\n> Also, will the new setting to disable allocation of persistent task help here?\r\n\r\nIt could potentially be the solution for Cloud.  If those scenarios I described could benefit then the startup sequence could be:\r\n\r\n1. Start master eligible nodes\r\n2. Set `cluster.persistent_tasks.allocation.enable: none`\r\n3. Start other cluster nodes\r\n4. Wait for all indices to reload from disk\r\n5. Set `cluster.persistent_tasks.allocation.enable: all`\r\n\r\nWe certainly need that setting for the case of a multiple consecutive restores from snapshot where we don't want tasks to start in between the different parts.  But for some simpler cases it would be nice if datafeeds just protected themselves without changing any settings.  As @stevedodson says, these simpler cases are also likely to affect on-prem customers who won't read the docs.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384133388","html_url":"https://github.com/elastic/elasticsearch/issues/29993#issuecomment-384133388","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993","id":384133388,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMzM4OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-28T15:20:15Z","updated_at":"2018-04-25T01:36:25Z","author_association":"COLLABORATOR","body":"*Original comment by @bleskes:*\n\n> it's not so much the datafeed causing an issue, but potentially getting incorrect results.\r\n\r\nMaybe I'm missing something really obvious, but shouldn't the shards header be something you should check regardless of restarts? this will give you information regarding partial results? It looks like this in JSON land, but the transport is equivalent:\r\n\r\n```\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"skipped\": 0,\r\n    \"failed\": 0\r\n  },\r\n```\r\n\r\nif total is not successful, you're missing data. As of 6.3 we have a [new flag](https://github.com/elastic/elasticsearch/issues/27435) that will cause the search to fail and we're [considering](https://github.com/elastic/elasticsearch/issues/28494) making that the new default. I think this is what you need?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/653638139","html_url":"https://github.com/elastic/elasticsearch/issues/29993#issuecomment-653638139","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993","id":653638139,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzYzODEzOQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-07-03T18:01:06Z","updated_at":"2020-07-03T18:01:06Z","author_association":"CONTRIBUTOR","body":"This issue is old.  For a while we have had functionality that will stop a datafeed being assigned to a node if any of the indices it requires are not active.","performed_via_github_app":null}]