{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24179","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24179/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24179/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24179/events","html_url":"https://github.com/elastic/elasticsearch/issues/24179","id":222691875,"node_id":"MDU6SXNzdWUyMjI2OTE4NzU=","number":24179,"title":"RemoteClusterConnectionTests.testCloseWhileConcurrentlyConnecting sporadically fails","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"labels":[{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":620636309,"node_id":"MDU6TGFiZWw2MjA2MzYzMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.0-alpha2","name":"v6.0.0-alpha2","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2017-04-19T10:29:20Z","updated_at":"2017-06-06T09:00:35Z","closed_at":"2017-05-16T08:02:17Z","author_association":"MEMBER","active_lock_reason":null,"body":"Failure trace ([source](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/2507/console)):\r\n\r\n```\r\nThrowable #1: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=1916, name=elasticsearch[org.elasticsearch.action.search.RemoteClusterConnectionTests][management][T#2], state=RUNNABLE, group=TGRP-RemoteClusterConnectionTests]\r\n   > \tat __randomizedtesting.SeedInfo.seed([45ECFED169707D4D:F4A7F9173C63FBE1]:0)\r\n   > Caused by: java.lang.AssertionError: shit's been called twice\r\n   > \tat __randomizedtesting.SeedInfo.seed([45ECFED169707D4D]:0)\r\n   > \tat org.elasticsearch.action.search.RemoteClusterConnectionTests$4.lambda$run$1(RemoteClusterConnectionTests.java:508)\r\n   > \tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:68)\r\n   > \tat org.elasticsearch.action.ActionListener.onFailure(ActionListener.java:102)\r\n   > \tat org.elasticsearch.action.search.RemoteClusterConnection$ConnectHandler$1.lambda$doRun$1(RemoteClusterConnection.java:347)\r\n   > \tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:68)\r\n   > \tat org.elasticsearch.action.search.RemoteClusterConnection$ConnectHandler$SniffClusterStateResponseHandler.handleResponse(RemoteClusterConnection.java:493)\r\n   > \tat org.elasticsearch.action.search.RemoteClusterConnection$ConnectHandler$SniffClusterStateResponseHandler.handleResponse(RemoteClusterConnection.java:440)\r\n   > \tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1030)\r\n   > \tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1030)\r\n   > \tat org.elasticsearch.transport.TcpTransport$2.doRun(TcpTransport.java:1384)\r\n   > \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638)\r\n   > \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n   > \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n   > \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n   > \tat java.lang.Thread.run(Thread.java:745)\r\n   > Caused by: java.lang.RuntimeException\r\n   > \tat org.elasticsearch.action.search.RemoteClusterConnectionTests$4.lambda$run$1(RemoteClusterConnectionTests.java:505)\r\n   > \tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:68)\r\n   > \tat org.elasticsearch.action.ActionListener.onFailure(ActionListener.java:102)\r\n   > \tat org.elasticsearch.action.search.RemoteClusterConnection$ConnectHandler$1.lambda$doRun$1(RemoteClusterConnection.java:347)\r\n   > \tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:68)\r\n   > \tat org.elasticsearch.action.search.RemoteClusterConnection$ConnectHandler.collectRemoteNodes(RemoteClusterConnection.java:408)\r\n   > \tat org.elasticsearch.action.search.RemoteClusterConnection$ConnectHandler$1.doRun(RemoteClusterConnection.java:352)\r\n  2> NOTE: test params are: codec=Asserting(Lucene70), sim=RandomSimilarity(queryNorm=true): {}, locale=nl-NL, timezone=America/Yakutat\r\n   > \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  2> NOTE: Linux 4.8.6-300.fc25.x86_64 amd64/Oracle Corporation 1.8.0_121 (64-bit)/cpus=4,threads=1,free=408114792,total=529530880\r\n   > \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n   > \tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n   > \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569)\r\n   > \t... 3 more\r\n```\r\n\r\n* Affected branches (based on builds that failed in the past): master, 5.3\r\n* Reproduction: `gradle :core:test -Dtests.seed=45ECFED169707D4D -Dtests.class=org.elasticsearch.action.search.RemoteClusterConnectionTests -Dtests.method=\"testFilterDiscoveredNodes\" -Dtests.security.manager=true -Dtests.locale=nl-NL -Dtests.timezone=America/Yakutat`\r\n* Reproducability: fails roughly once per month in CI; not reproducable locally after 100 iterations (reproduction line + `-Dtests.iters=100`)\r\n\r\nLikely related to #24010\r\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}