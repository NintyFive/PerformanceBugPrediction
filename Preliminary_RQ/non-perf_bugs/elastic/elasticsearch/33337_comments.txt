[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/417966580","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-417966580","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":417966580,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzk2NjU4MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-02T23:14:55Z","updated_at":"2018-09-02T23:14:55Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/417966858","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-417966858","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":417966858,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzk2Njg1OA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-09-02T23:19:54Z","updated_at":"2018-09-02T23:19:54Z","author_association":"MEMBER","body":"I've muted this test on master and 6.x.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422219904","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-422219904","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":422219904,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjIxOTkwNA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T01:08:18Z","updated_at":"2018-09-18T01:08:18Z","author_association":"MEMBER","body":"This test failed because we assigned different terms (1 and 2) to seq=133. This happened in these steps:\r\n\r\n1. The primary of the follower assigns its primary term to operations in TransportBulkShardOperationsAction.\r\n\r\n2. An operation (seq=133) is assigned term=1, indexed to the primary and the replica of the follower. However, this primary is restarted before it can respond to ShardFollowNodeTask.\r\n\r\n3. The replica is promoted, and the old primary recovers operation `{seq=133, term=1}` from the new primary (i.e. old replica) via peer-recovery.\r\n\r\n4. ShardFollowNodeTask does not receive a response, then retries to index the operation(seq=133) to a new primary. The new primary assigns its term (term=2) to operation (seq=133). TransportBulkShardOperationsAction replicates this operation {seq=133,term=2} to the old primary.\r\n\r\n5. The new operation `{seq=133,term=2}` conflicts with the old operation `{seq=133,term=1}` and trip the assertion.\r\n\r\n```\r\njava.lang.AssertionError: seqNo [133] was processed twice in generation [2], \r\nwith different data. \r\n\r\nprvOp [Index{id='CBdenGUBUjHVaMehll6c', type='doc', seqNo=133, primaryTerm=1,\r\n             version=1, autoGeneratedIdTimestamp=-1}], \r\nnewOp [Index{id='CBdenGUBUjHVaMehll6c', type='doc', seqNo=133, primaryTerm=2,\r\n             version=1, autoGeneratedIdTimestamp=-1}]\r\n```\r\n\r\nOne solution I can see is to let ShardFollowNodeTask assign the primary term once before dispatching operations. We can piggyback the current term on the primary in responses (even though we won't have the latest term on ShardFollowNodeTask all the time). @bleskes and @jasontedor WDYT?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422221112","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-422221112","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":422221112,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjIyMTExMg==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T01:15:51Z","updated_at":"2018-09-18T01:15:51Z","author_association":"MEMBER","body":"This still is an issue with the proposal if ShardFollowNodeTask is restarted. Or let's relax the `assertNoSeqNumberConflict`assertion for the following engines?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422727472","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-422727472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":422727472,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjcyNzQ3Mg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T09:32:03Z","updated_at":"2018-09-19T09:32:03Z","author_association":"MEMBER","body":"I think this specific situation will be avoided with rollbacks in place, correct? I did make me think of a deeper problem. I added this as a discussion topic for our next sync.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422824973","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-422824973","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":422824973,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjgyNDk3Mw==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T14:27:16Z","updated_at":"2018-09-19T14:27:16Z","author_association":"MEMBER","body":"> I think this specific situation will be avoided with rollbacks in place, correct?\r\n\r\nNo, as we are testing with 1 replica on both sides.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425964398","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-425964398","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":425964398,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTk2NDM5OA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-10-01T16:05:53Z","updated_at":"2018-10-01T16:05:53Z","author_association":"MEMBER","body":"I've un-muted this test. It should be okay now as the FollowingEngine will skip an operation which was already processed before (see #34099).\r\n\r\nI am closing this issue since @jasontedor is working on a broader fix which covers this issue.\r\n\r\n/cc @martijnvg","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426434198","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-426434198","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":426434198,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjQzNDE5OA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T21:19:25Z","updated_at":"2018-10-02T21:19:25Z","author_association":"MEMBER","body":"We haven't resolved this issue completely. I will mute this test.\r\nCI: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/122/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/434754635","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-434754635","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":434754635,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNDc1NDYzNQ==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-10-31T16:27:27Z","updated_at":"2018-10-31T17:42:27Z","author_association":"CONTRIBUTOR","body":"this failed again for me in a PR CI run\r\n\r\n**link**\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+pull-request/1500/console\r\n\r\n**reproduce**\r\n\r\n```\r\n./gradlew :x-pack:plugin:ccr:internalClusterTest -Dtests.seed=1B26A8E013912DCB -Dtests.class=org.elasticsearch.xpack.ccr.FollowerFailOverIT -Dtests.method=\"testFollowIndexAndCloseNode\" -Dtests.security.manager=true -Dtests.locale=zh-SG -Dtests.timezone=America/Virgin -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n\r\n<details><summary> <b>stacktrace</b> </summary>\r\n\r\n<p>\r\n\r\n```\r\n15:23:32 FAILURE 81.6s J2 | FollowerFailOverIT.testFollowIndexAndCloseNode <<< FAILURES!\r\n15:23:32    > Throwable #1: java.lang.AssertionError: \r\n15:23:32    > Expected: <1224L>\r\n15:23:32    >      but: was <1223L>\r\n15:23:32    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n15:23:32    > \tat org.elasticsearch.xpack.CcrIntegTestCase.lambda$assertSameDocCount$2(CcrIntegTestCase.java:399)\r\n15:23:32    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n15:23:32    > \tat org.elasticsearch.xpack.CcrIntegTestCase.assertSameDocCount(CcrIntegTestCase.java:394)\r\n15:23:32    > \tat org.elasticsearch.xpack.ccr.FollowerFailOverIT.testFollowIndexAndCloseNode(FollowerFailOverIT.java:136)\r\n15:23:32    > \tat java.lang.Thread.run(Thread.java:748)\r\n15:23:32    > \tSuppressed: java.lang.AssertionError: \r\n15:23:32    > Expected: <1224L>\r\n15:23:32    >      but: was <1223L>\r\n15:23:32    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n15:23:32    > \t\tat org.elasticsearch.xpack.CcrIntegTestCase.lambda$assertSameDocCount$2(CcrIntegTestCase.java:399)\r\n15:23:32    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:834)\r\n15:23:32    > \t\t... 39 more\r\n15:23:32    > \tSuppressed: java.lang.AssertionError: \r\n15:23:32    > Expected: <1224L>\r\n15:23:32    >      but: was <1223L>\r\n15:23:32    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n15:23:32    > \t\tat org.elasticsearch.xpack.CcrIntegTestCase.lambda$assertSameDocCount$2(CcrIntegTestCase.java:399)\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\nOH, I take that back, I might be stale. will merge in latest master","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/434794986","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-434794986","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":434794986,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNDc5NDk4Ng==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-10-31T18:19:52Z","updated_at":"2018-10-31T18:19:52Z","author_association":"MEMBER","body":"Sorry for the noise @talevy. I am re-opening this and will look into it soon.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/434802752","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-434802752","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":434802752,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNDgwMjc1Mg==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-10-31T18:43:25Z","updated_at":"2018-10-31T18:43:25Z","author_association":"CONTRIBUTOR","body":"thanks @dnhatn, this branch was working off of master as of yesterday, working off of this time in history, I believe, https://github.com/elastic/elasticsearch/tree/7ef65dedc36735a0e84f482bd9fbc4acab9f7a17","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435334104","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-435334104","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":435334104,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTMzNDEwNA==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T10:21:14Z","updated_at":"2018-11-02T10:21:14Z","author_association":"MEMBER","body":"Another failure in this suite this time on 6.5. The actuals errors look different but may be related so I'm documenting here rather than opening a new issue\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.5+multijob-unix-compatibility/os=ubuntu&&virtual/15/console\r\n\r\nObviously does not reproduce:\r\n```\r\n./gradlew :x-pack:plugin:ccr:internalClusterTest \\\r\n  -Dtests.seed=C69158B9F0EBE031 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.FollowerFailOverIT \\\r\n  -Dtests.method=\"testFailOverOnFollower\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=da-DK \\\r\n  -Dtests.timezone=America/Halifax \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nSome of the errors are:\r\n\r\n```\r\njava.lang.AssertionError: shard [leader-index][0] on node [leaderd3] has pending operations:\r\n --> BulkShardRequest [[leader-index][0]] containing [index {[leader-index][doc][101844], source[{\"f\":101844}]}]\r\n\tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:234)\r\n\tat org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationPermit(IndexShard.java:2327)\r\n\tat\r\n...\r\n```\r\n\r\n```\r\ncom.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=809, name=Thread-80, state=RUNNABLE, group=TGRP-FollowerFailOverIT]\r\nCaused by: [leader-index/byEAeLw0QOW7N0HaS64B4A] IndexNotFoundException[no such index]\r\n\tat __randomizedtesting.SeedInfo.seed([C69158B9F0EBE031]:0)\r\n\tat org.elasticsearch.cluster.routing.RoutingTable.shardRoutingTable(RoutingTable.java:137)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase.primary(TransportReplicationAction.java:795)\r\n...\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435387080","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-435387080","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":435387080,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTM4NzA4MA==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T13:53:32Z","updated_at":"2018-11-02T13:53:32Z","author_association":"MEMBER","body":"Another failure of `testFollowIndexAndCloseNode` this time on master\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/135/console\r\n\r\nDoes not reproduce:\r\n```\r\n./gradlew :x-pack:plugin:ccr:internalClusterTest \\\r\n  -Dtests.seed=C96A71B22CD3BE8B \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.FollowerFailOverIT \\\r\n  -Dtests.method=\"testFollowIndexAndCloseNode\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=de-DE \\\r\n  -Dtests.timezone=America/New_York \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\nThe failed assertion is different to the one in the opening comment\r\n\r\n```\r\nExpected: <1190L>\r\n     but: was <1189L>\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.xpack.CcrIntegTestCase.lambda$assertSameDocCount$2(CcrIntegTestCase.java:399)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:848)\r\n\tat org.elasticsearch.xpack.CcrIntegTestCase.assertSameDocCount(CcrIntegTestCase.java:394)\r\n\tat org.elasticsearch.xpack.ccr.FollowerFailOverIT.testFollowIndexAndCloseNode(FollowerFailOverIT.java:139)\r\n```\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435413506","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-435413506","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":435413506,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTQxMzUwNg==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T15:16:30Z","updated_at":"2018-11-02T15:16:30Z","author_association":"MEMBER","body":"I muted `FollowerFailOverIT.testFollowIndexAndCloseNode` on [master](https://github.com/elastic/elasticsearch/commit/43cff56aecd2877a3be758b3280fd5071f477d02), [6.x](https://github.com/elastic/elasticsearch/commit/e679cf34a5cc75d2ecaaa9779c06786f3ec5a138) and [6.5](https://github.com/elastic/elasticsearch/commit/ff61ee175e143cbed9e93f46ef9461796e5a9c15)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441239700","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-441239700","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":441239700,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTIzOTcwMA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-11-23T13:20:44Z","updated_at":"2018-11-23T13:20:44Z","author_association":"MEMBER","body":"This started to fail again. The latest failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+g1gc/113/console\r\n\r\nThe test checks whether all operations have fully replicated to the follow shards, only for one shard it turns out there no ops:\r\n\r\n```\r\nFAILURE 79.1s J2 | FollowerFailOverIT.testFollowIndexAndCloseNode <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: \r\n   > Expected: <{0=SeqNoStats{maxSeqNo=112, localCheckpoint=112, globalCheckpoint=112}, 1=SeqNoStats{maxSeqNo=118, localCheckpoint=118, globalCheckpoint=118}, 2=SeqNoStats{maxSeqNo=-1, localCheckpoint=-1, globalCheckpoint=-2}}>\r\n   >      but: was <{0=SeqNoStats{maxSeqNo=112, localCheckpoint=112, globalCheckpoint=112}, 1=SeqNoStats{maxSeqNo=118, localCheckpoint=118, globalCheckpoint=118}, 2=SeqNoStats{maxSeqNo=104, localCheckpoint=104, globalCheckpoint=104}}>\r\n```\r\n\r\nAfter a random non master node is stopped in the follower cluster the following warnings do show up in the log:\r\n\r\n```\r\n[2018-11-23T12:06:38,102][WARN ][o.e.x.c.a.b.TransportBulkShardOperationsAction] [followerd2] [[index2][2]] failed to perform indices:data/write/bulk_shard_operat\r\nions[s] on replica [index2][2], node[AHaZkuH5SymTX_zDKdL5Mg], [R], s[STARTED], a[id=EBAwm4tuQ5qNlww6nd75iw]\r\n...\r\n[2018-11-23T12:06:38,108][WARN ][o.e.c.a.s.ShardStateAction] [followerd2] node closed while execution action [internal:cluster/shard/failure] for shard entry [shard id [[index2][2]], allocation id [EBAwm4tuQ5qNlww6nd75iw], primary term [1], message [failed to perform indices:data/write/bulk_shard_operations[s] on replica [index2][2], node[AHaZkuH5SymTX_zDKdL5Mg], [R], s[STARTED], a[id=EBAwm4tuQ5qNlww6nd75iw]], failure [NodeNotConnectedException[[followerd1][127.0.0.1:34629] Node not connected]], markAsStale [true]]\r\n...\r\n[2018-11-23T12:06:38,159][WARN ][o.e.c.r.a.AllocationService] [followerm0] [index2][2] marking unavailable shards as stale: [eYvk9X_aSYC3GkolxpdS0g]\r\n...\r\n[2018-11-23T12:06:38,213][WARN ][o.e.c.r.a.AllocationService] [followerm0] [index2][1] marking unavailable shards as stale: [t8elnSUqR56mlxT6TlWGuA]\r\n```\r\n\r\nI'm trying to understand why these follower shards are marked as stale.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453215806","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-453215806","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":453215806,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzIxNTgwNg==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2019-01-10T19:08:27Z","updated_at":"2019-01-10T19:08:27Z","author_association":"CONTRIBUTOR","body":"This failed today:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+release-tests/317/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453435302","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-453435302","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":453435302,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzQzNTMwMg==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2019-01-11T08:50:57Z","updated_at":"2019-01-11T08:50:57Z","author_association":"CONTRIBUTOR","body":"Failed on intake too: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/1194/console\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453436701","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-453436701","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":453436701,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzQzNjcwMQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-01-11T08:54:56Z","updated_at":"2019-01-11T08:54:56Z","author_association":"MEMBER","body":"This failure is different than before. I'm looking into this now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453443055","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-453443055","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":453443055,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzQ0MzA1NQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-01-11T09:12:17Z","updated_at":"2019-01-11T09:33:55Z","author_association":"MEMBER","body":"~~This looks to be related to a test issue that was fixed in another test: https://github.com/elastic/elasticsearch/issues/35403#issuecomment-443154490~~\r\n\r\n~~I will disable delayed allocation in this test too and close this issue when I don't see any failures on monday.~~\r\n\r\nTurns out this is not because of delayed allocation. No attempt was made to assign a replica shard of the follower index. I'm going to add more information in the logs of this test.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458591211","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-458591211","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":458591211,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODU5MTIxMQ==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2019-01-29T15:48:53Z","updated_at":"2019-01-29T15:50:23Z","author_association":"CONTRIBUTOR","body":"Another one here: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.6+internalClusterTest/70/console\r\n\r\n```\r\n  1> [2019-01-29T14:05:35,830][INFO ][o.e.n.Node               ] [testAddNewReplicasOnFollower] closed\r\n  1> [2019-01-29T14:05:35,826][WARN ][o.e.t.RemoteClusterConnection] [followerm1] fetching nodes from external cluster [leader_cluster] failed\r\n  1> org.elasticsearch.transport.ConnectTransportException: [][127.0.0.1:41543] connect_exception\r\n  1> \tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onFailure(TcpTransport.java:1569) ~[elasticsearch-6.6.0-SNAPSHOT.jar:6.6.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.action.ActionListener.lambda$toBiConsumer$2(ActionListener.java:99) ~[elasticsearch-6.6.0-SNAPSHOT.jar:6.6.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.common.concurrent.CompletableContext.lambda$addListener$0(CompletableContext.java:42) ~[elasticsearch-core-6.6.0-SNAPSHOT.jar:6.6.0-SNAPSHOT]\r\n  1> \tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n  1> \tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n  1> \tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n  1> \tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n  1> \tat org.elasticsearch.common.concurrent.CompletableContext.completeExceptionally(CompletableContext.java:57) ~[elasticsearch-core-6.6.0-SNAPSHOT.jar:6.6.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.MockTcpTransport.lambda$initiateChannel$0(MockTcpTransport.java:195) ~[framework-6.6.0-SNAPSHOT.jar:6.6.0-SNAPSHOT]\r\n  1> \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_202]\r\n  1> \tat java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_202]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_202]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_202]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_202]\r\n  1> Caused by: java.net.ConnectException: Connection refused (Connection refused)\r\n  1> \tat java.net.PlainSocketImpl.socketConnect(Native Method) ~[?:1.8.0_202]\r\n  1> \tat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350) ~[?:1.8.0_202]\r\n  1> \tat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206) ~[?:1.8.0_202]\r\n  1> \tat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188) ~[?:1.8.0_202]\r\n  1> \tat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392) ~[?:1.8.0_202]\r\n  1> \tat java.net.Socket.connect(Socket.java:589) ~[?:1.8.0_202]\r\n  1> \tat org.elasticsearch.mocksocket.MockSocket.access$101(MockSocket.java:32) ~[mocksocket-1.2.jar:?]\r\n  1> \tat org.elasticsearch.mocksocket.MockSocket.lambda$connect$0(MockSocket.java:66) ~[mocksocket-1.2.jar:?]\r\n  1> \tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_202]\r\n  1> \tat org.elasticsearch.mocksocket.MockSocket.connect(MockSocket.java:65) ~[mocksocket-1.2.jar:?]\r\n  1> \tat org.elasticsearch.mocksocket.MockSocket.connect(MockSocket.java:59) ~[mocksocket-1.2.jar:?]\r\n  1> \tat org.elasticsearch.transport.MockTcpTransport.lambda$initiateChannel$0(MockTcpTransport.java:190) ~[framework-6.6.0-SNAPSHOT.jar:6.6.0-SNAPSHOT]\r\n  1> \t... 5 more\r\n```\r\n\r\n```\r\nFAILURE 77.7s J4 | FollowerFailOverIT.testFollowIndexAndCloseNode <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: \r\n   > Expected: <{0=SeqNoStats{maxSeqNo=33, localCheckpoint=33, globalCheckpoint=33}, 1=SeqNoStats{maxSeqNo=42, localCheckpoint=42, globalCheckpoint=42}, 2=SeqNoStats{maxSeqNo=48, localCheckpoint=-1, globalCheckpoint=-2}}>\r\n   >      but: was <{0=SeqNoStats{maxSeqNo=33, localCheckpoint=33, globalCheckpoint=33}, 1=SeqNoStats{maxSeqNo=42, localCheckpoint=42, globalCheckpoint=42}, 2=SeqNoStats{maxSeqNo=48, localCheckpoint=48, globalCheckpoint=48}}>\r\n   > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   > \tat org.elasticsearch.xpack.CcrIntegTestCase.lambda$assertIndexFullyReplicatedToFollower$4(CcrIntegTestCase.java:453)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:848)\r\n   > \tat org.elasticsearch.xpack.CcrIntegTestCase.assertIndexFullyReplicatedToFollower(CcrIntegTestCase.java:438)\r\n   > \tat org.elasticsearch.xpack.ccr.FollowerFailOverIT.testFollowIndexAndCloseNode(FollowerFailOverIT.java:160)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > \tSuppressed: java.lang.AssertionError: \r\n   > Expected: <{0=SeqNoStats{maxSeqNo=31, localCheckpoint=31, globalCheckpoint=31}, 1=SeqNoStats{maxSeqNo=41, localCheckpoint=41, globalCheckpoint=41}, 2=SeqNoStats{maxSeqNo=47, localCheckpoint=-1, globalCheckpoint=-2}}>\r\n   >      but: was <{0=SeqNoStats{maxSeqNo=33, localCheckpoint=33, globalCheckpoint=33}, 1=SeqNoStats{maxSeqNo=42, localCheckpoint=42, globalCheckpoint=42}, 2=SeqNoStats{maxSeqNo=48, localCheckpoint=48, globalCheckpoint=48}}>\r\n   > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   > \t\tat org.elasticsearch.xpack.CcrIntegTestCase.lambda$assertIndexFullyReplicatedToFollower$4(CcrIntegTestCase.java:453)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:836)\r\n   > \t\t... 39 more\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460183213","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-460183213","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":460183213,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDE4MzIxMw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T09:37:25Z","updated_at":"2019-02-04T09:37:25Z","author_association":"MEMBER","body":"This looks like another one today:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+intake/1351/console\r\n\r\n@dnhatn Let me know if I should mute this test again or if you are still looking for more logs.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460384684","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-460384684","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":460384684,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDM4NDY4NA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T19:42:47Z","updated_at":"2019-02-04T19:42:47Z","author_association":"MEMBER","body":"Another one today: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.6+internalClusterTest/528/console\r\n\r\n@dnhatn Can you mute this if you got what you are looking for in the logs?\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460386831","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-460386831","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":460386831,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDM4NjgzMQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T19:48:45Z","updated_at":"2019-02-04T19:48:45Z","author_association":"MEMBER","body":"@cbuescher Thanks for the ping. I'll this test now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460416893","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-460416893","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":460416893,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDQxNjg5Mw==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T21:19:41Z","updated_at":"2019-02-04T21:19:41Z","author_association":"CONTRIBUTOR","body":"I ran into this on one of my PR builds and investigated it a bit. I can reproduce this around 1/50 times. I start the single test method in IntelliJ, with Repeat until failure on.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467763877","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-467763877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":467763877,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzc2Mzg3Nw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T08:07:56Z","updated_at":"2019-02-27T08:07:56Z","author_association":"MEMBER","body":"@dnhatn Can this test be unmuted now? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/468305913","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-468305913","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":468305913,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODMwNTkxMw==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-02-28T15:03:44Z","updated_at":"2019-02-28T15:03:53Z","author_association":"MEMBER","body":"@martijnvg We need to wait for https://github.com/elastic/elasticsearch/issues/39467.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470375151","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-470375151","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":470375151,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDM3NTE1MQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-03-07T03:55:49Z","updated_at":"2019-03-07T03:55:49Z","author_association":"MEMBER","body":"Resolved by #39584","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470375215","html_url":"https://github.com/elastic/elasticsearch/issues/33337#issuecomment-470375215","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33337","id":470375215,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDM3NTIxNQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-03-07T03:56:10Z","updated_at":"2019-03-07T03:56:10Z","author_association":"MEMBER","body":"I have unmuted this test.","performed_via_github_app":null}]