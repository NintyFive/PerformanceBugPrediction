{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/64070","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64070/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64070/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64070/events","html_url":"https://github.com/elastic/elasticsearch/issues/64070","id":727475824,"node_id":"MDU6SXNzdWU3Mjc0NzU4MjQ=","number":64070,"title":"[Transform] transform fails for histogram group_by on unsigned_long","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"assignees":[{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-10-22T15:06:08Z","updated_at":"2020-11-03T09:08:17Z","closed_at":"2020-11-03T09:08:17Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Affected version:** > 7.10\r\n\r\nRepro steps:\r\n\r\n```\r\nPUT test_ul\r\n{\r\n  \"mappings\": {\r\n    \"properties\": {\r\n      \"metric\": {\r\n        \"type\": \"unsigned_long\"\r\n      },\r\n      \"id\": {\r\n        \"type\": \"keyword\"\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST test_ul/_doc/1\r\n{\r\n  \"id\": \"a\",\r\n  \"metric\": 17446744073709551615\r\n}\r\n\r\nPUT _transform/hl2\r\n{\r\n  \"source\": {\r\n    \"index\": \"test_ul\"\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"hl2\"\r\n  },\r\n  \"pivot\": {\r\n    \"group_by\": {\r\n      \"h\": {\r\n        \"histogram\": {\r\n          \"field\": \"metric\",\r\n          \"interval\": 50\r\n        }\r\n      }\r\n    },\r\n    \"aggregations\": {\r\n      \"c\": {\r\n        \"value_count\": {\r\n          \"field\": \"metric\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST _transform/hl2/_start\r\nGET _transform/hl2/_stats\r\n```\r\n\r\nFailure:\r\n\r\n```\r\n\"reason\" : \"Failed to index documents into destination index due to permanent error: [org.elasticsearch.xpack.transform.transforms.BulkIndexingException: Bulk index experienced [1] failures and at least 1 irrecoverable [org.elasticsearch.xpack.transform.transforms.TransformException: Destination index mappings are incompatible with the transform configuration.; org.elasticsearch.index.mapper.MapperParsingException: failed to parse field [h] of type [unsigned_long] in document with id 'Q1R7jWbmN-iLDSNqT1dXVM0AAAAAAAAA'. Preview of field's value: '1.7446744073709552E19'; java.lang.IllegalArgumentException: For input string: [1.7446744073709552E19].]. Other failures:; org.elasticsearch.xpack.transform.transforms.TransformException: Destination index mappings are incompatible with the transform configuration.; org.elasticsearch.index.mapper.MapperParsingException: failed to parse field [h] of type [unsigned_long] in document with id 'Q1R7jWbmN-iLDSNqT1dXVM0AAAAAAAAA'. Preview of field's value: '1.7446744073709552E19'; java.lang.IllegalArgumentException: For input string: [1.7446744073709552E19].]\",\r\n```\r\n\r\nReason: Transform writes `unsigned_long` with floating point for the histogram field `h`, this isn't allowed for `unsigned_long`, it must be a whole number.\r\n\r\n/CC @droberts195 ","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}