[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/85136619","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-85136619","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":85136619,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MTM2NjE5","user":{"login":"mattweber","id":173955,"node_id":"MDQ6VXNlcjE3Mzk1NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mattweber","html_url":"https://github.com/mattweber","followers_url":"https://api.github.com/users/mattweber/followers","following_url":"https://api.github.com/users/mattweber/following{/other_user}","gists_url":"https://api.github.com/users/mattweber/gists{/gist_id}","starred_url":"https://api.github.com/users/mattweber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattweber/subscriptions","organizations_url":"https://api.github.com/users/mattweber/orgs","repos_url":"https://api.github.com/users/mattweber/repos","events_url":"https://api.github.com/users/mattweber/events{/privacy}","received_events_url":"https://api.github.com/users/mattweber/received_events","type":"User","site_admin":false},"created_at":"2015-03-23T18:38:06Z","updated_at":"2015-03-23T18:38:06Z","author_association":"CONTRIBUTOR","body":"+1, In #3278 I perform a terms lookup after parsing but this happened on all shards and resulted in multiple lookup requests for a single query.  This would allow the expensive lookup to be performed once on the coordinating node which would be very beneficial!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88175368","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-88175368","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":88175368,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MTc1MzY4","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-03-31T17:13:59Z","updated_at":"2015-04-29T12:55:47Z","author_association":"MEMBER","body":"Here is our rough plan:\n\nFirst step (everything still happens on the nodes that hold the relevant shards):\n- split existing `QueryParser#parse()` method into 1) `fromXContent()` that parses the query but allows to have an intermediate format for it and 2) `toQuery()` that allows to create the lucene query ouf the intermediate query. Keep the exisiting `Query parse()` method around temporarily, which will call both `fromXContent` and `toQuery`. \n- Move `toQuery` to `QueryBuilder`s so that every query (intermediate format) can be transformed into the corresponding lucene query on each data node.\n- make all the QueryBuilders implement `Streamable` so that the intermediate query format can be sent over the wire between the nodes (will be unused at first)\n\nSecond step (query parsing moved to the coordinating node):\n- Refactor the whole `SearchRequest` so that instead of holding the source bytes array in json format, it holds different elements of a search request, all in `Streamable` format\n- leverage existing request validation mechanism so that `SearchRequest#validate` validates the query too (during `TransportSearchAction#execute`): this is very convenient as it gets called on the coordinating node, no matter where the request comes from (could come as json through rest layer, or as java objects through java api, either transport client or node client).\n- call `fromXContent` on the coordinating node and make use of `Streamable` methods to send queries over the wire\n- delete `parse` method from all QueryBuilders, not needed anymore.\n\nThings we are not too happy about and might need improvement, will be tackled later on:\n- rename QueryBuilders by removing the Builders suffix, as they will not be really just builders anymore\n- java api side of things is heavier on users, since a single class exposes a lot of internal aspects, we might be able to make methods package private\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89041305","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-89041305","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":89041305,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MDQxMzA1","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2015-04-02T20:49:12Z","updated_at":"2015-04-02T20:49:12Z","author_association":"MEMBER","body":"@clintongormley et al,\n\nBecause we are touching every single query in this change, it also gives us the ability to remove support for camel-casing in queries where it exists. How do we feel about removing the camel casing in these PRs as well?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89820357","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-89820357","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":89820357,"node_id":"MDEyOklzc3VlQ29tbWVudDg5ODIwMzU3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T17:52:55Z","updated_at":"2015-04-05T17:52:55Z","author_association":"CONTRIBUTOR","body":"@dakrone ++ - should we be doing this by using parseField and then later using https://github.com/elastic/elasticsearch/issues/8963 to warn about the deprecations?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/94054388","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-94054388","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":94054388,"node_id":"MDEyOklzc3VlQ29tbWVudDk0MDU0Mzg4","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-04-17T19:06:38Z","updated_at":"2015-04-17T19:06:38Z","author_association":"MEMBER","body":"We decided to reset the feature branch to the current tip of master and branch from there starting with #10580.  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137394610","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-137394610","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":137394610,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzM5NDYxMA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-09-03T09:49:22Z","updated_at":"2015-09-03T09:49:22Z","author_association":"MEMBER","body":"I've just updated the description of this issue and added all the other search sections that will need to be refactored, along with queries and aggregations.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239138850","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-239138850","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":239138850,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTEzODg1MA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-08-11T11:46:56Z","updated_at":"2016-08-11T11:46:56Z","author_association":"MEMBER","body":"I had a quick look at what is left to do here and marked `inner_hits` and `sort` done. There are some specific open issues marked `:Search Refactoring`, so I am wondering if we should close this issue. @cbuescher @colings86 Thoughts? What were your plans around alias filters?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239165976","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-239165976","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":239165976,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTE2NTk3Ng==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2016-08-11T13:49:05Z","updated_at":"2016-08-11T13:49:05Z","author_association":"MEMBER","body":"I'm for closing this issue. The few issues which are still open and tagged as `:Search Refactoring` can stand alone as issues and the success of this issue doesn't rely directly on them (though it would be nice to fix those issues. As for the alias filters maybe we can open a separate issue for them too?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239167310","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-239167310","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":239167310,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTE2NzMxMA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-08-11T13:54:02Z","updated_at":"2016-08-11T13:54:02Z","author_association":"MEMBER","body":"+1 on closing and opening a separate issue for the alias filters. Are they part of the SearchSourceBuilder? Just curious what place they have in terms of parsing incoming requests. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239168669","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-239168669","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":239168669,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTE2ODY2OQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2016-08-11T13:58:29Z","updated_at":"2016-08-11T13:58:29Z","author_association":"MEMBER","body":"@cbuescher I think the reason alias filter were on the list was because they are represented by a QueryBuilder object and could be stored as a serialised QueryBuilder rather than JSON. I agree though that it's not directly connected to this issue\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258489958","html_url":"https://github.com/elastic/elasticsearch/issues/10217#issuecomment-258489958","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10217","id":258489958,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODQ4OTk1OA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-11-04T17:05:32Z","updated_at":"2016-11-04T17:05:32Z","author_association":"MEMBER","body":"What was most important to do for alias filters was done with #20916. Each search request against filtered indices was previously sending the filter as a string all the way to the shards, where the actual filter was parsed and converted to lucene query. Now the parsing happens once on the coordinating node, only `toFilter` gets called on each shard to get the corresponding lucene query. We still store alias filters in compressed XContent format as part of the cluster state, but I don't think that is going to change anytime soon. That said we can close this issue, nothing left to be done. Yay!\n","performed_via_github_app":null}]