{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3509","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3509/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3509/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3509/events","html_url":"https://github.com/elastic/elasticsearch/issues/3509","id":18050584,"node_id":"MDU6SXNzdWUxODA1MDU4NA==","number":3509,"title":"Error writing to elasticsearch","user":{"login":"jaloare","id":223852,"node_id":"MDQ6VXNlcjIyMzg1Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/223852?v=4","gravatar_id":"","url":"https://api.github.com/users/jaloare","html_url":"https://github.com/jaloare","followers_url":"https://api.github.com/users/jaloare/followers","following_url":"https://api.github.com/users/jaloare/following{/other_user}","gists_url":"https://api.github.com/users/jaloare/gists{/gist_id}","starred_url":"https://api.github.com/users/jaloare/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaloare/subscriptions","organizations_url":"https://api.github.com/users/jaloare/orgs","repos_url":"https://api.github.com/users/jaloare/repos","events_url":"https://api.github.com/users/jaloare/events{/privacy}","received_events_url":"https://api.github.com/users/jaloare/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"assignees":[{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2013-08-14T12:57:24Z","updated_at":"2013-08-19T13:35:56Z","closed_at":"2013-08-19T13:35:56Z","author_association":"NONE","active_lock_reason":null,"body":"We are currently working with version 1.1.13  installed on ubuntu and elasticsearch version 0.90.2 of working on two-node cluster.\n\nWhen we write some traces with characters such as _é_ or _í_ we find the following error in log file logstash:\n\n> {: Message => \"Error writing to elasticsearch\",: response => # <FTW :: Response: FTW 0x6f229f11 @ headers = HTTP :: Headers :: <{\"content-type\" => \"text / plain; charset = UTF-8 \",\" content-length \"=>\" 70 \"}>, @ body = <FTW :: Connection (@ 4046) @ destinations = [\" xxx.xxx.xxx.xxx: 9200 \"] @ connected = true @ remote_address = \"10.35.167.205\" @ secure = false>, @ status = 400, @ logger = # <Cabin :: Channel: 0x22956f6b @ subscriber_lock = # <Mutex:0xc5eb8a>, @ metrics = # <Cabin :: Metrics: 0x41eab16b @ channel = # <Cabin::Channel:0x22956f6b ...>, @ metrics = {}, @ metrics_lock = # Mutex:0x1726099c>, @ data = {}, @ subscribers = {}, @ level =: info>, @ reason = \"Bad Request\", @ version = 1.1>,: response_body => \"No handler found for uri [/ logstash-2013.08.15/test] and method [GET]\",: level =>: error }\n\nThe elasticsearch log file shows the following error message:\n\n> [2013-08-14 13:53:59,652][DEBUG][action.index             ] [xxx.xxx.xxx.xxx] [logstash-2013.08.15][2], node[kAqv4xJHTB6uyWCmcWKyrw], [P], s[STARTED]: Failed to execute [index {[logstash-2013.08.15][test][_IpC9zxLTLiOvWFc4XZBow], source[{\"@source\":\"file://control-node/tmp/test/test.log\",\"@tags\":[\"test\"],\"@fields\":{\"logLevel\":[\"INFO\"],\"petitionID\":[\"113002\"],\"userID\":[\"Unknown\"],\"type\":[\"Server\"],\"received\":[\"2013-08-14T11:53:45.058Z\"]},\"@timestamp\":\"2013-08-15T06:27:58.615Z\",\"@source_host\":\"control-node\",\"@source_path\":\"/tmp/test/test.log\",\"@message\":\"2013-08-15 08:27:58,615 [Server] INFO  - [113002] [Unknown] [Server] El usuario se ha registrado con éxito test@gmail.com nil null\",\"@type\":\"test\"]}]\n> org.elasticsearch.index.mapper.MapperParsingException: Failed to parse\n>     at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:509)\n>     at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:430)\n>     at org.elasticsearch.index.shard.service.InternalIndexShard.prepareCreate(InternalIndexShard.java:297)\n>     at org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:211)\n>     at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction.performOnPrimary(TransportShardReplicationOperationAction.java:532)\n>     at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$1.run(TransportShardReplicationOperationAction.java:430)\n>     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1146)\n>     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n>     at java.lang.Thread.run(Thread.java:679)\n> Caused by: org.elasticsearch.common.jackson.core.JsonParseException: Unexpected end-of-input: expected close marker for OBJECT (from [Source: [B@410f87d7; line: 1, column: 0])\n>  at [Source: [B@410f87d7; line: 1, column: 979]\n>     at org.elasticsearch.common.jackson.core.JsonParser._constructError(JsonParser.java:1378)\n>     at org.elasticsearch.common.jackson.core.base.ParserMinimalBase._reportError(ParserMinimalBase.java:599)\n>     at org.elasticsearch.common.jackson.core.base.ParserMinimalBase._reportInvalidEOF(ParserMinimalBase.java:532)\n>     at org.elasticsearch.common.jackson.core.base.ParserBase._handleEOF(ParserBase.java:479)\n>     at org.elasticsearch.common.jackson.core.json.UTF8StreamJsonParser._skipWSOrEnd(UTF8StreamJsonParser.java:2512)\n>     at org.elasticsearch.common.jackson.core.json.UTF8StreamJsonParser.nextToken(UTF8StreamJsonParser.java:626)\n>     at org.elasticsearch.common.xcontent.json.JsonXContentParser.nextToken(JsonXContentParser.java:48)\n>     at org.elasticsearch.index.mapper.object.ObjectMapper.parse(ObjectMapper.java:461)\n>     at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:486)\n>     ... 8 more\n\nlogstash.conf\n\n> input {\n>       file {\n>     'debug' => false\n>     'path' => ['/tmp/test/test.log']\n>     'tags' => 'test'\n>     'type' => 'test'\n>     'discover_interval' => 0\n>     'start_position' => 'beginning'\n>   }\n> }\n> filter {\n>   multiline {\n>     'pattern' => '(^\\sat)|(^java)|(^com)|(^Cause)|(^\\s+.)|(^org)'\n>     'tags' => 'test'\n>     'type' => 'test'\n>     'what' => 'previous'\n>   }\n>   grok {\n>     'add_field' => ['received', '%{@timestamp}']\n>     'pattern' => '%{TIMESTAMP_ISO8601:date} [%{DATA}] %{USERNAME:logLevel}( )+- ([%{INT:petitionID}] (([%{USERNAME:userID}] [%{USERNAME:type}] )|([%{USERNAME:server}] )))?((?<iphone>%{USERNAME}.09)|%{GREEDYDATA})'\n>     'tags' => 'test'\n>     'type' => 'test'\n>   }\n>   date {\n>     'match' => ['date', 'yyyy-MM-dd HH:mm:ss,SSS']\n>     'tags' => 'test'\n>     'type' => 'test'\n>   }\n>   mutate {\n>     'remove' => ['date']\n>     'tags' => 'test'\n>     'type' => 'test'\n>   }\n> }\n> output {\n>   elasticsearch_http { host => \"x.x.x.x\" flush_size => 1}\n> }\n\nWe have verified that the data file was utf-8, and have tried to run the option logstash java _-Dfile.encoding = UTF8_ with the same results.\n\nHow we could get to write the traces in elasticsearch. Any suggestions?\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}