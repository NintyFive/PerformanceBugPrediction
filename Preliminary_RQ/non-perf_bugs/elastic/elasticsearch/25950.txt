{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25950","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25950/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25950/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25950/events","html_url":"https://github.com/elastic/elasticsearch/issues/25950","id":246366447,"node_id":"MDU6SXNzdWUyNDYzNjY0NDc=","number":25950,"title":"Term(s) query on range field fails","user":{"login":"scinconovetta","id":15264424,"node_id":"MDQ6VXNlcjE1MjY0NDI0","avatar_url":"https://avatars0.githubusercontent.com/u/15264424?v=4","gravatar_id":"","url":"https://api.github.com/users/scinconovetta","html_url":"https://github.com/scinconovetta","followers_url":"https://api.github.com/users/scinconovetta/followers","following_url":"https://api.github.com/users/scinconovetta/following{/other_user}","gists_url":"https://api.github.com/users/scinconovetta/gists{/gist_id}","starred_url":"https://api.github.com/users/scinconovetta/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scinconovetta/subscriptions","organizations_url":"https://api.github.com/users/scinconovetta/orgs","repos_url":"https://api.github.com/users/scinconovetta/repos","events_url":"https://api.github.com/users/scinconovetta/events{/privacy}","received_events_url":"https://api.github.com/users/scinconovetta/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-07-28T14:37:30Z","updated_at":"2017-07-31T14:33:07Z","closed_at":"2017-07-31T14:33:07Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"No longer able to run a term(s) query on a long_range field from v5.5.0 and later.  This type of query worked in versions such as v5.3.0 and v5.4.0. Bug introduced in this [commit](https://github.com/elastic/elasticsearch/commit/0e7c4cd58e437d1a82a37a04f5b7877131252c2a#diff-bc271544999af8a1941e5422b178e389)\r\n\r\nThe following error message is produced: `java.lang.IllegalArgumentException: Field [iprange] of type [long_range] does not support range queries`\r\n\r\nExample field mapping:\r\n```\r\n{\r\n    \"mappings\": {\r\n        \"properties\": {\r\n            \"iprange\": {\r\n                \"type\": \"long_range\"\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\nExample document:\r\n```\r\n{\r\n  \"iprange\": {\r\n    \"gte\": 1184220823,\r\n    \"lte\": 1184220823\r\n  }\r\n}\r\n```\r\n\r\nExample query:\r\n```\r\n{\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"filter\": {\r\n                \"terms\": {\r\n                    \"iprange\": [1593315665,1595584936,1184220823,1187276336]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nExample error log:\r\n```\r\n        at org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:329) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:312) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:613) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:481) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:457) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:253) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:330) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:327) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1544) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_121]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_121]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_121]\r\nCaused by: java.lang.IllegalArgumentException: Field [iprange] of type [long_range] does not support range queries\r\n        at org.elasticsearch.index.mapper.MappedFieldType.rangeQuery(MappedFieldType.java:354) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.mapper.RangeFieldMapper$RangeFieldType.termQuery(RangeFieldMapper.java:278) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.mapper.MappedFieldType.termsQuery(MappedFieldType.java:348) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.TermsQueryBuilder.handleTermsQuery(TermsQueryBuilder.java:438) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.TermsQueryBuilder.doToQuery(TermsQueryBuilder.java:411) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.toQuery(AbstractQueryBuilder.java:96) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.toFilter(AbstractQueryBuilder.java:118) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.addBooleanClauses(BoolQueryBuilder.java:446) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.doToQuery(BoolQueryBuilder.java:419) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.toQuery(AbstractQueryBuilder.java:96) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.QueryShardContext.lambda$toQuery$1(QueryShardContext.java:313) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:325) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:312) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:613) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:481) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:457) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:253) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:330) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:327) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1544) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_121]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_121]\r\n        at java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_121]\r\n```","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}