{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21326","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21326/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21326/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21326/events","html_url":"https://github.com/elastic/elasticsearch/issues/21326","id":187289545,"node_id":"MDU6SXNzdWUxODcyODk1NDU=","number":21326,"title":"connection closing/timeout issue maybe related to client node?","user":{"login":"olibob","id":1624033,"node_id":"MDQ6VXNlcjE2MjQwMzM=","avatar_url":"https://avatars2.githubusercontent.com/u/1624033?v=4","gravatar_id":"","url":"https://api.github.com/users/olibob","html_url":"https://github.com/olibob","followers_url":"https://api.github.com/users/olibob/followers","following_url":"https://api.github.com/users/olibob/following{/other_user}","gists_url":"https://api.github.com/users/olibob/gists{/gist_id}","starred_url":"https://api.github.com/users/olibob/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/olibob/subscriptions","organizations_url":"https://api.github.com/users/olibob/orgs","repos_url":"https://api.github.com/users/olibob/repos","events_url":"https://api.github.com/users/olibob/events{/privacy}","received_events_url":"https://api.github.com/users/olibob/received_events","type":"User","site_admin":false},"labels":[{"id":146854632,"node_id":"MDU6TGFiZWwxNDY4NTQ2MzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Network","name":":Distributed/Network","color":"0e8a16","default":false,"description":"Http and internode communication implementations"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2016-11-04T09:39:33Z","updated_at":"2019-08-26T14:42:31Z","closed_at":"2019-08-26T14:42:31Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.0.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: 1.8.0_112-b15\r\n\r\n**OS version**: Debian 8 (jessie)\r\n\r\nHi,\r\n\r\nI'm having an issue bulk loading into a 4 nodes test setup: 1 client node + 3 data nodes (one of them gets elected as master).\r\nDuring the loading (from scratch), I can see the following in the logs:\r\n\r\nClient Node:\r\n```\r\n[2016-11-04T07:16:08,090][WARN ][o.e.t.n.Netty4Transport  ] [bb-front-els-pp] exception caught on transport layer [[id: 0xe3826a4f, L:/10.13.50.199:9300 - R:/10.13.50.132:45521]], closing connection\r\n[2016-11-04T09:12:27,632][WARN ][o.e.t.n.Netty4Transport  ] [bb-front-els-pp] exception caught on transport layer [[id: 0x5da55f00, L:/10.13.50.199:48784 - R:/10.13.50.134:9300]], closing connection\r\n[2016-11-04T09:12:50,672][WARN ][o.e.t.n.Netty4Transport  ] [bb-front-els-pp] exception caught on transport layer [[id: 0xa2219798, L:/10.13.50.199:57320 - R:/10.13.50.133:9300]], closing connection\r\n```\r\n\r\nData1:\r\n```\r\n[2016-11-04T07:16:51,118][WARN ][o.e.t.n.Netty4Transport  ] [bb-back-els1-pp] exception caught on transport layer [[id: 0x7fd2453d, L:/10.13.50.132:45528 - R:/10.13.50.199:9300]], closing connection\r\n```\r\n\r\nData2:\r\n```\r\n[2016-11-04T07:16:49,457][WARN ][o.e.t.n.Netty4Transport  ] [bb-back-els2-pp] exception caught on transport layer [[id: 0xc9a27aae, L:/10.13.50.133:56808 - R:/10.13.50.199:9300]], closing connection\r\n```\r\n\r\nData3:\r\n\r\n```\r\n[2016-11-04T07:16:25,248][WARN ][o.e.t.n.Netty4Transport  ] [bb-back-els3-pp] exception caught on transport layer [[id: 0x420dc7e3, L:/10.13.50.134:49367 - R:/10.13.50.199:9300]], closing connection\r\n```\r\n\r\nNode configs are very basic:\r\n\r\n```\r\nbootstrap.memory_lock: true\r\nnetwork.host: 10.13.50.132 (133, 134)\r\ndiscovery.zen.ping.unicast.hosts: [\"bb-front-els-pp\", \"bb-back-els1-pp\", \"bb-back-els2-pp\", \"bb-back-els3-pp \"]\r\ndiscovery.zen.minimum_master_nodes: 2\r\nnode.max_local_storage_nodes: 1\r\n```\r\n\r\nClient Node:\r\n\r\n```\r\nnode.master: false\r\nnode.data: false\r\nnode.ingest: false\r\nbootstrap.memory_lock: true\r\nnetwork.host: 10.13.50.199\r\ndiscovery.zen.ping.unicast.hosts: [\"bb-front-els-pp\", \"bb-back-els1-pp\", \"bb-back-els2-pp\", \"bb-back-els3-pp \"]\r\ndiscovery.zen.minimum_master_nodes: 2\r\nnode.max_local_storage_nodes: 1\r\n```\r\n\r\n_cat/nodes\r\n\r\n```\r\n10.13.50.132  8 82 0 0.00 0.01 0.05 mdi - bb-back-els1-pp\r\n10.13.50.134 10 90 0 0.04 0.03 0.05 mdi * bb-back-els3-pp\r\n10.13.50.199  5 78 0 0.00 0.01 0.05 -   - bb-front-els-pp\r\n10.13.50.133  7 83 0 0.00 0.01 0.05 mdi - bb-back-els2-pp\r\n```\r\n\r\n- There are no network restrictions on these nodes\r\n- All nodes are Debian Jessie VMs (4 cores, 8GB RAM): swappiness set to 1\r\n- Elasticsearch 5.0.0 (no plugins): JVM with 4GB - bootstrap.memory_lock: true\r\n- JDK: 1.8.0_112-b15 (with 1.8.0_101 I've even seen a node restart, master being re-elected, ...)\r\n- We use a data node to bulk load (REST) because we get better results than using the client node\r\n\r\nWe load 500 documents at a time (around 800k per document). A full load represents 3529299 documents\r\n\r\nAfter a random amount of time (or documents loaded), the warnings start to appear. The  cluster does not respond to queries anymore, even hours after completion of the bulk load. A restart of the cluster is necessary.\r\n\r\nAnyone experiencing this kind of behavior?\r\nAny pointers would be appreciated.","closed_by":{"login":"andrershov","id":600624,"node_id":"MDQ6VXNlcjYwMDYyNA==","avatar_url":"https://avatars1.githubusercontent.com/u/600624?v=4","gravatar_id":"","url":"https://api.github.com/users/andrershov","html_url":"https://github.com/andrershov","followers_url":"https://api.github.com/users/andrershov/followers","following_url":"https://api.github.com/users/andrershov/following{/other_user}","gists_url":"https://api.github.com/users/andrershov/gists{/gist_id}","starred_url":"https://api.github.com/users/andrershov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrershov/subscriptions","organizations_url":"https://api.github.com/users/andrershov/orgs","repos_url":"https://api.github.com/users/andrershov/repos","events_url":"https://api.github.com/users/andrershov/events{/privacy}","received_events_url":"https://api.github.com/users/andrershov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}