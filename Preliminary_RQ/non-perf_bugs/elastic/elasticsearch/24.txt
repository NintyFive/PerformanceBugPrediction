{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24/events","html_url":"https://github.com/elastic/elasticsearch/issues/24","id":135256,"node_id":"MDU6SXNzdWUxMzUyNTY=","number":24,"title":"Changing field type with create_mapping just hides the error","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":23175,"node_id":"MDU6TGFiZWwyMzE3NQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.05.0","name":"v0.05.0","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2010-02-18T12:05:16Z","updated_at":"2010-03-02T18:05:44Z","closed_at":"2010-03-02T17:06:43Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Easier to give an example than to explain:\n    - on  a new cluster  (ie no indices, no mappings)\n    - index a document with eg { foo: 123 }  # sets type of foo to 'int'\n    - index a doc with { foo : \"bar\" }               # throws an error\n    - create a mapping and set foo's type to 'string'\n    - index the doc with { foo: \"bar\"}   # ok\n    - search for {term: { foo: 123}}   # 1 hit\n    - search for {term: { foo: \"bar\"}}   # no hits\n\nSo setting the mapping doesn't change the type of 'foo', it just hides the error message later on.\n\nThis seems inconsistent to me - it should either change the type of 'foo' going forward, or throw an error when you try to change the type with create_mapping.\n\nLog file follows:\n\n```\ncurl -XPUT http://127.0.0.2:9200/twitter/tweet/1 -d '{\n   \"foo\" : 123\n}\n'\n# {\n#    \"ok\" : true,\n#    \"_index\" : \"twitter\",\n#    \"_id\" : \"1\",\n#    \"_type\" : \"tweet\"\n# }\n\n\ncurl -XPUT http://127.0.0.2:9200/twitter/tweet/2 -d '{\n   \"foo\" : \"bar\"\n}\n'\n# {\n#    \"debug\" : {\n#       \"at\" : {\n#          \"className\" : \"java.lang.Thread\",\n#          \"methodName\" : \"run\",\n#          \"fileName\" : \"Thread.java\",\n#          \"lineNumber\" : 619\n#       },\n#       \"cause\" : {\n#          \"at\" : {\n#             \"className\" : \"java.lang.Thread\",\n#             \"methodName\" : \"run\",\n#             \"fileName\" : \"Thread.java\",\n#             \"lineNumber\" : 619\n#          },\n#          \"message\" : \"Current token (VALUE_STRING) not numeric, c\n# >         an not use numeric value accessors\\n at [Source: {\\n   \n#       },\n#       \"message\" : \"Index[twitter] Shard[1] \"\n#    },\n#    \"error\" : \"Index[twitter] Shard[1] ; nested: Failed to parse; \n# >   nested: Current token (VALUE_STRING) not numeric, can not use\n# }\n\n\ncurl -XPUT http://127.0.0.2:9200/_all/tweet/_mapping -d '{\n   \"properties\" : {\n      \"foo\" : {\n         \"type\" : \"string\"\n      }\n   }\n}\n'\n# {\n#    \"ok\" : true\n# }\n\n\ncurl -XPUT http://127.0.0.2:9200/twitter/tweet/2 -d '{\n   \"foo\" : \"bar\"\n}\n'\n# {\n#    \"ok\" : true,\n#    \"_index\" : \"twitter\",\n#    \"_id\" : \"2\",\n#    \"_type\" : \"tweet\"\n# }\n\n\ncurl -XGET http://127.0.0.2:9200/twitter/tweet/_search -d '{\n   \"query\" : {\n      \"term\" : {\n         \"foo\" : \"123\"\n      }\n   }\n}\n'\n# {\n#    \"hits\" : {\n#       \"hits\" : [],\n#       \"total\" : 0\n#    },\n#    \"_shards\" : {\n#       \"failed\" : 0,\n#       \"successful\" : 5,\n#       \"total\" : 5\n#    }\n# }\n\n\ncurl -XGET http://127.0.0.2:9200/twitter/tweet/_search -d '{\n   \"query\" : {\n      \"term\" : {\n         \"foo\" : \"bar\"\n      }\n   }\n}\n'\n# {\n#    \"hits\" : {\n#       \"hits\" : [],\n#       \"total\" : 0\n#    },\n#    \"_shards\" : {\n#       \"failed\" : 5,\n#       \"successful\" : 0,\n#       \"total\" : 5\n#    }\n# }\n```\n","closed_by":null,"performed_via_github_app":null}