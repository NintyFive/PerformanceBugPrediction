{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22409","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22409/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22409/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22409/events","html_url":"https://github.com/elastic/elasticsearch/issues/22409","id":198416115,"node_id":"MDU6SXNzdWUxOTg0MTYxMTU=","number":22409,"title":"Partial snapshots with ArrayIndexOutOfBoundsException failure","user":{"login":"sluehr","id":11414984,"node_id":"MDQ6VXNlcjExNDE0OTg0","avatar_url":"https://avatars2.githubusercontent.com/u/11414984?v=4","gravatar_id":"","url":"https://api.github.com/users/sluehr","html_url":"https://github.com/sluehr","followers_url":"https://api.github.com/users/sluehr/followers","following_url":"https://api.github.com/users/sluehr/following{/other_user}","gists_url":"https://api.github.com/users/sluehr/gists{/gist_id}","starred_url":"https://api.github.com/users/sluehr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sluehr/subscriptions","organizations_url":"https://api.github.com/users/sluehr/orgs","repos_url":"https://api.github.com/users/sluehr/repos","events_url":"https://api.github.com/users/sluehr/events{/privacy}","received_events_url":"https://api.github.com/users/sluehr/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-01-03T06:18:37Z","updated_at":"2017-01-03T22:17:16Z","closed_at":"2017-01-03T22:17:16Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.4\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: Oracle 1.8.0_40\r\n\r\n**OS version**: Oracle Enterprise Linux 6.3\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWe are seeing partial snapshots being created with ArrayIndexOutOfBoundsExceptions after a week of successful snapshot creation. The failures we are seeing are:\r\n\r\n```\r\n{\r\n      \"shard_id\": 2,\r\n      \"status\": \"INTERNAL_SERVER_ERROR\",\r\n      \"node_id\": \"bmYrf6rCS7OdPB_LWDXrqQ\",\r\n      \"index\": \"805330515.indexname_0\",\r\n      \"reason\": \"IndexShardSnapshotFailedException[256]; nested: ArrayIndexOutOfBoundsException[256]; \"\r\n}\r\n```\r\n\r\nOur current workaround is to remove the the snapshot repository and recreate it. We are then able to create full snapshots for a week or two.\r\n\r\n**Steps to reproduce**:\r\n 1. Trigger a snapshot\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\n5330503.comments][2]] [hostname 20170102232100364] failed to create snapshot\r\n** [out :: hostname] org.elasticsearch.index.snapshots.IndexShardSnapshotFailedException: 256\r\n ** [out :: hostname] at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository.snapshot(BlobStoreIndexShardRepository.java:201)\r\n ** [out :: hostname] at org.elasticsearch.snapshots.SnapshotShardsService.snapshot(SnapshotShardsService.java:340)\r\n ** [out :: hostname] at org.elasticsearch.snapshots.SnapshotShardsService.access$200(SnapshotShardsService.java:76)\r\n ** [out :: hostname] at org.elasticsearch.snapshots.SnapshotShardsService$1.doRun(SnapshotShardsService.java:296)\r\n ** [out :: hostname] at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n ** [out :: hostname] at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n ** [out :: hostname] at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n ** [out :: hostname] at java.lang.Thread.run(Thread.java:745)\r\n ** [out :: hostname] Caused by: java.lang.ArrayIndexOutOfBoundsException: 256\r\n ** [out :: hostname] at com.fasterxml.jackson.core.sym.ByteQuadsCanonicalizer.addName(ByteQuadsCanonicalizer.java:853)\r\n ** [out :: hostname] at com.fasterxml.jackson.dataformat.smile.SmileParser._addDecodedToSymbols(SmileParser.java:1613)\r\n ** [out :: hostname] at com.fasterxml.jackson.dataformat.smile.SmileParser._handleFieldName(SmileParser.java:1528)\r\n ** [out :: hostname] at com.fasterxml.jackson.dataformat.smile.SmileParser.nextToken(SmileParser.java:587)\r\n ** [out :: hostname] at org.elasticsearch.common.xcontent.json.JsonXContentParser.nextToken(JsonXContentParser.java:53)\r\n ** [out :: hostname] at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardSnapshots.fromXContent(BlobStoreIndexShardSnapshots.java:262)\r\n ** [out :: hostname] at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardSnapshots.fromXContent(BlobStoreIndexShardSnapshots.java:48)\r\n ** [out :: hostname] at org.elasticsearch.repositories.blobstore.BlobStoreFormat.read(BlobStoreFormat.java:107)\r\n ** [out :: hostname] at org.elasticsearch.repositories.blobstore.ChecksumBlobStoreFormat.readBlob(ChecksumBlobStoreFormat.java:102)\r\n ** [out :: hostname] at org.elasticsearch.repositories.blobstore.BlobStoreFormat.read(BlobStoreFormat.java:83)\r\n ** [out :: hostname] at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$Context.buildBlobStoreIndexShardSnapshots(BlobStoreIndexShardRepository.java:469)\r\n ** [out :: hostname] at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$SnapshotContext.snapshot(BlobStoreIndexShardRepository.java:537)\r\n ** [out :: hostname] at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository.snapshot(BlobStoreIndexShardRepository.java:191)\r\n ** [out :: hostname] ... 7 common frames omitted\r\n ** [out :: hostname] 2017-01-03T10:21:00,803+11:00 [] [] [@] [] [] [elasticsearch[hostname][clusterService#updateTask][T#1]] INFO  o.elasticsearch.snapshots - [hostname] snapshot [indexname_20170102232100364] is done\r\n```","closed_by":{"login":"sluehr","id":11414984,"node_id":"MDQ6VXNlcjExNDE0OTg0","avatar_url":"https://avatars2.githubusercontent.com/u/11414984?v=4","gravatar_id":"","url":"https://api.github.com/users/sluehr","html_url":"https://github.com/sluehr","followers_url":"https://api.github.com/users/sluehr/followers","following_url":"https://api.github.com/users/sluehr/following{/other_user}","gists_url":"https://api.github.com/users/sluehr/gists{/gist_id}","starred_url":"https://api.github.com/users/sluehr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sluehr/subscriptions","organizations_url":"https://api.github.com/users/sluehr/orgs","repos_url":"https://api.github.com/users/sluehr/repos","events_url":"https://api.github.com/users/sluehr/events{/privacy}","received_events_url":"https://api.github.com/users/sluehr/received_events","type":"User","site_admin":false},"performed_via_github_app":null}