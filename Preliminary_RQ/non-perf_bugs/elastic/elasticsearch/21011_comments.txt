[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254760258","html_url":"https://github.com/elastic/elasticsearch/issues/21011#issuecomment-254760258","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21011","id":254760258,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDc2MDI1OA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T09:22:00Z","updated_at":"2016-10-19T09:22:00Z","author_association":"MEMBER","body":"The REST client is using:\n\n``` xml\n    <dependency>\n      <groupId>org.apache.httpcomponents</groupId>\n      <artifactId>httpclient</artifactId>\n      <version>4.5.2</version>\n      <scope>compile</scope>\n      <exclusions>\n        <exclusion>\n          <groupId>*</groupId>\n          <artifactId>*</artifactId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n    <dependency>\n      <groupId>org.apache.httpcomponents</groupId>\n      <artifactId>httpcore</artifactId>\n      <version>4.4.5</version>\n      <scope>compile</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.apache.httpcomponents</groupId>\n      <artifactId>httpasyncclient</artifactId>\n      <version>4.1.2</version>\n      <scope>compile</scope>\n      <exclusions>\n        <exclusion>\n          <groupId>*</groupId>\n          <artifactId>*</artifactId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n    <dependency>\n      <groupId>org.apache.httpcomponents</groupId>\n      <artifactId>httpcore-nio</artifactId>\n      <version>4.4.5</version>\n      <scope>compile</scope>\n      <exclusions>\n        <exclusion>\n          <groupId>*</groupId>\n          <artifactId>*</artifactId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n    <dependency>\n      <groupId>commons-codec</groupId>\n      <artifactId>commons-codec</artifactId>\n      <version>1.10</version>\n      <scope>compile</scope>\n    </dependency>\n    <dependency>\n      <groupId>commons-logging</groupId>\n      <artifactId>commons-logging</artifactId>\n      <version>1.1.3</version>\n      <scope>compile</scope>\n    </dependency>\n```\n\nSee https://repo1.maven.org/maven2/org/elasticsearch/client/rest/5.0.0-rc1/rest-5.0.0-rc1.pom\n\nIf you are talking about the TransportClient, this one depends on elasticsearch server which uses indeed LOG4J2 in the server.\nMy guess is that when it will become more mature, we will remove at some point the Transport Client.\n\nIn the mean time, you can try to shade elasticsearch and relocate the LOG4J jars if you wish.\nRead https://www.elastic.co/blog/to-shade-or-not-to-shade\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254786474","html_url":"https://github.com/elastic/elasticsearch/issues/21011#issuecomment-254786474","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21011","id":254786474,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDc4NjQ3NA==","user":{"login":"guenhter","id":16029571,"node_id":"MDQ6VXNlcjE2MDI5NTcx","avatar_url":"https://avatars2.githubusercontent.com/u/16029571?v=4","gravatar_id":"","url":"https://api.github.com/users/guenhter","html_url":"https://github.com/guenhter","followers_url":"https://api.github.com/users/guenhter/followers","following_url":"https://api.github.com/users/guenhter/following{/other_user}","gists_url":"https://api.github.com/users/guenhter/gists{/gist_id}","starred_url":"https://api.github.com/users/guenhter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guenhter/subscriptions","organizations_url":"https://api.github.com/users/guenhter/orgs","repos_url":"https://api.github.com/users/guenhter/repos","events_url":"https://api.github.com/users/guenhter/events{/privacy}","received_events_url":"https://api.github.com/users/guenhter/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T11:29:52Z","updated_at":"2016-10-19T11:29:52Z","author_association":"NONE","body":"Thanks for the quick response. \nAs long as log4j is present, I will use `log4j-over-slf4j`.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/257084909","html_url":"https://github.com/elastic/elasticsearch/issues/21011#issuecomment-257084909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21011","id":257084909,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NzA4NDkwOQ==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2016-10-29T10:54:38Z","updated_at":"2016-10-29T10:56:53Z","author_association":"NONE","body":"Hello,\n\nI encoutered the same issue. \nI have the following dependencies:\n\n``` xml\n<dependency>\n  <groupId>org.elasticsearch.client</groupId>\n  <artifactId>transport</artifactId>\n  <version>${elastic.version}</version>\n</dependency>\n<dependency>\n  <groupId>org.apache.logging.log4j</groupId>\n  <artifactId>log4j-to-slf4j</artifactId>\n  <version>2.7</version>\n  <scope>runtime</scope>\n</dependency>\n```\n\nEven with the log4j to slf4j adapter, I have this error:\n\n``` java\nException in thread \"elasticsearch[N8GnTfl][clusterService#updateTask][T#1]\" java.lang.NoClassDefFoundError: org/apache/logging/log4j/core/config/Configurator\n    at org.elasticsearch.common.logging.Loggers.setLevel(Loggers.java:149)\n    at org.elasticsearch.common.logging.Loggers.setLevel(Loggers.java:144)\n    at org.elasticsearch.index.SearchSlowLog.setLevel(SearchSlowLog.java:114)\n    at org.elasticsearch.index.SearchSlowLog.<init>(SearchSlowLog.java:109)\n    at org.elasticsearch.index.IndexModule.<init>(IndexModule.java:114)\n    at org.elasticsearch.indices.IndicesService.createIndexService(IndicesService.java:402)\n    at org.elasticsearch.indices.IndicesService.createIndex(IndicesService.java:374)\n    at org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$1.execute(MetaDataCreateIndexService.java:347)\n    at org.elasticsearch.cluster.ClusterStateUpdateTask.execute(ClusterStateUpdateTask.java:45)\n    at org.elasticsearch.cluster.service.ClusterService.runTasksForExecutor(ClusterService.java:555)\n    at org.elasticsearch.cluster.service.ClusterService$UpdateTask.run(ClusterService.java:894)\n    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:444)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:237)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:200)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.ClassNotFoundException: org.apache.logging.log4j.core.config.Configurator\n    at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n    ... 17 more\n```\n\nIt seems that the only way to avoid this is to add full log4j implementation to the classpath.\n\n@dadoonet, are you saying that at some point, Transport Client will be dropped in favor of REST Client ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/257085207","html_url":"https://github.com/elastic/elasticsearch/issues/21011#issuecomment-257085207","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21011","id":257085207,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NzA4NTIwNw==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-10-29T11:01:19Z","updated_at":"2016-10-29T11:01:19Z","author_association":"MEMBER","body":"Yes. You sadly need to have log4j impl in the classpath. The TransportClient is tight with elasticsearch core which needs to have this log4j impl.\nOne of the thing you can may be do is to shade all that to avoid conflicts with your project. This can help: https://www.elastic.co/blog/to-shade-or-not-to-shade\n\n> are you saying that at some point Transport Client will be dropped in favor of REST Client ?\n\nThis is my guess indeed. I mean that having a REST client with less deps will be a great win.\nBut it won't happen anytime soon as we first have to add some query builders and more feature on top of the low level REST client.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258788927","html_url":"https://github.com/elastic/elasticsearch/issues/21011#issuecomment-258788927","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21011","id":258788927,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODc4ODkyNw==","user":{"login":"mbechler","id":4471061,"node_id":"MDQ6VXNlcjQ0NzEwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/4471061?v=4","gravatar_id":"","url":"https://api.github.com/users/mbechler","html_url":"https://github.com/mbechler","followers_url":"https://api.github.com/users/mbechler/followers","following_url":"https://api.github.com/users/mbechler/following{/other_user}","gists_url":"https://api.github.com/users/mbechler/gists{/gist_id}","starred_url":"https://api.github.com/users/mbechler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbechler/subscriptions","organizations_url":"https://api.github.com/users/mbechler/orgs","repos_url":"https://api.github.com/users/mbechler/repos","events_url":"https://api.github.com/users/mbechler/events{/privacy}","received_events_url":"https://api.github.com/users/mbechler/received_events","type":"User","site_admin":false},"created_at":"2016-11-07T09:41:32Z","updated_at":"2016-11-07T09:41:32Z","author_association":"NONE","body":"Is it really necessary that you are fiddling around with the loggers like that? The only real core dependency on  log4j-core seems to be setting logger levels from IndexSettings in IndexingSlowLog/SearchSlowLog. If that wouldn't be there (or fail gracefully) client users would still be able to use their respective logging backend with an adapter and without pulling in and configuring the log4j2.\n","performed_via_github_app":null}]