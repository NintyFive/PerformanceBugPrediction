[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/287059486","html_url":"https://github.com/elastic/elasticsearch/issues/23608#issuecomment-287059486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23608","id":287059486,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NzA1OTQ4Ng==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-03-16T13:40:07Z","updated_at":"2017-03-16T13:40:07Z","author_association":"CONTRIBUTOR","body":"I've seen this when you create a new index using reindex without setting up the types first. Elasticsearch is using its standard type inference mechanisms and reindex exposes the problems with it more quickly then normal operations. My guess is you have `age` fields in your source that look like `11` and that look like `\"11\"`. If the `11` hits first then Elasticsearch will infer the type of the field is `long`. If the `\"11\"` hits first then Elasticsearch will infer that they type is `text`. If they hit at the same time then you'll get the error you got. Is this what happened to you?\r\n\r\nThere is a section at the top of the reindex documentation marked `IMPORTANT` that advises you to set up the target index first yourself. Do you have any ideas on other places to put this documentation so it is more visible?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/287071866","html_url":"https://github.com/elastic/elasticsearch/issues/23608#issuecomment-287071866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23608","id":287071866,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NzA3MTg2Ng==","user":{"login":"dseeley","id":5869991,"node_id":"MDQ6VXNlcjU4Njk5OTE=","avatar_url":"https://avatars3.githubusercontent.com/u/5869991?v=4","gravatar_id":"","url":"https://api.github.com/users/dseeley","html_url":"https://github.com/dseeley","followers_url":"https://api.github.com/users/dseeley/followers","following_url":"https://api.github.com/users/dseeley/following{/other_user}","gists_url":"https://api.github.com/users/dseeley/gists{/gist_id}","starred_url":"https://api.github.com/users/dseeley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dseeley/subscriptions","organizations_url":"https://api.github.com/users/dseeley/orgs","repos_url":"https://api.github.com/users/dseeley/repos","events_url":"https://api.github.com/users/dseeley/events{/privacy}","received_events_url":"https://api.github.com/users/dseeley/received_events","type":"User","site_admin":false},"created_at":"2017-03-16T14:20:32Z","updated_at":"2017-03-16T14:20:32Z","author_association":"NONE","body":"This is just a simple illustrative example.  The actual index I am having problems with uses dynamic templates, and the resultant mapping is thousands of lines long.  It is not practical to set it up manually beforehand.  On reindex, the target index assumes the correct template (same as the source), which uses dynamic field mappings, and correctly interprets the first 1.6 million documents, but then comes across a new document type with conflicting field types and fails as per the example.\r\n\r\nI believe it is failing because a scan/scroll batch contains multiple documents with 'age' fields that are interpreted as different types.  I would expect that once the first document from the batch has been indexed, the index has this type set for the field; any subsequent indexing of that field with a differing type should be either ignored or coerced.  When the batch size is set to 1, the problem goes away, but this is not a practical solution (far too slow).\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309728779","html_url":"https://github.com/elastic/elasticsearch/issues/23608#issuecomment-309728779","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23608","id":309728779,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTcyODc3OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-06-20T11:47:14Z","updated_at":"2017-06-20T11:47:14Z","author_association":"CONTRIBUTOR","body":"> The actual index I am having problems with uses dynamic templates, and the resultant mapping is thousands of lines long. It is not practical to set it up manually beforehand.\r\n\r\nYou can set it up manually very easily, by retrieving the mapping from the old index and passing it as a parameter to the create-index command.\r\n\r\nYour fields are mapped as they are because of chance ordering of documents.  If they'd arrived in a different order, you'd have seen rejections on the original index.  That's just the way dynamic mappings work - there's nothing more we can do here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309730553","html_url":"https://github.com/elastic/elasticsearch/issues/23608#issuecomment-309730553","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23608","id":309730553,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTczMDU1Mw==","user":{"login":"dseeley","id":5869991,"node_id":"MDQ6VXNlcjU4Njk5OTE=","avatar_url":"https://avatars3.githubusercontent.com/u/5869991?v=4","gravatar_id":"","url":"https://api.github.com/users/dseeley","html_url":"https://github.com/dseeley","followers_url":"https://api.github.com/users/dseeley/followers","following_url":"https://api.github.com/users/dseeley/following{/other_user}","gists_url":"https://api.github.com/users/dseeley/gists{/gist_id}","starred_url":"https://api.github.com/users/dseeley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dseeley/subscriptions","organizations_url":"https://api.github.com/users/dseeley/orgs","repos_url":"https://api.github.com/users/dseeley/repos","events_url":"https://api.github.com/users/dseeley/events{/privacy}","received_events_url":"https://api.github.com/users/dseeley/received_events","type":"User","site_admin":false},"created_at":"2017-06-20T11:55:39Z","updated_at":"2017-06-20T11:55:39Z","author_association":"NONE","body":"I didn't use the original mapping as you suggest because it was being reindexed from es1.53 to es5, and I assumed the differences would matter - perhaps this was not true.  In the end, I used stream2es, which didn't suffer from this problem.","performed_via_github_app":null}]