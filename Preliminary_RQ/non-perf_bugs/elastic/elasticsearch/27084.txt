{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27084","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27084/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27084/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27084/events","html_url":"https://github.com/elastic/elasticsearch/issues/27084","id":267745350,"node_id":"MDU6SXNzdWUyNjc3NDUzNTA=","number":27084,"title":"Add lookup capability to geo_distance query / Support `lat/lon` as lookup field","user":{"login":"RTodorov","id":3506845,"node_id":"MDQ6VXNlcjM1MDY4NDU=","avatar_url":"https://avatars0.githubusercontent.com/u/3506845?v=4","gravatar_id":"","url":"https://api.github.com/users/RTodorov","html_url":"https://github.com/RTodorov","followers_url":"https://api.github.com/users/RTodorov/followers","following_url":"https://api.github.com/users/RTodorov/following{/other_user}","gists_url":"https://api.github.com/users/RTodorov/gists{/gist_id}","starred_url":"https://api.github.com/users/RTodorov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RTodorov/subscriptions","organizations_url":"https://api.github.com/users/RTodorov/orgs","repos_url":"https://api.github.com/users/RTodorov/repos","events_url":"https://api.github.com/users/RTodorov/events{/privacy}","received_events_url":"https://api.github.com/users/RTodorov/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-10-23T17:05:59Z","updated_at":"2017-10-31T11:04:55Z","closed_at":"2017-10-27T13:41:14Z","author_association":"NONE","active_lock_reason":null,"body":"Since `more_like_this` query does not support geospatial fields, one way of implementing it would be to use a normal query where we could \"join\" the fields via lookup.\r\n\r\nFor example, I have a restaurant that makes sushi and I want to find related places nearby. I'd like to be able to do something like this:\r\n\r\n```\r\n{\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"filter\": [\r\n                {\r\n                    \"terms\": {\r\n                        \"category\": {\r\n                            \"id\": \"sushiplace123\",\r\n                            \"index\": \"places\",\r\n                            \"type\": \"restaurant\",\r\n                            \"path\": \"category\"\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    \"geo_distance\": {\r\n                        \"address.location\": {\r\n                            \"id\": \"sushiplace123\",\r\n                            \"index\": \"places\",\r\n                            \"type\": \"restaurant\",\r\n                            \"path\": \"address.location\"\r\n                        },\r\n                        \"distance\": \"1km\"\r\n                    }\r\n                }\r\n            ],\r\n            \"must\": [\r\n                {\r\n                    \"match_all\": {}\r\n                }\r\n            ]\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThis query means that I'm looking for places with the same category as sushiplace123 (sushi) and within a 1km radius.\r\n\r\nCurrently, the only solution I could find is to query the cluster twice.\r\n\r\nIs this something that could be implemented? Also, are you considering adding geospatial capabilities to the ``more_like_this`` query / api?","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}