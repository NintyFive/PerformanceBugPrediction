{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/58391","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58391/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58391/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58391/events","html_url":"https://github.com/elastic/elasticsearch/issues/58391","id":642493137,"node_id":"MDU6SXNzdWU2NDI0OTMxMzc=","number":58391,"title":"Netty client throwing NoSuchMethodError","user":{"login":"danaoxmt","id":57339609,"node_id":"MDQ6VXNlcjU3MzM5NjA5","avatar_url":"https://avatars1.githubusercontent.com/u/57339609?v=4","gravatar_id":"","url":"https://api.github.com/users/danaoxmt","html_url":"https://github.com/danaoxmt","followers_url":"https://api.github.com/users/danaoxmt/followers","following_url":"https://api.github.com/users/danaoxmt/following{/other_user}","gists_url":"https://api.github.com/users/danaoxmt/gists{/gist_id}","starred_url":"https://api.github.com/users/danaoxmt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danaoxmt/subscriptions","organizations_url":"https://api.github.com/users/danaoxmt/orgs","repos_url":"https://api.github.com/users/danaoxmt/repos","events_url":"https://api.github.com/users/danaoxmt/events{/privacy}","received_events_url":"https://api.github.com/users/danaoxmt/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-06-21T04:34:21Z","updated_at":"2020-06-23T05:39:15Z","closed_at":"2020-06-22T20:03:40Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\n$ ~/elasticsearch-6.4.2/bin/elasticsearch --version\r\nJava HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.\r\nVersion: 6.4.2\r\n\r\n**Plugins installed**: []\r\norg.elasticsearch.client:transport:6.4.2\r\n\r\n**JVM version** (`java -version`):\r\n$ java -version\r\njava version \"11.0.5\" 2019-10-15 LTS\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nDarwin Kernel Version 19.5.0\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nThis isn't an issue in that the elasticsearch client seems to be performing as expected and is querying data successfully but there are a heap of log messages from the Netty client about fatal errors that seem to be attached to all the threads available to the Netty thread pool. It's throwing the stack trace pasted below for all threads. \r\n\r\nLooks like its attempting to access a method that doesnt exist in the Netty library. java.lang.NoSuchMethodError: io.netty.buffer.ByteBuf.isContiguous()\r\n\r\nI am instantiating the client using the PreBuiltTransportClient constructor which I think is not considered best practise in favour of the HighLevelRestClient but I would have thought it would still work without throwing all these noisey log messages/ I'm not even sure that this is an issue with how the client is built it seems like an issue in the Netty library itself.\r\n\r\nI was under the impression that https://github.com/elastic/elasticsearch/pull/22452 fixed this issue by disabling the Netty recycler but looking at the jvm.options file currently checked into Github it doesn't seem to have that property? \r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n2020-06-21 11:56:41,184 DEBUG [Thread-0] DefaultListableBeanFactory:217 - Creating shared instance of singleton bean 'client'\r\n11:56:47.816 [elasticsearch[_client_][transport_client_boss][T#1]] ERROR org.elasticsearch.transport.netty4.Netty4Utils - fatal error on the network layer\r\n        at org.elasticsearch.transport.netty4.Netty4Utils.maybeDie(Netty4Utils.java:182)\r\n        at org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.exceptionCaught(Netty4MessageChannelHandler.java:73)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeExceptionCaught(AbstractChannelHandlerContext.java:302)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeExceptionCaught(AbstractChannelHandlerContext.java:281)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireExceptionCaught(AbstractChannelHandlerContext.java:273)\r\n        at io.netty.channel.ChannelInboundHandlerAdapter.exceptionCaught(ChannelInboundHandlerAdapter.java:143)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeExceptionCaught(AbstractChannelHandlerContext.java:302)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:381)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n        at io.netty.handler.logging.LoggingHandler.channelRead(LoggingHandler.java:241)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:615)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:578)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\nException in thread \"Thread-1\"  at java.base/java.lang.Thread.run(Thread.java:834)\r\njava.lang.NoSuchMethodError: io.netty.buffer.ByteBuf.isContiguous()Z\r\n        at io.netty.handler.codec.ByteToMessageDecoder$1.cumulate(ByteToMessageDecoder.java:83)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:274)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n        at io.netty.handler.logging.LoggingHandler.channelRead(LoggingHandler.java:241)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:615)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:578)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at java.base/java.lang.Thread.run(Thread.java:834)\r\n\r\n```\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}