[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/477569290","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-477569290","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":477569290,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzU2OTI5MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-28T12:12:01Z","updated_at":"2019-03-28T12:12:01Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/477573113","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-477573113","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":477573113,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzU3MzExMw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2019-03-28T12:24:44Z","updated_at":"2019-03-28T12:24:44Z","author_association":"MEMBER","body":"This looks like a timezone issue, times are stored as UTC within Elasticsearch, and this document has timestamp from 23:23:57 which does match your range query. The UI seems to apply a timezone `+1` to it when visualizing it though. Note that you can provide a [timezone](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html#_time_zone_in_range_queries) as part of the range query if you want to leave your query as is, otherwise you would have to convert your range to UTC manually. Does this make sense to you?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478104357","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478104357","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":478104357,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODEwNDM1Nw==","user":{"login":"cawoodm","id":498834,"node_id":"MDQ6VXNlcjQ5ODgzNA==","avatar_url":"https://avatars2.githubusercontent.com/u/498834?v=4","gravatar_id":"","url":"https://api.github.com/users/cawoodm","html_url":"https://github.com/cawoodm","followers_url":"https://api.github.com/users/cawoodm/followers","following_url":"https://api.github.com/users/cawoodm/following{/other_user}","gists_url":"https://api.github.com/users/cawoodm/gists{/gist_id}","starred_url":"https://api.github.com/users/cawoodm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cawoodm/subscriptions","organizations_url":"https://api.github.com/users/cawoodm/orgs","repos_url":"https://api.github.com/users/cawoodm/repos","events_url":"https://api.github.com/users/cawoodm/events{/privacy}","received_events_url":"https://api.github.com/users/cawoodm/received_events","type":"User","site_admin":false},"created_at":"2019-03-29T18:31:49Z","updated_at":"2019-03-29T18:31:49Z","author_association":"CONTRIBUTOR","body":"I will try this (timezone) on monday and get back to you. For now I am wondering what timezone ES is defaulting to? Our server is CET, our client is CET, we never configured anything so I would expect a sensible default and not, say EST or GMT.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478130209","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478130209","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":478130209,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODEzMDIwOQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-03-29T19:57:10Z","updated_at":"2019-03-29T20:31:39Z","author_association":"MEMBER","body":"> Our server is CET, our client is CET, we never configured anything so I would expect a sensible default and not, say EST or GMT.\r\n\r\nThat is UTC, like @javanna already mentiond. More info in the [docs](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-datehistogram-aggregation.html#_timezone). Also I just checked that `timezone` is supported in date math expressions with rounding in `range` queries like in the example you mentioned.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478455421","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478455421","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":478455421,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODQ1NTQyMQ==","user":{"login":"cawoodm","id":498834,"node_id":"MDQ6VXNlcjQ5ODgzNA==","avatar_url":"https://avatars2.githubusercontent.com/u/498834?v=4","gravatar_id":"","url":"https://api.github.com/users/cawoodm","html_url":"https://github.com/cawoodm","followers_url":"https://api.github.com/users/cawoodm/followers","following_url":"https://api.github.com/users/cawoodm/following{/other_user}","gists_url":"https://api.github.com/users/cawoodm/gists{/gist_id}","starred_url":"https://api.github.com/users/cawoodm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cawoodm/subscriptions","organizations_url":"https://api.github.com/users/cawoodm/orgs","repos_url":"https://api.github.com/users/cawoodm/repos","events_url":"https://api.github.com/users/cawoodm/events{/privacy}","received_events_url":"https://api.github.com/users/cawoodm/received_events","type":"User","site_admin":false},"created_at":"2019-04-01T06:43:37Z","updated_at":"2019-04-01T06:43:37Z","author_association":"CONTRIBUTOR","body":"OK, I can confirm that works.\r\n```\r\n\"timestamp\": {\r\n    \"gte\": \"now-1d/d\",\r\n    \"lt\": \"now-0d/d\",\r\n    \"time_zone\": \"+01:00\"\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478461742","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478461742","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":478461742,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODQ2MTc0Mg==","user":{"login":"cawoodm","id":498834,"node_id":"MDQ6VXNlcjQ5ODgzNA==","avatar_url":"https://avatars2.githubusercontent.com/u/498834?v=4","gravatar_id":"","url":"https://api.github.com/users/cawoodm","html_url":"https://github.com/cawoodm","followers_url":"https://api.github.com/users/cawoodm/followers","following_url":"https://api.github.com/users/cawoodm/following{/other_user}","gists_url":"https://api.github.com/users/cawoodm/gists{/gist_id}","starred_url":"https://api.github.com/users/cawoodm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cawoodm/subscriptions","organizations_url":"https://api.github.com/users/cawoodm/orgs","repos_url":"https://api.github.com/users/cawoodm/repos","events_url":"https://api.github.com/users/cawoodm/events{/privacy}","received_events_url":"https://api.github.com/users/cawoodm/received_events","type":"User","site_admin":false},"created_at":"2019-04-01T07:08:52Z","updated_at":"2019-04-01T07:08:52Z","author_association":"CONTRIBUTOR","body":"Little help? Just trying to do a query with local dates (CET). I'm getting ` \"failed to parse date field [2019-03-31 00:00:00] with format [date_time||epoch_millis]\"`. I've tried `\"gte\": \"2019-03-31 00:00:00\"`, `\"gte\": \"2019-03-31 00:00:00.000\"`, `\"gte\": \"2019-03-31 00:00:00.0000000000\"` and `T` as a separator to no avail..","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478463967","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478463967","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":478463967,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODQ2Mzk2Nw==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2019-04-01T07:17:26Z","updated_at":"2019-04-01T07:17:26Z","author_association":"MEMBER","body":"please see the documentation for date formats in order to find out how a specific date format is structured: https://www.elastic.co/guide/en/elasticsearch/reference/6.6/mapping-date-format.html#built-in-date-formats","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478619274","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478619274","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":478619274,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODYxOTI3NA==","user":{"login":"cawoodm","id":498834,"node_id":"MDQ6VXNlcjQ5ODgzNA==","avatar_url":"https://avatars2.githubusercontent.com/u/498834?v=4","gravatar_id":"","url":"https://api.github.com/users/cawoodm","html_url":"https://github.com/cawoodm","followers_url":"https://api.github.com/users/cawoodm/followers","following_url":"https://api.github.com/users/cawoodm/following{/other_user}","gists_url":"https://api.github.com/users/cawoodm/gists{/gist_id}","starred_url":"https://api.github.com/users/cawoodm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cawoodm/subscriptions","organizations_url":"https://api.github.com/users/cawoodm/orgs","repos_url":"https://api.github.com/users/cawoodm/repos","events_url":"https://api.github.com/users/cawoodm/events{/privacy}","received_events_url":"https://api.github.com/users/cawoodm/received_events","type":"User","site_admin":false},"created_at":"2019-04-01T15:09:59Z","updated_at":"2019-04-01T15:09:59Z","author_association":"CONTRIBUTOR","body":"I did that, that's why I'm confused:\r\n\r\n> date_time or strict_date_time\r\nA formatter that combines a full date and time, separated by a T: yyyy-MM-dd'T'HH:mm:ss.SSSZZ.\r\n\r\nIN: `2019-03-30T00:00:00.00000`\r\nOUT: ERROR: `failed to parse date field [2019-03-30T00:00:00.000] with format [date_time||epoch_millis]`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478621046","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478621046","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":478621046,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODYyMTA0Ng==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2019-04-01T15:14:33Z","updated_at":"2019-04-01T15:14:33Z","author_association":"MEMBER","body":"your example in the [above comment](https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478461742) showed a completely different date format, thus my confusion. Can you please create a fully reproducible example with the new values your are using, including index creation/mapping and the full query?\r\n\r\nThanks a lot!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478674690","html_url":"https://github.com/elastic/elasticsearch/issues/40581#issuecomment-478674690","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40581","id":478674690,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODY3NDY5MA==","user":{"login":"cawoodm","id":498834,"node_id":"MDQ6VXNlcjQ5ODgzNA==","avatar_url":"https://avatars2.githubusercontent.com/u/498834?v=4","gravatar_id":"","url":"https://api.github.com/users/cawoodm","html_url":"https://github.com/cawoodm","followers_url":"https://api.github.com/users/cawoodm/followers","following_url":"https://api.github.com/users/cawoodm/following{/other_user}","gists_url":"https://api.github.com/users/cawoodm/gists{/gist_id}","starred_url":"https://api.github.com/users/cawoodm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cawoodm/subscriptions","organizations_url":"https://api.github.com/users/cawoodm/orgs","repos_url":"https://api.github.com/users/cawoodm/repos","events_url":"https://api.github.com/users/cawoodm/events{/privacy}","received_events_url":"https://api.github.com/users/cawoodm/received_events","type":"User","site_admin":false},"created_at":"2019-04-01T17:39:50Z","updated_at":"2019-04-01T17:39:50Z","author_association":"CONTRIBUTOR","body":"TLDR: I guess we just have to add the timezone to numeric dates - it doesn't get it from the `time_zone`.\r\n\r\nThe mapping is \"date_time\" and acc. the docs the only format it accepts is `yyyy-MM-ddThh:mm:ss.SSSZ` but I want to specify a local time so I dropped the `Z` and added `time_zone` to no avail.\r\n\r\nThe following works:\r\n\r\n```json\r\n{\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"filter\": [\r\n                {\r\n                    \"range\": {\r\n                        \"timestamp\": {\r\n                            \"gte\": \"2019-03-30T00:00:00.000+01:00\",\r\n                            \"lt\": \"2019-04-01T00:00:00.000+01:00\",\r\n                            \"time_zone\": \"+01:00\"\r\n                        }\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nBut not this:\r\n```json\r\n{\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"filter\": [\r\n                {\r\n                    \"range\": {\r\n                        \"timestamp\": {\r\n                            \"gte\": \"2019-03-30T00:00:00.000\",\r\n                            \"lt\": \"2019-04-01T00:00:00.000\",\r\n                            \"time_zone\": \"+01:00\"\r\n                        }\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    }\r\n}\r\n```","performed_via_github_app":null}]