[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75507415","html_url":"https://github.com/elastic/elasticsearch/issues/9802#issuecomment-75507415","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9802","id":75507415,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NTA3NDE1","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-02-23T08:53:26Z","updated_at":"2015-02-23T08:53:26Z","author_association":"CONTRIBUTOR","body":"this is related to #8993 \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75507474","html_url":"https://github.com/elastic/elasticsearch/issues/9802#issuecomment-75507474","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9802","id":75507474,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NTA3NDc0","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-02-23T08:53:52Z","updated_at":"2015-02-23T08:53:52Z","author_association":"CONTRIBUTOR","body":"@tlrx can you comment on this. I really wonder if the native library we load here is worth the trouble?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75524306","html_url":"https://github.com/elastic/elasticsearch/issues/9802#issuecomment-75524306","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9802","id":75524306,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NTI0MzA2","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-02-23T11:10:30Z","updated_at":"2015-02-23T11:10:30Z","author_association":"MEMBER","body":"@rmuir thanks for spotting it.\n\n> Does the functionality or just the test need to create these proxies? Can we avoid it? Otherwise, we can add this permission, but it is a little bit strange that JNA for e.g. unix mlockall does not need to create proxies but on windows it does.\n\nThe functionality makes a native call on Windows to add a console control handler. The current implementation uses proxification which is the best documented way to make a native call on Windows with the JNA library. The other way is to use [Direct Mapping](https://github.com/twall/jna/blob/master/www/DirectMapping.md) like what is done in the unix/mlockall function.\n\nIf these proxy creation is really annoying, I think I can change the code to use Direct Mapping in Kernel32Library too. \n\nBesides this, I didn't see a test for the `Native.tryMlockall()` method. I added one locally and it fails with SecurityManager enabled and the current test policy: \n\n```\nCaused by: java.security.AccessControlException: access denied (\"java.lang.RuntimePermission\" \"createSecurityManager\")\n```\n\n> I really wonder if the native library we load here is worth the trouble?\n\n#8993 relies on the [SetConsoleCtrlHandler function](https://msdn.microsoft.com/en-us/library/windows/desktop/ms683242%28v=vs.85%29.aspx) and was added to ensure that a node is correctly shutdown on Windows when the user closes the console that starts Elasticsearch (either by clicking Close on the console window's window menu, or by clicking the End Task button command from Task Manager, or with a TASKILL command like a stop script would do). I really think that's very important to gracefully stop the node... Without this, it's like kill -9 the JVM.\n\nSo I suggest to keep the native library (it will also be used for the mlockall equivalent on Windows) and unify the way the native calls are made in CLibrary/Kernel32Libray and limit the permissions to grant in the policy file, and finally add a test for Native.tryMlockall().\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75536745","html_url":"https://github.com/elastic/elasticsearch/issues/9802#issuecomment-75536745","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9802","id":75536745,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NTM2NzQ1","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-02-23T12:59:31Z","updated_at":"2015-02-23T12:59:31Z","author_association":"CONTRIBUTOR","body":"> So I suggest to keep the native library (it will also be used for the mlockall equivalent on Windows) and unify the way the native calls are made in CLibrary/Kernel32Libray and limit the permissions to grant in the policy file, and finally add a test for Native.tryMlockall().\n\n+1 that sounds great. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75542267","html_url":"https://github.com/elastic/elasticsearch/issues/9802#issuecomment-75542267","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9802","id":75542267,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NTQyMjY3","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-02-23T13:42:46Z","updated_at":"2015-02-23T13:42:46Z","author_association":"CONTRIBUTOR","body":"cool stuff!!\n","performed_via_github_app":null}]