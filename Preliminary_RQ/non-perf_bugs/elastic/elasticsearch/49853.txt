{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/49853","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49853/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49853/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49853/events","html_url":"https://github.com/elastic/elasticsearch/issues/49853","id":533282093,"node_id":"MDU6SXNzdWU1MzMyODIwOTM=","number":49853,"title":"Not getting response in Elasticsearch suggestion in elasticsearch7.2.1 version","user":{"login":"GeetaLakhwani-1","id":56623054,"node_id":"MDQ6VXNlcjU2NjIzMDU0","avatar_url":"https://avatars2.githubusercontent.com/u/56623054?v=4","gravatar_id":"","url":"https://api.github.com/users/GeetaLakhwani-1","html_url":"https://github.com/GeetaLakhwani-1","followers_url":"https://api.github.com/users/GeetaLakhwani-1/followers","following_url":"https://api.github.com/users/GeetaLakhwani-1/following{/other_user}","gists_url":"https://api.github.com/users/GeetaLakhwani-1/gists{/gist_id}","starred_url":"https://api.github.com/users/GeetaLakhwani-1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GeetaLakhwani-1/subscriptions","organizations_url":"https://api.github.com/users/GeetaLakhwani-1/orgs","repos_url":"https://api.github.com/users/GeetaLakhwani-1/repos","events_url":"https://api.github.com/users/GeetaLakhwani-1/events{/privacy}","received_events_url":"https://api.github.com/users/GeetaLakhwani-1/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-12-05T11:08:04Z","updated_at":"2019-12-06T06:35:05Z","closed_at":"2019-12-05T14:01:25Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\nTrying to add ElasticSearch Suggestion in my response and implementing it using SearchRequestBuilder as:-\r\n```\r\nSearchResponse searchResponse = searchRequestBuilder.execute().actionGet(3m);\r\n```\r\nQuery is correct as I tried to run in Kibana\r\n```\r\n{\"from\":0,\"size\":10,\"timeout\":\"10000ms\",\"query\":{\"bool\":{\"must\":[{\"function_score\":{\"query\":{\"bool\":{\"should\":[{\"match_phrase\":{\"title\":{\"query\":\"elastic\",\"slop\":0,\"zero_terms_query\":\"NONE\",\"boost\":0.01}}},{\"match_phrase\":{\"content\":{\"query\":\"elastic\",\"slop\":0,\"zero_terms_query\":\"NONE\",\"boost\":0.005}}},{\"match_phrase\":{\"filename\":{\"query\":\"elastic\",\"slop\":0,\"zero_terms_query\":\"NONE\",\"boost\":0.01}}},{\"match_phrase\":{\"all_values\":{\"query\":\"elastic\",\"slop\":0,\"zero_terms_query\":\"NONE\",\"boost\":0.005}}},{\"match_phrase\":{\"title_en\":{\"query\":\"elastic\",\"slop\":0,\"zero_terms_query\":\"NONE\",\"boost\":1.0}}},{\"match_phrase\":{\"content_en\":{\"query\":\"elastic\",\"slop\":0,\"zero_terms_query\":\"NONE\",\"boost\":0.5}}}],\"adjust_pure_negative\":true,\"boost\":1.0}},\"functions\":[{\"filter\":{\"match_all\":{\"boost\":1.0}},\"field_value_factor\":{\"field\":\"boost\",\"factor\":1.0,\"modifier\":\"none\"}},{\"filter\":{\"match_all\":{\"boost\":1.0}},\"field_value_factor\":{\"field\":\"click_count\",\"factor\":1.0,\"modifier\":\"none\"}}],\"score_mode\":\"sum\",\"max_boost\":1.5,\"boost\":1.0}}],\"filter\":[{\"bool\":{\"must_not\":[{\"term\":{\"role\":{\"value\":\"DRguest\",\"boost\":1.0}}},{\"term\":{\"role\":{\"value\":\"D1admin\",\"boost\":1.0}}},{\"term\":{\"role\":{\"value\":\"DRadmin\",\"boost\":1.0}}}],\"should\":[{\"term\":{\"role\":{\"value\":\"Rguest\",\"boost\":1.0}}},{\"term\":{\"role\":{\"value\":\"1admin\",\"boost\":1.0}}},{\"term\":{\"role\":{\"value\":\"Radmin\",\"boost\":1.0}}}],\"adjust_pure_negative\":true,\"boost\":1.0}}],\"adjust_pure_negative\":true,\"boost\":1.0}},\"_source\":{\"includes\":[\"score\",\"_id\",\"doc_id\",\"boost\",\"content_length\",\"host\",\"site\",\"last_modified\",\"timestamp\",\"mimetype\",\"filetype\",\"filename\",\"created\",\"title\",\"digest\",\"url\",\"thumbnail\",\"click_count\",\"favorite_count\",\"config_id\",\"lang\",\"has_cache\",\"filename\",\"url\",\"digest\",\"doc_id\",\"title\"],\"excludes\":[]},\"track_total_hits\":10000,\"aggregations\":{\"field:bGFiZWw=\":{\"terms\":{\"field\":\"label\",\"size\":100,\"min_doc_count\":1,\"shard_min_doc_count\":0,\"show_term_doc_count_error\":false,\"order\":[{\"_count\":\"desc\"},{\"_key\":\"asc\"}]}},\"query:dGltZXN0YW1wOltub3cvZC0xZCBUTyAqXQ==\":{\"filter\":{\"range\":{\"timestamp\":{\"from\":\"now/d-1d\",\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}}},\"query:dGltZXN0YW1wOltub3cvZC03ZCBUTyAqXQ==\":{\"filter\":{\"range\":{\"timestamp\":{\"from\":\"now/d-7d\",\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}}},\"query:dGltZXN0YW1wOltub3cvZC0xTSBUTyAqXQ==\":{\"filter\":{\"range\":{\"timestamp\":{\"from\":\"now/d-1M\",\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}}},\"query:dGltZXN0YW1wOltub3cvZC0xeSBUTyAqXQ==\":{\"filter\":{\"range\":{\"timestamp\":{\"from\":\"now/d-1y\",\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}}}},\"highlight\":{\"fields\":{\"content\":{\"fragment_size\":60,\"number_of_fragments\":2,\"type\":\"fvh\"}}},\r\n\"suggest\":{\"suggest_user\":{\"text\":\"elastic\",\"term\":{\"field\":\"title\",\"suggest_mode\":\"MISSING\",\"accuracy\":0.5,\"sort\":\"SCORE\",\"string_distance\":\"INTERNAL\",\"max_edits\":2,\"max_inspections\":5,\"max_term_freq\":0.01,\"prefix_length\":1,\"min_word_length\":4,\"min_doc_freq\":0.0}}}}\r\n```\r\nI tried to implement suggestion feature with the help of below code as in elasticsearch version 7.2:-\r\n```\r\nSearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\r\nSuggestionBuilder termSuggestionBuilder =SuggestBuilders.termSuggestion(\"user\").text(\"elast\"); \r\nSuggestBuilder suggestBuilder = new SuggestBuilder();\r\nsuggestBuilder.addSuggestion(\"suggest_user\", termSuggestionBuilder); \r\nsearchSourceBuilder.suggest(suggestBuilder);\r\n```\r\nWhen I tried to retrieve the sugestions with the help of TermSuggestion then not getting proper response and getting below exception:-\r\n\r\n```\r\nElasticsearchStatusException[{\"took\":164,\"timed_out\":false,\"_shards\":{\"total\":6,\"successful\":6,\"skipped\":0,\"failed\":0},\"hits\":{\"total\":{\"value\":1,\"relation\":\"eq\"},\"max_score\":0.43710136,\"hits\":[{\"_index\":\"nero.default.20191204\",\"_type\":\"_doc\",\"_id\":\"77db761c336df2368f06ea21404dab6ea14cac38b94bdbdd59da746ca52e6b8f9e715ab57afcecf1fd0a84a7cc480594231cfefa6a00a0809bef27ccde764a26\",\"_score\":0.43710136,\"_source\":{\"filetype\":\"html\",\"thumbnail\":\"https://www.elastic.co/static-res/images/elastic-logo-200.png\",\"created\":\"2019-12-05T06:51:41.356Z\",\"click_count\":0,\"title\":\"Open Source Search: The Creators of Elasticsearch, ELK Stack & Kibana | Elastic\",\"doc_id\":\"833795e12339437c9515e6d55b1c290b\",\"url\":\"https://www.elastic.co/\",\"site\":\"www.elastic.co/\",\"config_id\":\"Wcjxw0G4BzlTtvS7CtqfT\",\"has_cache\":\"true\",\"host\":\"www.elastic.co\",\"digest\":\"We're the creators of the Elastic (ELK) Stack -- Elasticsearch, Kibana, Beats, and Logstash. Securely and reliably search, analyze, and visualize your data in the cloud or on-prem.\",\"boost\":\"1.0\",\"favorite_count\":0,\"mimetype\":\"text/html\",\"lang\":\"en\",\"content_length\":\"2077723\",\"timestamp\":\"2019-12-05T06:51:41.356Z\"},\"highlight\":{\"content\":[\"the latest and greatest from <em>Elastic</em>. MarketoFEForm\"]}}]},\"aggregations\":{\"filter#query:dGltZXN0YW1wOltub3cvZC0xTSBUTyAqXQ==\":{\"meta\":{},\"doc_count\":1},\"filter#query:dGltZXN0YW1wOltub3cvZC03ZCBUTyAqXQ==\":{\"meta\":{},\"doc_count\":1},\"sterms#field:bGFiZWw=\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[]},\"filter#query:dGltZXN0YW1wOltub3cvZC0xeSBUTyAqXQ==\":{\"meta\":{},\"doc_count\":1},\"filter#query:dGltZXN0YW1wOltub3cvZC0xZCBUTyAqXQ==\":{\"meta\":{},\"doc_count\":1}},\"suggest\":{\"term#suggest_user\":[{\"text\":\"elast\",\"offset\":0,\"length\":7,\"options\":[]}]}}]; nested: NamedObjectNotFoundException[unknown named object category [org.elasticsearch.search.suggest.Suggest$Suggestion]];\r\n\r\nat org.codelibs.elasticsearch.client.action.HttpAction.toElasticsearchException(HttpAction.java:143)\r\nat org.codelibs.elasticsearch.client.action.HttpSearchAction.lambda$execute$0(HttpSearchAction.java:53)\r\nat org.codelibs.curl.CurlRequest.lambda$execute$4(CurlRequest.java:202)\r\nat org.codelibs.curl.CurlRequest.lambda$connect$3(CurlRequest.java:182)\r\nat java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1426)\r\nat java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:290)\r\nat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1020)\r\nat java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1656)\r\nat java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1594)\r\nat java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:177)\r\nSuppressed: org.elasticsearch.common.xcontent.NamedObjectNotFoundException: unknown named object category [org.elasticsearch.search.suggest.Suggest$Suggestion]\r\nat org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:128)\r\nat org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:415)\r\nat org.elasticsearch.common.xcontent.XContentParserUtils.parseTypedKeysObject(XContentParserUtils.java:153)\r\nat org.elasticsearch.search.suggest.Suggest$Suggestion.fromXContent(Suggest.java:436)\r\nat org.elasticsearch.search.suggest.Suggest.fromXContent(Suggest.java:192)\r\nat org.elasticsearch.action.search.SearchResponse.innerFromXContent(SearchResponse.java:294)\r\nat org.elasticsearch.action.search.SearchResponse.fromXContent(SearchResponse.java:251)\r\nat org.codelibs.elasticsearch.client.action.HttpSearchAction.lambda$execute$0(HttpSearchAction.java:46)\r\n... 8 more\r\nSuppressed: ParsingException[Failed to parse object: expecting field with name [error] but found [took]]\r\nat org.elasticsearch.common.xcontent.XContentParserUtils.ensureFieldName(XContentParserUtils.java:50)\r\nat org.elasticsearch.ElasticsearchException.failureFromXContent(ElasticsearchException.java:587)\r\nat org.elasticsearch.rest.BytesRestResponse.errorFromXContent(BytesRestResponse.java:169)at org.codelibs.elasticsearch.client.action.HttpAction.toElasticsearchException(HttpAction.java:138)\r\n [CIRCULAR REFERENCE:org.elasticsearch.common.xcontent.NamedObjectNotFoundException: unknown named object category [org.elasticsearch.search.suggest.Suggest$Suggestion]]\r\n```\r\n==============================================================\r\n\r\nAs I debugged this and found that registry content for suggestion from elasticsearch-httpclient-7.2.1.jar -> org.codelibs.elasticsearch.client.HttpClient -> getDefaultNamedXContents() is commented.\r\n```\r\n //        entries.add(new NamedXContentRegistry.Entry(Suggest.Suggestion.class, new ParseField(TermSuggestion.NAME),\r\n        //                (parser, context) -> TermSuggestion.fromXContent(parser, (String) context)));\r\n        //        entries.add(new NamedXContentRegistry.Entry(Suggest.Suggestion.class, new ParseField(PhraseSuggestion.NAME),\r\n        //                (parser, context) -> PhraseSuggestion.fromXContent(parser, (String) context)));\r\n        //        entries.add(new NamedXContentRegistry.Entry(Suggest.Suggestion.class, new ParseField(CompletionSuggestion.NAME),\r\n        //  (parser, context) -> CompletionSuggestion.fromXContent(parser, (String) context)));\r\n```\r\nCould you please advice why these lines are commented ?\r\nIs any other jar for elasticsearch suggestion?\r\nCould someone please help for the same.\r\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}