[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/242403195","html_url":"https://github.com/elastic/elasticsearch/issues/20161#issuecomment-242403195","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20161","id":242403195,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MjQwMzE5NQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-08-25T14:18:06Z","updated_at":"2016-08-25T14:18:06Z","author_association":"CONTRIBUTOR","body":"Hi @apidruchny \n\nI can reproduce this failure - something funny in the parsing of the `not` query.  That said, `and`, `or`, and `not` are deprecated and have been removed in 5.0.  You should rewrite this query to use `bool` instead:\n\n```\nPOST _search\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"post_filter\": {\n    \"bool\": {\n      \"must_not\": [\n        {\n          \"term\": {\n            \"field1\": \"1234\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nBy the way, use `post_filter` ONLY if you want to include documents in your aggregation that you then want to exclude from the returned `hits`.  Using it as a generic filtering mechanism is very inefficient\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/242409670","html_url":"https://github.com/elastic/elasticsearch/issues/20161#issuecomment-242409670","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20161","id":242409670,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MjQwOTY3MA==","user":{"login":"apidruchny","id":1816354,"node_id":"MDQ6VXNlcjE4MTYzNTQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1816354?v=4","gravatar_id":"","url":"https://api.github.com/users/apidruchny","html_url":"https://github.com/apidruchny","followers_url":"https://api.github.com/users/apidruchny/followers","following_url":"https://api.github.com/users/apidruchny/following{/other_user}","gists_url":"https://api.github.com/users/apidruchny/gists{/gist_id}","starred_url":"https://api.github.com/users/apidruchny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apidruchny/subscriptions","organizations_url":"https://api.github.com/users/apidruchny/orgs","repos_url":"https://api.github.com/users/apidruchny/repos","events_url":"https://api.github.com/users/apidruchny/events{/privacy}","received_events_url":"https://api.github.com/users/apidruchny/received_events","type":"User","site_admin":false},"created_at":"2016-08-25T14:34:40Z","updated_at":"2016-08-25T14:34:40Z","author_association":"NONE","body":"Yes, I know that boolean filters are deprecated, and post_filter is inefficient. This is just a distilled example. In reality our query is a much more complicated filtered query (no post_filter) and we are trying to migrate from version 1.7.5 to 2.3.5. Could this issue please be re-opened? Even being deprecated, the \"not\" filter should still work, to allow legacy applications to migrate to the current version of Elasticsearch. And this is exactly what we are trying to do.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/242410572","html_url":"https://github.com/elastic/elasticsearch/issues/20161#issuecomment-242410572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20161","id":242410572,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MjQxMDU3Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-08-25T14:36:57Z","updated_at":"2016-08-25T14:36:57Z","author_association":"CONTRIBUTOR","body":"Sure I can reopen it, but we're unlikely to fix deprecated functionality unless somebody sends a PR.  Why migrate to `not` when you're just going to have to repeat the migration for the next version anyway?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/242424761","html_url":"https://github.com/elastic/elasticsearch/issues/20161#issuecomment-242424761","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20161","id":242424761,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MjQyNDc2MQ==","user":{"login":"apidruchny","id":1816354,"node_id":"MDQ6VXNlcjE4MTYzNTQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1816354?v=4","gravatar_id":"","url":"https://api.github.com/users/apidruchny","html_url":"https://github.com/apidruchny","followers_url":"https://api.github.com/users/apidruchny/followers","following_url":"https://api.github.com/users/apidruchny/following{/other_user}","gists_url":"https://api.github.com/users/apidruchny/gists{/gist_id}","starred_url":"https://api.github.com/users/apidruchny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apidruchny/subscriptions","organizations_url":"https://api.github.com/users/apidruchny/orgs","repos_url":"https://api.github.com/users/apidruchny/repos","events_url":"https://api.github.com/users/apidruchny/events{/privacy}","received_events_url":"https://api.github.com/users/apidruchny/received_events","type":"User","site_admin":false},"created_at":"2016-08-25T15:16:00Z","updated_at":"2016-08-25T15:16:00Z","author_association":"NONE","body":"Thanks. We are not migrating to `not`, we are migrating to Elasticsearch 2.3.5 and the `not` filter is already used in a legacy application. Sure, it will be necessary to replace the `not` filter eventually, but we would prefer to not have to do it now when we are still on version 1.7.5.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/243535561","html_url":"https://github.com/elastic/elasticsearch/issues/20161#issuecomment-243535561","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20161","id":243535561,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MzUzNTU2MQ==","user":{"login":"apidruchny","id":1816354,"node_id":"MDQ6VXNlcjE4MTYzNTQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1816354?v=4","gravatar_id":"","url":"https://api.github.com/users/apidruchny","html_url":"https://github.com/apidruchny","followers_url":"https://api.github.com/users/apidruchny/followers","following_url":"https://api.github.com/users/apidruchny/following{/other_user}","gists_url":"https://api.github.com/users/apidruchny/gists{/gist_id}","starred_url":"https://api.github.com/users/apidruchny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apidruchny/subscriptions","organizations_url":"https://api.github.com/users/apidruchny/orgs","repos_url":"https://api.github.com/users/apidruchny/repos","events_url":"https://api.github.com/users/apidruchny/events{/privacy}","received_events_url":"https://api.github.com/users/apidruchny/received_events","type":"User","site_admin":false},"created_at":"2016-08-30T18:31:53Z","updated_at":"2016-08-30T18:31:53Z","author_association":"NONE","body":"There is a very easy workaround (adding \"filter\" element under \"not\"). I am going to close this issue. Thanks for looking at this issue. Following works:\n\n```\nPOST _search\n{\n    \"query\" : {\n        \"match_all\" : {}\n    },\n    \"post_filter\" : {\n        \"not\" : {\n            \"filter\" : {\n                \"and\" : [\n                    {\n                        \"query\" : {\n                            \"term\" : {\n                                \"field1\" : \"1234\"\n                            }\n                        }\n                    }\n                ]\n            }\n        }\n    }\n}\n```\n","performed_via_github_app":null}]