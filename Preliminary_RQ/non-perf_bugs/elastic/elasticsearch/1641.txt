{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1641","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1641/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1641/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1641/events","html_url":"https://github.com/elastic/elasticsearch/issues/1641","id":2978753,"node_id":"MDU6SXNzdWUyOTc4NzUz","number":1641,"title":"Highlighting broken after 0.18.5 when using CustomScoreQuery","user":{"login":"bjornlilja","id":444118,"node_id":"MDQ6VXNlcjQ0NDExOA==","avatar_url":"https://avatars3.githubusercontent.com/u/444118?v=4","gravatar_id":"","url":"https://api.github.com/users/bjornlilja","html_url":"https://github.com/bjornlilja","followers_url":"https://api.github.com/users/bjornlilja/followers","following_url":"https://api.github.com/users/bjornlilja/following{/other_user}","gists_url":"https://api.github.com/users/bjornlilja/gists{/gist_id}","starred_url":"https://api.github.com/users/bjornlilja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bjornlilja/subscriptions","organizations_url":"https://api.github.com/users/bjornlilja/orgs","repos_url":"https://api.github.com/users/bjornlilja/repos","events_url":"https://api.github.com/users/bjornlilja/events{/privacy}","received_events_url":"https://api.github.com/users/bjornlilja/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2012-01-26T12:25:44Z","updated_at":"2012-05-04T14:33:02Z","closed_at":"2012-05-04T14:33:02Z","author_association":"NONE","active_lock_reason":null,"body":"Hi\n\nWe are using Elasticsearch with pyes (0.16.0) and CustomScoreQuery. When upgrading from ES 0.18.5 to 0.18.6 or higher the highlighting beaks. \n\nExample _broken_ query:\n\n{\"custom_score\": {\"query\": {\"bool\": {\"must\": [{\"query_string\": {\"fields\": [\"title\", \"text\", \"org_comments_text\", \"other_comments_text\", \"tags\"], \"query\": \"filmer\"}}]}}, \"script\": \"_score \\* (1 + (0.5 \\* min((max(7 - ((time() - doc['last_activity'].value)/(1000_60_60_24)), 0)), 1)_0.1) + (0.5 \\* min((max(30 - ((time() - doc['last_activity'].value)/(1000_60_60_24)), 0)), 1)_0.1) + (1.0 \\* min((max(90 - ((time() - doc['last_activity'].value)/(1000_60_60_24)), 0)), 1)_0.1) + (2 \\* min((max(180 - ((time() - doc['last_activity'].value)/(1000_60_60_24)), 0)), 1)_0.1))\"}}\n\nExample of _working_ query: \n{\"bool\": {\"must\": [{\"query_string\": {\"fields\": [\"title\", \"text\", \"org_comments_text\", \"other_comments_text\", \"tags\"], \"query\": \"kundo\"}}]}} \n\nWhen reading the changelog it appears as this fix could be the cause: \nhttps://github.com/elasticsearch/elasticsearch/commit/be282cc4c8b44956be4ec98be73061ca3e25b73a\n\nIssue #1314 from september 2011 raises the same issue, has it perhaps reappeared by the above fix? \n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}