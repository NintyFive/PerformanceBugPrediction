{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/753","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/753/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/753/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/753/events","html_url":"https://github.com/elastic/elasticsearch/issues/753","id":653126,"node_id":"MDU6SXNzdWU2NTMxMjY=","number":753,"title":"Inconsistent results when re-running queries.","user":{"login":"rboulton","id":73564,"node_id":"MDQ6VXNlcjczNTY0","avatar_url":"https://avatars2.githubusercontent.com/u/73564?v=4","gravatar_id":"","url":"https://api.github.com/users/rboulton","html_url":"https://github.com/rboulton","followers_url":"https://api.github.com/users/rboulton/followers","following_url":"https://api.github.com/users/rboulton/following{/other_user}","gists_url":"https://api.github.com/users/rboulton/gists{/gist_id}","starred_url":"https://api.github.com/users/rboulton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rboulton/subscriptions","organizations_url":"https://api.github.com/users/rboulton/orgs","repos_url":"https://api.github.com/users/rboulton/repos","events_url":"https://api.github.com/users/rboulton/events{/privacy}","received_events_url":"https://api.github.com/users/rboulton/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2011-03-07T16:33:45Z","updated_at":"2014-02-24T12:16:33Z","closed_at":"2013-04-04T18:41:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I'm getting inconsistent results when running a query multiple times in succession.  The following is a minimal example that reproduces this for me.  The index contains around 80,000 docs, and is using the default sharding configuration (5 shards).  There are 2 nodes in the cluster.  Cluster status is green, and has been running for a couple of days since the initial indexing.  No changes currently happening.\n\nRunning the following shell command to run the same query every second, on an index which is not being modified at all:\n\n```\n$ while :; do curl -XGET http://hostname.amazonaws.com:9200/core/galleries.Gallery/_search -d \"{\\\"query\\\": {\\\"field\\\": {\\\"_id\\\": \\\"392\\\"}}, \\\"from\\\": 0, \\\"size\\\": 10}\"; echo; sleep 1; done\n```\n\nOutput is multiple lines not finding any documents:\n\n```\n{\"took\":3,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"hits\":{\"total\":0,\"max_score\":null,\"hits\":[]}}\n{\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"hits\":{\"total\":0,\"max_score\":null,\"hits\":[]}}\n{\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"hits\":{\"total\":0,\"max_score\":null,\"hits\":[]}}\n```\n\nAt this point, I ran the following in a separate console:\n\n```\n$ curl -XGET http://hostname.amazonaws.com:9200/core/galleries.Gallery/392;\n```\n\nwhich returned:\n\n```\n{\"_index\":\"core_4d6fc008\",\"_type\":\"galleries.Gallery\",\"_id\":\"392\",\"_version\":1, \"_source\" : {\"known_as\": [], \"score\": 5, \"name\": [\"National Museums Liverpool, Walker Art Gallery\"]}}\n```\n\nAfter this point, the output in the first console changed to repeat:\n\n```\n{\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":9.345693,\"hits\":[{\"_index\":\"core_4d6fc008\",\"_type\":\"galleries.Gallery\",\"_id\":\"392\",\"_score\":9.345693, \"_source\" : {\"known_as\": [], \"score\": 5, \"name\": [\"National Museums Liverpool, Walker Art Gallery\"]}}]}}\n{\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":9.345693,\"hits\":[{\"_index\":\"core_4d6fc008\",\"_type\":\"galleries.Gallery\",\"_id\":\"392\",\"_score\":9.345693, \"_source\" : {\"known_as\": [], \"score\": 5, \"name\": [\"National Museums Liverpool, Walker Art Gallery\"]}}]}}\n```\n\nLeaving the cluster alone for a few minutes, then re-running the original query, it starts returning no results again.\n\nI'm also seeing other more complex searches missing some (but not all) of the results after refreshing; the search described above is just for one of the documents which was only occasionally returned by such a search.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}