{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30882","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30882/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30882/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30882/events","html_url":"https://github.com/elastic/elasticsearch/issues/30882","id":326598007,"node_id":"MDU6SXNzdWUzMjY1OTgwMDc=","number":30882,"title":"Cannot install old version trial license","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"labels":[{"id":912841668,"node_id":"MDU6TGFiZWw5MTI4NDE2Njg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/License","name":":Security/License","color":"0e8a16","default":false,"description":"License functionality for commercial features"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"assignees":[{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-05-25T16:58:29Z","updated_at":"2019-02-07T08:30:42Z","closed_at":"2018-05-31T20:05:59Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This was raised by the ingest team. They were attempting to register a trial license that was not updated to the current version (`VERSION_CRYPTO_ALGORITHMS`). When this happens, there is a cluster state listener that notices that the license is of type `trial` and is an outdated version.\r\n\r\n`LicenseService.java`\r\n```\r\nif (currentClusterState.getNodes().isLocalNodeElectedMaster() &&\r\n                    (noLicense || LicenseUtils.licenseNeedsExtended(currentLicense) || LicenseUtils.signatureNeedsUpdate(currentLicense))) {\r\n                registerOrUpdateSelfGeneratedLicense();\r\n            }\r\n```\r\n\r\nLicenseUtils.signatureNeedsUpdate(currentLicense) is the operative line.\r\n\r\nThat schedules the `StartupSelfGeneratedLicenseTask`. \r\n\r\nThis task updates the license to the newer version. In order to do this it takes the issue date and adds the self generated expiration milliseconds (30 days). However, this license was created in 2014 and expires in 2030. So it is overwritten with a self generated license that has already expired (30 days from the issue date in 2014).\r\n\r\nI do not know the specific behavior that we want here (I am not familiar with the `LicenseUtils.signatureNeedsUpdate` work). Do we want to be replacing registered `trial` licenses with self generated trial licenses? Maybe if the license is not self generated, we want to reuse the expiration date opposed to the issue date + self generated duration (30 days)?\r\n\r\n@elastic/es-security \r\n\r\nAssigning @jkakavas because he introduced the `LicenseUtils.signatureNeedsUpdate` work.","closed_by":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"performed_via_github_app":null}