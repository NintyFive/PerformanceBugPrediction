{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/56536","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56536/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56536/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56536/events","html_url":"https://github.com/elastic/elasticsearch/issues/56536","id":616092637,"node_id":"MDU6SXNzdWU2MTYwOTI2Mzc=","number":56536,"title":"Expose Snapshot Repository Size via API?","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-05-11T18:33:15Z","updated_at":"2020-05-12T12:13:27Z","closed_at":"2020-05-12T12:13:27Z","author_association":"MEMBER","active_lock_reason":null,"body":"This is an ask from ECE/ECK:\r\n\r\nThere is interest in being able to get the byte-size of a snapshot repository via an API. \r\n\r\nTechnically (and naively) this could currently be implemented by loading `RepositoryData`, reading the shard-generations for each shard snapshot folder from the repository and then aggregating that data read from all the `index-{uuid}` blobs.\r\nWhile the repository metadata currently has the data available practically, this approach would mean reading as many blobs as we have shards in the repository (this could be a lot). So the naive approach is not great in its performance characteristics. \r\n\r\nOn the other hand, requests of similar or even higher cost/time are currently possible getting the status for all snapshots via the `_/snapshot/repo/_all/_status` call) so outright exposing this functionality and optimizing later would be an option potentially. \r\nThe alternative would be to improve the repository metadata such that we could respond to a request for the size of a repository  The problem with this is, that our BwC approach would then lead to that kind of new metadata not being available for existing repositories (so we'd either have to error out on the API request for those or fall back to something that loads all the shard metadata after all).\r\n\r\nMarking this as discuss so we can talk about it during snapshot resiliency sync.","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}