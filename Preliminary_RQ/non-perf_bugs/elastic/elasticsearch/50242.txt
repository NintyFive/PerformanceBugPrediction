{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50242","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50242/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50242/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50242/events","html_url":"https://github.com/elastic/elasticsearch/issues/50242","id":538532724,"node_id":"MDU6SXNzdWU1Mzg1MzI3MjQ=","number":50242,"title":"[Docs] Provide best practices for upgrading large clusters","user":{"login":"rwaight","id":43173714,"node_id":"MDQ6VXNlcjQzMTczNzE0","avatar_url":"https://avatars1.githubusercontent.com/u/43173714?v=4","gravatar_id":"","url":"https://api.github.com/users/rwaight","html_url":"https://github.com/rwaight","followers_url":"https://api.github.com/users/rwaight/followers","following_url":"https://api.github.com/users/rwaight/following{/other_user}","gists_url":"https://api.github.com/users/rwaight/gists{/gist_id}","starred_url":"https://api.github.com/users/rwaight/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rwaight/subscriptions","organizations_url":"https://api.github.com/users/rwaight/orgs","repos_url":"https://api.github.com/users/rwaight/repos","events_url":"https://api.github.com/users/rwaight/events{/privacy}","received_events_url":"https://api.github.com/users/rwaight/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":151933706,"node_id":"MDU6TGFiZWwxNTE5MzM3MDY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eupgrade","name":">upgrade","color":"c7def8","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-12-16T16:54:10Z","updated_at":"2020-03-18T14:33:00Z","closed_at":"2020-03-18T14:33:00Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:  \r\nIn addition to the best practices provided in [elastic/elasticsearch#47028](https://github.com/elastic/elasticsearch/issues/47028), the upgrade documentation should be improved to include guidance around performing \"batch\" restarts when upgrading a large cluster.\r\n\r\nWe should provide guidance to only upgrade nodes in small batches at a time (maybe a percentage of the node count? 5% or 10%?). For a 100 node cluster, our recommendation would be to bring up 10 nodes, wait for the upgraded nodes to join the cluster (or a minimum time of 3-5 minutes) then bring up 10 more nodes; this process would be repeated until all nodes were upgraded.\r\n\r\nThe reason for this request is due flooding master nodes when upgrading large clusters. At a high level, this can occur if a batch restart is performed when upgrading a cluster with 100-150 nodes. When all of the nodes are brought back online at the same time, they end up DDOSing the master nodes. This can cause the master nodes to become unresponsive, which can cause any nodes that have already joined the cluster to be kicked from the cluster due to communication timeouts.","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}