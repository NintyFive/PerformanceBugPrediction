{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37643","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37643/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37643/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37643/events","html_url":"https://github.com/elastic/elasticsearch/issues/37643","id":401196743,"node_id":"MDU6SXNzdWU0MDExOTY3NDM=","number":37643,"title":"Installing repository-gcs kills elasticsearch","user":{"login":"cafuego","id":148719,"node_id":"MDQ6VXNlcjE0ODcxOQ==","avatar_url":"https://avatars2.githubusercontent.com/u/148719?v=4","gravatar_id":"","url":"https://api.github.com/users/cafuego","html_url":"https://github.com/cafuego","followers_url":"https://api.github.com/users/cafuego/followers","following_url":"https://api.github.com/users/cafuego/following{/other_user}","gists_url":"https://api.github.com/users/cafuego/gists{/gist_id}","starred_url":"https://api.github.com/users/cafuego/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cafuego/subscriptions","organizations_url":"https://api.github.com/users/cafuego/orgs","repos_url":"https://api.github.com/users/cafuego/repos","events_url":"https://api.github.com/users/cafuego/events{/privacy}","received_events_url":"https://api.github.com/users/cafuego/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":73544,"node_id":"MDU6TGFiZWw3MzU0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Enon-issue","name":">non-issue","color":"cfcfcf","default":false,"description":null},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"assignees":[{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-01-21T05:16:25Z","updated_at":"2020-11-11T21:56:04Z","closed_at":"2019-01-21T14:15:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.5.4\r\n\r\n**Plugins installed**: [ingest-geoip, ingest-user-agent]\r\n\r\n**JVM version** (`java -version`):  As shipped in the container.\r\n\r\n```\r\nsh-4.2# /opt/jdk-11.0.1/bin/java -version\r\nopenjdk version \"11.0.1\" 2018-10-16\r\nOpenJDK Runtime Environment 18.9 (build 11.0.1+13)\r\nOpenJDK 64-Bit Server VM 18.9 (build 11.0.1+13, mixed mode)\r\n```\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\nDocker 18.09.1 on both MacOS and on CentOS 7.\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI'm trying up update our docker based ELK 5.6.7 setup to 6.5.4. The upgrade assistant in Kibana reports no errors (though there are warnings). I kept getting silent fails (no logs, no console output, just ES and container exit)\r\n\r\nSince I got no logs, I set up a local copy (minus the data) to see if I could replicate the issue. I can spin up an ES instance when I use all the default sample settings from the ES docker guide, but the instance exits (without any explanatory logs) the moment I install the gcs-archive plugin.\r\n\r\nI am able to restart the local ES instance and ask it about installed plugins, the response I get is:\r\n\r\n```\r\nsh-4.2# ./bin/elasticsearch-plugin list\r\n.installing-17043088347915376259\r\ningest-geoip\r\ningest-user-agent\r\n```\r\n\r\nSo something is going wrong somewhere along the way. \r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Create a docker based ES instance using the sample docker config from https://www.elastic.co/guide/en/elasticsearch/reference/6.5/docker.html\r\n 2. Open a shell in the elasticsearch container and run `elasticsearch-plugin install --batch repository-gcs`\r\n 3. Oops\r\n\r\n**Provide logs (if relevant)**:\r\n\r\nThe final output from `docker-compose up elasticsearch`:\r\n\r\n```\r\nelk-elasticsearch | [2019-01-21T05:07:31,811][INFO ][o.e.l.LicenseService     ] [YGTwYNK] license [7619b178-262b-4760-bae6-0ab354ed7b19] mode [basic] - valid\r\nelk-elasticsearch | [2019-01-21T05:07:31,857][INFO ][o.e.g.GatewayService     ] [YGTwYNK] recovered [1] indices into cluster_state\r\nelk-elasticsearch | [2019-01-21T05:07:32,652][INFO ][o.e.c.r.a.AllocationService] [YGTwYNK] Cluster health status changed from [RED] to [GREEN] (reason: [shards started [[.kibana_1][0]] ...]).\r\nelk-elasticsearch | [2019-01-21T05:08:00,075][INFO ][o.e.c.r.a.DiskThresholdMonitor] [YGTwYNK] low disk watermark [85%] exceeded on [YGTwYNKlQ6GH90riIRkshA][YGTwYNK]\r\n[snip a few repeats]\r\nelk-elasticsearch | [2019-01-21T05:09:30,071][INFO ][o.e.c.r.a.DiskThresholdMonitor] [YGTwYNK] low disk watermark [85%] exceeded on [YGTwYNKlQ6GH90riIRkshA][YGTwYNK][/usr/share/elasticsearch/data/nodes/0] free: 54.3gb[11.6%], replicas will not be assigned to this node\r\nelk-elasticsearch | [2019-01-21T05:09:32,560][INFO ][o.e.x.m.j.p.NativeController] [YGTwYNK] Native controller process has stopped - no new native processes can be started\r\nelk-elasticsearch exited with code 137\r\n```","closed_by":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}