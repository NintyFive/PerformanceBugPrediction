[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69751745","html_url":"https://github.com/elastic/elasticsearch/issues/9167#issuecomment-69751745","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9167","id":69751745,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NzUxNzQ1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-13T14:30:45Z","updated_at":"2015-01-13T14:30:45Z","author_association":"CONTRIBUTOR","body":"Hi @yedeng \n\nI can't test this with `_ip` as I only have one IP address, but you said that you're seeing similar problems when using `_name`.\n\ni tried this out with `_name`, and a single index created with the default settings, and everything worked as expected.  Could you provide a complete recreation of the problem using `_name` (so that I can test it out as well), and also provide the output of: `GET /_cat/shards` at each step, so that I can see what you are seeing.\n\nthanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69797533","html_url":"https://github.com/elastic/elasticsearch/issues/9167#issuecomment-69797533","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9167","id":69797533,"node_id":"MDEyOklzc3VlQ29tbWVudDY5Nzk3NTMz","user":{"login":"yedeng","id":5913307,"node_id":"MDQ6VXNlcjU5MTMzMDc=","avatar_url":"https://avatars2.githubusercontent.com/u/5913307?v=4","gravatar_id":"","url":"https://api.github.com/users/yedeng","html_url":"https://github.com/yedeng","followers_url":"https://api.github.com/users/yedeng/followers","following_url":"https://api.github.com/users/yedeng/following{/other_user}","gists_url":"https://api.github.com/users/yedeng/gists{/gist_id}","starred_url":"https://api.github.com/users/yedeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yedeng/subscriptions","organizations_url":"https://api.github.com/users/yedeng/orgs","repos_url":"https://api.github.com/users/yedeng/repos","events_url":"https://api.github.com/users/yedeng/events{/privacy}","received_events_url":"https://api.github.com/users/yedeng/received_events","type":"User","site_admin":false},"created_at":"2015-01-13T18:53:42Z","updated_at":"2015-01-13T19:10:36Z","author_association":"NONE","body":"I setup the same ES cluster in AWS cloud, and do the test again.\n\nFour nodes (node-0, node-1, node-2, and node-6) form the ES cluster. There is only one index saved in the ES cluster. The cluster has one master node (node-0) without saving any shard. All shards are saved in node-1, node-2, and node-6.\n\nThis time, I firstly try to decommission multiple nodes. Then, I try to decommission single nodes.\n\n//before any decommission action:\nGET http://ip.of.master.node:9200/_cat/shards\nlogstash-2015.01.13 4     p      STARTED 278   72.1kb 10.165.74.90   node-2 \nlogstash-2015.01.13 4     r      STARTED 278   71.9kb 10.237.168.143 node-6 \nlogstash-2015.01.13 0     p      STARTED 275   72.6kb 10.149.68.176  node-1 \nlogstash-2015.01.13 0     r      STARTED 275   77.8kb 10.237.168.143 node-6 \nlogstash-2015.01.13 3     p      STARTED 276     72kb 10.149.68.176  node-1 \nlogstash-2015.01.13 3     r      STARTED 276   60.2kb 10.165.74.90   node-2 \nlogstash-2015.01.13 1     p      STARTED 289   62.7kb 10.165.74.90   node-2 \nlogstash-2015.01.13 1     r      STARTED 289   75.1kb 10.237.168.143 node-6 \nlogstash-2015.01.13 2     r      STARTED 282   72.9kb 10.149.68.176  node-1 \nlogstash-2015.01.13 2     p      STARTED 282   72.4kb 10.237.168.143 node-6 \n\n//try to decomission node-1 and node-2.\ncurl -XPUT ip.of.master.node:9200/_cluster/settings -d '{\n    \"transient\" : {\n        \"cluster.routing.allocation.exclude._name\" : \"node-1,node-2\"\n    }\n}'\n//wait a long time, check shards\nGET http://ip.of.master.node:9200/_cat/shards\nlogstash-2015.01.13 4     p      STARTED  278  72.1kb 10.165.74.90   node-2 \nlogstash-2015.01.13 4     r      STARTED  278  71.9kb 10.237.168.143 node-6 \nlogstash-2015.01.13 0     p      STARTED  275  72.6kb 10.149.68.176  node-1 \nlogstash-2015.01.13 0     r      STARTED  275  77.8kb 10.237.168.143 node-6 \nlogstash-2015.01.13 3     r      STARTED  276  60.2kb 10.165.74.90   node-2\nlogstash-2015.01.13 3     p      STARTED  276    72kb 10.237.168.143 node-6 \nlogstash-2015.01.13 1     p      STARTED  289  62.7kb 10.165.74.90   node-2 \nlogstash-2015.01.13 1     r      STARTED  289  75.1kb 10.237.168.143 node-6 \nlogstash-2015.01.13 2     r      STARTED  282  72.9kb 10.149.68.176  node-1 \nlogstash-2015.01.13 2     p      STARTED  282  72.4kb 10.237.168.143 node-6 \n\n//reset \"exclude._name\"\ncurl -XPUT ip.of.master.node:9200/_cluster/settings -d '{\n    \"transient\" : {\n        \"cluster.routing.allocation.exclude._name\" : \"\"\n    }\n}'\n//check shards \nGET http://ip.of.master.node:9200/_cat/shards\nlogstash-2015.01.13 4     p      STARTED  278  72.1kb 10.165.74.90   node-2 \nlogstash-2015.01.13 4     r      STARTED  278  71.9kb 10.237.168.143 node-6 \nlogstash-2015.01.13 0     p      STARTED  275  72.6kb 10.149.68.176  node-1 \nlogstash-2015.01.13 0     r      STARTED  275  77.8kb 10.237.168.143 node-6 \nlogstash-2015.01.13 3     r      STARTED  276  60.2kb 10.165.74.90   node-2 \nlogstash-2015.01.13 3     p      STARTED  276    72kb 10.237.168.143 node-6 \nlogstash-2015.01.13 1     r      STARTED  289  62.7kb 10.149.68.176  node-1 \nlogstash-2015.01.13 1     p      STARTED  289  62.7kb 10.165.74.90   node-2 \nlogstash-2015.01.13 2     r      STARTED  282  72.9kb 10.149.68.176  node-1 \nlogstash-2015.01.13 2     p      STARTED  282  72.4kb 10.237.168.143 node-6 \n\n//only decommission \"node-1\"\ncurl -XPUT ip.of.master.node:9200/_cluster/settings -d '{\n    \"transient\" : {\n        \"cluster.routing.allocation.exclude._name\" : \"node-1\"\n    }\n}'\n//check shards\nGET http://ip.of.master.node:9200/_cat/shards\nlogstash-2015.01.13 2     r      STARTED  282 72.3kb 10.165.74.90   node-2 \nlogstash-2015.01.13 2     p      STARTED  282 72.4kb 10.237.168.143 node-6 \nlogstash-2015.01.13 0     p      STARTED  275 72.5kb 10.165.74.90   node-2 \nlogstash-2015.01.13 0     r      STARTED  275 77.8kb 10.237.168.143 node-6 \nlogstash-2015.01.13 3     r      STARTED  276 60.2kb 10.165.74.90   node-2 \nlogstash-2015.01.13 3     p      STARTED  276   72kb 10.237.168.143 node-6 \nlogstash-2015.01.13 1     p      STARTED  289 62.7kb 10.165.74.90   node-2 \nlogstash-2015.01.13 1     r      STARTED  289 62.7kb 10.237.168.143 node-6 \nlogstash-2015.01.13 4     p      STARTED  278 72.1kb 10.165.74.90   node-2 \nlogstash-2015.01.13 4     r      STARTED  278 71.9kb 10.237.168.143 node-6 \n\n//only decommission \"node-2\"\ncurl -XPUT ip.of.master.node:9200/_cluster/settings -d '{\n    \"transient\" : {\n        \"cluster.routing.allocation.exclude._name\" : \"node-2\"\n    }\n}'\n//check shards\nGET http://ip.of.master.node:9200/_cat/shards\nlogstash-2015.01.13 2     r      STARTED  282 72.3kb 10.149.68.176  node-1 \nlogstash-2015.01.13 2     p      STARTED  282 72.4kb 10.237.168.143 node-6 \nlogstash-2015.01.13 0     p      STARTED  275 72.5kb 10.149.68.176  node-1 \nlogstash-2015.01.13 0     r      STARTED  275 77.8kb 10.237.168.143 node-6 \nlogstash-2015.01.13 3     r      STARTED  276   72kb 10.149.68.176  node-1 \nlogstash-2015.01.13 3     p      STARTED  276   72kb 10.237.168.143 node-6 \nlogstash-2015.01.13 1     p      STARTED  289 62.7kb 10.149.68.176  node-1 \nlogstash-2015.01.13 1     r      STARTED  289 62.7kb 10.237.168.143 node-6 \nlogstash-2015.01.13 4     p      STARTED  278   72kb 10.149.68.176  node-1 \nlogstash-2015.01.13 4     r      STARTED  278 71.9kb 10.237.168.143 node-6 \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/70147860","html_url":"https://github.com/elastic/elasticsearch/issues/9167#issuecomment-70147860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9167","id":70147860,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMTQ3ODYw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-15T19:40:37Z","updated_at":"2015-01-15T19:40:37Z","author_association":"CONTRIBUTOR","body":"OK - all that is happening here is that Elasticsearch is unable to satisfy your request, because you need at least two nodes to host the primaries and the replicas.\n\nIf you reduce the number of replicas to 0 and set exclude to \"node-1,node-2\" then it will put all of the shards on node-6 only\n","performed_via_github_app":null}]