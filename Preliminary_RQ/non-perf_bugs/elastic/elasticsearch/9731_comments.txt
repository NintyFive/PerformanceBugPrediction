[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/74752336","html_url":"https://github.com/elastic/elasticsearch/issues/9731#issuecomment-74752336","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9731","id":74752336,"node_id":"MDEyOklzc3VlQ29tbWVudDc0NzUyMzM2","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-02-17T21:01:36Z","updated_at":"2015-02-17T21:01:36Z","author_association":"MEMBER","body":"@ebradshaw That sounds like a fine idea to me. Do you want to create a PR making IndexUpgraderOneMerge have a delegate OneMerge instead of calling the current super?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/74775457","html_url":"https://github.com/elastic/elasticsearch/issues/9731#issuecomment-74775457","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9731","id":74775457,"node_id":"MDEyOklzc3VlQ29tbWVudDc0Nzc1NDU3","user":{"login":"ebradshaw","id":3810632,"node_id":"MDQ6VXNlcjM4MTA2MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/3810632?v=4","gravatar_id":"","url":"https://api.github.com/users/ebradshaw","html_url":"https://github.com/ebradshaw","followers_url":"https://api.github.com/users/ebradshaw/followers","following_url":"https://api.github.com/users/ebradshaw/following{/other_user}","gists_url":"https://api.github.com/users/ebradshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ebradshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebradshaw/subscriptions","organizations_url":"https://api.github.com/users/ebradshaw/orgs","repos_url":"https://api.github.com/users/ebradshaw/repos","events_url":"https://api.github.com/users/ebradshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ebradshaw/received_events","type":"User","site_admin":false},"created_at":"2015-02-17T23:09:26Z","updated_at":"2015-02-17T23:09:26Z","author_association":"NONE","body":"@rjernst I'll go ahead and get on that.  Thanks.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75175597","html_url":"https://github.com/elastic/elasticsearch/issues/9731#issuecomment-75175597","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9731","id":75175597,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MTc1NTk3","user":{"login":"ebradshaw","id":3810632,"node_id":"MDQ6VXNlcjM4MTA2MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/3810632?v=4","gravatar_id":"","url":"https://api.github.com/users/ebradshaw","html_url":"https://github.com/ebradshaw","followers_url":"https://api.github.com/users/ebradshaw/followers","following_url":"https://api.github.com/users/ebradshaw/following{/other_user}","gists_url":"https://api.github.com/users/ebradshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ebradshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebradshaw/subscriptions","organizations_url":"https://api.github.com/users/ebradshaw/orgs","repos_url":"https://api.github.com/users/ebradshaw/repos","events_url":"https://api.github.com/users/ebradshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ebradshaw/received_events","type":"User","site_admin":false},"created_at":"2015-02-20T01:39:14Z","updated_at":"2015-02-20T01:39:14Z","author_association":"NONE","body":"@rjernst So I started digging into this, only to quickly realize that Lucene's current rendition of MergePolicy.OneMerge will not support delegation.  This is due to the direct member variable access of the various variables used by IndexWriter.  When a wrapping OneMerge delegates to another OneMerge, it quickly runs into issues since the member variables of the delegate have not and cannot be initialized by the IndexWriter.\n\nThis bummed me out for a bit, because I think that the ability to apply the decorator pattern to the merge/CodecReader logic would be useful in more cases than this one.  After some more digging, I realized that this could be resolved by making all of the member variables in OneMerge private and adding appropriately restricted getters and setters.  It requires a fair amount of variable access code change in the IndexWriter and a few other classes, but will have no impact on the overall logic involved.  Once this is done, a DelegatingOneMerge could be created and used as the base class for most of the other OneMerges.  Here are some Gists:\n\n[DelegatingOneMerge](https://gist.github.com/ebradshaw/e0b74e9e8d4976ab9e0a)\n[OneMerge](https://gist.github.com/ebradshaw/d72116a014f226076303)\n\nI've begun a PR in Lucene for this change.  Do you or anyone else see any reasons why these modifications might be a problem?  The only API change that I see occuring as a result would be that the public variable access of estimatedMergeBytes, segments and totalDocCount would have to be locked down and changed to public getters.\n\nIf you have any alternative thoughts or suggestions, I'm all ears.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/162214625","html_url":"https://github.com/elastic/elasticsearch/issues/9731#issuecomment-162214625","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9731","id":162214625,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MjIxNDYyNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-12-05T15:57:20Z","updated_at":"2015-12-05T15:57:20Z","author_association":"CONTRIBUTOR","body":"No progress on this since Feb. Closing for now\n","performed_via_github_app":null}]