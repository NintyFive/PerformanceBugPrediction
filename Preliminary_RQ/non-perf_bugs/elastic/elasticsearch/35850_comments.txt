[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441214563","html_url":"https://github.com/elastic/elasticsearch/issues/35850#issuecomment-441214563","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35850","id":441214563,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTIxNDU2Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-11-23T11:13:37Z","updated_at":"2018-11-23T11:13:37Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441215392","html_url":"https://github.com/elastic/elasticsearch/issues/35850#issuecomment-441215392","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35850","id":441215392,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTIxNTM5Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-11-23T11:17:40Z","updated_at":"2018-11-23T11:17:40Z","author_association":"MEMBER","body":"Also we ran into this in a PR test over at https://github.com/elastic/elasticsearch/pull/34112, there the error looks slightly different though:\r\n\r\nBuild: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+pull-request-1/220/console\r\n\r\n```\r\n11:25:37 FAILURE 0.68s J6 | IndexShardTests.testRestoreLocalHistoryFromTranslogOnPromotion <<< FAILURES!\r\n11:25:37    > Throwable #1: java.lang.AssertionError: \r\n11:25:37    > Expected: <673L>\r\n11:25:37    >      but: was <30L>\r\n11:25:37    > \tat __randomizedtesting.SeedInfo.seed([A945C21B27945AD0:198FBCBAD6556E29]:0)\r\n11:25:37    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n11:25:37    > \tat org.elasticsearch.index.shard.IndexShardTests.testRestoreLocalHistoryFromTranslogOnPromotion(IndexShardTests.java:1081)\r\n11:25:37    > \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n```\r\n./gradlew :server:test -Dtests.seed=A945C21B27945AD0 -Dtests.class=org.elasticsearch.index.shard.IndexShardTests -Dtests.method=\"testRestoreLocalHistoryFromTranslogOnPromotion\" -Dtests.security.manager=true -Dtests.locale=ar-BH -Dtests.timezone=Asia/Aqtobe -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n\r\nNote this is a different method (\"testRestoreLocalHistoryFromTranslogOnPromotion\") and on master, but same test class and at least correlated by time. Maybe related, just filing here in case this gives further hints.\r\n\r\n\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441240624","html_url":"https://github.com/elastic/elasticsearch/issues/35850#issuecomment-441240624","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35850","id":441240624,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTI0MDYyNA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-11-23T13:24:57Z","updated_at":"2018-11-23T13:24:57Z","author_association":"MEMBER","body":"Another one that looks related, this time on master and again in \"testRestoreLocalHistoryFromTranslogOnPromotion\":\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=centos/76/console\r\n\r\n```\r\n./gradlew :server:test -Dtests.seed=A2BDA22B8BC2A5C6 -Dtests.class=org.elasticsearch.index.shard.IndexShardTests -Dtests.method=\"testRestoreLocalHistoryFromTranslogOnPromotion\" -Dtests.security.manager=true -Dtests.locale=zh-HK -Dtests.timezone=America/Argentina/Mendoza -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n```\r\n12:31:00    > Throwable #1: java.lang.AssertionError: \r\n[...]\r\n12:31:00    > Expected: <491L>\r\n12:31:00    >      but: was <110L>\r\n12:31:00    > \tat __randomizedtesting.SeedInfo.seed([A2BDA22B8BC2A5C6:1277DC8A7A03913F]:0)\r\n12:31:00    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n12:31:00    > \tat org.elasticsearch.index.shard.IndexShardTests.testRestoreLocalHistoryFromTranslogOnPromotion(IndexShardTests.java:1081)\r\n12:31:00    > \tat java.lang.Thread.run(Thread.java:748)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441241748","html_url":"https://github.com/elastic/elasticsearch/issues/35850#issuecomment-441241748","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35850","id":441241748,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTI0MTc0OA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-11-23T13:30:29Z","updated_at":"2018-11-23T13:30:29Z","author_association":"MEMBER","body":"I muted both IndexShardTests#testRestoreLocalHistoryFromTranslogOnPromotion and  IndexShardTests#testRollbackReplicaEngineOnPromotion on master and 6.x","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441242166","html_url":"https://github.com/elastic/elasticsearch/issues/35850#issuecomment-441242166","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35850","id":441242166,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTI0MjE2Ng==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-11-23T13:32:32Z","updated_at":"2018-11-23T13:32:32Z","author_association":"MEMBER","body":"Thanks @cbuescher !","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441541995","html_url":"https://github.com/elastic/elasticsearch/issues/35850#issuecomment-441541995","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35850","id":441541995,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTU0MTk5NQ==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2018-11-26T07:24:42Z","updated_at":"2018-11-26T07:25:02Z","author_association":"CONTRIBUTOR","body":"The were some errors that seems related with this one. They reproduce locally for master and 6.x:\r\n\r\n```\r\n./gradlew :server:test   -Dtests.seed=91B36D5827A7C41   -Dtests.class=org.elasticsearch.index.shd.IndexShardTests   -Dtests.method=\"testOperationPermitOnReplicaShards\"   -Dtests.security.manager=true   -Dtests.locale=ro   -Dtests.timezone=America/Scoresbysund   -Dcompiler.java=11   -Druntime.java=8\r\n```\r\n\r\nOutput: \r\n\r\n```\r\n 1> [2018-11-26T06:04:01,946][INFO ][o.e.i.s.IndexShardTests  ] [testOperationPermitOnReplicaShards] before test\r\n  1> [2018-11-26T06:04:03,582][INFO ][o.e.i.s.IndexShardTests  ] [testOperationPermitOnReplicaShards] shard routing to [index][0], node[tDRGSLjrNj], [R], s[STARTED], a[id=-RB7P6EUTeKztb4anytFxg]\r\n  2> Nov 26, 2018 6:04:03 AM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n  2> WARNING: Uncaught exception in thread: Thread[elasticsearch[org.elasticsearch.index.shard.IndexShardTests][generic][T#2],5,TGRP-IndexShardTests]\r\n  2> java.lang.AssertionError: \r\n  2> Expected: <78L>\r\n  2>      but: was <74L>\r\n  2>    at __randomizedtesting.SeedInfo.seed([91B36D5827A7C41]:0)\r\n  2>    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n  2>    at org.junit.Assert.assertThat(Assert.java:956)\r\n  2>    at org.junit.Assert.assertThat(Assert.java:923)\r\n  2>    at org.elasticsearch.index.shard.IndexShardTests$8.onResponse(IndexShardTests.java:841)\r\n  2>    at org.elasticsearch.index.shard.IndexShardTests$8.onResponse(IndexShardTests.java:837)\r\n  2>    at org.elasticsearch.index.shard.IndexShard$4.onResponse(IndexShard.java:2506)\r\n  2>    at org.elasticsearch.index.shard.IndexShard$4.onResponse(IndexShard.java:2484)\r\n  2>    at org.elasticsearch.index.shard.IndexShardOperationPermits$1.doRun(IndexShardOperationPermits.java:146)\r\n  2>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:726)\r\n  2>    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  2>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n  2>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n  2>    at java.lang.Thread.run(Thread.java:748)\r\nHEARTBEAT J0 PID(48961@ignacios-MBP): 2018-11-26T08:04:12, stalled for 10.3s at: IndexShardTests.testOperationPermitOnReplicaShards\r\nHEARTBEAT J0 PID(48961@ignacios-MBP): 2018-11-26T08:04:22, stalled for 20.3s at: IndexShardTests.testOperationPermitOnReplicaShards\r\nHEARTBEAT J0 PID(48961@ignacios-MBP): 2018-11-26T08:04:32, stalled for 30.3s at: IndexShardTests.testOperationPermitOnReplicaShards\r\nHEARTBEAT J0 PID(48961@ignacios-MBP): 2018-11-26T08:04:42, stalled for 40.3s at: IndexShardTests.testOperationPermitOnReplicaShards\r\n<============-> 97% EXECUTING [58s]\r\n> :server:test > Suites: 0/1\r\n> :server:test > Tests: completed: 0, failed: 0, ignored: 0\r\n> :server:test > J0: IndexShardTests.testOperationPermitOnReplicaShards stalled for 40.3s\r\n```\r\n\r\nIt actually leads to a timeout. I am not muting the test because fix seems to be applied soon. \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441558746","html_url":"https://github.com/elastic/elasticsearch/issues/35850#issuecomment-441558746","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35850","id":441558746,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTU1ODc0Ng==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2018-11-26T08:39:52Z","updated_at":"2018-11-26T08:39:52Z","author_association":"CONTRIBUTOR","body":"Test IndexShardTests.testOperationPermitOnReplicaShards has been muted in master and 6.x","performed_via_github_app":null}]