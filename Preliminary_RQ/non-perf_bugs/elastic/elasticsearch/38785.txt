{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38785","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38785/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38785/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38785/events","html_url":"https://github.com/elastic/elasticsearch/issues/38785","id":409332860,"node_id":"MDU6SXNzdWU0MDkzMzI4NjA=","number":38785,"title":"[ML] Errors when running nginx module jobs","user":{"login":"pheyos","id":1945390,"node_id":"MDQ6VXNlcjE5NDUzOTA=","avatar_url":"https://avatars0.githubusercontent.com/u/1945390?v=4","gravatar_id":"","url":"https://api.github.com/users/pheyos","html_url":"https://github.com/pheyos","followers_url":"https://api.github.com/users/pheyos/followers","following_url":"https://api.github.com/users/pheyos/following{/other_user}","gists_url":"https://api.github.com/users/pheyos/gists{/gist_id}","starred_url":"https://api.github.com/users/pheyos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pheyos/subscriptions","organizations_url":"https://api.github.com/users/pheyos/orgs","repos_url":"https://api.github.com/users/pheyos/repos","events_url":"https://api.github.com/users/pheyos/events{/privacy}","received_events_url":"https://api.github.com/users/pheyos/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-02-12T14:41:13Z","updated_at":"2019-03-15T09:25:56Z","closed_at":"2019-03-15T09:25:56Z","author_association":"NONE","active_lock_reason":null,"body":"**Found in version**\r\n- 7.0.0-beta1 BC2\r\n\r\n**Steps to reproduce**\r\n- Use the `nginx` module to create ML jobs\r\n\r\n**Expected result**\r\n- The 5 jobs defined in the module are created without errors\r\n\r\n**Actual result**\r\n- The elasticsearch.log shows a lot of errors of the form:\r\n```\r\n[DEBUG][o.e.a.b.TransportShardBulkAction] [elastic-ro] [.ml-anomalies-shared][0] failed to execute bulk item (index) index {[.ml-anomalies-.write-dr_remote_ip_request_rate][doc][dr_remote_ip_request_rate_influencer_1489273200000_3600_nginx.access.remote_ip_837166815_39], source[{\"job_id\":\"dr_remote_ip_request_rate\",\"result_type\":\"influencer\",\"influencer_field_name\":\"nginx.access.remote_ip\",\"influencer_field_value\":\"d59e:bcc0:846e:c67e:12fb:c430:f37c:9aec\",\"nginx.access.remote_ip\":\"d59e:bcc0:846e:c67e:12fb:c430:f37c:9aec\",\"influencer_score\":5.767481395370252,\"initial_influencer_score\":5.767481395370252,\"probability\":2.1435293947279067E-6,\"bucket_span\":3600,\"is_interim\":true,\"timestamp\":1489273200000}]}\r\norg.elasticsearch.index.mapper.MapperParsingException: failed to parse\r\n    at org.elasticsearch.index.mapper.DocumentParser.wrapInMapperParsingException(DocumentParser.java:177) ~[elasticsearch-7.0.0-beta1.jar:7.0.0-beta1]\r\n    at org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:74) ~[elasticsearch-7.0.0-beta1.jar:7.0.0-beta1]\r\n\r\n[...]\r\n\r\nCaused by: java.lang.ClassCastException: org.elasticsearch.index.mapper.KeywordFieldMapper cannot be cast to org.elasticsearch.index.mapper.ObjectMapper\r\n    at org.elasticsearch.index.mapper.DocumentParser.getDynamicParentMapper(DocumentParser.java:898) ~[elasticsearch-7.0.0-beta1.jar:7.0.0-beta1]\r\n```\r\n\r\n**Additional information**\r\n- The `.ml-anomalies-shared` result index does not contain mappings for the job's term field mappings.","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}