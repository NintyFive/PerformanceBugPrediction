{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/46070","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46070/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46070/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46070/events","html_url":"https://github.com/elastic/elasticsearch/issues/46070","id":486315191,"node_id":"MDU6SXNzdWU0ODYzMTUxOTE=","number":46070,"title":"[ML] Data frame transform _preview endpoint missing mapping fields","user":{"login":"walterra","id":230104,"node_id":"MDQ6VXNlcjIzMDEwNA==","avatar_url":"https://avatars3.githubusercontent.com/u/230104?v=4","gravatar_id":"","url":"https://api.github.com/users/walterra","html_url":"https://github.com/walterra","followers_url":"https://api.github.com/users/walterra/followers","following_url":"https://api.github.com/users/walterra/following{/other_user}","gists_url":"https://api.github.com/users/walterra/gists{/gist_id}","starred_url":"https://api.github.com/users/walterra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/walterra/subscriptions","organizations_url":"https://api.github.com/users/walterra/orgs","repos_url":"https://api.github.com/users/walterra/repos","events_url":"https://api.github.com/users/walterra/events{/privacy}","received_events_url":"https://api.github.com/users/walterra/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-08-28T11:14:30Z","updated_at":"2019-08-28T13:43:10Z","closed_at":"2019-08-28T13:43:10Z","author_association":"NONE","active_lock_reason":null,"body":"The decuded mappings introduced in #43742 seems to miss exposing mappings based on scripted fields. For example, using the following in Kibana Dev Console:\r\n\r\n```json\r\nPOST _data_frame/transforms/_preview\r\n{\r\n  \"source\": {\r\n    \"index\": [\r\n      \"filebeat-nginx-elasticco-anon-2017\"\r\n    ]\r\n  },\r\n  \"pivot\": {\r\n    \"group_by\": {\r\n      \"source.address\": {\r\n        \"terms\": {\r\n          \"field\": \"source.address\"\r\n        }\r\n      }\r\n    },\r\n    \"aggregations\": {\r\n      \"@timestamp_max\": {\r\n        \"max\": {\r\n          \"field\": \"@timestamp\"\r\n        }\r\n      },\r\n      \"@timestamp_min\": {\r\n        \"min\": {\r\n          \"field\": \"@timestamp\"\r\n        }\r\n      },\r\n      \"duration\": {\r\n        \"bucket_script\": {\r\n          \"buckets_path\": {\r\n            \"min\": \"@timestamp_min\",\r\n            \"max\": \"@timestamp_max\"\r\n          },\r\n          \"script\": \"(params.max - params.min)/1000\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nWill return:\r\n\r\n```\r\n{\r\n  \"preview\" : [\r\n    {\r\n      \"duration\" : 3236636.783,\r\n      \"@timestamp_min\" : \"2017-02-01T06:02:10.303Z\",\r\n      \"@timestamp_max\" : \"2017-03-10T17:06:07.086Z\",\r\n      \"source\" : {\r\n        \"address\" : \"\"\r\n      }\r\n    },\r\n    ...\r\n   {\r\n      \"duration\" : 0.0,\r\n      \"@timestamp_min\" : \"2017-02-09T08:07:07.963Z\",\r\n      \"@timestamp_max\" : \"2017-02-09T08:07:07.963Z\",\r\n      \"source\" : {\r\n        \"address\" : \"0.104.130.123\"\r\n      }\r\n    }\r\n  ],\r\n  \"mappings\" : {\r\n    \"properties\" : {\r\n      \"@timestamp_min\" : {\r\n        \"type\" : \"date\"\r\n      },\r\n      \"@timestamp_max\" : {\r\n        \"type\" : \"date\"\r\n      },\r\n      \"source.address\" : {\r\n        \"type\" : \"keyword\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nYou can see that `duration` is part of the preview documents, but it's missing from the `mappings` part.\r\n\r\nThis affects the Kibana data frame transforms wizard in `7.3+`: For the transforms preview table, the columns visible are based on the `mappings`, so the `duration` column will not show up at all.","closed_by":{"login":"walterra","id":230104,"node_id":"MDQ6VXNlcjIzMDEwNA==","avatar_url":"https://avatars3.githubusercontent.com/u/230104?v=4","gravatar_id":"","url":"https://api.github.com/users/walterra","html_url":"https://github.com/walterra","followers_url":"https://api.github.com/users/walterra/followers","following_url":"https://api.github.com/users/walterra/following{/other_user}","gists_url":"https://api.github.com/users/walterra/gists{/gist_id}","starred_url":"https://api.github.com/users/walterra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/walterra/subscriptions","organizations_url":"https://api.github.com/users/walterra/orgs","repos_url":"https://api.github.com/users/walterra/repos","events_url":"https://api.github.com/users/walterra/events{/privacy}","received_events_url":"https://api.github.com/users/walterra/received_events","type":"User","site_admin":false},"performed_via_github_app":null}