{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29517","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29517/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29517/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29517/events","html_url":"https://github.com/elastic/elasticsearch/issues/29517","id":314297440,"node_id":"MDU6SXNzdWUzMTQyOTc0NDA=","number":29517,"title":"Cancelling relocations with /_cluster/reroute API does not work","user":{"login":"joedj","id":250501,"node_id":"MDQ6VXNlcjI1MDUwMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/250501?v=4","gravatar_id":"","url":"https://api.github.com/users/joedj","html_url":"https://github.com/joedj","followers_url":"https://api.github.com/users/joedj/followers","following_url":"https://api.github.com/users/joedj/following{/other_user}","gists_url":"https://api.github.com/users/joedj/gists{/gist_id}","starred_url":"https://api.github.com/users/joedj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joedj/subscriptions","organizations_url":"https://api.github.com/users/joedj/orgs","repos_url":"https://api.github.com/users/joedj/repos","events_url":"https://api.github.com/users/joedj/events{/privacy}","received_events_url":"https://api.github.com/users/joedj/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-04-14T04:12:22Z","updated_at":"2018-04-30T08:24:58Z","closed_at":"2018-04-30T08:24:57Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 6.2.3, Build: c59ff00/2018-03-13T10:06:29.741383Z, JVM: 1.8.0_161\r\n\r\n**Plugins installed**:\r\ndiscovery-ec2  ingest-geoip  ingest-user-agent  repository-s3  x-pack\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_161\"\r\nOpenJDK Runtime Environment (build 1.8.0_161-b14)\r\nOpenJDK 64-Bit Server VM (build 25.161-b14, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux 368248a25fe8 4.9.85-38.58.amzn1.x86_64 #1 SMP Wed Mar 14 01:17:26 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nExpected behaviour:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-reroute.html mentions \"(or recovery)\" in the `cancel` section, implying that it is possible to cancel an ongoing shard recovery (i.e. rebalance).\r\n\r\nInvoking the `cancel` command with `\"node\" : \"target_node\"` should cancel the recovery.\r\n\r\nActual behaviour:\r\nInvoking the `cancel` command with `\"node\" : \"target_node\"` does nothing.\r\nInvoking the `cancel` command with `\"node\" : \"source_node\"` cancels the allocation on the source node, and the shard is reinitialized.\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Allocate a shard to a different node.\r\n2. Find relevant information:\r\n```bash\r\ncurl localhost:9200/_cat/shards | grep RELOCATING\r\nmyindex                  2  r RELOCATING 57683083  63.2gb 10.9.37.161 ip-10-9-37-161-f69cced2c589 -> 10.9.37.163 yJhK1sq_R-eLQIlMV52MvA ip-10-9-37-163-3d269cd16c52\r\n```\r\n3. Attempt to cancel relocation\r\n```bash\r\ncurl -s -XPOST -H'Content-Type: application/json' http://localhost:9200/_cluster/reroute --data-binary @- << \"END\"\r\n{\r\n    \"commands\" : [\r\n        {\r\n            \"cancel\" : {\r\n                \"index\" : \"myindex\",\r\n                \"shard\" : 2,\r\n                \"node\": \"yJhK1sq_R-eLQIlMV52MvA\"\r\n            }\r\n        }\r\n    ]\r\n}\r\nEND\r\n```\r\n4. Observe that the relocation is not cancelled.\r\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}