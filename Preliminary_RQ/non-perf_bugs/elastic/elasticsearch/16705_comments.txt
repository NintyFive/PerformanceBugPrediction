[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185575722","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-185575722","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":185575722,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTU3NTcyMg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-02-18T07:15:59Z","updated_at":"2016-02-18T14:11:41Z","author_association":"MEMBER","body":"I replied on the mailing list, I am not sure it's a bug, Did we verify that the behaviour was different before? As far as I can remember, if you had a filtered query in the past, filter matches would be highlighted?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185747468","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-185747468","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":185747468,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTc0NzQ2OA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-02-18T14:33:58Z","updated_at":"2016-02-18T14:33:58Z","author_association":"MEMBER","body":"I stand corrected, I double checked and indeed this has changed as a side effect of query/filter merging. The same query (using a filtered query) would highlight only the query part in 1.7 and previous versions, while now filters get highlighted as well with 2.0+. Using a specific `highlight_query` without the filters is a valid workaround until we get this fixed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185818524","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-185818524","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":185818524,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTgxODUyNA==","user":{"login":"igor-kupczynski","id":166651,"node_id":"MDQ6VXNlcjE2NjY1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/166651?v=4","gravatar_id":"","url":"https://api.github.com/users/igor-kupczynski","html_url":"https://github.com/igor-kupczynski","followers_url":"https://api.github.com/users/igor-kupczynski/followers","following_url":"https://api.github.com/users/igor-kupczynski/following{/other_user}","gists_url":"https://api.github.com/users/igor-kupczynski/gists{/gist_id}","starred_url":"https://api.github.com/users/igor-kupczynski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/igor-kupczynski/subscriptions","organizations_url":"https://api.github.com/users/igor-kupczynski/orgs","repos_url":"https://api.github.com/users/igor-kupczynski/repos","events_url":"https://api.github.com/users/igor-kupczynski/events{/privacy}","received_events_url":"https://api.github.com/users/igor-kupczynski/received_events","type":"User","site_admin":false},"created_at":"2016-02-18T17:10:26Z","updated_at":"2016-02-18T17:10:26Z","author_association":"NONE","body":"Copying @jpountz as well\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186052499","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-186052499","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":186052499,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjA1MjQ5OQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T05:04:27Z","updated_at":"2016-02-19T05:04:27Z","author_association":"CONTRIBUTOR","body":"I guess we could get the old behavior back by trying to figure out if the query is used in a filter context. I thought this side effect of the filter->query conversion was known/expected though. Stuff like #15793 snuck in but the rest of the filter terms being highlighted was expected?\n\nThe whole terms extraction process has always been a bit hacky and when I was managing a production installation I always relied on good old highlight_query to save me.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251370920","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-251370920","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":251370920,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTM3MDkyMA==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2016-10-04T12:13:44Z","updated_at":"2016-10-04T12:13:44Z","author_association":"CONTRIBUTOR","body":"++ on fixing this\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251512294","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-251512294","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":251512294,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTUxMjI5NA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-10-04T21:01:03Z","updated_at":"2016-10-04T21:01:03Z","author_association":"CONTRIBUTOR","body":"I have been thinking a bit more about it today and I could not come up with a rule about what should be highlighted:\n- should filters really not be highlighted?\n- if yes then do we still agree that what lives under a `constant_score` should not be highlighted? (it is technically a filter)\n- isn't it mostly due to the use of `\"require_field_match\":false`? in that case maybe the actual fix is for users to specify a `highlight_query` to be more specific about what needs to be highlighted.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251514169","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-251514169","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":251514169,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTUxNDE2OQ==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2016-10-04T21:08:30Z","updated_at":"2016-10-04T21:08:30Z","author_association":"CONTRIBUTOR","body":"@jpountz thanks for looking at it! My comments go inline:\n\n> should filters really not be highlighted?\n\nMaybe we should be able to specify whether the filters should be higlighted or not? Shoudn't this be a configuration? Depending on the use case, people would want to higlight this or not\n\n> if yes then do we still agree that what lives under a constant_score should not be highlighted? (it >is technically a filter)\n\nThis could be addressed with my statement in [1]\n\n> isn't it mostly due to the use of \"require_field_match\":false? in that case maybe the actual fix is for >users to specify a highlight_query to be more specific about what needs to be highlighted.\n\nI think that when require_field_match is false, a highlight query should be required, otherwise what should be highlighted? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251521524","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-251521524","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":251521524,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTUyMTUyNA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-10-04T21:38:21Z","updated_at":"2016-10-04T21:38:21Z","author_association":"CONTRIBUTOR","body":"> Maybe we should be able to specify whether the filters should be higlighted or not?\n\nThis is something I'd like to avoid if possible as settings/options increase the complexity of our APIs.\n\n> I think that when require_field_match is false, a highlight query should be required, otherwise what should be highlighted?\n\nThe current default is to highlight the main query and highlighters will try to highlight across fields. It  is indeed quite a tricky option as weird things can happen if fields have different analyzers.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/256080085","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-256080085","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":256080085,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NjA4MDA4NQ==","user":{"login":"dexterama","id":5594854,"node_id":"MDQ6VXNlcjU1OTQ4NTQ=","avatar_url":"https://avatars0.githubusercontent.com/u/5594854?v=4","gravatar_id":"","url":"https://api.github.com/users/dexterama","html_url":"https://github.com/dexterama","followers_url":"https://api.github.com/users/dexterama/followers","following_url":"https://api.github.com/users/dexterama/following{/other_user}","gists_url":"https://api.github.com/users/dexterama/gists{/gist_id}","starred_url":"https://api.github.com/users/dexterama/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dexterama/subscriptions","organizations_url":"https://api.github.com/users/dexterama/orgs","repos_url":"https://api.github.com/users/dexterama/repos","events_url":"https://api.github.com/users/dexterama/events{/privacy}","received_events_url":"https://api.github.com/users/dexterama/received_events","type":"User","site_admin":false},"created_at":"2016-10-25T16:04:00Z","updated_at":"2016-10-25T16:06:32Z","author_association":"NONE","body":"jpountz: Hello, I am the original poster of this issue on your Elastic forum (https://discuss.elastic.co/t/2-0-question-about-whats-returning-within-the-highlighter/34065) and I also spoke with you about this at Elasticon 2016 at your info booth. My suggestion, please, is to NOT include the filters in the highlighter, and here is my motivation:\n\nWhat is the premise of the filter? To include, or exclude, given data that matches a given pattern.\n\nWhat is the premise of the highlighter? To show the user where their search terms hit within the indexed documents, to provide context of the search result they are viewing. \n\nThis is my understanding of the distinction between the two. \n\nAs an engineer, the filter is used to control the return of data.\nAs a user (e.g. using an aggregation selection to filter down return data), the aggregation/UI interaction might have spawned the filter's creation, but does not mean they need to see a hit upon their aggregation within the highlight. E.g. They selected an aggregation result of document type, so we apply a filter upon it, it is a data limiter in the query, not part of why it hit their search criteria, per se.\n\nBut, most importantly, if we ever wish to filter data OUT of a users return set, due to security/authorizations, we NEVER want those filters as part of the highlight. (e.g. user A can only search upon documents of type X, so a filter is applied to the search.)\n\nTo this engineer, it seems like the highlighter should highlight **search term matches**, but not the filters that might control data that the search terms query against.\n\nThanks for listening. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375590710","html_url":"https://github.com/elastic/elasticsearch/issues/16705#issuecomment-375590710","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16705","id":375590710,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTU5MDcxMA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-03-23T09:20:38Z","updated_at":"2018-03-23T09:20:38Z","author_association":"MEMBER","body":"Highlighting can override the main query so I think it's more flexible to differentiate the main query from the highlight query rather than trying to find which part of the main query should be highlighted.\r\nBy default we try to extract **all** terms/phrases from the main query but for more fine grained scenario the solution is to override the query in the highlight section. With this approach you can control what the highlighter should do in a way that is not hidden in the highlighting logic.","performed_via_github_app":null}]