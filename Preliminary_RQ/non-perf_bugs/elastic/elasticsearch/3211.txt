{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3211","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3211/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3211/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3211/events","html_url":"https://github.com/elastic/elasticsearch/issues/3211","id":15786292,"node_id":"MDU6SXNzdWUxNTc4NjI5Mg==","number":3211,"title":"ElasticSearch 0.90 fails when \"highlight\" contains a field of type \"long\"","user":{"login":"ariasdelrio","id":668781,"node_id":"MDQ6VXNlcjY2ODc4MQ==","avatar_url":"https://avatars0.githubusercontent.com/u/668781?v=4","gravatar_id":"","url":"https://api.github.com/users/ariasdelrio","html_url":"https://github.com/ariasdelrio","followers_url":"https://api.github.com/users/ariasdelrio/followers","following_url":"https://api.github.com/users/ariasdelrio/following{/other_user}","gists_url":"https://api.github.com/users/ariasdelrio/gists{/gist_id}","starred_url":"https://api.github.com/users/ariasdelrio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ariasdelrio/subscriptions","organizations_url":"https://api.github.com/users/ariasdelrio/orgs","repos_url":"https://api.github.com/users/ariasdelrio/repos","events_url":"https://api.github.com/users/ariasdelrio/events{/privacy}","received_events_url":"https://api.github.com/users/ariasdelrio/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":41588718,"node_id":"MDU6TGFiZWw0MTU4ODcxOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.2","name":"v0.90.2","color":"DDDDDD","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2013-06-20T08:13:29Z","updated_at":"2013-07-03T09:57:21Z","closed_at":"2013-06-24T14:12:31Z","author_association":"NONE","active_lock_reason":null,"body":"If the \"highlight\" section of a searh query contains a field of type \"long\", an error occurs. That didn't happen with the old version.\nThis is a sample script I used to test this behaviour:\n\n``` bash\ncurl -s -o /dev/null -X DELETE \"http://${hostname}:9200/test?pretty\"\n\ncurl -s -o /dev/null -X PUT \"http://${hostname}:9200/test/?pretty\"  -d '\n{\n   \"mappings\" : {\n      \"test1\" : {\n        \"properties\" : {\n            \"text\" : {\n                \"store\": \"yes\",\n                \"type\": \"string\"\n            }\n         }\n      },\n      \"test2\" : {\n        \"properties\" : {\n            \"text\" : {\n                \"store\": \"yes\",\n                \"type\": \"string\"\n            },\n            \"number\" : {\n                \"store\": \"yes\",\n                \"type\": \"long\"\n            }\n         }\n      }\n   }\n}\n'\n\ncurl -s -o /dev/null -X POST \"http://${hostname}:9200/test/test1?pretty\"  -d '\n{\n   \"text\" : \"test one\"\n}\n'\n\ncurl -s -o /dev/null -X POST \"http://${hostname}:9200/test/test2?pretty\"  -d '\n{\n   \"text\" : \"test two\",\n   \"number\" : 100\n}\n'\n\ncurl -s -o /dev/null -X POST \"http://${hostname}:9200/test1/_refresh\"\ncurl -s -o /dev/null -X POST \"http://${hostname}:9200/test2/_refresh\"\n\nsleep 3\n\ncurl -s -X GET \"http://${hostname}:9200/test/_search?pretty\" -d '\n{\n  \"query\": {\n        \"prefix\": {\n          \"text\": \"test\"\n        }\n  },\n  \"highlight\": {\n    \"number_of_fragments\": 0,\n    \"fields\": {\n        \"text\": {},\n        \"number\": {}\n    }\n  }\n\n}'\n```\n\nIf you run it against an elasticsearch 0.20.6 server, it returns the two hits, correctly highlighted.\nHowever, if you run it against an elasticsearch 0.90 server, this happens:\n\n``` bash\n{\n  \"took\" : 6,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 4,\n    \"failed\" : 1,\n    \"failures\" : [ {\n      \"index\" : \"test\",\n      \"shard\" : 0,\n      \"status\" : 500,\n      \"reason\" : \"FetchPhaseExecutionException[[test][0]: query[text:test*],from[0],size[10]: Fetch Failed [Failed to highlight field [number]]]; nested: StringIndexOutOfBoundsException[String index out of range: -1]; \"\n    } ]\n  },\n  \"hits\" : {\n    \"total\" : 2,\n    \"max_score\" : 1.0,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"test1\",\n      \"_id\" : \"y51XzuuaQ6uYnigzhq5EtA\",\n      \"_score\" : 1.0, \"_source\" :\n{\n   \"text\" : \"test one\"\n}\n,\n      \"highlight\" : {\n        \"text\" : [ \"<em>test</em> one\" ]\n      }\n    } ]\n  }\n}\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}