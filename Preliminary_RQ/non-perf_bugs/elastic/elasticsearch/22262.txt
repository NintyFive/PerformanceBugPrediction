{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22262","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22262/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22262/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22262/events","html_url":"https://github.com/elastic/elasticsearch/issues/22262","id":196431989,"node_id":"MDU6SXNzdWUxOTY0MzE5ODk=","number":22262,"title":"Default analyzer is not picked up correctly in index time, if the default analyzer  is overwrite in index setting","user":{"login":"youxu71","id":8296390,"node_id":"MDQ6VXNlcjgyOTYzOTA=","avatar_url":"https://avatars2.githubusercontent.com/u/8296390?v=4","gravatar_id":"","url":"https://api.github.com/users/youxu71","html_url":"https://github.com/youxu71","followers_url":"https://api.github.com/users/youxu71/followers","following_url":"https://api.github.com/users/youxu71/following{/other_user}","gists_url":"https://api.github.com/users/youxu71/gists{/gist_id}","starred_url":"https://api.github.com/users/youxu71/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/youxu71/subscriptions","organizations_url":"https://api.github.com/users/youxu71/orgs","repos_url":"https://api.github.com/users/youxu71/repos","events_url":"https://api.github.com/users/youxu71/events{/privacy}","received_events_url":"https://api.github.com/users/youxu71/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-12-19T14:51:44Z","updated_at":"2016-12-19T15:02:48Z","closed_at":"2016-12-19T15:02:48Z","author_association":"NONE","active_lock_reason":null,"body":"Repro steps:\r\n\r\nCreate index with following setting:\r\n\r\n```\r\nPOST / myindex\r\n{\r\n      \"settings\" : {\r\n        \"analysis\" : {\r\n          \"filter\" : {\r\n            \"customsplit\" : {\r\n              \"type\" : \"pattern_capture\",\r\n              \"preserve_original\" : 1,\r\n              \"patterns\" : [\r\n                \"([^_.]+)\"\r\n              ]\r\n            }\r\n          },\r\n          \"analyzer\" : {\r\n            **\"standard\"** : {\r\n              \"tokenizer\" : \"standard\",\r\n              \"filter\" : [\r\n                \"lowercase\",\r\n                \"customsplit\"\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"mappings\" : {\r\n        \"docs\" : {\r\n          \"properties\" : {\r\n            \"Url\" : {\r\n              \"type\" : \"string\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n```\r\n\r\nPlease be noticed that:\r\n\r\n- The analyzer is not defined for Url field, so it should use default analyzer which is \"standard\" analyzer.\r\n- In myindex setting, \"standard\" analyzer is re-written by adding \"customsplit\" filter in addition to \"lowercase\" filter\r\n- The customsplit filter is a pattern_capture filter to split word by \".\" and \"_\", which allows the re-written standard analyzer split DNS to several tokens as following output:\r\n\r\n```\r\n   GET /myindex/_analyze?analyzer=standard&text=www.xyz.com\r\n   {\r\n      \"tokens\": [\r\n        {\r\n          \"token\": \"www.xyz.com\",\r\n          \"start_offset\": 0,\r\n          \"end_offset\": 11,\r\n          \"type\": \"<ALPHANUM>\",\r\n          \"position\": 1\r\n        },\r\n        {\r\n          \"token\": \"www\",\r\n          \"start_offset\": 0,\r\n          \"end_offset\": 11,\r\n          \"type\": \"<ALPHANUM>\",\r\n          \"position\": 1\r\n        },\r\n        {\r\n          \"token\": \"xyz\",\r\n          \"start_offset\": 0,\r\n          \"end_offset\": 11,\r\n          \"type\": \"<ALPHANUM>\",\r\n          \"position\": 1\r\n        },\r\n        {\r\n          \"token\": \"com\",\r\n          \"start_offset\": 0,\r\n          \"end_offset\": 11,\r\n          \"type\": \"<ALPHANUM>\",\r\n          \"position\": 1\r\n        }\r\n      ]\r\n    }\r\n    \r\n````\r\n\r\nInsert one doc into myindex:\r\n\r\n```\r\nPOST /myindex/docs/1\r\n{\r\n\t\"Url\": \"www.xyz.com\"\r\n}\r\n```\r\n\r\nSearch \"xyz\" on \"Url\" field:\r\n\r\n```\r\nPOST /myindex/_search\r\n{\r\n \"query\": {\r\n  \"match\": {\r\n    \"Url\": \"xyz\"\r\n  }\r\n }\r\n}\r\n```\r\n\r\nActual Result: None document returned,\r\nExpected Result: doc 1 should be returned.\r\n\r\n\r\nUpdate the index setting by explicitly specifying \"Url\" field analyzer to \"standard:\r\n\r\n```\r\n{\r\nmappings\": {\r\n  \"docs\": {\r\n    \"properties\": {\r\n      \"Url\": {\r\n        \"type\": \"string\",\r\n        **\"analyzer\": \"standard\"**\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nSearch \"xyz\" on Url field with exact same query DSL in step 3\r\n\r\nActual result; doc 1 returned as expected.\r\n\r\n\r\nI guess for default analyzer, ES just pick up the built-in analyzer, it is built-in \"standard\" in my case, regardless whether the analyzer is re-written in index setting. \r\nIt is somehow confusing. I think it should either reject \"standard\" as an analyzer name in customized analyzer setting or pick the right one when indexing the document.\r\n\r\nYou can also find the detailed issue discussion in elasticsearch forum: https://discuss.elastic.co/t/what-is-default-index-analyzer/69402/4\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}