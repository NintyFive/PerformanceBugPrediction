[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352537633","html_url":"https://github.com/elastic/elasticsearch/issues/27874#issuecomment-352537633","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27874","id":352537633,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjUzNzYzMw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-18T19:46:30Z","updated_at":"2017-12-18T19:46:30Z","author_association":"MEMBER","body":"Duplicates #22103","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352577812","html_url":"https://github.com/elastic/elasticsearch/issues/27874#issuecomment-352577812","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27874","id":352577812,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjU3NzgxMg==","user":{"login":"cdaringe","id":1003261,"node_id":"MDQ6VXNlcjEwMDMyNjE=","avatar_url":"https://avatars0.githubusercontent.com/u/1003261?v=4","gravatar_id":"","url":"https://api.github.com/users/cdaringe","html_url":"https://github.com/cdaringe","followers_url":"https://api.github.com/users/cdaringe/followers","following_url":"https://api.github.com/users/cdaringe/following{/other_user}","gists_url":"https://api.github.com/users/cdaringe/gists{/gist_id}","starred_url":"https://api.github.com/users/cdaringe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdaringe/subscriptions","organizations_url":"https://api.github.com/users/cdaringe/orgs","repos_url":"https://api.github.com/users/cdaringe/repos","events_url":"https://api.github.com/users/cdaringe/events{/privacy}","received_events_url":"https://api.github.com/users/cdaringe/received_events","type":"User","site_admin":false},"created_at":"2017-12-18T22:25:45Z","updated_at":"2017-12-18T22:25:45Z","author_association":"NONE","body":"hi @jasontedor, thanks for the xref. \r\n\r\nhowever, i did in fact see #22103.  you can see the the errors i present and the errors they present are similar, but different.  same objective, but perhaps _slightly_ different failure mode.\r\n\r\nin the docker context, it's not abundantly clear where to set those policies values that you articulated in that issue.\r\n\r\n```sh\r\n[root@94d395433e1e elasticsearch]# grep -irn RuntimePermission\r\nplugins/ingest-geoip/plugin-security.policy:26:  permission java.lang.RuntimePermission \"accessDeclaredMembers\";\r\nmodules/lang-mustache/plugin-security.policy:22:  permission java.lang.RuntimePermission \"accessDeclaredMembers\";\r\nmodules/lang-painless/plugin-security.policy:22:  permission java.lang.RuntimePermission \"accessDeclaredMembers\";\r\nmodules/lang-expression/plugin-security.policy:22:  permission java.lang.RuntimePermission \"accessDeclaredMembers\";\r\n```\r\n\r\ni tried updating ^^^ listed policy files, but alas, the issue persists.  can you lend a hand and point me to where those settings would go?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352624700","html_url":"https://github.com/elastic/elasticsearch/issues/27874#issuecomment-352624700","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27874","id":352624700,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjYyNDcwMA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-19T02:53:51Z","updated_at":"2017-12-19T02:53:51Z","author_association":"MEMBER","body":"You need to grant the permission to core Elasticsearch; add a file named `.java.policy` in the home directory of the user that you run Elasticsearch as and add the grant. Note that this impacts *any* JVM not limited to Elasticsearch that is run by this user. Does this help?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352875011","html_url":"https://github.com/elastic/elasticsearch/issues/27874#issuecomment-352875011","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27874","id":352875011,"node_id":"MDEyOklzc3VlQ29tbWVudDM1Mjg3NTAxMQ==","user":{"login":"cdaringe","id":1003261,"node_id":"MDQ6VXNlcjEwMDMyNjE=","avatar_url":"https://avatars0.githubusercontent.com/u/1003261?v=4","gravatar_id":"","url":"https://api.github.com/users/cdaringe","html_url":"https://github.com/cdaringe","followers_url":"https://api.github.com/users/cdaringe/followers","following_url":"https://api.github.com/users/cdaringe/following{/other_user}","gists_url":"https://api.github.com/users/cdaringe/gists{/gist_id}","starred_url":"https://api.github.com/users/cdaringe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdaringe/subscriptions","organizations_url":"https://api.github.com/users/cdaringe/orgs","repos_url":"https://api.github.com/users/cdaringe/repos","events_url":"https://api.github.com/users/cdaringe/events{/privacy}","received_events_url":"https://api.github.com/users/cdaringe/received_events","type":"User","site_admin":false},"created_at":"2017-12-19T20:20:26Z","updated_at":"2017-12-19T20:32:32Z","author_association":"NONE","body":"Yes, it completely helps! :)  Thx!\r\n\r\nFor those who are in docker-land and want to see how i overcame it, i use the following assets to build my ES json logging docker image:\r\n\r\n```Dockerfile\r\n# Dockerfile\r\nARG FROM\r\n# eg. elasticsearch:6.1.0\r\nFROM $FROM\r\nCOPY setup-json-logging.sh .\r\nRUN bash setup-json-logging.sh clean-jackson-jars\r\n# squash log4j properties outright, as there's no great way to unset\r\n# existing log configuration values.\r\nCOPY log4j2.properties /usr/share/elasticsearch/config/log4j2.properties\r\n# build/libs/*.jar expands to the jackson core, annotations, and databind jars\r\nCOPY build/libs/*.jar /usr/share/elasticsearch/lib/\r\nRUN chown 1000:0 /usr/share/elasticsearch/config/log4j2.properties && \\\r\n  chmod 0664 /usr/share/elasticsearch/config/log4j2.properties & \\\r\n  chown -R 1000:0 /usr/share/elasticsearch/lib/ && \\\r\n  bash setup-json-logging.sh update-jvm-perms\r\n```\r\n\r\n```sh\r\n#! /bin/bash\r\n# setup-json-logging.sh\r\nDEPENDENCY_JAR_GLOBS=(\"*jackson-core*.jar\" \"*jackson-databind*.jar\" \"*jackson-annotations*.jar\")\r\n\r\n# purge jackson jars, bring our own\r\nif [ \"$1\" == \"clean-jackson-jars\" ]\r\nthen\r\n  echo cleaning jackson jars\r\n  for glob in ${DEPENDENCY_JAR_GLOBS[@]}\r\n  do\r\n    echo testing for $glob\r\n    find . -name \"$glob\" | while read -r line;\r\n    do\r\n      printf \"\\tpurging $line\\n\"\r\n      rm -f $line\r\n    done\r\n  done\r\nfi\r\n\r\n# loosen the JVM perms so we can configure our own logger\r\n# {@see https://github.com/elastic/elasticsearch/issues/22103}\r\nif [ \"$1\" == \"update-jvm-perms\" ]\r\nthen\r\n  read -d '' JAVA_POLICY << EOF\r\ngrant {\r\n  permission java.lang.RuntimePermission \"accessDeclaredMembers\";\r\n  permission java.lang.reflect.ReflectPermission \"suppressAccessChecks\";\r\n};\r\nEOF\r\n  echo \"$JAVA_POLICY\" > .java.policy\r\nfi\r\n```\r\n\r\n```properties\r\n# log4j2.properties\r\nstatus = error\r\ndest = err\r\nname = PropertiesConfig\r\n\r\nappender.console.type = Console\r\nappender.console.name = STDOUT\r\nappender.console.layout.type = JsonLayout\r\nappender.console.layout.compact= true\r\nappender.console.layout.eventEol= true\r\nappender.console.layout.locationInfo= true\r\nappender.console.layout.stacktraceAsString= true\r\n\r\nrootLogger.level = info\r\nrootLogger.appenderRef.stdout.ref = STDOUT\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352877445","html_url":"https://github.com/elastic/elasticsearch/issues/27874#issuecomment-352877445","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27874","id":352877445,"node_id":"MDEyOklzc3VlQ29tbWVudDM1Mjg3NzQ0NQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-19T20:30:04Z","updated_at":"2017-12-19T20:30:04Z","author_association":"MEMBER","body":"> Yes, it completely helps! :) Thx!\r\n\r\nYou are very welcome. :smile:","performed_via_github_app":null}]