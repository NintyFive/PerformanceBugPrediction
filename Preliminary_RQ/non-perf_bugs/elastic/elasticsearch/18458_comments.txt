[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220252776","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-220252776","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":220252776,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDI1Mjc3Ng==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T07:53:11Z","updated_at":"2016-05-19T07:53:11Z","author_association":"CONTRIBUTOR","body":"I think `top_left` and `bottom_right` need to be swapped in the query. This query works:\n\n```\nPOST /test/a/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": {\n        \"match_all\": {}\n      },\n      \"filter\": {\n        \"geo_bounding_box\": {\n          \"location\": {\n            \"bottom_right\": [\n              56,\n              43\n            ],\n            \"top_left\": [\n              54,\n              45\n            ]\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nA better error message would certainly help here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220276428","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-220276428","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":220276428,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDI3NjQyOA==","user":{"login":"daamsie","id":740324,"node_id":"MDQ6VXNlcjc0MDMyNA==","avatar_url":"https://avatars0.githubusercontent.com/u/740324?v=4","gravatar_id":"","url":"https://api.github.com/users/daamsie","html_url":"https://github.com/daamsie","followers_url":"https://api.github.com/users/daamsie/followers","following_url":"https://api.github.com/users/daamsie/following{/other_user}","gists_url":"https://api.github.com/users/daamsie/gists{/gist_id}","starred_url":"https://api.github.com/users/daamsie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daamsie/subscriptions","organizations_url":"https://api.github.com/users/daamsie/orgs","repos_url":"https://api.github.com/users/daamsie/repos","events_url":"https://api.github.com/users/daamsie/events{/privacy}","received_events_url":"https://api.github.com/users/daamsie/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T09:41:58Z","updated_at":"2016-05-19T09:41:58Z","author_association":"NONE","body":"Interesting. But why would 54 be the top of the box and 56 be bottom? And why would 45 be right while 43 is left? That doesn't make any sense.\n\nFor now I am working around this bug by using a geo_polygon, but I understand the performance is not as good. \n\n```\ncurl -XPOST 'http://localhost:9200/test/a/_search' -d '\n{\n query: {\n    bool: {\n      must: {\n        match_all: {}\n      },\n      filter: {\n        geo_polygon: {\n        location : {\n            points: [\n                {lat: 43, lon: 54},\n                {lat: 43, lon: 56},\n                {lat: 45, lon: 56},\n                {lat: 45, lon: 54}\n            ]\n          }\n        }\n      }\n    }   \n  }\n}\n'\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220279737","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-220279737","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":220279737,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDI3OTczNw==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T09:56:44Z","updated_at":"2016-05-19T09:56:44Z","author_association":"CONTRIBUTOR","body":"@nknize can you please look at this issue. I think it has something todo with your geov2 changes. Maybe we trying to pull a double from a float field or something like this. It seems like the wrong decoding for prefix coded terms is used on the lucene level.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220290678","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-220290678","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":220290678,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDI5MDY3OA==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T10:49:48Z","updated_at":"2016-05-19T10:49:48Z","author_association":"CONTRIBUTOR","body":">  But why would 54 be the top of the box and 56 be bottom? And why would 45 be right while 43 is left? That doesn't make any sense.\n\nWhen you define a geo coordinate with [x, y] then x is the longitude and y the latitude, see [here](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-bounding-box-query.html#_lat_lon_as_array_2). \n\nSo [56, y] will be \"right\" (east, unless you want to span 56-54 once around earth) of  [54, y]  and [x, 45] would be \"above\" (north) of [x, 43]. \nAt least this is how I understood it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220291588","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-220291588","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":220291588,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDI5MTU4OA==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T10:54:34Z","updated_at":"2016-05-19T10:54:34Z","author_association":"CONTRIBUTOR","body":"Although now that I think about it I am assuming here that  +10 longitude means we are going east and I am not sure anymore this is correct. @nknize  will hopefully be able to explain.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220294484","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-220294484","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":220294484,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDI5NDQ4NA==","user":{"login":"daamsie","id":740324,"node_id":"MDQ6VXNlcjc0MDMyNA==","avatar_url":"https://avatars0.githubusercontent.com/u/740324?v=4","gravatar_id":"","url":"https://api.github.com/users/daamsie","html_url":"https://github.com/daamsie","followers_url":"https://api.github.com/users/daamsie/followers","following_url":"https://api.github.com/users/daamsie/following{/other_user}","gists_url":"https://api.github.com/users/daamsie/gists{/gist_id}","starred_url":"https://api.github.com/users/daamsie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daamsie/subscriptions","organizations_url":"https://api.github.com/users/daamsie/orgs","repos_url":"https://api.github.com/users/daamsie/repos","events_url":"https://api.github.com/users/daamsie/events{/privacy}","received_events_url":"https://api.github.com/users/daamsie/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T11:10:15Z","updated_at":"2016-05-19T11:10:15Z","author_association":"NONE","body":"+10 longitude does mean you're headed east. \n\nBut I see what you're saying now... I did know that geoJSON format has lon, then lat, but I didn't notice that top_left also follows this. The naming is _really_ confusing in that instance since it strongly implies that top (latitude) comes before left (longitude). It's like naming it latLon and then having the values be [lon, lat]\n\nAh well, in that case I agree that some better error messaging would be great here, but at least this thread now exists to help future people googling for an answer (I spent a while hunting for one on this! :))\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220325160","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-220325160","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":220325160,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMyNTE2MA==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T13:33:19Z","updated_at":"2016-05-19T13:33:19Z","author_association":"CONTRIBUTOR","body":"@daamsie I see how one could misinterpret `top_left` `bottom_right` json field names. For this reason we recommend expressing a geo point as an object so there's no ambiguity as to which value is lat and lon.\n\nStill, the error message indicates a bug with pole crossing. I would expect this query be split into 2 bboxes: [56, 43] , [180, -90] and [-180, 90] , [54, 45]  The fact this wasn't caught also indicates missing test coverage so thank you for pointing this out.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/221976428","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-221976428","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":221976428,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTk3NjQyOA==","user":{"login":"jweber","id":61980,"node_id":"MDQ6VXNlcjYxOTgw","avatar_url":"https://avatars0.githubusercontent.com/u/61980?v=4","gravatar_id":"","url":"https://api.github.com/users/jweber","html_url":"https://github.com/jweber","followers_url":"https://api.github.com/users/jweber/followers","following_url":"https://api.github.com/users/jweber/following{/other_user}","gists_url":"https://api.github.com/users/jweber/gists{/gist_id}","starred_url":"https://api.github.com/users/jweber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jweber/subscriptions","organizations_url":"https://api.github.com/users/jweber/orgs","repos_url":"https://api.github.com/users/jweber/repos","events_url":"https://api.github.com/users/jweber/events{/privacy}","received_events_url":"https://api.github.com/users/jweber/received_events","type":"User","site_admin":false},"created_at":"2016-05-26T19:54:12Z","updated_at":"2016-05-26T19:54:12Z","author_association":"NONE","body":"I just wanted to note that we started seeing this same issue after moving to 2.3.3.\n\nIf it helps, here are a few of the _geo_bounding_box_ values that were generating this message:\n\n`{\n    \"top_left\": \"48.65, -123.4805\",\n    \"bottom_right\": \"48.7, -123.409\"\n}`\n\n`{\n    \"top_left\": \"54, 10.5\",\n    \"bottom_right\": \"54.1, 10.6\"\n}`\n\n`{\n    \"top_left\": \"37.3, -112.6\",\n    \"bottom_right\": \"37.4, -112.5\"\n}`\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222011676","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-222011676","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":222011676,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjAxMTY3Ng==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2016-05-26T22:20:09Z","updated_at":"2016-05-26T22:20:09Z","author_association":"CONTRIBUTOR","body":"Hi @jweber, the coordinates should be in lon, lat order.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222012380","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-222012380","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":222012380,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjAxMjM4MA==","user":{"login":"jweber","id":61980,"node_id":"MDQ6VXNlcjYxOTgw","avatar_url":"https://avatars0.githubusercontent.com/u/61980?v=4","gravatar_id":"","url":"https://api.github.com/users/jweber","html_url":"https://github.com/jweber","followers_url":"https://api.github.com/users/jweber/followers","following_url":"https://api.github.com/users/jweber/following{/other_user}","gists_url":"https://api.github.com/users/jweber/gists{/gist_id}","starred_url":"https://api.github.com/users/jweber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jweber/subscriptions","organizations_url":"https://api.github.com/users/jweber/orgs","repos_url":"https://api.github.com/users/jweber/repos","events_url":"https://api.github.com/users/jweber/events{/privacy}","received_events_url":"https://api.github.com/users/jweber/received_events","type":"User","site_admin":false},"created_at":"2016-05-26T22:24:12Z","updated_at":"2016-05-26T22:24:12Z","author_association":"NONE","body":"[The docs](https://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-geo-bounding-box-query.html#_lat_lon_as_string_2) say that it should be in lat,lon order when used as a string. Is that incorrect?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222234380","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-222234380","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":222234380,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjIzNDM4MA==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2016-05-27T19:31:12Z","updated_at":"2016-05-27T19:31:12Z","author_association":"CONTRIBUTOR","body":"Sorry, you're correct. But in each of your examples the top `latitude` value is less than the bottom. So the bounding boxes will be crossing the pole. It looks like the check for this didn't make it into the 2.3 branch so you're getting the scary Lucene exception. I'll back port the friendlier exception. Thanks for the heads up!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222240422","html_url":"https://github.com/elastic/elasticsearch/issues/18458#issuecomment-222240422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","id":222240422,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjI0MDQyMg==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2016-05-27T20:01:53Z","updated_at":"2016-05-27T20:01:53Z","author_association":"CONTRIBUTOR","body":"I added the friendlier exception handling in https://github.com/elastic/elasticsearch/commit/55513946827b5061be6d431da5671711ec489d6c Its already fixed on master so I'm going to go ahead and close this issue.\n","performed_via_github_app":null}]