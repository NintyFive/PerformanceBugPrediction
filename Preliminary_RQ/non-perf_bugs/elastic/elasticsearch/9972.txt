{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9972","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9972/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9972/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9972/events","html_url":"https://github.com/elastic/elasticsearch/issues/9972","id":59705365,"node_id":"MDU6SXNzdWU1OTcwNTM2NQ==","number":9972,"title":"Indexing request failure during master re-elect","user":{"login":"ajhalani","id":1163503,"node_id":"MDQ6VXNlcjExNjM1MDM=","avatar_url":"https://avatars3.githubusercontent.com/u/1163503?v=4","gravatar_id":"","url":"https://api.github.com/users/ajhalani","html_url":"https://github.com/ajhalani","followers_url":"https://api.github.com/users/ajhalani/followers","following_url":"https://api.github.com/users/ajhalani/following{/other_user}","gists_url":"https://api.github.com/users/ajhalani/gists{/gist_id}","starred_url":"https://api.github.com/users/ajhalani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajhalani/subscriptions","organizations_url":"https://api.github.com/users/ajhalani/orgs","repos_url":"https://api.github.com/users/ajhalani/repos","events_url":"https://api.github.com/users/ajhalani/events{/privacy}","received_events_url":"https://api.github.com/users/ajhalani/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"assignees":[{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2015-03-03T21:06:00Z","updated_at":"2015-12-05T19:29:40Z","closed_at":"2015-12-05T19:29:40Z","author_association":"NONE","active_lock_reason":null,"body":"Using v1.4.1 on 2 clusters, one 8-node(1 primary, 3 replica) and a 2-node cluster (1 primary, 1 replica). When we shutdown the master, it takes 3-3.5 seconds to elect new master. During this time we see indexing failure on the still online node with response - \n\n> {\"error\":\"ClusterBlockException[blocked by: [SERVICE_UNAVAILABLE/2/no master];]\",\"status\":503}\n\nFor e.g timeline for 2 node cluster - two machines es1 and es2(old master which was shut down)\n\n```\n[2015-02-22 01:15:02,448][DEBUG][discovery.zen.fd         ] [es1.node2] [master] stopping fault detection against master [[es2.node2][vy1Q05dARpe96RTM_c0kFw][es2][inet[/10.126.44.92:9311]]{datacenter=ny, master=true}], reason [master left (reason = shut_down)]\n[2015-02-22 01:15:02,448][DEBUG][cluster.service          ] [es1.node2] cluster state updated, version [2649], source [zen-disco-master_failed ([es2.node2][vy1Q05dARpe96RTM_c0kFw][es2][inet[/10.126.44.92:9311]]{datacenter=ny, master=true})]\n[2015-02-22 01:15:02,448][INFO ][cluster.service          ] [es1.node2] removed {[es2.node2][vy1Q05dARpe96RTM_c0kFw][es2][inet[/10.126.44.92:9311]]{datacenter=ny, master=true},}, reason: zen-disco-master_failed ([es2.node2][vy1Q05dARpe96RTM_c0kFw][bgolnybcitap01][inet[/10.126.44.92:9311]]{datacenter=ny, master=true})\n[2015-02-22 01:15:02,448][DEBUG][cluster.service          ] [es1.node2] set local cluster state to version 2649\n[2015-02-22 01:15:02,450][DEBUG][transport.netty          ] [es1.node2] disconnecting from [[es2.node2][vy1Q05dARpe96RTM_c0kFw][es2][inet[/10.126.44.92:9311]]{datacenter=ny, master=true}] due to explicit disconnect call\n[2015-02-22 01:15:02,453][DEBUG][cluster.service          ] [es1.node2] processing [zen-disco-master_failed ([es2.node2][vy1Q05dARpe96RTM_c0kFw][es2][inet[/10.126.44.92:9311]]{datacenter=ny, master=true})]: done applying updated cluster_state (version: 2649)\n[2015-02-22 01:15:02,469][WARN ][action.index             ] [es1.node2] Failed to perform indices:data/write/index on remote replica [es2.node2][vy1Q05dARpe96RTM_c0kFw][es2][inet[/10.126.44.92:9311]]{datacenter=ny, master=true}[spend_20150215][0]org.elasticsearch.transport.NodeDisconnectedException: [es2.node2][inet[/10.126.44.92:9311]][indices:data/write/index[r]] disconnected\n[2015-02-22 01:15:02,469][WARN ][action.index             ] [es1.node2] Failed to perform indices:data/write/index on remote replica [es2.node2][vy1Q05dARpe96RTM_c0kFw][es2][inet[/10.126.44.92:9311]]{datacenter=ny, master=true}[spend_20150215][4]org.elasticsearch.transport.NodeDisconnectedException: [es2.node2][inet[/10.126.44.92:9311]][indices:data/write/index[r]] disconnected\n[2015-02-22 01:15:02,469][WARN ][action.index             ] [es1.node2] Failed to perform indices:data/write/index on remote replica [es2.node2][vy1Q05dARpe96RTM_c0kFw][es2][inet[/10.126.44.92:9311]]{datacenter=ny, master=true}[spend_20150215][1]org.elasticsearch.transport.NodeDisconnectedException: [es2.node2][inet[/10.126.44.92:9311]][indices:data/write/index[r]] disconnected\n[2015-02-22 01:15:02,473][WARN ][cluster.action.shard     ] [es1.node2] can't send shard failed for [spend_20150215][4], node[vy1Q05dARpe96RTM_c0kFw], [R], s[STARTED]. no master known.\n[2015-02-22 01:15:02,473][WARN ][cluster.action.shard     ] [es1.node2] can't send shard failed for [spend_20150215][0], node[vy1Q05dARpe96RTM_c0kFw], [R], s[STARTED]. no master known.\n[2015-02-22 01:15:02,473][WARN ][cluster.action.shard     ] [es1.node2] can't send shard failed for [spend_20150215][1], node[vy1Q05dARpe96RTM_c0kFw], [R], s[STARTED]. no master known.\n\n>> Indexing request comes at 22FEB2015_01:15:02.592 and fails immediately \n\n[2015-02-22 01:15:05,454][DEBUG][discovery.zen            ] [es1.node2] filtered ping responses: (filter_client[true], filter_data[false]) {none}\n[2015-02-22 01:15:05,454][DEBUG][cluster.service          ] [es1.node2] processing [zen-disco-join (elected_as_master)]: execute\n[2015-02-22 01:15:05,472][DEBUG][gateway.local            ] [es1.node2] [spend_phrases_20141120][0]: not allocating, number_of_allocated_shards_found [0], required_number [1]\n[2015-02-22 01:15:05,472][DEBUG][gateway.local            ] [es1.node2] [spend_phrases_20141120][2]: not allocating, number_of_allocated_shards_found [0], required_number [1]\n[2015-02-22 01:15:05,482][DEBUG][cluster.service          ] [es1.node2] cluster state updated, version [2650], source [zen-disco-join (elected_as_master)]\n[2015-02-22 01:15:05,482][INFO ][cluster.service          ] [es1.node2] new_master [es1.node2][XOS-rG5sTyqAHPLUiNAS-w][es1][inet[/10.126.158.82:9311]]{datacenter=nj, master=true}, reason: zen-disco-join (elected_as_master)\n```\n\nWe are using default settings for timeout etc, the error was not a timeout but an immediate failure. \n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}