[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/433346282","html_url":"https://github.com/elastic/elasticsearch/issues/34897#issuecomment-433346282","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34897","id":433346282,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMzM0NjI4Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-26T09:25:55Z","updated_at":"2018-10-26T09:25:55Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435381808","html_url":"https://github.com/elastic/elasticsearch/issues/34897#issuecomment-435381808","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34897","id":435381808,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTM4MTgwOA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T13:34:41Z","updated_at":"2018-11-02T13:34:41Z","author_association":"CONTRIBUTOR","body":"We discussed this and broadly agreed to do it. Note that we are not intending to change the meaning of `RED` health - it already means no master OR unassigned primaries, and we would like it to keep this meaning.\r\n\r\nWe contemplated _identifying_ the discovered master in the cluster health response. I think I'd rather just have a boolean `\"discovered_master\": true`, on the grounds that you can find out which node is the discovered master via other APIs (`GET _nodes/_master` for instance) and the identity of the master isn't important for the cluster's health.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/483539163","html_url":"https://github.com/elastic/elasticsearch/issues/34897#issuecomment-483539163","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34897","id":483539163,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MzUzOTE2Mw==","user":{"login":"getsaurabh02","id":15327011,"node_id":"MDQ6VXNlcjE1MzI3MDEx","avatar_url":"https://avatars0.githubusercontent.com/u/15327011?v=4","gravatar_id":"","url":"https://api.github.com/users/getsaurabh02","html_url":"https://github.com/getsaurabh02","followers_url":"https://api.github.com/users/getsaurabh02/followers","following_url":"https://api.github.com/users/getsaurabh02/following{/other_user}","gists_url":"https://api.github.com/users/getsaurabh02/gists{/gist_id}","starred_url":"https://api.github.com/users/getsaurabh02/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/getsaurabh02/subscriptions","organizations_url":"https://api.github.com/users/getsaurabh02/orgs","repos_url":"https://api.github.com/users/getsaurabh02/repos","events_url":"https://api.github.com/users/getsaurabh02/events{/privacy}","received_events_url":"https://api.github.com/users/getsaurabh02/received_events","type":"User","site_admin":false},"created_at":"2019-04-16T07:10:17Z","updated_at":"2019-04-16T07:10:17Z","author_association":"NONE","body":"I am currently working on it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/519441101","html_url":"https://github.com/elastic/elasticsearch/issues/34897#issuecomment-519441101","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34897","id":519441101,"node_id":"MDEyOklzc3VlQ29tbWVudDUxOTQ0MTEwMQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-08-08T09:22:45Z","updated_at":"2019-08-08T09:22:45Z","author_association":"CONTRIBUTOR","body":"We discussed this again recently and determined that `GET _cluster/health?timeout=0s` returns `503 Service Unavailable` when there is no master, and `200 OK` otherwise, so it looks like we don't need any further action here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/537894911","html_url":"https://github.com/elastic/elasticsearch/issues/34897#issuecomment-537894911","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34897","id":537894911,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNzg5NDkxMQ==","user":{"login":"getsaurabh02","id":15327011,"node_id":"MDQ6VXNlcjE1MzI3MDEx","avatar_url":"https://avatars0.githubusercontent.com/u/15327011?v=4","gravatar_id":"","url":"https://api.github.com/users/getsaurabh02","html_url":"https://github.com/getsaurabh02","followers_url":"https://api.github.com/users/getsaurabh02/followers","following_url":"https://api.github.com/users/getsaurabh02/following{/other_user}","gists_url":"https://api.github.com/users/getsaurabh02/gists{/gist_id}","starred_url":"https://api.github.com/users/getsaurabh02/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/getsaurabh02/subscriptions","organizations_url":"https://api.github.com/users/getsaurabh02/orgs","repos_url":"https://api.github.com/users/getsaurabh02/repos","events_url":"https://api.github.com/users/getsaurabh02/events{/privacy}","received_events_url":"https://api.github.com/users/getsaurabh02/received_events","type":"User","site_admin":false},"created_at":"2019-10-03T10:55:34Z","updated_at":"2019-10-03T10:55:34Z","author_association":"NONE","body":"Hi @DaveCTurner , thanks for responding on this. I tried running this and verified form code as well that `GET _cluster/health?timeout=0s` returns a valid response when used along with the flag `local=true` when no master is present. It does not return `503 Service Unavailable` as expected otherwise. \r\n\r\nThis makes the API behavior inconsistent with the presence of `local=true` field when master is not discovered on a node. Also, using the health API request always without the `local` field will not be an efficient choice for large clusters, when triggered frequently. \r\n\r\nIntroducing the `\"discovered_master\": true`, as thought earlier, allows the no-master cases to be distinguished consistently, with and without the presence of the `local` field. Thoughts?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/539029867","html_url":"https://github.com/elastic/elasticsearch/issues/34897#issuecomment-539029867","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34897","id":539029867,"node_id":"MDEyOklzc3VlQ29tbWVudDUzOTAyOTg2Nw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-10-07T14:09:04Z","updated_at":"2019-10-07T14:09:04Z","author_association":"CONTRIBUTOR","body":"> This makes the API behavior inconsistent\r\n\r\nAsking a node to compute the cluster health locally is always possible, so 200 seems like the right response there. 503 here doesn't mean simply \"unhealthy\", it means \"so unhealthy that I can't even answer your question\".\r\n\r\n> Also, using the health API request always without the local field will not be an efficient choice for large clusters, when triggered frequently.\r\n\r\nThis deserves some further investigation. Health requests should be pretty cheap, and there are benefits to getting an answer from the master. Are you really seeing the master struggling with the load here? Can you provide more details?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/655951655","html_url":"https://github.com/elastic/elasticsearch/issues/34897#issuecomment-655951655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34897","id":655951655,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTk1MTY1NQ==","user":{"login":"getsaurabh02","id":15327011,"node_id":"MDQ6VXNlcjE1MzI3MDEx","avatar_url":"https://avatars0.githubusercontent.com/u/15327011?v=4","gravatar_id":"","url":"https://api.github.com/users/getsaurabh02","html_url":"https://github.com/getsaurabh02","followers_url":"https://api.github.com/users/getsaurabh02/followers","following_url":"https://api.github.com/users/getsaurabh02/following{/other_user}","gists_url":"https://api.github.com/users/getsaurabh02/gists{/gist_id}","starred_url":"https://api.github.com/users/getsaurabh02/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/getsaurabh02/subscriptions","organizations_url":"https://api.github.com/users/getsaurabh02/orgs","repos_url":"https://api.github.com/users/getsaurabh02/repos","events_url":"https://api.github.com/users/getsaurabh02/events{/privacy}","received_events_url":"https://api.github.com/users/getsaurabh02/received_events","type":"User","site_admin":false},"created_at":"2020-07-09T07:22:39Z","updated_at":"2020-07-09T07:22:39Z","author_association":"NONE","body":"Hi @DaveCTurner replying back and requesting opening this thread again to get some more thoughts. We have seen instances where master node gets overwhelmed with too many *(periodic)* health requests being delegated to it from data nodes (without ```local=true```), typically in a large cluster, resulting into steep JVM spikes and causing master duress. This is more apparent when the master node is already under stress due to increased number of pending tasks, or busy managing cluster states, such as during full cluster restart.\r\n\r\nEven for non dedicated master setup, this can get aggravated with even with a small cluster sizes *(less than 10 nodes)*. This could typically happens in scenarios when cluster has a font end service, or a load balancer or maybe some monitoring script which intends to look for node health periodically, to send or restrict traffic to node, based upon nodes ability to process the request. Without the presence of field ```local=true``` in the health API call it is not possible to uncover scenarios where a node is not connected to the active master. Also ```cluster/health?timeout=0s``` returns a valid response when used along with the flag ```local=true``` when no master is present.\r\n\r\nAs there could be multiple reason which could lead a node to this situation, such as leader check failures due to network partitioning etc. Please let me know if it still makes sense to have a dedicated ```\"discovered_master\": true``` for better clarity. This will leverage the local cluster state, without having to delegate each request to master to discover its presence.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/655960359","html_url":"https://github.com/elastic/elasticsearch/issues/34897#issuecomment-655960359","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34897","id":655960359,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTk2MDM1OQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2020-07-09T07:38:50Z","updated_at":"2020-07-09T07:38:50Z","author_association":"CONTRIBUTOR","body":"Repeating my previous message, health requests should be pretty cheap, can you analyse this in more detail so we can understand better how and why it's struggling?","performed_via_github_app":null}]