[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183650799","html_url":"https://github.com/elastic/elasticsearch/issues/16642#issuecomment-183650799","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16642","id":183650799,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzY1MDc5OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-13T11:50:06Z","updated_at":"2016-02-13T11:50:06Z","author_association":"CONTRIBUTOR","body":"@roytmana could you please provide examples of what you are trying to achieve (and what can't be achieved by simply including the required parent field in the nested doc itself)?\n\nI'm sure that you are aware that nested docs are separate docs from the parent, so accessing the parent from the nested doc would be prohibitively expensive.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183909196","html_url":"https://github.com/elastic/elasticsearch/issues/16642#issuecomment-183909196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16642","id":183909196,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzkwOTE5Ng==","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"created_at":"2016-02-14T16:08:45Z","updated_at":"2016-02-14T16:08:45Z","author_association":"NONE","body":"Hello @clintongormley \n\nThe example below is just a small example to demonstrate the issue. In real life I have a number of nested (sometimes twice) of fields in the main object and the main object has hundreds of properties. I cannot embed all the parent object's properties into nested child objects because it is an entirely dynamic system and users can craft any kind of query or aggregation on any combination of properties. It would be impractical to repeat all parent (owner) properties in the nested child not to mention that the JSON is not for searching and aggregation only it is heavily used by other systems and other reports.\n\nOf course I understand that nested is a separate document and price of accessing parent may not be trivial but it is lot less expensive than in parent/child and in context of aggregation it could be optimized nicely if parent aggregation is on the owner object so it is already loaded and available within child aggregations. Also if trying to work around it with reverse nested aggregation incurs cost of fetching owner objects anyway (and does not work as you can see in example below).\n\nI think allowing access to parent fields using something like ../parentProperty would be terrific feature in supporting cases that otherwise required messy, inefficient and often very much unwanted denormalization \n\nAll the issues could be in some form worked around if you are hand-crafting a specific query and can modify your json on a dime (by bringing in needed parent properties into a nested field) just to satisfy your query. But in dynamic systems where queries are not known upfront and where JSON structure needs to be kept stable or versioned carefully it is just not possible \n\nImagine having Teams that handle Requests of certain Priority. Each request may have multiple teams assigned to it and each team request assignment has number of hours allocated for this team on a request:\n\n``` javascript\nrequest:{\n  priority:1,\n  teams:[\n    {name:'team1', hours:10},\n    {name:'team2', hours:20},\n  ]\n}\n```\n\nLet's try to produce a report that gives number of hours by team by priority. Doing nested aggregation on **teams.name** and then reverse nested to group on **priority** and then nested to sum **teams.hours** double-counts hours because second nesting on teams knows nothing about  upstream nesting as it is executed in context of request and as result it will lump hours for each team on request under the top level team aggregation \n\nIf i could access \"../priority\" from teams nested document context I would not have to use reverse nested and lose my aggregation context and everything would have worked like a charm\n\nSimilar case with filter aggregation - it is not possible to add any filtering logic on parent fields to it. While it is possible to put that logic into parent agg on the owner document it will only work with simple single purpose queries. Complex queries with multiple filters as sub aggs often have conflicting criteria in the filters (ex. each filter agg segments out a portion of docs based on parent's properties) forcing the aggregation to be split onto multiple queries and then re-aggregated  on the client. It could be non trivial if it is happening within some multi-bucket aggs\n\nThank you,\nAlex\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/184186158","html_url":"https://github.com/elastic/elasticsearch/issues/16642#issuecomment-184186158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16642","id":184186158,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NDE4NjE1OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-15T12:26:16Z","updated_at":"2016-02-15T12:26:16Z","author_association":"CONTRIBUTOR","body":"This issue is pretty much a duplicate of #16642, so I'll close this one in favour of the other\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/184277648","html_url":"https://github.com/elastic/elasticsearch/issues/16642#issuecomment-184277648","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16642","id":184277648,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NDI3NzY0OA==","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"created_at":"2016-02-15T16:16:03Z","updated_at":"2016-02-15T16:16:03Z","author_association":"NONE","body":"@clintongormley you are sating \"This issue is pretty much a duplicate of #16642, so I'll close this one in favour of the other\" but this is the #16642 I think you have already closed the other one\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/184278087","html_url":"https://github.com/elastic/elasticsearch/issues/16642#issuecomment-184278087","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16642","id":184278087,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NDI3ODA4Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-15T16:18:04Z","updated_at":"2016-02-15T16:18:04Z","author_association":"CONTRIBUTOR","body":"Sorry, I meant #16380\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/633143809","html_url":"https://github.com/elastic/elasticsearch/issues/16642#issuecomment-633143809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16642","id":633143809,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzE0MzgwOQ==","user":{"login":"huskizero","id":992378,"node_id":"MDQ6VXNlcjk5MjM3OA==","avatar_url":"https://avatars3.githubusercontent.com/u/992378?v=4","gravatar_id":"","url":"https://api.github.com/users/huskizero","html_url":"https://github.com/huskizero","followers_url":"https://api.github.com/users/huskizero/followers","following_url":"https://api.github.com/users/huskizero/following{/other_user}","gists_url":"https://api.github.com/users/huskizero/gists{/gist_id}","starred_url":"https://api.github.com/users/huskizero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/huskizero/subscriptions","organizations_url":"https://api.github.com/users/huskizero/orgs","repos_url":"https://api.github.com/users/huskizero/repos","events_url":"https://api.github.com/users/huskizero/events{/privacy}","received_events_url":"https://api.github.com/users/huskizero/received_events","type":"User","site_admin":false},"created_at":"2020-05-23T21:38:15Z","updated_at":"2020-05-23T21:38:15Z","author_association":"NONE","body":"This problem is not solved. The two tickets are referring to each other...\r\n\r\n#16380 and #16642\r\n\r\n> Sorry, I meant #16380\r\n\r\n","performed_via_github_app":null}]