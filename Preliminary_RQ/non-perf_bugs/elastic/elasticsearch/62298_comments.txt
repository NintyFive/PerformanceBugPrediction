[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/691964868","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-691964868","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":691964868,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MTk2NDg2OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-09-14T10:26:12Z","updated_at":"2020-09-14T10:26:12Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security (:Security/Network)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/692011511","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-692011511","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":692011511,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MjAxMTUxMQ==","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"created_at":"2020-09-14T12:10:39Z","updated_at":"2020-09-14T12:10:39Z","author_association":"CONTRIBUTOR","body":"Same failure in `SimpleSecurityNetty4ServerTransportTests.testHostOnMessages`.\r\n\r\nBuild scan: https://gradle-enterprise.elastic.co/s/t7qp3irnwdjvq","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/692976634","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-692976634","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":692976634,"node_id":"MDEyOklzc3VlQ29tbWVudDY5Mjk3NjYzNA==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2020-09-15T21:00:45Z","updated_at":"2020-09-15T21:00:45Z","author_association":"CONTRIBUTOR","body":"Had a failure from the the same class, but different test. I suspect similar root causes across the different tests, so documenting here instead of creating a new issue.  \r\n\r\nHere is the scan: https://gradle-enterprise.elastic.co/s/vg5asrz3uyiwg\r\n\r\n[90 failures](https://gradle-enterprise.elastic.co/scans/tests?list.size=50&list.sortColumn=startTime&list.sortOrder=desc&search.buildToolTypes=gradle&search.buildToolTypes=maven&search.relativeStartTime=P28D&search.timeZoneId=America/Chicago&tests.container=org.elasticsearch.xpack.security.transport.netty4.SimpleSecurityNetty4ServerTransportTests&tests.sortField=FAILED&tests.unstableOnly=true) from this class in the past 28 days. \r\n\r\n\r\n<img width=\"1898\" alt=\"image\" src=\"https://user-images.githubusercontent.com/976291/93264018-27886400-f76c-11ea-9bb5-4f0031259275.png\">\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/693286564","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-693286564","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":693286564,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzI4NjU2NA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-09-16T09:25:24Z","updated_at":"2020-09-16T09:25:24Z","author_association":"MEMBER","body":"Another similar looking one today on master, this time in `SimpleSecurityNetty4ServerTransportTests.testBlockingIncomingRequests`:\r\n\r\nhttps://gradle-enterprise.elastic.co/s/qo4epsr4q4lc6\r\n\r\n```\r\njava.lang.IllegalStateException: availableProcessors is already set to [32], rejecting [32]\r\n\tat io.netty.util.NettyRuntime$AvailableProcessorsHolder.setAvailableProcessors(NettyRuntime.java:51)\r\n\tat io.netty.util.NettyRuntime.setAvailableProcessors(NettyRuntime.java:87)\r\n\tat org.elasticsearch.transport.netty4.Netty4Utils.setAvailableProcessors(Netty4Utils.java:61)\r\n\tat org.elasticsearch.transport.netty4.Netty4Transport.<init>(Netty4Transport.java:106)\r\n\tat org.elasticsearch.xpack.core.security.transport.netty4.SecurityNetty4Transport.<init>(SecurityNetty4Transport.java:67)\r\n\tat org.elasticsearch.xpack.security.transport.netty4.SecurityNetty4ServerTransport.<init>(SecurityNetty4ServerTransport.java:39)\r\n\tat org.elasticsearch.xpack.security.transport.netty4.SimpleSecurityNetty4ServerTransportTests$1.<init>(SimpleSecurityNetty4ServerTransportTests.java:36)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/693366658","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-693366658","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":693366658,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzM2NjY1OA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-09-16T12:16:29Z","updated_at":"2020-09-16T12:16:29Z","author_association":"MEMBER","body":"Another one, this in `testTcpHandshakeConnectionReset`: https://gradle-enterprise.elastic.co/s/okvfiuzojb3v6","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/693388641","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-693388641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":693388641,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzM4ODY0MQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-09-16T13:00:35Z","updated_at":"2020-09-16T13:00:35Z","author_association":"MEMBER","body":"Three times is a charm: https://gradle-enterprise.elastic.co/s/xb2wcesocc7e4\r\nMuting the entire test for now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/693397186","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-693397186","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":693397186,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzM5NzE4Ng==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-09-16T13:15:09Z","updated_at":"2020-09-16T13:15:09Z","author_association":"MEMBER","body":"Muted with f5f72648d4a844147a2f2eef6affdd3d9aa404e2 and  f8634e5beabbf4f4d1e7eafd8491593ef7ecdc36 on master and 7.x","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/693397952","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-693397952","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":693397952,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzM5Nzk1Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-09-16T13:16:23Z","updated_at":"2020-09-16T13:16:23Z","author_association":"MEMBER","body":"@elastic/es-security please reenable the test if this muting feels too crude, I muted the whole tests since several methods seem to fail but if its clear that these are only a couple the muting might possibly be more fine grained.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/696106568","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-696106568","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":696106568,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NjEwNjU2OA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-09-21T13:15:10Z","updated_at":"2020-09-21T13:15:10Z","author_association":"CONTRIBUTOR","body":"The same `availableProcessors is already set to [N], rejecting [N]` message was seen in `IPFilterTests.testThatNodeStartsWithIPFilterDisabled` in https://gradle-enterprise.elastic.co/s/em5noqiaekl7o\r\n\r\nAs with all the other failures, it's nothing really to do with the exact test that failed, but with something more generic in the mock node setup.\r\n\r\nThere is code in `Netty4Utils.java` that is supposed to prevent this, and comments about how the special setting is only required for tests:\r\n\r\n```\r\n        // we set this to false in tests to avoid tests that randomly set processors from stepping on each other\r\n        final boolean set = Booleans.parseBoolean(System.getProperty(\"es.set.netty.runtime.available.processors\", \"true\"));\r\n        if (!set) {\r\n            return;\r\n        }\r\n\r\n        /*\r\n         * This can be invoked twice, once from Netty4Transport and another time from Netty4HttpServerTransport; however,\r\n         * Netty4Runtime#availableProcessors forbids settings the number of processors twice so we prevent double invocation here.\r\n         */\r\n        if (isAvailableProcessorsSet.compareAndSet(false, true)) {\r\n            NettyRuntime.setAvailableProcessors(availableProcessors);\r\n```\r\n\r\nSo it seems that the solution is just to set `es.set.netty.runtime.available.processors: false` in many security tests.  It's probably best to do this sooner rather than later because muting `SimpleSecurityNetty4ServerTransportTests` just seems to have moved the problem to different tests, so eventually masses of tests will end up getting muted if it's left unfixed.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/696127421","html_url":"https://github.com/elastic/elasticsearch/issues/62298#issuecomment-696127421","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62298","id":696127421,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NjEyNzQyMQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-09-21T13:50:13Z","updated_at":"2020-09-21T13:50:13Z","author_association":"CONTRIBUTOR","body":"`IPFilterTests.testThatNodeStartsWithIPFilterDisabled` has failed 3 times today because of this. I have muted it on master and 7.x:\r\n\r\n- master: 352b2c39b1c6c0b42d61ce09ebd5dd4482a8cb92\r\n- 7.x: 453756169252157a61ef6ae55ff7037f5f66f1d0","performed_via_github_app":null}]