[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62188111","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-62188111","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":62188111,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMTg4MTEx","user":{"login":"andrassy","id":890433,"node_id":"MDQ6VXNlcjg5MDQzMw==","avatar_url":"https://avatars1.githubusercontent.com/u/890433?v=4","gravatar_id":"","url":"https://api.github.com/users/andrassy","html_url":"https://github.com/andrassy","followers_url":"https://api.github.com/users/andrassy/followers","following_url":"https://api.github.com/users/andrassy/following{/other_user}","gists_url":"https://api.github.com/users/andrassy/gists{/gist_id}","starred_url":"https://api.github.com/users/andrassy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrassy/subscriptions","organizations_url":"https://api.github.com/users/andrassy/orgs","repos_url":"https://api.github.com/users/andrassy/repos","events_url":"https://api.github.com/users/andrassy/events{/privacy}","received_events_url":"https://api.github.com/users/andrassy/received_events","type":"User","site_admin":false},"created_at":"2014-11-07T18:15:42Z","updated_at":"2014-11-07T18:15:42Z","author_association":"NONE","body":"A little bit of digging in the code and I came across the \"index.load_fixed_bitset_filters_eagerly\" setting. Setting this to false seems to avoid my initial problem. Has the default changed? Is this something new? Are there any impacts I might need to look out for in setting this to false?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62188358","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-62188358","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":62188358,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMTg4MzU4","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-11-07T18:17:24Z","updated_at":"2014-11-07T18:17:24Z","author_association":"MEMBER","body":"Hey @andrassy how many nested object fields do you have in all your mappings?\n\nSince 1.4 we eagerly load the filters and keep them around to make nested query execution as fast as possible. Under the hood the nested query relies on the fact that these filters are in memory as bitsets.\n\nThe `index.load_fixed_bitset_filters_eagerly` setting has been added to disable the eager loading, but at some point when running nested queries these filters will end up in the heap as bitsets. Maybe disabling in your case make sense in the case if you have many nested object fields, but not all are used.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62190361","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-62190361","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":62190361,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMTkwMzYx","user":{"login":"andrassy","id":890433,"node_id":"MDQ6VXNlcjg5MDQzMw==","avatar_url":"https://avatars1.githubusercontent.com/u/890433?v=4","gravatar_id":"","url":"https://api.github.com/users/andrassy","html_url":"https://github.com/andrassy","followers_url":"https://api.github.com/users/andrassy/followers","following_url":"https://api.github.com/users/andrassy/following{/other_user}","gists_url":"https://api.github.com/users/andrassy/gists{/gist_id}","starred_url":"https://api.github.com/users/andrassy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrassy/subscriptions","organizations_url":"https://api.github.com/users/andrassy/orgs","repos_url":"https://api.github.com/users/andrassy/repos","events_url":"https://api.github.com/users/andrassy/events{/privacy}","received_events_url":"https://api.github.com/users/andrassy/received_events","type":"User","site_admin":false},"created_at":"2014-11-07T18:31:48Z","updated_at":"2014-11-07T18:31:48Z","author_association":"NONE","body":"_stats reports doc count just above 600 million docs for the index (which includes the nesteds, right?) - 10 shards across 5 data nodes at  present. There are quite a few nested mappings which we do use, but I think that we're probably not hitting the full parent doc set due to other filters being applied when we actually query - would that keep the bit filter caches smaller? It's just that we don't seem to have hit any OOM limits recently, operating with 1.3.x and prior versions for some time. \n\nWe could restructure the data to avoid many of the nested mappings I think but this'll take us some time :( and involve some code changes right the way up our stack. We'll try with the index.load_fixed_bitset_filters_eagerly setting as false and see how we get on. \n\nThought it was worth sharing the issue here. Thanks for the rapid response @martijnvg!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62191676","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-62191676","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":62191676,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMTkxNjc2","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-11-07T18:41:08Z","updated_at":"2014-11-07T18:41:08Z","author_association":"MEMBER","body":"@andrassy Sharing this is really important! ES may needs to change its default behaviour when it comes to eager loading filters associated with nested object fields.\n\nYes, the doc count does include nested documents. You said you have quite a few nested object fields. Can you give share how many nested fields you have (check the mapping) ? (or an estimation)\n\nIn the node stats api we also expose how much the bit set filter is taking (under the fixed_bit_set_memory_in_bytes key). Are you able to check this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62193102","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-62193102","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":62193102,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMTkzMTAy","user":{"login":"andrassy","id":890433,"node_id":"MDQ6VXNlcjg5MDQzMw==","avatar_url":"https://avatars1.githubusercontent.com/u/890433?v=4","gravatar_id":"","url":"https://api.github.com/users/andrassy","html_url":"https://github.com/andrassy","followers_url":"https://api.github.com/users/andrassy/followers","following_url":"https://api.github.com/users/andrassy/following{/other_user}","gists_url":"https://api.github.com/users/andrassy/gists{/gist_id}","starred_url":"https://api.github.com/users/andrassy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrassy/subscriptions","organizations_url":"https://api.github.com/users/andrassy/orgs","repos_url":"https://api.github.com/users/andrassy/repos","events_url":"https://api.github.com/users/andrassy/events{/privacy}","received_events_url":"https://api.github.com/users/andrassy/received_events","type":"User","site_admin":false},"created_at":"2014-11-07T18:51:20Z","updated_at":"2014-11-07T18:51:20Z","author_association":"NONE","body":"We have three types within the index with 5, 5, and 4 (totalling 14) nested properties.\n\nfixed_bit_set_memory_in_bytes currently says 0, but I only just started to recover with load_fixed_bitset_filters_eagerly set to false. I'll check again once we've seen some traffic - it'll probably be Monday now as it's our DEV box and everyone else went home already :D\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62194995","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-62194995","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":62194995,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMTk0OTk1","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-11-07T19:03:39Z","updated_at":"2014-11-07T19:03:39Z","author_association":"MEMBER","body":"Ok, would be great to know how much `fixed_bit_set_memory_in_bytes` is being reported.\n\nDo you by any chance also have a `_parent` fields configured in your mappings? Each parent type increases the entries in the bitset cache.\n\nAlso beyond that do you have any other warming configured? (warmer queries, eager field data loading)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62202379","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-62202379","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":62202379,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMjAyMzc5","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-11-07T19:54:32Z","updated_at":"2014-11-07T19:54:32Z","author_association":"MEMBER","body":"Also if you are able to share your mappings (or a dummy mapping that show the structure of your nested object fields) that would be helpful to see if we can improve this. Having 14 types and 600M docs shouldn't result in a OOM with your available heap space.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63126327","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-63126327","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":63126327,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMTI2MzI3","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T20:45:26Z","updated_at":"2014-11-14T20:45:26Z","author_association":"MEMBER","body":"By changing the default eager loading behaviour and changing the dependency on bitset based filters in nested and parent/child via the following issues: #8454, #8440 and #8414, running out of memory like happened here will not happen anymore.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65835045","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-65835045","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":65835045,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODM1MDQ1","user":{"login":"portante","id":949097,"node_id":"MDQ6VXNlcjk0OTA5Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/949097?v=4","gravatar_id":"","url":"https://api.github.com/users/portante","html_url":"https://github.com/portante","followers_url":"https://api.github.com/users/portante/followers","following_url":"https://api.github.com/users/portante/following{/other_user}","gists_url":"https://api.github.com/users/portante/gists{/gist_id}","starred_url":"https://api.github.com/users/portante/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/portante/subscriptions","organizations_url":"https://api.github.com/users/portante/orgs","repos_url":"https://api.github.com/users/portante/repos","events_url":"https://api.github.com/users/portante/events{/privacy}","received_events_url":"https://api.github.com/users/portante/received_events","type":"User","site_admin":false},"created_at":"2014-12-05T18:45:23Z","updated_at":"2014-12-05T18:45:23Z","author_association":"NONE","body":"I just upgraded from 1.3.2-1 to 1.4.1 and am seeing the following OOMs:\n\n```\n[2014-12-05 13:32:14,166][WARN ][index.warmer             ] [Patriots] [foo.bar-20140831][0] failed to load fixed bitset for [org.elasticsearch.index.search.nested.NonNestedDocsFilter@a801f786]  \norg.elasticsearch.common.util.concurrent.ExecutionError: java.lang.OutOfMemoryError: Java heap space  \n        at org.elasticsearch.common.cache.LocalCache$Segment.get(LocalCache.java:2201)  \n        at org.elasticsearch.common.cache.LocalCache.get(LocalCache.java:3937)  \n        at org.elasticsearch.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4739)  \n        at org.elasticsearch.index.cache.fixedbitset.FixedBitSetFilterCache.getAndLoadIfNotPresent(FixedBitSetFilterCache.java:137)  \n        at org.elasticsearch.index.cache.fixedbitset.FixedBitSetFilterCache.access$100(FixedBitSetFilterCache.java:73)  \n        at org.elasticsearch.index.cache.fixedbitset.FixedBitSetFilterCache$FixedBitSetFilterWarmer$1.run(FixedBitSetFilterCache.java:278)  \n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)  \n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)  \n        at java.lang.Thread.run(Thread.java:745)  \nCaused by: java.lang.OutOfMemoryError: Java heap space  \n```\n\nIs this related to this problem?  And if so, do I have to change something else for my indexes, or should this change in 1.4.1 have fixed this already?\n\nSee also my comment in: https://github.com/elasticsearch/elasticsearch/issues/8487\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65859639","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-65859639","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":65859639,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODU5NjM5","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-12-05T21:46:25Z","updated_at":"2014-12-05T21:48:12Z","author_association":"MEMBER","body":"@portante ES version 1.4.1 should have fixed OOM issue related to the fixed bitset cache.\n\nif possible can you share the following:\n- Your mappings: localhost:9200/_mappings\n- Cluster stats: localhost:9200/_cluster/stats?human&pretty\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65865124","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-65865124","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":65865124,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODY1MTI0","user":{"login":"portante","id":949097,"node_id":"MDQ6VXNlcjk0OTA5Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/949097?v=4","gravatar_id":"","url":"https://api.github.com/users/portante","html_url":"https://github.com/portante","followers_url":"https://api.github.com/users/portante/followers","following_url":"https://api.github.com/users/portante/following{/other_user}","gists_url":"https://api.github.com/users/portante/gists{/gist_id}","starred_url":"https://api.github.com/users/portante/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/portante/subscriptions","organizations_url":"https://api.github.com/users/portante/orgs","repos_url":"https://api.github.com/users/portante/repos","events_url":"https://api.github.com/users/portante/events{/privacy}","received_events_url":"https://api.github.com/users/portante/received_events","type":"User","site_admin":false},"created_at":"2014-12-05T22:30:35Z","updated_at":"2014-12-05T22:30:35Z","author_association":"NONE","body":"@martijnvg: Loaded the above in the following gist: https://gist.github.com/portante/711aa2428461a7485384\n\nI did not provide all the mappings for each index, instead I gave you one representative one of each type, sosreport, sar, and marvel (which is already known).\n\nI also provided a /_cat/shards output so you can see the relative sizes of the indexes.  The vos.sar-\\* indexes are about 10 - 13 GB, while all the others seem to be in sub-1 GB ranges.\n\nI have successfully loaded all .marvel_, tvos._, vos.sosreport-\\* indexes, but have been unsuccessful with the vos.sar-\\* indexes.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65871792","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-65871792","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":65871792,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODcxNzky","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-12-05T23:34:40Z","updated_at":"2014-12-05T23:34:40Z","author_association":"MEMBER","body":"I see that the fixed bitset cache already takes 10GB and many of your shards are not started. In total you have assigned 206GB of jvm heap to ES, which feels more than sufficient, so I don't see directly why you would run OOM. However in general this amount of heap for a single node is too high and should be split across more nodes (can be on the same physical machine). That being sad this shouldn't result in the situation you're in now. \n\nAlso the vos.sar-20141019 index has in total 14 unique nested object fields. Do the other indices have the same nested fields? And how many Lucene documents (this different than the number of documents in ES when nested fields have been defined in the mapping) do those indices have in total (more or less)? This can be found in the indices stats api under docs.stats?\n\nAs I commented earlier here ES since 1.4 loads a data-structure eagerly in memory in order for nested query/filter and nested aggregations to run fast. (not loading it when it is needed). \n\nIn order to get all shards started I recommend setting `index.load_fixed_bitset_filters_eagerly` to `false` in your elasticsearch.yml file and restart. This disables the eager loading and prevents the OOM caused by the stack trace you send earlier.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65872413","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-65872413","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":65872413,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODcyNDEz","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-12-05T23:42:08Z","updated_at":"2014-12-05T23:42:08Z","author_association":"MEMBER","body":"@portante It is better to run the indices stats after you configured the mentioned setting and the cat indices api maybe provides a better view to the metric: localhost:9200/_cat/indices/vos.sar-*\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65883607","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-65883607","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":65883607,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODgzNjA3","user":{"login":"portante","id":949097,"node_id":"MDQ6VXNlcjk0OTA5Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/949097?v=4","gravatar_id":"","url":"https://api.github.com/users/portante","html_url":"https://github.com/portante","followers_url":"https://api.github.com/users/portante/followers","following_url":"https://api.github.com/users/portante/following{/other_user}","gists_url":"https://api.github.com/users/portante/gists{/gist_id}","starred_url":"https://api.github.com/users/portante/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/portante/subscriptions","organizations_url":"https://api.github.com/users/portante/orgs","repos_url":"https://api.github.com/users/portante/repos","events_url":"https://api.github.com/users/portante/events{/privacy}","received_events_url":"https://api.github.com/users/portante/received_events","type":"User","site_admin":false},"created_at":"2014-12-06T03:24:34Z","updated_at":"2014-12-06T03:24:34Z","author_association":"NONE","body":"@martijnvg, can you explain why having more memory is too much?  I can certainly break this up, but that seems counter intuitive.\n\nAll the vos.sar-\\* indices CAN have 14 unique indexes.  Most about about 6 - 8, if I understand the data set correctly.\n\nIn the provided gist, you can see that value: https://gist.github.com/portante/711aa2428461a7485384#file-shards-cat-L71\n\nEach indexed sar document represents one sample collected as reported by the `sadf` command from sysstat.  On some systems they might collect 144 samples a day (10 min intervals), some have 8,600+ samples (10 seconds per day).  What really seems to affect the size of things is the number of nested elements.  We have seen VM hosts with close to 1,000 nics servicing VMs, which ends up have one per net-dev and net-edev docs.  Or they might have 400+ block devices ending up with that many nested docs for disks.\n\nI had disabled the index warmers on those large indexes as a work-around.  After enabling the warmers, and applying the setting above, the instance now takes about a 3 minutes to load up from ES start.\n\nMuch better. Thanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65955901","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-65955901","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":65955901,"node_id":"MDEyOklzc3VlQ29tbWVudDY1OTU1OTAx","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-12-07T21:27:02Z","updated_at":"2014-12-07T21:27:02Z","author_association":"MEMBER","body":"@portante This is the reason: http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/heap-sizing.html#compressed_oops\n\nNow that all shards are started can you share how much docs all the vos.sar-\\* indices have? \nBest way to share this is via running: `curl 'localhost:9200/_cat/shards/vos.sar-*'`. \nThis can give a good indication how much heap memory the fixed bitset cache will take if everything is being loaded.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66140869","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-66140869","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":66140869,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTQwODY5","user":{"login":"portante","id":949097,"node_id":"MDQ6VXNlcjk0OTA5Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/949097?v=4","gravatar_id":"","url":"https://api.github.com/users/portante","html_url":"https://github.com/portante","followers_url":"https://api.github.com/users/portante/followers","following_url":"https://api.github.com/users/portante/following{/other_user}","gists_url":"https://api.github.com/users/portante/gists{/gist_id}","starred_url":"https://api.github.com/users/portante/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/portante/subscriptions","organizations_url":"https://api.github.com/users/portante/orgs","repos_url":"https://api.github.com/users/portante/repos","events_url":"https://api.github.com/users/portante/events{/privacy}","received_events_url":"https://api.github.com/users/portante/received_events","type":"User","site_admin":false},"created_at":"2014-12-08T16:23:53Z","updated_at":"2014-12-08T16:23:53Z","author_association":"NONE","body":"@martijnvg, I have updated that gist with the output requested above (using wildcards did not work on the _cat command for some reason for me), see https://gist.github.com/portante/711aa2428461a7485384#file-shards-txt\n\nI'll have to think about the compressed_oops and how we can restructure to take advantage of that.  It seems like this would be a nice feature to have for ES where it would break itself up into smaller instances automatically instead of having to require the users to do it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76510723","html_url":"https://github.com/elastic/elasticsearch/issues/8394#issuecomment-76510723","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8394","id":76510723,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NTEwNzIz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-02-28T04:56:22Z","updated_at":"2015-02-28T04:56:22Z","author_association":"CONTRIBUTOR","body":"I think this ticket can be closed now? Feel free to reopen if more discussion is needed\n","performed_via_github_app":null}]