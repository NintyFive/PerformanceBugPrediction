{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8361","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8361/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8361/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8361/events","html_url":"https://github.com/elastic/elasticsearch/issues/8361","id":47947533,"node_id":"MDU6SXNzdWU0Nzk0NzUzMw==","number":8361,"title":"OOM when indexing large volumes on a single 1.4b1 node ","user":{"login":"thomasmarkus","id":5584610,"node_id":"MDQ6VXNlcjU1ODQ2MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/5584610?v=4","gravatar_id":"","url":"https://api.github.com/users/thomasmarkus","html_url":"https://github.com/thomasmarkus","followers_url":"https://api.github.com/users/thomasmarkus/followers","following_url":"https://api.github.com/users/thomasmarkus/following{/other_user}","gists_url":"https://api.github.com/users/thomasmarkus/gists{/gist_id}","starred_url":"https://api.github.com/users/thomasmarkus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thomasmarkus/subscriptions","organizations_url":"https://api.github.com/users/thomasmarkus/orgs","repos_url":"https://api.github.com/users/thomasmarkus/repos","events_url":"https://api.github.com/users/thomasmarkus/events{/privacy}","received_events_url":"https://api.github.com/users/thomasmarkus/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"assignees":[{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2014-11-06T10:42:03Z","updated_at":"2014-11-12T17:40:11Z","closed_at":"2014-11-12T17:40:11Z","author_association":"NONE","active_lock_reason":null,"body":"We're importing compressed logs (about 7G uncompressed per day and testing with 30 days total) on a single elastic search node with 8G of heap of 16G total on the machine. I'm stress-testing the single ES node (centos 7 + latest openjdk7, ES installed via the RPM) with a maximum of 70 concurrent curl processes feeding ES started from a ruby script, using the bulk API, to insert about 1000 log lines (wildfly client request logs) per curl proces. Data is added to a daily index and I optimize the index after each day's import is completed.\n\nAfter several hours ES 1.4b1 starts logging excessive gc activity like so:\n\n[2014-11-06 00:00:02,079][INFO ][monitor.jvm              ] [Gorr] [gc][old][32172][4535] duration [8.3s], collections [1]/[8.8s], total [8.3s]/[2.8h], memory [7.5gb]->[7.3gb]/[7.7gb], all_pools {[young] [360.8mb]->[160.5mb]/[532.5mb]}{[survivor] [0b]->[0b]/[66.5mb]}{[old] [7.1gb]->[7.1gb]/[7.1gb]}\n[2014-11-06 00:00:15,211][WARN ][monitor.jvm              ] [Gorr] [gc][old][32173][4536] duration [12.8s], collections [1]/[13.2s], total [12.8s]/[2.8h], memory [7.3gb]->[7.3gb]/[7.7gb], all_pools {[young] [160.5mb]->[190.1mb]/[532.5mb]}{[survivor] [0b]->[0b]/[66.5mb]}{[old] [7.1gb]->[7.1gb]/[7.1gb]}\n[2014-11-06 00:00:28,292][WARN ][monitor.jvm              ] [Gorr] [gc][old][32174][4537] duration [12.5s], collections [1]/[13s], total [12.5s]/[2.8h], memory [7.3gb]->[7.2gb]/[7.7gb], all_pools {[young] [190.1mb]->[101.4mb]/[532.5mb]}{[survivor] [0b]->[0b]/[66.5mb]}{[old] [7.1gb]->[7.1gb]/[7.1gb]}\n\nDuring previous runs with 2G heap I would get heap space exhausted exceptions which I initially attributed to query load coming from Kibana. However, I'm still seeing growing memory use with a 8GB heap for ES and no queries during indexing from Kibana.\nI would expect the memory use to be roughly constant over time during indexing, but I only notice logged GC activity after importing > 90 days of logs (about 90GB). Last night I had gc lines like the above during more than 10 hours after which I restarted the node to improve the situation. Imports continued at their usual pace after this node restart.\n\nI'm aware that this issue description is vague. Please advice me on what metrics you need to debug this issue.\n\n---\n\njava version \"1.7.0_71\"\nOpenJDK Runtime Environment (rhel-2.5.3.1.el7_0-x86_64 u71-b14)\nOpenJDK 64-Bit Server VM (build 24.65-b04, mixed mode)\n","closed_by":{"login":"thomasmarkus","id":5584610,"node_id":"MDQ6VXNlcjU1ODQ2MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/5584610?v=4","gravatar_id":"","url":"https://api.github.com/users/thomasmarkus","html_url":"https://github.com/thomasmarkus","followers_url":"https://api.github.com/users/thomasmarkus/followers","following_url":"https://api.github.com/users/thomasmarkus/following{/other_user}","gists_url":"https://api.github.com/users/thomasmarkus/gists{/gist_id}","starred_url":"https://api.github.com/users/thomasmarkus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thomasmarkus/subscriptions","organizations_url":"https://api.github.com/users/thomasmarkus/orgs","repos_url":"https://api.github.com/users/thomasmarkus/repos","events_url":"https://api.github.com/users/thomasmarkus/events{/privacy}","received_events_url":"https://api.github.com/users/thomasmarkus/received_events","type":"User","site_admin":false},"performed_via_github_app":null}