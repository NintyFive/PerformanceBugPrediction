{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21329","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21329/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21329/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21329/events","html_url":"https://github.com/elastic/elasticsearch/issues/21329","id":187303862,"node_id":"MDU6SXNzdWUxODczMDM4NjI=","number":21329,"title":"Shards wont get assigned after cluster restart","user":{"login":"barton-im","id":4304093,"node_id":"MDQ6VXNlcjQzMDQwOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/4304093?v=4","gravatar_id":"","url":"https://api.github.com/users/barton-im","html_url":"https://github.com/barton-im","followers_url":"https://api.github.com/users/barton-im/followers","following_url":"https://api.github.com/users/barton-im/following{/other_user}","gists_url":"https://api.github.com/users/barton-im/gists{/gist_id}","starred_url":"https://api.github.com/users/barton-im/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/barton-im/subscriptions","organizations_url":"https://api.github.com/users/barton-im/orgs","repos_url":"https://api.github.com/users/barton-im/repos","events_url":"https://api.github.com/users/barton-im/events{/privacy}","received_events_url":"https://api.github.com/users/barton-im/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-11-04T10:52:33Z","updated_at":"2016-11-04T13:51:29Z","closed_at":"2016-11-04T13:51:29Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch 1.7.1\r\n\r\nOS: Debian 7\r\n\r\nI have several indices in my cluster that got only partially assigned (some of the shards are normally assigned where the other shards are stuck in unassigned state). The cluster restart doesnt help, after restart always the same shards are not assigned. I got to this state when I was running out of space (had to raise the watermark for shard allocation) and installed new disks on the machines in a rolling fashion. But some of the shards got stuck still not being assigned, so I tried to disable the free space allocation altogether and restarted the cluster after which some of the shards came back but still some didnt. \r\nNow I am in a state where I see the data in the shards that are not assigned. I tried to check some with CheckIndex tool that says that everything is OK with that shard. I tried to look for .recovering files in the translog but there are none. I tried to change the replication and close open indices but in the logs I dont even see a trace of the ES trying to allocate the failed shard. \r\nI tried the reroute assign API, but without the allow_primary=true it just says the 400 error and if I allow the primary it deletes the existing shard with empty one so that is a no go for me. The reroute?explain says that the shards are \"CLUSTER_RECOVERED\".\r\nI tried to mess around with the data dir (removing the \" _state\" and \"translog\" directories for the index and shard and restart the node but with no success.\r\n\r\nIs there a way to somehow \"reset\" the ES metadata for a given shard so I dont loose the actual lucene data in the shard? Seems to me like some inconsistent ES state for the given shard(s).\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}