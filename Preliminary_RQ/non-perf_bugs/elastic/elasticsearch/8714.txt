{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8714","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8714/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8714/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8714/events","html_url":"https://github.com/elastic/elasticsearch/issues/8714","id":50464943,"node_id":"MDU6SXNzdWU1MDQ2NDk0Mw==","number":8714,"title":"Better error message for update document with parent","user":{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars0.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-11-30T17:55:27Z","updated_at":"2014-12-01T16:38:25Z","closed_at":"2014-12-01T10:01:36Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"If I update a document that has a parent and I do not provide a routing value elasticsearch fails. This is expected (see #3334) but imo the error message should not be a null pointer exception but something that tells the cause of the failure.\n\nHere is a script that reproduces the error:\n\n``` shell\n#!/bin/sh\n\ncurl -XDELETE \"http://localhost:9200/bugreport\"\ncurl -XPUT \"http://localhost:9200/bugreport\"\necho \"\"\necho \"create tasks:\"\ncurl -XPUT \"http://localhost:9200/bugreport/_mapping/tasks\" -d '{\n\"tasks\": {\n    \"_id\": {\"path\": \"id\", \"index\": \"not_analyzed\"},\n    \"properties\": {\n        \"id\": {\"type\": \"string\", \"index\": \"not_analyzed\"}\n    }\n}}'\necho \"\"\necho \"create task_comments:\"\ncurl -XPUT \"http://localhost:9200/bugreport/_mapping/task_comments\" -d '{\n\"task_comments\": {\n    \"_parent\": {\"type\": \"tasks\"},\n    \"_routing\": {\"required\": true},\n    \"properties\": {\n        \"taskId\": {\"type\": \"string\", \"index\": \"not_analyzed\"},\n        \"message\": {\"type\": \"string\"}\n    }\n}}'\necho \"\"\necho \"add task record:\"\ncurl -XPUT \"http://localhost:9200/bugreport/tasks/cebe%2Ftest%2F6?op_type=create\" -d '{\n    \"title\":\"test\",\n    \"description\":\"test\",\n    \"id\":\"cebe\\/test\\/6\"\n}'\necho \"\"\necho \"add task_comments record:\"\ncurl -XPUT \"http://localhost:9200/bugreport/task_comments/1?op_type=create&parent=cebe%2Ftest%2F6\" -d '{\n    \"taskId\":\"cebe\\/test\\/6\",\n    \"authorId\":\"cebe\",\n    \"message\":\"asdasd\"\n}'\necho \"\"\necho \"update it:\"\ncurl -XPOST \"http://localhost:9200/bugreport/task_comments/_bulk\" -d '\n{\"update\":{\"_id\":\"1\",\"_type\":\"task_comments\",\"_index\":\"bugreport\"}}\n{\"doc\":{\"message\":\"as asdf\",\"updated\":\"2014-10-24 21:59:18\"}}\n\n'\n#{\"update\":{\"_id\":\"1\",\"_routing\": \"cebe\\/test\\/6\",\"_type\":\"task_comments\",\"_index\":\"bugreport\"}}\n\n```\n\noutput:\n\n```\n{\"acknowledged\":true}{\"acknowledged\":true}\ncreate tasks:\n{\"acknowledged\":true}\ncreate task_comments:\n{\"acknowledged\":true}\nadd task record:\n{\"_index\":\"bugreport\",\"_type\":\"tasks\",\"_id\":\"cebe/test/6\",\"_version\":1,\"created\":true}\nadd task_comments record:\n{\"_index\":\"bugreport\",\"_type\":\"task_comments\",\"_id\":\"1\",\"_version\":1,\"created\":true}\nupdate it:\n{\"error\":\"NullPointerException[null]\",\"status\":500}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}