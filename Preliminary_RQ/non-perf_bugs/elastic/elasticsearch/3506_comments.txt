[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/116990894","html_url":"https://github.com/elastic/elasticsearch/issues/3506#issuecomment-116990894","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3506","id":116990894,"node_id":"MDEyOklzc3VlQ29tbWVudDExNjk5MDg5NA==","user":{"login":"zoellner","id":2665319,"node_id":"MDQ6VXNlcjI2NjUzMTk=","avatar_url":"https://avatars2.githubusercontent.com/u/2665319?v=4","gravatar_id":"","url":"https://api.github.com/users/zoellner","html_url":"https://github.com/zoellner","followers_url":"https://api.github.com/users/zoellner/followers","following_url":"https://api.github.com/users/zoellner/following{/other_user}","gists_url":"https://api.github.com/users/zoellner/gists{/gist_id}","starred_url":"https://api.github.com/users/zoellner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zoellner/subscriptions","organizations_url":"https://api.github.com/users/zoellner/orgs","repos_url":"https://api.github.com/users/zoellner/repos","events_url":"https://api.github.com/users/zoellner/events{/privacy}","received_events_url":"https://api.github.com/users/zoellner/received_events","type":"User","site_admin":false},"created_at":"2015-06-30T06:03:16Z","updated_at":"2016-03-16T00:57:39Z","author_association":"NONE","body":"Just in case someone comes across this (it's one of the few percolate examples showing up on google) and tries to get it to work, the percolate request needs a string or array in the sort field, not a boolean.\n(In addition, due to issues with dynamic scripts, one might have to switch the language from the default groovy to expression)\n\n```\n{ \n    \"doc\": { \n        \"field\" : \"value\" \n    },\n    \"query\" : {\n        \"function_score\" : {\n            \"query\" : { \"match_all\": {}},\n            \"functions\" : [\n                {\n                    \"script_score\" : {\n                        \"script\" : \"doc['priority'].value\",\n                        \"lang\": \"expression\"\n                    }\n                }\n            ]\n        }\n    },\n    \"sort\" : \"_score\",\n    \"size\" : 10\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/197045879","html_url":"https://github.com/elastic/elasticsearch/issues/3506#issuecomment-197045879","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3506","id":197045879,"node_id":"MDEyOklzc3VlQ29tbWVudDE5NzA0NTg3OQ==","user":{"login":"Charlemagne3","id":3698741,"node_id":"MDQ6VXNlcjM2OTg3NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3698741?v=4","gravatar_id":"","url":"https://api.github.com/users/Charlemagne3","html_url":"https://github.com/Charlemagne3","followers_url":"https://api.github.com/users/Charlemagne3/followers","following_url":"https://api.github.com/users/Charlemagne3/following{/other_user}","gists_url":"https://api.github.com/users/Charlemagne3/gists{/gist_id}","starred_url":"https://api.github.com/users/Charlemagne3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Charlemagne3/subscriptions","organizations_url":"https://api.github.com/users/Charlemagne3/orgs","repos_url":"https://api.github.com/users/Charlemagne3/repos","events_url":"https://api.github.com/users/Charlemagne3/events{/privacy}","received_events_url":"https://api.github.com/users/Charlemagne3/received_events","type":"User","site_admin":false},"created_at":"2016-03-15T22:04:20Z","updated_at":"2016-03-15T22:04:51Z","author_association":"NONE","body":"Confirming @zoellner, I had to use the following for my more complex filtered query:\n\n``` json\n{\n    \"query\": {\n        \"filtered\": {\n            \"filter\": {\n                \"term\": {\n                    \"tenant_id\": 29\n                }\n            },\n            \"query\": {\n                \"function_score\": {\n                    \"query\": {\"match_all\": {}},\n                    \"functions\": [\n                        {\n                            \"script_score\": {\n                                \"script\": \"doc[\\\"priority\\\"].value\",\n                                \"lang\": \"expression\"\n                            }\n                        }\n                    ]\n                }\n            }\n        }\n    },\n    \"sort\": \"_score\",\n    \"size\": 10\n}\n```\n\nnote the escaped quotes; the single quotes did not work for me, they gave an exception: \n\n```\n{\"script\": \"doc['priority'].value\",\"lang\": \"expression\"}}]}},\"sort\": \"_score\",\"size\": 10}}}'\n{\"took\":11,\"_shards\":{\"total\":5,\"successful\":0,\"failed\":5,\"failures\":[{\"shard\":0,\"index\":\"pulley.c\",\"status\":\"BAD_REQUEST\",\"reason\":{\"type\":\"parse_exception\",\"reason\":\"failed to parse request\",\"caused_by\":{\"type\":\"query_parsing_exception\",\"reason\":\"script_score the script could not be loaded\",\"index\":\"pulley.c\",\"line\":1,\"col\":205,\"caused_by\":{\"type\":\"script_exception\",\"reason\":\"Failed to compile inline script [doc[priority].value] using lang [expression]\",\"caused_by\":{\"type\":\"script_exception\",\"reason\":\"Failed to parse expression: doc[priority].value\",\"caused_by\":{\"type\":\"parse_exception\",\"reason\":\"unexpected character '[' on line (1) position (3)\",\"caused_by\":{\"type\":\"lexer_no_viable_alt_exception\",\"reason\":null}}}}}}}]},\"total\":0,\"matches\":[]}\n```\n","performed_via_github_app":null}]