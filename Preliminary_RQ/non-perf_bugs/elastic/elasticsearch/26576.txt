{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26576","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26576/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26576/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26576/events","html_url":"https://github.com/elastic/elasticsearch/issues/26576","id":256717987,"node_id":"MDU6SXNzdWUyNTY3MTc5ODc=","number":26576,"title":"S3 snapshots with timeout failures after upgrade to 5.5.2","user":{"login":"davekonopka","id":57581,"node_id":"MDQ6VXNlcjU3NTgx","avatar_url":"https://avatars2.githubusercontent.com/u/57581?v=4","gravatar_id":"","url":"https://api.github.com/users/davekonopka","html_url":"https://github.com/davekonopka","followers_url":"https://api.github.com/users/davekonopka/followers","following_url":"https://api.github.com/users/davekonopka/following{/other_user}","gists_url":"https://api.github.com/users/davekonopka/gists{/gist_id}","starred_url":"https://api.github.com/users/davekonopka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davekonopka/subscriptions","organizations_url":"https://api.github.com/users/davekonopka/orgs","repos_url":"https://api.github.com/users/davekonopka/repos","events_url":"https://api.github.com/users/davekonopka/events{/privacy}","received_events_url":"https://api.github.com/users/davekonopka/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2017-09-11T14:14:42Z","updated_at":"2018-05-26T13:00:18Z","closed_at":"2018-01-08T12:43:15Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n5.5.2\r\n\r\n**Plugins installed**: []\r\ndiscovery-ec2\r\nrepository-s3\r\n\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_131\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_131-b11)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nAmazon Linux on EC2 instances\r\nLinux 4.9.43-17.38.amzn1.x86_64 #1 SMP Thu Aug 17 00:20:39 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\nI recently upgraded a few clusters in different environments from 5.2.2 -> 5.5.2. Since doing so one of the clusters is running into timeout failures creating snapshots to S3. I've had a few successful snapshots and the other clusters have no failures so I know it does work. However most runs produce at least one failed shared or more with the same timeout error. Incidentally this has been limited to our production cluster which has the most/largest indices.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\nSome data redacted with `...` below.\r\n\r\n```\r\n     \"failures\": [\r\n        {\r\n          \"index\": \"...-2017.09.11\",\r\n          \"index_uuid\": \"...-2017.09.11\",\r\n          \"shard_id\": 4,\r\n          \"reason\": \"IndexShardSnapshotFailedException[Failed to perform snapshot (index files)]; nested: IOException[Unable to upload object elasticsearch-snapshots/indices/.../4/__e]; nested: AmazonS3Exception[Your socket connection to the server was not read from or written to within the timeout period. Idle connections will be closed. (Service: Amazon S3; Status Code: 400; Error Code: RequestTimeout; Request ID: BB3062E801AD4513)]; \",\r\n          \"node_id\": \"...\",\r\n          \"status\": \"INTERNAL_SERVER_ERROR\"\r\n        }\r\n      ],\r\n```\r\n\r\n```\r\n     \"failures\": [\r\n        {\r\n          \"index\": \"...-2017.09.10\",\r\n          \"index_uuid\": \"...-2017.09.10\",\r\n          \"shard_id\": 0,\r\n          \"reason\": \"IndexShardSnapshotFailedException[Failed to perform snapshot (index files)]; nested: IOException[Unable to upload object elasticsearch-snapshots/indices/.../0/__1]; nested: AmazonS3Exception[Your socket connection to the server was not read from or written to within the timeout period. Idle connections will be closed. (Service: Amazon S3; Status Code: 400; Error Code: RequestTimeout; Request ID: 4C030EBC4EB49F51)]; \",\r\n          \"node_id\": \"...\",\r\n          \"status\": \"INTERNAL_SERVER_ERROR\"\r\n        },\r\n        {\r\n          \"index\": \"...-2017.08.30\",\r\n          \"index_uuid\": \"...-2017.08.30\",\r\n          \"shard_id\": 0,\r\n          \"reason\": \"IndexShardSnapshotFailedException[Failed to write file list]; nested: IOException[Unable to upload object elasticsearch-snapshots/indices/.../0/pending-index-11]; nested: AmazonS3Exception[Your socket connection to the server was not read from or written to within the timeout period. Idle connections will be closed. (Service: Amazon S3; Status Code: 400; Error Code: RequestTimeout; Request ID: 1562D61EBA5696BD)]; \",\r\n          \"node_id\": \"...\",\r\n          \"status\": \"INTERNAL_SERVER_ERROR\"\r\n        }\r\n      ],\r\n```","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}