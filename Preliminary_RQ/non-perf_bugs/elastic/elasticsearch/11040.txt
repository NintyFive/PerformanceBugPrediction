{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11040","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11040/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11040/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11040/events","html_url":"https://github.com/elastic/elasticsearch/issues/11040","id":73992321,"node_id":"MDU6SXNzdWU3Mzk5MjMyMQ==","number":11040,"title":"Something may wrong when update the weight's of a doc to change the score of the result of complete suggestion when the doc size is large.","user":{"login":"yuikns","id":1095780,"node_id":"MDQ6VXNlcjEwOTU3ODA=","avatar_url":"https://avatars3.githubusercontent.com/u/1095780?v=4","gravatar_id":"","url":"https://api.github.com/users/yuikns","html_url":"https://github.com/yuikns","followers_url":"https://api.github.com/users/yuikns/followers","following_url":"https://api.github.com/users/yuikns/following{/other_user}","gists_url":"https://api.github.com/users/yuikns/gists{/gist_id}","starred_url":"https://api.github.com/users/yuikns/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yuikns/subscriptions","organizations_url":"https://api.github.com/users/yuikns/orgs","repos_url":"https://api.github.com/users/yuikns/repos","events_url":"https://api.github.com/users/yuikns/events{/privacy}","received_events_url":"https://api.github.com/users/yuikns/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-05-07T13:43:55Z","updated_at":"2015-05-08T07:47:33Z","closed_at":"2015-05-08T07:17:56Z","author_association":"NONE","active_lock_reason":null,"body":"Here is a mapping of index\n\n```\n{\n    \"settings\": {\n        \"analysis\": {\n            \"analyzer\": {\n                \"name_analyzer\": {\n                    \"type\": \"custom\",\n                    \"tokenizer\": \"standard\",\n                    \"filter\": [ \"standard\", \"lowercase\" ]\n                }\n            }\n        }\n    },\n    \"mappings\": {\n        \"doc\": {\n            \"properties\": {\n                \"suggest\": {\n                    \"type\": \"completion\",\n                    \"analyzer\": \"name_analyzer\",\n                    \"payloads\": true\n                }\n            }\n        }\n    }\n}\n```\n\nInsert a doc : \n\n```\n$ curl -XPUT localhost:9200/sample/doc/1 -d '{\n\"suggest\" : {\n \"output\" : \"1\" ,\n \"input\" : [ \"info\" ],\n \"weight\" : 100\n }\n}'\n{\"_index\":\"sample\",\"_type\":\"doc\",\"_id\":\"1\",\"_version\":1,\"created\":true}\n```\n\nAnd then , I try to query this doc, get result as follow : \n\n```\n$ curl -X POST 'localhost:9200/sample/_suggest?pretty' -d '{\n\"sample-suggest\" : {\n\"text\" : \"in\",\n\"completion\" : {\n\"field\" : \"suggest\"\n}}}'\n{\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"sample-suggest\" : [ {\n    \"text\" : \"in\",\n    \"offset\" : 0,\n    \"length\" : 2,\n    \"options\" : [ {\n      \"text\" : \"1\",\n      \"score\" : 100.0  # << this score equals the weight I had settted\n    } ]\n  } ]\n}\n```\n\nAnd then, I update this doc's weight  from 100 to 3\n\n```\n$ curl -XPUT localhost:9200/sample/doc/1 -d '{\n\"suggest\" : {\n \"output\" : \"1\" ,\n \"input\" : [ \"info\" ],\n \"weight\" : 3\n }\n}'\n{\"_index\":\"sample\",\"_type\":\"doc\",\"_id\":\"1\",\"_version\":2,\"created\":false}\n```\n\nLet's check this doc again : \n\n```\n$ curl http://localhost:9200/sample/doc/1\n{\"_index\":\"sample\",\"_type\":\"doc\",\"_id\":\"1\",\"_version\":2,\"found\":true,\"_source\":{\n\"suggest\" : {\n \"output\" : \"1\" ,\n \"input\" : [ \"info\" ],\n \"weight\" : 3\n }\n}}\n```\n\nIt had also updated.\n\nAnd then, I request a suggestion again.\n\n```\n$ cur-X POST 'localhost:9200/sample/_suggest?pretty' -d '{\n\"sample-suggest\" : {\n\"text\" : \"in\",\n\"completion\" : {\n\"field\" : \"suggest\"\n}}}'\n{\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"sample-suggest\" : [ {\n    \"text\" : \"in\",\n    \"offset\" : 0,\n    \"length\" : 2,\n    \"options\" : [ {\n      \"text\" : \"1\",\n      \"score\" : 3.0\n    } ]\n  } ]\n}\n```\n\nthe score updated from 100 to 3.\n\n---\n\nHowever, my index with 38M docs(with size about 64G Byte). When I update the doc as below.\nI can also curl this doc, and found the weight had been changed, however, when I use the suggestion, It always give me the old score back.\n\nI'm not sure is there something wrong when I  was trying to update those docs. Any replies are appreciated.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}