{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/62781","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62781/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62781/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62781/events","html_url":"https://github.com/elastic/elasticsearch/issues/62781","id":706575120,"node_id":"MDU6SXNzdWU3MDY1NzUxMjA=","number":62781,"title":"EQL: Bug with interleaved sequences","user":{"login":"rw-access","id":31489089,"node_id":"MDQ6VXNlcjMxNDg5MDg5","avatar_url":"https://avatars1.githubusercontent.com/u/31489089?v=4","gravatar_id":"","url":"https://api.github.com/users/rw-access","html_url":"https://github.com/rw-access","followers_url":"https://api.github.com/users/rw-access/followers","following_url":"https://api.github.com/users/rw-access/following{/other_user}","gists_url":"https://api.github.com/users/rw-access/gists{/gist_id}","starred_url":"https://api.github.com/users/rw-access/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rw-access/subscriptions","organizations_url":"https://api.github.com/users/rw-access/orgs","repos_url":"https://api.github.com/users/rw-access/repos","events_url":"https://api.github.com/users/rw-access/events{/privacy}","received_events_url":"https://api.github.com/users/rw-access/received_events","type":"User","site_admin":false},"labels":[{"id":1690690117,"node_id":"MDU6TGFiZWwxNjkwNjkwMTE3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/EQL","name":":Query Languages/EQL","color":"0e8a16","default":false,"description":"EQL querying"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967501040,"node_id":"MDU6TGFiZWwxOTY3NTAxMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:QL","name":"Team:QL","color":"fef2c0","default":false,"description":"Meta label for query languages team"}],"state":"closed","locked":false,"assignee":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"assignees":[{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-09-22T17:45:22Z","updated_at":"2020-10-08T09:17:39Z","closed_at":"2020-10-08T09:17:39Z","author_association":"MEMBER","active_lock_reason":null,"body":"It appears that there is a bug related to EQL's sequencing (have not verified in master, only 7.9). I'm not sure exactly what/where it is, but here are some of the factors at play\r\n\r\n* using a join key\r\n* using a tiebreaker\r\n* interleaved sequences\r\n\r\n\r\n### How to reproduce\r\nUpload your data\r\n```python\r\nPUT my-index-000001\r\n{\r\n  \"mappings\": {\r\n    \"properties\": {\r\n      \"eventType\": {\r\n        \"type\": \"keyword\"\r\n      },\r\n      \"event.sequence\": {\r\n        \"type\": \"long\"\r\n      }\r\n    }\r\n  }\r\n}\r\nPUT my-index-000001/_doc/1\r\n{\r\n  \"@timestamp\": \"2020-09-22T06:29:40.546Z\",\r\n  \"eventType\": \"REQUEST\",\r\n  \"transID\": 1234,\r\n  \"event.sequence\": 1\r\n}\r\nPUT my-index-000001/_doc/2\r\n{\r\n  \"@timestamp\": \"2020-09-22T06:29:41.432Z\",\r\n  \"eventType\": \"ERROR\",\r\n  \"transID\": 1234,\r\n  \"event.sequence\": 2\r\n}\r\nPUT my-index-000001/_doc/3\r\n{\r\n  \"@timestamp\": \"2020-09-22T06:29:42.542Z\",\r\n  \"eventType\": \"STAT\",\r\n  \"transID\": 1234,\r\n  \"event.sequence\": 3\r\n}\r\nPUT my-index-000001/_doc/4\r\n{\r\n  \"@timestamp\": \"2020-09-23T06:29:40.654Z\",\r\n  \"eventType\": \"REQUEST\",\r\n  \"transID\": 1235,\r\n  \"event.sequence\": 1\r\n}\r\nPUT my-index-000001/_doc/5\r\n{\r\n  \"@timestamp\": \"2020-09-23T06:29:41.545Z\",\r\n  \"eventType\": \"ERROR\",\r\n  \"transID\": 1235,\r\n  \"event.sequence\": 2\r\n}\r\nPUT my-index-000001/_doc/6\r\n{\r\n  \"@timestamp\": \"2020-09-23T06:29:41.545Z\",\r\n  \"eventType\": \"STAT\",\r\n  \"transID\": 1235,\r\n  \"event.sequence\": 3\r\n}\r\n``` \r\n\r\n\r\nHere are the queries that are behaving oddly\r\n```python\r\n# Brings back, \"transID\": 1234\r\nGET /my-index-000001/_eql/search\r\n{\r\n  \"timestamp_field\": \"@timestamp\",\r\n  \"event_category_field\": \"eventType\",\r\n  \"query\": \"\"\"\r\n  sequence by transID \r\n    [ REQUEST where true ]\r\n    [ ERROR where true ]\r\n    [ STAT where true ]\r\n  \"\"\"\r\n}\r\n\r\n# Brings back, \"transID\": 1235\r\nGET /my-index-000001/_eql/search\r\n{\r\n  \"tiebreaker_field\": \"event.sequence\",\r\n  \"timestamp_field\": \"@timestamp\",\r\n  \"event_category_field\": \"eventType\",\r\n  \"query\": \"\"\"\r\n  sequence by transID \r\n    [ REQUEST where true ]\r\n    [ ERROR where true ]\r\n    [ STAT where true ]\r\n  \"\"\"\r\n}\r\n\r\n# Brings back no results\r\nGET /my-index-000001/_eql/search\r\n{\r\n  \"tiebreaker_field\": \"event.sequence\",\r\n  \"timestamp_field\": \"@timestamp\",\r\n  \"event_category_field\": \"eventType\",\r\n  \"query\": \"\"\"\r\n  sequence by transID \r\n    [ REQUEST where transID == 1234 ]\r\n    [ ERROR where true ]\r\n    [ STAT where true ]\r\n  \"\"\"\r\n}\r\n\r\n# Brings back, \"transID\": 1234\r\nGET /my-index-000001/_eql/search\r\n{\r\n  \"tiebreaker_field\": \"event.sequence\",\r\n  \"timestamp_field\": \"@timestamp\",\r\n  \"event_category_field\": \"eventType\",\r\n  \"query\": \"\"\"\r\n  sequence by transID \r\n    [ REQUEST where transID == 1234 ]\r\n    [ ERROR where transID == 1234 ]\r\n    [ STAT where transID == 1234 ]\r\n  \"\"\"\r\n}\r\n```","closed_by":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}