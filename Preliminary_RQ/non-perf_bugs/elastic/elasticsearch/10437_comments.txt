[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89735923","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-89735923","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":89735923,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NzM1OTIz","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T08:45:36Z","updated_at":"2015-04-05T08:45:36Z","author_association":"MEMBER","body":"when the server is under high CPU load, can you first check if its the ES process, and if so, can you issue the hot threads api and post back the response of it here? http://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-hot-threads.html\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/90558087","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-90558087","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":90558087,"node_id":"MDEyOklzc3VlQ29tbWVudDkwNTU4MDg3","user":{"login":"erjiang","id":321497,"node_id":"MDQ6VXNlcjMyMTQ5Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/321497?v=4","gravatar_id":"","url":"https://api.github.com/users/erjiang","html_url":"https://github.com/erjiang","followers_url":"https://api.github.com/users/erjiang/followers","following_url":"https://api.github.com/users/erjiang/following{/other_user}","gists_url":"https://api.github.com/users/erjiang/gists{/gist_id}","starred_url":"https://api.github.com/users/erjiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erjiang/subscriptions","organizations_url":"https://api.github.com/users/erjiang/orgs","repos_url":"https://api.github.com/users/erjiang/repos","events_url":"https://api.github.com/users/erjiang/events{/privacy}","received_events_url":"https://api.github.com/users/erjiang/received_events","type":"User","site_admin":false},"created_at":"2015-04-07T13:44:56Z","updated_at":"2015-04-07T13:44:56Z","author_association":"NONE","body":"Here is the output of hot_threads after elasticsearch started consuming extra CPU again. It is now consistently using approx 40-60% CPU up from 4-8% CPU.\n\n```\n::: [MODAM][tB-KGWlsQ4KDt1PUMleoyQ][localhost][inet[/10.0.3.26:9300]]\n   Hot threads at 2015-04-07T13:40:51.020Z, interval=500ms, busiestThreads=3, ignoreIdleThreads=true:\n\n    0.0% (133.7micros out of 500ms) cpu usage by thread 'elasticsearch[MODAM][transport_client_timer][T#1]{Hashed wheel timer #1}'\n     10/10 snapshots sharing following 5 elements\n       java.lang.Thread.sleep(Native Method)\n       org.elasticsearch.common.netty.util.HashedWheelTimer$Worker.waitForNextTick(HashedWheelTimer.java:445)\n       org.elasticsearch.common.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:364)\n       org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n       java.lang.Thread.run(Thread.java:745)\n```\n\nRunning it again, I get:\n\n```\n::: [MODAM][tB-KGWlsQ4KDt1PUMleoyQ][localhost][inet[/10.0.3.26:9300]]\n   Hot threads at 2015-04-07T13:43:43.961Z, interval=500ms, busiestThreads=3, ignoreIdleThreads=true:\n\n```\n\nPlease let me know what other information I can provide.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/90654373","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-90654373","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":90654373,"node_id":"MDEyOklzc3VlQ29tbWVudDkwNjU0Mzcz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-07T17:24:10Z","updated_at":"2015-04-07T17:24:10Z","author_association":"CONTRIBUTOR","body":"Hi @erjiang \n\nAre you seeing any logs in syslog about \"riding the rocket\"?  See https://github.com/elastic/elasticsearch/issues/10447#issuecomment-90295492\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/91329286","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-91329286","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":91329286,"node_id":"MDEyOklzc3VlQ29tbWVudDkxMzI5Mjg2","user":{"login":"erjiang","id":321497,"node_id":"MDQ6VXNlcjMyMTQ5Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/321497?v=4","gravatar_id":"","url":"https://api.github.com/users/erjiang","html_url":"https://github.com/erjiang","followers_url":"https://api.github.com/users/erjiang/followers","following_url":"https://api.github.com/users/erjiang/following{/other_user}","gists_url":"https://api.github.com/users/erjiang/gists{/gist_id}","starred_url":"https://api.github.com/users/erjiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erjiang/subscriptions","organizations_url":"https://api.github.com/users/erjiang/orgs","repos_url":"https://api.github.com/users/erjiang/repos","events_url":"https://api.github.com/users/erjiang/events{/privacy}","received_events_url":"https://api.github.com/users/erjiang/received_events","type":"User","site_admin":false},"created_at":"2015-04-09T19:04:53Z","updated_at":"2015-04-09T19:04:53Z","author_association":"NONE","body":"We didn't see the \"riding the rocket\" message.\n\nSo far our best guess is that elasticsearch used up its available Java heap space, causing GC to continually run and consume cycles. That would explain why the problem would occur after a day or two and go away after restarting elasticsearch.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/92277786","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-92277786","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":92277786,"node_id":"MDEyOklzc3VlQ29tbWVudDkyMjc3Nzg2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-13T08:58:45Z","updated_at":"2015-04-13T13:26:59Z","author_association":"CONTRIBUTOR","body":"OK, so sounds like memory pressure.  Are you using a lot of fielddata (ie per-doc field values loaded for sorting, aggs, or scripting)?  You can check with:\n\n```\nGET /_nodes/stats/indices/fielddata?fields=*&human&pretty\n```\n\nIf so, consider switching those fields to use `doc_values: true` (which you can only do on a new index) to shift the memory use from your heap to the file system cache.  This will be the new default in 2.0.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/135144927","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-135144927","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":135144927,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNTE0NDkyNw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-08-26T19:20:44Z","updated_at":"2015-08-26T19:20:44Z","author_association":"CONTRIBUTOR","body":"Closing due to lack of feedback\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143777253","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-143777253","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":143777253,"node_id":"MDEyOklzc3VlQ29tbWVudDE0Mzc3NzI1Mw==","user":{"login":"pjcard","id":8281121,"node_id":"MDQ6VXNlcjgyODExMjE=","avatar_url":"https://avatars2.githubusercontent.com/u/8281121?v=4","gravatar_id":"","url":"https://api.github.com/users/pjcard","html_url":"https://github.com/pjcard","followers_url":"https://api.github.com/users/pjcard/followers","following_url":"https://api.github.com/users/pjcard/following{/other_user}","gists_url":"https://api.github.com/users/pjcard/gists{/gist_id}","starred_url":"https://api.github.com/users/pjcard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjcard/subscriptions","organizations_url":"https://api.github.com/users/pjcard/orgs","repos_url":"https://api.github.com/users/pjcard/repos","events_url":"https://api.github.com/users/pjcard/events{/privacy}","received_events_url":"https://api.github.com/users/pjcard/received_events","type":"User","site_admin":false},"created_at":"2015-09-28T15:26:28Z","updated_at":"2015-09-28T15:26:28Z","author_association":"NONE","body":"I too saw this issue, with HashedWheelTimer appearing as the only process in hot threads. I've restarted my server (rather than process), and I'll report back as to whether it recurs.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143780081","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-143780081","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":143780081,"node_id":"MDEyOklzc3VlQ29tbWVudDE0Mzc4MDA4MQ==","user":{"login":"mausch","id":95194,"node_id":"MDQ6VXNlcjk1MTk0","avatar_url":"https://avatars1.githubusercontent.com/u/95194?v=4","gravatar_id":"","url":"https://api.github.com/users/mausch","html_url":"https://github.com/mausch","followers_url":"https://api.github.com/users/mausch/followers","following_url":"https://api.github.com/users/mausch/following{/other_user}","gists_url":"https://api.github.com/users/mausch/gists{/gist_id}","starred_url":"https://api.github.com/users/mausch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mausch/subscriptions","organizations_url":"https://api.github.com/users/mausch/orgs","repos_url":"https://api.github.com/users/mausch/repos","events_url":"https://api.github.com/users/mausch/events{/privacy}","received_events_url":"https://api.github.com/users/mausch/received_events","type":"User","site_admin":false},"created_at":"2015-09-28T15:33:08Z","updated_at":"2015-09-28T15:33:08Z","author_association":"NONE","body":"In my case, something similar was happening because I had too many indices open. Closing old indices with Curator stopped that behaviour. https://www.elastic.co/blog/curator-tending-your-time-series-indices\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/219283162","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-219283162","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":219283162,"node_id":"MDEyOklzc3VlQ29tbWVudDIxOTI4MzE2Mg==","user":{"login":"andrenarchy","id":1874116,"node_id":"MDQ6VXNlcjE4NzQxMTY=","avatar_url":"https://avatars1.githubusercontent.com/u/1874116?v=4","gravatar_id":"","url":"https://api.github.com/users/andrenarchy","html_url":"https://github.com/andrenarchy","followers_url":"https://api.github.com/users/andrenarchy/followers","following_url":"https://api.github.com/users/andrenarchy/following{/other_user}","gists_url":"https://api.github.com/users/andrenarchy/gists{/gist_id}","starred_url":"https://api.github.com/users/andrenarchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrenarchy/subscriptions","organizations_url":"https://api.github.com/users/andrenarchy/orgs","repos_url":"https://api.github.com/users/andrenarchy/repos","events_url":"https://api.github.com/users/andrenarchy/events{/privacy}","received_events_url":"https://api.github.com/users/andrenarchy/received_events","type":"User","site_admin":false},"created_at":"2016-05-15T12:31:22Z","updated_at":"2016-05-15T12:31:22Z","author_association":"NONE","body":"I also experienced a constant cpu load without any activity on the ES cluster. Increasing ES_HEAP_SIZE to half of my system's memory fixed it. @erjiang: Thanks for the hint!\n\nIs there a way how ES can detect such a situation? It would be very helpful if a warning would appear in the log messages.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/219819808","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-219819808","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":219819808,"node_id":"MDEyOklzc3VlQ29tbWVudDIxOTgxOTgwOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-17T19:01:22Z","updated_at":"2016-05-17T19:01:22Z","author_association":"MEMBER","body":"> Is there a way how ES can detect such a situation? It would be very helpful if a warning would appear in the log messages.\n\nI opened #18419.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296146097","html_url":"https://github.com/elastic/elasticsearch/issues/10437#issuecomment-296146097","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10437","id":296146097,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjE0NjA5Nw==","user":{"login":"maoxiajun","id":3657883,"node_id":"MDQ6VXNlcjM2NTc4ODM=","avatar_url":"https://avatars1.githubusercontent.com/u/3657883?v=4","gravatar_id":"","url":"https://api.github.com/users/maoxiajun","html_url":"https://github.com/maoxiajun","followers_url":"https://api.github.com/users/maoxiajun/followers","following_url":"https://api.github.com/users/maoxiajun/following{/other_user}","gists_url":"https://api.github.com/users/maoxiajun/gists{/gist_id}","starred_url":"https://api.github.com/users/maoxiajun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maoxiajun/subscriptions","organizations_url":"https://api.github.com/users/maoxiajun/orgs","repos_url":"https://api.github.com/users/maoxiajun/repos","events_url":"https://api.github.com/users/maoxiajun/events{/privacy}","received_events_url":"https://api.github.com/users/maoxiajun/received_events","type":"User","site_admin":false},"created_at":"2017-04-21T09:44:29Z","updated_at":"2017-04-21T09:44:29Z","author_association":"NONE","body":"`26.2% (131ms out of 500ms) cpu usage by thread 'elasticsearch[xxx][search][T#62]'\r\n     10/10 snapshots sharing following 10 elements\r\n       sun.misc.Unsafe.park(Native Method)\r\n       java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\r\n       java.util.concurrent.LinkedTransferQueue.awaitMatch(LinkedTransferQueue.java:737)\r\n       java.util.concurrent.LinkedTransferQueue.xfer(LinkedTransferQueue.java:647)\r\n       java.util.concurrent.LinkedTransferQueue.take(LinkedTransferQueue.java:1269)\r\n       org.elasticsearch.common.util.concurrent.SizeBlockingQueue.take(SizeBlockingQueue.java:162)\r\n       java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)\r\n       java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)\r\n       java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n       java.lang.Thread.run(Thread.java:745)`\r\n\r\nI can see this when use 'curl localhost:9200/_nodes/hot_threads'","performed_via_github_app":null}]