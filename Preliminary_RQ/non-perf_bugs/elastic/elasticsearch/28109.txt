{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28109","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28109/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28109/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28109/events","html_url":"https://github.com/elastic/elasticsearch/issues/28109","id":286375134,"node_id":"MDU6SXNzdWUyODYzNzUxMzQ=","number":28109,"title":"Supporting dot product via Painless scripting","user":{"login":"adamhadani","id":139888,"node_id":"MDQ6VXNlcjEzOTg4OA==","avatar_url":"https://avatars0.githubusercontent.com/u/139888?v=4","gravatar_id":"","url":"https://api.github.com/users/adamhadani","html_url":"https://github.com/adamhadani","followers_url":"https://api.github.com/users/adamhadani/followers","following_url":"https://api.github.com/users/adamhadani/following{/other_user}","gists_url":"https://api.github.com/users/adamhadani/gists{/gist_id}","starred_url":"https://api.github.com/users/adamhadani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamhadani/subscriptions","organizations_url":"https://api.github.com/users/adamhadani/orgs","repos_url":"https://api.github.com/users/adamhadani/repos","events_url":"https://api.github.com/users/adamhadani/events{/privacy}","received_events_url":"https://api.github.com/users/adamhadani/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2018-01-05T19:00:04Z","updated_at":"2019-07-04T15:00:51Z","closed_at":"2018-04-26T21:38:54Z","author_association":"NONE","active_lock_reason":null,"body":"We've been experimenting with implementing a custom dot product based relevancy scoring formula that could help us greatly in combination with the standard Elasticsearch features (specifically, it will be very useful for us to use it in combination with the rescore functionality to only rescore top K results).\r\n\r\n### Feature suggestion\r\n\r\nTLDR - It will be very useful to be able to pass a Painless inline script a `param` which is essentially a vector (E.g. of floats), and have it perform the dot product of that vector with previously stored vectors associated with the various documents to be scored, and use the result of this dot product as the relevancy score. This is a very general framework which can be used to express a lot of domain-specific logic, so seems like a feature of general interest (Notably, cosine similarity is a particular instance of such a dot product when the vectors are all normalized to have unit norm).\r\n\r\nA couple of specific notes:\r\n* Existing solutions involve either a custom plugin (which does not seem to support newer ES versions), or have some pretty severe limitations. See references below.\r\n* Ideally, It should be possible for an inline script to also use a combination of such dot products, i.e have each document be associated with multiple vectors at index time, and then be able to pass in multiple vectors as `params` to the script and have the script compute the score as a weighted combination of multiple dot products, e.g something like `params['weight_a'] * doc['vector_a'].dot(params['vector_a']) + params['weight_b'] * doc['vector_b'].dot(params['vector_b'])`\r\n\r\n### References\r\n\r\n* ES Plugin for dot products - https://github.com/MLnick/elasticsearch-vector-scoring\r\n* Existing ways of simulating this with Painless and their drawbacks -\r\n https://stackoverflow.com/a/43836510\r\n  ","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}