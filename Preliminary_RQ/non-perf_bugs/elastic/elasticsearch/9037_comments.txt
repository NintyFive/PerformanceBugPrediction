[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67949015","html_url":"https://github.com/elastic/elasticsearch/issues/9037#issuecomment-67949015","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9037","id":67949015,"node_id":"MDEyOklzc3VlQ29tbWVudDY3OTQ5MDE1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-23T13:06:31Z","updated_at":"2014-12-23T13:06:31Z","author_association":"CONTRIBUTOR","body":"Hi @kaniini \n\nI'm going to assume you've had a bad day and will ignore the sarcasm and try to help you.\n\n> until recently, we had some broken code that operated under the assumption that counts were inexpensive, \n\nCounts are a good deal less expensive than queries, as they don't have to collect results.  However, you can write cheap queries or expensive queries.  The `term` example that you give should be very cheap indeed, but (eg) using wildcards could turn out to be very costly.\n\n> {\n>     'query': {\n>         {'term': {'device': device_id}}\n>    },\n>    'timeout': 2000\n> }\n> \n> this immediately threw an error because the high quality documentation was unfortunately inconsistent in explaining how we were supposed to do this. \n\nThe errors probably resulted from the fact that the above is malformed JSON (you have double `{{}}`) and throws a `JsonParseException`.  Your second query is similarly malformed.   \n\nAlternatively, maybe your actual request was correctly formed JSON, but you were using the `_count` API, as in:\n\n```\nGET /_count\n{\n  \"query\": {\n    \"term\": {\n      \"foo\": \"bar\"\n    }\n  },\n  \"timeout\": 2000\n}\n```\n\n... in which case the exception is:\n\n```\nQueryParsingException[[t] request does not support [timeout]\n```\n\n...which is correct.  The `timeout` documentation that you linked to is for the `search` API, not the `count` API.  The correct syntax to achieve what you want is:\n\n```\nGET /_search?search_type=count\n{\n  \"query\": {\n    \"term\": {\n      \"foo\": \"bar\"\n    }\n  },\n  \"timeout\": 2000\n}\n```\n\nThe `timeout` can be specified as a number (in which case it represents milliseconds) or a string with a unit, eg `\"2s\"`.  \n\nNote: the timeout can only interrupt the query in certain phases. A very expensive wildcard query may still exceed the timeout as it is not interruptible.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67971815","html_url":"https://github.com/elastic/elasticsearch/issues/9037#issuecomment-67971815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9037","id":67971815,"node_id":"MDEyOklzc3VlQ29tbWVudDY3OTcxODE1","user":{"login":"kaniini","id":1522444,"node_id":"MDQ6VXNlcjE1MjI0NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522444?v=4","gravatar_id":"","url":"https://api.github.com/users/kaniini","html_url":"https://github.com/kaniini","followers_url":"https://api.github.com/users/kaniini/followers","following_url":"https://api.github.com/users/kaniini/following{/other_user}","gists_url":"https://api.github.com/users/kaniini/gists{/gist_id}","starred_url":"https://api.github.com/users/kaniini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaniini/subscriptions","organizations_url":"https://api.github.com/users/kaniini/orgs","repos_url":"https://api.github.com/users/kaniini/repos","events_url":"https://api.github.com/users/kaniini/events{/privacy}","received_events_url":"https://api.github.com/users/kaniini/received_events","type":"User","site_admin":false},"created_at":"2014-12-23T16:47:16Z","updated_at":"2014-12-23T16:47:16Z","author_association":"NONE","body":"hello,\n\nyes, we were not having a good day yesterday...\n\nthat being said, i must say that the `/_search?search_type=count` thing is really not obvious in the documentation, so it would probably be a good idea to at least clarify this in the documentation.\n\nthanks for at least telling us what was up with that.\n","performed_via_github_app":null}]