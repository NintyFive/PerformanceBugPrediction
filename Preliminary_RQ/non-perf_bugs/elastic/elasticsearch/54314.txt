{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/54314","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54314/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54314/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54314/events","html_url":"https://github.com/elastic/elasticsearch/issues/54314","id":588815002,"node_id":"MDU6SXNzdWU1ODg4MTUwMDI=","number":54314,"title":"Validate rest api specs as part of build","user":{"login":"russcam","id":208231,"node_id":"MDQ6VXNlcjIwODIzMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/208231?v=4","gravatar_id":"","url":"https://api.github.com/users/russcam","html_url":"https://github.com/russcam","followers_url":"https://api.github.com/users/russcam/followers","following_url":"https://api.github.com/users/russcam/following{/other_user}","gists_url":"https://api.github.com/users/russcam/gists{/gist_id}","starred_url":"https://api.github.com/users/russcam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russcam/subscriptions","organizations_url":"https://api.github.com/users/russcam/orgs","repos_url":"https://api.github.com/users/russcam/repos","events_url":"https://api.github.com/users/russcam/events{/privacy}","received_events_url":"https://api.github.com/users/russcam/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"assignees":[{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2020-03-27T00:55:28Z","updated_at":"2020-11-11T21:46:56Z","closed_at":"2020-04-21T23:18:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"https://github.com/elastic/elasticsearch/pull/54252 updates rest api specs to conform to [a JSON schema included in the PR](https://github.com/elastic/elasticsearch/blob/fccaf58fdf3e248300fbb16f4879f2b0db9ea9ac/rest-api-spec/schema.json). \r\n\r\nThe schema definition itself is intentionally loose in some places and could be stricter, but I think it would be prudent to discuss the definition separately to this issue, in order to keep this issue focused.\r\n\r\nThe clients team has a nightly CI job to validate the rest api specs in specific branches against the schema, and commit the reported output to a private repository, but it would probably be more valuable to perform this validation as part of the Elasticsearch build. Doing so would catch issues in the specs at the point at which additions or changes are made and committed into mainline branches, reducing the need to update specs post-merge.\r\n\r\n### Possible implementation\r\n\r\nA gradle task could be implemented to validate rest api specs against the JSON schema as part of a gradle build performed _pre_-merge. A Java JSON schema validator that can validate using Draft-07 schemas would be required, of which there look to be a few potential candidates:\r\n\r\n1. https://github.com/networknt/json-schema-validator\r\n2. https://github.com/everit-org/json-schema\r\n3. https://github.com/leadpony/justify\r\n\r\nAll [oss](https://github.com/elastic/elasticsearch/tree/master/rest-api-spec/src/main/resources/rest-api-spec/api) (excluding `_common.json`) and [xpack](https://github.com/elastic/elasticsearch/tree/master/x-pack/plugin/src/test/resources/rest-api-spec/api) specs would be validated, perhaps with the ability to validate only spec files that have been added/changed in the PR .\r\n\r\n/cc @mark-vieira, @elastic/es-clients   \r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}