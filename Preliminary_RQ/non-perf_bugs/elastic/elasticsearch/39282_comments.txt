[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466239962","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466239962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466239962,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjIzOTk2Mg==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T01:44:02Z","updated_at":"2019-02-22T01:44:02Z","author_association":"CONTRIBUTOR","body":"@jffree The idea of a \"slave\" doesn't exist in Elasticsearch. We have \"master eligible\" and \"non master eligible\" and we have an \"elected master\", but \"slave\" isn't a term we use so it's not clear exactly what your configuration was.\r\n\r\nIt sounds like you might have been running with an unsafe configuration - can you please update your desciption to use clear Elasticsearch terminology so we can be sure what your setup looked like.\r\n\r\nWe need to know:\r\n- how many nodes you had\r\n- which of those nodes were master eligible. That is, in their `elasticsearch.yml` you had `node.master: true` _OR_ there was no setting for `node.master` (the default value is `true`)\r\n- which node was the elected master\r\n- when you say \"B become new master\" was that automatic, or did you have to make a configuration change?\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466241484","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466241484","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466241484,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI0MTQ4NA==","user":{"login":"jffree","id":9236604,"node_id":"MDQ6VXNlcjkyMzY2MDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/9236604?v=4","gravatar_id":"","url":"https://api.github.com/users/jffree","html_url":"https://github.com/jffree","followers_url":"https://api.github.com/users/jffree/followers","following_url":"https://api.github.com/users/jffree/following{/other_user}","gists_url":"https://api.github.com/users/jffree/gists{/gist_id}","starred_url":"https://api.github.com/users/jffree/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jffree/subscriptions","organizations_url":"https://api.github.com/users/jffree/orgs","repos_url":"https://api.github.com/users/jffree/repos","events_url":"https://api.github.com/users/jffree/events{/privacy}","received_events_url":"https://api.github.com/users/jffree/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T01:51:03Z","updated_at":"2019-02-22T01:51:03Z","author_association":"NONE","body":"@tvernum \r\n1. I have two nodes in cluster (A and B)\r\n2. old cluster A is master, I set `node.master: true`  in `elasticsearch.yml`, B is set   `node.master: false`  in \r\n `elasticsearch.yml`\r\n3. Stop A, update B config( remove  `node.master: false`  in  `elasticsearch.yml`), so B can run standalone\r\n4. POST new data to B node\r\n5. Startup A node and (set `node.master: false`  in `elasticsearch.yml`),   B is set   `node.master: true`  in \r\n `elasticsearch.yml`, so B is master in new cluster\r\n6. But the new data loss!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466242452","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466242452","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466242452,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI0MjQ1Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T01:56:27Z","updated_at":"2019-02-22T01:56:27Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466243402","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466243402","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466243402,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI0MzQwMg==","user":{"login":"jffree","id":9236604,"node_id":"MDQ6VXNlcjkyMzY2MDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/9236604?v=4","gravatar_id":"","url":"https://api.github.com/users/jffree","html_url":"https://github.com/jffree","followers_url":"https://api.github.com/users/jffree/followers","following_url":"https://api.github.com/users/jffree/following{/other_user}","gists_url":"https://api.github.com/users/jffree/gists{/gist_id}","starred_url":"https://api.github.com/users/jffree/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jffree/subscriptions","organizations_url":"https://api.github.com/users/jffree/orgs","repos_url":"https://api.github.com/users/jffree/repos","events_url":"https://api.github.com/users/jffree/events{/privacy}","received_events_url":"https://api.github.com/users/jffree/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T02:01:03Z","updated_at":"2019-02-22T02:01:03Z","author_association":"NONE","body":"@tvernum \r\nWe also have tried to delete data (UUID dir on A node) when A join cluster again, but data still lost ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466266704","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466266704","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466266704,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI2NjcwNA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T04:09:53Z","updated_at":"2019-02-22T04:09:53Z","author_association":"CONTRIBUTOR","body":"@jffree you haven't properly configured `minimum_master_nodes`. Please read https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-settings.html#minimum_master_nodes and adapt your configuration. Also note that questions like this should best be first asked on https://discuss.elastic.co instead. Thank you","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466276863","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466276863","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466276863,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI3Njg2Mw==","user":{"login":"jffree","id":9236604,"node_id":"MDQ6VXNlcjkyMzY2MDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/9236604?v=4","gravatar_id":"","url":"https://api.github.com/users/jffree","html_url":"https://github.com/jffree","followers_url":"https://api.github.com/users/jffree/followers","following_url":"https://api.github.com/users/jffree/following{/other_user}","gists_url":"https://api.github.com/users/jffree/gists{/gist_id}","starred_url":"https://api.github.com/users/jffree/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jffree/subscriptions","organizations_url":"https://api.github.com/users/jffree/orgs","repos_url":"https://api.github.com/users/jffree/repos","events_url":"https://api.github.com/users/jffree/events{/privacy}","received_events_url":"https://api.github.com/users/jffree/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T05:16:50Z","updated_at":"2019-02-22T05:17:33Z","author_association":"NONE","body":"@ywelsch \r\nI have set `minimum_master_nodes`  1  in `elasticsearch.yml`.\r\nAlso, I have node this question on https://discuss.elastic.co, but nobody can give me an answer.\r\nAnd I want to ask you, if you do not clear what happened, why you close this issue? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466278229","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466278229","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466278229,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI3ODIyOQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T05:25:14Z","updated_at":"2019-02-22T05:25:14Z","author_association":"CONTRIBUTOR","body":"you have two master-eligible nodes, so you need to set minimum_master_nodes to 2, i.e. `(master_eligible_nodes / 2) + 1  == (2/2) + 1 == 1 + 1 == 2` according to the linked docs. More info is also here: https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#split-brain","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466279291","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466279291","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466279291,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI3OTI5MQ==","user":{"login":"jffree","id":9236604,"node_id":"MDQ6VXNlcjkyMzY2MDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/9236604?v=4","gravatar_id":"","url":"https://api.github.com/users/jffree","html_url":"https://github.com/jffree","followers_url":"https://api.github.com/users/jffree/followers","following_url":"https://api.github.com/users/jffree/following{/other_user}","gists_url":"https://api.github.com/users/jffree/gists{/gist_id}","starred_url":"https://api.github.com/users/jffree/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jffree/subscriptions","organizations_url":"https://api.github.com/users/jffree/orgs","repos_url":"https://api.github.com/users/jffree/repos","events_url":"https://api.github.com/users/jffree/events{/privacy}","received_events_url":"https://api.github.com/users/jffree/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T05:31:48Z","updated_at":"2019-02-22T05:31:48Z","author_association":"NONE","body":"@ywelsch \r\nIf I have set `minimum_master_nodes` 2, one node dead, and the cluster will not work. \r\nI hope the other node will still support service.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466292219","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466292219","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466292219,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI5MjIxOQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T06:46:18Z","updated_at":"2019-02-22T06:46:18Z","author_association":"CONTRIBUTOR","body":"> If I have set `minimum_master_nodes` 2, one node dead, and the cluster will not work.\r\n\r\nyes, you cannot have high availability in a 2 node cluster. Note that with `minimum_master_nodes` 2, the remaining node will be available for searches, but not for writes or metadata operations (e.g. backups).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466318260","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466318260","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466318260,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjMxODI2MA==","user":{"login":"vigyasharma","id":869395,"node_id":"MDQ6VXNlcjg2OTM5NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/869395?v=4","gravatar_id":"","url":"https://api.github.com/users/vigyasharma","html_url":"https://github.com/vigyasharma","followers_url":"https://api.github.com/users/vigyasharma/followers","following_url":"https://api.github.com/users/vigyasharma/following{/other_user}","gists_url":"https://api.github.com/users/vigyasharma/gists{/gist_id}","starred_url":"https://api.github.com/users/vigyasharma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vigyasharma/subscriptions","organizations_url":"https://api.github.com/users/vigyasharma/orgs","repos_url":"https://api.github.com/users/vigyasharma/repos","events_url":"https://api.github.com/users/vigyasharma/events{/privacy}","received_events_url":"https://api.github.com/users/vigyasharma/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T08:38:24Z","updated_at":"2019-02-22T08:38:24Z","author_association":"CONTRIBUTOR","body":"@ywelsch While setting `minimum_master_nodes` to 2 will avoid this, curious to know if this expected behavior or a replication edge case?\r\n\r\nThis does not look like a split brain, at a time there was only one master. First A is master, then it is stopped and node B is made master (single node cluster), then A is made *master ineligible* and added back to cluster. But it seems that node A's shards override node B's shards?\r\n\r\nCould this be an issue around allotting [primary terms](https://github.com/elastic/elasticsearch/pull/14062) for shards when master B promoted its replica to primary?\r\n\r\nHow are the cluster state details from node A and node B reconciled when A joins back? \r\n*(Apologies if this should've been a forum question, asking here to use context from this issue)*","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466344482","html_url":"https://github.com/elastic/elasticsearch/issues/39282#issuecomment-466344482","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39282","id":466344482,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjM0NDQ4Mg==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T10:07:21Z","updated_at":"2019-02-22T10:07:21Z","author_association":"CONTRIBUTOR","body":"For reference, it looks like the same question was asked on the discussion forum --> https://discuss.elastic.co/t/data-loss-when-old-master-node-dead-and-startup-again/169506/6\r\n\r\n@vigyasharma yes please ask your question on the forum. It's a good question, but this is not the right place to answer it.","performed_via_github_app":null}]