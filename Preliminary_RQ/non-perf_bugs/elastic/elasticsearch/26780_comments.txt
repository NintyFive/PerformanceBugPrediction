[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/332804432","html_url":"https://github.com/elastic/elasticsearch/issues/26780#issuecomment-332804432","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26780","id":332804432,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjgwNDQzMg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-09-28T11:09:21Z","updated_at":"2017-09-28T11:09:21Z","author_association":"CONTRIBUTOR","body":"Can you give a concrete example of some date math expressions that do not work today and that you would like to make work? For instance I believe `now||-1d/d` could be stated as `now-1d/d` and your second example `now||-1d/d||-1d||-1d` looks made up?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/338824722","html_url":"https://github.com/elastic/elasticsearch/issues/26780#issuecomment-338824722","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26780","id":338824722,"node_id":"MDEyOklzc3VlQ29tbWVudDMzODgyNDcyMg==","user":{"login":"rcrezende","id":604872,"node_id":"MDQ6VXNlcjYwNDg3Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/604872?v=4","gravatar_id":"","url":"https://api.github.com/users/rcrezende","html_url":"https://github.com/rcrezende","followers_url":"https://api.github.com/users/rcrezende/followers","following_url":"https://api.github.com/users/rcrezende/following{/other_user}","gists_url":"https://api.github.com/users/rcrezende/gists{/gist_id}","starred_url":"https://api.github.com/users/rcrezende/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rcrezende/subscriptions","organizations_url":"https://api.github.com/users/rcrezende/orgs","repos_url":"https://api.github.com/users/rcrezende/repos","events_url":"https://api.github.com/users/rcrezende/events{/privacy}","received_events_url":"https://api.github.com/users/rcrezende/received_events","type":"User","site_admin":false},"created_at":"2017-10-23T23:21:45Z","updated_at":"2017-10-23T23:50:02Z","author_association":"NONE","body":"This comes from a feature in a custom ES ui-client when we rewrite the user defined dates with templates.\r\n\r\nFor instance, a template could be:\r\n```{{timefilter.time.from}}||/d+1d```\r\n\r\nThen the template variable ```{{timefilter.time.from}}``` would be resolved to whatever the user selects in the UI. That allows users to define generic expressions for date range filters that would be dynamically resolved at runtime when someone selects the actual date intervals in the UI.\r\n\r\nBut because there is a special case in the parser, the expression ```{{timefilter.time.from}}||/d+1d``` is not always correct because ```{{timefilter.time.from}}```  can be resolved to the string 'now'.\r\nImplementing such feature, with current ES time expression parsing logic, requires also parsing on the client to merge properly with the template expression.\r\n\r\nIf '||' could be used with 'now' and multiple '||' allowed, the template expression would be correct regardless of ```{{timefilter.time.from}}```.\r\n\r\nExample 1:\r\n```\r\n{{timefilter.time.from}} = 'now-3M/d'\r\ntemplate = '{{timefilter.time.from}}||/d+7d'\r\n\r\nrewrite => 'now-3M/d||/d+7d' (which is incorrect for ES)\r\n```\r\n\r\nNot having such feature doesn't block the date templating, but adds unnecessary complexity to the rewrite method (**simple substitution would not work**). Today the above would be correctly rewritten to \r\n ```\r\nresolve_now_to_the_hardcoded_now_date_at_client_runtime||-3M/d/d+7d\r\n```\r\n\r\nExample 2:\r\n```\r\n{{timefilter.time.from}} = \"2017-10-20T23:42:58.807Z||-5d/d\"\r\ntemplate = '{{timefilter.time.from}}||/d+12h'\r\n\r\nrewrite (substitution) => '2017-10-20T23:42:58.807Z||-5d/d||/d+12h' (bad request)\r\n```\r\n\r\ncurrent \"workaround\" implementation:\r\n```\r\n'2017-10-20T23:42:58.807Z||-5d/d/d+12h'\r\n```\r\n\r\nNote that the proposed feature would also accept all current possible expressions, then not leading to breaking changes with your clients.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372765920","html_url":"https://github.com/elastic/elasticsearch/issues/26780#issuecomment-372765920","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26780","id":372765920,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjc2NTkyMA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T18:14:13Z","updated_at":"2018-03-13T18:14:13Z","author_association":"CONTRIBUTOR","body":"Thanks for the explanation of your needs. I added the `discuss` label. cc @elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/394410027","html_url":"https://github.com/elastic/elasticsearch/issues/26780#issuecomment-394410027","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26780","id":394410027,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NDQxMDAyNw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-06-04T16:06:44Z","updated_at":"2018-06-04T16:06:44Z","author_association":"CONTRIBUTOR","body":"We re-discussed this issue today and agreed to close it for now. While we understand the motivation, we'd like to see more traction to actually implement something like that.","performed_via_github_app":null}]