{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9037","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9037/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9037/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9037/events","html_url":"https://github.com/elastic/elasticsearch/issues/9037","id":52707990,"node_id":"MDU6SXNzdWU1MjcwNzk5MA==","number":9037,"title":"es 1.3.x: does not really support timeout in query dsl","user":{"login":"kaniini","id":1522444,"node_id":"MDQ6VXNlcjE1MjI0NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522444?v=4","gravatar_id":"","url":"https://api.github.com/users/kaniini","html_url":"https://github.com/kaniini","followers_url":"https://api.github.com/users/kaniini/followers","following_url":"https://api.github.com/users/kaniini/following{/other_user}","gists_url":"https://api.github.com/users/kaniini/gists{/gist_id}","starred_url":"https://api.github.com/users/kaniini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaniini/subscriptions","organizations_url":"https://api.github.com/users/kaniini/orgs","repos_url":"https://api.github.com/users/kaniini/repos","events_url":"https://api.github.com/users/kaniini/events{/privacy}","received_events_url":"https://api.github.com/users/kaniini/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-12-23T02:06:30Z","updated_at":"2014-12-23T16:47:16Z","closed_at":"2014-12-23T13:06:31Z","author_association":"NONE","active_lock_reason":null,"body":"hello,\n\nwe have a fairly sizeable cluster running elasticsearch 1.3.2.  this is where the story begins:\n\nuntil recently, we had some broken code that operated under the assumption that counts were inexpensive, you know, with the product being touted as a \"enterprise-quality big data analytics package\".\n\nin the process of debugging this, we discovered the [`timeout` request body parameter](http://www.elasticsearch.org/guide/en/elasticsearch/reference/1.3/search-request-body.html) as part of the query DSL.  we were delighted by the possibility of adding timeouts to our count requests as a temporary workaround.  so we quickly changed our query to this:\n\n```\n{\n     'query': {\n          {'term': {'device': device_id}}\n     },\n     'timeout': 2000\n}\n```\n\nthis immediately threw an error because the high quality documentation was unfortunately inconsistent in explaining how we were supposed to do this.  oh well.  so anyway, we changed our query DSL to this:\n\n```\n{\n    'query': {\n         {'term': {'device': device_id}, 'timeout': 2000},\n    }\n}\n```\n\nthis seemed to work, at least it returned data.  but then we started getting parse errors, like:\n\n```\nBroadcastShardOperationFailedException[[20141222][18] ]; nested: RemoteTransportException[[Rigellian Recorder][inet[/172.16.15.29:9300]][count/s]]; nested: QueryParsingException[[20141222] [_na] query malformed, no field after start_object];\n```\n\n...for all of our shards.\n\nat this point, we just decided to cut our losses and completely rewrite the code in question, which was probably the right decision to make in the first place.\n\nalso, in case you were wondering... we tried numerous instances of timeout value: `2000`, `2s`, `0.003m`, and so on.  they all failed in the same way -- shards rejecting the query dsl sent to them.  using strings seemed to make it more predictably prone to failure.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}