[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466251112","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-466251112","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":466251112,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI1MTExMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T02:36:19Z","updated_at":"2019-02-22T02:36:19Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466252792","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-466252792","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":466252792,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjI1Mjc5Mg==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T02:44:27Z","updated_at":"2019-02-22T02:44:27Z","author_association":"CONTRIBUTOR","body":"Ping: @gwbrown @tylersmalley @joshdover ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466337939","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-466337939","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":466337939,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjMzNzkzOQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T09:45:29Z","updated_at":"2019-02-22T09:45:29Z","author_association":"CONTRIBUTOR","body":"This also has implications for 7.0 as (unlike 6.x) 7.x will have a migration assistant from day one to prepare for upgrade to version 8.  elastic/kibana#30849 details a vaguely similar problem that affects the ML and Watcher indices in 7.0.\r\n\r\nLogically extending the proposal in this issue description:\r\n\r\n* Change the Kibana assistant _in 7.x_ to rename `.security-7` to `.security-8`\r\n* Change Elasticsearch from 7.0 onwards to treat `security-6`, `.security-7` and `.security-8` as restricted indices","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466347482","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-466347482","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":466347482,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjM0NzQ4Mg==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T10:17:42Z","updated_at":"2019-02-22T10:17:42Z","author_association":"CONTRIBUTOR","body":"Thanks @droberts195\r\n\r\nThat sounds like an issue. The 7.x upgrade assistant breaks the security index (https://github.com/elastic/elasticsearch/issues/39018), we shouldn't be shipping with that enabled.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466438276","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-466438276","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":466438276,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjQzODI3Ng==","user":{"login":"joshdover","id":1813008,"node_id":"MDQ6VXNlcjE4MTMwMDg=","avatar_url":"https://avatars2.githubusercontent.com/u/1813008?v=4","gravatar_id":"","url":"https://api.github.com/users/joshdover","html_url":"https://github.com/joshdover","followers_url":"https://api.github.com/users/joshdover/followers","following_url":"https://api.github.com/users/joshdover/following{/other_user}","gists_url":"https://api.github.com/users/joshdover/gists{/gist_id}","starred_url":"https://api.github.com/users/joshdover/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshdover/subscriptions","organizations_url":"https://api.github.com/users/joshdover/orgs","repos_url":"https://api.github.com/users/joshdover/repos","events_url":"https://api.github.com/users/joshdover/events{/privacy}","received_events_url":"https://api.github.com/users/joshdover/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T15:35:14Z","updated_at":"2019-02-22T15:35:14Z","author_association":"MEMBER","body":"Special handling for `.security-6` to `.security-7` in the Kibana Upgrade Assistant seems like a reasonable approach to me. For the Upgrade Assistant shipping in 7.0, do we want to disable reindexing of the `.security-7` index to `.security-8` for the time being?\r\n\r\nI ask due to the [discussion about special system indices](https://github.com/elastic/elasticsearch/issues/38678#issuecomment-462211056) that may happen in 8.0. Are we just creating more work for ourselves by allowing `.security-8` to exist if we are considering an alternative approach to storing this type of data?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466438790","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-466438790","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":466438790,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjQzODc5MA==","user":{"login":"joshdover","id":1813008,"node_id":"MDQ6VXNlcjE4MTMwMDg=","avatar_url":"https://avatars2.githubusercontent.com/u/1813008?v=4","gravatar_id":"","url":"https://api.github.com/users/joshdover","html_url":"https://github.com/joshdover","followers_url":"https://api.github.com/users/joshdover/followers","following_url":"https://api.github.com/users/joshdover/following{/other_user}","gists_url":"https://api.github.com/users/joshdover/gists{/gist_id}","starred_url":"https://api.github.com/users/joshdover/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshdover/subscriptions","organizations_url":"https://api.github.com/users/joshdover/orgs","repos_url":"https://api.github.com/users/joshdover/repos","events_url":"https://api.github.com/users/joshdover/events{/privacy}","received_events_url":"https://api.github.com/users/joshdover/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T15:36:41Z","updated_at":"2019-02-22T15:36:41Z","author_association":"MEMBER","body":"As an aside, should we restrict reindexing of the security index in general? While unlikely, it's possible a user could reindex this index and use aliases and get their cluster into a broken or insecure state.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466834200","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-466834200","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":466834200,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjgzNDIwMA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-25T00:22:27Z","updated_at":"2019-02-25T00:23:09Z","author_association":"CONTRIBUTOR","body":"> Special handling for `.security-6` to `.security-7` in the Kibana Upgrade Assistant seems like a reasonable approach to me.\r\n\r\nGreat, I'll work on making the necessary changes to ES to treat `.security-7` in a special way.\r\n\r\n@albertzaharovits, since you've most recently worked on restrict indices, can you get up to speed on this issue and be ready to review my PR when it's up?\r\n\r\n> For the Upgrade Assistant shipping in 7.0, do we want to disable reindexing of the `.security-7` index to `.security-8` for the time being?\r\n\r\nYes, for 2 reasons\r\n1. As we know it stops security feature from working. Sorry, I didn't realise the impact of that when it was first raised.\r\n2. I think this would give users the impression that their security index was \"v8 ready\", but we don't know what the security index will look like in 8 (or even if it will exist). It is highly likely we will need a special, customised \"upgrade security index\" step to be ready for ES8, but we can't define that process yet. I don't want users to feel like they're being given a moving target.\r\n\r\n> As an aside, should we restrict reindexing of the security index in general\r\n\r\nTypically we don't, because sometimes it's what's needed in order to fix a broken index, or simply as a backup of their security index. \r\nSo far our _\"Don't do that\"_ approach is mostly successful. What concerns me is if we put a tool like the asistant in front of users and then tell them, _\"you shouldn't have used that\"_.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466960747","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-466960747","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":466960747,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Njk2MDc0Nw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2019-02-25T10:34:04Z","updated_at":"2019-02-25T10:34:04Z","author_association":"MEMBER","body":"@tvernum thanks for picking this up. To summarize the plan and make sure I don't miss anything:\r\n1) We introduce a new `.security-7` naming convention and teach the migration assistant in 6.x to reindex into it.\r\n2) We will not allow upgrading the `.security-7` index in the 7.x migration assistant code (no matter what ES version created it). We need to be careful around wording in the kibana side here.\r\n3) The 7.x migration assistant will still allow you to reindex `.security-6` into `.security-7` if people started with a 6.x cluster and upgrade to 7.x\r\n\r\n@tvernum do I miss anything? also, I'm concerned about the type change to `_doc` being an issue with security. That sounds like security isn't using the typeless API and that, in turn, will likely cause a problem. \r\n\r\n@joshdover does this makes sense from your end of things? do you have a kibana issue to track it?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467096957","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467096957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467096957,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzA5Njk1Nw==","user":{"login":"joshdover","id":1813008,"node_id":"MDQ6VXNlcjE4MTMwMDg=","avatar_url":"https://avatars2.githubusercontent.com/u/1813008?v=4","gravatar_id":"","url":"https://api.github.com/users/joshdover","html_url":"https://github.com/joshdover","followers_url":"https://api.github.com/users/joshdover/followers","following_url":"https://api.github.com/users/joshdover/following{/other_user}","gists_url":"https://api.github.com/users/joshdover/gists{/gist_id}","starred_url":"https://api.github.com/users/joshdover/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshdover/subscriptions","organizations_url":"https://api.github.com/users/joshdover/orgs","repos_url":"https://api.github.com/users/joshdover/repos","events_url":"https://api.github.com/users/joshdover/events{/privacy}","received_events_url":"https://api.github.com/users/joshdover/received_events","type":"User","site_admin":false},"created_at":"2019-02-25T17:16:11Z","updated_at":"2019-02-25T17:16:11Z","author_association":"MEMBER","body":"The `.security-6` to `.security-7` path should be simple enough to implement in the Assistant. I've created https://github.com/elastic/kibana/issues/31927 to track this.\r\n\r\n> 2\\. We will not allow upgrading the `.security-7` index in the 7.x migration assistant code (no matter what ES version created it). We need to be careful around wording in the kibana side here.\r\n\r\nDo we have any problem with just not showing any deprecation warning for `.security-7` until we know what we're going to do for 8.0? This could give a false sense of upgradability, but since the assistant already informs the user that they need to upgrade to the last 7.x minor to get the latest warnings, this seems fine to me.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467099687","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467099687","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467099687,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzA5OTY4Nw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2019-02-25T17:24:02Z","updated_at":"2019-02-25T17:24:02Z","author_association":"MEMBER","body":"> but since the assistant already informs the user that they need to upgrade to the last 7.x minor to get the latest warnings, this seems fine to me.\r\n\r\ngood one. works from my perspective.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467273049","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467273049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467273049,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzI3MzA0OQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T02:53:04Z","updated_at":"2019-02-26T02:53:04Z","author_association":"CONTRIBUTOR","body":"@bleskes \r\n\r\n>  We introduce a new `.security-7` naming convention and teach the migration assistant in 6.x to reindex into it.\r\n\r\nYes. The ES side of this is #39337 which is about ready to merge (I just want a 2nd review on it given the impact).\r\n\r\n> We will not allow upgrading the `.security-7` index in the 7.x migration assistant code (no matter what ES version created it).\r\n\r\nYes. The issue is not so much the naming issue (though there is one) but that (per your comment below) current security code can't handle a reindex to `_doc` / type-less APIs.\r\n\r\n> The 7.x migration assistant will still allow you to reindex `.security-6` into `.security-7` if people started with a 6.x cluster and upgrade to 7.x\r\n\r\nThat's fine (and could be helpful) as long as it doesn't change the name of the `doc` type.\r\n\r\n> do I miss anything?\r\n\r\nNo, I don't think so.\r\n**But** I haven't done any impact assessment for internal indices other than `.security`\r\nI have concerns about (for example) the fact that none of the ES watcher test suite will ever test running with `.watches` pointing to `.reindexed-v6-watches-6`. However, I think that's a separate isuse to consider.\r\n\r\n> I'm concerned about the type change to `_doc` being an issue with security. That sounds like security isn't using the typeless API and that, in turn, will likely cause a problem.\r\n\r\nIt is certainly the case that security isn't using typeless APIs. Do you have specific concerns? We'd like to get rid of the security index (convert it to a special internal index) before ES8, so we haven't prioritised any work on migrating it to typeless APIs.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467332065","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467332065","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467332065,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzMzMjA2NQ==","user":{"login":"tylersmalley","id":40265,"node_id":"MDQ6VXNlcjQwMjY1","avatar_url":"https://avatars2.githubusercontent.com/u/40265?v=4","gravatar_id":"","url":"https://api.github.com/users/tylersmalley","html_url":"https://github.com/tylersmalley","followers_url":"https://api.github.com/users/tylersmalley/followers","following_url":"https://api.github.com/users/tylersmalley/following{/other_user}","gists_url":"https://api.github.com/users/tylersmalley/gists{/gist_id}","starred_url":"https://api.github.com/users/tylersmalley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tylersmalley/subscriptions","organizations_url":"https://api.github.com/users/tylersmalley/orgs","repos_url":"https://api.github.com/users/tylersmalley/repos","events_url":"https://api.github.com/users/tylersmalley/events{/privacy}","received_events_url":"https://api.github.com/users/tylersmalley/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T07:46:33Z","updated_at":"2019-02-26T07:46:33Z","author_association":"MEMBER","body":"I have a PR up to make this change in Kibana for 6.7: https://github.com/elastic/kibana/pull/31996\r\n\r\nTomorrow I will take care of excluding security from being upgradeable in 7.0+, unless @gwbrown you think that should be handled in the deprecations API?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467399259","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467399259","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467399259,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzM5OTI1OQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T11:15:28Z","updated_at":"2019-02-26T11:15:28Z","author_association":"MEMBER","body":"> **But** I haven't done any impact assessment for internal indices other than `.security`\r\nI have concerns about (for example) the fact that none of the ES watcher test suite will ever test running with `.watches` pointing to `.reindexed-v6-watches-6`. However, I think that's a separate isuse to consider.\r\n\r\n@gwbrown can you please chase/test/evaluate where we stand on the other internal indices? I would look at everything that starts with a `.`.\r\n\r\n> It is certainly the case that security isn't using typeless APIs. Do you have specific concerns?\r\n\r\n@tvernum Good question. I need to understand more. I'll reach out to discuss via another channel.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467457833","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467457833","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467457833,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzQ1NzgzMw==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T14:25:33Z","updated_at":"2019-02-26T14:25:33Z","author_association":"CONTRIBUTOR","body":"@bleskes @gwbrown @tvernum - I have been working through the internal indexes see https://github.com/elastic/elasticsearch/issues/38637\r\n\r\nWIP PR for Logstash Central monitoring: https://github.com/elastic/elasticsearch/pull/38653\r\nWIP PR for Monitoring : https://github.com/elastic/elasticsearch/pull/39336\r\nWIP PR for Watcher: https://github.com/elastic/elasticsearch/pull/39383\r\n\r\nI haven't done anything with the .security templates/indexes yet.\r\n\r\nThe goal here is to have these ready by next week and asses how much risk merging these into 7.0 would introduce. \r\n\r\nI am also working with Kibana to move to the typeless API's.  I will to ask for any changes beyond adoption of the typeless API (e.g. changing types or index patterns) that those be merged to a feature branch and assess the risk next week as well. Ping me directly for additional information. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467658990","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467658990","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467658990,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzY1ODk5MA==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T23:31:43Z","updated_at":"2019-02-27T00:00:13Z","author_association":"CONTRIBUTOR","body":"After digging through the code and talking to some experts:\r\n* `.watches` will also need some special handling - the underlying index must have a name starting with `.watches` (see [here](https://github.com/elastic/elasticsearch/blob/master/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/Watcher.java#L579-L581) primarily - Watcher needs to attach a listener to the `.watches` index, which it does by matching the name. There may be other places, but this is the biggest one, as it needs that listener to pick up new or changed watches.).\r\n* `.triggered-watches` should be fine.\r\n* `.watcher-history*` indices should be fine.\r\n* `.monitoring*` indices should be fine.\r\n* `.logstash` should be fine, as far as Elasticsearch is concerned, though I still need to check with the associated features in Kibana and Logstash. I will be a bit surprised if there are issues, but it's possible.\r\n* I need to check with @droberts195 regarding ML's indices.\r\n\r\nI still need to do more thorough manual (and if possible, automated) testing - I'll continue to work on that.\r\n\r\nOne consistent theme I've seen is that by and large, the features that depend on these indices are **not** ready to use a typeless index.  It may be that we want to disable the reindex assistant for all internal indices in 7.0 until we've made some progress on that front. The PRs Jake linked to above should address this for those features, but they may not make it into 7.0, and they require some pretty significant changes.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467659863","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467659863","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467659863,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzY1OTg2Mw==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T23:34:57Z","updated_at":"2019-02-26T23:34:57Z","author_association":"CONTRIBUTOR","body":"> Tomorrow I will take care of excluding security from being upgradeable in 7.0+, unless @gwbrown you think that should be handled in the deprecations API?\r\n\r\nGiven that we'll already need special cases Kibana side for `.security` and `.watches`, it might be a good idea to keep those contained to one place.  On the other hand, putting a different message in the Deprecations API would be good to dissuade users from reindexing them manually if they aren't using the Kibana migration assistant.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467755524","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467755524","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467755524,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzc1NTUyNA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T07:34:44Z","updated_at":"2019-02-27T07:35:35Z","author_association":"CONTRIBUTOR","body":"The ES changes for `.security-7` (https://github.com/elastic/elasticsearch/pull/39337) have been merged and backported to 6.7 (https://github.com/elastic/elasticsearch/pull/39433)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467962156","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-467962156","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":467962156,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzk2MjE1Ng==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T17:49:44Z","updated_at":"2019-02-27T17:49:44Z","author_association":"MEMBER","body":"> Given that we'll already need special cases Kibana side for `.security` and `.watches`\r\n\r\n@gwbrown, we had a meeting today about it and the decision was that:\r\n\r\n1. `.watches` will require some fixing to make it properly respond to alias changes. @jakelandis is on it.\r\n2. The migration assistant in 7.0 will not allow reindexing of the internal indices in 7.x for now. Once we figure out what we want we can enable that functionality in the right way.\r\n3. We will continue to explore what it means to go typeless internally in 7.0. @jpountz is working on backporting the `_doc`-matches-any-type functionality to 6.7. That will allow ML to keep their move to the typeless API and open the door to everything else if deemed possible. It will be great if you can continue your research to see if there are other problems.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/468115676","html_url":"https://github.com/elastic/elasticsearch/issues/39284#issuecomment-468115676","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39284","id":468115676,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODExNTY3Ng==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-28T02:48:22Z","updated_at":"2019-02-28T02:48:22Z","author_association":"CONTRIBUTOR","body":"I am going to close this issue and I believe the specific problem is now resolved with https://github.com/elastic/elasticsearch/pull/39337 and https://github.com/elastic/kibana/pull/31996\r\n\r\nThe conversation here has crossed into other related issues, but I believe all of them are covered by other tracking issues. If there's something on this thread that hasn't made it to another issue/PR, please open one.\r\n","performed_via_github_app":null}]