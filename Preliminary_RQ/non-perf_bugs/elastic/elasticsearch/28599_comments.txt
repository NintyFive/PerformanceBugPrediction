[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366260770","html_url":"https://github.com/elastic/elasticsearch/issues/28599#issuecomment-366260770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28599","id":366260770,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjI2MDc3MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-02-16T15:07:58Z","updated_at":"2018-02-16T15:07:58Z","author_association":"MEMBER","body":"We don't do exact unique count because it doesn't scale, elasticsearch is distributed so getting all unique values would require that each shard send their full list to the coordinating node. This could work for few values but it would break as soon as the number of unique values grow.  For this reason we rely on HyperLogLog to do an approximation using a reasonable amount of memory. You can also tweak the parameters to get a better precision:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cardinality-aggregation.html#_precision_control\r\nNote also that if the number of unique values is below the provided threshold the count is accurate.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366265029","html_url":"https://github.com/elastic/elasticsearch/issues/28599#issuecomment-366265029","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28599","id":366265029,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjI2NTAyOQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-02-16T15:22:48Z","updated_at":"2018-02-16T15:22:48Z","author_association":"MEMBER","body":"> Note also that if the number of unique values is below the provided threshold the count is accurate.\r\n\r\nSorry my mistake, the count is close to accurate in this case but there is no guarantee that it is completely accurate since we use hashing and there might be some collisions (very low probability but can happen so the count is not always accurate in this case too).","performed_via_github_app":null}]