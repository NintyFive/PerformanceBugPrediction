{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38412","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38412/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38412/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38412/events","html_url":"https://github.com/elastic/elasticsearch/issues/38412","id":406737235,"node_id":"MDU6SXNzdWU0MDY3MzcyMzU=","number":38412,"title":"UpgradeClusterClientYamlTestSuiteIT tests fail because of deprecation warnings","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"assignees":[{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2019-02-05T11:23:30Z","updated_at":"2019-02-05T18:11:06Z","closed_at":"2019-02-05T18:07:54Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Came across this in a PR build: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+pull-request-2/7278/console\r\n\r\nExample output:\r\n```\r\n3:04:47 ERROR   0.08s | UpgradeClusterClientYamlTestSuiteIT.test {p0=old_cluster/40_ml_datafeed_crud/Put job and datafeed in old cluster} <<< FAILURES!\r\n13:04:47    > Throwable #1: org.elasticsearch.client.WarningFailureException: method [GET], host [http://[::1]:46781], URI [/_template/.ml-notifications], status line [HTTP/1.1 200 OK]\r\n13:04:47    > Warnings: [[types removal] The response format of get index template requests will change in the next major version. Please start using the `include_type_name` parameter set to `false` in the request to move to the new, typeless response format that will be the default in 7.0.]\r\n13:04:47    > {\".ml-notifications\":{\"order\":0,\"version\":6070099,\"index_patterns\":[\".ml-notifications\"],\"settings\":{\"index\":{\"number_of_shards\":\"1\",\"auto_expand_replicas\":\"0-1\",\"unassigned\":{\"node_left\":{\"delayed_timeout\":\"1m\"}}}},\"mappings\":{\"audit_message\":{\"properties\":{\"job_id\":{\"type\":\"keyword\"},\"level\":{\"type\":\"keyword\"},\"message\":{\"type\":\"text\",\"fields\":{\"raw\":{\"type\":\"keyword\"}}},\"timestamp\":{\"type\":\"date\"},\"node_name\":{\"type\":\"keyword\"}}}},\"aliases\":{}}}\r\n13:04:47    > \tat __randomizedtesting.SeedInfo.seed([CA5B3D2C2AEFD704:420F02F68413BAFC]:0)\r\n13:04:47    > \tat org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:690)\r\n13:04:47    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:218)\r\n13:04:47    > \tat org.elasticsearch.xpack.test.rest.XPackRestTestHelper.lambda$waitForTemplates$1(XPackRestTestHelper.java:79)\r\n13:04:47    > \tat org.elasticsearch.test.ESTestCase.awaitBusy(ESTestCase.java:879)\r\n13:04:47    > \tat org.elasticsearch.test.ESTestCase.awaitBusy(ESTestCase.java:868)\r\n13:04:47    > \tat org.elasticsearch.xpack.test.rest.XPackRestTestHelper.waitForTemplates(XPackRestTestHelper.java:76)\r\n13:04:47    > \tat org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT.waitForTemplates(UpgradeClusterClientYamlTestSuiteIT.java:31)\r\n13:04:47    > \tat java.lang.Thread.run(Thread.java:748)\r\n13:04:47    > Caused by: org.elasticsearch.client.WarningFailureException: method [GET], host [http://[::1]:46781], URI [/_template/.ml-notifications], status line [HTTP/1.1 200 OK]\r\n13:04:47    > Warnings: [[types removal] The response format of get index template requests will change in the next major version. Please start using the `include_type_name` parameter set to `false` in the request to move to the new, typeless response format that will be the default in 7.0.]\r\n13:04:47    > {\".ml-notifications\":{\"order\":0,\"version\":6070099,\"index_patterns\":[\".ml-notifications\"],\"settings\":{\"index\":{\"number_of_shards\":\"1\",\"auto_expand_replicas\":\"0-1\",\"unassigned\":{\"node_left\":{\"delayed_timeout\":\"1m\"}}}},\"mappings\":{\"audit_message\":{\"properties\":{\"job_id\":{\"type\":\"keyword\"},\"level\":{\"type\":\"keyword\"},\"message\":{\"type\":\"text\",\"fields\":{\"raw\":{\"type\":\"keyword\"}}},\"timestamp\":{\"type\":\"date\"},\"node_name\":{\"type\":\"keyword\"}}}},\"aliases\":{}}}\r\n13:04:47    > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:304)\r\n13:04:47    > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:294)\r\n13:04:47    > \tat org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:122)\r\n13:04:47    > \tat org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:181)\r\n13:04:47    > \tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:448)\r\n13:04:47    > \tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:338)\r\n13:04:47    > \tat org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n13:04:47    > \tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n13:04:47    > \tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n13:04:47    > \tat org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n13:04:47    > \tat org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n13:04:47    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n13:04:47    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n13:04:47    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n13:04:47    > \tat org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n13:04:47    > \tat org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:591)\r\n13:04:47    > \t... 1 more\r\n```\r\n\r\nThis looks similar to https://github.com/elastic/elasticsearch/issues/38395 and looks like it can be resolved by dealing with the deprecation warnings in the [XPackRestTestHelper](https://github.com/elastic/elasticsearch/blob/5384162a42b066ee4bcadba6ab6d699f6966747f/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/test/rest/XPackRestTestHelper.java#L79)","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}