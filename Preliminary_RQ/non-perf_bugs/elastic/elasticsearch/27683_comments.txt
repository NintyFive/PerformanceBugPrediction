[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/349644243","html_url":"https://github.com/elastic/elasticsearch/issues/27683#issuecomment-349644243","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27683","id":349644243,"node_id":"MDEyOklzc3VlQ29tbWVudDM0OTY0NDI0Mw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2017-12-06T13:47:47Z","updated_at":"2017-12-06T13:47:47Z","author_association":"MEMBER","body":"Hi @jeacott1,\r\n\r\nthe BulkResponse you get back when executing the BulkRequest should hold a response for each item responding of the bulk requests, in the order they have been sent (either the document id/type/index or a failure object). Could you describe in more detail what part is missing from this API to work in your use case?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/349814229","html_url":"https://github.com/elastic/elasticsearch/issues/27683#issuecomment-349814229","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27683","id":349814229,"node_id":"MDEyOklzc3VlQ29tbWVudDM0OTgxNDIyOQ==","user":{"login":"jeacott1","id":16600100,"node_id":"MDQ6VXNlcjE2NjAwMTAw","avatar_url":"https://avatars3.githubusercontent.com/u/16600100?v=4","gravatar_id":"","url":"https://api.github.com/users/jeacott1","html_url":"https://github.com/jeacott1","followers_url":"https://api.github.com/users/jeacott1/followers","following_url":"https://api.github.com/users/jeacott1/following{/other_user}","gists_url":"https://api.github.com/users/jeacott1/gists{/gist_id}","starred_url":"https://api.github.com/users/jeacott1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeacott1/subscriptions","organizations_url":"https://api.github.com/users/jeacott1/orgs","repos_url":"https://api.github.com/users/jeacott1/repos","events_url":"https://api.github.com/users/jeacott1/events{/privacy}","received_events_url":"https://api.github.com/users/jeacott1/received_events","type":"User","site_admin":false},"created_at":"2017-12-06T23:52:32Z","updated_at":"2017-12-06T23:52:32Z","author_association":"NONE","body":"sure,\r\n the current api only accepts and responds with data intended directly for ES consumption. ie I can only send actual to be indexed documents. If I want for example to use the async api, and know which partition Id was associated with a given batch I have 3 basic options.\r\n1. I create a new esClient, or wrapper representing each partition and ensure I use the correct one for the partition each time. seems naive and makes it that much harder to throttle throughput to ES.\r\n2. I add a new partitionid field to my to-be-indexed pojo's representing es documents and not serialise that field to json before submission. somewhat hacky and invasive. \r\n3. some external means of keeping track of each doc (or the first doc in a bulkRequest) vs partitionid and looking them up.\r\n\r\nthe trouble with all of these is that I really want to track the batch, not the individual documents since the batch will have an associated kafka offset that needs to be stored, or not depending on success. \r\n\r\nso the ability to pass through arbitrary context stuff would I think be helpful.\r\nnone of this works for the BulkProcessor unless it can accept bulkRequests. at least then I can control each submission block is per partition and recognise which one failed when it does. I could also pass through some form of ordering marker so I can properly track responses in order too.\r\n\r\nwithout it I seem to be stuck with hacky workarounds. am I missing something?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/349824501","html_url":"https://github.com/elastic/elasticsearch/issues/27683#issuecomment-349824501","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27683","id":349824501,"node_id":"MDEyOklzc3VlQ29tbWVudDM0OTgyNDUwMQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-07T00:48:19Z","updated_at":"2017-12-07T00:48:19Z","author_association":"MEMBER","body":"I don't understand, you can capture the context client side as part of your async listener:\r\n\r\n```\r\n        final int partitionId;\r\n        final BulkRequest bulkRequest;\r\n        client.bulkAsync(bulkRequest, new ActionListener<BulkResponse>() {\r\n            @Override\r\n            public void onResponse(BulkResponse bulkItemResponses) {\r\n                // capture partitionId and use it in the listener\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Exception e) {\r\n                // capture partitionId and use it in the listener\r\n            }\r\n        });\r\n```\r\n\r\nYou can capture whatever metadata you need here?\r\n\r\nThe bulk processor is different since you do not control the batching. Sending bulk requests to the bulk processor mostly defeats the point of the bulk processor (other than controlling the number of outstanding requests), instead use the bulk methods on the clients?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/350886749","html_url":"https://github.com/elastic/elasticsearch/issues/27683#issuecomment-350886749","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27683","id":350886749,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MDg4Njc0OQ==","user":{"login":"jeacott1","id":16600100,"node_id":"MDQ6VXNlcjE2NjAwMTAw","avatar_url":"https://avatars3.githubusercontent.com/u/16600100?v=4","gravatar_id":"","url":"https://api.github.com/users/jeacott1","html_url":"https://github.com/jeacott1","followers_url":"https://api.github.com/users/jeacott1/followers","following_url":"https://api.github.com/users/jeacott1/following{/other_user}","gists_url":"https://api.github.com/users/jeacott1/gists{/gist_id}","starred_url":"https://api.github.com/users/jeacott1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeacott1/subscriptions","organizations_url":"https://api.github.com/users/jeacott1/orgs","repos_url":"https://api.github.com/users/jeacott1/repos","events_url":"https://api.github.com/users/jeacott1/events{/privacy}","received_events_url":"https://api.github.com/users/jeacott1/received_events","type":"User","site_admin":false},"created_at":"2017-12-11T22:59:17Z","updated_at":"2017-12-11T22:59:17Z","author_association":"NONE","body":"ok sure, I could use anonymous inner classes, or I could create a new listener/client pair per partition,\r\n but if I don't want to structure my code that way, or I want to use just a single listener I think this lib should support the case.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/351014076","html_url":"https://github.com/elastic/elasticsearch/issues/27683#issuecomment-351014076","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27683","id":351014076,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MTAxNDA3Ng==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2017-12-12T10:43:46Z","updated_at":"2017-12-12T10:43:46Z","author_association":"MEMBER","body":"I'm not convinved yet that this is a good enough reason to add more complexity to the bulk api. I'm leaving this issue open for others to comment but currently I think solving this task on the client end is a better solution.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352021240","html_url":"https://github.com/elastic/elasticsearch/issues/27683#issuecomment-352021240","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27683","id":352021240,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjAyMTI0MA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-12-15T14:38:11Z","updated_at":"2017-12-15T14:38:42Z","author_association":"MEMBER","body":"> ok sure, I could use anonymous inner classes, or I could create a new listener/client pair per partition, but if I don't want to structure my code that way, or I want to use just a single listener I think this lib should support the case.\r\n\r\nNote that you do not have to use anonymous classes. You can have a concrete listener:\r\n\r\n```java\r\nclass PartitionIdAwareListener extends ActionListener<BulkResponse> {\r\n    private final int partitionId;\r\n\r\n    public ParititionIdAwareListener(final int int partitionId) {\r\n      this.partitionId = partitionId;\r\n    }\r\n\r\n    .\r\n    .\r\n    .\r\n}\r\n```\r\n\r\nThen:\r\n\r\n```java\r\n        client.bulkAsync(bulkRequest, new ParititionIdAwareListener(partitionId));\r\n```\r\n\r\nWe discussed this in Fix-it-Friday and agree that since this can easily be handled client side without adding any complexity to the API we are not going to implement this functionality.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/354681891","html_url":"https://github.com/elastic/elasticsearch/issues/27683#issuecomment-354681891","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27683","id":354681891,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NDY4MTg5MQ==","user":{"login":"jeacott1","id":16600100,"node_id":"MDQ6VXNlcjE2NjAwMTAw","avatar_url":"https://avatars3.githubusercontent.com/u/16600100?v=4","gravatar_id":"","url":"https://api.github.com/users/jeacott1","html_url":"https://github.com/jeacott1","followers_url":"https://api.github.com/users/jeacott1/followers","following_url":"https://api.github.com/users/jeacott1/following{/other_user}","gists_url":"https://api.github.com/users/jeacott1/gists{/gist_id}","starred_url":"https://api.github.com/users/jeacott1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeacott1/subscriptions","organizations_url":"https://api.github.com/users/jeacott1/orgs","repos_url":"https://api.github.com/users/jeacott1/repos","events_url":"https://api.github.com/users/jeacott1/events{/privacy}","received_events_url":"https://api.github.com/users/jeacott1/received_events","type":"User","site_admin":false},"created_at":"2018-01-01T22:36:19Z","updated_at":"2018-01-01T22:36:19Z","author_association":"NONE","body":"@jasontedor even with a new listener, it doesn't solve the actual problem.  I still need a new listener per partition instead of a simple single listener though which I can pass a context.\r\n\r\nbut I guess, cest comme ca.","performed_via_github_app":null}]