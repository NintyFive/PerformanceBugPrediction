{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6815","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6815/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6815/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6815/events","html_url":"https://github.com/elastic/elasticsearch/issues/6815","id":37573064,"node_id":"MDU6SXNzdWUzNzU3MzA2NA==","number":6815,"title":"New clustering aggregation","user":{"login":"mal","id":591257,"node_id":"MDQ6VXNlcjU5MTI1Nw==","avatar_url":"https://avatars0.githubusercontent.com/u/591257?v=4","gravatar_id":"","url":"https://api.github.com/users/mal","html_url":"https://github.com/mal","followers_url":"https://api.github.com/users/mal/followers","following_url":"https://api.github.com/users/mal/following{/other_user}","gists_url":"https://api.github.com/users/mal/gists{/gist_id}","starred_url":"https://api.github.com/users/mal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mal/subscriptions","organizations_url":"https://api.github.com/users/mal/orgs","repos_url":"https://api.github.com/users/mal/repos","events_url":"https://api.github.com/users/mal/events{/privacy}","received_events_url":"https://api.github.com/users/mal/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2014-07-10T15:20:14Z","updated_at":"2014-10-31T09:56:44Z","closed_at":"2014-10-31T09:56:44Z","author_association":"NONE","active_lock_reason":null,"body":"Bucket documents if they contain at least `n` values in common, such that given four documents:\n\n``` json\n{\"a\": [4,5,34,712]}\n{\"a\": [3,4]}\n{\"a\": [100, 200, 300]}\n{\"a\": [712]}\n```\n\nA req/res pair in the case of `n=1` (defined by setting `overlap` in this example) would look something like (not suggested output format, for illustrative purposes only):\n\nRequest:\n\n```\n{\n    \"aggs\" : {\n        \"my_clusters\" : {\n            \"cluster\" : { \"field\" : \"a\", \"overlap\": 1 }\n        }\n    }\n}\n```\n\nResponse:\n\n```\n{\n    ...\n\n    \"aggregations\" : {\n        \"my_clusters\" : {\n            \"buckets\" : [\n                {\n                    \"key\" : [3, 4, 5, 34, 712],\n                    \"doc_count\" : 3\n                },\n                {\n                    \"key\" : [100, 200, 300],\n                    \"doc_count\" : 1\n                },\n            ]\n        }\n    }\n}\n```\n\nWhile this would be useful on it's own, using it together with the forthcoming top hits aggregation, would allow the selection of fields from the highest scoring document from each cluster, which would be amazingly useful.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}