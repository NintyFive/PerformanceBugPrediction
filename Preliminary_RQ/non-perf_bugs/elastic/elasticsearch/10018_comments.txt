[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/77572603","html_url":"https://github.com/elastic/elasticsearch/issues/10018#issuecomment-77572603","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10018","id":77572603,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NTcyNjAz","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2015-03-06T15:03:47Z","updated_at":"2015-03-06T15:03:47Z","author_association":"MEMBER","body":"I looked at it, not obvious..., seems like the shard got moved, but ended up not being deleted. Seems unrelated so far to my change.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83056341","html_url":"https://github.com/elastic/elasticsearch/issues/10018#issuecomment-83056341","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10018","id":83056341,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDU2MzQx","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2015-03-18T16:55:20Z","updated_at":"2015-03-18T16:55:20Z","author_association":"CONTRIBUTOR","body":"Here is what happens:\nWhen we delete shards we first check if all expected copies of this shard are actually up and running somewhere else (IndicesStore.deleteShardIfExistElseWhere()). This check checks for STARTED and RELOCATED. In the test we relocate a shard from one node (node_1) to another (node_3) but at the moment node_1 checks if enough shards available the shard is still in POST_RECOVERY on node_3 and therefore the check fails.\n\nThis is easily reproducible by adding an artificial delay in IndexShardState.changeState.\n\nChatted with @s1monw about it and will make a PR to schedule a retry of the check in case the check runs into shards which are in POST_RECOVERY.\n","performed_via_github_app":null}]