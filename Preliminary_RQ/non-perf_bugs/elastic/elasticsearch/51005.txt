{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51005","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51005/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51005/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51005/events","html_url":"https://github.com/elastic/elasticsearch/issues/51005","id":549817694,"node_id":"MDU6SXNzdWU1NDk4MTc2OTQ=","number":51005,"title":"Normalization pipeline aggregations","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":1967499105,"node_id":"MDU6TGFiZWwxOTY3NDk5MTA1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Analytics","name":"Team:Analytics","color":"fef2c0","default":false,"description":"Meta label for analytics/geo team"},{"id":1903451964,"node_id":"MDU6TGFiZWwxOTAzNDUxOTY0","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Top%20Ask","name":"Top Ask","color":"fef2c0","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"assignees":[{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-01-14T21:05:11Z","updated_at":"2020-05-14T20:32:42Z","closed_at":"2020-05-14T20:32:42Z","author_association":"MEMBER","active_lock_reason":null,"body":"This proposal is for one (or several) pipeline aggs that can perform normalization of the metrics.  For example, given the series of data:\r\n\r\n```\r\n[5, 5, 10, 50, 10, 20]\r\n```\r\nA user might want to normalize those in different ways:\r\n\r\n- Rescale [-1, 1]\r\n  - `[-1, -1, -0.77, 1, -0.77, -0.33]`\r\n- Rescale [0, 100]\r\n  - `[0, 0, 11.11, 100, 11.11, 33.33]`\r\n- Percentage of sum [0, 100%]\r\n  - `[5%, 5%, 10%, 50%, 10%, 20%]`\r\n- Mean normalization\r\n  - `[4.63, 4.63, 9.63, 49.63, 9.63, 9.63, 19.63]`\r\n- Z-score normalization (mean of zero, stdev of 1)\r\n  - `[-0.68, -0.68, -0.39, 1.94, -0.39, 0.19]`\r\n- Softmax (0-1 range, sum to 1, larger values have more weight)\r\n  - `[2.862E-20, 2.862E-20, 4.248E-18, 0.999, 9.357E-14, 4.248E-18]`\r\n\r\netc etc\r\n\r\nThe two obvious use-cases are rescaling values to a a `[0, 1]` range to make it easier to compare relative magnitudes, and normalizing to percentage of the sum for percentage charts.  \r\n\r\nMore advanced functions like z-score are useful for their statistical properties, softmax can handle negative numbers nicely, etc.  But I'm not sure how useful they would be in practice, since this is operating over bucket values and not raw values (which is where normalization/centering/standardizing typically has value).\r\n\r\nIn any case, a pipeline agg could accept the values from a multi-bucket agg (like a date_histo) and perform the normalization to produce a new set of metrics.  Unsure how the syntax would look.  If it was a single-purpose agg (`percentage_of_sum`) it's easy.  But if we want to build a multi-function agg that can perform multiple functions, we either need a selectable function or something like MovingFunction where the user specifies a script (with helper methods)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}