[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/146240930","html_url":"https://github.com/elastic/elasticsearch/issues/13975#issuecomment-146240930","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13975","id":146240930,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NjI0MDkzMA==","user":{"login":"cphoover","id":284360,"node_id":"MDQ6VXNlcjI4NDM2MA==","avatar_url":"https://avatars0.githubusercontent.com/u/284360?v=4","gravatar_id":"","url":"https://api.github.com/users/cphoover","html_url":"https://github.com/cphoover","followers_url":"https://api.github.com/users/cphoover/followers","following_url":"https://api.github.com/users/cphoover/following{/other_user}","gists_url":"https://api.github.com/users/cphoover/gists{/gist_id}","starred_url":"https://api.github.com/users/cphoover/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cphoover/subscriptions","organizations_url":"https://api.github.com/users/cphoover/orgs","repos_url":"https://api.github.com/users/cphoover/repos","events_url":"https://api.github.com/users/cphoover/events{/privacy}","received_events_url":"https://api.github.com/users/cphoover/received_events","type":"User","site_admin":false},"created_at":"2015-10-07T15:50:17Z","updated_at":"2015-10-07T15:50:17Z","author_association":"NONE","body":"I think I have a solution for this...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/146241594","html_url":"https://github.com/elastic/elasticsearch/issues/13975#issuecomment-146241594","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13975","id":146241594,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NjI0MTU5NA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-10-07T15:52:42Z","updated_at":"2015-10-07T15:52:42Z","author_association":"CONTRIBUTOR","body":"> I think I have a solution for this...\n\nhttps://xkcd.com/979/\n\nBut to be serious I'd love to hear about it!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/146302772","html_url":"https://github.com/elastic/elasticsearch/issues/13975#issuecomment-146302772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13975","id":146302772,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NjMwMjc3Mg==","user":{"login":"cphoover","id":284360,"node_id":"MDQ6VXNlcjI4NDM2MA==","avatar_url":"https://avatars0.githubusercontent.com/u/284360?v=4","gravatar_id":"","url":"https://api.github.com/users/cphoover","html_url":"https://github.com/cphoover","followers_url":"https://api.github.com/users/cphoover/followers","following_url":"https://api.github.com/users/cphoover/following{/other_user}","gists_url":"https://api.github.com/users/cphoover/gists{/gist_id}","starred_url":"https://api.github.com/users/cphoover/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cphoover/subscriptions","organizations_url":"https://api.github.com/users/cphoover/orgs","repos_url":"https://api.github.com/users/cphoover/repos","events_url":"https://api.github.com/users/cphoover/events{/privacy}","received_events_url":"https://api.github.com/users/cphoover/received_events","type":"User","site_admin":false},"created_at":"2015-10-07T19:26:22Z","updated_at":"2015-10-07T19:26:22Z","author_association":"NONE","body":"@nik9000 LOL\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/146304179","html_url":"https://github.com/elastic/elasticsearch/issues/13975#issuecomment-146304179","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13975","id":146304179,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NjMwNDE3OQ==","user":{"login":"cphoover","id":284360,"node_id":"MDQ6VXNlcjI4NDM2MA==","avatar_url":"https://avatars0.githubusercontent.com/u/284360?v=4","gravatar_id":"","url":"https://api.github.com/users/cphoover","html_url":"https://github.com/cphoover","followers_url":"https://api.github.com/users/cphoover/followers","following_url":"https://api.github.com/users/cphoover/following{/other_user}","gists_url":"https://api.github.com/users/cphoover/gists{/gist_id}","starred_url":"https://api.github.com/users/cphoover/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cphoover/subscriptions","organizations_url":"https://api.github.com/users/cphoover/orgs","repos_url":"https://api.github.com/users/cphoover/repos","events_url":"https://api.github.com/users/cphoover/events{/privacy}","received_events_url":"https://api.github.com/users/cphoover/received_events","type":"User","site_admin":false},"created_at":"2015-10-07T19:32:56Z","updated_at":"2015-10-07T20:05:34Z","author_association":"NONE","body":"# APM Data Rentention/Archival Process\n\n## Snapshot, Compression and Archival of Historical Indices\n\nThis process will involve using [elastic curator](https://github.com/elastic/curator) in conjunction with the [AWS Cloud Plugin for Elasticsearch](https://github.com/elastic/elasticsearch-cloud-aws#s3-repository) in order to store compressed snapshots of the previous days index. This process should run on a nightly basis. Optionally we can move indexes stored in s3 into Amazon Glacier cold storage, by setting up an [AWS Lifecycle rule](https://aws.amazon.com/blogs/aws/archive-s3-to-glacier/), to be stored at a significantly [cheaper cost](https://aws.amazon.com/s3/pricing/).  The disadvantage being once files are moved to cold storage they take some time to be read and are not immediately accessible. You can read more about [glacier here](https://aws.amazon.com/glacier/).\n\n## Sampling/Thinning out of Historical Indices\n\nThis section still needs to be flushed out a bit, and the tooling needs to be created. The general idea is creating a tool, that uses the ES [Scan and Scroll API ](https://www.elastic.co/guide/en/elasticsearch/guide/current/scan-scroll.html) to push documents into a new index based on a sample ratio (e.g `Math.random() <= SAMPLE_RATIO`). This tool should be run to thin the data of older indices out on a nightly basis. In our case we have an alerting system. This sampling process should omit periods of time in which we had active alerts.  In those periods of time we should have full resolution of our data points.  After this process has finished being created and the process has completed the newly created index should be given an index alias of the former index name. Then the old index can be dropped.\n\nCurrently we are using a **count** aggregation to visualize traffic/throughput, or rate of events.  This will not work when using sampling of data, because it would appear in our charts that indices that had been sampled would have a lower event count. Instead to fix this we will have to attach a new field onto all events that we care about `\"countFactor\"`.  This can easily be done with the logstash [mutate filter](https://www.elastic.co/guide/en/logstash/current/plugins-filters-mutate.html). So by default all documents will be indexed into elasticsearch with a field value `\"countFactor\" : 1`. Now when we run the sampling/thinning process we will have to multiply the countFactor by the divisor e.g. `sample 1/2 of events \"countFactor\" : 2`   now let's say a month passes and you want to thin that out by another 50% of documents you would multiply by 2 again and now have `\"countFactor\" : 4`. Now to visualize the event rate, instead of using a count aggregation you will use a sum aggregation.  This would give you the approximate rate of events at any given time.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/146552976","html_url":"https://github.com/elastic/elasticsearch/issues/13975#issuecomment-146552976","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13975","id":146552976,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NjU1Mjk3Ng==","user":{"login":"cphoover","id":284360,"node_id":"MDQ6VXNlcjI4NDM2MA==","avatar_url":"https://avatars0.githubusercontent.com/u/284360?v=4","gravatar_id":"","url":"https://api.github.com/users/cphoover","html_url":"https://github.com/cphoover","followers_url":"https://api.github.com/users/cphoover/followers","following_url":"https://api.github.com/users/cphoover/following{/other_user}","gists_url":"https://api.github.com/users/cphoover/gists{/gist_id}","starred_url":"https://api.github.com/users/cphoover/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cphoover/subscriptions","organizations_url":"https://api.github.com/users/cphoover/orgs","repos_url":"https://api.github.com/users/cphoover/repos","events_url":"https://api.github.com/users/cphoover/events{/privacy}","received_events_url":"https://api.github.com/users/cphoover/received_events","type":"User","site_admin":false},"created_at":"2015-10-08T13:54:59Z","updated_at":"2015-10-08T13:54:59Z","author_association":"NONE","body":"@nik9000 not sure if there is a better way to handle this. What are your thoughts?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/146555749","html_url":"https://github.com/elastic/elasticsearch/issues/13975#issuecomment-146555749","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13975","id":146555749,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NjU1NTc0OQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-10-08T14:03:26Z","updated_at":"2015-10-08T14:03:26Z","author_association":"CONTRIBUTOR","body":"@cphoover I think its a good plan. I've been thinking about this for the past few months too and your ideas seem pretty good.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372697990","html_url":"https://github.com/elastic/elasticsearch/issues/13975#issuecomment-372697990","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13975","id":372697990,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjY5Nzk5MA==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T15:06:02Z","updated_at":"2018-03-13T15:06:02Z","author_association":"CONTRIBUTOR","body":"If I am not mistaken, A solution for this exists in our new [Rollups API](https://www.elastic.co/guide/en/elasticsearch/reference/master/rollup-search.html). Closing. \r\nFeel free to open if you feel like this is not the solution you were intending.","performed_via_github_app":null}]