{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17885","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17885/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17885/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17885/events","html_url":"https://github.com/elastic/elasticsearch/issues/17885","id":149722216,"node_id":"MDU6SXNzdWUxNDk3MjIyMTY=","number":17885,"title":"Dynamic fields are still added when `dynamic: false` but field is an array in document","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-04-20T10:02:25Z","updated_at":"2016-05-02T12:07:21Z","closed_at":"2016-04-20T10:09:15Z","author_association":"MEMBER","active_lock_reason":null,"body":"This was found by testing a code comment left by @rjernst : https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java#L544-545\n\nRun the following Sense script:\n\n```\nPUT test\n{\n  \"settings\": {\n    \"number_of_shards\": 1,\n    \"number_of_replicas\": 0,\n    \"index.mapper.dynamic\":false\n  },\n  \"mappings\": {\n    \"doc\": {\n      \"properties\": {\n        \"foo\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n\nPOST test/doc/1\n{\n  \"ignore_me\": [2.0, 3.0]\n}\n\nGET test\n```\n\nThe index is created with dynamic mappings set to `false` so all unmapped fields should be silently ignored and not added to the mappings. However the last command returns:\n\n```\n{\n  \"test\": {\n    \"aliases\": {},\n    \"mappings\": {\n      \"doc\": {\n        \"properties\": {\n          \"foo\": {\n            \"type\": \"text\"\n          },\n          \"ignore_me\": {\n            \"type\": \"float\"\n          }\n        }\n      }\n    },\n    \"settings\": {\n      \"index\": {\n        \"mapper\": {\n          \"dynamic\": \"false\"\n        },\n        \"creation_date\": \"1461146374897\",\n        \"number_of_shards\": \"1\",\n        \"number_of_replicas\": \"0\",\n        \"uuid\": \"WrcW-mGOT9iD-saDgZqc8A\",\n        \"version\": {\n          \"created\": \"5000099\"\n        }\n      }\n    }\n  }\n```\n\nThis shows that the `ignore_me` field was in fact added to the mappings and running the search below will confirm that the field was indexed (the search matches the document).\n\n```\nGET test/_search\n{\n  \"query\": {\n    \"term\": {\n      \"ignore_me\": {\n        \"value\": 2.0\n      }\n    }\n  }\n}\n```\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}