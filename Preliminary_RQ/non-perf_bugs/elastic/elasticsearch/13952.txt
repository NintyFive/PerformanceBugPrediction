{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13952","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13952/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13952/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13952/events","html_url":"https://github.com/elastic/elasticsearch/issues/13952","id":109881163,"node_id":"MDU6SXNzdWUxMDk4ODExNjM=","number":13952,"title":"OR statement braking the \"NOT\" statement ElasticSearch","user":{"login":"ACV2","id":6947506,"node_id":"MDQ6VXNlcjY5NDc1MDY=","avatar_url":"https://avatars0.githubusercontent.com/u/6947506?v=4","gravatar_id":"","url":"https://api.github.com/users/ACV2","html_url":"https://github.com/ACV2","followers_url":"https://api.github.com/users/ACV2/followers","following_url":"https://api.github.com/users/ACV2/following{/other_user}","gists_url":"https://api.github.com/users/ACV2/gists{/gist_id}","starred_url":"https://api.github.com/users/ACV2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ACV2/subscriptions","organizations_url":"https://api.github.com/users/ACV2/orgs","repos_url":"https://api.github.com/users/ACV2/repos","events_url":"https://api.github.com/users/ACV2/events{/privacy}","received_events_url":"https://api.github.com/users/ACV2/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-10-05T20:38:29Z","updated_at":"2015-10-08T19:38:41Z","closed_at":"2015-10-05T20:48:43Z","author_association":"NONE","active_lock_reason":null,"body":"Hi Everyone,\nI'm here to give back to community, i spent hours looking for an answer for my problem without luck, so I decided to share my findings with you all, so we can all take a look on the mystic of elasticsearch.\n\nMy problem was very simple, but not easy as it seems:\ni needed to search for a field where the fields match a keyword or it were simply blank either null\nex:\n\nSELECT \\* FROM bucket1 WHERE country=\"canada\" AND (language=en OR language=NULL)\n\nsimple right?\n\nfor my query i constructed the following:\nbucket/document/_search [POST]\n{\n  \"size\": 10,\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"country:ca AND region1:quebec AND (language:en OR -language:*)\"\n    }\n  }\n}\n\nIt brought me 0 (zero) results what made me think.. because when i did the split query, it broght me around 35k results\nex:\n{\n  \"size\": 10,\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"country:ca AND region1:quebec AND (language:en)\"\n    }\n  }\n}\n32k results\nTHEN \n{\n  \"size\": 10,\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"country:ca AND region1:quebec AND (-language:*)\"\n    }\n  }\n}\n3k results\n\nso i decided go for different approach\n{\n  \"size\": 10,\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"(region1:quebec AND -geo_city:\\* ) OR (region1:quebec AND geo_city:montreal )\"\n    }\n  }\n}\n35K results\nconclusion NOT statement is broking everything if set with an OR statement.\nafter that i finally did the following:\n{\n  \"size\": 10,\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"country:ca AND region1:quebec AND ((language:en) OR (-language:*))\"\n    }\n  }\n}\n35k results, and it was working\n\nnow im looking for a different approach to make this query more efficient, cuz the NOT statement is taking really long time to excecute, around x20 factor than without the NOT statement.\n\ni hope to have some feedbacks on this =)\n\nthanks in advance\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}