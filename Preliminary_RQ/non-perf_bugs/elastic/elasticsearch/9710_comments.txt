[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/74828693","html_url":"https://github.com/elastic/elasticsearch/issues/9710#issuecomment-74828693","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9710","id":74828693,"node_id":"MDEyOklzc3VlQ29tbWVudDc0ODI4Njkz","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-02-18T08:26:39Z","updated_at":"2015-02-18T08:26:39Z","author_association":"CONTRIBUTOR","body":"+1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/74865982","html_url":"https://github.com/elastic/elasticsearch/issues/9710#issuecomment-74865982","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9710","id":74865982,"node_id":"MDEyOklzc3VlQ29tbWVudDc0ODY1OTgy","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-02-18T13:48:47Z","updated_at":"2015-02-18T13:48:47Z","author_association":"MEMBER","body":"I'm working on a solution with minimal code changes that would only require a setter for the time zone in the DateTime formatter and a small change in the DateHistogramParser. I ran some local tests, a query like\n\n```\nGET /dates/docs/_search?search_type=count \n{\n  \"aggs\" : {\n    \"date_agg\" : {\n      \"date_histogram\": {\n        \"field\": \"date\",\n        \"interval\": \"month\",\n        \"time_zone\": \"Europe/Amsterdam\"\n      }\n    }\n  }\n}\n```\n\nwould now get results like:\n\n```\n\"aggregations\": {\n      \"date_agg\": {\n         \"buckets\": [\n            {\n               \"key_as_string\": \"2014-03-01T00:00:00.000+01:00\",\n               \"key\": 1393628400000,\n               \"doc_count\": 4\n            },\n            {\n               \"key_as_string\": \"2014-06-01T00:00:00.000+02:00\",\n               \"key\": 1401573600000,\n               \"doc_count\": 2\n            },\n            [...]\n         ]\n      }\n   }\n```\n\nThe nice thing is that `key_as_string` is still a UTC date makes more sense in terms of the specified time zone because it seemingly starts at midnight but the zone is appended. This also works nicely with DST (as demostrated above).\n\nWithout specifying the `time_zone` the result would be something like:\n\n```\n\"aggregations\": {\n      \"date_agg\": {\n         \"buckets\": [\n            {\n               \"key_as_string\": \"2014-03-01T00:00:00.000Z\",\n               \"key\": 1393632000000,\n               \"doc_count\": 4\n            },\n            {\n               \"key_as_string\": \"2014-06-01T00:00:00.000Z\",\n               \"key\": 1401580800000,\n               \"doc_count\": 2\n            },\n            [...]\n         ]\n      }\n   }\n```\n\nNote that this doesn't affect custom formatting like:\n\n```\n\"format\" : \"YY-MM-dd#HH-mm-ss#Z\"  \n-->\n{\n        \"key_as_string\": \"14-03-01#00-00-00#+0100\",\n        \"key\": 1393628400000,\n        \"doc_count\": 4\n},\n```\n\nAlso, the time zone can entirely be dropped with custom formatting so it looks like local time, but the key is still UTC:\n\n```\n\"format\" : \"YY-MM-dd#HH:mm:ss\"  \n-->\n{\n        \"key_as_string\": \"14-03-01#00:00:00\",\n        \"key\": 1393628400000,\n        \"doc_count\": 4\n},\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/74866181","html_url":"https://github.com/elastic/elasticsearch/issues/9710#issuecomment-74866181","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9710","id":74866181,"node_id":"MDEyOklzc3VlQ29tbWVudDc0ODY2MTgx","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-02-18T13:50:23Z","updated_at":"2015-02-18T13:50:23Z","author_association":"MEMBER","body":"I wonder if this needs to be configurable because it is a nice default behaviour and one can always specify a format that drops the time zone using custom formatting. I will open a PR with my current changes for discussion.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/74866637","html_url":"https://github.com/elastic/elasticsearch/issues/9710#issuecomment-74866637","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9710","id":74866637,"node_id":"MDEyOklzc3VlQ29tbWVudDc0ODY2NjM3","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-02-18T13:53:34Z","updated_at":"2015-02-18T13:53:34Z","author_association":"CONTRIBUTOR","body":"@cbuescher The behaviour described above looks great to me. Also +1 to not introduce additional settings.\n","performed_via_github_app":null}]