{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15286","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15286/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15286/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15286/events","html_url":"https://github.com/elastic/elasticsearch/issues/15286","id":120819167,"node_id":"MDU6SXNzdWUxMjA4MTkxNjc=","number":15286,"title":"Creating a java client node throws \"script file extension not supported [groovy]\", but script works as expected","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-12-07T16:54:51Z","updated_at":"2015-12-08T10:07:37Z","closed_at":"2015-12-08T06:32:17Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I have two groovy files placed in the config/scripts directory of the elasticsearch home directory. Since upgrading to elasticsearch 2.1.0 (from 1.6.0), I have started seeing the following stacktrace upon launching my application:\n\n`java.lang.IllegalArgumentException: script file extension not supported [groovy]\n    at org.elasticsearch.script.ScriptService.getScriptEngineServiceForFileExt(ScriptService.java:221)\n    at org.elasticsearch.script.ScriptService.access$1200(ScriptService.java:83)\n    at org.elasticsearch.script.ScriptService$ScriptChangesListener.onFileInit(ScriptService.java:537)\n    at org.elasticsearch.watcher.FileWatcher$FileObserver.onFileCreated(FileWatcher.java:256)\n    at org.elasticsearch.watcher.FileWatcher$FileObserver.init(FileWatcher.java:166)\n    at org.elasticsearch.watcher.FileWatcher$FileObserver.createChild(FileWatcher.java:173)\n    at org.elasticsearch.watcher.FileWatcher$FileObserver.listChildren(FileWatcher.java:188)\n    at org.elasticsearch.watcher.FileWatcher$FileObserver.onDirectoryCreated(FileWatcher.java:299)\n    at org.elasticsearch.watcher.FileWatcher$FileObserver.init(FileWatcher.java:162)\n    at org.elasticsearch.watcher.FileWatcher$FileObserver.access$000(FileWatcher.java:75)\n    at org.elasticsearch.watcher.FileWatcher.doInit(FileWatcher.java:65)\n    at org.elasticsearch.watcher.AbstractResourceWatcher.init(AbstractResourceWatcher.java:36)\n    at org.elasticsearch.watcher.ResourceWatcherService.add(ResourceWatcherService.java:133)\n    at org.elasticsearch.watcher.ResourceWatcherService.add(ResourceWatcherService.java:126)\n    at org.elasticsearch.script.ScriptService.<init>(ScriptService.java:192)`\n\nIt seems like there is no engine for groovy files. However, when I later perform an operation that uses the scripts, everything works with no problems at all. Seeing in the source code, I can see the \"scriptEnginesByExt\" map being populated before the FileWatcher gets initialised. So, I cannot see how the engine for groovy scripts could be being added later. \n\nAlso note that this occurs when I am creating a Node client (configured with `.client(true)`). If I create a transport client instead, I do not get the stacktrace. Before upgrading, such a stacktrace was not present while still using a Node client.\n\nI would be thankful for any ideas on why this is happening.\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}