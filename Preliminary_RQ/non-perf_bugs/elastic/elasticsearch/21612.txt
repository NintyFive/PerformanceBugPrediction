{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21612","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21612/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21612/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21612/events","html_url":"https://github.com/elastic/elasticsearch/issues/21612","id":189946098,"node_id":"MDU6SXNzdWUxODk5NDYwOTg=","number":21612,"title":"Network traffic & Virtual Memory upped by several times since upgrading to ES5","user":{"login":"xgwu","id":10510416,"node_id":"MDQ6VXNlcjEwNTEwNDE2","avatar_url":"https://avatars2.githubusercontent.com/u/10510416?v=4","gravatar_id":"","url":"https://api.github.com/users/xgwu","html_url":"https://github.com/xgwu","followers_url":"https://api.github.com/users/xgwu/followers","following_url":"https://api.github.com/users/xgwu/following{/other_user}","gists_url":"https://api.github.com/users/xgwu/gists{/gist_id}","starred_url":"https://api.github.com/users/xgwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xgwu/subscriptions","organizations_url":"https://api.github.com/users/xgwu/orgs","repos_url":"https://api.github.com/users/xgwu/repos","events_url":"https://api.github.com/users/xgwu/events{/privacy}","received_events_url":"https://api.github.com/users/xgwu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-11-17T05:55:41Z","updated_at":"2016-11-17T09:33:51Z","closed_at":"2016-11-17T09:33:51Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**:\r\n5.0.0\r\n**Plugins installed**: []\r\nnone\r\n**JVM version**:\r\n1.8.0_77\r\n**OS version**:\r\nCentOS release 6.4 (Final)\r\n**Description of the problem including expected versus actual behavior**:\r\nLinux 2.6.32-358.el6.x86_64 #1 SMP Fri Feb 22 00:31:26 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux\r\n**Steps to reproduce**:\r\nAfter upgrading from v2.4.0 to v5.0.0 last weekend, Nov 11th, we saw significant increment in a couple of resource usages:\r\n1. network traffic increased by about 7 times.\r\n![image](https://cloud.githubusercontent.com/assets/10510416/20377518/1dd0b61e-accb-11e6-81d8-b1d70aa8ddb0.png)\r\n![image](https://cloud.githubusercontent.com/assets/10510416/20377523/25ab8544-accb-11e6-9b03-a1fdb6e36121.png)\r\nBy refering to documents, tcp compression defaults to false both in v5.0.0 & v2.4.0, not sure why there is such a big difference. As our architecture puts several dedicated client nodes as data entry points, NIC bandwidth now became the bottleneck which however was never a concern back in v2.4.0 time. For now we have to get around the bottleneck by enabling tcp compression on client nodes.\r\n\r\n2. The memory virtual increased by about 5 times on data node, but total on disk index size is about the same size after upgrading.\r\n![image](https://cloud.githubusercontent.com/assets/10510416/20377670/1bb2bb2e-accc-11e6-84ea-bde0beff0668.png)\r\n\r\nThough I understand memory virtual is not the actual physical memory required, it raised me concerns that data node potentially need to map more data from disks to memory than previous version. And I worried the performance could suffer when the search needs to access large amount of on disk data.\r\n\r\nConsidering we are suffering from occasional node wearing out issue reported in another issue:\r\nhttps://github.com/elastic/elasticsearch/issues/21611 , I suspect these could be somewhat related.\r\n \r\n**Provide logs (if relevant)**:\r\n\r\n<!--\r\nIf you are filing a feature request, please remove the above bug\r\nreport block and provide responses for all of the below items.\r\n-->\r\n\r\n**Describe the feature**:\r\n","closed_by":{"login":"xgwu","id":10510416,"node_id":"MDQ6VXNlcjEwNTEwNDE2","avatar_url":"https://avatars2.githubusercontent.com/u/10510416?v=4","gravatar_id":"","url":"https://api.github.com/users/xgwu","html_url":"https://github.com/xgwu","followers_url":"https://api.github.com/users/xgwu/followers","following_url":"https://api.github.com/users/xgwu/following{/other_user}","gists_url":"https://api.github.com/users/xgwu/gists{/gist_id}","starred_url":"https://api.github.com/users/xgwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xgwu/subscriptions","organizations_url":"https://api.github.com/users/xgwu/orgs","repos_url":"https://api.github.com/users/xgwu/repos","events_url":"https://api.github.com/users/xgwu/events{/privacy}","received_events_url":"https://api.github.com/users/xgwu/received_events","type":"User","site_admin":false},"performed_via_github_app":null}