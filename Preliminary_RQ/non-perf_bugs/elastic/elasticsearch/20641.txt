{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20641","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20641/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20641/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20641/events","html_url":"https://github.com/elastic/elasticsearch/issues/20641","id":178863862,"node_id":"MDU6SXNzdWUxNzg4NjM4NjI=","number":20641,"title":"Duplicate items in the dynamic_templates should give an error on mapping","user":{"login":"LeonardGC","id":8624699,"node_id":"MDQ6VXNlcjg2MjQ2OTk=","avatar_url":"https://avatars2.githubusercontent.com/u/8624699?v=4","gravatar_id":"","url":"https://api.github.com/users/LeonardGC","html_url":"https://github.com/LeonardGC","followers_url":"https://api.github.com/users/LeonardGC/followers","following_url":"https://api.github.com/users/LeonardGC/following{/other_user}","gists_url":"https://api.github.com/users/LeonardGC/gists{/gist_id}","starred_url":"https://api.github.com/users/LeonardGC/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LeonardGC/subscriptions","organizations_url":"https://api.github.com/users/LeonardGC/orgs","repos_url":"https://api.github.com/users/LeonardGC/repos","events_url":"https://api.github.com/users/LeonardGC/events{/privacy}","received_events_url":"https://api.github.com/users/LeonardGC/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-09-23T12:27:12Z","updated_at":"2017-05-09T08:14:52Z","closed_at":"2016-09-26T08:25:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version**: 5.0.0 beta1\n\n**Plugins installed**: []\n\n**JVM version**:Version 8 Update 101\n\n**Steps to reproduce**:\n1. Definition of a mapping where I define 2 \"testString\" blocks.\n\n```\n{\n  \"settings\": {\n    \"analysis\": {\n      \"analyzer\": {\n        \"default\": {\n          \"type\": \"custom\",\n          \"tokenizer\": \"standard\",\n          \"filter\": [\n            \"standard\",\n            \"lowercase\",\n            \"asciifolding\"\n          ]\n        },\n        \"lowercasedRaw\": {\n          \"type\": \"custom\",\n          \"tokenizer\": \"keyword\",\n          \"filter\": [\n            \"lowercase\"\n          ]\n        }\n      }\n    }\n  },\n  \"mappings\": {\n    \"_default_\": {\n      \"dynamic_templates\": [\n        /* all \"test\" fields have an analyzed subfield added */\n        {\n          \"testString\": {\n            \"match_mapping_type\": \"string\",\n            \"match\" : \"test\",\n            \"mapping\": {\n              \"type\": \"string\",\n              \"analyzer\": \"lowercasedRaw\",\n              \"index\": \"analyzed\",\n              \"fields\": {\n                \"analyzed\": {\n                  \"type\": \"string\",\n                  \"index\": \"analyzed\",\n                  \"analyzer\": \"default\"\n                }\n              }\n            }\n          }\n        },\n        /* string fields are by default analyzed with the lowercasedRaw analyzer */\n        /* NOTICE the duplicate \"testString\" name */\n        {\n          \"testString\": {\n            \"match_mapping_type\": \"string\",\n            \"mapping\": {\n              \"analyzer\": \"lowercasedRaw\",\n              \"index\": \"analyzed\",\n              \"type\": \"string\"\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n```\n1. First case\n   Add the following records (in bulk):\n\n```\n{\"index\":{\"_type\" : \"log\", \"_id\" : \"1\" } }\n{\"test\":\"testing\"}\n{\"index\":{\"_type\" : \"log\", \"_id\" : \"2\" } }\n{\"group\":\"U2\"}\n```\n\nGet the mapping now (I removed the \"_default_\" part, because that stays the same):\n\n```\n{\n  \"testing\": {\n    \"mappings\": {\n      \"log\": {\n        \"dynamic_templates\": [\n          {\n            \"testString\": {\n              \"match\": \"test\",\n              \"match_mapping_type\": \"string\",\n              \"mapping\": {\n                \"analyzer\": \"lowercasedRaw\",\n                \"fields\": {\n                  \"analyzed\": {\n                    \"analyzer\": \"default\",\n                    \"index\": \"analyzed\",\n                    \"type\": \"string\"\n                  }\n                },\n                \"index\": \"analyzed\",\n                \"type\": \"string\"\n              }\n            }\n          },\n          {\n            \"testString\": {\n              \"match_mapping_type\": \"string\",\n              \"mapping\": {\n                \"analyzer\": \"lowercasedRaw\",\n                \"index\": \"analyzed\",\n                \"type\": \"string\"\n              }\n            }\n          }\n        ],\n        \"properties\": {\n          \"group\": {\n            \"type\": \"text\",\n            \"analyzer\": \"lowercasedRaw\"\n          },\n          \"test\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"analyzed\": {\n                \"type\": \"text\"\n              }\n            },\n            \"analyzer\": \"lowercasedRaw\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n1. Second case\n   Add the following records (in bulk): (these are the same records as above, but only the order is changed:\n\n```\n{\"index\":{\"_type\" : \"log\", \"_id\" : \"2\" } }\n{\"group\":\"U2\"}\n{\"index\":{\"_type\" : \"log\", \"_id\" : \"1\" } }\n{\"test\":\"testing\"}\n```\n\nGet the mapping now (I removed the \"_default_\" part, because that stays the same):\n\n```\n{\n  \"testing\": {\n    \"mappings\": {\n      \"log\": {\n        \"dynamic_templates\": [\n          {\n            \"testString\": {\n              \"match\": \"test\",\n              \"match_mapping_type\": \"string\",\n              \"mapping\": {\n                \"analyzer\": \"lowercasedRaw\",\n                \"fields\": {\n                  \"analyzed\": {\n                    \"analyzer\": \"default\",\n                    \"index\": \"analyzed\",\n                    \"type\": \"string\"\n                  }\n                },\n                \"index\": \"analyzed\",\n                \"type\": \"string\"\n              }\n            }\n          }\n        ],\n        \"properties\": {\n          \"group\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"test\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"analyzed\": {\n                \"type\": \"text\"\n              }\n            },\n            \"analyzer\": \"lowercasedRaw\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nIf you compare these 2 mappings you'll see the differences.\n1. Notice that if you correct the original mapping and give the 2 items a different name, the mapping stays consistent, regardless the order of the records.\n","closed_by":{"login":"LeonardGC","id":8624699,"node_id":"MDQ6VXNlcjg2MjQ2OTk=","avatar_url":"https://avatars2.githubusercontent.com/u/8624699?v=4","gravatar_id":"","url":"https://api.github.com/users/LeonardGC","html_url":"https://github.com/LeonardGC","followers_url":"https://api.github.com/users/LeonardGC/followers","following_url":"https://api.github.com/users/LeonardGC/following{/other_user}","gists_url":"https://api.github.com/users/LeonardGC/gists{/gist_id}","starred_url":"https://api.github.com/users/LeonardGC/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LeonardGC/subscriptions","organizations_url":"https://api.github.com/users/LeonardGC/orgs","repos_url":"https://api.github.com/users/LeonardGC/repos","events_url":"https://api.github.com/users/LeonardGC/events{/privacy}","received_events_url":"https://api.github.com/users/LeonardGC/received_events","type":"User","site_admin":false},"performed_via_github_app":null}