{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21034","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21034/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21034/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21034/events","html_url":"https://github.com/elastic/elasticsearch/issues/21034","id":184169039,"node_id":"MDU6SXNzdWUxODQxNjkwMzk=","number":21034,"title":"Bug?: dictionary_decompounder filter ignores marked keywords","user":{"login":"iamjochem","id":792188,"node_id":"MDQ6VXNlcjc5MjE4OA==","avatar_url":"https://avatars0.githubusercontent.com/u/792188?v=4","gravatar_id":"","url":"https://api.github.com/users/iamjochem","html_url":"https://github.com/iamjochem","followers_url":"https://api.github.com/users/iamjochem/followers","following_url":"https://api.github.com/users/iamjochem/following{/other_user}","gists_url":"https://api.github.com/users/iamjochem/gists{/gist_id}","starred_url":"https://api.github.com/users/iamjochem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iamjochem/subscriptions","organizations_url":"https://api.github.com/users/iamjochem/orgs","repos_url":"https://api.github.com/users/iamjochem/repos","events_url":"https://api.github.com/users/iamjochem/events{/privacy}","received_events_url":"https://api.github.com/users/iamjochem/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-10-20T08:46:40Z","updated_at":"2016-10-20T09:44:16Z","closed_at":"2016-10-20T09:16:46Z","author_association":"NONE","active_lock_reason":null,"body":"The following looks like a bug to me (but maybe I misunderstand the intent of the two filters in question and how they are meant to interact).\n\n| **Elasticsearch version** | 2.2 |\n| --- | --- |\n| **Plugins installed** | https://github.com/francesconero/elasticsearch-concatenate-token-filter/tree/2.2.0 |\n| **JVM version** | java version \"1.8.0_51\", Java(TM) SE Runtime Environment (build 1.8.0_51-b16), Java HotSpot(TM) 64-Bit Server VM (build 25.51-b03, mixed mode) |\n| **OS version** | Mac OSX 10.10.5 |\n## The problem:\n\n I am trying to use the `dictionary_decompounder` filter to extract sub-words and at the same time stop other words from being stemmed/decompounded using the `keyword_marker` filter - the `dictionary_decompounder` ignores tokens marked as keywords and de-compounds them. \n\nThe expectation is that the tokens marked as keywords are not touched by the `dictionary_decompounder` filter (in the same way as stemmer filters do not touch them). \n\nAdditionally I notice that the `dictionary_decompounder` will generate duplicate tokens when the input token is equal to a matching sub-word (\"keuken\" in the example below) - this looks like it is not intended but it is easily worked around using a `unique` filter (so, for me, it's not so much of a problem)\n## Steps to reproduce**:\n### 1. create a test index:\n\n> _N.B._ the `control_*` analyzers are included to show that stemming does not occur on keywords and also that the word \"messing\" is [incorrectly] stemmed to \"mes\" \n\n``` json\n{\n    \"analysis\"    : {\n        \"analyzer\"      : {\n            \"control_stem\"      : {\n                \"type\"          : \"custom\",\n                \"tokenizer\"     : \"standard\",\n                \"filter\"        : [\"kp_snow\"]\n            },\n\n            \"control_kwstem\"    : {\n                \"type\"          : \"custom\",\n                \"tokenizer\"     : \"standard\",\n                \"filter\"        : [\"nl_keywords\", \"kp_snow\"]\n            },\n\n            \"test\"              : {\n                \"type\"          : \"custom\",\n                \"tokenizer\"     : \"standard\",\n                \"filter\"        : [\"nl_keywords\", \"nl_dehyphenate\", \"kp_snow\"]\n            }\n        },\n\n        \"filter\"        : {\n            \"kp_snow\"           : {\n                \"type\"                      : \"snowball\",\n                \"language\"                  : \"Kp\"\n            },\n\n\n            \"nl_keywords\"       : {\n                \"type\"                      : \"keyword_marker\",\n                \"keywords\"                  : [\n                    \"messing\"\n                ]\n            },\n\n            \"nl_dehyphenate\": {\n                \"type\"                      : \"dictionary_decompounder\",\n                \"min_word_size\"             : 6,\n                \"min_subword_size\"          : 3,\n                \"max_subword_size\"          : 15,\n                \"word_list\"                 : [\n                    \"keuken\",\n                    \"mes\"\n                ]\n            }\n        }\n    }\n}\n```\n### 2. Perform an analyzer query\n\nAssuming the created index is called \"**decomp_test**\" the following request illustrate expected/actual analyzer results:\n\n``` sh\nhttp://localhost:9200/decomp_test/_analyze?analyzer=test\n```\n\n| Actual Tokens | Expected Tokens |\n| --- | --- |\n| messing, mes, keukenme, keuk, mes, keuk, keuk | messing, keukenme, keuk, mes, keuk |\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}