{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8370","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8370/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8370/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8370/events","html_url":"https://github.com/elastic/elasticsearch/issues/8370","id":48000418,"node_id":"MDU6SXNzdWU0ODAwMDQxOA==","number":8370,"title":"Big requests shouldn't be stuffed into exception messages","user":{"login":"zakmagnus","id":1757886,"node_id":"MDQ6VXNlcjE3NTc4ODY=","avatar_url":"https://avatars2.githubusercontent.com/u/1757886?v=4","gravatar_id":"","url":"https://api.github.com/users/zakmagnus","html_url":"https://github.com/zakmagnus","followers_url":"https://api.github.com/users/zakmagnus/followers","following_url":"https://api.github.com/users/zakmagnus/following{/other_user}","gists_url":"https://api.github.com/users/zakmagnus/gists{/gist_id}","starred_url":"https://api.github.com/users/zakmagnus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zakmagnus/subscriptions","organizations_url":"https://api.github.com/users/zakmagnus/orgs","repos_url":"https://api.github.com/users/zakmagnus/repos","events_url":"https://api.github.com/users/zakmagnus/events{/privacy}","received_events_url":"https://api.github.com/users/zakmagnus/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-11-06T19:03:04Z","updated_at":"2018-02-13T19:38:00Z","closed_at":"2014-11-07T13:06:14Z","author_association":"NONE","active_lock_reason":null,"body":"For example, suppose ES receives a search query exceeding the maximum number of search terms Lucene will accept. This is probably a pretty large query. Eventually the Lucene Query will throw an exception as terms are added to it, and it will be caught by SearchService.parseSource(). In there, the query will be converted to JSON and placed into an exception message. That's a pretty large string.\n\nTo make matters worse, all of your shards will create similar exceptions, and their messages will be combined together in SearchPhaseExecutionError.buildMessage(). This means a very large string will be constructed in-memory. Maybe it could even OOM your node, if the original request was large enough.\n\nInstead of placing request contents directly into exception messages, could they instead just be logged?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}