[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/328674988","html_url":"https://github.com/elastic/elasticsearch/issues/26589#issuecomment-328674988","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26589","id":328674988,"node_id":"MDEyOklzc3VlQ29tbWVudDMyODY3NDk4OA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-09-11T22:18:22Z","updated_at":"2017-09-11T22:18:22Z","author_association":"MEMBER","body":"Refreshing from disk is not possible, due to how the keystore is loaded essentially as part of elasticsearch.yml (but from a secure source) when elasticsearch is started. Node settings are passed around and held onto all over the system during initialization. There is no mechanism to pass \"updated\" settings around, or what this would imply (for example, some node settings are used to construct service implementations inside the Node, so refreshing them would mean reconstructing running services, which themselves may be held onto by other services).\r\n\r\nAt the moment, there is not a good, secure solution for this.  For the time being, there is an undocumented system property, `es.allow_insecure_settings` which you can set to true, and will allow you to pass the access/secret key in the repository settings (which is inherently insecure since the cluster state is stored in plaintext on disk).  We do intend to come up with a better solution for this in the future, but there are not yet concrete plans for that.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/328913763","html_url":"https://github.com/elastic/elasticsearch/issues/26589#issuecomment-328913763","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26589","id":328913763,"node_id":"MDEyOklzc3VlQ29tbWVudDMyODkxMzc2Mw==","user":{"login":"scottsom","id":23276852,"node_id":"MDQ6VXNlcjIzMjc2ODUy","avatar_url":"https://avatars1.githubusercontent.com/u/23276852?v=4","gravatar_id":"","url":"https://api.github.com/users/scottsom","html_url":"https://github.com/scottsom","followers_url":"https://api.github.com/users/scottsom/followers","following_url":"https://api.github.com/users/scottsom/following{/other_user}","gists_url":"https://api.github.com/users/scottsom/gists{/gist_id}","starred_url":"https://api.github.com/users/scottsom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottsom/subscriptions","organizations_url":"https://api.github.com/users/scottsom/orgs","repos_url":"https://api.github.com/users/scottsom/repos","events_url":"https://api.github.com/users/scottsom/events{/privacy}","received_events_url":"https://api.github.com/users/scottsom/received_events","type":"User","site_admin":false},"created_at":"2017-09-12T16:48:03Z","updated_at":"2017-09-12T16:48:03Z","author_association":"CONTRIBUTOR","body":"Maybe I am missing something but an instance of `KeyStoreWrapper` is created during the bootstrap and then this same instance appears to be passed around (i.e. it is effectively a singleton). If this instance refreshed itself internally then new settings would be made visible on future reads.\r\n\r\nIs there a particular reason the setting values are read at construction time into member variables rather than reading from `SecureSettings` at time of use?\r\n\r\nFor example, in the repository-s3 case, instead of constructing the S3 client with an instance of `StaticCredentialsProvider`, the plugin could extend `AWSCredentialsProvider` to something like `SecureSettingsCredentialsProvider` that reads directly from the secure settings instance to pick up the latest keys without having to reconstruct anything.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329867790","html_url":"https://github.com/elastic/elasticsearch/issues/26589#issuecomment-329867790","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26589","id":329867790,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTg2Nzc5MA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-09-15T18:44:28Z","updated_at":"2017-09-15T18:44:28Z","author_association":"MEMBER","body":"> If this instance refreshed itself internally then new settings would be made visible on future reads\r\n\r\nIt is more complicated than that. The keystore is _closed_ after the node is initialized. We keep this stuff in memory for as little time as possible. The contract is plugins/services must read their secure settings during initialization.  S3 repository iterates over all the named clients, pulling creds/settings together, and then stores those in its own internal map of client settings, then looks up from there later when creating a new repository.\r\n\r\nWith secure settings, we wanted to start out simple, and that is why we went with a local keystore. But long term this is likely to be expanded in scope to store cluster settings securely as well. This would then enable repository settings to be marked as secure, and change how we store them in cluster state.  As I mentioned before, there is more work to come on secure settings. The insecure flag is only at temporary measure to allow faster update of certain secure settings (which is no worse than already existed in 5.x).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329869284","html_url":"https://github.com/elastic/elasticsearch/issues/26589#issuecomment-329869284","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26589","id":329869284,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTg2OTI4NA==","user":{"login":"scottsom","id":23276852,"node_id":"MDQ6VXNlcjIzMjc2ODUy","avatar_url":"https://avatars1.githubusercontent.com/u/23276852?v=4","gravatar_id":"","url":"https://api.github.com/users/scottsom","html_url":"https://github.com/scottsom","followers_url":"https://api.github.com/users/scottsom/followers","following_url":"https://api.github.com/users/scottsom/following{/other_user}","gists_url":"https://api.github.com/users/scottsom/gists{/gist_id}","starred_url":"https://api.github.com/users/scottsom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottsom/subscriptions","organizations_url":"https://api.github.com/users/scottsom/orgs","repos_url":"https://api.github.com/users/scottsom/repos","events_url":"https://api.github.com/users/scottsom/events{/privacy}","received_events_url":"https://api.github.com/users/scottsom/received_events","type":"User","site_admin":false},"created_at":"2017-09-15T18:51:11Z","updated_at":"2017-09-15T18:51:11Z","author_association":"CONTRIBUTOR","body":"Got it, thanks for the explanation.","performed_via_github_app":null}]