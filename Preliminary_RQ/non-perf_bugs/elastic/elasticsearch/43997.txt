{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43997","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43997/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43997/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43997/events","html_url":"https://github.com/elastic/elasticsearch/issues/43997","id":464461959,"node_id":"MDU6SXNzdWU0NjQ0NjE5NTk=","number":43997,"title":"Unable to use Elasticsearch-shards recovery tool (nullPointerException)","user":{"login":"craigsheppard","id":4712485,"node_id":"MDQ6VXNlcjQ3MTI0ODU=","avatar_url":"https://avatars0.githubusercontent.com/u/4712485?v=4","gravatar_id":"","url":"https://api.github.com/users/craigsheppard","html_url":"https://github.com/craigsheppard","followers_url":"https://api.github.com/users/craigsheppard/followers","following_url":"https://api.github.com/users/craigsheppard/following{/other_user}","gists_url":"https://api.github.com/users/craigsheppard/gists{/gist_id}","starred_url":"https://api.github.com/users/craigsheppard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigsheppard/subscriptions","organizations_url":"https://api.github.com/users/craigsheppard/orgs","repos_url":"https://api.github.com/users/craigsheppard/repos","events_url":"https://api.github.com/users/craigsheppard/events{/privacy}","received_events_url":"https://api.github.com/users/craigsheppard/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-07-05T05:01:06Z","updated_at":"2019-07-05T18:32:47Z","closed_at":"2019-07-05T09:07:07Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.2.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): `openjdk version \"1.8.0_212\"`\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): **docker sebp/elk image**\r\n`Linux 3133ef838a7a 4.9.125-linuxkit #1 SMP Fri Sep 7 08:20:28 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux`\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI have an index with corrupted translogs (primaries are ALLOCATION_FAILED due to translog EOF), and I'm trying to use the `elasticsearch-shards` tool to get my index up and running again, but it crashes when run with a `java.lang.NullPointerException`.\r\n\r\n**Steps to reproduce**:\r\nRunning the latest sebp/elk locally on an old machine (MacOS):\r\n\r\nI get a shell in my docker image: `bash -c \"clear && docker exec -it elk sh\"` then I kill elasticsearch, and then run:\r\n```\r\n# opt/elasticsearch/bin/elasticsearch-shard remove-corrupted-data --index environment --shard-id 0\r\n```\r\nand the output is:\r\n```\r\nfuture versions of Elasticsearch will require Java 11; your Java version from [/usr/lib/jvm/java-8-openjdk-amd64/jre] does not meet this requirement\r\nERROR StatusLogger No Log4j 2 configuration file found. Using default configuration (logging only errors to the console), or user programmatically provided configurations. Set system property 'log4j2.debug' to show Log4j 2 internal initialization logging. See https://logging.apache.org/log4j/2.x/manual/configuration.html for instructions on how to configure Log4j 2\r\n-----------------------------------------------------------------------\r\n\r\n    WARNING: Elasticsearch MUST be stopped before running this tool.\r\n\r\n  Please make a complete backup of your index before using this tool.\r\n\r\n-----------------------------------------------------------------------\r\nException in thread \"main\" java.lang.NullPointerException\r\n\tat org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.findAndProcessShardPath(RemoveCorruptedShardDataCommand.java:175)\r\n\tat org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.execute(RemoveCorruptedShardDataCommand.java:282)\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n\tat org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:77)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n\tat org.elasticsearch.cli.Command.main(Command.java:90)\r\n\tat org.elasticsearch.index.shard.ShardToolCli.main(ShardToolCli.java:35)\r\n# \r\n```\r\n\r\nNot sure where to go next - I'm ok with some data loss, but would like to recover this ASAP.\r\n\r\nThanks!\r\n\r\n","closed_by":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}