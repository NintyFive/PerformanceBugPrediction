{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14876","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14876/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14876/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14876/events","html_url":"https://github.com/elastic/elasticsearch/issues/14876","id":117994817,"node_id":"MDU6SXNzdWUxMTc5OTQ4MTc=","number":14876,"title":"Expired documents purge is not working after installing Shield Plugin","user":{"login":"vikasgithub","id":2128425,"node_id":"MDQ6VXNlcjIxMjg0MjU=","avatar_url":"https://avatars3.githubusercontent.com/u/2128425?v=4","gravatar_id":"","url":"https://api.github.com/users/vikasgithub","html_url":"https://github.com/vikasgithub","followers_url":"https://api.github.com/users/vikasgithub/followers","following_url":"https://api.github.com/users/vikasgithub/following{/other_user}","gists_url":"https://api.github.com/users/vikasgithub/gists{/gist_id}","starred_url":"https://api.github.com/users/vikasgithub/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vikasgithub/subscriptions","organizations_url":"https://api.github.com/users/vikasgithub/orgs","repos_url":"https://api.github.com/users/vikasgithub/repos","events_url":"https://api.github.com/users/vikasgithub/events{/privacy}","received_events_url":"https://api.github.com/users/vikasgithub/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-11-20T08:49:59Z","updated_at":"2018-09-14T09:02:39Z","closed_at":"2015-11-20T09:09:42Z","author_association":"NONE","active_lock_reason":null,"body":"I am trying out the ElasticSearch purge functionality for expired documents. It works fine when I do not have Shield plugin configured. But, as soon as I have Shield plugin configured, I get the following error\n\n2015-11-20 09:40:52,052][DEBUG][shield.authz.accesscontrol] [localhost] [test][4] couldn't locate the current request, field level security will only allow meta fields\n2015-11-20 09:40:52,053][DEBUG][indices.ttl              ] [localhost] [test][4] purging shard\n2015-11-20 09:40:52,054][WARN ][indices.ttl              ] [localhost] failed to purge\njava.lang.IllegalStateException: opting out of the query cache. current request can't be found\n       at org.elasticsearch.shield.authz.accesscontrol.OptOutQueryCache.doCache(OptOutQueryCache.java:62)\n       at org.apache.lucene.search.IndexSearcher.createWeight(IndexSearcher.java:853)\n       at org.apache.lucene.search.IndexSearcher.createNormalizedWeight(IndexSearcher.java:834)\n       at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:485)\n       at org.elasticsearch.indices.ttl.IndicesTTLService.purgeShards(IndicesTTLService.java:204)\n       at org.elasticsearch.indices.ttl.IndicesTTLService.access$000(IndicesTTLService.java:67)\n       at org.elasticsearch.indices.ttl.IndicesTTLService$PurgerThread.run(IndicesTTLService.java:140)\n\nI have username and password authentication enabled in Shield. I have enabled anonymous access as well. But, the error is same in all cases.\n\nI am using Java 7.0, ElasticSearch 2.0 and Shield 2.0.\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}