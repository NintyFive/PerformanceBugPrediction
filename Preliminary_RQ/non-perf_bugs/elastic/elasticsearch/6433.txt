{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6433","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6433/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6433/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6433/events","html_url":"https://github.com/elastic/elasticsearch/issues/6433","id":35162214,"node_id":"MDU6SXNzdWUzNTE2MjIxNA==","number":6433,"title":"Invoking analyzer at query time returning a parse exception","user":{"login":"zrdunlap","id":4873119,"node_id":"MDQ6VXNlcjQ4NzMxMTk=","avatar_url":"https://avatars3.githubusercontent.com/u/4873119?v=4","gravatar_id":"","url":"https://api.github.com/users/zrdunlap","html_url":"https://github.com/zrdunlap","followers_url":"https://api.github.com/users/zrdunlap/followers","following_url":"https://api.github.com/users/zrdunlap/following{/other_user}","gists_url":"https://api.github.com/users/zrdunlap/gists{/gist_id}","starred_url":"https://api.github.com/users/zrdunlap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zrdunlap/subscriptions","organizations_url":"https://api.github.com/users/zrdunlap/orgs","repos_url":"https://api.github.com/users/zrdunlap/repos","events_url":"https://api.github.com/users/zrdunlap/events{/privacy}","received_events_url":"https://api.github.com/users/zrdunlap/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-06-06T16:44:25Z","updated_at":"2014-09-08T00:25:08Z","closed_at":"2014-06-06T16:49:51Z","author_association":"NONE","active_lock_reason":null,"body":"We recently upgraded from 1.1.1 to 1.2.1 in our dev installation and have encountered an issue with calling analyzers at query time.\n\nIn 1.1.1 the following query:\n\n```\nGET /doc/_search\n{\n    \"query\" : {\n        \"match\" : {\n            \"title\" : \"colorado\"\n        },\n            \"analyzer\" : \"simple\"\n    }\n}\n```\n\nWorked fine. I could swap in any of the default analyzers and they all seemed to function as expected.\n\nIn 1.2.1. we're getting the following error:\n\n```\n{\n   \"error\": \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[fk7ZFddlSwKduZNP32kjoQ][im][4]: SearchParseException[[im][4]: query[title:colorado],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n    \\\"query\\\" : {\\n        \\\"match\\\" : {\\n            \\\"title\\\" : \\\"colorado\\\"\\n        },\\n            \\\"analyzer\\\" : \\\"simple\\\"\\n    }\\n}\\n]]]; nested: ElasticsearchParseException[Expected field name but got VALUE_STRING \\\"analyzer\\\"]; }{[fk7ZFddlSwKduZNP32kjoQ][im][3]: SearchParseException[[im][3]: query[title:colorado],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n    \\\"query\\\" : {\\n        \\\"match\\\" : {\\n            \\\"title\\\" : \\\"colorado\\\"\\n        },\\n            \\\"analyzer\\\" : \\\"simple\\\"\\n    }\\n}\\n]]]; nested: ElasticsearchParseException[Expected field name but got VALUE_STRING \\\"analyzer\\\"]; }{[fk7ZFddlSwKduZNP32kjoQ][im][2]: SearchParseException[[im][2]: query[title:colorado],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n    \\\"query\\\" : {\\n        \\\"match\\\" : {\\n            \\\"title\\\" : \\\"colorado\\\"\\n        },\\n            \\\"analyzer\\\" : \\\"simple\\\"\\n    }\\n}\\n]]]; nested: ElasticsearchParseException[Expected field name but got VALUE_STRING \\\"analyzer\\\"]; }{[fk7ZFddlSwKduZNP32kjoQ][im][1]: SearchParseException[[im][1]: query[title:colorado],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n    \\\"query\\\" : {\\n        \\\"match\\\" : {\\n            \\\"title\\\" : \\\"colorado\\\"\\n        },\\n            \\\"analyzer\\\" : \\\"simple\\\"\\n    }\\n}\\n]]]; nested: ElasticsearchParseException[Expected field name but got VALUE_STRING \\\"analyzer\\\"]; }{[fk7ZFddlSwKduZNP32kjoQ][im][0]: SearchParseException[[im][0]: query[title:colorado],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n    \\\"query\\\" : {\\n        \\\"match\\\" : {\\n            \\\"title\\\" : \\\"colorado\\\"\\n        },\\n            \\\"analyzer\\\" : \\\"simple\\\"\\n    }\\n}\\n]]]; nested: ElasticsearchParseException[Expected field name but got VALUE_STRING \\\"analyzer\\\"]; }]\",\n   \"status\": 400\n}\n```\n\n(Sorry for the length).\n\nWe did not make any changes to our settings or mappings, I even installed 1.2.1 on a different machine with no settings or mappings and just loaded our content set and get the same error. A clean install of 1.1.1 works as expected. \n\nAny help would be greatly appreciate.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}