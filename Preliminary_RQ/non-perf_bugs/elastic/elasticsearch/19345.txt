{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19345","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19345/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19345/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19345/events","html_url":"https://github.com/elastic/elasticsearch/issues/19345","id":164623624,"node_id":"MDU6SXNzdWUxNjQ2MjM2MjQ=","number":19345,"title":"Modify foreach processor to accept a single processor instead of collection","user":{"login":"BigFunger","id":12193008,"node_id":"MDQ6VXNlcjEyMTkzMDA4","avatar_url":"https://avatars1.githubusercontent.com/u/12193008?v=4","gravatar_id":"","url":"https://api.github.com/users/BigFunger","html_url":"https://github.com/BigFunger","followers_url":"https://api.github.com/users/BigFunger/followers","following_url":"https://api.github.com/users/BigFunger/following{/other_user}","gists_url":"https://api.github.com/users/BigFunger/gists{/gist_id}","starred_url":"https://api.github.com/users/BigFunger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BigFunger/subscriptions","organizations_url":"https://api.github.com/users/BigFunger/orgs","repos_url":"https://api.github.com/users/BigFunger/repos","events_url":"https://api.github.com/users/BigFunger/events{/privacy}","received_events_url":"https://api.github.com/users/BigFunger/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"assignees":[{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":13,"created_at":"2016-07-08T21:53:44Z","updated_at":"2017-01-20T00:18:39Z","closed_at":"2016-07-13T20:13:00Z","author_association":"NONE","active_lock_reason":null,"body":"@BigFunger, @Bargs, and @talevy had a discussion on Zoom earlier today, and this is one of the issues that we discussed.\n### Summary\n\nI would like to see the foreach processor reworked so that it only accepts a single processor instead of an array of processors as it does now.\n### Background\n\nI have been working on the UI for ingest pipelines, and specifically I have been trying to implement the foreach processor. The UI uses the verbose setting on the simulate API to report back to the user. \n\nThis way, when the user add or edits a processor, I can use the output from the parent processor as the input of the next and provide them with the data necessary to build out their processors. This is a problem in the context of the foreach processor because I can't provide the user with the input and output of each of the processors defined within the foreach processor.\n\nPer our discussion, it also make sense to structure the foreach processor in this way because it follows the patterns that have been established in the other processors. For example, if you want to apply an `uppercase` processor to more than one field in the document, you need to create one `uppercase` processor for each field you want to act on.\n### Example\n\nWith a pipeline definition of the following:\n\n``` json\n{\n  \"pipeline\": {\n    \"description\": \"\",\n    \"processors\": [\n      {\n        \"split\": {\n          \"tag\": \"processor_1\",\n          \"field\": \"message\",\n          \"separator\": \" \"\n        }\n      },\n      {\n        \"foreach\": {\n          \"tag\": \"processor_2\",\n          \"field\": \"message\",\n          \"processors\": [\n            {\n              \"uppercase\": {\n                \"tag\": \"processor_3\",\n                \"field\": \"_value\"\n              },\n              \"lowercase\": {\n                \"tag\": \"processor_4\",\n                \"field\": \"_value\"\n              },\n              \"uppercase\": {\n                \"tag\": \"processor_5\",\n                \"field\": \"_value\"\n              }\n            }\n          ]\n        }\n      }\n    ]\n  },\n  \"docs\": [\n    {\n      \"_source\": {\n        \"message\": \"these are the words of a sentence\"\n      }\n    }\n  ]\n}\n```\n\nI would expect the following output:\n\n``` json\n{\n  \"docs\": [\n    {\n      \"processor_results\": [\n        {\n          \"tag\": \"processor_1\",\n          \"doc\": {\n            \"_type\": \"_type\",\n            \"_id\": \"_id\",\n            \"_index\": \"_index\",\n            \"_source\": {\n              \"message\": [\n                \"these\",\n                \"are\",\n                \"the\",\n                \"words\",\n                \"of\",\n                \"a\",\n                \"sentence\"\n              ]\n            },\n            \"_ingest\": {\n              \"timestamp\": \"2016-07-06T21:27:14.585+0000\"\n            }\n          }\n        },\n        {\n          \"tag\": \"processor_3\",\n          \"doc\": {\n            \"_type\": \"_type\",\n            \"_id\": \"_id\",\n            \"_index\": \"_index\",\n            \"_source\": {\n              \"message\": [\n                \"THESE\",\n                \"ARE\",\n                \"THE\",\n                \"WORDS\",\n                \"OF\",\n                \"A\",\n                \"SENTENCE\"\n              ]\n            },\n            \"_ingest\": {\n              \"timestamp\": \"2016-07-06T21:27:14.585+0000\"\n            }\n          }\n        },\n        {\n          \"tag\": \"processor_4\",\n          \"doc\": {\n            \"_type\": \"_type\",\n            \"_id\": \"_id\",\n            \"_index\": \"_index\",\n            \"_source\": {\n              \"message\": [\n                \"these\",\n                \"are\",\n                \"the\",\n                \"words\",\n                \"of\",\n                \"a\",\n                \"sentence\"\n              ]\n            },\n            \"_ingest\": {\n              \"timestamp\": \"2016-07-06T21:27:14.585+0000\"\n            }\n          }\n        },\n        {\n          \"tag\": \"processor_5\",\n          \"doc\": {\n            \"_type\": \"_type\",\n            \"_id\": \"_id\",\n            \"_index\": \"_index\",\n            \"_source\": {\n              \"message\": [\n                \"THESE\",\n                \"ARE\",\n                \"THE\",\n                \"WORDS\",\n                \"OF\",\n                \"A\",\n                \"SENTENCE\"\n              ]\n            },\n            \"_ingest\": {\n              \"timestamp\": \"2016-07-06T21:27:14.585+0000\"\n            }\n          }\n        },\n        {\n          \"tag\": \"processor_2\",\n          \"doc\": {\n            \"_type\": \"_type\",\n            \"_id\": \"_id\",\n            \"_index\": \"_index\",\n            \"_source\": {\n              \"message\": [\n                \"THESE\",\n                \"ARE\",\n                \"THE\",\n                \"WORDS\",\n                \"OF\",\n                \"A\",\n                \"SENTENCE\"\n              ]\n            },\n            \"_ingest\": {\n              \"timestamp\": \"2016-07-06T21:27:14.585+0000\"\n            }\n          }\n        }\n      ]\n    }\n  ]\n}\n```\n\nInstead, I get this back:\n\n``` json\n{\n  \"docs\": [\n    {\n      \"processor_results\": [\n        {\n          \"tag\": \"processor_1\",\n          \"doc\": {\n            \"_id\": \"_id\",\n            \"_type\": \"_type\",\n            \"_index\": \"_index\",\n            \"_source\": {\n              \"message\": [\n                \"these\",\n                \"are\",\n                \"the\",\n                \"words\",\n                \"of\",\n                \"a\",\n                \"sentence\"\n              ]\n            },\n            \"_ingest\": {\n              \"timestamp\": \"2016-07-08T21:36:14.400+0000\"\n            }\n          }\n        },\n        {\n          \"tag\": \"processor_2\",\n          \"doc\": {\n            \"_id\": \"_id\",\n            \"_type\": \"_type\",\n            \"_index\": \"_index\",\n            \"_source\": {\n              \"message\": [\n                \"these\",\n                \"are\",\n                \"the\",\n                \"words\",\n                \"of\",\n                \"a\",\n                \"sentence\"\n              ]\n            },\n            \"_ingest\": {\n              \"timestamp\": \"2016-07-08T21:36:14.400+0000\"\n            }\n          }\n        }\n      ]\n    }\n  ]\n}\n```\n","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}