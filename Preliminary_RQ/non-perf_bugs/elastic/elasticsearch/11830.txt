{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11830","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11830/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11830/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11830/events","html_url":"https://github.com/elastic/elasticsearch/issues/11830","id":90414493,"node_id":"MDU6SXNzdWU5MDQxNDQ5Mw==","number":11830,"title":"[DOC] Multi-level nested query syntax, add more clarity in docs.","user":{"login":"RanadeepPolavarapu","id":7084995,"node_id":"MDQ6VXNlcjcwODQ5OTU=","avatar_url":"https://avatars1.githubusercontent.com/u/7084995?v=4","gravatar_id":"","url":"https://api.github.com/users/RanadeepPolavarapu","html_url":"https://github.com/RanadeepPolavarapu","followers_url":"https://api.github.com/users/RanadeepPolavarapu/followers","following_url":"https://api.github.com/users/RanadeepPolavarapu/following{/other_user}","gists_url":"https://api.github.com/users/RanadeepPolavarapu/gists{/gist_id}","starred_url":"https://api.github.com/users/RanadeepPolavarapu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RanadeepPolavarapu/subscriptions","organizations_url":"https://api.github.com/users/RanadeepPolavarapu/orgs","repos_url":"https://api.github.com/users/RanadeepPolavarapu/repos","events_url":"https://api.github.com/users/RanadeepPolavarapu/events{/privacy}","received_events_url":"https://api.github.com/users/RanadeepPolavarapu/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"assignees":[{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false}],"milestone":null,"comments":17,"created_at":"2015-06-23T15:11:00Z","updated_at":"2019-09-25T04:56:16Z","closed_at":"2019-09-25T04:56:16Z","author_association":"NONE","active_lock_reason":null,"body":"Nested query on one level is working great, but after the second level onwards (nesting) the query returns no results.\n\nHere is my example:\n\n```\n{\n    \"mappings\": {\n        \"customers\": {\n            \"properties\": {\n                \"lastUpdated\": {\n                    \"type\": \"long\"\n                },\n                \"isDeleted\": {\n                    \"type\": \"boolean\"\n                },\n                \"person\": {\n                    \"type\": \"nested\",\n                    \"properties\": {\n                        \"car\": {\n                            \"type\": \"nested\",\n                            \"properties\": {\n                                \"model\": {\n                                    \"type\": \"string\"\n                                },\n                                \"make\": {\n                                    \"type\": \"string\"\n                                }\n                            }\n                        },\n                        \"last_name\": {\n                            \"type\": \"string\"\n                        },\n                        \"first_name\": {\n                            \"type\": \"string\"\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\nMy documents:\n\n```\n{\n    \"person\": {\n        \"first_name\": \"Zach\",\n        \"last_name\": \"Foobar\",\n        \"car\": [\n            {\n                \"make\": \"Saturn\",\n                \"model\": \"SL\"\n            },\n            {\n                \"make\": \"Subaru\",\n                \"model\": \"Imprezza\"\n            }\n        ]\n    },\n    \"isDeleted\": false,\n    \"lastUpdated\": 1433257051959\n}\n\n{\n    \"person\": {\n        \"first_name\": \"Bob\",\n        \"last_name\": \"Doe\",\n        \"car\": [\n            {\n                \"make\": \"Saturn\",\n                \"model\": \"Imprezza\"\n            },\n            {\n                \"make\": \"Honda\",\n                \"model\": \"Accord\"\n            }\n        ]\n    },\n    \"isDeleted\": false,\n    \"lastUpdated\": 1433257051959\n}\n```\n\nLastly, my query and result:\n\n```\n{\n    \"query\": {\n        \"nested\": {\n            \"path\": \"person\",\n            \"query\": {\n                \"match\": {\n                    \"person.car.make\": \"Honda\"\n                }\n            },\n            \"inner_hits\": {}\n        }\n    }\n}\n\n{\n  \"took\": 1,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": 0,\n    \"max_score\": null,\n    \"hits\": []\n  }\n}\n```\n\n---\n\nEDIT: So, It seems that this query works, but not the one above. \n\n```\n{\n    \"query\": {\n        \"nested\": {\n            \"path\": \"person\",\n            \"query\": {\n                \"match\": {\n                    \"person.car.make\": \"Honda\"\n                }\n            },\n            \"inner_hits\": {}\n        }\n    }\n}\n```\n\nI would suggest adding more clarity in the docs for multi-level nested queries about the path and query path. The [doc](https://www.elastic.co/guide/en/elasticsearch/guide/current/nested-query.html)  for nested query should be enhance for multi-level nesting.\n","closed_by":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"performed_via_github_app":null}