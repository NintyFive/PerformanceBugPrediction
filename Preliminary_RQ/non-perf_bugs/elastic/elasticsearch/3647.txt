{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3647","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3647/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3647/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3647/events","html_url":"https://github.com/elastic/elasticsearch/issues/3647","id":19159215,"node_id":"MDU6SXNzdWUxOTE1OTIxNQ==","number":3647,"title":"Clients crashing with Bad file descriptor / Cannot assign requested address","user":{"login":"rb2k","id":9519,"node_id":"MDQ6VXNlcjk1MTk=","avatar_url":"https://avatars1.githubusercontent.com/u/9519?v=4","gravatar_id":"","url":"https://api.github.com/users/rb2k","html_url":"https://github.com/rb2k","followers_url":"https://api.github.com/users/rb2k/followers","following_url":"https://api.github.com/users/rb2k/following{/other_user}","gists_url":"https://api.github.com/users/rb2k/gists{/gist_id}","starred_url":"https://api.github.com/users/rb2k/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rb2k/subscriptions","organizations_url":"https://api.github.com/users/rb2k/orgs","repos_url":"https://api.github.com/users/rb2k/repos","events_url":"https://api.github.com/users/rb2k/events{/privacy}","received_events_url":"https://api.github.com/users/rb2k/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"assignees":[{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2013-09-08T11:07:30Z","updated_at":"2013-10-30T12:06:42Z","closed_at":"2013-10-30T12:06:42Z","author_association":"NONE","active_lock_reason":null,"body":"When doing a lot of small/fast requests (in this case head requests to document IDs, most of them resulting in a hit), Elasicsearch seems to crash in a way that makes all other programs die for a few seconds. After that, connections can seemingly be reestablished.\nSeeing as in this case, running a ruby script will kill a python script running in the background, I'd assume it's not a problem in the client implementations\n\n```\n# cat /etc/elasticsearch/elasticsearch.yml \nnetwork.host: 127.0.0.1\ncluster:\n  name: some-thing\npath:\n  logs: /var/log/elasticsearch\n  data: /home/somthing/elasticsearch\nindex:\n  number_of_shards: 1\n  number_of_replicas: 0\n  refresh_interval: 20s\n  cache:\n    field:\n      type: soft\nboostrap:\n  mlockall: true\nindices:\n  fielddata:\n    cache:\n      size: 30%\n```\n\n```\nVM name: Java HotSpot(TM) 64-Bit Server VM\nVM vendor: Oracle Corporation\nVM version: 23.25-b01\nUptime: 189 hours, 28 minutes, 4 seconds and 77 milliseconds\nJava version: 1.7.0_25\n```\n\n```\nHTTP & Transport\nHTTP address: inet[/127.0.0.1:9200]\nBound address: inet[/127.0.0.1:9200]\nPublish address: inet[/127.0.0.1:9200]\nTransport address: inet[/127.0.0.1:9300]\nBound address: inet[/127.0.0.1:9300]\nPublish address: inet[/127.0.0.1:9300]\n```\n\n```\nES version: 0.90.3\n```\n\nThese are the limits of ES:\n\n```\n# cat /proc/18426/limits \nLimit                     Soft Limit           Hard Limit           Units     \nMax cpu time              unlimited            unlimited            seconds   \nMax file size             unlimited            unlimited            bytes     \nMax data size             unlimited            unlimited            bytes     \nMax stack size            8388608              unlimited            bytes     \nMax core file size        0                    unlimited            bytes     \nMax resident set          unlimited            unlimited            bytes     \nMax processes             256606               256606               processes \nMax open files            65535                65535                files     \nMax locked memory         65536                65536                bytes     \nMax address space         unlimited            unlimited            bytes     \nMax file locks            unlimited            unlimited            locks     \nMax pending signals       256606               256606               signals   \nMax msgqueue size         819200               819200               bytes     \nMax nice priority         0                    0                    \nMax realtime priority     0                    0                    \nMax realtime timeout      unlimited            unlimited            us        \n```\n\nThis is the stacktrace from stretcher (ruby client):\n\n```\nFaraday::Error::ConnectionFailed: Bad file descriptor - Bad file descriptor (Errno::EBADF)\norg/jruby/RubyIO.java:2025 • close\ngems/excon-0.25.3/lib/excon/socket.rb:192 • connect\ngems/excon-0.25.3/lib/excon/socket.rb:174 • connect\norg/jruby/RubyArray.java:1617 • each\ngems/excon-0.25.3/lib/excon/socket.rb:152 • connect\ngems/excon-0.25.3/lib/excon/socket.rb:32 • initialize\ngems/excon-0.25.3/lib/excon/connection.rb:363 • socket\ngems/excon-0.25.3/lib/excon/connection.rb:105 • request_call\ngems/excon-0.25.3/lib/excon/middlewares/mock.rb:42 • request_call\ngems/excon-0.25.3/lib/excon/middlewares/instrumentor.rb:22 • request_call\ngems/excon-0.25.3/lib/excon/middlewares/base.rb:15 • request_call\ngems/excon-0.25.3/lib/excon/middlewares/base.rb:15 • request_call\ngems/excon-0.25.3/lib/excon/middlewares/base.rb:15 • request_call\ngems/excon-0.25.3/lib/excon/connection.rb:244 • request\ngems/faraday-0.8.8/lib/faraday/adapter/excon.rb:45 • call\ngems/faraday_middleware-0.9.0/lib/faraday_middleware/request/encode_json.rb:23 • call\ngems/faraday_middleware-0.9.0/lib/faraday_middleware/response_middleware.rb:30 • call\ngems/faraday-0.8.8/lib/faraday/response.rb:8 • call\ngems/stretcher-1.19.0/lib/stretcher/server.rb:219 • request\norg/jruby/ext/thread/Mutex.java:149 • synchronize\ngems/stretcher-1.19.0/lib/stretcher/server.rb:217 • request\ngems/stretcher-1.19.0/lib/stretcher/server.rb:155 • mget\ngems/stretcher-1.19.0/lib/stretcher/index.rb:74 • mget\n```\n\nThis is what esclient will look like:\n\n```\nTraceback (most recent call last):\n  File \"/usr/local/bin/esdump\", line 71, in <module>\n    scrollres = es.scroll(scroll_id)\n  File \"/usr/local/lib/python2.7/dist-packages/esclient.py\", line 251, in scroll\n    query_string_args=query_string_args, encode_json=False)\n  File \"/usr/local/lib/python2.7/dist-packages/esclient.py\", line 122, in send_request\n    self.last_response = requests.request(method.lower(), url, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/requests/api.py\", line 44, in request\n    return session.request(method=method, url=url, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/requests/sessions.py\", line 335, in request\n    resp = self.send(prep, **send_kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/requests/sessions.py\", line 438, in send\n    r = adapter.send(request, **kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/requests/adapters.py\", line 327, in send\n    raise ConnectionError(e)\nrequests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=9200): Max retries exceeded with url: /_search/scroll?scroll=10m (Caused by <class 'socket.error'>: [Errno 99] Cannot assign requested address)\n```\n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}