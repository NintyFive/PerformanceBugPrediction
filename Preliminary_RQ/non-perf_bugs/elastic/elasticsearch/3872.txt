{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3872","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3872/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3872/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3872/events","html_url":"https://github.com/elastic/elasticsearch/issues/3872","id":20800489,"node_id":"MDU6SXNzdWUyMDgwMDQ4OQ==","number":3872,"title":"inconsistent behavior and documentation(?) errors with function_score","user":{"login":"Xylakant","id":337823,"node_id":"MDQ6VXNlcjMzNzgyMw==","avatar_url":"https://avatars0.githubusercontent.com/u/337823?v=4","gravatar_id":"","url":"https://api.github.com/users/Xylakant","html_url":"https://github.com/Xylakant","followers_url":"https://api.github.com/users/Xylakant/followers","following_url":"https://api.github.com/users/Xylakant/following{/other_user}","gists_url":"https://api.github.com/users/Xylakant/gists{/gist_id}","starred_url":"https://api.github.com/users/Xylakant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xylakant/subscriptions","organizations_url":"https://api.github.com/users/Xylakant/orgs","repos_url":"https://api.github.com/users/Xylakant/repos","events_url":"https://api.github.com/users/Xylakant/events{/privacy}","received_events_url":"https://api.github.com/users/Xylakant/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":56772237,"node_id":"MDU6TGFiZWw1Njc3MjIzNw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.6","name":"v0.90.6","color":"e0e0e0","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"assignees":[{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2013-10-10T11:14:48Z","updated_at":"2013-10-31T17:55:19Z","closed_at":"2013-10-14T13:13:25Z","author_association":"NONE","active_lock_reason":null,"body":"Trying to use the new `function_score` query in 0.90.5 I stumbled across some errors. In a couple of cases the code does not work as documented.\n## boost_mode `multiply`\n\nUsing `\"boost_mode\": \"multiply\"` fails:\n\n```\n{\n    \"query\": {\n        \"function_score\": {\n            \"boost_mode\": \"multiply\",\n            \"query\": {\n                \"match\": {\n                    \"title\": \"elasticsearch\"\n                }\n            },\n            \"functions\": [\n                {\n                    \"gauss\": {\n                        \"date\": {\n                            \"scale\": \"4w\"\n                        }\n                    }\n                }\n            ]\n        }\n    }\n}\n```\n\nresult:\n\n```\nQueryParsingException[[psb-1.1] function_score illegal boost_mode [multiply]]\n```\n\n`\"boost_mode\": \"mult\"` works. However, `score_mode` just behaves the other way round:\n\n```\nQueryParsingException[[psb-1.1] function_score illegal score_mode [mult]];\n```\n## `boost` as decay_function\n\nBoth the blog post introducing the feature and the documentation propose a query along the lines of\n\n```\n\"query\": {\n  \"function_score\": {\n    \"query\": {\n      \"match\": { \"title\": \"elasticsearch\"}\n    },\n    \"functions\": [\n      { \"boost\":  1 },\n      {\n        \"gauss\": {\n          \"timestamp\": {\n            \"scale\": \"4w\"\n          }\n        }\n      }\n    ],\n    \"score_mode\": \"sum\"\n  }\n}\n```\n\nrespectively\n\n```\n\"function_score\": {\n    \"functions\": [\n        {\n            \"boost\": \"3\",\n            \"filter\": {...}\n        },\n        {\n            \"filter\": {...},\n            \"script_score\": {\n                \"params\": {\n                    \"param1\": 2,\n                    \"param2\": 3.1\n                },\n                \"script\": \"_score * doc['my_numeric_field'].value / pow(param1, param2)\"\n            }\n        }\n    ],\n    \"query\": {...},\n    \"score_mode\": \"first\"\n}\n```\n\nThe second sample is intended to provide a replacement for the `custom_filters_score_query`. However, the first example fails against 0.90.5 with the following trace:\n\n```\nParse Failure [Failed to parse source [{ \"query\": { \"function_score\": { \"query\": { \"match\": { \"title\": \"elasticsearch\" } }, \"functions\": [ { \"boost\": 1 }, { \"gauss\": { \"timestamp\": { \"scale\": \"4w\" } } } ], \"score_mode\": \"sum\" } } }]]]; nested: QueryParsingException[[psb-1.1] No function with the name [boost] is registered.]; }\n```\n\nI failed to figure out what's the right incantation to invoke `boost`.\n","closed_by":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"performed_via_github_app":null}