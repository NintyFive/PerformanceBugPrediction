{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42473","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42473/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42473/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42473/events","html_url":"https://github.com/elastic/elasticsearch/issues/42473","id":447860759,"node_id":"MDU6SXNzdWU0NDc4NjA3NTk=","number":42473,"title":"Empty index with completion suggesters returns null suggestions","user":{"login":"kylelyk","id":3401359,"node_id":"MDQ6VXNlcjM0MDEzNTk=","avatar_url":"https://avatars1.githubusercontent.com/u/3401359?v=4","gravatar_id":"","url":"https://api.github.com/users/kylelyk","html_url":"https://github.com/kylelyk","followers_url":"https://api.github.com/users/kylelyk/followers","following_url":"https://api.github.com/users/kylelyk/following{/other_user}","gists_url":"https://api.github.com/users/kylelyk/gists{/gist_id}","starred_url":"https://api.github.com/users/kylelyk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kylelyk/subscriptions","organizations_url":"https://api.github.com/users/kylelyk/orgs","repos_url":"https://api.github.com/users/kylelyk/repos","events_url":"https://api.github.com/users/kylelyk/events{/privacy}","received_events_url":"https://api.github.com/users/kylelyk/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"assignees":[{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-05-23T20:34:10Z","updated_at":"2019-06-12T13:41:42Z","closed_at":"2019-06-12T13:41:42Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 6.4.2\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: java 11.0.1 2018-10-16 LTS\r\n\r\n**OS version**: Darwin Kernel Version 18.2.0\r\n\r\nWhen searching completion suggestions on a new index with no documents added, a different response is returned from when searching on na index with no documents matching.\r\n\r\nAlso a side note is that the example `PUT music` call in the [docs](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters-completion.html) does not work.\r\n\r\n**Steps to reproduce**:\r\n\r\n```\r\nPUT music\r\n{\r\n    \"mappings\": {\r\n      \"_doc\": {\r\n        \"properties\" : {\r\n            \"suggest\" : {\r\n                \"type\" : \"completion\"\r\n            },\r\n            \"title\" : {\r\n                \"type\": \"keyword\"\r\n            }\r\n        }\r\n      }\r\n        \r\n    }\r\n}\r\n```\r\n\r\n```\r\nPOST music/_search?pretty\r\n{\r\n    \"suggest\": {\r\n        \"song-suggest\" : {\r\n            \"prefix\" : \"v\", \r\n            \"completion\" : { \r\n                \"field\" : \"suggest\" \r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nReturns:\r\n\r\n```\r\n{\r\n  \"took\": 0,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"skipped\": 0,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 0,\r\n    \"max_score\": 0,\r\n    \"hits\": []\r\n  }\r\n}\r\n```\r\n\r\n```\r\nPUT music/_doc/1?refresh\r\n{\r\n    \"suggest\" : [\r\n        {\r\n            \"input\": \"Nevermind\",\r\n            \"weight\" : 10\r\n        },\r\n        {\r\n            \"input\": \"Nirvana\",\r\n            \"weight\" : 3\r\n        }\r\n    ]\r\n}\r\n```\r\n\r\n```\r\nPOST music/_search?pretty\r\n{\r\n    \"suggest\": {\r\n        \"song-suggest\" : {\r\n            \"prefix\" : \"v\", \r\n            \"completion\" : { \r\n                \"field\" : \"suggest\" \r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nReturns \r\n\r\n```\r\n{\r\n  \"took\": 0,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"skipped\": 0,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 0,\r\n    \"max_score\": 0,\r\n    \"hits\": []\r\n  },\r\n  \"suggest\": {\r\n    \"song-suggest\": [\r\n      {\r\n        \"text\": \"v\",\r\n        \"offset\": 0,\r\n        \"length\": 1,\r\n        \"options\": []\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nThis is a problem since `SearchResponse.getSuggest()` in the JDK will return `null` in the first case and the proper `Suggest` object in the second case. I would expect it to always return `Suggest` object in both cases.","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}