{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3130","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3130/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3130/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3130/events","html_url":"https://github.com/elastic/elasticsearch/issues/3130","id":15119536,"node_id":"MDU6SXNzdWUxNTExOTUzNg==","number":3130,"title":"Elasticsearch not responding. Possible GC issue.","user":{"login":"astathopoulos","id":827828,"node_id":"MDQ6VXNlcjgyNzgyOA==","avatar_url":"https://avatars1.githubusercontent.com/u/827828?v=4","gravatar_id":"","url":"https://api.github.com/users/astathopoulos","html_url":"https://github.com/astathopoulos","followers_url":"https://api.github.com/users/astathopoulos/followers","following_url":"https://api.github.com/users/astathopoulos/following{/other_user}","gists_url":"https://api.github.com/users/astathopoulos/gists{/gist_id}","starred_url":"https://api.github.com/users/astathopoulos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astathopoulos/subscriptions","organizations_url":"https://api.github.com/users/astathopoulos/orgs","repos_url":"https://api.github.com/users/astathopoulos/repos","events_url":"https://api.github.com/users/astathopoulos/events{/privacy}","received_events_url":"https://api.github.com/users/astathopoulos/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"assignees":[{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2013-06-04T13:54:19Z","updated_at":"2013-06-25T08:00:12Z","closed_at":"2013-06-25T07:18:06Z","author_association":"NONE","active_lock_reason":null,"body":"I am trying to upgrade elasticsearch from 0.19.12 to 0.90.x. After upgrading elasticsearch on the workers of my testing environment I found out that elasticsearch server started to become unresponsive on every distinct worker. The workers are regular PCs with one elasticsearch instance with its own cluster name. They are not related at all.\n\nI managed to figure out that each of the elasticsearch instances were run out of heap memory.\n\nI wrote a script that does the same thing that the tests of our application perform to the elasticsearch server(creating the proper indexes before the start of the suite, performing some queries and truncating the contents of each index after each run).\n\nI compared the heap memory usage between the 0.19.12 and 0.90.1 versions with this script. I found out that in the case of the version 0.19.12, the garbage collector was applied and the heap memory was freed, and the server continued to run without any problem.\n\nBut in the case of 0.90.1, although the garbage collector was applied, the memory was not freed.\n\nI attach the screenshots of bigdesk for both versions and the script that I used for conducting this comparison.\n\n```\n#!/bin/bash\n\nwhile true; do\n\n  echo \"Deleting all indexes\"\n  curl -XDELETE 'http://localhost:9200/_all/?pretty' > /dev/null  2>&1\n\n  echo \"Creating index\"\n  curl -XPUT 'http://localhost:9200/test/?pretty' -d '{\n   \"index\" : true,\n   \"settings\": {\n     \"number_of_shards\" : 1\n   },\n   \"_default_\": {\n     \"include_in_all\" : true\n   },\n   \"mappings\" : {\n     \"blog_post\" : {\n       \"type\" : \"object\",\n       \"_all\" : {\"enabled\" : true },\n       \"_source\": {\"enabled\" : true, \"compress\" : true}\n     }\n   }\n  }' > /dev/null  2>&1\n\n  for i in {1..10}\n  do\n    echo \"Truncating $i times\"\n    curl -XDELETE 'http://localhost:9200/test/blog_post/_query?pretty' -d '{\n      \"match_all\" : {}\n    }' > /dev/null  2>&1\n\n    echo \"Refreshing $i times\"\n    curl -XPOST 'http://localhost:9200/test/_refresh?pretty' > /dev/null  2>&1\n  done\n\ndone\n```\n\nElasticsearch 0.19.12:\n![heap-memory-0-19-12](https://f.cloud.github.com/assets/827828/605783/f4e58206-cd1d-11e2-8b58-962d5b6790c8.png)\n\nElasticsearch 0.90.1:\n![heap-memory-0-90-1](https://f.cloud.github.com/assets/827828/605784/faecf986-cd1d-11e2-9cb8-0a030bdbea39.png)\n\nI have mentioned this issue at the google group of elasticsearch: [Elasticsearch becomes unresponsive after updating to 0.90.x](https://groups.google.com/forum/?fromgroups=#!topic/elasticsearch/yqhCO-NNOXs)\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}