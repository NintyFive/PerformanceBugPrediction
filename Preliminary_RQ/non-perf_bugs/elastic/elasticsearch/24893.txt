{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24893","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24893/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24893/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24893/events","html_url":"https://github.com/elastic/elasticsearch/issues/24893","id":231422952,"node_id":"MDU6SXNzdWUyMzE0MjI5NTI=","number":24893,"title":"Deprecate `insert_zero` (and thus `gap_policy`) on pipeline aggs","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":189346177,"node_id":"MDU6TGFiZWwxODkzNDYxNzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edeprecation","name":">deprecation","color":"ce18a7","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-05-25T18:39:28Z","updated_at":"2017-06-06T14:18:24Z","closed_at":"2017-06-06T14:18:24Z","author_association":"MEMBER","active_lock_reason":null,"body":"The `insert_zero` gap policy has bothered me for a long time, and a related discussion in #24747 made me think about it again.  Inserting zeros leads to all kinds of weird responses, like this:\r\n\r\n```json\r\n{\r\n  \"aggregations\": {\r\n    \"histo\": {\r\n      \"buckets\": [\r\n        {\r\n          \"key_as_string\": \"2015-01-03T00:00:00.000Z\",\r\n          \"key\": 1420243200000,\r\n          \"doc_count\": 1,\r\n          \"max1\": {\r\n            \"value\": 1\r\n          },\r\n          \"movavg\": {\r\n            \"value\": 1\r\n          }\r\n        },\r\n        {\r\n          \"key_as_string\": \"2015-01-04T00:00:00.000Z\",\r\n          \"key\": 1420329600000,\r\n          \"doc_count\": 1,\r\n          \"max1\": {\r\n            \"value\": null\r\n          },\r\n          \"movavg\": {\r\n            \"value\": 1\r\n          }\r\n        },\r\n        {\r\n          \"key_as_string\": \"2015-01-05T00:00:00.000Z\",\r\n          \"key\": 1420416000000,\r\n          \"doc_count\": 1,\r\n          \"max1\": {\r\n            \"value\": null\r\n          },\r\n          \"movavg\": {\r\n            \"value\": 0.6666666666666666\r\n          }\r\n        },\r\n        {\r\n          \"key_as_string\": \"2015-01-06T00:00:00.000Z\",\r\n          \"key\": 1420502400000,\r\n          \"doc_count\": 1,\r\n          \"max1\": {\r\n            \"value\": null\r\n          },\r\n          \"movavg\": {\r\n            \"value\": 0.3333333333333333\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nWhere the value is presented to the user as `null`, but the movavg magically keeps generating values.  This is at best confusing.  Philosophically, it's dangerous in that it's doctoring the data we return to the user.  For the same reasons I argued in #24747, if used as part of an \"analytics pipeline\", `insert_zeros` will generate unsound results because it's just making up data... and in an astoundingly unintelligent manner at that.\r\n\r\nI vote we deprecate `insert_zero` and by extension all of `gap_policy` immediately, and remove it at a later date.  This also has the nice benefit of simplifying the internal pipeline code a bit, since the gap_policy stuff is kinda kludgy anyway.\r\n\r\nI did a search through the issues and forums, and there's essentially no user discussion of the option being used (which is probably a good thing).\r\n\r\n/cc @colings86 @jpountz ","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}