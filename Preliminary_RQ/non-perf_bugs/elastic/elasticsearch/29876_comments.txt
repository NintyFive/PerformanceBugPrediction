[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385616785","html_url":"https://github.com/elastic/elasticsearch/issues/29876#issuecomment-385616785","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29876","id":385616785,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTYxNjc4NQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-05-01T07:33:05Z","updated_at":"2018-05-01T07:33:05Z","author_association":"CONTRIBUTOR","body":"This was fixed in #29059\r\n\r\nThe issue isn't actually due to roles.yml being missing, or even due to anonymous access, it's that the missing file means that the `anon` role doesn't exist on some of the nodes, and that means the user has inconsistent privileges across the nodes.\r\n\r\nX-Pack security requires that roles are consistent across nodes - things break quite horribly if you don't do that, as it means actions that work on 1 node fail when run on other nodes.\r\n\r\nIn this case, the REST request is sent to a node that has the role, and it then tries to execute `TransportNodesStatsAction` on the node that is missing the role. That fails because the user is not permitted  to perform that action on that node.\r\nThe Rest action assumed that each node would report back its file system info, but that doesn't happen if one of the nodes refuses to execute the action.\r\n\r\nFrom 6.3 onwards, the rest action will run correctly, but some rows will have only partial data if the relelvant node does not have the correct roles. ","performed_via_github_app":null}]