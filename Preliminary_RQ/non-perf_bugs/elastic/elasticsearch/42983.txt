{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983/events","html_url":"https://github.com/elastic/elasticsearch/issues/42983","id":453493242,"node_id":"MDU6SXNzdWU0NTM0OTMyNDI=","number":42983,"title":"Long time for elect new master after existing leader unavailable","user":{"login":"svagner","id":2765622,"node_id":"MDQ6VXNlcjI3NjU2MjI=","avatar_url":"https://avatars0.githubusercontent.com/u/2765622?v=4","gravatar_id":"","url":"https://api.github.com/users/svagner","html_url":"https://github.com/svagner","followers_url":"https://api.github.com/users/svagner/followers","following_url":"https://api.github.com/users/svagner/following{/other_user}","gists_url":"https://api.github.com/users/svagner/gists{/gist_id}","starred_url":"https://api.github.com/users/svagner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/svagner/subscriptions","organizations_url":"https://api.github.com/users/svagner/orgs","repos_url":"https://api.github.com/users/svagner/repos","events_url":"https://api.github.com/users/svagner/events{/privacy}","received_events_url":"https://api.github.com/users/svagner/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"assignees":[{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2019-06-07T12:40:07Z","updated_at":"2019-06-11T09:10:00Z","closed_at":"2019-06-11T09:09:59Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 7.0.1 (e4efcb5)\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: build 1.8.0_191-b12\r\n\r\n**OS version**: Linux masterv7-1003 3.10.0-957.12.2.el7.x86_64 #1 SMP Tue May 14 21:24:32 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**: \r\nLong time for elect new master when existed master became unavailable (> 1m)\r\nAlso weird record in logs:\r\nsourceNode={masterv7-1003}{**DJqWBwA4T9ebbdDBtIjwfQ**}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20}, targetNode={masterv7-1003}{**DJqWBwA4T9ebbdDBtIjwfQ**}{Rrs73W8nRKOcgeaZeadbdA}\r\nLooks like we try to connect to ourself...\r\n\r\n**Steps to reproduce**:\r\n\r\nWe have 5 master-eligible nodes:\r\n```\r\n10.198.26.193   3 27 0 0.01 0.03 0.05 mi - masterv7-1005\r\n10.197.180.144  5 50 3 0.50 0.17 0.09 mi - masterv7-1003\r\n10.197.26.30    4 27 0 0.00 0.02 0.05 mi - masterv7-1002\r\n10.197.217.168  8 27 0 0.03 0.03 0.05 mi - masterv7-1001\r\n10.197.179.107  7 27 0 0.00 0.03 0.06 mi * masterv7-1004\r\n```\r\n\r\nAll nodes are located in same local network: rtt:0.133/0.098\r\n\r\nrun command on masterv7-1004:\r\n```\r\necho c > /proc/sysrq-trigger\r\n```\r\n\r\nTime when cluster will elect new master and cluster became available > 1min. \r\n\r\n**logs**:\r\n```\r\n2019-06-07T13:00:33.657+02:00 masterv7-1003 elasticsearch[14510] failed to connect to node {masterv7-1004}{90fry9MjQjuXhkCFF8OkaA}{sKxWCTTIQfyhcDyd8dJwUg}{10.197.179.107}{10.197.179.107:9300}{ml.machine_memory=134836666368, ml.max_open_jobs=20, xpack.installed=true} (tried [1] times)\r\n2019-06-07T13:00:33.660+02:00 masterv7-1003 elasticsearch[14510] cluster state applier task [becoming candidate: onLeaderFailure] took [30s] which is above the warn threshold of 30s\r\n2019-06-07T13:00:36.136+02:00 masterv7-1003 elasticsearch[14510] master node changed {previous [], current [{masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20}]}, term: 31, version: 841, reason: Publication{term=31, version=841}\r\n2019-06-07T13:01:06.055+02:00 masterv7-1003 elasticsearch[14510] failed to join {masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20} with JoinRequest{sourceNode={masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20}, optionalJoin=Optional[Join{term=31, lastAcceptedTerm=29, lastAcceptedVersion=840, sourceNode={masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20}, targetNode={masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360,  xpack.installed=true, ml.max_open_jobs=20}}]}\r\n2019-06-07T13:01:06.055+02:00 masterv7-1003 elasticsearch[14510] failed to join {masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20} with JoinRequest{sourceNode={masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20}, optionalJoin=Optional[Join{term=31, lastAcceptedTerm=29, lastAcceptedVersion=840, sourceNode={masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20}, targetNode={masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20}}]}\r\n...\r\n2019-06-07T13:01:33.723+02:00 masterv7-1003 elasticsearch[14510] cluster state applier task [Publication{term=31, version=841}] took [57.5s] which is above the warn threshold of 30s\r\n2019-06-07T13:01:33.731+02:00 masterv7-1003 elasticsearch[14510] Received response for a request that has timed out, sent [87590ms] ago, timed out [27668ms] ago, action [internal:cluster/coordination/join], node [{masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20}], id [303]\r\n2019-06-07T13:01:33.732+02:00 masterv7-1003 elasticsearch[14510] cluster state update task [elected-as-master ([3] nodes joined)[{masterv7-1005}{Cz1NUYmESjW3NTz_tYE8ag}{rKALbvKfSPOko0P5Ktlelw}{10.198.26.193}{10.198.26.193:9300}{ml.machine_memory=134836662272, ml.max_open_jobs=20, xpack.installed=true} elect leader, {masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{ml.machine_memory=134835855360, xpack.installed=true, ml.max_open_jobs=20} elect leader, {masterv7-1001}{WQKwhB2aQkSl-SquZhfVdA}{kn3ADfzAQQ6CoPcw90eoMg}{10.197.217.168}{10.197.217.168:9300}{ml.machine_memory=134835867648, ml.max_open_jobs=20, xpack.installed=true} elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_]] took [1.4m] which is above the warn threshold of 30s\r\n2019-06-07T13:01:33.771+02:00 masterv7-1003 elasticsearch[14510] node-left[{masterv7-1004}{90fry9MjQjuXhkCFF8OkaA}{sKxWCTTIQfyhcDyd8dJwUg}{10.197.179.107}{10.197.179.107:9300}{ml.machine_memory=134836666368, ml.max_open_jobs=20, xpack.installed=true} disconnected], term: 31, version: 842, reason: removed {{masterv7-1004}{90fry9MjQjuXhkCFF8OkaA}{sKxWCTTIQfyhcDyd8dJwUg}{10.197.179.107}{10.197.179.107:9300}{ml.machine_memory=134836666368, ml.max_open_jobs=20, xpack.installed=true},}\r\n2019-06-07T13:02:03.777+02:00 masterv7-1003 elasticsearch[14510] removed {{masterv7-1004}{90fry9MjQjuXhkCFF8OkaA}{sKxWCTTIQfyhcDyd8dJwUg}{10.197.179.107}{10.197.179.107:9300}{ml.machine_memory=134836666368, ml.max_open_jobs=20, xpack.installed=true},}, term: 31, version: 842, reason: Publication{term=31, version=842}\r\n2019-06-07T13:02:03.784+02:00 masterv7-1003 elasticsearch[14510] cluster state update task [node-left[{masterv7-1004}{90fry9MjQjuXhkCFF8OkaA}{sKxWCTTIQfyhcDyd8dJwUg}{10.197.179.107}{10.197.179.107:9300}{ml.machine_memory=134836666368, ml.max_open_jobs=20, xpack.installed=true} disconnected]] took [30s] which is above the warn threshold of 30s\r\n```","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}