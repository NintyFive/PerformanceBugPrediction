[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294367877","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294367877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":294367877,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDM2Nzg3Nw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-04-16T18:55:16Z","updated_at":"2017-04-16T18:55:16Z","author_association":"CONTRIBUTOR","body":"Lack of a script_stack element is certainly a bug. NPE might be yours. I\nhave a few more script_stack issues to look at next week, so I'm happy to\nlook I to this one. Any chance you could figure out if the document that\ncauses this exception has a bill id.keyword field?\n\nOn Sun, Apr 16, 2017, 2:08 PM sumitsaxena21 <notifications@github.com>\nwrote:\n\n> *Elasticsearch version*: 5.1\n>\n> *Plugins installed*: [painless]\n>\n> *JVM version*: 1.8\n>\n> *OS version*: AWS Elasticsearch\n>\n> *Description of the problem including expected versus actual behavior*:\n>\n> There is a bug in painless script. If sort field is not present in all the\n> documents then it is throwing null pointer exception while executing below\n> script\n> \"aggregations\" : {\n> \"id_script_keyword\" : {\n> \"max\" : {\n> \"script\" : {\n> \"inline\" : \"Double.parseDouble(doc['id.keyword'].value)\",\n> \"lang\" : \"painless\"\n> }\n> }\n> I have 100 documents and few documents don't have id field.\n> expected : normal sort behavior.\n> actual : null pointer exception.\n>\n> *Steps to reproduce*:\n>\n>    1. put a document in elaticsearch without id field.\n>    2. run\n>    \"aggregations\" : {\n>    \"id_script_keyword\" : {\n>    \"max\" : {\n>    \"script\" : {\n>    \"inline\" : \"Double.parseDouble(doc['id.keyword'].value)\",\n>    \"lang\" : \"painless\"\n>    }\n>    }\n>    3.\n>\n> *Provide logs (if relevant)*:\n> {\n> \"took\": 6,\n> \"timed_out\": false,\n> \"_shards\": {\n> \"total\": 5,\n> \"successful\": 4,\n> \"failed\": 1,\n> \"failures\": [\n> {\n> \"shard\": 0,\n> \"index\": \"merch-ecs_products-v2-en_us_g1\",\n> \"node\": \"SxJrPFRHSOGEy5Rh9QiOTg\",\n> \"reason\": {\n> \"type\": \"script_exception\",\n> \"reason\": \"runtime error\",\n> \"caused_by\": {\n> \"type\": \"null_pointer_exception\",\n> \"reason\": null\n> },\n> \"script_stack\": [],\n> \"script\": \"Double.parseDouble(doc['id.keyword'].value)\",\n> \"lang\": \"painless\"\n> }\n> }\n> ]\n> },\n> \"hits\": {\n> \"total\": 0,\n> \"max_score\": 0,\n> \"hits\": []\n> },\n> \"aggregations\": {\n> \"rollupIdentifier\": {\n> \"doc_count_error_upper_bound\": 0,\n> \"sum_other_doc_count\": 0,\n> \"buckets\": []\n> }\n> }\n> }\n>\n> *Describe the feature*:\n>\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/24125>, or mute the\n> thread\n> <https://github.com/notifications/unsubscribe-auth/AANLov3qun2TtIJVm-nNeCCeP6csOAbHks5rwlkcgaJpZM4M-sGn>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294506198","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294506198","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":294506198,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDUwNjE5OA==","user":{"login":"sumitsaxena21","id":27636615,"node_id":"MDQ6VXNlcjI3NjM2NjE1","avatar_url":"https://avatars2.githubusercontent.com/u/27636615?v=4","gravatar_id":"","url":"https://api.github.com/users/sumitsaxena21","html_url":"https://github.com/sumitsaxena21","followers_url":"https://api.github.com/users/sumitsaxena21/followers","following_url":"https://api.github.com/users/sumitsaxena21/following{/other_user}","gists_url":"https://api.github.com/users/sumitsaxena21/gists{/gist_id}","starred_url":"https://api.github.com/users/sumitsaxena21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sumitsaxena21/subscriptions","organizations_url":"https://api.github.com/users/sumitsaxena21/orgs","repos_url":"https://api.github.com/users/sumitsaxena21/repos","events_url":"https://api.github.com/users/sumitsaxena21/events{/privacy}","received_events_url":"https://api.github.com/users/sumitsaxena21/received_events","type":"User","site_admin":false},"created_at":"2017-04-17T15:13:27Z","updated_at":"2017-04-17T15:13:27Z","author_association":"NONE","body":"Hi,\nThe document that causes this exception, doesn't have id field in it.\n\nNPE might be yours.  \"reason\": {\n> \"type\": \"script_exception\",\n> \"reason\": \"runtime error\",\n> \"caused_by\": {\n> \"type\": \"null_pointer_exception\",\n> \"reason\": null\n> },\n\nThis is coming right from curl, my application doesn't do anything as I am\nusing curl command to execute the aggregation using script for bucket sort.\n\nThanks\nSumit\n\nOn Sun, Apr 16, 2017 at 11:56 AM, Nik Everett <notifications@github.com>\nwrote:\n\n> Lack of a script_stack element is certainly a bug. NPE might be yours. I\n> have a few more script_stack issues to look at next week, so I'm happy to\n> look I to this one. Any chance you could figure out if the document that\n> causes this exception has a bill id.keyword field?\n>\n> On Sun, Apr 16, 2017, 2:08 PM sumitsaxena21 <notifications@github.com>\n> wrote:\n>\n> > *Elasticsearch version*: 5.1\n> >\n> > *Plugins installed*: [painless]\n> >\n> > *JVM version*: 1.8\n> >\n> > *OS version*: AWS Elasticsearch\n> >\n> > *Description of the problem including expected versus actual behavior*:\n> >\n> > There is a bug in painless script. If sort field is not present in all\n> the\n> > documents then it is throwing null pointer exception while executing\n> below\n> > script\n> > \"aggregations\" : {\n> > \"id_script_keyword\" : {\n> > \"max\" : {\n> > \"script\" : {\n> > \"inline\" : \"Double.parseDouble(doc['id.keyword'].value)\",\n> > \"lang\" : \"painless\"\n> > }\n> > }\n> > I have 100 documents and few documents don't have id field.\n> > expected : normal sort behavior.\n> > actual : null pointer exception.\n> >\n> > *Steps to reproduce*:\n> >\n> > 1. put a document in elaticsearch without id field.\n> > 2. run\n> > \"aggregations\" : {\n> > \"id_script_keyword\" : {\n> > \"max\" : {\n> > \"script\" : {\n> > \"inline\" : \"Double.parseDouble(doc['id.keyword'].value)\",\n> > \"lang\" : \"painless\"\n> > }\n> > }\n> > 3.\n> >\n> > *Provide logs (if relevant)*:\n> > {\n> > \"took\": 6,\n> > \"timed_out\": false,\n> > \"_shards\": {\n> > \"total\": 5,\n> > \"successful\": 4,\n> > \"failed\": 1,\n> > \"failures\": [\n> > {\n> > \"shard\": 0,\n> > \"index\": \"merch-ecs_products-v2-en_us_g1\",\n> > \"node\": \"SxJrPFRHSOGEy5Rh9QiOTg\",\n> > \"reason\": {\n> > \"type\": \"script_exception\",\n> > \"reason\": \"runtime error\",\n> > \"caused_by\": {\n> > \"type\": \"null_pointer_exception\",\n> > \"reason\": null\n> > },\n> > \"script_stack\": [],\n> > \"script\": \"Double.parseDouble(doc['id.keyword'].value)\",\n> > \"lang\": \"painless\"\n> > }\n> > }\n> > ]\n> > },\n> > \"hits\": {\n> > \"total\": 0,\n> > \"max_score\": 0,\n> > \"hits\": []\n> > },\n> > \"aggregations\": {\n> > \"rollupIdentifier\": {\n> > \"doc_count_error_upper_bound\": 0,\n> > \"sum_other_doc_count\": 0,\n> > \"buckets\": []\n> > }\n> > }\n> > }\n> >\n> > *Describe the feature*:\n> >\n> > —\n> > You are receiving this because you are subscribed to this thread.\n> > Reply to this email directly, view it on GitHub\n> > <https://github.com/elastic/elasticsearch/issues/24125>, or mute the\n> > thread\n> > <https://github.com/notifications/unsubscribe-auth/AANLov3qun2TtIJVm-\n> nNeCCeP6csOAbHks5rwlkcgaJpZM4M-sGn>\n> > .\n> >\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294367877>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AaWzhzpk9MZ5uAYi5b8eqsJ0jTRLqkynks5rwmRcgaJpZM4M-sGn>\n> .\n>\n\n\n\n-- \nThanks\nSumit Saxena\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294516861","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294516861","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":294516861,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDUxNjg2MQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-04-17T16:05:33Z","updated_at":"2017-04-17T16:05:33Z","author_association":"CONTRIBUTOR","body":"Your script is throwing the NPE. I think you can work around it by checking\nthe null first. Even when I fix the bug your script still won't work\nbecause it expects all documents to have an id.\n\nOn Mon, Apr 17, 2017, 11:13 AM sumitsaxena21 <notifications@github.com>\nwrote:\n\n> Hi,\n> The document that causes this exception, doesn't have id field in it.\n>\n> NPE might be yours. \"reason\": {\n> > \"type\": \"script_exception\",\n> > \"reason\": \"runtime error\",\n> > \"caused_by\": {\n> > \"type\": \"null_pointer_exception\",\n> > \"reason\": null\n> > },\n>\n> This is coming right from curl, my application doesn't do anything as I am\n> using curl command to execute the aggregation using script for bucket sort.\n>\n> Thanks\n> Sumit\n>\n> On Sun, Apr 16, 2017 at 11:56 AM, Nik Everett <notifications@github.com>\n> wrote:\n>\n> > Lack of a script_stack element is certainly a bug. NPE might be yours. I\n> > have a few more script_stack issues to look at next week, so I'm happy to\n> > look I to this one. Any chance you could figure out if the document that\n> > causes this exception has a bill id.keyword field?\n> >\n> > On Sun, Apr 16, 2017, 2:08 PM sumitsaxena21 <notifications@github.com>\n> > wrote:\n> >\n> > > *Elasticsearch version*: 5.1\n> > >\n> > > *Plugins installed*: [painless]\n> > >\n> > > *JVM version*: 1.8\n> > >\n> > > *OS version*: AWS Elasticsearch\n> > >\n> > > *Description of the problem including expected versus actual behavior*:\n> > >\n> > > There is a bug in painless script. If sort field is not present in all\n> > the\n> > > documents then it is throwing null pointer exception while executing\n> > below\n> > > script\n> > > \"aggregations\" : {\n> > > \"id_script_keyword\" : {\n> > > \"max\" : {\n> > > \"script\" : {\n> > > \"inline\" : \"Double.parseDouble(doc['id.keyword'].value)\",\n> > > \"lang\" : \"painless\"\n> > > }\n> > > }\n> > > I have 100 documents and few documents don't have id field.\n> > > expected : normal sort behavior.\n> > > actual : null pointer exception.\n> > >\n> > > *Steps to reproduce*:\n> > >\n> > > 1. put a document in elaticsearch without id field.\n> > > 2. run\n> > > \"aggregations\" : {\n> > > \"id_script_keyword\" : {\n> > > \"max\" : {\n> > > \"script\" : {\n> > > \"inline\" : \"Double.parseDouble(doc['id.keyword'].value)\",\n> > > \"lang\" : \"painless\"\n> > > }\n> > > }\n> > > 3.\n> > >\n> > > *Provide logs (if relevant)*:\n> > > {\n> > > \"took\": 6,\n> > > \"timed_out\": false,\n> > > \"_shards\": {\n> > > \"total\": 5,\n> > > \"successful\": 4,\n> > > \"failed\": 1,\n> > > \"failures\": [\n> > > {\n> > > \"shard\": 0,\n> > > \"index\": \"merch-ecs_products-v2-en_us_g1\",\n> > > \"node\": \"SxJrPFRHSOGEy5Rh9QiOTg\",\n> > > \"reason\": {\n> > > \"type\": \"script_exception\",\n> > > \"reason\": \"runtime error\",\n> > > \"caused_by\": {\n> > > \"type\": \"null_pointer_exception\",\n> > > \"reason\": null\n> > > },\n> > > \"script_stack\": [],\n> > > \"script\": \"Double.parseDouble(doc['id.keyword'].value)\",\n> > > \"lang\": \"painless\"\n> > > }\n> > > }\n> > > ]\n> > > },\n> > > \"hits\": {\n> > > \"total\": 0,\n> > > \"max_score\": 0,\n> > > \"hits\": []\n> > > },\n> > > \"aggregations\": {\n> > > \"rollupIdentifier\": {\n> > > \"doc_count_error_upper_bound\": 0,\n> > > \"sum_other_doc_count\": 0,\n> > > \"buckets\": []\n> > > }\n> > > }\n> > > }\n> > >\n> > > *Describe the feature*:\n> > >\n> > > —\n> > > You are receiving this because you are subscribed to this thread.\n> > > Reply to this email directly, view it on GitHub\n> > > <https://github.com/elastic/elasticsearch/issues/24125>, or mute the\n> > > thread\n> > > <https://github.com/notifications/unsubscribe-auth/AANLov3qun2TtIJVm-\n> > nNeCCeP6csOAbHks5rwlkcgaJpZM4M-sGn>\n> > > .\n> > >\n> >\n> > —\n> > You are receiving this because you authored the thread.\n> > Reply to this email directly, view it on GitHub\n> > <\n> https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294367877\n> >,\n> > or mute the thread\n> > <\n> https://github.com/notifications/unsubscribe-auth/AaWzhzpk9MZ5uAYi5b8eqsJ0jTRLqkynks5rwmRcgaJpZM4M-sGn\n> >\n> > .\n> >\n>\n>\n>\n> --\n> Thanks\n> Sumit Saxena\n>\n> —\n> You are receiving this because you commented.\n>\n>\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294506198>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AANLom_8RgAOta_RSrByVZ8TlOjWoNlcks5rw4GdgaJpZM4M-sGn>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294981940","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294981940","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":294981940,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDk4MTk0MA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-04-18T21:03:07Z","updated_at":"2017-04-18T21:03:07Z","author_association":"CONTRIBUTOR","body":"@sumitsaxena21 your words talk about a sort but your example is an aggregation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294982514","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294982514","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":294982514,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDk4MjUxNA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-04-18T21:05:36Z","updated_at":"2017-04-18T21:05:36Z","author_association":"CONTRIBUTOR","body":"Ah, bucket sort script.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294984136","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-294984136","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":294984136,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDk4NDEzNg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-04-18T21:12:21Z","updated_at":"2017-04-18T21:12:21Z","author_association":"CONTRIBUTOR","body":"OK. I still can't reproduce this. Here is the script I'm using:\r\n```\r\nDELETE /ledger\r\n\r\nPUT /ledger\r\n{\r\n  \"settings\": {\r\n    \"number_of_shards\": 2,\r\n    \"number_of_replicas\": 1\r\n  },\r\n  \"mappings\": {\r\n    \"doc\": {\r\n      \"properties\": {\r\n        \"id\": {\r\n          \"type\": \"text\",\r\n          \"fields\": {\r\n            \"keyword\": {\r\n              \"type\": \"keyword\"\r\n            }\r\n          }\r\n        },\r\n        \"type\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"amount\": {\r\n          \"type\": \"double\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST /ledger/doc/_bulk?refresh\r\n{\"index\":{}}\r\n{\"id\": \"213\", \"date\": \"2015/01/01 00:00:00\", \"amount\": 200, \"type\": \"sale\", \"description\": \"something\"}\r\n{\"index\":{}}\r\n{\"date\": \"2015/01/01 00:00:00\", \"amount\": 10, \"type\": \"expense\", \"decription\": \"another thing\"}\r\n\r\nPOST /ledger/_search\r\n{\r\n  \"aggs\": {\r\n    \"date\": {\r\n      \"terms\": {\r\n        \"field\": \"date\",\r\n        \"order\": {\r\n          \"id_script_keyword\": \"desc\"\r\n        }\r\n      },\r\n      \"aggs\": {\r\n        \"id_script_keyword\": {\r\n          \"max\": {\r\n            \"script\": {\r\n              \"inline\": \"Double.parseDouble(doc['id.keyword'].value)\",\r\n              \"lang\": \"painless\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nI get a null pointer exception all right, but it has an obvious script_stack:\r\n\r\n```\r\n\"failures\": [\r\n      {\r\n        \"shard\": 1,\r\n        \"index\": \"ledger\",\r\n        \"node\": \"u-u9FSzOSbaGHGfCqYmY6A\",\r\n        \"reason\": {\r\n          \"type\": \"script_exception\",\r\n          \"reason\": \"runtime error\",\r\n          \"caused_by\": {\r\n            \"type\": \"null_pointer_exception\",\r\n            \"reason\": null\r\n          },\r\n          \"script_stack\": [\r\n            \"sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1838)\",\r\n            \"sun.misc.FloatingDecimal.parseDouble(FloatingDecimal.java:110)\",\r\n            \"java.lang.Double.parseDouble(Double.java:538)\",\r\n            \"Double.parseDouble(doc['id.keyword'].value)\",\r\n            \"                                    ^---- HERE\"\r\n          ],\r\n          \"script\": \"Double.parseDouble(doc['id.keyword'].value)\",\r\n          \"lang\": \"painless\"\r\n        }\r\n      }\r\n```\r\n\r\nAs far as I can tell this is working perfectly. If you want to handle null in the script that is up to you. Like this:\r\n```\r\nPOST /ledger/_search\r\n{\r\n  \"aggs\": {\r\n    \"date\": {\r\n      \"terms\": {\r\n        \"field\": \"date\",\r\n        \"order\": {\r\n          \"id_script_keyword\": \"desc\"\r\n        }\r\n      },\r\n      \"aggs\": {\r\n        \"id_script_keyword\": {\r\n          \"max\": {\r\n            \"script\": {\r\n              \"inline\": \"doc['id.keyword'].empty ? 0 : Double.parseDouble(doc['id.keyword'].value)\",\r\n              \"lang\": \"painless\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nCan you put together a complete reproduction, like the one I pasted in the top of this comment? Without something like that I'm just guessing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/295027809","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-295027809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":295027809,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NTAyNzgwOQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-04-19T00:45:21Z","updated_at":"2017-04-19T00:45:21Z","author_association":"CONTRIBUTOR","body":"I wonder if this is http://jawspeak.com/2010/05/26/hotspot-caused-exceptions-to-lose-their-stack-traces-in-production-and-the-fix/","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303959737","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-303959737","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":303959737,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzk1OTczNw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-05-25T08:58:06Z","updated_at":"2017-05-25T08:58:06Z","author_association":"MEMBER","body":"No further feedback, closing. If you manage to create a reproduction script please post it here and we can reopen","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375874356","html_url":"https://github.com/elastic/elasticsearch/issues/24125#issuecomment-375874356","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24125","id":375874356,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTg3NDM1Ng==","user":{"login":"bilalvdemir","id":18368833,"node_id":"MDQ6VXNlcjE4MzY4ODMz","avatar_url":"https://avatars3.githubusercontent.com/u/18368833?v=4","gravatar_id":"","url":"https://api.github.com/users/bilalvdemir","html_url":"https://github.com/bilalvdemir","followers_url":"https://api.github.com/users/bilalvdemir/followers","following_url":"https://api.github.com/users/bilalvdemir/following{/other_user}","gists_url":"https://api.github.com/users/bilalvdemir/gists{/gist_id}","starred_url":"https://api.github.com/users/bilalvdemir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bilalvdemir/subscriptions","organizations_url":"https://api.github.com/users/bilalvdemir/orgs","repos_url":"https://api.github.com/users/bilalvdemir/repos","events_url":"https://api.github.com/users/bilalvdemir/events{/privacy}","received_events_url":"https://api.github.com/users/bilalvdemir/received_events","type":"User","site_admin":false},"created_at":"2018-03-24T11:17:34Z","updated_at":"2018-03-24T11:19:59Z","author_association":"NONE","body":"With Elasticsearch 5.x and gt verison we can read all fields with script. For example:\r\n\r\n````\r\nGET _search\r\n{\r\n  \"size\": 0,\r\n  \"query\": {\r\n    \"match\": {\r\n      \"description\": \"test\"\r\n    }\r\n  },\r\n  \"_source\": {\r\n    \"excludes\": [],\r\n    \"includes\": [\r\n      \"detail.name\",\r\n      \"data.timestamp\",\r\n      \"data.o3\"\r\n    ]\r\n  },\r\n  \"aggs\": {\r\n    \"custom\": {\r\n      \"sum\": {\r\n        \"script\": \"((params._source.detail.name==null) ? 0 : (params._source.detail.name.toString().length())) + ((params._source.data.timestamp==null) ? 0 : (params._source.data.timestamp.toString().length()))\"\r\n      }\r\n    }\r\n  }\r\n}\r\n````\r\n\r\nFor nested feilds you must use nested conditions.\r\n`\"(params._source.x==null) ? 0 : ( (params._source.x.y==null) ? 0 : (params._source.x.y.length()) ))\"`\r\n\r\n@sumitsaxena21 @nik9000 ","performed_via_github_app":null}]