{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10968","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10968/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10968/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10968/events","html_url":"https://github.com/elastic/elasticsearch/issues/10968","id":73143893,"node_id":"MDU6SXNzdWU3MzE0Mzg5Mw==","number":10968,"title":"[openbsd] shield doesn't work on OpenBSD, probably because of blowfish","user":{"login":"jirib","id":46245,"node_id":"MDQ6VXNlcjQ2MjQ1","avatar_url":"https://avatars2.githubusercontent.com/u/46245?v=4","gravatar_id":"","url":"https://api.github.com/users/jirib","html_url":"https://github.com/jirib","followers_url":"https://api.github.com/users/jirib/followers","following_url":"https://api.github.com/users/jirib/following{/other_user}","gists_url":"https://api.github.com/users/jirib/gists{/gist_id}","starred_url":"https://api.github.com/users/jirib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jirib/subscriptions","organizations_url":"https://api.github.com/users/jirib/orgs","repos_url":"https://api.github.com/users/jirib/repos","events_url":"https://api.github.com/users/jirib/events{/privacy}","received_events_url":"https://api.github.com/users/jirib/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"assignees":[{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2015-05-04T22:20:25Z","updated_at":"2015-05-05T11:12:56Z","closed_at":"2015-05-05T11:06:18Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\nI'm trying to learn elasticsearch and I tried shield plugin with ES 1.5.1 on OpenBSD 5.7 snapshot amd64.\n\n```\n# ./bin/elasticsearch -v     \nVersion: 1.5.1, Build: 5e38401/2015-04-09T13:41:35Z, JVM: 1.7.0_71\n# find plugins/shield/           \nplugins/shield/\nplugins/shield/LICENSE.txt\nplugins/shield/NOTICE.txt\nplugins/shield/config\nplugins/shield/commons-codec-1.10.jar\nplugins/shield/automaton-1.11-8.jar\nplugins/shield/unboundid-ldapsdk-2.3.8.jar\nplugins/shield/elasticsearch-shield-1.2.1.jar\n```\n\nIt could be related to blowfish implementation but I'm not sure. Let's compare shields hashed passwords and OpenBSD blowfish hashed passwords:\n\n```\n# cat config/shield/users                                                                                                                                                                                          \nes_admin:$2a$10$PQHKemNIRLEz.qWIPNQSbe0y2Yp/B7bIfgdJtjJo5r9g8VBtMosk2\n# \nI-search: \n# cat config/shield/users \n# grep jirib /etc/master.passwd  \njirib:$2b$10$m.........anonymized....:1000:1000:staff:0:0:jirib:/home/jirib:/bin/ksh\n```\n\nIIRC there was an issue with blowfish $2a passwords, here is what OpenBSD people wrote:\n\n> Solar found a bug in the OpenBSD implementation of bcrypt when hashing long passwords. The length is stored in an unsigned char type, which will overflow and wrap at 256. Although we consider the existence of affected hashes very rare, in order to differentiate hashes generated before and after the fix, we are introducing a new minor 'b'.\n> \n> OpenBSD 5.5 (coming this spring) will accept and verify 'b' hashes, although it will still generate 'a' hashes. OpenBSD 5.6 (coming this fall) will change to generating 'b' hashes by default.\n> \n> A future release of Solar's bcrypt code should also support 'b'. \n\nWith shied plugin installed:\n\n```\n$  curl -u es_admin -XGET 'http://127.0.0.1:9200/'  \nEnter host password for user 'es_admin':\n{\"error\":\"AuthenticationException[unable to authenticate user [es_admin] for REST request [/]]\",\"status\":401}\n```\n\nWith shield plugin removed:\n\n```\n$  curl -XGET 'http://127.0.0.1:9200/'              \n{\n  \"status\" : 200,\n  \"name\" : \"Ringmaster\",\n  \"cluster_name\" : \"elasticsearch\",\n  \"version\" : {\n    \"number\" : \"1.5.1\",\n    \"build_hash\" : \"5e38401bc4e4388537a615569ac60925788e1cf4\",\n    \"build_timestamp\" : \"2015-04-09T13:41:35Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.10.4\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n\n(I apologize but I could not manage to get some logging about auth issue.)\n\nIf you need more info I'd be pleased to provide it.\n","closed_by":{"login":"jirib","id":46245,"node_id":"MDQ6VXNlcjQ2MjQ1","avatar_url":"https://avatars2.githubusercontent.com/u/46245?v=4","gravatar_id":"","url":"https://api.github.com/users/jirib","html_url":"https://github.com/jirib","followers_url":"https://api.github.com/users/jirib/followers","following_url":"https://api.github.com/users/jirib/following{/other_user}","gists_url":"https://api.github.com/users/jirib/gists{/gist_id}","starred_url":"https://api.github.com/users/jirib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jirib/subscriptions","organizations_url":"https://api.github.com/users/jirib/orgs","repos_url":"https://api.github.com/users/jirib/repos","events_url":"https://api.github.com/users/jirib/events{/privacy}","received_events_url":"https://api.github.com/users/jirib/received_events","type":"User","site_admin":false},"performed_via_github_app":null}