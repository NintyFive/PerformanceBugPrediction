[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422335791","html_url":"https://github.com/elastic/elasticsearch/issues/33805#issuecomment-422335791","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33805","id":422335791,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjMzNTc5MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T10:11:10Z","updated_at":"2018-09-18T10:11:10Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423218038","html_url":"https://github.com/elastic/elasticsearch/issues/33805#issuecomment-423218038","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33805","id":423218038,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzIxODAzOA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T15:04:56Z","updated_at":"2018-09-20T15:04:56Z","author_association":"CONTRIBUTOR","body":"I have a WIP branch https://github.com/albertzaharovits/elasticsearch/tree/fix-get-alias but I have to go in vacation, I'll resume next Tuesday.\r\n\r\nTestwise I think https://github.com/elastic/elasticsearch/blob/master/x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/IndicesAndAliasesResolverTests.java should try to verify that whatever patterns it is resolving it conforms to how https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java resolves.\r\n\r\nI am going to close this because I will treat it under the https://github.com/elastic/elasticsearch/issues/29915 umbrella .","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427246472","html_url":"https://github.com/elastic/elasticsearch/issues/33805#issuecomment-427246472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33805","id":427246472,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzI0NjQ3Mg==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T04:57:57Z","updated_at":"2018-10-05T04:59:21Z","author_association":"CONTRIBUTOR","body":"@costin I think I finally have a solid grasp of the issue.\r\nFirst there is no security vulnerability. Under all circumstances wildcards are expanded by the security plugin in the limited visibility scope of the user. I was originally fooled by explicitly requested aliases (non wildcards) that were out of the user's visibility, but those requests are truthfully denied later in the process.\r\n\r\nI have investigated the `GetAlias` API using wildcard (exclusion) expressions. There were indeed several problems.\r\nThe root of the problem is described in #34144 which has been merged and the **broken behavior you experienced when the Security plugin was enabled is fixed.**\r\nHowever, `GetAlias` is broken in other ways, which has nothing to do with the Security plugin.\r\nFor example, the result of your `GetAlias` request:\r\n```\r\ncurl -u elastic-admin:elastic-password -X GET \"localhost:9200/_alias/test_*,-test_a*?pretty\"\r\n{\r\n  \"error\" : \"aliases [-test_a*,test_*] missing\",\r\n  \"status\" : 404\r\n}\r\n```\r\nThis shows no results, as expected, but there is an odd error being reported.\r\nAgain, this is a problem in ES core.\r\nI have raised #34230 to fix it, but the fix elicits a bwc breaking change explained here https://github.com/elastic/elasticsearch/issues/30536#issuecomment-426598553 . This needs some advertising to get it approved for merging. **Any support on the discuss issue #30536 is welcome and appreciated!**\r\nThere is another thing about wildcard expressions that **might impact you**, since you are using alias wildcards together with exclusions. It is described here #34291 . It's interesting because in this story the Security plugin is the hero not the villain!\r\n\r\nRegarding the second part of your report, namely the `GetIndex` misbehavior, I was not able to reproduce it in any form and I am pretty sure the Security plugin is not breaking anything there. Also, it looks pretty serios, so I am thinking it's a setup problem somehow...\r\nThere are tests for these stuffs, maybe I am missing something in your setup/environment? I don't use the Transport client, I fake the request options in the code and issue curl calls.\r\nCan you confirm if the problem persists, and if so, give some more reproduction steps?\r\n\r\n\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427741567","html_url":"https://github.com/elastic/elasticsearch/issues/33805#issuecomment-427741567","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33805","id":427741567,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzc0MTU2Nw==","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"created_at":"2018-10-08T07:24:51Z","updated_at":"2018-10-08T07:24:51Z","author_association":"MEMBER","body":"Thanks @albertzaharovits for the comprehensive reply. I'll take the changes for the spin and report back;\r\nonce thing to note from the start, there are differences in the rest vs java/transport API.\r\nWith `GetAlias` one can restrict the filtering only to aliases vs indices (`GetAlias.setAliases() vs .setIndices()) while with `GetIndex` one can set specific `IndexOptions` - which SQL uses namely for `GetIndex` to not expand to aliases but rather only indices.\r\n\r\nAgain, I'll pick the updates and report back.","performed_via_github_app":null}]