{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/58251","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58251/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58251/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58251/events","html_url":"https://github.com/elastic/elasticsearch/issues/58251","id":640413260,"node_id":"MDU6SXNzdWU2NDA0MTMyNjA=","number":58251,"title":"Test upgrade scenarios with New Indexing Strategy for Data Streams","user":{"login":"ruflin","id":244900,"node_id":"MDQ6VXNlcjI0NDkwMA==","avatar_url":"https://avatars3.githubusercontent.com/u/244900?v=4","gravatar_id":"","url":"https://api.github.com/users/ruflin","html_url":"https://github.com/ruflin","followers_url":"https://api.github.com/users/ruflin/followers","following_url":"https://api.github.com/users/ruflin/following{/other_user}","gists_url":"https://api.github.com/users/ruflin/gists{/gist_id}","starred_url":"https://api.github.com/users/ruflin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruflin/subscriptions","organizations_url":"https://api.github.com/users/ruflin/orgs","repos_url":"https://api.github.com/users/ruflin/repos","events_url":"https://api.github.com/users/ruflin/events{/privacy}","received_events_url":"https://api.github.com/users/ruflin/received_events","type":"User","site_admin":false},"labels":[{"id":1915711992,"node_id":"MDU6TGFiZWwxOTE1NzExOTky","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Data%20streams","name":":Core/Features/Data streams","color":"0e8a16","default":false,"description":""},{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-06-17T12:45:00Z","updated_at":"2020-08-18T12:32:29Z","closed_at":"2020-08-18T12:32:29Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In a recent conversations around data streams the upgrade scenarios we use for the new indexing strategy were brought up and that it is important that these are potentially also tested on the ES so they will get broken. This issue is to document the different scenarios.\r\n\r\nIn the following scenarios it is always assumed, that on upgrade, the following additional assets are installed / overwritten in the following order:\r\n\r\n* New ingest pipeline is loaded\r\n* Template is overwritten\r\n* Check if mapping can be updated\r\n\r\n## 1) Compatible mapping upgrade\r\n\r\nThe old and new mapping are compatible. The old template contains `foo.bar: keyword`, the new mapping `foo.bar: keyword, foo.hello_world: keyword`. Steps\r\n\r\n* Load template\r\n* Ingest data into data stream with `foo.bar`\r\n* Update template\r\n* Update mapping of current write index\r\n* Send data with `foo.bar` and `foo.hello_world`\r\n* Make sure `foo.hello_world` is type keyword\r\n\r\n## 2) Conflicting mapping upgrade\r\n\r\nThe old and new mapping are not compatible. The old template contains `foo: keyword`, the new mapping `foo.bar: keyword`. Steps\r\n\r\n* Load template and empty ingest pipeline \"old\"\r\n* Ingest data into data stream with `foo`\r\n* Load ingest pipeline which checks for `foo` field and renames it to `foo.bar`\r\n* Update template\r\n* Try to update mapping of current write index -> error\r\n* Trigger rollover of write index\r\n* Send data with `foo` \r\n* Send data with `foo.bar` \r\n* Make sure `foo.bar` is type keyword and newest index contains 2 events","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}