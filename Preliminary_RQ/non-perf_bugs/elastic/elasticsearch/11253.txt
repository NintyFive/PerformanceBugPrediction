{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11253","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11253/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11253/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11253/events","html_url":"https://github.com/elastic/elasticsearch/issues/11253","id":78465363,"node_id":"MDU6SXNzdWU3ODQ2NTM2Mw==","number":11253,"title":"Dentry cache bloating on ES instances","user":{"login":"vanga","id":5126396,"node_id":"MDQ6VXNlcjUxMjYzOTY=","avatar_url":"https://avatars3.githubusercontent.com/u/5126396?v=4","gravatar_id":"","url":"https://api.github.com/users/vanga","html_url":"https://github.com/vanga","followers_url":"https://api.github.com/users/vanga/followers","following_url":"https://api.github.com/users/vanga/following{/other_user}","gists_url":"https://api.github.com/users/vanga/gists{/gist_id}","starred_url":"https://api.github.com/users/vanga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanga/subscriptions","organizations_url":"https://api.github.com/users/vanga/orgs","repos_url":"https://api.github.com/users/vanga/repos","events_url":"https://api.github.com/users/vanga/events{/privacy}","received_events_url":"https://api.github.com/users/vanga/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-05-20T10:21:15Z","updated_at":"2015-05-25T14:04:21Z","closed_at":"2015-05-25T14:04:20Z","author_association":"NONE","active_lock_reason":null,"body":"I had created a post in elasticsearch google group earlier\nhttps://groups.google.com/forum/#!topic/elasticsearch/c8_BLOtFVhs\n\nES version 1.5.2\nArch Linux on Amazon EC2\nof the available 16 GB, 8 GB is heap (mlocked). Memory consumption is continuously increasing (225 MB per day).\nTotal no of documents is around 800k, 500 MB.\n\n```\ncat /proc/meminfo has\n    Slab: 3424728 kB \n    SReclaimable: 3407256 kB\n\ncurl -XGET 'http://localhost:9200/_nodes/stats/jvm?pretty'\n\n    \"heap_used_in_bytes\" : 5788779888,\n              \"heap_used_percent\" : 67,\n              \"heap_committed_in_bytes\" : 8555069440,\n\nslabtop\n OBJS ACTIVE  USE OBJ SIZE  SLABS OBJ/SLAB CACHE SIZE NAME                  \n17750313 17750313 100%    0.19K 845253       21   3381012K dentry\n```\n\nI understand that the dentry cache isn't a bad thing and kernel can take back this memory if needed, but the unusual rate of increase is a bit worrisome. \n\nI have straced elasticsearch for a couple of minutes\nstrace -fp PID -o file.txt\n\nout of the 40k+ events recorded\n2.2k + events have resulted in errors like this\nhttps://gist.github.com/vanga/55ca296f737b3c1fb9a2\nIs this normal?\n\nI think this is the reason for the dentry bloating, though I am not sure if there is some thing wrong with my cluster or not. \n\nUpdate: Is ES/lucene making requests to non existent files? or is it making requests to files which were there, but not any more? If yes why would it request to files which are not there? is there some thing wrong with the cluster?\n\nUpdate: I see that access to a file which resulted in ENOENT succeeds at later point in time(based on strace output). \nThanks.\n","closed_by":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"performed_via_github_app":null}