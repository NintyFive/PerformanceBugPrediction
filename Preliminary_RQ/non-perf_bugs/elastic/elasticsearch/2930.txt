{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2930","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2930/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2930/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2930/events","html_url":"https://github.com/elastic/elasticsearch/issues/2930","id":13552745,"node_id":"MDU6SXNzdWUxMzU1Mjc0NQ==","number":2930,"title":"Using script_field loses all indexed data","user":{"login":"amir20","id":260667,"node_id":"MDQ6VXNlcjI2MDY2Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/260667?v=4","gravatar_id":"","url":"https://api.github.com/users/amir20","html_url":"https://github.com/amir20","followers_url":"https://api.github.com/users/amir20/followers","following_url":"https://api.github.com/users/amir20/following{/other_user}","gists_url":"https://api.github.com/users/amir20/gists{/gist_id}","starred_url":"https://api.github.com/users/amir20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amir20/subscriptions","organizations_url":"https://api.github.com/users/amir20/orgs","repos_url":"https://api.github.com/users/amir20/repos","events_url":"https://api.github.com/users/amir20/events{/privacy}","received_events_url":"https://api.github.com/users/amir20/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2013-04-23T19:33:20Z","updated_at":"2013-06-05T19:52:52Z","closed_at":"2013-04-24T14:40:01Z","author_association":"NONE","active_lock_reason":null,"body":"I posted this on [google groups](https://groups.google.com/forum/?fromgroups=#!topic/elasticsearch/Dw2kqpygwwg) so I apologize for creating an issue. I can close if it doesn't belong here. But I believe this is a bug.\n\nIt seems like using `script_fields` makes the rest of the document disappear. Here is what I am doing. I am trying to use elasticsearch with script_field to return distance in miles. The distance works but when I use script_field, all the data is lost that would have been returned if I didn't use script_field. Example:\n\n``` json\n{\n  \"script_fields\": {\n    \"distance\": {\n      \"script\": \"doc['lat_lon'].distanceInKm(0,50.3)\"\n    }\n  },\n \"query\": {\n    \"match_all\": {}\n  }\n}\n```\n\nThis returns\n\n``` json\n{\n    took: 1,\n    timed_out: false,\n    _shards: {\n        total: 5,\n        successful: 5,\n        failed: 0\n    },\n    hits: {\n        total: 1,\n        max_score: 1,\n        hits: [\n            {\n                _index: test_channels,\n                _type: channel,\n                _id: 1,\n                _score: 1,\n                fields: {\n                    distance: 19629.025705718916\n                }\n            }\n        ]\n    }\n}\n```\n\nAs you can see there is distance but nothing else. Removing the script_field like this:\n\n``` json\n{\n \"query\": {\n    \"match_all\": {}\n  }\n}\n```\n\nProduces the correct result. \n\n``` json\n{\n    took: 0,\n    timed_out: false,\n    _shards: {\n        total: 5,\n        successful: 5,\n        failed: 0,\n    }\n    hits: {\n        total: 1,\n        max_score: 1,\n        hits: [\n            {\n                _index: \"test_channels\",\n                _type: \"channel\",\n                _id: 1,\n                _score: 1,\n                _source: {\n                    created_at: \"2013-04-23T15:50:54Z\",\n                    description: \"Odit nam vitae facere velit eum similique. Voluptatem sed voluptas necessitatibus architecto molestiae voluptates possimus. Quo necessitatibus doloribus aut. Omnis nam non ratione. Nihil harum esse eaque sunt error consequuntur quia quasi.\"\n                    id: 1,\n                    image_file_name: null,\n                    latitude: 37.3320132,\n                    longitude: -122.0289113,\n                    name: \"Repellat inventore architecto et similique quo in.\",\n                    lat_lon: {\n                        lat: 37.3320132,\n                        lon: -122.0289113\n                    }\n                }\n            }\n        ]\n    }\n}\n```\n\nIs this potentially a bug or works as designed? \n","closed_by":{"login":"amir20","id":260667,"node_id":"MDQ6VXNlcjI2MDY2Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/260667?v=4","gravatar_id":"","url":"https://api.github.com/users/amir20","html_url":"https://github.com/amir20","followers_url":"https://api.github.com/users/amir20/followers","following_url":"https://api.github.com/users/amir20/following{/other_user}","gists_url":"https://api.github.com/users/amir20/gists{/gist_id}","starred_url":"https://api.github.com/users/amir20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amir20/subscriptions","organizations_url":"https://api.github.com/users/amir20/orgs","repos_url":"https://api.github.com/users/amir20/repos","events_url":"https://api.github.com/users/amir20/events{/privacy}","received_events_url":"https://api.github.com/users/amir20/received_events","type":"User","site_admin":false},"performed_via_github_app":null}