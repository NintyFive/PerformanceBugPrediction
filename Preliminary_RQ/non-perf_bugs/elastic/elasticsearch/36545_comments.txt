[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446887266","html_url":"https://github.com/elastic/elasticsearch/issues/36545#issuecomment-446887266","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36545","id":446887266,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njg4NzI2Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T08:44:31Z","updated_at":"2018-12-13T08:44:31Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447951097","html_url":"https://github.com/elastic/elasticsearch/issues/36545#issuecomment-447951097","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36545","id":447951097,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Nzk1MTA5Nw==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2018-12-17T18:36:29Z","updated_at":"2018-12-17T18:36:29Z","author_association":"CONTRIBUTOR","body":"Discussed this issue in person today.\r\n\r\nThe issues isn't specific to the Date Index Name processor, rather any processor that can change the location of `_index`. Below is an alternative reproduction:\r\n```\r\nDELETE foo,bar\r\nGET _cat/indices?v\r\n\r\nPUT _ingest/pipeline/test1\r\n{\r\n  \"processors\": [\r\n    {\r\n      \"set\": {\r\n        \"field\": \"_index\",\r\n        \"value\": \"foo\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n\r\nPUT bar/_doc/1?pipeline=test1\r\n{\r\n  \"a\" : \"b\"\r\n}\r\n\r\nGET foo/_doc/1\r\nGET bar/_doc/1\r\nGET _cat/indices?v\r\n```\r\n^ Note that both foo and bar indices are created. \r\n\r\nhttps://github.com/elastic/elasticsearch/pull/32786 is correctly identified as the change which introduces this issue. That change was made to ensure that a default pipeline, when defined via an index template would correctly find the default pipeline for the very first document as described in https://github.com/elastic/elasticsearch/issues/32758. \r\n\r\nThe fix for this needs to ensure it does not re-introduce https://github.com/elastic/elasticsearch/issues/32758. A likely fix for this will be:\r\nif there is not an explicit pipeline requested AND the (request) target index does not exist\r\nthen change the order back to the original pipeline execution before index creation, \r\nand then explicitly find and read the index template that will match the index request and pull the default pipeline (if it exists) from the index template.  \r\n","performed_via_github_app":null}]