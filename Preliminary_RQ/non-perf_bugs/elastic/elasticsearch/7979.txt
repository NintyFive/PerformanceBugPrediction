{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7979","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7979/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7979/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7979/events","html_url":"https://github.com/elastic/elasticsearch/issues/7979","id":44822674,"node_id":"MDU6SXNzdWU0NDgyMjY3NA==","number":7979,"title":"Huge amount of non-heap memory usage in v1.3.3","user":{"login":"martinb3","id":103033,"node_id":"MDQ6VXNlcjEwMzAzMw==","avatar_url":"https://avatars0.githubusercontent.com/u/103033?v=4","gravatar_id":"","url":"https://api.github.com/users/martinb3","html_url":"https://github.com/martinb3","followers_url":"https://api.github.com/users/martinb3/followers","following_url":"https://api.github.com/users/martinb3/following{/other_user}","gists_url":"https://api.github.com/users/martinb3/gists{/gist_id}","starred_url":"https://api.github.com/users/martinb3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martinb3/subscriptions","organizations_url":"https://api.github.com/users/martinb3/orgs","repos_url":"https://api.github.com/users/martinb3/repos","events_url":"https://api.github.com/users/martinb3/events{/privacy}","received_events_url":"https://api.github.com/users/martinb3/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-10-03T16:50:57Z","updated_at":"2014-10-15T10:06:49Z","closed_at":"2014-10-15T10:06:49Z","author_association":"NONE","active_lock_reason":null,"body":"Howdy! I'm wondering if the whole \"set your heap to 50% of system memory\" is too ambiguous. Do you intend to mean \"all of the JVM should take up 50% of system memory\"?\n\nI just installed 1.3.3 on a server with 2gb of RAM, and with this commandline (heap fixed at 800mb), I'm seeing the total process memory at an additional 300mb:\n\n`/usr/bin/java -server -Djava.net.preferIPv4Stack=true -Des.config=/usr/local/etc/elasticsearch/elasticsearch.yml -Xms800m -Xmx800m -Xss256k -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError -Delasticsearch -Des.pidfile=/usr/local/var/run/elkstack_centos_65.pid -Des.path.home=/usr/local/elasticsearch -cp :/usr/local/elasticsearch/lib/*:/usr/local/elasticsearch/lib/sigar/* org.elasticsearch.bootstrap.Elasticsearch`\n\nps output:\n`497       8518  0.2 57.3 2162076 1175444 ?     SLl  14:09   0:25 /usr/bin/java` -- 1175444 is roughly 1176mb. That means the non-heap memory is almost a 3rd of the total process memory (an additional 300+ mb).\n\nIs that expected? Should the recommendation of using 50% of system memory for heap really be something closer to 50% of the system memory?\n\nFWIW, here's my node stats:\n\n```\n      \"os\" : {\n        \"timestamp\" : 1412354968278,\n        \"uptime_in_millis\" : 10674,\n        \"load_average\" : [ 0.0, 0.0, 0.0 ],\n        \"cpu\" : {\n          \"sys\" : 0,\n          \"user\" : 0,\n          \"idle\" : 99,\n          \"usage\" : 0,\n          \"stolen\" : 0\n        },\n        \"mem\" : {\n          \"free_in_bytes\" : 345624576,\n          \"used_in_bytes\" : 1752281088,\n          \"free_percent\" : 22,\n          \"used_percent\" : 77,\n          \"actual_free_in_bytes\" : 471433216,\n          \"actual_used_in_bytes\" : 1626472448\n        },\n        \"swap\" : {\n          \"used_in_bytes\" : 0,\n          \"free_in_bytes\" : 0\n        }\n      },\n      \"process\" : {\n        \"timestamp\" : 1412354968278,\n        \"open_file_descriptors\" : 126,\n        \"cpu\" : {\n          \"percent\" : 0,\n          \"sys_in_millis\" : 3080,\n          \"user_in_millis\" : 22960,\n          \"total_in_millis\" : 26040\n        },\n        \"mem\" : {\n          \"resident_in_bytes\" : 1203654656,\n          \"share_in_bytes\" : 20033536,\n          \"total_virtual_in_bytes\" : 2213965824\n        }\n      },\n```\n\nHeap stats:\n\n```\nAttaching to process ID 8518, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 24.65-b04\n\nusing parallel threads in the new generation.\nusing thread-local object allocation.\nConcurrent Mark-Sweep GC\n\nHeap Configuration:\n   MinHeapFreeRatio = 40\n   MaxHeapFreeRatio = 70\n   MaxHeapSize      = 838860800 (800.0MB)\n   NewSize          = 174456832 (166.375MB)\n   MaxNewSize       = 174456832 (166.375MB)\n   OldSize          = 348913664 (332.75MB)\n   NewRatio         = 2\n   SurvivorRatio    = 8\n   PermSize         = 21757952 (20.75MB)\n   MaxPermSize      = 174063616 (166.0MB)\n   G1HeapRegionSize = 0 (0.0MB)\n```\n\nWhy is my process at 1200mb when the heap is only 800mb? Thanks!\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}