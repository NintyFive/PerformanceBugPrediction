{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12462","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12462/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12462/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12462/events","html_url":"https://github.com/elastic/elasticsearch/issues/12462","id":97247685,"node_id":"MDU6SXNzdWU5NzI0NzY4NQ==","number":12462,"title":"Snapshot repository failling HEAD request during start-up is not available","user":{"login":"nkvoll","id":391931,"node_id":"MDQ6VXNlcjM5MTkzMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/391931?v=4","gravatar_id":"","url":"https://api.github.com/users/nkvoll","html_url":"https://github.com/nkvoll","followers_url":"https://api.github.com/users/nkvoll/followers","following_url":"https://api.github.com/users/nkvoll/following{/other_user}","gists_url":"https://api.github.com/users/nkvoll/gists{/gist_id}","starred_url":"https://api.github.com/users/nkvoll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nkvoll/subscriptions","organizations_url":"https://api.github.com/users/nkvoll/orgs","repos_url":"https://api.github.com/users/nkvoll/repos","events_url":"https://api.github.com/users/nkvoll/events{/privacy}","received_events_url":"https://api.github.com/users/nkvoll/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2015-07-25T19:10:43Z","updated_at":"2018-02-14T13:46:24Z","closed_at":"2015-08-13T11:42:01Z","author_association":"MEMBER","active_lock_reason":null,"body":"This manifests as `{\"error\":\"RepositoryMissingException[[test-repo] missing]\",\"status\":404}`-errors if the repository is attempted used.\n\nThis behaviour is problematic in case a service has an intermittent hiccup just as Elasticsearch is starting (i.e S3 having some issues at the API level, temporary networking issues and so on).\n\nHere's the stack trace from the instance start:\n\n```\n[2015-07-25 20:52:16,198][WARN ][repositories             ] [Red Shift] failed to create repository [s3][test-repo]\norg.elasticsearch.common.inject.CreationException: Guice creation errors:\n\n1) Error injecting constructor, com.amazonaws.AmazonClientException: Unable to execute HTTP request: Connection refused\n  at org.elasticsearch.repositories.s3.S3Repository.<init>(Unknown Source)\n  while locating org.elasticsearch.repositories.s3.S3Repository\n  while locating org.elasticsearch.repositories.Repository\n\n1 error\n    at org.elasticsearch.common.inject.internal.Errors.throwCreationExceptionIfErrorsExist(Errors.java:344)\n    at org.elasticsearch.common.inject.InjectorBuilder.injectDynamically(InjectorBuilder.java:178)\n    at org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:110)\n    at org.elasticsearch.common.inject.InjectorImpl.createChildInjector(InjectorImpl.java:131)\n    at org.elasticsearch.common.inject.ModulesBuilder.createChildInjector(ModulesBuilder.java:69)\n    at org.elasticsearch.repositories.RepositoriesService.createRepositoryHolder(RepositoriesService.java:407)\n    at org.elasticsearch.repositories.RepositoriesService.clusterChanged(RepositoriesService.java:302)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:480)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:188)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:158)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: com.amazonaws.AmazonClientException: Unable to execute HTTP request: Connection refused\n    at com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:473)\n    at com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:297)\n    at com.amazonaws.services.s3.AmazonS3Client.invoke(AmazonS3Client.java:3672)\n    at com.amazonaws.services.s3.AmazonS3Client.headBucket(AmazonS3Client.java:1079)\n    at com.amazonaws.services.s3.AmazonS3Client.doesBucketExist(AmazonS3Client.java:1042)\n    at org.elasticsearch.cloud.aws.blobstore.S3BlobStore.<init>(S3BlobStore.java:74)\n    at org.elasticsearch.repositories.s3.S3Repository.<init>(S3Repository.java:125)\n    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n    at java.lang.reflect.Constructor.newInstance(Constructor.java:422)\n    at org.elasticsearch.common.inject.DefaultConstructionProxyFactory$1.newInstance(DefaultConstructionProxyFactory.java:54)\n    at org.elasticsearch.common.inject.ConstructorInjector.construct(ConstructorInjector.java:86)\n    at org.elasticsearch.common.inject.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:98)\n    at org.elasticsearch.common.inject.FactoryProxy.get(FactoryProxy.java:52)\n    at org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter$1.call(ProviderToInternalFactoryAdapter.java:45)\n    at org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:837)\n    at org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:42)\n    at org.elasticsearch.common.inject.Scopes$1$1.get(Scopes.java:57)\n    at org.elasticsearch.common.inject.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:45)\n    at org.elasticsearch.common.inject.InjectorBuilder$1.call(InjectorBuilder.java:200)\n    at org.elasticsearch.common.inject.InjectorBuilder$1.call(InjectorBuilder.java:193)\n    at org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:830)\n    at org.elasticsearch.common.inject.InjectorBuilder.loadEagerSingletons(InjectorBuilder.java:193)\n    at org.elasticsearch.common.inject.InjectorBuilder.injectDynamically(InjectorBuilder.java:175)\n    ... 11 more\nCaused by: java.net.ConnectException: Connection refused\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:345)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:589)\n    at org.apache.http.conn.scheme.PlainSocketFactory.connectSocket(PlainSocketFactory.java:117)\n    at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:177)\n    at org.apache.http.impl.conn.ManagedClientConnectionImpl.open(ManagedClientConnectionImpl.java:304)\n    at org.apache.http.impl.client.DefaultRequestDirector.tryConnect(DefaultRequestDirector.java:611)\n    at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:446)\n    at org.apache.http.impl.client.AbstractHttpClient.doExecute(AbstractHttpClient.java:863)\n    at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)\n    at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:57)\n    at com.amazonaws.http.AmazonHttpClient.executeOneRequest(AmazonHttpClient.java:701)\n    at com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:462)\n    ... 35 more\n[2015-07-25 20:52:16,205][WARN ][repositories             ] [Red Shift] failed to create repository [test-repo]\norg.elasticsearch.repositories.RepositoryException: [test-repo] failed to create repository\n    at org.elasticsearch.repositories.RepositoriesService.createRepositoryHolder(RepositoriesService.java:414)\n    at org.elasticsearch.repositories.RepositoriesService.clusterChanged(RepositoriesService.java:302)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:480)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:188)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:158)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.common.inject.CreationException: Guice creation errors:\n\n1) Error injecting constructor, com.amazonaws.AmazonClientException: Unable to execute HTTP request: Connection refused\n  at org.elasticsearch.repositories.s3.S3Repository.<init>(Unknown Source)\n  while locating org.elasticsearch.repositories.s3.S3Repository\n  while locating org.elasticsearch.repositories.Repository\n\n1 error\n    at org.elasticsearch.common.inject.internal.Errors.throwCreationExceptionIfErrorsExist(Errors.java:344)\n    at org.elasticsearch.common.inject.InjectorBuilder.injectDynamically(InjectorBuilder.java:178)\n    at org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:110)\n    at org.elasticsearch.common.inject.InjectorImpl.createChildInjector(InjectorImpl.java:131)\n    at org.elasticsearch.common.inject.ModulesBuilder.createChildInjector(ModulesBuilder.java:69)\n    at org.elasticsearch.repositories.RepositoriesService.createRepositoryHolder(RepositoriesService.java:407)\n    ... 7 more\nCaused by: com.amazonaws.AmazonClientException: Unable to execute HTTP request: Connection refused\n    at com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:473)\n    at com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:297)\n    at com.amazonaws.services.s3.AmazonS3Client.invoke(AmazonS3Client.java:3672)\n    at com.amazonaws.services.s3.AmazonS3Client.headBucket(AmazonS3Client.java:1079)\n    at com.amazonaws.services.s3.AmazonS3Client.doesBucketExist(AmazonS3Client.java:1042)\n    at org.elasticsearch.cloud.aws.blobstore.S3BlobStore.<init>(S3BlobStore.java:74)\n    at org.elasticsearch.repositories.s3.S3Repository.<init>(S3Repository.java:125)\n    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n    at java.lang.reflect.Constructor.newInstance(Constructor.java:422)\n    at org.elasticsearch.common.inject.DefaultConstructionProxyFactory$1.newInstance(DefaultConstructionProxyFactory.java:54)\n    at org.elasticsearch.common.inject.ConstructorInjector.construct(ConstructorInjector.java:86)\n    at org.elasticsearch.common.inject.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:98)\n    at org.elasticsearch.common.inject.FactoryProxy.get(FactoryProxy.java:52)\n    at org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter$1.call(ProviderToInternalFactoryAdapter.java:45)\n    at org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:837)\n    at org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:42)\n    at org.elasticsearch.common.inject.Scopes$1$1.get(Scopes.java:57)\n    at org.elasticsearch.common.inject.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:45)\n    at org.elasticsearch.common.inject.InjectorBuilder$1.call(InjectorBuilder.java:200)\n    at org.elasticsearch.common.inject.InjectorBuilder$1.call(InjectorBuilder.java:193)\n    at org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:830)\n    at org.elasticsearch.common.inject.InjectorBuilder.loadEagerSingletons(InjectorBuilder.java:193)\n    at org.elasticsearch.common.inject.InjectorBuilder.injectDynamically(InjectorBuilder.java:175)\n    ... 11 more\nCaused by: java.net.ConnectException: Connection refused\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:345)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:589)\n    at org.apache.http.conn.scheme.PlainSocketFactory.connectSocket(PlainSocketFactory.java:117)\n    at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:177)\n    at org.apache.http.impl.conn.ManagedClientConnectionImpl.open(ManagedClientConnectionImpl.java:304)\n    at org.apache.http.impl.client.DefaultRequestDirector.tryConnect(DefaultRequestDirector.java:611)\n    at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:446)\n    at org.apache.http.impl.client.AbstractHttpClient.doExecute(AbstractHttpClient.java:863)\n    at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)\n    at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:57)\n    at com.amazonaws.http.AmazonHttpClient.executeOneRequest(AmazonHttpClient.java:701)\n    at com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:462)\n    ... 35 more\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}