[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559033231","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-559033231","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":559033231,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTAzMzIzMQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-11-27T10:43:21Z","updated_at":"2019-11-27T10:43:21Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/EQL)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/560546979","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-560546979","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":560546979,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MDU0Njk3OQ==","user":{"login":"stacey-gammon","id":16563603,"node_id":"MDQ6VXNlcjE2NTYzNjAz","avatar_url":"https://avatars3.githubusercontent.com/u/16563603?v=4","gravatar_id":"","url":"https://api.github.com/users/stacey-gammon","html_url":"https://github.com/stacey-gammon","followers_url":"https://api.github.com/users/stacey-gammon/followers","following_url":"https://api.github.com/users/stacey-gammon/following{/other_user}","gists_url":"https://api.github.com/users/stacey-gammon/gists{/gist_id}","starred_url":"https://api.github.com/users/stacey-gammon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stacey-gammon/subscriptions","organizations_url":"https://api.github.com/users/stacey-gammon/orgs","repos_url":"https://api.github.com/users/stacey-gammon/repos","events_url":"https://api.github.com/users/stacey-gammon/events{/privacy}","received_events_url":"https://api.github.com/users/stacey-gammon/received_events","type":"User","site_admin":false},"created_at":"2019-12-02T19:34:22Z","updated_at":"2019-12-02T19:34:22Z","author_association":"NONE","body":"@wylieconlon @chrisdavies  -- would be interested to hear your thoughts on the last section `Alternatives to current result output` in relation to Lens and suggested visualization types.  Is there a visualization type we could suggest if the return structure was formatted a certain way?  Maybe something like nested tables? A cell in a table actually contains a whole table itself?  Like the result of a sequence query could be something like this:\r\n\r\n<img width=\"797\" alt=\"Screen Shot 2019-12-02 at 2 26 00 PM\" src=\"https://user-images.githubusercontent.com/16563603/69988484-bc88dc00-150f-11ea-8441-80c4a7b842f6.png\">\r\n\r\nor something like this:\r\n\r\n<img width=\"798\" alt=\"Screen Shot 2019-12-02 at 2 26 07 PM\" src=\"https://user-images.githubusercontent.com/16563603/69988499-c3175380-150f-11ea-8092-d3a4bea1688d.png\">\r\n\r\nNote that a row can belong in multiple sequences, hence the sequence_id column is an array type, not a string type.  I feel like the first structure might be easier for suggesting visualizations?  Especially if we want a generic data table layer like we were talking about, I think we probably don't want to do something like, if the table has a column named \"sequenceIds\", suggest this visualization.\r\n\r\nThis would probably be a new visualization type as well... maybe something like a table where each row is a sequence but it has collapsible sub rows (kind of like that EAH demo from RBC)?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/561629693","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-561629693","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":561629693,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MTYyOTY5Mw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-12-04T12:51:27Z","updated_at":"2019-12-04T12:52:54Z","author_association":"MEMBER","body":"For the JSON response of the API, I am leaning towards the response providing a flat list of events with a field for sequence_id. The reason for this is that it will be easily compatible with the current output of results from Endpoint, it fits into the way that SIEM is likely to want to display the results and the data can be used to create the kinds of nested tables that @stacey-gammon mentions above since all the information will be present.\r\n\r\nAs for the fact that an event can belong in multiple sequences, one solution to this would be to duplicate the event rather than make the sequence_id field multi-valued.\r\n\r\n@rw-access How does the current EQL implementation output results where the sequences overlap? does it duplicate the events that are shared by multiple sequences in the results?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/561720986","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-561720986","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":561720986,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MTcyMDk4Ng==","user":{"login":"rw-access","id":31489089,"node_id":"MDQ6VXNlcjMxNDg5MDg5","avatar_url":"https://avatars1.githubusercontent.com/u/31489089?v=4","gravatar_id":"","url":"https://api.github.com/users/rw-access","html_url":"https://github.com/rw-access","followers_url":"https://api.github.com/users/rw-access/followers","following_url":"https://api.github.com/users/rw-access/following{/other_user}","gists_url":"https://api.github.com/users/rw-access/gists{/gist_id}","starred_url":"https://api.github.com/users/rw-access/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rw-access/subscriptions","organizations_url":"https://api.github.com/users/rw-access/orgs","repos_url":"https://api.github.com/users/rw-access/repos","events_url":"https://api.github.com/users/rw-access/events{/privacy}","received_events_url":"https://api.github.com/users/rw-access/received_events","type":"User","site_admin":false},"created_at":"2019-12-04T16:25:03Z","updated_at":"2020-10-08T14:44:05Z","author_association":"MEMBER","body":"Sorry for jamming several replies in one comment. Buckle in.\r\n\r\n> Field to use as an implicit join key - This defines a field that will be implicitly added as the first join key. \r\n\r\nWhat's the rationale for making this implicit vs explicit? One thing I observed in the POC is that the order of the join keys can impact total search time significantly, because of the search_after skipping. For instance, using endpoint_id as the last key took one query 40 minutes, but when I put it as the first key, it was ~15-20% complete after four hours. I eventually just canceled it. If we guess this ordering wrong for implicit join keys, we could degrade performance.\r\n\r\n> Field to use as event type (process, file, network etc.). Defaults to event.type\r\n\r\nI still don't think we should only allow this to be a specific field, because it might not be flexible enough. If we do, I think `event.category` is a better default with how we use it in ECS now. This is another approach that is flexible and reusable:\r\n```json\r\n{\r\n  \"event_mapping\": {\r\n    \"file\" : {\r\n      \"index\": \"endgame-file-*\"\r\n      },\r\n     \"process\": {\r\n       \"index\": [\"endgame-*\"],\r\n       \"filter\": \"event.category == 'process'\"\r\n     }\r\n  }\r\n}\r\n```\r\n>  For EQL queries without pipes, the results of an EQL query are always a flat list of events\r\nThis experience is different depending on where you view it. Within all of the EQL engines, each result is always an array of events. For single event queries, that size is always 1, so it's easy to flatten. For sequences or joins, the length of the array mirrors that of the sequence. It's not _pipes_ that turns it into an array, but it's sequences or joins.\r\n\r\nWithin the Endgame platform, EQL was a bit of an afterthought, so for I had to flatten every array regardless, and added some fields so that arrays could be reassembled, with each event as a separate \"card\", similar to how kibana presents data. I think we'll have to brainstorm more what the best representation is. This means that if an event is in two sequences (more below), then it is outputted _twice_.\r\n\r\n> The endgame CLI client also has the option to define --flat --columns which pivot the result data into a table form with the specified columns. This may also be something we would want to support since it will put the results into a much more consumable form for clients like Kibana and is the kind of operation analysts will naturally reach for following the search anyway.\r\n\r\nThis client still operates on the flattened results, with each event as a separate row. If you display columns across different data types, you end up with a sparse matrix.\r\n\r\n> @rw-access How does the current EQL implementation output results where the sequences overlap? does it duplicate the events that are shared by multiple sequences in the results?\r\n\r\nGood question. Overlaps are technically possible but only for events that could satisfy multiple positions in a sequence. But you won't find one event in the same position for two separate sequences (with [one undocumented exception](https://github.com/endgameinc/eql/blob/15cf87e2e1a4d34f5f655ce9ef0535b5d0f0b7e0/eql/etc/test_queries.toml#L764-L768)). For reference, https://eql.readthedocs.io/en/latest/query-guide/implementation.html#sequences\r\n\r\nFor instance, this sequence will have no overlaps because there are no events that satisfy `file where true` and `process where true`\r\n ```sql\r\nsequence\r\n  [file where true]\r\n  [process where true]\r\n```\r\n\r\nBut this sequence would link each process to its first child. Since every process (minus the initial one at the of the chain or ones without children) is both a parent and a child, so it'll be in two sequences:\r\n```sql\r\nsequence\r\n  [process where true] by pid\r\n  [process where true] by pid\r\n```\r\nIf you have a lineage of A -> B -> C -> D, then you'll see sequences for (A, B), (B, C), (C, D).\r\n\r\nIn my opinion, the most clear representation of sequences was the first picture that @stacey-gammon showed:\r\n<img width=\"797\" alt=\"Screen Shot 2019-12-02 at 2 26 00 PM\" src=\"https://user-images.githubusercontent.com/16563603/69988484-bc88dc00-150f-11ea-8441-80c4a7b842f6.png\">\r\n\r\nIf you went with the second view, `sequence_ids` needs to be updated to reflect `{\"sequence_id\": 1, \"position\": 0}`. This doesn't help when events are intermingled. If you had events in this order:\r\n\r\n| _id | ppid | pid |\r\n|---|------|-----|\r\n| a   | 0  | 4 |\r\n| b   | 4  | 8 |\r\n| c   | 4  | 12 |\r\n| d   | 8  | 16 |\r\n| e   | 12  | 20 |\r\n| f   | 16  | 24 |\r\n\r\nThen you end up with results (a, b), (b, d), (c, e), (d, f). That's tricky if you require each event to only be shown once. Also, note that the join key is different for each pair. \r\n\r\n> As for the fact that an event can belong in multiple sequences, one solution to this would be to duplicate the event rather than make the sequence_id field multi-valued.\r\nAgreed, otherwise you end up with this undecipherable table:\r\n\r\n|  sequence (id, pos, join key)  | _id | ppid | pid |\r\n|---------|-----|------|-----|\r\n| (0, 0, 4)   | a   | 0  | 4 |\r\n| (0, 1, 4) (1, 0, 8)  | b   | 4  | 8 |\r\n| (2, 0, 12)   | c   | 4  | 12 |\r\n| (1, 1, 8) (3, 0, 16)  | d   | 8  | 16 |\r\n| (2, 1, 12)   | e   | 12  | 20 |\r\n| (3, 1, 16)   | f   | 16  | 24 |","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/563141720","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-563141720","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":563141720,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MzE0MTcyMA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-12-09T09:25:22Z","updated_at":"2019-12-09T09:25:22Z","author_association":"MEMBER","body":"> What's the rationale for making this implicit vs explicit? \r\n\r\nThe rationale is that we want the same rule as written to run against both Elasticsearch and Endpoint so we need some way to replicate the per endpoint querying in Elasticsearch without needing to change the rule that's run between the endpoint and Elasticsearch.\r\n\r\n> I still don't think we should only allow this to be a specific field, because it might not be flexible enough. If we do, I think event.category is a better default with how we use it in ECS now. \r\n\r\nI think it will be flexible enough, especially when combined with https://github.com/elastic/elasticsearch/pull/49713. The ability to create a constant field in the index will allow users to effectively do the reverse of your suggestion and will enable users to query over many indexes whilst still efficiently filtering on the event type. The problem with your suggestion is that its another kinda of mapping which needs to be stored and maintained which will make the users experience (especially whilst users are learning the feature) more complicated. \r\n\r\n> This means that if an event is in two sequences (more below), then it is outputted twice.\r\n\r\nThis will actually make the response much easier since each \"row\" will only belong to a single sequence","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/564011353","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-564011353","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":564011353,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDAxMTM1Mw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-12-10T12:30:22Z","updated_at":"2019-12-10T13:07:35Z","author_association":"MEMBER","body":"There seems to be a preference for defining sequences in structure rather than a flat list of events with a sequence id. This was also shared by @tsg when I spoke to him the other day about how he would use EQL. \r\n\r\n@scunningham would Endpoint be ok with getting back structured sequences in the response from EQL in Elasticsearch (essentially option 1 or 2 below) or would it need a flat event structure like it currently has for the endpoints (essentially option 3 below)?\r\n\r\nOne thing to note is that EQL results are not always sequences, a result can be made up of 1 event or multiple events. To cope with this we can either define the response format as if every result has multiple events (so a result contains an array of events) and the array will only contain a single event if the query does not use sequence or join, or we can define the response so the result can contain different types of payload; event or sequence. The former has the advantage that clients has one kind of response to process and can process it in the same way every time.\r\n\r\nTo help us make progress below are some examples of responses in the different forms. \r\n\r\n## Sequences as structure in the response\r\n\r\n### Option 1 - Same format for sequence and non-sequence results\r\n\r\n#### Example 1 - non-sequence query\r\n\r\nQuery:\r\n```\r\nprocess where process.name = \"interesting.exe\"\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n    \"took\" : 5,\r\n    \"timed_out\" : false,\r\n    \"hits\" : {\r\n        \"total\" : {\r\n            \"value\" : 1000,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"hits\" : [\r\n            {\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"0\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:12:12\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"eric\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"6\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:12:56\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"bob\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"135\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T17:24:45\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"alice\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            ...\r\n        ]\r\n    }\r\n}\r\n```\r\n\r\n#### Example 2 - sequence query\r\n\r\nQuery: \r\n```\r\nsequence by pid\r\n[process where process.name = \"interesting.exe\"]\r\n[network where true]\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n    \"took\" : 5,\r\n    \"timed_out\" : false,\r\n    \"hits\" : {\r\n        \"total\" : {\r\n            \"value\" : 100,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"hits\" : [\r\n            {\r\n                \"join_keys\": [ \"4021\" ],\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"0\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:12:12\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 4021,\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"eric\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    },\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"2\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:12:13\",\r\n                            \"event\": {\r\n                                \"type\": \"network\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 4021,\r\n                                ...\r\n                            },\r\n                            \"network\":{\r\n                                \"port\": 50392\r\n                            }\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"join_keys\": [ \"325\" ],\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"6\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:12:56\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 325,\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"bob\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    },\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"20\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:13:08\",\r\n                            \"event\": {\r\n                                \"type\": \"network\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 325,\r\n                                ...\r\n                            },\r\n                            \"network\":{\r\n                                \"port\": 50392\r\n                            }\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"join_keys\": [ \"200\" ],\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"135\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T17:24:45\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 200,\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"alice\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    },\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"136\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T17:24:45\",\r\n                            \"event\": {\r\n                                \"type\": \"network\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 200,\r\n                                ...\r\n                            },\r\n                            \"network\":{\r\n                                \"port\": 50392\r\n                            }\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            ...\r\n        ]\r\n    }\r\n}\r\n```\r\n\r\n### Option 2 - Different format for sequence and non-sequence results\r\n\r\n#### Example 1 - non-sequence query\r\n\r\nQuery:\r\n```\r\nprocess where process.name = \"interesting.exe\"\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n    \"took\" : 5,\r\n    \"timed_out\" : false,\r\n    \"hits\" : {\r\n        \"total\" : {\r\n            \"value\" : 1000,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"hits\" : [\r\n            {\r\n                \"event\": {\r\n                    \"_index\" : \"my_index\",\r\n                    \"_id\" : \"0\",\r\n                    \"_source\" : {\r\n                        \"date\" : \"2009-11-15T14:12:12\",\r\n                        \"event\": {\r\n                            \"type\": \"process\",\r\n                            ...\r\n                        },\r\n                        \"process\": {\r\n                            \"name\": \"interesting.exe\",\r\n                            ...\r\n                        },\r\n                        \"user\": {\r\n                            \"name\": \"eric\",\r\n                            ...\r\n                        },\r\n                        ...\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                \"event\": {\r\n                    \"_index\" : \"my_index\",\r\n                    \"_id\" : \"6\",\r\n                    \"_source\" : {\r\n                        \"date\" : \"2009-11-15T14:12:56\",\r\n                        \"event\": {\r\n                            \"type\": \"process\",\r\n                            ...\r\n                        },\r\n                        \"process\": {\r\n                            \"name\": \"interesting.exe\",\r\n                            ...\r\n                        },\r\n                        \"user\": {\r\n                            \"name\": \"bob\",\r\n                            ...\r\n                        },\r\n                        ...\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                \"event\": {\r\n                    \"_index\" : \"my_index\",\r\n                    \"_id\" : \"135\",\r\n                    \"_source\" : {\r\n                        \"date\" : \"2009-11-15T17:24:45\",\r\n                        \"event\": {\r\n                            \"type\": \"process\",\r\n                            ...\r\n                        },\r\n                        \"process\": {\r\n                            \"name\": \"interesting.exe\",\r\n                            ...\r\n                        },\r\n                        \"user\": {\r\n                            \"name\": \"alice\",\r\n                            ...\r\n                        },\r\n                        ...\r\n                    }\r\n                }\r\n            },\r\n            ...\r\n        ]\r\n    }\r\n}\r\n```\r\n\r\n#### Example 2 - sequence query\r\n\r\nQuery: \r\n```\r\nsequence by pid\r\n[process where process.name = \"interesting.exe\"]\r\n[network where true]\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n    \"took\" : 5,\r\n    \"timed_out\" : false,\r\n    \"hits\" : {\r\n        \"total\" : {\r\n            \"value\" : 100,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"hits\" : [\r\n            {\r\n                \"sequence\": {\r\n                    \"join_keys\": [ \"4021\" ],\r\n                    \"events\":[\r\n                        {\r\n                            \"_index\" : \"my_index\",\r\n                            \"_id\" : \"0\",\r\n                            \"_source\" : {\r\n                                \"date\" : \"2009-11-15T14:12:12\",\r\n                                \"event\": {\r\n                                    \"type\": \"process\",\r\n                                    ...\r\n                                },\r\n                                \"process\": {\r\n                                    \"name\": \"interesting.exe\",\r\n                                    \"pid\": 4021,\r\n                                    ...\r\n                                },\r\n                                \"user\": {\r\n                                    \"name\": \"eric\",\r\n                                    ...\r\n                                },\r\n                                ...\r\n                            }\r\n                        },\r\n                        {\r\n                            \"_index\" : \"my_index\",\r\n                            \"_id\" : \"2\",\r\n                            \"_source\" : {\r\n                                \"date\" : \"2009-11-15T14:12:13\",\r\n                                \"event\": {\r\n                                    \"type\": \"network\",\r\n                                    ...\r\n                                },\r\n                                \"process\": {\r\n                                    \"name\": \"interesting.exe\",\r\n                                    \"pid\": 4021,\r\n                                    ...\r\n                                },\r\n                                \"network\":{\r\n                                    \"port\": 50392\r\n                                }\r\n                                ...\r\n                            }\r\n                        }\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"sequence\": {\r\n                    \"join_keys\": [ \"325\" ],\r\n                    \"events\":[\r\n                        {\r\n                            \"_index\" : \"my_index\",\r\n                            \"_id\" : \"6\",\r\n                            \"_source\" : {\r\n                                \"date\" : \"2009-11-15T14:12:56\",\r\n                                \"event\": {\r\n                                    \"type\": \"process\",\r\n                                    ...\r\n                                },\r\n                                \"process\": {\r\n                                    \"name\": \"interesting.exe\",\r\n                                    \"pid\": 325,\r\n                                    ...\r\n                                },\r\n                                \"user\": {\r\n                                    \"name\": \"bob\",\r\n                                    ...\r\n                                },\r\n                                ...\r\n                            }\r\n                        },\r\n                        {\r\n                            \"_index\" : \"my_index\",\r\n                            \"_id\" : \"20\",\r\n                            \"_source\" : {\r\n                                \"date\" : \"2009-11-15T14:13:08\",\r\n                                \"event\": {\r\n                                    \"type\": \"network\",\r\n                                    ...\r\n                                },\r\n                                \"process\": {\r\n                                    \"name\": \"interesting.exe\",\r\n                                    \"pid\": 325,\r\n                                    ...\r\n                                },\r\n                                \"network\":{\r\n                                    \"port\": 50392\r\n                                }\r\n                                ...\r\n                            }\r\n                        }\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"sequence\": {\r\n                    \"join_keys\": [ \"200\" ],\r\n                    \"events\":[\r\n                        {\r\n                            \"_index\" : \"my_index\",\r\n                            \"_id\" : \"135\",\r\n                            \"_source\" : {\r\n                                \"date\" : \"2009-11-15T17:24:45\",\r\n                                \"event\": {\r\n                                    \"type\": \"process\",\r\n                                    ...\r\n                                },\r\n                                \"process\": {\r\n                                    \"name\": \"interesting.exe\",\r\n                                    \"pid\": 200,\r\n                                    ...\r\n                                },\r\n                                \"user\": {\r\n                                    \"name\": \"alice\",\r\n                                    ...\r\n                                },\r\n                                ...\r\n                            }\r\n                        },\r\n                        {\r\n                            \"_index\" : \"my_index\",\r\n                            \"_id\" : \"136\",\r\n                            \"_source\" : {\r\n                                \"date\" : \"2009-11-15T17:24:45\",\r\n                                \"event\": {\r\n                                    \"type\": \"network\",\r\n                                    ...\r\n                                },\r\n                                \"process\": {\r\n                                    \"name\": \"interesting.exe\",\r\n                                    \"pid\": 200,\r\n                                    ...\r\n                                },\r\n                                \"network\":{\r\n                                    \"port\": 50392\r\n                                }\r\n                                ...\r\n                            }\r\n                        }\r\n                    ]\r\n                }\r\n            },\r\n            ...\r\n        ]\r\n    }\r\n}\r\n```\r\n\r\n## Option 3 - Results as flat list of events with sequence id\r\n\r\n#### Example 1 - non-sequence query\r\n\r\nQuery:\r\n```\r\nprocess where process.name = \"interesting.exe\"\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n    \"took\" : 5,\r\n    \"timed_out\" : false,\r\n    \"hits\" : {\r\n        \"total\" : {\r\n            \"value\" : 1000,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"hits\" : [\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"0\",\r\n                \"_sequence_id\": 0,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T14:12:12\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"eric\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"6\",\r\n                \"_sequence_id\": 1,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T14:12:56\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"bob\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"135\",\r\n                \"_sequence_id\": 2,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T17:24:45\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"alice\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            ...\r\n        ]\r\n    }\r\n}\r\n```\r\n\r\n#### Example 2 - sequence query\r\n\r\nQuery: \r\n```\r\nsequence by pid\r\n[process where process.name = \"interesting.exe\"]\r\n[network where true]\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n    \"took\" : 5,\r\n    \"timed_out\" : false,\r\n    \"hits\" : {\r\n        \"total\" : {\r\n            \"value\" : 100,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"hits\" : [\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"0\",\r\n                \"_sequence_id\": 0,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T14:12:12\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        \"pid\": 4021,\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"eric\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"2\",\r\n                \"_sequence_id\": 0,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T14:12:13\",\r\n                    \"event\": {\r\n                        \"type\": \"network\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        \"pid\": 4021,\r\n                        ...\r\n                    },\r\n                    \"network\":{\r\n                        \"port\": 50392\r\n                    }\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"6\",\r\n                \"_sequence_id\": 1,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T14:12:56\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        \"pid\": 325,\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"bob\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"20\",\r\n                \"_sequence_id\": 1,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T14:13:08\",\r\n                    \"event\": {\r\n                        \"type\": \"network\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        \"pid\": 325,\r\n                        ...\r\n                    },\r\n                    \"network\":{\r\n                        \"port\": 50392\r\n                    }\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"135\",\r\n                \"_sequence_id\": 2,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T17:24:45\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        \"pid\": 200,\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"alice\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"136\",\r\n                \"_sequence_id\": 2,\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T17:24:45\",\r\n                    \"event\": {\r\n                        \"type\": \"network\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        \"pid\": 200,\r\n                        ...\r\n                    },\r\n                    \"network\":{\r\n                        \"port\": 50392\r\n                    }\r\n                    ...\r\n                }\r\n            },\r\n            ...\r\n        ]\r\n    }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565240605","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-565240605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":565240605,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTI0MDYwNQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-12-12T23:57:06Z","updated_at":"2019-12-12T23:57:06Z","author_association":"MEMBER","body":"Another option that we discussed today:\r\n\r\n### Option 4 - Define results type at top level\r\n\r\n#### Example 1 - non-sequence query\r\n\r\nQuery:\r\n```\r\nprocess where process.name = \"interesting.exe\"\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n    \"took\" : 5,\r\n    \"timed_out\" : false,\r\n    \"hits\" : {\r\n        \"total\" : {\r\n            \"value\" : 1000,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"events\" : [\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"0\",\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T14:12:12\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"eric\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"6\",\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T14:12:56\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"bob\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            {\r\n                \"_index\" : \"my_index\",\r\n                \"_id\" : \"135\",\r\n                \"_source\" : {\r\n                    \"date\" : \"2009-11-15T17:24:45\",\r\n                    \"event\": {\r\n                        \"type\": \"process\",\r\n                        ...\r\n                    },\r\n                    \"process\": {\r\n                        \"name\": \"interesting.exe\",\r\n                        ...\r\n                    },\r\n                    \"user\": {\r\n                        \"name\": \"alice\",\r\n                        ...\r\n                    },\r\n                    ...\r\n                }\r\n            },\r\n            ...\r\n        ]\r\n    }\r\n}\r\n```\r\n\r\n#### Example 2 - sequence query\r\n\r\nQuery: \r\n```\r\nsequence by pid\r\n[process where process.name = \"interesting.exe\"]\r\n[network where true]\r\n```\r\n\r\nResponse:\r\n```\r\n{\r\n    \"took\" : 5,\r\n    \"timed_out\" : false,\r\n    \"hits\" : {\r\n        \"total\" : {\r\n            \"value\" : 100,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"sequences\" : [\r\n            {\r\n                \"join_keys\": [ \"4021\" ],\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"0\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:12:12\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 4021,\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"eric\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    },\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"2\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:12:13\",\r\n                            \"event\": {\r\n                                \"type\": \"network\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 4021,\r\n                                ...\r\n                            },\r\n                            \"network\":{\r\n                                \"port\": 50392\r\n                            }\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"join_keys\": [ \"325\" ],\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"6\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:12:56\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 325,\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"bob\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    },\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"20\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T14:13:08\",\r\n                            \"event\": {\r\n                                \"type\": \"network\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 325,\r\n                                ...\r\n                            },\r\n                            \"network\":{\r\n                                \"port\": 50392\r\n                            }\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"join_keys\": [ \"200\" ],\r\n                \"events\":[\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"135\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T17:24:45\",\r\n                            \"event\": {\r\n                                \"type\": \"process\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 200,\r\n                                ...\r\n                            },\r\n                            \"user\": {\r\n                                \"name\": \"alice\",\r\n                                ...\r\n                            },\r\n                            ...\r\n                        }\r\n                    },\r\n                    {\r\n                        \"_index\" : \"my_index\",\r\n                        \"_id\" : \"136\",\r\n                        \"_source\" : {\r\n                            \"date\" : \"2009-11-15T17:24:45\",\r\n                            \"event\": {\r\n                                \"type\": \"network\",\r\n                                ...\r\n                            },\r\n                            \"process\": {\r\n                                \"name\": \"interesting.exe\",\r\n                                \"pid\": 200,\r\n                                ...\r\n                            },\r\n                            \"network\":{\r\n                                \"port\": 50392\r\n                            }\r\n                            ...\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            ...\r\n        ]\r\n    }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/566111882","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-566111882","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":566111882,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjExMTg4Mg==","user":{"login":"aleksmaus","id":872351,"node_id":"MDQ6VXNlcjg3MjM1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/872351?v=4","gravatar_id":"","url":"https://api.github.com/users/aleksmaus","html_url":"https://github.com/aleksmaus","followers_url":"https://api.github.com/users/aleksmaus/followers","following_url":"https://api.github.com/users/aleksmaus/following{/other_user}","gists_url":"https://api.github.com/users/aleksmaus/gists{/gist_id}","starred_url":"https://api.github.com/users/aleksmaus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aleksmaus/subscriptions","organizations_url":"https://api.github.com/users/aleksmaus/orgs","repos_url":"https://api.github.com/users/aleksmaus/repos","events_url":"https://api.github.com/users/aleksmaus/events{/privacy}","received_events_url":"https://api.github.com/users/aleksmaus/received_events","type":"User","site_admin":false},"created_at":"2019-12-16T15:33:55Z","updated_at":"2019-12-16T15:38:40Z","author_association":"CONTRIBUTOR","body":"Adding example of counts query response here based on conversation with @rw-access \r\n```\r\n{\r\n    \"timed_out\": false,\r\n    \"took\": 5,\r\n    \"hits\": {\r\n        \"total\" : {\r\n            \"value\" : 100,\r\n            \"relation\" : \"eq\"\r\n        },\r\n        \"counts\": [\r\n            {\r\n                \"_count\": 40,\r\n                \"_keys\": [...],\r\n                \"_percent\": 0.4223148165093,\r\n                \"_values\": [...]\r\n            },\r\n            {\r\n                \"_count\": 15,\r\n                \"_keys\": [...],\r\n                \"_percent\": 0.170275,\r\n                \"_values\": [...]\r\n            }, ...\r\n        ]\r\n    }\r\n} \r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/566138573","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-566138573","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":566138573,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjEzODU3Mw==","user":{"login":"pcsanwald","id":163306,"node_id":"MDQ6VXNlcjE2MzMwNg==","avatar_url":"https://avatars1.githubusercontent.com/u/163306?v=4","gravatar_id":"","url":"https://api.github.com/users/pcsanwald","html_url":"https://github.com/pcsanwald","followers_url":"https://api.github.com/users/pcsanwald/followers","following_url":"https://api.github.com/users/pcsanwald/following{/other_user}","gists_url":"https://api.github.com/users/pcsanwald/gists{/gist_id}","starred_url":"https://api.github.com/users/pcsanwald/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pcsanwald/subscriptions","organizations_url":"https://api.github.com/users/pcsanwald/orgs","repos_url":"https://api.github.com/users/pcsanwald/repos","events_url":"https://api.github.com/users/pcsanwald/events{/privacy}","received_events_url":"https://api.github.com/users/pcsanwald/received_events","type":"User","site_admin":false},"created_at":"2019-12-16T16:35:00Z","updated_at":"2019-12-16T16:35:00Z","author_association":"CONTRIBUTOR","body":"> To cope with this we can either define the response format as if every result has multiple events (so a result contains an array of events) and the array will only contain a single event if the query does not use sequence or join, or we can define the response so the result can contain different types of payload; event or sequence. The former has the advantage that clients has one kind of response to process and can process it in the same way every time.\r\n\r\nto add a drive by comment, I'm in favor of the former approach, unless there is a compelling reason why a single event returned would be truly a different type of thing here. Main reason being it adds complexity to both server and client in terms of constructing and parsing response, with usually a limited benefit ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/566141432","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-566141432","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":566141432,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjE0MTQzMg==","user":{"login":"stacey-gammon","id":16563603,"node_id":"MDQ6VXNlcjE2NTYzNjAz","avatar_url":"https://avatars3.githubusercontent.com/u/16563603?v=4","gravatar_id":"","url":"https://api.github.com/users/stacey-gammon","html_url":"https://github.com/stacey-gammon","followers_url":"https://api.github.com/users/stacey-gammon/followers","following_url":"https://api.github.com/users/stacey-gammon/following{/other_user}","gists_url":"https://api.github.com/users/stacey-gammon/gists{/gist_id}","starred_url":"https://api.github.com/users/stacey-gammon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stacey-gammon/subscriptions","organizations_url":"https://api.github.com/users/stacey-gammon/orgs","repos_url":"https://api.github.com/users/stacey-gammon/repos","events_url":"https://api.github.com/users/stacey-gammon/events{/privacy}","received_events_url":"https://api.github.com/users/stacey-gammon/received_events","type":"User","site_admin":false},"created_at":"2019-12-16T16:41:49Z","updated_at":"2019-12-16T16:41:49Z","author_association":"NONE","body":"The reason, imo, to allow the client to differentiate between the two different types of responses (without having to parse the request) is that the user will likely want to view them differently.  How will the user want to view a sequence query result vs the result of a \"process where true\" query?  The same or different? I think the answer is differently.  If the result of all non-sequence queries is a table, these queries can be used as a data source in Lens and they can view the results with all of the usual visualization types.    Sequence queries are special in that you probably don't want to view the results in something like a bar chart, but more like a specialized nested table structure.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/575214640","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-575214640","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":575214640,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NTIxNDY0MA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2020-01-16T15:50:09Z","updated_at":"2020-01-16T15:50:09Z","author_association":"MEMBER","body":"We meet to talk about this particularly in the context of SIEM and agreed that we will go with option 4 above for the response format.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/592082447","html_url":"https://github.com/elastic/elasticsearch/issues/49634#issuecomment-592082447","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49634","id":592082447,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MjA4MjQ0Nw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2020-02-27T17:32:02Z","updated_at":"2020-02-27T17:32:02Z","author_association":"MEMBER","body":"There are aspects to this which we need to work ourt like pagination and reposnses for pipes but they are tracked in separate issues so I'm closing this one","performed_via_github_app":null}]