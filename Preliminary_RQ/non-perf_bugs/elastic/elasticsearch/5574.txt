{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5574","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5574/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5574/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5574/events","html_url":"https://github.com/elastic/elasticsearch/issues/5574","id":30291616,"node_id":"MDU6SXNzdWUzMDI5MTYxNg==","number":5574,"title":"Inconsistent aggregation support between _search and _msearch","user":{"login":"jlecour","id":5142,"node_id":"MDQ6VXNlcjUxNDI=","avatar_url":"https://avatars3.githubusercontent.com/u/5142?v=4","gravatar_id":"","url":"https://api.github.com/users/jlecour","html_url":"https://github.com/jlecour","followers_url":"https://api.github.com/users/jlecour/followers","following_url":"https://api.github.com/users/jlecour/following{/other_user}","gists_url":"https://api.github.com/users/jlecour/gists{/gist_id}","starred_url":"https://api.github.com/users/jlecour/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlecour/subscriptions","organizations_url":"https://api.github.com/users/jlecour/orgs","repos_url":"https://api.github.com/users/jlecour/repos","events_url":"https://api.github.com/users/jlecour/events{/privacy}","received_events_url":"https://api.github.com/users/jlecour/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-03-27T11:23:12Z","updated_at":"2014-03-27T13:22:11Z","closed_at":"2014-03-27T13:21:51Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hi,\n\nWith Elasticsearch `1.0.1` (not yet verified with `1.1`), I'm having an issue with aggregations and `_search` vs. `_msearch` APIs.\n\nHere is a simple example : \n\n```\ncurl -XPOST http://localhost:9200/hotels/_search -d '{\n  \"aggs\": {\n    \"filtered_hotels\": {\n      \"filter\": {\n        \"and\": [{\n          \"terms\": {\n            \"kinds\": [\"HOT\", \"RES\"]\n          }\n        }]\n      }\n    }\n  },\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {\n        \"term\": {\n          \"destinations\": 3\n        }\n      }\n    }\n  },\n  \"size\": 0\n}'\n```\n\n``` json\n{\n  \"took\": 1,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": 230,\n    \"max_score\": 0.0,\n    \"hits\": []\n  },\n  \"aggregations\": {\n    \"filtered_hotels\": {\n      \"doc_count\": 135\n    }\n  }\n}\n```\n\nIt works fine !\n\nBut the same query, sent to the `_msearch` API returns an error : \n\n```\ncurl -XPOST http://localhost:9200/hotels/_msearch -d '{\"aggs\":{\"filtered_hotels\":{\"filter\":{\"and\":[{\"terms\":{\"kinds\":[\"HOT\",\"RES\"]}}]}}},\"query\":{\"filtered\":{\"filter\":{\"term\":{\"destinations\":3}}}},\"size\":0}\n'\n```\n\n``` json\n{\"error\":\"and doesn't support arrays\"}\n```\n\nIf I change the query to remove the `and` array (since there is a single filter in it, I also get a similar error:\n\n```\ncurl -XPOST http://localhost:9200/hotels/_msearch -d '{\"aggs\":{\"filtered_hotels\":{\"filter\":{\"terms\":{\"kinds\":[\"HOT\",\"RES\"]}}}},\"query\":{\"filtered\":{\"filter\":{\"term\":{\"destinations\":3}}}},\"size\":0}\n'\n```\n\n``` json\n{\"error\":\"kinds doesn't support arrays\"}\n```\n\nIt seems that arrays are not supported in an `_msearch` request.\n\nAm I doing something wrong?\n\nThanks for your support.\n","closed_by":{"login":"jlecour","id":5142,"node_id":"MDQ6VXNlcjUxNDI=","avatar_url":"https://avatars3.githubusercontent.com/u/5142?v=4","gravatar_id":"","url":"https://api.github.com/users/jlecour","html_url":"https://github.com/jlecour","followers_url":"https://api.github.com/users/jlecour/followers","following_url":"https://api.github.com/users/jlecour/following{/other_user}","gists_url":"https://api.github.com/users/jlecour/gists{/gist_id}","starred_url":"https://api.github.com/users/jlecour/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlecour/subscriptions","organizations_url":"https://api.github.com/users/jlecour/orgs","repos_url":"https://api.github.com/users/jlecour/repos","events_url":"https://api.github.com/users/jlecour/events{/privacy}","received_events_url":"https://api.github.com/users/jlecour/received_events","type":"User","site_admin":false},"performed_via_github_app":null}