{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5363","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5363/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5363/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5363/events","html_url":"https://github.com/elastic/elasticsearch/issues/5363","id":28958206,"node_id":"MDU6SXNzdWUyODk1ODIwNg==","number":5363,"title":"terms filter returning wrong results, maybe cache issue","user":{"login":"rslinckx","id":373249,"node_id":"MDQ6VXNlcjM3MzI0OQ==","avatar_url":"https://avatars0.githubusercontent.com/u/373249?v=4","gravatar_id":"","url":"https://api.github.com/users/rslinckx","html_url":"https://github.com/rslinckx","followers_url":"https://api.github.com/users/rslinckx/followers","following_url":"https://api.github.com/users/rslinckx/following{/other_user}","gists_url":"https://api.github.com/users/rslinckx/gists{/gist_id}","starred_url":"https://api.github.com/users/rslinckx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rslinckx/subscriptions","organizations_url":"https://api.github.com/users/rslinckx/orgs","repos_url":"https://api.github.com/users/rslinckx/repos","events_url":"https://api.github.com/users/rslinckx/events{/privacy}","received_events_url":"https://api.github.com/users/rslinckx/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":82340461,"node_id":"MDU6TGFiZWw4MjM0MDQ2MQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.13","name":"v0.90.13","color":"dddddd","default":false,"description":null},{"id":82340516,"node_id":"MDU6TGFiZWw4MjM0MDUxNg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.2","name":"v1.0.2","color":"dddddd","default":false,"description":null},{"id":75962075,"node_id":"MDU6TGFiZWw3NTk2MjA3NQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.1.0","name":"v1.1.0","color":"DDDDDD","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2014-03-07T11:13:27Z","updated_at":"2014-03-12T01:43:15Z","closed_at":"2014-03-12T01:43:15Z","author_association":"NONE","active_lock_reason":null,"body":"I'm seeing a strange behavior using elasticsearch 0.90.12.\n\nThe index contains 180269 docs\n\nI try to perform the following query:\n\n```\n{'query':\n        {'filtered':\n                {'filter': {\n                        'terms': {'id': [188915, 189067, 183817, 188969, 188425]}\n                },\n                'query': {'match_all': {}}\n                }\n        }\n}\n```\n\nIt returns more or less randomly the following list of doc ids: \n\n[183817, 188915, 188969, 189067, 188231]\nor\n[183817, 188915, 188969, 189067, 188425]\n\nAs you can see the first return value is entirely unexpected. If i add \"_cache: false\" to the terms filter it consistently returns the correct value. It also works as expected when i choose a bool execution strategy. It also work if i slightly change the list of requested ids (remove one, add one), only that specific list triggers the problem.\n\nI can't reduce the problem locally, it seems to depend on the exact state of that index and that exact lis of ID.\n\nCould it be some kind of cache collision because of the hashing algorithm used to generate the cache key, or the bitset ?\n\nIn any case this could lead to data leak since i can't trust that my filter will work as expected.. Thanks for any advice on how to debug this properly!\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}