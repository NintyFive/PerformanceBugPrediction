[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327096246","html_url":"https://github.com/elastic/elasticsearch/issues/26502#issuecomment-327096246","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26502","id":327096246,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzA5NjI0Ng==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2017-09-05T07:37:07Z","updated_at":"2017-09-05T07:37:07Z","author_association":"CONTRIBUTOR","body":"The volume of data not the complexity of the query here is likely to be the issue. Even the smallest overhead can amount to a lot when you have a tight loop on a very large number of docs. \r\nFrom [the docs](https://www.elastic.co/guide/en/elasticsearch/reference/5.5/_profiling_considerations.html):\r\n\r\n\tLike any profiler, the Profile API introduces a non-negligible overhead to search execution. \r\n\tThe act of instrumenting low-level method calls ... can be fairly expensive, since these \r\n\tmethods are called in tight loops\r\n\r\nCan you confirm the number of docs you have? If it's very large then the profiler is working-as-designed I expect.\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327097848","html_url":"https://github.com/elastic/elasticsearch/issues/26502#issuecomment-327097848","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26502","id":327097848,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzA5Nzg0OA==","user":{"login":"joedj","id":250501,"node_id":"MDQ6VXNlcjI1MDUwMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/250501?v=4","gravatar_id":"","url":"https://api.github.com/users/joedj","html_url":"https://github.com/joedj","followers_url":"https://api.github.com/users/joedj/followers","following_url":"https://api.github.com/users/joedj/following{/other_user}","gists_url":"https://api.github.com/users/joedj/gists{/gist_id}","starred_url":"https://api.github.com/users/joedj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joedj/subscriptions","organizations_url":"https://api.github.com/users/joedj/orgs","repos_url":"https://api.github.com/users/joedj/repos","events_url":"https://api.github.com/users/joedj/events{/privacy}","received_events_url":"https://api.github.com/users/joedj/received_events","type":"User","site_admin":false},"created_at":"2017-09-05T07:44:52Z","updated_at":"2017-09-05T07:44:52Z","author_association":"NONE","body":"I see, makes sense.\r\nTest env: 150 million docs\r\nProduction: 5 billion docs\r\n\r\nIs there a way to disable the profile API?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327107057","html_url":"https://github.com/elastic/elasticsearch/issues/26502#issuecomment-327107057","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26502","id":327107057,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzEwNzA1Nw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-09-05T08:25:41Z","updated_at":"2017-09-05T08:25:41Z","author_association":"CONTRIBUTOR","body":"I think @markharwood 's explanation is the right one. `org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:246)` is just a loop that iterates over matches of the query, so the more documents, the longer it takes.\r\n\r\nFor the record, profiling will have less overhead in 5.6 (#25772).\r\n\r\n> Is there a way to disable the profile API?\r\n\r\nNo. I'm not sure it would make sense to make it possible to disable it given that there are many other ways to consume a lot of CPU on a cluster that you have read access to.","performed_via_github_app":null}]