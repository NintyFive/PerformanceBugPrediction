[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/349380383","html_url":"https://github.com/elastic/elasticsearch/issues/27661#issuecomment-349380383","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27661","id":349380383,"node_id":"MDEyOklzc3VlQ29tbWVudDM0OTM4MDM4Mw==","user":{"login":"vchan2002","id":10999697,"node_id":"MDQ6VXNlcjEwOTk5Njk3","avatar_url":"https://avatars3.githubusercontent.com/u/10999697?v=4","gravatar_id":"","url":"https://api.github.com/users/vchan2002","html_url":"https://github.com/vchan2002","followers_url":"https://api.github.com/users/vchan2002/followers","following_url":"https://api.github.com/users/vchan2002/following{/other_user}","gists_url":"https://api.github.com/users/vchan2002/gists{/gist_id}","starred_url":"https://api.github.com/users/vchan2002/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vchan2002/subscriptions","organizations_url":"https://api.github.com/users/vchan2002/orgs","repos_url":"https://api.github.com/users/vchan2002/repos","events_url":"https://api.github.com/users/vchan2002/events{/privacy}","received_events_url":"https://api.github.com/users/vchan2002/received_events","type":"User","site_admin":false},"created_at":"2017-12-05T17:35:54Z","updated_at":"2017-12-05T17:35:54Z","author_association":"NONE","body":"So... going further troubleshooting... I tried to do a GET of the existing pipeline, delete it, and re-PUT it.... the 1st two steps is fine, but the last step, it complains that \r\n\r\n        \"reason\": \"[processors] required property is missing\",\r\n\r\nHowever, the ingest pipeline does have a processors property... So I'm a bit lost as to what's wrong.\r\n\r\n`{\r\n  \"filebeat-6.0.0-system-auth-pipeline\": {\r\n    \"description\": \"Pipeline for parsing system authorisation/secure logs\",\r\n    \"processors\": [\r\n      {\r\n        \"grok\": {\r\n          \"field\": \"message\",\r\n          \"ignore_missing\": true,\r\n          \"pattern_definitions\": {\r\n            \"GREEDYMULTILINE\": \"(.|\\n)*\"\r\n          },\r\n          \"patterns\": [\r\n            \"\"\"%{SYSLOGTIMESTAMP:system.auth.timestamp} %{SYSLOGHOST:system.auth.hostname} sshd(?:\\[%{POSINT:system.auth.pid}\\])?: %{DATA:system.auth.ssh.event} %{DATA:system.auth.ssh.method} for (invalid user )?%{DATA:system.auth.user} from %{IPORHOST:system.auth.ssh.ip} port %{NUMBER:system.auth.ssh.port} ssh2(: %{GREEDYDATA:system.auth.ssh.signature})?\"\"\",\r\n            \"\"\"%{SYSLOGTIMESTAMP:system.auth.timestamp} %{SYSLOGHOST:system.auth.hostname} sshd(?:\\[%{POSINT:system.auth.pid}\\])?: %{DATA:system.auth.ssh.event} user %{DATA:system.auth.user} from %{IPORHOST:system.auth.ssh.ip}\"\"\",\r\n            \"\"\"%{SYSLOGTIMESTAMP:system.auth.timestamp} %{SYSLOGHOST:system.auth.hostname} sshd(?:\\[%{POSINT:system.auth.pid}\\])?: Did not receive identification string from %{IPORHOST:system.auth.ssh.dropped_ip}\"\"\",\r\n            \"\"\"%{SYSLOGTIMESTAMP:system.auth.timestamp} %{SYSLOGHOST:system.auth.hostname} sudo(?:\\[%{POSINT:system.auth.pid}\\])?: \\s*%{DATA:system.auth.user} :( %{DATA:system.auth.sudo.error} ;)? TTY=%{DATA:system.auth.sudo.tty} ; PWD=%{DATA:system.auth.sudo.pwd} ; USER=%{DATA:system.auth.sudo.user} ; COMMAND=%{GREEDYDATA:system.auth.sudo.command}\"\"\",\r\n            \"\"\"%{SYSLOGTIMESTAMP:system.auth.timestamp} %{SYSLOGHOST:system.auth.hostname} groupadd(?:\\[%{POSINT:system.auth.pid}\\])?: new group: name=%{DATA:system.auth.groupadd.name}, GID=%{NUMBER:system.auth.groupadd.gid}\"\"\",\r\n            \"\"\"%{SYSLOGTIMESTAMP:system.auth.timestamp} %{SYSLOGHOST:system.auth.hostname} useradd(?:\\[%{POSINT:system.auth.pid}\\])?: new user: name=%{DATA:system.auth.useradd.name}, UID=%{NUMBER:system.auth.useradd.uid}, GID=%{NUMBER:system.auth.useradd.gid}, home=%{DATA:system.auth.useradd.home}, shell=%{DATA:system.auth.useradd.shell}$\"\"\",\r\n            \"\"\"%{SYSLOGTIMESTAMP:system.auth.timestamp} %{SYSLOGHOST:system.auth.hostname}? %{DATA:system.auth.program}(?:\\[%{POSINT:system.auth.pid}\\])?: %{GREEDYMULTILINE:system.auth.message}\"\"\"\r\n          ]\r\n        }\r\n      },\r\n      {\r\n        \"remove\": {\r\n          \"field\": \"message\"\r\n        }\r\n      },\r\n      {\r\n        \"date\": {\r\n          \"formats\": [\r\n            \"MMM  d HH:mm:ss\",\r\n            \"MMM dd HH:mm:ss\"\r\n          ],\r\n          \"ignore_failure\": true,\r\n          \"field\": \"system.auth.timestamp\",\r\n          \"target_field\": \"@timestamp\"\r\n        }\r\n      },\r\n      {\r\n        \"geoip\": {\r\n          \"field\": \"system.auth.ssh.ip\",\r\n          \"target_field\": \"system.auth.ssh.geoip\",\r\n          \"ignore_failure\": true\r\n        }\r\n      }\r\n    ],\r\n    \"on_failure\": [\r\n      {\r\n        \"set\": {\r\n          \"field\": \"error.message\",\r\n          \"value\": \"{{ _ingest.on_failure_message }}\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/349971811","html_url":"https://github.com/elastic/elasticsearch/issues/27661#issuecomment-349971811","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27661","id":349971811,"node_id":"MDEyOklzc3VlQ29tbWVudDM0OTk3MTgxMQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2017-12-07T13:49:04Z","updated_at":"2017-12-07T13:49:04Z","author_association":"MEMBER","body":"Hi @vchan2002, we reserve Github for bug reports and feature requests only. Please ask questions like these in the [Elasticsearch forum](https://discuss.elastic.co/c/elasticsearch) instead.\r\n\r\nI tried to reproduce your issue as follows:\r\n\r\n```\r\n# on 5.6.3:\r\n\r\ncurl -XPUT 'localhost:9200/_ingest/pipeline/ingestion-status?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"description\" : \"Sets status\",\r\n  \"processors\" : [\r\n    {\r\n      \"set\" : {\r\n        \"field\": \"status\",\r\n        \"value\": \"ingested\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n'\r\ncurl -XPOST 'http://localhost:9200/ledger/sale/_bulk?pretty&pipeline=ingestion-status' -H 'Content-Type: application/json' -d'\r\n{\"index\":{}}\r\n{\"date\": \"2015/01/01 00:00:00\", \"amount\": 200, \"type\": \"sale\", \"description\": \"something\"}\r\n{\"index\":{}}\r\n{\"date\": \"2015/01/01 00:00:00\", \"amount\": 10, \"type\": \"expense\", \"decription\": \"another thing\"}\r\n{\"index\":{}}\r\n{\"date\": \"2015/01/01 00:00:00\", \"amount\": 150, \"type\": \"sale\", \"description\": \"blah\"}\r\n'\r\n\r\ncurl -XGET 'localhost:9200/_search?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n    \"query\": {\r\n        \"match_all\": {}\r\n    }\r\n}\r\n'\r\n\r\n# do an upgrade to 6.0.0\r\n\r\n# on 6.0.0\r\ncurl -XPOST 'http://localhost:9200/ledger/sale/_bulk?pretty&pipeline=ingestion-status' -H 'Content-Type: application/json' -d'\r\n{\"index\":{}}\r\n{\"date\": \"2017/01/01 00:00:00\", \"amount\": 300, \"type\": \"sale\", \"description\": \"something\"}\r\n'\r\n\r\ncurl -XGET 'localhost:9200/_search?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n    \"query\": {\r\n        \"match_all\": {}\r\n    }\r\n}\r\n'\r\n```\r\n\r\nAll search results contained the field `status` with the value `ingested` indicating that they went through the ingest pipeline just fine (before and after the upgrade).\r\n\r\nW.r.t to the trouble that you had with recreating the ingest pipeline on 6.0.0. You've probably tried to create it as follows:\r\n\r\n```\r\ncurl -XPUT 'localhost:9200/_ingest/pipeline/filebeat-6.0.0-system-auth-pipeline?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"filebeat-6.0.0-system-auth-pipeline\": {\r\n    \"description\": \"Pipeline for parsing system authorisation/secure logs\",\r\n    \"processors\": [ ...  ]\r\n  }\r\n}\r\n'\r\n```\r\n\r\nHowever, the correct syntax is:\r\n\r\n```\r\ncurl -XPUT 'localhost:9200/_ingest/pipeline/filebeat-6.0.0-system-auth-pipeline?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n    \"description\": \"Pipeline for parsing system authorisation/secure logs\",\r\n    \"processors\": [ ...  ]\r\n}\r\n'\r\n```\r\n\r\nHope that helps you! :)","performed_via_github_app":null}]