[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/512148559","html_url":"https://github.com/elastic/elasticsearch/issues/44474#issuecomment-512148559","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44474","id":512148559,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjE0ODU1OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T08:03:53Z","updated_at":"2019-07-17T08:03:53Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/512181980","html_url":"https://github.com/elastic/elasticsearch/issues/44474#issuecomment-512181980","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44474","id":512181980,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjE4MTk4MA==","user":{"login":"karlbanke","id":6724482,"node_id":"MDQ6VXNlcjY3MjQ0ODI=","avatar_url":"https://avatars3.githubusercontent.com/u/6724482?v=4","gravatar_id":"","url":"https://api.github.com/users/karlbanke","html_url":"https://github.com/karlbanke","followers_url":"https://api.github.com/users/karlbanke/followers","following_url":"https://api.github.com/users/karlbanke/following{/other_user}","gists_url":"https://api.github.com/users/karlbanke/gists{/gist_id}","starred_url":"https://api.github.com/users/karlbanke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlbanke/subscriptions","organizations_url":"https://api.github.com/users/karlbanke/orgs","repos_url":"https://api.github.com/users/karlbanke/repos","events_url":"https://api.github.com/users/karlbanke/events{/privacy}","received_events_url":"https://api.github.com/users/karlbanke/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T09:40:44Z","updated_at":"2019-07-17T09:40:44Z","author_association":"NONE","body":"Also, when I use only either one of the two terms in the select_feed field of the percolated document it works correctly. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/513553304","html_url":"https://github.com/elastic/elasticsearch/issues/44474#issuecomment-513553304","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44474","id":513553304,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMzU1MzMwNA==","user":{"login":"hpetru","id":1880766,"node_id":"MDQ6VXNlcjE4ODA3NjY=","avatar_url":"https://avatars0.githubusercontent.com/u/1880766?v=4","gravatar_id":"","url":"https://api.github.com/users/hpetru","html_url":"https://github.com/hpetru","followers_url":"https://api.github.com/users/hpetru/followers","following_url":"https://api.github.com/users/hpetru/following{/other_user}","gists_url":"https://api.github.com/users/hpetru/gists{/gist_id}","starred_url":"https://api.github.com/users/hpetru/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hpetru/subscriptions","organizations_url":"https://api.github.com/users/hpetru/orgs","repos_url":"https://api.github.com/users/hpetru/repos","events_url":"https://api.github.com/users/hpetru/events{/privacy}","received_events_url":"https://api.github.com/users/hpetru/received_events","type":"User","site_admin":false},"created_at":"2019-07-21T13:12:59Z","updated_at":"2019-07-21T13:13:26Z","author_association":"NONE","body":"@karlbanke Hello Karl, can you proved a snippet of code which will allow me to reproduce this issue, I was trying to get the same behavior on origin/6.2 branch and had no luck.\r\nhttps://gist.github.com/hpetru/4bb2c21b309641e863debd258e60425f - here are my steps for reproducing this issue, after indexing all those documents I queried ES 15 times and always ES was returning right results","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/513837459","html_url":"https://github.com/elastic/elasticsearch/issues/44474#issuecomment-513837459","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44474","id":513837459,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMzgzNzQ1OQ==","user":{"login":"karlbanke","id":6724482,"node_id":"MDQ6VXNlcjY3MjQ0ODI=","avatar_url":"https://avatars3.githubusercontent.com/u/6724482?v=4","gravatar_id":"","url":"https://api.github.com/users/karlbanke","html_url":"https://github.com/karlbanke","followers_url":"https://api.github.com/users/karlbanke/followers","following_url":"https://api.github.com/users/karlbanke/following{/other_user}","gists_url":"https://api.github.com/users/karlbanke/gists{/gist_id}","starred_url":"https://api.github.com/users/karlbanke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlbanke/subscriptions","organizations_url":"https://api.github.com/users/karlbanke/orgs","repos_url":"https://api.github.com/users/karlbanke/repos","events_url":"https://api.github.com/users/karlbanke/events{/privacy}","received_events_url":"https://api.github.com/users/karlbanke/received_events","type":"User","site_admin":false},"created_at":"2019-07-22T15:19:35Z","updated_at":"2019-07-22T15:19:35Z","author_association":"NONE","body":"@hpetru Thanks for checking. I use the following 4 documents. \r\n\r\n`\r\n{\r\n    \"took\": 6,\r\n    \"timed_out\": false,\r\n    \"_shards\": {\r\n        \"total\": 5,\r\n        \"successful\": 5,\r\n        \"skipped\": 0,\r\n        \"failed\": 0\r\n    },\r\n    \"hits\": {\r\n        \"total\": 4,\r\n        \"max_score\": 1,\r\n        \"hits\": [\r\n            {\r\n                \"_index\": \"filterbadges\",\r\n                \"_type\": \"_doc\",\r\n                \"_id\": \"nu00GmwBIuAyBPQRqwpK\",\r\n                \"_score\": 1,\r\n                \"_source\": {\r\n                    \"query\": {\r\n                        \"bool\": {\r\n                            \"must\": [\r\n                                {\r\n                                    \"bool\": {\r\n                                        \"must\": [\r\n                                            {\r\n                                                \"bool\": {\r\n                                                    \"adjust_pure_negative\": true,\r\n                                                    \"boost\": 1\r\n                                                }\r\n                                            },\r\n                                            {\r\n                                                \"bool\": {\r\n                                                    \"should\": [\r\n                                                        {\r\n                                                            \"terms\": {\r\n                                                                \"category\": [\r\n                                                                    \"http://g2.dpa.com/cv/category/ku\"\r\n                                                                ],\r\n                                                                \"boost\": 1\r\n                                                            }\r\n                                                        }\r\n                                                    ],\r\n                                                    \"adjust_pure_negative\": true,\r\n                                                    \"boost\": 1\r\n                                                }\r\n                                            }\r\n                                        ],\r\n                                        \"adjust_pure_negative\": true,\r\n                                        \"boost\": 1\r\n                                    }\r\n                                },\r\n                                {\r\n                                    \"terms\": {\r\n                                        \"select_feeds\": [\r\n                                            \"sel_SpringerFachmedien\",\r\n                                            \"sel_VolkswagenAG\"\r\n                                        ],\r\n                                        \"boost\": 1\r\n                                    }\r\n                                }\r\n                            ],\r\n                            \"adjust_pure_negative\": true,\r\n                            \"boost\": 1\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                \"_index\": \"filterbadges\",\r\n                \"_type\": \"_doc\",\r\n                \"_id\": \"ee0zGmwBIuAyBPQRtgqM\",\r\n                \"_score\": 1,\r\n                \"_source\": {\r\n                    \"query\": {\r\n                        \"bool\": {\r\n                            \"must\": [\r\n                                {\r\n                                    \"bool\": {\r\n                                        \"must\": [\r\n                                            {\r\n                                                \"bool\": {\r\n                                                    \"adjust_pure_negative\": true,\r\n                                                    \"boost\": 1\r\n                                                }\r\n                                            },\r\n                                            {\r\n                                                \"bool\": {\r\n                                                    \"should\": [\r\n                                                        {\r\n                                                            \"terms\": {\r\n                                                                \"category\": [\r\n                                                                    \"http://g2.dpa.com/cv/category/pl\"\r\n                                                                ],\r\n                                                                \"boost\": 1\r\n                                                            }\r\n                                                        }\r\n                                                    ],\r\n                                                    \"adjust_pure_negative\": true,\r\n                                                    \"boost\": 1\r\n                                                }\r\n                                            }\r\n                                        ],\r\n                                        \"adjust_pure_negative\": true,\r\n                                        \"boost\": 1\r\n                                    }\r\n                                },\r\n                                {\r\n                                    \"terms\": {\r\n                                        \"select_feeds\": [\r\n                                            \"sel_SpringerFachmedien\",\r\n                                            \"sel_VolkswagenAG\"\r\n                                        ],\r\n                                        \"boost\": 1\r\n                                    }\r\n                                }\r\n                            ],\r\n                            \"adjust_pure_negative\": true,\r\n                            \"boost\": 1\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                \"_index\": \"filterbadges\",\r\n                \"_type\": \"_doc\",\r\n                \"_id\": \"VO05GmwBIuAyBPQRJgvr\",\r\n                \"_score\": 1,\r\n                \"_source\": {\r\n                    \"query\": {\r\n                        \"bool\": {\r\n                            \"must\": [\r\n                                {\r\n                                    \"bool\": {\r\n                                        \"must\": [\r\n                                            {\r\n                                                \"bool\": {\r\n                                                    \"adjust_pure_negative\": true,\r\n                                                    \"boost\": 1\r\n                                                }\r\n                                            },\r\n                                            {\r\n                                                \"bool\": {\r\n                                                    \"should\": [\r\n                                                        {\r\n                                                            \"terms\": {\r\n                                                                \"category\": [\r\n                                                                    \"http://g2.dpa.com/cv/category/pl\"\r\n                                                                ],\r\n                                                                \"boost\": 1\r\n                                                            }\r\n                                                        }\r\n                                                    ],\r\n                                                    \"adjust_pure_negative\": true,\r\n                                                    \"boost\": 1\r\n                                                }\r\n                                            }\r\n                                        ],\r\n                                        \"adjust_pure_negative\": true,\r\n                                        \"boost\": 1\r\n                                    }\r\n                                },\r\n                                {\r\n                                    \"terms\": {\r\n                                        \"select_feeds\": [\r\n                                            \"sel_SpringerFachmedien\",\r\n                                            \"sel_VolkswagenAG\",\r\n                                            \"sel_SomeYetOther\",\r\n                                            \"sel_SomeTotallyOther\"\r\n                                        ],\r\n                                        \"boost\": 1\r\n                                    }\r\n                                }\r\n                            ],\r\n                            \"adjust_pure_negative\": true,\r\n                            \"boost\": 1\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                \"_index\": \"filterbadges\",\r\n                \"_type\": \"_doc\",\r\n                \"_id\": \"Te04GmwBIuAyBPQR_Qvq\",\r\n                \"_score\": 1,\r\n                \"_source\": {\r\n                    \"query\": {\r\n                        \"bool\": {\r\n                            \"must\": [\r\n                                {\r\n                                    \"bool\": {\r\n                                        \"must\": [\r\n                                            {\r\n                                                \"bool\": {\r\n                                                    \"adjust_pure_negative\": true,\r\n                                                    \"boost\": 1\r\n                                                }\r\n                                            },\r\n                                            {\r\n                                                \"bool\": {\r\n                                                    \"should\": [\r\n                                                        {\r\n                                                            \"terms\": {\r\n                                                                \"category\": [\r\n                                                                    \"http://g2.dpa.com/cv/category/ku\"\r\n                                                                ],\r\n                                                                \"boost\": 1\r\n                                                            }\r\n                                                        }\r\n                                                    ],\r\n                                                    \"adjust_pure_negative\": true,\r\n                                                    \"boost\": 1\r\n                                                }\r\n                                            }\r\n                                        ],\r\n                                        \"adjust_pure_negative\": true,\r\n                                        \"boost\": 1\r\n                                    }\r\n                                },\r\n                                {\r\n                                    \"terms\": {\r\n                                        \"select_feeds\": [\r\n                                            \"sel_SpringerFachmedien\",\r\n                                            \"sel_VolkswagenAG\",\r\n                                            \"sel_SomeOther\",\r\n                                            \"sel_SomeTotallyOther\"\r\n                                        ],\r\n                                        \"boost\": 1\r\n                                    }\r\n                                }\r\n                            ],\r\n                            \"adjust_pure_negative\": true,\r\n                            \"boost\": 1\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        ]\r\n    }\r\n}\r\n`\r\n\r\nAnd the following query\r\n\r\n`{\r\n   \"size\":\"1000\",\r\n   \"sort\":[\r\n      {\r\n         \"_id\":{\r\n            \"order\":\"asc\"\r\n         }\r\n      }\r\n   ],\r\n   \"query\":{\r\n      \"percolate\":{\r\n         \"field\":\"query\",\r\n         \"document\":{\r\n            \"select_feeds\":[\r\n               \"sel_SpringerFachmedien\",\r\n               \"sel_VolkswagenAG\"\r\n            ],\r\n            \"category\":[\r\n               \"http://g2.dpa.com/cv/category/pl\"\r\n            ]\r\n         }\r\n      }\r\n   }\r\n}`\r\n\r\nagainst the Elasticsearch 6.2.0 Docker Container. This returns 4 hits (all documents!) instead of the expected 2. \r\n\r\nAs soon as I provide only one feed for the document the result is correct (query see below).\r\n\r\n`{\r\n   \"size\":\"1000\",\r\n   \"sort\":[\r\n      {\r\n         \"_id\":{\r\n            \"order\":\"asc\"\r\n         }\r\n      }\r\n   ],\r\n   \"query\":{\r\n      \"percolate\":{\r\n         \"field\":\"query\",\r\n         \"document\":{\r\n            \"select_feeds\":[\r\n               \"sel_SpringerFachmedien\"\r\n            ],\r\n            \"category\":[\r\n               \"http://g2.dpa.com/cv/category/pl\"\r\n            ]\r\n         }\r\n      }\r\n   }\r\n}`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/517933871","html_url":"https://github.com/elastic/elasticsearch/issues/44474#issuecomment-517933871","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44474","id":517933871,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNzkzMzg3MQ==","user":{"login":"hpetru","id":1880766,"node_id":"MDQ6VXNlcjE4ODA3NjY=","avatar_url":"https://avatars0.githubusercontent.com/u/1880766?v=4","gravatar_id":"","url":"https://api.github.com/users/hpetru","html_url":"https://github.com/hpetru","followers_url":"https://api.github.com/users/hpetru/followers","following_url":"https://api.github.com/users/hpetru/following{/other_user}","gists_url":"https://api.github.com/users/hpetru/gists{/gist_id}","starred_url":"https://api.github.com/users/hpetru/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hpetru/subscriptions","organizations_url":"https://api.github.com/users/hpetru/orgs","repos_url":"https://api.github.com/users/hpetru/repos","events_url":"https://api.github.com/users/hpetru/events{/privacy}","received_events_url":"https://api.github.com/users/hpetru/received_events","type":"User","site_admin":false},"created_at":"2019-08-03T15:41:34Z","updated_at":"2019-08-03T15:43:55Z","author_association":"NONE","body":"This bug can be found in 6.2.0, 6.2.1, 6.2.2, 6.2.3, the 6.2.4 version is fixed\r\nthis commit https://github.com/elastic/elasticsearch/commit/12b50ab89a08e11d003f43efcab21004fa3bf1b4 which was applied to version 6.2.4 solves bug described by you above\r\n\r\nYou should just update your ES server from 6.2.0 to 6.2.4","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/590842636","html_url":"https://github.com/elastic/elasticsearch/issues/44474#issuecomment-590842636","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44474","id":590842636,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MDg0MjYzNg==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2020-02-25T12:28:56Z","updated_at":"2020-02-25T12:28:56Z","author_association":"CONTRIBUTOR","body":"Fixed by 12b50ab","performed_via_github_app":null}]