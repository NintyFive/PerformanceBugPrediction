{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44808","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44808/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44808/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44808/events","html_url":"https://github.com/elastic/elasticsearch/issues/44808","id":472236047,"node_id":"MDU6SXNzdWU0NzIyMzYwNDc=","number":44808,"title":"[ML] Failures in mixed cluster BWC tests for data frame transforms crud","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"assignees":[{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-07-24T11:43:16Z","updated_at":"2019-09-18T13:29:29Z","closed_at":"2019-09-18T13:29:29Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Build link: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+matrix-java-periodic/ES_BUILD_JAVA=openjdk12,ES_RUNTIME_JAVA=zulu11,nodes=general-purpose/100/console\r\n\r\nReproduce:\r\n\r\n```\r\n./gradlew :x-pack:qa:rolling-upgrade:v7.3.0#twoThirdsUpgradedTestRunner --tests \"org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT.test {p0=mixed_cluster/80_data_frame_jobs_crud/Test GET, start, and stop old cluster batch transforms}\" -Dtests.seed=CEB38F680E8C42A6 -Dtests.security.manager=true -Dtests.locale=fr-BF -Dtests.timezone=Asia/Qyzylorda -Dcompiler.java=12 -Druntime.java=11 -Dtests.rest.suite=mixed_cluster\r\n```\r\n\r\nFailure:\r\n\r\n```\r\norg.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT > test {p0=mixed_cluster/80_data_frame_jobs_crud/Test GET, start, and stop old cluster batch transforms} FAILED\r\n    java.lang.AssertionError: Failure at [mixed_cluster/80_data_frame_jobs_crud:189]: expected [2xx] status code but api [data_frame.stop_data_frame_transform] returned [409 Conflict] [{\"error\":{\"root_cause\":[{\"type\":\"status_exception\",\"reason\":\"Unable to stop data frame transform [old-complex-transform] as it is in a failed state with reason [Failed to load data frame transform state for transform [old-complex-transform]]. Use force stop to stop the data frame transform.\",\"stack_trace\":\"ElasticsearchStatusException[Unable to stop data frame transform [old-complex-transform] as it is in a failed state with reason [Failed to load data frame transform state for transform [old-complex-transform]]. Use force stop to stop the data frame transform.]\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.validateTaskState(TransportStopDataFrameTransformAction.java:93)\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.lambda$doExecute$0(TransportStopDataFrameTransformAction.java:123)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.xpack.dataframe.persistence.DataFrameTransformsConfigManager.lambda$expandTransformIds$6(DataFrameTransformsConfigManager.java:244)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:68)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.sendSearchResponse(AbstractSearchAsyncAction.java:300)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$3.run(FetchSearchPhase.java:213)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:171)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:165)\\n\\tat org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:119)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:171)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:165)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:206)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$2(FetchSearchPhase.java:104)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:110)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.access$000(FetchSearchPhase.java:44)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:86)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.lang.Thread.run(Thread.java:834)\\n\"}],\"type\":\"status_exception\",\"reason\":\"Unable to stop data frame transform [old-complex-transform] as it is in a failed state with reason [Failed to load data frame transform state for transform [old-complex-transform]]. Use force stop to stop the data frame transform.\",\"stack_trace\":\"ElasticsearchStatusException[Unable to stop data frame transform [old-complex-transform] as it is in a failed state with reason [Failed to load data frame transform state for transform [old-complex-transform]]. Use force stop to stop the data frame transform.]\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.validateTaskState(TransportStopDataFrameTransformAction.java:93)\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.lambda$doExecute$0(TransportStopDataFrameTransformAction.java:123)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.xpack.dataframe.persistence.DataFrameTransformsConfigManager.lambda$expandTransformIds$6(DataFrameTransformsConfigManager.java:244)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:68)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.sendSearchResponse(AbstractSearchAsyncAction.java:300)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$3.run(FetchSearchPhase.java:213)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:171)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:165)\\n\\tat org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:119)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:171)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:165)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:206)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$2(FetchSearchPhase.java:104)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:110)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.access$000(FetchSearchPhase.java:44)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:86)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.lang.Thread.run(Thread.java:834)\\n\"},\"status\":409}]\r\n\r\n        Caused by:\r\n        java.lang.AssertionError: expected [2xx] status code but api [data_frame.stop_data_frame_transform] returned [409 Conflict] [{\"error\":{\"root_cause\":[{\"type\":\"status_exception\",\"reason\":\"Unable to stop data frame transform [old-complex-transform] as it is in a failed state with reason [Failed to load data frame transform state for transform [old-complex-transform]]. Use force stop to stop the data frame transform.\",\"stack_trace\":\"ElasticsearchStatusException[Unable to stop data frame transform [old-complex-transform] as it is in a failed state with reason [Failed to load data frame transform state for transform [old-complex-transform]]. Use force stop to stop the data frame transform.]\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.validateTaskState(TransportStopDataFrameTransformAction.java:93)\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.lambda$doExecute$0(TransportStopDataFrameTransformAction.java:123)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.xpack.dataframe.persistence.DataFrameTransformsConfigManager.lambda$expandTransformIds$6(DataFrameTransformsConfigManager.java:244)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:68)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.sendSearchResponse(AbstractSearchAsyncAction.java:300)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$3.run(FetchSearchPhase.java:213)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:171)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:165)\\n\\tat org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:119)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:171)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:165)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:206)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$2(FetchSearchPhase.java:104)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:110)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.access$000(FetchSearchPhase.java:44)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:86)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.lang.Thread.run(Thread.java:834)\\n\"}],\"type\":\"status_exception\",\"reason\":\"Unable to stop data frame transform [old-complex-transform] as it is in a failed state with reason [Failed to load data frame transform state for transform [old-complex-transform]]. Use force stop to stop the data frame transform.\",\"stack_trace\":\"ElasticsearchStatusException[Unable to stop data frame transform [old-complex-transform] as it is in a failed state with reason [Failed to load data frame transform state for transform [old-complex-transform]]. Use force stop to stop the data frame transform.]\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.validateTaskState(TransportStopDataFrameTransformAction.java:93)\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.lambda$doExecute$0(TransportStopDataFrameTransformAction.java:123)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.xpack.dataframe.persistence.DataFrameTransformsConfigManager.lambda$expandTransformIds$6(DataFrameTransformsConfigManager.java:244)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:68)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.sendSearchResponse(AbstractSearchAsyncAction.java:300)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$3.run(FetchSearchPhase.java:213)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:171)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:165)\\n\\tat org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:119)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:171)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:165)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:206)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$2(FetchSearchPhase.java:104)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:110)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.access$000(FetchSearchPhase.java:44)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:86)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.lang.Thread.run(Thread.java:834)\\n\"},\"status\":409}]\r\n```\r\n\r\n","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}