[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/55124637","html_url":"https://github.com/elastic/elasticsearch/issues/7673#issuecomment-55124637","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7673","id":55124637,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MTI0NjM3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-09-10T14:39:17Z","updated_at":"2014-09-10T14:39:17Z","author_association":"CONTRIBUTOR","body":"thanks for the report @glelouarn - we'll take a look \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67824877","html_url":"https://github.com/elastic/elasticsearch/issues/7673#issuecomment-67824877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7673","id":67824877,"node_id":"MDEyOklzc3VlQ29tbWVudDY3ODI0ODc3","user":{"login":"glelouarn","id":1512261,"node_id":"MDQ6VXNlcjE1MTIyNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/1512261?v=4","gravatar_id":"","url":"https://api.github.com/users/glelouarn","html_url":"https://github.com/glelouarn","followers_url":"https://api.github.com/users/glelouarn/followers","following_url":"https://api.github.com/users/glelouarn/following{/other_user}","gists_url":"https://api.github.com/users/glelouarn/gists{/gist_id}","starred_url":"https://api.github.com/users/glelouarn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glelouarn/subscriptions","organizations_url":"https://api.github.com/users/glelouarn/orgs","repos_url":"https://api.github.com/users/glelouarn/repos","events_url":"https://api.github.com/users/glelouarn/events{/privacy}","received_events_url":"https://api.github.com/users/glelouarn/received_events","type":"User","site_admin":false},"created_at":"2014-12-22T10:55:41Z","updated_at":"2014-12-22T10:55:41Z","author_association":"NONE","body":"Hi work on it and initialized the pull request https://github.com/elasticsearch/elasticsearch/pull/9029\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/73036699","html_url":"https://github.com/elastic/elasticsearch/issues/7673#issuecomment-73036699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7673","id":73036699,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDM2Njk5","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-02-05T12:11:35Z","updated_at":"2015-02-05T15:01:28Z","author_association":"MEMBER","body":"I encountered similar problems while working on #9062. The problem is in the way Rounding.nextRoundingValue() is used when adding empty buckets in InternalHistogram.addEmptyBuckets(). The assumtion there is that when adding time durations (like 1M) to the key of an existing (non-empty) bucket to fill the histogram with empty buckets one always ends up with the key of the next non-empty bucket.\n\ne.g. in the example about one would expect\n\nnextRoundingValue(\"2013-06-30--22:00:00.000+0000\") => \"2013-07-31--22:00:00.000+0000\"\n(well, that is 2hour before the 1st of next month)\n\nInternally we use DurationField.add() from Joda-Time, but that works in a slightly different way (at least for months), e.g. if you start with 2014-01-31T22:00:00.000Z and then add 1month durations consecutively one gets:\n\n2014-01-31T22:00:00.000Z + month -> 2014-02-28T22:00:00.000Z\n2014-02-28T22:00:00.000Z + month -> 2014-03-28T22:00:00.000Z\n2014-03-28T22:00:00.000Z + month -> 2014-04-28T22:00:00.000Z\netc...\n\nbut the following rounded non-empty buckets will have keys 2014-03-31T22:00:00.000Z, 2014-04-30T22:00:00.000Z etc...\n\nThe time-zone offset is just one way to run into this. I think that any offset (could be positive as well) that makes bucket keys lie in the range of day_of_month in 28-31 will likely result in the same glitch, at least for DateTimeUnit.MONTH_OF_YEAR and above. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76688306","html_url":"https://github.com/elastic/elasticsearch/issues/7673#issuecomment-76688306","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7673","id":76688306,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Njg4MzA2","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-03-02T10:24:33Z","updated_at":"2015-03-02T10:24:33Z","author_association":"MEMBER","body":"This is fixed on 1.4 and 1.x with https://github.com/elasticsearch/elasticsearch/pull/9790 I think.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/82527795","html_url":"https://github.com/elastic/elasticsearch/issues/7673#issuecomment-82527795","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7673","id":82527795,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTI3Nzk1","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-03-17T18:56:35Z","updated_at":"2015-03-17T18:56:35Z","author_association":"MEMBER","body":"The fix for this will be in the next release (either 1.4.5 or 1.5).\n","performed_via_github_app":null}]