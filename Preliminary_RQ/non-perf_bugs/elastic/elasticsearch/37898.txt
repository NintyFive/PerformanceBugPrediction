{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37898","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37898/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37898/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37898/events","html_url":"https://github.com/elastic/elasticsearch/issues/37898","id":403393970,"node_id":"MDU6SXNzdWU0MDMzOTM5NzA=","number":37898,"title":"DynamicMappingIT#testConflictingDynamicMappings can fail with IllegalArgumentException","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2019-01-26T02:07:48Z","updated_at":"2019-02-22T16:10:03Z","closed_at":"2019-02-01T07:35:30Z","author_association":"MEMBER","active_lock_reason":null,"body":"I wasn't able to reproduce this locally, but the same error has popped up a few times on CI in the past couple days. It looks like we might receive an unexpected exception type when merging conflicting mappings.\r\n\r\n---\r\n\r\nLink to the build: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+release-tests/408\r\n\r\nCommand to reproduce: \r\n```\r\n./gradlew :server:integTest \\\r\n  -Dtests.seed=3735D88AEB8647FB \\\r\n  -Dtests.class=org.elasticsearch.index.mapper.DynamicMappingIT \\\r\n  -Dtests.method=\"testConflictingDynamicMappings\" \\\r\n```\r\n\r\nRelevant excerpt from logs:\r\n```\r\nERROR   0.12s J7 | DynamicMappingIT.testConflictingDynamicMappings <<< FAILURES!\r\n   > Throwable #1: java.lang.IllegalArgumentException: mapper [foo] of different type, current_type [long], merged_type [text]\r\n   > \tat __randomizedtesting.SeedInfo.seed([3735D88AEB8647FB:55D09E8433A4A293]:0)\r\n   > \tat org.elasticsearch.index.mapper.FieldMapper.doMerge(FieldMapper.java:354)\r\n   > \tat org.elasticsearch.index.mapper.NumberFieldMapper.doMerge(NumberFieldMapper.java:1093)\r\n   > \tat org.elasticsearch.index.mapper.FieldMapper.merge(FieldMapper.java:340)\r\n   > \tat org.elasticsearch.index.mapper.FieldMapper.merge(FieldMapper.java:52)\r\n   > \tat org.elasticsearch.index.mapper.ObjectMapper.doMerge(ObjectMapper.java:487)\r\n   > \tat org.elasticsearch.index.mapper.RootObjectMapper.doMerge(RootObjectMapper.java:278)\r\n   > \tat org.elasticsearch.index.mapper.ObjectMapper.merge(ObjectMapper.java:457)\r\n   > \tat org.elasticsearch.index.mapper.RootObjectMapper.merge(RootObjectMapper.java:273)\r\n   > \tat org.elasticsearch.index.mapper.Mapping.merge(Mapping.java:91)\r\n   > \tat org.elasticsearch.index.mapper.DocumentMapper.merge(DocumentMapper.java:339)\r\n   > \tat org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.applyRequest(MetaDataMappingService.java:286)\r\n   > \tat org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.execute(MetaDataMappingService.java:232)\r\n   > \tat org.elasticsearch.cluster.service.MasterService.executeTasks(MasterService.java:642)\r\n   > \tat org.elasticsearch.cluster.service.MasterService.calculateTaskOutputs(MasterService.java:271)\r\n   > \tat org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:201)\r\n   > \tat org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:136)\r\n```","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}