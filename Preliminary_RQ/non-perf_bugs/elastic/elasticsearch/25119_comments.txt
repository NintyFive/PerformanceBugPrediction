[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307120629","html_url":"https://github.com/elastic/elasticsearch/issues/25119#issuecomment-307120629","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25119","id":307120629,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzEyMDYyOQ==","user":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"created_at":"2017-06-08T14:28:18Z","updated_at":"2017-06-08T14:28:18Z","author_association":"CONTRIBUTOR","body":"I'm curious about how other repositories that use distributed storage manage this sort of problem (like Azure or S3). If their services are unavailable when the plugin starts, do they also fail in this way? Is there any sort of official stance or documentation that we have in regard to how repository plugins are expected to manage long lived connection resources? Perhaps @imotov has some insight on this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307193532","html_url":"https://github.com/elastic/elasticsearch/issues/25119#issuecomment-307193532","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25119","id":307193532,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzE5MzUzMg==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-06-08T18:48:37Z","updated_at":"2017-06-08T18:48:37Z","author_association":"MEMBER","body":"@jbaiera Why would there be a need for a long lived connection? Starting up ES should not cause a connection to the service, except perhaps to verify settings. For example, with the s3 repository, starting up ES only gathers settings. Creating an s3 repository will attempt to connect to s3 to find if the bucket exists.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307293886","html_url":"https://github.com/elastic/elasticsearch/issues/25119#issuecomment-307293886","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25119","id":307293886,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzI5Mzg4Ng==","user":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"created_at":"2017-06-09T04:42:04Z","updated_at":"2017-06-09T04:42:04Z","author_association":"CONTRIBUTOR","body":"@rjernst In this case I am talking about a node coming online with a previously configured repository. My understanding at the moment (and please correct me if I'm wrong, I'm only just now starting to dive into the lifecycle code) is that if the cluster state contains a repository at start up, then that repository is created when the repository service comes online. If the node can't reach S3 at this time, looking at the code I would assume that creating the repository would fail because it cannot verify the existence of the S3 bucket. This is currently how it is for HDFS as well - The client cannot connect to HDFS and thus fails. My previous post is about whether or not this failure to create the connection makes sense to occur when the repository is created or if it should happen later on when trying to use the repository.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308179177","html_url":"https://github.com/elastic/elasticsearch/issues/25119#issuecomment-308179177","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25119","id":308179177,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODE3OTE3Nw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-06-13T16:50:30Z","updated_at":"2017-06-13T16:50:30Z","author_association":"MEMBER","body":">  My previous post is about whether or not this failure to create the connection makes sense to occur when the repository is created or if it should happen later on when trying to use the repository.\r\n\r\nI think it makes sense as is. Otherwise a misconfiguration is not found until trying to create a snapshot, vs when creating the repository.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308231859","html_url":"https://github.com/elastic/elasticsearch/issues/25119#issuecomment-308231859","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25119","id":308231859,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODIzMTg1OQ==","user":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"created_at":"2017-06-13T20:03:47Z","updated_at":"2017-06-13T20:03:47Z","author_association":"CONTRIBUTOR","body":"@rjernst I agree with you on that. I don't think there's any way for us to distinguish the difference between a repository being added via a request, or a repository being added because a node is coming online. Based on this, I'm inclined to say that if a deployment is actively configured to use HDFS as a repository, then HDFS must be running and available when nodes in that deployment come online. I don't see any way to get around this at this time unless we make serious changes to the repository mechanisms.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308264786","html_url":"https://github.com/elastic/elasticsearch/issues/25119#issuecomment-308264786","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25119","id":308264786,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODI2NDc4Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-06-13T22:16:27Z","updated_at":"2017-06-13T22:16:27Z","author_association":"MEMBER","body":"> I'm inclined to say that if a deployment is actively configured to use HDFS as a repository, then HDFS must be running and available when nodes in that deployment come online\r\n\r\nI agree. Can you update repository-hdfs docs with this requirement?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309113422","html_url":"https://github.com/elastic/elasticsearch/issues/25119#issuecomment-309113422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25119","id":309113422,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTExMzQyMg==","user":{"login":"inqueue","id":6099128,"node_id":"MDQ6VXNlcjYwOTkxMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/6099128?v=4","gravatar_id":"","url":"https://api.github.com/users/inqueue","html_url":"https://github.com/inqueue","followers_url":"https://api.github.com/users/inqueue/followers","following_url":"https://api.github.com/users/inqueue/following{/other_user}","gists_url":"https://api.github.com/users/inqueue/gists{/gist_id}","starred_url":"https://api.github.com/users/inqueue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/inqueue/subscriptions","organizations_url":"https://api.github.com/users/inqueue/orgs","repos_url":"https://api.github.com/users/inqueue/repos","events_url":"https://api.github.com/users/inqueue/events{/privacy}","received_events_url":"https://api.github.com/users/inqueue/received_events","type":"User","site_admin":false},"created_at":"2017-06-16T19:24:03Z","updated_at":"2017-06-16T19:24:03Z","author_association":"MEMBER","body":"Use case for this report:\r\n* Target repo has been created and exists on HDFS\r\n* Snapshots are made regularly to existing HDFS repo\r\n\r\nSeries of events:\r\n1) Hadoop and Elasticsearch clusters are restarted, Elasticsearch before Hadoop. HDFS is not running when Elasticsearch starts.\r\n2) HDFS repo is started.\r\n3) With HDFS and Elasticsearch now running, the next scheduled snapshot fails with the error.\r\n\r\nhttps://github.com/elastic/elasticsearch/pull/25220 should address it as there appears to be no other technical solution for this condition.","performed_via_github_app":null}]