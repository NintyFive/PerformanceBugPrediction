{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36229","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36229/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36229/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36229/events","html_url":"https://github.com/elastic/elasticsearch/issues/36229","id":387433978,"node_id":"MDU6SXNzdWUzODc0MzM5Nzg=","number":36229,"title":"Rollup searches based on \"obsolete\" timezones fail","user":{"login":"cjcenizal","id":1238659,"node_id":"MDQ6VXNlcjEyMzg2NTk=","avatar_url":"https://avatars2.githubusercontent.com/u/1238659?v=4","gravatar_id":"","url":"https://api.github.com/users/cjcenizal","html_url":"https://github.com/cjcenizal","followers_url":"https://api.github.com/users/cjcenizal/followers","following_url":"https://api.github.com/users/cjcenizal/following{/other_user}","gists_url":"https://api.github.com/users/cjcenizal/gists{/gist_id}","starred_url":"https://api.github.com/users/cjcenizal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cjcenizal/subscriptions","organizations_url":"https://api.github.com/users/cjcenizal/orgs","repos_url":"https://api.github.com/users/cjcenizal/repos","events_url":"https://api.github.com/users/cjcenizal/events{/privacy}","received_events_url":"https://api.github.com/users/cjcenizal/received_events","type":"User","site_admin":false},"labels":[{"id":912843355,"node_id":"MDU6TGFiZWw5MTI4NDMzNTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Rollup","name":":Analytics/Rollup","color":"0e8a16","default":false,"description":"Turn fine-grained time-based data into coarser-grained data"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-12-04T19:01:36Z","updated_at":"2019-04-17T17:33:52Z","closed_at":"2019-04-17T17:33:52Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This originated from https://discuss.elastic.co/t/visualizing-rollup-index-with-timezone-result-in-error/159064/2. CC @polyfractal \r\n\r\nTo reproduce, follow these steps to create data, a rollup job, and a search on the rolled-up data:\r\n\r\n```\r\nPUT test_index\r\n\r\nPUT test_index/_doc/1\r\n{\r\n  \"utc_time\" : \"2018-12-02T16:02:19.851Z\"\r\n}\r\n\r\nPUT _xpack/rollup/job/test_job\r\n{\r\n    \"index_pattern\": \"test_index\",\r\n    \"rollup_index\": \"test_index_rollup\",\r\n    \"cron\": \"0 * * * * ?\",\r\n    \"groups\": {\r\n      \"date_histogram\": {\r\n        \"interval\": \"24h\",\r\n        \"field\": \"utc_time\",\r\n        \"time_zone\": \"Canada/Mountain\"\r\n      }\r\n    },\r\n    \"metrics\": [],\r\n    \"page_size\": 1000\r\n}\r\n\r\nPOST _xpack/rollup/job/test_job/_start\r\n\r\nGET test_index_rollup/_rollup_search\r\n{  \r\n   \"size\":0,\r\n   \"aggregations\":{  \r\n      \"2\":{  \r\n         \"date_histogram\":{  \r\n            \"field\":\"order_date\",\r\n            \"interval\":\"24h\",\r\n            \"time_zone\":\"Canada/Mountain\",\r\n            \"min_doc_count\":1\r\n         }\r\n      }\r\n   }\r\n}\r\n```\r\n\r\nThe search will fail with this error:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"There is not a rollup job that has a [date_histogram] agg on field [order_date] which also satisfies all requirements of query.\"\r\n      }\r\n    ],\r\n    \"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"There is not a rollup job that has a [date_histogram] agg on field [order_date] which also satisfies all requirements of query.\"\r\n  },\r\n  \"status\": 400\r\n}\r\n```","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}