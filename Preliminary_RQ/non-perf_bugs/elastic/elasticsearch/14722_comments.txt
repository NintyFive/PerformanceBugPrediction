[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/156311221","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-156311221","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":156311221,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NjMxMTIyMQ==","user":{"login":"ebradshaw","id":3810632,"node_id":"MDQ6VXNlcjM4MTA2MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/3810632?v=4","gravatar_id":"","url":"https://api.github.com/users/ebradshaw","html_url":"https://github.com/ebradshaw","followers_url":"https://api.github.com/users/ebradshaw/followers","following_url":"https://api.github.com/users/ebradshaw/following{/other_user}","gists_url":"https://api.github.com/users/ebradshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ebradshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebradshaw/subscriptions","organizations_url":"https://api.github.com/users/ebradshaw/orgs","repos_url":"https://api.github.com/users/ebradshaw/repos","events_url":"https://api.github.com/users/ebradshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ebradshaw/received_events","type":"User","site_admin":false},"created_at":"2015-11-13T03:18:19Z","updated_at":"2015-11-13T03:18:19Z","author_association":"NONE","body":"Also, this is appearing in both 1.4.2 and 1.7.3.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/156330169","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-156330169","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":156330169,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NjMzMDE2OQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-13T05:55:11Z","updated_at":"2015-11-13T05:55:11Z","author_association":"MEMBER","body":"I think you should wait for a yellow status before sending your search request.\n\nBTW you did not tell which exception you are getting and Es version.\n\nDoes not look like an issue to me.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/156413437","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-156413437","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":156413437,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NjQxMzQzNw==","user":{"login":"ebradshaw","id":3810632,"node_id":"MDQ6VXNlcjM4MTA2MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/3810632?v=4","gravatar_id":"","url":"https://api.github.com/users/ebradshaw","html_url":"https://github.com/ebradshaw","followers_url":"https://api.github.com/users/ebradshaw/followers","following_url":"https://api.github.com/users/ebradshaw/following{/other_user}","gists_url":"https://api.github.com/users/ebradshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ebradshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebradshaw/subscriptions","organizations_url":"https://api.github.com/users/ebradshaw/orgs","repos_url":"https://api.github.com/users/ebradshaw/repos","events_url":"https://api.github.com/users/ebradshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ebradshaw/received_events","type":"User","site_admin":false},"created_at":"2015-11-13T12:07:02Z","updated_at":"2015-11-15T00:42:17Z","author_association":"NONE","body":"Thanks for the quick reply, David.\n\nI've tried this with both ES version 1.4.2 and 1.7.3.  Regarding the status, as I understand it ensureSearchable(...) verifies that the index status is GREEN, and I call this before doing the final count.  \n\nI've also added a _refresh call into the test case, as that was necessary for the first assertion to pass:\n\nhttps://gist.github.com/ebradshaw/a4fa97b7eac4257c4a2e\n\nRegardless, the last assertion fails with:\n\njava.lang.AssertionError: expected:<1> but was:<0>\n    at __randomizedtesting.SeedInfo.seed([F88CF07515CF7DEF:C81F9BF1E097BCED]:0)\n    at org.junit.Assert.fail(Assert.java:88)\n    at org.junit.Assert.failNotEquals(Assert.java:834)\n    at org.junit.Assert.assertEquals(Assert.java:645)\n    at org.junit.Assert.assertEquals(Assert.java:631)\n    at com.elasticearth.plugin.aggregation.CloseOpenIT.testCloseOpen(CloseOpenIT.java:39)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/156710132","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-156710132","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":156710132,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NjcxMDEzMg==","user":{"login":"ebradshaw","id":3810632,"node_id":"MDQ6VXNlcjM4MTA2MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/3810632?v=4","gravatar_id":"","url":"https://api.github.com/users/ebradshaw","html_url":"https://github.com/ebradshaw","followers_url":"https://api.github.com/users/ebradshaw/followers","following_url":"https://api.github.com/users/ebradshaw/following{/other_user}","gists_url":"https://api.github.com/users/ebradshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ebradshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebradshaw/subscriptions","organizations_url":"https://api.github.com/users/ebradshaw/orgs","repos_url":"https://api.github.com/users/ebradshaw/repos","events_url":"https://api.github.com/users/ebradshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ebradshaw/received_events","type":"User","site_admin":false},"created_at":"2015-11-14T15:12:13Z","updated_at":"2015-11-14T15:12:13Z","author_association":"NONE","body":"@dadoonet It looks like the old index is deleted and a new one is created when the index is reopened.  When I look at the actual files in the index folder for the shard, all of the data files disappear and the segments_2 file is reverted to segments_1.  Does this still seem normal?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/156805074","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-156805074","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":156805074,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NjgwNTA3NA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-15T11:35:01Z","updated_at":"2015-11-15T11:35:01Z","author_association":"MEMBER","body":"Wondering if you should not call [flush](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-flush.html) before closing the index? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/156817490","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-156817490","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":156817490,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NjgxNzQ5MA==","user":{"login":"ebradshaw","id":3810632,"node_id":"MDQ6VXNlcjM4MTA2MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/3810632?v=4","gravatar_id":"","url":"https://api.github.com/users/ebradshaw","html_url":"https://github.com/ebradshaw","followers_url":"https://api.github.com/users/ebradshaw/followers","following_url":"https://api.github.com/users/ebradshaw/following{/other_user}","gists_url":"https://api.github.com/users/ebradshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ebradshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebradshaw/subscriptions","organizations_url":"https://api.github.com/users/ebradshaw/orgs","repos_url":"https://api.github.com/users/ebradshaw/repos","events_url":"https://api.github.com/users/ebradshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ebradshaw/received_events","type":"User","site_admin":false},"created_at":"2015-11-15T15:22:02Z","updated_at":"2015-11-15T15:22:02Z","author_association":"NONE","body":"@dadoonet Tried calling flush and updated the test case.  It didn't seem to make a difference.  \n\nI also ran a similar test using a transport client connected to node running in a separate JVM.  It passed!  Maybe the issue is with the embedded node?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157407233","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-157407233","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":157407233,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzQwNzIzMw==","user":{"login":"ebradshaw","id":3810632,"node_id":"MDQ6VXNlcjM4MTA2MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/3810632?v=4","gravatar_id":"","url":"https://api.github.com/users/ebradshaw","html_url":"https://github.com/ebradshaw","followers_url":"https://api.github.com/users/ebradshaw/followers","following_url":"https://api.github.com/users/ebradshaw/following{/other_user}","gists_url":"https://api.github.com/users/ebradshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ebradshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebradshaw/subscriptions","organizations_url":"https://api.github.com/users/ebradshaw/orgs","repos_url":"https://api.github.com/users/ebradshaw/repos","events_url":"https://api.github.com/users/ebradshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ebradshaw/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T15:39:52Z","updated_at":"2015-11-17T15:39:52Z","author_association":"NONE","body":"@dadoonet Unless I'm missing something, do you think we could reopen this issue?  While I can manage a workaround with a separate JVM, this isn't exactly test friendly :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157416258","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-157416258","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":157416258,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzQxNjI1OA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T16:10:39Z","updated_at":"2015-11-17T16:10:39Z","author_association":"MEMBER","body":"@ebradshaw Have you tried looking at existing tests in ES? This test does what you want I believe:\nhttps://github.com/elastic/elasticsearch/blob/6e81b0dd7025fe10d49ade35b5852697ef39355e/core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java#L329\n\nMy only thought is it looks like you are running on an old version based on the test constructs. What version would that be? If it is before 2.0 (as it appears it to be), you could be getting hit with the translog being fsynced asynchronously.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157416532","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-157416532","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":157416532,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzQxNjUzMg==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T16:11:39Z","updated_at":"2015-11-17T16:11:39Z","author_association":"MEMBER","body":"I wrote this test and it works fine on 2.0:\n\n``` java\n        client.prepareIndex(\"test\", \"type\").setSource(\"foo\", \"bar\").get();\n        client.admin().cluster().prepareHealth(\"test\").setWaitForYellowStatus().get();\n        client.admin().indices().prepareClose(\"test\").get();\n        client.admin().indices().prepareOpen(\"test\").get();\n        client.admin().cluster().prepareHealth(\"test\").setWaitForYellowStatus().get();\n        long count = client.prepareCount(\"test\").get().getCount();\n        assertThat(count, is(1L));\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157566371","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-157566371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":157566371,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzU2NjM3MQ==","user":{"login":"ebradshaw","id":3810632,"node_id":"MDQ6VXNlcjM4MTA2MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/3810632?v=4","gravatar_id":"","url":"https://api.github.com/users/ebradshaw","html_url":"https://github.com/ebradshaw","followers_url":"https://api.github.com/users/ebradshaw/followers","following_url":"https://api.github.com/users/ebradshaw/following{/other_user}","gists_url":"https://api.github.com/users/ebradshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/ebradshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebradshaw/subscriptions","organizations_url":"https://api.github.com/users/ebradshaw/orgs","repos_url":"https://api.github.com/users/ebradshaw/repos","events_url":"https://api.github.com/users/ebradshaw/events{/privacy}","received_events_url":"https://api.github.com/users/ebradshaw/received_events","type":"User","site_admin":false},"created_at":"2015-11-18T01:18:38Z","updated_at":"2015-11-18T01:18:38Z","author_association":"NONE","body":"@dadoonet That works for me also.  Must be time to upgrade to 2.0!  \n\n@rjernst I was wondering if it might be something with the translog.  Looks like that testOpenCloseWithDocs wasn't there prior to 2.0.\n\nThanks for the help here guys.  BTW, it took me a bit of trouble getting the test to work in 2.0.  The [docs](https://www.elastic.co/guide/en/elasticsearch/reference/current/using-elasticsearch-test-classes.html) call out two dependencies , but I also found that I had to include hamcrest-all-1.3 + junit-4.12 with hamcrest-core excluded.  If I didn't do this, I was dealing with either NoClassDefFoundErrors or Jar Hell errors.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157844449","html_url":"https://github.com/elastic/elasticsearch/issues/14722#issuecomment-157844449","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14722","id":157844449,"node_id":"MDEyOklzc3VlQ29tbWVudDE1Nzg0NDQ0OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-11-18T19:58:29Z","updated_at":"2015-11-18T19:58:29Z","author_association":"MEMBER","body":"I know the issues with dependencies are fixed in master. We no longer have a test-jar there, but a full test-framework module, with proper dependencies. There, simply depending on the test-framework is sufficient.\n","performed_via_github_app":null}]