{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6334","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6334/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6334/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6334/events","html_url":"https://github.com/elastic/elasticsearch/issues/6334","id":34503992,"node_id":"MDU6SXNzdWUzNDUwMzk5Mg==","number":6334,"title":"Internal: Base64 decode parsing detects more errors","user":{"login":"erikringsmuth","id":1128965,"node_id":"MDQ6VXNlcjExMjg5NjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1128965?v=4","gravatar_id":"","url":"https://api.github.com/users/erikringsmuth","html_url":"https://github.com/erikringsmuth","followers_url":"https://api.github.com/users/erikringsmuth/followers","following_url":"https://api.github.com/users/erikringsmuth/following{/other_user}","gists_url":"https://api.github.com/users/erikringsmuth/gists{/gist_id}","starred_url":"https://api.github.com/users/erikringsmuth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erikringsmuth/subscriptions","organizations_url":"https://api.github.com/users/erikringsmuth/orgs","repos_url":"https://api.github.com/users/erikringsmuth/repos","events_url":"https://api.github.com/users/erikringsmuth/events{/privacy}","received_events_url":"https://api.github.com/users/erikringsmuth/received_events","type":"User","site_admin":false},"labels":[{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":95090930,"node_id":"MDU6TGFiZWw5NTA5MDkzMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.3.0","name":"v1.3.0","color":"DDDDDD","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2014-05-28T20:33:09Z","updated_at":"2015-06-07T13:19:54Z","closed_at":"2014-06-24T11:44:58Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I found a bug in the `Base64.decode()` function. It will decode incorrectly formatted base 64 strings. For example, `\"user:password\"` encodes to `\"dXNlcjpwYXNzd29yZA==\"`. Both `\"dXNlcjpwYXNzd29yZA==123\"` and `\"dXNlcjpwYXNzd29yZA=5\"` decode to \"user:password\" although neither of them are valid base 64 strings. You can add or replace characters after the first padding character.\n\nI wrote a quick test to show the bug.\n\n``` java\n@Test\npublic void testBase64DecodeWithExtraCharactersAfterPadding() {\n    // \"user:password\" encodes to \"dXNlcjpwYXNzd29yZA==\"\n    String correctlyEncoded = \"\";\n    String extraCharacters = \"\";\n    String replacePaddingCharacter = \"\";\n    try {\n        correctlyEncoded = new String(Base64.decode(\"dXNlcjpwYXNzd29yZA==\"));\n        extraCharacters = new String(Base64.decode(\"dXNlcjpwYXNzd29yZA==123\"));\n        replacePaddingCharacter = new String(Base64.decode(\"dXNlcjpwYXNzd29yZA=5\"));\n    } catch (IOException e) {\n    }\n    assertEquals(\"user:password\", correctlyEncoded);\n    assertNotEquals(\"user:password\", extraCharacters); // this assertion fails\n    assertNotEquals(\"user:password\", replacePaddingCharacter); // this assertion fails\n}\n```\n\nI think this line is the culprit.\nhttps://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/common/Base64.java#L1219\n\nIt breaks early when it should really throw an `IOException` like the code 8 lines down.\n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}