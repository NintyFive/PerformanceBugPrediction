[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89590655","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-89590655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":89590655,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NTkwNjU1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-04T14:55:34Z","updated_at":"2015-04-04T14:55:34Z","author_association":"CONTRIBUTOR","body":"Hi @asanderson \n\nTrying to extend the filtered query to say \"also apply to this has-child subclause\" doesn't make sense to me.  Things would suddenly get very complicated with action-at-a-distance.\n\nIf you want the condition to apply to the sub-clause, then you should include it in the sub-clause.  It'll still be able to use the cached filter.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89604699","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-89604699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":89604699,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NjA0Njk5","user":{"login":"asanderson","id":1292951,"node_id":"MDQ6VXNlcjEyOTI5NTE=","avatar_url":"https://avatars0.githubusercontent.com/u/1292951?v=4","gravatar_id":"","url":"https://api.github.com/users/asanderson","html_url":"https://github.com/asanderson","followers_url":"https://api.github.com/users/asanderson/followers","following_url":"https://api.github.com/users/asanderson/following{/other_user}","gists_url":"https://api.github.com/users/asanderson/gists{/gist_id}","starred_url":"https://api.github.com/users/asanderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asanderson/subscriptions","organizations_url":"https://api.github.com/users/asanderson/orgs","repos_url":"https://api.github.com/users/asanderson/repos","events_url":"https://api.github.com/users/asanderson/events{/privacy}","received_events_url":"https://api.github.com/users/asanderson/received_events","type":"User","site_admin":false},"created_at":"2015-04-04T15:58:55Z","updated_at":"2015-04-04T15:58:55Z","author_association":"NONE","body":"Again, it makes sense in the very real scenario where you have a common access control field for which you want to guarantee a filter is applied to all parent and child records.  The filters are already huge, so having to wrap the has_child subclause into a filtered query and copying the huge filter from the outer filtered query is very ugly.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89604815","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-89604815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":89604815,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NjA0ODE1","user":{"login":"asanderson","id":1292951,"node_id":"MDQ6VXNlcjEyOTI5NTE=","avatar_url":"https://avatars0.githubusercontent.com/u/1292951?v=4","gravatar_id":"","url":"https://api.github.com/users/asanderson","html_url":"https://github.com/asanderson","followers_url":"https://api.github.com/users/asanderson/followers","following_url":"https://api.github.com/users/asanderson/following{/other_user}","gists_url":"https://api.github.com/users/asanderson/gists{/gist_id}","starred_url":"https://api.github.com/users/asanderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asanderson/subscriptions","organizations_url":"https://api.github.com/users/asanderson/orgs","repos_url":"https://api.github.com/users/asanderson/repos","events_url":"https://api.github.com/users/asanderson/events{/privacy}","received_events_url":"https://api.github.com/users/asanderson/received_events","type":"User","site_admin":false},"created_at":"2015-04-04T16:01:47Z","updated_at":"2015-04-04T16:01:47Z","author_association":"NONE","body":"So, good luck w/ implementing a common access control field strategy w/ Shield that applies to both parent and child documents, if you leave this closed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89835865","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-89835865","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":89835865,"node_id":"MDEyOklzc3VlQ29tbWVudDg5ODM1ODY1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T19:23:15Z","updated_at":"2015-04-05T19:23:15Z","author_association":"CONTRIBUTOR","body":"You raise a good point...  How to completely exclude documents from all queries that match some filter.  Reopening for discussion\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89836034","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-89836034","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":89836034,"node_id":"MDEyOklzc3VlQ29tbWVudDg5ODM2MDM0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T19:23:38Z","updated_at":"2015-04-05T19:23:38Z","author_association":"CONTRIBUTOR","body":"@uboness this may be of interest to you\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/90230779","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-90230779","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":90230779,"node_id":"MDEyOklzc3VlQ29tbWVudDkwMjMwNzc5","user":{"login":"asanderson","id":1292951,"node_id":"MDQ6VXNlcjEyOTI5NTE=","avatar_url":"https://avatars0.githubusercontent.com/u/1292951?v=4","gravatar_id":"","url":"https://api.github.com/users/asanderson","html_url":"https://github.com/asanderson","followers_url":"https://api.github.com/users/asanderson/followers","following_url":"https://api.github.com/users/asanderson/following{/other_user}","gists_url":"https://api.github.com/users/asanderson/gists{/gist_id}","starred_url":"https://api.github.com/users/asanderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asanderson/subscriptions","organizations_url":"https://api.github.com/users/asanderson/orgs","repos_url":"https://api.github.com/users/asanderson/repos","events_url":"https://api.github.com/users/asanderson/events{/privacy}","received_events_url":"https://api.github.com/users/asanderson/received_events","type":"User","site_admin":false},"created_at":"2015-04-06T20:30:54Z","updated_at":"2015-04-06T20:30:54Z","author_association":"NONE","body":"Currently, it's a pain to have to rewrite an end-user's query to wrap all their queries and filters w/ a common access control filter.  There should be an easier way to do this.  From an API user perspective, the ideal solution would be to specify top-level pre_filter similarly to how easier it is to specify a post_filter. If agreed, then feel free to close this again and open up a new feature to support this pre_filter concept.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/337397896","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-337397896","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":337397896,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzM5Nzg5Ng==","user":{"login":"marshall007","id":877936,"node_id":"MDQ6VXNlcjg3NzkzNg==","avatar_url":"https://avatars2.githubusercontent.com/u/877936?v=4","gravatar_id":"","url":"https://api.github.com/users/marshall007","html_url":"https://github.com/marshall007","followers_url":"https://api.github.com/users/marshall007/followers","following_url":"https://api.github.com/users/marshall007/following{/other_user}","gists_url":"https://api.github.com/users/marshall007/gists{/gist_id}","starred_url":"https://api.github.com/users/marshall007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marshall007/subscriptions","organizations_url":"https://api.github.com/users/marshall007/orgs","repos_url":"https://api.github.com/users/marshall007/repos","events_url":"https://api.github.com/users/marshall007/events{/privacy}","received_events_url":"https://api.github.com/users/marshall007/received_events","type":"User","site_admin":false},"created_at":"2017-10-17T22:44:31Z","updated_at":"2017-10-17T22:44:47Z","author_association":"NONE","body":"@clintongormley are there any workarounds for this issue? We have a similar situation where we're trying to apply boolean `{ should, filter }` queries at both the parent and child levels. We would essentially want to treat the parent/child `should` and `filter` sub-queries as if they were siblings on the same boolean query.\r\n\r\nI tried something along these lines, but you are not allowed to have duplicate `has_child` queries on the same type in a single query:\r\n\r\n```js\r\n{\r\n  bool: {\r\n    filter: [\r\n      {  }, // parent.bool.filter\r\n      {\r\n        has_child: {\r\n          type: '...',\r\n          query: // child.bool.filter\r\n        }\r\n      }\r\n    ]\r\n    should: [\r\n      {  }, // parent.bool.should\r\n      {\r\n        has_child: {\r\n          type: '...',\r\n          query: // child.bool.should\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372760370","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-372760370","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":372760370,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjc2MDM3MA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T17:58:02Z","updated_at":"2018-03-13T17:58:02Z","author_association":"MEMBER","body":"cc @elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425231213","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-425231213","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":425231213,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTIzMTIxMw==","user":{"login":"tomcallahan","id":15988488,"node_id":"MDQ6VXNlcjE1OTg4NDg4","avatar_url":"https://avatars1.githubusercontent.com/u/15988488?v=4","gravatar_id":"","url":"https://api.github.com/users/tomcallahan","html_url":"https://github.com/tomcallahan","followers_url":"https://api.github.com/users/tomcallahan/followers","following_url":"https://api.github.com/users/tomcallahan/following{/other_user}","gists_url":"https://api.github.com/users/tomcallahan/gists{/gist_id}","starred_url":"https://api.github.com/users/tomcallahan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomcallahan/subscriptions","organizations_url":"https://api.github.com/users/tomcallahan/orgs","repos_url":"https://api.github.com/users/tomcallahan/repos","events_url":"https://api.github.com/users/tomcallahan/events{/privacy}","received_events_url":"https://api.github.com/users/tomcallahan/received_events","type":"User","site_admin":false},"created_at":"2018-09-27T20:26:52Z","updated_at":"2018-09-27T20:26:52Z","author_association":"CONTRIBUTOR","body":"@jaymode any thoughts on this issue ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437403396","html_url":"https://github.com/elastic/elasticsearch/issues/10058#issuecomment-437403396","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10058","id":437403396,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzQwMzM5Ng==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T15:55:59Z","updated_at":"2018-11-09T15:55:59Z","author_association":"MEMBER","body":"We discussed this during a team meeting and outside of the security use case, we could not think of a non-contrived example where this would be needed. Given that and the existing complexity of parent child, we do not feel like this is something we should introduce within our query dsl and code.\r\n\r\nIn terms of a solution for this type of issue, we do offer document level security in our security product which will provide the behavior that this request is asking for.","performed_via_github_app":null}]