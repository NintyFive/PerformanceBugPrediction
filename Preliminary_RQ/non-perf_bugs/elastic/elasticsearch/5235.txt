{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5235","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5235/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5235/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5235/events","html_url":"https://github.com/elastic/elasticsearch/issues/5235","id":28159623,"node_id":"MDU6SXNzdWUyODE1OTYyMw==","number":5235,"title":"feature request : aggregation reducer functions (aka buffer functions / window functions)","user":{"login":"mccraigmccraig","id":29339,"node_id":"MDQ6VXNlcjI5MzM5","avatar_url":"https://avatars1.githubusercontent.com/u/29339?v=4","gravatar_id":"","url":"https://api.github.com/users/mccraigmccraig","html_url":"https://github.com/mccraigmccraig","followers_url":"https://api.github.com/users/mccraigmccraig/followers","following_url":"https://api.github.com/users/mccraigmccraig/following{/other_user}","gists_url":"https://api.github.com/users/mccraigmccraig/gists{/gist_id}","starred_url":"https://api.github.com/users/mccraigmccraig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mccraigmccraig/subscriptions","organizations_url":"https://api.github.com/users/mccraigmccraig/orgs","repos_url":"https://api.github.com/users/mccraigmccraig/repos","events_url":"https://api.github.com/users/mccraigmccraig/events{/privacy}","received_events_url":"https://api.github.com/users/mccraigmccraig/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"uboness","id":211019,"node_id":"MDQ6VXNlcjIxMTAxOQ==","avatar_url":"https://avatars3.githubusercontent.com/u/211019?v=4","gravatar_id":"","url":"https://api.github.com/users/uboness","html_url":"https://github.com/uboness","followers_url":"https://api.github.com/users/uboness/followers","following_url":"https://api.github.com/users/uboness/following{/other_user}","gists_url":"https://api.github.com/users/uboness/gists{/gist_id}","starred_url":"https://api.github.com/users/uboness/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uboness/subscriptions","organizations_url":"https://api.github.com/users/uboness/orgs","repos_url":"https://api.github.com/users/uboness/repos","events_url":"https://api.github.com/users/uboness/events{/privacy}","received_events_url":"https://api.github.com/users/uboness/received_events","type":"User","site_admin":false},"assignees":[{"login":"uboness","id":211019,"node_id":"MDQ6VXNlcjIxMTAxOQ==","avatar_url":"https://avatars3.githubusercontent.com/u/211019?v=4","gravatar_id":"","url":"https://api.github.com/users/uboness","html_url":"https://github.com/uboness","followers_url":"https://api.github.com/users/uboness/followers","following_url":"https://api.github.com/users/uboness/following{/other_user}","gists_url":"https://api.github.com/users/uboness/gists{/gist_id}","starred_url":"https://api.github.com/users/uboness/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uboness/subscriptions","organizations_url":"https://api.github.com/users/uboness/orgs","repos_url":"https://api.github.com/users/uboness/repos","events_url":"https://api.github.com/users/uboness/events{/privacy}","received_events_url":"https://api.github.com/users/uboness/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2014-02-24T13:03:52Z","updated_at":"2014-02-24T21:15:47Z","closed_at":"2014-02-24T21:15:47Z","author_association":"NONE","active_lock_reason":null,"body":"i would like to do group-by type aggregations e.g. given documents :\n\n```\n{name: \"foo\", location: \"london\", revenue: 100}\n{name: \"foo\", location: \"paris\", revenue: 500}\n{name: \"bar\", location: \"sydney\", revenue: 15}\n{name: \"bar\", location: \"new york\", revenue: 23}\n```\n\nto produce output by grouping on name, collecting locations and summing revenues: \n\n```\n{name: \"foo\", location: [\"london\",\"paris\"], revenue: 600}\n{name: \"bar\", location: [\"sydney\", \"new york\"], revenue: 38}\n```\n\nthis is difficult with the currently available aggregations\n\nto my naive eye it seems like it might be relatively easy to create a metric aggregation which operates very similarly to cascalog's defparallelagg https://github.com/nathanmarz/cascalog/wiki/Guide-to-custom-operations#wiki-aggregators\n\nso the metric aggregation would define two scripts : one to initialise an aggregate container given a document, and another to combine aggregate containers\n\ne.g.\n\n```\n{aggs:\n  {name: \n    {terms: {field: \"name\", size: 0},\n     aggs: \n       {location_revenue: \n         {reduce: {init: \"{name: doc.name, \n                           location: [doc.location], \n                           revenue: doc.revenue}\", \n                   combine: \"{name: doc1.name, \n                              location: doc1.location.concat(doc2.location), \n                              revenue: doc1.revenue+doc2.revenue}\"}}}}}}\n```\n","closed_by":{"login":"mccraigmccraig","id":29339,"node_id":"MDQ6VXNlcjI5MzM5","avatar_url":"https://avatars1.githubusercontent.com/u/29339?v=4","gravatar_id":"","url":"https://api.github.com/users/mccraigmccraig","html_url":"https://github.com/mccraigmccraig","followers_url":"https://api.github.com/users/mccraigmccraig/followers","following_url":"https://api.github.com/users/mccraigmccraig/following{/other_user}","gists_url":"https://api.github.com/users/mccraigmccraig/gists{/gist_id}","starred_url":"https://api.github.com/users/mccraigmccraig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mccraigmccraig/subscriptions","organizations_url":"https://api.github.com/users/mccraigmccraig/orgs","repos_url":"https://api.github.com/users/mccraigmccraig/repos","events_url":"https://api.github.com/users/mccraigmccraig/events{/privacy}","received_events_url":"https://api.github.com/users/mccraigmccraig/received_events","type":"User","site_admin":false},"performed_via_github_app":null}