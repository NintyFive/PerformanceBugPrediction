[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169655237","html_url":"https://github.com/elastic/elasticsearch/issues/15819#issuecomment-169655237","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15819","id":169655237,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTY1NTIzNw==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-01-07T12:51:05Z","updated_at":"2016-01-07T12:51:05Z","author_association":"CONTRIBUTOR","body":"I don't have any idea how that NullPointerException showed up without a stacktrace to be honest! @rmuir any idea?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169678297","html_url":"https://github.com/elastic/elasticsearch/issues/15819#issuecomment-169678297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15819","id":169678297,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTY3ODI5Nw==","user":{"login":"skundrik","id":14072681,"node_id":"MDQ6VXNlcjE0MDcyNjgx","avatar_url":"https://avatars2.githubusercontent.com/u/14072681?v=4","gravatar_id":"","url":"https://api.github.com/users/skundrik","html_url":"https://github.com/skundrik","followers_url":"https://api.github.com/users/skundrik/followers","following_url":"https://api.github.com/users/skundrik/following{/other_user}","gists_url":"https://api.github.com/users/skundrik/gists{/gist_id}","starred_url":"https://api.github.com/users/skundrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skundrik/subscriptions","organizations_url":"https://api.github.com/users/skundrik/orgs","repos_url":"https://api.github.com/users/skundrik/repos","events_url":"https://api.github.com/users/skundrik/events{/privacy}","received_events_url":"https://api.github.com/users/skundrik/received_events","type":"User","site_admin":false},"created_at":"2016-01-07T14:25:29Z","updated_at":"2016-01-07T14:25:29Z","author_association":"NONE","body":"I came across this article which talks about JVM optimisation of NullPointerException. It might be worth adding this as a standard start-up option.\n\nhttp://jawspeak.com/2010/05/26/hotspot-caused-exceptions-to-lose-their-stack-traces-in-production-and-the-fix/\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169681572","html_url":"https://github.com/elastic/elasticsearch/issues/15819#issuecomment-169681572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15819","id":169681572,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTY4MTU3Mg==","user":{"login":"skundrik","id":14072681,"node_id":"MDQ6VXNlcjE0MDcyNjgx","avatar_url":"https://avatars2.githubusercontent.com/u/14072681?v=4","gravatar_id":"","url":"https://api.github.com/users/skundrik","html_url":"https://github.com/skundrik","followers_url":"https://api.github.com/users/skundrik/followers","following_url":"https://api.github.com/users/skundrik/following{/other_user}","gists_url":"https://api.github.com/users/skundrik/gists{/gist_id}","starred_url":"https://api.github.com/users/skundrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skundrik/subscriptions","organizations_url":"https://api.github.com/users/skundrik/orgs","repos_url":"https://api.github.com/users/skundrik/repos","events_url":"https://api.github.com/users/skundrik/events{/privacy}","received_events_url":"https://api.github.com/users/skundrik/received_events","type":"User","site_admin":false},"created_at":"2016-01-07T14:38:30Z","updated_at":"2016-01-07T14:48:17Z","author_association":"NONE","body":"Based on the above  I went to see if I can find the first occurrence of it and came up with this which seems to indicate that `stats2` doesn't contain the `readerCoreKey` any more.\n\n```\n[2015-12-23 11:47:49,949][WARN ][index.engine             ] [data-nd2] [logstash-2015.12.23-v1][1] failed to rollback writer on close\njava.lang.NullPointerException\n    at org.elasticsearch.indices.cache.query.IndicesQueryCache$1.onDocIdSetEviction(IndicesQueryCache.java:158)\n    at org.apache.lucene.search.LRUQueryCache.clearCoreCacheKey(LRUQueryCache.java:313)\n    at org.apache.lucene.search.LRUQueryCache$1.onClose(LRUQueryCache.java:276)\n    at org.apache.lucene.index.SegmentCoreReaders.notifyCoreClosedListeners(SegmentCoreReaders.java:168)\n    at org.apache.lucene.index.SegmentCoreReaders.decRef(SegmentCoreReaders.java:157)\n    at org.apache.lucene.index.SegmentReader.doClose(SegmentReader.java:175)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.index.ReadersAndUpdates.dropReaders(ReadersAndUpdates.java:182)\n    at org.apache.lucene.index.IndexWriter$ReaderPool.dropAll(IndexWriter.java:603)\n    at org.apache.lucene.index.IndexWriter.rollbackInternal(IndexWriter.java:2075)\n    at org.apache.lucene.index.IndexWriter.rollback(IndexWriter.java:2033)\n    at org.elasticsearch.index.engine.InternalEngine.closeNoLock(InternalEngine.java:993)\n    at org.elasticsearch.index.engine.Engine.failEngine(Engine.java:540)\n    at org.elasticsearch.index.engine.InternalEngine.refresh(InternalEngine.java:685)\n    at org.elasticsearch.index.shard.IndexShard.refresh(IndexShard.java:615)\n    at org.elasticsearch.index.shard.IndexShard$EngineRefresher$1.run(IndexShard.java:1255)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n[2015-12-23 11:47:49,949][WARN ][index.engine             ] [data-nd2] [logstash-2015.12.23-v1][1] failed engine [refresh failed]\njava.lang.NullPointerException\n    at org.elasticsearch.indices.cache.query.IndicesQueryCache$1.onDocIdSetEviction(IndicesQueryCache.java:158)\n    at org.apache.lucene.search.LRUQueryCache.clearCoreCacheKey(LRUQueryCache.java:313)\n    at org.apache.lucene.search.LRUQueryCache$1.onClose(LRUQueryCache.java:276)\n    at org.apache.lucene.index.SegmentCoreReaders.notifyCoreClosedListeners(SegmentCoreReaders.java:168)\n    at org.apache.lucene.index.SegmentCoreReaders.decRef(SegmentCoreReaders.java:157)\n    at org.apache.lucene.index.SegmentReader.doClose(SegmentReader.java:175)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.index.StandardDirectoryReader.doClose(StandardDirectoryReader.java:359)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.index.IndexReader.close(IndexReader.java:403)\n    at org.apache.lucene.index.FilterDirectoryReader.doClose(FilterDirectoryReader.java:134)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.search.SearcherManager.decRef(SearcherManager.java:130)\n    at org.apache.lucene.search.SearcherManager.decRef(SearcherManager.java:58)\n    at org.apache.lucene.search.ReferenceManager.release(ReferenceManager.java:274)\n    at org.apache.lucene.search.ReferenceManager.doMaybeRefresh(ReferenceManager.java:189)\n    at org.apache.lucene.search.ReferenceManager.maybeRefreshBlocking(ReferenceManager.java:253)\n    at org.elasticsearch.index.engine.InternalEngine.refresh(InternalEngine.java:678)\n    at org.elasticsearch.index.shard.IndexShard.refresh(IndexShard.java:615)\n    at org.elasticsearch.index.shard.IndexShard$EngineRefresher$1.run(IndexShard.java:1255)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n[2015-12-23 11:47:49,969][WARN ][index.shard              ] [data-nd2] [logstash-2015.12.23-v1][1] Failed to perform scheduled engine refresh\n[logstash-2015.12.23-v1][[logstash-2015.12.23-v1][1]] RefreshFailedEngineException[Refresh failed]; nested: NullPointerException;\n    at org.elasticsearch.index.engine.InternalEngine.refresh(InternalEngine.java:686)\n    at org.elasticsearch.index.shard.IndexShard.refresh(IndexShard.java:615)\n    at org.elasticsearch.index.shard.IndexShard$EngineRefresher$1.run(IndexShard.java:1255)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.indices.cache.query.IndicesQueryCache$1.onDocIdSetEviction(IndicesQueryCache.java:158)\n    at org.apache.lucene.search.LRUQueryCache.clearCoreCacheKey(LRUQueryCache.java:313)\n    at org.apache.lucene.search.LRUQueryCache$1.onClose(LRUQueryCache.java:276)\n    at org.apache.lucene.index.SegmentCoreReaders.notifyCoreClosedListeners(SegmentCoreReaders.java:168)\n    at org.apache.lucene.index.SegmentCoreReaders.decRef(SegmentCoreReaders.java:157)\n    at org.apache.lucene.index.SegmentReader.doClose(SegmentReader.java:175)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.index.StandardDirectoryReader.doClose(StandardDirectoryReader.java:359)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.index.IndexReader.close(IndexReader.java:403)\n    at org.apache.lucene.index.FilterDirectoryReader.doClose(FilterDirectoryReader.java:134)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.search.SearcherManager.decRef(SearcherManager.java:130)\n    at org.apache.lucene.search.SearcherManager.decRef(SearcherManager.java:58)\n    at org.apache.lucene.search.ReferenceManager.release(ReferenceManager.java:274)\n    at org.apache.lucene.search.ReferenceManager.doMaybeRefresh(ReferenceManager.java:189)\n    at org.apache.lucene.search.ReferenceManager.maybeRefreshBlocking(ReferenceManager.java:253)\n    at org.elasticsearch.index.engine.InternalEngine.refresh(InternalEngine.java:678)\n    ... 5 more\n[2015-12-23 11:47:49,989][WARN ][indices.cluster          ] [data-nd2] [[logstash-2015.12.23-v1][1]] marking and sending shard failed due to [engine failure, reason [refresh failed]]\njava.lang.NullPointerException\n    at org.elasticsearch.indices.cache.query.IndicesQueryCache$1.onDocIdSetEviction(IndicesQueryCache.java:158)\n    at org.apache.lucene.search.LRUQueryCache.clearCoreCacheKey(LRUQueryCache.java:313)\n    at org.apache.lucene.search.LRUQueryCache$1.onClose(LRUQueryCache.java:276)\n    at org.apache.lucene.index.SegmentCoreReaders.notifyCoreClosedListeners(SegmentCoreReaders.java:168)\n    at org.apache.lucene.index.SegmentCoreReaders.decRef(SegmentCoreReaders.java:157)\n    at org.apache.lucene.index.SegmentReader.doClose(SegmentReader.java:175)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.index.StandardDirectoryReader.doClose(StandardDirectoryReader.java:359)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.index.IndexReader.close(IndexReader.java:403)\n    at org.apache.lucene.index.FilterDirectoryReader.doClose(FilterDirectoryReader.java:134)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.search.SearcherManager.decRef(SearcherManager.java:130)\n    at org.apache.lucene.search.SearcherManager.decRef(SearcherManager.java:58)\n    at org.apache.lucene.search.ReferenceManager.release(ReferenceManager.java:274)\n    at org.apache.lucene.search.ReferenceManager.doMaybeRefresh(ReferenceManager.java:189)\n    at org.apache.lucene.search.ReferenceManager.maybeRefreshBlocking(ReferenceManager.java:253)\n    at org.elasticsearch.index.engine.InternalEngine.refresh(InternalEngine.java:678)\n    at org.elasticsearch.index.shard.IndexShard.refresh(IndexShard.java:615)\n    at org.elasticsearch.index.shard.IndexShard$EngineRefresher$1.run(IndexShard.java:1255)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169683365","html_url":"https://github.com/elastic/elasticsearch/issues/15819#issuecomment-169683365","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15819","id":169683365,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTY4MzM2NQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-01-07T14:45:25Z","updated_at":"2016-01-07T14:45:25Z","author_association":"CONTRIBUTOR","body":"great, that helps a lot\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169684142","html_url":"https://github.com/elastic/elasticsearch/issues/15819#issuecomment-169684142","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15819","id":169684142,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTY4NDE0Mg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-01-07T14:48:16Z","updated_at":"2016-01-07T14:48:16Z","author_association":"CONTRIBUTOR","body":"Fixed in 2.1.1 #15202\n","performed_via_github_app":null}]