[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/564022797","html_url":"https://github.com/elastic/elasticsearch/issues/50009#issuecomment-564022797","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009","id":564022797,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDAyMjc5Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-12-10T13:03:26Z","updated_at":"2019-12-10T13:03:26Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Search)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565477742","html_url":"https://github.com/elastic/elasticsearch/issues/50009#issuecomment-565477742","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009","id":565477742,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTQ3Nzc0Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-12-13T15:14:56Z","updated_at":"2019-12-13T15:14:56Z","author_association":"MEMBER","body":"Hi @deadbeef84, thanks for raising this and the great reproduction. \r\n\r\nLooking at the query explain output for the `range` query on the `date_range` field gives:\r\n```\r\n\"explanation\" : \"bar:<ranges:[1575849600000 : 1575849600000]>\"\r\n```\r\nand on the `date` field we get (after adding another datapoint outside the range so it doesn't rewrite):\r\n```\r\n \"explanation\" : \"foo:[1575849600000 TO 1575935999999]\"\r\n```\r\n\r\nThe different rounding behaviour on the two field types is indeed odd. I wonder if the `date_range` behaviour has always been like this or if this has recently changed. I tried on 7.5 but will also try a somewhat older 6 version. In any case I think we should discuss changing the behaviour to be similar, although changing might now come with compatibility issues, so even if we decide to change it we might only do it on a mayor version.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565485311","html_url":"https://github.com/elastic/elasticsearch/issues/50009#issuecomment-565485311","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009","id":565485311,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTQ4NTMxMQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-12-13T15:33:55Z","updated_at":"2019-12-13T15:33:55Z","author_association":"MEMBER","body":"The `date_range` field behaviour on 6.8.3 looks the same as described above, query explain is: `\"explanation\" : \"bar:<ranges:[1575849600000 : 1575849600000]>\"`\r\nSo even if we consider this a bug or want to change the behaviour we should take that into account. Labling for discussion whether we need to update or clarify in the docs or if we want to change the behaviour to \"lte\" behaves similar to how if is resolved in `date` fields.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565517934","html_url":"https://github.com/elastic/elasticsearch/issues/50009#issuecomment-565517934","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009","id":565517934,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTUxNzkzNA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-12-13T16:55:29Z","updated_at":"2019-12-13T16:55:29Z","author_association":"MEMBER","body":"The rounding behaviour for \"gt\" is also different between range queries on `date` and on `date_range`. On the `date_range` field (bar) the following shows a lower bound of `1575849600001` both for `gt` and `gte`.\r\n```\r\nPOST /mytest/_validate/query?explain\r\n{\r\n  \"query\":{\r\n    \"range\":{\r\n      \"bar\": {\r\n        \"gt\":\"2019-12-09||/d\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nOn the `date` field however, `gt` rounds up to `1575936000000` while `gte` includes the lower bound `1575849600000`. The behaviour on `date` is consistent with what we document here: https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html#range-query-date-math-rounding while the behaviour on `date_range` is not. I think we need to change the rounding in RangeType.DATE if we want this to be consistent.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565800410","html_url":"https://github.com/elastic/elasticsearch/issues/50009#issuecomment-565800410","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009","id":565800410,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTgwMDQxMA==","user":{"login":"deadbeef84","id":961178,"node_id":"MDQ6VXNlcjk2MTE3OA==","avatar_url":"https://avatars0.githubusercontent.com/u/961178?v=4","gravatar_id":"","url":"https://api.github.com/users/deadbeef84","html_url":"https://github.com/deadbeef84","followers_url":"https://api.github.com/users/deadbeef84/followers","following_url":"https://api.github.com/users/deadbeef84/following{/other_user}","gists_url":"https://api.github.com/users/deadbeef84/gists{/gist_id}","starred_url":"https://api.github.com/users/deadbeef84/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deadbeef84/subscriptions","organizations_url":"https://api.github.com/users/deadbeef84/orgs","repos_url":"https://api.github.com/users/deadbeef84/repos","events_url":"https://api.github.com/users/deadbeef84/events{/privacy}","received_events_url":"https://api.github.com/users/deadbeef84/received_events","type":"User","site_admin":false},"created_at":"2019-12-15T11:23:39Z","updated_at":"2019-12-15T11:23:39Z","author_association":"NONE","body":"Thanks for digging into this.\r\n\r\nI can add that the issue exists on `6.4.1` (which was where we saw it first) and I just tested it on `5.3.0` where behavior is the same. I think date_range type was introduced in 5.2.0 so it doesn't appear to be a regression.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/566117116","html_url":"https://github.com/elastic/elasticsearch/issues/50009#issuecomment-566117116","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009","id":566117116,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjExNzExNg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-12-16T15:46:05Z","updated_at":"2019-12-16T15:46:05Z","author_association":"MEMBER","body":"Another related observation regarding `query_string` query: with the above field mapping (foo -> date, bar -> date_range) the following:\r\n```\r\nPOST /mytest/_validate/query?explain\r\n{\r\n  \"query\": {\"query_string\": {\r\n    \"query\": \"foo:[2019-12-14 TO 2019-12-14]\"\r\n  }}\r\n}\r\n```\r\nshows the query expands to this query: \"explanation\" : \"foo:[1576281600000 TO 1576367999999]\", so it includes the full day \"2019-12-14\" while the same done on the \"date_range\" returns \"bar:<ranges:[1576281600000 : 1576281600000]>\", so to/from are parsed to the same value.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/566136982","html_url":"https://github.com/elastic/elasticsearch/issues/50009#issuecomment-566136982","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009","id":566136982,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjEzNjk4Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-12-16T16:30:59Z","updated_at":"2019-12-16T16:30:59Z","author_association":"MEMBER","body":"Brought this up for discussion and the current tendency is to try and make this consitent, but probably only on 8.0 so we don't change the behaviour on a minor.","performed_via_github_app":null}]