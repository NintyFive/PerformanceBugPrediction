[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/261367684","html_url":"https://github.com/elastic/elasticsearch/issues/21636#issuecomment-261367684","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21636","id":261367684,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MTM2NzY4NA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-11-17T20:59:22Z","updated_at":"2016-11-17T20:59:22Z","author_association":"MEMBER","body":"Hi @nostrebor,\nPlease ask questions like these on the discussion forum: https://discuss.elastic.co/\nWe reserve Github for issues and feature requests.\nRegarding your issue each field is highlighted using its own analyzer. Since you're using a keyword analyzer the only query that can be highlighted would be the entire value of the field. So it would only work with the query \"Kostya Test\".\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/261373775","html_url":"https://github.com/elastic/elasticsearch/issues/21636#issuecomment-261373775","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21636","id":261373775,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MTM3Mzc3NQ==","user":{"login":"nostrebor","id":7697492,"node_id":"MDQ6VXNlcjc2OTc0OTI=","avatar_url":"https://avatars2.githubusercontent.com/u/7697492?v=4","gravatar_id":"","url":"https://api.github.com/users/nostrebor","html_url":"https://github.com/nostrebor","followers_url":"https://api.github.com/users/nostrebor/followers","following_url":"https://api.github.com/users/nostrebor/following{/other_user}","gists_url":"https://api.github.com/users/nostrebor/gists{/gist_id}","starred_url":"https://api.github.com/users/nostrebor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nostrebor/subscriptions","organizations_url":"https://api.github.com/users/nostrebor/orgs","repos_url":"https://api.github.com/users/nostrebor/repos","events_url":"https://api.github.com/users/nostrebor/events{/privacy}","received_events_url":"https://api.github.com/users/nostrebor/received_events","type":"User","site_admin":false},"created_at":"2016-11-17T21:23:45Z","updated_at":"2016-11-17T21:23:45Z","author_association":"NONE","body":"I thought that might be the case so I tried it. As I mentioned in my original post, the same can be repeated where the search is an exact match for the field, and no highlighting is done then either.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/261476192","html_url":"https://github.com/elastic/elasticsearch/issues/21636#issuecomment-261476192","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21636","id":261476192,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MTQ3NjE5Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-11-18T08:32:04Z","updated_at":"2016-11-18T08:32:04Z","author_association":"MEMBER","body":"Ok now I understand the problem @nostrebor \nThis simple recreation exhibits the problem:\n\n```\nPUT t\n{\n    \"mappings\": {\n        \"t\": {\n            \"properties\": {\n                \"message\": {\n                    \"type\": \"keyword\",\n                    \"store\": true\n                }\n            }\n        }\n    }\n}\n\nPUT t/t/1\n{\n    \"message\": \"foo\"\n}\n\nGET _search\n{\n   \"size\": 1,\n   \"stored_fields\": \"message\",\n   \"query\": {\n      \"match\": {\n         \"message\": \"foo\"\n      }\n   },\n   \"highlight\": {\n      \"fields\": {\n         \"message\": {\n             \"type\": \"plain\",\n             \"no_match_size\": 10\n         }\n      }\n   }\n}\n```\n\n... returns:\n\n```\n{\n   \"took\": 1,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 1,\n      \"max_score\": 0.2876821,\n      \"hits\": [\n         {\n            \"_index\": \"t\",\n            \"_type\": \"t\",\n            \"_id\": \"1\",\n            \"_score\": 0.2876821,\n            \"fields\": {\n               \"message\": [\n                  \"foo\"\n               ]\n            },\n            \"highlight\": {\n               \"message\": [\n                  \"[66 6f 6f]\"\n               ]\n            }\n         }\n      ]\n   }\n}\n```\n\nThis is due to the fact that the keyword field is stored as a binary field. The highlighter does not convert the binary value into a valid string. \nI'll work on a fix. \nAs a workaround you can use a text field with a keyword analyzer:\n\n```\n\"message\": {\n  \"type\": \"text\",\n  \"analyzer\": \"keyword\",\n  \"store\": true\n}\n```\n\n... or you can force highlighting on source:\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-highlighting.html#_force_highlighting_on_source\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/261487265","html_url":"https://github.com/elastic/elasticsearch/issues/21636#issuecomment-261487265","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21636","id":261487265,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MTQ4NzI2NQ==","user":{"login":"nostrebor","id":7697492,"node_id":"MDQ6VXNlcjc2OTc0OTI=","avatar_url":"https://avatars2.githubusercontent.com/u/7697492?v=4","gravatar_id":"","url":"https://api.github.com/users/nostrebor","html_url":"https://github.com/nostrebor","followers_url":"https://api.github.com/users/nostrebor/followers","following_url":"https://api.github.com/users/nostrebor/following{/other_user}","gists_url":"https://api.github.com/users/nostrebor/gists{/gist_id}","starred_url":"https://api.github.com/users/nostrebor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nostrebor/subscriptions","organizations_url":"https://api.github.com/users/nostrebor/orgs","repos_url":"https://api.github.com/users/nostrebor/repos","events_url":"https://api.github.com/users/nostrebor/events{/privacy}","received_events_url":"https://api.github.com/users/nostrebor/received_events","type":"User","site_admin":false},"created_at":"2016-11-18T09:31:42Z","updated_at":"2016-11-18T09:31:42Z","author_association":"NONE","body":"For posterity, there was a separate issue of searching vs all converting the string to lowercase which would not match the keyword data iirc, which has an existing flag already. Thanks for looking into the other issue though!\n","performed_via_github_app":null}]