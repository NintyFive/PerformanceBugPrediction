{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14491","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14491/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14491/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14491/events","html_url":"https://github.com/elastic/elasticsearch/issues/14491","id":114883357,"node_id":"MDU6SXNzdWUxMTQ4ODMzNTc=","number":14491,"title":"Mapping conflict error upgrading from 1.5 to 2.0","user":{"login":"chilladx","id":657375,"node_id":"MDQ6VXNlcjY1NzM3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/657375?v=4","gravatar_id":"","url":"https://api.github.com/users/chilladx","html_url":"https://github.com/chilladx","followers_url":"https://api.github.com/users/chilladx/followers","following_url":"https://api.github.com/users/chilladx/following{/other_user}","gists_url":"https://api.github.com/users/chilladx/gists{/gist_id}","starred_url":"https://api.github.com/users/chilladx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chilladx/subscriptions","organizations_url":"https://api.github.com/users/chilladx/orgs","repos_url":"https://api.github.com/users/chilladx/repos","events_url":"https://api.github.com/users/chilladx/events{/privacy}","received_events_url":"https://api.github.com/users/chilladx/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-11-03T18:47:26Z","updated_at":"2016-01-05T17:26:04Z","closed_at":"2015-11-04T14:31:02Z","author_association":"NONE","active_lock_reason":null,"body":"When trying to start the master node of my cluster, just after the upgrade from 1.5 to 2.0 (yeah, that's a big jump), I get this error log:\n\n```\n[2015-11-03 18:15:10,948][ERROR][gateway                  ] [mon-01] failed to read local state, exiting...\njava.lang.IllegalStateException: unable to upgrade the mappings for the index [logstash-2015.10.18], reason: [Mapper for [timestamp] conflicts with existing mapping in other types:\n[mapper [timestamp] cannot be changed from type [date] to [string]]]\n```\n\nUnfortunately, I don't have the detailed description of the field or the relevant analyzer configuration for the field, but as its name states, it's a timestamp from logstash, so it should look like one of these:\n- \"dd/MMM/yyyy:HH:mm:ss Z\"\n- \"YYYY-MM-dd HH:mm:ss\"\n- \"HH:mm:ss\"\n- \"YYYY-MM-dd HH:mm:ss,SSS ZZ\"\n- \"YYYY-MM-dd HH:mm:ss,SSSZZ\"\n- \"YYYY-MM-dd HH:mm:ss,SSS\"\n\nThe log ends with this:\n\n```\n[2015-11-03 18:15:11,383][ERROR][bootstrap                ] Guice Exception: java.lang.IllegalStateException: unable to upgrade the mappings for the index [logstash-2015.10.18], reason: [Mapper for [timestamp] conflicts with existing mapping in other types:\n[mapper [timestamp] cannot be changed from type [date] to [string]]]\nLikely root cause: java.lang.IllegalArgumentException: Mapper for [timestamp] conflicts with existing mapping in other types:\n[mapper [timestamp] cannot be changed from type [date] to [string]]\n        at org.elasticsearch.index.mapper.FieldTypeLookup.checkCompatibility(FieldTypeLookup.java:117)\n        at org.elasticsearch.index.mapper.MapperService.checkNewMappersCompatibility(MapperService.java:345)\n        at org.elasticsearch.index.mapper.MapperService.merge(MapperService.java:296)\n        at org.elasticsearch.index.mapper.MapperService.merge(MapperService.java:242)\n        at org.elasticsearch.cluster.metadata.MetaDataIndexUpgradeService.checkMappingsCompatibility(MetaDataIndexUpgradeService.java:329)\n        at org.elasticsearch.cluster.metadata.MetaDataIndexUpgradeService.upgradeIndexMetaData(MetaDataIndexUpgradeService.java:112)\n        at org.elasticsearch.gateway.GatewayMetaState.pre20Upgrade(GatewayMetaState.java:226)\n        at org.elasticsearch.gateway.GatewayMetaState.<init>(GatewayMetaState.java:85)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n        at <<<guice>>>\n        at org.elasticsearch.node.Node.<init>(Node.java:198)\n        at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:145)\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:170)\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:270)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)\n```\n\nAnd the node shuts down..\n\nI have carefully read #13169 and #13345, but none of these helped me, the node keeps failing to start.\n","closed_by":{"login":"chilladx","id":657375,"node_id":"MDQ6VXNlcjY1NzM3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/657375?v=4","gravatar_id":"","url":"https://api.github.com/users/chilladx","html_url":"https://github.com/chilladx","followers_url":"https://api.github.com/users/chilladx/followers","following_url":"https://api.github.com/users/chilladx/following{/other_user}","gists_url":"https://api.github.com/users/chilladx/gists{/gist_id}","starred_url":"https://api.github.com/users/chilladx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chilladx/subscriptions","organizations_url":"https://api.github.com/users/chilladx/orgs","repos_url":"https://api.github.com/users/chilladx/repos","events_url":"https://api.github.com/users/chilladx/events{/privacy}","received_events_url":"https://api.github.com/users/chilladx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}