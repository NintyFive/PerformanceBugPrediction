[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17088657","html_url":"https://github.com/elastic/elasticsearch/issues/2943#issuecomment-17088657","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2943","id":17088657,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDg4NjU3","user":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"created_at":"2013-04-26T17:39:06Z","updated_at":"2013-04-26T17:39:06Z","author_association":"CONTRIBUTOR","body":"Doesn't median (and other percentiles) require total order of the data set across all [distributed] shards?\n\nI might be wrong but I think the best you could get _easily_ is some kind of median estimate but I am not sure how [statistically] accurate it would be (given routing or default assumption about data distribution function as in reality not all data comes from process with normal distribution).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17119371","html_url":"https://github.com/elastic/elasticsearch/issues/2943#issuecomment-17119371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2943","id":17119371,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTE5Mzcx","user":{"login":"pjancarik","id":1137468,"node_id":"MDQ6VXNlcjExMzc0Njg=","avatar_url":"https://avatars2.githubusercontent.com/u/1137468?v=4","gravatar_id":"","url":"https://api.github.com/users/pjancarik","html_url":"https://github.com/pjancarik","followers_url":"https://api.github.com/users/pjancarik/followers","following_url":"https://api.github.com/users/pjancarik/following{/other_user}","gists_url":"https://api.github.com/users/pjancarik/gists{/gist_id}","starred_url":"https://api.github.com/users/pjancarik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjancarik/subscriptions","organizations_url":"https://api.github.com/users/pjancarik/orgs","repos_url":"https://api.github.com/users/pjancarik/repos","events_url":"https://api.github.com/users/pjancarik/events{/privacy}","received_events_url":"https://api.github.com/users/pjancarik/received_events","type":"User","site_admin":false},"created_at":"2013-04-27T16:57:09Z","updated_at":"2013-04-27T16:57:09Z","author_association":"NONE","body":"I need to count median over several time based indexes(so several distributed shards). Now I can only fetch all values from ES and process it in application. In case of several thousands values it can take long time. I try to perform some benchmarks if this is usable approach.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17120148","html_url":"https://github.com/elastic/elasticsearch/issues/2943#issuecomment-17120148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2943","id":17120148,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTIwMTQ4","user":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"created_at":"2013-04-27T17:43:40Z","updated_at":"2013-04-27T17:43:40Z","author_association":"CONTRIBUTOR","body":"Just out of curiosity, why you need median? May be if you can shed more light on your use case we can see if you can calculate median estimate (the chance is that statistical facet gives you all the values you need for estimate calculation).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17123872","html_url":"https://github.com/elastic/elasticsearch/issues/2943#issuecomment-17123872","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2943","id":17123872,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTIzODcy","user":{"login":"pjancarik","id":1137468,"node_id":"MDQ6VXNlcjExMzc0Njg=","avatar_url":"https://avatars2.githubusercontent.com/u/1137468?v=4","gravatar_id":"","url":"https://api.github.com/users/pjancarik","html_url":"https://github.com/pjancarik","followers_url":"https://api.github.com/users/pjancarik/followers","following_url":"https://api.github.com/users/pjancarik/following{/other_user}","gists_url":"https://api.github.com/users/pjancarik/gists{/gist_id}","starred_url":"https://api.github.com/users/pjancarik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjancarik/subscriptions","organizations_url":"https://api.github.com/users/pjancarik/orgs","repos_url":"https://api.github.com/users/pjancarik/repos","events_url":"https://api.github.com/users/pjancarik/events{/privacy}","received_events_url":"https://api.github.com/users/pjancarik/received_events","type":"User","site_admin":false},"created_at":"2013-04-27T21:46:00Z","updated_at":"2013-04-27T21:46:00Z","author_association":"NONE","body":"We store several user metrics in month indexes for last 3 months. One of the metrics for example is \"user_response_time\", which measure how long it takes user to reply on particular request. For each of these metrics we need to count mean, min, max and median for given time range and user. Except median we can count it  via statistical facet.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17130932","html_url":"https://github.com/elastic/elasticsearch/issues/2943#issuecomment-17130932","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2943","id":17130932,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTMwOTMy","user":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"created_at":"2013-04-28T09:03:37Z","updated_at":"2013-04-28T09:03:37Z","author_association":"CONTRIBUTOR","body":"IIRC statistical facet gives you statistics that are based on sum and count. These are currently calculated across distributed shards. But unfortunately this is not the case for median.\n\nI think you have basically two options:\n- try to get the median out of elasticsearch using `sort` and `from/size`. You will need to `count` number of data items upfront, so for example if you have 10 data points then use sort and ask for 5th data item. But I am not sure if this would scale generally across large data sets.\n- calculate median estimate on client size based on you assumptions about the data. Although it might sound scary I think it can work well in many cases.\n\nAs for the median estimate I would try the following:\n- determine data distribution function\n- use calculation for median estimate for that distribution\n\nFirst you need to draw some assumptions about distribution of your data. In your case the data definitely does not follow normal distribution. You are more likely dealing with data that can be modelled by Gamma or Weibull distribution. You can use Goodness-of-fit to test if your data follow particular distribution. [1,2] Good news is you can use histogram facet for this test.\n\n[1] http://en.wikipedia.org/wiki/Goodness_of_fit\n[2] http://cs.wikipedia.org/wiki/Test_dobr√©_shody (in czech)\n\nThen use median estimate calculation. For example if you find out that your data can be modelled by Weibull distribution then there is known way how to estimate median [3,4]\n\n[3] http://en.wikipedia.org/wiki/Weibull_distribution\n[4] http://www.itl.nist.gov/div898/handbook/eda/section3/eda3668.htm\n\nThe challenge can be to calculate all the parameters that are needed for median estimate (see example [5] or more general discussion on various approaches [6])\n\n[5] http://www.itl.nist.gov/div898/handbook/apr/section4/apr413.htm\n[6] http://interstat.statjournals.net/YEAR/2000/articles/0010001.pdf\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17130946","html_url":"https://github.com/elastic/elasticsearch/issues/2943#issuecomment-17130946","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2943","id":17130946,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTMwOTQ2","user":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"created_at":"2013-04-28T09:05:23Z","updated_at":"2013-04-28T09:05:23Z","author_association":"CONTRIBUTOR","body":"Anyway, I would also recommend you to ask on ML. I might be simply wrong.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17137364","html_url":"https://github.com/elastic/elasticsearch/issues/2943#issuecomment-17137364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2943","id":17137364,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTM3MzY0","user":{"login":"pjancarik","id":1137468,"node_id":"MDQ6VXNlcjExMzc0Njg=","avatar_url":"https://avatars2.githubusercontent.com/u/1137468?v=4","gravatar_id":"","url":"https://api.github.com/users/pjancarik","html_url":"https://github.com/pjancarik","followers_url":"https://api.github.com/users/pjancarik/followers","following_url":"https://api.github.com/users/pjancarik/following{/other_user}","gists_url":"https://api.github.com/users/pjancarik/gists{/gist_id}","starred_url":"https://api.github.com/users/pjancarik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjancarik/subscriptions","organizations_url":"https://api.github.com/users/pjancarik/orgs","repos_url":"https://api.github.com/users/pjancarik/repos","events_url":"https://api.github.com/users/pjancarik/events{/privacy}","received_events_url":"https://api.github.com/users/pjancarik/received_events","type":"User","site_admin":false},"created_at":"2013-04-28T16:57:13Z","updated_at":"2013-04-28T16:57:13Z","author_association":"NONE","body":"Thanks Lukas for your thorough description and tips. Using sort and from/size will be suitable for this use case, because I don't expect the data items size in most cases exceed 1000. There are plans for others median use cases for future with much more data sets, so than I will try your suggestions.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/36537592","html_url":"https://github.com/elastic/elasticsearch/issues/2943#issuecomment-36537592","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2943","id":36537592,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTM3NTky","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-03-03T17:55:43Z","updated_at":"2014-03-03T17:55:43Z","author_association":"CONTRIBUTOR","body":"FYI, we just added a new `percentiles` aggregation that allows to compute an approximate value of the median, see #5323.\n","performed_via_github_app":null}]