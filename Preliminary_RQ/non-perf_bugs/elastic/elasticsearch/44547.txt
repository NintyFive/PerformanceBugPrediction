{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44547","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44547/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44547/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44547/events","html_url":"https://github.com/elastic/elasticsearch/issues/44547","id":469685148,"node_id":"MDU6SXNzdWU0Njk2ODUxNDg=","number":44547,"title":"Different role names result in permission problems","user":{"login":"wuuti","id":2852461,"node_id":"MDQ6VXNlcjI4NTI0NjE=","avatar_url":"https://avatars2.githubusercontent.com/u/2852461?v=4","gravatar_id":"","url":"https://api.github.com/users/wuuti","html_url":"https://github.com/wuuti","followers_url":"https://api.github.com/users/wuuti/followers","following_url":"https://api.github.com/users/wuuti/following{/other_user}","gists_url":"https://api.github.com/users/wuuti/gists{/gist_id}","starred_url":"https://api.github.com/users/wuuti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuuti/subscriptions","organizations_url":"https://api.github.com/users/wuuti/orgs","repos_url":"https://api.github.com/users/wuuti/repos","events_url":"https://api.github.com/users/wuuti/events{/privacy}","received_events_url":"https://api.github.com/users/wuuti/received_events","type":"User","site_admin":false},"labels":[{"id":912838209,"node_id":"MDU6TGFiZWw5MTI4MzgyMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authorization","name":":Security/Authorization","color":"0e8a16","default":false,"description":"Roles, Privileges, DLS/FLS, RBAC/ABAC"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-07-18T10:12:05Z","updated_at":"2019-07-18T12:39:06Z","closed_at":"2019-07-18T12:39:05Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 6.8 (docker image), also on Elastic Cloud!\r\n\r\nI have found a weird bug with permissions and roles. I wanted to set up a user with restricted permissions for an API talking to elastic. It turned out, that the naming of the role results in different permissions.\r\n\r\n## Steps to reproduce\r\n\r\nFirst create the problematic role with a role name \"qy_role.api\":\r\n```bash\r\ncurl -X POST \\\r\n  http://localhost:9200/_security/role/qy_role.api \\\r\n  -H 'Authorization: Basic [...snip...] ==' \\\r\n  -H 'Content-Type: application/json' \\\r\n  -H 'Host: localhost:9200' \\\r\n  -d '{\r\n    \"cluster\" : [\r\n      \"monitor\",\r\n      \"cluster:admin/repository/put\",\r\n      \"cluster:admin/snapshot/delete\",\r\n      \"cluster:admin/snapshot/create\"\r\n    ],\r\n    \"indices\" : [\r\n      {\r\n        \"names\" : [\r\n          \"qy_*\"\r\n        ],\r\n        \"privileges\" : [\r\n          \"read\",\r\n          \"index\",\r\n          \"create\",\r\n          \"write\",\r\n          \"delete\",\r\n          \"create_index\",\r\n          \"monitor\",\r\n          \"manage\",\r\n          \"indices:monitor/settings/get\"\r\n        ],\r\n        \"field_security\" : {\r\n          \"grant\" : [\r\n            \"*\"\r\n          ]\r\n        },\r\n        \"allow_restricted_indices\" : false\r\n      }\r\n    ],\r\n    \"applications\" : [ ],\r\n    \"run_as\" : [ ],\r\n    \"metadata\" : { },\r\n    \"transient_metadata\" : {\r\n      \"enabled\" : true\r\n    }\r\n}'\r\n```\r\nThen create the user mapped to this role:\r\n```bash\r\ncurl -X POST \\\r\n  http://localhost:9200/_security/user/qy.user \\\r\n  -H 'Authorization: Basic [...snip...] ==' \\\r\n  -H 'Content-Type: application/json' \\\r\n  -H 'Host: localhost:9200' \\\r\n  -d '{\r\n  \"password\" : \"password\",\r\n  \"roles\" : [ \"qy_role.api\" ],\r\n  \"full_name\" : \"My User\",\r\n  \"email\" : \"user@test.local\",\r\n  \"metadata\" : {\r\n  }\r\n}'\r\n```\r\nIf you then try to, e.g. create an index \"qy_platforms-2019.05.10\" and alias \"qy_platforms\" with that user, you will end up with  \r\n```json\r\n{\"error\":{\"root_cause\":[{\"type\":\"security_exception\",\"reason\":\"action [indi  \r\n  ces:admin/aliases] is unauthorized for user [qy.user]\"}],\"type\":\"security_e  \r\n  xception\",\"reason\":\"action [indices:admin/aliases] is unauthorized for user  \r\n   [qy.user]\"},\"status\":403}  \r\n```\r\n\r\n## Steps to make it work\r\nIf you simply replace the role name \"qy_role.api\" in the above two curls with ***my_role.api***, it magically works to create an index and do all the other stuff from the privilege list.  \r\n\r\n## Expected behaviour\r\nI would either both role names expect to trigger the exception (making clear that something in the permissions might be wrong), _or_ both role names to work as being set up.\r\n","closed_by":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"performed_via_github_app":null}