{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8596","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8596/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8596/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8596/events","html_url":"https://github.com/elastic/elasticsearch/issues/8596","id":49723546,"node_id":"MDU6SXNzdWU0OTcyMzU0Ng==","number":8596,"title":"Prefix expansions should be based on term frequency","user":{"login":"gibrown","id":820871,"node_id":"MDQ6VXNlcjgyMDg3MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/820871?v=4","gravatar_id":"","url":"https://api.github.com/users/gibrown","html_url":"https://github.com/gibrown","followers_url":"https://api.github.com/users/gibrown/followers","following_url":"https://api.github.com/users/gibrown/following{/other_user}","gists_url":"https://api.github.com/users/gibrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gibrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gibrown/subscriptions","organizations_url":"https://api.github.com/users/gibrown/orgs","repos_url":"https://api.github.com/users/gibrown/repos","events_url":"https://api.github.com/users/gibrown/events{/privacy}","received_events_url":"https://api.github.com/users/gibrown/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2014-11-21T17:20:04Z","updated_at":"2015-11-21T21:36:56Z","closed_at":"2015-11-21T21:36:56Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"It appears (and I read somewhere) that prefix expansions (for multi-match phrase prefix queries for instance) are sorted alphabetically. This means that the max_expansions limits limit can get hit quickly for short text.\n\nAn example I was looking at was searching for \"related pos\". Should match a bunch of docs I have mentioning \"related posts\", but matches nothing unless I set max expansions to 5000. My filters are limiting us to a search of about 3000 docs in an index of many millions of docs, so there are a lot of words starting with \"pos\" that are going to get in the way of the prefix query.\n\nI think a better sorting of which terms to expand on would be to start with the terms with the lowest document frequency since they will be the most discerning of importance. I think this should be a doable change. Any pointers on if there is a reader to get the terms with frequencies?\n\nEven better would be to limit which terms are chosen based on the filters being applied. I'm not sure that's possible though given the query execution order.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}