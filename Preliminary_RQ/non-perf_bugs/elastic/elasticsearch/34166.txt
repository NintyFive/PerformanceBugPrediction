{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34166","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34166/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34166/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34166/events","html_url":"https://github.com/elastic/elasticsearch/issues/34166","id":365184690,"node_id":"MDU6SXNzdWUzNjUxODQ2OTA=","number":34166,"title":"How to use HasPrivilegesAction to check user's privileges","user":{"login":"jemoii","id":10105398,"node_id":"MDQ6VXNlcjEwMTA1Mzk4","avatar_url":"https://avatars1.githubusercontent.com/u/10105398?v=4","gravatar_id":"","url":"https://api.github.com/users/jemoii","html_url":"https://github.com/jemoii","followers_url":"https://api.github.com/users/jemoii/followers","following_url":"https://api.github.com/users/jemoii/following{/other_user}","gists_url":"https://api.github.com/users/jemoii/gists{/gist_id}","starred_url":"https://api.github.com/users/jemoii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jemoii/subscriptions","organizations_url":"https://api.github.com/users/jemoii/orgs","repos_url":"https://api.github.com/users/jemoii/repos","events_url":"https://api.github.com/users/jemoii/events{/privacy}","received_events_url":"https://api.github.com/users/jemoii/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-09-30T02:29:52Z","updated_at":"2018-10-01T08:13:12Z","closed_at":"2018-10-01T08:13:11Z","author_association":"NONE","active_lock_reason":null,"body":"When I follow [security-api-privileges](https://www.elastic.co/guide/en/elasticsearch/reference/5.5/security-api-privileges.html) to check user's privileges, \r\n\r\n- curl:\r\n```\r\ncurl -X POST \\\r\n  http://localhost:9200/_xpack/security/user/_has_privileges \\\r\n  -H 'Authorization: Basic ${base64}' \\\r\n  -H 'Cache-Control: no-cache' \\\r\n  -H 'Content-Type: application/json' \\\r\n  -d '{\"cluster\": [ \"monitor\", \"manage\" ]}'\r\n```\r\n```json\r\n{\r\n    \"username\": \"linda\",\r\n    \"has_all_requested\": true,\r\n    \"cluster\": {\r\n        \"monitor\": true,\r\n        \"manage\": false\r\n    },\r\n    \"index\": {}\r\n}\r\n```\r\n\r\n- Java code(`org.elasticsearch.plugin:x-pack-api:5.5.0`):\r\n```java\r\nHasPrivilegesRequestBuilder hasPrivilegesRequestBuilder = HasPrivilegesAction.INSTANCE.newRequestBuilder(transportClient);\r\nhasPrivilegesRequestBuilder.request().username(\"linda\");\r\nhasPrivilegesRequestBuilder.request().clusterPrivileges(\"monitor\", \"manage\");\r\nhasPrivilegesRequestBuilder.request().indexPrivileges(new RoleDescriptor.IndicesPrivileges[0]);\r\nHasPrivilegesResponse hasPrivilegesResponse = hasPrivilegesRequestBuilder.get(TimeValue.timeValueMillis(2000));\r\n```\r\n\r\n`linda` is my username for cluster, if has no specified username , `HasPrivilegesRequest#writeTo` will throw NullPointException.\r\nBut I'm puzzled about `HasPrivilegesResponse`,\r\n\r\n```java\r\npublic class HasPrivilegesResponse extends ActionResponse {\r\n    private boolean completeMatch;\r\n    private Map<String, Boolean> cluster;\r\n    private List<HasPrivilegesResponse.IndexPrivileges> index;\r\n```\r\nIn `HasPrivilegesResponse`, it's `completeMatch` not `has_all_request` or `hasAllRequest`, and `cluster` is always empty.\r\n\r\nIs there something wrong with my code? Thank you for pointing it.\r\n\r\n- elasticsearch version, 5.5.0\r\n- Java version, 1.8.0_151","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}