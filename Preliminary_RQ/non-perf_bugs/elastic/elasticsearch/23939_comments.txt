[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292121231","html_url":"https://github.com/elastic/elasticsearch/issues/23939#issuecomment-292121231","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23939","id":292121231,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjEyMTIzMQ==","user":{"login":"sikelong123","id":19286508,"node_id":"MDQ6VXNlcjE5Mjg2NTA4","avatar_url":"https://avatars2.githubusercontent.com/u/19286508?v=4","gravatar_id":"","url":"https://api.github.com/users/sikelong123","html_url":"https://github.com/sikelong123","followers_url":"https://api.github.com/users/sikelong123/followers","following_url":"https://api.github.com/users/sikelong123/following{/other_user}","gists_url":"https://api.github.com/users/sikelong123/gists{/gist_id}","starred_url":"https://api.github.com/users/sikelong123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sikelong123/subscriptions","organizations_url":"https://api.github.com/users/sikelong123/orgs","repos_url":"https://api.github.com/users/sikelong123/repos","events_url":"https://api.github.com/users/sikelong123/events{/privacy}","received_events_url":"https://api.github.com/users/sikelong123/received_events","type":"User","site_admin":false},"created_at":"2017-04-06T09:36:49Z","updated_at":"2017-04-06T09:36:49Z","author_association":"NONE","body":"The first problem: null pointer problem\r\nSecond questions: rejoin,java.io.IOException: failed to obtain in-memory shard lock","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292122162","html_url":"https://github.com/elastic/elasticsearch/issues/23939#issuecomment-292122162","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23939","id":292122162,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjEyMjE2Mg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-06T09:40:31Z","updated_at":"2017-04-06T09:40:31Z","author_association":"CONTRIBUTOR","body":"1) That NullPointerException is harmless, but has been fixed in #21084, which is in ES v5.0.2+. Please upgrade.\r\n2) Is your cluster health still red? Does running `curl -XPOST 'localhost:9200/_cluster/reroute?retry_failed` solve the issue? If not, can you post the output of `curl -XGET 'localhost:9200/_cluster/allocation/explain`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292128582","html_url":"https://github.com/elastic/elasticsearch/issues/23939#issuecomment-292128582","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23939","id":292128582,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjEyODU4Mg==","user":{"login":"sikelong123","id":19286508,"node_id":"MDQ6VXNlcjE5Mjg2NTA4","avatar_url":"https://avatars2.githubusercontent.com/u/19286508?v=4","gravatar_id":"","url":"https://api.github.com/users/sikelong123","html_url":"https://github.com/sikelong123","followers_url":"https://api.github.com/users/sikelong123/followers","following_url":"https://api.github.com/users/sikelong123/following{/other_user}","gists_url":"https://api.github.com/users/sikelong123/gists{/gist_id}","starred_url":"https://api.github.com/users/sikelong123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sikelong123/subscriptions","organizations_url":"https://api.github.com/users/sikelong123/orgs","repos_url":"https://api.github.com/users/sikelong123/repos","events_url":"https://api.github.com/users/sikelong123/events{/privacy}","received_events_url":"https://api.github.com/users/sikelong123/received_events","type":"User","site_admin":false},"created_at":"2017-04-06T10:07:16Z","updated_at":"2017-04-06T10:07:16Z","author_association":"NONE","body":"A lot of main shards are lost before reboot.No problem after the restart.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292128651","html_url":"https://github.com/elastic/elasticsearch/issues/23939#issuecomment-292128651","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23939","id":292128651,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjEyODY1MQ==","user":{"login":"sikelong123","id":19286508,"node_id":"MDQ6VXNlcjE5Mjg2NTA4","avatar_url":"https://avatars2.githubusercontent.com/u/19286508?v=4","gravatar_id":"","url":"https://api.github.com/users/sikelong123","html_url":"https://github.com/sikelong123","followers_url":"https://api.github.com/users/sikelong123/followers","following_url":"https://api.github.com/users/sikelong123/following{/other_user}","gists_url":"https://api.github.com/users/sikelong123/gists{/gist_id}","starred_url":"https://api.github.com/users/sikelong123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sikelong123/subscriptions","organizations_url":"https://api.github.com/users/sikelong123/orgs","repos_url":"https://api.github.com/users/sikelong123/repos","events_url":"https://api.github.com/users/sikelong123/events{/privacy}","received_events_url":"https://api.github.com/users/sikelong123/received_events","type":"User","site_admin":false},"created_at":"2017-04-06T10:07:33Z","updated_at":"2017-04-06T10:07:33Z","author_association":"NONE","body":"@ywelsch ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292133360","html_url":"https://github.com/elastic/elasticsearch/issues/23939#issuecomment-292133360","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23939","id":292133360,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjEzMzM2MA==","user":{"login":"sikelong123","id":19286508,"node_id":"MDQ6VXNlcjE5Mjg2NTA4","avatar_url":"https://avatars2.githubusercontent.com/u/19286508?v=4","gravatar_id":"","url":"https://api.github.com/users/sikelong123","html_url":"https://github.com/sikelong123","followers_url":"https://api.github.com/users/sikelong123/followers","following_url":"https://api.github.com/users/sikelong123/following{/other_user}","gists_url":"https://api.github.com/users/sikelong123/gists{/gist_id}","starred_url":"https://api.github.com/users/sikelong123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sikelong123/subscriptions","organizations_url":"https://api.github.com/users/sikelong123/orgs","repos_url":"https://api.github.com/users/sikelong123/repos","events_url":"https://api.github.com/users/sikelong123/events{/privacy}","received_events_url":"https://api.github.com/users/sikelong123/received_events","type":"User","site_admin":false},"created_at":"2017-04-06T10:29:17Z","updated_at":"2017-04-06T10:29:17Z","author_association":"NONE","body":"old gc logs:\r\n**firdt:**\r\n[2017-04-03T08:18:52,492][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][young][4633755][90625] duration [3.2s], collections [1]/[1.6m], total [3.2s]/[1.4h], memory [57.1gb]->[32.2gb]/[59.9gb], all_pools {[young] [24.7gb]->[266.6mb]/[24.8gb]}{[survivor] [515.9mb]->[0b]/[3gb]}{[old] [31.8gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:18:52,492][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4633755][2718] duration [1.6m], collections [2]/[1.6m], total [1.6m]/[29.6m], memory [57.1gb]->[32.2gb]/[59.9gb], all_pools {[young] [24.7gb]->[266.6mb]/[24.8gb]}{[survivor] [515.9mb]->[0b]/[3gb]}{[old] [31.8gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:18:52,492][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4633755] overhead, spent [1.6m] collecting in the last [1.6m]\r\n**second**\r\n[2017-04-03T08:19:42,618][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4633804] overhead, spent [1.2s] collecting in the last [1.9s]\r\n[2017-04-03T08:21:20,793][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4633811][2720] duration [1.5m], collections [2]/[1.5m], total [1.5m]/[31.2m], memory [59.8gb]->[32.6gb]/[59.9gb], all_pools {[young] [24.8gb]->[635.3mb]/[24.8gb]}{[survivor] [3gb]->[0b]/[3gb]}{[old] [31.9gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:21:20,793][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4633811] overhead, spent [1.5m] collecting in the last [1.5m]\r\n\r\n**third**\r\n[2017-04-03T08:23:58,283][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4633880][2722] duration [1.4m], collections [1]/[1.4m], total [1.4m]/[32.7m], memory [59.6gb]->[32.3gb]/[59.9gb], all_pools {[young] [24.8gb]->[398.6mb]/[24.8gb]}{[survivor] [2.8gb]->[0b]/[3gb]}{[old] [31.9gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:23:58,283][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4633880] overhead, spent [1.4m] collecting in the last [1.4m]\r\n[2017-04-03T08:26:09,411][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4633925][2723] duration [1.4m], collections [1]/[1.4m], total [1.4m]/[34.1m], memory [59.8gb]->[32.3gb]/[59.9gb], all_pools {[young] [24.8gb]->[401mb]/[24.8gb]}{[survivor] [3gb]->[0b]/[3gb]}{[old] [31.9gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:26:09,411][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4633925] overhead, spent [1.4m] collecting in the last [1.4m]\r\n[2017-04-03T08:26:23,477][INFO ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4633939] overhead, spent [433ms] collecting in the last [1s]\r\n[2017-04-03T08:27:56,157][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4633941][2725] duration [1.5m], collections [2]/[1.5m], total [1.5m]/[35.6m], memory [56.1gb]->[31.9gb]/[59.9gb], all_pools {[young] [24.2gb]->[19.3mb]/[24.8gb]}{[survivor] [0b]->[0b]/[3gb]}{[old] [31.9gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:27:56,157][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4633941] overhead, spent [1.5m] collecting in the last [1.5m]\r\n**fourth**\r\n[2017-04-03T08:34:08,761][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4634225][2735] duration [1.4m], collections [1]/[1.4m], total [1.4m]/[37.2m], memory [56.9gb]->[32.3gb]/[59.9gb], all_pools {[young] [24.2gb]->[374.5mb]/[24.8gb]}{[survivor] [844.2mb]->[0b]/[3gb]}{[old] [31.8gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:34:08,761][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4634225] overhead, spent [1.4m] collecting in the last [1.4m]\r\n[2017-04-03T08:36:22,252][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4634259][2736] duration [1.6m], collections [1]/[1.6m], total [1.6m]/[38.9m], memory [59.8gb]->[32.6gb]/[59.9gb], all_pools {[young] [24.8gb]->[671.6mb]/[24.8gb]}{[survivor] [3gb]->[0b]/[3gb]}{[old] [31.9gb]->[32gb]/[32gb]}\r\n[2017-04-03T08:36:22,253][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4634259] overhead, spent [1.6m] collecting in the last [1.6m]\r\n\r\n**fifth**\r\n[2017-04-03T08:38:32,952][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4634288][2737] duration [1.6m], collections [1]/[1.7m], total [1.6m]/[40.6m], memory [59.6gb]->[32.4gb]/[59.9gb], all_pools {[young] [24.8gb]->[436mb]/[24.8gb]}{[survivor] [2.8gb]->[0b]/[3gb]}{[old] [32gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:38:32,952][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4634288] overhead, spent [1.6m] collecting in the last [1.7m]\r\n**sixth**\r\n[2017-04-03T08:40:46,187][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4634324][2738] duration [1.6m], collections [1]/[1.6m], total [1.6m]/[42.2m], memory [59.7gb]->[32.1gb]/[59.9gb], all_pools {[young] [24.8gb]->[203mb]/[24.8gb]}{[survivor] [2.9gb]->[0b]/[3gb]}{[old] [31.9gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:40:46,187][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4634324] overhead, spent [1.6m] collecting in the last [1.6m]\r\n\r\n**seventh**\r\n[2017-04-03T08:42:56,802][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4634370][2739] duration [1.4m], collections [1]/[1.4m], total [1.4m]/[43.6m], memory [59.8gb]->[32.2gb]/[59.9gb], all_pools {[young] [24.8gb]->[247.9mb]/[24.8gb]}{[survivor] [3gb]->[0b]/[3gb]}{[old] [31.9gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:42:56,802][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4634370] overhead, spent [1.4m] collecting in the last [1.4m]\r\n[2017-04-03T08:45:07,732][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4634400][2740] duration [1.6m], collections [1]/[1.6m], total [1.6m]/[45.3m], memory [59.7gb]->[32.4gb]/[59.9gb], all_pools {[young] [24.8gb]->[500.6mb]/[24.8gb]}{[survivor] [2.9gb]->[0b]/[3gb]}{[old] [31.9gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:45:07,732][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4634400] overhead, spent [1.6m] collecting in the last [1.6m]\r\n**eighth**\r\n[2017-04-03T08:47:19,016][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][old][4634428][2741] duration [1.7m], collections [1]/[1.7m], total [1.7m]/[47.1m], memory [59.8gb]->[32.5gb]/[59.9gb], all_pools {[young] [24.8gb]->[532.6mb]/[24.8gb]}{[survivor] [3gb]->[0b]/[3gb]}{[old] [31.9gb]->[31.9gb]/[32gb]}\r\n[2017-04-03T08:47:19,028][WARN ][o.e.m.j.JvmGcMonitorService] [mogu015052] [gc][4634428] overhead, spent [1.7m] collecting in the last [1.7m]\r\n\r\n......\r\n\r\n\r\n\r\nBut why does it lead to second problems?\r\nAlso, why is primary shard lost?\r\nThe following issue similar with my problem, but also to turn over some of the parameters as you said, but second problems still happen above\r\n[https://github.com/elastic/elasticsearch/issues/23199](url)\r\n@ywelsch \r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292145407","html_url":"https://github.com/elastic/elasticsearch/issues/23939#issuecomment-292145407","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23939","id":292145407,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjE0NTQwNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-06T11:28:58Z","updated_at":"2017-04-06T11:28:58Z","author_association":"CONTRIBUTOR","body":"> But why does it lead to second problems?\r\n\r\nIt's all explained in #23199: \r\n\r\n> The ShardLockObtainFailedException manifests as a result of cluster instabilities having nodes come and go quickly. More resources on data nodes can, but is not guaranteed to, remedy such situations.\r\n\r\nWhen the cluster forms again after long GC / network disconnects, and the master allocates the shards to the problematic node, the node first has to properly shutdown the existing shard resources. This can take a while, depending on the operations that were previously running. This manifests in the ShardLock failures, as the new shard instance cannot be created while the old one is not fully cleaned up. We are currently investigating how we can provide more insight into which types of operations are preventing the old shard instance from being released, which will require code changes.\r\n\r\n> Also, why is primary shard lost?\r\n\r\nIt's not lost. What happens is that the shard cannot be allocated as long as the locks of the previous instance are not being released.\r\n\r\nAs this is a duplicate of #23199 now, I'm closing this one.","performed_via_github_app":null}]