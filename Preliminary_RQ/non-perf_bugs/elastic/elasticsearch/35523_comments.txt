[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438597511","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438597511","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438597511,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODU5NzUxMQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T09:34:33Z","updated_at":"2018-11-14T09:34:33Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438602081","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438602081","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438602081,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODYwMjA4MQ==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T09:48:49Z","updated_at":"2018-11-14T09:48:49Z","author_association":"CONTRIBUTOR","body":"It looks like we inherit spatial4j's GeoHashUtils. MAX_PRECISION of 24 but [our docs](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-geohashgrid-aggregation.html) for geohashgrid claim 12 is the highest accepted resolution. \r\n\r\nI'm not sure where in the REST layer we expose the option to pick precision using meters not levels - (didn't appear in the geohashgrid agg docs)  so I'm not sure if this \"max\" inconsistency affects clients.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438608100","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438608100","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438608100,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODYwODEwMA==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T10:08:23Z","updated_at":"2018-11-14T10:08:23Z","author_association":"CONTRIBUTOR","body":"@markharwood note that there are two different things:\r\n\r\n1) Spatial prefix tree based on geohash that support up to 24 levels. This is used when indexing geo_shapes and the `tree` is set to geohash.  For  [geohash prefix tree](https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-shape.html#prefix-trees),  the maximum level is 24.\r\n2) Geohash grid aggregation which supports up to 12 levels. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438611424","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438611424","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438611424,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODYxMTQyNA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T10:18:58Z","updated_at":"2018-11-14T10:18:58Z","author_association":"CONTRIBUTOR","body":"OK. I'm not a geo expert so I'll leave it to the geo team to comment but perhaps one reason for the 12 vs 24 discrepancy is the different contexts:\r\nGeohashGrid agg - being end-user facing we don't want to render gigabytes of fine-grained JSON information at the lower levels of detail, especially when used with sub aggregations.\r\nSpatial indexes used for measuring shape intersections may want to use higher levels of detail for accurate matching.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438677444","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438677444","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438677444,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODY3NzQ0NA==","user":{"login":"chamini2","id":2745502,"node_id":"MDQ6VXNlcjI3NDU1MDI=","avatar_url":"https://avatars0.githubusercontent.com/u/2745502?v=4","gravatar_id":"","url":"https://api.github.com/users/chamini2","html_url":"https://github.com/chamini2","followers_url":"https://api.github.com/users/chamini2/followers","following_url":"https://api.github.com/users/chamini2/following{/other_user}","gists_url":"https://api.github.com/users/chamini2/gists{/gist_id}","starred_url":"https://api.github.com/users/chamini2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chamini2/subscriptions","organizations_url":"https://api.github.com/users/chamini2/orgs","repos_url":"https://api.github.com/users/chamini2/repos","events_url":"https://api.github.com/users/chamini2/events{/privacy}","received_events_url":"https://api.github.com/users/chamini2/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T14:19:44Z","updated_at":"2018-11-14T14:19:44Z","author_association":"NONE","body":"@iverase, but the weird part is that sending a 0 to that method returns a 24, and then sending a 1 returns a 11; there is no in between. (I did not try to send floating number between 0 and 1, though :thinking:)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438684921","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438684921","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438684921,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODY4NDkyMQ==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T14:41:59Z","updated_at":"2018-11-14T14:46:41Z","author_association":"CONTRIBUTOR","body":"@chamini2:  That is actually right as 1 meter precision is around 11 levels. If you try 1 mm (0.001 meters) then you see that the levels are 15.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438686398","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438686398","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438686398,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODY4NjM5OA==","user":{"login":"chamini2","id":2745502,"node_id":"MDQ6VXNlcjI3NDU1MDI=","avatar_url":"https://avatars0.githubusercontent.com/u/2745502?v=4","gravatar_id":"","url":"https://api.github.com/users/chamini2","html_url":"https://github.com/chamini2","followers_url":"https://api.github.com/users/chamini2/followers","following_url":"https://api.github.com/users/chamini2/following{/other_user}","gists_url":"https://api.github.com/users/chamini2/gists{/gist_id}","starred_url":"https://api.github.com/users/chamini2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chamini2/subscriptions","organizations_url":"https://api.github.com/users/chamini2/orgs","repos_url":"https://api.github.com/users/chamini2/repos","events_url":"https://api.github.com/users/chamini2/events{/privacy}","received_events_url":"https://api.github.com/users/chamini2/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T14:46:15Z","updated_at":"2018-11-14T14:46:15Z","author_association":"NONE","body":"In case that returning 24 makes sense for this case... Where can I find an equivalent method for geohash grid?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438714694","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438714694","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438714694,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODcxNDY5NA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T16:00:05Z","updated_at":"2018-11-14T16:00:05Z","author_association":"CONTRIBUTOR","body":">Where can I find an equivalent method for geohash grid?\r\n\r\nDo you mean you want 24 levels in geohashgrid agg or you want to express precision using meters not level numbers?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438717543","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438717543","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438717543,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODcxNzU0Mw==","user":{"login":"chamini2","id":2745502,"node_id":"MDQ6VXNlcjI3NDU1MDI=","avatar_url":"https://avatars0.githubusercontent.com/u/2745502?v=4","gravatar_id":"","url":"https://api.github.com/users/chamini2","html_url":"https://github.com/chamini2","followers_url":"https://api.github.com/users/chamini2/followers","following_url":"https://api.github.com/users/chamini2/following{/other_user}","gists_url":"https://api.github.com/users/chamini2/gists{/gist_id}","starred_url":"https://api.github.com/users/chamini2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chamini2/subscriptions","organizations_url":"https://api.github.com/users/chamini2/orgs","repos_url":"https://api.github.com/users/chamini2/repos","events_url":"https://api.github.com/users/chamini2/events{/privacy}","received_events_url":"https://api.github.com/users/chamini2/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T16:07:08Z","updated_at":"2018-11-14T16:07:08Z","author_association":"NONE","body":"I want a method that works just like `geoHashLevelsForPrecision` but returns 12 or less (like https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-geohashgrid-aggregation.html says), not 24 (which seems to be appropriate for geohash prefix tree)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438724490","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438724490","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438724490,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODcyNDQ5MA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T16:25:37Z","updated_at":"2018-11-14T16:25:37Z","author_association":"CONTRIBUTOR","body":">I want a method \r\n\r\nAre we talking Java methods? So the equivalent of:\r\n\r\n     Math.min(12, GeoUtils.geoHashLevelsForPrecision(meters))\r\n\r\nWhen we talk about changes to the elasticsearch API we generally talk about changing the REST interface for the benefit of all languages (python, perl etc). \r\nWe're not a Java SDK so we don't generally discuss making changes to internal classes to make only one language client (Java) happier.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438736639","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438736639","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438736639,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODczNjYzOQ==","user":{"login":"chamini2","id":2745502,"node_id":"MDQ6VXNlcjI3NDU1MDI=","avatar_url":"https://avatars0.githubusercontent.com/u/2745502?v=4","gravatar_id":"","url":"https://api.github.com/users/chamini2","html_url":"https://github.com/chamini2","followers_url":"https://api.github.com/users/chamini2/followers","following_url":"https://api.github.com/users/chamini2/following{/other_user}","gists_url":"https://api.github.com/users/chamini2/gists{/gist_id}","starred_url":"https://api.github.com/users/chamini2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chamini2/subscriptions","organizations_url":"https://api.github.com/users/chamini2/orgs","repos_url":"https://api.github.com/users/chamini2/repos","events_url":"https://api.github.com/users/chamini2/events{/privacy}","received_events_url":"https://api.github.com/users/chamini2/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T16:58:17Z","updated_at":"2018-11-14T16:58:17Z","author_association":"NONE","body":"I understand that, but this seems like a bug on the Java client from my point of view. Allowing precision to be 24 in geohash grid would be good anyways.\r\n\r\nWhere should I open Java client specific bugs?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438750950","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438750950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438750950,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODc1MDk1MA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T17:38:09Z","updated_at":"2018-11-14T17:38:09Z","author_association":"CONTRIBUTOR","body":">Allowing precision to be 24 in geohash grid would be good anyways.\r\n\r\nCan you say more about the use cases where this would be useful? We tend to avoid features that can easily create a bazillion buckets when not used with care.\r\n\r\n>Where should I open Java client specific bugs?\r\n\r\nI suspect GeoUtils is not considered to be part of the Java client. We are moving to a lightweight Java client free of server-side dependencies which will expose as much or little functionality as all other clients have access to via the REST api. Java apps should stop building dependencies on server code.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438783743","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438783743","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438783743,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODc4Mzc0Mw==","user":{"login":"chamini2","id":2745502,"node_id":"MDQ6VXNlcjI3NDU1MDI=","avatar_url":"https://avatars0.githubusercontent.com/u/2745502?v=4","gravatar_id":"","url":"https://api.github.com/users/chamini2","html_url":"https://github.com/chamini2","followers_url":"https://api.github.com/users/chamini2/followers","following_url":"https://api.github.com/users/chamini2/following{/other_user}","gists_url":"https://api.github.com/users/chamini2/gists{/gist_id}","starred_url":"https://api.github.com/users/chamini2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chamini2/subscriptions","organizations_url":"https://api.github.com/users/chamini2/orgs","repos_url":"https://api.github.com/users/chamini2/repos","events_url":"https://api.github.com/users/chamini2/events{/privacy}","received_events_url":"https://api.github.com/users/chamini2/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T19:15:13Z","updated_at":"2018-11-14T19:15:13Z","author_association":"NONE","body":"Then there is a bug on the java server?\r\n\r\nDoing `GeoUtils.checkPrecisionRange(GeoUtils.geoHashLevelsForPrecision(0))` throws an error:\r\n\r\n```\r\n    public static int checkPrecisionRange(int precision) {\r\n        if ((precision < 1) || (precision > 12)) {\r\n            throw new IllegalArgumentException(\"Invalid geohash aggregation precision of \" + precision\r\n                + \". Must be between 1 and 12.\");\r\n        }\r\n        return precision;\r\n    }\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438795000","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438795000","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":438795000,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODc5NTAwMA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T19:50:22Z","updated_at":"2018-11-14T19:50:22Z","author_association":"CONTRIBUTOR","body":"GeoUtils.checkPrecisionRange is only used by `org.elasticsearch.search.aggregations.bucket.geogrid.GeoGridAggregationBuilder` and `org.elasticsearch.search.suggest.completion.context.GeoQueryContext` both of which have documented precision limits of 12.\r\nI don't think theres an issue to be flagged here unless @nknize has a concern over the 24-level shape encoding support in the index but only a 12-level aggregation support.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446700690","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-446700690","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":446700690,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjcwMDY5MA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-12-12T18:52:28Z","updated_at":"2018-12-12T18:52:28Z","author_association":"MEMBER","body":"I think returning 12 for `GeoUtils.geoHashLevelsForPrecision(0)` might be misleading. This function is used in parsing geo hash aggs. So, right now if a user runs something like this:\r\n```\r\nPOST /museums/_search?size=0\r\n{\r\n    \"aggregations\" : {\r\n        \"large-grid\" : {\r\n            \"geohash_grid\" : {\r\n                \"field\" : \"location\",\r\n                \"precision\" : \"1mm\"\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\nwe return an error message:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"x_content_parse_exception\",\r\n        \"reason\": \"[6:31] [geohash_grid] failed to parse field [precision]\"\r\n      }\r\n    ],\r\n    \"type\": \"x_content_parse_exception\",\r\n    \"reason\": \"[6:31] [geohash_grid] failed to parse field [precision]\",\r\n    \"caused_by\": {\r\n      \"type\": \"illegal_argument_exception\",\r\n      \"reason\": \"precision too high [0.1mm]\",\r\n      \"caused_by\": {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"Invalid geohash aggregation precision of 16. Must be between 1 and 12.\"\r\n      }\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\nBasically, it is more or less clear that we cannot support such high precision. Returning 12 could set wrong expectations about supported precision I think. From this perspective, using the workaround `Math.min(12, GeoUtils.geoHashLevelsForPrecision(meters))` proposed by @markharwood is a good solution since it forces the user to acknowledge that the fact the precision is too high is ignored. \r\n\r\nSaying that I wonder if the correct behaviour for precisions that we cannot support is to throw `IllegalArgumentException`. Because right now\r\n`GeoUtils.geoHashLevelsForPrecision(\"0m\")` returns `24`\r\nbut \r\n`GeoUtils.geoHashLevelsForPrecision(\"0.00000001mm\")` returns `25`\r\n\r\nSuch behaviour seems to be technically incorrect. Although, I understand that it's might be not very practical example since we are talking subatomic scale here. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448241553","html_url":"https://github.com/elastic/elasticsearch/issues/35523#issuecomment-448241553","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35523","id":448241553,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODI0MTU1Mw==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-12-18T14:37:07Z","updated_at":"2018-12-18T14:37:07Z","author_association":"CONTRIBUTOR","body":"Closing as not a bug - GeoUtils is not considered part of the Java client API and a workaround was offered in https://github.com/elastic/elasticsearch/issues/35523#issuecomment-438724490","performed_via_github_app":null}]