[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320258393","html_url":"https://github.com/elastic/elasticsearch/issues/26012#issuecomment-320258393","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26012","id":320258393,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDI1ODM5Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T14:08:06Z","updated_at":"2017-08-04T14:08:06Z","author_association":"MEMBER","body":"Discussed with @dakrone and during FixItFriday and decided that this is something we should investigate. The weighting of each bucket could be done directly in `InternalMultiBucketAggregation.InternalBucket`. That would also gives the possibility to apply the request circuit breaker in the coordinating node.\r\nI mark this issue as adoptme because neither @dakrone or I have time to work on it at the moment.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322758538","html_url":"https://github.com/elastic/elasticsearch/issues/26012#issuecomment-322758538","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26012","id":322758538,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjc1ODUzOA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-08-16T12:43:11Z","updated_at":"2017-08-16T12:45:05Z","author_association":"MEMBER","body":"Adding this to the `InternalBucket` might be tricky because `InternalMultiBucketAggregation ` and `InternalBucket`are not just created on the shard but also on the coordinating node during the reduce phase and on the High Level REST client. Adding the accounting would require us to pass in a `CircuitBreakerService` to the `InternalBucket` and `InternalMultiBucketAggregation ` which would not be possible on the coordinating node or in the client.\r\n\r\nI spoke to @jimczi about this and we said that maybe we actually only need to add this kind of accounting on the histogram aggregations since they are the only ones that insert empty buckets so are the only aggregations that should cause this kind of problem at the `buildAggregation()` stage.\r\n\r\nWe have seen bucket explosion problems not caused by the histograms aggregations but these shouldn't be in the `buildAggregation()` phase so I don't think putting the 5kb accounting in all bucket aggs would solve this completely.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322800572","html_url":"https://github.com/elastic/elasticsearch/issues/26012#issuecomment-322800572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26012","id":322800572,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjgwMDU3Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-08-16T15:01:31Z","updated_at":"2017-08-16T15:01:31Z","author_association":"MEMBER","body":"As @colings86 said we can protect the bucket explosion directly in the (date)histogram when the final buckets are created. I removed the high hanging fruit label because this is much easier to add and should protect against crazy histogram aggs that tries to create millions of empty buckets. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352424272","html_url":"https://github.com/elastic/elasticsearch/issues/26012#issuecomment-352424272","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26012","id":352424272,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjQyNDI3Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-12-18T13:24:14Z","updated_at":"2017-12-18T13:24:14Z","author_association":"MEMBER","body":"Closed by #27581","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441558823","html_url":"https://github.com/elastic/elasticsearch/issues/26012#issuecomment-441558823","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26012","id":441558823,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTU1ODgyMw==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2018-11-26T08:40:12Z","updated_at":"2018-11-26T08:40:12Z","author_association":"CONTRIBUTOR","body":"This still seems to happening, opened as https://github.com/elastic/elasticsearch/issues/35896","performed_via_github_app":null}]