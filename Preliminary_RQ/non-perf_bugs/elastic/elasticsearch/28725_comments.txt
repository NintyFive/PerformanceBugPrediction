[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366724739","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-366724739","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":366724739,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjcyNDczOQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-02-19T15:24:09Z","updated_at":"2018-02-19T15:24:09Z","author_association":"CONTRIBUTOR","body":"This is a bug, they should always be the same. Can you share your query?\r\n\r\ncc @elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366754711","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-366754711","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":366754711,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Njc1NDcxMQ==","user":{"login":"krueger","id":312117,"node_id":"MDQ6VXNlcjMxMjExNw==","avatar_url":"https://avatars3.githubusercontent.com/u/312117?v=4","gravatar_id":"","url":"https://api.github.com/users/krueger","html_url":"https://github.com/krueger","followers_url":"https://api.github.com/users/krueger/followers","following_url":"https://api.github.com/users/krueger/following{/other_user}","gists_url":"https://api.github.com/users/krueger/gists{/gist_id}","starred_url":"https://api.github.com/users/krueger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krueger/subscriptions","organizations_url":"https://api.github.com/users/krueger/orgs","repos_url":"https://api.github.com/users/krueger/repos","events_url":"https://api.github.com/users/krueger/events{/privacy}","received_events_url":"https://api.github.com/users/krueger/received_events","type":"User","site_admin":false},"created_at":"2018-02-19T17:14:25Z","updated_at":"2018-02-19T17:14:25Z","author_association":"NONE","body":"This is the query \r\n\r\n```\r\n{\r\n  \"from\" : 0,\r\n  \"size\" : 67,\r\n  \"query\" : {\r\n    \"function_score\" : {\r\n      \"query\" : {\r\n        \"bool\" : {\r\n          \"must\" : [\r\n            {\r\n              \"bool\" : {\r\n                \"should\" : [\r\n                  {\r\n                    \"nested\" : {\r\n                      \"query\" : {\r\n                        \"bool\" : {\r\n                          \"must\" : [\r\n                            {\r\n                              \"constant_score\" : {\r\n                                \"filter\" : {\r\n                                  \"bool\" : {\r\n                                    \"must\" : [\r\n                                      {\r\n                                        \"terms\" : {\r\n                                          \"elements.aclgroups\" : [\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"<some id>\",\r\n                                            \"DUMMY_GROUP_ID\"\r\n                                          ],\r\n                                          \"boost\" : 1.0\r\n                                        }\r\n                                      },\r\n                                      {\r\n                                        \"term\" : {\r\n                                          \"elements.hidden\" : {\r\n                                            \"value\" : false,\r\n                                            \"boost\" : 1.0\r\n                                          }\r\n                                        }\r\n                                      },\r\n                                      {\r\n                                        \"bool\" : {\r\n                                          \"should\" : [\r\n                                            {\r\n                                              \"term\" : {\r\n                                                \"elements.approval_status\" : {\r\n                                                  \"value\" : \"APPROVED\",\r\n                                                  \"boost\" : 1.0\r\n                                                }\r\n                                              }\r\n                                            },\r\n                                            {\r\n                                              \"bool\" : {\r\n                                                \"must_not\" : [\r\n                                                  {\r\n                                                    \"exists\" : {\r\n                                                      \"field\" : \"elements.approval_status\",\r\n                                                      \"boost\" : 1.0\r\n                                                    }\r\n                                                  }\r\n                                                ],\r\n                                                \"disable_coord\" : false,\r\n                                                \"adjust_pure_negative\" : true,\r\n                                                \"boost\" : 1.0\r\n                                              }\r\n                                            }\r\n                                          ],\r\n                                          \"disable_coord\" : false,\r\n                                          \"adjust_pure_negative\" : true,\r\n                                          \"boost\" : 1.0\r\n                                        }\r\n                                      },\r\n                                      {\r\n                                        \"bool\" : {\r\n                                          \"must\" : [\r\n                                            {\r\n                                              \"range\" : {\r\n                                                \"elements.valid_from\" : {\r\n                                                  \"from\" : null,\r\n                                                  \"to\" : \"now\",\r\n                                                  \"include_lower\" : true,\r\n                                                  \"include_upper\" : true,\r\n                                                  \"time_zone\" : \"+01:00\",\r\n                                                  \"boost\" : 1.0\r\n                                                }\r\n                                              }\r\n                                            },\r\n                                            {\r\n                                              \"range\" : {\r\n                                                \"elements.valid_to\" : {\r\n                                                  \"from\" : \"now\",\r\n                                                  \"to\" : null,\r\n                                                  \"include_lower\" : true,\r\n                                                  \"include_upper\" : true,\r\n                                                  \"time_zone\" : \"+01:00\",\r\n                                                  \"boost\" : 1.0\r\n                                                }\r\n                                              }\r\n                                            }\r\n                                          ],\r\n                                          \"disable_coord\" : false,\r\n                                          \"adjust_pure_negative\" : true,\r\n                                          \"boost\" : 1.0\r\n                                        }\r\n                                      }\r\n                                    ],\r\n                                    \"disable_coord\" : false,\r\n                                    \"adjust_pure_negative\" : true,\r\n                                    \"boost\" : 1.0\r\n                                  }\r\n                                },\r\n                                \"boost\" : 1.0\r\n                              }\r\n                            },\r\n                            {\r\n                              \"bool\" : {\r\n                                \"must\" : [\r\n                                  {\r\n                                    \"multi_match\" : {\r\n                                      \"query\" : \"<query>\",\r\n                                      \"fields\" : [\r\n                                        \"elements.content.search^1.0\",\r\n                                        \"elements.tags^1.0\",\r\n                                        \"elements.title.search^1.0\"\r\n                                      ],\r\n                                      \"type\" : \"best_fields\",\r\n                                      \"operator\" : \"AND\",\r\n                                      \"slop\" : 0,\r\n                                      \"prefix_length\" : 0,\r\n                                      \"max_expansions\" : 50,\r\n                                      \"lenient\" : false,\r\n                                      \"cutoff_frequency\" : 0.0,\r\n                                      \"zero_terms_query\" : \"NONE\",\r\n                                      \"boost\" : 1.0\r\n                                    }\r\n                                  }\r\n                                ],\r\n                                \"disable_coord\" : false,\r\n                                \"adjust_pure_negative\" : true,\r\n                                \"boost\" : 1.0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"disable_coord\" : false,\r\n                          \"adjust_pure_negative\" : true,\r\n                          \"boost\" : 1.0\r\n                        }\r\n                      },\r\n                      \"path\" : \"elements\",\r\n                      \"ignore_unmapped\" : true,\r\n                      \"score_mode\" : \"none\",\r\n                      \"boost\" : 1.0,\r\n                      \"inner_hits\" : {\r\n                        \"name\" : \"elements\",\r\n                        \"ignore_unmapped\" : true,\r\n                        \"from\" : 0,\r\n                        \"size\" : 3,\r\n                        \"version\" : false,\r\n                        \"explain\" : false,\r\n                        \"track_scores\" : false,\r\n                        \"highlight\" : {\r\n                          \"pre_tags\" : [\r\n                            \"<span class=\\\"highlighted\\\">\"\r\n                          ],\r\n                          \"post_tags\" : [\r\n                            \"</span>\"\r\n                          ],\r\n                          \"fragment_size\" : 80,\r\n                          \"number_of_fragments\" : 3,\r\n                          \"type\" : \"fvh\",\r\n                          \"fields\" : {\r\n                            \"elements.content\" : {\r\n                              \"type\" : \"fvh\",\r\n                              \"matched_fields\" : [\r\n                                \"elements.content\",\r\n                                \"elements.content.search\"\r\n                              ]\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    }\r\n                  },\r\n                  {\r\n                    \"bool\" : {\r\n                      \"must\" : [\r\n                        {\r\n                          \"constant_score\" : {\r\n                            \"filter\" : {\r\n                              \"bool\" : {\r\n                                \"must\" : [\r\n                                  {\r\n                                    \"bool\" : {\r\n                                      \"should\" : [\r\n                                        {\r\n                                          \"term\" : {\r\n                                            \"aclusers\" : {\r\n                                              \"value\" : \"<some id>\",\r\n                                              \"boost\" : 1.0\r\n                                            }\r\n                                          }\r\n                                        },\r\n                                        {\r\n                                          \"bool\" : {\r\n                                            \"must\" : [\r\n                                              {\r\n                                                \"terms\" : {\r\n                                                  \"resource\" : [\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\",\r\n                                                    \"<some resource>\"\r\n                                                  ],\r\n                                                  \"boost\" : 1.0\r\n                                                }\r\n                                              },\r\n                                              {\r\n                                                \"terms\" : {\r\n                                                  \"aclwritegroups\" : [\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"<some id>\",\r\n                                                    \"DUMMY_GROUP_ID\"\r\n                                                  ],\r\n                                                  \"boost\" : 1.0\r\n                                                }\r\n                                              }\r\n                                            ],\r\n                                            \"disable_coord\" : false,\r\n                                            \"adjust_pure_negative\" : true,\r\n                                            \"boost\" : 1.0\r\n                                          }\r\n                                        }\r\n                                      ],\r\n                                      \"disable_coord\" : false,\r\n                                      \"adjust_pure_negative\" : true,\r\n                                      \"boost\" : 1.0\r\n                                    }\r\n                                  }\r\n                                ],\r\n                                \"disable_coord\" : false,\r\n                                \"adjust_pure_negative\" : true,\r\n                                \"boost\" : 1.0\r\n                              }\r\n                            },\r\n                            \"boost\" : 1.0\r\n                          }\r\n                        },\r\n                        {\r\n                          \"nested\" : {\r\n                            \"query\" : {\r\n                              \"bool\" : {\r\n                                \"must\" : [\r\n                                  {\r\n                                    \"multi_match\" : {\r\n                                      \"query\" : \"<query>\",\r\n                                      \"fields\" : [\r\n                                        \"elements.content.search^1.0\",\r\n                                        \"elements.tags^1.0\",\r\n                                        \"elements.title.search^1.0\"\r\n                                      ],\r\n                                      \"type\" : \"best_fields\",\r\n                                      \"operator\" : \"AND\",\r\n                                      \"slop\" : 0,\r\n                                      \"prefix_length\" : 0,\r\n                                      \"max_expansions\" : 50,\r\n                                      \"lenient\" : false,\r\n                                      \"cutoff_frequency\" : 0.0,\r\n                                      \"zero_terms_query\" : \"NONE\",\r\n                                      \"boost\" : 1.0\r\n                                    }\r\n                                  }\r\n                                ],\r\n                                \"disable_coord\" : false,\r\n                                \"adjust_pure_negative\" : true,\r\n                                \"boost\" : 1.0\r\n                              }\r\n                            },\r\n                            \"path\" : \"elements\",\r\n                            \"ignore_unmapped\" : true,\r\n                            \"score_mode\" : \"none\",\r\n                            \"boost\" : 1.0\r\n                          }\r\n                        }\r\n                      ],\r\n                      \"disable_coord\" : false,\r\n                      \"adjust_pure_negative\" : true,\r\n                      \"boost\" : 1.0\r\n                    }\r\n                  }\r\n                ],\r\n                \"disable_coord\" : false,\r\n                \"adjust_pure_negative\" : true,\r\n                \"boost\" : 1.0\r\n              }\r\n            },\r\n            {\r\n              \"bool\" : {\r\n                \"must\" : [\r\n                  {\r\n                    \"bool\" : {\r\n                      \"must_not\" : [\r\n                        {\r\n                          \"terms\" : {\r\n                            \"resource\" : [\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\",\r\n                              \"<some resource>\"\r\n                            ],\r\n                            \"boost\" : 1.0\r\n                          }\r\n                        }\r\n                      ],\r\n                      \"disable_coord\" : false,\r\n                      \"adjust_pure_negative\" : true,\r\n                      \"boost\" : 1.0\r\n                    }\r\n                  }\r\n                ],\r\n                \"disable_coord\" : false,\r\n                \"adjust_pure_negative\" : true,\r\n                \"boost\" : 1.0\r\n              }\r\n            }\r\n          ],\r\n          \"disable_coord\" : false,\r\n          \"adjust_pure_negative\" : true,\r\n          \"boost\" : 1.0\r\n        }\r\n      },\r\n      \"functions\" : [\r\n        {\r\n          \"filter\" : {\r\n            \"match_all\" : {\r\n              \"boost\" : 1.0\r\n            }\r\n          },\r\n          \"field_value_factor\" : {\r\n            \"field\" : \"boost_factor\",\r\n            \"factor\" : 1.0,\r\n            \"modifier\" : \"none\"\r\n          }\r\n        }\r\n      ],\r\n      \"score_mode\" : \"multiply\",\r\n      \"max_boost\" : 3.4028235E38,\r\n      \"boost\" : 1.0\r\n    }\r\n  },\r\n  \"explain\" : false,\r\n  \"stored_fields\" : [\r\n    \"id\",\r\n    \"title\"\r\n  ],\r\n  \"highlight\" : {\r\n    \"pre_tags\" : [\r\n      \"<span class=\\\"highlighted\\\">\"\r\n    ],\r\n    \"post_tags\" : [\r\n      \"</span>\"\r\n    ],\r\n    \"type\" : \"fvh\",\r\n    \"fields\" : {\r\n      \"content.search\" : {\r\n        \"fragment_size\" : 80,\r\n        \"number_of_fragments\" : 3,\r\n        \"type\" : \"fvh\",\r\n        \"highlight_query\" : {\r\n          \"bool\" : {\r\n            \"must\" : [\r\n              {\r\n                \"multi_match\" : {\r\n                  \"query\" : \"<query>\",\r\n                  \"fields\" : [\r\n                    \"content.search^1.0\"\r\n                  ],\r\n                  \"type\" : \"best_fields\",\r\n                  \"operator\" : \"AND\",\r\n                  \"slop\" : 0,\r\n                  \"prefix_length\" : 0,\r\n                  \"max_expansions\" : 50,\r\n                  \"lenient\" : false,\r\n                  \"cutoff_frequency\" : 0.0,\r\n                  \"zero_terms_query\" : \"NONE\",\r\n                  \"boost\" : 1.0\r\n                }\r\n              }\r\n            ],\r\n            \"disable_coord\" : false,\r\n            \"adjust_pure_negative\" : true,\r\n            \"boost\" : 1.0\r\n          }\r\n        },\r\n        \"matched_fields\" : [\r\n          \"content.search\"\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  \"suggest\" : {\r\n    \"autocomplete\" : {\r\n      \"text\" : \"<query>\",\r\n      \"term\" : {\r\n        \"field\" : \"autocomplete\",\r\n        \"suggest_mode\" : \"MISSING\",\r\n        \"accuracy\" : 0.5,\r\n        \"sort\" : \"SCORE\",\r\n        \"string_distance\" : \"INTERNAL\",\r\n        \"max_edits\" : 2,\r\n        \"max_inspections\" : 5,\r\n        \"max_term_freq\" : 0.01,\r\n        \"prefix_length\" : 1,\r\n        \"min_word_length\" : 4,\r\n        \"min_doc_freq\" : 0.0\r\n      }\r\n    }\r\n  },\r\n  \"rescore\" : [\r\n    {\r\n      \"query\" : {\r\n        \"rescore_query\" : {\r\n          \"multi_match\" : {\r\n            \"query\" : \"<query>\",\r\n            \"fields\" : [\r\n              \"elements.content.stem^1.0\",\r\n              \"elements.tags^1.0\",\r\n              \"elements.title.stem^1.0\"\r\n            ],\r\n            \"type\" : \"phrase\",\r\n            \"operator\" : \"OR\",\r\n            \"slop\" : 0,\r\n            \"prefix_length\" : 0,\r\n            \"max_expansions\" : 50,\r\n            \"lenient\" : false,\r\n            \"zero_terms_query\" : \"NONE\",\r\n            \"boost\" : 1.0\r\n          }\r\n        },\r\n        \"query_weight\" : 1.0,\r\n        \"rescore_query_weight\" : 80.0,\r\n        \"score_mode\" : \"total\"\r\n      }\r\n    },\r\n    {\r\n      \"query\" : {\r\n        \"rescore_query\" : {\r\n          \"match\" : {\r\n            \"elements.content.stem\" : {\r\n              \"query\" : \"<query>\",\r\n              \"operator\" : \"AND\",\r\n              \"prefix_length\" : 0,\r\n              \"max_expansions\" : 50,\r\n              \"fuzzy_transpositions\" : true,\r\n              \"lenient\" : false,\r\n              \"zero_terms_query\" : \"NONE\",\r\n              \"boost\" : 1.0\r\n            }\r\n          }\r\n        },\r\n        \"query_weight\" : 1.0,\r\n        \"rescore_query_weight\" : 2.0,\r\n        \"score_mode\" : \"total\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nWhich value is used for sorting the search results? The value from _score or the value from _explanation? Is the result sorted correctly?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366763977","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-366763977","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":366763977,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Njc2Mzk3Nw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-02-19T17:51:09Z","updated_at":"2018-02-19T17:51:09Z","author_association":"CONTRIBUTOR","body":"> Which value is used for sorting the search results? The value from _score or the value from _explanation? Is the result sorted correctly?\r\n\r\nResults are always sorted based on `_score`, `_explanation` is just extra debugging information. I suspect results are still sorted correctly, but it is hard to say for sure without knowing what the exact bug is.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366774892","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-366774892","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":366774892,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Njc3NDg5Mg==","user":{"login":"krueger","id":312117,"node_id":"MDQ6VXNlcjMxMjExNw==","avatar_url":"https://avatars3.githubusercontent.com/u/312117?v=4","gravatar_id":"","url":"https://api.github.com/users/krueger","html_url":"https://github.com/krueger","followers_url":"https://api.github.com/users/krueger/followers","following_url":"https://api.github.com/users/krueger/following{/other_user}","gists_url":"https://api.github.com/users/krueger/gists{/gist_id}","starred_url":"https://api.github.com/users/krueger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krueger/subscriptions","organizations_url":"https://api.github.com/users/krueger/orgs","repos_url":"https://api.github.com/users/krueger/repos","events_url":"https://api.github.com/users/krueger/events{/privacy}","received_events_url":"https://api.github.com/users/krueger/received_events","type":"User","site_admin":false},"created_at":"2018-02-19T18:42:43Z","updated_at":"2018-02-19T18:42:43Z","author_association":"NONE","body":"This is the complete explanation part:\r\n\r\n```\r\n\"_explanation\": {\r\n                    \"value\": 196.23717,\r\n                    \"description\": \"sum of:\",\r\n                    \"details\": [\r\n                        {\r\n                            \"value\": 191.49968,\r\n                            \"description\": \"product of:\",\r\n                            \"details\": [\r\n                                {\r\n                                    \"value\": 191.49968,\r\n                                    \"description\": \"sum of:\",\r\n                                    \"details\": [\r\n                                        {\r\n                                            \"value\": 2,\r\n                                            \"description\": \"product of:\",\r\n                                            \"details\": [\r\n                                                {\r\n                                                    \"value\": 2,\r\n                                                    \"description\": \"sum of:\",\r\n                                                    \"details\": [\r\n                                                        {\r\n                                                            \"value\": 2,\r\n                                                            \"description\": \"function score, product of:\",\r\n                                                            \"details\": [\r\n                                                                {\r\n                                                                    \"value\": 2,\r\n                                                                    \"description\": \"sum of:\",\r\n                                                                    \"details\": [\r\n                                                                        {\r\n                                                                            \"value\": 1,\r\n                                                                            \"description\": \"sum of:\",\r\n                                                                            \"details\": [\r\n                                                                                {\r\n                                                                                    \"value\": 0,\r\n                                                                                    \"description\": \"Score based on 1 child docs in range from 2714 to 2714, best match:\",\r\n                                                                                    \"details\": [\r\n                                                                                        {\r\n                                                                                            \"value\": 7.6046343,\r\n                                                                                            \"description\": \"sum of:\",\r\n                                                                                            \"details\": [\r\n                                                                                                {\r\n                                                                                                    \"value\": 7.6046343,\r\n                                                                                                    \"description\": \"sum of:\",\r\n                                                                                                    \"details\": [\r\n                                                                                                        {\r\n                                                                                                            \"value\": 1,\r\n                                                                                                            \"description\": \"ConstantScore(+ConstantScore(elements.aclgroups:<id>\r\n                                                                                                            elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:<id> elements.aclgroups:DUMMY_GROUP_ID elements.aclgroups:ubguhplma88o) +elements.hidden:F +((elements.approval_status:APPROVED (-ConstantScore(_field_names:elements.approval_status) +*:*))~1) +(+elements.valid_from:[-9223372036854775808 TO 9223372036854775807] +elements.valid_to:[1519050328256 TO 9223372036854775807])), product of:\",\r\n                                                                                                            \"details\": [\r\n                                                                                                                {\r\n                                                                                                                    \"value\": 1,\r\n                                                                                                                    \"description\": \"boost\",\r\n                                                                                                                    \"details\": []\r\n                                                                                                                },\r\n                                                                                                                {\r\n                                                                                                                    \"value\": 1,\r\n                                                                                                                    \"description\": \"queryNorm\",\r\n                                                                                                                    \"details\": []\r\n                                                                                                                }\r\n                                                                                                            ]\r\n                                                                                                        },\r\n                                                                                                        {\r\n                                                                                                            \"value\": 6.6046343,\r\n                                                                                                            \"description\": \"max of:\",\r\n                                                                                                            \"details\": [\r\n                                                                                                                {\r\n                                                                                                                    \"value\": 6.6046343,\r\n                                                                                                                    \"description\": \"weight(elements.content.search:term in 16) [PerFieldSimilarity], result of:\",\r\n                                                                                                                    \"details\": [\r\n                                                                                                                        {\r\n                                                                                                                            \"value\": 6.6046343,\r\n                                                                                                                            \"description\": \"score(doc=16,freq=1.0 = termFreq=1.0\\n), product of:\",\r\n                                                                                                                            \"details\": [\r\n                                                                                                                                {\r\n                                                                                                                                    \"value\": 3.9169664,\r\n                                                                                                                                    \"description\": \"idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\",\r\n                                                                                                                                    \"details\": [\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 56,\r\n                                                                                                                                            \"description\": \"docFreq\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 2838,\r\n                                                                                                                                            \"description\": \"docCount\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        }\r\n                                                                                                                                    ]\r\n                                                                                                                                },\r\n                                                                                                                                {\r\n                                                                                                                                    \"value\": 1.6861606,\r\n                                                                                                                                    \"description\": \"tfNorm, computed as (freq * (k1 + 1)) / (freq + k1 * (1 - b + b * fieldLength / avgFieldLength)) from:\",\r\n                                                                                                                                    \"details\": [\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 1,\r\n                                                                                                                                            \"description\": \"termFreq=1.0\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 1.2,\r\n                                                                                                                                            \"description\": \"parameter k1\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 0.75,\r\n                                                                                                                                            \"description\": \"parameter b\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 1944.5743,\r\n                                                                                                                                            \"description\": \"avgFieldLength\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 10.24,\r\n                                                                                                                                            \"description\": \"fieldLength\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        }\r\n                                                                                                                                    ]\r\n                                                                                                                                }\r\n                                                                                                                            ]\r\n                                                                                                                        }\r\n                                                                                                                    ]\r\n                                                                                                                }\r\n                                                                                                            ]\r\n                                                                                                        }\r\n                                                                                                    ]\r\n                                                                                                },\r\n                                                                                                {\r\n                                                                                                    \"value\": 0,\r\n                                                                                                    \"description\": \"match on required clause, product of:\",\r\n                                                                                                    \"details\": [\r\n                                                                                                        {\r\n                                                                                                            \"value\": 0,\r\n                                                                                                            \"description\": \"# clause\",\r\n                                                                                                            \"details\": []\r\n                                                                                                        },\r\n                                                                                                        {\r\n                                                                                                            \"value\": 1,\r\n                                                                                                            \"description\": \"_type:__elements, product of:\",\r\n                                                                                                            \"details\": [\r\n                                                                                                                {\r\n                                                                                                                    \"value\": 1,\r\n                                                                                                                    \"description\": \"boost\",\r\n                                                                                                                    \"details\": []\r\n                                                                                                                },\r\n                                                                                                                {\r\n                                                                                                                    \"value\": 1,\r\n                                                                                                                    \"description\": \"queryNorm\",\r\n                                                                                                                    \"details\": []\r\n                                                                                                                }\r\n                                                                                                            ]\r\n                                                                                                        }\r\n                                                                                                    ]\r\n                                                                                                }\r\n                                                                                            ]\r\n                                                                                        }\r\n                                                                                    ]\r\n                                                                                },\r\n                                                                                {\r\n                                                                                    \"value\": 1,\r\n                                                                                    \"description\": \"sum of:\",\r\n                                                                                    \"details\": [\r\n                                                                                        {\r\n                                                                                            \"value\": 1,\r\n                                                                                            \"description\": \"ConstantScore((aclusers:4374ef463c8cb7f0013c967ea7cc4701 (+resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> resource:<resource> +ConstantScore(aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:<id> aclwritegroups:DUMMY_GROUP_ID aclwritegroups:<id>)))~1), product of:\",\r\n                                                                                            \"details\": [\r\n                                                                                                {\r\n                                                                                                    \"value\": 1,\r\n                                                                                                    \"description\": \"boost\",\r\n                                                                                                    \"details\": []\r\n                                                                                                },\r\n                                                                                                {\r\n                                                                                                    \"value\": 1,\r\n                                                                                                    \"description\": \"queryNorm\",\r\n                                                                                                    \"details\": []\r\n                                                                                                }\r\n                                                                                            ]\r\n                                                                                        },\r\n                                                                                        {\r\n                                                                                            \"value\": 0,\r\n                                                                                            \"description\": \"Score based on 1 child docs in range from 2714 to 2714, best match:\",\r\n                                                                                            \"details\": [\r\n                                                                                                {\r\n                                                                                                    \"value\": 6.6046343,\r\n                                                                                                    \"description\": \"sum of:\",\r\n                                                                                                    \"details\": [\r\n                                                                                                        {\r\n                                                                                                            \"value\": 6.6046343,\r\n                                                                                                            \"description\": \"max of:\",\r\n                                                                                                            \"details\": [\r\n                                                                                                                {\r\n                                                                                                                    \"value\": 6.6046343,\r\n                                                                                                                    \"description\": \"weight(elements.content.search:term in 16) [PerFieldSimilarity], result of:\",\r\n                                                                                                                    \"details\": [\r\n                                                                                                                        {\r\n                                                                                                                            \"value\": 6.6046343,\r\n                                                                                                                            \"description\": \"score(doc=16,freq=1.0 = termFreq=1.0\\n), product of:\",\r\n                                                                                                                            \"details\": [\r\n                                                                                                                                {\r\n                                                                                                                                    \"value\": 3.9169664,\r\n                                                                                                                                    \"description\": \"idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\",\r\n                                                                                                                                    \"details\": [\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 56,\r\n                                                                                                                                            \"description\": \"docFreq\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 2838,\r\n                                                                                                                                            \"description\": \"docCount\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        }\r\n                                                                                                                                    ]\r\n                                                                                                                                },\r\n                                                                                                                                {\r\n                                                                                                                                    \"value\": 1.6861606,\r\n                                                                                                                                    \"description\": \"tfNorm, computed as (freq * (k1 + 1)) / (freq + k1 * (1 - b + b * fieldLength / avgFieldLength)) from:\",\r\n                                                                                                                                    \"details\": [\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 1,\r\n                                                                                                                                            \"description\": \"termFreq=1.0\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 1.2,\r\n                                                                                                                                            \"description\": \"parameter k1\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 0.75,\r\n                                                                                                                                            \"description\": \"parameter b\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 1944.5743,\r\n                                                                                                                                            \"description\": \"avgFieldLength\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        },\r\n                                                                                                                                        {\r\n                                                                                                                                            \"value\": 10.24,\r\n                                                                                                                                            \"description\": \"fieldLength\",\r\n                                                                                                                                            \"details\": []\r\n                                                                                                                                        }\r\n                                                                                                                                    ]\r\n                                                                                                                                }\r\n                                                                                                                            ]\r\n                                                                                                                        }\r\n                                                                                                                    ]\r\n                                                                                                                }\r\n                                                                                                            ]\r\n                                                                                                        },\r\n                                                                                                        {\r\n                                                                                                            \"value\": 0,\r\n                                                                                                            \"description\": \"match on required clause, product of:\",\r\n                                                                                                            \"details\": [\r\n                                                                                                                {\r\n                                                                                                                    \"value\": 0,\r\n                                                                                                                    \"description\": \"# clause\",\r\n                                                                                                                    \"details\": []\r\n                                                                                                                },\r\n                                                                                                                {\r\n                                                                                                                    \"value\": 1,\r\n                                                                                                                    \"description\": \"_type:__elements, product of:\",\r\n                                                                                                                    \"details\": [\r\n                                                                                                                        {\r\n                                                                                                                            \"value\": 1,\r\n                                                                                                                            \"description\": \"boost\",\r\n                                                                                                                            \"details\": []\r\n                                                                                                                        },\r\n                                                                                                                        {\r\n                                                                                                                            \"value\": 1,\r\n                                                                                                                            \"description\": \"queryNorm\",\r\n                                                                                                                            \"details\": []\r\n                                                                                                                        }\r\n                                                                                                                    ]\r\n                                                                                                                }\r\n                                                                                                            ]\r\n                                                                                                        }\r\n                                                                                                    ]\r\n                                                                                                }\r\n                                                                                            ]\r\n                                                                                        }\r\n                                                                                    ]\r\n                                                                                }\r\n                                                                            ]\r\n                                                                        },\r\n                                                                        {\r\n                                                                            \"value\": 1,\r\n                                                                            \"description\": \"sum of:\",\r\n                                                                            \"details\": [\r\n                                                                                {\r\n                                                                                    \"value\": 1,\r\n                                                                                    \"description\": \"*:*, product of:\",\r\n                                                                                    \"details\": [\r\n                                                                                        {\r\n                                                                                            \"value\": 1,\r\n                                                                                            \"description\": \"boost\",\r\n                                                                                            \"details\": []\r\n                                                                                        },\r\n                                                                                        {\r\n                                                                                            \"value\": 1,\r\n                                                                                            \"description\": \"queryNorm\",\r\n                                                                                            \"details\": []\r\n                                                                                        }\r\n                                                                                    ]\r\n                                                                                }\r\n                                                                            ]\r\n                                                                        }\r\n                                                                    ]\r\n                                                                },\r\n                                                                {\r\n                                                                    \"value\": 1,\r\n                                                                    \"description\": \"min of:\",\r\n                                                                    \"details\": [\r\n                                                                        {\r\n                                                                            \"value\": 1,\r\n                                                                            \"description\": \"field value function: none(doc['boost_factor'].value * factor=1.0)\",\r\n                                                                            \"details\": []\r\n                                                                        },\r\n                                                                        {\r\n                                                                            \"value\": 3.4028235e+38,\r\n                                                                            \"description\": \"maxBoost\",\r\n                                                                            \"details\": []\r\n                                                                        }\r\n                                                                    ]\r\n                                                                }\r\n                                                            ]\r\n                                                        },\r\n                                                        {\r\n                                                            \"value\": 0,\r\n                                                            \"description\": \"match on required clause, product of:\",\r\n                                                            \"details\": [\r\n                                                                {\r\n                                                                    \"value\": 0,\r\n                                                                    \"description\": \"# clause\",\r\n                                                                    \"details\": []\r\n                                                                },\r\n                                                                {\r\n                                                                    \"value\": 1,\r\n                                                                    \"description\": \"#*:* -_type:__*, product of:\",\r\n                                                                    \"details\": [\r\n                                                                        {\r\n                                                                            \"value\": 1,\r\n                                                                            \"description\": \"boost\",\r\n                                                                            \"details\": []\r\n                                                                        },\r\n                                                                        {\r\n                                                                            \"value\": 1,\r\n                                                                            \"description\": \"queryNorm\",\r\n                                                                            \"details\": []\r\n                                                                        }\r\n                                                                    ]\r\n                                                                }\r\n                                                            ]\r\n                                                        }\r\n                                                    ]\r\n                                                },\r\n                                                {\r\n                                                    \"value\": 1,\r\n                                                    \"description\": \"primaryWeight\",\r\n                                                    \"details\": []\r\n                                                }\r\n                                            ]\r\n                                        },\r\n                                        {\r\n                                            \"value\": 189.49968,\r\n                                            \"description\": \"product of:\",\r\n                                            \"details\": [\r\n                                                {\r\n                                                    \"value\": 2.368746,\r\n                                                    \"description\": \"max of:\",\r\n                                                    \"details\": [\r\n                                                        {\r\n                                                            \"value\": 2.368746,\r\n                                                            \"description\": \"weight(elements.content.stem:term in 17) [PerFieldSimilarity], result of:\",\r\n                                                            \"details\": [\r\n                                                                {\r\n                                                                    \"value\": 2.368746,\r\n                                                                    \"description\": \"score(doc=17,freq=2.0 = termFreq=2.0\\n), product of:\",\r\n                                                                    \"details\": [\r\n                                                                        {\r\n                                                                            \"value\": 3.9530065,\r\n                                                                            \"description\": \"idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\",\r\n                                                                            \"details\": [\r\n                                                                                {\r\n                                                                                    \"value\": 54,\r\n                                                                                    \"description\": \"docFreq\",\r\n                                                                                    \"details\": []\r\n                                                                                },\r\n                                                                                {\r\n                                                                                    \"value\": 2838,\r\n                                                                                    \"description\": \"docCount\",\r\n                                                                                    \"details\": []\r\n                                                                                }\r\n                                                                            ]\r\n                                                                        },\r\n                                                                        {\r\n                                                                            \"value\": 0.5992265,\r\n                                                                            \"description\": \"tfNorm, computed as (freq * (k1 + 1)) / (freq + k1 * (1 - b + b * fieldLength / avgFieldLength)) from:\",\r\n                                                                            \"details\": [\r\n                                                                                {\r\n                                                                                    \"value\": 2,\r\n                                                                                    \"description\": \"termFreq=2.0\",\r\n                                                                                    \"details\": []\r\n                                                                                },\r\n                                                                                {\r\n                                                                                    \"value\": 1.2,\r\n                                                                                    \"description\": \"parameter k1\",\r\n                                                                                    \"details\": []\r\n                                                                                },\r\n                                                                                {\r\n                                                                                    \"value\": 0.75,\r\n                                                                                    \"description\": \"parameter b\",\r\n                                                                                    \"details\": []\r\n                                                                                },\r\n                                                                                {\r\n                                                                                    \"value\": 238.7012,\r\n                                                                                    \"description\": \"avgFieldLength\",\r\n                                                                                    \"details\": []\r\n                                                                                },\r\n                                                                                {\r\n                                                                                    \"value\": 1337.4694,\r\n                                                                                    \"description\": \"fieldLength\",\r\n                                                                                    \"details\": []\r\n                                                                                }\r\n                                                                            ]\r\n                                                                        }\r\n                                                                    ]\r\n                                                                }\r\n                                                            ]\r\n                                                        }\r\n                                                    ]\r\n                                                },\r\n                                                {\r\n                                                    \"value\": 80,\r\n                                                    \"description\": \"secondaryWeight\",\r\n                                                    \"details\": []\r\n                                                }\r\n                                            ]\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"value\": 1,\r\n                                    \"description\": \"primaryWeight\",\r\n                                    \"details\": []\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"value\": 4.737492,\r\n                            \"description\": \"product of:\",\r\n                            \"details\": [\r\n                                {\r\n                                    \"value\": 2.368746,\r\n                                    \"description\": \"weight(elements.content.stem:term in 17) [PerFieldSimilarity], result of:\",\r\n                                    \"details\": [\r\n                                        {\r\n                                            \"value\": 2.368746,\r\n                                            \"description\": \"score(doc=17,freq=2.0 = termFreq=2.0\\n), product of:\",\r\n                                            \"details\": [\r\n                                                {\r\n                                                    \"value\": 3.9530065,\r\n                                                    \"description\": \"idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\",\r\n                                                    \"details\": [\r\n                                                        {\r\n                                                            \"value\": 54,\r\n                                                            \"description\": \"docFreq\",\r\n                                                            \"details\": []\r\n                                                        },\r\n                                                        {\r\n                                                            \"value\": 2838,\r\n                                                            \"description\": \"docCount\",\r\n                                                            \"details\": []\r\n                                                        }\r\n                                                    ]\r\n                                                },\r\n                                                {\r\n                                                    \"value\": 0.5992265,\r\n                                                    \"description\": \"tfNorm, computed as (freq * (k1 + 1)) / (freq + k1 * (1 - b + b * fieldLength / avgFieldLength)) from:\",\r\n                                                    \"details\": [\r\n                                                        {\r\n                                                            \"value\": 2,\r\n                                                            \"description\": \"termFreq=2.0\",\r\n                                                            \"details\": []\r\n                                                        },\r\n                                                        {\r\n                                                            \"value\": 1.2,\r\n                                                            \"description\": \"parameter k1\",\r\n                                                            \"details\": []\r\n                                                        },\r\n                                                        {\r\n                                                            \"value\": 0.75,\r\n                                                            \"description\": \"parameter b\",\r\n                                                            \"details\": []\r\n                                                        },\r\n                                                        {\r\n                                                            \"value\": 238.7012,\r\n                                                            \"description\": \"avgFieldLength\",\r\n                                                            \"details\": []\r\n                                                        },\r\n                                                        {\r\n                                                            \"value\": 1337.4694,\r\n                                                            \"description\": \"fieldLength\",\r\n                                                            \"details\": []\r\n                                                        }\r\n                                                    ]\r\n                                                }\r\n                                            ]\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"value\": 2,\r\n                                    \"description\": \"secondaryWeight\",\r\n                                    \"details\": []\r\n                                }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366775521","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-366775521","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":366775521,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Njc3NTUyMQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-02-19T18:45:48Z","updated_at":"2018-02-19T18:45:48Z","author_association":"MEMBER","body":"I think it's just a known issue with `rescorer`. If the `window_size` (which default to `10`) of the `rescorer` is smaller than the requested size (`from`+`size`, in the example query `0+67`) then all documents that appear after the `window_size` will skip the rescore and they will just apply the `query_weight` to the original score. Though we don't check if the document was part of the window when `explain` is called which is why the score within the explanation is not correct. It shows the score as if it were rescored even though the document might not have been rescored.\r\nYou should have the same score if you change the `window_size` to match the `size+from` of you query (`67` ;) ).\r\nI'll leave this issue open for now  because there is a bug in the rescorer `explain` output but the fix is not trivial and I am not sure that it is worth fixing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/367363507","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-367363507","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":367363507,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NzM2MzUwNw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-02-21T15:28:49Z","updated_at":"2018-02-21T15:28:49Z","author_association":"CONTRIBUTOR","body":"I think we should fix it: scores are explanations should always match.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/367457057","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-367457057","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":367457057,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NzQ1NzA1Nw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-02-21T20:15:26Z","updated_at":"2018-02-21T20:15:26Z","author_association":"MEMBER","body":"Fair enough, I restored the adoptme tag. Also note that the score will not always match the explanations since we can have more than one rescorer so only the explanation of the last rescorer should match the final score of the hit.  ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385534158","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-385534158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":385534158,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTUzNDE1OA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T21:27:32Z","updated_at":"2018-04-30T21:27:32Z","author_association":"CONTRIBUTOR","body":"To implement the correct `explain` in  `QueryRescorer` `explain` function, we need to check if a document was within the `window_size` - `N`.   This is difficult to check,  as documents can be resorted, and the top N documents are not necessarily the one for which rescoring was applied (in case for example `rescore_query_weight` is negative, they may be at the bottom).  We can potentially modify `RescoreContext` to  save all docIds for which rescore was applied, and use this info during `ExplainFetchSubPhase`, but I am not sure if we want to go this round.\r\n\r\nThe simpler solution would be to remove `window_size` parameter from `rescore` API, and  apply rescore for all docs between [from, from+size).\r\n\r\nWhat do you think @jimczi @jpountz ?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386227438","html_url":"https://github.com/elastic/elasticsearch/issues/28725#issuecomment-386227438","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28725","id":386227438,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjIyNzQzOA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-05-03T08:40:37Z","updated_at":"2018-05-03T08:40:37Z","author_association":"MEMBER","body":"> The simpler solution would be to remove window_size parameter from rescore API, and apply rescore for all docs between [from, from+size).\r\n\r\nThe `window_size` is important because it ensures that pagination queries always rescore the same hits. If we remove it the pagination would rescore more documents on each page and this would yields different results (or duplicates) on each page.\r\n\r\n> We can potentially modify RescoreContext to save all docIds for which rescore was applied, and use this info during ExplainFetchSubPhase, but I am not sure if we want to go this round.\r\n\r\nThe window_size should be small (100-1000 or something) so I think that's ok and I don't see how we could do it differently.\r\n","performed_via_github_app":null}]