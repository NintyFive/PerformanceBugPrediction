{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6583","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6583/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6583/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6583/events","html_url":"https://github.com/elastic/elasticsearch/issues/6583","id":36211848,"node_id":"MDU6SXNzdWUzNjIxMTg0OA==","number":6583,"title":"Replication of new documents from 1.1.2 primary to 1.0.3 replica not working during upgrade","user":{"login":"haardvark","id":1389883,"node_id":"MDQ6VXNlcjEzODk4ODM=","avatar_url":"https://avatars1.githubusercontent.com/u/1389883?v=4","gravatar_id":"","url":"https://api.github.com/users/haardvark","html_url":"https://github.com/haardvark","followers_url":"https://api.github.com/users/haardvark/followers","following_url":"https://api.github.com/users/haardvark/following{/other_user}","gists_url":"https://api.github.com/users/haardvark/gists{/gist_id}","starred_url":"https://api.github.com/users/haardvark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/haardvark/subscriptions","organizations_url":"https://api.github.com/users/haardvark/orgs","repos_url":"https://api.github.com/users/haardvark/repos","events_url":"https://api.github.com/users/haardvark/events{/privacy}","received_events_url":"https://api.github.com/users/haardvark/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"assignees":[{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2014-06-21T00:09:37Z","updated_at":"2015-01-05T11:41:03Z","closed_at":"2015-01-05T11:41:03Z","author_association":"NONE","active_lock_reason":null,"body":"During a rolling upgrade of our cluster from 1.0.3 to 1.1.2, we observed issues with replication of newly indexed documents from 1.0.3 data nodes holding primary shards to 1.1.2 data nodes holding their replicas.  Replication between 1.0.3 primaries and 1.0.3 replicas, between 1.1.2 primaries and 1.0.3 replicas, and 1.1.2 primaries and 1.1.2 replicas continued to work correctly throughout the upgrade.  Documents were being indexed via the _bulk API.\n\nLogs on both 1.0.3 and 1.1.2 nodes logged three different types of unusual messages, which did not cease until every node in the cluster was upgraded:\n\n[2014-06-18 15:29:33,057][WARN ][transport.netty          ] [T02-C01-A02] Message not fully read (request) for [2092] and action [indices/recovery/s], resetting\n\n[2014-06-18 20:47:37,234][WARN ][transport.netty          ] [T02-C01-A02] Message not fully read (response) for [41328828] handler org.elasticsearch.action.support.broadcast.TransportBroadcastOperationAction$AsyncBroadcastAction$3@1c73aab6, error [false], resetting\n\n[2014-06-19 21:47:52,935][DEBUG][discovery.zen            ] [T02-C01-A02] received cluster state from [[ES2PROD-M01][ViFfCcmsRLKAEkoli2hfWQ][es2prod-m01][inet[/10.0.64.103:9300]]{updateDomain=3, data=false, faultDomain=1, master=true}] which is also master but with cluster name [null]\n\nWe are running our nodes in Azure on Windows 2012 R2 Datacenter using the following JVM:\n            \"version\": \"1.7.0_55\",\n            \"vm_name\": \"OpenJDK 64-Bit Server VM\",\n            \"vm_version\": \"24.55-b03\",\n            \"vm_vendor\": \"Azul Systems, Inc.\"\n\nAlso, it should be noted that /_cat/shards and /_cat/indices both returned null pointer exceptions during the upgrade process.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}