{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57208","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57208/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57208/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57208/events","html_url":"https://github.com/elastic/elasticsearch/issues/57208","id":625722296,"node_id":"MDU6SXNzdWU2MjU3MjIyOTY=","number":57208,"title":"Hidden indices are not included in the snapshots","user":{"login":"lucabelluccini","id":87379,"node_id":"MDQ6VXNlcjg3Mzc5","avatar_url":"https://avatars3.githubusercontent.com/u/87379?v=4","gravatar_id":"","url":"https://api.github.com/users/lucabelluccini","html_url":"https://github.com/lucabelluccini","followers_url":"https://api.github.com/users/lucabelluccini/followers","following_url":"https://api.github.com/users/lucabelluccini/following{/other_user}","gists_url":"https://api.github.com/users/lucabelluccini/gists{/gist_id}","starred_url":"https://api.github.com/users/lucabelluccini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucabelluccini/subscriptions","organizations_url":"https://api.github.com/users/lucabelluccini/orgs","repos_url":"https://api.github.com/users/lucabelluccini/repos","events_url":"https://api.github.com/users/lucabelluccini/events{/privacy}","received_events_url":"https://api.github.com/users/lucabelluccini/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967495446,"node_id":"MDU6TGFiZWwxOTY3NDk1NDQ2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Infra","name":"Team:Core/Infra","color":"fef2c0","default":false,"description":"Meta label for core/infra team"}],"state":"closed","locked":false,"assignee":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"assignees":[{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2020-05-27T14:00:41Z","updated_at":"2020-10-07T23:33:09Z","closed_at":"2020-10-07T23:33:08Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.7.0\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nTriggering a full snapshot will not include hidden indices.\r\nThis can be critical as some of the hidden indexes contain data from ML jobs\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Spawn a cluster in ES 7.7.0\r\n 2. Try to trigger a snapshot\r\n 3. Compare the list of indices in the snapshots vs those in the cluster\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\n> GET */_settings?expand_wildcards=all&filter_path=*.settings.index.hidden\r\n{\r\n  \".watcher-history-11-2020.05.27\" : {\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"hidden\" : \"true\"\r\n      }\r\n    }\r\n  },\r\n  \".watcher-history-11-2020.05.25\" : {\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"hidden\" : \"true\"\r\n      }\r\n    }\r\n  },\r\n  \".slm-history-2-000001\" : {\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"hidden\" : \"true\"\r\n      }\r\n    }\r\n  },\r\n  \"ilm-history-2-000001\" : {\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"hidden\" : \"true\"\r\n      }\r\n    }\r\n  },\r\n  \".watcher-history-11-2020.05.26\" : {\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"hidden\" : \"true\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n```\r\n> GET _snapshot/found-snapshots/test\r\n{\r\n  \"snapshots\" : [\r\n    {\r\n      \"snapshot\" : \"test\",\r\n      \"uuid\" : \"WLjeWJDdSdmB4i6sulM-qg\",\r\n      \"version_id\" : 7070099,\r\n      \"version\" : \"7.7.0\",\r\n      \"indices\" : [\r\n<REDACTED - But none of the indices above is present>\r\n      ],\r\n      \"include_global_state\" : true,\r\n      \"state\" : \"SUCCESS\",\r\n      \"start_time\" : \"2020-05-27T13:44:13.047Z\",\r\n      \"start_time_in_millis\" : 1590587053047,\r\n      \"end_time\" : \"2020-05-27T13:44:55.891Z\",\r\n      \"end_time_in_millis\" : 1590587095891,\r\n      \"duration_in_millis\" : 42844,\r\n      \"failures\" : [ ],\r\n      \"shards\" : {\r\n        \"total\" : 65,\r\n        \"failed\" : 0,\r\n        \"successful\" : 65\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n## Workaround\r\n\r\nTo include hidden indices prefixed with `.`, it is possible to use:\r\n```\r\nPOST _snapshot/found-snapshots/test\r\n{\r\n  \"indices\": \"*,.*\"\r\n}\r\n```\r\n\r\nTo snapshot hidden indices not prefixed with `.` (e.g. `ilm-history...`), we would need to add a prefix explicitly (e.g. `ilm*`), which is not so straightforward as we need to know all the possible names of the hidden indices.","closed_by":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"performed_via_github_app":null}