[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386535989","html_url":"https://github.com/elastic/elasticsearch/issues/30370#issuecomment-386535989","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370","id":386535989,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjUzNTk4OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-04T08:27:03Z","updated_at":"2018-05-04T08:27:03Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386538622","html_url":"https://github.com/elastic/elasticsearch/issues/30370#issuecomment-386538622","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370","id":386538622,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjUzODYyMg==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-05-04T08:39:39Z","updated_at":"2018-05-04T08:39:39Z","author_association":"CONTRIBUTOR","body":"First up, #30244 is merged into 6.3, and we are expecting 6.3.0 to be the next release, so making the changes described here will not relieve the issues you are experiencing any sooner.\r\n\r\n30 seconds is a very long time to spend on any kinds of change to the cluster state, mapping updates and index creation included, and the fact that you are seeing these things time out regularly indicates some kind of problem in the way your cluster is configured. Please open a discussion about this over on https://discuss.elastic.co/ and give some more details of your cluster setup (e.g. number of nodes, number & size of indices, numbers of shards & replicas, approximate load).\r\n\r\nI've raised this issue for discussion with the wider team to gather input on your proposal.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386592933","html_url":"https://github.com/elastic/elasticsearch/issues/30370#issuecomment-386592933","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370","id":386592933,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjU5MjkzMw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-05-04T12:56:33Z","updated_at":"2018-05-04T12:56:33Z","author_association":"MEMBER","body":"> We'd like to be able to set a higher value than 30 seconds for update_mapping operations to reduce the chance of them timing out.\r\n\r\nAs a temporary measure you can increase the timeout by setting `indices.mapping.dynamic_timeout` to something higher.  @DaveCTurner's advice is still sound - it's not healthy for the master to be unavailable to process requests. I suggest you follow up on the offer to figure things out there.\r\n\r\n> As the create index operations are specifically spread out through the day during low-activity of the system and not to immediately index to them,\r\n\r\nUnderstood. Other use cases may see it differently. Without an active primary, indexing can not continue. In many use cases this is seen as more important. If replicas are not starting, you do not meet your HA requirements. That again is sensitive to other users. All in all, determining these priorities is a very tricky thing. I suggest investing time in making sure the master keeps up to speed. That will cover this and many other issues. I'm going to close this now, we can reopen if the discussion on the forums brings up something that needs changing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386765187","html_url":"https://github.com/elastic/elasticsearch/issues/30370#issuecomment-386765187","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370","id":386765187,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Njc2NTE4Nw==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-05-05T00:22:47Z","updated_at":"2018-05-05T00:22:47Z","author_association":"NONE","body":"Hi @DaveCTurner and @bleskes\r\n\r\nThanks for your quick answers. I'll open a thread in the discuss forums to see if we can get to the bottom of this.\r\n@bleskes, where can the indices.mapping.dynamic_timeout setting be changed? I only see references to its code on github.\r\n\r\nAs for the cluster tasks priority - there are several odd behaviors caused by the cluster task priority set automatically by elasticsearch:\r\n\r\nOne such behavior is the one described above when update_mapping tasks (high priority) are put aside for initializing primary shards (urgent priority). This pauses live indexing of the bulk (and the consumer which sent it) until primary shard initialization finishes - which can take a few seconds. I'd expect any explicit index opening (PUT index_name request) to have lower priority than urgent. This may not be the case when elasticsearch implicitly opens indices (when a document is indexed into a non-existing index), a case where it is clear why urgent priority is needed.\r\n\r\nAnother case, for example, is the master ping task, which receives medium priority. These pings are then put aside by many other tasks (including update_mapping and initialize shards) - increasing the chance of a master ping timeout. We've already seen cases where this behavior leads the master to think a node is not connected to the cluster anymore, taking it out of the cluster and then connecting it back a few seconds later. This is some funny behavior, as the node already participates in other tasks (e.g. indexing  / update_mapping / shard initialization etc.), signaling to the master that it is indeed connected and functioning. As this task is critical to the survival of nodes in the cluster, I think it should be assigned a higher priority (especially considering the low amount of resources or time it actually takes to complete).\r\n\r\nThanks.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386807750","html_url":"https://github.com/elastic/elasticsearch/issues/30370#issuecomment-386807750","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370","id":386807750,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjgwNzc1MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-05-05T14:02:20Z","updated_at":"2018-05-05T14:02:20Z","author_association":"MEMBER","body":"@redlus I agree it's good to evaluate these priorities and as David already indicated we will discuss this internally. I'm more than willing to discuss the examples you gave but let's do on another thread on discuss.elastic.co . If we end up want to change something we can come back here.\r\n\r\n> I'll open a thread in the discuss forums to see if we can get to the bottom of this.\r\n\r\nAll of that put aside, your use case feels abusive as you should not be seeing so many messages. I'm looking forward to hear about your setup on that discuss thread you were going to open. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386842915","html_url":"https://github.com/elastic/elasticsearch/issues/30370#issuecomment-386842915","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370","id":386842915,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Njg0MjkxNQ==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-05-05T23:49:25Z","updated_at":"2018-05-05T23:49:25Z","author_association":"NONE","body":"Hi @DaveCTurner and @bleskes,\r\nI've opened a discussion with more information on our cluster in the link below:\r\nhttps://discuss.elastic.co/t/creating-indices-and-update-mapping-tasks-take-way-too-long/130718\r\n\r\nThanks!","performed_via_github_app":null}]