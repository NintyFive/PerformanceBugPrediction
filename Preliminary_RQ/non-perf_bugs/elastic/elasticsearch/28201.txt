{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28201","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28201/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28201/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28201/events","html_url":"https://github.com/elastic/elasticsearch/issues/28201","id":288215006,"node_id":"MDU6SXNzdWUyODgyMTUwMDY=","number":28201,"title":" ES nodes disconnects intermittently from the cluster ","user":{"login":"neeraj20gupta","id":13968394,"node_id":"MDQ6VXNlcjEzOTY4Mzk0","avatar_url":"https://avatars2.githubusercontent.com/u/13968394?v=4","gravatar_id":"","url":"https://api.github.com/users/neeraj20gupta","html_url":"https://github.com/neeraj20gupta","followers_url":"https://api.github.com/users/neeraj20gupta/followers","following_url":"https://api.github.com/users/neeraj20gupta/following{/other_user}","gists_url":"https://api.github.com/users/neeraj20gupta/gists{/gist_id}","starred_url":"https://api.github.com/users/neeraj20gupta/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neeraj20gupta/subscriptions","organizations_url":"https://api.github.com/users/neeraj20gupta/orgs","repos_url":"https://api.github.com/users/neeraj20gupta/repos","events_url":"https://api.github.com/users/neeraj20gupta/events{/privacy}","received_events_url":"https://api.github.com/users/neeraj20gupta/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-01-12T18:59:57Z","updated_at":"2018-01-12T19:48:35Z","closed_at":"2018-01-12T19:48:35Z","author_association":"NONE","active_lock_reason":null,"body":"I have a 12 node cluster for elasticsearch(version 2.4), all the machines are on EC2-instances. IN between I am getting errors like master left due to which unassigned shards increases and cluster health turns to red.\r\nEnvironment details:\r\nJVM : java-1.8.0-openjdk-1.8.0.45-28.b13.el6_6.x86_64\r\nOS Version : CentOS release 6.6 (64 bit) \r\n\r\n`[2018-01-11 07:48:44,828][INFO ][discovery.zen ] [esnode21] master_left [{esnode12}{-xxxxxxxxxx}{x.x.x.x}{x.x.x.x:9300}], reason [failed to ping, tried [3] times, each with maximum [1h] timeout]`\r\n\r\nBefore these logs its just a normal GC activity no errors.\r\nWe have tested the network configuration even ran a test to test network drops and everything seems fine.\r\n\r\nIncreased the fault-detection to following :-\r\n```\r\ndiscovery.zen.fd.ping_interval: 1800s\r\ndiscovery.zen.fd.ping_timeout: 3600s\r\n```\r\n\r\nAfter going through various blogs I came across Nodes randomly disconnected from the ES cluster. I have also truned of scatter-gather using ethtool as mentioned in https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1317811.\r\n\r\nI have also updated the TCP keepalive settings as below\r\n```\r\nnet.ipv4.tcp_keepalive_time = 120\r\nnet.ipv4.tcp_keepalive_probes = 3\r\nnet.ipv4.tcp_keepalive_intvl = 30\r\n```\r\nStill these errors are occurring intermittently.\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}