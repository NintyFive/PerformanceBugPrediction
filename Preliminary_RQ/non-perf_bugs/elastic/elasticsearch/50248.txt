{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50248","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50248/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50248/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50248/events","html_url":"https://github.com/elastic/elasticsearch/issues/50248","id":538604761,"node_id":"MDU6SXNzdWU1Mzg2MDQ3NjE=","number":50248,"title":"Reindex wait_for_completion=false task failure","user":{"login":"jbudz","id":3143860,"node_id":"MDQ6VXNlcjMxNDM4NjA=","avatar_url":"https://avatars1.githubusercontent.com/u/3143860?v=4","gravatar_id":"","url":"https://api.github.com/users/jbudz","html_url":"https://github.com/jbudz","followers_url":"https://api.github.com/users/jbudz/followers","following_url":"https://api.github.com/users/jbudz/following{/other_user}","gists_url":"https://api.github.com/users/jbudz/gists{/gist_id}","starred_url":"https://api.github.com/users/jbudz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbudz/subscriptions","organizations_url":"https://api.github.com/users/jbudz/orgs","repos_url":"https://api.github.com/users/jbudz/repos","events_url":"https://api.github.com/users/jbudz/events{/privacy}","received_events_url":"https://api.github.com/users/jbudz/received_events","type":"User","site_admin":false},"labels":[{"id":1315850572,"node_id":"MDU6TGFiZWwxMzE1ODUwNTcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Reindex","name":":Distributed/Reindex","color":"0e8a16","default":false,"description":"Issues relating to reindex that are not caused by issues further down"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-12-16T19:25:16Z","updated_at":"2019-12-19T11:31:44Z","closed_at":"2019-12-19T11:31:44Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"```\r\ncurl -XPUT \"http://localhost:9220/foo\"\r\ncurl -XPOST \"http://localhost:9220/_reindex?wait_for_completion=false\" -H 'Content-Type: application/json' -d'{  \"source\": {    \"index\": \"foo\"  },  \"dest\": {    \"index\": \"bar\"  }}'\r\n\r\n// run twice\r\ncurl -XPOST \"http://localhost:9220/_reindex?wait_for_completion=false\" -H 'Content-Type: application/json' -d'{  \"source\": {    \"index\": \"foo\"  },  \"dest\": {    \"index\": \"bar\"  }}'\r\n```\r\n\r\nError log\r\n```\r\n   │ info [o.e.t.LoggingTaskListener] [windesk] 6563 failed with exception\r\n   │      org.elasticsearch.index.mapper.MapperParsingException: Root mapping definition has unsupported parameters:  [task : {_meta={version=2}, dynamic=strict, properties={completed={type=boolean}, task={properties={action={type=keyword}, cancellable={type=boolean}, id={type=long}, parent_task_id={type=keyword}, node={type=keyword}, running_time_in_nanos={type=long}, start_time_in_millis={type=long}, type={type=keyword}, status={type=object, enabled=false}, description={type=text}, headers={type=object, enabled=false}}}, response={type=object, enabled=false}, error={type=object, enabled=false}}}]\r\n   │            at org.elasticsearch.index.mapper.DocumentMapperParser.checkNoRemainingFields(DocumentMapperParser.java:147) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n   │            at org.elasticsearch.index.mapper.DocumentMapperParser.parse(DocumentMapperParser.java:135) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n   │            at org.elasticsearch.index.mapper.DocumentMapperParser.parse(DocumentMapperParser.java:83) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n   │            at org.elasticsearch.index.mapper.MapperService.parse(MapperService.java:553) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n```\r\n\r\nThe response code is 200 with a task id.  When attempting to retrieve the returned task id:\r\n```\r\ncurl -XGET \"http://localhost:9220/_tasks/UWqGoA9jRM25A2GQIUZp3g:6563\"\r\n```\r\n```\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"resource_not_found_exception\",\r\n        \"reason\" : \"task [UWqGoA9jRM25A2GQIUZp3g:6563] isn't running and hasn't stored its results\"\r\n      }\r\n    ],\r\n    \"type\" : \"resource_not_found_exception\",\r\n    \"reason\" : \"task [UWqGoA9jRM25A2GQIUZp3g:6563] isn't running and hasn't stored its results\"\r\n  },\r\n  \"status\" : 404\r\n}\r\n\r\n```\r\n\r\n\r\nRe-indexing fails until the .tasks index is deleted, and then I can run it once before it starts failing again.\r\n\r\n\r\n","closed_by":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}