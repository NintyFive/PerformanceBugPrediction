[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411483903","html_url":"https://github.com/elastic/elasticsearch/issues/32710#issuecomment-411483903","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32710","id":411483903,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTQ4MzkwMw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-08-08T17:17:44Z","updated_at":"2018-08-08T17:17:44Z","author_association":"MEMBER","body":"The context suggester uses an id to differentiate the contexts that can clash with a reserved character. `0x1d` is 29 in decimal so you can use up to 29 contexts without hitting this bug(we start the id at 0) . This is clearly a bug but 30 is already too much. We don't limit anything here but more than 2, 3 contexts should be discouraged so I am inclined to use this bug to limit the number of allowed context mapping.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411484021","html_url":"https://github.com/elastic/elasticsearch/issues/32710#issuecomment-411484021","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32710","id":411484021,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTQ4NDAyMQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-08T17:18:10Z","updated_at":"2018-08-08T17:18:10Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411676856","html_url":"https://github.com/elastic/elasticsearch/issues/32710#issuecomment-411676856","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32710","id":411676856,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTY3Njg1Ng==","user":{"login":"leibale","id":7086055,"node_id":"MDQ6VXNlcjcwODYwNTU=","avatar_url":"https://avatars0.githubusercontent.com/u/7086055?v=4","gravatar_id":"","url":"https://api.github.com/users/leibale","html_url":"https://github.com/leibale","followers_url":"https://api.github.com/users/leibale/followers","following_url":"https://api.github.com/users/leibale/following{/other_user}","gists_url":"https://api.github.com/users/leibale/gists{/gist_id}","starred_url":"https://api.github.com/users/leibale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leibale/subscriptions","organizations_url":"https://api.github.com/users/leibale/orgs","repos_url":"https://api.github.com/users/leibale/repos","events_url":"https://api.github.com/users/leibale/events{/privacy}","received_events_url":"https://api.github.com/users/leibale/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T08:18:47Z","updated_at":"2018-08-09T08:18:47Z","author_association":"NONE","body":"So, what do you suggest me to do?\r\n\r\nI have a store index with products, each product has `names` array and `branches` object (with id as the key and a branch object as the value). Each branch object contains data of the product in the specific branch (like `isActive`, `price`, etc.).\r\n\r\nHow can I perform a suggest on the names when the product is active in a specific branch (like `branches.${branchId}.isActive`) without adding a context for each branch (each product has 40-50 branches)?\r\n\r\nProduct example:\r\n```json\r\n{\r\n  \"id\": 1,\r\n  \"names\": [\"Product Name\", \"Another Product Name\"],\r\n  \"branches\": {\r\n    \"1\": {\r\n      \"isActive\": true,\r\n      \"price\": 10\r\n    },\r\n    \"2\": {\r\n      \"isActive\": false\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411681057","html_url":"https://github.com/elastic/elasticsearch/issues/32710#issuecomment-411681057","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32710","id":411681057,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTY4MTA1Nw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T08:34:07Z","updated_at":"2018-08-09T08:34:07Z","author_association":"MEMBER","body":"If you have a lot of contexts with different types (numbers, booleans, texts) I'd suggest to use a `text` field for `names` with a `keyword` tokenizer and an [`edge_ngram`](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-edgengram-tokenfilter.html) filter to index all prefixes in the `index_analyzer` and a simple `keyword` tokenizer for the `search_analyzer`. This way you can use the query DSL to search your `names` field and use the other fields in your mapping as filters. Using too many contexts in the `completion` suggester is a sign that you need a real index with multi-fields support, the cost of recreating and querying this index in the `completion` suggester defeats the purpose of this special field.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411712162","html_url":"https://github.com/elastic/elasticsearch/issues/32710#issuecomment-411712162","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32710","id":411712162,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTcxMjE2Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T10:26:16Z","updated_at":"2018-08-09T10:26:16Z","author_association":"MEMBER","body":"> How can I perform a suggest on the names when the product is active in a specific branch (like branches.${branchId}.isActive) without adding a context for each branch (each product has 40-50 branches)?\r\n\r\nSorry I misread your comment, if you only need to know if the suggestion is active in a branch you can use a single context mapping, `branch` for instance, and use the ids of the active branches as context values. So for instance if `product 1` is active in branches 1, 4 and 45 you can index it as:\r\n````\r\n{\r\n    \"suggest\": {\r\n        \"input\": \"product 1\",\r\n        \"contexts\": {\r\n            \"place_type\": [\"1\", \"4\", \"45\"] \r\n        }\r\n    }\r\n}\r\n````\r\nI opened https://github.com/elastic/elasticsearch/issues/32741 to address the >=30 contexts failures\r\n so I hope you don't mind if I close this issue. ","performed_via_github_app":null}]