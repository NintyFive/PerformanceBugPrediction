[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153787582","html_url":"https://github.com/elastic/elasticsearch/issues/14528#issuecomment-153787582","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528","id":153787582,"node_id":"MDEyOklzc3VlQ29tbWVudDE1Mzc4NzU4Mg==","user":{"login":"designermonkey","id":221344,"node_id":"MDQ6VXNlcjIyMTM0NA==","avatar_url":"https://avatars1.githubusercontent.com/u/221344?v=4","gravatar_id":"","url":"https://api.github.com/users/designermonkey","html_url":"https://github.com/designermonkey","followers_url":"https://api.github.com/users/designermonkey/followers","following_url":"https://api.github.com/users/designermonkey/following{/other_user}","gists_url":"https://api.github.com/users/designermonkey/gists{/gist_id}","starred_url":"https://api.github.com/users/designermonkey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/designermonkey/subscriptions","organizations_url":"https://api.github.com/users/designermonkey/orgs","repos_url":"https://api.github.com/users/designermonkey/repos","events_url":"https://api.github.com/users/designermonkey/events{/privacy}","received_events_url":"https://api.github.com/users/designermonkey/received_events","type":"User","site_admin":false},"created_at":"2015-11-04T16:43:36Z","updated_at":"2015-11-04T16:43:36Z","author_association":"NONE","body":"And on a slight tangent, the exception above is because of a missing mapping, yet elasticsearch never even tells me that, it balks on the fact it can't use a nested path. Surely, the missing mapping is the issue, not the path?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153791148","html_url":"https://github.com/elastic/elasticsearch/issues/14528#issuecomment-153791148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528","id":153791148,"node_id":"MDEyOklzc3VlQ29tbWVudDE1Mzc5MTE0OA==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2015-11-04T16:56:49Z","updated_at":"2015-11-04T16:56:49Z","author_association":"MEMBER","body":"@designermonkey what version of ES are you using? With 2.0 REST exceptions are now rendered in a structured way, to make it easier to extract useful information out of them. Additionally, we are working on parsing queries on the coordinating node, which will reduce the amount of shard failures (only a single exception instead of an exception for each shard)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153848611","html_url":"https://github.com/elastic/elasticsearch/issues/14528#issuecomment-153848611","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528","id":153848611,"node_id":"MDEyOklzc3VlQ29tbWVudDE1Mzg0ODYxMQ==","user":{"login":"designermonkey","id":221344,"node_id":"MDQ6VXNlcjIyMTM0NA==","avatar_url":"https://avatars1.githubusercontent.com/u/221344?v=4","gravatar_id":"","url":"https://api.github.com/users/designermonkey","html_url":"https://github.com/designermonkey","followers_url":"https://api.github.com/users/designermonkey/followers","following_url":"https://api.github.com/users/designermonkey/following{/other_user}","gists_url":"https://api.github.com/users/designermonkey/gists{/gist_id}","starred_url":"https://api.github.com/users/designermonkey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/designermonkey/subscriptions","organizations_url":"https://api.github.com/users/designermonkey/orgs","repos_url":"https://api.github.com/users/designermonkey/repos","events_url":"https://api.github.com/users/designermonkey/events{/privacy}","received_events_url":"https://api.github.com/users/designermonkey/received_events","type":"User","site_admin":false},"created_at":"2015-11-04T20:08:57Z","updated_at":"2015-11-04T20:08:57Z","author_association":"NONE","body":"I'm on 1.7 and not sure about upgrading yet. Any breaking changes to know about? Can an existing index be upgraded?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153857374","html_url":"https://github.com/elastic/elasticsearch/issues/14528#issuecomment-153857374","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528","id":153857374,"node_id":"MDEyOklzc3VlQ29tbWVudDE1Mzg1NzM3NA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2015-11-04T20:44:26Z","updated_at":"2015-11-04T20:44:26Z","author_association":"MEMBER","body":"BTW, this is what the exception would look like under 2.0:\n\n``` json\n{\n   \"error\": {\n      \"root_cause\": [\n         {\n            \"type\": \"query_parsing_exception\",\n            \"reason\": \"[nested] failed to find nested object under path [hierarchy]\",\n            \"index\": \"test\",\n            \"line\": 14,\n            \"col\": 25\n         }\n      ],\n      \"type\": \"search_phase_execution_exception\",\n      \"reason\": \"all shards failed\",\n      \"phase\": \"query\",\n      \"grouped\": true,\n      \"failed_shards\": [\n         {\n            \"shard\": 0,\n            \"index\": \"test\",\n            \"node\": \"R33m3wHNSbGW8mkHcJwlpQ\",\n            \"reason\": {\n               \"type\": \"query_parsing_exception\",\n               \"reason\": \"[nested] failed to find nested object under path [hierarchy]\",\n               \"index\": \"test\",\n               \"line\": 14,\n               \"col\": 25\n            }\n         }\n      ]\n   },\n   \"status\": 400\n}\n```\n\nThere are indeed breaking changes, specifically around mappings which might cause some trouble.  You can read about them here:  https://www.elastic.co/guide/en/elasticsearch/reference/2.0/breaking-changes-2.0.html\n\nThe new [Migration Plugin](https://github.com/elastic/elasticsearch-migration) should help identify potential issues before upgrading, at least on the index structure / mapping / analysis side of things.  Won't be able to help with changes to query or response syntax.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/154009345","html_url":"https://github.com/elastic/elasticsearch/issues/14528#issuecomment-154009345","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528","id":154009345,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NDAwOTM0NQ==","user":{"login":"designermonkey","id":221344,"node_id":"MDQ6VXNlcjIyMTM0NA==","avatar_url":"https://avatars1.githubusercontent.com/u/221344?v=4","gravatar_id":"","url":"https://api.github.com/users/designermonkey","html_url":"https://github.com/designermonkey","followers_url":"https://api.github.com/users/designermonkey/followers","following_url":"https://api.github.com/users/designermonkey/following{/other_user}","gists_url":"https://api.github.com/users/designermonkey/gists{/gist_id}","starred_url":"https://api.github.com/users/designermonkey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/designermonkey/subscriptions","organizations_url":"https://api.github.com/users/designermonkey/orgs","repos_url":"https://api.github.com/users/designermonkey/repos","events_url":"https://api.github.com/users/designermonkey/events{/privacy}","received_events_url":"https://api.github.com/users/designermonkey/received_events","type":"User","site_admin":false},"created_at":"2015-11-05T09:49:21Z","updated_at":"2015-11-05T09:49:21Z","author_association":"NONE","body":"That is so much better :) Thanks for the info guys.\n\n@polyfractal would this require an upgrade of the php lib to v2 as well?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/154089876","html_url":"https://github.com/elastic/elasticsearch/issues/14528#issuecomment-154089876","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528","id":154089876,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NDA4OTg3Ng==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2015-11-05T15:18:47Z","updated_at":"2015-11-05T15:18:47Z","author_association":"MEMBER","body":"Nope, no upgrade required.  The ES-PHP 1.x branch never tried to deserialize the error response, since sometimes ES would send back non-JSON exceptions (mostly with older versions of ES iirc).  So you'll just get back a blob of (structured) JSON using the ES-PHP 1.x branch. \n\nIf you know you're always querying a 2.x branch of Elasticsearch, you should be able to safely `json_decode()` the exception message all the time.\n\nSo with ES-PHP 1.x you'll get something like this:\n\n``` php\nprint_r($e->getMessage())\n  {\"error\":{\"root_cause\":[{\"type\":\"query_parsing_exception\",\"reason\":\"[nested] failed to find nested object under path [hierarchy]\",\"index\":\"test\",\"line\":14,\"col\":35}],\"type\":\"search_phase_execution_exception\",\"reason\":\"all shards failed\",\"phase\":\"query\",\"grouped\":true,\"failed_shards\":[{\"shard\":0,\"index\":\"test\",\"node\":\"PHHrUvTRQbuiTaAtGsESvA\",\"reason\":{\"type\":\"query_parsing_exception\",\"reason\":\"[nested] failed to find nested object under path [hierarchy]\",\"index\":\"test\",\"line\":14,\"col\":35}}]},\"status\":400}\n\nprint_r($e->getCode())\n  400\n\nprint_r($e->getPrevious()->getMessage())\n  Client error response\n  [status code] 400\n  [reason phrase] Bad Request\n  [url] http://localhost:9200/_search\n```\n\nWhereas with the ES-PHP 2.x branch you'd see:\n\n``` php\nprint_r($e->getMessage())\n  query_parsing_exception: [nested] failed to find nested object under path [hierarchy]\n\nprint_r($e->getCode())\n  400\n\nprint_r($e->getPrevious()->getMessage())\n  {\"error\":{\"root_cause\":[{\"type\":\"query_parsing_exception\",\"reason\":\"[nested] failed to find nested object under path [hierarchy]\",\"index\":\"test\",\"line\":14,\"col\":35}],\"type\":\"search_phase_execution_exception\",\"reason\":\"all shards failed\",\"phase\":\"query\",\"grouped\":true,\"failed_shards\":[{\"shard\":0,\"index\":\"test\",\"node\":\"PHHrUvTRQbuiTaAtGsESvA\",\"reason\":{\"type\":\"query_parsing_exception\",\"reason\":\"[nested] failed to find nested object under path [hierarchy]\",\"index\":\"test\",\"line\":14,\"col\":35}}]},\"status\":400}\n```\n\nI'm actually working on the exception handling right now (in part spurred by your exception ticket, in part by working ES 2.0 itself).  PHP exceptions can only accept a string as their error message, which means we decode the exception into a nice PHP array to build the \"english reason\"...then throw it away.  Which is not terribly friendly.\n\nSo I'm working right now to add a `getStructured()` method to the exceptions so you can get the full ES structured exception in array form. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/154096465","html_url":"https://github.com/elastic/elasticsearch/issues/14528#issuecomment-154096465","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528","id":154096465,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NDA5NjQ2NQ==","user":{"login":"designermonkey","id":221344,"node_id":"MDQ6VXNlcjIyMTM0NA==","avatar_url":"https://avatars1.githubusercontent.com/u/221344?v=4","gravatar_id":"","url":"https://api.github.com/users/designermonkey","html_url":"https://github.com/designermonkey","followers_url":"https://api.github.com/users/designermonkey/followers","following_url":"https://api.github.com/users/designermonkey/following{/other_user}","gists_url":"https://api.github.com/users/designermonkey/gists{/gist_id}","starred_url":"https://api.github.com/users/designermonkey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/designermonkey/subscriptions","organizations_url":"https://api.github.com/users/designermonkey/orgs","repos_url":"https://api.github.com/users/designermonkey/repos","events_url":"https://api.github.com/users/designermonkey/events{/privacy}","received_events_url":"https://api.github.com/users/designermonkey/received_events","type":"User","site_admin":false},"created_at":"2015-11-05T15:39:09Z","updated_at":"2015-11-05T15:39:09Z","author_association":"NONE","body":"Thanks for the feedback. I really do wish I had time to help you out there, family and heavy work commitments leave me with no time :(\n","performed_via_github_app":null}]