[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158431109","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-158431109","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":158431109,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODQzMTEwOQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-20T15:24:00Z","updated_at":"2015-11-20T15:24:00Z","author_association":"MEMBER","body":"What happens is that as you restart nodes other replicas are elected as primaries. Since Elasticsearch does sync replication, all shard copies do the same work except for extreme cases (like a lot of document rejections, or extremely heavy update scripts). As such the location of the primaries shouldn't matter much (and we are working on those extreme cases where it still does).\n\nDo you see any odd behavior due to those primaries?  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159237844","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-159237844","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":159237844,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTIzNzg0NA==","user":{"login":"kaanbasal","id":3204601,"node_id":"MDQ6VXNlcjMyMDQ2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3204601?v=4","gravatar_id":"","url":"https://api.github.com/users/kaanbasal","html_url":"https://github.com/kaanbasal","followers_url":"https://api.github.com/users/kaanbasal/followers","following_url":"https://api.github.com/users/kaanbasal/following{/other_user}","gists_url":"https://api.github.com/users/kaanbasal/gists{/gist_id}","starred_url":"https://api.github.com/users/kaanbasal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaanbasal/subscriptions","organizations_url":"https://api.github.com/users/kaanbasal/orgs","repos_url":"https://api.github.com/users/kaanbasal/repos","events_url":"https://api.github.com/users/kaanbasal/events{/privacy}","received_events_url":"https://api.github.com/users/kaanbasal/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T11:35:04Z","updated_at":"2015-11-24T11:45:56Z","author_association":"NONE","body":"I made some tests about the behaviour of primary shard distribution based on the other users thoughts mentioned. I find that there is no CPU or RAM overhead on the node full of primary shards when making query or inserting new documents, on the other side the only thing I found odd is when a new node added to the cluster, the only node sending the data to the newly created node is that node which is full of primary shards and this behaviour makes Network and CPU overhead only on that machine.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159247918","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-159247918","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":159247918,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTI0NzkxOA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T12:03:07Z","updated_at":"2015-11-24T12:03:07Z","author_association":"MEMBER","body":"> the only node sending the data to the newly created node is that node which is full of primary shards\n\nThat is correct for indexing. Searches how ever should round robin and hit the new node as well.\n\n> behaviour makes Network and CPU overhead only on that machine.\n\nwhich of two machines do you mean? I presume the one with primary, in which case I can see the network argument (but not the cpu). Is network a bottle neck for you?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159252166","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-159252166","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":159252166,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTI1MjE2Ng==","user":{"login":"kaanbasal","id":3204601,"node_id":"MDQ6VXNlcjMyMDQ2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3204601?v=4","gravatar_id":"","url":"https://api.github.com/users/kaanbasal","html_url":"https://github.com/kaanbasal","followers_url":"https://api.github.com/users/kaanbasal/followers","following_url":"https://api.github.com/users/kaanbasal/following{/other_user}","gists_url":"https://api.github.com/users/kaanbasal/gists{/gist_id}","starred_url":"https://api.github.com/users/kaanbasal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaanbasal/subscriptions","organizations_url":"https://api.github.com/users/kaanbasal/orgs","repos_url":"https://api.github.com/users/kaanbasal/repos","events_url":"https://api.github.com/users/kaanbasal/events{/privacy}","received_events_url":"https://api.github.com/users/kaanbasal/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T12:25:19Z","updated_at":"2015-11-24T12:26:46Z","author_association":"NONE","body":"Your assumption is right about the machine, it's the one with primary. For now network is not a bottle neck for us but I just wanted you to know this situation. \nFor the CPU argument, I made some queries/inserts while indexing the newly added node, and the node with primary had a lot of CPU usage than the other nodes.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159255124","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-159255124","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":159255124,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTI1NTEyNA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T12:35:22Z","updated_at":"2015-11-24T12:35:22Z","author_association":"MEMBER","body":"ok. Are you using update scripts? as I mentioned, those are run on the primary only, but are typically light weight. If not, can you run [the _hot_threads API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-hot-threads.html?q=hot%20thre#cluster-nodes-hot-threads) and report what the node with the primary says?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159257484","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-159257484","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":159257484,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTI1NzQ4NA==","user":{"login":"kaanbasal","id":3204601,"node_id":"MDQ6VXNlcjMyMDQ2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3204601?v=4","gravatar_id":"","url":"https://api.github.com/users/kaanbasal","html_url":"https://github.com/kaanbasal","followers_url":"https://api.github.com/users/kaanbasal/followers","following_url":"https://api.github.com/users/kaanbasal/following{/other_user}","gists_url":"https://api.github.com/users/kaanbasal/gists{/gist_id}","starred_url":"https://api.github.com/users/kaanbasal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaanbasal/subscriptions","organizations_url":"https://api.github.com/users/kaanbasal/orgs","repos_url":"https://api.github.com/users/kaanbasal/repos","events_url":"https://api.github.com/users/kaanbasal/events{/privacy}","received_events_url":"https://api.github.com/users/kaanbasal/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T12:46:54Z","updated_at":"2015-11-24T12:55:02Z","author_association":"NONE","body":"I don't know which info do you need from the hot threads api response. Do you want me to send all of the  response or any specific value?\n\nEdit: I don't use update script\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159259485","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-159259485","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":159259485,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTI1OTQ4NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T12:55:40Z","updated_at":"2015-11-24T12:55:40Z","author_association":"MEMBER","body":"If you gist them it would be great (with an indication of which node is the one with the primaries. That will tell us what it does.\n\n> On 24 Nov 2015, at 13:47, Kaan Basal notifications@github.com wrote:\n> \n> I don't know which info do you need from the hot threads api response. Do you want me to send all of the response or any specific value?\n> \n> —\n> Reply to this email directly or view it on GitHub.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159261958","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-159261958","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":159261958,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTI2MTk1OA==","user":{"login":"kaanbasal","id":3204601,"node_id":"MDQ6VXNlcjMyMDQ2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3204601?v=4","gravatar_id":"","url":"https://api.github.com/users/kaanbasal","html_url":"https://github.com/kaanbasal","followers_url":"https://api.github.com/users/kaanbasal/followers","following_url":"https://api.github.com/users/kaanbasal/following{/other_user}","gists_url":"https://api.github.com/users/kaanbasal/gists{/gist_id}","starred_url":"https://api.github.com/users/kaanbasal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaanbasal/subscriptions","organizations_url":"https://api.github.com/users/kaanbasal/orgs","repos_url":"https://api.github.com/users/kaanbasal/repos","events_url":"https://api.github.com/users/kaanbasal/events{/privacy}","received_events_url":"https://api.github.com/users/kaanbasal/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T13:09:28Z","updated_at":"2015-11-24T13:09:28Z","author_association":"NONE","body":"Ok, you can check it here: [Hot Threads](https://gist.github.com/kaanbasal/ebaffd30567435c142b5)\n\n[Hot_Thread_Primary_Only_Indexing](https://gist.github.com/kaanbasal/ebaffd30567435c142b5#file-hot_thread_primary_only_indexing) is only primary node, while indexing to newly added node. (before making query/insert)\n\nThe others are while indexing & querying/inserting at the same time. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/164562282","html_url":"https://github.com/elastic/elasticsearch/issues/14879#issuecomment-164562282","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14879","id":164562282,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NDU2MjI4Mg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-12-14T21:16:56Z","updated_at":"2015-12-14T21:16:56Z","author_association":"MEMBER","body":"@kaanbasal sorry for taking so long to respond. The hot thread seem to suggest that the replicas are still recovering and pull data from the node with the primary. Specifically the hot threads show compression code, compressing the data before it is being sent. It is correct that when the index is going from yellow to green the primary has more to do then replicas. However, this period is temporary. The tricky part is that moving the primaries around for this purpose will create more traffic than letting the replicas finish recovering. I'm going to close this for now as it feels like the right tradeoff. Feel free to reopen if it doesn't add up.\n\nNote that in master we're going to reduce the CPU spent compressing lucene files during recovery. They are already compressed.\n","performed_via_github_app":null}]