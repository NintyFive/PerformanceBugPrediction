[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131761","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-384131761","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":384131761,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTc2MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T18:41:48Z","updated_at":"2018-04-25T01:28:04Z","author_association":"COLLABORATOR","body":"*Original comment by @polyfractal:*\n\nStarting to get noisy, disabled the tests for now\r\n\r\nMaster: LINK REDACTED\r\n6.x: LINK REDACTED","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131764","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-384131764","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":384131764,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTc2NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-23T00:25:58Z","updated_at":"2018-04-25T01:28:04Z","author_association":"COLLABORATOR","body":"*Original comment by @tvernum:*\n\n@tbrooks8 This looks like it could be license related - any thoughts?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131767","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-384131767","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":384131767,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTc2Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-23T01:39:38Z","updated_at":"2018-04-25T01:28:04Z","author_association":"COLLABORATOR","body":"*Original comment by @tbrooks8:*\n\nYeah I’ll take a look tomorrow. Thanks for the ping. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131768","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-384131768","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":384131768,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTc2OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-23T17:27:11Z","updated_at":"2018-04-25T01:28:04Z","author_association":"COLLABORATOR","body":"*Original comment by @tbrooks8:*\n\n@rjernst - It looks to be that this is failing while reading the encrypted public key. And it started failing shortly after HASH REDACTED. Could that be related?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131769","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-384131769","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":384131769,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTc2OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-23T19:08:46Z","updated_at":"2018-04-25T01:28:05Z","author_association":"COLLABORATOR","body":"*Original comment by @rjernst:*\n\nIt is definitely related. @elasticdog  In LINK REDACTED you said no decoding should be necessary. Can you confirm this is still correct? This seems the most likely problem.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131770","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-384131770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":384131770,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTc3MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T08:16:50Z","updated_at":"2018-04-25T01:28:05Z","author_association":"COLLABORATOR","body":"*Original comment by @elasticdog:*\n\nThe base64 decoding happens when Ansible pulls the license out of Vault to write it to the disk:\r\n\r\nLINK REDACTED\r\n\r\nYou can verify that the old key and what is in Vault are the same by checking out the commit before HASH REDACTED when the key was removed:\r\n\r\n```\r\n$ cd x-pack-elasticsearch/\r\n$ git checkout HASH REDACTED^\r\n$ vault read -field=pubkey secret/release/license | base64 --decode > decoded.key\r\n$ shasum plugin/keys/prod/public.key decoded.key \r\n95e0dcb7bb45c4a67c41cd29190319feecd42ef1  plugin/keys/prod/public.key\r\n95e0dcb7bb45c4a67c41cd29190319feecd42ef1  decoded.key\r\n```\r\n\r\n...although, I'm having trouble getting checksums to align with what's actually on the internal-ci machines (I just picked one at random to test):\r\n\r\n```\r\nEMAIL REDACTED shasum /etc/x-pack/license.key\r\n5cc2cb605da4105f2977bb654c4289adf0b653aa  /etc/x-pack/license.key\r\n```\r\n\r\nIt does look like they're different sizes, and Ansible might be adding some unexpected content. I've confirmed that the Vault lookup plugin is working as expected, so it may be that Ansible's built-in `b64decode` filter is not behaving the same as `base64 --decode`. Investigating now.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131772","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-384131772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":384131772,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTc3Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T08:42:46Z","updated_at":"2018-04-25T01:28:05Z","author_association":"COLLABORATOR","body":"*Original comment by @elasticdog:*\n\nI can see the expected content is there in a `hexdump` (within some extra junk), so I started digging into the upstream [b64decode filter source](https://github.com/ansible/ansible/blob/f0fd0f219de80a8f682b80e1ccdb83fd4988da64/lib/ansible/plugins/filter/core.py#L466-L467) and Ansible's [custom text utility functions](https://github.com/ansible/ansible/blob/f0fd0f219de80a8f682b80e1ccdb83fd4988da64/lib/ansible/module_utils/_text.py). It looks like this may be a known limitation with trying to pass binary files through Jinja templates. I believe in this scenario, the content gets [inadvertently UTF-8 encoded](https://github.com/ansible/ansible/issues/13794). 😢 🐼 \r\n\r\nI'll split up the Ansible task to use the system binaries for decoding rather than running it through a filter. Sorry for not catching this sooner...you'd think base64 decoding would be a problem devoid of much complexity.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131773","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-384131773","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":384131773,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTc3Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T09:43:58Z","updated_at":"2018-04-25T01:28:05Z","author_association":"COLLABORATOR","body":"*Original comment by @elasticdog:*\n\nI've worked around the jinja2 filtering behavior, re-deployed the license file, and **confirmed** that it matches the expected output:\r\n\r\n```\r\nEMAIL REDACTED shasum /etc/x-pack/license.key\r\n95e0dcb7bb45c4a67c41cd29190319feecd42ef1  /etc/x-pack/license.key\r\n```\r\n\r\nFeel free to resolve this once there's a green release tests job.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/389742403","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-389742403","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":389742403,"node_id":"MDEyOklzc3VlQ29tbWVudDM4OTc0MjQwMw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-05-17T04:40:12Z","updated_at":"2018-05-17T04:40:12Z","author_association":"CONTRIBUTOR","body":"I believe this is sorted out now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412120361","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-412120361","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":412120361,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjEyMDM2MQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T15:35:58Z","updated_at":"2018-08-10T15:35:58Z","author_association":"MEMBER","body":"@tvernum I noticed the yaml test is still `skip: all` in master, presumably this should be removed now?\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/master/x-pack/plugin/src/test/resources/rest-api-spec/test/upgrade/10_basic.yml#L5","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431329772","html_url":"https://github.com/elastic/elasticsearch/issues/29890#issuecomment-431329772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29890","id":431329772,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTMyOTc3Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-10-19T11:15:59Z","updated_at":"2018-10-19T11:15:59Z","author_association":"MEMBER","body":"@tvernum was directed here by the weekly mail, there still seems to be the above mentioned \"skip: all\" so I'm just pinging if the skip can be removed.","performed_via_github_app":null}]