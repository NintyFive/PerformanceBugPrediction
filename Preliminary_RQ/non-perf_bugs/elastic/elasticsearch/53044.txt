{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53044","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53044/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53044/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53044/events","html_url":"https://github.com/elastic/elasticsearch/issues/53044","id":574376725,"node_id":"MDU6SXNzdWU1NzQzNzY3MjU=","number":53044,"title":"No way to specify auto-slice in an AbstractBulkByScrollRequest","user":{"login":"tc027","id":61717338,"node_id":"MDQ6VXNlcjYxNzE3MzM4","avatar_url":"https://avatars1.githubusercontent.com/u/61717338?v=4","gravatar_id":"","url":"https://api.github.com/users/tc027","html_url":"https://github.com/tc027","followers_url":"https://api.github.com/users/tc027/followers","following_url":"https://api.github.com/users/tc027/following{/other_user}","gists_url":"https://api.github.com/users/tc027/gists{/gist_id}","starred_url":"https://api.github.com/users/tc027/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tc027/subscriptions","organizations_url":"https://api.github.com/users/tc027/orgs","repos_url":"https://api.github.com/users/tc027/repos","events_url":"https://api.github.com/users/tc027/events{/privacy}","received_events_url":"https://api.github.com/users/tc027/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null},{"id":1874266491,"node_id":"MDU6TGFiZWwxODc0MjY2NDkx","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.6.2","name":"v7.6.2","color":"dddddd","default":false,"description":""},{"id":1789304462,"node_id":"MDU6TGFiZWwxNzg5MzA0NDYy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.7.0","name":"v7.7.0","color":"dddddd","default":false,"description":""},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-03-03T02:38:40Z","updated_at":"2020-03-08T20:34:15Z","closed_at":"2020-03-06T13:55:49Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\nElasticsearch version: 7.6.0\r\n\r\nJVM version:\r\nopenjdk version \"11.0.6\" 2020-01-14\r\nOpenJDK Runtime Environment AdoptOpenJDK (build 11.0.6+10)\r\nOpenJDK 64-Bit Server VM AdoptOpenJDK (build 11.0.6+10, mixed mode)\r\n\r\nOS version: Windows 10\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nThere is no way to specify auto-slice in an AbstractBulkByScrollRequest. AbstractBulkByScrollRequest.setSlices only takes an int but AbstractBaseReindexRestHandler.parseSlices checks for an 'auto' string, which is impossible provide via the Java High Level REST Client. Simply providing '0' instead does not work either as this causes parseSlices to throw an exception.\r\n\r\n```\r\npublic static final int AUTO_SLICES = 0;\r\npublic static final String AUTO_SLICES_VALUE = \"auto\";\r\n\r\npublic Self setSlices(int slices) {\r\n        if (slices < 0) {\r\n            throw new IllegalArgumentException(\"[slices] must be at least 0 but was [\" + slices + \"]\");\r\n        }\r\n        this.slices = slices;\r\n        return self();\r\n}\r\n```\r\n\r\n```\r\nprivate static Integer parseSlices(RestRequest request) {\r\n        String slicesString = request.param(\"slices\");\r\n        if (slicesString == null) {\r\n            return null;\r\n        }\r\n\r\n        if (slicesString.equals(AbstractBulkByScrollRequest.AUTO_SLICES_VALUE)) {\r\n            return AbstractBulkByScrollRequest.AUTO_SLICES;\r\n        }\r\n\r\n        int slices;\r\n        try {\r\n            slices = Integer.parseInt(slicesString);\r\n        } catch (NumberFormatException e) {\r\n            throw new IllegalArgumentException(\r\n                \"[slices] must be a positive integer or the string \\\"auto\\\", but was [\" + slicesString + \"]\", e);\r\n        }\r\n\r\n        if (slices < 1) {\r\n            throw new IllegalArgumentException(\r\n                \"[slices] must be a positive integer or the string \\\"auto\\\", but was [\" + slicesString + \"]\");\r\n        }\r\n\r\n        return slices;\r\n}\r\n```\r\n\r\n**Steps to reproduce**:\r\n\r\n```\r\nUpdateByQueryRequest request = new UpdateByQueryRequest(index)\r\nrequest.setSlices(\"auto\")// does not work due to being string\r\n```\r\n\r\n```\r\nUpdateByQueryRequest request = new UpdateByQueryRequest(index)\r\nrequest.setSlices(0)// does not work due to being less than 1\r\n```","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}