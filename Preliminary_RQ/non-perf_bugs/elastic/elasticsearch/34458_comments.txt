[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/429850380","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-429850380","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":429850380,"node_id":"MDEyOklzc3VlQ29tbWVudDQyOTg1MDM4MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-15T13:22:38Z","updated_at":"2018-10-15T13:22:38Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/430633797","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-430633797","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":430633797,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMDYzMzc5Nw==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-10-17T13:43:53Z","updated_at":"2018-10-17T13:43:53Z","author_association":"CONTRIBUTOR","body":"Those logs are unfortunately gone. \r\nI did run into this locally while running with the Gradle daemon, \r\nand then subsequently looked at the  heap put nothing stood out. \r\nI'm not aware of any changes to the  build that could have caused this around Oct. 7.    \r\nWe allow Gradle to use 2G, I am tempted to increase that to see if we still get OOMs and as an interim solution before I get a chance to look more into it. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431003840","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-431003840","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":431003840,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTAwMzg0MA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-10-18T13:15:25Z","updated_at":"2018-10-18T13:15:25Z","author_association":"CONTRIBUTOR","body":"another one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=oraclelinux/4/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431019771","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-431019771","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":431019771,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTAxOTc3MQ==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-10-18T13:59:58Z","updated_at":"2018-10-18T13:59:58Z","author_association":"CONTRIBUTOR","body":"@ywelsch the one you link to has:\r\n```\r\n15:18:02 > Task :server:integTest FAILED\r\n15:18:02 Tests with failures:\r\n15:18:02   - org.elasticsearch.action.admin.indices.create.CreateIndexIT.testCreateAndDeleteIndexConcurrently\r\n15:18:02 \r\n```\r\n\r\n@DaveCTurner  where was the OOM ? I assumed Gradle, but it could have been the tests, or the tests clusters too. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431026804","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-431026804","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":431026804,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTAyNjgwNA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-10-18T14:18:08Z","updated_at":"2018-10-18T14:18:08Z","author_association":"CONTRIBUTOR","body":"They looked like the one that Yannick just linked:\r\n\r\n```\r\n  2> Oct 18, 2018 3:14:40 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n  2> WARNING: Uncaught exception in thread: Thread[elasticsearch[node_td3][__mock_network_thread][T#11],5,TGRP-CreateIndexIT]\r\n  2> java.lang.OutOfMemoryError: Java heap space\r\n  2> \tat __randomizedtesting.SeedInfo.seed([8896DE14CA3FC96D]:0)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport.readMessage(MockTcpTransport.java:155)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport.access$800(MockTcpTransport.java:69)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport$MockChannel$2.lambda$doRun$0(MockTcpTransport.java:335)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport$MockChannel$2$$Lambda$2318/1903598586.run(Unknown Source)\r\n  2> \tat org.elasticsearch.common.util.CancellableThreads.executeIO(CancellableThreads.java:105)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport$MockChannel$2.doRun(MockTcpTransport.java:335)\r\n  2> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n  1> [2018-10-18T15:14:35,036][WARN ][o.e.t.d.TestZenDiscovery ] [node_tm2] not enough master nodes discovered during pinging (found [[Candidate{node={node_tm2}{yE_r74WFSE2wsscOhN9fNw}{a7UCF_URSVGq9hfHOgz40A}{127.0.0.1}{127.0.0.1:40624}, clusterStateVersion=-1}]], but needed [2]), pinging again\r\n  1> [2018-10-18T15:14:35,036][INFO ][o.e.t.d.MockZenPing      ] [node_tm2] pinging using mock zen ping\r\n  2> \tat java.lang.Thread.run(Thread.java:748)\r\n  2> Oct 18, 2018 3:14:40 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n  2> WARNING: Uncaught exception in thread: Thread[elasticsearch[node_td3][__mock_network_thread][T#14],5,TGRP-CreateIndexIT]\r\n  2> java.lang.OutOfMemoryError: Java heap space\r\n  2> \tat __randomizedtesting.SeedInfo.seed([8896DE14CA3FC96D]:0)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport.readMessage(MockTcpTransport.java:155)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport.access$800(MockTcpTransport.java:69)\r\n  1> [2018-10-18T15:14:35,036][INFO ][o.e.t.d.MockZenPing      ] [node_td3] pinging using mock zen ping\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport$MockChannel$2.lambda$doRun$0(MockTcpTransport.java:335)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport$MockChannel$2$$Lambda$2318/1903598586.run(Unknown Source)\r\n  1> [2018-10-18T15:14:35,036][WARN ][o.e.t.d.TestZenDiscovery ] [node_td3] not enough master nodes discovered during pinging (found [[Candidate{node={node_tm2}{yE_r74WFSE2wsscOhN9fNw}{a7UCF_URSVGq9hfHOgz40A}{127.0.0.1}{127.0.0.1:40624}, clusterStateVersion=-1}]], but needed [2]), pinging again\r\n  2> \tat org.elasticsearch.common.util.CancellableThreads.executeIO(CancellableThreads.java:105)\r\n  2> \tat org.elasticsearch.transport.MockTcpTransport$MockChannel$2.doRun(MockTcpTransport.java:335)\r\n  1> [2018-10-18T15:14:35,036][INFO ][o.e.t.d.MockZenPing      ] [node_td3] pinging using mock zen ping\r\n  2> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/433834524","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-433834524","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":433834524,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMzgzNDUyNA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-29T09:02:09Z","updated_at":"2018-10-29T09:02:09Z","author_association":"MEMBER","body":"https://github.com/elastic/infra/issues/7430 has now been merged so any heapdumps are uploaded to GCP if CI fails. \r\n\r\nIf you come across a build which has OOME'd, please check the uploaded heapdump to see whats dominating the heap","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437210009","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437210009","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437210009,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzIxMDAwOQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T00:48:16Z","updated_at":"2018-11-09T00:48:16Z","author_association":"CONTRIBUTOR","body":"We had a failure in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=fedora/47/\r\n\r\nI did a quick analysis of the [heap dump](https://storage.cloud.google.com/elasticsearch-ci-artifacts/jobs/elastic+elasticsearch+master+multijob-unix-compatibility/os=fedora/47/server/build/heapdump/java_pid3241.hprof).\r\n\r\nThe usage is clearly in 8 very large (50 million bytes) `byte[]` created by `MockTcpTransport.readMessage`.\r\ne.g.\r\n> The thread java.lang.Thread @ 0xf05dd0b0 elasticsearch[node_sd1][__mock_network_thread][T#8] keeps local variables with total size 50,399,752 (11.75%) bytes.\r\n>\r\n> The memory is accumulated in one instance of \"byte[]\" loaded by \"<system class loader>\".\r\n```\r\n\r\nelasticsearch[node_sd1][__mock_network_thread][T#8]\r\n  at java.net.SocketInputStream.socketRead0(Ljava/io/FileDescriptor;[BIII)I (Native Method)\r\n  at java.net.SocketInputStream.socketRead(Ljava/io/FileDescriptor;[BIII)I (SocketInputStream.java:116)\r\n  at java.net.SocketInputStream.read([BIII)I (SocketInputStream.java:171)\r\n  at java.net.SocketInputStream.read([BII)I (SocketInputStream.java:141)\r\n  at java.io.BufferedInputStream.read1([BII)I (BufferedInputStream.java:284)\r\n  at java.io.BufferedInputStream.read([BII)I (BufferedInputStream.java:345)\r\n  at org.elasticsearch.common.io.Streams.readFully(Ljava/io/InputStream;[BII)I (Streams.java:214)\r\n  at org.elasticsearch.common.io.stream.InputStreamStreamInput.readBytes([BII)V (InputStreamStreamInput.java:67)\r\n  at org.elasticsearch.common.io.stream.StreamInput.readFully([B)V (StreamInput.java:192)\r\n  at org.elasticsearch.transport.MockTcpTransport.readMessage(Lorg/elasticsearch/transport/MockTcpTransport$MockChannel;Lorg/elasticsearch/common/io/stream/StreamInput;)V (MockTcpTransport.java:155)\r\n  at org.elasticsearch.transport.MockTcpTransport.access$800(Lorg/elasticsearch/transport/MockTcpTransport;Lorg/elasticsearch/transport/MockTcpTransport$MockChannel;Lorg/elasticsearch/common/io/stream/StreamInput;)V (MockTcpTransport.java:69)\r\n  at org.elasticsearch.transport.MockTcpTransport$MockChannel$2.lambda$doRun$0(Lorg/elasticsearch/common/io/stream/StreamInput;)V (MockTcpTransport.java:334)\r\n  at org.elasticsearch.transport.MockTcpTransport$MockChannel$2$$Lambda$1476.run()V (Unknown Source)\r\n  at org.elasticsearch.common.util.CancellableThreads.executeIO(Lorg/elasticsearch/common/util/CancellableThreads$IOInterruptable;)V (CancellableThreads.java:106)\r\n  at org.elasticsearch.transport.MockTcpTransport$MockChannel$2.doRun()V (MockTcpTransport.java:334)\r\n  at org.elasticsearch.common.util.concurrent.AbstractRunnable.run()V (AbstractRunnable.java:37)\r\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(Ljava/util/concurrent/ThreadPoolExecutor$Worker;)V (ThreadPoolExecutor.java:1149)\r\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run()V (ThreadPoolExecutor.java:624)\r\n  at java.lang.Thread.run()V (Thread.java:748)\r\n```\r\n\r\n**[Histogram](https://github.com/elastic/elasticsearch/files/2564153/histogram.csv.txt)**\r\n```\r\nClass Name,Objects,Shallow Heap,Retained Heap,\r\nbyte[],2453,410076168,410076168,\r\njava.lang.Thread,124,14880,403746688,\r\njava.lang.Class,14387,112208,13161896,\r\nchar[],55506,7408016,7408016,\r\njava.lang.String,49448,1186752,5845880,\r\ncom.carrotsearch.ant.tasks.junit4.slave.SlaveMain,1,32,5244176,\r\njava.lang.Object[],9987,735976,4984312,\r\njava.util.HashMap,6053,290544,3235016,\r\njava.util.HashMap$Node[],2447,283248,3027384,\r\njava.util.HashMap$Node,15713,502816,2635448,\r\nsun.misc.Launcher$AppClassLoader,1,88,2593176,\r\norg.apache.lucene.analysis.standard.StandardTokenizerImpl,7,504,2241752,\r\njava.util.concurrent.ConcurrentHashMap,535,34240,2053952,\r\njava.util.concurrent.ConcurrentHashMap$Node[],332,243016,2029616,\r\njava.util.Vector,310,9920,1931568,\r\njava.util.Collections$UnmodifiableMap,885,28320,1895464,\r\njava.util.concurrent.ConcurrentHashMap$Node,27920,893440,1766048,\r\norg.elasticsearch.index.shard.IndexShard,7,1624,1331408,\r\norg.elasticsearch.index.IndexService,1,152,1310760,\r\norg.elasticsearch.index.engine.InternalEngine,7,1456,1195880,\r\njava.lang.invoke.MethodType,4248,169920,1192536,\r\norg.elasticsearch.common.cache.Cache,10,800,1039776,\r\norg.elasticsearch.common.cache.Cache$CacheSegment[],10,10400,1035200,\r\norg.elasticsearch.common.cache.Cache$CacheSegment,2560,81920,1024848,\r\norg.apache.lucene.index.DefaultIndexingChain,4,256,976120,\r\norg.elasticsearch.test.InternalTestCluster$NodeAndClient,3,120,895640,\r\norg.elasticsearch.common.inject.InjectorImpl,6,288,876080,\r\norg.elasticsearch.index.engine.InternalEngine$AssertingIndexWriter,7,1456,841320,\r\norg.elasticsearch.node.MockNode,3,192,787992,\r\n```\r\n\r\n**Byte Arrays**\r\n```\r\nClass Name                                                                                                 | Shallow Heap | Retained Heap\r\n-----------------------------------------------------------------------------------------------------------------------------------------\r\n                                                                                                           |              |              \r\nbyte[50390785] @ 0xf85989e8                                                                                |   50,390,808 |    50,390,808\r\n'- <Java Local> java.lang.Thread @ 0xf55814f8  elasticsearch[node_sd1][__mock_network_thread][T#15] Thread |          120 |    50,399,584\r\nbyte[50390785] @ 0xf5583a08                                                                                |   50,390,808 |    50,390,808\r\n'- <Java Local> java.lang.Thread @ 0xf3b9ada0  elasticsearch[node_sd1][__mock_network_thread][T#14] Thread |          120 |    50,399,584\r\nbyte[50390785] @ 0xf0b7be68                                                                                |   50,390,808 |    50,390,808\r\n'- <Java Local> java.lang.Thread @ 0xf0587e10  elasticsearch[node_sd1][__mock_network_thread][T#13] Thread |          120 |    50,399,584\r\nbyte[50390785] @ 0xed54c698                                                                                |   50,390,808 |    50,390,808\r\n'- <Java Local> java.lang.Thread @ 0xf0589038  elasticsearch[node_sd1][__mock_network_thread][T#11] Thread |          120 |    50,399,584\r\nbyte[50390785] @ 0xea53df80                                                                                |   50,390,808 |    50,390,808\r\n'- <Java Local> java.lang.Thread @ 0xf05dd3c0  elasticsearch[node_sd1][__mock_network_thread][T#12] Thread |          120 |    50,399,584\r\nbyte[50390785] @ 0xe75257d0                                                                                |   50,390,808 |    50,390,808\r\n'- <Java Local> java.lang.Thread @ 0xf05887d0  elasticsearch[node_sd1][__mock_network_thread][T#9] Thread  |          120 |    50,399,584\r\nbyte[50390785] @ 0xe45170b8                                                                                |   50,390,808 |    50,390,808\r\n'- <Java Local> java.lang.Thread @ 0xf0588228  elasticsearch[node_sd1][__mock_network_thread][T#10] Thread |          120 |    50,399,584\r\nbyte[50390785] @ 0xe14feb60                                                                                |   50,390,808 |    50,390,808\r\n'- <Java Local> java.lang.Thread @ 0xf05dd0b0  elasticsearch[node_sd1][__mock_network_thread][T#8] Thread  |          120 |    50,399,752\r\nbyte[5242880] @ 0xe03963c0                                                                                 |    5,242,896 |     5,242,896\r\nbyte[32768] @ 0xf0a95068                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf0a77c58                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf0a50958                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf0a01f98                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf09dcba8                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf09afb30                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf0979430                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf094bf38                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf092cc20                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf08d5f00                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf08b8298                                                                                   |       32,784 |        32,784\r\nbyte[32768] @ 0xf088bc80                                                                                   |       32,784 |        32,784\r\nbyte[18432] @ 0xf0a6a9b8                                                                                   |       18,448 |        18,448\r\nbyte[18432] @ 0xf09cf910                                                                                   |       18,448 |        18,448\r\nbyte[18432] @ 0xf0946c78                                                                                   |       18,448 |        18,448\r\nbyte[18432] @ 0xf08abab0                                                                                   |       18,448 |        18,448\r\nbyte[16384] @ 0xf071e5c0                                                                                   |       16,400 |        16,400\r\nbyte[16384] @ 0xf071a5b0                                                                                   |       16,400 |        16,400\r\nbyte[16384] @ 0xf07165a0                                                                                   |       16,400 |        16,400\r\nbyte[16384] @ 0xf0712590                                                                                   |       16,400 |        16,400\r\nTotal: 29 of 2,453 entries; 2,424 more                                                                     |              |              \r\n-----------------------------------------------------------------------------------------------------------------------------------------\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437210652","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437210652","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437210652,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzIxMDY1Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T00:51:39Z","updated_at":"2018-11-09T00:51:39Z","author_association":"MEMBER","body":"Thanks @tvernum!\r\n\r\n@original-brownbear @tbrooks8 Would you take a look?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437211498","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437211498","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437211498,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzIxMTQ5OA==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T00:56:20Z","updated_at":"2018-11-09T00:56:20Z","author_association":"CONTRIBUTOR","body":"Are there tests where we send 50 mb messages? The `MockTcpTransport` is pretty straightforward in the way that it allocates byte arrays that are the exact size of the incoming message.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437214071","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437214071","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437214071,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzIxNDA3MQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T01:09:45Z","updated_at":"2018-11-09T01:12:16Z","author_association":"CONTRIBUTOR","body":"I think this is caused by MockTcpTransport trying to read TLS streams.\r\n\r\nThe messages sizes are supposedly `50390785` which is [ `0x03` `0x00` `0xe7` `0x01` ]\r\nThe message size starts at the 3rd  bytes of the stream (there are 2 header bytes).\r\n\r\nWhich means if MockTcpTranports gets a TLS header of `16,3,3,0` it will read the first 2 bytes as the header, and then the 3,0 ... as the mesasge size.\r\n\r\nWe might just want to validate the header bytes before we read and allocate the message size? \r\n \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437215646","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437215646","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437215646,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzIxNTY0Ng==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T01:18:10Z","updated_at":"2018-11-09T01:18:10Z","author_association":"CONTRIBUTOR","body":"> I think this is caused by MockTcpTransport trying to read TLS streams.\r\n\r\nIsn't this kind of a problem? The `MockTcpTransport` does not support TLS. Shouldn't the test be using a different transport is we are doing TLS?\r\n\r\nAnyway, yeah I can throw an exception prior to the allocation in case the marker bytes are incorrect.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437216545","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437216545","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437216545,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzIxNjU0NQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T01:22:39Z","updated_at":"2018-11-09T01:22:39Z","author_association":"MEMBER","body":"I am confused, the tests reported in some of these failures are, for example, `CreateIndexIT`. Thereâ€™s no TLS there?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437217215","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437217215","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437217215,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzIxNzIxNQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T01:25:41Z","updated_at":"2018-11-09T01:25:41Z","author_association":"CONTRIBUTOR","body":"I may be totally wrong - I was just throwing out a guess at what would cause MockTcpTransport to be processing messages with such a crazy size. The byte arrangement looked suspicious to me.\r\n\r\nBut it could be a test that randomly generate really large messages.\r\nA header check would certainly help work out whether this is an invalid message or a just insanely  large one.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437219085","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437219085","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437219085,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzIxOTA4NQ==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T01:35:06Z","updated_at":"2018-11-09T01:35:50Z","author_association":"CONTRIBUTOR","body":"I opened a PR for checking the marker bytes early. Additionally, the PR uses recyclable `BigArrays` for `BytesStreamOutput`. This does not prevent the allocation fo 50 mb arrays for the low level reads. That would be more work (and more complicated).\r\n\r\nBefore we do that we might want to have a discussion if we want to continue to maintain a blocking (behaves differently than production) and non-blocking test:framework transport. Since we have both now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437291208","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-437291208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":437291208,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzI5MTIwOA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T08:48:38Z","updated_at":"2018-11-09T08:48:38Z","author_association":"CONTRIBUTOR","body":"> Before we do that we might want to have a discussion if we want to continue to maintain a blocking (behaves differently than production) and non-blocking test:framework transport. Since we have both now.\r\n\r\nI've added the team-discuss label here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/443622528","html_url":"https://github.com/elastic/elasticsearch/issues/34458#issuecomment-443622528","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34458","id":443622528,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MzYyMjUyOA==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2018-12-03T08:07:54Z","updated_at":"2018-12-03T08:07:54Z","author_association":"MEMBER","body":"Last week we had a discussion among the team whether to remove `MockTcpTransport` entirely and decided to do so. Tim has implemented the first step towards removal in https://github.com/elastic/elasticsearch/pull/36089.\r\n\r\nThis issue here is closed by https://github.com/elastic/elasticsearch/pull/35402.","performed_via_github_app":null}]