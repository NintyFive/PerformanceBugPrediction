[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/70169547","html_url":"https://github.com/elastic/elasticsearch/issues/9317#issuecomment-70169547","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9317","id":70169547,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMTY5NTQ3","user":{"login":"ebuildy","id":1219817,"node_id":"MDQ6VXNlcjEyMTk4MTc=","avatar_url":"https://avatars0.githubusercontent.com/u/1219817?v=4","gravatar_id":"","url":"https://api.github.com/users/ebuildy","html_url":"https://github.com/ebuildy","followers_url":"https://api.github.com/users/ebuildy/followers","following_url":"https://api.github.com/users/ebuildy/following{/other_user}","gists_url":"https://api.github.com/users/ebuildy/gists{/gist_id}","starred_url":"https://api.github.com/users/ebuildy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebuildy/subscriptions","organizations_url":"https://api.github.com/users/ebuildy/orgs","repos_url":"https://api.github.com/users/ebuildy/repos","events_url":"https://api.github.com/users/ebuildy/events{/privacy}","received_events_url":"https://api.github.com/users/ebuildy/received_events","type":"User","site_admin":false},"created_at":"2015-01-15T21:54:57Z","updated_at":"2015-01-15T21:54:57Z","author_association":"CONTRIBUTOR","body":"Try to use a single shard (in settings), sometimes there is trouble with several shards and a few documents.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/70246138","html_url":"https://github.com/elastic/elasticsearch/issues/9317#issuecomment-70246138","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9317","id":70246138,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjQ2MTM4","user":{"login":"kvspb","id":1138253,"node_id":"MDQ6VXNlcjExMzgyNTM=","avatar_url":"https://avatars3.githubusercontent.com/u/1138253?v=4","gravatar_id":"","url":"https://api.github.com/users/kvspb","html_url":"https://github.com/kvspb","followers_url":"https://api.github.com/users/kvspb/followers","following_url":"https://api.github.com/users/kvspb/following{/other_user}","gists_url":"https://api.github.com/users/kvspb/gists{/gist_id}","starred_url":"https://api.github.com/users/kvspb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kvspb/subscriptions","organizations_url":"https://api.github.com/users/kvspb/orgs","repos_url":"https://api.github.com/users/kvspb/repos","events_url":"https://api.github.com/users/kvspb/events{/privacy}","received_events_url":"https://api.github.com/users/kvspb/received_events","type":"User","site_admin":false},"created_at":"2015-01-16T12:17:39Z","updated_at":"2015-01-16T12:17:39Z","author_association":"NONE","body":"I temporarily  move category aggregation to nested aggregation, and have correct result, but i need a hierarchy of results with categories at the top.\n\n``` json\nGET test/product/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"property\": {\n      \"nested\": {\"path\": \"property\"},\n      \"aggs\": {\n        \"property_id\": {\n          \"terms\": {\"field\": \"property.id\",\"size\": 0},\n          \"aggs\": {\n            \"categories\": {\n              \"reverse_nested\": {},\n              \"aggs\": {\n                \"categories\": {\n                  \"terms\": {\"field\": \"categories\",\"size\": 0}\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nresult\n\n``` json\n...\n   \"aggregations\": {\n      \"property\": {\n         \"doc_count\": 6,\n         \"property_id\": {\n            \"doc_count_error_upper_bound\": 0,\n            \"sum_other_doc_count\": 0,\n            \"buckets\": [\n               {\n                  \"key\": 1,\n                  \"doc_count\": 2,\n                  \"categories\": {\n                     \"doc_count\": 2,\n                     \"categories\": {\n                        \"doc_count_error_upper_bound\": 0,\n                        \"sum_other_doc_count\": 0,\n                        \"buckets\": [\n                           {\n                              \"key\": 1,\n                              \"doc_count\": 2\n                           },\n                           {\n                              \"key\": 2,\n                              \"doc_count\": 2\n                           },\n                           {\n                              \"key\": 3,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 4,\n                              \"doc_count\": 1\n                           }\n                        ]\n                     }\n                  }\n               },\n               {\n                  \"key\": 2,\n                  \"doc_count\": 1,\n                  \"categories\": {\n                     \"doc_count\": 1,\n                     \"categories\": {\n                        \"doc_count_error_upper_bound\": 0,\n                        \"sum_other_doc_count\": 0,\n                        \"buckets\": [\n                           {\n                              \"key\": 1,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 2,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 3,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 4,\n                              \"doc_count\": 1\n                           }\n                        ]\n                     }\n                  }\n               },\n               {\n                  \"key\": 3,\n                  \"doc_count\": 1,\n                  \"categories\": {\n                     \"doc_count\": 1,\n                     \"categories\": {\n                        \"doc_count_error_upper_bound\": 0,\n                        \"sum_other_doc_count\": 0,\n                        \"buckets\": [\n                           {\n                              \"key\": 1,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 2,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 3,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 4,\n                              \"doc_count\": 1\n                           }\n                        ]\n                     }\n                  }\n               },\n               {\n                  \"key\": 4,\n                  \"doc_count\": 1,\n                  \"categories\": {\n                     \"doc_count\": 1,\n                     \"categories\": {\n                        \"doc_count_error_upper_bound\": 0,\n                        \"sum_other_doc_count\": 0,\n                        \"buckets\": [\n                           {\n                              \"key\": 1,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 2,\n                              \"doc_count\": 1\n                           }\n                        ]\n                     }\n                  }\n               },\n               {\n                  \"key\": 5,\n                  \"doc_count\": 1,\n                  \"categories\": {\n                     \"doc_count\": 1,\n                     \"categories\": {\n                        \"doc_count_error_upper_bound\": 0,\n                        \"sum_other_doc_count\": 0,\n                        \"buckets\": [\n                           {\n                              \"key\": 1,\n                              \"doc_count\": 1\n                           },\n                           {\n                              \"key\": 2,\n                              \"doc_count\": 1\n                           }\n                        ]\n                     }\n                  }\n               }\n            ]\n         }\n      }\n   }\n...\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/70250151","html_url":"https://github.com/elastic/elasticsearch/issues/9317#issuecomment-70250151","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9317","id":70250151,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjUwMTUx","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-01-16T12:59:28Z","updated_at":"2015-01-16T12:59:28Z","author_association":"MEMBER","body":"@kvspb Thanks for reporting, this is indeed a bug.\n","performed_via_github_app":null}]