{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26944","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26944/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26944/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26944/events","html_url":"https://github.com/elastic/elasticsearch/issues/26944","id":264216779,"node_id":"MDU6SXNzdWUyNjQyMTY3Nzk=","number":26944,"title":"Inner hits _source is now always wrapped in path to parent","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-10-10T12:54:55Z","updated_at":"2018-02-14T13:26:29Z","closed_at":"2017-10-19T10:06:42Z","author_association":"MEMBER","active_lock_reason":null,"body":"Prior to 6.x the `_source` of an inner hit was always rooted to the child object that you were referencing. \r\n\r\nGiven the following super simple document where `children` is `nested`\r\n\r\n```json\r\nPOST /sample/doc\r\n{\r\n  \"children\": [\r\n    {\r\n      \"startTime\": 37230000000,\r\n      \"endTime\": 73840000000\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nThe inner hits for `children` used to look like this:\r\n\r\n```\r\n\"_source\" : {\r\n  \"startTime\" : 37230000000,\r\n  \"endTime\" : 73840000000\r\n}\r\n```\r\n\r\nNow in 6.x the context of source has changed the root of the child. Note the additional `children` key. If it was N levels deep the actual source of the inner hit would be N levels deep too.\r\n\r\n```json\r\n\"_source\" : {\r\n  \"children\" : {\r\n   \"startTime\" : 37230000000,\r\n   \"endTime\" : 73840000000\r\n  }\r\n}\r\n```\r\n\r\nThis changes a lot of code that assumes the current context of the inner hit is inner hit and not the root of the document. \r\n\r\nAnother side effect is that the returned inner hit `_source` json, that is now rooted to the original `doc`, can no longer be mapped back into the `doc` type because `children` no longer is an array.\r\n\r\nSo now `_source` neither maps back to the original `doc` nor `child` and always acts as if it was source filtered.\r\n\r\nI spoke with @martijnvg and I realize this change relates to:\r\n\r\nhttps://github.com/elastic/elasticsearch/issues/23090\r\nhttps://github.com/elastic/elasticsearch/issues/16653\r\n\r\nWhich I am 100% behind, full paths should be specified always. I don't agree with the way these changes changed the way `_source` is presented back to user though. \r\n\r\ncc @elastic/es-clients \r\n\r\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}