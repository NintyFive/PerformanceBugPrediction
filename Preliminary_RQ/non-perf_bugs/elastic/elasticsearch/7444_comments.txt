[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53390155","html_url":"https://github.com/elastic/elasticsearch/issues/7444#issuecomment-53390155","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7444","id":53390155,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMzkwMTU1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-08-26T08:30:25Z","updated_at":"2014-08-26T08:30:25Z","author_association":"CONTRIBUTOR","body":"@bly2k i don't think that we should prevent access to other fields when a `field` is specified.  What if you want to compare the current `_value` with the value of another field in the doc?\n\nThe difference is that when you specify a `field`, the `script` gets called once for every value that field contains, but without a field, it just gets called once.  This is by design.\n\nWhere do the docs say that a value script should **only** be able to work on the `_value`? If they do say that, then the docs should be changed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53403492","html_url":"https://github.com/elastic/elasticsearch/issues/7444#issuecomment-53403492","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7444","id":53403492,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDAzNDky","user":{"login":"bly2k","id":3187614,"node_id":"MDQ6VXNlcjMxODc2MTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/3187614?v=4","gravatar_id":"","url":"https://api.github.com/users/bly2k","html_url":"https://github.com/bly2k","followers_url":"https://api.github.com/users/bly2k/followers","following_url":"https://api.github.com/users/bly2k/following{/other_user}","gists_url":"https://api.github.com/users/bly2k/gists{/gist_id}","starred_url":"https://api.github.com/users/bly2k/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bly2k/subscriptions","organizations_url":"https://api.github.com/users/bly2k/orgs","repos_url":"https://api.github.com/users/bly2k/repos","events_url":"https://api.github.com/users/bly2k/events{/privacy}","received_events_url":"https://api.github.com/users/bly2k/received_events","type":"User","site_admin":false},"created_at":"2014-08-26T10:51:56Z","updated_at":"2014-08-26T10:51:56Z","author_association":"CONTRIBUTOR","body":"@clintongormley Maybe you're right I'm just reading the docs incorrectly:\n\nhttp://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations.html#_values_source\n\n\"When both field and script settings are configured for the aggregation, the script will be treated as a value script. While normal scripts are evaluated on a document level (i.e. the script has access to all the data associated with the document), value scripts are evaluated on the value level. In this mode, the values are extracted from the configured field and the script is used to apply a \"transformation\" over these value/s.\"\n\nRegardless, something needs to be corrected, either doc, or code (since the code produces inconsistent results). :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53404190","html_url":"https://github.com/elastic/elasticsearch/issues/7444#issuecomment-53404190","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7444","id":53404190,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDA0MTkw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-08-26T11:00:14Z","updated_at":"2014-08-26T11:00:14Z","author_association":"CONTRIBUTOR","body":"Why do you say the code produces inconsistent results? If I run this in master, both of them give me a sum of 6, which is what I'd expect.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53404268","html_url":"https://github.com/elastic/elasticsearch/issues/7444#issuecomment-53404268","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7444","id":53404268,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDA0MjY4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-08-26T11:01:22Z","updated_at":"2014-08-26T11:01:22Z","author_association":"CONTRIBUTOR","body":"And those docs seem consistent with the behaviour (and the intended behaviour)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53405288","html_url":"https://github.com/elastic/elasticsearch/issues/7444#issuecomment-53405288","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7444","id":53405288,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDA1Mjg4","user":{"login":"bly2k","id":3187614,"node_id":"MDQ6VXNlcjMxODc2MTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/3187614?v=4","gravatar_id":"","url":"https://api.github.com/users/bly2k","html_url":"https://github.com/bly2k","followers_url":"https://api.github.com/users/bly2k/followers","following_url":"https://api.github.com/users/bly2k/following{/other_user}","gists_url":"https://api.github.com/users/bly2k/gists{/gist_id}","starred_url":"https://api.github.com/users/bly2k/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bly2k/subscriptions","organizations_url":"https://api.github.com/users/bly2k/orgs","repos_url":"https://api.github.com/users/bly2k/repos","events_url":"https://api.github.com/users/bly2k/events{/privacy}","received_events_url":"https://api.github.com/users/bly2k/received_events","type":"User","site_admin":false},"created_at":"2014-08-26T11:14:38Z","updated_at":"2014-08-26T11:14:38Z","author_association":"CONTRIBUTOR","body":"@clintongormley that's correct. However, if you run the example in ES 1.2.3 (or anything older than 1.3), the first search query will fail, and the second query will succeed. At first I thought i was a bug that was fixed in 1.3 and I asked @jpountz and he said there was a refactoring in 1.3 that \"accidentally/silently\" made this work all the time. \n\nSo it's either a bug prior to 1.3 that was (accidentally) fixed in 1.3, or, it's a new bug that was introduced in 1.3 (breaking the old behavior). Either way could be right - we just pick one.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53418599","html_url":"https://github.com/elastic/elasticsearch/issues/7444#issuecomment-53418599","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7444","id":53418599,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDE4NTk5","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-08-26T13:19:44Z","updated_at":"2014-08-26T13:19:44Z","author_association":"CONTRIBUTOR","body":"The bug was in pre-1.3.  They're now working as they were intended.\n","performed_via_github_app":null}]