{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57864","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57864/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57864/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57864/events","html_url":"https://github.com/elastic/elasticsearch/issues/57864","id":635218930,"node_id":"MDU6SXNzdWU2MzUyMTg5MzA=","number":57864,"title":"retention lease background sync failed after deleting index","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"},{"id":1789304462,"node_id":"MDU6TGFiZWwxNzg5MzA0NDYy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.7.0","name":"v7.7.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"fcofdez","id":1033457,"node_id":"MDQ6VXNlcjEwMzM0NTc=","avatar_url":"https://avatars1.githubusercontent.com/u/1033457?v=4","gravatar_id":"","url":"https://api.github.com/users/fcofdez","html_url":"https://github.com/fcofdez","followers_url":"https://api.github.com/users/fcofdez/followers","following_url":"https://api.github.com/users/fcofdez/following{/other_user}","gists_url":"https://api.github.com/users/fcofdez/gists{/gist_id}","starred_url":"https://api.github.com/users/fcofdez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fcofdez/subscriptions","organizations_url":"https://api.github.com/users/fcofdez/orgs","repos_url":"https://api.github.com/users/fcofdez/repos","events_url":"https://api.github.com/users/fcofdez/events{/privacy}","received_events_url":"https://api.github.com/users/fcofdez/received_events","type":"User","site_admin":false},"assignees":[{"login":"fcofdez","id":1033457,"node_id":"MDQ6VXNlcjEwMzM0NTc=","avatar_url":"https://avatars1.githubusercontent.com/u/1033457?v=4","gravatar_id":"","url":"https://api.github.com/users/fcofdez","html_url":"https://github.com/fcofdez","followers_url":"https://api.github.com/users/fcofdez/followers","following_url":"https://api.github.com/users/fcofdez/following{/other_user}","gists_url":"https://api.github.com/users/fcofdez/gists{/gist_id}","starred_url":"https://api.github.com/users/fcofdez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fcofdez/subscriptions","organizations_url":"https://api.github.com/users/fcofdez/orgs","repos_url":"https://api.github.com/users/fcofdez/repos","events_url":"https://api.github.com/users/fcofdez/events{/privacy}","received_events_url":"https://api.github.com/users/fcofdez/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-06-09T08:26:41Z","updated_at":"2020-06-16T08:55:57Z","closed_at":"2020-06-16T08:55:57Z","author_association":"MEMBER","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.7.0\r\n\r\n**Plugins installed**: [`repository-s3`]\r\n\r\n**JVM version** (`java -version`): bundled (i.e. 14)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): `Linux/4.15.0-1058-aws/amd64`\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen deleting an index which contains data (in our case it was 100GB large), we see the following exception trace:\r\n\r\n```\r\n[2020-06-09T07:27:37,710][INFO ][o.e.c.m.MetaDataDeleteIndexService] [elasticsearch-0] [elasticlogs-2020-01-01/5MAgXrFzTkaB3sILV7dqsA] deleting index\r\n[2020-06-09T07:27:42,199][WARN ][o.e.i.s.RetentionLeaseSyncAction] [elasticsearch-0] [elasticlogs-2020-01-01][3] retention lease background sync failed\r\norg.elasticsearch.transport.RemoteTransportException: [elasticsearch-0][10.10.1.56:9300][indices:admin/seq_no/retention_lease_background_sync[p]]\r\nCaused by: org.elasticsearch.index.IndexNotFoundException: no such index [elasticlogs-2020-01-01]\r\n        at org.elasticsearch.indices.IndicesService.indexServiceSafe(IndicesService.java:504) ~[elasticsearch-7.7.0.jar:7.7.0]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction.getIndexShard(TransportReplicationAction.java:591) ~[elasticsearch-7.7.0.jar:7.7.0]\r\n[...]\r\n```\r\n\r\nWhile it is harmless that the retention lease background sync fails for an index that has just been deleted, the expectation is that the retention lease background sync is cancelled when the index is deleted (or it does not have any issues when the index is deleted).\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Create an index with data in it (in our case it was 100GB large)\r\n2. Delete the index\r\n3. Observe the retention lease background sync failing in the logs\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n[Full log file](https://github.com/elastic/elasticsearch/files/4750806/node.log) attached.","closed_by":{"login":"fcofdez","id":1033457,"node_id":"MDQ6VXNlcjEwMzM0NTc=","avatar_url":"https://avatars1.githubusercontent.com/u/1033457?v=4","gravatar_id":"","url":"https://api.github.com/users/fcofdez","html_url":"https://github.com/fcofdez","followers_url":"https://api.github.com/users/fcofdez/followers","following_url":"https://api.github.com/users/fcofdez/following{/other_user}","gists_url":"https://api.github.com/users/fcofdez/gists{/gist_id}","starred_url":"https://api.github.com/users/fcofdez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fcofdez/subscriptions","organizations_url":"https://api.github.com/users/fcofdez/orgs","repos_url":"https://api.github.com/users/fcofdez/repos","events_url":"https://api.github.com/users/fcofdez/events{/privacy}","received_events_url":"https://api.github.com/users/fcofdez/received_events","type":"User","site_admin":false},"performed_via_github_app":null}