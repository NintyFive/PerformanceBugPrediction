[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28004497","html_url":"https://github.com/elastic/elasticsearch/issues/4123#issuecomment-28004497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4123","id":28004497,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDA0NDk3","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T20:43:40Z","updated_at":"2013-11-07T20:43:40Z","author_association":"MEMBER","body":"The tricky bit here is that you have two fields, `category.name` and `type.name`, both configured as `\"path\":\"just_name\"`. As a result, they get collapsed and merged into the same lucene field, called `name`. \n\nThis is problematic when making highlighting based on the additional information stored in the index, compared to using the plain highlighter that just re-analyzes the text on-the-fly. In fact the content of the field is loaded from the `_source` field, but the offsets relate to a bigger field, which leads to wrong snippets. Exactly the same happens with the fast vector highlighter.\n\nA workaround would be to configure those fields as `\"store\":\"yes\"`. Then the content would be loaded from the same lucene field and the offsets would match, but you would get snippets coming from both the json fields.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28005350","html_url":"https://github.com/elastic/elasticsearch/issues/4123#issuecomment-28005350","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4123","id":28005350,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDA1MzUw","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T20:53:59Z","updated_at":"2013-11-07T20:53:59Z","author_association":"MEMBER","body":"Even better, if you do need to collapse those fields into the same lucene field, I'd suggest to use a `multi_field` and keep a variation of the field with a unique name so that the `just_name` won't be a problem and you can highlight against it.\n\nYou could for instance have the following `category.name` multi_field with the `hl` variation that has a unique name (actually the full_path set through the `index_name`) :\n\n```\n{\n    \"category\" : {\n        \"name\" : {\n            \"type\":\"multi_field\",\n            \"path\":\"just_name\",\n            \"fields\" : {\n                \"name\" : {\"type\":\"string\"},\n                \"hl\":{\"type\":\"string\",\"index_name\":\"category.name.hl\"}\n            }\n        }\n    }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28007567","html_url":"https://github.com/elastic/elasticsearch/issues/4123#issuecomment-28007567","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4123","id":28007567,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDA3NTY3","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T21:21:33Z","updated_at":"2013-11-07T21:21:33Z","author_association":"NONE","body":"I do not know lucene internals but from ES search API perspective name field is not collapsed into one field across type and category properties and can be searched independently from each other. \nI always assumed their lucene name is their full name (type.name and category.name) just like if i did not use just_name since they are the primary fields of  multifield mappings (their field name matches  property name)\n\nthe quick test shows that what you say is correct and primary field 'name' in my case acts no different than 'all' field in my mapping which i intended to COLLAPSE \n\nIf ES does not expand primary field name  to full path, than the whole concept of multi_field is flawed! All ES examples virtually imply that it is not so\n\nI am already using full path name for parts of multifield that I do not want to collapse but I thought the primary fields will be different. I will have to switch to using full path for all field of multifields  that i do not intend to collapse - what a pain\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28016514","html_url":"https://github.com/elastic/elasticsearch/issues/4123#issuecomment-28016514","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4123","id":28016514,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDE2NTE0","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T23:12:25Z","updated_at":"2013-11-07T23:12:25Z","author_association":"NONE","body":"i switched to unique index_name for all primary fields in multifield mapping and highlighting seem to work now \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28016627","html_url":"https://github.com/elastic/elasticsearch/issues/4123#issuecomment-28016627","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4123","id":28016627,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDE2NjI3","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T23:14:23Z","updated_at":"2013-11-07T23:14:32Z","author_association":"MEMBER","body":"Cool, thanks for your feedback @roytmana !\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28017166","html_url":"https://github.com/elastic/elasticsearch/issues/4123#issuecomment-28017166","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4123","id":28017166,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDE3MTY2","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T23:22:34Z","updated_at":"2013-11-07T23:22:34Z","author_association":"NONE","body":"phew I spent way too much time on highlighting :-)\n\nI still feel that the way multifield handles primary fields is totally counter-intuitive \nat least docs for the multifield should stress using of index_name to ensure its uniqueness\n\nshould I close the issue since it is consistent with current behavior of the primary multifield or you are going to research moret?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28052779","html_url":"https://github.com/elastic/elasticsearch/issues/4123#issuecomment-28052779","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4123","id":28052779,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDUyNzc5","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2013-11-08T10:12:42Z","updated_at":"2013-11-08T10:12:42Z","author_association":"MEMBER","body":"The problem is not related to `multi_field` itself, you perfectly got how `multi_field` works. \n\nThe issue happens when you use `\"path\":\"just_name\"` or the same `index_name` for different fields. The way `index_name` and `\"path\":\"just_name\"` work is described [here](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-object-type.html#_path_3), maybe we can improve the docs there, although there is an example that describes what happens under the hood.\n\nAs for this issue, I don't see a way to fix it unfortunately, but we can leave it open for now so that people know this is actually a problem. What we could do is try to at least not provide snippets (or return an error?) instead of returning wrong snippets, but that wouldn't fix the problem anyway.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48467197","html_url":"https://github.com/elastic/elasticsearch/issues/4123#issuecomment-48467197","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4123","id":48467197,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDY3MTk3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-09T13:09:58Z","updated_at":"2014-07-09T13:09:58Z","author_association":"CONTRIBUTOR","body":"`path` has been removed, so this should no longer be an issue. Closing\n","performed_via_github_app":null}]