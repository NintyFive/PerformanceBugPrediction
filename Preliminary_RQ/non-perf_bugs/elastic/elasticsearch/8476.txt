{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8476","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8476/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8476/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8476/events","html_url":"https://github.com/elastic/elasticsearch/issues/8476","id":48686888,"node_id":"MDU6SXNzdWU0ODY4Njg4OA==","number":8476,"title":"CircuitBreakingException occurs without plausible reasons","user":{"login":"aaneja","id":1797669,"node_id":"MDQ6VXNlcjE3OTc2Njk=","avatar_url":"https://avatars2.githubusercontent.com/u/1797669?v=4","gravatar_id":"","url":"https://api.github.com/users/aaneja","html_url":"https://github.com/aaneja","followers_url":"https://api.github.com/users/aaneja/followers","following_url":"https://api.github.com/users/aaneja/following{/other_user}","gists_url":"https://api.github.com/users/aaneja/gists{/gist_id}","starred_url":"https://api.github.com/users/aaneja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aaneja/subscriptions","organizations_url":"https://api.github.com/users/aaneja/orgs","repos_url":"https://api.github.com/users/aaneja/repos","events_url":"https://api.github.com/users/aaneja/events{/privacy}","received_events_url":"https://api.github.com/users/aaneja/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2014-11-13T20:20:10Z","updated_at":"2014-11-24T19:03:29Z","closed_at":"2014-11-14T08:54:44Z","author_association":"NONE","active_lock_reason":null,"body":"I saw a CircuitBreakingException when running the following query yesterday:\n`{\"size\":1,\"query\":{\"filtered\":{\"filter\":{\"bool\":{\"must\":[{\"term\":{\"<string field>\":\"<string>\"}},{\"range\":{\"<date field>\":{\"gte\":\"2014-10-20\",\"lte\":\"2014-10-21\"}}}]}}}},\"aggs\":{\"1\":{\"value_count\":{\"field\":\"request.count\"}}}}`\n\nrequest.count is a long field.\n(FYI : The same query without any aggs does not match any documents.)\n\nResponse :\n`{\"error\":\"SearchPhaseExecutionException[Failed to execute phase [query_fetch], all shards failed; shardFailures {[G6x3HS9FTnidgrGxRG4U_g][rollup-2014-10-20][5]: RemoteTransportException[[<node name>][inet[/10.0.64.113:9300]][search/phase/query+fetch]]; nested: ElasticsearchException[org.elasticsearch.common.breaker.CircuitBreakingException: Data too large, data for field [request.count] would be larger than limit of [11998016307/11.1gb]]; nested: UncheckedExecutionException[org.elasticsearch.common.breaker.CircuitBreakingException: Data too large, data for field [request.count] would be larger than limit of [11998016307/11.1gb]]; nested: CircuitBreakingException[Data too large, data for field [request.count] would be larger than limit of [11998016307/11.1gb]]; }]\",\"status\":500}`\n\nWhen I re-ran this query today, it took really long (148s) and returned without errors with the expected response.\nMarvel tells me that the fielddata size went up by 300 megabytes.\nI checked node stats and all the nodes where this index lives are 7-8 gig.\n\nMy question is why did the breaker hit yesterday given that the aggs was a simple value_count over a long field ? \nI'll be happy to include more logs if someone can tell me where to look for them.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}