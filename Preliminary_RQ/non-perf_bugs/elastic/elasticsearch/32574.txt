{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32574","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32574/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32574/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32574/events","html_url":"https://github.com/elastic/elasticsearch/issues/32574","id":346890139,"node_id":"MDU6SXNzdWUzNDY4OTAxMzk=","number":32574,"title":"Multi-node integration tests do not log node IDs correctly","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"labels":[{"id":151561891,"node_id":"MDU6TGFiZWwxNTE1NjE4OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Logging","name":":Core/Infra/Logging","color":"0e8a16","default":false,"description":"Log management and logging utilities"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2018-08-02T07:23:55Z","updated_at":"2019-02-07T08:24:29Z","closed_at":"2018-08-20T17:53:16Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Digging into \r\nhttps://github.com/elastic/elasticsearch/issues/32552 was made a little trickier by the lack of the correct node name in a few log messages. The log excerpt below has examples of all the cases of this that I think I encountered. I think this was introduced in #31588.\r\n\r\n```\r\n  1> [2018-08-01T06:44:59,262][INFO ][o.e.n.Node               ] [testMultipleNodesShutdownNonMasterNodes] closed\r\n  1> [2018-08-01T06:44:59,263][INFO ][o.e.n.Node               ] [testMultipleNodesShutdownNonMasterNodes] stopping ...\r\n  1> [2018-08-01T06:44:59,263][DEBUG][o.e.t.d.TestZenDiscovery ] [node_t1] filtered ping responses: (ignore_non_masters [false])\r\n  1> \t--> ping_response{node [{node_t1}{N7pZoArIQkagoOjazUUnpg}{CHz8p-1ZSWK6x_N0-Frh7Q}{127.0.0.1}{127.0.0.1:36663}], id[1831], master [null],cluster_state_version [9], cluster_name[TEST-CHILD_VM=[1]-CLUSTER_SEED=[4742294414363736227]-HASH=[181D1FE4F82A7D]-cluster]}\r\n  1> [2018-08-01T06:44:59,263][WARN ][o.e.t.d.TestZenDiscovery ] [node_t1] not enough master nodes discovered during pinging (found [[Candidate{node={node_t1}{N7pZoArIQkagoOjazUUnpg}{CHz8p-1ZSWK6x_N0-Frh7Q}{127.0.0.1}{127.0.0.1:36663}, clusterStateVersion=9}]], but needed [3]), pinging again\r\n  1> [2018-08-01T06:44:59,266][DEBUG][o.e.i.IndicesService     ] [[indices_shutdown[T#1]]] [test] closing ... (reason [NO_LONGER_ASSIGNED])\r\n  1> [2018-08-01T06:44:59,266][DEBUG][o.e.i.IndicesService     ] [[indices_shutdown[T#1]]] [test/xM1OBH02QE2z4aIJH9p5Ug] closing index service (reason [NO_LONGER_ASSIGNED][shutdown])\r\n  1> [2018-08-01T06:44:59,266][DEBUG][o.e.i.IndexService       ] [[indices_shutdown[T#1]]] [test] [3] closing... (reason: [shutdown])\r\n  1> [2018-08-01T06:44:59,266][DEBUG][o.e.i.s.IndexShard       ] [[indices_shutdown[T#1]]] [test][3] state: [STARTED]->[CLOSED], reason [shutdown]\r\n  1> [2018-08-01T06:44:59,266][DEBUG][o.e.i.e.Engine           ] [[indices_shutdown[T#1]]] [test][3] flushing shard on close - this might take some time to sync files to disk\r\n  1> [2018-08-01T06:44:59,266][DEBUG][o.e.i.e.Engine           ] [[indices_shutdown[T#1]]] [test][3] close now acquiring writeLock\r\n  1> [2018-08-01T06:44:59,266][DEBUG][o.e.i.e.Engine           ] [[indices_shutdown[T#1]]] [test][3] close acquired writeLock\r\n  1> [2018-08-01T06:44:59,266][DEBUG][o.e.i.t.Translog         ] [[indices_shutdown[T#1]]] [test][3] translog closed\r\n  1> [2018-08-01T06:44:59,267][DEBUG][o.e.i.e.Engine           ] [[indices_shutdown[T#1]]] [test][3] engine closed [api]\r\n  1> [2018-08-01T06:44:59,267][DEBUG][o.e.i.s.Store            ] [[indices_shutdown[T#1]]] [test][3] store reference count on close: 0\r\n  1> [2018-08-01T06:44:59,267][DEBUG][o.e.i.IndexService       ] [[indices_shutdown[T#1]]] [test] [3] closed (reason: [shutdown])\r\n  1> [2018-08-01T06:44:59,267][DEBUG][o.e.i.c.b.BitsetFilterCache] [[indices_shutdown[T#1]]] [test] clearing all bitsets because [close]\r\n  1> [2018-08-01T06:44:59,267][DEBUG][o.e.i.c.q.IndexQueryCache] [[indices_shutdown[T#1]]] [test] full cache clear, reason [close]\r\n  1> [2018-08-01T06:44:59,267][DEBUG][o.e.i.c.b.BitsetFilterCache] [[indices_shutdown[T#1]]] [test] clearing all bitsets because [close]\r\n  1> [2018-08-01T06:44:59,267][DEBUG][o.e.i.IndicesService     ] [[indices_shutdown[T#1]]] [test/xM1OBH02QE2z4aIJH9p5Ug] closed... (reason [NO_LONGER_ASSIGNED][shutdown])\r\n  1> [2018-08-01T06:44:59,267][INFO ][o.e.n.Node               ] [testMultipleNodesShutdownNonMasterNodes] stopped\r\n  1> [2018-08-01T06:44:59,267][INFO ][o.e.n.Node               ] [testMultipleNodesShutdownNonMasterNodes] closing ...\r\n  1> [2018-08-01T06:44:59,269][INFO ][o.e.n.Node               ] [testMultipleNodesShutdownNonMasterNodes] closed\r\n  1> [2018-08-01T06:44:59,269][INFO ][o.e.c.MinimumMasterNodesIT] [testMultipleNodesShutdownNonMasterNodes] after test\r\n```","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}