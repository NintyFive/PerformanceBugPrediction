[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265195006","html_url":"https://github.com/elastic/elasticsearch/issues/22002#issuecomment-265195006","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22002","id":265195006,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTE5NTAwNg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2016-12-06T16:22:03Z","updated_at":"2016-12-06T16:22:03Z","author_association":"CONTRIBUTOR","body":"There is another offender I think: Upon primary relocation (which can be done from an old to a new node), there is a short period in time during relocation handoff where the relocation target (on a newer node) replicates back to the relocation source (on an older node). /cc: @bleskes ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265242933","html_url":"https://github.com/elastic/elasticsearch/issues/22002#issuecomment-265242933","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22002","id":265242933,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTI0MjkzMw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-12-06T19:11:32Z","updated_at":"2016-12-06T19:11:32Z","author_association":"MEMBER","body":">  the newly promoted primary might use a new postings format or codec that is not available on the replication target nodes.\r\n\r\nNote that is currently OK as it is only relevant when doing a recovery. However we want to make this rule stricter so it will apply at all times (and use it for other stuff).\r\n\r\n>  Upon primary relocation (which can be done from an old to a new node), there is a short period in time during relocation handoff where the relocation target (on a newer node) replicates back to the relocation source (on an older node).\r\n\r\nThat's a good one. I think the period is longer though - one the primary has relocated from old to new we can end up in a situation that other replicas are on old for a long time. That part is solvable by preventing relocation of primaries from old to new if there is another replica on an old node (which will mean move the replicas first).   However the scenario you describe still holds - and it gets messy. Something to think about - I don't see an immediate solution .\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312231109","html_url":"https://github.com/elastic/elasticsearch/issues/22002#issuecomment-312231109","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22002","id":312231109,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjIzMTEwOQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-06-30T10:16:15Z","updated_at":"2017-06-30T10:16:15Z","author_association":"CONTRIBUTOR","body":"Replication from a newer node to an older node is ok, and difficult to avoid (e.g. primary relocation during rolling restart). The recovery is avoided as when then old primary fails, all initializing shards are failed as well. ","performed_via_github_app":null}]