{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/56258","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56258/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56258/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56258/events","html_url":"https://github.com/elastic/elasticsearch/issues/56258","id":612986245,"node_id":"MDU6SXNzdWU2MTI5ODYyNDU=","number":56258,"title":"SearchRequest cancellation based on timeout","user":{"login":"sohami","id":22159459,"node_id":"MDQ6VXNlcjIyMTU5NDU5","avatar_url":"https://avatars1.githubusercontent.com/u/22159459?v=4","gravatar_id":"","url":"https://api.github.com/users/sohami","html_url":"https://github.com/sohami","followers_url":"https://api.github.com/users/sohami/followers","following_url":"https://api.github.com/users/sohami/following{/other_user}","gists_url":"https://api.github.com/users/sohami/gists{/gist_id}","starred_url":"https://api.github.com/users/sohami/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sohami/subscriptions","organizations_url":"https://api.github.com/users/sohami/orgs","repos_url":"https://api.github.com/users/sohami/repos","events_url":"https://api.github.com/users/sohami/events{/privacy}","received_events_url":"https://api.github.com/users/sohami/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":1967498216,"node_id":"MDU6TGFiZWwxOTY3NDk4MjE2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Search","name":"Team:Search","color":"fef2c0","default":false,"description":"Meta label for search team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-05-06T01:06:46Z","updated_at":"2020-05-12T08:03:17Z","closed_at":"2020-05-12T08:03:17Z","author_association":"NONE","active_lock_reason":null,"body":"### Feature request\r\n\r\nIn **ES-7.4 version**, support for cancelling a search request when the client connection is closed is added. Also the current **timeout** parameter in the search request is not the request level timeout, instead it is checked at shard level search request of each batch. A search request on a coordinator can span to multiple batches of `ShardSearchTransportRequest` when `throttleConcurrentRequest` is enabled. This means when there are 2 such batches, then timeout will be applied separately on the shard request in these 2 batches and actual request may end up timing out after 2 x timeout parameter value. For an index with large shard count, the number of batches can be higher and the request will timeout after long delay. \r\n\r\nI am wondering if we can provide a new search request parameter which can be enforced at the parent request level (e.g. `cancel_after_timeinterval`), such that after expiry it will cancel the search request. This will be helpful for cases where the connection is still alive but user is running a large resource hungry search and doesn't wait until completion. With the new parameter which can be set at request level, user can set it as per their workload/use-case and if query doesn't complete by then, it will be cancelled in the backend. This will help to save the unnecessary resource the query was consuming for which user is not interested in the results anymore. \r\nAlso there can be a cluster level parameter for this as well such that if a user is not willing to set it at per request then the cluster level parameter can be used to cancel all the search request (if set) after the timeout. Order of precedence will be:  **requestParameter > clusterParameter**. If none of the parameters are set then behavior will fallback to what it is today.\r\n\r\nPlease let me know your thoughts about this new feature.\r\n\r\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}