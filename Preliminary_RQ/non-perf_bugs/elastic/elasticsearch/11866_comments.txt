[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115174469","html_url":"https://github.com/elastic/elasticsearch/issues/11866#issuecomment-115174469","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11866","id":115174469,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTE3NDQ2OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-25T09:03:00Z","updated_at":"2015-06-25T09:03:00Z","author_association":"CONTRIBUTOR","body":"Hi @spencerapplegate \n\nIt sounds like you have no documents which match your geo filter.  I'd suggest choosing one document which you think SHOULD match and testing it against your query with the explain API: https://www.elastic.co/guide/en/elasticsearch/reference/current/search-explain.html\n\nBtw, a better place to ask questions like these is in the forum: http://discuss.elastic.co/.  This issues list is meant for bug reports and feature requests\n\nthanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115222472","html_url":"https://github.com/elastic/elasticsearch/issues/11866#issuecomment-115222472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11866","id":115222472,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTIyMjQ3Mg==","user":{"login":"sappleg","id":1972509,"node_id":"MDQ6VXNlcjE5NzI1MDk=","avatar_url":"https://avatars3.githubusercontent.com/u/1972509?v=4","gravatar_id":"","url":"https://api.github.com/users/sappleg","html_url":"https://github.com/sappleg","followers_url":"https://api.github.com/users/sappleg/followers","following_url":"https://api.github.com/users/sappleg/following{/other_user}","gists_url":"https://api.github.com/users/sappleg/gists{/gist_id}","starred_url":"https://api.github.com/users/sappleg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sappleg/subscriptions","organizations_url":"https://api.github.com/users/sappleg/orgs","repos_url":"https://api.github.com/users/sappleg/repos","events_url":"https://api.github.com/users/sappleg/events{/privacy}","received_events_url":"https://api.github.com/users/sappleg/received_events","type":"User","site_admin":false},"created_at":"2015-06-25T11:59:03Z","updated_at":"2015-06-25T11:59:34Z","author_association":"NONE","body":"@clintongormley I have 2179 documents that match my geo filter, I'd be pleased to post the response with the hits here but it is obviously rather large. When I remove the `search_type=count` parameter, they all appear in the hits section of the response. This is absolutely unexpected behavior\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115229765","html_url":"https://github.com/elastic/elasticsearch/issues/11866#issuecomment-115229765","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11866","id":115229765,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTIyOTc2NQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-25T12:16:14Z","updated_at":"2015-06-25T12:16:14Z","author_association":"CONTRIBUTOR","body":"@spencerapplegate I missed that.  But your geo-point is in the `property` type and `broker` is in the `listing` type, so your matching docs (all of type `property`) don't have any values called `broker.listing`.  \n\nYou have a parent-child relationship between property and broker, so presumably the thing you're missing is a `children` aggregation.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115234460","html_url":"https://github.com/elastic/elasticsearch/issues/11866#issuecomment-115234460","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11866","id":115234460,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTIzNDQ2MA==","user":{"login":"sappleg","id":1972509,"node_id":"MDQ6VXNlcjE5NzI1MDk=","avatar_url":"https://avatars3.githubusercontent.com/u/1972509?v=4","gravatar_id":"","url":"https://api.github.com/users/sappleg","html_url":"https://github.com/sappleg","followers_url":"https://api.github.com/users/sappleg/followers","following_url":"https://api.github.com/users/sappleg/following{/other_user}","gists_url":"https://api.github.com/users/sappleg/gists{/gist_id}","starred_url":"https://api.github.com/users/sappleg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sappleg/subscriptions","organizations_url":"https://api.github.com/users/sappleg/orgs","repos_url":"https://api.github.com/users/sappleg/repos","events_url":"https://api.github.com/users/sappleg/events{/privacy}","received_events_url":"https://api.github.com/users/sappleg/received_events","type":"User","site_admin":false},"created_at":"2015-06-25T12:29:09Z","updated_at":"2015-06-25T12:29:47Z","author_association":"NONE","body":"@clintongormley when I change the filtered query to something more basic, like a term filter, its works completely as expected. This is with aggregating on the child document. For instance, If I change the query to this:\n\n``` json\n{\n    \"query\" : {\n        \"filtered\": {\n            \"query\": { \"match_all\": {} },\n            \"filter\": {\n                \"term\": {\n                    \"broker\": \"CBRE\"\n                }\n            }\n        }\n    },\n    \"aggs\" : {\n        \"brokers\" : {\n            \"terms\" : {\n                \"field\" : \"listing.broker\",\n                \"order\" : { \"_term\" : \"asc\" }\n            }\n        }\n    }\n}\n```\n\nIt returns the correct bucket with its counts:\n\n``` json\n{\n  \"took\": 1,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": 1533,\n    \"max_score\": 0,\n    \"hits\": []\n  },\n  \"aggregations\": {\n    \"brokers\": {\n      \"doc_count_error_upper_bound\": 0,\n      \"sum_other_doc_count\": 0,\n      \"buckets\": [\n        {\n          \"key\": \"CBRE\",\n          \"doc_count\": 1533\n        }\n      ]\n    }\n  }\n}\n```\n\nWe have 1533 properties with listings with a broker of `CBRE`.\n\nIts only when we try to use the geo_bounding_box filter that it will return `[]` for buckets. We have tried flipping top_right to top_left and vis-versa for the bottom bounds. We have also changed the bounding box to be all inclusive, but nothing will return in the buckets.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115240006","html_url":"https://github.com/elastic/elasticsearch/issues/11866#issuecomment-115240006","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11866","id":115240006,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTI0MDAwNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-25T12:46:37Z","updated_at":"2015-06-25T12:46:37Z","author_association":"CONTRIBUTOR","body":"@spencerapplegate that's because your term query is matching the `broker` field in the `listing` type, and that's the same document type that you're aggregating on.  If you change your term query to check a field that only exists in the `property` type then you'll see that you get no aggregations from the `listing.broker` field, same as for geo.\n\nPlease take this to the forum - this is a problem with usage, not Elasticsearch.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115240990","html_url":"https://github.com/elastic/elasticsearch/issues/11866#issuecomment-115240990","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11866","id":115240990,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTI0MDk5MA==","user":{"login":"sappleg","id":1972509,"node_id":"MDQ6VXNlcjE5NzI1MDk=","avatar_url":"https://avatars3.githubusercontent.com/u/1972509?v=4","gravatar_id":"","url":"https://api.github.com/users/sappleg","html_url":"https://github.com/sappleg","followers_url":"https://api.github.com/users/sappleg/followers","following_url":"https://api.github.com/users/sappleg/following{/other_user}","gists_url":"https://api.github.com/users/sappleg/gists{/gist_id}","starred_url":"https://api.github.com/users/sappleg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sappleg/subscriptions","organizations_url":"https://api.github.com/users/sappleg/orgs","repos_url":"https://api.github.com/users/sappleg/repos","events_url":"https://api.github.com/users/sappleg/events{/privacy}","received_events_url":"https://api.github.com/users/sappleg/received_events","type":"User","site_admin":false},"created_at":"2015-06-25T12:48:54Z","updated_at":"2015-06-25T12:48:54Z","author_association":"NONE","body":"@clintongormley thank you for the direction!\n","performed_via_github_app":null}]