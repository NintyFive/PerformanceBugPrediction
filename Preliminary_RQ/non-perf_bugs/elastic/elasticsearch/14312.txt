{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14312","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14312/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14312/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14312/events","html_url":"https://github.com/elastic/elasticsearch/issues/14312","id":113620331,"node_id":"MDU6SXNzdWUxMTM2MjAzMzE=","number":14312,"title":"Out of memory error with elasticsearch-2.0.0-rc1 on windows server 2012","user":{"login":"raphaele81","id":10754469,"node_id":"MDQ6VXNlcjEwNzU0NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/10754469?v=4","gravatar_id":"","url":"https://api.github.com/users/raphaele81","html_url":"https://github.com/raphaele81","followers_url":"https://api.github.com/users/raphaele81/followers","following_url":"https://api.github.com/users/raphaele81/following{/other_user}","gists_url":"https://api.github.com/users/raphaele81/gists{/gist_id}","starred_url":"https://api.github.com/users/raphaele81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raphaele81/subscriptions","organizations_url":"https://api.github.com/users/raphaele81/orgs","repos_url":"https://api.github.com/users/raphaele81/repos","events_url":"https://api.github.com/users/raphaele81/events{/privacy}","received_events_url":"https://api.github.com/users/raphaele81/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-10-27T16:07:58Z","updated_at":"2015-10-27T16:14:47Z","closed_at":"2015-10-27T16:14:47Z","author_association":"NONE","active_lock_reason":null,"body":"I'm currently evaluating ELK for my company. I played successfully with logstash-2.0.0-betaX and elasticsearch-2.0.0-betaX and upgraded to elasticsearch-2.0.0-rc1 a few days ago.\n\nSince then, I get a \"java.lang.OutOfMemoryError: GC overhead limit exceeded\" after a few minutes of elasticsearch running.\n\nHere is my setup:\n- ELK running on windows server 2012 with 8GB Ram\n- logstash-2.0.0-beta3 indexing log files (accessible through network shared file) and logs in oracle databases (logstash-input-jdbc)\n- elasticsearch-2.0.0-rc1 with shield plugin\n\nelasticsearch.yml configuration major changes:\n\n```\nthreadpool.index.queue_size: 1000\nthreadpool.search.queue_size: 10000\nthreadpool.bulk.queue_size: 100\n```\n\nES_HEAP_SIZE\n\n```\nset ES_MIN_MEM=2g\nset ES_MAX_MEM=2g\n```\n\n**The exact same set up with elasticsearch-2.0.0-beta1 works fine.**\n\nHere is the complete stacktrace:\n\n```\n[2015-10-27 15:07:15,107][INFO ][monitor.jvm              ] [node_test_dc_1] [gc][old][489][24] duration [5.3s], collections [1]/[5.4s], total [5.3s]/[1.5m], memory [1.5gb]->[1.5gb]/[1.9gb], all_pools {[young] [243.1mb]->[245.5mb]/[268.5mb]}{[survivor] [0b]->[0b]/[205mb]}{[old] [1.3gb]->[1.3gb]/[1.3gb]}\n[2015-10-27 15:09:11,562][INFO ][monitor.jvm              ] [node_test_dc_1] [gc][old][521][62] duration [7s], collections [1]/[7s], total [7s]/[3.4m], memory [1.5gb]->[1.5gb]/[1.9gb], all_pools {[young] [258.3mb]->[259.7mb]/[268.5mb]}{[survivor] [0b]->[0b]/[205mb]}{[old] [1.3gb]->[1.3gb]/[1.3gb]}\n[2015-10-27 15:11:52,501][WARN ][index.engine             ] [node_test_dc_1] [etl-2015.10.14][0] Failed to close SearcherManager\njava.lang.OutOfMemoryError: GC overhead limit exceeded\n    at java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1563)\n    at java.lang.Class.checkPackageAccess(Class.java:2372)\n    at java.lang.Class.checkMemberAccess(Class.java:2351)\n    at java.lang.Class.getMethod(Class.java:1783)\n    at org.apache.lucene.store.MMapDirectory$2$1.run(MMapDirectory.java:289)\n    at org.apache.lucene.store.MMapDirectory$2$1.run(MMapDirectory.java:286)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at org.apache.lucene.store.MMapDirectory$2.freeBuffer(MMapDirectory.java:286)\n    at org.apache.lucene.store.ByteBufferIndexInput.freeBuffer(ByteBufferIndexInput.java:378)\n    at org.apache.lucene.store.ByteBufferIndexInput.close(ByteBufferIndexInput.java:357)\n    at org.apache.lucene.util.IOUtils.close(IOUtils.java:96)\n    at org.apache.lucene.util.IOUtils.close(IOUtils.java:83)\n    at org.apache.lucene.codecs.lucene50.Lucene50CompoundReader.close(Lucene50CompoundReader.java:120)\n    at org.apache.lucene.util.IOUtils.close(IOUtils.java:96)\n    at org.apache.lucene.util.IOUtils.close(IOUtils.java:83)\n    at org.apache.lucene.index.SegmentCoreReaders.decRef(SegmentCoreReaders.java:152)\n    at org.apache.lucene.index.SegmentReader.doClose(SegmentReader.java:169)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.index.StandardDirectoryReader.doClose(StandardDirectoryReader.java:359)\n    at org.apache.lucene.index.FilterDirectoryReader.doClose(FilterDirectoryReader.java:134)\n    at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n    at org.apache.lucene.search.SearcherManager.decRef(SearcherManager.java:130)\n    at org.apache.lucene.search.SearcherManager.decRef(SearcherManager.java:58)\n    at org.apache.lucene.search.ReferenceManager.release(ReferenceManager.java:274)\n    at org.apache.lucene.search.ReferenceManager.swapReference(ReferenceManager.java:62)\n    at org.apache.lucene.search.ReferenceManager.close(ReferenceManager.java:146)\n    at org.apache.lucene.util.IOUtils.close(IOUtils.java:96)\n    at org.apache.lucene.util.IOUtils.close(IOUtils.java:83)\n    at org.elasticsearch.index.engine.InternalEngine.closeNoLock(InternalEngine.java:954)\n    at org.elasticsearch.index.engine.Engine.failEngine(Engine.java:517)\n    at org.elasticsearch.index.engine.Engine.maybeFailEngine(Engine.java:556)\n    at org.elasticsearch.index.engine.InternalEngine.maybeFailEngine(InternalEngine.java:886)\n```\n\nHeap dump analyze:\n![es_leak_suspects](https://cloud.githubusercontent.com/assets/10754469/10764138/081edfd2-7ccd-11e5-8197-91484126b011.png)\n","closed_by":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"performed_via_github_app":null}