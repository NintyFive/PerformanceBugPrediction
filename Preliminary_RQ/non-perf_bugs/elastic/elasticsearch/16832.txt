{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832/events","html_url":"https://github.com/elastic/elasticsearch/issues/16832","id":136807717,"node_id":"MDU6SXNzdWUxMzY4MDc3MTc=","number":16832,"title":"Percolation with Bounding Box GeoLocation throws NullPointerException in Lucene","user":{"login":"amscotti","id":598958,"node_id":"MDQ6VXNlcjU5ODk1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/598958?v=4","gravatar_id":"","url":"https://api.github.com/users/amscotti","html_url":"https://github.com/amscotti","followers_url":"https://api.github.com/users/amscotti/followers","following_url":"https://api.github.com/users/amscotti/following{/other_user}","gists_url":"https://api.github.com/users/amscotti/gists{/gist_id}","starred_url":"https://api.github.com/users/amscotti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amscotti/subscriptions","organizations_url":"https://api.github.com/users/amscotti/orgs","repos_url":"https://api.github.com/users/amscotti/repos","events_url":"https://api.github.com/users/amscotti/events{/privacy}","received_events_url":"https://api.github.com/users/amscotti/received_events","type":"User","site_admin":false},"labels":[{"id":156502592,"node_id":"MDU6TGFiZWwxNTY1MDI1OTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Percolator","name":":Search/Percolator","color":"0e8a16","default":false,"description":"Reverse search: find queries that match a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2016-02-26T20:33:54Z","updated_at":"2017-06-28T12:32:28Z","closed_at":"2017-06-28T12:32:28Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.2.0\n\n**JVM version**: 1.8.0_72\n\n**OS version**: Linux 851a91a0d5ad 4.0.7-boot2docker #1 SMP Wed Jul 15 00:01:41 UTC 2015 x86_64 GNU/Linux\n\nHi, we are currently running a cluster of 2.1.2 and looking to upgrade to 2.2.0, but we are having some issues when it comes to testing our code around percolators. With 2.1.2 everything works fine, but when testing against 2.2.0 we get a return of internal server error with the reason being a null pointer exception. I have tested this with two clean Docker images from the official Elasticsearch images to ensure there's no configuration issues.\n\nThe only thing I could find about this issue is an unanswered posting on Stack Overflow here, http://stackoverflow.com/questions/35451052/elastic-search-percolation-with-bounding-box-geolocation-throws-nullpointerexcep\n\n**Steps to reproduce**:\n 1 Create Percolator Index\n\n``` bash\ncurl -XPOST http://192.168.99.101:32770/test -d '{\"mappings\": {\".percolator\": {\"dynamic\": true,\"properties\": {\"id\": {\"type\" : \"integer\"}}},\"test\": {\"properties\": {\"location\": {\"type\": \"geo_point\",\"lat_lon\": true }}}}}'\n```\n\n 2 Create Percolator Query\n\n``` bash\ncurl -XPUT http://192.168.99.101:32770/test/.percolator/alert-1 -d '{\"query\":{\"filtered\":{\"filter\":{\"bool\":{\"must\":[{\"geo_bounding_box\":{\"location\":{\"top_left\":[-71.09,42.36],\"bottom_right\":[-71.085,42.355]},\"type\":\"indexed\"}}]}}}}}'\n```\n\n 3 Percolator a Document\n\n``` bash\ncurl -XGET http://192.168.99.101:32772/test/test/_percolate?percolate_format=ids&percolate_index=test -d '{\"doc\":{\"location\":{\"lon\":-71.0875,\"lat\":42.3575}}}'\n```\n\n**Output from 2.1.2**\n\n``` json\n{\"took\":3,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"total\":1,\"matches\":[\"alert-1\"]}\n```\n\n**Output from 2.2.0**\n\n``` json\n{\"took\":6,\"_shards\":{\"total\":5,\"successful\":4,\"failed\":1,\"failures\":[{\"shard\":3,\"index\":\"test\",\"status\":\"INTERNAL_SERVER_ERROR\",\"reason\":{\"type\":\"null_pointer_exception\",\"reason\":null}}]},\"total\":0,\"matches\":[]}\n```\n\n**Provide logs (if relevant)**:\n\n```\nRemoteTransportException[[Anelle][127.0.0.1:9301][indices:data/read/percolate[s]]]; nested: PercolateException[failed to percolate]; nested: PercolateException[failed to execute]; nested: NullPointerException;\nCaused by: PercolateException[failed to percolate]; nested: PercolateException[failed to execute]; nested: NullPointerException;\n        at org.elasticsearch.action.percolate.TransportPercolateAction.shardOperation(TransportPercolateAction.java:180)\n        at org.elasticsearch.action.percolate.TransportPercolateAction.shardOperation(TransportPercolateAction.java:55)\n        at org.elasticsearch.action.support.broadcast.TransportBroadcastAction$ShardTransportHandler.messageReceived(TransportBroadcastAction.java:268)\n        at org.elasticsearch.action.support.broadcast.TransportBroadcastAction$ShardTransportHandler.messageReceived(TransportBroadcastAction.java:264)\n        at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:350)\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: PercolateException[failed to execute]; nested: NullPointerException;\n        at org.elasticsearch.percolator.PercolatorService$4.doPercolate(PercolatorService.java:583)\n        at org.elasticsearch.percolator.PercolatorService.percolate(PercolatorService.java:254)\n        at org.elasticsearch.action.percolate.TransportPercolateAction.shardOperation(TransportPercolateAction.java:177)\n        ... 8 more\nCaused by: java.lang.NullPointerException\n        at org.apache.lucene.search.GeoPointTermQueryConstantScoreWrapper$1.getDocIDs(GeoPointTermQueryConstantScoreWrapper.java:86)\n        at org.apache.lucene.search.GeoPointTermQueryConstantScoreWrapper$1.scorer(GeoPointTermQueryConstantScoreWrapper.java:126)\n        at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:628)\n        at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:280)\n        at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:628)\n        at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:280)\n        at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:628)\n        at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:280)\n        at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:628)\n        at org.elasticsearch.common.lucene.Lucene.exists(Lucene.java:248)\n        at org.elasticsearch.percolator.PercolatorService$4.doPercolate(PercolatorService.java:571)\n        ... 10 more\n```\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}