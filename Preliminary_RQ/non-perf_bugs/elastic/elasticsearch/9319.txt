{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9319","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9319/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9319/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9319/events","html_url":"https://github.com/elastic/elasticsearch/issues/9319","id":54469761,"node_id":"MDU6SXNzdWU1NDQ2OTc2MQ==","number":9319,"title":"Disk-Based Shard Allocation not rebalancing shards when High Watermark Threshold is hit.","user":{"login":"dhollinger","id":2914211,"node_id":"MDQ6VXNlcjI5MTQyMTE=","avatar_url":"https://avatars1.githubusercontent.com/u/2914211?v=4","gravatar_id":"","url":"https://api.github.com/users/dhollinger","html_url":"https://github.com/dhollinger","followers_url":"https://api.github.com/users/dhollinger/followers","following_url":"https://api.github.com/users/dhollinger/following{/other_user}","gists_url":"https://api.github.com/users/dhollinger/gists{/gist_id}","starred_url":"https://api.github.com/users/dhollinger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dhollinger/subscriptions","organizations_url":"https://api.github.com/users/dhollinger/orgs","repos_url":"https://api.github.com/users/dhollinger/repos","events_url":"https://api.github.com/users/dhollinger/events{/privacy}","received_events_url":"https://api.github.com/users/dhollinger/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-01-15T16:26:39Z","updated_at":"2015-01-16T08:58:49Z","closed_at":"2015-01-16T08:58:49Z","author_association":"NONE","active_lock_reason":null,"body":"When the disk space on nodes (usually between 1-3 nodes) in our 40 node cluster start to hit the cluster.routing.allocation.disk.watermark low and high thresholds (set to the defaults of 85% and 90%), disk-based shard allocation doesn't properly rebalance the shards until we execute the following two commands:\n\n<pre><code>\ncurl -XPUT localhost:9200/_cluster/settings -d '{\n    \"transient\" : {\n        \"cluster.routing.allocation.disk.threshold_enabled\" : false\n    }\n}'\n</code></pre>\n\n\nfollowed by:\n\n<pre><code>\ncurl -XPUT localhost:9200/_cluster/settings -d '{\n    \"transient\" : {\n         \"cluster.routing.allocation.disk.threshold_enabled\" : true\n     }\n}'\n</code></pre>\n\n\nOnce we complete what is effectively turning disk-based shard allocation off, then on again, everything starts working as expected.\n\nWe are running Elasticsearch 1.3.4\nI did not see any similar issues reported or fixed for any other version.\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}