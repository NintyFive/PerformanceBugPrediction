[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183477409","html_url":"https://github.com/elastic/elasticsearch/issues/16593#issuecomment-183477409","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593","id":183477409,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzQ3NzQwOQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2016-02-12T20:30:00Z","updated_at":"2016-02-12T20:30:00Z","author_association":"MEMBER","body":"Hmm, do you just want the \"total\" derivative of the summed `like_count` between the two different ranges?  Or do you want to see the derivative between each term in the ranges?\n\nThe first is doable by using a `sum_bucket` agg to accumulate all the `like_count` for a single range, then a derivative over that sum:\n\n``` json\n{\n   \"aggregations\": {\n      \"date_range_buckets\": {\n         \"date_histogram\": {\n            \"field\": \"creation_date\",\n            \"interval\": \"day\"\n         },\n         \"aggregations\": {\n            \"channel\": {\n               \"terms\": {\n                  \"field\": \"channel\"\n               },\n               \"aggregations\": {\n                  \"post_likes_count\": {\n                     \"sum\": {\n                        \"field\": \"likes_count\"\n                     }\n                  }\n               }\n            },\n            \"sum_of_likes\": {\n               \"sum_bucket\": {\n                  \"buckets_path\": \"channel>post_likes_count.value\"\n               }\n            },\n            \"deriv\": {\n               \"derivative\": {\n                  \"buckets_path\": \"sum_of_likes\"\n               }\n            }\n         }\n      }\n   },\n   \"size\": 0\n}\n```\n\nThe second option is not currently possible...the pipeline aggs don't really play nicely with terms aggs at the moment.  We dont have any syntax to \"path\" into a specific term, and the aggs don't know how to \"link up\" matching terms between different ranges. \n\nWe've definitely talked about this type of functionality before.  Unsure where we left off, it might be pending some refactoring.  @colings86 thoughts?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183548813","html_url":"https://github.com/elastic/elasticsearch/issues/16593#issuecomment-183548813","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593","id":183548813,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzU0ODgxMw==","user":{"login":"kennycason","id":2858428,"node_id":"MDQ6VXNlcjI4NTg0Mjg=","avatar_url":"https://avatars1.githubusercontent.com/u/2858428?v=4","gravatar_id":"","url":"https://api.github.com/users/kennycason","html_url":"https://github.com/kennycason","followers_url":"https://api.github.com/users/kennycason/followers","following_url":"https://api.github.com/users/kennycason/following{/other_user}","gists_url":"https://api.github.com/users/kennycason/gists{/gist_id}","starred_url":"https://api.github.com/users/kennycason/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kennycason/subscriptions","organizations_url":"https://api.github.com/users/kennycason/orgs","repos_url":"https://api.github.com/users/kennycason/repos","events_url":"https://api.github.com/users/kennycason/events{/privacy}","received_events_url":"https://api.github.com/users/kennycason/received_events","type":"User","site_admin":false},"created_at":"2016-02-13T00:59:10Z","updated_at":"2016-02-13T00:59:10Z","author_association":"NONE","body":"I admittedly probably made the example more complicated by adding in multiple date ranges. :) Thanks for the response!\n\nWhen you said \"the pipeline aggs don't really play nicely with terms aggs at the moment.\" - That was the primary point of interest for me, the ability to do pipeline metrics on any aggregation (or at least terms aggs) and not just on the histogram aggregations. \n\nAs it stands now, I am building a generic metrics pipeline that functions on an Elasticsearch response for our api. i.e. given an Elasticsearch response, and a list of fields & desired metrics (derivative/avg/etc), apply it to the response before returning to user. Fortunately the calculations aren't super complex but I found my code getting a bit more complex when I started trying to implement my own \"gap policy\" before applying my own pipeline.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183550144","html_url":"https://github.com/elastic/elasticsearch/issues/16593#issuecomment-183550144","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593","id":183550144,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzU1MDE0NA==","user":{"login":"yaauie","id":210924,"node_id":"MDQ6VXNlcjIxMDkyNA==","avatar_url":"https://avatars1.githubusercontent.com/u/210924?v=4","gravatar_id":"","url":"https://api.github.com/users/yaauie","html_url":"https://github.com/yaauie","followers_url":"https://api.github.com/users/yaauie/followers","following_url":"https://api.github.com/users/yaauie/following{/other_user}","gists_url":"https://api.github.com/users/yaauie/gists{/gist_id}","starred_url":"https://api.github.com/users/yaauie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yaauie/subscriptions","organizations_url":"https://api.github.com/users/yaauie/orgs","repos_url":"https://api.github.com/users/yaauie/repos","events_url":"https://api.github.com/users/yaauie/events{/privacy}","received_events_url":"https://api.github.com/users/yaauie/received_events","type":"User","site_admin":false},"created_at":"2016-02-13T01:10:40Z","updated_at":"2016-02-13T01:10:40Z","author_association":"MEMBER","body":"`date_range` aggregation shares a property with `date_histogram` aggs, which may make them suitable for derivative aggregations, specifically that the ordering of the buckets is meaningful (so long as one doesn't completely encompass another), therefore the pipeline has enough information to provide the derivative. Given a `date_range` agg, it would be very useful to apply derivative in order to support period-over-period comparisons for arbitrary periods (as opposed to the set of pre-defined periods that `date_range` aggs make possible).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183584626","html_url":"https://github.com/elastic/elasticsearch/issues/16593#issuecomment-183584626","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593","id":183584626,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzU4NDYyNg==","user":{"login":"kennycason","id":2858428,"node_id":"MDQ6VXNlcjI4NTg0Mjg=","avatar_url":"https://avatars1.githubusercontent.com/u/2858428?v=4","gravatar_id":"","url":"https://api.github.com/users/kennycason","html_url":"https://github.com/kennycason","followers_url":"https://api.github.com/users/kennycason/followers","following_url":"https://api.github.com/users/kennycason/following{/other_user}","gists_url":"https://api.github.com/users/kennycason/gists{/gist_id}","starred_url":"https://api.github.com/users/kennycason/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kennycason/subscriptions","organizations_url":"https://api.github.com/users/kennycason/orgs","repos_url":"https://api.github.com/users/kennycason/repos","events_url":"https://api.github.com/users/kennycason/events{/privacy}","received_events_url":"https://api.github.com/users/kennycason/received_events","type":"User","site_admin":false},"created_at":"2016-02-13T04:12:27Z","updated_at":"2016-02-13T04:12:27Z","author_association":"NONE","body":"@yaauie that's a good point on the ordering and something that makes our case a bit different is that we have nested term aggregations, then for each of the buckets we perform sub aggregations like sum/average, or just use count. those are all numerical values that we then use to sort our buckets THEN we manually apply the derivative pipeline.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376184156","html_url":"https://github.com/elastic/elasticsearch/issues/16593#issuecomment-376184156","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593","id":376184156,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjE4NDE1Ng==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T14:24:59Z","updated_at":"2018-03-26T14:24:59Z","author_association":"MEMBER","body":"Revisiting this ticket, it seems there are two related issues here:\r\n\r\n1. Allow \"pathing\" through terms aggregations, either by providing some kind of syntax to specify a term (`foo>bar['my_term']>the_sum.value`), or by adding logic so the pipeline aggs know how to \"link\" up values between terms aggs (`foo>bar>the_sum.value` and it knows to grab the different `the_sum` values from each term)\r\n2. Extend derivatives and related aggs to work with Ranges, since they provide some semblance of ordering\r\n\r\nThe second point seems like an easy win.  The first point (which is the meat of the request in this issue) is a lot more difficult, because there are a lot of funky edge-cases to handle (what happens if some values are missing in different term partitions?  How do you handle multi-nested terms? etc etc)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376209704","html_url":"https://github.com/elastic/elasticsearch/issues/16593#issuecomment-376209704","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593","id":376209704,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjIwOTcwNA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T15:35:25Z","updated_at":"2018-03-26T15:35:25Z","author_association":"MEMBER","body":"We chatted about this in our Search meeting.\r\n\r\n1. We don't see this functionality being implemented any time soon, because it is very complicated to deal with all the edge-cases and in some cases it isn't clear how they would be handled.  We may implement it at some point in the future, but not in the near-term.\r\n2. Extending pipeline aggs to work with Ranges (date and regular) is something that we should talk more about.  There are also interesting edge-cases there too (how to deal with gaps, etc) but it seems a more tractable problem.  I'll open a dedicated issue to discuss this feature request.\r\n\r\nGoing to close this ticket for now.  Just because we're closing doesn't mean we won't implement the functionality in the future... we just want to signal it's not something we're working on now.  Thanks!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376214505","html_url":"https://github.com/elastic/elasticsearch/issues/16593#issuecomment-376214505","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593","id":376214505,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjIxNDUwNQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T15:49:11Z","updated_at":"2018-03-26T15:49:11Z","author_association":"MEMBER","body":"Issue related to working with ranges: https://github.com/elastic/elasticsearch/issues/29250","performed_via_github_app":null}]