{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18256","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18256/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18256/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18256/events","html_url":"https://github.com/elastic/elasticsearch/issues/18256","id":154122832,"node_id":"MDU6SXNzdWUxNTQxMjI4MzI=","number":18256,"title":"CORS filtering applied for same origin requests","user":{"login":"mchv","id":615085,"node_id":"MDQ6VXNlcjYxNTA4NQ==","avatar_url":"https://avatars2.githubusercontent.com/u/615085?v=4","gravatar_id":"","url":"https://api.github.com/users/mchv","html_url":"https://github.com/mchv","followers_url":"https://api.github.com/users/mchv/followers","following_url":"https://api.github.com/users/mchv/following{/other_user}","gists_url":"https://api.github.com/users/mchv/gists{/gist_id}","starred_url":"https://api.github.com/users/mchv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mchv/subscriptions","organizations_url":"https://api.github.com/users/mchv/orgs","repos_url":"https://api.github.com/users/mchv/repos","events_url":"https://api.github.com/users/mchv/events{/privacy}","received_events_url":"https://api.github.com/users/mchv/received_events","type":"User","site_admin":false},"labels":[{"id":152517143,"node_id":"MDU6TGFiZWwxNTI1MTcxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/REST%20API","name":":Core/Infra/REST API","color":"0e8a16","default":false,"description":"REST infrastructure and utilities"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":360757959,"node_id":"MDU6TGFiZWwzNjA3NTc5NTk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.3.3","name":"v2.3.3","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"assignees":[{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2016-05-10T22:40:24Z","updated_at":"2016-05-11T19:23:02Z","closed_at":"2016-05-11T19:23:02Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: `2.3.2`\n**JVM version**: `1.8`\n**OS version**: not relevant\n\n**Description of the problem including expected versus actual behavior**:\n- Actual behavior\n\nFollowing [CORS implementation refactoring changes](https://github.com/elastic/elasticsearch/pull/16436) when a request contains an `Origin` header, it is considered as a cross-origin request and `CORS` filtering is applied based on configuration. \n\nThis prevents the [head plugin](https://github.com/mobz/elasticsearch-head), if `CORS` is not enabled or not configured to enable a specific origin, to work with `Chrome` or `Safari` as [they add an origin header for every POST request](http://stackoverflow.com/a/15514049) \n\nMore specifically `POST requests` from those browsers will be returned `403` (`Forbidden`)  \n- Expected behavior \n\nAccording to [RFC 6454](https://tools.ietf.org/html/rfc6454#section-7.3):\n\n> The user agent MAY include an Origin header field in any HTTP request.\n\n[CorsHandler](https://github.com/elastic/elasticsearch/blob/2.3/core/src/main/java/org/elasticsearch/http/netty/cors/CorsHandler.java) should check the `Host` header, and if it matches the domain in the `Origin` header, don't treat the request as a cross-origin request, and so allow it to be performed. \n\n**Steps to reproduce**:\n-  1 - Disable `CORS` in elasticsearch configuration\n\n``` yaml\nhttp.cors.enabled: false\n```\n- 2 - Send a `same origin POST` request with an `Origin` header  \n\n```\ncurl -H \"Origin: http://localhost:9200\" -X POST http://localhost:9200/_all/_search\n```\n","closed_by":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"performed_via_github_app":null}