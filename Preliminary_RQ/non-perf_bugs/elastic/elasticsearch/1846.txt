{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1846","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1846/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1846/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1846/events","html_url":"https://github.com/elastic/elasticsearch/issues/1846","id":3978974,"node_id":"MDU6SXNzdWUzOTc4OTc0","number":1846,"title":"support geo sorting on multiple geo point values per doc","user":{"login":"tommyvn","id":910265,"node_id":"MDQ6VXNlcjkxMDI2NQ==","avatar_url":"https://avatars2.githubusercontent.com/u/910265?v=4","gravatar_id":"","url":"https://api.github.com/users/tommyvn","html_url":"https://github.com/tommyvn","followers_url":"https://api.github.com/users/tommyvn/followers","following_url":"https://api.github.com/users/tommyvn/following{/other_user}","gists_url":"https://api.github.com/users/tommyvn/gists{/gist_id}","starred_url":"https://api.github.com/users/tommyvn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tommyvn/subscriptions","organizations_url":"https://api.github.com/users/tommyvn/orgs","repos_url":"https://api.github.com/users/tommyvn/repos","events_url":"https://api.github.com/users/tommyvn/events{/privacy}","received_events_url":"https://api.github.com/users/tommyvn/received_events","type":"User","site_admin":false},"labels":[{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":32716575,"node_id":"MDU6TGFiZWwzMjcxNjU3NQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.0.RC2","name":"v0.90.0.RC2","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2012-04-04T21:36:08Z","updated_at":"2015-07-06T12:30:13Z","closed_at":"2013-03-28T16:16:49Z","author_association":"NONE","active_lock_reason":null,"body":"I have multiple geo points per document and would like to be able to sort based on the closest matching location in the document to my center point. Apparently the way things currently work is the sort will be based on a random location on the document, as in the following scenario:\n\nI have the following mapping:\n\n```\n$ curl -XGET 'http://localhost:9200/work/offices/_mapping?pretty=true'\n{\n  \"offices\" : {\n    \"properties\" : {\n      \"location\" : {\n        \"properties\" : {\n          \"address\" : {\n            \"type\" : \"string\"\n          },\n          \"point\" : {\n            \"type\" : \"geo_point\"\n          }\n        }\n      },\n      \"name\" : {\n        \"type\" : \"string\"\n      }\n    }\n  }\n}\n```\n\nThen I have the following query and response (I've only included hits to cut down on noise):\n\n```\n$ curl -XGET 'http://localhost:9200/work/offices/_search?pretty=true' -d '{ \"fields\": [ \"name\", \"location\" ], \"query\": { \"match_all\": {} }, \"sort\": { \"_geo_distance\": {\"location.point\": [-0.0976398, 51.4962307], \"order\": \"asc\", \"unit\": \"km\"} }}'\n...\n    \"hits\" : [ {\n      \"_index\" : \"work\",\n      \"_type\" : \"offices\",\n      \"_id\" : \"IDtt2WnSQnWEhuAxhlbPgw\",\n      \"_score\" : null,\n      \"fields\" : {\n        \"location\" : [ {\n          \"point\" : [ -0.01655, 51.5007324 ],\n          \"address\" : \"E14 9SH\"\n        }, {\n          \"point\" : [ -0.0976398, 51.4962307 ],\n          \"address\" : \"SE1 6PL\"\n        } ],\n        \"name\" : \"office3\"\n      },\n      \"sort\" : [ 0.0 ]\n    }, {\n      \"_index\" : \"work\",\n      \"_type\" : \"offices\",\n      \"_id\" : \"xzaVAHUoSGON8gY1-ggILQ\",\n      \"_score\" : null,\n      \"fields\" : {\n        \"location\" : [ {\n          \"point\" : [ -0.01655, 51.5007324 ],\n          \"address\" : \"E14 9SH\"\n        }, {\n          \"point\" : [ -0.0684337, 51.4843866 ],\n          \"address\" : \"SE1 5BA\"\n        } ],\n        \"name\" : \"office10\"\n      },\n      \"sort\" : [ 2.413161036894697 ]\n    }, {\n      \"_index\" : \"work\",\n      \"_type\" : \"offices\",\n      \"_id\" : \"ZWjuiVkWSD6H99ooKcKNuA\",\n      \"_score\" : null,\n      \"fields\" : {\n        \"location\" : [ {\n          \"point\" : [ -0.0976398, 51.4962307 ],\n          \"address\" : \"SE1 6PL\"\n        }, {\n          \"point\" : [ -0.0684337, 51.4843866 ],\n          \"address\" : \"SE1 5BA\"\n        } ],\n        \"name\" : \"office8\"\n      },\n      \"sort\" : [ 2.413161036894697 ]\n    }\n...\n```\n\noffice8 and office3 both have locations 0km away from my search point, yet office10 is sneaking in between the two at 2.4km away and office8 is also placing itself 2.4km away (which it is, but but only on the further location point).\n\nThis was originally discussed here: https://groups.google.com/forum/?fromgroups#!topic/elasticsearch/DxIUevwZfOs\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}