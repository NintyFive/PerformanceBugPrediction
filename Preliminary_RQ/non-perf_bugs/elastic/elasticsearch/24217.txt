{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24217","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24217/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24217/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24217/events","html_url":"https://github.com/elastic/elasticsearch/issues/24217","id":223110912,"node_id":"MDU6SXNzdWUyMjMxMTA5MTI=","number":24217,"title":"rollover `max_docs` uses doc count from both primary and replica/s","user":{"login":"jpcarey","id":5118470,"node_id":"MDQ6VXNlcjUxMTg0NzA=","avatar_url":"https://avatars2.githubusercontent.com/u/5118470?v=4","gravatar_id":"","url":"https://api.github.com/users/jpcarey","html_url":"https://github.com/jpcarey","followers_url":"https://api.github.com/users/jpcarey/followers","following_url":"https://api.github.com/users/jpcarey/following{/other_user}","gists_url":"https://api.github.com/users/jpcarey/gists{/gist_id}","starred_url":"https://api.github.com/users/jpcarey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpcarey/subscriptions","organizations_url":"https://api.github.com/users/jpcarey/orgs","repos_url":"https://api.github.com/users/jpcarey/repos","events_url":"https://api.github.com/users/jpcarey/events{/privacy}","received_events_url":"https://api.github.com/users/jpcarey/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2017-04-20T15:40:25Z","updated_at":"2017-06-13T12:30:46Z","closed_at":"2017-06-13T12:30:46Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**: 5.3.0\r\n\r\nThe rollover `max_docs` value uses the doc count from both primary and replica/s.  It should be based upon the primary only, since the replica count can be changed.\r\n\r\n(start two nodes, to allow the default 1 replica to allocate)\r\n```\r\nPUT /logs-000001 \r\n{\r\n  \"aliases\": {\r\n    \"logs_write\": {}\r\n  }\r\n}\r\nPUT logs_write/test/1\r\n{\r\n  \"blah\": \"foo\"\r\n}\r\nPOST /logs_write/_rollover?dry_run\r\n{\r\n  \"conditions\": {\r\n    \"max_docs\":  2\r\n  }\r\n}\r\n# response\r\n{\r\n  \"old_index\": \"logs-000001\",\r\n  \"new_index\": \"logs-000002\",\r\n  \"rolled_over\": false,\r\n  \"dry_run\": true,\r\n  \"acknowledged\": false,\r\n  \"shards_acknowledged\": false,\r\n  \"conditions\": {\r\n    \"[max_docs: 2]\": true\r\n  }\r\n}\r\n```\r\nchange the replica count to 0:\r\n```\r\nPUT /logs-000001/_settings\r\n{\r\n  \"index\": {\r\n    \"number_of_replicas\": 0\r\n  }\r\n}\r\n# response\r\n{\r\n  \"old_index\": \"logs-000001\",\r\n  \"new_index\": \"logs-000002\",\r\n  \"rolled_over\": false,\r\n  \"dry_run\": true,\r\n  \"acknowledged\": false,\r\n  \"shards_acknowledged\": false,\r\n  \"conditions\": {\r\n    \"[max_docs: 2]\": false\r\n  }\r\n}\r\n```","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}