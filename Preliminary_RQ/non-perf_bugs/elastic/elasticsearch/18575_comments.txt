[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222456960","html_url":"https://github.com/elastic/elasticsearch/issues/18575#issuecomment-222456960","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18575","id":222456960,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjQ1Njk2MA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-05-30T09:53:28Z","updated_at":"2016-05-30T09:53:28Z","author_association":"CONTRIBUTOR","body":"It looks to me that it can happen when all documents with a value are deleted on a shard and then merged away. Can you describe what your test case is doing?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/222480673","html_url":"https://github.com/elastic/elasticsearch/issues/18575#issuecomment-222480673","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18575","id":222480673,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjQ4MDY3Mw==","user":{"login":"DavidHauger","id":15940636,"node_id":"MDQ6VXNlcjE1OTQwNjM2","avatar_url":"https://avatars3.githubusercontent.com/u/15940636?v=4","gravatar_id":"","url":"https://api.github.com/users/DavidHauger","html_url":"https://github.com/DavidHauger","followers_url":"https://api.github.com/users/DavidHauger/followers","following_url":"https://api.github.com/users/DavidHauger/following{/other_user}","gists_url":"https://api.github.com/users/DavidHauger/gists{/gist_id}","starred_url":"https://api.github.com/users/DavidHauger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DavidHauger/subscriptions","organizations_url":"https://api.github.com/users/DavidHauger/orgs","repos_url":"https://api.github.com/users/DavidHauger/repos","events_url":"https://api.github.com/users/DavidHauger/events{/privacy}","received_events_url":"https://api.github.com/users/DavidHauger/received_events","type":"User","site_admin":false},"created_at":"2016-05-30T12:20:36Z","updated_at":"2016-05-30T12:20:36Z","author_association":"NONE","body":"it creates an index, adds a couple of documents (these two steps are done in the setup which is used for a couple of tests), creates a `TermsBuilder` aggregation, sets the `exclude()` with an array of Strings, and performs a query with this `TermsBuilder` aggregation added (and processes the result for further testing).\nWell, the query is a bit more complex, but we saw this \"shard failing exception\" only with the exclude option set; the same test with an include option always worked (we include some values in one case and excluded the others in another test - so the results should be exactly the same).\nWithin this test we are not deleting (or overriding) any documents. Our test case extends `ESIntegTestCase`; the failing shards are definitely not necessarily empty; because there are 1-2 documents missing in the results, that should lie on these failing shard(s).\n","performed_via_github_app":null}]