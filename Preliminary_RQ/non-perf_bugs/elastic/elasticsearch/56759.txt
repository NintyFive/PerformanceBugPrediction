{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/56759","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56759/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56759/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56759/events","html_url":"https://github.com/elastic/elasticsearch/issues/56759","id":618133077,"node_id":"MDU6SXNzdWU2MTgxMzMwNzc=","number":56759,"title":"SQL: Jdbc driver version detection fails on JBoss Wildfly","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"labels":[{"id":912794284,"node_id":"MDU6TGFiZWw5MTI3OTQyODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/SQL","name":":Query Languages/SQL","color":"0e8a16","default":false,"description":"SQL querying"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967501040,"node_id":"MDU6TGFiZWwxOTY3NTAxMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:QL","name":"Team:QL","color":"fef2c0","default":false,"description":"Meta label for query languages team"}],"state":"closed","locked":false,"assignee":{"login":"bpintea","id":1562801,"node_id":"MDQ6VXNlcjE1NjI4MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1562801?v=4","gravatar_id":"","url":"https://api.github.com/users/bpintea","html_url":"https://github.com/bpintea","followers_url":"https://api.github.com/users/bpintea/followers","following_url":"https://api.github.com/users/bpintea/following{/other_user}","gists_url":"https://api.github.com/users/bpintea/gists{/gist_id}","starred_url":"https://api.github.com/users/bpintea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bpintea/subscriptions","organizations_url":"https://api.github.com/users/bpintea/orgs","repos_url":"https://api.github.com/users/bpintea/repos","events_url":"https://api.github.com/users/bpintea/events{/privacy}","received_events_url":"https://api.github.com/users/bpintea/received_events","type":"User","site_admin":false},"assignees":[{"login":"bpintea","id":1562801,"node_id":"MDQ6VXNlcjE1NjI4MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1562801?v=4","gravatar_id":"","url":"https://api.github.com/users/bpintea","html_url":"https://github.com/bpintea","followers_url":"https://api.github.com/users/bpintea/followers","following_url":"https://api.github.com/users/bpintea/following{/other_user}","gists_url":"https://api.github.com/users/bpintea/gists{/gist_id}","starred_url":"https://api.github.com/users/bpintea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bpintea/subscriptions","organizations_url":"https://api.github.com/users/bpintea/orgs","repos_url":"https://api.github.com/users/bpintea/repos","events_url":"https://api.github.com/users/bpintea/events{/privacy}","received_events_url":"https://api.github.com/users/bpintea/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-05-14T10:58:23Z","updated_at":"2020-05-15T16:14:35Z","closed_at":"2020-05-15T16:14:35Z","author_association":"MEMBER","active_lock_reason":null,"body":"When loading the JDBC driver inside JBoss AP/Wildfly, the version discovery fails due to some issues with opening the jar.\r\n```\r\nOpening jar:file:/E:/wildfly-19.1.0.Final/modules/system/layers/base/org/elasticsearch/jdbc/main/x-pack-sql-jdbc-7.7.0.jar!/\r\n```\r\n\r\nThe following URL, despite being returned by the AP itself when calling `conn.getInputStream`:\r\n\r\n```java\r\nURL url = SqlVersion.class.getProtectionDomain().getCodeSource().getLocation();\r\n...\r\nURLConnection conn = url.openConnection();\r\nconn.setUseCaches(false);\r\n\r\ntry (JarInputStream jar = new JarInputStream(conn.getInputStream())) { <--\r\n```\r\n\r\nThe underlying error seems to be:\r\n```\r\nCaused by: java.lang.IllegalArgumentException: Detected Elasticsearch JDBC jar but cannot retrieve its version at URLjar:file:/E:/tmp/wildfly/wildfly-19.1.0.Final/modules/system/layers/base/org/elasticsearch/jdbc/main/x-pack-sql-jdbc-7.9.0-SNAPSHOT.jar!/\r\n        at org.elasticsearch.jdbc@7.9.0-SNAPSHOT//org.elasticsearch.xpack.sql.client.ClientVersion.extractVersion(ClientVersion.java:87)\r\n        at org.elasticsearch.jdbc@7.9.0-SNAPSHOT//org.elasticsearch.xpack.sql.client.ClientVersion.<clinit>(ClientVersion.java:71)\r\n        ... 19 more\r\nCaused by: java.io.IOException: no entry name specified\r\n        at java.base/sun.net.www.protocol.jar.JarURLConnection.getInputStream(JarURLConnection.java:160)\r\n        at org.elasticsearch.jdbc@7.9.0-SNAPSHOT//org.elasticsearch.xpack.sql.client.ClientVersion.extractVersion(ClientVersion.java:81)\r\n        ... 20 more\r\n```\r\nWhich is confusing. Probably the resource/jar handling inside the server is somewhat different causing the jar to not be opened correctly. Some small tests indicate that while the URL if modified can be opened, the jar manifest is missing.\r\nSo probably a different URL/approach need to be taken to get a hold of the manifest.\r\n\r\nAs a separate issue, we could consider not detecting a version as a warning and not an exception...","closed_by":{"login":"bpintea","id":1562801,"node_id":"MDQ6VXNlcjE1NjI4MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1562801?v=4","gravatar_id":"","url":"https://api.github.com/users/bpintea","html_url":"https://github.com/bpintea","followers_url":"https://api.github.com/users/bpintea/followers","following_url":"https://api.github.com/users/bpintea/following{/other_user}","gists_url":"https://api.github.com/users/bpintea/gists{/gist_id}","starred_url":"https://api.github.com/users/bpintea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bpintea/subscriptions","organizations_url":"https://api.github.com/users/bpintea/orgs","repos_url":"https://api.github.com/users/bpintea/repos","events_url":"https://api.github.com/users/bpintea/events{/privacy}","received_events_url":"https://api.github.com/users/bpintea/received_events","type":"User","site_admin":false},"performed_via_github_app":null}