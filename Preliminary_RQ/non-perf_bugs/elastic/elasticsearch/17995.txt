{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17995","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17995/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17995/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17995/events","html_url":"https://github.com/elastic/elasticsearch/issues/17995","id":151231796,"node_id":"MDU6SXNzdWUxNTEyMzE3OTY=","number":17995,"title":"Allow defining settings values to `null` when updating settings","user":{"login":"Wedjaa","id":6388662,"node_id":"MDQ6VXNlcjYzODg2NjI=","avatar_url":"https://avatars1.githubusercontent.com/u/6388662?v=4","gravatar_id":"","url":"https://api.github.com/users/Wedjaa","html_url":"https://github.com/Wedjaa","followers_url":"https://api.github.com/users/Wedjaa/followers","following_url":"https://api.github.com/users/Wedjaa/following{/other_user}","gists_url":"https://api.github.com/users/Wedjaa/gists{/gist_id}","starred_url":"https://api.github.com/users/Wedjaa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Wedjaa/subscriptions","organizations_url":"https://api.github.com/users/Wedjaa/orgs","repos_url":"https://api.github.com/users/Wedjaa/repos","events_url":"https://api.github.com/users/Wedjaa/events{/privacy}","received_events_url":"https://api.github.com/users/Wedjaa/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-04-26T20:31:01Z","updated_at":"2016-04-27T09:07:26Z","closed_at":"2016-04-27T09:07:26Z","author_association":"NONE","active_lock_reason":null,"body":"The idea is that right now when you update a setting that has multiple attributes you have no way of removing the old values - since ES ignores null values when updating settings. In practice:\n\n```\n{\n   \"settings\": {\n      \"analysis\": {\n         \"filter\": {\n             \"lowercase_filter\": {\n                \"type\": \"lowercase\",\n                \"language\": \"greek\"\n             }\n         }\n      }\n   }\n}\n```\n\nthese will create a lowercase filter for the `greek` language. If I want to go back to using the standard language if I try and `PUT` the following settings:\n\n```\n{\n   \"settings\": {\n      \"analysis\": {\n         \"filter\": {\n             \"lowercase_filter\": {\n                \"type\": \"lowercase\"\n             }\n         }\n      }\n   }\n}\n```\n\nthe resulting settings in ES will not have changed - the missing `language` attribute would be simply merged from the previous version of the settings.\n\nExplicitly setting the value to `null`\n\n```\n{\n   \"settings\": {\n      \"analysis\": {\n         \"filter\": {\n             \"lowercase_filter\": {\n                \"type\": \"lowercase\",\n                \"language\": null\n             }\n         }\n      }\n   }\n}\n```\n\nhas no effect - since the parses is currently simply ignoring null values. \n\nAt the core of this there is the issue that currently the settings are being held in an immutable map that doesn't accept null values.\n\nI have a PR that does the following:\n- Create a `Setting` object that holds a setting value; I could have used an Optional - but I wanted to be  compatible with JDKs < 1.8;\n- The Settings map will contain a map of Setting, allowing the loading of `null` values;\n- The loader will correctly load null values into the settings;\n- In the `Settings` builder there are two main changes: putting in settings will do a merge with the following logic: if the new value is `null` and an old value exists the key will be removed - and all the subkeys - otherwise we will insert the null in the settings.\n\nIs there any other person interested in this PR?\n\nFabio\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}