[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238112284","html_url":"https://github.com/elastic/elasticsearch/issues/19852#issuecomment-238112284","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852","id":238112284,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODExMjI4NA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-08-07T22:21:59Z","updated_at":"2016-08-07T22:21:59Z","author_association":"CONTRIBUTOR","body":"It is hard to tell what causes this. The stats endpoints are useful to\nfigure it out. Also, what plugins are you using? Search guard has a\ndevastating problem in 2.3. there is a pr open to fix it but I'm on mobile\nso I don't have a handy link.\n\nOn Aug 7, 2016 4:57 PM, \"djtecha\" notifications@github.com wrote:\n\n> java version \"1.8.0_92\"\n> ES 2.3.4\n> \n> So, I have 4 nodes, each with 32GB dedicated to the heap space. After\n> about 2 days the heap makes it's way up to over 90% and I start to get\n> rolling outage. Checking the stats I notice that ALL of the heap stays in\n> the old generation pool and never seems to clear out. I've tried switching\n> to G1GC which seemed to help a little bit, I've tried messing with the\n> NewGen Ratio and all sorts of other things, but in the end the old\n> generation never clears and the cluster is unstable until I start\n> restarting nodes.\n> \n> Current Run Options:\n> \n> /platform/jdk/bin/java -Xms32g -Xmx32g -Djava.awt.headless=true\n> -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:\n> CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly\n> -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps\n> -XX:+PrintClassHistogram -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime\n> -Xloggc:/var/log/elasticsearch/gc.log -XX:+HeapDumpOnOutOfMemoryError\n> -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true\n> -XX:-UseParNewGC -XX:-UseConcMarkSweepGC -XX:+UseG1GC -XX:+PrintGCDetails\n> -XX:NewRatio=4 -Des.path.home=/usr/share/elasticsearch -cp\n> /usr/share/elasticsearch/lib/elasticsearch-2.3.4.jar:/usr/share/elasticsearch/lib/*\n> org.elasticsearch.bootstrap.Elasticsearch start -Des.pidfile=/var/run/\n> elasticsearch/elasticsearch.pid -Des.default.path.home=/usr/share/elasticsearch\n> -Des.default.path.logs=/var/log/elasticsearch -Des.default.path.data=/var/lib/elasticsearch\n> -Des.default.path.conf=/etc/elasticsearch\n> \n> elasticsearch.yaml\n> \n> #Cluster Settings\n> cluster.name: elasticsearch\n> \n> node.rack: \"East\"\n> node.name: \"es-1\"\n> node.max_local_storage_nodes: 1\n> \n> #Path Settings\n> path.conf: /etc/elasticsearch\n> path.data: /storage/elasticsearch\n> \n> #Lock memory for ES\n> bootstrap.mlockall: true\n> \n> #Networking\n> network.host: [ _local_, _bond0_ ]\n> discovery.zen.minimum_master_nodes: 3\n> discovery.zen.ping.unicast.hosts: [\"es-1\", \"es-2\", \"es-3\", \"es-4\"]\n> \n> #CLUSTER\n> cluster.routing.allocation.disk.watermark.high: \"95%\"\n> cluster.routing.allocation.node_concurrent_recoveries: 30\n> cluster.routing.allocation.cluster_concurrent_rebalance: 6\n> \n> #INDICES\n> indices.store.throttle.max_bytes_per_sec: 400mb\n> \n> #Recovery\n> indices.recovery.max_bytes_per_sec: 1000mb\n> indices.recovery.concurrent_streams: 10\n> gateway.recover_after_data_nodes: 2\n> gateway.recover_after_time: 1m\n> gateway.expected_data_nodes: 2\n> \n> #Field Data tweaks\n> #indices.fielddata.cache.size: 20% #Evictions a large amount of garbage in\n> memory, which must be garbage collected later on\n> \n> #Circuit Breaker\n> indices.breaker.fielddata.limit: 25%\n> indices.breaker.request.limit: 25%\n> indices.breaker.total.limit: 50%\n> \n> #SLOW LOG\n> index.search.slowlog.threshold.query.warn: 10s\n> index.search.slowlog.threshold.fetch.warn: 1s\n> index.indexing.slowlog.threshold.index.warn: 10s\n> \n> #GC LOGGING\n> monitor.jvm.gc.young.warn: 1000ms\n> monitor.jvm.gc.young.info: 700ms\n> monitor.jvm.gc.young.debug: 400ms\n> monitor.jvm.gc.old.warn: 10s\n> monitor.jvm.gc.old.info: 5s\n> monitor.jvm.gc.old.debug: 2s\n> \n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/elastic/elasticsearch/issues/19852, or mute the\n> thread\n> https://github.com/notifications/unsubscribe-auth/AANLouw9YwQ0FPafSfiIYRfmmnZkOfmBks5qdkbDgaJpZM4Jelf4\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238290140","html_url":"https://github.com/elastic/elasticsearch/issues/19852#issuecomment-238290140","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852","id":238290140,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODI5MDE0MA==","user":{"login":"djtecha","id":3084627,"node_id":"MDQ6VXNlcjMwODQ2Mjc=","avatar_url":"https://avatars1.githubusercontent.com/u/3084627?v=4","gravatar_id":"","url":"https://api.github.com/users/djtecha","html_url":"https://github.com/djtecha","followers_url":"https://api.github.com/users/djtecha/followers","following_url":"https://api.github.com/users/djtecha/following{/other_user}","gists_url":"https://api.github.com/users/djtecha/gists{/gist_id}","starred_url":"https://api.github.com/users/djtecha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djtecha/subscriptions","organizations_url":"https://api.github.com/users/djtecha/orgs","repos_url":"https://api.github.com/users/djtecha/repos","events_url":"https://api.github.com/users/djtecha/events{/privacy}","received_events_url":"https://api.github.com/users/djtecha/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T16:23:00Z","updated_at":"2016-08-08T16:24:29Z","author_association":"NONE","body":"I have marvel, aws-cloud, searchguard-ssl and searchguard-2. Kind of hard to know as I had to fully upgrade form 1.7 due to backwards compatibility issues. Is there a way we can force the OLD GEN to flush? I could just have a job do that nightly in a staggered fashion until I can figure this out.\n\nIs this the issue? https://github.com/floragunncom/search-guard-ssl/issues/15\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238290681","html_url":"https://github.com/elastic/elasticsearch/issues/19852#issuecomment-238290681","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852","id":238290681,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODI5MDY4MQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T16:24:51Z","updated_at":"2016-08-08T16:24:51Z","author_association":"MEMBER","body":"@djtecha it sounds like you may be hitting this memory leak with searchguard: https://github.com/floragunncom/search-guard-ssl/pull/31\n\nRelates to #19838\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238291173","html_url":"https://github.com/elastic/elasticsearch/issues/19852#issuecomment-238291173","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852","id":238291173,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODI5MTE3Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T16:26:36Z","updated_at":"2016-08-08T16:26:36Z","author_association":"MEMBER","body":"The plugin searchguard-ssl is causing memory leaks in 2.3. If you take a histogram of your heap, you should see it littered with uncollectable task instances. This is almost surely the problem that you're experiencing, and there is nothing you can do other than restarting the instance.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238292269","html_url":"https://github.com/elastic/elasticsearch/issues/19852#issuecomment-238292269","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852","id":238292269,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODI5MjI2OQ==","user":{"login":"djtecha","id":3084627,"node_id":"MDQ6VXNlcjMwODQ2Mjc=","avatar_url":"https://avatars1.githubusercontent.com/u/3084627?v=4","gravatar_id":"","url":"https://api.github.com/users/djtecha","html_url":"https://github.com/djtecha","followers_url":"https://api.github.com/users/djtecha/followers","following_url":"https://api.github.com/users/djtecha/following{/other_user}","gists_url":"https://api.github.com/users/djtecha/gists{/gist_id}","starred_url":"https://api.github.com/users/djtecha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djtecha/subscriptions","organizations_url":"https://api.github.com/users/djtecha/orgs","repos_url":"https://api.github.com/users/djtecha/repos","events_url":"https://api.github.com/users/djtecha/events{/privacy}","received_events_url":"https://api.github.com/users/djtecha/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T16:30:35Z","updated_at":"2016-08-08T16:30:35Z","author_association":"NONE","body":"Thanks, I'll follow the bug and restart nightly until a patch is released. Glad to know I'm not alone on this one :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238292355","html_url":"https://github.com/elastic/elasticsearch/issues/19852#issuecomment-238292355","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852","id":238292355,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODI5MjM1NQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T16:30:54Z","updated_at":"2016-08-08T16:30:54Z","author_association":"MEMBER","body":"Duplicates #19794\n","performed_via_github_app":null}]