{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18807","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18807/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18807/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18807/events","html_url":"https://github.com/elastic/elasticsearch/issues/18807","id":159467384,"node_id":"MDU6SXNzdWUxNTk0NjczODQ=","number":18807,"title":"Add whitelisted classes groovy.json.JSONOutput ","user":{"login":"rvalenciano","id":5366444,"node_id":"MDQ6VXNlcjUzNjY0NDQ=","avatar_url":"https://avatars2.githubusercontent.com/u/5366444?v=4","gravatar_id":"","url":"https://api.github.com/users/rvalenciano","html_url":"https://github.com/rvalenciano","followers_url":"https://api.github.com/users/rvalenciano/followers","following_url":"https://api.github.com/users/rvalenciano/following{/other_user}","gists_url":"https://api.github.com/users/rvalenciano/gists{/gist_id}","starred_url":"https://api.github.com/users/rvalenciano/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rvalenciano/subscriptions","organizations_url":"https://api.github.com/users/rvalenciano/orgs","repos_url":"https://api.github.com/users/rvalenciano/repos","events_url":"https://api.github.com/users/rvalenciano/events{/privacy}","received_events_url":"https://api.github.com/users/rvalenciano/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-06-09T17:44:33Z","updated_at":"2016-09-22T08:35:03Z","closed_at":"2016-06-09T17:53:22Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3\n\n**JVM version**:  openjdk version \"1.8.0_91\"\nOpenJDK Runtime Environment (build 1.8.0_91-b14)\nOpenJDK 64-Bit Server VM (build 25.91-b14, mixed mode)\n\n**OS version**: centOS 7\n\n**Description of the problem including expected versus actual behavior**:\n\nI'm having the exact same issue of this [thread](https://discuss.elastic.co/t/webhook-action-hits-collection-not-json/24568): Basically watcher ctx is giving me a java.util.HashMap object and I need a json object.\n\nSo, I try to implement the solution but I get the error described in the log section (Summarizing, ScriptException[failed to run inline script [return [ body: groovy.json.JsonOutput.toJson(ctx  .payload.hits.hits)]] using lang [groovy]]; nested: MissingPropertyException[No such property: groovy for class). \n\nDoing more research, I found this [page](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-security.html) about the security feature of whitelisting classes. I guess i can whitelist in my classloader whitelist in the java security policy, but why not producing json output from elasticsearch scripting for default?\n\n**Steps to reproduce**:\n1. Using sense, create a watch like [this](https://gist.github.com/rvalenciano/db701603a1df6051dd9315da64505f8f):\n\n**Provide logs (if relevant)**:\n\nThe error is described here;\n\n`[2016-06-09 11:12:09,191][INFO ][cluster.metadata         ] [Tower] [.watch_history-2016.06.09] update_mapping [watch_record]\n[2016-06-09 11:12:19,102][ERROR][watcher.transform.script ] [Tower] failed to execute [script] transform for [running_process_watch_1-2016-06-09T17:12:19.083Z]\nScriptException[failed to run inline script [return [ body: groovy.json.JsonOutput.toJson(ctx  .payload.hits.hits)]] using lang [groovy]]; nested: MissingPropertyException[No such property: groovy for class: 703695e74fadee477a3e905ccc4a47d0c085cf47];\n    at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:320)\n    at org.elasticsearch.watcher.transform.script.ExecutableScriptTransform.doExecute(ExecutableScriptTransform.java:74)\n    at org.elasticsearch.watcher.transform.script.ExecutableScriptTransform.execute(ExecutableScriptTransform.java:60)\n    at org.elasticsearch.watcher.transform.script.ExecutableScriptTransform.execute(ExecutableScriptTransform.java:41)\n    at org.elasticsearch.watcher.execution.ExecutionService.executeInner(ExecutionService.java:378)\n    at org.elasticsearch.watcher.execution.ExecutionService.execute(ExecutionService.java:273)\n    at org.elasticsearch.watcher.execution.ExecutionService$WatchExecutionTask.run(ExecutionService.java:438)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: groovy.lang.MissingPropertyException: No such property: groovy for class: 703695e74fadee477a3e905ccc4a47d0c085cf47\n    at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.unwrap(ScriptBytecodeAdapter.java:53)\n    at org.codehaus.groovy.vmplugin.v7.IndyGuardsFiltersAndSignatures.unwrap(IndyGuardsFiltersAndSignatures.java:177)\n    at 703695e74fadee477a3e905ccc4a47d0c085cf47.run(703695e74fadee477a3e905ccc4a47d0c085cf47:1)\n    at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript$1.run(GroovyScriptEngineService.java:313)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:310) \n`\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n\n**Describe the feature**:\n\nIs there any possibility for whitelisting groovy.json.JSONOutput in the default class wishlist? An example of this is in this [fork](https://github.com/rmuir/elasticsearch/commit/79467a138a0f435ff3776216aa8df0364787ad00).\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}