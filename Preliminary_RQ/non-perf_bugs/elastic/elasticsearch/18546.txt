{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18546","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18546/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18546/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18546/events","html_url":"https://github.com/elastic/elasticsearch/issues/18546","id":156484117,"node_id":"MDU6SXNzdWUxNTY0ODQxMTc=","number":18546,"title":"Parser raises an exception if interval is set to \"0.1s\" but works fine with \"100ms\"","user":{"login":"rporres","id":2647973,"node_id":"MDQ6VXNlcjI2NDc5NzM=","avatar_url":"https://avatars3.githubusercontent.com/u/2647973?v=4","gravatar_id":"","url":"https://api.github.com/users/rporres","html_url":"https://github.com/rporres","followers_url":"https://api.github.com/users/rporres/followers","following_url":"https://api.github.com/users/rporres/following{/other_user}","gists_url":"https://api.github.com/users/rporres/gists{/gist_id}","starred_url":"https://api.github.com/users/rporres/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rporres/subscriptions","organizations_url":"https://api.github.com/users/rporres/orgs","repos_url":"https://api.github.com/users/rporres/repos","events_url":"https://api.github.com/users/rporres/events{/privacy}","received_events_url":"https://api.github.com/users/rporres/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2016-05-24T11:30:19Z","updated_at":"2016-05-24T15:21:38Z","closed_at":"2016-05-24T15:21:37Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: `2.3.2`\n\n**JVM version**: \n\n```\nopenjdk version \"1.8.0_45-internal\"\nOpenJDK Runtime Environment (build 1.8.0_45-internal-b14)\nOpenJDK 64-Bit Server VM (build 25.45-b02, mixed mode)\n```\n\n**OS version**: `Ubuntu 12.04.5 LTS (GNU/Linux 3.2.0-80-virtual x86_64)`\n\n**Description of the problem including expected versus actual behavior**: date_histogram aggregations fail if interval is set to `0.1s` but work fine if set to `100ms`. I would say the problem comes from the parser and it doesn't have anything to do with date_histograms.\n\n**Steps to reproduce**:\n1. Following query fails\n\n```\ncurl -XGET 'http://localhost:9200/logstash-2016.05.23/_search?pretty' -d '\n{\n   \"size\" : 0,\n   \"aggs\" : {\n      \"0\" : {\n         \"aggs\" : {\n            \"0\" : {\n               \"date_histogram\" : {\n                  \"field\" : \"@timestamp\",\n                  \"interval\" : \"0.1s\"\n               }\n            }\n         },\n         \"filter\" : {\n            \"query\" : {\n               \"filtered\" : {\n                  \"query\" : {\n                     \"query_string\" : {\n                        \"query\" : \"*\"\n                     }\n                  },\n                  \"filter\" : {\n                     \"bool\" : {\n                        \"must\" : [\n                           {\n                              \"range\" : {\n                                 \"@timestamp\" : {\n                                    \"to\" : 1464034121806,\n                                    \"from\" : 1464034119663\n                                 }\n                              }\n                           }\n                        ]\n                     }\n                  }\n               }\n            }\n         }\n      }\n   }\n}\n'\n{\n  \"error\" : {\n    \"root_cause\" : [ {\n      \"type\" : \"illegal_argument_exception\",\n      \"reason\" : \"Zero or negative time interval not supported\"\n    } ],\n    \"type\" : \"search_phase_execution_exception\",\n    \"reason\" : \"all shards failed\",\n    \"phase\" : \"query\",\n    \"grouped\" : true,\n    \"failed_shards\" : [ {\n      \"shard\" : 0,\n      \"index\" : \"logstash-2016.05.23\",\n      \"node\" : \"z3wh9XcOQjCIyVjT2H-8qg\",\n      \"reason\" : {\n        \"type\" : \"illegal_argument_exception\",\n        \"reason\" : \"Zero or negative time interval not supported\"\n      }\n    } ]\n  },\n  \"status\" : 400\n}\n```\n\nbut it works fine if I change the `interval` field to the equivalent value `100ms` \n\n```\ncurl -XGET 'http://eln02.useb.cartodb.net:9200/logstash-2016.05.23/_search?pretty' -d '\n{\n   \"size\" : 0,\n   \"aggs\" : {\n      \"0\" : {\n         \"aggs\" : {\n            \"0\" : {\n               \"date_histogram\" : {\n                  \"field\" : \"@timestamp\",\n                  \"interval\" : \"100ms\"\n               }\n            }\n         },\n         \"filter\" : {\n            \"query\" : {\n               \"filtered\" : {\n                  \"query\" : {\n                     \"query_string\" : {\n                        \"query\" : \"*\"\n                     }\n                  },\n                  \"filter\" : {\n                     \"bool\" : {\n                        \"must\" : [\n                           {\n                              \"range\" : {\n                                 \"@timestamp\" : {\n                                    \"to\" : 1464034121806,\n                                    \"from\" : 1464034119663\n                                 }\n                              }\n                           }\n                        ]\n                     }\n                  }\n               }\n            }\n         }\n      }\n   }\n}\n'\n{\n  \"took\" : 304,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n\n(...)\n```\n\n**Provide logs (if relevant)**:\n\n```\n2016-05-24 11:25:06,144][DEBUG][action.search            ] [eln02] All shards failed for phase: [query]\nRemoteTransportException[[eln01][10.0.2.81:9300][indices:data/read/search[phase/query]]]; nested: SearchParseException[failed to parse search source [\n{\n   \"size\" : 0,\n   \"aggs\" : {\n      \"0\" : {\n         \"aggs\" : {\n            \"0\" : {\n               \"date_histogram\" : {\n                  \"field\" : \"@timestamp\",\n                  \"interval\" : \"0.1s\"\n               }\n            }\n         },\n         \"filter\" : {\n            \"query\" : {\n               \"filtered\" : {\n                  \"query\" : {\n                     \"query_string\" : {\n                        \"query\" : \"*\"\n                     }\n                  },\n                  \"filter\" : {\n                     \"bool\" : {\n                        \"must\" : [\n                           {\n                              \"range\" : {\n                                 \"@timestamp\" : {\n                                    \"to\" : 1464034121806,\n                                    \"from\" : 1464034119663\n                                 }\n                              }\n                           }\n                        ]\n                     }\n                  }\n               }\n            }\n         }\n      }\n   }\n}\n]]; nested: IllegalArgumentException[Zero or negative time interval not supported];\nCaused by: SearchParseException[failed to parse search source [\n{\n   \"size\" : 0,\n   \"aggs\" : {\n      \"0\" : {\n         \"aggs\" : {\n            \"0\" : {\n               \"date_histogram\" : {\n                  \"field\" : \"@timestamp\",\n                  \"interval\" : \"0.1s\"\n               }\n            }\n         },\n         \"filter\" : {\n            \"query\" : {\n               \"filtered\" : {\n                  \"query\" : {\n                     \"query_string\" : {\n                        \"query\" : \"*\"\n                     }\n                  },\n                  \"filter\" : {\n                     \"bool\" : {\n                        \"must\" : [\n                           {\n                              \"range\" : {\n                                 \"@timestamp\" : {\n                                    \"to\" : 1464034121806,\n                                    \"from\" : 1464034119663\n                                 }\n                              }\n                           }\n                        ]\n                     }\n                  }\n               }\n            }\n         }\n      }\n   }\n}\n]]; nested: IllegalArgumentException[Zero or negative time interval not supported];\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:855)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:654)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:620)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:371)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:368)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:365)\n    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:300)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.IllegalArgumentException: Zero or negative time interval not supported\n    at org.elasticsearch.common.rounding.TimeZoneRounding$Builder.<init>(TimeZoneRounding.java:62)\n    at org.elasticsearch.common.rounding.TimeZoneRounding.builder(TimeZoneRounding.java:40)\n    at org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramParser.parse(DateHistogramParser.java:184)\n    at org.elasticsearch.search.aggregations.AggregatorParsers.parseAggregators(AggregatorParsers.java:198)\n    at org.elasticsearch.search.aggregations.AggregatorParsers.parseAggregators(AggregatorParsers.java:176)\n    at org.elasticsearch.search.aggregations.AggregatorParsers.parseAggregators(AggregatorParsers.java:103)\n    at org.elasticsearch.search.aggregations.AggregationParseElement.parse(AggregationParseElement.java:60)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:838)\n```\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}