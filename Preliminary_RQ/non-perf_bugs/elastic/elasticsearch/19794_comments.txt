[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237428668","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-237428668","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":237428668,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzQyODY2OA==","user":{"login":"wadey","id":18437,"node_id":"MDQ6VXNlcjE4NDM3","avatar_url":"https://avatars1.githubusercontent.com/u/18437?v=4","gravatar_id":"","url":"https://api.github.com/users/wadey","html_url":"https://github.com/wadey","followers_url":"https://api.github.com/users/wadey/followers","following_url":"https://api.github.com/users/wadey/following{/other_user}","gists_url":"https://api.github.com/users/wadey/gists{/gist_id}","starred_url":"https://api.github.com/users/wadey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wadey/subscriptions","organizations_url":"https://api.github.com/users/wadey/orgs","repos_url":"https://api.github.com/users/wadey/repos","events_url":"https://api.github.com/users/wadey/events{/privacy}","received_events_url":"https://api.github.com/users/wadey/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T01:44:11Z","updated_at":"2016-08-04T01:44:11Z","author_association":"NONE","body":"This seems suspicious: https://github.com/elastic/elasticsearch/blob/v2.3.3/core/src/main/java/org/elasticsearch/transport/RequestHandlerRegistry.java#L78-L80\n\nThis section is only unregistering the task if it fails. The only other way unregister gets called for a task is when `handler` calls `channel.sendResponse` (because TransportChannelWrapper unregisters it then). Are there any cases where `sendResponse` might not be getting called by the handler?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237592245","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-237592245","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":237592245,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzU5MjI0NQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T15:38:07Z","updated_at":"2016-08-04T15:38:07Z","author_association":"MEMBER","body":"@wadey  If `sendResponse` is not getting called it's a problem in itself. We can figure out where it happens by getting a list of currently running/leaking tasks or a heapdump.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237595584","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-237595584","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":237595584,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzU5NTU4NA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T15:48:54Z","updated_at":"2016-08-04T15:48:54Z","author_association":"CONTRIBUTOR","body":"> This section is only unregistering the task if it fails. The only other way unregister gets called for a task is when handler calls channel.sendResponse (because TransportChannelWrapper unregisters it then). Are there any cases where sendResponse might not be getting called by the handler?\n\nWe always send a response even in the case of an exception. I wonder if they pile up due to a node connection drop and we wait for a cluster state update to retry? Do they go away at some point? We wait I think 60 sec by default so they might pile up in the case of a hick-up ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237609674","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-237609674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":237609674,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzYwOTY3NA==","user":{"login":"wadey","id":18437,"node_id":"MDQ6VXNlcjE4NDM3","avatar_url":"https://avatars1.githubusercontent.com/u/18437?v=4","gravatar_id":"","url":"https://api.github.com/users/wadey","html_url":"https://github.com/wadey","followers_url":"https://api.github.com/users/wadey/followers","following_url":"https://api.github.com/users/wadey/following{/other_user}","gists_url":"https://api.github.com/users/wadey/gists{/gist_id}","starred_url":"https://api.github.com/users/wadey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wadey/subscriptions","organizations_url":"https://api.github.com/users/wadey/orgs","repos_url":"https://api.github.com/users/wadey/repos","events_url":"https://api.github.com/users/wadey/events{/privacy}","received_events_url":"https://api.github.com/users/wadey/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T16:37:14Z","updated_at":"2016-08-04T16:37:14Z","author_association":"NONE","body":"> We can figure out where it happens by getting a list of currently running/leaking tasks or a heapdump.\n\n@imotov I don't feel comfortable sharing the heapdump as it contains a lot of internal information, but I'm trying to look through it and help debug this (I work with Max the original reporter in the forums). I am going to try to enable debug/trace logging for the related Replication class files to see if I can see any errors or retries happening.\n\n> Do they go away at some point? We wait I think 60 sec by default so they might pile up in the case of a hick-up ?\n\n@s1monw There are ReplicationTasks that are multiple days old inside of the `tasks` map. Example:\n\n![visualvm_1_3_8](https://cloud.githubusercontent.com/assets/18437/17410060/0fbb3b72-5a40-11e6-823d-5f3aa38a81a3.png)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237621682","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-237621682","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":237621682,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzYyMTY4Mg==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T17:20:46Z","updated_at":"2016-08-04T17:35:06Z","author_association":"MEMBER","body":"@wadey Thanks! This is useful. Are most of these tasks say \"indices:data/writes/bulk[s]\" in the action field? Could you give any more information about the state of the cluster for the last few day? Are all shards available for this index? Have you seen any failures? Did you have a lot of node restarts? \n\nThe original forum post indicates that the following plugins are used: searchguard-ssl, stats, and head.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237628713","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-237628713","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":237628713,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzYyODcxMw==","user":{"login":"dopey","id":1820847,"node_id":"MDQ6VXNlcjE4MjA4NDc=","avatar_url":"https://avatars0.githubusercontent.com/u/1820847?v=4","gravatar_id":"","url":"https://api.github.com/users/dopey","html_url":"https://github.com/dopey","followers_url":"https://api.github.com/users/dopey/followers","following_url":"https://api.github.com/users/dopey/following{/other_user}","gists_url":"https://api.github.com/users/dopey/gists{/gist_id}","starred_url":"https://api.github.com/users/dopey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dopey/subscriptions","organizations_url":"https://api.github.com/users/dopey/orgs","repos_url":"https://api.github.com/users/dopey/repos","events_url":"https://api.github.com/users/dopey/events{/privacy}","received_events_url":"https://api.github.com/users/dopey/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T17:45:44Z","updated_at":"2016-08-04T17:45:44Z","author_association":"NONE","body":"Hey @imotov. The cluster state has been green (all shards are available) since the last rolling restart which was ~ 1week ago. We did restart 1 node yesterday after we made a request to he `_task` api which caused an OOM on the server, but in general we don't see restarts until we need to do a rolling restart of the whole cluster due to memory pressure. Nothing in the logs to indicate any failures. No connection dropping, no master elections, just `create mapping` and `update mapping` lines from when the log index rolls over. We use 3 plugins: elasticsearch-statsd, elasticsearch-head, and search-guard-ssl. We have 2 clusters: a staging cluster with 3 servers, and a production cluster with 5 servers. The staging cluster has ~400million documents and the production one has ~1billion. We normally have ~2.5weeks in staging before we need to rolling restart the cluster, and ~1.5 weeks in production.\n\nLooking into the action field question.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237637114","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-237637114","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":237637114,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzYzNzExNA==","user":{"login":"wadey","id":18437,"node_id":"MDQ6VXNlcjE4NDM3","avatar_url":"https://avatars1.githubusercontent.com/u/18437?v=4","gravatar_id":"","url":"https://api.github.com/users/wadey","html_url":"https://github.com/wadey","followers_url":"https://api.github.com/users/wadey/followers","following_url":"https://api.github.com/users/wadey/following{/other_user}","gists_url":"https://api.github.com/users/wadey/gists{/gist_id}","starred_url":"https://api.github.com/users/wadey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wadey/subscriptions","organizations_url":"https://api.github.com/users/wadey/orgs","repos_url":"https://api.github.com/users/wadey/repos","events_url":"https://api.github.com/users/wadey/events{/privacy}","received_events_url":"https://api.github.com/users/wadey/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T18:14:20Z","updated_at":"2016-08-04T18:14:20Z","author_association":"NONE","body":"> Are most of these tasks say \"indices:data/writes/bulk[s]\" in the action field?\n\n@imotov I used [MAT](http://www.eclipse.org/mat/) to do a group by, here are the ReplicationTasks grouped by `action`:\n\n<img width=\"546\" alt=\"eclipse_memory_analyzer\" src=\"https://cloud.githubusercontent.com/assets/18437/17413048/b3bce4ca-5a4d-11e6-9837-8f9d993b32e2.png\">\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237661414","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-237661414","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":237661414,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzY2MTQxNA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T19:42:00Z","updated_at":"2016-08-04T19:42:00Z","author_association":"MEMBER","body":"@wadey and @dopey thanks a lot for providing an awesome bug report. The information that you provided and timely responses were really helpful and I was able to reproduce the issue locally. It looks like an issue is in the `searchguard-ssl` plugin that you are using. I opened floragunncom/search-guard-ssl/pull/31 It fixes the issue for me. Since it doesn't seem to be an elasticsearch bug, I am going to close this issue for now. Please, feel free to reopen if needed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238701864","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-238701864","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":238701864,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODcwMTg2NA==","user":{"login":"floragunn","id":11678154,"node_id":"MDQ6VXNlcjExNjc4MTU0","avatar_url":"https://avatars3.githubusercontent.com/u/11678154?v=4","gravatar_id":"","url":"https://api.github.com/users/floragunn","html_url":"https://github.com/floragunn","followers_url":"https://api.github.com/users/floragunn/followers","following_url":"https://api.github.com/users/floragunn/following{/other_user}","gists_url":"https://api.github.com/users/floragunn/gists{/gist_id}","starred_url":"https://api.github.com/users/floragunn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/floragunn/subscriptions","organizations_url":"https://api.github.com/users/floragunn/orgs","repos_url":"https://api.github.com/users/floragunn/repos","events_url":"https://api.github.com/users/floragunn/events{/privacy}","received_events_url":"https://api.github.com/users/floragunn/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T21:45:16Z","updated_at":"2016-08-09T21:45:16Z","author_association":"NONE","body":"Bug is fixed with version 15 of Search Guard SSL (released today). Thx @imotov for providing a fix.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238950870","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-238950870","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":238950870,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODk1MDg3MA==","user":{"login":"wadey","id":18437,"node_id":"MDQ6VXNlcjE4NDM3","avatar_url":"https://avatars1.githubusercontent.com/u/18437?v=4","gravatar_id":"","url":"https://api.github.com/users/wadey","html_url":"https://github.com/wadey","followers_url":"https://api.github.com/users/wadey/followers","following_url":"https://api.github.com/users/wadey/following{/other_user}","gists_url":"https://api.github.com/users/wadey/gists{/gist_id}","starred_url":"https://api.github.com/users/wadey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wadey/subscriptions","organizations_url":"https://api.github.com/users/wadey/orgs","repos_url":"https://api.github.com/users/wadey/repos","events_url":"https://api.github.com/users/wadey/events{/privacy}","received_events_url":"https://api.github.com/users/wadey/received_events","type":"User","site_admin":false},"created_at":"2016-08-10T18:01:51Z","updated_at":"2016-08-10T18:01:51Z","author_association":"NONE","body":"Thanks @imotov @nik9000 @floragunncom (and anyone else I missed) for the quick work in investigating and getting this resolved!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/240495208","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-240495208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":240495208,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MDQ5NTIwOA==","user":{"login":"trentcioran","id":212241,"node_id":"MDQ6VXNlcjIxMjI0MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/212241?v=4","gravatar_id":"","url":"https://api.github.com/users/trentcioran","html_url":"https://github.com/trentcioran","followers_url":"https://api.github.com/users/trentcioran/followers","following_url":"https://api.github.com/users/trentcioran/following{/other_user}","gists_url":"https://api.github.com/users/trentcioran/gists{/gist_id}","starred_url":"https://api.github.com/users/trentcioran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trentcioran/subscriptions","organizations_url":"https://api.github.com/users/trentcioran/orgs","repos_url":"https://api.github.com/users/trentcioran/repos","events_url":"https://api.github.com/users/trentcioran/events{/privacy}","received_events_url":"https://api.github.com/users/trentcioran/received_events","type":"User","site_admin":false},"created_at":"2016-08-17T18:01:56Z","updated_at":"2016-08-17T18:01:56Z","author_association":"NONE","body":"Hi, any idea when this fix will made available on a new version of elasticsearch? Thanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/240496569","html_url":"https://github.com/elastic/elasticsearch/issues/19794#issuecomment-240496569","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19794","id":240496569,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MDQ5NjU2OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-08-17T18:05:51Z","updated_at":"2016-08-17T18:05:51Z","author_association":"MEMBER","body":"@trentcioran The issue is with the plugin, not Elasticsearch, and a fix for the plugin has been made [available](https://github.com/floragunncom).\n","performed_via_github_app":null}]