{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/46350","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46350/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46350/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46350/events","html_url":"https://github.com/elastic/elasticsearch/issues/46350","id":489408824,"node_id":"MDU6SXNzdWU0ODk0MDg4MjQ=","number":46350,"title":"shouldStoreResult is not set correctly","user":{"login":"nchouard","id":31971995,"node_id":"MDQ6VXNlcjMxOTcxOTk1","avatar_url":"https://avatars2.githubusercontent.com/u/31971995?v=4","gravatar_id":"","url":"https://api.github.com/users/nchouard","html_url":"https://github.com/nchouard","followers_url":"https://api.github.com/users/nchouard/followers","following_url":"https://api.github.com/users/nchouard/following{/other_user}","gists_url":"https://api.github.com/users/nchouard/gists{/gist_id}","starred_url":"https://api.github.com/users/nchouard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nchouard/subscriptions","organizations_url":"https://api.github.com/users/nchouard/orgs","repos_url":"https://api.github.com/users/nchouard/repos","events_url":"https://api.github.com/users/nchouard/events{/privacy}","received_events_url":"https://api.github.com/users/nchouard/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":16,"created_at":"2019-09-04T21:31:52Z","updated_at":"2020-08-13T08:56:46Z","closed_at":"2020-08-13T08:56:46Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.5.3\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: 1.8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Darwin Kernel Version 18.6.0\r\n\r\n**Description of the problem including expected versus actual behavior**: \r\n\r\nWhen trying to make an updateByQuery call with the Java RestHighLevelClient, `shouldStoreResult` is always false, even if you explicitly set the request object to true. The updateByQuery tasks are not stored when they have finished or failed and when you try to retrieve them, and exception is thrown.\r\n\r\n**Steps to reproduce**: \r\n\r\n 1. Create an UpdateByQueryRequest and set `shouldStoreResult`:\r\n```\r\nUpdateByQueryRequest request = UpdateByQueryRequest(\"index\").setShouldStoreResult(true).setScript(new Script(ScriptType.STORED, null, scriptId, params));\r\n```\r\n 2. Call updateByQueryAsync:\r\n```\r\nrestClient.updateByQueryAsync(request, RequestOptions.DEFAULT, listener);\r\n```\r\n 3. Get the list of tasks, and then try to retrieve the task by id in Kibana:\r\n```\r\nListTasksRequest request = new ListTasksRequest().setActions(\"*byquery\").setDetailed(true);\r\nListTasksResponse response = esRestClient.tasks().list(request, RequestOptions.DEFAULT);\r\n```\r\n```\r\n// kibana\r\nGET _tasks/:taskId\r\n```\r\n**Provide logs (if relevant)**:\r\nKibana error when you try to fetch\r\n```\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"resource_not_found_exception\",\r\n        \"reason\" : \"task [24XlcEQtRfa1FI5rkpioGw:65213] isn't running and hasn't stored its results\"\r\n      }\r\n    ],\r\n    \"type\" : \"resource_not_found_exception\",\r\n    \"reason\" : \"task [24XlcEQtRfa1FI5rkpioGw:65213] isn't running and hasn't stored its results\"\r\n  },\r\n  \"status\" : 404\r\n}\r\n```","closed_by":{"login":"andreidan","id":1217601,"node_id":"MDQ6VXNlcjEyMTc2MDE=","avatar_url":"https://avatars2.githubusercontent.com/u/1217601?v=4","gravatar_id":"","url":"https://api.github.com/users/andreidan","html_url":"https://github.com/andreidan","followers_url":"https://api.github.com/users/andreidan/followers","following_url":"https://api.github.com/users/andreidan/following{/other_user}","gists_url":"https://api.github.com/users/andreidan/gists{/gist_id}","starred_url":"https://api.github.com/users/andreidan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreidan/subscriptions","organizations_url":"https://api.github.com/users/andreidan/orgs","repos_url":"https://api.github.com/users/andreidan/repos","events_url":"https://api.github.com/users/andreidan/events{/privacy}","received_events_url":"https://api.github.com/users/andreidan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}