{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30654","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30654/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30654/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30654/events","html_url":"https://github.com/elastic/elasticsearch/issues/30654","id":323629055,"node_id":"MDU6SXNzdWUzMjM2MjkwNTU=","number":30654,"title":"Simple pipe aggregation","user":{"login":"liverpoologic","id":34872813,"node_id":"MDQ6VXNlcjM0ODcyODEz","avatar_url":"https://avatars0.githubusercontent.com/u/34872813?v=4","gravatar_id":"","url":"https://api.github.com/users/liverpoologic","html_url":"https://github.com/liverpoologic","followers_url":"https://api.github.com/users/liverpoologic/followers","following_url":"https://api.github.com/users/liverpoologic/following{/other_user}","gists_url":"https://api.github.com/users/liverpoologic/gists{/gist_id}","starred_url":"https://api.github.com/users/liverpoologic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liverpoologic/subscriptions","organizations_url":"https://api.github.com/users/liverpoologic/orgs","repos_url":"https://api.github.com/users/liverpoologic/repos","events_url":"https://api.github.com/users/liverpoologic/events{/privacy}","received_events_url":"https://api.github.com/users/liverpoologic/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-05-16T13:48:08Z","updated_at":"2018-05-16T14:22:00Z","closed_at":"2018-05-16T14:22:00Z","author_association":"NONE","active_lock_reason":null,"body":"I am trying to create a simple aggregation pipe to determine the difference between two aggregate values within a bucket.\r\nAny help / ideas appreciated\r\n\r\nexample code below (returns error below)\r\n\r\n```js\r\n    \"aggs\": {\r\n        \"groupbyuser\": {\r\n            \"terms\": {\r\n                \"field\": \"user\"\r\n            },\r\n            \"aggs\": {\r\n                \"first_transaction\": {\r\n                    \"min\": {\r\n                        \"field\": \"timestamp\"\r\n                    }\r\n                },\r\n                \"last_transaction\": {\r\n                    \"max\": {\r\n                        \"field\": \"timestamp\"\r\n                    }\r\n                },\r\n                \"session_length\": {\r\n                    \"bucket_script\": {\r\n                        \"buckets_path\": {\r\n                            \"start\":\"first_transaction\",\r\n                            \"end\":\"last_transaction\"\r\n                        },\r\n                        \"script\":\"params.end - params.start\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\n```\r\n{\r\n    \"error\": {\r\n        \"root_cause\": [],\r\n        \"type\": \"reduce_search_phase_exception\",\r\n        \"reason\": \"[reduce] \",\r\n        \"phase\": \"fetch\",\r\n        \"grouped\": true,\r\n        \"failed_shards\": [],\r\n        \"caused_by\": {\r\n            \"type\": \"script_exception\",\r\n            \"reason\": \"failed to run inline script [params.end - params.start] using lang [groovy]\",\r\n            \"caused_by\": {\r\n                \"type\": \"missing_property_exception\",\r\n                \"reason\": \"No such property: params for class: xxxxxxxxxxxxx\"\r\n            }\r\n        }\r\n    },\r\n    \"status\": 503\r\n}\r\n```","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}