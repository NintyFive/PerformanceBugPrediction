[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363432783","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363432783","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":363432783,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzQzMjc4Mw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-02-06T14:09:31Z","updated_at":"2018-02-06T14:09:31Z","author_association":"CONTRIBUTOR","body":"@azsolinsky How did you determine for this to be the cause? Looking at `DiscoNodesCache`, which is the class that does the caching, it seems to account for the empty list. If the returned list is empty, no caching should be happening. The only possible fault I can find with the `DiscoNodesCache` class is that the `empty` variable might not be concurrency-safe.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363844396","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363844396","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":363844396,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Mzg0NDM5Ng==","user":{"login":"azsolinsky","id":22183636,"node_id":"MDQ6VXNlcjIyMTgzNjM2","avatar_url":"https://avatars3.githubusercontent.com/u/22183636?v=4","gravatar_id":"","url":"https://api.github.com/users/azsolinsky","html_url":"https://github.com/azsolinsky","followers_url":"https://api.github.com/users/azsolinsky/followers","following_url":"https://api.github.com/users/azsolinsky/following{/other_user}","gists_url":"https://api.github.com/users/azsolinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/azsolinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azsolinsky/subscriptions","organizations_url":"https://api.github.com/users/azsolinsky/orgs","repos_url":"https://api.github.com/users/azsolinsky/repos","events_url":"https://api.github.com/users/azsolinsky/events{/privacy}","received_events_url":"https://api.github.com/users/azsolinsky/received_events","type":"User","site_admin":false},"created_at":"2018-02-07T17:24:24Z","updated_at":"2018-02-08T02:30:19Z","author_association":"NONE","body":"Ok, how did you determine no caching is happening if it returns an empty list?\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/139deb535a58de87c602888a121b2791bcd22df2/plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java#L239:L243\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/139deb535a58de87c602888a121b2791bcd22df2/server/src/main/java/org/elasticsearch/common/util/SingleObjectCache.java#L54:L64\r\n\r\nIf empty list is returned the SIngleObjectCache will certainly cache it; only if the response were null would it not be cached; the code doesn't distinguish between empty list and and non-empty list; why do you think it will not cache the empty list?\r\n\r\n(EDIT: I see now that the needsRefresh() was overridden, thus making it refresh on the next call and preventing it from effectively being cached -- I missed this in my initial inspection of the code)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363940089","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363940089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":363940089,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Mzk0MDA4OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-02-07T22:57:46Z","updated_at":"2018-02-07T22:58:45Z","author_association":"MEMBER","body":"@azsolinsky The `empty` variable is set if the returned list is empty, which means `needsRefresh()` will return `true`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363960608","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363960608","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":363960608,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Mzk2MDYwOA==","user":{"login":"azsolinsky","id":22183636,"node_id":"MDQ6VXNlcjIyMTgzNjM2","avatar_url":"https://avatars3.githubusercontent.com/u/22183636?v=4","gravatar_id":"","url":"https://api.github.com/users/azsolinsky","html_url":"https://github.com/azsolinsky","followers_url":"https://api.github.com/users/azsolinsky/followers","following_url":"https://api.github.com/users/azsolinsky/following{/other_user}","gists_url":"https://api.github.com/users/azsolinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/azsolinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azsolinsky/subscriptions","organizations_url":"https://api.github.com/users/azsolinsky/orgs","repos_url":"https://api.github.com/users/azsolinsky/repos","events_url":"https://api.github.com/users/azsolinsky/events{/privacy}","received_events_url":"https://api.github.com/users/azsolinsky/received_events","type":"User","site_admin":false},"created_at":"2018-02-08T00:31:15Z","updated_at":"2018-02-08T00:31:15Z","author_association":"NONE","body":"Ok. Won't it still use the empty list for that call though as opposed to using the last good response? Suppose it stays throttled for 30 seconds?\n\nOn Feb 7, 2018, at 2:59 PM, Ryan Ernst <notifications@github.com<mailto:notifications@github.com>> wrote:\n\n\n@azsolinsky<https://github.com/azsolinsky> The empty variable is set if the returned list is empty, which means needsRefresh() will always return true.\n\n-\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub<https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363940089>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AVJ-1IWzS8F-YAyQHEjVo0xfjLQiihUqks5tSiqvgaJpZM4RzWpi>.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363960919","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363960919","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":363960919,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Mzk2MDkxOQ==","user":{"login":"azsolinsky","id":22183636,"node_id":"MDQ6VXNlcjIyMTgzNjM2","avatar_url":"https://avatars3.githubusercontent.com/u/22183636?v=4","gravatar_id":"","url":"https://api.github.com/users/azsolinsky","html_url":"https://github.com/azsolinsky","followers_url":"https://api.github.com/users/azsolinsky/followers","following_url":"https://api.github.com/users/azsolinsky/following{/other_user}","gists_url":"https://api.github.com/users/azsolinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/azsolinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azsolinsky/subscriptions","organizations_url":"https://api.github.com/users/azsolinsky/orgs","repos_url":"https://api.github.com/users/azsolinsky/repos","events_url":"https://api.github.com/users/azsolinsky/events{/privacy}","received_events_url":"https://api.github.com/users/azsolinsky/received_events","type":"User","site_admin":false},"created_at":"2018-02-08T00:32:40Z","updated_at":"2018-02-08T00:32:40Z","author_association":"NONE","body":"Also that means there is a potential issue with retrying the call too much without exponential back off.\n\nJeff S\n\nOn Feb 7, 2018, at 2:59 PM, Ryan Ernst <notifications@github.com<mailto:notifications@github.com>> wrote:\n\n\n@azsolinsky<https://github.com/azsolinsky> The empty variable is set if the returned list is empty, which means needsRefresh() will always return true.\n\n-\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub<https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363940089>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AVJ-1IWzS8F-YAyQHEjVo0xfjLQiihUqks5tSiqvgaJpZM4RzWpi>.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363981149","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363981149","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":363981149,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Mzk4MTE0OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-02-08T02:21:55Z","updated_at":"2018-02-08T02:21:55Z","author_association":"MEMBER","body":"I'm not saying the current behavior is good or correct, just that it will not \"cache the empty list\" as was originally stated in this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363982176","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-363982176","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":363982176,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Mzk4MjE3Ng==","user":{"login":"azsolinsky","id":22183636,"node_id":"MDQ6VXNlcjIyMTgzNjM2","avatar_url":"https://avatars3.githubusercontent.com/u/22183636?v=4","gravatar_id":"","url":"https://api.github.com/users/azsolinsky","html_url":"https://github.com/azsolinsky","followers_url":"https://api.github.com/users/azsolinsky/followers","following_url":"https://api.github.com/users/azsolinsky/following{/other_user}","gists_url":"https://api.github.com/users/azsolinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/azsolinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azsolinsky/subscriptions","organizations_url":"https://api.github.com/users/azsolinsky/orgs","repos_url":"https://api.github.com/users/azsolinsky/repos","events_url":"https://api.github.com/users/azsolinsky/events{/privacy}","received_events_url":"https://api.github.com/users/azsolinsky/received_events","type":"User","site_admin":false},"created_at":"2018-02-08T02:27:59Z","updated_at":"2018-02-08T02:27:59Z","author_association":"NONE","body":"Ok, your point is taken. I took for granted that needsRefresh was being overridden, and thought it would not refresh on a second call. I updated the title. However, I think the behavior during throttling still needs to be addressed to protect the service from spikes calling the describe instance call API in the case of throttling.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/364598725","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-364598725","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":364598725,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NDU5ODcyNQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-02-09T23:27:44Z","updated_at":"2018-02-09T23:27:44Z","author_association":"MEMBER","body":"@azsolinsky I've marked this as an `adoptme`. Do you have any interesting in working on a PR?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/364973608","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-364973608","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":364973608,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NDk3MzYwOA==","user":{"login":"azsolinsky","id":22183636,"node_id":"MDQ6VXNlcjIyMTgzNjM2","avatar_url":"https://avatars3.githubusercontent.com/u/22183636?v=4","gravatar_id":"","url":"https://api.github.com/users/azsolinsky","html_url":"https://github.com/azsolinsky","followers_url":"https://api.github.com/users/azsolinsky/followers","following_url":"https://api.github.com/users/azsolinsky/following{/other_user}","gists_url":"https://api.github.com/users/azsolinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/azsolinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azsolinsky/subscriptions","organizations_url":"https://api.github.com/users/azsolinsky/orgs","repos_url":"https://api.github.com/users/azsolinsky/repos","events_url":"https://api.github.com/users/azsolinsky/events{/privacy}","received_events_url":"https://api.github.com/users/azsolinsky/received_events","type":"User","site_admin":false},"created_at":"2018-02-12T16:16:30Z","updated_at":"2018-02-12T16:16:30Z","author_association":"NONE","body":"I have interest, but I'm not sure about my availability; I'll have to get back on it in the near future.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/474476073","html_url":"https://github.com/elastic/elasticsearch/issues/28452#issuecomment-474476073","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28452","id":474476073,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDQ3NjA3Mw==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-03-19T17:14:38Z","updated_at":"2019-03-19T17:14:38Z","author_association":"CONTRIBUTOR","body":"@azsolinsky thanks for your interest in improving elasticsearch. We discussed this internally and do not currently intend to work on this in the foreseeable future. I will therefore close this issue. If you still have an interest in improving this, feel free to open a pull request for it.","performed_via_github_app":null}]