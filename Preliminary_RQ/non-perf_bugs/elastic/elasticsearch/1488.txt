{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1488","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1488/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1488/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1488/events","html_url":"https://github.com/elastic/elasticsearch/issues/1488","id":2328744,"node_id":"MDU6SXNzdWUyMzI4NzQ0","number":1488,"title":"Scalable Sharding","user":{"login":"folke","id":292349,"node_id":"MDQ6VXNlcjI5MjM0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/292349?v=4","gravatar_id":"","url":"https://api.github.com/users/folke","html_url":"https://github.com/folke","followers_url":"https://api.github.com/users/folke/followers","following_url":"https://api.github.com/users/folke/following{/other_user}","gists_url":"https://api.github.com/users/folke/gists{/gist_id}","starred_url":"https://api.github.com/users/folke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/folke/subscriptions","organizations_url":"https://api.github.com/users/folke/orgs","repos_url":"https://api.github.com/users/folke/repos","events_url":"https://api.github.com/users/folke/events{/privacy}","received_events_url":"https://api.github.com/users/folke/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2011-11-23T11:33:38Z","updated_at":"2013-12-18T11:34:31Z","closed_at":"2013-12-18T11:34:31Z","author_association":"NONE","active_lock_reason":null,"body":"The sharding that is currently possible with Elasticsearch is already great. But if you want to scale to really very big datasets, then you can still experience performance issues.\n\nSuppose that you have 1 big index spread over 10 shards. In this case, Elastic still needs to perform searches on 10 shards (ideally on 10 different servers in parallel).\n\nAnother approach could be to have some kind of user configurable sharding in place. For example, in our case (we are a social media platform), we do not use Elastic sharding, but have our own custom sharding on top where we create indices for every topic and every month. This means that for a search of the last 30 days, at most, we need to search on the shard for this month and the shard for last month.\n\nThe same approach could be done on text fields. Suppose that we have setup 10 shards and do sharding on the field \"contents\". Instead of pushing the data to one of the shards, we could first perform an analysis step on the \"contents\" field to break up in words and then for each word, determine the servers responsible for that word. On those servers, we then index the document. The result of this would be that there would be more redundance on storing the documents (and as such adding documents will also take longer), but when searching, we can immediately determine based on the query what servers need to be searched (only those responsible for the data ranges that contain the analyzed words in the query). (key distribution could be done based on hashing and hashing ranges per server, similar to how for example Redis or Memcache work)\n\nMultiple sharding keys should als be possible.\n\nWith this custom sharding, it should be possible to scale datasets to billions of documents. There will be redundant storage, but queries will be alot faster. For example in a 100 server setup, one search with 100 shards could potentially take a long time. With the custom sharding, only a few servers would need to be queried.\n","closed_by":{"login":"folke","id":292349,"node_id":"MDQ6VXNlcjI5MjM0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/292349?v=4","gravatar_id":"","url":"https://api.github.com/users/folke","html_url":"https://github.com/folke","followers_url":"https://api.github.com/users/folke/followers","following_url":"https://api.github.com/users/folke/following{/other_user}","gists_url":"https://api.github.com/users/folke/gists{/gist_id}","starred_url":"https://api.github.com/users/folke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/folke/subscriptions","organizations_url":"https://api.github.com/users/folke/orgs","repos_url":"https://api.github.com/users/folke/repos","events_url":"https://api.github.com/users/folke/events{/privacy}","received_events_url":"https://api.github.com/users/folke/received_events","type":"User","site_admin":false},"performed_via_github_app":null}