[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71703645","html_url":"https://github.com/elastic/elasticsearch/issues/9448#issuecomment-71703645","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448","id":71703645,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzAzNjQ1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T18:46:17Z","updated_at":"2015-01-27T18:46:17Z","author_association":"CONTRIBUTOR","body":"Hi @ieb \n\nI'm not a Java person, but it is quite possible to add new types with new or existing parent types:\n\n```\nDELETE test \n\nPUT /test \n{\n  \"mappings\": {\n    \"child\": {\n      \"_parent\": {\n        \"type\": \"parent\"\n      }\n    },\n    \"parent\": {}\n  }\n}\n\nPUT /test/_mapping/new_parent\n{\n  \"properties\": {}\n}\n\nPUT /test/_mapping/new_child\n{\n  \"_parent\": {\n    \"type\": \"new_parent\"\n  }\n}\n\nPUT /test/_mapping/other_child\n{\n  \"_parent\": {\n    \"type\": \"parent\"\n  }\n}\n\nGET /_mapping\n```\n\nIt looks like a bug in the way you're doing it.  I suggest asking in the mailing list for help with that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71799006","html_url":"https://github.com/elastic/elasticsearch/issues/9448#issuecomment-71799006","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448","id":71799006,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzk5MDA2","user":{"login":"ieb","id":68709,"node_id":"MDQ6VXNlcjY4NzA5","avatar_url":"https://avatars2.githubusercontent.com/u/68709?v=4","gravatar_id":"","url":"https://api.github.com/users/ieb","html_url":"https://github.com/ieb","followers_url":"https://api.github.com/users/ieb/followers","following_url":"https://api.github.com/users/ieb/following{/other_user}","gists_url":"https://api.github.com/users/ieb/gists{/gist_id}","starred_url":"https://api.github.com/users/ieb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ieb/subscriptions","organizations_url":"https://api.github.com/users/ieb/orgs","repos_url":"https://api.github.com/users/ieb/repos","events_url":"https://api.github.com/users/ieb/events{/privacy}","received_events_url":"https://api.github.com/users/ieb/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T08:42:51Z","updated_at":"2015-01-28T08:42:51Z","author_association":"NONE","body":"@clintongormley \nI will ask on list, but your example PUT requests are not representative of the bug being reported. \nThe failure happens when index and type exist but the type has no _parent field.\nIn your examples the index exists, but the types don't exist and are created when the mapping is made.\n\nThe Java call works if the type does not exist. (as per your PUT examples)\n\nObviously this \"bug\" could be \"working as designed\".... which would be a pity.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71805135","html_url":"https://github.com/elastic/elasticsearch/issues/9448#issuecomment-71805135","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448","id":71805135,"node_id":"MDEyOklzc3VlQ29tbWVudDcxODA1MTM1","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T09:33:49Z","updated_at":"2015-01-28T09:33:49Z","author_association":"MEMBER","body":"@ieb Indeed. I can reproduce your \"issue\" using REST. So it's not related to Java API.\n\n```\nDELETE test \nPUT test\n\nPUT /test/_mapping/parent\n{\n  \"properties\": {}\n}\n\nPUT /test/_mapping/child\n{\n  \"properties\": {}\n}\n\nPUT /test/_mapping/child\n{\n  \"_parent\": {\n    \"type\": \"new_parent\"\n  }\n}\n```\n\nGives:\n\n```\n{\n   \"error\": \"MergeMappingException[Merge failed with failures {[The _parent field's type option can't be changed]}]\",\n   \"status\": 400\n}\n```\n\nThis is by design. See here: https://github.com/elasticsearch/elasticsearch/blob/1.4/src/main/java/org/elasticsearch/index/mapper/internal/ParentFieldMapper.java#L367-370\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71805450","html_url":"https://github.com/elastic/elasticsearch/issues/9448#issuecomment-71805450","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448","id":71805450,"node_id":"MDEyOklzc3VlQ29tbWVudDcxODA1NDUw","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T09:36:03Z","updated_at":"2015-01-28T09:36:03Z","author_association":"MEMBER","body":"BTW if you have no document already you can remove the type.\n\n```\nDELETE test \nPUT test\n\nPUT /test/_mapping/parent\n{\n  \"properties\": {}\n}\n\nPUT /test/_mapping/child\n{\n  \"properties\": {}\n}\n\nDELETE test/_mapping/child\n\nPUT /test/_mapping/child\n{\n  \"_parent\": {\n    \"type\": \"new_parent\"\n  }\n}\n```\n\nThis is working.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71805673","html_url":"https://github.com/elastic/elasticsearch/issues/9448#issuecomment-71805673","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448","id":71805673,"node_id":"MDEyOklzc3VlQ29tbWVudDcxODA1Njcz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T09:37:40Z","updated_at":"2015-01-28T09:37:40Z","author_association":"CONTRIBUTOR","body":"@ieb ah ok - like I said I'm not a Java person.  As @dadoonet said, this is by design.  You can't change this mapping after the fact.  Even if one shard has no documents in that type, that shard has no way of knowing if the same is true on other nodes.\n\n> BTW if you have no document already you can remove the type.\n\nNote that this functionality is dangerous and will be removed (https://github.com/elasticsearch/elasticsearch/issues/8877)\n","performed_via_github_app":null}]