[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/402772032","html_url":"https://github.com/elastic/elasticsearch/issues/31801#issuecomment-402772032","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31801","id":402772032,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjc3MjAzMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-05T16:02:24Z","updated_at":"2018-07-05T16:02:24Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404484420","html_url":"https://github.com/elastic/elasticsearch/issues/31801#issuecomment-404484420","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31801","id":404484420,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDQ4NDQyMA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-07-12T11:44:38Z","updated_at":"2018-07-12T11:44:38Z","author_association":"CONTRIBUTOR","body":"When printing `master_left` (the WARN one), the nodes execute the `ZenDiscovery.rejoin` method and remove the active master from their local cluster state. During pinging, they will then not broadcast knowledge of an active master. Can you check if the above WARN message was logged on all nodes? Can you check if there's a follow-up log message indicating that the master has been readded to the cluster state?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/406221463","html_url":"https://github.com/elastic/elasticsearch/issues/31801#issuecomment-406221463","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31801","id":406221463,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjIyMTQ2Mw==","user":{"login":"itiyama","id":7935367,"node_id":"MDQ6VXNlcjc5MzUzNjc=","avatar_url":"https://avatars3.githubusercontent.com/u/7935367?v=4","gravatar_id":"","url":"https://api.github.com/users/itiyama","html_url":"https://github.com/itiyama","followers_url":"https://api.github.com/users/itiyama/followers","following_url":"https://api.github.com/users/itiyama/following{/other_user}","gists_url":"https://api.github.com/users/itiyama/gists{/gist_id}","starred_url":"https://api.github.com/users/itiyama/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itiyama/subscriptions","organizations_url":"https://api.github.com/users/itiyama/orgs","repos_url":"https://api.github.com/users/itiyama/repos","events_url":"https://api.github.com/users/itiyama/events{/privacy}","received_events_url":"https://api.github.com/users/itiyama/received_events","type":"User","site_admin":false},"created_at":"2018-07-19T09:52:32Z","updated_at":"2018-07-19T09:52:32Z","author_association":"NONE","body":"Yes, I checked.  The above WARN was logged on all 8 data nodes.\r\nThere is no follow-up log message indicating that the master has been re-added. In fact, the log WARN message appeared after 1.5 hours for a different master eligible node when the old master was terminated","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/406339708","html_url":"https://github.com/elastic/elasticsearch/issues/31801#issuecomment-406339708","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31801","id":406339708,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjMzOTcwOA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-07-19T16:37:43Z","updated_at":"2018-07-19T16:37:43Z","author_association":"CONTRIBUTOR","body":"Are you using any `discovery.zen.*` settings that deviate from the defaults?\r\nCan you try setting `discovery.zen.master_election.ignore_non_master_pings` to `true` and see if that helps?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/406355251","html_url":"https://github.com/elastic/elasticsearch/issues/31801#issuecomment-406355251","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31801","id":406355251,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjM1NTI1MQ==","user":{"login":"itiyama","id":7935367,"node_id":"MDQ6VXNlcjc5MzUzNjc=","avatar_url":"https://avatars3.githubusercontent.com/u/7935367?v=4","gravatar_id":"","url":"https://api.github.com/users/itiyama","html_url":"https://github.com/itiyama","followers_url":"https://api.github.com/users/itiyama/followers","following_url":"https://api.github.com/users/itiyama/following{/other_user}","gists_url":"https://api.github.com/users/itiyama/gists{/gist_id}","starred_url":"https://api.github.com/users/itiyama/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itiyama/subscriptions","organizations_url":"https://api.github.com/users/itiyama/orgs","repos_url":"https://api.github.com/users/itiyama/repos","events_url":"https://api.github.com/users/itiyama/events{/privacy}","received_events_url":"https://api.github.com/users/itiyama/received_events","type":"User","site_admin":false},"created_at":"2018-07-19T17:31:38Z","updated_at":"2018-07-19T17:31:38Z","author_association":"NONE","body":"Are you using any discovery.zen.* settings that deviate from the defaults?\r\n>I am using default `discovery.zen.*` settings.\r\n\r\nCan you try setting discovery.zen.master_election.ignore_non_master_pings to true and see if that helps?\r\n> I can, but why do you think that would help- Also, since I don't know the exact steps to reproduce the scenario, verifying if that works might be tricky.\r\n\r\nJust a thought- It appeared to me as though the cluster state did not change even though the master fault detection stopped- which further caused the stale data to be present in cluster state. If we can have some staleness associated with the master value stored in cluster state- master would have been re-elected even though the fault detection stopped due to whatever reason. We should know the concurrency issue which did not change(or revert) the cluster state when master pings stopped- but invalidating master entries in the cluster state would have helped here.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411643858","html_url":"https://github.com/elastic/elasticsearch/issues/31801#issuecomment-411643858","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31801","id":411643858,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTY0Mzg1OA==","user":{"login":"itiyama","id":7935367,"node_id":"MDQ6VXNlcjc5MzUzNjc=","avatar_url":"https://avatars3.githubusercontent.com/u/7935367?v=4","gravatar_id":"","url":"https://api.github.com/users/itiyama","html_url":"https://github.com/itiyama","followers_url":"https://api.github.com/users/itiyama/followers","following_url":"https://api.github.com/users/itiyama/following{/other_user}","gists_url":"https://api.github.com/users/itiyama/gists{/gist_id}","starred_url":"https://api.github.com/users/itiyama/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itiyama/subscriptions","organizations_url":"https://api.github.com/users/itiyama/orgs","repos_url":"https://api.github.com/users/itiyama/repos","events_url":"https://api.github.com/users/itiyama/events{/privacy}","received_events_url":"https://api.github.com/users/itiyama/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T05:45:56Z","updated_at":"2018-08-09T05:45:56Z","author_association":"NONE","body":"Please provide a response to this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412502667","html_url":"https://github.com/elastic/elasticsearch/issues/31801#issuecomment-412502667","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31801","id":412502667,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjUwMjY2Nw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-08-13T12:34:22Z","updated_at":"2018-08-13T12:34:22Z","author_association":"CONTRIBUTOR","body":"> I can, but why do you think that would help\r\n\r\nThe scenario you described had all master-eligible nodes restart. If it's the data nodes having poisonous information about who they think is the master, this setting will make sure that the active mastership information by data nodes is discarded, i.e., only the values coming from the cluster state of the master-eligible nodes will be trusted for that information, and as those have been restarted, they will not contain info about mastership of any node, thereby allowing a proper election.\r\n\r\n> but invalidating master entries in the cluster state would have helped here.\r\n\r\nWe should not be building new features into some components just to work around bugs in other components. If there's a bug here, we need to find and fix it.\r\n\r\nOnce the cluster is in this situation, it would be interesting to see on each node what their local cluster state looks like (`GET /_cluster/state?local`) in order to check if they all properly consider the master to have stepped down (i.e. no current master in their cluster state). If there's a node that mistakenly considers the master to still be present, take a heap dump which allows us to further inspect the state.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448554116","html_url":"https://github.com/elastic/elasticsearch/issues/31801#issuecomment-448554116","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31801","id":448554116,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODU1NDExNg==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-12-19T10:57:31Z","updated_at":"2018-12-19T10:57:31Z","author_association":"CONTRIBUTOR","body":"The changes in #32006 mean that we are now much more picky about the nodes that we consider to be \"live\" during the discovery phase, and a master is chosen from the known-live nodes more sensibly. In particular, we check that we're actually connected to a node during discovery, so I think this poisonous situation can no longer occur.","performed_via_github_app":null}]