{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27601","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27601/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27601/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27601/events","html_url":"https://github.com/elastic/elasticsearch/issues/27601","id":277985192,"node_id":"MDU6SXNzdWUyNzc5ODUxOTI=","number":27601,"title":"Include original index name (if renamed during restore) in snapshot restore exceptions","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":151561891,"node_id":"MDU6TGFiZWwxNTE1NjE4OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Logging","name":":Core/Infra/Logging","color":"0e8a16","default":false,"description":"Log management and logging utilities"},{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-11-30T03:20:14Z","updated_at":"2018-05-01T13:16:39Z","closed_at":"2018-05-01T13:16:39Z","author_association":"MEMBER","active_lock_reason":null,"body":"ES 2.4, 5.6\r\n\r\nTo reproduce:\r\n\r\n1.  Take a snapshot of an index named \"teststring\" which has 5 shards \r\n2.  Create an empty index named \"teststring2\" with 1 shard\r\n3.  Close teststring2 index\r\n4.  Restore teststring index but as part of the snapshot restore call, rename it to \"teststring2\"\r\n\r\nThen you will get the following message (which is expected, because the target index already exists and has 1 shard defined, when the index from the snapshot has 5 shards):\r\n\r\n```\r\n[2017-11-29T19:06:50,047][WARN ][o.e.s.RestoreService     ] [fHsaf5F] [snapshot1/-nwyRmMVQPSgeoR_xDy5wA] failed to restore snapshot\r\norg.elasticsearch.snapshots.SnapshotRestoreException: [my_es_backup_repro:snapshot1/-nwyRmMVQPSgeoR_xDy5wA] cannot restore index [teststring2] with [1] shard from snapshot with [5] shards\r\n\tat org.elasticsearch.snapshots.RestoreService$1.validateExistingIndex(RestoreService.java:404) ~[elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.snapshots.RestoreService$1.execute(RestoreService.java:302) ~[elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.cluster.ClusterStateUpdateTask.execute(ClusterStateUpdateTask.java:45) ~[elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.cluster.service.ClusterService.executeTasks(ClusterService.java:634) ~[elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.cluster.service.ClusterService.calculateTaskOutputs(ClusterService.java:612) ~[elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.cluster.service.ClusterService.runTasks(ClusterService.java:571) [elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.cluster.service.ClusterService$ClusterServiceTaskBatcher.run(ClusterService.java:263) [elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) [elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) [elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569) [elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:247) [elasticsearch-5.6.0.jar:5.6.0]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:210) [elasticsearch-5.6.0.jar:5.6.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_111]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_111]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_111]\r\n```\r\n\r\nThe above warning is confusing because there is no mention of the original index name (in this case \"teststring\") from the snapshot at all (there are no other messages related to the restore failure that includes the original index name either).  If I am the one who issued the initial restore call, then I would certainly know that I have renamed it, but for admins who have to look back at previous failures for restores that were performed by someone else, it can be confusing because all you get is the renamed index name, and this renamed index name is likely not going to be present in the original snapshot.  What will be helpful is if there is some indication of where the snapshot with [5] shards is coming from (i.e. the original index name from the snapshot) as part of these exceptions/warnings.\r\n\r\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}