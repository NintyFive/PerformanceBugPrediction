[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303958260","html_url":"https://github.com/elastic/elasticsearch/issues/24847#issuecomment-303958260","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24847","id":303958260,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzk1ODI2MA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-05-25T08:50:39Z","updated_at":"2017-05-25T08:50:39Z","author_association":"MEMBER","body":"@mrec I think the documentation is correct here and working as expected because the OR and AND operators are expected to act on the arguments left and right of them much like `+`, `-`, `*`, `/` do in arithmetic. This is, at least from my experience, normal behaviour for boolean operators too (except NOT which is a unary operator os only acts on the argument to the right of it)\r\n\r\nWhen you specify `A AND B` you are saying that the query should match only if both A and B evaluate to true. When precedence is defined it dictates the order in which the operators are evaluated and each operator assumes only the __immediate argument either side of it at that point in the evaluation__. So if you specify `A OR B AND C` it will first evaluate the `AND` operator with only the arguments immediately either side of the operator so in this case it will evaluate `B AND C`. Lets assume that evaluates to `true`, the expression then becomes `A OR true`, then the OR operator can be evaluated to complete the expression and obtain a result.\r\n\r\nI don't believe this is a quirk of Lucene or Elasticsearch, as far as I know its the way boolean precedence is usually defined (in some cases no precedence is defined and the order of evaluation is strictly left to right but when it is defined I believe its always defined this way).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303960241","html_url":"https://github.com/elastic/elasticsearch/issues/24847#issuecomment-303960241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24847","id":303960241,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzk2MDI0MQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-05-25T09:00:46Z","updated_at":"2017-05-25T09:11:39Z","author_association":"MEMBER","body":"Ignore the above, you are right that there is an issue, exactly because of what I wrote above which is not honoured by the query above ðŸ˜„  I misread your explanation after your example, sorry","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303962045","html_url":"https://github.com/elastic/elasticsearch/issues/24847#issuecomment-303962045","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24847","id":303962045,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzk2MjA0NQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-05-25T09:10:42Z","updated_at":"2017-05-25T09:10:42Z","author_association":"MEMBER","body":"We should fix the documentation to explain the unexpected behaviour of using `AND` and `OR` in the `query_string` query and IMO we should also encourage people to not use `NOT/AND/OR` and instead use the `+/-` unary operators to define what should, must, and must not match for a document to be considered a hit much like the conclusion of [the article linked above suggests](https://lucidworks.com/2011/12/28/why-not-and-or-and-not/).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416193113","html_url":"https://github.com/elastic/elasticsearch/issues/24847#issuecomment-416193113","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24847","id":416193113,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjE5MzExMw==","user":{"login":"ekalgolas","id":10568682,"node_id":"MDQ6VXNlcjEwNTY4Njgy","avatar_url":"https://avatars3.githubusercontent.com/u/10568682?v=4","gravatar_id":"","url":"https://api.github.com/users/ekalgolas","html_url":"https://github.com/ekalgolas","followers_url":"https://api.github.com/users/ekalgolas/followers","following_url":"https://api.github.com/users/ekalgolas/following{/other_user}","gists_url":"https://api.github.com/users/ekalgolas/gists{/gist_id}","starred_url":"https://api.github.com/users/ekalgolas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ekalgolas/subscriptions","organizations_url":"https://api.github.com/users/ekalgolas/orgs","repos_url":"https://api.github.com/users/ekalgolas/repos","events_url":"https://api.github.com/users/ekalgolas/events{/privacy}","received_events_url":"https://api.github.com/users/ekalgolas/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T11:11:26Z","updated_at":"2018-08-27T11:11:26Z","author_association":"CONTRIBUTOR","body":"@mrec @colings86 This is already fixed in master. The doc now states:\r\n\r\nThe familiar boolean operators `AND`, `OR` and `NOT` (also written `&&`, `||`\r\nand `!`) are also supported but beware that they do not honor the usual\r\nprecedence rules, so parentheses should be used whenever multiple operators are\r\nused together. For instance the previous query could be rewritten as:\r\n\r\n`((quick AND fox) OR (brown AND fox) OR fox) AND NOT news`::\r\n\r\nThis form now replicates the logic from the original query correctly, but\r\nthe relevance scoring bears little resemblance to the original.\r\n\r\nIn contrast, the same query rewritten using the <<query-dsl-match-query,`match` query>>\r\nwould look like this:\r\n\r\n    {\r\n        \"bool\": {\r\n            \"must\":     { \"match\": \"fox\"         },\r\n            \"should\":   { \"match\": \"quick brown\" },\r\n            \"must_not\": { \"match\": \"news\"        }\r\n        }\r\n    }","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/480374010","html_url":"https://github.com/elastic/elasticsearch/issues/24847#issuecomment-480374010","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24847","id":480374010,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MDM3NDAxMA==","user":{"login":"kat257","id":18668178,"node_id":"MDQ6VXNlcjE4NjY4MTc4","avatar_url":"https://avatars3.githubusercontent.com/u/18668178?v=4","gravatar_id":"","url":"https://api.github.com/users/kat257","html_url":"https://github.com/kat257","followers_url":"https://api.github.com/users/kat257/followers","following_url":"https://api.github.com/users/kat257/following{/other_user}","gists_url":"https://api.github.com/users/kat257/gists{/gist_id}","starred_url":"https://api.github.com/users/kat257/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kat257/subscriptions","organizations_url":"https://api.github.com/users/kat257/orgs","repos_url":"https://api.github.com/users/kat257/repos","events_url":"https://api.github.com/users/kat257/events{/privacy}","received_events_url":"https://api.github.com/users/kat257/received_events","type":"User","site_admin":false},"created_at":"2019-04-05T18:17:08Z","updated_at":"2019-04-05T18:17:08Z","author_association":"CONTRIBUTOR","body":"Locations to be corrected: \r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#_boolean_operators\r\nhttps://www.elastic.co/guide/en/elasticsearch/client/java-api/current/java-full-text-queries.html","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/480403942","html_url":"https://github.com/elastic/elasticsearch/issues/24847#issuecomment-480403942","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24847","id":480403942,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MDQwMzk0Mg==","user":{"login":"mrec","id":4206148,"node_id":"MDQ6VXNlcjQyMDYxNDg=","avatar_url":"https://avatars0.githubusercontent.com/u/4206148?v=4","gravatar_id":"","url":"https://api.github.com/users/mrec","html_url":"https://github.com/mrec","followers_url":"https://api.github.com/users/mrec/followers","following_url":"https://api.github.com/users/mrec/following{/other_user}","gists_url":"https://api.github.com/users/mrec/gists{/gist_id}","starred_url":"https://api.github.com/users/mrec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrec/subscriptions","organizations_url":"https://api.github.com/users/mrec/orgs","repos_url":"https://api.github.com/users/mrec/repos","events_url":"https://api.github.com/users/mrec/events{/privacy}","received_events_url":"https://api.github.com/users/mrec/received_events","type":"User","site_admin":false},"created_at":"2019-04-05T20:00:06Z","updated_at":"2019-04-05T20:00:06Z","author_association":"NONE","body":"Agreed, the new text looks fine to me. Happy for this to be closed as fixed.\r\n\r\n(I must have missed the update from @ekalgolas - apologies)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/489963715","html_url":"https://github.com/elastic/elasticsearch/issues/24847#issuecomment-489963715","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24847","id":489963715,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4OTk2MzcxNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-05-07T07:17:37Z","updated_at":"2019-05-07T07:17:37Z","author_association":"MEMBER","body":"Docs are already updated so I am closing this issue.","performed_via_github_app":null}]