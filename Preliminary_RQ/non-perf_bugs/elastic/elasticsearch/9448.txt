{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9448/events","html_url":"https://github.com/elastic/elasticsearch/issues/9448","id":55651107,"node_id":"MDU6SXNzdWU1NTY1MTEwNw==","number":9448,"title":"Unable to update a _parent mapping for a type in an index once the index exists, even if no _parent mapping is present for the type.","user":{"login":"ieb","id":68709,"node_id":"MDQ6VXNlcjY4NzA5","avatar_url":"https://avatars2.githubusercontent.com/u/68709?v=4","gravatar_id":"","url":"https://api.github.com/users/ieb","html_url":"https://github.com/ieb","followers_url":"https://api.github.com/users/ieb/followers","following_url":"https://api.github.com/users/ieb/following{/other_user}","gists_url":"https://api.github.com/users/ieb/gists{/gist_id}","starred_url":"https://api.github.com/users/ieb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ieb/subscriptions","organizations_url":"https://api.github.com/users/ieb/orgs","repos_url":"https://api.github.com/users/ieb/repos","events_url":"https://api.github.com/users/ieb/events{/privacy}","received_events_url":"https://api.github.com/users/ieb/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-01-27T17:53:13Z","updated_at":"2015-01-28T09:37:40Z","closed_at":"2015-01-27T18:46:17Z","author_association":"NONE","active_lock_reason":null,"body":"I have many indexes in an ES cluster (due to many tenants of the parent application). Each index contains many types that cannot be determined when the index is created. Once the index is created, its not possible to create further _parent mappings for types that were not known when the index was created. \n\nFrom reading other issues in this tracker, I could only find that the index had to be deleted whenever a new _parent mapping for a type was introduced. In this instance the dataset is too large and required to be online many 9's to make deleting all indexes and re-indexing from scratch on every update to the code base, unworkable.\n\nAre there any workarounds ? Do I have to store each type in a separate index ? (even that will be immensely painful for frequent code updates and require the schema to be fixed well in advance.)\n\nThe code to set the _parent mapping for a type I am using is of the form.  \n  index is the name of the index.\n  type is the type\n  parentType is the parentType for type.\n\n```\nif (client.admin().indices().prepareExists(index).get().isExists()) {\n   GetMappingsResponse mappings = client.admin().indices().prepareGetMappings(index).setTypes(type).get();\n   ImmutableOpenMap<String, ImmutableOpenMap<String, MappingMetaData>> m = mappings.getMappings();\n  if ( m.containsKey(\"1\") && m.get(\"1\").containsKey(type) && m.get(\"1\").get(type).hasParentField() ) {\n       System.err.println(\"Parent mapping for  \"+index+\"/\"+type+\" already exists\");\n  } else {\n       PutMappingResponse create = client.admin().indices().preparePutMapping(index).setType(type).setSource(\"_parent\", \"type=\"+parentType).get();\n\n   ^^^^^^ exception thrown here, note at this point there is no _parent field. The exception message appears misleading ?\n\n\n       System.err.println(\"Add Mapping Ok \"+create.isAcknowledged());\n  }\n} else {\n  System.err.println(\"Index does not exist\");\n  CreateIndexResponse create = client.admin().indices().prepareCreate(index).addMapping(type, \"_parent\",\"type=\"+parentType).get();\n       System.err.println(\"Created Index with Mapping Ok \"+create.isAcknowledged());\n}\n```\n\nException is:\n\n```\norg.elasticsearch.index.mapper.MergeMappingException: Merge failed with failures {[The _parent field's type option can't be changed]}\nat    org.elasticsearch.cluster.metadata.MetaDataMappingService$4.execute(MetaDataMappingService.java:511)\nat org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:329)\nat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:153)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\nat java.lang.Thread.run(Thread.java:744)\n```\n\nApologies if this has been discussed/dealt with before. I searched all issues but could not find an answer.\n\nVersion being used is 1.4.0\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}