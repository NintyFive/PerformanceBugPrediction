{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/362","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/362/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/362/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/362/events","html_url":"https://github.com/elastic/elasticsearch/issues/362","id":308358,"node_id":"MDU6SXNzdWUzMDgzNTg=","number":362,"title":"Search failure when no results are found and sorting by score","user":{"login":"andreiz","id":40809,"node_id":"MDQ6VXNlcjQwODA5","avatar_url":"https://avatars0.githubusercontent.com/u/40809?v=4","gravatar_id":"","url":"https://api.github.com/users/andreiz","html_url":"https://github.com/andreiz","followers_url":"https://api.github.com/users/andreiz/followers","following_url":"https://api.github.com/users/andreiz/following{/other_user}","gists_url":"https://api.github.com/users/andreiz/gists{/gist_id}","starred_url":"https://api.github.com/users/andreiz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreiz/subscriptions","organizations_url":"https://api.github.com/users/andreiz/orgs","repos_url":"https://api.github.com/users/andreiz/repos","events_url":"https://api.github.com/users/andreiz/events{/privacy}","received_events_url":"https://api.github.com/users/andreiz/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":45098,"node_id":"MDU6TGFiZWw0NTA5OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.11.0","name":"v0.11.0","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2010-09-08T21:57:41Z","updated_at":"2010-09-09T12:48:01Z","closed_at":"2010-09-09T12:48:01Z","author_association":"NONE","active_lock_reason":null,"body":"Using ES 0.10.\n\nTo reproduce:\n\n```\ncurl -XPUT 'http://localhost:9200/bug/' -d'{ index: { number_of_shards: 1, number_of_replicas: 0 } }'\ncurl -XPUT 'http://localhost:9200/bug/test/_mapping' -d '    {\n    \"test\" : {\n        \"properties\" : {\n            \"user\" : {\"type\" : \"string\", \"index\" : \"not_analyzed\"},\n            \"title\" : {\"type\" : \"string\", \"boost\" : 2.0},\n            \"notes\" : {\"type\" : \"string\"},\n            \"tags\" : {\"type\" : \"string\", \"index_name\" : \"tag\"},\n            \"created\" : {\"type\" : \"date\", \"format\" : \"YYYY-MM-DD HH:mm:ss\"},\n            \"geo\" : {\"type\" : \"geo_point\"},\n            \"privacy\" : {\"type\" : \"integer\"}\n        }\n    }\n}'\n\n\ncurl -XPUT \"http://localhost:9200/bug/test/1\" -d'{\"tags\": [\"geotagged\", \"w\", \"incendio\", \"puglia\", \"vacanze\", \"peschici\", \"estate2007\", \"leconseguenzedellincendio\", \"geo:lat=41942574\", \"geo:lon=16012316\"], \"notes\": \"\", \"created\": \"2007-08-22 02:52:15\", \"privacy\": 1000, \"user\": \"liberodicrederci\", \"title\": \"incendio peschici\", \"geo\": {\"lat\": 41.942574, \"lon\": 16.012315999999998}}'\ncurl -XPUT \"http://localhost:9200/bug/test/2\" -d'{\"tags\": [\"columbus\", \"georgia\", \"ranger\", \"banquet\", \"airborne\", \"fortbenning\", \"ftbenning\", \"75thrra\"], \"notes\": \"\", \"created\": \"2007-08-21 18:22:20\", \"privacy\": 1000, \"user\": \"rangerpete\", \"title\": \"20070811-191543-1D3-PSP_3298.JPG\", \"geo\": {\"lat\": 32.461877999999999, \"lon\": -84.995496000000003}}'\n\ncurl -XPOST \"http://localhost:9200/bug/test/_search?pretty=true\" -d'\n{\n    \"sort\": [\n        \"_score\",\n        {\"created\": {\"reverse\": true}}\n    ],\n    \"from\": 0, \"size\": 10,\n    \"query\": {\n        \"filtered\": {\n            \"query\": {\n                \"query_string\": {\n                    \"query\": \"thisquerydoesnotexist\",\n                    \"fields\": [\"title\", \"notes\", \"tags\"],\n                    \"default_operator\": \"AND\",\n                    \"use_dis_max\": true\n                }\n            },\n            \"filter\": {\n                \"geo_bounding_box\": {\n                    \"geo\": {\n                         \"top_left\" : {\n                            \"lat\" : 47.55,\n                            \"lon\" : -124.10\n                        },\n                        \"bottom_right\" : {\n                            \"lat\" : 31.06,\n                            \"lon\" : -77\n                        }\n                    }\n                }\n            }\n        }\n    }\n}'\n```\n\nFull backtrace:\n\n```\n[10:49:53,546][DEBUG][action.search.type       ] [USAgent] [photos][0], node[ed4fd2d5-fa99-41ba-b0c0-9c5d46b0472d], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@28acaa28] while moving to second phase\njava.lang.IllegalArgumentException: field can only be null when type is SCORE or DOC\n    at org.apache.lucene.search.SortField.initFieldType(SortField.java:217)\n    at org.apache.lucene.search.SortField.<init>(SortField.java:127)\n    at org.elasticsearch.search.controller.SearchPhaseController.sortDocs(SearchPhaseController.java:106)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.moveToSecondPhase(TransportSearchQueryThenFetchAction.java:85)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.onFirstPhaseResult(TransportSearchTypeAction.java:218)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.access$100(TransportSearchTypeAction.java:80)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$3.onResult(TransportSearchTypeAction.java:196)\n    at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:130)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:77)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:194)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.access$000(TransportSearchTypeAction.java:80)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$1.run(TransportSearchTypeAction.java:153)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n    at java.lang.Thread.run(Thread.java:637)\n```\n","closed_by":null,"performed_via_github_app":null}