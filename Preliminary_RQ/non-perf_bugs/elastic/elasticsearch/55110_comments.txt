[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/612991971","html_url":"https://github.com/elastic/elasticsearch/issues/55110#issuecomment-612991971","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110","id":612991971,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjk5MTk3MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-04-13T17:07:09Z","updated_at":"2020-04-13T17:07:09Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Scripting)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/612992595","html_url":"https://github.com/elastic/elasticsearch/issues/55110#issuecomment-612992595","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110","id":612992595,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjk5MjU5NQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2020-04-13T17:08:29Z","updated_at":"2020-04-13T17:08:29Z","author_association":"CONTRIBUTOR","body":"I don't know the answer offhand so I've tagged the scripting folk. I remember that there is some issue with `List.remove(index)` and `List.remove(item)` that painless bumps into.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/613029589","html_url":"https://github.com/elastic/elasticsearch/issues/55110#issuecomment-613029589","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110","id":613029589,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMzAyOTU4OQ==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2020-04-13T18:29:59Z","updated_at":"2020-04-13T18:29:59Z","author_association":"CONTRIBUTOR","body":"@HighOnWater I believe this isn't working correctly because the code is both reading from the `ctx._source['array1']` list and modifying it at the same time with the remove method. So it's possible to skip one of the fields as the index `i` has already moved past it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/613054493","html_url":"https://github.com/elastic/elasticsearch/issues/55110#issuecomment-613054493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110","id":613054493,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMzA1NDQ5Mw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2020-04-13T19:25:55Z","updated_at":"2020-04-13T19:25:55Z","author_association":"MEMBER","body":"@HighOnWater This isn't a painless issue, nor even a java specific problem. A ConcurrentModificationException is only thrown when a container knows that it is being iterated and modified at the same time. Using indices to access and modify a list will never work (unless special care is taken to adjust the loop index when an element is removed).\r\n\r\nSince there is nothing we can do in painless, or java, to protect from this, I hope you don't mind that I close this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/613056794","html_url":"https://github.com/elastic/elasticsearch/issues/55110#issuecomment-613056794","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110","id":613056794,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMzA1Njc5NA==","user":{"login":"HighOnWater","id":30986640,"node_id":"MDQ6VXNlcjMwOTg2NjQw","avatar_url":"https://avatars1.githubusercontent.com/u/30986640?v=4","gravatar_id":"","url":"https://api.github.com/users/HighOnWater","html_url":"https://github.com/HighOnWater","followers_url":"https://api.github.com/users/HighOnWater/followers","following_url":"https://api.github.com/users/HighOnWater/following{/other_user}","gists_url":"https://api.github.com/users/HighOnWater/gists{/gist_id}","starred_url":"https://api.github.com/users/HighOnWater/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HighOnWater/subscriptions","organizations_url":"https://api.github.com/users/HighOnWater/orgs","repos_url":"https://api.github.com/users/HighOnWater/repos","events_url":"https://api.github.com/users/HighOnWater/events{/privacy}","received_events_url":"https://api.github.com/users/HighOnWater/received_events","type":"User","site_admin":false},"created_at":"2020-04-13T19:31:16Z","updated_at":"2020-04-13T19:32:26Z","author_association":"NONE","body":"Hi @rjernst , while mentioning ConcurrentModificationException, i was digressing a bit. Shouldn't the removal of item from lists work fine with traditional for loops in painless as in java?\r\nIf you look at this snippet:\r\n```\r\nArrayList<String> stringsList = new ArrayList<>();\r\n        stringsList.add(\"Hello\");\r\n        stringsList.add(\"World\");\r\n        stringsList.add(\"Data\");\r\n        stringsList.add(\"World\");\r\n\r\n        for(int i = 0;i < stringsList.size(); i++) {\r\n            if (stringsList.get(i).equals(\"World\"))\r\n                stringsList.remove(i);\r\n        }\r\n```\r\nIt works fine in java. As the documentation specifies, most of the java constructs are supported by painless, shouldn't then the behavior be consistent?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/613062332","html_url":"https://github.com/elastic/elasticsearch/issues/55110#issuecomment-613062332","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110","id":613062332,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMzA2MjMzMg==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2020-04-13T19:43:44Z","updated_at":"2020-04-13T19:43:44Z","author_association":"MEMBER","body":"@HighOnWater Your example happens to work only because of the order you insert the elements. If you instead you use this order, you will see the second instance of \"World\" is left:\r\n\r\n```\r\nstringsList.add(\"Hello\");\r\nstringsList.add(\"World\");\r\nstringsList.add(\"World\");\r\nstringsList.add(\"Data\");\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/613196181","html_url":"https://github.com/elastic/elasticsearch/issues/55110#issuecomment-613196181","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110","id":613196181,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMzE5NjE4MQ==","user":{"login":"HighOnWater","id":30986640,"node_id":"MDQ6VXNlcjMwOTg2NjQw","avatar_url":"https://avatars1.githubusercontent.com/u/30986640?v=4","gravatar_id":"","url":"https://api.github.com/users/HighOnWater","html_url":"https://github.com/HighOnWater","followers_url":"https://api.github.com/users/HighOnWater/followers","following_url":"https://api.github.com/users/HighOnWater/following{/other_user}","gists_url":"https://api.github.com/users/HighOnWater/gists{/gist_id}","starred_url":"https://api.github.com/users/HighOnWater/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HighOnWater/subscriptions","organizations_url":"https://api.github.com/users/HighOnWater/orgs","repos_url":"https://api.github.com/users/HighOnWater/repos","events_url":"https://api.github.com/users/HighOnWater/events{/privacy}","received_events_url":"https://api.github.com/users/HighOnWater/received_events","type":"User","site_admin":false},"created_at":"2020-04-14T02:45:23Z","updated_at":"2020-04-14T02:45:23Z","author_association":"NONE","body":"thanks","performed_via_github_app":null}]