{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396/events","html_url":"https://github.com/elastic/elasticsearch/issues/8396","id":48140359,"node_id":"MDU6SXNzdWU0ODE0MDM1OQ==","number":8396,"title":"ArrayIndexOutOfBoundsException in murmur hash with has_child","user":{"login":"aleph-zero","id":452273,"node_id":"MDQ6VXNlcjQ1MjI3Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/452273?v=4","gravatar_id":"","url":"https://api.github.com/users/aleph-zero","html_url":"https://github.com/aleph-zero","followers_url":"https://api.github.com/users/aleph-zero/followers","following_url":"https://api.github.com/users/aleph-zero/following{/other_user}","gists_url":"https://api.github.com/users/aleph-zero/gists{/gist_id}","starred_url":"https://api.github.com/users/aleph-zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aleph-zero/subscriptions","organizations_url":"https://api.github.com/users/aleph-zero/orgs","repos_url":"https://api.github.com/users/aleph-zero/repos","events_url":"https://api.github.com/users/aleph-zero/events{/privacy}","received_events_url":"https://api.github.com/users/aleph-zero/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":15,"created_at":"2014-11-07T22:48:50Z","updated_at":"2018-02-14T13:29:03Z","closed_at":"2014-12-24T09:04:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Running 1.4.0 it is possible to hang ES.\n\nSteps to reproduce:\nThree processes in a while(true) loop.  One is using the _bulk API to insert (and update) a small random number of documents. The other two processes are executing fairly complex filteredQuery's.\n\nI can run any of the two processes concurrently without problems, but when a the third one starts, ES fails with the exception below.\n\nOther times, the exception doesn't occur but instead ES just hangs and I have to kill -9 its jvm.  \n\n```\n[2014-11-07 16:46:36,175][DEBUG][action.search.type       ] [Hardcore] [2848] Failed to execute query phase\norg.elasticsearch.search.query.QueryPhaseExecutionException: [xxx.public.test.idxtest][2]: query[filtered(ConstantScore(++cache(_xmin:[2882514 TO 2882514]) +cache(_cmin:[* TO 0}) +cache(_xmax:[0 TO 0]) +cache(_xmax:[2882514 TO 2882514]) +cache(_cmax:[0 TO *]) +cache(_xmin_is_committed:T) +cache(_xmax:[0 TO 0]) +cache(_xmax:[2882514 TO 2882514]) +cache(_cmax:[0 TO *]) +NotFilter(cache(_xmax:[2882514 TO 2882514])) +cache(_xmax_is_committed:F) +CustomQueryWrappingFilter(child_filter[data/xact](filtered(ConstantScore(cache(BooleanFilter(_field_names:id))))->cache(_type:data)))))->cache(+_type:xact +org.elasticsearch.index.search.nested.NonNestedDocsFilter@38f048bd)],from[0],size[32768]: Query Failed [Failed to execute main query]\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n    at org.elasticsearch.search.SearchService.executeScan(SearchService.java:245)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$21.call(SearchServiceTransportAction.java:520)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$21.call(SearchServiceTransportAction.java:517)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.RuntimeException: java.lang.ArrayIndexOutOfBoundsException: 13417\n    at org.elasticsearch.search.internal.ContextIndexSearcher.createNormalizedWeight(ContextIndexSearcher.java:136)\n    at org.elasticsearch.index.search.child.CustomQueryWrappingFilter.getDocIdSet(CustomQueryWrappingFilter.java:72)\n    at org.elasticsearch.common.lucene.search.AndFilter.getDocIdSet(AndFilter.java:54)\n    at org.elasticsearch.common.lucene.search.ApplyAcceptedDocsFilter.getDocIdSet(ApplyAcceptedDocsFilter.java:46)\n    at org.apache.lucene.search.ConstantScoreQuery$ConstantWeight.scorer(ConstantScoreQuery.java:157)\n    at org.apache.lucene.search.FilteredQuery$RandomAccessFilterStrategy.filteredScorer(FilteredQuery.java:542)\n    at org.apache.lucene.search.FilteredQuery$1.scorer(FilteredQuery.java:136)\n    at org.apache.lucene.search.FilteredQuery$RandomAccessFilterStrategy.filteredScorer(FilteredQuery.java:542)\n    at org.apache.lucene.search.FilteredQuery$FilterStrategy.filteredBulkScorer(FilteredQuery.java:504)\n    at org.apache.lucene.search.FilteredQuery$1.bulkScorer(FilteredQuery.java:150)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:618)\n    at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:309)\n    at org.elasticsearch.search.scan.ScanContext.execute(ScanContext.java:52)\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:120)\n    ... 7 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 13417\n    at org.apache.lucene.util.StringHelper.murmurhash3_x86_32(StringHelper.java:205)\n    at org.apache.lucene.util.StringHelper.murmurhash3_x86_32(StringHelper.java:229)\n    at org.apache.lucene.util.BytesRef.hashCode(BytesRef.java:143)\n    at org.elasticsearch.common.util.BytesRefHash.add(BytesRefHash.java:151)\n    at org.elasticsearch.index.search.child.ParentIdsFilter.createShortCircuitFilter(ParentIdsFilter.java:67)\n    at org.elasticsearch.index.search.child.ChildrenConstantScoreQuery.createWeight(ChildrenConstantScoreQuery.java:127)\n    at org.apache.lucene.search.IndexSearcher.createNormalizedWeight(IndexSearcher.java:684)\n    at org.elasticsearch.search.internal.ContextIndexSearcher.createNormalizedWeight(ContextIndexSearcher.java:133)\n    ... 21 more\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}