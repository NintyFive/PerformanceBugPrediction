{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/63717","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63717/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63717/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63717/events","html_url":"https://github.com/elastic/elasticsearch/issues/63717","id":722129030,"node_id":"MDU6SXNzdWU3MjIxMjkwMzA=","number":63717,"title":"Restore Elasticsearch from snapshot, doesn't respect attributes in config","user":{"login":"tabbi","id":1536560,"node_id":"MDQ6VXNlcjE1MzY1NjA=","avatar_url":"https://avatars3.githubusercontent.com/u/1536560?v=4","gravatar_id":"","url":"https://api.github.com/users/tabbi","html_url":"https://github.com/tabbi","followers_url":"https://api.github.com/users/tabbi/followers","following_url":"https://api.github.com/users/tabbi/following{/other_user}","gists_url":"https://api.github.com/users/tabbi/gists{/gist_id}","starred_url":"https://api.github.com/users/tabbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabbi/subscriptions","organizations_url":"https://api.github.com/users/tabbi/orgs","repos_url":"https://api.github.com/users/tabbi/repos","events_url":"https://api.github.com/users/tabbi/events{/privacy}","received_events_url":"https://api.github.com/users/tabbi/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-10-15T08:44:47Z","updated_at":"2020-10-16T13:21:23Z","closed_at":"2020-10-16T13:21:11Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`7.4.0`):\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`1.8.0`):\r\n\r\n**OS version** (CentOS 7.8):\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI have a 3 node ElasticSearch (V.7.4.0) Cluster, and i want to move data to new Elasticsearch cluster containing 5 nodes (3 master eligible, and 2 data nodes)\r\nhere is my old cluster overview\r\n \r\n- ES01 (master,data) \r\n- ES02 (master,data)\r\n- ES03 (master,data)\r\n\r\nand here is my new cluster overview \r\n\r\nZone1 (e,g Rack1 in my physical DC)\r\n- ES01 (Master,data,)\r\n- ES02 (DATA)\r\n\r\nZone2\r\n- ES03 (Master,data)\r\n- ES04 (DATA)\r\n\r\nZone3\r\n- ES05 (Master-only)\r\n\r\nso as you can see the main difference from old cluster, is added Racks, so respect of this, i've added following lines in my elasticsearch.yml file\r\n\r\nES01.yml\r\n```\r\ncluster.routing.allocation.awareness.attributes: zone\r\ncluster.routing.allocation.awareness.force.zone.values: zone1,zone2\r\nnode.attr.zone: zone1\r\n```\r\n\r\nES02.yml\r\n\r\n```\r\ncluster.routing.allocation.awareness.attributes: zone\r\ncluster.routing.allocation.awareness.force.zone.values: zone1,zone2\r\nnode.attr.zone: zone1 \r\n```\r\n\r\nES03.yml\r\n\r\n```\r\ncluster.routing.allocation.awareness.attributes: zone\r\ncluster.routing.allocation.awareness.force.zone.values: zone1,zone2\r\nnode.attr.zone: zone2\r\n\r\n```\r\n\r\nES04.yml\r\n\r\n```\r\ncluster.routing.allocation.awareness.attributes: zone\r\ncluster.routing.allocation.awareness.force.zone.values: zone1,zone2\r\nnode.attr.zone: zone2\r\n\r\n```\r\n\r\nES05.yml\r\n\r\n```\r\ncluster.routing.allocation.awareness.attributes: zone\r\ncluster.routing.allocation.awareness.force.zone.values: zone1,zone2\r\n```\r\n\r\nso when i'm restoring data from snapshot from old (3 node cluster without any attributes) to new (5 node cluster with attributes, some primary and replica shards allocated on the same Zone\r\n```\r\n\r\nip-kim-info                             0  p STARTED    126  79.3kb 10.0.87.209 elastic-03\r\nip-kim-info                             0  r STARTED    126  79.3kb 10.0.87.208 elastic-02\r\nnotification                            0  r STARTED 580957   1.7gb 10.0.87.209 elastic-03\r\nnotification                            0  p STARTED 580957   1.7gb 10.0.87.208 elastic-02\r\n\r\n```\r\nas you can see above the notification and ip-kim-info shards are allocated on the nodes which composed in the same Zone\r\n","closed_by":{"login":"tabbi","id":1536560,"node_id":"MDQ6VXNlcjE1MzY1NjA=","avatar_url":"https://avatars3.githubusercontent.com/u/1536560?v=4","gravatar_id":"","url":"https://api.github.com/users/tabbi","html_url":"https://github.com/tabbi","followers_url":"https://api.github.com/users/tabbi/followers","following_url":"https://api.github.com/users/tabbi/following{/other_user}","gists_url":"https://api.github.com/users/tabbi/gists{/gist_id}","starred_url":"https://api.github.com/users/tabbi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabbi/subscriptions","organizations_url":"https://api.github.com/users/tabbi/orgs","repos_url":"https://api.github.com/users/tabbi/repos","events_url":"https://api.github.com/users/tabbi/events{/privacy}","received_events_url":"https://api.github.com/users/tabbi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}