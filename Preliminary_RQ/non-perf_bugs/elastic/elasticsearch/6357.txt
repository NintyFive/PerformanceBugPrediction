{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6357","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6357/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6357/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6357/events","html_url":"https://github.com/elastic/elasticsearch/issues/6357","id":34656506,"node_id":"MDU6SXNzdWUzNDY1NjUwNg==","number":6357,"title":"Random shards do not recover if one index has faulty synonym filter defined","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"assignees":[{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2014-05-30T15:43:06Z","updated_at":"2015-05-22T13:38:24Z","closed_at":"2015-05-22T13:15:18Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I use a synonym filter with the synonyms defined in a text file. 1 node, several indexes with several shards, only one of them uses the synonym filter. When I remove the textfile that contains the synonyms many indexes do not recover when I restart the node. This is random, affected shards and indexes vary.\n\nTo reproduce:\n1. start node and create some indexes with documents\n2. place synonym file in correct folder, create index that uses synonym filter with synonyms from file and index documents (see example below for details)\n3. stop node\n4. remove the synonym file\n5. start node again\n\nI would have expected only the affected index shards not to recover but instead this is completely random.\n\nExample index:\n\n```\nDELETE synonymindex\n\nPUT synonymindex\n{\n   \"settings\": {\n      \"index\": {\n         \"analysis\": {\n            \"analyzer\": {\n               \"synonym\": {\n                  \"tokenizer\": \"whitespace\",\n                  \"filter\": [\n                     \"synonym\"\n                  ]\n               }\n            },\n            \"filter\": {\n               \"synonym\": {\n                  \"type\": \"synonym\",\n                  \"synonyms_path\": \"analysis/synonym.txt\"\n               }\n            }\n         }\n      }\n   },\n   \"mappings\": {\n      \"sometype\": {\n         \"properties\": {\n            \"text\": {\n               \"type\": \"string\",\n               \"analyzer\": \"synonym\"\n            }\n         }\n      }\n   }\n}\n\nPOST synonymindex/sometype\n{\n    \"text\": \"foo\"\n}\n```\n\nthe file analysis/synonym.txt contains only one line:\n\n```\nfoo, bar\n```\n","closed_by":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"performed_via_github_app":null}