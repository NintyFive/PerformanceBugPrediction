{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57543","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57543/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57543/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57543/events","html_url":"https://github.com/elastic/elasticsearch/issues/57543","id":629336071,"node_id":"MDU6SXNzdWU2MjkzMzYwNzE=","number":57543,"title":"[Ingest Pipelines][Append Processor] Adding a \"unique\" argument","user":{"login":"P1llus","id":8027539,"node_id":"MDQ6VXNlcjgwMjc1Mzk=","avatar_url":"https://avatars1.githubusercontent.com/u/8027539?v=4","gravatar_id":"","url":"https://api.github.com/users/P1llus","html_url":"https://github.com/P1llus","followers_url":"https://api.github.com/users/P1llus/followers","following_url":"https://api.github.com/users/P1llus/following{/other_user}","gists_url":"https://api.github.com/users/P1llus/gists{/gist_id}","starred_url":"https://api.github.com/users/P1llus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/P1llus/subscriptions","organizations_url":"https://api.github.com/users/P1llus/orgs","repos_url":"https://api.github.com/users/P1llus/repos","events_url":"https://api.github.com/users/P1llus/events{/privacy}","received_events_url":"https://api.github.com/users/P1llus/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-06-02T16:18:38Z","updated_at":"2020-09-11T13:17:59Z","closed_at":"2020-09-11T13:17:59Z","author_association":"NONE","active_lock_reason":null,"body":"When appending values to specific fields there is currently a need to check if the related value already exists with if conditions.\r\n\r\nIt would be great to add support to check if the value already exists in the array and only append it if it does not.\r\n\r\nIn both Observability and Security usecases, we have the possibility to append related sources to make visualization easier. Fields like \"related.user\", \"related.hash\", \"related.XYZ\" is examples on that.\r\n\r\nThe issue comes down to certain cases where maybe the related user would be in multiple parts of the event.\r\n\r\n```\r\nPOST /_ingest/pipeline/_simulate\r\n{\r\n  \"pipeline\": {\r\n    \"description\": \"_description\",\r\n    \"processors\": [\r\n      {\r\n        \"append\": {\r\n          \"field\": \"related.user\",\r\n          \"value\": \"{{source.user}}\"\r\n        }\r\n      },\r\n      {\r\n        \"append\": {\r\n          \"field\": \"related.user\",\r\n          \"value\": \"{{client.user}}\"\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"docs\": [\r\n    {\r\n      \"_index\": \"index\",\r\n      \"_id\": \"id\",\r\n      \"_source\": {\r\n        \"source\": {\r\n          \"user\": \"testuser\"\r\n        },\r\n        \"client\": {\r\n          \"user\": \"testuser\"\r\n        }\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nIf we could add a \"unique: true\" argument to the append processor here, we could do something like:\r\n\r\n```\r\n{\r\n  \"append\": {\r\n    \"field\": \"related.user\",\r\n    \"value\": \"{{client.user}}\",\r\n    \"unique\": true\r\n  }\r\n}\r\n```\r\n","closed_by":{"login":"danhermann","id":22777892,"node_id":"MDQ6VXNlcjIyNzc3ODky","avatar_url":"https://avatars0.githubusercontent.com/u/22777892?v=4","gravatar_id":"","url":"https://api.github.com/users/danhermann","html_url":"https://github.com/danhermann","followers_url":"https://api.github.com/users/danhermann/followers","following_url":"https://api.github.com/users/danhermann/following{/other_user}","gists_url":"https://api.github.com/users/danhermann/gists{/gist_id}","starred_url":"https://api.github.com/users/danhermann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danhermann/subscriptions","organizations_url":"https://api.github.com/users/danhermann/orgs","repos_url":"https://api.github.com/users/danhermann/repos","events_url":"https://api.github.com/users/danhermann/events{/privacy}","received_events_url":"https://api.github.com/users/danhermann/received_events","type":"User","site_admin":false},"performed_via_github_app":null}