{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15162","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15162/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15162/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15162/events","html_url":"https://github.com/elastic/elasticsearch/issues/15162","id":119808630,"node_id":"MDU6SXNzdWUxMTk4MDg2MzA=","number":15162,"title":"ElasticSearch 1.7.3 crashed and doesn't restart - no logs","user":{"login":"ThomasdOtreppe","id":7316682,"node_id":"MDQ6VXNlcjczMTY2ODI=","avatar_url":"https://avatars0.githubusercontent.com/u/7316682?v=4","gravatar_id":"","url":"https://api.github.com/users/ThomasdOtreppe","html_url":"https://github.com/ThomasdOtreppe","followers_url":"https://api.github.com/users/ThomasdOtreppe/followers","following_url":"https://api.github.com/users/ThomasdOtreppe/following{/other_user}","gists_url":"https://api.github.com/users/ThomasdOtreppe/gists{/gist_id}","starred_url":"https://api.github.com/users/ThomasdOtreppe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ThomasdOtreppe/subscriptions","organizations_url":"https://api.github.com/users/ThomasdOtreppe/orgs","repos_url":"https://api.github.com/users/ThomasdOtreppe/repos","events_url":"https://api.github.com/users/ThomasdOtreppe/events{/privacy}","received_events_url":"https://api.github.com/users/ThomasdOtreppe/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-12-01T21:09:59Z","updated_at":"2015-12-02T11:34:05Z","closed_at":"2015-12-02T11:34:05Z","author_association":"NONE","active_lock_reason":null,"body":"System info:\n- Ubuntu 14.04.3 64 bit LTS\n- ElasticSearch 1.7.3 from Elastic repo\n- 24Gb RAM\n- ~300Gb SSD (more than 250Gb left)\n- No swap\n\nI've been using that install for quite a while with no problem. It suddenly crashed for an unknown reason. Unfortunately, there is no log about the crash and starting it using 'service elasticsearch start' doesn't work; it hangs for about 10 seconds then fails and no logs are generated in /var/log/elasticsearch about it (yes, there are logs but there are from before it crashed).\n\nHere are the last few lines in the log file if that's any useful (indexing_slowlog and search_slowlog are both empty):\n\n```\n[2015-11-30 10:23:17,551][INFO ][cluster.metadata         ] [Tomorrow Man] [logstash-2015.01.30] update_mapping [monit] (dynamic)\n[2015-11-30 10:57:01,403][INFO ][cluster.metadata         ] [Tomorrow Man] [logstash-2015.11.30] update_mapping [snort] (dynamic)\n[2015-11-30 11:43:31,081][INFO ][cluster.metadata         ] [Tomorrow Man] [logstash-2015.11.30] update_mapping [sophos] (dynamic)\n[2015-11-30 12:26:45,955][INFO ][cluster.metadata         ] [Tomorrow Man] [logstash-2015.11.30] update_mapping [fortinet] (dynamic)\n[2015-11-30 12:28:10,743][INFO ][cluster.metadata         ] [Tomorrow Man] [logstash-2015.11.30] update_mapping [fortinet] (dynamic)\n[2015-11-30 13:36:47,798][INFO ][cluster.metadata         ] [Tomorrow Man] [logstash-2015.11.30] update_mapping [auth] (dynamic)\n[2015-11-30 13:37:04,885][INFO ][cluster.metadata         ] [Tomorrow Man] [logstash-2015.11.30] update_mapping [auth] (dynamic)\n[2015-11-30 14:34:35,672][INFO ][cluster.metadata         ] [Tomorrow Man] [logstash-2015.11.30] update_mapping [iptables-dropped] (dynamic)\n[2015-11-30 14:51:38,409][WARN ][monitor.jvm              ] [Tomorrow Man] [gc][young][2427240][80285] duration [1s], collections [1]/[1.7s], total [1s]/[1.7h], memory [10.6gb]->[10.2gb]/[18.9gb], all_pools {[young] [396.7mb]->[1mb]/[399.4mb]}{[survivor] [24.4mb]->[23.2mb]/[49.8mb]}{[old] [10.2gb]->[10.2gb]/[18.5gb]}\n[2015-11-30 14:57:44,552][WARN ][monitor.jvm              ] [Tomorrow Man] [gc][young][2427567][80301] duration [4.1s], collections [1]/[5.1s], total [4.1s]/[1.7h], memory [10.6gb]->[10.2gb]/[18.9gb], all_pools {[young] [398.5mb]->[9.5mb]/[399.4mb]}{[survivor] [22.2mb]->[22.9mb]/[49.8mb]}{[old] [10.2gb]->[10.2gb]/[18.5gb]}\n```\n\nI checked to see if /var/run/elasticsearch had the right privileges/permission and it has (owned by 'elasticsearch' user):\n\n```\n~# ls /var/run/ -al | grep elastic\ndrwxr-xr-x  2 elasticsearch elasticsearch   60 Nov  2 12:23 elasticsearch\n```\n\nI found http://sandlininc.com/?p=747 and added the log line\n\n```\nlog_daemon_msg \"sudo -u $ES_USER $DAEMON $DAEMON_OPTS\"\n```\n\nright before the deamon startup (with start-stop-daemon). Starting it with the sudo command displayed on the screen when trying to start with 'service' works fine and stays up (and displays no errors) but starting it through 'service' still fails:\n\n```\nsudo -u elasticsearch /usr/share/elasticsearch/bin/elasticsearch -d -p /var/run/elasticsearch/elasticsearch.pid --default.config=/etc/elasticsearch/elasticsearch.yml --default.path.home=/usr/share/elasticsearch --default.path.logs=/var/log/elasticsearch --default.path.data=/var/lib/elasticsearch --default.path.work=/tmp/elasticsearch --default.path.conf=/etc/elasticsearch\n```\n\nUnfortunately, updating to 2.1.0 is not an option at this time since another tool we use depends on 1.7.3 to work.\n\nAs mentioned by someone else, there is more than enough disk space (more than 250Gb left). RAM isn't an issue either. the system has 24Gb and there is 19Gb given to ElasticSearch (ES_HEAP_SIZE=19g, in /etc/default/elasticsearch).\n\nI got a little bit of help from the [forum](https://discuss.elastic.co/t/elasticsearch-1-7-3-crashed-and-doesnt-restart-no-logs/) and here is the output of 'bash -x /etc/init.d/elasticsearch start':\n\n```\n+ PATH=/bin:/usr/bin:/sbin:/usr/sbin\n+ NAME=elasticsearch\n+ DESC='Elasticsearch Server'\n+ DEFAULT=/etc/default/elasticsearch\n++ id -u\n+ '[' 0 -ne 0 ']'\n+ . /lib/lsb/init-functions\n+++ run-parts --lsbsysinit --list /lib/lsb/init-functions.d\n++ for hook in '$(run-parts --lsbsysinit --list /lib/lsb/init-functions.d 2>/dev/null)'\n++ '[' -r /lib/lsb/init-functions.d/20-left-info-blocks ']'\n++ . /lib/lsb/init-functions.d/20-left-info-blocks\n++ for hook in '$(run-parts --lsbsysinit --list /lib/lsb/init-functions.d 2>/dev/null)'\n++ '[' -r /lib/lsb/init-functions.d/50-ubuntu-logging ']'\n++ . /lib/lsb/init-functions.d/50-ubuntu-logging\n+++ LOG_DAEMON_MSG=\n++ FANCYTTY=\n++ '[' -e /etc/lsb-base-logging.sh ']'\n++ true\n+ '[' -r /etc/default/rcS ']'\n+ . /etc/default/rcS\n++ UTC=yes\n+ ES_USER=elasticsearch\n+ ES_GROUP=elasticsearch\n+ JDK_DIRS='/usr/lib/jvm/java-8-oracle/ /usr/lib/jvm/j2sdk1.8-oracle/ /usr/lib/jvm/jdk-7-oracle-x64 /usr/lib/jvm/java-7-oracle /usr/lib/jvm/j2sdk1.7-oracle/ /usr/lib/jvm/java-7-openjdk /usr/lib/jvm/java-7-openjdk-amd64/ /usr/lib/jvm/java-7-openjdk-armhf /usr/lib/jvm/java-7-openjdk-i386/ /usr/lib/jvm/default-java'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/java-8-oracle//bin/java -a -z '' ']'\n+ JAVA_HOME=/usr/lib/jvm/java-8-oracle/\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/j2sdk1.8-oracle//bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/jdk-7-oracle-x64/bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/java-7-oracle/bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/j2sdk1.7-oracle//bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/java-7-openjdk/bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/java-7-openjdk-amd64//bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/java-7-openjdk-armhf/bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/java-7-openjdk-i386//bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ for jdir in '$JDK_DIRS'\n+ '[' -r /usr/lib/jvm/default-java/bin/java -a -z /usr/lib/jvm/java-8-oracle/ ']'\n+ export JAVA_HOME\n+ ES_HOME=/usr/share/elasticsearch\n+ MAX_OPEN_FILES=65535\n+ LOG_DIR=/var/log/elasticsearch\n+ DATA_DIR=/var/lib/elasticsearch\n+ WORK_DIR=/tmp/elasticsearch\n+ CONF_DIR=/etc/elasticsearch\n+ CONF_FILE=/etc/elasticsearch/elasticsearch.yml\n+ MAX_MAP_COUNT=262144\n+ PID_DIR=/var/run/elasticsearch\n+ '[' -f /etc/default/elasticsearch ']'\n+ . /etc/default/elasticsearch\n++ ES_HEAP_SIZE=19g\n+ PID_FILE=/var/run/elasticsearch/elasticsearch.pid\n+ DAEMON=/usr/share/elasticsearch/bin/elasticsearch\n+ DAEMON_OPTS='-d -p /var/run/elasticsearch/elasticsearch.pid --default.config=/etc/elasticsearch/elasticsearch.yml --default.path.home=/usr/share/elasticsearch --default.path.logs=/var/log/elasticsearch --default.path.data=/var/lib/elasticsearch --default.path.work=/tmp/elasticsearch --default.path.conf=/etc/elasticsearch'\n+ export ES_HEAP_SIZE\n+ export ES_HEAP_NEWSIZE\n+ export ES_DIRECT_SIZE\n+ export ES_JAVA_OPTS\n+ test -x /usr/share/elasticsearch/bin/elasticsearch\n+ case \"$1\" in\n+ checkJava\n+ '[' -x /usr/lib/jvm/java-8-oracle//bin/java ']'\n+ JAVA=/usr/lib/jvm/java-8-oracle//bin/java\n+ '[' '!' -x /usr/lib/jvm/java-8-oracle//bin/java ']'\n+ '[' -n '' -a -z 19g ']'\n+ log_daemon_msg 'Starting Elasticsearch Server'\n+ '[' -z 'Starting Elasticsearch Server' ']'\n+ log_use_fancy_output\n+ TPUT=/usr/bin/tput\n+ EXPR=/usr/bin/expr\n+ '[' -t 1 ']'\n+ '[' xxterm '!=' x ']'\n+ '[' xxterm '!=' xdumb ']'\n+ '[' -x /usr/bin/tput ']'\n+ '[' -x /usr/bin/expr ']'\n+ /usr/bin/tput hpa 60\n+ /usr/bin/tput setaf 1\n+ '[' -z ']'\n+ FANCYTTY=1\n+ case \"$FANCYTTY\" in\n+ true\n+ /usr/bin/tput xenl\n++ /usr/bin/tput cols\n+ COLS=144\n+ '[' 144 ']'\n+ '[' 144 -gt 6 ']'\n++ /usr/bin/expr 144 - 7\n+ COL=137\n+ log_use_plymouth\n+ '[' n = y ']'\n+ plymouth --ping\n+ printf ' * Starting Elasticsearch Server       '\n * Starting Elasticsearch Server       ++ /usr/bin/expr 144 - 1\n+ /usr/bin/tput hpa 143\n                                                                                                                                               + printf ' '\n ++ pidofproc -p /var/run/elasticsearch/elasticsearch.pid elasticsearch\n++ local pidfile base status specified pid OPTIND\n++ pidfile=\n++ specified=\n++ OPTIND=1\n++ getopts p: opt\n++ case \"$opt\" in\n++ pidfile=/var/run/elasticsearch/elasticsearch.pid\n++ specified=specified\n++ getopts p: opt\n++ shift 2\n++ '[' 1 -ne 1 ']'\n++ base=elasticsearch\n++ '[' '!' specified ']'\n++ '[' -n /var/run/elasticsearch/elasticsearch.pid -a -r /var/run/elasticsearch/elasticsearch.pid ']'\n++ read pid\n++ '[' -n '' ']'\n++ '[' -n specified ']'\n++ '[' -e /var/run/elasticsearch/elasticsearch.pid -a '!' -r /var/run/elasticsearch/elasticsearch.pid ']'\n++ return 3\n+ pid=\n+ '[' -n '' ']'\n+ mkdir -p /var/log/elasticsearch /var/lib/elasticsearch /tmp/elasticsearch\n+ chown elasticsearch:elasticsearch /var/log/elasticsearch /var/lib/elasticsearch /tmp/elasticsearch\n+ '[' -n /var/run/elasticsearch ']'\n+ '[' '!' -e /var/run/elasticsearch ']'\n+ '[' -n /var/run/elasticsearch/elasticsearch.pid ']'\n+ '[' '!' -e /var/run/elasticsearch/elasticsearch.pid ']'\n+ '[' -n 65535 ']'\n+ ulimit -n 65535\n+ '[' -n '' ']'\n+ '[' -n 262144 -a -f /proc/sys/vm/max_map_count ']'\n+ sysctl -q -w vm.max_map_count=262144\n+ log_daemon_msg 'sudo -u elasticsearch /usr/share/elasticsearch/bin/elasticsearch -d -p /var/run/elasticsearch/elasticsearch.pid --default.config=/etc/elasticsearch/elasticsearch.yml --default.path.home=/usr/share/elasticsearch --default.path.logs=/var/log/elasticsearch --default.path.data=/var/lib/elasticsearch --default.path.work=/tmp/elasticsearch --default.path.conf=/etc/elasticsearch'\n+ '[' -z 'sudo -u elasticsearch /usr/share/elasticsearch/bin/elasticsearch -d -p /var/run/elasticsearch/elasticsearch.pid --default.config=/etc/elasticsearch/elasticsearch.yml --default.path.home=/usr/share/elasticsearch --default.path.logs=/var/log/elasticsearch --default.path.data=/var/lib/elasticsearch --default.path.work=/tmp/elasticsearch --default.path.conf=/etc/elasticsearch' ']'\n+ log_use_fancy_output\n+ TPUT=/usr/bin/tput\n+ EXPR=/usr/bin/expr\n+ '[' -t 1 ']'\n+ '[' xxterm '!=' x ']'\n+ '[' xxterm '!=' xdumb ']'\n+ '[' -x /usr/bin/tput ']'\n+ '[' -x /usr/bin/expr ']'\n+ /usr/bin/tput hpa 60\n+ /usr/bin/tput setaf 1\n+ '[' -z 1 ']'\n+ true\n+ case \"$FANCYTTY\" in\n+ true\n+ /usr/bin/tput xenl\n++ /usr/bin/tput cols\n+ COLS=144\n+ '[' 144 ']'\n+ '[' 144 -gt 6 ']'\n++ /usr/bin/expr 144 - 7\n+ COL=137\n+ log_use_plymouth\n+ '[' n = y ']'\n+ plymouth --ping\n+ printf ' * sudo -u elasticsearch /usr/share/elasticsearch/bin/elasticsearch -d -p /var/run/elasticsearch/elasticsearch.pid --default.config=/etc/elasticsearch/elasticsearch.yml --default.path.home=/usr/share/elasticsearch --default.path.logs=/var/log/elasticsearch --default.path.data=/var/lib/elasticsearch --default.path.work=/tmp/elasticsearch --default.path.conf=/etc/elasticsearch       '\n * sudo -u elasticsearch /usr/share/elasticsearch/bin/elasticsearch -d -p /var/run/elasticsearch/elasticsearch.pid --default.config=/etc/elasticsearch/elasticsearch.yml --default.path.home=/usr/share/elasticsearch --default.path.logs=/var/log/elasticsearch --default.path.data=/var/lib/elasticsearch --default.path.work=/tmp/elasticsearch --default.path.conf=/etc/elasticsearch       ++ /usr/bin/expr 144 - 1\n+ /usr/bin/tput hpa 143\n                                                                                                                                               + printf ' '\n + start-stop-daemon --start -b --user elasticsearch -c elasticsearch --pidfile /var/run/elasticsearch/elasticsearch.pid --exec /usr/share/elasticsearch/bin/elasticsearch -- -d -p /var/run/elasticsearch/elasticsearch.pid --default.config=/etc/elasticsearch/elasticsearch.yml --default.path.home=/usr/share/elasticsearch --default.path.logs=/var/log/elasticsearch --default.path.data=/var/lib/elasticsearch --default.path.work=/tmp/elasticsearch --default.path.conf=/etc/elasticsearch\n+ return=0\n+ '[' 0 -eq 0 ']'\n+ i=0\n+ timeout=10\n+ exit 0\n```\n\nAnd I also have a strace file from 'strace -f bash /etc/init.d/elasticsearch start' that I can give for analysis.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}