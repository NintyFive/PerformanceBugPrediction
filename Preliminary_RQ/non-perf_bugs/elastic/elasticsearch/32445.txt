{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32445","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32445/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32445/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32445/events","html_url":"https://github.com/elastic/elasticsearch/issues/32445","id":345352766,"node_id":"MDU6SXNzdWUzNDUzNTI3NjY=","number":32445,"title":"Get Watch API returns 400 error for watch having password in chained http input","user":{"login":"inqueue","id":6099128,"node_id":"MDQ6VXNlcjYwOTkxMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/6099128?v=4","gravatar_id":"","url":"https://api.github.com/users/inqueue","html_url":"https://github.com/inqueue","followers_url":"https://api.github.com/users/inqueue/followers","following_url":"https://api.github.com/users/inqueue/following{/other_user}","gists_url":"https://api.github.com/users/inqueue/gists{/gist_id}","starred_url":"https://api.github.com/users/inqueue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/inqueue/subscriptions","organizations_url":"https://api.github.com/users/inqueue/orgs","repos_url":"https://api.github.com/users/inqueue/repos","events_url":"https://api.github.com/users/inqueue/events{/privacy}","received_events_url":"https://api.github.com/users/inqueue/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-07-27T20:13:19Z","updated_at":"2019-08-23T16:02:13Z","closed_at":"2018-07-30T06:20:14Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**: 6.3.1\r\n\r\nWatches containing one or more chained `http` inputs with redacted passwords are not returned by the Get Watch API. The following example uses a single `http` input. The same occurs with multiple `http` inputs in the chain.\r\n\r\n```\r\nPOST _xpack/watcher/watch/502_errors\r\n{\r\n  \"trigger\": {\r\n    \"schedule\": {\r\n      \"interval\": \"15m\"\r\n    }\r\n  },\r\n  \"input\": {\r\n    \"chain\": {\r\n      \"inputs\": [\r\n        {\r\n          \"bad_gateway\": {\r\n            \"http\": {\r\n              \"request\": {\r\n                \"scheme\": \"https\",\r\n                \"host\": \"host.tld\",\r\n                \"port\": 9200,\r\n                \"method\": \"get\",\r\n                \"path\": \"log-*/_search\",\r\n                \"params\": {},\r\n                \"headers\": {},\r\n                \"auth\": {\r\n                  \"basic\": {\r\n                    \"username\": \"username\",\r\n                    \"password\": \"(┛ಠДಠ)┛彡┻━┻\"\r\n                  }\r\n                },\r\n                \"body\": \"\"\"{ \"size\": 0, \"query\": { \"bool\": { \"must\": [ { \"match_phrase\": { \"log\" : \"*502 bad gateway\" } }, { \"match_phrase\": { \"type\": \"err*\" } }, { \"range\": { \"@timestamp\": { \"gte\": \"now-60m\" } } } ] } }}\"\"\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  \"condition\": {\r\n    \"script\": {\r\n      \"source\": \"return ctx.payload.bad_gateway.hits.total > 0 || ctx.payload.gateway_timeout.hits.total > 0;\",\r\n      \"lang\": \"painless\"\r\n    }\r\n  },\r\n  \"actions\": {\r\n    \"email_alert_either\": {\r\n      \"throttle_period_in_millis\": 3600000,\r\n      \"condition\": {\r\n        \"script\": {\r\n          \"source\": \"ctx.payload._value.3 == 0 || ctx.payload._value.4 == 0\",\r\n          \"lang\": \"painless\"\r\n        }\r\n      },\r\n      \"email\": {\r\n        \"profile\": \"standard\",\r\n        \"from\": \"watcher@domain.tld\",\r\n        \"to\": [\r\n          \"admin@domain.tld\"\r\n        ],\r\n        \"subject\": \"{{ctx.payload._value.0}}\",\r\n        \"body\": {\r\n          \"html\": \"watch_body\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n```\r\n{\r\n  \"_id\": \"502_errors\",\r\n  \"_version\": 1,\r\n  \"created\": true\r\n}\r\n```\r\n\r\n**Fetch Watch**\r\n```\r\nGET _xpack/watcher/watch/502_errors\r\n```\r\n\r\n**Expect**\r\nWatch is returned with `password` field value `::es_redacted::`. \r\n\r\n**Actual**\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"parse_exception\",\r\n        \"reason\": \"found redacted password in field [password]\"\r\n      }\r\n    ],\r\n    \"type\": \"parse_exception\",\r\n    \"reason\": \"could not parse [http] input for watch [502_errors]. failed to parse http request template\",\r\n    \"caused_by\": {\r\n      \"type\": \"parse_exception\",\r\n      \"reason\": \"found redacted password in field [password]\"\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\n**Workaround**\r\nRetrieve the watch by ID directly from the `.watches` system index.\r\n```\r\nGET .watches/doc/502_errors\r\n```\r\n\r\n**Discovery**\r\nThis issue surfaced while attempting to edit the watch with the Kibana Watcher UI. Clicking the watch in the UI results in the `Watcher: Error 400 Bad Request: [parse_exception] found redacted password in field [password]` red banner error at the top of the browser window. The `400` response returned by the Get Watch API prevents Kibana from loading the watch for UI editing.\r\n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}