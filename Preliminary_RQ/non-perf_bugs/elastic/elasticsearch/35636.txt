{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/35636","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35636/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35636/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35636/events","html_url":"https://github.com/elastic/elasticsearch/issues/35636","id":381603360,"node_id":"MDU6SXNzdWUzODE2MDMzNjA=","number":35636,"title":"delete_by_query API \"size\" parameter not supported in the json request in 6.x","user":{"login":"narph","id":1900090,"node_id":"MDQ6VXNlcjE5MDAwOTA=","avatar_url":"https://avatars1.githubusercontent.com/u/1900090?v=4","gravatar_id":"","url":"https://api.github.com/users/narph","html_url":"https://github.com/narph","followers_url":"https://api.github.com/users/narph/followers","following_url":"https://api.github.com/users/narph/following{/other_user}","gists_url":"https://api.github.com/users/narph/gists{/gist_id}","starred_url":"https://api.github.com/users/narph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narph/subscriptions","organizations_url":"https://api.github.com/users/narph/orgs","repos_url":"https://api.github.com/users/narph/repos","events_url":"https://api.github.com/users/narph/events{/privacy}","received_events_url":"https://api.github.com/users/narph/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-11-16T13:39:01Z","updated_at":"2019-07-03T16:20:06Z","closed_at":"2019-07-03T16:20:05Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):6.x\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n**Steps to reproduce**:\r\n\r\ntesting the \"size\" parameter inside the json request\r\n```\r\npost twitter/doc/1\r\n{\r\n \"message\":\"hello1\",\r\n \"num\":2\r\n}\r\npost twitter/doc/2\r\n{\r\n \"message\":\"hello2\",\r\n \"num\":1\r\n}\r\npost twitter/doc/3\r\n{\r\n \"message\":\"hello\",\r\n \"num\":2\r\n}\r\npost twitter/doc/4\r\n{\r\n \"message\":\"hello\",\r\n \"num\":2\r\n}\r\n\r\nget twitter/_search\r\n\r\nPOST twitter/_delete_by_query\r\n{\r\n \"query\": {\r\n   \"bool\": {\r\n     \"must\": [\r\n       {\r\n         \"script\": {\r\n           \"script\": {\r\n             \"lang\": \"expression\",\r\n             \"source\": \"\"\"doc[\"num\"].value ==2\"\"\"\r\n           }\r\n         }\r\n       }\r\n     ]\r\n   }\r\n }\r\n , \"size\":2\r\n}\r\n```\r\nThe get twitter/_search returns 2 docs after the delete_by_query call was executed in ES 5.6.x versions.\r\nBut it will return 1 doc after the call in 6.x (random testing on 6.0.0, 6.4, 6.5 ), it seems that the \"size\" param is ignored in the call, the delete_by_query will remove 3 docs instead of 2.\r\n\r\nIf we add  \"size\" as a query string param then the delete_by_query will delete 2 docs on all versions tested.\r\n```\r\nPOST twitter/_delete_by_query?size=2\r\n{\r\n \"query\": {\r\n   \"bool\": {\r\n     \"must\": [\r\n       {\r\n         \"script\": {\r\n           \"script\": {\r\n             \"lang\": \"expression\",\r\n             \"source\": \"\"\"doc[\"num\"].value ==2\"\"\"\r\n           }\r\n         }\r\n       }\r\n     ]\r\n   }\r\n }\r\n}\r\n```\r\nHas this option been removed starting 6.x?\r\nWas not able to find any of these changes in the es docs as well.\r\n\r\n\r\n","closed_by":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"performed_via_github_app":null}