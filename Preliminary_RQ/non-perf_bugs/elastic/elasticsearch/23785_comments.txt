[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290611499","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290611499","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290611499,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDYxMTQ5OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-03-31T04:14:53Z","updated_at":"2017-03-31T04:14:53Z","author_association":"MEMBER","body":"Can you please do an `ls` in `/usr/share/elasticsearch/lib/` and past the output here? It seems like the upgrade did not remove all previously installed files.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290741470","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290741470","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290741470,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDc0MTQ3MA==","user":{"login":"Gacko","id":935479,"node_id":"MDQ6VXNlcjkzNTQ3OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/935479?v=4","gravatar_id":"","url":"https://api.github.com/users/Gacko","html_url":"https://github.com/Gacko","followers_url":"https://api.github.com/users/Gacko/followers","following_url":"https://api.github.com/users/Gacko/following{/other_user}","gists_url":"https://api.github.com/users/Gacko/gists{/gist_id}","starred_url":"https://api.github.com/users/Gacko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gacko/subscriptions","organizations_url":"https://api.github.com/users/Gacko/orgs","repos_url":"https://api.github.com/users/Gacko/repos","events_url":"https://api.github.com/users/Gacko/events{/privacy}","received_events_url":"https://api.github.com/users/Gacko/received_events","type":"User","site_admin":false},"created_at":"2017-03-31T15:18:30Z","updated_at":"2017-03-31T15:18:30Z","author_association":"NONE","body":"It does remove the old library and installs the new one but attemps to load the old, removed one.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290752961","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290752961","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290752961,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDc1Mjk2MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-03-31T15:57:36Z","updated_at":"2017-03-31T15:57:36Z","author_association":"MEMBER","body":"> It does remove the old library and installs the new one but attemps to load the old, removed one.\r\n\r\nIt's not trying to load an old one, it's checking the manifest of the jar that is actually executing and the manifest of that jar says it's an old version.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290753196","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290753196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290753196,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDc1MzE5Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-03-31T15:58:34Z","updated_at":"2017-03-31T15:58:34Z","author_association":"MEMBER","body":"Can you please send us this jar?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290911676","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290911676","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290911676,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDkxMTY3Ng==","user":{"login":"Gacko","id":935479,"node_id":"MDQ6VXNlcjkzNTQ3OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/935479?v=4","gravatar_id":"","url":"https://api.github.com/users/Gacko","html_url":"https://github.com/Gacko","followers_url":"https://api.github.com/users/Gacko/followers","following_url":"https://api.github.com/users/Gacko/following{/other_user}","gists_url":"https://api.github.com/users/Gacko/gists{/gist_id}","starred_url":"https://api.github.com/users/Gacko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gacko/subscriptions","organizations_url":"https://api.github.com/users/Gacko/orgs","repos_url":"https://api.github.com/users/Gacko/repos","events_url":"https://api.github.com/users/Gacko/events{/privacy}","received_events_url":"https://api.github.com/users/Gacko/received_events","type":"User","site_admin":false},"created_at":"2017-04-01T10:31:28Z","updated_at":"2017-04-01T10:32:19Z","author_association":"NONE","body":"Just to clarify... `yum upgrade` removes files related to the old RPM or no longer included in the new RPM, installs news files from the new RPM and restarts Elasticsearch using SystemD in the `postinst` script, right?\r\n\r\nIs it possible the old JAR is still there when the `postinst` script is called and removed afterwards? Because the old JAR is missing after a simple `yum upgrade` without a `RESTART_ON_UPGRADE` triggered restart and `systemctl restart elasticsearch` works fine, too.\r\n\r\nI'm not having a yum-based box around right now but I'm having a apt-based one running Elasticsearch 5.2.2. I'll backup the `/usr/share/elasticsearch` directory before upgrading and try upgrading later.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290912915","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290912915","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290912915,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDkxMjkxNQ==","user":{"login":"Gacko","id":935479,"node_id":"MDQ6VXNlcjkzNTQ3OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/935479?v=4","gravatar_id":"","url":"https://api.github.com/users/Gacko","html_url":"https://github.com/Gacko","followers_url":"https://api.github.com/users/Gacko/followers","following_url":"https://api.github.com/users/Gacko/following{/other_user}","gists_url":"https://api.github.com/users/Gacko/gists{/gist_id}","starred_url":"https://api.github.com/users/Gacko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gacko/subscriptions","organizations_url":"https://api.github.com/users/Gacko/orgs","repos_url":"https://api.github.com/users/Gacko/repos","events_url":"https://api.github.com/users/Gacko/events{/privacy}","received_events_url":"https://api.github.com/users/Gacko/received_events","type":"User","site_admin":false},"created_at":"2017-04-01T10:57:55Z","updated_at":"2017-04-01T10:57:55Z","author_association":"NONE","body":"Okay. Upgrade works using `apt`. Got to kickstart a virtual box with a `yum`-based distro...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290913725","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290913725","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290913725,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDkxMzcyNQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-01T11:15:35Z","updated_at":"2017-04-01T11:15:35Z","author_association":"MEMBER","body":"> Just to clarify... yum upgrade removes files related to the old RPM or no longer included in the new RPM, installs news files from the new RPM and restarts Elasticsearch using SystemD in the postinst script, right?\r\n\r\nThere are complicated rules around what is preserved regarding config files, but the nut of the situation is other than data, logs, and config, all files are removed from the old installation. After installation, you are correct that a restart is performed with systemd or Sys V init.\r\n\r\n> Is it possible the old JAR is still there when the postinst script is called and removed afterwards?\r\n\r\nNo, the symptoms here are of a completely garbage jar, a jar whose manifest indicates it was built for 5.2.2, but whose code indicates it was built for 5.3.0. This does not match the content of the jars that was distributed with either 5.2.2 or 5.3.0. That's why I asked for the jar, something is incredibly wrong here, and I'm unconvinced our build system produced this jar.\r\n\r\nAlso, to be clear, we have packaging tests that test upgrading from the RPM against all previously released versions in the 5.x series.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290920489","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290920489","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290920489,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDkyMDQ4OQ==","user":{"login":"Gacko","id":935479,"node_id":"MDQ6VXNlcjkzNTQ3OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/935479?v=4","gravatar_id":"","url":"https://api.github.com/users/Gacko","html_url":"https://github.com/Gacko","followers_url":"https://api.github.com/users/Gacko/followers","following_url":"https://api.github.com/users/Gacko/following{/other_user}","gists_url":"https://api.github.com/users/Gacko/gists{/gist_id}","starred_url":"https://api.github.com/users/Gacko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gacko/subscriptions","organizations_url":"https://api.github.com/users/Gacko/orgs","repos_url":"https://api.github.com/users/Gacko/repos","events_url":"https://api.github.com/users/Gacko/events{/privacy}","received_events_url":"https://api.github.com/users/Gacko/received_events","type":"User","site_admin":false},"created_at":"2017-04-01T13:35:30Z","updated_at":"2017-04-01T13:37:00Z","author_association":"NONE","body":"I added the Elasticsearch YUM repository as described here https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html, installed Elasticsearch using `yum install elasticsearch` which was version 5.2.2 at the time, configured it to restart on upgrade and let it run for some time. The next time I did a `yum upgrade` it got updated to 5.3.0 and failed to restart.\r\n\r\nUnfortunately I do not have a backup or snapshot of the box when 5.2.2 was installed nor do I have access to the server at the moment. The only thing I can do is kickstarting a whole new CentOS 7 box and trying to reproduce the exception.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290942601","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290942601","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290942601,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDk0MjYwMQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-01T19:42:34Z","updated_at":"2017-04-01T19:42:34Z","author_association":"MEMBER","body":"> The only thing I can do is kickstarting a whole new CentOS 7 box and trying to reproduce the exception.\r\n\r\nI understand that it will take you time to do this. Yet, without a reliable reproduction or at least the inciminating jar there isn't much we can do here since it does not reproduce. If you do have the time do this, it will be appreciated. Otherwise, we will have to close this as can not reproduce.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290951295","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290951295","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290951295,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDk1MTI5NQ==","user":{"login":"Gacko","id":935479,"node_id":"MDQ6VXNlcjkzNTQ3OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/935479?v=4","gravatar_id":"","url":"https://api.github.com/users/Gacko","html_url":"https://github.com/Gacko","followers_url":"https://api.github.com/users/Gacko/followers","following_url":"https://api.github.com/users/Gacko/following{/other_user}","gists_url":"https://api.github.com/users/Gacko/gists{/gist_id}","starred_url":"https://api.github.com/users/Gacko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gacko/subscriptions","organizations_url":"https://api.github.com/users/Gacko/orgs","repos_url":"https://api.github.com/users/Gacko/repos","events_url":"https://api.github.com/users/Gacko/events{/privacy}","received_events_url":"https://api.github.com/users/Gacko/received_events","type":"User","site_admin":false},"created_at":"2017-04-01T22:28:57Z","updated_at":"2017-04-01T22:28:57Z","author_association":"NONE","body":"I could not reproduce this using a fresh CentOS 7 installation. I'll backup my Elasticsearch installation the next time I do an upgrade from the official Elasticsearch repo using the production system which is running on Oracle Linux.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290962787","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-290962787","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":290962787,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDk2Mjc4Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-02T03:45:40Z","updated_at":"2017-04-02T03:45:40Z","author_association":"MEMBER","body":"Okay, thanks for reporting back, it's appreciated. If this happens again indeed a snapshot of the system in the before state will be helpful but even a copy of the jar in the after state will help tremendously. Cheers!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296923398","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-296923398","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":296923398,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjkyMzM5OA==","user":{"login":"Gacko","id":935479,"node_id":"MDQ6VXNlcjkzNTQ3OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/935479?v=4","gravatar_id":"","url":"https://api.github.com/users/Gacko","html_url":"https://github.com/Gacko","followers_url":"https://api.github.com/users/Gacko/followers","following_url":"https://api.github.com/users/Gacko/following{/other_user}","gists_url":"https://api.github.com/users/Gacko/gists{/gist_id}","starred_url":"https://api.github.com/users/Gacko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gacko/subscriptions","organizations_url":"https://api.github.com/users/Gacko/orgs","repos_url":"https://api.github.com/users/Gacko/repos","events_url":"https://api.github.com/users/Gacko/events{/privacy}","received_events_url":"https://api.github.com/users/Gacko/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T06:12:05Z","updated_at":"2017-04-25T06:12:53Z","author_association":"NONE","body":"I just upgraded from 5.3.0 to 5.3.1. Different JAR, same behavior:\r\n\r\n```\r\nroot@hostname:~# cp -r /usr/share/elasticsearch elasticsearch-5.3.0\r\n\r\nroot@hostname:~# yum --version\r\n3.4.3\r\n  Installed: rpm-4.11.3-21.el7.x86_64 at 2017-03-13 13:35\r\n  Built    : None at 2016-09-02 22:09\r\n  Committed: Florian Festi <ffesti@redhat.com> at 2016-07-26\r\n\r\n  Installed: yum-3.4.3-150.0.1.el7.noarch at 2017-03-13 13:35\r\n  Built    : None at 2016-11-04 05:59\r\n  Committed: EL Errata <el-errata_ww@oracle.com> at 2016-11-03\r\n\r\n  Installed: yum-rhn-plugin-2.6.3-1.el7.noarch at 2017-03-03 14:43\r\n  Built    : Koji at 2016-11-10 10:44\r\n  Committed: Gennadii Altukhov <galt@redhat.com> at 2016-11-09\r\n\r\nroot@hostname:~# yum upgrade elasticsearch\r\nLoaded plugins: langpacks, rhnplugin\r\nThis system is receiving updates from RHN Classic or Red Hat Satellite.\r\nelasticsearch-5.x                                                                                                                                                                                                                                        | 1.3 kB  00:00:00     \r\n[...]                                                                                                                                                                                                                                 | 1.0 kB  00:00:00     \r\nResolving Dependencies\r\n--> Running transaction check\r\n---> Package elasticsearch.noarch 0:5.3.0-1 will be updated\r\n---> Package elasticsearch.noarch 0:5.3.1-1 will be an update\r\n--> Finished Dependency Resolution\r\n\r\nDependencies Resolved\r\n\r\n================================================================================================================================================================================================================================================================================\r\n Package                                                             Arch                                                         Version                                                         Repository                                                               Size\r\n================================================================================================================================================================================================================================================================================\r\nUpdating:\r\n elasticsearch                                                       noarch                                                       5.3.1-1                                                         elasticsearch-5.x                                                        32 M\r\n\r\nTransaction Summary\r\n================================================================================================================================================================================================================================================================================\r\nUpgrade  1 Package\r\n\r\nTotal download size: 32 M\r\nIs this ok [y/d/N]: y\r\nDownloading packages:\r\nDelta RPMs disabled because /usr/bin/applydeltarpm not installed.\r\nelasticsearch-5.3.1.rpm                                                                                                                                                                                                                                  |  32 MB  00:00:02     \r\nRunning transaction check\r\nRunning transaction test\r\nTransaction test succeeded\r\nRunning transaction\r\n  Updating   : elasticsearch-5.3.1-1.noarch                                                                                                                                                                                                                                 1/2 \r\nRestarting elasticsearch service... OK\r\n  Cleanup    : elasticsearch-5.3.0-1.noarch                                                                                                                                                                                                                                 2/2 \r\n  Verifying  : elasticsearch-5.3.1-1.noarch                                                                                                                                                                                                                                 1/2 \r\n  Verifying  : elasticsearch-5.3.0-1.noarch                                                                                                                                                                                                                                 2/2 \r\n\r\nUpdated:\r\n  elasticsearch.noarch 0:5.3.1-1                                                                                                                                                                                                                                                \r\n\r\nComplete!\r\n\r\nroot@hostname:~# tail -n 50 /var/log/elasticsearch/cluster-name.log \r\n[2017-04-25T07:56:55,898][INFO ][o.e.n.Node               ] [node-name] stopping ...\r\n[2017-04-25T07:56:55,929][INFO ][o.e.n.Node               ] [node-name] stopped\r\n[2017-04-25T07:56:55,930][INFO ][o.e.n.Node               ] [node-name] closing ...\r\n[2017-04-25T07:56:55,943][INFO ][o.e.n.Node               ] [node-name] closed\r\n[2017-04-25T07:57:01,521][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-name] uncaught exception in thread [main]\r\norg.elasticsearch.bootstrap.StartupException: org.elasticsearch.bootstrap.BootstrapException: java.io.FileNotFoundException: /usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar (No such file or directory)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:127) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:114) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:58) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.cli.Command.main(Command.java:88) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:91) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:84) ~[elasticsearch-5.3.1.jar:5.3.1]\r\nCaused by: org.elasticsearch.bootstrap.BootstrapException: java.io.FileNotFoundException: /usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar (No such file or directory)\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:232) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:360) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:123) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\t... 6 more\r\nCaused by: java.io.FileNotFoundException: /usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar (No such file or directory)\r\n\tat java.util.zip.ZipFile.open(Native Method) ~[?:1.8.0_121]\r\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:219) ~[?:1.8.0_121]\r\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:149) ~[?:1.8.0_121]\r\n\tat java.util.jar.JarFile.<init>(JarFile.java:166) ~[?:1.8.0_121]\r\n\tat java.util.jar.JarFile.<init>(JarFile.java:103) ~[?:1.8.0_121]\r\n\tat org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:175) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:88) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:230) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:360) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:123) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\t... 6 more\r\n\r\nroot@hostname:~# systemctl start elasticsearch\r\n\r\nroot@hostname:~# tail -n 50 /var/log/elasticsearch/cluster-name.log \r\n[2017-04-25T07:56:55,898][INFO ][o.e.n.Node               ] [node-name] stopping ...\r\n[2017-04-25T07:56:55,929][INFO ][o.e.n.Node               ] [node-name] stopped\r\n[2017-04-25T07:56:55,930][INFO ][o.e.n.Node               ] [node-name] closing ...\r\n[2017-04-25T07:56:55,943][INFO ][o.e.n.Node               ] [node-name] closed\r\n[2017-04-25T07:57:01,521][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-name] uncaught exception in thread [main]\r\norg.elasticsearch.bootstrap.StartupException: org.elasticsearch.bootstrap.BootstrapException: java.io.FileNotFoundException: /usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar (No such file or directory)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:127) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:114) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:58) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.cli.Command.main(Command.java:88) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:91) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:84) ~[elasticsearch-5.3.1.jar:5.3.1]\r\nCaused by: org.elasticsearch.bootstrap.BootstrapException: java.io.FileNotFoundException: /usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar (No such file or directory)\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:232) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:360) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:123) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\t... 6 more\r\nCaused by: java.io.FileNotFoundException: /usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar (No such file or directory)\r\n\tat java.util.zip.ZipFile.open(Native Method) ~[?:1.8.0_121]\r\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:219) ~[?:1.8.0_121]\r\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:149) ~[?:1.8.0_121]\r\n\tat java.util.jar.JarFile.<init>(JarFile.java:166) ~[?:1.8.0_121]\r\n\tat java.util.jar.JarFile.<init>(JarFile.java:103) ~[?:1.8.0_121]\r\n\tat org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:175) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:88) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:230) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:360) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:123) ~[elasticsearch-5.3.1.jar:5.3.1]\r\n\t... 6 more\r\n[2017-04-25T08:00:04,258][INFO ][o.e.n.Node               ] [node-name] initializing ...\r\n[2017-04-25T08:00:04,424][INFO ][o.e.e.NodeEnvironment    ] [node-name] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [5.9gb], net total_space [14.6gb], spins? [unknown], types [rootfs]\r\n[2017-04-25T08:00:04,425][INFO ][o.e.e.NodeEnvironment    ] [node-name] heap size [7.9gb], compressed ordinary object pointers [true]\r\n[2017-04-25T08:00:04,456][INFO ][o.e.n.Node               ] [node-name] node name [node-name], node ID [Wch9nH_-SEGeTWDw2_84bQ]\r\n[2017-04-25T08:00:04,456][INFO ][o.e.n.Node               ] [node-name] version[5.3.1], pid[3521], build[5f9cf58/2017-04-17T15:52:53.846Z], OS[Linux/3.10.0-514.10.2.el7.x86_64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_121/25.121-b13]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [aggs-matrix-stats]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [ingest-common]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [lang-expression]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [lang-groovy]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [lang-mustache]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [lang-painless]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [percolator]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [reindex]\r\n[2017-04-25T08:00:05,388][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [transport-netty3]\r\n[2017-04-25T08:00:05,389][INFO ][o.e.p.PluginsService     ] [node-name] loaded module [transport-netty4]\r\n[2017-04-25T08:00:05,389][INFO ][o.e.p.PluginsService     ] [node-name] no plugins loaded\r\n[2017-04-25T08:00:08,347][INFO ][o.e.n.Node               ] [node-name] initialized\r\n[2017-04-25T08:00:08,347][INFO ][o.e.n.Node               ] [node-name] starting ...\r\n[2017-04-25T08:00:08,578][INFO ][o.e.t.TransportService   ] [node-name] publish_address {bind-ip:9300}, bound_addresses {bind-ip:9300}\r\n[2017-04-25T08:00:08,586][INFO ][o.e.b.BootstrapChecks    ] [node-name] bound or publishing to a non-loopback or non-link-local address, enforcing bootstrap checks\r\n[2017-04-25T08:00:11,641][INFO ][o.e.c.s.ClusterService   ] [node-name] new_master {node-name}{Wch9nH_-SEGeTWDw2_84bQ}{-SC0zaNPSnK1L0-OZvJT3g}{bind-ip}{bind-ip:9300}, reason: zen-disco-elected-as-master ([0] nodes joined)\r\n[2017-04-25T08:00:11,663][INFO ][o.e.h.n.Netty4HttpServerTransport] [node-name] publish_address {bind-ip:9200}, bound_addresses {bind-ip:9200}\r\n[2017-04-25T08:00:11,667][INFO ][o.e.n.Node               ] [node-name] started\r\n```\r\n\r\nWhere do you want me to put the 5.3.0 backup?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296976688","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-296976688","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":296976688,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Njk3NjY4OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T09:43:14Z","updated_at":"2017-04-25T09:43:14Z","author_association":"MEMBER","body":"@Gacko This is different than the problem that you reported before yet seemingly similar.\r\n\r\nThere's something very puzzling about your system, I do think this is ultimately specific to your environment and not a problem with the packaging (and again, this doesn't reproduce for me where I just tried on Oracle 7, and it doesn't reproduce in our packaging tests which we test across a variety of OS (e.g., CentOS 6, CentOS 7, RHEL 6, RHEL 7, Oracle 6, Oracle 7, Fedora 24, etc.)).\r\n\r\nHere's why I think this. The logs indicate that the node is failing unable to find `/usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar` during the part of the jar hell check where we check the jars on the classpath. The jars on the classpath are set by the startup scripts where we specify it as `/usr/share/elasticsearch/lib/elasticsearch-5.3.1.jar:/usr/share/elasticsearch/lib/*`. This will be glob expanded by the shell before Elasticsearch starts and so ultimately Elasticsearch will see the contents of the lib folder as the shell saw them before Elasticsearch started.\r\n\r\nThis means that the running Elasticsearch instance thinks that `/usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar` is on the classpath, yet that file can not be found. It's as if the moment before starting Elasticsearch, the filesystem told the shell that `/usr/share/elasticsearch/lib/lucene-sandbox-6.4.1.jar` was there, and then after starting Elasticsearch it was not (it's important to note that 5.3.0 depends on Lucene 6.4.1, and 5.3.1 depends on Lucene 6.4.2, but important to note that we do not specify these dependencies explicitly on the classpath, we simply rely on the shell's glob expansion).\r\n\r\n> Where do you want me to put the 5.3.0 backup?\r\n\r\nBased on the above analysis, I don't think examining this is going to shed any light on this at all. I think you need to think about things that are specific to your environment. Sorry, it's likely we will close this one as unable to reproduce.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297008630","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-297008630","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":297008630,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzAwODYzMA==","user":{"login":"Gacko","id":935479,"node_id":"MDQ6VXNlcjkzNTQ3OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/935479?v=4","gravatar_id":"","url":"https://api.github.com/users/Gacko","html_url":"https://github.com/Gacko","followers_url":"https://api.github.com/users/Gacko/followers","following_url":"https://api.github.com/users/Gacko/following{/other_user}","gists_url":"https://api.github.com/users/Gacko/gists{/gist_id}","starred_url":"https://api.github.com/users/Gacko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gacko/subscriptions","organizations_url":"https://api.github.com/users/Gacko/orgs","repos_url":"https://api.github.com/users/Gacko/repos","events_url":"https://api.github.com/users/Gacko/events{/privacy}","received_events_url":"https://api.github.com/users/Gacko/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T12:03:22Z","updated_at":"2017-04-25T12:03:22Z","author_association":"NONE","body":"Ok, thank you very much. I'll keep this in mind the next time I update and disable RESTART_ON_UPGRADE. The problem itself won't a big deal to me in the future since we're going to move over to Docker soon and I just wanted to make sure this is not related to Elasticsearch.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297009282","html_url":"https://github.com/elastic/elasticsearch/issues/23785#issuecomment-297009282","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23785","id":297009282,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzAwOTI4Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T12:06:20Z","updated_at":"2017-04-25T12:06:20Z","author_association":"MEMBER","body":"> I just wanted to make sure this is not related to Elasticsearch.\r\n\r\nIndeed, I appreciate the additional information you provided today. I feel very confident in saying that this is not an Elasticsearch issue.","performed_via_github_app":null}]