[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276616375","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276616375","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276616375,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjYxNjM3NQ==","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"created_at":"2017-02-01T09:55:04Z","updated_at":"2017-02-01T09:55:04Z","author_association":"CONTRIBUTOR","body":"I also think `findJavaHome()` in `BuildPlugin.groovy` should make use of `org.gradle.java.home` property. Rather than rely solely on JAVA_HOME environment variable.\r\n\r\nThis would allow more flexibility in specifying which JDK to use for building.\r\n(via `gradle.properties` or with `-Dorg.gradle.java.home=/JDK_PATH` on the command line)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276717795","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276717795","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276717795,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjcxNzc5NQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-02-01T17:10:33Z","updated_at":"2017-02-01T17:10:33Z","author_association":"MEMBER","body":"> Gradle itself was run on Java 8\r\n\r\nGradle uses JAVA_HOME, so it would have been running in java 7. If you have org.gradle.java.home set, then it will briefly start on that java from JAVA_HOME, and fork to the java that was specified.  This is how we test with java 9 (gradle running on java 8, JAVA_HOME set to java 9, which is what the compile/tests use, and why findJavaHome uses only JAVA_HOME, by design).\r\n\r\nThere isn't much we can do with java 7 and before, as far as detecting them. Or rather, I don't think we should have any special logic to support giving a nice error message there, since, for example, java 7 has been EOL for almost 2 years.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276720501","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276720501","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276720501,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjcyMDUwMQ==","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"created_at":"2017-02-01T17:19:49Z","updated_at":"2017-02-01T17:19:49Z","author_association":"CONTRIBUTOR","body":"Fair enough.\r\nBut there _is_ logic to check the minimal Java version. But if the version is < than minimal that code will never be executed. Because the plugin will fail earlier while trying to _retrieve Java version_ (using `jjs` command).\r\n\r\nIn my case I was running Gradle from IDEA. And there is a separate 'Gradle JDK' setting there. So Gradle was running with Java 8 while JAVA_HOME was still pointing to Java 7.\r\nSo effectively 'elasticsearch.build' plugin is incompatible with IntelliJ IDEA when JAVA_HOME points to Java 7.\r\n(even thought running Gradle from command line will work fine due to `org.gradle.java.home`)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276721346","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276721346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276721346,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjcyMTM0Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-02-01T17:22:37Z","updated_at":"2017-02-01T17:22:37Z","author_association":"MEMBER","body":"> So effectively 'elasticsearch.build' plugin is incompatible with IntelliJ IDEA when JAVA_HOME points to Java 7.\r\n\r\nThis cannot work. JAVA_HOME must point to java 8 or later, because, regardless of which version of java gradle uses via org.gradle.java.home (which still must be java 8, if set), the java pointed to by JAVA_HOME is used to compile and test ES.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276723606","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276723606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276723606,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjcyMzYwNg==","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"created_at":"2017-02-01T17:30:42Z","updated_at":"2017-02-01T17:30:42Z","author_association":"CONTRIBUTOR","body":"You obviously know it better.\r\nMy point was that minimal Java version checking code does not make much sense since it needs that very same minimal version to just determine the version number for comparison.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276724686","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276724686","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276724686,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjcyNDY4Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-02-01T17:34:39Z","updated_at":"2017-02-01T17:34:39Z","author_association":"MEMBER","body":"@sabi0 Let me see if I can do a preliminary check using gradle's builtin java version detection.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276763221","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276763221","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276763221,"node_id":"MDEyOklzc3VlQ29tbWVudDI3Njc2MzIyMQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-02-01T19:53:40Z","updated_at":"2017-02-01T19:53:40Z","author_association":"MEMBER","body":"@sabi0 Using gradle's java version isn't possible, but I at least improved the error you see: #22911","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276902645","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276902645","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276902645,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjkwMjY0NQ==","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"created_at":"2017-02-02T09:03:01Z","updated_at":"2017-02-02T09:03:01Z","author_association":"CONTRIBUTOR","body":"By the way `jrunscript -f es-gradle-tmp.js` works the same as `jjs es-gradle-tmp.js` and is available even on Java 6.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276903283","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276903283","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276903283,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjkwMzI4Mw==","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"created_at":"2017-02-02T09:06:09Z","updated_at":"2017-02-02T09:06:09Z","author_association":"CONTRIBUTOR","body":"Moreover, you could do even this:\r\n`jrunscript -e 'print(java.lang.System.getProperty(\"java.specification.version\"));'`\r\nand don't bother with creating / deleting temporary files.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276928158","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276928158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276928158,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjkyODE1OA==","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"created_at":"2017-02-02T11:02:01Z","updated_at":"2017-02-02T11:02:01Z","author_association":"CONTRIBUTOR","body":"Here\r\n```groovy\r\n    private static String runJavascript(Project project, String javaHome, String script) {\r\n        ByteArrayOutputStream output = new ByteArrayOutputStream()\r\n        project.exec {\r\n            executable = new File(javaHome, 'bin/jrunscript')\r\n            args = [ '-e', script ]\r\n            standardOutput = output\r\n            errorOutput = new ByteArrayOutputStream()\r\n        }\r\n        return output.toString('UTF-8').trim()\r\n    }\r\n```\r\n\r\nBut you'd then have to 'double-escape' the double quotes in the scripts:\r\n`String versionScript = 'print(java.lang.System.getProperty(\\\\\"java.version\\\\\"));'`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276940968","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-276940968","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":276940968,"node_id":"MDEyOklzc3VlQ29tbWVudDI3Njk0MDk2OA==","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"created_at":"2017-02-02T12:09:16Z","updated_at":"2017-02-02T12:09:16Z","author_association":"CONTRIBUTOR","body":"By the way, the 'Java 1.8 or above is required ...' error message could mention JAVA_HOME.\r\n\r\nOtherwise it might be not so clear where the the wrong version comes from.\r\nE.g. when running Gradle from IDEA (with Java 8) it only shows the exception message, not the 'Elasticsearch Build Hamster' output before it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/277175049","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-277175049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":277175049,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NzE3NTA0OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-02-03T06:33:00Z","updated_at":"2017-02-03T06:33:00Z","author_association":"MEMBER","body":"@sabi0 Thank you! I had never heard of `jrunscript`. I like that much better.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/277192425","html_url":"https://github.com/elastic/elasticsearch/issues/22898#issuecomment-277192425","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22898","id":277192425,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NzE5MjQyNQ==","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"created_at":"2017-02-03T08:34:33Z","updated_at":"2017-02-03T08:34:33Z","author_association":"CONTRIBUTOR","body":"FYI: When I was trying `jrunscript` approach on Windows (with Gradle 2.13) I discovered that quotes in the arguments weren't escaped. So build would try to run the following command:\r\n`bin/jrunscript -e \"print(java.lang.System.getProperty(\"java.version\"));\"`\r\nAnd it would fail with exit code 10.\r\n\r\nTo fix this I had to double-escape the quotes myself (as one escaping level is removed by Groovy):\r\n```groovy\r\nString versionScript = 'print(java.lang.System.getProperty(\\\\\"java.version\\\\\"));'\r\nreturn runJavascript(project, javaHome, versionScript)\r\n```\r\nThen the command was executed successfully:\r\n`bin/jrunscript -e \"print(java.lang.System.getProperty(\\\"java.version\\\"));\"`","performed_via_github_app":null}]