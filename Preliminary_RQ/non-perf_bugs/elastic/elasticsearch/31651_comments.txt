[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400998481","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-400998481","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":400998481,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDk5ODQ4MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-28T11:05:54Z","updated_at":"2018-06-28T11:05:54Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/401523088","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-401523088","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":401523088,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTUyMzA4OA==","user":{"login":"jucaleb4","id":18367055,"node_id":"MDQ6VXNlcjE4MzY3MDU1","avatar_url":"https://avatars1.githubusercontent.com/u/18367055?v=4","gravatar_id":"","url":"https://api.github.com/users/jucaleb4","html_url":"https://github.com/jucaleb4","followers_url":"https://api.github.com/users/jucaleb4/followers","following_url":"https://api.github.com/users/jucaleb4/following{/other_user}","gists_url":"https://api.github.com/users/jucaleb4/gists{/gist_id}","starred_url":"https://api.github.com/users/jucaleb4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jucaleb4/subscriptions","organizations_url":"https://api.github.com/users/jucaleb4/orgs","repos_url":"https://api.github.com/users/jucaleb4/repos","events_url":"https://api.github.com/users/jucaleb4/events{/privacy}","received_events_url":"https://api.github.com/users/jucaleb4/received_events","type":"User","site_admin":false},"created_at":"2018-06-30T07:14:23Z","updated_at":"2018-07-01T08:15:49Z","author_association":"NONE","body":"Hi, can I take a stab at this? @davidkyle @pheyos ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/401692588","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-401692588","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":401692588,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTY5MjU4OA==","user":{"login":"jucaleb4","id":18367055,"node_id":"MDQ6VXNlcjE4MzY3MDU1","avatar_url":"https://avatars1.githubusercontent.com/u/18367055?v=4","gravatar_id":"","url":"https://api.github.com/users/jucaleb4","html_url":"https://github.com/jucaleb4","followers_url":"https://api.github.com/users/jucaleb4/followers","following_url":"https://api.github.com/users/jucaleb4/following{/other_user}","gists_url":"https://api.github.com/users/jucaleb4/gists{/gist_id}","starred_url":"https://api.github.com/users/jucaleb4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jucaleb4/subscriptions","organizations_url":"https://api.github.com/users/jucaleb4/orgs","repos_url":"https://api.github.com/users/jucaleb4/repos","events_url":"https://api.github.com/users/jucaleb4/events{/privacy}","received_events_url":"https://api.github.com/users/jucaleb4/received_events","type":"User","site_admin":false},"created_at":"2018-07-02T07:11:42Z","updated_at":"2018-07-02T07:11:42Z","author_association":"NONE","body":"I tried reproducing your steps and got [this](https://imgur.com/EiZ7QAg), it looks like the job `job_id2` picked up the calendar `planned-outages` when they shared a common job and running it. Am I missing a step, as it looks like this solves step 5?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/401758395","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-401758395","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":401758395,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTc1ODM5NQ==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2018-07-02T10:35:31Z","updated_at":"2018-07-02T10:35:31Z","author_association":"MEMBER","body":"Hi @jucaleb4 thank for your interest I'm delighted you want to take a stab at this.\r\n\r\nFor background on ML Calendars and Scheduled events see the [docs](https://www.elastic.co/guide/en/elastic-stack-overview/6.3/ml-calendars.html), the basic idea is to define periods of time where anomalies won't be generated. \r\n\r\nBelow are the detailed steps to reproduce, you will need some sample data and a script into index it I've created a [gist](https://gist.github.com/davidkyle/6a751a79b8c93bd14c263ddb0edbbbbf) for that purpose.\r\n\r\n1. Extract the files from the [gist](https://gist.github.com/davidkyle/6a751a79b8c93bd14c263ddb0edbbbbf) and index the farequote dataset by running `python upload_farequote.py` with the file `farequote_epoch_ms.csv` in the same directory\r\n\r\n2. Create the index pattern `farequote` for the farequote index\r\n\r\n3. In Maching Learning create a single metric job on the farequote index pattern.\r\n\r\n4. Set the aggregation to count and run the job. Notice the single large anomaly on the 2016/06/25\r\n\r\n5. Go to Machine Learning -> Settings -> Calendar Management\r\n\r\n6. Create a new Calendar `farequote`\r\n\r\n7. Add the new group `farequoute-group` to the calendar\r\n\r\n8. Add a new event for a single day on 2016/06/25 with the description `farequote anomaly`\r\n\r\n9. Save the calendar\r\n\r\n10. Clone the original farequote job and name it `farequote-with-calendar` and add the Job Group `farequote-group`\r\n\r\n11. Save the job and click `Start datafeed` then `Start`\r\n\r\n12. View the job results and notice that there is no anomaly on 2016/06/25\r\n\r\nThis time the calendar worked as expected as no anomalies were created you should see results similar to this. \r\n![calendar-results](https://user-images.githubusercontent.com/2353640/42158881-bd264a30-7de9-11e8-88f7-8a1d5e35762a.jpeg)\r\n\r\nThe bug occurs when you add the job to a group after the job has been created. To recreate the bug:\r\n\r\n1. Clone the original `farequote` job again. Name it `farequote-bug` and *don't* add the job group\r\n\r\n2. Click `Save`, click `Ok` to the influencers question then click `Close` instead of `Start Datafeed`. At this point the job is open.\r\n\r\n3. Go back the the Job Management page and edit the job `farequote-bug` (edit is one of the actions on the right of the screen)\r\n\r\n4. Add the job group `farequote-group` and click `Update`\r\n\r\n5. Now start the datafeed for job `farequote-bug` (the first action under actions on the right of the screen)\r\n\r\n6. View the results. The Calendar entry is not picked up and an anomaly is created on 2016/06/25.\r\n\r\nThe job is part of the job group which uses the `farequote` calendar. All jobs in the group should pick up the calendar entries.\r\n\r\nThe relevant code is in [JobManager.updateJob](https://github.com/elastic/elasticsearch/blob/6.3/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/JobManager.java#L242), in particular when the job is changed by adding a group it needs to send an [update to the native ML process](https://github.com/elastic/elasticsearch/blob/6.3/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/JobManager.java#L361)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/402012518","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-402012518","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":402012518,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjAxMjUxOA==","user":{"login":"jucaleb4","id":18367055,"node_id":"MDQ6VXNlcjE4MzY3MDU1","avatar_url":"https://avatars1.githubusercontent.com/u/18367055?v=4","gravatar_id":"","url":"https://api.github.com/users/jucaleb4","html_url":"https://github.com/jucaleb4","followers_url":"https://api.github.com/users/jucaleb4/followers","following_url":"https://api.github.com/users/jucaleb4/following{/other_user}","gists_url":"https://api.github.com/users/jucaleb4/gists{/gist_id}","starred_url":"https://api.github.com/users/jucaleb4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jucaleb4/subscriptions","organizations_url":"https://api.github.com/users/jucaleb4/orgs","repos_url":"https://api.github.com/users/jucaleb4/repos","events_url":"https://api.github.com/users/jucaleb4/events{/privacy}","received_events_url":"https://api.github.com/users/jucaleb4/received_events","type":"User","site_admin":false},"created_at":"2018-07-03T04:51:29Z","updated_at":"2018-07-03T05:35:25Z","author_association":"NONE","body":"This will help me get started, thanks @davidkyle. If I have anymore questions, I'll let you know along the way.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403242412","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-403242412","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":403242412,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzI0MjQxMg==","user":{"login":"jucaleb4","id":18367055,"node_id":"MDQ6VXNlcjE4MzY3MDU1","avatar_url":"https://avatars1.githubusercontent.com/u/18367055?v=4","gravatar_id":"","url":"https://api.github.com/users/jucaleb4","html_url":"https://github.com/jucaleb4","followers_url":"https://api.github.com/users/jucaleb4/followers","following_url":"https://api.github.com/users/jucaleb4/following{/other_user}","gists_url":"https://api.github.com/users/jucaleb4/gists{/gist_id}","starred_url":"https://api.github.com/users/jucaleb4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jucaleb4/subscriptions","organizations_url":"https://api.github.com/users/jucaleb4/orgs","repos_url":"https://api.github.com/users/jucaleb4/repos","events_url":"https://api.github.com/users/jucaleb4/events{/privacy}","received_events_url":"https://api.github.com/users/jucaleb4/received_events","type":"User","site_admin":false},"created_at":"2018-07-07T20:57:38Z","updated_at":"2018-07-08T20:14:31Z","author_association":"NONE","body":"@davidkyle Hi David, so the current elasticsearch source code is es7.0. However, the kibana download version I have is 6.3.0. So when I try to run ES, the Kibana complains about the type mismatch. Is there a way I can either a) downgrade es to 6.3.0 or b) upgrade kibana to 7.0 to test this code?\r\n\r\nedit: figured it out!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412803936","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-412803936","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":412803936,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjgwMzkzNg==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T08:59:52Z","updated_at":"2018-08-14T08:59:52Z","author_association":"CONTRIBUTOR","body":"Hi @jucaleb4.  Are you still planning to submit a PR for this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413104250","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-413104250","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":413104250,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzEwNDI1MA==","user":{"login":"jucaleb4","id":18367055,"node_id":"MDQ6VXNlcjE4MzY3MDU1","avatar_url":"https://avatars1.githubusercontent.com/u/18367055?v=4","gravatar_id":"","url":"https://api.github.com/users/jucaleb4","html_url":"https://github.com/jucaleb4","followers_url":"https://api.github.com/users/jucaleb4/followers","following_url":"https://api.github.com/users/jucaleb4/following{/other_user}","gists_url":"https://api.github.com/users/jucaleb4/gists{/gist_id}","starred_url":"https://api.github.com/users/jucaleb4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jucaleb4/subscriptions","organizations_url":"https://api.github.com/users/jucaleb4/orgs","repos_url":"https://api.github.com/users/jucaleb4/repos","events_url":"https://api.github.com/users/jucaleb4/events{/privacy}","received_events_url":"https://api.github.com/users/jucaleb4/received_events","type":"User","site_admin":false},"created_at":"2018-08-15T06:16:02Z","updated_at":"2018-08-15T06:16:02Z","author_association":"NONE","body":"@droberts195 I have not submitted a PR, I have been trying to get this to work but have not gotten a working solution. If it's fine with @davidkyle, you can tackle it","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413128238","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-413128238","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":413128238,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzEyODIzOA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2018-08-15T08:21:46Z","updated_at":"2018-08-15T08:21:46Z","author_association":"CONTRIBUTOR","body":"Thanks for having a go @jucaleb4.  We'll transfer it to someone in the ML team.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413287421","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-413287421","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":413287421,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzI4NzQyMQ==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2018-08-15T18:16:55Z","updated_at":"2018-08-15T18:16:55Z","author_association":"MEMBER","body":"@jucaleb4 hey, I just opened a PR, let me know if you want to go over how I figured it out/fixed it :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413427140","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-413427140","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":413427140,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzQyNzE0MA==","user":{"login":"jucaleb4","id":18367055,"node_id":"MDQ6VXNlcjE4MzY3MDU1","avatar_url":"https://avatars1.githubusercontent.com/u/18367055?v=4","gravatar_id":"","url":"https://api.github.com/users/jucaleb4","html_url":"https://github.com/jucaleb4","followers_url":"https://api.github.com/users/jucaleb4/followers","following_url":"https://api.github.com/users/jucaleb4/following{/other_user}","gists_url":"https://api.github.com/users/jucaleb4/gists{/gist_id}","starred_url":"https://api.github.com/users/jucaleb4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jucaleb4/subscriptions","organizations_url":"https://api.github.com/users/jucaleb4/orgs","repos_url":"https://api.github.com/users/jucaleb4/repos","events_url":"https://api.github.com/users/jucaleb4/events{/privacy}","received_events_url":"https://api.github.com/users/jucaleb4/received_events","type":"User","site_admin":false},"created_at":"2018-08-16T05:06:20Z","updated_at":"2018-08-16T05:06:20Z","author_association":"NONE","body":"@benwtrent hey, thanks for fixing it. Your changes make sense, it's something similar to what I did by adding a new boolean for a new group inside `isAutodetectProcessUpdate()`. When I ran it locally the changes didn't register. How did it work for you?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413528087","html_url":"https://github.com/elastic/elasticsearch/issues/31651#issuecomment-413528087","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31651","id":413528087,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzUyODA4Nw==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2018-08-16T12:26:15Z","updated_at":"2018-08-16T12:26:15Z","author_association":"MEMBER","body":"Job has to be open for the change to be captured. Additionally, you have to signal that a change has occurred: https://github.com/elastic/elasticsearch/pull/32881/files#diff-150690f539e82196e503011ae92ed227R69 \r\n\r\nScheduled events are separate but related things to a job, so one has to take into account letting the system know that the scheduled events need refreshed for the job as well. ","performed_via_github_app":null}]