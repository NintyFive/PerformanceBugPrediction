{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23235","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23235/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23235/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23235/events","html_url":"https://github.com/elastic/elasticsearch/issues/23235","id":208464993,"node_id":"MDU6SXNzdWUyMDg0NjQ5OTM=","number":23235,"title":"Get NumberFormatException when input string > 2^31","user":{"login":"charz","id":620340,"node_id":"MDQ6VXNlcjYyMDM0MA==","avatar_url":"https://avatars1.githubusercontent.com/u/620340?v=4","gravatar_id":"","url":"https://api.github.com/users/charz","html_url":"https://github.com/charz","followers_url":"https://api.github.com/users/charz/followers","following_url":"https://api.github.com/users/charz/following{/other_user}","gists_url":"https://api.github.com/users/charz/gists{/gist_id}","starred_url":"https://api.github.com/users/charz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/charz/subscriptions","organizations_url":"https://api.github.com/users/charz/orgs","repos_url":"https://api.github.com/users/charz/repos","events_url":"https://api.github.com/users/charz/events{/privacy}","received_events_url":"https://api.github.com/users/charz/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-02-17T14:54:59Z","updated_at":"2017-02-20T14:30:51Z","closed_at":"2017-02-20T14:30:51Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.1.0 \r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: 1.8.0_121\r\n\r\n**OS version**: Ubuntu 14.04.2 LTS\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen I do a bulk post with a large number (`> 2^31`) for content-length, I got 400 error due to an exception.\r\n\r\n**Steps to reproduce**:\r\n\r\n```\r\n$ cat test.json ; curl -s -XPOST localhost:9200/bbk_idx/4 --data-binary \"@test.json\"\r\n{\r\n  \"content-type\" : \"application\\/octet-stream\",\r\n  \"last-modified\" : 1437426922000,\r\n  \"x-timestamp\" : 1437426921794,\r\n  \"x-swift-object\" : \"demo.obj\",\r\n  \"x-swift-account\" : \"AUTH_demo\",\r\n  \"content-length\" : \"2147483646\",\r\n  \"etag\" : \"7a6f8d3760aaab4d3a9d41785519947b\",\r\n  \"x-swift-container\" : \"container\"\r\n}\r\n\r\n{\"_index\":\"bbk_idx\",\"_type\":\"4\",\"_id\":\"AVpMhBgtQm440Iyz7XhV\",\"_version\":1,\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"created\":true}vagrant@vagrant-ubuntu-trusty-64:~$ cat test.json ; curl -s -XPOST localhost:9200/bbk_idx/4 --data-binary \"@test.json\"                               \r\n\r\n\r\n~$ cat bad.json ; curl -s -XPOST localhost:9200/bbk_idx/4 --data-binary \"@bad.json\"\r\n{\r\n  \"content-type\" : \"application\\/octet-stream\",\r\n  \"last-modified\" : 1437426922000,\r\n  \"x-timestamp\" : 1437426921794,\r\n  \"x-swift-object\" : \"demo.obj\",\r\n  \"x-swift-account\" : \"AUTH_demo\",\r\n  \"content-length\" : \"2147483699\",\r\n  \"etag\" : \"7a6f8d3760aaab4d3a9d41785519947b\",\r\n  \"x-swift-container\" : \"container\"\r\n}\r\n\r\n{\"error\":{\"root_cause\":[{\"type\":\"mapper_parsing_exception\",\"reason\":\"failed to parse [content-length]\"}],\"type\":\"mapper_parsing_exception\",\"reason\":\"failed to parse [content-length]\",\"caused_by\":{\"type\":\"number_format_exception\",\"reason\":\"For input string: \\\"2147483699\\\"\"}},\"status\":400}\r\n``` \r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\n[2017-02-17 14:40:51,704][DEBUG][action.index             ] [ansible-es-1] [bbk_idx][0], node[eJ3JivobT4uP2P_JTAMUPw], [P], v[2], s[STARTED], a[id=XlK50ZItS7Sjv5iaL7xZGA]: Failed to execute [index {[bbk_idx][4][AVpMhLv3Qm440Iyz7XhW], source[{\r\n  \"content-type\" : \"application\\/octet-stream\",\r\n  \"last-modified\" : 1437426922000,\r\n  \"x-timestamp\" : 1437426921794,\r\n  \"x-swift-object\" : \"demo.obj\",\r\n  \"x-swift-account\" : \"AUTH_demo\",\r\n  \"content-length\" : \"2147483699\",\r\n  \"etag\" : \"7a6f8d3760aaab4d3a9d41785519947b\",\r\n  \"x-swift-container\" : \"container\"\r\n}\r\n\r\n]}]\r\nMapperParsingException[failed to parse [content-length]]; nested: NumberFormatException[For input string: \"2147483699\"];\r\n\tat org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:339)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:314)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseValue(DocumentParser.java:441)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:267)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.innerParseDocument(DocumentParser.java:127)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:79)\r\n\tat org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:318)\r\n\tat org.elasticsearch.index.shard.IndexShard.prepareCreate(IndexShard.java:516)\r\n\tat org.elasticsearch.index.shard.IndexShard.prepareCreate(IndexShard.java:507)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.prepareIndexOperationOnPrimary(TransportReplicationAction.java:1052)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.executeIndexRequestOnPrimary(TransportReplicationAction.java:1060)\r\n\tat org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:170)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.performOnPrimary(TransportReplicationAction.java:579)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase$1.doRun(TransportReplicationAction.java:452)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: java.lang.NumberFormatException: For input string: \"2147483699\"\r\n\tat java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\r\n\tat java.lang.Integer.parseInt(Integer.java:583)\r\n\tat java.lang.Integer.parseInt(Integer.java:615)\r\n\tat org.elasticsearch.common.xcontent.support.AbstractXContentParser.intValue(AbstractXContentParser.java:126)\r\n\tat org.elasticsearch.index.mapper.core.IntegerFieldMapper.innerParseCreateField(IntegerFieldMapper.java:288)\r\n\tat org.elasticsearch.index.mapper.core.NumberFieldMapper.parseCreateField(NumberFieldMapper.java:213)\r\n\tat org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:331)\r\n\t... 17 more\r\n[2017-02-17 14:40:51,705][INFO ][rest.suppressed          ] /bbk_idx/4 Params: {index=bbk_idx, type=4}\r\nMapperParsingException[failed to parse [content-length]]; nested: NumberFormatException[For input string: \"2147483699\"];\r\n\tat org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:339)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:314)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseValue(DocumentParser.java:441)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:267)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.innerParseDocument(DocumentParser.java:127)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:79)\r\n\tat org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:318)\r\n\tat org.elasticsearch.index.shard.IndexShard.prepareCreate(IndexShard.java:516)\r\n\tat org.elasticsearch.index.shard.IndexShard.prepareCreate(IndexShard.java:507)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.prepareIndexOperationOnPrimary(TransportReplicationAction.java:1052)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.executeIndexRequestOnPrimary(TransportReplicationAction.java:1060)\r\n\tat org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:170)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.performOnPrimary(TransportReplicationAction.java:579)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase$1.doRun(TransportReplicationAction.java:452)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: java.lang.NumberFormatException: For input string: \"2147483699\"\r\n\tat java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\r\n\tat java.lang.Integer.parseInt(Integer.java:583)\r\n\tat java.lang.Integer.parseInt(Integer.java:615)\r\n\tat org.elasticsearch.common.xcontent.support.AbstractXContentParser.intValue(AbstractXContentParser.java:126)\r\n\tat org.elasticsearch.index.mapper.core.IntegerFieldMapper.innerParseCreateField(IntegerFieldMapper.java:288)\r\n\tat org.elasticsearch.index.mapper.core.NumberFieldMapper.parseCreateField(NumberFieldMapper.java:213)\r\n\tat org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:331)\r\n\t... 17 more\r\n```\r\n\r\n**Describe the feature**:\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}