{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52213","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52213/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52213/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52213/events","html_url":"https://github.com/elastic/elasticsearch/issues/52213","id":563283961,"node_id":"MDU6SXNzdWU1NjMyODM5NjE=","number":52213,"title":"testNotifyOnDisconnectInSniffer fails (very occasionally)","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"labels":[{"id":146854632,"node_id":"MDU6TGFiZWwxNDY4NTQ2MzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Network","name":":Distributed/Network","color":"0e8a16","default":false,"description":"Http and internode communication implementations"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-02-11T15:27:52Z","updated_at":"2020-02-11T15:38:33Z","closed_at":"2020-02-11T15:38:33Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This build failed:\r\n\r\nhttps://gradle-enterprise.elastic.co/s/vf7pp6fchoh5w/console-log?task=:server:integTest\r\n\r\n```\r\n\r\norg.elasticsearch.client.transport.NodeDisconnectIT > testNotifyOnDisconnectInSniffer FAILED |  \r\n-- | --\r\n  | java.lang.AssertionError: expected:<1> but was:<0> |  \r\n  | at __randomizedtesting.SeedInfo.seed([A37722C9900F7688:2A4BE9BB222164B6]:0) |  \r\n  | at org.junit.Assert.fail(Assert.java:88) |  \r\n  | at org.junit.Assert.failNotEquals(Assert.java:834) |  \r\n  | at org.junit.Assert.assertEquals(Assert.java:645) |  \r\n  | at org.junit.Assert.assertEquals(Assert.java:631) |  \r\n  | at org.elasticsearch.client.transport.NodeDisconnectIT.testNotifyOnDisconnectInSniffer(NodeDisconnectIT.java:78) |  \r\n  | REPRODUCE WITH: ./gradlew ':server:integTest' --tests \"org.elasticsearch.client.transport.NodeDisconnectIT.testNotifyOnDisconnectInSniffer\" -Dtests.seed=A37722C9900F7688 -Dtests.security.manager=true -Dtests.locale=bg -Dtests.timezone=Etc/GMT+0 -Dcompiler.java=13\r\n```\r\n\r\nIt does not reproduce for me.\r\n\r\nI see a few other failures of this test in the past, but it's very infrequent.\r\n\r\nNotable mention for this strange exception in the log:\r\n\r\n```\r\n\r\n1> [2020-02-11T14:56:54,260][INFO ][o.e.c.s.ClusterApplierService] [node_t1] removed {{node_t0}{TUWuLZ62QQO-StG8hmnAEw}{202HRPTnT-O6K6DYk_I97w}{127.0.0.1}{127.0.0.1:43096}{dim}}, term: 1, version: 10, reason: Publication{term=1, version=10}\r\n--\r\n1> [2020-02-11T14:56:54,281][INFO ][o.e.c.t.TransportClientNodesService] [testNotifyOnDisconnectInSniffer] failed to get node info for {#transport#-1}{mCenUNDbQSe0Xtd6HXghVQ}{127.0.0.1}{127.0.0.1:43096}, disconnecting... |  \r\n-- | --\r\n  | 1> org.elasticsearch.transport.RemoteTransportException: [_client_][127.0.0.1:43096][cluster:monitor/nodes/liveness] |  \r\n  | 1> Caused by: org.elasticsearch.transport.ActionNotFoundTransportException: No handler for action [cluster:monitor/nodes/liveness] |  \r\n  | 1> \tat org.elasticsearch.transport.InboundHandler.handleRequest(InboundHandler.java:167) ~[main/:?] |  \r\n  | 1> \tat org.elasticsearch.transport.InboundHandler.messageReceived(InboundHandler.java:119) ~[main/:?] |  \r\n  | 1> \tat org.elasticsearch.transport.InboundHandler.inboundMessage(InboundHandler.java:103) ~[main/:?] |  \r\n  | 1> \tat org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:676) ~[main/:?] |  \r\n  | 1> \tat org.elasticsearch.transport.TcpTransport.consumeNetworkReads(TcpTransport.java:700) ~[main/:?] |  \r\n  | 1> \tat org.elasticsearch.transport.nio.MockNioTransport$MockTcpReadWriteHandler.consumeReads(MockNioTransport.java:276) ~[framework-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat org.elasticsearch.nio.SocketChannelContext.handleReadBytes(SocketChannelContext.java:228) ~[elasticsearch-nio-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat org.elasticsearch.nio.BytesChannelContext.read(BytesChannelContext.java:40) ~[elasticsearch-nio-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat org.elasticsearch.nio.EventHandler.handleRead(EventHandler.java:139) ~[elasticsearch-nio-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat org.elasticsearch.transport.nio.TestEventHandler.handleRead(TestEventHandler.java:151) ~[framework-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat org.elasticsearch.nio.NioSelector.handleRead(NioSelector.java:420) ~[elasticsearch-nio-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat org.elasticsearch.nio.NioSelector.processKey(NioSelector.java:246) ~[elasticsearch-nio-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:174) ~[elasticsearch-nio-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:131) ~[elasticsearch-nio-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT] |  \r\n  | 1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_241]\r\n```\r\n\r\nMaybe it was a port collision (`43096` was the publish port for one of the nodes, but now seems to belong to the `_client_`??) or maybe it's unrelated. It doesn't appear in the previous time this test failed.","closed_by":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"performed_via_github_app":null}