[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65486891","html_url":"https://github.com/elastic/elasticsearch/issues/8771#issuecomment-65486891","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8771","id":65486891,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDg2ODkx","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-12-03T20:42:29Z","updated_at":"2014-12-03T20:42:29Z","author_association":"CONTRIBUTOR","body":"is it possible that `/var/run` already exists and it's not a directory?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65492741","html_url":"https://github.com/elastic/elasticsearch/issues/8771#issuecomment-65492741","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8771","id":65492741,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDkyNzQx","user":{"login":"t-lo","id":71888,"node_id":"MDQ6VXNlcjcxODg4","avatar_url":"https://avatars2.githubusercontent.com/u/71888?v=4","gravatar_id":"","url":"https://api.github.com/users/t-lo","html_url":"https://github.com/t-lo","followers_url":"https://api.github.com/users/t-lo/followers","following_url":"https://api.github.com/users/t-lo/following{/other_user}","gists_url":"https://api.github.com/users/t-lo/gists{/gist_id}","starred_url":"https://api.github.com/users/t-lo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/t-lo/subscriptions","organizations_url":"https://api.github.com/users/t-lo/orgs","repos_url":"https://api.github.com/users/t-lo/repos","events_url":"https://api.github.com/users/t-lo/events{/privacy}","received_events_url":"https://api.github.com/users/t-lo/received_events","type":"User","site_admin":false},"created_at":"2014-12-03T21:19:39Z","updated_at":"2014-12-03T21:21:03Z","author_association":"CONTRIBUTOR","body":"`/var/run` already exists, and it _is_ a directory (otherwise I'd meet all kinds of weirdness with my Linux). I tested this in a Debian 7 VM, too, with the same result. \n\nI got two more failure modes:\n1 If I use a path where I have write access to (say, `/tmp/fail.pid`) I get\n\n```\n$ bin/elasticsearch -p /tmp/bla\n{2.0.0-SNAPSHOT}: pid Failed ...\n- NoSuchFileException[/tmp/bla]\njava.nio.file.NoSuchFileException: /tmp/bla\n        at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)\n        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\n        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\n        at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)\n        at java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:434)\n        at java.nio.file.Files.newOutputStream(Files.java:216)\n        at org.elasticsearch.bootstrap.Bootstrap.main(Bootstrap.java:156)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:32)\n```\n\n2  when I use no path at all (i.e. specifying a PID file in the local working directory) I get\n\n```\nbin/elasticsearch -p bla\n{2.0.0-SNAPSHOT}: pid Failed ...\n- NullPointerException[null]\njava.lang.NullPointerException\n        at java.nio.file.Files.provider(Files.java:97)\n        at java.nio.file.Files.createDirectory(Files.java:674)\n        at java.nio.file.Files.createAndCheckIsDirectory(Files.java:781)\n        at java.nio.file.Files.createDirectories(Files.java:727)\n        at org.elasticsearch.bootstrap.Bootstrap.main(Bootstrap.java:155)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:32)\n```\n\n@s1monw were you able to reproduce the issue?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65553110","html_url":"https://github.com/elastic/elasticsearch/issues/8771#issuecomment-65553110","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8771","id":65553110,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTUzMTEw","user":{"login":"t-lo","id":71888,"node_id":"MDQ6VXNlcjcxODg4","avatar_url":"https://avatars2.githubusercontent.com/u/71888?v=4","gravatar_id":"","url":"https://api.github.com/users/t-lo","html_url":"https://github.com/t-lo","followers_url":"https://api.github.com/users/t-lo/followers","following_url":"https://api.github.com/users/t-lo/following{/other_user}","gists_url":"https://api.github.com/users/t-lo/gists{/gist_id}","starred_url":"https://api.github.com/users/t-lo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/t-lo/subscriptions","organizations_url":"https://api.github.com/users/t-lo/orgs","repos_url":"https://api.github.com/users/t-lo/repos","events_url":"https://api.github.com/users/t-lo/events{/privacy}","received_events_url":"https://api.github.com/users/t-lo/received_events","type":"User","site_admin":false},"created_at":"2014-12-04T08:44:29Z","updated_at":"2014-12-04T08:44:29Z","author_association":"CONTRIBUTOR","body":"@s1monw wrote\n\n> is it possible that /var/run already exists and it's not a directory?\n\nLooking at this agan, actually, yes, it exists and is a _soft link_ to a directory. D'uh.\n\nThe other failure modes' causes were \n- a PID file with no \"path\" part (creating the path fails with a Null pointer exception)\n- the file did not exist (open fails b/c the `CREATE` flag was not used)\n\nAll gone if you accept my pull request.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65566638","html_url":"https://github.com/elastic/elasticsearch/issues/8771#issuecomment-65566638","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8771","id":65566638,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTY2NjM4","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-12-04T09:32:48Z","updated_at":"2014-12-04T09:32:48Z","author_association":"CONTRIBUTOR","body":"> Looking at this agan, actually, yes, it exists and is a soft link to a directory. D'uh.\n\nyes that is what I figured... yet there are more problems with this as you also found out. The real problem is that there is no tests for this at all which is a pain and needs to be fixed. I didn't see your PR until now and I fixed it this morning as well. I factored it out and added unittests so this doesn't happen again. I also found out that `DELETE_ON_EXIST` doesn't work on all OS so i went the shutdownhook path. Can you maybe try this PR too #8775\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65590018","html_url":"https://github.com/elastic/elasticsearch/issues/8771#issuecomment-65590018","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8771","id":65590018,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTkwMDE4","user":{"login":"t-lo","id":71888,"node_id":"MDQ6VXNlcjcxODg4","avatar_url":"https://avatars2.githubusercontent.com/u/71888?v=4","gravatar_id":"","url":"https://api.github.com/users/t-lo","html_url":"https://github.com/t-lo","followers_url":"https://api.github.com/users/t-lo/followers","following_url":"https://api.github.com/users/t-lo/following{/other_user}","gists_url":"https://api.github.com/users/t-lo/gists{/gist_id}","starred_url":"https://api.github.com/users/t-lo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/t-lo/subscriptions","organizations_url":"https://api.github.com/users/t-lo/orgs","repos_url":"https://api.github.com/users/t-lo/repos","events_url":"https://api.github.com/users/t-lo/events{/privacy}","received_events_url":"https://api.github.com/users/t-lo/received_events","type":"User","site_admin":false},"created_at":"2014-12-04T09:54:28Z","updated_at":"2014-12-04T09:54:28Z","author_association":"CONTRIBUTOR","body":"@s1monw I just verified #8775: Your pull request fixes all three failure modes.\n\nConcerning the testing I think this class of problems is best addressed (in the long term) by automated system / deployment tests - you can't catch everything with unit testing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65606233","html_url":"https://github.com/elastic/elasticsearch/issues/8771#issuecomment-65606233","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8771","id":65606233,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NjA2MjMz","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-12-04T10:10:08Z","updated_at":"2014-12-04T10:10:08Z","author_association":"CONTRIBUTOR","body":"> Concerning the testing I think this class of problems is best addressed (in the long term) by automated system / deployment tests - you can't catch everything with unit testing.\n\nI disagree - integration tests for this exists but they run too late and don't have enough variation. We need to have tests that fail while you develop everything else is error prone and from the last decade IMO. Stuff can happen once but never more than once because we need to add tests for it.\n","performed_via_github_app":null}]