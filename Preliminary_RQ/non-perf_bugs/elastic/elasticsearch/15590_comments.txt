[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/166638132","html_url":"https://github.com/elastic/elasticsearch/issues/15590#issuecomment-166638132","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15590","id":166638132,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NjYzODEzMg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-22T15:02:19Z","updated_at":"2015-12-22T15:02:19Z","author_association":"CONTRIBUTOR","body":"Thanks for the report, this problem is due to #14084.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169612820","html_url":"https://github.com/elastic/elasticsearch/issues/15590#issuecomment-169612820","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15590","id":169612820,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTYxMjgyMA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-01-07T09:50:17Z","updated_at":"2016-01-07T09:50:17Z","author_association":"CONTRIBUTOR","body":"Closing: warmers will go away in 3.0 #15614\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/197117293","html_url":"https://github.com/elastic/elasticsearch/issues/15590#issuecomment-197117293","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15590","id":197117293,"node_id":"MDEyOklzc3VlQ29tbWVudDE5NzExNzI5Mw==","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2016-03-16T02:25:27Z","updated_at":"2016-03-16T02:25:27Z","author_association":"MEMBER","body":"I can still reproduce the issue on 2.2.0 so it doesn't look like it is addressed by https://github.com/elastic/elasticsearch/pull/14084.  \n\n```\n[2016-03-15 19:04:28,764][WARN ][index.warmer             ] [cluster1_node1] [testwarmer][3] warmer [testwarmer] failed\njava.lang.ClassCastException: org.apache.lucene.index.MultiReader cannot be cast to org.apache.lucene.index.DirectoryReader\n    at org.elasticsearch.search.aggregations.support.ValuesSource$Bytes$WithOrdinals$FieldData.globalOrdinalsValues(ValuesSource.java:144)\n    at org.elasticsearch.search.aggregations.support.ValuesSource$Bytes$WithOrdinals.globalMaxOrd(ValuesSource.java:117)\n    at org.elasticsearch.search.aggregations.bucket.terms.TermsAggregatorFactory.doCreateInternal(TermsAggregatorFactory.java:217)\n    at org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.createInternal(ValuesSourceAggregatorFactory.java:64)\n    at org.elasticsearch.search.aggregations.AggregatorFactory.create(AggregatorFactory.java:102)\n    at org.elasticsearch.search.aggregations.AggregatorFactories.createTopLevelAggregators(AggregatorFactories.java:87)\n    at org.elasticsearch.search.aggregations.AggregationPhase.preProcess(AggregationPhase.java:85)\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:111)\n    at org.elasticsearch.search.SearchService.loadOrExecuteQueryPhase(SearchService.java:364)\n    at org.elasticsearch.search.SearchService.access$600(SearchService.java:120)\n    at org.elasticsearch.search.SearchService$SearchWarmer$1.run(SearchService.java:1165)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\nSimple warmer with a terms agg:\n\n```\nPUT testwarmer/type/1\n{\n  \"test\":\"test\"\n}\n\nPUT /testwarmer/_warmer/testwarmer\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"aggs\": {\n    \"test\":{\n      \"terms\": {\n        \"field\": \"test\",\n        \"size\": 10\n      }\n    }\n  }\n}\n\nPUT testwarmer/type/1\n{\n  \"test\":\"test\"\n}\n```\n\nHowever, as noted above, warmers will be removed from the product in 5.0 (previously known as 3.0) so this is just a note in case  users run into it on 2.2.x.\n","performed_via_github_app":null}]