{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19538","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19538/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19538/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19538/events","html_url":"https://github.com/elastic/elasticsearch/issues/19538","id":166837548,"node_id":"MDU6SXNzdWUxNjY4Mzc1NDg=","number":19538,"title":"On full cluster restart, shards are not recovering and remaining in Unassigned state","user":{"login":"venkatreddyamalla","id":7733986,"node_id":"MDQ6VXNlcjc3MzM5ODY=","avatar_url":"https://avatars1.githubusercontent.com/u/7733986?v=4","gravatar_id":"","url":"https://api.github.com/users/venkatreddyamalla","html_url":"https://github.com/venkatreddyamalla","followers_url":"https://api.github.com/users/venkatreddyamalla/followers","following_url":"https://api.github.com/users/venkatreddyamalla/following{/other_user}","gists_url":"https://api.github.com/users/venkatreddyamalla/gists{/gist_id}","starred_url":"https://api.github.com/users/venkatreddyamalla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/venkatreddyamalla/subscriptions","organizations_url":"https://api.github.com/users/venkatreddyamalla/orgs","repos_url":"https://api.github.com/users/venkatreddyamalla/repos","events_url":"https://api.github.com/users/venkatreddyamalla/events{/privacy}","received_events_url":"https://api.github.com/users/venkatreddyamalla/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-07-21T14:46:00Z","updated_at":"2016-07-22T19:37:21Z","closed_at":"2016-07-21T14:59:04Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.x\n\n**JVM version**: 1.7 and 1.8\n\n**OS version**: Ubuntu 14.05\n\n**Description of the problem including expected versus actual behavior**:\n**TL;DR** If I have more replicas than my data-nodes while restarting the cluster then shards are not recovering. \n\nI have cluster of 8 nodes ( 3 master + 5 data) and configured replica as 4 for each and every index in order to keep all shards in each and every node(can sustain max of 4 data nodes failure).  Now in process of full cluster restart, I've shutdown all data + master nodes. I started restarting cluster by making master nodes up first then data nodes 1 by one. As I had replica 4, my cluster should have recovered all indices from data node-1 when I restarted it.  But it didn't happened, cluster state was _red_, and all shards were in unassigned state(I didn't find any thing in logs like why shards recovering is not happening). Instead when I changed _replication_ to <=1, all shards are started recovering and finally my cluster state went to _yellow_ .  Can you please let me know if I'm missing any configuration here.\n\n**Steps to reproduce**:\n1. Start a cluster of 1 master + 1 data node\n2. Create index with 1 shard with replica 1( Now cluster state will become to **Yellow**)\n3. Stop elasticsearch in data node - cluster state **Red**\n4. Start elasticsearch in data node - cluster state **Yellow** (_Recovered successfully_)\n5. Now increase replica to 2 - cluster state **Yellow**\n6. Stop elasticsearch in data node - cluster state **Red**\n7. Start elasticsearch in data node - cluster state **Red** . Now index is not getting recovered and all shards remaining in state _unassigned_  As replica(2) is more than available data-nodes(1).\n8.  Now decrease the replica to 1 or 0 (<= available data nodes in cluster(in this case 1)), and index is recovered immediately.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}