{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8890","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8890/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8890/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8890/events","html_url":"https://github.com/elastic/elasticsearch/issues/8890","id":51636231,"node_id":"MDU6SXNzdWU1MTYzNjIzMQ==","number":8890,"title":"Merge policy settings are ignored when set in YML","user":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":157995054,"node_id":"MDU6TGFiZWwxNTc5OTUwNTQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.4.3","name":"v1.4.3","color":"dddddd","default":false,"description":null},{"id":127700367,"node_id":"MDU6TGFiZWwxMjc3MDAzNjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.5.0","name":"v1.5.0","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2014-12-11T01:52:49Z","updated_at":"2015-01-30T12:41:50Z","closed_at":"2015-01-30T12:41:50Z","author_association":"MEMBER","active_lock_reason":null,"body":"Setting the merge_factor, and other merge policies, from within the YML file are always overridden by the defaults. There is a workaround, which is to set them in a base index template, which will cause them to be taken. This is only an issue in 1.4.0 and 1.4.1.\n\nThis came up when trying to set `index.merge.policy.merge_factor` in `elasticsearch.yml` to a value other than `10`, which is the default. Peaking at the code, the sibling settings are also effected (e.g., `index.merge.policy.max_merge_size`).\n\nFor example, in an `elasticsearch.yml`:\n\n``` yml\nindex.merge.policy.type: log_byte_size \nindex.merge.policy.merge_factor: 30 \n```\n\nAfter creating any index, you will see something along the lines of\n\n```\n[2014-12-10 00:00:00,920][INFO ][cluster.metadata   ] [cluster-name] [index-name-2014.12.10] creating index, cause [auto(bulk api)], shards [4]/[2], mappings [] \n[2014-12-10 00:00:03,664][INFO ][index.merge.policy ] [cluster-name] [index-name-2014.12.10][3] updating merge_factor from [30] to [10]\n```\n\nNotice that it's reverting the `merge_factor` (and it's not just a mistake in the log output).\n\nAll of the providers suffer the from the same issue:\n- [`LogDocMergePolicyProvider`](https://github.com/elasticsearch/elasticsearch/blob/v1.4.0/src/main/java/org/elasticsearch/index/merge/policy/LogDocMergePolicyProvider.java#L111)\n- [`LogByteSizeMergePolicyProvider`](https://github.com/elasticsearch/elasticsearch/blob/v1.4.0/src/main/java/org/elasticsearch/index/merge/policy/LogByteSizeMergePolicyProvider.java#L111)\n- [`TieredMergePolicyProvider`](https://github.com/elasticsearch/elasticsearch/blob/v1.4.0/src/main/java/org/elasticsearch/index/merge/policy/TieredMergePolicyProvider.java#L124)\n\nThey all get the value set at index-creation time -- defaulting it to the global default if it's unset -- then compare to see if it's different from the global value. If they're different, it uses the index-creation value, which means the global default if it is unset.\n\nThe fix is simple, the passed in \"default\" should just be the global value rather than the global default.\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}