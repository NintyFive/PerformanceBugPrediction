{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384/events","html_url":"https://github.com/elastic/elasticsearch/issues/23384","id":210497706,"node_id":"MDU6SXNzdWUyMTA0OTc3MDY=","number":23384,"title":"histogram on an array","user":{"login":"sundarv85","id":11090193,"node_id":"MDQ6VXNlcjExMDkwMTkz","avatar_url":"https://avatars0.githubusercontent.com/u/11090193?v=4","gravatar_id":"","url":"https://api.github.com/users/sundarv85","html_url":"https://github.com/sundarv85","followers_url":"https://api.github.com/users/sundarv85/followers","following_url":"https://api.github.com/users/sundarv85/following{/other_user}","gists_url":"https://api.github.com/users/sundarv85/gists{/gist_id}","starred_url":"https://api.github.com/users/sundarv85/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sundarv85/subscriptions","organizations_url":"https://api.github.com/users/sundarv85/orgs","repos_url":"https://api.github.com/users/sundarv85/repos","events_url":"https://api.github.com/users/sundarv85/events{/privacy}","received_events_url":"https://api.github.com/users/sundarv85/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-02-27T14:22:45Z","updated_at":"2018-04-30T16:31:17Z","closed_at":"2018-04-13T10:18:30Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:\r\n\r\nThis is a feature request.\r\n\r\nWhen we have an array of long/int, then a percentile or avg on such an array works correctly by considering the count of the array elements. But when histogram is requested, the current implementation of histogram works based on doc count. \r\n\r\n```\r\nDELETE histperc\r\nPUT histperc\r\nPUT histperc/_mapping/t\r\n{\r\n  \"properties\": {\r\n    \"name\": {\r\n      \"type\": \"string\"\r\n    },\r\n    \"avg\": {\r\n      \"type\": \"long\"\r\n    },\r\n    \"entries\": {\r\n      \"type\": \"long\"\r\n    },\r\n    \"count\": {\r\n      \"type\": \"long\"\r\n    }\r\n  }\r\n}\r\n\r\nPOST /histperc/t/_bulk\r\n{ \"index\": { \"_id\": \"e1\" }}\r\n{ \"name\": \"GET /login\", \"avg\": 2, \"entries\": [2, 2, 3, 3, 3], \"count\": 5}\r\n{ \"index\": { \"_id\": \"e2\" }}\r\n{ \"name\": \"GET /login\", \"avg\": 1, \"entries\": [1, 2, 1], \"count\": 3}\r\n{ \"index\": { \"_id\": \"e3\" }}\r\n{ \"name\": \"GET /login\", \"avg\": 7, \"entries\": [7], \"count\": 1}\r\n{ \"index\": { \"_id\": \"e4\" }}\r\n{ \"name\": \"GET /login\", \"avg\": 3, \"entries\": [3], \"count\": 1}\r\n\r\n# works correctly\r\nGET /histperc/t/_search\r\n{\r\n  \"aggs\": {\r\n    \"perc\": {\r\n      \"percentiles\": {\r\n        \"field\": \"entries\"\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n# works correctly\r\nGET /histperc/t/_search?size=0\r\n{\r\n  \"aggs\": {\r\n    \"average\": {\r\n      \"avg\": {\r\n        \"field\": \"entries\"\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n# works based on doc count. Interested in getting it to work with the values of the array instead\r\nGET /histperc/t/_search\r\n{\r\n  \"aggs\": {\r\n    \"hist\": {\r\n      \"histogram\": {\r\n        \"field\": \"entries\",\r\n        \"interval\": 1\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThe reason to request such a support is, in time-based data, most of the times the only change is in the value in this array and the rest of the elements are the same. Hence, the cost of duplicating the documents is higher for this one feature of histogram, esp because avg and percentile already work correctly on this array.\r\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}