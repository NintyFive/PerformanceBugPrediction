{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6268","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6268/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6268/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6268/events","html_url":"https://github.com/elastic/elasticsearch/issues/6268","id":34007806,"node_id":"MDU6SXNzdWUzNDAwNzgwNg==","number":6268,"title":"Internal: Filter cache size limit not honored for 32GB or over","user":{"login":"danp60","id":220241,"node_id":"MDQ6VXNlcjIyMDI0MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/220241?v=4","gravatar_id":"","url":"https://api.github.com/users/danp60","html_url":"https://github.com/danp60","followers_url":"https://api.github.com/users/danp60/followers","following_url":"https://api.github.com/users/danp60/following{/other_user}","gists_url":"https://api.github.com/users/danp60/gists{/gist_id}","starred_url":"https://api.github.com/users/danp60/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danp60/subscriptions","organizations_url":"https://api.github.com/users/danp60/orgs","repos_url":"https://api.github.com/users/danp60/repos","events_url":"https://api.github.com/users/danp60/events{/privacy}","received_events_url":"https://api.github.com/users/danp60/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":101489188,"node_id":"MDU6TGFiZWwxMDE0ODkxODg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.1.3","name":"v1.1.3","color":"DDDDDD","default":false,"description":null},{"id":101487511,"node_id":"MDU6TGFiZWwxMDE0ODc1MTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.2.1","name":"v1.2.1","color":"DDDDDD","default":false,"description":null},{"id":95090930,"node_id":"MDU6TGFiZWw5NTA5MDkzMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.3.0","name":"v1.3.0","color":"DDDDDD","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":12,"created_at":"2014-05-21T17:56:07Z","updated_at":"2014-10-03T22:42:04Z","closed_at":"2014-05-22T22:44:54Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nWe are running an elasticsearch 1.1.1 6 node cluster with 256GB of ram, and using 96GB JVM heap sizes. I've noticed that when I set the filter cache size to 32GB or over with this command:\n\n```\ncurl -XPUT \"http://localhost:9200/_cluster/settings\" -d'\n{\n    \"transient\" : {\n       \"indices.cache.filter.size\" : \"50%\"\n    }\n}'\n```\n\nThe field cache size keeps growing above and beyond the indicated limit. The relevant node stats show that the filter cache size is about 69GB in size, which is over the configured limit of 48GB\n\n```\n\"filter_cache\" : {\n    \"memory_size_in_bytes\" : 74550217274,\n    \"evictions\" : 8665179\n},\n```\n\nI've enable debug logging on the node itself and it looks like the cache itself is getting created with the correct values:\n\n```\n[2014-05-21 00:31:57,215][DEBUG][indices.cache.filter     ] [ess02-006] using [node] weighted filter cache with size [50%], actual_size [47.9gb], expire [null], clean_interval [1m]\n```\n\nWhats strange is that when I set the limit to 31.9GB, the limit is enforced, which leads me to believe there is some sort of overflow going on.\n\nThanks,\nDaniel\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}