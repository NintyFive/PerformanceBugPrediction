[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34723385","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34723385","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34723385,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzIzMzg1","user":{"login":"sameerpokarna","id":6449715,"node_id":"MDQ6VXNlcjY0NDk3MTU=","avatar_url":"https://avatars2.githubusercontent.com/u/6449715?v=4","gravatar_id":"","url":"https://api.github.com/users/sameerpokarna","html_url":"https://github.com/sameerpokarna","followers_url":"https://api.github.com/users/sameerpokarna/followers","following_url":"https://api.github.com/users/sameerpokarna/following{/other_user}","gists_url":"https://api.github.com/users/sameerpokarna/gists{/gist_id}","starred_url":"https://api.github.com/users/sameerpokarna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sameerpokarna/subscriptions","organizations_url":"https://api.github.com/users/sameerpokarna/orgs","repos_url":"https://api.github.com/users/sameerpokarna/repos","events_url":"https://api.github.com/users/sameerpokarna/events{/privacy}","received_events_url":"https://api.github.com/users/sameerpokarna/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T03:25:25Z","updated_at":"2014-02-11T03:25:25Z","author_association":"NONE","body":"It appears that the org.elasticsearch.common.util.BloomFilter is used by the index.cache.id.simple.SimpleIdCache and is left referenced (and held in Java Heap) by the org.elasticsearch.indices.ttl.IndicesTTLService$PurgerThread, even after flag is set to false. Opening and closing all of the indices releases the memory retained by org.elasticsearch.common.util.BloomFilter.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34738321","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34738321","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34738321,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzM4MzIx","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T09:32:17Z","updated_at":"2014-02-11T09:32:17Z","author_association":"CONTRIBUTOR","body":"hey, lemme ask you some questions... Once you change the value `index.codec.bloom.load` do you still have searches going on on the indices? If so are some of the searches of type `scan` /  `scroll`? Does this also keep holding on to the bloom filter if you wait until all the searches are gone our of scope?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34747089","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34747089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34747089,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzQ3MDg5","user":{"login":"sameerpokarna","id":6449715,"node_id":"MDQ6VXNlcjY0NDk3MTU=","avatar_url":"https://avatars2.githubusercontent.com/u/6449715?v=4","gravatar_id":"","url":"https://api.github.com/users/sameerpokarna","html_url":"https://github.com/sameerpokarna","followers_url":"https://api.github.com/users/sameerpokarna/followers","following_url":"https://api.github.com/users/sameerpokarna/following{/other_user}","gists_url":"https://api.github.com/users/sameerpokarna/gists{/gist_id}","starred_url":"https://api.github.com/users/sameerpokarna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sameerpokarna/subscriptions","organizations_url":"https://api.github.com/users/sameerpokarna/orgs","repos_url":"https://api.github.com/users/sameerpokarna/repos","events_url":"https://api.github.com/users/sameerpokarna/events{/privacy}","received_events_url":"https://api.github.com/users/sameerpokarna/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T11:46:36Z","updated_at":"2014-02-11T11:46:36Z","author_association":"NONE","body":"No, I have no searches going on.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34754089","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34754089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34754089,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzU0MDg5","user":{"login":"sameerpokarna","id":6449715,"node_id":"MDQ6VXNlcjY0NDk3MTU=","avatar_url":"https://avatars2.githubusercontent.com/u/6449715?v=4","gravatar_id":"","url":"https://api.github.com/users/sameerpokarna","html_url":"https://github.com/sameerpokarna","followers_url":"https://api.github.com/users/sameerpokarna/followers","following_url":"https://api.github.com/users/sameerpokarna/following{/other_user}","gists_url":"https://api.github.com/users/sameerpokarna/gists{/gist_id}","starred_url":"https://api.github.com/users/sameerpokarna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sameerpokarna/subscriptions","organizations_url":"https://api.github.com/users/sameerpokarna/orgs","repos_url":"https://api.github.com/users/sameerpokarna/repos","events_url":"https://api.github.com/users/sameerpokarna/events{/privacy}","received_events_url":"https://api.github.com/users/sameerpokarna/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T13:32:35Z","updated_at":"2014-02-11T13:32:35Z","author_association":"NONE","body":"Appears like the clusterChanged() method of IndexCache needs to implement the mechanism to clear the idCache...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34757454","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34757454","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34757454,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzU3NDU0","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T14:13:09Z","updated_at":"2014-02-11T14:13:09Z","author_association":"CONTRIBUTOR","body":"I don't see where the ID cache holds on to the bloom filters really. The SegmentCoreReader (core cache key) is removed if the reader goes out of scope so I am not seeing how this relates to the clsuterChanged event?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34760864","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34760864","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34760864,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzYwODY0","user":{"login":"sameerpokarna","id":6449715,"node_id":"MDQ6VXNlcjY0NDk3MTU=","avatar_url":"https://avatars2.githubusercontent.com/u/6449715?v=4","gravatar_id":"","url":"https://api.github.com/users/sameerpokarna","html_url":"https://github.com/sameerpokarna","followers_url":"https://api.github.com/users/sameerpokarna/followers","following_url":"https://api.github.com/users/sameerpokarna/following{/other_user}","gists_url":"https://api.github.com/users/sameerpokarna/gists{/gist_id}","starred_url":"https://api.github.com/users/sameerpokarna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sameerpokarna/subscriptions","organizations_url":"https://api.github.com/users/sameerpokarna/orgs","repos_url":"https://api.github.com/users/sameerpokarna/repos","events_url":"https://api.github.com/users/sameerpokarna/events{/privacy}","received_events_url":"https://api.github.com/users/sameerpokarna/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T14:49:35Z","updated_at":"2014-02-11T14:49:35Z","author_association":"NONE","body":"![image010](https://f.cloud.github.com/assets/6449715/2137781/9de40750-932b-11e3-965a-da0334a9b9e0.jpeg)\n\nAttaching a yourkit screenshot, after changing setting to false. Hope this helps.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34761590","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34761590","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34761590,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzYxNTkw","user":{"login":"sameerpokarna","id":6449715,"node_id":"MDQ6VXNlcjY0NDk3MTU=","avatar_url":"https://avatars2.githubusercontent.com/u/6449715?v=4","gravatar_id":"","url":"https://api.github.com/users/sameerpokarna","html_url":"https://github.com/sameerpokarna","followers_url":"https://api.github.com/users/sameerpokarna/followers","following_url":"https://api.github.com/users/sameerpokarna/following{/other_user}","gists_url":"https://api.github.com/users/sameerpokarna/gists{/gist_id}","starred_url":"https://api.github.com/users/sameerpokarna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sameerpokarna/subscriptions","organizations_url":"https://api.github.com/users/sameerpokarna/orgs","repos_url":"https://api.github.com/users/sameerpokarna/repos","events_url":"https://api.github.com/users/sameerpokarna/events{/privacy}","received_events_url":"https://api.github.com/users/sameerpokarna/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T14:57:06Z","updated_at":"2014-02-11T14:57:06Z","author_association":"NONE","body":"If I close the index, the IndicesClusterStateService.clusterChanged() -> applyCleanedIndices() appears to clean up the bloom filters.\nindexInjector.getInstance(IndexCache.class).close();\n\nWhen the bloom filter is reset, the clusterChanged of IndexCache does get called, but there is no action that is taken on idCache by this method\n        // clear the query parser cache if the metadata (mappings) changed...\n        if (event.metaDataChanged()) {\n            queryParserCache.clear();\n        }\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34762583","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34762583","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34762583,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzYyNTgz","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T15:06:33Z","updated_at":"2014-02-11T15:06:33Z","author_association":"CONTRIBUTOR","body":"so the way this works is that the we reopen the index reader when you set this method. Yet, the reader that are open while you put the setting in might still be used in searches or other places of the system ie. their ref count is not set to `0` and in-turn their core cache keys are still `alive` once the ref count goes to `0` it will free all the resources via the `public void onClose(Object coreCacheKey)` so there might be somebody that still holds on to an EngineSearcher or so?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34775740","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-34775740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":34775740,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzc1NzQw","user":{"login":"sameerpokarna","id":6449715,"node_id":"MDQ6VXNlcjY0NDk3MTU=","avatar_url":"https://avatars2.githubusercontent.com/u/6449715?v=4","gravatar_id":"","url":"https://api.github.com/users/sameerpokarna","html_url":"https://github.com/sameerpokarna","followers_url":"https://api.github.com/users/sameerpokarna/followers","following_url":"https://api.github.com/users/sameerpokarna/following{/other_user}","gists_url":"https://api.github.com/users/sameerpokarna/gists{/gist_id}","starred_url":"https://api.github.com/users/sameerpokarna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sameerpokarna/subscriptions","organizations_url":"https://api.github.com/users/sameerpokarna/orgs","repos_url":"https://api.github.com/users/sameerpokarna/repos","events_url":"https://api.github.com/users/sameerpokarna/events{/privacy}","received_events_url":"https://api.github.com/users/sameerpokarna/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T17:04:20Z","updated_at":"2014-02-11T17:04:20Z","author_association":"NONE","body":"You are correct that the Lucene indexwriter is reopened, but ElasticSearch IndexCache is still holding on to the references, and I see this being cleared only in following scenarios:\n1. InternalIndicesService.removeIndex()\n2. At the end of percolate\nAll other cases of this usage are when other objects are being closed.\nI do not find the reference where the reources are freed after the ref count goes down to 0. Can you please point me to that ?\n(Please note that I am using 0.90.9)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68250703","html_url":"https://github.com/elastic/elasticsearch/issues/5069#issuecomment-68250703","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5069","id":68250703,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MjUwNzAz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-29T11:36:31Z","updated_at":"2014-12-29T11:36:31Z","author_association":"CONTRIBUTOR","body":"Bloom filters have now been removed. Closing\n","performed_via_github_app":null}]