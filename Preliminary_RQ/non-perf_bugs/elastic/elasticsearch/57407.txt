{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57407","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57407/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57407/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57407/events","html_url":"https://github.com/elastic/elasticsearch/issues/57407","id":628383737,"node_id":"MDU6SXNzdWU2MjgzODM3Mzc=","number":57407,"title":"Regression in aggregation latency after #57241","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":1967499105,"node_id":"MDU6TGFiZWwxOTY3NDk5MTA1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Analytics","name":"Team:Analytics","color":"fef2c0","default":false,"description":"Meta label for analytics/geo team"}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":13,"created_at":"2020-06-01T12:00:23Z","updated_at":"2020-08-10T20:52:30Z","closed_at":"2020-08-10T20:52:30Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"After merging https://github.com/elastic/elasticsearch/pull/57241 we see the following spike in aggregation latency in the nightly charts (starting 20200528):\r\n\r\n![image](https://user-images.githubusercontent.com/1754575/83406710-e3b95b00-a417-11ea-9e02-28a5fee3dd8f.png)\r\n\r\nThe list of commits between 20200527 -> 20200528 is: https://github.com/elastic/elasticsearch/compare/16be0e65d387320aff35e3ddbaef3f1f621c41b9...9f6bc6856b1dde0d4a59eac33add780023b350d5\r\n\r\nand based on analysis, it can be attributed to #57241.\r\n\r\nThe specific regression is on the [country_agg-uncached query](https://github.com/elastic/rally-tracks/blob/a2d6f871466e24aa335b491abb9b1b043d16060a/geonames/operations/default.json#L48-L68) on geonames and it reproduces regardless of license type.\r\n\r\nThe following Rally invocations can be used to identify the regression:\r\n\r\nBefore #57241 i.e. 6f79750\r\n\r\n```\r\nesrally --track=geonames --challenge=append-no-conflicts --include-tasks=\"delete-index,create-index,check-cluster-health,index-append,refresh-after-index,force-merge,refresh-after-force-merge,wait-until-merges-finish,index-stats,node-stats,country_agg_uncached\" --runtime-jdk=bundled --car=defaults --revision=6f79750 --user-tag=\"commit:before_make_global_ords_terms_simpler_to_understand\" --on-error=abort\r\n```\r\n\r\nUsing suspect commit: 974d236\r\n```\r\nesrally --track=geonames --challenge=append-no-conflicts --include-tasks=\"delete-index,create-index,check-cluster-health,index-append,refresh-after-index,force-merge,refresh-after-force-merge,wait-until-merges-finish,index-stats,node-stats,country_agg_uncached\" --runtime-jdk=bundled --car=defaults --revision=974d236 --user-tag=\"commit:make_global_ords_terms_simpler_to_understand\" --on-error=abort\r\n```\r\n\r\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}