[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269674954","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-269674954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":269674954,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTY3NDk1NA==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2016-12-29T18:49:40Z","updated_at":"2016-12-29T18:49:40Z","author_association":"CONTRIBUTOR","body":"I tried to use templates prior to shrink, and got the following exception:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"mappings are not allowed when shrinking indices, all mappings are copied from the source index\"\r\n      }\r\n    ],\r\n    \"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"mappings are not allowed when shrinking indices, all mappings are copied from the source index\"\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nIf the mappings are always copied from the source index, then it means that there is no workaround for this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269753495","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-269753495","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":269753495,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTc1MzQ5NQ==","user":{"login":"GlenRSmith","id":1327920,"node_id":"MDQ6VXNlcjEzMjc5MjA=","avatar_url":"https://avatars3.githubusercontent.com/u/1327920?v=4","gravatar_id":"","url":"https://api.github.com/users/GlenRSmith","html_url":"https://github.com/GlenRSmith","followers_url":"https://api.github.com/users/GlenRSmith/followers","following_url":"https://api.github.com/users/GlenRSmith/following{/other_user}","gists_url":"https://api.github.com/users/GlenRSmith/gists{/gist_id}","starred_url":"https://api.github.com/users/GlenRSmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GlenRSmith/subscriptions","organizations_url":"https://api.github.com/users/GlenRSmith/orgs","repos_url":"https://api.github.com/users/GlenRSmith/repos","events_url":"https://api.github.com/users/GlenRSmith/events{/privacy}","received_events_url":"https://api.github.com/users/GlenRSmith/received_events","type":"User","site_admin":false},"created_at":"2016-12-30T10:01:53Z","updated_at":"2016-12-30T10:01:53Z","author_association":"CONTRIBUTOR","body":"Would using the reindex API be a workaround @gmoskovicz ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269759040","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-269759040","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":269759040,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTc1OTA0MA==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2016-12-30T11:02:31Z","updated_at":"2016-12-30T11:02:31Z","author_association":"CONTRIBUTOR","body":"Reindexing *is* a workaround. But i meant that there is no workaround as previous steps to actually use the shrink API with some previous steps.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270876640","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-270876640","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":270876640,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDg3NjY0MA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T10:33:59Z","updated_at":"2017-01-06T10:33:59Z","author_association":"CONTRIBUTOR","body":"I think the issue here is that we don't use the `index_version_created` for the target index which we should. I will look into this in a bit.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270936063","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-270936063","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":270936063,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDkzNjA2Mw==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T16:04:11Z","updated_at":"2017-01-06T16:04:11Z","author_association":"CONTRIBUTOR","body":"I just build an ES version from a snapshot and confirmed that the bug is fixed. thanks for reporting this @gmoskovicz ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270948446","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-270948446","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":270948446,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk0ODQ0Ng==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T16:55:01Z","updated_at":"2017-01-06T16:55:01Z","author_association":"CONTRIBUTOR","body":"Thanks for fixing it @s1monw ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/281339287","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-281339287","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":281339287,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MTMzOTI4Nw==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2017-02-21T13:06:32Z","updated_at":"2017-02-21T13:06:32Z","author_association":"CONTRIBUTOR","body":"@s1monw still happening in v5.2.1:\r\n\r\n```\r\n[2017-02-21T11:06:41,686][WARN ][o.e.c.a.s.ShardStateAction] [e9D0OYU] [doc_shrinked_index][0] received shard failed for shard id [[doc_shrinked_index][0]], allocation id [9DidZyR5R1GbdtJLfrM2Tw], primary term [0], message [failed recovery], failure [RecoveryFailedException[[doc_shrinked_index][0]: Recovery failed on {e9D0OYU}{e9D0OYUURbClpiOZmPE1Hg}{Icm2utt3Q4SFK5YHut-a2Q}{127.0.0.1}{127.0.0.1:9300}]; nested: MapperParsingException[Mapping definition for [@version] has unsupported parameters:  [fielddata : false]]; ]\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [doc_shrinked_index][0]: Recovery failed on {e9D0OYU}{e9D0OYUURbClpiOZmPE1Hg}{Icm2utt3Q4SFK5YHut-a2Q}{127.0.0.1}{127.0.0.1:9300}\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$4(IndexShard.java:1537) [elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.index.shard.IndexShard$$Lambda$1580/1463687544.run(Unknown Source) [elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:527) [elasticsearch-5.2.1.jar:5.2.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_45]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_45]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_45]\r\nCaused by: org.elasticsearch.index.mapper.MapperParsingException: Mapping definition for [@version] has unsupported parameters:  [fielddata : false]\r\n\tat org.elasticsearch.index.mapper.DocumentMapperParser.checkNoRemainingFields(DocumentMapperParser.java:151) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.index.mapper.DocumentMapperParser.checkNoRemainingFields(DocumentMapperParser.java:145) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.index.mapper.ObjectMapper$TypeParser.parseProperties(ObjectMapper.java:289) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.index.mapper.ObjectMapper$TypeParser.parseObjectOrDocumentTypeProperties(ObjectMapper.java:203) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.index.mapper.RootObjectMapper$TypeParser.parse(RootObjectMapper.java:102) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.index.mapper.DocumentMapperParser.parse(DocumentMapperParser.java:111) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.index.mapper.DocumentMapperParser.parse(DocumentMapperParser.java:91) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.index.mapper.MapperService.parse(MapperService.java:602) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.applyRequest(MetaDataMappingService.java:264) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.execute(MetaDataMappingService.java:230) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.cluster.service.ClusterService.executeTasks(ClusterService.java:674) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.cluster.service.ClusterService.calculateTaskOutputs(ClusterService.java:653) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.cluster.service.ClusterService.runTasks(ClusterService.java:612) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.cluster.service.ClusterService$UpdateTask.run(ClusterService.java:1112) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:527) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:238) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:201) ~[elasticsearch-5.2.1.jar:5.2.1]\r\n\t... 3 more\r\n```\r\n\r\nSame repro steps.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/281341614","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-281341614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":281341614,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MTM0MTYxNA==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2017-02-21T13:17:35Z","updated_at":"2017-02-21T13:17:35Z","author_association":"CONTRIBUTOR","body":"Looks like we need to backport this fix into 5.2, it was backported to 5.1 and 5.3 already.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/281344168","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-281344168","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":281344168,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MTM0NDE2OA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-02-21T13:28:49Z","updated_at":"2017-02-21T13:28:49Z","author_association":"CONTRIBUTOR","body":"@gmoskovicz thanks for reopening see https://github.com/elastic/elasticsearch/pull/22469#issuecomment-281344080","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/281344761","html_url":"https://github.com/elastic/elasticsearch/issues/22373#issuecomment-281344761","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22373","id":281344761,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MTM0NDc2MQ==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2017-02-21T13:31:26Z","updated_at":"2017-02-21T13:31:26Z","author_association":"CONTRIBUTOR","body":"Roger that! Thanks for the quick fix @s1monw !","performed_via_github_app":null}]