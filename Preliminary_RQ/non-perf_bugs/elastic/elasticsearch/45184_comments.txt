[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518153189","html_url":"https://github.com/elastic/elasticsearch/issues/45184#issuecomment-518153189","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45184","id":518153189,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODE1MzE4OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-05T09:12:12Z","updated_at":"2019-08-05T09:12:12Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518164282","html_url":"https://github.com/elastic/elasticsearch/issues/45184#issuecomment-518164282","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45184","id":518164282,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODE2NDI4Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-08-05T09:43:38Z","updated_at":"2019-08-05T09:48:38Z","author_association":"MEMBER","body":"Hi @jasondaicoder,\r\n\r\nYour expectations are right in that the ndcg score should only change if the ordering of any of the documents returned for one of the queries in your test set change. This might be the case for any of the following reasons:\r\n\r\n* You indexed or deleted documents in the index that you are running the evaluation against. This might be documents seemingly unrelated to your queries, but every change to the index has the potential to change term frequencies and affect ranking consequently\r\n* Your analysis chain slightly changed. This might be an undetected, involuntary change, e.g. some dictionary or file resources you are loading have changed or are configured slightly differently on two nodes in your cluster (synonym files are especially prone to this, if they are not exactly the same on all nodes, query result rankings can be different depending on which shard they hit)\r\n* running some nodes on slightly different versions of ES, e.g. changes in Lucene similarity calculcations amongst different versions can change slightly\r\n\r\nMaybe you can try to narrow the change in the overall score down to a particular requests \"id\", (the \"details\" section should show you a \"metric_score\" for each for each \"request id\"). Do all of those change when you compare the responses of the calls that have a different overall score? If only some of them changed, maybe you can narrow down what changed in the returned result order for those cases. Hope this helps as a start for investigation, let me know if you find anything that explains the changes in your case.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518190388","html_url":"https://github.com/elastic/elasticsearch/issues/45184#issuecomment-518190388","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45184","id":518190388,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODE5MDM4OA==","user":{"login":"jasondaicoder","id":8662103,"node_id":"MDQ6VXNlcjg2NjIxMDM=","avatar_url":"https://avatars2.githubusercontent.com/u/8662103?v=4","gravatar_id":"","url":"https://api.github.com/users/jasondaicoder","html_url":"https://github.com/jasondaicoder","followers_url":"https://api.github.com/users/jasondaicoder/followers","following_url":"https://api.github.com/users/jasondaicoder/following{/other_user}","gists_url":"https://api.github.com/users/jasondaicoder/gists{/gist_id}","starred_url":"https://api.github.com/users/jasondaicoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasondaicoder/subscriptions","organizations_url":"https://api.github.com/users/jasondaicoder/orgs","repos_url":"https://api.github.com/users/jasondaicoder/repos","events_url":"https://api.github.com/users/jasondaicoder/events{/privacy}","received_events_url":"https://api.github.com/users/jasondaicoder/received_events","type":"User","site_admin":false},"created_at":"2019-08-05T11:05:35Z","updated_at":"2019-08-05T11:05:35Z","author_association":"NONE","body":"Hi @cbuescher ,\r\n\r\nThanks a lot on your reply, you raised some very good point which we used to review and check our environment. \r\n\r\n1. We have a scheduled indexing job which is scheduled to run on every a few hours, however the source data changes rarely, we would expect very minimum impact from this, but will try to narrow down if there were any changes\r\n2. We don't use any external file for things like synonym, they are all inline settings\r\n3. All data nodes are in same ES version\r\n4. The ndcg score which changes on different run is actually per request id with specific \"query string\", we have list of terms which is passed as the \"query string\". We have discovered lots of them have the problem. \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518425068","html_url":"https://github.com/elastic/elasticsearch/issues/45184#issuecomment-518425068","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45184","id":518425068,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODQyNTA2OA==","user":{"login":"jasondaicoder","id":8662103,"node_id":"MDQ6VXNlcjg2NjIxMDM=","avatar_url":"https://avatars2.githubusercontent.com/u/8662103?v=4","gravatar_id":"","url":"https://api.github.com/users/jasondaicoder","html_url":"https://github.com/jasondaicoder","followers_url":"https://api.github.com/users/jasondaicoder/followers","following_url":"https://api.github.com/users/jasondaicoder/following{/other_user}","gists_url":"https://api.github.com/users/jasondaicoder/gists{/gist_id}","starred_url":"https://api.github.com/users/jasondaicoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasondaicoder/subscriptions","organizations_url":"https://api.github.com/users/jasondaicoder/orgs","repos_url":"https://api.github.com/users/jasondaicoder/repos","events_url":"https://api.github.com/users/jasondaicoder/events{/privacy}","received_events_url":"https://api.github.com/users/jasondaicoder/received_events","type":"User","site_admin":false},"created_at":"2019-08-05T22:27:47Z","updated_at":"2019-08-05T22:27:47Z","author_association":"NONE","body":"Hi @cbuescher,\r\n\r\nSorry forgot to mention that the changed ndcg score just swaps between two different values, it doesn’t change a lot.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/519451323","html_url":"https://github.com/elastic/elasticsearch/issues/45184#issuecomment-519451323","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45184","id":519451323,"node_id":"MDEyOklzc3VlQ29tbWVudDUxOTQ1MTMyMw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-08-08T09:53:02Z","updated_at":"2019-08-08T09:53:02Z","author_association":"MEMBER","body":">  ndcg score just swaps between two different values, it doesn’t change a lot\r\n\r\nThanks, could you share the values to see what \"not a lot\" means to you? I have a suspicion this could be rounding errors depending on the order in which the different search results arrive back and the overall score gets calculcated. Would you mind either sharing the whole response you get (both versions for the two slightly different values) or if you cannot do that, maybe just a list of the \"metric_score\" in the \"details\" section for each of the two varying overall scores? \r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/527460643","html_url":"https://github.com/elastic/elasticsearch/issues/45184#issuecomment-527460643","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45184","id":527460643,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzQ2MDY0Mw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-09-03T13:34:10Z","updated_at":"2019-09-03T13:34:10Z","author_association":"MEMBER","body":"Hi @jasondaicoder, just coming back to this. I'd still be interested to learn more about the magnitude of the fluctuations in scoring you are seeing and the circumstances under which this is happening (see my previous post). Let me know if you can share any more details, otherwise I'll close this issue in a bit but you can always reopen if you find a way so I can reproduce this issue or you can share more information.","performed_via_github_app":null}]