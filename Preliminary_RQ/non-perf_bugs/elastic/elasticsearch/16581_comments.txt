[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/182490495","html_url":"https://github.com/elastic/elasticsearch/issues/16581#issuecomment-182490495","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16581","id":182490495,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MjQ5MDQ5NQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-02-10T17:22:41Z","updated_at":"2016-02-10T17:22:41Z","author_association":"MEMBER","body":"How did you upgrade? It looks like you have lucene jars from ES 2.1 on your classpath.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/182770237","html_url":"https://github.com/elastic/elasticsearch/issues/16581#issuecomment-182770237","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16581","id":182770237,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Mjc3MDIzNw==","user":{"login":"iliasse-hassala","id":11230261,"node_id":"MDQ6VXNlcjExMjMwMjYx","avatar_url":"https://avatars3.githubusercontent.com/u/11230261?v=4","gravatar_id":"","url":"https://api.github.com/users/iliasse-hassala","html_url":"https://github.com/iliasse-hassala","followers_url":"https://api.github.com/users/iliasse-hassala/followers","following_url":"https://api.github.com/users/iliasse-hassala/following{/other_user}","gists_url":"https://api.github.com/users/iliasse-hassala/gists{/gist_id}","starred_url":"https://api.github.com/users/iliasse-hassala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iliasse-hassala/subscriptions","organizations_url":"https://api.github.com/users/iliasse-hassala/orgs","repos_url":"https://api.github.com/users/iliasse-hassala/repos","events_url":"https://api.github.com/users/iliasse-hassala/events{/privacy}","received_events_url":"https://api.github.com/users/iliasse-hassala/received_events","type":"User","site_admin":false},"created_at":"2016-02-11T08:50:30Z","updated_at":"2016-02-11T08:50:30Z","author_association":"NONE","body":"Hi rjernst, thank you for your answer.\n\nActually I'm using a Dockerfile (below) i just changed the image i'm pulling (2.1 to 2.2).\nI have a 3 nodes setup : Node{0,1,2}\n\n```\nFROM elasticsearch:2.2\n\n        EXPOSE 9200 9300\n\n        RUN /usr/share/elasticsearch/bin/plugin install license\n        RUN /usr/share/elasticsearch/bin/plugin install marvel-agent\n        RUN /usr/share/elasticsearch/bin/plugin install delete-by-query\n        RUN export ES_HEAP_SIZE=30g\n        COPY ESconf/* /usr/share/elasticsearch/config/\n\nCMD elasticsearch\n```\n\nBasically what i noticed is that the translogs of 3 indices among 12 were not empty. And when i close these 3 indices the errors disappears but the cluster is stuck in red state.\nI run \"/_cat/shards\" in the master node (Node3) and i see that there are some UNASSIGNED shards belonging to Node0 I presume (primary ones, since i had no replicas in order to speed up the bulk injection).\n\nThe Master node sees 3 nodes :  \"_health\" gives this\n\n```\n{\n  \"cluster_name\" : \"NOSQL_elastic_cluster\",\n  \"status\" : \"red\",\n  \"timed_out\" : false,\n  \"number_of_nodes\" : 3,\n  \"number_of_data_nodes\" : 3,\n  \"active_primary_shards\" : 52,\n  \"active_shards\" : 69,\n  \"relocating_shards\" : 0,\n  \"initializing_shards\" : 0,\n  \"unassigned_shards\" : 25,\n  \"delayed_unassigned_shards\" : 0,\n  \"number_of_pending_tasks\" : 0,\n  \"number_of_in_flight_fetch\" : 0,\n  \"task_max_waiting_in_queue_millis\" : 0,\n  \"active_shards_percent_as_number\" : 73.40425531914893\n}\n```\n\nBut when i run the same command on Node0 I get nothing (it times out) so may be something else is going on with Node0. What is weird is that the logs of Node0 says everything is ok (it detects the master and joins the cluster) :\n\n```\n[2016-02-10 16:54:27,638][INFO ][node                     ] [Node0] version[2.2.0], pid[6], build[8ff36d1/2016-01-27T13:32:39Z]\n[2016-02-10 16:54:27,638][INFO ][node                     ] [Node0] initializing ...\n[2016-02-10 16:54:28,409][INFO ][plugins                  ] [Node0] modules [lang-expression, lang-groovy], plugins [license, marvel-agent, delete-by-query], sites []\n[2016-02-10 16:54:28,464][INFO ][env                      ] [Node0] using [1] data paths, mounts [[/usr/share/elasticsearch/data (h097b:/vol/K1NQDATASQL1/ESdata/Node0)]], net usable_space [1.3tb], net total_space [2.9tb], spins? [possibly], types [nfs]\n[2016-02-10 16:54:28,464][INFO ][env                      ] [Node0] heap size [30.6gb], compressed ordinary object pointers [true]\n[2016-02-10 16:54:31,097][INFO ][node                     ] [Node0] initialized\n[2016-02-10 16:54:31,097][INFO ][node                     ] [Node0] starting ...\n[2016-02-10 16:54:31,505][INFO ][transport                ] [Node0] publish_address {10.150.232.141:9301}, bound_addresses {[::]:9301}\n[2016-02-10 16:54:31,520][INFO ][discovery                ] [Node0] NOSQL_elastic_cluster/JFUJziK_QViw9kPut7Aopw\n[2016-02-10 16:54:34,672][INFO ][cluster.service          ] [Node0] detected_master {Node2}{ZyxfRlELTECjeiSk63Wutw}{10.150.232.143}{10.150.232.143:9300}, added {{Node1}{kv-JGvl0RaCzdzCL-WWQ0A}{10.150.232.142}{10.150.232.142:9300},{Node2}{ZyxfRlELTECjeiSk63Wutw}{10.150.232.143}{10.150.232.143:9300},}, reason: zen-disco-receive(from master [{Node2}{ZyxfRlELTECjeiSk63Wutw}{10.150.232.143}{10.150.232.143:9300}])\n[2016-02-10 16:54:34,820][INFO ][license.plugin.core      ] [Node0] license [4eedac74-a1d1-4023-8006-82db439db4f1] - valid\n[2016-02-10 16:54:35,201][INFO ][http                     ] [Node0] publish_address {10.150.232.141:9201}, bound_addresses {[::]:9201}\n[2016-02-10 16:54:35,202][INFO ][node                     ] [Node0] started\n```\n\nAny idea ? thanks for your help.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/182782344","html_url":"https://github.com/elastic/elasticsearch/issues/16581#issuecomment-182782344","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16581","id":182782344,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Mjc4MjM0NA==","user":{"login":"iliasse-hassala","id":11230261,"node_id":"MDQ6VXNlcjExMjMwMjYx","avatar_url":"https://avatars3.githubusercontent.com/u/11230261?v=4","gravatar_id":"","url":"https://api.github.com/users/iliasse-hassala","html_url":"https://github.com/iliasse-hassala","followers_url":"https://api.github.com/users/iliasse-hassala/followers","following_url":"https://api.github.com/users/iliasse-hassala/following{/other_user}","gists_url":"https://api.github.com/users/iliasse-hassala/gists{/gist_id}","starred_url":"https://api.github.com/users/iliasse-hassala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iliasse-hassala/subscriptions","organizations_url":"https://api.github.com/users/iliasse-hassala/orgs","repos_url":"https://api.github.com/users/iliasse-hassala/repos","events_url":"https://api.github.com/users/iliasse-hassala/events{/privacy}","received_events_url":"https://api.github.com/users/iliasse-hassala/received_events","type":"User","site_admin":false},"created_at":"2016-02-11T09:37:35Z","updated_at":"2016-02-11T09:37:35Z","author_association":"NONE","body":"I had to reroute manually the UNASSIGNED shards. I guess that i should stop the cluster more properly (i was doing some bulk injection) before doing the update.\n","performed_via_github_app":null}]