{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45115","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45115/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45115/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45115/events","html_url":"https://github.com/elastic/elasticsearch/issues/45115","id":475871010,"node_id":"MDU6SXNzdWU0NzU4NzEwMTA=","number":45115,"title":"Catch Exceptions thrown in LLRC callbacks to protect the client IO Reactor Thread","user":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"labels":[{"id":407508641,"node_id":"MDU6TGFiZWw0MDc1MDg2NDE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20Low%20Level%20REST%20Client","name":":Core/Features/Java Low Level REST Client","color":"0e8a16","default":false,"description":"Minimal dependencies Java Client for Elasticsearch"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-08-01T20:20:28Z","updated_at":"2019-12-09T21:58:29Z","closed_at":"2019-12-09T21:57:29Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In the LLRC, we do not handle `RuntimeException`s thrown in the `onFailure` listener of a request callback.\r\nSo e.g. this code:\r\n\r\n```java\r\n            restClient.performRequestAsync(request, new ResponseListener() {\r\n                @Override\r\n                public void onSuccess(Response response) {\r\n                      // ...\r\n                }\r\n\r\n                @Override\r\n                public void onFailure(Exception exception) {\r\n                    throw new RuntimeException(exception);\r\n                }\r\n            });\r\n```\r\n\r\nwill cause a broken client because the exception bubbles up in the IOReactor and it's being hard-shutdown as a result. This is something we should fix. It's always possible that due to some unforeseen state/bug/... an exception is thrown in the failure handler. While that shouldn't happen and callback code should be fixed, it's not right to simply silently shut down the io reactor here and fail subsequent requests (there isn't even logging in the example code above). Instead, we should probably catch all exceptions and worst case log a warning for the unhandled ones and not let them break the client.\r\n\r\nSplit off from #42133 ","closed_by":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"performed_via_github_app":null}