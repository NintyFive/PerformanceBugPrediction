{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20068","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20068/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20068/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20068/events","html_url":"https://github.com/elastic/elasticsearch/issues/20068","id":172014517,"node_id":"MDU6SXNzdWUxNzIwMTQ1MTc=","number":20068,"title":"Painless script_fields don't have access to a _source variable","user":{"login":"Bargs","id":6239176,"node_id":"MDQ6VXNlcjYyMzkxNzY=","avatar_url":"https://avatars3.githubusercontent.com/u/6239176?v=4","gravatar_id":"","url":"https://api.github.com/users/Bargs","html_url":"https://github.com/Bargs","followers_url":"https://api.github.com/users/Bargs/followers","following_url":"https://api.github.com/users/Bargs/following{/other_user}","gists_url":"https://api.github.com/users/Bargs/gists{/gist_id}","starred_url":"https://api.github.com/users/Bargs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bargs/subscriptions","organizations_url":"https://api.github.com/users/Bargs/orgs","repos_url":"https://api.github.com/users/Bargs/repos","events_url":"https://api.github.com/users/Bargs/events{/privacy}","received_events_url":"https://api.github.com/users/Bargs/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":777829541,"node_id":"MDU6TGFiZWw3Nzc4Mjk1NDE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.3","name":"v6.0.3","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"assignees":[{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false}],"milestone":null,"comments":33,"created_at":"2016-08-18T22:19:39Z","updated_at":"2020-05-18T02:34:07Z","closed_at":"2018-03-13T19:09:25Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: master\n\n**Plugins installed**: none\n\n**JVM version**:  1.8.0_60\n\n**OS version**: OSX El Capitan\n\n**Description of the problem including expected versus actual behavior**:\n\nAccording to [the docs](https://www.elastic.co/guide/en/elasticsearch/reference/master/search-request-script-fields.html) `script_fields` can access the document _source via a `_source` keyword. When attempting this with a Painless script, I get a `Variable [_source] is not defined.` error.\n\n**Steps to reproduce**:\n1. Execute a query with a painless script_field that attempts to access _source, something like this:\n\n```\n    \"script_fields\": {\n        \"scriptip\": {\n            \"script\": {\n                \"inline\": \"return _source.ip;\",\n                \"lang\": \"painless\"\n            }\n        }\n    }\n```\n\n**Provide logs (if relevant)**:\n\n```\n{\n  \"error\": {\n    \"root_cause\": [\n      {\n        \"type\": \"script_exception\",\n        \"reason\": \"compile error\",\n        \"script_stack\": [\n          \"return _source.ip;\",\n          \"       ^---- HERE\"\n        ],\n        \"script\": \"return _source.ip;\",\n        \"lang\": \"painless\"\n      }\n    ],\n    \"type\": \"search_phase_execution_exception\",\n    \"reason\": \"all shards failed\",\n    \"phase\": \"query_fetch\",\n    \"grouped\": true,\n    \"failed_shards\": [\n      {\n        \"shard\": 0,\n        \"index\": \"logstash-0\",\n        \"node\": \"00s71MPnSRenvz6mflLQeQ\",\n        \"reason\": {\n          \"type\": \"script_exception\",\n          \"reason\": \"compile error\",\n          \"caused_by\": {\n            \"type\": \"illegal_argument_exception\",\n            \"reason\": \"Variable [_source] is not defined.\"\n          },\n          \"script_stack\": [\n            \"return _source.ip;\",\n            \"       ^---- HERE\"\n          ],\n          \"script\": \"return _source.ip;\",\n          \"lang\": \"painless\"\n        }\n      }\n    ],\n    \"caused_by\": {\n      \"type\": \"script_exception\",\n      \"reason\": \"compile error\",\n      \"caused_by\": {\n        \"type\": \"illegal_argument_exception\",\n        \"reason\": \"Variable [_source] is not defined.\"\n      },\n      \"script_stack\": [\n        \"return _source.ip;\",\n        \"       ^---- HERE\"\n      ],\n      \"script\": \"return _source.ip;\",\n      \"lang\": \"painless\"\n    }\n  },\n  \"status\": 500\n}\n```\n\n**Describe the feature**:\n","closed_by":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"performed_via_github_app":null}