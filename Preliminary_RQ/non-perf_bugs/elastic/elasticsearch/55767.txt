{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/55767","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55767/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55767/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55767/events","html_url":"https://github.com/elastic/elasticsearch/issues/55767","id":606741131,"node_id":"MDU6SXNzdWU2MDY3NDExMzE=","number":55767,"title":"Expose preserve_original setting in edge ngram token filter","user":{"login":"amitmbm","id":4751393,"node_id":"MDQ6VXNlcjQ3NTEzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/4751393?v=4","gravatar_id":"","url":"https://api.github.com/users/amitmbm","html_url":"https://github.com/amitmbm","followers_url":"https://api.github.com/users/amitmbm/followers","following_url":"https://api.github.com/users/amitmbm/following{/other_user}","gists_url":"https://api.github.com/users/amitmbm/gists{/gist_id}","starred_url":"https://api.github.com/users/amitmbm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amitmbm/subscriptions","organizations_url":"https://api.github.com/users/amitmbm/orgs","repos_url":"https://api.github.com/users/amitmbm/repos","events_url":"https://api.github.com/users/amitmbm/events{/privacy}","received_events_url":"https://api.github.com/users/amitmbm/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":1967498216,"node_id":"MDU6TGFiZWwxOTY3NDk4MjE2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Search","name":"Team:Search","color":"fef2c0","default":false,"description":"Meta label for search team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-04-25T10:35:19Z","updated_at":"2020-04-28T08:23:06Z","closed_at":"2020-04-28T08:23:06Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"`preserve_original` setting is currently not supported in the `EdgeNGramTokenFilter` https://www.elastic.co/guide/en/elasticsearch/reference/master/analysis-edgengram-tokenfilter.html#analysis-edgengram-tokenfilter\r\nand there is even TODO comment in the master code of Elasticsearch(as of 25th Apr 2020) to Expose `preserve_original` as shown in this GitHub code link \r\nhttps://github.com/elastic/elasticsearch/blob/master/modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/EdgeNGramTokenFilterFactory.java#L66\r\n\r\nElasticsearch version (bin/elasticsearch --version):\r\n8.0.0-SNAPSHOT\r\n\r\nPlugins installed: []\r\nN/A\r\n\r\nJVM version (java -version):\r\nopenjdk 14.0.1 2020-04-14\r\nOpenJDK Runtime Environment (build 14.0.1+7)\r\nOpenJDK 64-Bit Server VM (build 14.0.1+7, mixed mode, sharing)\r\n\r\nOS version (uname -a if on a Unix-like system):\r\nDarwin LT6577 19.3.0 Darwin Kernel Version 19.3.0: Thu Jan 9 20:58:23 PST 2020; root:xnu-6153.81.5~1/RELEASE_X86_64 x86_64\r\n\r\nDescription of the problem including expected versus actual behavior:\r\nIts a feature request and mentioned in the TODO of Elasticsearch master code, if provided preserve original functionality would work with n-gram token filter.\r\nSteps to reproduce:\r\n\r\nPlease include a minimal but complete recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc. The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n**1. Delete the existing index with the name `preserveoriginal` to test this feature.**\r\n`curl --user elastic:password -XDELETE localhost:9200/preserveoriginal`\r\n**2. Create a new index with custom analyzer which uses edge-ngram token filter.**\r\n```\r\ncurl --user elastic:123456 -X PUT \"localhost:9200/preserveoriginal?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"settings\": {\r\n        \"max_ngram_diff\": 50,\r\n        \"analysis\": {\r\n            \"filter\": {\r\n                \"edge_ngram_filter\": {\r\n                    \"type\": \"edge_ngram\",\r\n                    \"min_gram\": 1,\r\n                    \"max_gram\": 2\r\n                }\r\n            },\r\n            \"analyzer\": {\r\n                \"edge_ngram_analyzer\": {\r\n                    \"type\": \"custom\",\r\n                    \"tokenizer\": \"whitespace\",\r\n                    \"filter\": [\r\n                        \"lowercase\",\r\n                        \"edge_ngram_filter\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n'\r\n```\r\n3. **Check the tokens generated by ngram_analyzer created in the above step:**\r\n\r\n```\r\ncurl --user elastic:123456 -X GET \"localhost:9200/preserveoriginal/_analyze?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"analyzer\" : \"edge_ngram_analyzer\",\r\n  \"text\" : \"foo\"\r\n}\r\n'\r\n\r\n```\r\n\r\n**4.The output of the above analyzer API.**\r\n\r\n```\r\n{\r\n  \"tokens\" : [\r\n    {\r\n      \"token\" : \"f\",\r\n      \"start_offset\" : 0,\r\n      \"end_offset\" : 3,\r\n      \"type\" : \"word\",\r\n      \"position\" : 0\r\n    },\r\n    {\r\n      \"token\" : \"fo\",\r\n      \"start_offset\" : 0,\r\n      \"end_offset\" : 3,\r\n      \"type\" : \"word\",\r\n      \"position\" : 0\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n**Pease note `foo` original token isn't present in the result.**\r\n\r\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}