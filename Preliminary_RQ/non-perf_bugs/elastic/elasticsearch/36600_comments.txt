[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447014325","html_url":"https://github.com/elastic/elasticsearch/issues/36600#issuecomment-447014325","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36600","id":447014325,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzAxNDMyNQ==","user":{"login":"loretoparisi","id":163333,"node_id":"MDQ6VXNlcjE2MzMzMw==","avatar_url":"https://avatars3.githubusercontent.com/u/163333?v=4","gravatar_id":"","url":"https://api.github.com/users/loretoparisi","html_url":"https://github.com/loretoparisi","followers_url":"https://api.github.com/users/loretoparisi/followers","following_url":"https://api.github.com/users/loretoparisi/following{/other_user}","gists_url":"https://api.github.com/users/loretoparisi/gists{/gist_id}","starred_url":"https://api.github.com/users/loretoparisi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loretoparisi/subscriptions","organizations_url":"https://api.github.com/users/loretoparisi/orgs","repos_url":"https://api.github.com/users/loretoparisi/repos","events_url":"https://api.github.com/users/loretoparisi/events{/privacy}","received_events_url":"https://api.github.com/users/loretoparisi/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T15:42:03Z","updated_at":"2018-12-13T15:42:03Z","author_association":"NONE","body":"**[UPDATE]**\r\n\r\nI'm not sure the reason, but using the operator `==` and `null` it works like\r\n\r\n```javascript\r\nscript: {\r\n                            source: \"if ( ctx._source.tags == null ) ctx._source.tags=[]; if ( !ctx._source.tags.contains(params.tag) ) ctx._source.tags.add(params.tag);\",\r\n                            params: {\r\n                                tag: \"blue\"\r\n                            }\r\n                        },\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447064990","html_url":"https://github.com/elastic/elasticsearch/issues/36600#issuecomment-447064990","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36600","id":447064990,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzA2NDk5MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T18:07:11Z","updated_at":"2018-12-13T18:07:11Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447089949","html_url":"https://github.com/elastic/elasticsearch/issues/36600#issuecomment-447089949","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36600","id":447089949,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzA4OTk0OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T19:26:35Z","updated_at":"2018-12-13T19:26:35Z","author_association":"MEMBER","body":"Thanks very much for your interest in Elasticsearch.\r\n\r\nThis does not appear to be a bug.  The expression `ctx._source.tags` will do a lookup in the `ctx._source` Map. Since the `tags` field does not exist, it returns null, which using the `!` operator then tries to convert to a boolean. To check for the existence of a field, use `containsKey('fieldname')` on a Map.\r\n\r\nThere's an active community in the [forums](https://discuss.elastic.co/) that should be able to help with your issue. As such, I hope you don't mind that I close this.","performed_via_github_app":null}]