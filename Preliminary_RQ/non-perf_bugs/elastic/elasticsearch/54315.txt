{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/54315","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54315/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54315/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54315/events","html_url":"https://github.com/elastic/elasticsearch/issues/54315","id":588849332,"node_id":"MDU6SXNzdWU1ODg4NDkzMzI=","number":54315,"title":"Unable to create filtered alias, using range, data_nanos and negative offsets(now-7d)","user":{"login":"cpitchford","id":2324225,"node_id":"MDQ6VXNlcjIzMjQyMjU=","avatar_url":"https://avatars3.githubusercontent.com/u/2324225?v=4","gravatar_id":"","url":"https://api.github.com/users/cpitchford","html_url":"https://github.com/cpitchford","followers_url":"https://api.github.com/users/cpitchford/followers","following_url":"https://api.github.com/users/cpitchford/following{/other_user}","gists_url":"https://api.github.com/users/cpitchford/gists{/gist_id}","starred_url":"https://api.github.com/users/cpitchford/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cpitchford/subscriptions","organizations_url":"https://api.github.com/users/cpitchford/orgs","repos_url":"https://api.github.com/users/cpitchford/repos","events_url":"https://api.github.com/users/cpitchford/events{/privacy}","received_events_url":"https://api.github.com/users/cpitchford/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-03-27T02:49:33Z","updated_at":"2020-04-16T16:41:45Z","closed_at":"2020-04-16T16:41:45Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): OpenJDK 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.\r\nVersion: 7.6.1, Build: default/docker/aa751e09be0a5072e8570670309b1f12348f023b/2020-02-29T00:15:25.529771Z, JVM: 13.0.2\r\n\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): openjdk version \"13.0.2\" 2020-01-14\r\nOpenJDK Runtime Environment AdoptOpenJDK (build 13.0.2+8)\r\nOpenJDK 64-Bit Server VM AdoptOpenJDK (build 13.0.2+8, mixed mode, sharing)\r\n\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux ad9271944652 4.19.76-linuxkit #1 SMP Thu Oct 17 19:31:58 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n\r\n**Error is returned when attempting to create a filtered alias that uses a range, with a data_nanos field, using now, and a negative offset (such as now-7d)**\r\n\r\nThis error does not appear when using date fields or when using positive offsets (such as now+7d)\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Create index with date_nanos field\r\n\r\n```json\r\nPUT date_source\r\n{\r\n  \"mappings\": {\r\n    \"properties\": {\r\n      \"date\": {\r\n        \"type\": \"date\"\r\n      },\r\n      \"date_nanos\": {\r\n        \"type\": \"date_nanos\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n2. Create a filtered alias, filtering data_nanos field using negative offset (now-7d/d)\r\n\r\n```json\r\nPUT date_source/_alias/date_nanos_alias\r\n{\r\n  \"filter\": {\r\n   \"range\": {\r\n      \"date_nanos\": {\r\n        \"gt\": \"now-7d/d\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n3. Receive an error:\r\n\r\n```json\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"illegal_argument_exception\",\r\n        \"reason\" : \"failed to parse filter for alias [date_nanos_alias]\"\r\n      }\r\n    ],\r\n    \"type\" : \"illegal_argument_exception\",\r\n    \"reason\" : \"failed to parse filter for alias [date_nanos_alias]\",\r\n    \"caused_by\" : {\r\n      \"type\" : \"illegal_argument_exception\",\r\n      \"reason\" : \"date[1969-12-25T23:59:59.999Z] is before the epoch in 1970 and cannot be stored in nanosecond resolution\"\r\n    }\r\n  },\r\n  \"status\" : 400\r\n}\r\n```\r\n\r\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}