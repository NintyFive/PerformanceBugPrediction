[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/118267805","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-118267805","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":118267805,"node_id":"MDEyOklzc3VlQ29tbWVudDExODI2NzgwNQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2015-07-03T07:53:46Z","updated_at":"2015-07-03T07:53:46Z","author_association":"MEMBER","body":"+1 to this.\n\nPersonally I think it should be one setting for the search request in general since I don't see a reason why you would want to be notified of deprecated keys in your queries but not in your aggregations, etc.\n\nIt would be great to collate the error and print them all at once as this would save users lots of time when debugging syntax problems\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/118637483","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-118637483","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":118637483,"node_id":"MDEyOklzc3VlQ29tbWVudDExODYzNzQ4Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-07-05T16:43:42Z","updated_at":"2015-07-05T16:43:42Z","author_association":"CONTRIBUTOR","body":"Actually, that setting was added for percolator queries and alias filters, where creating a query on an unmapped field led to it assuming the field was a string.  i think the setting was added because a user complained about the change.  Honestly, what they are doing is broken and I think we shouldn't support their particular use case. I do wonder if the need for this has been fixed by https://github.com/elastic/elasticsearch/pull/11930?  (at least for aliases if not for percolators?)\n\nI think strict field lookups is distinct from warning/throwing exceptions for the use of deprecated functionality.  This issue deals with fieldname lookups: https://github.com/elastic/elasticsearch/issues/12016\n\nBut yes, I'm in favour of having a setting that controls whether the use of deprecated functionality throws an exception, warns to the deprecation log, or is ignored (see https://github.com/elastic/elasticsearch/issues/8963 for the original suggestion)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/118749117","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-118749117","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":118749117,"node_id":"MDEyOklzc3VlQ29tbWVudDExODc0OTExNw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-07-06T07:07:28Z","updated_at":"2015-07-06T07:07:28Z","author_association":"MEMBER","body":"Thanks for pointing this out @clintongormley I had a look at the codebase and this is what I found.\n\nI do see in the history that `index.query.parse.strict` and `index.query.parse.allow_unmapped_fields` were introduced at the same time in the context of percolation and aliases. That said `index.query.parse.strict` was hooked into the existing `ParseField` infra as far as I can see, to enable/disable deprecation exceptions through it, which is the only thing that this setting does at the moment.\n\nThe error message that we are used to in the context of aliases and percolation \"Strict field resolution and no field mapping can be found for the field with name...\" depends on the value of the `index.query.parse.allow_unmapped_fields` setting though, nothing to do with the strict query parsing setting. Maybe @martijnvg can confirm on how we use these two settings.\n\nI think it is worth at this point to introduce a new (more generic) setting to enable deprecation exceptions, which is not just a boolean but allows to either throw exception or log deprecation warning by using the deprecation logger that we now have.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/118761862","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-118761862","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":118761862,"node_id":"MDEyOklzc3VlQ29tbWVudDExODc2MTg2Mg==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-07-06T07:50:48Z","updated_at":"2015-07-06T07:50:48Z","author_association":"MEMBER","body":"The `index.query.parse.allow_unmapped_fields` setting can fail a search request if no mapping for a field can be found. The percolator relies on this setting, because it parse the percolator queries at creation time and a mapping misconfiguration can lead to unexpected and difficult experience during percolating. Also aliases still uses the `index.query.parse.allow_unmapped_fields` setting. I did not disable this as part of #11930, even though aliases are now parsed at search time. It could be disabled, but I didn't do that, because it felt to me it is good to know that an alias filter is incorrect at creation time rather then at search time, since the alias filter isn't defined in the search request it self and this makes things confusing. It felt to me that this behaviour should be changed in a different change (#11806, but this was later superseded by #12016)\n\nThe `index.query.parse.strict` was always there and deals with deprecated json format. The setting was there before strict parsing was added to the percolator and alias fields. This setting was just changed into a constant as part of the strict parsing change. \n\nThe `index.percolator.map_unmapped_fields_as_string` setting was added, because users in certain percolator scenarios (in cases when fields aren't known beforehand) did prefer flexibility over strictness and like the name suggests treats unmapped fields as string fields.\n\nIMO all these settings are completely obsolete when #12016 gets added and the `index.query.parse.allow_unmapped_fields` and `index.percolator.map_unmapped_fields_as_string` should be removed as part of that change. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/119219366","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-119219366","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":119219366,"node_id":"MDEyOklzc3VlQ29tbWVudDExOTIxOTM2Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-07-07T14:20:09Z","updated_at":"2015-07-07T14:20:09Z","author_association":"CONTRIBUTOR","body":"> The index.query.parse.strict was always there and deals with deprecated json format. The setting was there before strict parsing was added to the percolator and alias fields. This setting was just changed into a constant as part of the strict parsing change.\n\nAh ok - i got the two mixed up.\n\n> IMO all these settings are completely obsolete when #12016 gets added and the index.query.parse.allow_unmapped_fields and index.percolator.map_unmapped_fields_as_string should be removed as part of that change.\n\nI'm not sure I agree completely here (but maybe I'm missing something). As I understand it:\n- alias filters are now parsed at execution time so they don't need the strict query parsing any more\n- however percolators are still parsed only once, and so are susceptible to the same problems as before.\n- the `map_unmapped_fields_as_string` setting was added for that one user's use case, which i still think is broken and i'm very tempted to remove it\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/119887076","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-119887076","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":119887076,"node_id":"MDEyOklzc3VlQ29tbWVudDExOTg4NzA3Ng==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-07-09T09:25:36Z","updated_at":"2015-07-09T09:25:36Z","author_association":"MEMBER","body":"> alias filters are now parsed at execution time so they don't need the strict query parsing any more\n\nOk, lets disable the strict parsing for alias filters.\n\n> however percolators are still parsed only once, and so are susceptible to the same problems as before.\n\nTrue, we still need that, I made my conclusions too quick.\n\n> the map_unmapped_fields_as_string setting was added for that one user's use case, which i still think is broken and i'm very tempted to remove it\n\nis there a bug with `map_unmapped_fields_as_string` setting?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/119897368","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-119897368","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":119897368,"node_id":"MDEyOklzc3VlQ29tbWVudDExOTg5NzM2OA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-07-09T10:08:45Z","updated_at":"2015-07-09T10:08:45Z","author_association":"MEMBER","body":"I opened #12150 for alias filters.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/120301553","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-120301553","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":120301553,"node_id":"MDEyOklzc3VlQ29tbWVudDEyMDMwMTU1Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-07-10T08:37:51Z","updated_at":"2015-07-10T08:37:51Z","author_association":"CONTRIBUTOR","body":"> is there a bug with map_unmapped_fields_as_string setting?\n\nNot that there is a bug, just that their use case \"assume all unmapped fields are strings\" seems pretty broken.  Why would you create a percolator for an unknown field?\n\n(While we're on it, a wildcarded field name in a percolator query suffers from a similar problem: it would  just take into account fields that exist when the query is instantiated)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/120365225","html_url":"https://github.com/elastic/elasticsearch/issues/11996#issuecomment-120365225","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11996","id":120365225,"node_id":"MDEyOklzc3VlQ29tbWVudDEyMDM2NTIyNQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-07-10T10:30:52Z","updated_at":"2015-07-10T10:30:52Z","author_association":"MEMBER","body":"my proposals are now formalized as part of #8963 and we also have #12179 for percolator queries, I think we can close this issue then.\n","performed_via_github_app":null}]