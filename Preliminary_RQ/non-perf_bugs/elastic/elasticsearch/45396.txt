{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45396","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45396/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45396/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45396/events","html_url":"https://github.com/elastic/elasticsearch/issues/45396","id":479066869,"node_id":"MDU6SXNzdWU0NzkwNjY4Njk=","number":45396,"title":"ES 6.8.1 (also 7.2.1) fails to start (probably due to cgroups)","user":{"login":"kakra","id":17684,"node_id":"MDQ6VXNlcjE3Njg0","avatar_url":"https://avatars3.githubusercontent.com/u/17684?v=4","gravatar_id":"","url":"https://api.github.com/users/kakra","html_url":"https://github.com/kakra","followers_url":"https://api.github.com/users/kakra/followers","following_url":"https://api.github.com/users/kakra/following{/other_user}","gists_url":"https://api.github.com/users/kakra/gists{/gist_id}","starred_url":"https://api.github.com/users/kakra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kakra/subscriptions","organizations_url":"https://api.github.com/users/kakra/orgs","repos_url":"https://api.github.com/users/kakra/repos","events_url":"https://api.github.com/users/kakra/events{/privacy}","received_events_url":"https://api.github.com/users/kakra/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"assignees":[{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2019-08-09T16:20:26Z","updated_at":"2019-08-16T16:28:54Z","closed_at":"2019-08-16T08:26:57Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n6.8.1 (Gentoo ebuild)\r\nrunning in a systemd nspawn container\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_212\"\r\nOpenJDK Runtime Environment (IcedTea 3.12.0) (Gentoo icedtea-3.12.0)\r\nOpenJDK 64-Bit Server VM (build 25.212-b04, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux es6 5.2.7-gentoo #1 SMP Fri Aug 9 11:40:38 CEST 2019 x86_64 Intel(R) Core(TM) i5-3470 CPU @ 3.20GHz GenuineIntel GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nSince upgrading ES in my development container, it no longer starts. It crashes with a stack trace pointing to problems determining cgroup controllers. Researching other reports showed that the problem should be fixed, but it still shows for me. Logs below.\r\n\r\nLast known good version:\r\n`Sat Sep 15 02:21:22 2018 >>> app-misc/elasticsearch-6.4.0`\r\n\r\n**Steps to reproduce**:\r\n\r\n```\r\nes6 ~ # ls -l /sys/fs/cgroup\r\ninsgesamt 0\r\ndrwxr-xr-x 2 nobody nobody 0  9. Aug 17:42 blkio\r\ndrwxr-xr-x 2 nobody nobody 0  9. Aug 17:42 cpu\r\nlrwxrwxrwx 1 root   root   3  9. Aug 17:42 cpuacct -> cpu\r\ndrwxr-xr-x 2 nobody nobody 0  9. Aug 17:42 devices\r\ndrwxr-xr-x 2 nobody nobody 0  9. Aug 17:42 memory\r\ndr-xr-xr-x 2 nobody nobody 0  9. Aug 11:57 net_cls\r\nlrwxrwxrwx 1 root   root   7  9. Aug 17:42 net_prio -> net_cls\r\ndrwxr-xr-x 2 nobody nobody 0  9. Aug 17:42 pids\r\ndrwxr-xr-x 5 root   root   0  9. Aug 17:42 systemd\r\ndrwxr-xr-x 5 root   root   0  9. Aug 17:42 unified\r\n\r\nes6 ~ # cat /proc/cgroups\r\n#subsys_name    hierarchy       num_cgroups     enabled\r\ncpu     2       88      1\r\nblkio   4       108     1\r\nmemory  5       128     1\r\ndevices 3       86      1\r\nnet_cls 6       1       1\r\npids    7       92      1\r\n\r\nes6 ~ # cat /proc/self/cgroup\r\n7:pids:/\r\n6:net_cls:/\r\n5:memory:/\r\n4:blkio:/\r\n3:devices:/\r\n2:cpu:/\r\n1:name=systemd:/user.slice/user-0.slice/session-c1.scope\r\n0::/user.slice/user-0.slice/session-c1.scope\r\n\r\nes6 ~ # mount -t cgroup\r\ncgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)\r\ncgroup on /sys/fs/cgroup/net_cls type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls)\r\ncgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)\r\ncgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)\r\ncgroup on /sys/fs/cgroup/cpu type cgroup (rw,nosuid,nodev,noexec,relatime,cpu)\r\ncgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)\r\ncgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd)\r\n\r\nes6 ~ # grep cgroup /proc/self/mountinfo\r\n1067 1141 0:106 / /sys/fs/cgroup ro,nosuid,nodev,noexec - tmpfs tmpfs ro,mode=755,uid=65536,gid=65536\r\n1068 1067 0:29 / /sys/fs/cgroup/memory rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,memory\r\n1069 1067 0:30 / /sys/fs/cgroup/net_cls rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,net_cls\r\n1070 1067 0:27 / /sys/fs/cgroup/devices rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,devices\r\n1071 1067 0:28 / /sys/fs/cgroup/blkio rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,blkio\r\n1073 1067 0:26 / /sys/fs/cgroup/cpu rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,cpu\r\n1074 1067 0:31 / /sys/fs/cgroup/pids rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,pids\r\n1075 1067 0:21 / /sys/fs/cgroup/unified rw,nosuid,nodev,noexec,relatime - cgroup2 cgroup rw,nsdelegate\r\n1076 1067 0:22 / /sys/fs/cgroup/systemd rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,xattr,name=systemd\r\n\r\n# FULL LOG AT THE END\r\nes6 ~ # systemctl start elasticsearch.service\r\nes6 ~ # systemctl status elasticsearch.service\r\n● elasticsearch.service - Elasticsearch\r\n   Loaded: loaded (/lib/systemd/system/elasticsearch.service; enabled; vendor preset: disabled)\r\n  Drop-In: /etc/systemd/system/elasticsearch.service.d\r\n           └─00gentoo.conf, override.conf\r\n   Active: failed (Result: exit-code) since Fri 2019-08-09 18:18:28 CEST; 640ms ago\r\n     Docs: https://www.elastic.co\r\n  Process: 437 ExecStartPre=/usr/share/elasticsearch/bin/elasticsearch-systemd-pre-exec (code=exited, status=0/SUCCESS)\r\n  Process: 438 ExecStart=/usr/share/elasticsearch/bin/elasticsearch -p ${PID_DIR}/elasticsearch.pid -Epath.logs=${LOG_DIR} -Epath.data=${DATA_DIR} (code=exited, status=1/FAILURE)\r\n Main PID: 438 (code=exited, status=1/FAILURE)\r\n\r\nAug 09 18:18:28 es6 elasticsearch[438]:         at org.elasticsearch.monitor.MonitorService.<init>(MonitorService.java:46) ~[elasticsearch-6.8.1.jar:6.8.1]\r\nAug 09 18:18:28 es6 elasticsearch[438]:         at org.elasticsearch.node.Node.<init>(Node.java:399) ~[elasticsearch-6.8.1.jar:6.8.1]\r\nAug 09 18:18:28 es6 elasticsearch[438]:         at org.elasticsearch.node.Node.<init>(Node.java:266) ~[elasticsearch-6.8.1.jar:6.8.1]\r\nAug 09 18:18:28 es6 elasticsearch[438]:         at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:212) ~[elasticsearch-6.8.1.jar:6.8.1]\r\nAug 09 18:18:28 es6 elasticsearch[438]:         at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:212) ~[elasticsearch-6.8.1.jar:6.8.1]\r\nAug 09 18:18:28 es6 elasticsearch[438]:         at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:333) ~[elasticsearch-6.8.1.jar:6.8.1]\r\nAug 09 18:18:28 es6 elasticsearch[438]:         at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) ~[elasticsearch-6.8.1.jar:6.8.1]\r\nAug 09 18:18:28 es6 elasticsearch[438]:         ... 6 more\r\nAug 09 18:18:28 es6 systemd[1]: elasticsearch.service: Main process exited, code=exited, status=1/FAILURE\r\nAug 09 18:18:28 es6 systemd[1]: elasticsearch.service: Failed with result 'exit-code'.\r\n```\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\njava.lang.NullPointerException: null\r\n        at sun.nio.fs.UnixFileSystem.getPath(UnixFileSystem.java:273) ~[?:?]\r\n        at org.elasticsearch.common.io.PathUtils.get(PathUtils.java:60) ~[elasticsearch-core-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsProbe.readSysFsCgroupCpuAcctCpuAcctUsage(OsProbe.java:277) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsProbe.getCgroupCpuAcctUsageNanos(OsProbe.java:264) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsProbe.getCgroup(OsProbe.java:483) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsProbe.osStats(OsProbe.java:603) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsService.<init>(OsService.java:49) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.MonitorService.<init>(MonitorService.java:46) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:399) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:266) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:212) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:212) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:333) [elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) [elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150) [elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) [elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) [elasticsearch-cli-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.cli.Command.main(Command.java:90) [elasticsearch-cli-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:116) [elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) [elasticsearch-6.8.1.jar:6.8.1]\r\n[2019-08-09T17:46:33,105][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [QoY4z88] uncaught exception in thread [main]\r\norg.elasticsearch.bootstrap.StartupException: java.lang.NullPointerException\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:163) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[elasticsearch-cli-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:116) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[elasticsearch-6.8.1.jar:6.8.1]\r\nCaused by: java.lang.NullPointerException\r\n        at sun.nio.fs.UnixFileSystem.getPath(UnixFileSystem.java:273) ~[?:?]\r\n        at org.elasticsearch.common.io.PathUtils.get(PathUtils.java:60) ~[elasticsearch-core-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsProbe.readSysFsCgroupCpuAcctCpuAcctUsage(OsProbe.java:277) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsProbe.getCgroupCpuAcctUsageNanos(OsProbe.java:264) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsProbe.getCgroup(OsProbe.java:483) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsProbe.osStats(OsProbe.java:603) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.os.OsService.<init>(OsService.java:49) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.monitor.MonitorService.<init>(MonitorService.java:46) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:399) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:266) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:212) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:212) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:333) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        ... 6 more\r\n```","closed_by":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"performed_via_github_app":null}