{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2800","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2800/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2800/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2800/events","html_url":"https://github.com/elastic/elasticsearch/issues/2800","id":12195371,"node_id":"MDU6SXNzdWUxMjE5NTM3MQ==","number":2800,"title":"Stemmer override with large rule set causing java.lang.OutOfMemoryError: Java heap space","user":{"login":"vhyza","id":264954,"node_id":"MDQ6VXNlcjI2NDk1NA==","avatar_url":"https://avatars2.githubusercontent.com/u/264954?v=4","gravatar_id":"","url":"https://api.github.com/users/vhyza","html_url":"https://github.com/vhyza","followers_url":"https://api.github.com/users/vhyza/followers","following_url":"https://api.github.com/users/vhyza/following{/other_user}","gists_url":"https://api.github.com/users/vhyza/gists{/gist_id}","starred_url":"https://api.github.com/users/vhyza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vhyza/subscriptions","organizations_url":"https://api.github.com/users/vhyza/orgs","repos_url":"https://api.github.com/users/vhyza/repos","events_url":"https://api.github.com/users/vhyza/events{/privacy}","received_events_url":"https://api.github.com/users/vhyza/received_events","type":"User","site_admin":false},"labels":[{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":32716575,"node_id":"MDU6TGFiZWwzMjcxNjU3NQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.0.RC2","name":"v0.90.0.RC2","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2013-03-19T18:42:18Z","updated_at":"2013-03-21T06:59:14Z","closed_at":"2013-03-21T06:59:14Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hello,\n\nI was trying to create czech lemmatisation analyzer using [stemmer override filter](http://www.elasticsearch.org/guide/reference/index-modules/analysis/stemmer-override-tokenfilter.html) and czech dictionary from [aspell](ftp://ftp.gnu.org/gnu/aspell/dict/cs).\n\nThis dictionary contains around `300 000` words in base form and some suffix/prefix rules. After expansion format file looks like this\n\n```\nAakjaer Aakjaerech Aakjaery Aakjaerům Aakjaerů Aakjaerem Aakjaere Aakjaerovi Aakjaeru Aakjaera Aakjaerové\nAakjaerová Aakjaerovými Aakjaerovým Aakjaerových Aakjaerovou Aakjaerové\nAakjaerův Aakjaerovýma Aakjaerovými Aakjaerových Aakjaerovou Aakjaerovo Aakjaerovy Aakjaerovi Aakjaerovým \n```\n\neach line is one word with its forms. \n\nBecause of rules format `form => lemma` the final rule set is expanded from `300 000` to `4 364 674` lines. \n\nWhen I was trying on my local machine to index czech wikipedia pages (around `400 000` documents) `java.lang.OutOfMemoryError: Java heap space` error occured after approx 10 minutes of indexing (log file [here](https://gist.github.com/vhyza/9f88b921a1d0f650ccd8#file-elasticsearch-log))\n\nI'm using snapshot build of elasticsearch ([54e7e309a5d407b2fb1123a79e6af9d62e41ea1e](https://github.com/elasticsearch/elasticsearch/commit/54e7e309a5d407b2fb1123a79e6af9d62e41ea1e)), `JAVA_OPTS -Xss200000 -Xms2g -Xmx2g` with no other indices.\n\nIndex settings/mapping and river settings are in separate [gist](https://gist.github.com/vhyza/9f88b921a1d0f650ccd8#file-stemmer_override_test-sh)\n\nI was trying to achieve this functionality using [synonym token filter](http://www.elasticsearch.org/guide/reference/index-modules/analysis/synonym-tokenfilter.html), because of better format of synonym rules - `form1, form2, form3, form4 => lemma` (so number of rules are only about `300 000`).\n\nBut it's not the same. In the case of using `stemmer override filter`, when token was not found in rule set, stemmer was used. I probably can do the same by adding [keyword marker](http://www.elasticsearch.org/guide/reference/index-modules/analysis/keyword-marker-tokenfilter.html) and [stemmer](http://www.elasticsearch.org/guide/reference/index-modules/analysis/stemmer-tokenfilter.html) in the filter chain, but I don't think it is the right way to do that.\n\nPlease, is there some better 'compressed' format of `stemmer override filter` rules? Any thoughts how to avoid `java.lang.OutOfMemoryError: Java heap space` error?\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}