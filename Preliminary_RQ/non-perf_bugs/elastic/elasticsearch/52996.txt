{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52996","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52996/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52996/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52996/events","html_url":"https://github.com/elastic/elasticsearch/issues/52996","id":573841105,"node_id":"MDU6SXNzdWU1NzM4NDExMDU=","number":52996,"title":"When I using the \"normalizer\" seting under the \"fields\" setting is not work","user":{"login":"boat320","id":37325802,"node_id":"MDQ6VXNlcjM3MzI1ODAy","avatar_url":"https://avatars1.githubusercontent.com/u/37325802?v=4","gravatar_id":"","url":"https://api.github.com/users/boat320","html_url":"https://github.com/boat320","followers_url":"https://api.github.com/users/boat320/followers","following_url":"https://api.github.com/users/boat320/following{/other_user}","gists_url":"https://api.github.com/users/boat320/gists{/gist_id}","starred_url":"https://api.github.com/users/boat320/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boat320/subscriptions","organizations_url":"https://api.github.com/users/boat320/orgs","repos_url":"https://api.github.com/users/boat320/repos","events_url":"https://api.github.com/users/boat320/events{/privacy}","received_events_url":"https://api.github.com/users/boat320/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-03-02T09:37:05Z","updated_at":"2020-03-02T11:19:52Z","closed_at":"2020-03-02T11:19:52Z","author_association":"NONE","active_lock_reason":null,"body":"\r\nelasticsearch 6.7\r\njdk1.8\r\nmy problem is when I using the \"normalizer\" seting under the \"fields\" setting is not work.\r\nthis is my setting:\r\n\r\n######It's work########\r\n{\r\n      \"settings\": {\r\n    \"analysis\": {\r\n      \"char_filter\": {\r\n        \"quote\": {\r\n          \"type\": \"pattern_replace\",\r\n          \"pattern\": \"\\\\?.*\",\r\n          \"replacement\": \"\"\r\n        }\r\n      },\r\n      \"normalizer\": {\r\n        \"my_normalizer\": {\r\n          \"type\": \"custom\",\r\n          \"char_filter\": [\"quote\"]\r\n        }\r\n      }\r\n    }\r\n  },\r\n\"mappings\": {\r\n    \"doc\": {\r\n      \"properties\": {\r\n        \"request\": {\r\n          \"type\" : \"keyword\",\r\n          \"normalizer\":\"my_normalizer\",\r\n          \"fields\" : {\r\n           \"text\":{\r\n            \"type\": \"text\"\r\n           }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n###########\r\n\r\n\r\n##########It's not work#########\r\n{\r\n      \"settings\": {\r\n    \"analysis\": {\r\n      \"char_filter\": {\r\n        \"quote\": {\r\n          \"type\": \"pattern_replace\",\r\n          \"pattern\": \"\\\\?.*\",\r\n          \"replacement\": \"\"\r\n        }\r\n      },\r\n      \"normalizer\": {\r\n        \"my_normalizer\": {\r\n          \"type\": \"custom\",\r\n          \"char_filter\": [\"quote\"]\r\n        }\r\n      }\r\n    }\r\n  },\r\n\"mappings\": {\r\n    \"doc\": {\r\n      \"properties\": {\r\n        \"request\": {\r\n          \"type\" : \"text\",\r\n          \"fields\" : {\r\n           \"keyword\":{\r\n            \"type\": \"keyword\",\r\n            \"normalizer\":\"my_normalizer\"\r\n           }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n########################\r\n\r\nYou cat see different in this commend\r\n\r\n\r\nPOST huanghui-analyzer/doc\r\n{\r\n    \"request\": \"/partner/OrderQuery.actio?111\"\r\n}\r\nPOST huanghui-analyzer/doc\r\n{\r\n    \"request\": \"/partner/OrderQuery.actio?222\"\r\n}\r\nPOST huanghui-analyzer/doc\r\n{\r\n    \"request\": \"/partner/OrderQuery.actio?333\"\r\n}\r\n\r\nWhen use the first mapping:\r\nGET huanghui-analyzer/_search\r\n{\r\n  \"size\": 0, \r\n    \"aggs\" : {\r\n        \"genres\" : {\r\n            \"terms\" : { \"field\" : \"request\" } \r\n        }\r\n    }\r\n}\r\n\r\nWhen use the last mapping:\r\nGET huanghui-analyzer/_search\r\n{\r\n  \"size\": 0, \r\n    \"aggs\" : {\r\n        \"genres\" : {\r\n            \"terms\" : { \"field\" : \"request.keyword\" } \r\n        }\r\n    }\r\n}","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}