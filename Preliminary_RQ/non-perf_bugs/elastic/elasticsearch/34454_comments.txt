[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/429838562","html_url":"https://github.com/elastic/elasticsearch/issues/34454#issuecomment-429838562","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34454","id":429838562,"node_id":"MDEyOklzc3VlQ29tbWVudDQyOTgzODU2Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-15T12:43:46Z","updated_at":"2018-10-15T12:43:46Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441131120","html_url":"https://github.com/elastic/elasticsearch/issues/34454#issuecomment-441131120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34454","id":441131120,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTEzMTEyMA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-11-22T22:56:47Z","updated_at":"2018-11-22T22:56:47Z","author_association":"CONTRIBUTOR","body":"Gentlemen from @elastic/es-security,\r\n\r\nPlease help me to outline the user experience for the new workflow of snapshotting the `.security` index.\r\n\r\n**Abstract**\r\nThe [snapshot](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-snapshots.html) request can specify [multi index expressions](https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-index.html). This expression is resolved irrespective of the user's privileges: there are no index privileges for snapshots, this is a cluster action.\r\nIn particular snapshotting for \"*\" will go and snapshot `.security` as well.\r\n\r\n**Segregated Repositories**\r\nThere are still variables to peg, but it is likely we will end up with segregated repositories some for \"ordinary\" indices and some for \"system\" indices (read `.security`) which will be encrypted. From a user perspective, with the good habit of snapshotting \"\\*\", he will probably be surprised when snapshotting does not work as expected. He will have to read the documentation ðŸ˜¨ . The documentation will describe how to set up a repository for the system indices, and more importantly how to craft the index expressions for the two snapshot calls (excluding \",-.security*\" for \"ordinary\" indices and including \".security*\" for \"system\" ones). There have to be two API calls since a request targets a single repository.\r\n\r\n**The Workflow**\r\nThere are many alternative stories of this process. I will set forth two of them.\r\n\r\n* When a user tries to snapshot `.security` to an un-encrypted repository the operation will fail from the onset. He recreates the index expression to not include `.security` and continues to use the snapshot API with the existing repository. He then sets up the encrypted repository. He crafts another snapshot request that only includes the `.security` and calls the same snapshot API but with the name of the encrypted repository he created previously. **This is my preference.**\r\n\r\n* When a user tries to snapshot `.security` to an un-encrypted repository the operation will snapshot \"normal\" indices but complain and return an error if the expression included the `.security` index . For the `.security` index there is a separate API (not snapshot, although it is a very light wrapper over it). This API does not require the `.security` index name as a parameter, but it does require the name of an encrypted repo.\r\n\r\nAs I said there quite some variants. I am not saying we should decide right now, since we don't have all the building blocks in place, but please keep this problem in the back of your head and voice your opinion.\r\n\r\n**I prefer the first alternative.** If you have other ideas I am curious to discuss them. We can spin an email thread if discussion becomes involved. **Otherwise, if I hear no howling, I will proceed with the mindset that the first alternative is sensible, and I will try to keep this feed updated as we unravel the mysteries.**\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441134733","html_url":"https://github.com/elastic/elasticsearch/issues/34454#issuecomment-441134733","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34454","id":441134733,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTEzNDczMw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-11-22T23:47:53Z","updated_at":"2018-11-22T23:47:53Z","author_association":"CONTRIBUTOR","body":"My personal view is that we shouldn't be requiring encrypted repos for backing up .security.\r\n_Encouraging_ and supporting, but not requiring.\r\n\r\nI think we try too hard to make security decisions for other people without knowing their particular environment and needs, and that just makes things hard for them.\r\n\r\nCan you backup .security to NFS, even though it's not encrypted?\r\nIf so, then why not S3 (which might be an on-prem S3-like)\r\nIf not, then why are we forcing people to push their .security backups out to the cloud rather than keeping them in their datacentre? (because our plan implies that only cloud repos will support encryption).\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441277673","html_url":"https://github.com/elastic/elasticsearch/issues/34454#issuecomment-441277673","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34454","id":441277673,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTI3NzY3Mw==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-11-23T16:11:30Z","updated_at":"2018-11-23T16:11:30Z","author_association":"CONTRIBUTOR","body":"I agree with @tvernum 's comment on the encryption requirement. If I remember the discussions in Dublin correctly, the reasoning behind marking the (client side) encryption of repositories as a prerequisite is that so that we support(and encourage it as Tim said) it, but not enforce it. I get where you're coming from and I agree with the notion of protecting the users but Tim nailed it with \r\n\r\n> I think we try too hard to make security decisions for other people without knowing their particular environment and needs, and that just makes things hard for them.\r\n\r\nPending the discussion on the `*` index expansion in requests we could make sure that the user (either a  superuser or a user with `Snapshot Only` role ) has explicit read privileges over system indices and that should get us as far as we need from the perspective of protecting the user. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/510571497","html_url":"https://github.com/elastic/elasticsearch/issues/34454#issuecomment-510571497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34454","id":510571497,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMDU3MTQ5Nw==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2019-07-11T17:06:10Z","updated_at":"2019-07-11T17:06:43Z","author_association":"CONTRIBUTOR","body":"@tvernum When the backport affair from https://github.com/elastic/elasticsearch/pull/42970#issuecomment-510571019/#issuecomment-510571019 is sorted out, I would consider the work here done.\r\n\r\nDo you have any objections on marking this done in the next release-status meeting?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/511705474","html_url":"https://github.com/elastic/elasticsearch/issues/34454#issuecomment-511705474","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34454","id":511705474,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMTcwNTQ3NA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-07-16T07:46:09Z","updated_at":"2019-07-16T07:46:09Z","author_association":"CONTRIBUTOR","body":"@albertzaharovits No objections from me.","performed_via_github_app":null}]