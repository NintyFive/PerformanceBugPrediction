[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/253836180","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-253836180","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":253836180,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzgzNjE4MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-10-14T15:34:46Z","updated_at":"2016-10-14T15:34:46Z","author_association":"MEMBER","body":"The `value_type` does not handle boolean. The parser is too lenient and accepts invalid values (values that are not recognized as valid types) without throwing an error. You can try with `value_type=foo` and you'll have the same output. It's too late for 5.0.0 but we can remove this leniency in 5.x. I'll not remove the blocker label since others may want to comment as well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254204454","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-254204454","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":254204454,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDIwNDQ1NA==","user":{"login":"stacey-gammon","id":16563603,"node_id":"MDQ6VXNlcjE2NTYzNjAz","avatar_url":"https://avatars3.githubusercontent.com/u/16563603?v=4","gravatar_id":"","url":"https://api.github.com/users/stacey-gammon","html_url":"https://github.com/stacey-gammon","followers_url":"https://api.github.com/users/stacey-gammon/followers","following_url":"https://api.github.com/users/stacey-gammon/following{/other_user}","gists_url":"https://api.github.com/users/stacey-gammon/gists{/gist_id}","starred_url":"https://api.github.com/users/stacey-gammon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stacey-gammon/subscriptions","organizations_url":"https://api.github.com/users/stacey-gammon/orgs","repos_url":"https://api.github.com/users/stacey-gammon/repos","events_url":"https://api.github.com/users/stacey-gammon/events{/privacy}","received_events_url":"https://api.github.com/users/stacey-gammon/received_events","type":"User","site_admin":false},"created_at":"2016-10-17T13:18:12Z","updated_at":"2016-10-17T13:18:12Z","author_association":"NONE","body":"I've discovered a couple additional issues with boolean fields.  It appears that using a painless script field of `doc['alive'].value == false` fails with \n\n```\n \"caused_by\": {\n            \"type\": \"class_cast_exception\",\n            \"reason\": \"Cannot cast from: boolean to boolean\",\n            \"caused_by\": {\n              \"type\": \"wrong_method_type_exception\",\n              \"reason\": \"cannot convert MethodHandle(long,long)boolean to (Object,boolean)boolean\"\n            }\n```\n\nAlong the same vein, using a script query like the following does not return any results (it has to be 0 or 1 to work as expected).\n\n```\n     \"script\" : {\n              \"inline\" : \"(doc['alive'].value) == params.value\",\n              \"lang\" : \"painless\",\n              \"params\" : {\n                \"value\" : false\n              }\n            },\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254208200","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-254208200","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":254208200,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDIwODIwMA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-10-17T13:32:32Z","updated_at":"2016-10-17T13:32:32Z","author_association":"MEMBER","body":"@Stacey-Gammon this is a known issue reported by ... you. The fix should come in 5.1.0 as stated here:\nhttps://github.com/elastic/elasticsearch/issues/20949\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254228779","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-254228779","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":254228779,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDIyODc3OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-10-17T14:46:42Z","updated_at":"2016-10-17T14:46:42Z","author_association":"CONTRIBUTOR","body":"@jimferenczi would be good to document `value_type` as well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254750459","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-254750459","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":254750459,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDc1MDQ1OQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T08:39:45Z","updated_at":"2016-10-19T08:39:45Z","author_association":"CONTRIBUTOR","body":"Let's check whether we can get rid of it first? If I read the code correctly, this information is not propagated to painless but only used by aggregations.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266980471","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-266980471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":266980471,"node_id":"MDEyOklzc3VlQ29tbWVudDI2Njk4MDQ3MQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-12-14T09:04:53Z","updated_at":"2016-12-14T09:04:53Z","author_association":"CONTRIBUTOR","body":"Addressed by #22135.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267372162","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-267372162","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":267372162,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzM3MjE2Mg==","user":{"login":"Bargs","id":6239176,"node_id":"MDQ6VXNlcjYyMzkxNzY=","avatar_url":"https://avatars3.githubusercontent.com/u/6239176?v=4","gravatar_id":"","url":"https://api.github.com/users/Bargs","html_url":"https://github.com/Bargs","followers_url":"https://api.github.com/users/Bargs/followers","following_url":"https://api.github.com/users/Bargs/following{/other_user}","gists_url":"https://api.github.com/users/Bargs/gists{/gist_id}","starred_url":"https://api.github.com/users/Bargs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bargs/subscriptions","organizations_url":"https://api.github.com/users/Bargs/orgs","repos_url":"https://api.github.com/users/Bargs/repos","events_url":"https://api.github.com/users/Bargs/events{/privacy}","received_events_url":"https://api.github.com/users/Bargs/received_events","type":"User","site_admin":false},"created_at":"2016-12-15T16:26:24Z","updated_at":"2016-12-15T16:26:24Z","author_association":"NONE","body":"@jpountz I saw this was closed so I did some testing to see if we could remove our workaround in Kibana and I found that the terms agg no longer accepts boolean scripts. If I use a simplified version of the query Stacey provided above, I get an error:\r\n\r\nRequest:\r\n```\r\n{  \r\n   \"aggs\":{  \r\n      \"1\":{  \r\n        \"terms\": {\r\n          \"script\": {\r\n            \"inline\" : \"return true;\",\r\n            \"lang\": \"painless\"\r\n          },\r\n          \"value_type\": \"boolean\"\r\n        }\r\n      }\r\n   }\r\n}\r\n```\r\n\r\nResponse\r\n```\r\n{\r\n  \"took\": 3,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 4,\r\n    \"failed\": 1,\r\n    \"failures\": [\r\n      {\r\n        \"shard\": 4,\r\n        \"index\": \"foo\",\r\n        \"node\": \"bAWZQ2m9SGutXsY_I_WLfg\",\r\n        \"reason\": {\r\n          \"type\": \"aggregation_execution_exception\",\r\n          \"reason\": \"Unsupported script value [true]\"\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"hits\": {\r\n    \"total\": 0,\r\n    \"max_score\": null,\r\n    \"hits\": []\r\n  },\r\n  \"aggregations\": {\r\n    \"1\": {\r\n      \"doc_count_error_upper_bound\": 0,\r\n      \"sum_other_doc_count\": 0,\r\n      \"buckets\": []\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nIs this an unintentional side effect of the PR that closed this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267380162","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-267380162","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":267380162,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzM4MDE2Mg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-12-15T16:55:19Z","updated_at":"2016-12-15T16:55:19Z","author_association":"CONTRIBUTOR","body":"Let me dig into that, the issue reported an issue with the fact that the `boolean` value type was not supported, so I closed it since it was addressed, but it looks like there is something else that prevents terms aggs on boolean scripts.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267388376","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-267388376","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":267388376,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzM4ODM3Ng==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-12-15T17:26:39Z","updated_at":"2016-12-15T17:26:39Z","author_association":"CONTRIBUTOR","body":"OK, this is because aggregations expect that scripts return numbers as a representation for boolean values, like boolean fields do, so for instance that query works:\r\n\r\n```\r\nGET index/_search\r\n{  \r\n   \"aggs\":{  \r\n      \"1\":{  \r\n        \"terms\": {\r\n          \"script\": {\r\n            \"inline\" : \"return 1;\",\r\n            \"lang\": \"painless\"\r\n          },\r\n          \"value_type\": \"boolean\"\r\n        }\r\n      }\r\n   }\r\n}\r\n```\r\n\r\nIt should be fixable though.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267403141","html_url":"https://github.com/elastic/elasticsearch/issues/20941#issuecomment-267403141","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20941","id":267403141,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzQwMzE0MQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-12-15T18:27:28Z","updated_at":"2016-12-15T18:27:28Z","author_association":"CONTRIBUTOR","body":"I opened a PR https://github.com/elastic/elasticsearch/pull/22201","performed_via_github_app":null}]