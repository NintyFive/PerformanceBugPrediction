{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/62273","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62273/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62273/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62273/events","html_url":"https://github.com/elastic/elasticsearch/issues/62273","id":699393774,"node_id":"MDU6SXNzdWU2OTkzOTM3NzQ=","number":62273,"title":"Please undo sparse vector deprecation","user":{"login":"wmelton","id":1544125,"node_id":"MDQ6VXNlcjE1NDQxMjU=","avatar_url":"https://avatars2.githubusercontent.com/u/1544125?v=4","gravatar_id":"","url":"https://api.github.com/users/wmelton","html_url":"https://github.com/wmelton","followers_url":"https://api.github.com/users/wmelton/followers","following_url":"https://api.github.com/users/wmelton/following{/other_user}","gists_url":"https://api.github.com/users/wmelton/gists{/gist_id}","starred_url":"https://api.github.com/users/wmelton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wmelton/subscriptions","organizations_url":"https://api.github.com/users/wmelton/orgs","repos_url":"https://api.github.com/users/wmelton/repos","events_url":"https://api.github.com/users/wmelton/events{/privacy}","received_events_url":"https://api.github.com/users/wmelton/received_events","type":"User","site_admin":false},"labels":[{"id":418189364,"node_id":"MDU6TGFiZWw0MTgxODkzNjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Ranking","name":":Search/Ranking","color":"0e8a16","default":false,"description":"Scoring, rescoring, rank evaluation."},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967498216,"node_id":"MDU6TGFiZWwxOTY3NDk4MjE2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Search","name":"Team:Search","color":"fef2c0","default":false,"description":"Meta label for search team"},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-09-11T14:35:03Z","updated_at":"2020-10-30T18:22:25Z","closed_at":"2020-10-30T18:22:25Z","author_association":"NONE","active_lock_reason":null,"body":"@mayya-sharipova - in this thread you mentioned there were no valid use cases in the community to justify keeping sparse vector fields alive. https://discuss.elastic.co/t/please-dont-deprecate-sparse-vector-fields/219063\r\n\r\nI wanted to humbly suggest that you reconsider this feature and use-case, which seems broadly applicable to a number of e-commerce settings, and valuable overall. \r\n\r\nConsider any problem that can be expressed as a matrix of user/product relationships, such as the output of ALS from a Spark job or a user-row from LightFM or really any matrix factorization job. Matrix Factorization(MF) is still a defacto standard in recommendation systems, which are large and growing by the day in terms of interest/application/implementation in companies by data science teams. \r\n\r\nThe reality of most recommendation systems, is that most of them ultimately compute a sparse vector at some point. (Typically dense at first, but converted to sparse to save space). \r\n\r\nThe value of supporting sparse vectors in ES is that it is widely understood that once MF jobs are done and vectors computed, the similarity of one product or user to any other product or user is largely computable by finding its cosine distance. \r\n\r\nThis means that by supporting sparse vectors, a user could dump the vectors from MF recommendation jobs in to an ES instance and be able to offer real-time recommendations without storing the typically k=>v rows for every user/product combination and querying potentially millions of rows of data, which are static and do not extend to real-time recommendations effectively. This presents enormous value to a user and significantly simplifies their code and db architecture. \r\n\r\nThe challenge in an environment where products or users are increasing daily, is that the size of the output vector also changes daily (or hourly, or by minute, etc.). This makes dense vectors that must have their size defined upfront untenable for such a task in ES. Sparse vectors, however, perfectly meet the bill. While sparse are limited to 1024 fields too, that is an order of magnitude more storage capacity when dealing with large and very sparse data like many matrices are in recommendation systems. \r\n\r\nFinally - since ES supports cosine distance natively now, this entire effort of recommending products to users literally becomes a simple query with simple data points underlying it.\r\n\r\nThis is distinctly different than the `rank_feature` field type in that we are comparing vectors pairwise by their values, not by their individual field values/importance. Rank feature also only supports positive values, where vectors used in recommendation can often by negative. We can L2 normalize of course, but not everyone will have the knowledge/skillset to know that.\r\n\r\nPlease consider reimplementing this feature to significantly reduce the complexity of building modern product recommendation systems (and a whole host of other pairwise vector comparison search problems). \r\n","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}