{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4362","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4362/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4362/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4362/events","html_url":"https://github.com/elastic/elasticsearch/issues/4362","id":23865509,"node_id":"MDU6SXNzdWUyMzg2NTUwOQ==","number":4362,"title":"Percolate API : highlight issue on field with custom analyzer","user":{"login":"pdesoyres","id":3831406,"node_id":"MDQ6VXNlcjM4MzE0MDY=","avatar_url":"https://avatars2.githubusercontent.com/u/3831406?v=4","gravatar_id":"","url":"https://api.github.com/users/pdesoyres","html_url":"https://github.com/pdesoyres","followers_url":"https://api.github.com/users/pdesoyres/followers","following_url":"https://api.github.com/users/pdesoyres/following{/other_user}","gists_url":"https://api.github.com/users/pdesoyres/gists{/gist_id}","starred_url":"https://api.github.com/users/pdesoyres/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdesoyres/subscriptions","organizations_url":"https://api.github.com/users/pdesoyres/orgs","repos_url":"https://api.github.com/users/pdesoyres/repos","events_url":"https://api.github.com/users/pdesoyres/events{/privacy}","received_events_url":"https://api.github.com/users/pdesoyres/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2013-12-06T15:44:30Z","updated_at":"2013-12-13T11:19:29Z","closed_at":"2013-12-13T11:19:29Z","author_association":"NONE","active_lock_reason":null,"body":"The highlight is empty when field has a custom analyzer. (Using version 1.0.0.Beta2)\n\nHere are the steps to reproduce the behaviour :\nFirst, create an index with a custom analyzer\n\n```\n curl -XPUT \"http://localhost:9200/\" -d'\n {\n    \"settings\": {\n        \"index.analysis.analyzer.latin.tokenizer\": \"whitespace\",\n        \"index.analysis.analyzer.latin.type\": \"custom\"\n    }\n }\n```\n\nThen create a mapping using this custom analyzer :\n\n```\n curl -XPUT \"http://localhost:9200/idx/message/_mapping\" -d'\n {\n   \"message\": {\n      \"properties\": {\n         \"message\": {\n            \"type\": \"string\",\n            \"store\": true,\n            \"analyzer\": \"latin\"\n         }\n      }\n   }\n}'\n```\n\nIndex a percolator query :\n\n```\n curl -XPUT \"http://localhost:9200/idx/.percolator/q1\" -d'\n {\n    \"query\" : {\n        \"term\" : {\n            \"message\" : \"bonsai\"\n        }\n    }\n }'\n```\n\nFinaly, use _percolate API with highlight on the field that uses a custom analyzer :\n\n```\n curl -XPOST \"http://localhost:9200/idx/message/_percolate\" -d'\n {\n   \"highlight\": {\n      \"fields\": {\n         \"message\": {}\n      }\n   },\n   \"size\": 10,\n   \"doc\": {\n      \"message\": \"A new bonsai tree in the office\"\n   }\n }'\n```\n\nIt gives the following which do not have any highlight :\n\n```\n{\n   \"took\": 19,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"total\": 1,\n   \"matches\": [\n      {\n         \"_index\": \"idx\",\n         \"_id\": \"q1\",\n         \"highlight\": {}\n      }\n   ]\n}\n```\n\nNote that when using _search API, highlight is done properly :\n\nIndex a doc :\n\n```\n curl -XPUT \"http://localhost:9200/idx/message/1\" -d'\n {\n     \"message\" : \"A new bonsai tree in the office\"\n }'\n```\n\nSearch with highlight on the field that uses a custom analyzer :\n\n```\n curl -XPOST \"http://localhost:9200/idx/message/_search\" -d'\n {\n    \"query\":{\n        \"term\": {\"message\": \"bonsai\"}\n    },\n    \"highlight\": {\n        \"fields\": {\n            \"message\":{}\n        }\n    }\n }'\n```\n\nGives the following result :\n\n```\n{\n   \"took\": 3,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 1,\n      \"max_score\": 0.375,\n      \"hits\": [\n         {\n            \"_index\": \"idx\",\n            \"_type\": \"message\",\n            \"_id\": \"1\",\n            \"_score\": 0.375,\n            \"_source\": {\n               \"message\": \"A new bonsai tree in the office\"\n            },\n            \"highlight\": {\n               \"message\": [\n                  \"A new <em>bonsai</em> tree in the office\"\n               ]\n            }\n         }\n      ]\n   }\n}\n```\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}