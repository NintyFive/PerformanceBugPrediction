[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/104240418","html_url":"https://github.com/elastic/elasticsearch/issues/10130#issuecomment-104240418","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10130","id":104240418,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNDI0MDQxOA==","user":{"login":"wkoot","id":3715211,"node_id":"MDQ6VXNlcjM3MTUyMTE=","avatar_url":"https://avatars0.githubusercontent.com/u/3715211?v=4","gravatar_id":"","url":"https://api.github.com/users/wkoot","html_url":"https://github.com/wkoot","followers_url":"https://api.github.com/users/wkoot/followers","following_url":"https://api.github.com/users/wkoot/following{/other_user}","gists_url":"https://api.github.com/users/wkoot/gists{/gist_id}","starred_url":"https://api.github.com/users/wkoot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wkoot/subscriptions","organizations_url":"https://api.github.com/users/wkoot/orgs","repos_url":"https://api.github.com/users/wkoot/repos","events_url":"https://api.github.com/users/wkoot/events{/privacy}","received_events_url":"https://api.github.com/users/wkoot/received_events","type":"User","site_admin":false},"created_at":"2015-05-21T11:48:16Z","updated_at":"2015-05-21T11:48:16Z","author_association":"NONE","body":"Ran into the same issue, would be nice if `time_zone` is indeed picked up.\nI'm currently using the following workaround in python, as per your example:\n\n```\nfrom datetime import datetime\ntimezone_offset = \"+%iH\" % round(float((datetime.now() - datetime.utcnow()).seconds) / 60 / 60)\n\nquery = {\n    \"aggs\": {\n        \"range\": {\n            \"date_range\": {\n                \"field\": \"date\",\n                \"format\": \"YYYY-MM-dd HH:mm:ss\",\n                \"ranges\": [\n                    { \"to\": \"now-1d/d\" + timezone_offset }, \n                    { \"from\": \"now-1d/d\" + timezone_offset } \n                ]\n            }\n        }\n    }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/116801153","html_url":"https://github.com/elastic/elasticsearch/issues/10130#issuecomment-116801153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10130","id":116801153,"node_id":"MDEyOklzc3VlQ29tbWVudDExNjgwMTE1Mw==","user":{"login":"mj1856","id":1396388,"node_id":"MDQ6VXNlcjEzOTYzODg=","avatar_url":"https://avatars1.githubusercontent.com/u/1396388?v=4","gravatar_id":"","url":"https://api.github.com/users/mj1856","html_url":"https://github.com/mj1856","followers_url":"https://api.github.com/users/mj1856/followers","following_url":"https://api.github.com/users/mj1856/following{/other_user}","gists_url":"https://api.github.com/users/mj1856/gists{/gist_id}","starred_url":"https://api.github.com/users/mj1856/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mj1856/subscriptions","organizations_url":"https://api.github.com/users/mj1856/orgs","repos_url":"https://api.github.com/users/mj1856/repos","events_url":"https://api.github.com/users/mj1856/events{/privacy}","received_events_url":"https://api.github.com/users/mj1856/received_events","type":"User","site_admin":false},"created_at":"2015-06-29T19:16:43Z","updated_at":"2015-06-29T19:16:43Z","author_association":"NONE","body":"Keep in mind that offsets can change within a single time zone, due to daylight saving time, and other various anomalies.  See \"Time Zone != Offset\" in [the timezone tag wiki on StackOverflow](http://stackoverflow.com/tags/timezone/info).\n\nFor an aggregation to be meaningful in a specific time zone, such as US Pacific Time, the time zone itself would have to be understood by ElasticSearch.  This would probably be best expressed as an IANA/Olson time zone identifier, such as `\"America/Los_Angeles\"`.   This would also mean that an ElasticSearch cluster would have to have a process for receiving regular updates to the IANA tzdb, which can happen about a dozen times per year or so.\n\n@wkoot - In your example, the `timezone_offset` field is calculated based on the _current_ difference between the local time zone and UTC.  There's no guarantee that that offset is the correct one for any of the dates covered by the to/from values of the query.\n","performed_via_github_app":null}]