{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25398","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25398/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25398/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25398/events","html_url":"https://github.com/elastic/elasticsearch/issues/25398","id":238554409,"node_id":"MDU6SXNzdWUyMzg1NTQ0MDk=","number":25398,"title":"Null pointer when using bulk inserts","user":{"login":"nfroidure","id":229633,"node_id":"MDQ6VXNlcjIyOTYzMw==","avatar_url":"https://avatars3.githubusercontent.com/u/229633?v=4","gravatar_id":"","url":"https://api.github.com/users/nfroidure","html_url":"https://github.com/nfroidure","followers_url":"https://api.github.com/users/nfroidure/followers","following_url":"https://api.github.com/users/nfroidure/following{/other_user}","gists_url":"https://api.github.com/users/nfroidure/gists{/gist_id}","starred_url":"https://api.github.com/users/nfroidure/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nfroidure/subscriptions","organizations_url":"https://api.github.com/users/nfroidure/orgs","repos_url":"https://api.github.com/users/nfroidure/repos","events_url":"https://api.github.com/users/nfroidure/events{/privacy}","received_events_url":"https://api.github.com/users/nfroidure/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-06-26T14:06:06Z","updated_at":"2018-02-13T19:39:07Z","closed_at":"2017-06-28T14:25:44Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n**Elasticsearch version**:\r\n5.4.2 using the Docker image:\r\n```\r\ndocker run -p 9200:9200 -e \"http.host=0.0.0.0\" -e \"transport.host=127.0.0.1\" docker.elastic.co/elasticsearch/elasticsearch:5.4.2\r\n```\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\nThe one used by the docker image\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nDocker on Ubuntu\r\n**Description of the problem including expected versus actual behavior**:\r\nHaving null pointer exception:\r\n```\r\njava.lang.NullPointerException: null\r\n\tat org.elasticsearch.action.bulk.BulkRequest.add(BulkRequest.java:318) ~[elasticsearch-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.rest.action.document.RestBulkAction.prepareRequest(RestBulkAction.java:89) ~[elasticsearch-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:64) ~[elasticsearch-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.rest.SecurityRestFilter.lambda$handleRequest$0(SecurityRestFilter.java:81) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:59) ~[elasticsearch-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$finishAuthentication$20(AuthenticationService.java:424) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.finishAuthentication(AuthenticationService.java:433) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.consumeUser(AuthenticationService.java:360) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:59) ~[elasticsearch-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.common.IteratingActionListener.onResponse(IteratingActionListener.java:114) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$null$8(AuthenticationService.java:272) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:59) ~[elasticsearch-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.support.CachingUsernamePasswordRealm.authenticateWithCache(CachingUsernamePasswordRealm.java:117) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.support.CachingUsernamePasswordRealm.authenticate(CachingUsernamePasswordRealm.java:92) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$consumeToken$10(AuthenticationService.java:264) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.common.IteratingActionListener.run(IteratingActionListener.java:93) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.consumeToken(AuthenticationService.java:288) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$extractToken$6(AuthenticationService.java:239) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.extractToken(AuthenticationService.java:247) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$0(AuthenticationService.java:194) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$2(AuthenticationService.java:212) ~[x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:224) [x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:190) [x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:147) [x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:100) [x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.xpack.security.rest.SecurityRestFilter.handleRequest(SecurityRestFilter.java:78) [x-pack-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:260) [elasticsearch-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:199) [elasticsearch-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.http.netty4.Netty4HttpServerTransport.dispatchRequest(Netty4HttpServerTransport.java:505) [transport-netty4-5.4.2.jar:5.4.2]\r\n\tat org.elasticsearch.http.netty4.Netty4HttpRequestHandler.channelRead0(Netty4HttpRequestHandler.java:72) [transport-netty4-5.4.2.jar:5.4.2]\r\n\tat io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat org.elasticsearch.http.netty4.pipelining.HttpPipeliningHandler.channelRead(HttpPipeliningHandler.java:63) [transport-netty4-5.4.2.jar:5.4.2]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:102) [netty-codec-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.handler.codec.MessageToMessageCodec.channelRead(MessageToMessageCodec.java:111) [netty-codec-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:102) [netty-codec-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:102) [netty-codec-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) [netty-codec-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284) [netty-codec-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.ChannelInboundHandlerAdapter.channelRead(ChannelInboundHandlerAdapter.java:86) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1334) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:926) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:134) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:644) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:544) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:498) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:458) [netty-transport-4.1.11.Final.jar:4.1.11.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) [netty-common-4.1.11.Final.jar:4.1.11.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n```\r\n**Steps to reproduce**:\r\nUse the NodeJS client to bulk add:\r\n```\r\n{\r\n  \"body\": [\r\n    {\r\n      \"update\": {\r\n        \"_index\": \"sencrop-measures\",\r\n        \"_type\": \"measures\",\r\n        \"_id\": \"028D-SAT-1421148266000\"\r\n      }\r\n    },\r\n    {\r\n      \"doc\": {\r\n        \"type\": \"SAT\",\r\n        \"value\": 6,\r\n        \"time\": 1421148266000,\r\n        \"timeFrame\": {\r\n          \"gt\": 1421148266000,\r\n          \"lte\": 1421148266000\r\n        },\r\n        \"verified\": false,\r\n        \"device\": \"028D\",\r\n        \"usersIds\": [],\r\n        \"organisationsIds\": [],\r\n        \"signal\": 1969,\r\n        \"udm\": 22,\r\n        \"id\": \"RADAR69\"\r\n      }\r\n    },\r\n    {\r\n      \"update\": {\r\n        \"_index\": \"sencrop-measures\",\r\n        \"_type\": \"measures\",\r\n        \"_id\": \"028D-PRECISION-1421148266000\"\r\n      }\r\n    },\r\n    {\r\n      \"doc\": {\r\n        \"type\": \"PRECISION\",\r\n        \"value\": 1,\r\n        \"time\": 1421148266000,\r\n        \"timeFrame\": {\r\n          \"gt\": 1421148266000,\r\n          \"lte\": 1421148266000\r\n        },\r\n        \"verified\": false,\r\n        \"device\": \"028D\",\r\n        \"usersIds\": [],\r\n        \"organisationsIds\": [],\r\n        \"signal\": 1969,\r\n        \"udm\": 22,\r\n        \"id\": \"RADAR69\"\r\n      }\r\n    },\r\n    {\r\n      \"update\": {\r\n        \"_index\": \"sencrop-measures\",\r\n        \"_type\": \"measures\",\r\n        \"_id\": \"028D-LNG-1421148266000\"\r\n      }\r\n    },\r\n    {\r\n      \"doc\": {\r\n        \"type\": \"LNG\",\r\n        \"value\": 3.0434833333333335,\r\n        \"time\": 1421148266000,\r\n        \"timeFrame\": {\r\n          \"gt\": 1421148266000,\r\n          \"lte\": 1421148266000\r\n        },\r\n        \"verified\": false,\r\n        \"device\": \"028D\",\r\n        \"usersIds\": [],\r\n        \"organisationsIds\": [],\r\n        \"signal\": 1969,\r\n        \"udm\": 22,\r\n        \"id\": \"RADAR69\"\r\n      }\r\n    },\r\n    {\r\n      \"update\": {\r\n        \"_index\": \"sencrop-measures\",\r\n        \"_type\": \"measures\",\r\n        \"_id\": \"028D-LAT-1421148266000\"\r\n      }\r\n    },\r\n    {\r\n      \"doc\": {\r\n        \"type\": \"LAT\",\r\n        \"value\": 50.65155,\r\n        \"time\": 1421148266000,\r\n        \"timeFrame\": {\r\n          \"gt\": 1421148266000,\r\n          \"lte\": 1421148266000\r\n        },\r\n        \"verified\": false,\r\n        \"device\": \"028D\",\r\n        \"usersIds\": [],\r\n        \"organisationsIds\": [],\r\n        \"signal\": 1969,\r\n        \"udm\": 22,\r\n        \"id\": \"RADAR69\"\r\n      }\r\n    },\r\n    {\r\n      \"update\": {\r\n        \"_index\": \"sencrop-measures\",\r\n        \"_type\": \"measures\",\r\n        \"_id\": \"028D-ALT-1421148266000\"\r\n      }\r\n    },\r\n    {\r\n      \"doc\": {\r\n        \"type\": \"ALT\",\r\n        \"value\": 67,\r\n        \"time\": 1421148266000,\r\n        \"timeFrame\": {\r\n          \"gt\": 1421148266000,\r\n          \"lte\": 1421148266000\r\n        },\r\n        \"verified\": false,\r\n        \"device\": \"028D\",\r\n        \"usersIds\": [],\r\n        \"organisationsIds\": [],\r\n        \"signal\": 1969,\r\n        \"udm\": 22,\r\n        \"id\": \"RADAR69\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\nTo the following mappings:\r\n```\r\n{\r\n  \"_all\": {\r\n    \"enabled\": false\r\n  },\r\n  \"properties\": {\r\n    \"type\": {\r\n      \"type\": \"keyword\"\r\n    },\r\n    \"device\": {\r\n      \"type\": \"keyword\"\r\n    },\r\n    \"name\": {\r\n      \"type\": \"text\"\r\n    },\r\n    \"usersIds\": {\r\n      \"type\": \"integer\"\r\n    },\r\n    \"organisationsIds\": {\r\n      \"type\": \"integer\"\r\n    },\r\n    \"value\": {\r\n      \"type\": \"integer\"\r\n    },\r\n    \"signal\": {\r\n      \"type\": \"integer\"\r\n    },\r\n    \"udm\": {\r\n      \"type\": \"integer\"\r\n    },\r\n    \"location\": {\r\n      \"type\": \"geo_point\"\r\n    },\r\n    \"time\": {\r\n      \"type\": \"date\",\r\n      \"format\": \"epoch_millis\"\r\n    },\r\n    \"timeFrame\": {\r\n      \"type\": \"date_range\",\r\n      \"format\": \"epoch_millis\"\r\n    }\r\n  }\r\n}\r\n\r\n```\r\n\r\nI still use it locally for now so i can provide you the credentials I use since the stack trace seems related to the basic authentication.:\r\n```\r\n\r\nconst elasticsearch = require('elasticsearch');\r\nconst c = new elasticsearch.Client({\r\n    protocol: 'http',\r\n    host: '127.0.0.1:9200',\r\n    httpAuth: 'elastic:changeme',\r\n    apiVersion: '5.4',\r\n  });\r\n```\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"nfroidure","id":229633,"node_id":"MDQ6VXNlcjIyOTYzMw==","avatar_url":"https://avatars3.githubusercontent.com/u/229633?v=4","gravatar_id":"","url":"https://api.github.com/users/nfroidure","html_url":"https://github.com/nfroidure","followers_url":"https://api.github.com/users/nfroidure/followers","following_url":"https://api.github.com/users/nfroidure/following{/other_user}","gists_url":"https://api.github.com/users/nfroidure/gists{/gist_id}","starred_url":"https://api.github.com/users/nfroidure/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nfroidure/subscriptions","organizations_url":"https://api.github.com/users/nfroidure/orgs","repos_url":"https://api.github.com/users/nfroidure/repos","events_url":"https://api.github.com/users/nfroidure/events{/privacy}","received_events_url":"https://api.github.com/users/nfroidure/received_events","type":"User","site_admin":false},"performed_via_github_app":null}