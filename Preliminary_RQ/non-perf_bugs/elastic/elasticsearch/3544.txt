{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3544","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3544/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3544/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3544/events","html_url":"https://github.com/elastic/elasticsearch/issues/3544","id":18315117,"node_id":"MDU6SXNzdWUxODMxNTExNw==","number":3544,"title":"Wrong analyzer used when indexing dynamic property","user":{"login":"pmclellan","id":5272400,"node_id":"MDQ6VXNlcjUyNzI0MDA=","avatar_url":"https://avatars3.githubusercontent.com/u/5272400?v=4","gravatar_id":"","url":"https://api.github.com/users/pmclellan","html_url":"https://github.com/pmclellan","followers_url":"https://api.github.com/users/pmclellan/followers","following_url":"https://api.github.com/users/pmclellan/following{/other_user}","gists_url":"https://api.github.com/users/pmclellan/gists{/gist_id}","starred_url":"https://api.github.com/users/pmclellan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pmclellan/subscriptions","organizations_url":"https://api.github.com/users/pmclellan/orgs","repos_url":"https://api.github.com/users/pmclellan/repos","events_url":"https://api.github.com/users/pmclellan/events{/privacy}","received_events_url":"https://api.github.com/users/pmclellan/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":51048736,"node_id":"MDU6TGFiZWw1MTA0ODczNg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.4","name":"v0.90.4","color":"DDDDDD","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"assignees":[{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false}],"milestone":null,"comments":16,"created_at":"2013-08-20T19:12:30Z","updated_at":"2015-02-06T15:20:28Z","closed_at":"2013-09-11T14:09:14Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nI'm seeing some unusual behaviour when indexing documents in Elasticsearch with a dynamic template. I have a unit test that's failing intermittently. The flow of the test is as follows:\n\n```\n1) Initialise in-memory Elasticsearch cluster (one local node, no replicas)\n2) Create new index\n3) Create new type mapping\n4) Index some documents\n5) Refresh index and wait for all documents to be processed\n6) Query Elasticsearch for documents\n```\n\nThe type mapping I'm using includes the following dynamic template definition:\n\n```\n{\n    \"participants\": {\n        \"path_match\": \"participants.*\",\n        \"mapping\": {\n            \"type\": \"string\",\n            \"store\": \"yes\",\n            \"index\": \"analyzed\",\n            \"analyzer\": \"whitespace\"\n        }\n    }\n}\n```\n\nThis template is intended to produce fields of the form:\n\n```\nparticipants.new = [ 'user-1', 'user-2' ]\nparticipants.removed = [ 'user-3' ]\n```\n\nThe problem I have is that occasionally (perhaps once in every ten runs) the test will fail because step 6 does not return all the expected documents. When I check the indexed terms for the missing documents I see that values in the 'participants' field have been split into separate tokens on the '-' character. This seems to suggest that the default analyzer is being used for indexing instead of the whitespace one.\n\nSo far I haven't been able to detect any pattern to the failures. The unexpected tokenisation only affects a portion of the indexed documents and can occur at any point in the indexing process (i.e. it isn't always the first or last document that has problems).\n\nHere is a gist with a simplified version of my original test: https://gist.github.com/pmclellan/64b192537c97529ec2e4 This version fails much more consistently, usually on the first run. However, I have noticed that the problem does not occur if I index documents in a synchronous manner (i.e. waiting for a response to each indexing request before issuing the next).\n\nCheers,\nPaul\n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}