{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/61969","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61969/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61969/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61969/events","html_url":"https://github.com/elastic/elasticsearch/issues/61969","id":692909641,"node_id":"MDU6SXNzdWU2OTI5MDk2NDE=","number":61969,"title":"Unable to override index setting soft_delete when restoring snapshot","user":{"login":"NickFane","id":6821345,"node_id":"MDQ6VXNlcjY4MjEzNDU=","avatar_url":"https://avatars3.githubusercontent.com/u/6821345?v=4","gravatar_id":"","url":"https://api.github.com/users/NickFane","html_url":"https://github.com/NickFane","followers_url":"https://api.github.com/users/NickFane/followers","following_url":"https://api.github.com/users/NickFane/following{/other_user}","gists_url":"https://api.github.com/users/NickFane/gists{/gist_id}","starred_url":"https://api.github.com/users/NickFane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NickFane/subscriptions","organizations_url":"https://api.github.com/users/NickFane/orgs","repos_url":"https://api.github.com/users/NickFane/repos","events_url":"https://api.github.com/users/NickFane/events{/privacy}","received_events_url":"https://api.github.com/users/NickFane/received_events","type":"User","site_admin":false},"labels":[{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"assignees":[{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-09-04T08:44:55Z","updated_at":"2020-09-07T18:06:42Z","closed_at":"2020-09-07T18:06:42Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n**Background**\r\nMy team is working on implementing CCR to replicate data to another cluster of ours. The index we want to replicate is around 110gb, and was created about a week back on version 7.9. We are unable to replicate the index due to missing operations, but upon later investigation, we found that soft_delete had defaulted to false (which we are unsure if it is due to a bug, or bad config on our end). \r\n\r\nWe contacted Elastic support, and they mentioned to try restoring a snapshot, but overriding the index settings to set soft_delete to \"true\". The assumption here is that with soft_deletes now set to true, the index will retain the operations used to restore the snapshot. If this is the case, we can replicate the newly restored snapshot (which now contains all the required operations).\r\n\r\nWhen we tried this, we found that we couldn't override this setting with snapshots. \r\n<img width=\"1347\" alt=\"Screen Shot 2020-09-04 at 2 08 39 pm\" src=\"https://user-images.githubusercontent.com/6821345/92220226-06f41a80-eedf-11ea-92ca-f1e6aaacdfce.png\">\r\n\r\n**Request**\r\nThe feature request is for soft_deletes to be able to be overridden during the restoration of a snapshot. In order to be able to use features such as CCR that rely on these internal operations, on large indices which no longer contain them (or perhaps never did).\r\n\r\nAlso for extra info, we've also tried simply reindexing the data, however, we've found that with some recommended settings (such as  [slices == shardCount]), that it takes hours to finish the task. The added load this has on our cluster, causes us to not be able to run this in a production environment.","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}