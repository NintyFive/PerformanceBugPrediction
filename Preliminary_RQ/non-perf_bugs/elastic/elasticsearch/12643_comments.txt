[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/127677828","html_url":"https://github.com/elastic/elasticsearch/issues/12643#issuecomment-127677828","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12643","id":127677828,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzY3NzgyOA==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-08-04T17:08:41Z","updated_at":"2015-08-04T17:08:41Z","author_association":"CONTRIBUTOR","body":"We need tests that test this stuff... that needs to block any bugfix here.\n\nI know if someone can fix it, they will feel pressure to push fix without tests. But we cannot develop software this way anymore!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/127683885","html_url":"https://github.com/elastic/elasticsearch/issues/12643#issuecomment-127683885","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12643","id":127683885,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzY4Mzg4NQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-08-04T17:24:19Z","updated_at":"2015-08-04T17:24:19Z","author_association":"MEMBER","body":"So I tried to run `Ec2DiscoveryITest` from my IDE using options:\n\n```\n-Dtests.thirdparty=true -Dtests.config=/Users/dpilato/Documents/Elasticsearch/work/aws/elasticsearch.yml -Des.logger.level=DEBUG\n```\n\nAnd it went well. My config is:\n\n```\ncloud:\n  aws:\n    access_key: \"KEY\"\n    secret_key: \"SECRET\"\n\ndiscovery.type: ec2\n```\n\nSame when running from command line with `mvn test`, I don't get this error. \n\nSo I get only this when deploying the plugin in elasticsearch and trying to load AWS module.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/127693284","html_url":"https://github.com/elastic/elasticsearch/issues/12643#issuecomment-127693284","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12643","id":127693284,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzY5MzI4NA==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-08-04T18:00:42Z","updated_at":"2015-08-04T18:00:42Z","author_association":"CONTRIBUTOR","body":"ok, I think one thing we can do is cutover the thirdparty tests to run in the integration test phase so they run realistically? they are definitely integration tests. then they can be run in jenkins and we have more coverage for the discovery plugins: currently their integration tests only check that they were installed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/127713578","html_url":"https://github.com/elastic/elasticsearch/issues/12643#issuecomment-127713578","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12643","id":127713578,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzcxMzU3OA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-08-04T18:51:39Z","updated_at":"2015-08-04T18:51:39Z","author_association":"MEMBER","body":"So the problem is coming from the changes in ClassLoading.\n\nThe Discovery Module is started within a Node using the Node settings (and the Node classloader aka elasticsearch core classloader).\nWhen the plugin is loaded, it's now loaded within a child classloader.\n\nDiscovery then tries to call something like `Classes.loadClass(settings.getClassLoader(), ...);`.\n\nsettings.getClassLoader() is actually elasticsearch core Classloader, not the plugin one.\n\nSo we need somehow to tell the discovery module that he should use the plugin Classloader if any.\n\nI'm not sure yet how to do that.\n\nI pushed some changes for now in my branch https://github.com/dadoonet/elasticsearch/tree/plugins/discovery but it does not fix the issue. It only falls back to the default discovery instead of failling elasticsearch to start.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/127723648","html_url":"https://github.com/elastic/elasticsearch/issues/12643#issuecomment-127723648","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12643","id":127723648,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzcyMzY0OA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-08-04T19:08:49Z","updated_at":"2015-08-04T19:08:49Z","author_association":"MEMBER","body":"To reproduce the issue:\n\nBuild aws or azure plugin:\n\n```\ncd plugins/cloud-aws\nmvn clean install -DskipTests\n```\n\nBuild core:\n\n```\ncd core\nmvn clean install -DskipTests\n```\n\nBuild a distribution: \n\n```\ncd distribution/tar\nmvn clean install -DskipTests\ncd target/releases\ntar xzf elasticsearch-2.0.0-SNAPSHOT.tar.gz\ncd elasticsearch-2.0.0-SNAPSHOT\nbin/plugin install cloud-aws --url file:../../../../../plugins/cloud-aws/target/releases/elasticsearch-cloud-aws-2.0.0-SNAPSHOT.zip\n```\n\nChange `config/elasticsearch.yml` to:\n\n``` yml\ndiscovery.type: ec2\n```\n\nThen start elasticsearch.\n\nIf you want to iterate other the code, just in core run `mvn package` and then copy the elasticsearch jar file from target to `distribution/tar/target/releases/elasticsearch-2.0.0-SNAPSHOT/lib`.\n","performed_via_github_app":null}]