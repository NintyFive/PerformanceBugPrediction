{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7919","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7919/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7919/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7919/events","html_url":"https://github.com/elastic/elasticsearch/issues/7919","id":44347104,"node_id":"MDU6SXNzdWU0NDM0NzEwNA==","number":7919,"title":"Percolator can pick up incorrect field mapper when using _all field in queries","user":{"login":"bly2k","id":3187614,"node_id":"MDQ6VXNlcjMxODc2MTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/3187614?v=4","gravatar_id":"","url":"https://api.github.com/users/bly2k","html_url":"https://github.com/bly2k","followers_url":"https://api.github.com/users/bly2k/followers","following_url":"https://api.github.com/users/bly2k/following{/other_user}","gists_url":"https://api.github.com/users/bly2k/gists{/gist_id}","starred_url":"https://api.github.com/users/bly2k/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bly2k/subscriptions","organizations_url":"https://api.github.com/users/bly2k/orgs","repos_url":"https://api.github.com/users/bly2k/repos","events_url":"https://api.github.com/users/bly2k/events{/privacy}","received_events_url":"https://api.github.com/users/bly2k/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-09-29T19:50:39Z","updated_at":"2014-09-29T20:19:15Z","closed_at":"2014-09-29T20:19:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"If an index contains more than 1 type and contains percolator queries that match the _all field, it is possible/likely to run into a situation where the field mapper used to parse the _all field can be incorrect, thus leading to incorrect/unexpected results.\n\nSteps to reproduce:\n\n```\ncurl -XDELETE localhost:9200/b\n\ncurl -XPUT localhost:9200/b -d '\n{\n  \"settings\": {\n    \"index\": {\n      \"number_of_shards\": 1,\n      \"number_of_replicas\": 0\n    }\n  },\n  \"mappings\": {\n    \"doc\": {\n      \"_all\": {\n        \"analyzer\": \"snowball\"\n      }\n    },\n    \".percolator\": {\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}'\n\ncurl -XPOST localhost:9200/b/.percolator/1?pretty -d '{\n  \"name\": \"test1\",\n  \"query\": {\n    \"match\": {\n      \"_all\": \"running\"\n    }\n  }\n}'\n\ncurl -XPOST localhost:9200/_refresh?pretty\n\n#expected to match the above percolator query, but doesn't. reason is because the above percolator query picks up an incorrect mapper for the _all field\ncurl -XPOST localhost:9200/b/doc/_percolate?pretty -d '{\n  \"doc\": {\n    \"title\": \"running\"\n  }\n}'\n```\n","closed_by":{"login":"bly2k","id":3187614,"node_id":"MDQ6VXNlcjMxODc2MTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/3187614?v=4","gravatar_id":"","url":"https://api.github.com/users/bly2k","html_url":"https://github.com/bly2k","followers_url":"https://api.github.com/users/bly2k/followers","following_url":"https://api.github.com/users/bly2k/following{/other_user}","gists_url":"https://api.github.com/users/bly2k/gists{/gist_id}","starred_url":"https://api.github.com/users/bly2k/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bly2k/subscriptions","organizations_url":"https://api.github.com/users/bly2k/orgs","repos_url":"https://api.github.com/users/bly2k/repos","events_url":"https://api.github.com/users/bly2k/events{/privacy}","received_events_url":"https://api.github.com/users/bly2k/received_events","type":"User","site_admin":false},"performed_via_github_app":null}