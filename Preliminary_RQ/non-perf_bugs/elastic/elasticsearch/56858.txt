{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/56858","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56858/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56858/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56858/events","html_url":"https://github.com/elastic/elasticsearch/issues/56858","id":619460417,"node_id":"MDU6SXNzdWU2MTk0NjA0MTc=","number":56858,"title":"SnapshotStatusApisIT#testStatusAPICallInProgressSnapshot fails rarely and unreproducibly","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-05-16T12:19:40Z","updated_at":"2020-05-16T17:30:06Z","closed_at":"2020-05-16T17:30:06Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\r\nPlease fill out the following information, and ensure you have attempted\r\nto reproduce locally\r\n-->\r\n\r\n**Build scan**:\r\nhttps://gradle-enterprise.elastic.co/s/fmktjmk7gno6u/tests/failed\r\n\r\n**Repro line**:\r\n```\r\n./gradlew ':server:internalClusterTest' --tests \"org.elasticsearch.snapshots.SnapshotStatusApisIT.testStatusAPICallInProgressSnapshot\" -Dtests.seed=EB69A25B062FF8B3 -Dtests.security.manager=true -Dtests.locale=ar-KW -Dtests.timezone=Antarctica/DumontDUrville -Dcompiler.java=14 -Druntime.java=11\r\n```\r\n**Reproduces locally?**:\r\nNope.\r\n\r\n**Applicable branches**:\r\nmaster + others?\r\n\r\n**Failure history**:\r\nRarely. Twice in the past month according to gradle enterprise.\r\n\r\n**Failure excerpt**:\r\n```\r\n[2020-05-16T06:45:35,417][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] before test\r\n[2020-05-16T06:45:35,417][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] [SnapshotStatusApisIT#testStatusAPICallInProgressSnapshot]: setting up test\r\n[2020-05-16T06:45:35,530][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_sm2] adding template [random_index_template] for index patterns [*]\r\n[2020-05-16T06:45:35,644][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] [SnapshotStatusApisIT#testStatusAPICallInProgressSnapshot]: all set up test\r\n[2020-05-16T06:45:35,644][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] -->  creating repository\r\n[2020-05-16T06:45:35,648][INFO ][o.e.s.m.MockRepository   ] [node_sm2] starting mock repository with random prefix default\r\n[2020-05-16T06:45:35,663][INFO ][o.e.r.RepositoriesService] [node_sm2] put repository [test-repo]\r\n[2020-05-16T06:45:35,769][INFO ][o.e.s.m.MockRepository   ] [node_sm1] starting mock repository with random prefix default\r\n[2020-05-16T06:45:35,769][INFO ][o.e.s.m.MockRepository   ] [node_sd3] starting mock repository with random prefix default\r\n[2020-05-16T06:45:35,770][INFO ][o.e.s.m.MockRepository   ] [node_sd4] starting mock repository with random prefix default\r\n[2020-05-16T06:45:35,776][INFO ][o.e.s.m.MockRepository   ] [node_sm0] starting mock repository with random prefix default\r\n[2020-05-16T06:45:35,782][INFO ][o.e.s.m.MockRepository   ] [node_sm2] starting mock repository with random prefix default\r\n[2020-05-16T06:45:35,817][INFO ][o.e.c.m.MetadataCreateIndexService] [node_sm2] applying create index request using v1 templates [random_index_template]\r\n[2020-05-16T06:45:35,833][INFO ][o.e.c.m.MetadataCreateIndexService] [node_sm2] [test-idx-1] creating index, cause [api], templates [random_index_template], shards [2]/[0], mappings []\r\n[2020-05-16T06:45:36,514][INFO ][o.e.c.r.a.AllocationService] [node_sm2] current.health=\"GREEN\" message=\"Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[test-idx-1][0]]]).\" previous.health=\"YELLOW\" reason=\"shards started [[test-idx-1][0]]\"\r\n[2020-05-16T06:45:36,590][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] --> indexing some data\r\n[2020-05-16T06:45:36,658][INFO ][o.e.c.m.MetadataMappingService] [node_sm2] [test-idx-1/JKbL04oBTuebBVtZfyOceA] create_mapping\r\n[2020-05-16T06:45:37,845][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] --> snapshot\r\n[2020-05-16T06:45:37,846][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] --> wait for data nodes to get blocked\r\n[2020-05-16T06:45:37,914][INFO ][o.e.s.m.MockRepository   ] [node_sd4] [test-repo] blocking I/O operation for file [__ZpgQ-rhURgKAqbpB_27SPw] at path [[indices][P5511aZVQVaTYEjukm2Pyg][1]]\r\n[2020-05-16T06:45:37,917][INFO ][o.e.s.m.MockRepository   ] [node_sd4] [test-repo] blocking I/O operation for file [__MTHdKiUVQkSCn3oIxGr71A] at path [[indices][P5511aZVQVaTYEjukm2Pyg][1]]\r\n[2020-05-16T06:45:37,926][INFO ][o.e.s.SnapshotsService   ] [node_sm2] snapshot [test-repo:test-snap/f3Ve89VqSL-NJgkjURJC1Q] started\r\n[2020-05-16T06:45:37,996][INFO ][o.e.s.m.MockRepository   ] [node_sd3] [test-repo] blocking I/O operation for file [__DxscFcT8QhaT7oPl_FDRGw] at path [[indices][P5511aZVQVaTYEjukm2Pyg][0]]\r\n[2020-05-16T06:45:38,010][INFO ][o.e.a.a.c.r.c.TransportCleanupRepositoryAction] [node_sm2] Running cleanup operations on repository [test-repo][-1]\r\n[2020-05-16T06:45:38,013][INFO ][o.e.s.m.MockRepository   ] [node_sd3] [test-repo] blocking I/O operation for file [__AAMrtr36QV61D7HOTthQQw] at path [[indices][P5511aZVQVaTYEjukm2Pyg][0]]\r\n[2020-05-16T06:45:38,026][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] [SnapshotStatusApisIT#testStatusAPICallInProgressSnapshot]: cleaning up after test\r\n[2020-05-16T06:46:43,666][INFO ][o.e.s.SnapshotStatusApisIT] [testStatusAPICallInProgressSnapshot] after test\r\nREPRODUCE WITH: ./gradlew ':server:internalClusterTest' --tests \"org.elasticsearch.snapshots.SnapshotStatusApisIT.testStatusAPICallInProgressSnapshot\" -Dtests.seed=EB69A25B062FF8B3 -Dtests.security.manager=true -Dtests.locale=ar-KW -Dtests.timezone=Antarctica/DumontDUrville -Dcompiler.java=14 -Druntime.java=11\r\nREPRODUCE WITH: ./gradlew ':server:internalClusterTest' --tests \"org.elasticsearch.snapshots.SnapshotStatusApisIT.testStatusAPICallInProgressSnapshot\" -Dtests.seed=EB69A25B062FF8B3 -Dtests.security.manager=true -Dtests.locale=ar-KW -Dtests.timezone=Antarctica/DumontDUrville -Dcompiler.java=14 -Druntime.java=11\r\nREPRODUCE WITH: ./gradlew ':server:internalClusterTest' --tests \"org.elasticsearch.snapshots.SnapshotStatusApisIT.testStatusAPICallInProgressSnapshot\" -Dtests.seed=EB69A25B062FF8B3 -Dtests.security.manager=true -Dtests.locale=ar-KW -Dtests.timezone=Antarctica/DumontDUrville -Dcompiler.java=14 -Druntime.java=11\r\n```\r\n\r\nIs one of them.\r\n\r\n","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}