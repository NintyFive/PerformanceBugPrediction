[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/26199727","html_url":"https://github.com/elastic/elasticsearch/issues/3900#issuecomment-26199727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3900","id":26199727,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MTk5NzI3","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-10-12T15:41:25Z","updated_at":"2013-10-12T15:41:25Z","author_association":"MEMBER","body":"The `join` option on the nested filter allows the block join to be enabled or disabled. If disabled just the inner query or filter is executed and the hits are never linked back to the parent/root document. By default the nested filter performs the join and as far as I know it should only be set to false when a nested filter is used as a facet filter in a facet with nested enabled. The non join mode isn't heavily tested, but it used in SimpleNestedTests line 459.  \n\nWhat do you think is the bug?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/26223718","html_url":"https://github.com/elastic/elasticsearch/issues/3900#issuecomment-26223718","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3900","id":26223718,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjIzNzE4","user":{"login":"brusic","id":354105,"node_id":"MDQ6VXNlcjM1NDEwNQ==","avatar_url":"https://avatars1.githubusercontent.com/u/354105?v=4","gravatar_id":"","url":"https://api.github.com/users/brusic","html_url":"https://github.com/brusic","followers_url":"https://api.github.com/users/brusic/followers","following_url":"https://api.github.com/users/brusic/following{/other_user}","gists_url":"https://api.github.com/users/brusic/gists{/gist_id}","starred_url":"https://api.github.com/users/brusic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brusic/subscriptions","organizations_url":"https://api.github.com/users/brusic/orgs","repos_url":"https://api.github.com/users/brusic/repos","events_url":"https://api.github.com/users/brusic/events{/privacy}","received_events_url":"https://api.github.com/users/brusic/received_events","type":"User","site_admin":false},"created_at":"2013-10-13T18:35:11Z","updated_at":"2013-10-13T18:35:59Z","author_association":"CONTRIBUTOR","body":"Thanks Martijn. Your response helped explain my confusion. I have only used the nested filter as a facet filter, so the join option was both unnecessary and verbose (compared to the more concise direct filter). The default (enabled) join option only works when the filter is used as a query filter, not a facet filter. In fact, when used as a facet filter, the default option returns no values, which was my issue.\n\nSince my issue is technically is not a bug, I will go ahead and close the issue. However, perhaps some guidance would be appreciated.  What am trying to achieve is a distinct count of parents whose nested documents pass some filter. My hope was that returning just the parent documents with the join enabled, would lead to correct counts.\n","performed_via_github_app":null}]