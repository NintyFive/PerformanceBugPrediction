[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66619278","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-66619278","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":66619278,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NjE5Mjc4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-11T13:36:03Z","updated_at":"2014-12-11T13:36:03Z","author_association":"CONTRIBUTOR","body":"Hi @justnick21 \n\nCould you provide a small recreation of exactly what you are doing?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66621508","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-66621508","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":66621508,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NjIxNTA4","user":{"login":"justnick21","id":4408460,"node_id":"MDQ6VXNlcjQ0MDg0NjA=","avatar_url":"https://avatars0.githubusercontent.com/u/4408460?v=4","gravatar_id":"","url":"https://api.github.com/users/justnick21","html_url":"https://github.com/justnick21","followers_url":"https://api.github.com/users/justnick21/followers","following_url":"https://api.github.com/users/justnick21/following{/other_user}","gists_url":"https://api.github.com/users/justnick21/gists{/gist_id}","starred_url":"https://api.github.com/users/justnick21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justnick21/subscriptions","organizations_url":"https://api.github.com/users/justnick21/orgs","repos_url":"https://api.github.com/users/justnick21/repos","events_url":"https://api.github.com/users/justnick21/events{/privacy}","received_events_url":"https://api.github.com/users/justnick21/received_events","type":"User","site_admin":false},"created_at":"2014-12-11T13:55:11Z","updated_at":"2014-12-11T13:55:11Z","author_association":"NONE","body":"Sure, the mapping looks something like the following:\n\n```\n'properties': {\n  'latlongs': {'type': 'geo_point', 'index_name': 'latlong'},\n  'count': {'type': 'integer'}\n}\n```\n\nwhich contains records such as:\n\n```\n{\n  \"_index\": \"incidents\",\n  \"_type\": \"incident_type\",\n  \"_id\": \"112422\",\n  \"_version\": 1,\n  \"_score\": 1,\n  \"_source\": {\n    \"latlongs\": [\n      [\n        -70.65869808197021,\n        -33.4377803261738\n      ]\n    ],\n    \"count\": 6\n  }\n},\n{\n  \"_index\": \"incidents\",\n  \"_type\": \"incident_type\",\n  \"_id\": \"112423\",\n  \"_version\": 1,\n  \"_score\": 1,\n  \"_source\": {\n    \"latlongs\": [\n      [\n        -70.65869808197021,\n        -33.4377803261738\n      ],\n      [\n        -70.65869808197021,\n        -33.4377803261738\n      ]\n    ],\n    \"count\": 3\n  }\n}\n```\n\nsome records have multiple latlongs associated with them. when I run the query below it throws an ArrayIndexOutOfBoundsException\n\n```\n{\n  \"aggs\": {\n    \"latlongs_grid\": {\n      \"geohash_grid\": {\n        \"field\": \"latlongs\",\n        \"precision\": 5\n      },\n      \"aggs\": {\n        \"count__sum\": {\n          \"sum\": {\n            \"field\": \"count\"\n          }\n        },\n\n      }\n    }\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66665886","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-66665886","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":66665886,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NjY1ODg2","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2014-12-11T18:36:57Z","updated_at":"2014-12-11T18:36:57Z","author_association":"CONTRIBUTOR","body":"geo_point mapping only handles single points.  multipoint is a complex spatial type, so the mapping type should be geo_shape.\n\nI'm going to keep this open since it warrants a discussion for whether or not we should throw an IllegalArgumentException on insert when an array of lat/lons are provided.\n\nFor further information refer to the following:\n\nhttp://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-geo-point-type.html\nhttp://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-geo-shape-type.html \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66667140","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-66667140","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":66667140,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NjY3MTQw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-11T18:45:35Z","updated_at":"2014-12-11T18:45:35Z","author_association":"CONTRIBUTOR","body":"@nknize actually geo_points can handle multiple points (in most places, at least)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66669310","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-66669310","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":66669310,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NjY5MzEw","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2014-12-11T19:00:11Z","updated_at":"2014-12-11T19:00:11Z","author_association":"CONTRIBUTOR","body":"Thanks @clintongormley   I'll take a look to make sure aggregation is set up to handle multipoint for geo_point mapping. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67330945","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-67330945","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":67330945,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzMwOTQ1","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2014-12-17T14:40:48Z","updated_at":"2014-12-17T14:40:48Z","author_association":"CONTRIBUTOR","body":"Greetings @justnick21   \n\nI was unable to reproduce your error.  Can you tell me what version and API you're using?  Based on your example the test I used with the REST API to verify expected behavior is as follows:\n\nMapping:\n\n``` java\ncurl -XPUT 'http://localhost:9200/geoagg' -d '\n{\"mappings\": { \n    \"incidents\": { \n      \"properties\": { \n        \"latlongs\": { \"type\": \"geo_point\", \"index_name\": \"latlong\" }, \n        \"count\": {\"type\": \"integer\"} \n      }\n    } \n  } \n}'\n```\n\nInsert test documents:\n\n``` java\ncurl -XPOST 'http://localhost:9200/geoagg/incidents/1' -d '\n{ \"latlongs\": \n  [[-70.65869808197021, -33.4377803261738],\n   [-70.65869808197021, -33.4377803261738],\n   [-70.65869808197021, -33.4377803261738]], \n  \"count\": 3 \n}'\n\ncurl -XPOST 'http://localhost:9200/geoagg/incidents/2' -d '\n{ \"latlongs\": [[-70.65869808197021, -33.4377803261738]], \n  \"count\": 6 \n}'\n```\n\nAggregate query:\n\n``` java\ncurl -XGET 'http://localhost:9200/geoagg/incidents/_search' -d '\n{ \"query\": {\"match_all\":{} }, \n  \"aggs\": { \n    \"latlongs_grid\": { \n      \"geohash_grid\": { \"field\": \"latlongs\", \"precision\": 5}, \n      \"aggs\": { \n        \"count__sum\": { \n          \"sum\": { \"field\": \"count\" }\n        }\n      }\n    }\n  }\n}'\n```\n\nBucket response:\n\n``` java\n{ ...\n  \"hits\":{ \n    \"total\": 2,\n    \"max_score\": 1.0,\n    \"hits\": [ \n      { \"_index\":\"geoagg\",\n        \"_type\":\"incidents\",\n        \"_id\":\"2\",\n        \"_score\":1.0,\n        \"_source\": {\n          \"latlongs\": [[-70.65869808197021, -33.4377803261738]], \n          \"count\": 6 }\n        }, {\n          \"_index\":\"geoagg\",\n          \"_type\":\"incidents\",\n          \"_id\":\"1\",\n          \"_score\":1.0,\n          \"_source\": {\n            \"latlongs\": [[-70.65869808197021, -33.4377803261738],\n                              [-70.65869808197021, -33.4377803261738], \n                              [-70.65869808197021, -33.4377803261738]],\n             \"count\": 3 \n          }\n        }\n      ]\n    }, \"aggregations\": {\n      \"latlongs_grid\": {\n        \"buckets\": [ {\n          \"key\": \"66jcb\",\n          \"doc_count\": 2,\n          \"count__sum\": {\n            \"value\":9.0\n          }\n        }\n      ]\n    }\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76511364","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-76511364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":76511364,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NTExMzY0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-02-28T05:16:07Z","updated_at":"2015-02-28T05:16:07Z","author_association":"CONTRIBUTOR","body":"@justnick21 any more info here, otherwise we'll close this ticket\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76680005","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-76680005","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":76680005,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NjgwMDA1","user":{"login":"justnick21","id":4408460,"node_id":"MDQ6VXNlcjQ0MDg0NjA=","avatar_url":"https://avatars0.githubusercontent.com/u/4408460?v=4","gravatar_id":"","url":"https://api.github.com/users/justnick21","html_url":"https://github.com/justnick21","followers_url":"https://api.github.com/users/justnick21/followers","following_url":"https://api.github.com/users/justnick21/following{/other_user}","gists_url":"https://api.github.com/users/justnick21/gists{/gist_id}","starred_url":"https://api.github.com/users/justnick21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justnick21/subscriptions","organizations_url":"https://api.github.com/users/justnick21/orgs","repos_url":"https://api.github.com/users/justnick21/repos","events_url":"https://api.github.com/users/justnick21/events{/privacy}","received_events_url":"https://api.github.com/users/justnick21/received_events","type":"User","site_admin":false},"created_at":"2015-03-02T09:21:16Z","updated_at":"2015-03-02T09:21:16Z","author_association":"NONE","body":"@clintongormley if i manage to reproduce it on a a small test dataset i will reopen or raise again. thanks.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76686856","html_url":"https://github.com/elastic/elasticsearch/issues/8886#issuecomment-76686856","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8886","id":76686856,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Njg2ODU2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-03-02T10:13:41Z","updated_at":"2015-03-02T10:13:41Z","author_association":"CONTRIBUTOR","body":"thanks @justnick21 \n\nI'll close this issue for now then\n","performed_via_github_app":null}]