{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19967","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19967/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19967/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19967/events","html_url":"https://github.com/elastic/elasticsearch/issues/19967","id":170768009,"node_id":"MDU6SXNzdWUxNzA3NjgwMDk=","number":19967,"title":"Snapshot creation successful with code 200 when file system is unmounted or not accessible","user":{"login":"karthikrmit","id":20979592,"node_id":"MDQ6VXNlcjIwOTc5NTky","avatar_url":"https://avatars0.githubusercontent.com/u/20979592?v=4","gravatar_id":"","url":"https://api.github.com/users/karthikrmit","html_url":"https://github.com/karthikrmit","followers_url":"https://api.github.com/users/karthikrmit/followers","following_url":"https://api.github.com/users/karthikrmit/following{/other_user}","gists_url":"https://api.github.com/users/karthikrmit/gists{/gist_id}","starred_url":"https://api.github.com/users/karthikrmit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karthikrmit/subscriptions","organizations_url":"https://api.github.com/users/karthikrmit/orgs","repos_url":"https://api.github.com/users/karthikrmit/repos","events_url":"https://api.github.com/users/karthikrmit/events{/privacy}","received_events_url":"https://api.github.com/users/karthikrmit/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":73544,"node_id":"MDU6TGFiZWw3MzU0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Enon-issue","name":">non-issue","color":"cfcfcf","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-08-11T23:10:09Z","updated_at":"2016-08-13T00:32:46Z","closed_at":"2016-08-13T00:32:45Z","author_association":"NONE","active_lock_reason":null,"body":"When the nfs share is unmounted and then a snapshot creation is attempted, the snapshot is created successfully with \"State: PARTIAL\". The response code is 200 \nIf the same is attempted with '-d' option which is to delete the indices after snapshot, we end up with a partial snapshot and also losing original indices.\n\n**Elasticsearch version**:  \"version\" : \"number\" : \"2.2.0\"\n\n**Plugins installed**: None\n\n**JVM version**:  \n[root@localhost ~]#  java -version\nopenjdk version \"1.8.0_91\"\nOpenJDK Runtime Environment (build 1.8.0_91-b14)\nOpenJDK 64-Bit Server VM (build 25.91-b14, mixed mode)\n\n**OS version**: CentOS Linux release 7.2.1511 \n\n**Description of the problem including expected versus actual behavior**:\nExpected behavior: Fail the snapshot creation when the snapshot settings have \"type\": \"fs\" and the file system/share is not accessible.\n\n**Steps to reproduce**:\n1. Set the snapshot settings to type: fs and  \"location\": \"/mount/backups/my_backup\"\n2. unmount the share @ /mount/backups/my_backup\n3. Run a create snapshot command\n\n**Provide logs (if relevant)**:\n\n[2016-08-11 22:51:44,718][WARN ][snapshots                ] [es_node1] [[test-2016-08-05][4]] [my_backup:snap3] failed to create snapshot\n[test-2016-08-05][[test-2016-08-05][4]] IndexShardSnapshotFailedException[Failed to snapshot]; nested: ElasticsearchException[failed to create blob container]; nested: AccessDeniedException[/mnt/backup/indices];\n        at org.elasticsearch.snapshots.SnapshotShardsService.snapshot(SnapshotShardsService.java:355)\n        at org.elasticsearch.snapshots.SnapshotShardsService.access$200(SnapshotShardsService.java:76)\n        at org.elasticsearch.snapshots.SnapshotShardsService$1.doRun(SnapshotShardsService.java:296)\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: ElasticsearchException[failed to create blob container]; nested: AccessDeniedException[/mnt/backup/indices];\n        at org.elasticsearch.common.blobstore.fs.FsBlobStore.blobContainer(FsBlobStore.java:70)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$Context.<init>(BlobStoreIndexShardRepository.java:310)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$Context.<init>(BlobStoreIndexShardRepository.java:303)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$SnapshotContext.<init>(BlobStoreIndexShardRepository.java:513)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository.snapshot(BlobStoreIndexShardRepository.java:187)\n        at org.elasticsearch.snapshots.SnapshotShardsService.snapshot(SnapshotShardsService.java:340)\n        ... 6 more\nCaused by: java.nio.file.AccessDeniedException: /mnt/backup/indices\n        at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)\n        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\n        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\n        at sun.nio.fs.UnixFileSystemProvider.createDirectory(UnixFileSystemProvider.java:384)\n        at java.nio.file.Files.createDirectory(Files.java:674)\n        at java.nio.file.Files.createAndCheckIsDirectory(Files.java:781)\n        at java.nio.file.Files.createDirectories(Files.java:767)\n        at org.elasticsearch.common.blobstore.fs.FsBlobStore.buildAndCreate(FsBlobStore.java:86)\n        at org.elasticsearch.common.blobstore.fs.FsBlobStore.blobContainer(FsBlobStore.java:68)\n        ... 11 more\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}