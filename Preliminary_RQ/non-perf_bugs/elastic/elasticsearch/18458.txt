{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18458/events","html_url":"https://github.com/elastic/elasticsearch/issues/18458","id":155636687,"node_id":"MDU6SXNzdWUxNTU2MzY2ODc=","number":18458,"title":"geo_bounding_box queries failing with \"Illegal shift value, must be 32..63; got shift=0\"","user":{"login":"daamsie","id":740324,"node_id":"MDQ6VXNlcjc0MDMyNA==","avatar_url":"https://avatars0.githubusercontent.com/u/740324?v=4","gravatar_id":"","url":"https://api.github.com/users/daamsie","html_url":"https://github.com/daamsie","followers_url":"https://api.github.com/users/daamsie/followers","following_url":"https://api.github.com/users/daamsie/following{/other_user}","gists_url":"https://api.github.com/users/daamsie/gists{/gist_id}","starred_url":"https://api.github.com/users/daamsie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daamsie/subscriptions","organizations_url":"https://api.github.com/users/daamsie/orgs","repos_url":"https://api.github.com/users/daamsie/repos","events_url":"https://api.github.com/users/daamsie/events{/privacy}","received_events_url":"https://api.github.com/users/daamsie/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"assignees":[{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false}],"milestone":null,"comments":12,"created_at":"2016-05-19T01:32:40Z","updated_at":"2016-08-26T13:23:34Z","closed_at":"2016-05-27T20:01:53Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:2.3.2\n\n**JVM version**: 1.8.0 25.0-b70\n\n**OS version**: Mac OS X 10.10.3\n\n**Description of the problem including expected versus actual behavior**:\nIndexing documents with geo_point attributes and then finding them in a bounding_box results in an illegal_argument_exception with the reason \"Illegal shift value, must be 32..63; got shift=0\"\n\n**Steps to reproduce**:\n1. \n`curl -XPUT 'http://localhost:9200/test/'`\n\n2.\n\n```\ncurl -XPUT 'http://localhost:9200/test/a/_mapping' -d '\n{\n\n    \"properties\" : {\n        \"location\" : {\"type\": \"geo_point\", \"store\": true, \"lat_lon\": true},\n        \"name\": {\"type\" : \"string\", \"store\" : true }\n    }\n}\n'\n```\n\n 3.\n\n```\ncurl -XPOST 'http://localhost:9200/test/a/1/' -d '\n{\n    \"location\" : {\"lat\": 44, \"lon\": 55},\n    \"name\": \"John Smith\"\n}\n'\n```\n1. \n\n```\ncurl -XPOST 'http://localhost:9200/test/a/_search' -d '\n{\n query: {\n    bool: {\n      must: {\n        match_all: {}\n      },\n      filter: {\n        geo_bounding_box: {\n        location : {\n              top_left : [56,43],\n              bottom_right : [54,45]\n          }\n        }\n      }\n    }   \n  }\n}\n'\n```\n\n**Stacktrace**:\n\n```\n[2016-05-19 11:11:51,705][DEBUG][action.search            ] [Crimson Dynamo V] [test][3], node[qR1OS2SgRkKv5G-g7z43Tw], [P], v[2], s[STARTED], a[id=43cmhMAPSBCaD8gU5b88Hg]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3ccd252e] lastShard [true]\nRemoteTransportException[[Crimson Dynamo V][127.0.0.1:9300][indices:data/read/search[phase/query]]]; nested: QueryPhaseExecutionException[Query Failed [Failed to execute main query]]; nested: IllegalArgumentException[Illegal shift value, must be 32..63; got shift=0];\nCaused by: QueryPhaseExecutionException[Query Failed [Failed to execute main query]]; nested: IllegalArgumentException[Illegal shift value, must be 32..63; got shift=0];\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:409)\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:113)\n    at org.elasticsearch.search.SearchService.loadOrExecuteQueryPhase(SearchService.java:366)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:378)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:368)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:365)\n    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: java.lang.IllegalArgumentException: Illegal shift value, must be 32..63; got shift=0\n    at org.apache.lucene.spatial.util.GeoEncodingUtils.geoCodedToPrefixCodedBytes(GeoEncodingUtils.java:114)\n    at org.apache.lucene.spatial.util.GeoEncodingUtils.geoCodedToPrefixCoded(GeoEncodingUtils.java:92)\n    at org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum$Range.fillBytesRef(GeoPointPrefixTermsEnum.java:234)\n    at org.apache.lucene.spatial.geopoint.search.GeoPointTermsEnum.nextRange(GeoPointTermsEnum.java:71)\n    at org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum.nextRange(GeoPointPrefixTermsEnum.java:169)\n    at org.apache.lucene.spatial.geopoint.search.GeoPointPrefixTermsEnum.nextSeekTerm(GeoPointPrefixTermsEnum.java:188)\n    at org.apache.lucene.index.FilteredTermsEnum.next(FilteredTermsEnum.java:212)\n    at org.apache.lucene.spatial.geopoint.search.GeoPointTermQueryConstantScoreWrapper$1.scorer(GeoPointTermQueryConstantScoreWrapper.java:103)\n    at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:628)\n    at org.elasticsearch.indices.cache.query.IndicesQueryCache$CachingWeightWrapper.scorer(IndicesQueryCache.java:263)\n    at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:389)\n    at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:628)\n    at org.elasticsearch.indices.cache.query.IndicesQueryCache$CachingWeightWrapper.scorer(IndicesQueryCache.java:263)\n    at org.apache.lucene.search.ConstantScoreQuery$1.scorer(ConstantScoreQuery.java:134)\n    at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:389)\n    at org.apache.lucene.search.Weight.bulkScorer(Weight.java:135)\n    at org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:370)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:818)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:535)\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:384)\n    ... 12 more\n\n```\n","closed_by":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"performed_via_github_app":null}