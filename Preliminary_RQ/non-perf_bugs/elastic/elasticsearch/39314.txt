{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39314","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39314/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39314/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39314/events","html_url":"https://github.com/elastic/elasticsearch/issues/39314","id":413422659,"node_id":"MDU6SXNzdWU0MTM0MjI2NTk=","number":39314,"title":"StableMasterDisruptionIT fails in CI","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-02-22T14:16:34Z","updated_at":"2019-03-11T14:32:58Z","closed_at":"2019-03-11T14:32:58Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"StableMasterDisruptionIT.testFollowerCheckerDetectsUnresponsiveNodeAfterMasterReelection failed for the first time today.  The failure does not reproduce:\r\n```\r\nCaused by: java.lang.AssertionError: {\"cluster_uuid\":\"wT_jvqnWSqWikWaIwpJSSg\",\"version\":5,\"state_uuid\":\"lQhkDmd_SPOEmT1TTAsDNQ\",\"master_node\":null,\"blocks\":{\"global\":{\"2\":{\"description\":\"no master\",\"retryable\":true,\"levels\":[\"write\",\"metadata_write\"]}}},\"nodes\":{\"zHPKN-5CTsaIbXnzoAUA8w\":{\"name\":\"node_t0\",\"ephemeral_id\":\"0EFqlulZQZOaUeCvXxUQiw\",\"transport_address\":\"127.0.0.1:41269\",\"attributes\":{}},\"nHaB1FXFRxe7roXCYCMIcg\":{\"name\":\"node_t3\",\"ephemeral_id\":\"EjWuFcSMTKOXCAFsogNixQ\",\"transport_address\":\"127.0.0.1:45337\",\"attributes\":{}},\"zV4RHQfYRMmpvz6J1y88Bw\":{\"name\":\"node_t2\",\"ephemeral_id\":\"DTtYf6TZQTK2pL15WNuiYQ\",\"transport_address\":\"127.0.0.1:35081\",\"attributes\":{}},\"rAYJfaApT3auq8EBxJDzMQ\":{\"name\":\"node_t1\",\"ephemeral_id\":\"U2v3FHaDSRGzDhWIk_2orA\",\"transport_address\":\"127.0.0.1:41383\",\"attributes\":{}}},\"metadata\":{\"cluster_uuid\":\"wT_jvqnWSqWikWaIwpJSSg\",\"cluster_coordination\":{\"term\":1,\"last_committed_config\":[\"zV4RHQfYRMmpvz6J1y88Bw\",\"rAYJfaApT3auq8EBxJDzMQ\",\"zHPKN-5CTsaIbXnzoAUA8w\"],\"last_accepted_config\":[\"zV4RHQfYRMmpvz6J1y88Bw\",\"rAYJfaApT3auq8EBxJDzMQ\",\"zHPKN-5CTsaIbXnzoAUA8w\"],\"voting_config_exclusions\":[{\"node_id\":\"nHaB1FXFRxe7roXCYCMIcg\",\"node_name\":\"node_t3\"}]},\"templates\":{},\"indices\":{},\"index-graveyard\":{\"tombstones\":[]}},\"routing_table\":{\"indices\":{}},\"routing_nodes\":{\"unassigned\":[],\"nodes\":{\"nHaB1FXFRxe7roXCYCMIcg\":[],\"rAYJfaApT3auq8EBxJDzMQ\":[],\"zHPKN-5CTsaIbXnzoAUA8w\":[],\"zV4RHQfYRMmpvz6J1y88Bw\":[]}}} vs {\"cluster_uuid\":\"wT_jvqnWSqWikWaIwpJSSg\",\"version\":6,\"state_uuid\":\"iYC-SDemQD-T76Gy_zuyng\",\"master_node\":null,\"blocks\":{\"global\":{\"2\":{\"description\":\"no master\",\"retryable\":true,\"levels\":[\"write\",\"metadata_write\"]}}},\"nodes\":{\"zHPKN-5CTsaIbXnzoAUA8w\":{\"name\":\"node_t0\",\"ephemeral_id\":\"0EFqlulZQZOaUeCvXxUQiw\",\"transport_address\":\"127.0.0.1:41269\",\"attributes\":{}},\"nHaB1FXFRxe7roXCYCMIcg\":{\"name\":\"node_t3\",\"ephemeral_id\":\"EjWuFcSMTKOXCAFsogNixQ\",\"transport_address\":\"127.0.0.1:45337\",\"attributes\":{}},\"zV4RHQfYRMmpvz6J1y88Bw\":{\"name\":\"node_t2\",\"ephemeral_id\":\"DTtYf6TZQTK2pL15WNuiYQ\",\"transport_address\":\"127.0.0.1:35081\",\"attributes\":{}},\"rAYJfaApT3auq8EBxJDzMQ\":{\"name\":\"node_t1\",\"ephemeral_id\":\"U2v3FHaDSRGzDhWIk_2orA\",\"transport_address\":\"127.0.0.1:41383\",\"attributes\":{}}},\"metadata\":{\"cluster_uuid\":\"wT_jvqnWSqWikWaIwpJSSg\",\"cluster_coordination\":{\"term\":3,\"last_committed_config\":[\"zV4RHQfYRMmpvz6J1y88Bw\",\"rAYJfaApT3auq8EBxJDzMQ\",\"zHPKN-5CTsaIbXnzoAUA8w\"],\"last_accepted_config\":[\"zV4RHQfYRMmpvz6J1y88Bw\",\"rAYJfaApT3auq8EBxJDzMQ\",\"zHPKN-5CTsaIbXnzoAUA8w\"],\"voting_config_exclusions\":[{\"node_id\":\"nHaB1FXFRxe7roXCYCMIcg\",\"node_name\":\"node_t3\"}]},\"templates\":{},\"indices\":{},\"index-graveyard\":{\"tombstones\":[]}},\"routing_table\":{\"indices\":{}},\"routing_nodes\":{\"unassigned\":[],\"nodes\":{\"nHaB1FXFRxe7roXCYCMIcg\":[],\"rAYJfaApT3auq8EBxJDzMQ\":[],\"zHPKN-5CTsaIbXnzoAUA8w\":[],\"zV4RHQfYRMmpvz6J1y88Bw\":[]}}}\r\n\tat __randomizedtesting.SeedInfo.seed([93914A17FFFDFE5A]:0)\r\n\tat org.elasticsearch.cluster.coordination.Coordinator.assertPreviousStateConsistency(Coordinator.java:1007)\r\n\tat org.elasticsearch.cluster.coordination.Coordinator.publish(Coordinator.java:955)\r\n\tat org.elasticsearch.cluster.service.MasterService.publish(MasterService.java:252)\r\n\tat org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:238)\r\n```\r\n\r\nThe assertion is tripping because it expects a `term` of `1`, but it's getting one of `3`.\r\n\r\nReproduce line:\r\n```\r\nREPRODUCE WITH: ./gradlew :server:integTest \\\r\n  -Dtests.seed=93914A17FFFDFE5A \\\r\n  -Dtests.class=org.elasticsearch.discovery.StableMasterDisruptionIT \\\r\n  -Dtests.method=\"testFollowerCheckerDetectsUnresponsiveNodeAfterMasterReelection\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=sr-CS \\\r\n  -Dtests.timezone=Indian/Mayotte \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nBuild log:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/2204/console","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}