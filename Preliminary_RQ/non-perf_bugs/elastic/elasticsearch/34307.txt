{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34307","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34307/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34307/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34307/events","html_url":"https://github.com/elastic/elasticsearch/issues/34307","id":366834174,"node_id":"MDU6SXNzdWUzNjY4MzQxNzQ=","number":34307,"title":"Upgrade from 6.2.4 to 6.4.2 - unable to use elasticsearch-plugin command to remove x-pack plugin after upgrade","user":{"login":"danleerunk","id":11722989,"node_id":"MDQ6VXNlcjExNzIyOTg5","avatar_url":"https://avatars2.githubusercontent.com/u/11722989?v=4","gravatar_id":"","url":"https://api.github.com/users/danleerunk","html_url":"https://github.com/danleerunk","followers_url":"https://api.github.com/users/danleerunk/followers","following_url":"https://api.github.com/users/danleerunk/following{/other_user}","gists_url":"https://api.github.com/users/danleerunk/gists{/gist_id}","starred_url":"https://api.github.com/users/danleerunk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danleerunk/subscriptions","organizations_url":"https://api.github.com/users/danleerunk/orgs","repos_url":"https://api.github.com/users/danleerunk/repos","events_url":"https://api.github.com/users/danleerunk/events{/privacy}","received_events_url":"https://api.github.com/users/danleerunk/received_events","type":"User","site_admin":false},"labels":[{"id":146832994,"node_id":"MDU6TGFiZWwxNDY4MzI5OTQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Plugins","name":":Core/Infra/Plugins","color":"0e8a16","default":false,"description":"Plugin API and infrastructure"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2018-10-04T15:02:06Z","updated_at":"2018-10-17T13:14:14Z","closed_at":"2018-10-17T13:14:14Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.2.4 upgrading to 6.4.2\r\n\r\n**Plugins installed**: [xpack]\r\n\r\n**JVM version** (`java -version`): openjdk version \"1.8.0_171\"\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): CentOS 3.10.0-693.11.6.el7.x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen upgrading from versions of Elasticsearch prior to 6.3 to 6.3 or higher, the x-pack plugin must be removed. We advise running `bin/elasticsearch-plugin remove x-pack` after the upgrade, but before restarting the node, which worked in 6.3 to remove the plugin. However, when upgrading to 6.4, attempting this command results in the error mentioned at the bottom of this issue.\r\n\r\nExpected: `bin/elasticsearch-plugin remove x-pack` removes the x-pack plugin after upgrade from 6.2.4 to 6.4.2\r\nActual: the command fails with the error I've included below\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Install ES 6.2.4, then install the x-pack plugin\r\n 2. Stop ES and perform an upgrade to ES 6.4.2 (`rpm -Uvh`)\r\n 3. Attempt to run `bin/elasticsearch-plugin remove x-pack` from the ES_HOME directory\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\n[root@localhost elasticsearch]# bin/elasticsearch-plugin remove x-pack\r\nException in thread \"main\" java.lang.IllegalStateException: Could not load plugin descriptor for plugin directory [x-pack]\r\n\tat org.elasticsearch.plugins.PluginsService.readPluginBundle(PluginsService.java:394)\r\n\tat org.elasticsearch.plugins.PluginsService.findBundles(PluginsService.java:379)\r\n\tat org.elasticsearch.plugins.PluginsService.getPluginBundles(PluginsService.java:372)\r\n\tat org.elasticsearch.plugins.RemovePluginCommand.execute(RemovePluginCommand.java:89)\r\n\tat org.elasticsearch.plugins.RemovePluginCommand.execute(RemovePluginCommand.java:67)\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n\tat org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:77)\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n\tat org.elasticsearch.cli.Command.main(Command.java:90)\r\n\tat org.elasticsearch.plugins.PluginCli.main(PluginCli.java:47)\r\nCaused by: java.nio.file.NoSuchFileException: /usr/share/elasticsearch/plugins/x-pack/plugin-descriptor.properties\r\n\tat sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)\r\n\tat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\r\n\tat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\r\n\tat sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)\r\n\tat java.nio.file.Files.newByteChannel(Files.java:361)\r\n\tat java.nio.file.Files.newByteChannel(Files.java:407)\r\n\tat java.nio.file.spi.FileSystemProvider.newInputStream(FileSystemProvider.java:384)\r\n\tat java.nio.file.Files.newInputStream(Files.java:152)\r\n\tat org.elasticsearch.plugins.PluginInfo.readFromProperties(PluginInfo.java:162)\r\n\tat org.elasticsearch.plugins.PluginsService.readPluginBundle(PluginsService.java:391)\r\n\t... 10 more\r\n```\r\n\r\n**Notes**:\r\nI've marked as a bug, but upon further thought - we might just change the doc to advise removing the plugin prior to actually upgrading ES? I don't know if this has potential risk should the upgrade fail/etc. Easiest example of the doc is the [upgrade guide](https://www.elastic.co/products/upgrade_guide)\r\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}