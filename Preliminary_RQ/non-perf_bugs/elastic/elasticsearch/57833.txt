{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57833","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57833/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57833/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57833/events","html_url":"https://github.com/elastic/elasticsearch/issues/57833","id":634821162,"node_id":"MDU6SXNzdWU2MzQ4MjExNjI=","number":57833,"title":"CircuitBreakingException when *Beats dashboard.enabled=true Crashes the entire ECK network","user":{"login":"jaydlowrider","id":1182594,"node_id":"MDQ6VXNlcjExODI1OTQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1182594?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydlowrider","html_url":"https://github.com/jaydlowrider","followers_url":"https://api.github.com/users/jaydlowrider/followers","following_url":"https://api.github.com/users/jaydlowrider/following{/other_user}","gists_url":"https://api.github.com/users/jaydlowrider/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydlowrider/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydlowrider/subscriptions","organizations_url":"https://api.github.com/users/jaydlowrider/orgs","repos_url":"https://api.github.com/users/jaydlowrider/repos","events_url":"https://api.github.com/users/jaydlowrider/events{/privacy}","received_events_url":"https://api.github.com/users/jaydlowrider/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-06-08T18:01:06Z","updated_at":"2020-06-10T23:26:14Z","closed_at":"2020-06-10T23:26:14Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.6.2\r\n\r\n**Plugins installed**: [] repository-gcs mapper-size\r\n\r\n**JVM version** (`java -version`): OpenJDK 13\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux #1 SMP Tue Feb 11 05:33:03 PST 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\ncircuit_breaking_exception at shard 3index .server.log.2020.05.28node hRMLMRV1S2acHAMvwcOT_g\r\nType\r\ncircuit_breaking_exception\r\nReason\r\n[parent] Data too large, data for [<transport_request>] would be [10251944894/9.5gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10251941816/9.5gb], new bytes reserved: [3078/3kb], usages [request=0/0b, fielddata=3394401948/3.1gb, in_flight_requests=3078/3kb, accounting=5119101055/4.7gb]\r\nBytes wanted\r\n10251944894\r\nBytes limit\r\n10150864486\r\nDurability\r\nPERMANENT\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem,\r\nincluding (e.g.) index creation, mappings, settings, query etc.  The easier\r\nyou make for us to reproduce it, the more likely that somebody will take the\r\ntime to look at it.\r\n\r\n 1. Install Metricbeat 7.7.0\r\n 2. `setup.dashboards.enabled: true` and all relevant Kibana settings for the metricbeat.yml\r\n 3. and start metricbeat \r\n\r\n**Provide logs (if relevant)**:\r\n{\"type\":\"log\",\"@timestamp\":\"2020-06-01T14:44:29Z\",\"tags\":[\"status\",\"plugin:reporting@7.6.2\",\"error\"],\"pid\":6,\"state\":\"red\",\"message\":\"Status changed from red to red - [circuit_breaking_exception] [parent] Data too large, data for [<http_request>] would be [10193362360/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193362360/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb], with { bytes_wanted=10193362360 & bytes_limit=10150864486 & durability=\\\"PERMANENT\\\" }\",\"prevState\":\"red\",\"prevMsg\":\"[circuit_breaking_exception] [parent] Data too large, data for [<http_request>] would be [10200774048/9.5gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10200774048/9.5gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3394415362/3.1gb, in_flight_requests=0/0b, accounting=5119101055/4.7gb], with { bytes_wanted=10200774048 & bytes_limit=10150864486 & durability=\\\"PERMANENT\\\" }\"}\r\n{\"type\":\"log\",\"@timestamp\":\"2020-06-01T14:44:29Z\",\"tags\":[\"info\",\"monitoring\",\"kibana-monitoring\"],\"pid\":6,\"message\":\"Monitoring status upload endpoint is not enabled in Elasticsearch:Monitoring stats collection is stopped\"}\r\n{\"type\":\"log\",\"@timestamp\":\"2020-06-01T14:44:29Z\",\"tags\":[\"warning\",\"plugins\",\"licensing\"],\"pid\":6,\"message\":\"License information could not be obtained from Elasticsearch due to [circuit_breaking_exception] [parent] Data too large, data for [<http_request>] would be [10193362360/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193362360/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb], with { bytes_wanted=10193362360 & bytes_limit=10150864486 & durability=\\\"PERMANENT\\\" } :: {\\\"path\\\":\\\"/_xpack\\\",\\\"statusCode\\\":429,\\\"response\\\":\\\"{\\\\\\\"error\\\\\\\":{\\\\\\\"root_cause\\\\\\\":[{\\\\\\\"type\\\\\\\":\\\\\\\"circuit_breaking_exception\\\\\\\",\\\\\\\"reason\\\\\\\":\\\\\\\"[parent] Data too large, data for [<http_request>] would be [10193362360/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193362360/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb]\\\\\\\",\\\\\\\"bytes_wanted\\\\\\\":10193362360,\\\\\\\"bytes_limit\\\\\\\":10150864486,\\\\\\\"durability\\\\\\\":\\\\\\\"PERMANENT\\\\\\\"}],\\\\\\\"type\\\\\\\":\\\\\\\"circuit_breaking_exception\\\\\\\",\\\\\\\"reason\\\\\\\":\\\\\\\"[parent] Data too large, data for [<http_request>] would be [10193362360/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193362360/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb]\\\\\\\",\\\\\\\"bytes_wanted\\\\\\\":10193362360,\\\\\\\"bytes_limit\\\\\\\":10150864486,\\\\\\\"durability\\\\\\\":\\\\\\\"PERMANENT\\\\\\\"},\\\\\\\"status\\\\\\\":429}\\\"} error\"}\r\n{\"type\":\"log\",\"@timestamp\":\"2020-06-01T14:44:29Z\",\"tags\":[\"warning\",\"plugins\",\"licensing\"],\"pid\":6,\"message\":\"License information could not be obtained from Elasticsearch due to [circuit_breaking_exception] [parent] Data too large, data for [<http_request>] would be [10193397776/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193397776/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb], with { bytes_wanted=10193397776 & bytes_limit=10150864486 & durability=\\\"PERMANENT\\\" } :: {\\\"path\\\":\\\"/_xpack\\\",\\\"statusCode\\\":429,\\\"response\\\":\\\"{\\\\\\\"error\\\\\\\":{\\\\\\\"root_cause\\\\\\\":[{\\\\\\\"type\\\\\\\":\\\\\\\"circuit_breaking_exception\\\\\\\",\\\\\\\"reason\\\\\\\":\\\\\\\"[parent] Data too large, data for [<http_request>] would be [10193397776/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193397776/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb]\\\\\\\",\\\\\\\"bytes_wanted\\\\\\\":10193397776,\\\\\\\"bytes_limit\\\\\\\":10150864486,\\\\\\\"durability\\\\\\\":\\\\\\\"PERMANENT\\\\\\\"}],\\\\\\\"type\\\\\\\":\\\\\\\"circuit_breaking_exception\\\\\\\",\\\\\\\"reason\\\\\\\":\\\\\\\"[parent] Data too large, data for [<http_request>] would be [10193397776/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193397776/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb]\\\\\\\",\\\\\\\"bytes_wanted\\\\\\\":10193397776,\\\\\\\"bytes_limit\\\\\\\":10150864486,\\\\\\\"durability\\\\\\\":\\\\\\\"PERMANENT\\\\\\\"},\\\\\\\"status\\\\\\\":429}\\\"} error\"}\r\n{\"type\":\"log\",\"@timestamp\":\"2020-06-01T14:44:29Z\",\"tags\":[\"status\",\"plugin:xpack_main@7.6.2\",\"error\"],\"pid\":6,\"state\":\"red\",\"message\":\"Status changed from red to red - [circuit_breaking_exception] [parent] Data too large, data for [<http_request>] would be [10193397776/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193397776/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb], with { bytes_wanted=10193397776 & bytes_limit=10150864486 & durability=\\\"PERMANENT\\\" }\",\"prevState\":\"red\",\"prevMsg\":\"[circuit_breaking_exception] [parent] Data too large, data for [<http_request>] would be [10193362360/9.4gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10193362360/9.4gb], new bytes reserved: [0/0b], usages [request=0/0b, fielddata=3386311265/3.1gb, in_flight_requests=0/0b, accounting=5117300532/4.7gb], with { bytes_wanted=10193362360 & bytes_limit=10150864486 & durability=\\\"PERMANENT\\\" }\"}\r\n\"stacktrace\": [\"org.elasticsearch.transport.RemoteTransportException: [prod-logs-es-warm-2][10.248.141.4:9300][indices:data/read/search[phase/query]]\",\r\n\"Caused by: org.elasticsearch.common.breaker.CircuitBreakingException: [parent] Data too large, data for [<transport_request>] would be [10304452728/9.5gb], which is larger than the limit of [10150864486/9.4gb], real usage: [10304449576/9.5gb], new bytes reserved: [3152/3kb], usages [request=0/0b, fielddata=3386319373/3.1gb, in_flight_requests=3152/3kb, accounting=5117300532/4.7gb]\",\r\n\r\n\"at org.elasticsearch.indices.breaker.HierarchyCircuitBreakerService.checkParentLimit(HierarchyCircuitBreakerService.java:343) ~[elasticsearch-7.6.2.jar:7.6.2]\",\r\n\"at org.elasticsearch.common.breaker.ChildMemoryCircuitBreaker.addEstimateBytesAndMaybeBreak(ChildMemoryCircuitBreaker.java:128) ~[elasticsearch-7.6.2.jar:7.6.2]\",\r\n\"at org.elasticsearch.transport.InboundHandler.handleRequest(InboundHandler.java:171) [elasticsearch-7.6.2.jar:7.6.2]\",\r\n\"at org.elasticsearch.transport.InboundHandler.messageReceived(InboundHandler.java:119) [elasticsearch-7.6.2.jar:7.6.2]\",\r\n\"at org.elasticsearch.transport.InboundHandler.inboundMessage(InboundHandler.java:103) [elasticsearch-7.6.2.jar:7.6.2]\",\r\n\"at org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:667) [elasticsearch-7.6.2.jar:7.6.2]\",\r\n\"at org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:62) [transport-netty4-client-7.6.2.jar:7.6.2]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:326) [netty-codec-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:300) [netty-codec-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.logging.LoggingHandler.channelRead(LoggingHandler.java:241) [netty-handler-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1478) [netty-handler-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1227) [netty-handler-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1274) [netty-handler-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:503) [netty-codec-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:442) [netty-codec-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:281) [netty-codec-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1422) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:931) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:700) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:600) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:554) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:514) [netty-transport-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.util.concurrent.SingleThreadEventExecutor$6.run(SingleThreadEventExecutor.java:1050) [netty-common-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) [netty-common-4.1.43.Final.jar:4.1.43.Final]\",\r\n\"at java.lang.Thread.run(Thread.java:830) [?:?]\"] }\r\n\r\n","closed_by":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"performed_via_github_app":null}