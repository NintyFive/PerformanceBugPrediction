{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30946","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30946/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30946/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30946/events","html_url":"https://github.com/elastic/elasticsearch/issues/30946","id":327554003,"node_id":"MDU6SXNzdWUzMjc1NTQwMDM=","number":30946,"title":"PUT cluster.routing.allocation.exclude handling with array value","user":{"login":"jordansissel","id":131818,"node_id":"MDQ6VXNlcjEzMTgxOA==","avatar_url":"https://avatars1.githubusercontent.com/u/131818?v=4","gravatar_id":"","url":"https://api.github.com/users/jordansissel","html_url":"https://github.com/jordansissel","followers_url":"https://api.github.com/users/jordansissel/followers","following_url":"https://api.github.com/users/jordansissel/following{/other_user}","gists_url":"https://api.github.com/users/jordansissel/gists{/gist_id}","starred_url":"https://api.github.com/users/jordansissel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jordansissel/subscriptions","organizations_url":"https://api.github.com/users/jordansissel/orgs","repos_url":"https://api.github.com/users/jordansissel/repos","events_url":"https://api.github.com/users/jordansissel/events{/privacy}","received_events_url":"https://api.github.com/users/jordansissel/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"vladimirdolzhenko","id":209440,"node_id":"MDQ6VXNlcjIwOTQ0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/209440?v=4","gravatar_id":"","url":"https://api.github.com/users/vladimirdolzhenko","html_url":"https://github.com/vladimirdolzhenko","followers_url":"https://api.github.com/users/vladimirdolzhenko/followers","following_url":"https://api.github.com/users/vladimirdolzhenko/following{/other_user}","gists_url":"https://api.github.com/users/vladimirdolzhenko/gists{/gist_id}","starred_url":"https://api.github.com/users/vladimirdolzhenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vladimirdolzhenko/subscriptions","organizations_url":"https://api.github.com/users/vladimirdolzhenko/orgs","repos_url":"https://api.github.com/users/vladimirdolzhenko/repos","events_url":"https://api.github.com/users/vladimirdolzhenko/events{/privacy}","received_events_url":"https://api.github.com/users/vladimirdolzhenko/received_events","type":"User","site_admin":false},"assignees":[{"login":"vladimirdolzhenko","id":209440,"node_id":"MDQ6VXNlcjIwOTQ0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/209440?v=4","gravatar_id":"","url":"https://api.github.com/users/vladimirdolzhenko","html_url":"https://github.com/vladimirdolzhenko","followers_url":"https://api.github.com/users/vladimirdolzhenko/followers","following_url":"https://api.github.com/users/vladimirdolzhenko/following{/other_user}","gists_url":"https://api.github.com/users/vladimirdolzhenko/gists{/gist_id}","starred_url":"https://api.github.com/users/vladimirdolzhenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vladimirdolzhenko/subscriptions","organizations_url":"https://api.github.com/users/vladimirdolzhenko/orgs","repos_url":"https://api.github.com/users/vladimirdolzhenko/repos","events_url":"https://api.github.com/users/vladimirdolzhenko/events{/privacy}","received_events_url":"https://api.github.com/users/vladimirdolzhenko/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2018-05-30T02:46:05Z","updated_at":"2018-08-24T16:12:14Z","closed_at":"2018-08-24T16:12:14Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the feature**:\r\n\r\nPUT cluster.routing.allocation.exclude handling with array value should either work correctly or provide actionable feedback in an error response.\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.2.3\r\n\r\n**Plugins installed**: [x-pack]\r\n\r\n**JVM version** (`java -version`): Whatever version ships on the elasticsearch-platinum:6.2.3 docker image\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Whatever version ships on the elasticsearch-platinum:6.2.3 docker image\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n_cluster/settings accepts an array value for `cluster.routing.allocation.exclude._name` but has no apparent effect. \r\n\r\nExpected: A list of names should either be accepted and exclude all entries in the list, or this setting should be rejected and an actionable error message noted in the response.\r\n\r\n**Steps to reproduce**:\r\n\r\n```\r\nPUT _cluster/settings\r\n{\r\n  \"transient\" : {\r\n    \"cluster.routing.allocation.exclude._name\" : [ \"elasticsearch-data-0\" ]\r\n  }\r\n}\r\n\r\n<response>\r\n{\r\n  \"acknowledged\": true,\r\n  \"persistent\": {},\r\n  \"transient\": {\r\n    \"cluster\": {\r\n      \"routing\": {\r\n        \"allocation\": {\r\n          \"exclude\": {\r\n            \"_name\": [\r\n              \"elasticsearch-data-0\"\r\n            ]\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nResponse is 200 OK and otherwise seems OK. However, no shards are relocated from this node. There is no feedback on the HTTP response that indicates that this setting is invalid.\r\n\r\nWhile checking `_cat/shards`, I noticed that no shards were being reallocated based on my request which intended to say \"Evacuate all shards from elasticsearch-data-0\".\r\n\r\nThe correct setting is, as I read in the docs, to use comma-separated strings:\r\n\r\nWhile attempting to set cluster allocation to drain shards from a node, I did this:\r\n\r\n\r\n```\r\nPUT _cluster/settings\r\n{\r\n  \"transient\" : {\r\n    \"cluster.routing.allocation.exclude._name\": \"elasticsearch-data-0\"\r\n  }\r\n}\r\n```\r\n\r\nAnd then shards are moved away from this node.","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}