[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/717490809","html_url":"https://github.com/elastic/elasticsearch/issues/64237#issuecomment-717490809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64237","id":717490809,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzQ5MDgwOQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2020-10-27T19:42:13Z","updated_at":"2020-10-27T19:42:13Z","author_association":"MEMBER","body":"Sorry that you're having trouble. Alas, I am not able to reproduce this, and it would surprise me if the LTS build of JDK 11 removed CMS since the removal was only slated for [JDK 14](https://openjdk.java.net/jeps/363). The implementation of this removal was that CMS was removed in JDK 14, but the flags were ignored, and then in JDK 15 it was an error to use the CMS flags.\r\n\r\nI installed the package that you indicated, and configured `JAVA_HOME` in `/etc/sysconfig/elasticsearch` to point to this JDK:\r\n\r\n```\r\ncentos-7:~$ sudo cat /etc/sysconfig/elasticsearch | grep -i JAVA_HOME\r\nJAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.8.10-0.el7_8.x86_64\r\n```\r\n\r\nThen I started Elasticsearch using `systemctl`, and by hitting the endpoint `/_nodes/jvm?pretty=true&&filter_path=**.jvm` we can see that it is using JDK 11.0.8 from the package that you indicated.\r\n\r\n```\r\ncentos-7:~$ curl -XGET \"localhost:9200/_nodes/jvm?pretty=true&&filter_path=**.jvm\"\r\n{\r\n  \"nodes\" : {\r\n    \"9LSTad4hQseFxpNNUkw2hg\" : {\r\n      \"jvm\" : {\r\n        \"pid\" : 16308,\r\n        \"version\" : \"11.0.8\",\r\n        \"vm_name\" : \"OpenJDK 64-Bit Server VM\",\r\n        \"vm_version\" : \"11.0.8+10-LTS\",\r\n        \"vm_vendor\" : \"Oracle Corporation\",\r\n        \"bundled_jdk\" : true,\r\n        \"using_bundled_jdk\" : false,\r\n        \"start_time_in_millis\" : 1603827366129,\r\n        \"mem\" : {\r\n          \"heap_init_in_bytes\" : 1073741824,\r\n          \"heap_max_in_bytes\" : 1038876672,\r\n          \"non_heap_init_in_bytes\" : 7667712,\r\n          \"non_heap_max_in_bytes\" : 0,\r\n          \"direct_max_in_bytes\" : 0\r\n        },\r\n        \"gc_collectors\" : [\r\n          \"ParNew\",\r\n          \"ConcurrentMarkSweep\"\r\n        ],\r\n        \"memory_pools\" : [\r\n          \"CodeHeap 'non-nmethods'\",\r\n          \"Metaspace\",\r\n          \"CodeHeap 'profiled nmethods'\",\r\n          \"Compressed Class Space\",\r\n          \"Par Eden Space\",\r\n          \"Par Survivor Space\",\r\n          \"CodeHeap 'non-profiled nmethods'\",\r\n          \"CMS Old Gen\"\r\n        ],\r\n        \"using_compressed_ordinary_object_pointers\" : \"true\",\r\n        \"input_arguments\" : [\r\n          \"-Xshare:auto\",\r\n          \"-Des.networkaddress.cache.ttl=60\",\r\n          \"-Des.networkaddress.cache.negative.ttl=10\",\r\n          \"-XX:+AlwaysPreTouch\",\r\n          \"-Xss1m\",\r\n          \"-Djava.awt.headless=true\",\r\n          \"-Dfile.encoding=UTF-8\",\r\n          \"-Djna.nosys=true\",\r\n          \"-XX:-OmitStackTraceInFastThrow\",\r\n          \"-Dio.netty.noUnsafe=true\",\r\n          \"-Dio.netty.noKeySetOptimization=true\",\r\n          \"-Dio.netty.recycler.maxCapacityPerThread=0\",\r\n          \"-Dio.netty.allocator.numDirectArenas=0\",\r\n          \"-Dlog4j.shutdownHookEnabled=false\",\r\n          \"-Dlog4j2.disable.jmx=true\",\r\n          \"-Djava.locale.providers=SPI,COMPAT\",\r\n          \"-Xms1g\",\r\n          \"-Xmx1g\",\r\n          \"-XX:+UseConcMarkSweepGC\",\r\n          \"-XX:CMSInitiatingOccupancyFraction=75\",\r\n          \"-XX:+UseCMSInitiatingOccupancyOnly\",\r\n          \"-Djava.io.tmpdir=/tmp/elasticsearch-1198748067177237691\",\r\n          \"-XX:+HeapDumpOnOutOfMemoryError\",\r\n          \"-XX:HeapDumpPath=/var/lib/elasticsearch\",\r\n          \"-XX:ErrorFile=/var/log/elasticsearch/hs_err_pid%p.log\",\r\n          \"-Xlog:gc*,gc+age=trace,safepoint:file=/var/log/elasticsearch/gc.log:utctime,pid,tags:filecount=32,filesize=64m\",\r\n          \"-XX:MaxDirectMemorySize=536870912\",\r\n          \"-Des.path.home=/usr/share/elasticsearch\",\r\n          \"-Des.path.conf=/etc/elasticsearch\",\r\n          \"-Des.distribution.flavor=default\",\r\n          \"-Des.distribution.type=rpm\",\r\n          \"-Des.bundled_jdk=true\"\r\n        ]\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nSo I do not think the problem here is JDK 11.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/717597053","html_url":"https://github.com/elastic/elasticsearch/issues/64237#issuecomment-717597053","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64237","id":717597053,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzU5NzA1Mw==","user":{"login":"pa-jberanek","id":22837936,"node_id":"MDQ6VXNlcjIyODM3OTM2","avatar_url":"https://avatars3.githubusercontent.com/u/22837936?v=4","gravatar_id":"","url":"https://api.github.com/users/pa-jberanek","html_url":"https://github.com/pa-jberanek","followers_url":"https://api.github.com/users/pa-jberanek/followers","following_url":"https://api.github.com/users/pa-jberanek/following{/other_user}","gists_url":"https://api.github.com/users/pa-jberanek/gists{/gist_id}","starred_url":"https://api.github.com/users/pa-jberanek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pa-jberanek/subscriptions","organizations_url":"https://api.github.com/users/pa-jberanek/orgs","repos_url":"https://api.github.com/users/pa-jberanek/repos","events_url":"https://api.github.com/users/pa-jberanek/events{/privacy}","received_events_url":"https://api.github.com/users/pa-jberanek/received_events","type":"User","site_admin":false},"created_at":"2020-10-27T23:18:28Z","updated_at":"2020-10-27T23:19:00Z","author_association":"NONE","body":"Thank you for trying to reproduce the issue, and I learnt something new today...\r\n\r\nThe 'elasticsearch' RPM from the Elasticsearch yum repository comes with its own bundled JVM, which with 7.9.3 is Java 15!\r\n\r\nThe **actual** issue is that the server in question had been through numerous ES updates, but jvm.options had been modified by us to change the heap size. Due to this modification RPM updates created jvm.options.rpmnew, which we never reconciled back into jvm.options.\r\n\r\nWhat this meant is we ended up with an elasticsearch RPM including JVM 15 but with a jvm.options which read:\r\n\r\n```\r\n## GC configuration\r\n-XX:+UseConcMarkSweepGC\r\n-XX:CMSInitiatingOccupancyFraction=75\r\n-XX:+UseCMSInitiatingOccupancyOnly\r\n\r\n## G1GC Configuration\r\n# NOTE: G1GC is only supported on JDK version 10 or later.\r\n# To use G1GC uncomment the lines below.\r\n# 10-:-XX:-UseConcMarkSweepGC\r\n# 10-:-XX:-UseCMSInitiatingOccupancyOnly\r\n#10-:-XX:+UseG1GC\r\n#10-:-XX:G1ReservePercent=25\r\n#10-:-XX:InitiatingHeapOccupancyPercent=30\r\n```\r\n\r\nI've now read somewhere else that the suggestion is to **not** modify jvm.options to modify the heap, and instead to add a separate file in jvm.options.d to override the heap. If this is done then subsequent updates of the elasticsearch RPM will happily overwrite the jvm.options file with any new config required for the new JVM included in the RPM.\r\n\r\n``` ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/717598369","html_url":"https://github.com/elastic/elasticsearch/issues/64237#issuecomment-717598369","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64237","id":717598369,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzU5ODM2OQ==","user":{"login":"pa-jberanek","id":22837936,"node_id":"MDQ6VXNlcjIyODM3OTM2","avatar_url":"https://avatars3.githubusercontent.com/u/22837936?v=4","gravatar_id":"","url":"https://api.github.com/users/pa-jberanek","html_url":"https://github.com/pa-jberanek","followers_url":"https://api.github.com/users/pa-jberanek/followers","following_url":"https://api.github.com/users/pa-jberanek/following{/other_user}","gists_url":"https://api.github.com/users/pa-jberanek/gists{/gist_id}","starred_url":"https://api.github.com/users/pa-jberanek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pa-jberanek/subscriptions","organizations_url":"https://api.github.com/users/pa-jberanek/orgs","repos_url":"https://api.github.com/users/pa-jberanek/repos","events_url":"https://api.github.com/users/pa-jberanek/events{/privacy}","received_events_url":"https://api.github.com/users/pa-jberanek/received_events","type":"User","site_admin":false},"created_at":"2020-10-27T23:22:05Z","updated_at":"2020-10-27T23:22:05Z","author_association":"NONE","body":"Looking at the RPM one could also use the ES_JAVA_OPTS variable in /etc/sysconfig/elasticsearch. Both methods are mentioned in the current https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/717600441","html_url":"https://github.com/elastic/elasticsearch/issues/64237#issuecomment-717600441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64237","id":717600441,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzYwMDQ0MQ==","user":{"login":"pa-jberanek","id":22837936,"node_id":"MDQ6VXNlcjIyODM3OTM2","avatar_url":"https://avatars3.githubusercontent.com/u/22837936?v=4","gravatar_id":"","url":"https://api.github.com/users/pa-jberanek","html_url":"https://github.com/pa-jberanek","followers_url":"https://api.github.com/users/pa-jberanek/followers","following_url":"https://api.github.com/users/pa-jberanek/following{/other_user}","gists_url":"https://api.github.com/users/pa-jberanek/gists{/gist_id}","starred_url":"https://api.github.com/users/pa-jberanek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pa-jberanek/subscriptions","organizations_url":"https://api.github.com/users/pa-jberanek/orgs","repos_url":"https://api.github.com/users/pa-jberanek/repos","events_url":"https://api.github.com/users/pa-jberanek/events{/privacy}","received_events_url":"https://api.github.com/users/pa-jberanek/received_events","type":"User","site_admin":false},"created_at":"2020-10-27T23:28:38Z","updated_at":"2020-10-27T23:28:38Z","author_association":"NONE","body":"Given all the above, I'm happy to close this ticket.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/717643353","html_url":"https://github.com/elastic/elasticsearch/issues/64237#issuecomment-717643353","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64237","id":717643353,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzY0MzM1Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2020-10-28T01:48:50Z","updated_at":"2020-10-28T01:48:50Z","author_association":"MEMBER","body":"> The 'elasticsearch' RPM from the Elasticsearch yum repository comes with its own bundled JVM, which with 7.9.3 is Java 15!\r\n\r\nThat's right, and that's what we encourage users to be using. 😇 \r\n\r\n> Due to this modification RPM updates created jvm.options.rpmnew, which we never reconciled back into jvm.options.\r\n\r\nYeah, it's exactly for this reason that we introduced the `jvm.options.d` mechanism in #51882.\r\n\r\n> Looking at the RPM one could also use the ES_JAVA_OPTS variable in /etc/sysconfig/elasticsearch.\r\n\r\nYeah, while this mechanism exists, it is mostly useful for testing and we do not consider it the preferred way to configure the heap size.\r\n\r\nI'm glad that you were able to get to the bottom of the issue. Thank you for reporting back.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/717647499","html_url":"https://github.com/elastic/elasticsearch/issues/64237#issuecomment-717647499","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64237","id":717647499,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzY0NzQ5OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2020-10-28T02:03:16Z","updated_at":"2020-10-28T02:03:16Z","author_association":"MEMBER","body":"I opened #64256 to clarify the docs.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/717802833","html_url":"https://github.com/elastic/elasticsearch/issues/64237#issuecomment-717802833","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64237","id":717802833,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzgwMjgzMw==","user":{"login":"pa-jberanek","id":22837936,"node_id":"MDQ6VXNlcjIyODM3OTM2","avatar_url":"https://avatars3.githubusercontent.com/u/22837936?v=4","gravatar_id":"","url":"https://api.github.com/users/pa-jberanek","html_url":"https://github.com/pa-jberanek","followers_url":"https://api.github.com/users/pa-jberanek/followers","following_url":"https://api.github.com/users/pa-jberanek/following{/other_user}","gists_url":"https://api.github.com/users/pa-jberanek/gists{/gist_id}","starred_url":"https://api.github.com/users/pa-jberanek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pa-jberanek/subscriptions","organizations_url":"https://api.github.com/users/pa-jberanek/orgs","repos_url":"https://api.github.com/users/pa-jberanek/repos","events_url":"https://api.github.com/users/pa-jberanek/events{/privacy}","received_events_url":"https://api.github.com/users/pa-jberanek/received_events","type":"User","site_admin":false},"created_at":"2020-10-28T09:16:36Z","updated_at":"2020-10-28T09:16:36Z","author_association":"NONE","body":"Another doc location this is discussed?\r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/jvm-options.html","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/717910465","html_url":"https://github.com/elastic/elasticsearch/issues/64237#issuecomment-717910465","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64237","id":717910465,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzkxMDQ2NQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2020-10-28T12:48:58Z","updated_at":"2020-10-28T12:48:58Z","author_association":"MEMBER","body":"@pa-jberanek There is already a comment on that page that the preferred way of configuring JVM options is via `jvm.options.d`.","performed_via_github_app":null}]