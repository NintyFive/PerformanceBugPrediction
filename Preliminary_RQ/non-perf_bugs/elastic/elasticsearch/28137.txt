{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28137","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28137/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28137/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28137/events","html_url":"https://github.com/elastic/elasticsearch/issues/28137","id":286888318,"node_id":"MDU6SXNzdWUyODY4ODgzMTg=","number":28137,"title":"Problem with \"Elasticsearch: The Definitive Guide\" tutorial","user":{"login":"brian-vosburgh","id":4481402,"node_id":"MDQ6VXNlcjQ0ODE0MDI=","avatar_url":"https://avatars2.githubusercontent.com/u/4481402?v=4","gravatar_id":"","url":"https://api.github.com/users/brian-vosburgh","html_url":"https://github.com/brian-vosburgh","followers_url":"https://api.github.com/users/brian-vosburgh/followers","following_url":"https://api.github.com/users/brian-vosburgh/following{/other_user}","gists_url":"https://api.github.com/users/brian-vosburgh/gists{/gist_id}","starred_url":"https://api.github.com/users/brian-vosburgh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brian-vosburgh/subscriptions","organizations_url":"https://api.github.com/users/brian-vosburgh/orgs","repos_url":"https://api.github.com/users/brian-vosburgh/repos","events_url":"https://api.github.com/users/brian-vosburgh/events{/privacy}","received_events_url":"https://api.github.com/users/brian-vosburgh/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-01-08T21:08:56Z","updated_at":"2018-03-19T09:09:18Z","closed_at":"2018-01-08T21:11:40Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 6.1.1, Build: bd92e7f/2017-12-17T20:23:25.338Z, JVM: 1.8.0_151\r\n\r\n**Plugins installed**: []\r\ningest-geoip\r\ningest-user-agent\r\nx-pack\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_151\"\r\nOpenJDK Runtime Environment (build 1.8.0_151-b12)\r\nOpenJDK 64-Bit Server VM (build 25.151-b12, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux 80fde8811f4d 4.9.49-moby #1 SMP Fri Dec 8 13:40:02 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen working through the tutorial in _Elasticsearch: The Definitive Guide_, The queries do not work because the \"interests\" field is mapped as \"text\".\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Work through the tutorial in _Elasticsearch: The Definitive Guide_ up until the \"Analytics\" section (https://www.elastic.co/guide/en/elasticsearch/guide/current/_analytics.html).\r\n 2. Execute the first query (or any other query on the page):\r\n```\r\nGET /megacorp/employee/_search\r\n{\r\n  \"aggs\": {\r\n    \"all_interests\": {\r\n      \"terms\": { \"field\": \"interests\" }\r\n    }\r\n  }\r\n}\r\n```\r\n 3. Receive the following response:\r\n```\r\n{\r\n    \"error\": {\r\n        \"root_cause\": [\r\n            {\r\n                \"type\": \"illegal_argument_exception\",\r\n                \"reason\": \"Fielddata is disabled on text fields by default. Set fielddata=true on [interests] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.\"\r\n            }\r\n        ],\r\n        \"type\": \"search_phase_execution_exception\",\r\n        \"reason\": \"all shards failed\",\r\n        \"phase\": \"query\",\r\n        \"grouped\": true,\r\n        \"failed_shards\": [\r\n            {\r\n                \"shard\": 0,\r\n                \"index\": \"megacorp\",\r\n                \"node\": \"TjkX3YKgQHmMxLtenJtejw\",\r\n                \"reason\": {\r\n                    \"type\": \"illegal_argument_exception\",\r\n                    \"reason\": \"Fielddata is disabled on text fields by default. Set fielddata=true on [interests] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.\"\r\n                }\r\n            }\r\n        ]\r\n    },\r\n    \"status\": 400\r\n}\r\n```\r\n 4. The query should probably look like this (note the **`.keyword`**):\r\n```\r\n{\r\n  \"aggs\": {\r\n    \"all_interests\": {\r\n      \"terms\": { \"field\": \"interests.keyword\" }\r\n    }\r\n  }\r\n}\r\n```\r\n 5. The other queries on this page should be similarly modified.\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}