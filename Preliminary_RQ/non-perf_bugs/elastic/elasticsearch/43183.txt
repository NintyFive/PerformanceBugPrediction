{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43183","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43183/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43183/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43183/events","html_url":"https://github.com/elastic/elasticsearch/issues/43183","id":455507317,"node_id":"MDU6SXNzdWU0NTU1MDczMTc=","number":43183,"title":"Partial network partitioning leads to cluster unavailability.","user":{"login":"101alex","id":51769446,"node_id":"MDQ6VXNlcjUxNzY5NDQ2","avatar_url":"https://avatars1.githubusercontent.com/u/51769446?v=4","gravatar_id":"","url":"https://api.github.com/users/101alex","html_url":"https://github.com/101alex","followers_url":"https://api.github.com/users/101alex/followers","following_url":"https://api.github.com/users/101alex/following{/other_user}","gists_url":"https://api.github.com/users/101alex/gists{/gist_id}","starred_url":"https://api.github.com/users/101alex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/101alex/subscriptions","organizations_url":"https://api.github.com/users/101alex/orgs","repos_url":"https://api.github.com/users/101alex/repos","events_url":"https://api.github.com/users/101alex/events{/privacy}","received_events_url":"https://api.github.com/users/101alex/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"assignees":[{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-06-13T02:36:50Z","updated_at":"2019-06-14T08:52:40Z","closed_at":"2019-06-14T08:52:40Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 6.8.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 1.8.0_212\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): OS[Linux/4.4.0-145-generic/amd64]\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI have a cluster of 5 nodes (node1, node2, node3, node4, node5). Their ids are in the following order (this is critical for master election, which I believe is the core of this failure): node2 < node3 < the rest of nodes. \r\n\r\nWhen the cluster first starts, as expected, node2 is elected as a master, however, after a partial network partitioning occurs, isolating node2 from nodes 3,4, and 5, (while node 3 is able to communicate with all other nodes) the cluster is stuck in an unavailability status. In other words, no new master is elected and node2 steps down from being a master.\r\n\r\nI believe the expected behavior is to have node3 become the new master as it is connected to a majority of nodes and it has the smallest id (after node2). This does not happen, however. From examining the logs it seems that node3 keeps trying to join node2 as it thinks it should be the master while it does not accept the join requests from nodes 3, 4, and 5. \r\n \r\n\r\n**Steps to reproduce**:\r\n\r\n In my setup I have 1 index with the following settings: \r\n     * Number of shards: 1\r\n     * Number of replicas: 2\r\n     * write.wait_for_active_shards: 3\r\n\r\nI have 5 nodes, and then once a partial network partitioning occurs (as described above), the system stays unavailable (I had waited for more than 1 hour and it stayed in that status) and it does not accept index operations.\r\n\r\n\r\n*****Log files are provided for the 5 nodes.** \r\n\r\n[node1.log](https://github.com/elastic/elasticsearch/files/3283870/node1.log)\r\n[node2.log](https://github.com/elastic/elasticsearch/files/3283872/node2.log)\r\n[node3.log](https://github.com/elastic/elasticsearch/files/3283873/node3.log)\r\n[node4.log](https://github.com/elastic/elasticsearch/files/3283874/node4.log)\r\n[node5.log](https://github.com/elastic/elasticsearch/files/3283875/node5.log)\r\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}