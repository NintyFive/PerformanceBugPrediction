{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20298","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20298/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20298/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20298/events","html_url":"https://github.com/elastic/elasticsearch/issues/20298","id":174739891,"node_id":"MDU6SXNzdWUxNzQ3Mzk4OTE=","number":20298,"title":"java.lang.NullPointerException in Tribe node","user":{"login":"zcola","id":3234989,"node_id":"MDQ6VXNlcjMyMzQ5ODk=","avatar_url":"https://avatars3.githubusercontent.com/u/3234989?v=4","gravatar_id":"","url":"https://api.github.com/users/zcola","html_url":"https://github.com/zcola","followers_url":"https://api.github.com/users/zcola/followers","following_url":"https://api.github.com/users/zcola/following{/other_user}","gists_url":"https://api.github.com/users/zcola/gists{/gist_id}","starred_url":"https://api.github.com/users/zcola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zcola/subscriptions","organizations_url":"https://api.github.com/users/zcola/orgs","repos_url":"https://api.github.com/users/zcola/repos","events_url":"https://api.github.com/users/zcola/events{/privacy}","received_events_url":"https://api.github.com/users/zcola/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2016-09-02T11:36:45Z","updated_at":"2018-04-17T19:22:18Z","closed_at":"2018-04-17T19:22:17Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**:2.3.4\n\n**Plugins installed**: [ 'analysis-ik', 'kopf', '   license', 'marvel-agent' ]\n\n**JVM version**:Java HotSpot(TM) 64-Bit Server VM (build 25.66-b17, mixed mode)\n\n**OS version**:Debian 8\n\n**Description of the problem including expected versus actual behavior**:\n\n```\nelasticsearch.yml\nnetwork.host: 10.160.98.78\nnode.name: \"${HOSTNAME}_${NODE_ZONE}\"\ntribe:\n    e100:\n        cluster.name: logstash-es\n        discovery.zen.ping.timeout: 100s\n        network.host: 10.160.98.78\n        discovery.zen.ping.multicast.enabled: false\n        discovery.zen.ping.unicast.hosts: [\"10.120.69.96\", \"10.120.69.97\", ...]\n    e101:\n        cluster.name: es-new\n        discovery.zen.ping.timeout: 100s\n        network.host: 10.160.98.78\n        discovery.zen.ping.multicast.enabled: false\n        discovery.zen.ping.unicast.hosts: [ \"10.63.72.10\", \"10.63.72.11\", ...\" ]\n    e102:\n        cluster.name: es-102\n        discovery.zen.ping.timeout: 100s\n        network.host: 10.160.98.78\n        discovery.zen.ping.multicast.enabled: false\n        discovery.zen.ping.unicast.hosts: [ \"10.63.72.12\" ]\n    blocks.indices.write: e100\n    on_conflict: prefer_e100\nscript.engine.groovy.inline.search: true\nscript.engine.groovy.inline.aggs: true\npath.plugins: \"/home/elk/running/elasticsearch/plugins_tribe\"\n```\n\n**Steps to reproduce**:\n- When the timer expires night to clean index, tribe node may not work properly (We have 2 tribe node，It seems to work fine `19.36`, `98.78` error)\n\n```\ncurl 10.160.98.78:9200/_cat/indices\n{\"error\":{\"root_cause\":[{\"type\":\"null_pointer_exception\",\"reason\":null}],\"type\":\"null_pointer_exception\",\"reason\":null},\"status\":500}\n```\n\n```\ncurl http://10.63.19.36:9200/_cat/indices\ngreen open g15_zzz-2016.06.30                           1 0         3     0   6.8kb   6.8kb\ngreen open g18_tmp_nat_iptables-fileupload              1 0      1172     0   283kb   283kb\ngreen open xy2freeclient-2016.09                        1 1     70172     0  13.7mb   6.8mb\ngreen open xy2freeclient-2016.08                        1 1   1434906     0 250.1mb 125.1mb\ngreen open appdown_accesslog-2016.08                    1 1 107015373     0  34.6gb  17.3gb\n```\n- We use curator to close or delete indices\n\n```\n    def delete(self, indices):\n        \"\"\"\n        :param indices: 删除列表\n        :return:\n        \"\"\"\n        w = indices if isinstance(indices, list) else [indices]\n        return curator.delete_indices(self.client, w)\n\n    def close(self, indices):\n        \"\"\"\n\n        :param indices: 关闭列表\n        :return:\n        \"\"\"\n        w = indices if isinstance(indices, list) else [indices]\n        return curator.close_indices(self.client, w)\n```\n\n```\n2016-09-01 03:30:24,773 - __main__ - INFO - ---------------------- voicelog start ----------------------\nGET / {} None\nGET / {} None\nGET /_cat/indices/voicelog-2016.08.26 {'h': 'status', u'format': 'json'} None\nGET / {} None\nPOST /voicelog-2016.08.26/_flush/synced {} None\nPOST /voicelog-2016.08.26/_close {'ignore_unavailable': 'true'} None\n2016-09-01 03:30:26,722 - __main__ - INFO - 关闭索引:voicelog-2016.08.26 ret:True\n2016-09-01 03:30:26,722 - __main__ - INFO - 关闭5天前的index:voicelog-2016.08.26 过期天数:6\n```\n- After restart tribe node `98.78` back to normal\n\n**Provide logs (if relevant)**:\n\n```\n[2016-09-01 03:30:26,331][INFO ][tribe                    ] [elk-edata04-101_tribe] [e100] removing index [voicelog-2016.08.26]\n[2016-09-01 03:30:26,332][WARN ][tribe                    ] [elk-edata04-101_tribe] failed to process [cluster event from e100, zen-disco-receive(from master [{elk-edata05-100}{Kf1SqrhFR9ywP_fMAB_Jdw}{10.120.69.109}{10.120.69.109:9300}{master=true}])]\njava.lang.NullPointerException\n[2016-09-01 03:30:26,741][WARN ][cluster.service          ] [elk-edata04-101_tribe/e100] failed to notify ClusterStateListener\njava.lang.ClassCastException: org.elasticsearch.license.plugin.core.LicensesMetaData cannot be cast to org.elasticsearch.license.plugin.core.LicensesMetaData\n    at org.elasticsearch.license.plugin.core.LicensesService.clusterChanged(LicensesService.java:466)\n    at org.elasticsearch.cluster.service.InternalClusterService.runTasksForExecutor(InternalClusterService.java:610)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:772)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:231)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:194)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n[2016-09-01 03:30:26,748][INFO ][tribe                    ] [elk-edata04-101_tribe] [e100] removing index [voicelog-2016.08.26]\n[2016-09-01 03:30:26,748][WARN ][tribe                    ] [elk-edata04-101_tribe] failed to process [cluster event from e100, zen-disco-receive(from master [{elk-edata05-100}{Kf1SqrhFR9ywP_fMAB_Jdw}{10.120.69.109}{10.120.69.109:9300}{master=true}])]\njava.lang.NullPointerException\n[2016-09-01 03:30:31,685][WARN ][cluster.service          ] [elk-edata04-101_tribe/e100] failed to notify ClusterStateListener\njava.lang.ClassCastException: org.elasticsearch.license.plugin.core.LicensesMetaData cannot be cast to org.elasticsearch.license.plugin.core.LicensesMetaData\n    at org.elasticsearch.license.plugin.core.LicensesService.clusterChanged(LicensesService.java:466)\n    at org.elasticsearch.cluster.service.InternalClusterService.runTasksForExecutor(InternalClusterService.java:610)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:772)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:231)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:194)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n[2016-09-02 18:28:18,359][WARN ][rest.suppressed          ] path: /_cat/indices, params: {}\njava.lang.NullPointerException\n    at org.elasticsearch.rest.action.cat.RestIndicesAction.buildTable(RestIndicesAction.java:345)\n    at org.elasticsearch.rest.action.cat.RestIndicesAction.access$100(RestIndicesAction.java:52)\n    at org.elasticsearch.rest.action.cat.RestIndicesAction$1$1$1.buildResponse(RestIndicesAction.java:111)\n    at org.elasticsearch.rest.action.cat.RestIndicesAction$1$1$1.buildResponse(RestIndicesAction.java:108)\n    at org.elasticsearch.rest.action.support.RestResponseListener.processResponse(RestResponseListener.java:43)\n    at org.elasticsearch.rest.action.support.RestActionListener.onResponse(RestActionListener.java:49)\n    at org.elasticsearch.action.support.ThreadedActionListener$1.doRun(ThreadedActionListener.java:89)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n```\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}