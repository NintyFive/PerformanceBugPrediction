{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26915","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26915/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26915/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26915/events","html_url":"https://github.com/elastic/elasticsearch/issues/26915","id":263490508,"node_id":"MDU6SXNzdWUyNjM0OTA1MDg=","number":26915,"title":"How to expose the new Lucene CoveringQuery in the query dsl?","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":12,"created_at":"2017-10-06T15:46:30Z","updated_at":"2018-02-14T13:28:34Z","closed_at":"2017-11-01T09:56:18Z","author_association":"MEMBER","active_lock_reason":null,"body":"Lucene 7.1 comes with a new query, called the [CoveringQuery](https://issues.apache.org/jira/browse/LUCENE-7621). This is neat query that is like a bool query with should clauses but instead of global minimum should match for all documents it allows a minimum should match per document. I wonder how this new query can best be exposed in the ES query dsl?\r\n\r\nIt can be exposed in the `bool` query itself (via a `minimum_should_match` field or something like that), but that can be confusing as `CoveringQuery` Lucene query doesn't understand must, filter or must_not clauses and then we run into difficult to explain search results. At this moment I lean towards exposing this a separate query in the query dsl. I'm just not sure what the best name should be for this query, but I think the structure should look something like this:\r\n\r\n```\r\n{\r\n   \"covering\" : {\r\n     \"minimum_should_match_field\": \"my_field\",\r\n     \"queries\": [\r\n        {\r\n          # query1\r\n        },\r\n        {\r\n          # query2\r\n        },\r\n       # etc\r\n     ]\r\n   }\r\n}\r\n```\r\n\r\nThe field specified in the `minimum_should_match_field` must be a number field with doc values not turned off. There is no need to worry about negative values, because the `CoveringQuery` treats a minimum should match of 0 and lower as 1.\r\n\r\nI think that the `match` query should also get a new `type` named `covering` (or another name) and a `minimum_should_match_field` option that then under the hood uses the `CoveringQuery` instead of `BooleanQuery` or `PhraseQuery`.","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}