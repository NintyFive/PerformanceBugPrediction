{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42846","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42846/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42846/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42846/events","html_url":"https://github.com/elastic/elasticsearch/issues/42846","id":451977175,"node_id":"MDU6SXNzdWU0NTE5NzcxNzU=","number":42846,"title":"CreateIndexRequest with waitForActiveShards(ActiveShardCount.ALL) times out","user":{"login":"nov1n","id":4356790,"node_id":"MDQ6VXNlcjQzNTY3OTA=","avatar_url":"https://avatars0.githubusercontent.com/u/4356790?v=4","gravatar_id":"","url":"https://api.github.com/users/nov1n","html_url":"https://github.com/nov1n","followers_url":"https://api.github.com/users/nov1n/followers","following_url":"https://api.github.com/users/nov1n/following{/other_user}","gists_url":"https://api.github.com/users/nov1n/gists{/gist_id}","starred_url":"https://api.github.com/users/nov1n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nov1n/subscriptions","organizations_url":"https://api.github.com/users/nov1n/orgs","repos_url":"https://api.github.com/users/nov1n/repos","events_url":"https://api.github.com/users/nov1n/events{/privacy}","received_events_url":"https://api.github.com/users/nov1n/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-06-04T12:49:33Z","updated_at":"2019-06-04T17:33:05Z","closed_at":"2019-06-04T17:33:05Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.1.1.\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): openjdk version \"11.0.1\" 2018-10-16\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): 18.2.0 Darwin Kernel Version 18.2.0: Thu Dec 20 20:46:53 PST 2018; root:xnu-4903.241.1~1/RELEASE_X86_64 x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nThe create index request with `waitForActiveShards(ActiveShardCount.ALL)` times out with exception: `Exception in thread \"main\" java.net.SocketTimeoutException: 30,000 milliseconds timeout on connection http-outgoing-0 [ACTIVE]`.\r\n\r\nSetting wait `waitForActiveShards` to `ActiveShardCount.DEFAULT`, or 1 works.\r\n\r\n**Steps to reproduce**:\r\n\r\nStep 1:\r\n`docker run -p 9200:9200 -e \"discovery.type=single-node\" docker.elastic.co/elasticsearch/elasticsearch:7.1.0`\r\n\r\nStep 2:\r\n```\r\npackage com.mycompany.app;\r\n\r\nimport java.io.IOException;\r\nimport java.util.UUID;\r\nimport org.apache.http.HttpHost;\r\nimport org.elasticsearch.action.support.ActiveShardCount;\r\nimport org.elasticsearch.client.RequestOptions;\r\nimport org.elasticsearch.client.RestClient;\r\nimport org.elasticsearch.client.RestHighLevelClient;\r\nimport org.elasticsearch.client.indices.CreateIndexRequest;\r\nimport org.elasticsearch.client.indices.CreateIndexResponse;\r\nimport org.elasticsearch.common.xcontent.XContentType;\r\n\r\npublic class Repro {\r\n  private static RestHighLevelClient client;\r\n\r\n  public static void main(String[] args) throws IOException {\r\n    String index = \"{\\\"settings\\\":{\\\"number_of_shards\\\" : 1, \\\"number_of_replicas\\\": 1}}\";\r\n    HttpHost elasticsearchHost = new HttpHost(\"localhost\", 9200);\r\n    client = new RestHighLevelClient(RestClient.builder(new HttpHost(elasticsearchHost)));\r\n\r\n    CreateIndexResponse response =\r\n        client\r\n            .indices()\r\n            .create(new CreateIndexRequest(UUID.randomUUID().toString())\r\n                    .waitForActiveShards(ActiveShardCount.ALL)\r\n                    .source(index, XContentType.JSON),\r\n                RequestOptions.DEFAULT);\r\n  }\r\n}\r\n```\r\n\r\nStep 3: Wait 30 seconds for it to time out.\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n{\"type\": \"server\", \"timestamp\": \"2019-06-04T12:42:28,382+0000\", \"level\": \"INFO\", \"component\": \"o.e.c.m.MetaDataCreateIndexService\", \"cluster.name\": \"docker-cluster\", \"node.name\": \"94911a5e9a71\", \"cluster.uuid\": \"CCOmnb5lSdOW3ZndJtkL1w\", \"node.id\": \"Q4I86GN9RyS405upH84n5w\",  \"message\": \"[a5d1c328-83fc-44d6-abf2-1cbb1969eb2c] creating index, cause [api], templates [], shards [1]/[1], mappings []\"  }\r\n```\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}