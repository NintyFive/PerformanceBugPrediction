[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383053086","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383053086","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383053086,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzA1MzA4Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-20T10:18:44Z","updated_at":"2018-04-20T10:18:44Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383053835","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383053835","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383053835,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzA1MzgzNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-04-20T10:22:02Z","updated_at":"2018-04-20T10:22:02Z","author_association":"MEMBER","body":"It could also be nice to have this information per query. So instead of setting `matches:true` to the main search request we could allow this option to be set per query builder like we do for `named` queries ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383063070","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383063070","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383063070,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzA2MzA3MA==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2018-04-20T11:05:52Z","updated_at":"2018-04-20T11:05:52Z","author_association":"CONTRIBUTOR","body":"We could extend the named query functionality to allow you to get the Matches, score and Explanation for each named query.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383064206","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383064206","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383064206,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzA2NDIwNg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-04-20T11:11:51Z","updated_at":"2018-04-20T11:11:51Z","author_association":"CONTRIBUTOR","body":">  to get the Matches, score and Explanation for each named query\r\n\r\nThis would align with #29606.\r\n\r\n> We need to make it clear that the offsets are using UTF-16 encoding. If offsets are not stored in the index, they will need to be derived by re-analyzing the source somehow (either using a MemoryIndex or just extracting offsets from a TokenStream), and limits will need to be put on this, similar to the limits on highlighting. This process may be expensive, so it should also be possible to return only the positions.\r\n\r\nI'm afraid that returning UTF16 offsets is going to make the API super hard to use to everyone but Java clients? Maybe the encoding should be a (required?) parameter of the API? This would make the API slower for sure, but much easier to use.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383098822","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383098822","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383098822,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzA5ODgyMg==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-04-20T13:38:53Z","updated_at":"2018-04-20T13:38:53Z","author_association":"CONTRIBUTOR","body":"> I'm afraid that returning UTF16 offsets is going to make the API super hard to use to everyone but Java clients?\r\n\r\nI suspect that whatever offsets are returned will break some clients in some more-or-less subtle ways. It's reasonable to expect offsets to be used in expressions like `s.substring(startIndex,endIndex)` and the meaning of the numbers in this kind of expression are very language-dependent.\r\n\r\nUTF16 offsets are equivalent to offsets in byte-based strings using ASCII (also ISO-8859-1) encoding, and as offsets into codepoint-based strings that do not contain surrogates. The fact that these numbers _almost_ coincide is the source of much trappiness. I don't know whether UTF16 offsets are likely to be more widely useful than the other possibilities, but I think they work well for C++ and possibly Python too (but badly for Haskell FWIW).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383137863","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383137863","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383137863,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzEzNzg2Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2018-04-20T15:44:37Z","updated_at":"2018-04-20T15:44:37Z","author_association":"CONTRIBUTOR","body":"I can't speak for other languages, but eg in Perl, I'd get back the JSON and the characters would be decoded from UTF8, so my `substr` function would work on characters, not on raw UTF8 bytes.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383141063","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383141063","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383141063,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzE0MTA2Mw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-04-20T15:55:48Z","updated_at":"2018-04-20T15:56:00Z","author_association":"CONTRIBUTOR","body":"@clintongormley Actually it seems like to work on UTF8 bytes? `perl -e \"print substr(\\\"àbcd\\\", 2, 1)\"` -> \"b\", `perl -e \"print substr(\\\"abcd\\\", 2, 1)\"` -> \"c\".","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383152481","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383152481","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383152481,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzE1MjQ4MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2018-04-20T16:35:27Z","updated_at":"2018-04-20T16:35:27Z","author_association":"CONTRIBUTOR","body":"@jpountz that's because the UTF8 bytes haven't been decoded into characters in that example - they're just raw bytes.\r\n\r\nThis example handles the encoding and decoding correctly:\r\n```\r\nperl -C -e \"use utf8; print substr(\\\"àbcd\\\", 2 1)\"\r\n```\r\n\r\nDecoding JSON would automatically convert the raw UTF8 bytes into characters.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383521966","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-383521966","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":383521966,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzUyMTk2Ng==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-04-23T10:01:07Z","updated_at":"2018-04-23T10:01:07Z","author_association":"CONTRIBUTOR","body":"I did a bit more digging with @bleskes: Perl, Python and Ruby seem to make it easy to work with unicode code points. Go, Java, C# and C++ are not so easy since you need to explicitly convert back and forth between unicode code offsets and byte/character offsets: you can't use substring utility methods directly.\r\n\r\nI think it means we have the following options which both have pros/cons:\r\n 1. always return Unicode code point offsets (UTF32 offsets)\r\n   - nicer API\r\n   - easy to use with Perl, Python, Ruby, less with Go, Java, C# and C++\r\n   - potentially still trappy if the user doesn't use the right string abstraction, eg. Python 2 users need to make sure they use a unicode string, not a regular string\r\n 2. make the encoding a required option of the API\r\n   - less nice but forces the uses to reason about encodings\r\n   - easier to work with Go, Java and C# by requesting offsets that can directly be used with their substring utility methods, eg. offsets into the UTF16 representation of the string for Java/C# and offsets into the UTF8 representation of the string for Go\r\n 3. make the API return extracted matches and context in a way that would make it easy to build snippets in a search results UI, but no offsets\r\n   - less flexible but no potential to use the offsets wrong\r\n\r\nAnother source of traps is that some language APIs iterate graphemes (eg. C#'s 'TextElement') rather than code points, which would merge combined sequences into a single item. This would be trappy for the same reason that @DaveCTurner mentioned above that it would almost always coincide.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414678171","html_url":"https://github.com/elastic/elasticsearch/issues/29631#issuecomment-414678171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","id":414678171,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDY3ODE3MQ==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2018-08-21T13:42:24Z","updated_at":"2018-08-21T13:42:24Z","author_association":"CONTRIBUTOR","body":"Rather than implementing this as a REST API, we'll look into exposing it via highlighter plugins, so that encoding issues won't be a problem.","performed_via_github_app":null}]