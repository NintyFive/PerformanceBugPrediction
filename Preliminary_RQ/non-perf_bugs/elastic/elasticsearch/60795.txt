{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/60795","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60795/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60795/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60795/events","html_url":"https://github.com/elastic/elasticsearch/issues/60795","id":673874932,"node_id":"MDU6SXNzdWU2NzM4NzQ5MzI=","number":60795,"title":"EQL: Regex inconsistencies in match function","user":{"login":"rw-access","id":31489089,"node_id":"MDQ6VXNlcjMxNDg5MDg5","avatar_url":"https://avatars1.githubusercontent.com/u/31489089?v=4","gravatar_id":"","url":"https://api.github.com/users/rw-access","html_url":"https://github.com/rw-access","followers_url":"https://api.github.com/users/rw-access/followers","following_url":"https://api.github.com/users/rw-access/following{/other_user}","gists_url":"https://api.github.com/users/rw-access/gists{/gist_id}","starred_url":"https://api.github.com/users/rw-access/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rw-access/subscriptions","organizations_url":"https://api.github.com/users/rw-access/orgs","repos_url":"https://api.github.com/users/rw-access/repos","events_url":"https://api.github.com/users/rw-access/events{/privacy}","received_events_url":"https://api.github.com/users/rw-access/received_events","type":"User","site_admin":false},"labels":[{"id":1690690117,"node_id":"MDU6TGFiZWwxNjkwNjkwMTE3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/EQL","name":":Query Languages/EQL","color":"0e8a16","default":false,"description":"EQL querying"},{"id":1967501040,"node_id":"MDU6TGFiZWwxOTY3NTAxMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:QL","name":"Team:QL","color":"fef2c0","default":false,"description":"Meta label for query languages team"}],"state":"closed","locked":false,"assignee":{"login":"rw-access","id":31489089,"node_id":"MDQ6VXNlcjMxNDg5MDg5","avatar_url":"https://avatars1.githubusercontent.com/u/31489089?v=4","gravatar_id":"","url":"https://api.github.com/users/rw-access","html_url":"https://github.com/rw-access","followers_url":"https://api.github.com/users/rw-access/followers","following_url":"https://api.github.com/users/rw-access/following{/other_user}","gists_url":"https://api.github.com/users/rw-access/gists{/gist_id}","starred_url":"https://api.github.com/users/rw-access/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rw-access/subscriptions","organizations_url":"https://api.github.com/users/rw-access/orgs","repos_url":"https://api.github.com/users/rw-access/repos","events_url":"https://api.github.com/users/rw-access/events{/privacy}","received_events_url":"https://api.github.com/users/rw-access/received_events","type":"User","site_admin":false},"assignees":[{"login":"rw-access","id":31489089,"node_id":"MDQ6VXNlcjMxNDg5MDg5","avatar_url":"https://avatars1.githubusercontent.com/u/31489089?v=4","gravatar_id":"","url":"https://api.github.com/users/rw-access","html_url":"https://github.com/rw-access","followers_url":"https://api.github.com/users/rw-access/followers","following_url":"https://api.github.com/users/rw-access/following{/other_user}","gists_url":"https://api.github.com/users/rw-access/gists{/gist_id}","starred_url":"https://api.github.com/users/rw-access/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rw-access/subscriptions","organizations_url":"https://api.github.com/users/rw-access/orgs","repos_url":"https://api.github.com/users/rw-access/repos","events_url":"https://api.github.com/users/rw-access/events{/privacy}","received_events_url":"https://api.github.com/users/rw-access/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-08-05T22:01:50Z","updated_at":"2020-08-20T14:46:45Z","closed_at":"2020-08-20T14:46:45Z","author_association":"MEMBER","active_lock_reason":null,"body":"EQL/QL is inconsistent with lucene for handling regular expressions. EQL came from a Python background, so had a PCRE-bent, but had some limited functionality at first. For a while implementation didn't support groups, but only character classes, metacharacters, and repeats `*`, `+`, `{a,b}`.\r\n\r\nI noticed this when testing this string: `\"\\\"?-p\\\"?[A-za-z0-9]+\\\"?.*?\"`.\r\nThis was the generated regexp. I noticed that this query returns `\"failed to create query: expected '\\\"' at position 23\"` \r\n```json\r\n{\"regexp\": {\"process.args\": \"\\\"?-p\\\"?[A-za-z0-9]+\\\"?.*?\"}}\r\n```\r\n\r\nBut this worked fine when I escaped every quote character:\r\n```json\r\n{\"regexp\": {\"process.args\": \"\\\\\\\"?-p\\\\\\\"?[A-za-z0-9]+\\\\\\\"?.*?\"}}\r\n```\r\n\r\nThe problem here is because `\"` are reserved characters.\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/master/regexp-syntax.html#regexp-reserved-characters\r\n\r\nWe need to decide how we will handle regex for EQL, and we need to make sure that the new Endpoint will support the same behavior. The best way to guarantee consistent results between Python, Endpoint and Lucene is if you only use the functionality that is shared by both, and that all special characters in either are escaped.","closed_by":{"login":"rw-access","id":31489089,"node_id":"MDQ6VXNlcjMxNDg5MDg5","avatar_url":"https://avatars1.githubusercontent.com/u/31489089?v=4","gravatar_id":"","url":"https://api.github.com/users/rw-access","html_url":"https://github.com/rw-access","followers_url":"https://api.github.com/users/rw-access/followers","following_url":"https://api.github.com/users/rw-access/following{/other_user}","gists_url":"https://api.github.com/users/rw-access/gists{/gist_id}","starred_url":"https://api.github.com/users/rw-access/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rw-access/subscriptions","organizations_url":"https://api.github.com/users/rw-access/orgs","repos_url":"https://api.github.com/users/rw-access/repos","events_url":"https://api.github.com/users/rw-access/events{/privacy}","received_events_url":"https://api.github.com/users/rw-access/received_events","type":"User","site_admin":false},"performed_via_github_app":null}