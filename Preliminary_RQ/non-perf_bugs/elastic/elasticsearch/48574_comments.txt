[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547145863","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547145863","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547145863,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE0NTg2Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:06:11Z","updated_at":"2019-10-28T21:06:11Z","author_association":"MEMBER","body":"Why do you think that these settings are deprecated? It's also not clear to me why you think that setting the heap size disables container support. I see the contrary:\r\n\r\nJDK 13:\r\n\r\n```\r\n16:59:42 [jason@totoro:~] $ /opt/java/jdk-13/bin/java -Xms2g -Xmx2g -XX:+PrintFlagsFinal -version | grep -i container\r\n     bool PreferContainerQuotaForCPUCount          = true                                      {product} {default}\r\n     bool UseContainerSupport                      = true                                      {product} {default}\r\nopenjdk version \"13.0.1\" 2019-10-15\r\nOpenJDK Runtime Environment (build 13.0.1+9)\r\nOpenJDK 64-Bit Server VM (build 13.0.1+9, mixed mode, sharing)\r\n```\r\n\r\nJDK 14:\r\n\r\n```\r\n17:01:43 [jason@totoro:~] $ /opt/java/jdk-14/bin/java -Xms2g -Xmx2g -XX:+PrintFlagsFinal -version | grep -i container\r\n     bool PreferContainerQuotaForCPUCount          = true                                      {product} {default}\r\n     bool UseContainerSupport                      = true                                      {product} {default}\r\nopenjdk version \"14-ea\" 2020-03-17\r\nOpenJDK Runtime Environment (build 14-ea+20-879)\r\nOpenJDK 64-Bit Server VM (build 14-ea+20-879, mixed mode, sharing)\r\n17:01:57 [jason@totoro:~] $ \r\n```\r\n\r\nWe do expect our users that are not running in Docker containers or don't want to rely on container support to explicitly set the heap setting. The defaults that we ship with are intended for a good out -of-box experience, but not for any production use-cases. For Docker, we expect most users to mount over a jvm.options file and configure the heap size although we understand that some instead configure memory limits. The difficulty that we have with memory limits is that it's too indirect, the JVM needs memory beyond the heap size for its own uses, so it would be sharing that memory limit with the indirectly configured heap.\r\n\r\nI'd like to better understand the difficulty that you're experiencing with this though, can you explain, especially in light of what appears to me that heap size is not deprecated, and setting it doesn't disable container support.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547154382","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547154382","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547154382,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE1NDM4Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:29:34Z","updated_at":"2019-10-28T21:29:34Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Packaging)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547154469","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547154469","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547154469,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE1NDQ2OQ==","user":{"login":"dennybaa","id":891419,"node_id":"MDQ6VXNlcjg5MTQxOQ==","avatar_url":"https://avatars1.githubusercontent.com/u/891419?v=4","gravatar_id":"","url":"https://api.github.com/users/dennybaa","html_url":"https://github.com/dennybaa","followers_url":"https://api.github.com/users/dennybaa/followers","following_url":"https://api.github.com/users/dennybaa/following{/other_user}","gists_url":"https://api.github.com/users/dennybaa/gists{/gist_id}","starred_url":"https://api.github.com/users/dennybaa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dennybaa/subscriptions","organizations_url":"https://api.github.com/users/dennybaa/orgs","repos_url":"https://api.github.com/users/dennybaa/repos","events_url":"https://api.github.com/users/dennybaa/events{/privacy}","received_events_url":"https://api.github.com/users/dennybaa/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:29:50Z","updated_at":"2019-10-28T21:32:01Z","author_association":"NONE","body":"Hi @jasontedor,\r\n\r\nWell they are indeed not really deprecated, but on containerized environments are not required since UseContainerSupport is enabled by default  (https://bugs.openjdk.java.net/browse/JDK-8196595). The fact is that **these options override heap size auto-configuration** based on cgroup limits. Surely JVM needs memory beyond its heap size, which is successfully treated with `-XX:MaxRAMPercentage` (by default 25%). So basically on a containerized environment (especially when cgroup limits are controlled), these two parameters are sufficient to control heap properly and moreover they have a default value. So there's no need to control heap by setting xmx, xms, maxram etc - it just works.\r\n\r\nI could not agree more with all the points you gave above.\r\n\r\n> For Docker, we expect most users to mount over a jvm.options ...\r\n\r\nYes, right, but it would be nice to have the jvm.options configurable in the container, for example mountable, use defaults or nothing at all. I've been desperately trying to find elasticsearch oss docker container images sources, but I haven't succeed. This issue exactly relates to elasticsearch oss docker container image and I would like to rise this issue there. Since I haven't found anything I popped in here (\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547156652","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547156652","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547156652,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE1NjY1Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:36:03Z","updated_at":"2019-10-28T21:36:03Z","author_association":"MEMBER","body":"Thanks for the quick response and feedback @dennybaa.\r\n\r\nFor clarity, this is the right repository for the official Elasticsearch Docker images, the build is contained (pun!) in this repository.\r\n\r\n> Yes, right, but it would be nice to have the jvm.options configurable in the container, for example mountable, use defaults or nothing at all.\r\n\r\nGiven this, I still think that we are making the right tradeoffs. One aspect that we try to maintain is that our users have the same default experience no matter how they deploy Elasticsearch, whether it be via an RPM package, or our Docker images. Otherwise, users have the option to mount over a JVM options file, and if you so desire, remove the heap setting to base it on the memory limits of the container.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547157886","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547157886","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547157886,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE1Nzg4Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:40:04Z","updated_at":"2019-10-28T21:41:20Z","author_association":"MEMBER","body":"Relates #42660. Note that point 2. there is no longer valid since #41962.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547159086","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547159086","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547159086,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE1OTA4Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:43:57Z","updated_at":"2019-10-28T21:43:57Z","author_association":"MEMBER","body":"Relates #42754, where our docs continue to recommend that you set the heap size, even if you've set a memory limit. We understand the appeal of `-XX:+UseContainerSupport` but we don't think it gives the right control over the heap size and direct memory size.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547159186","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547159186","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547159186,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE1OTE4Ng==","user":{"login":"dennybaa","id":891419,"node_id":"MDQ6VXNlcjg5MTQxOQ==","avatar_url":"https://avatars1.githubusercontent.com/u/891419?v=4","gravatar_id":"","url":"https://api.github.com/users/dennybaa","html_url":"https://github.com/dennybaa","followers_url":"https://api.github.com/users/dennybaa/followers","following_url":"https://api.github.com/users/dennybaa/following{/other_user}","gists_url":"https://api.github.com/users/dennybaa/gists{/gist_id}","starred_url":"https://api.github.com/users/dennybaa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dennybaa/subscriptions","organizations_url":"https://api.github.com/users/dennybaa/orgs","repos_url":"https://api.github.com/users/dennybaa/repos","events_url":"https://api.github.com/users/dennybaa/events{/privacy}","received_events_url":"https://api.github.com/users/dennybaa/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:44:15Z","updated_at":"2019-10-28T21:44:45Z","author_association":"NONE","body":"> One aspect that we try to maintain is that our users have the same default experience no matter how they deploy Elasticsearch, our users have the same default experience no matter how they deploy Elasticsearch\r\n\r\nYup, right but this not configurable yet in the container, but it should be. JVM is shipped with the container as well as jvm.options file and currently forces the container to pick up these defaults.\r\n\r\n@jasontedor  So you say #41962, that if we mount an empty jvm.options file, parsing won't fail and no defaults will be substituted, right?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547161776","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547161776","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547161776,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE2MTc3Ng==","user":{"login":"dennybaa","id":891419,"node_id":"MDQ6VXNlcjg5MTQxOQ==","avatar_url":"https://avatars1.githubusercontent.com/u/891419?v=4","gravatar_id":"","url":"https://api.github.com/users/dennybaa","html_url":"https://github.com/dennybaa","followers_url":"https://api.github.com/users/dennybaa/followers","following_url":"https://api.github.com/users/dennybaa/following{/other_user}","gists_url":"https://api.github.com/users/dennybaa/gists{/gist_id}","starred_url":"https://api.github.com/users/dennybaa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dennybaa/subscriptions","organizations_url":"https://api.github.com/users/dennybaa/orgs","repos_url":"https://api.github.com/users/dennybaa/repos","events_url":"https://api.github.com/users/dennybaa/events{/privacy}","received_events_url":"https://api.github.com/users/dennybaa/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:52:48Z","updated_at":"2019-10-28T21:53:27Z","author_association":"NONE","body":"Well you might think to make it configurable and not rely on https://github.com/elastic/elasticsearch/pull/42006, but rely on it if xmx xmx are set, otherwise rely on that what the newer features provide), IMO","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547163203","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547163203","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547163203,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE2MzIwMw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T21:57:37Z","updated_at":"2019-10-28T21:57:37Z","author_association":"MEMBER","body":"> JVM is shipped with the container as well as jvm.options file and currently forces the container to pick up these defaults.\r\n\r\nRight, but this is deliberate as I mentioned so that users have the same out-of-box experience no matter which distribution they use.\r\n\r\n> So you say #41962, that if we mount an empty jvm.options file, parsing won't fail and no defaults will be substituted, right?\r\n\r\nParsing won't fail, but you can't use an empty JVM options file currently, as there are important settings that we set on behalf or users that are needed for Elasticsearch to run properly. If those settings aren't there, Elasticsearch won't run properly. Note that we are in the process of moving many of these into internal configuration (#48252), but that's not how it is today.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547165959","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547165959","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547165959,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE2NTk1OQ==","user":{"login":"dennybaa","id":891419,"node_id":"MDQ6VXNlcjg5MTQxOQ==","avatar_url":"https://avatars1.githubusercontent.com/u/891419?v=4","gravatar_id":"","url":"https://api.github.com/users/dennybaa","html_url":"https://github.com/dennybaa","followers_url":"https://api.github.com/users/dennybaa/followers","following_url":"https://api.github.com/users/dennybaa/following{/other_user}","gists_url":"https://api.github.com/users/dennybaa/gists{/gist_id}","starred_url":"https://api.github.com/users/dennybaa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dennybaa/subscriptions","organizations_url":"https://api.github.com/users/dennybaa/orgs","repos_url":"https://api.github.com/users/dennybaa/repos","events_url":"https://api.github.com/users/dennybaa/events{/privacy}","received_events_url":"https://api.github.com/users/dennybaa/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T22:06:08Z","updated_at":"2019-10-28T22:06:48Z","author_association":"NONE","body":"> Note that we are in the process of moving many of these into internal configuration (#48252), but that's not how it is today.\r\n\r\nSounds good, once it happens I believe that what I'm talking about can be made configurable. I.e. by default can behave like xmx, xms are defaulted, but can be switched off to trigger the new possibility of heap \"auto configuration\". Well, thank you, ES is truly a great project :+1: \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547175508","html_url":"https://github.com/elastic/elasticsearch/issues/48574#issuecomment-547175508","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48574","id":547175508,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE3NTUwOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-10-28T22:37:15Z","updated_at":"2019-10-28T22:37:15Z","author_association":"MEMBER","body":"Thank you for the kind words. Given the discussion here, I am going to close the issue. Let me know if thatâ€™s an error.","performed_via_github_app":null}]