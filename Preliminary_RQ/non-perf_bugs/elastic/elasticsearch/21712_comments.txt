[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263269858","html_url":"https://github.com/elastic/elasticsearch/issues/21712#issuecomment-263269858","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21712","id":263269858,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzI2OTg1OA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T13:22:54Z","updated_at":"2016-11-28T13:23:15Z","author_association":"MEMBER","body":"Discussed in FixItFriday, `cross_fields` based on whitespace split is not going to work in a lot of use cases so the ultimate solution would be to treat `cross_fields` like the `multi_match` does. It means that `cross_fields` should only be executed on fields that share the same analyzer. Now that `split_on_whitespace` is integrated in the `query_string` it should be feasible to reconcile `multi_match` and `query_string`. With this approach the example shown above would create a query like the following:\r\n```\r\n  \"explanation\": \"+(+text:the +text:doors) | +(+text_stop:doors)\"\r\n```\r\nwhich does not perform `cross_fields` since the two fields do not share the same analyzer.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278311947","html_url":"https://github.com/elastic/elasticsearch/issues/21712#issuecomment-278311947","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21712","id":278311947,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODMxMTk0Nw==","user":{"login":"guilhermemaranhao","id":5608250,"node_id":"MDQ6VXNlcjU2MDgyNTA=","avatar_url":"https://avatars1.githubusercontent.com/u/5608250?v=4","gravatar_id":"","url":"https://api.github.com/users/guilhermemaranhao","html_url":"https://github.com/guilhermemaranhao","followers_url":"https://api.github.com/users/guilhermemaranhao/followers","following_url":"https://api.github.com/users/guilhermemaranhao/following{/other_user}","gists_url":"https://api.github.com/users/guilhermemaranhao/gists{/gist_id}","starred_url":"https://api.github.com/users/guilhermemaranhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guilhermemaranhao/subscriptions","organizations_url":"https://api.github.com/users/guilhermemaranhao/orgs","repos_url":"https://api.github.com/users/guilhermemaranhao/repos","events_url":"https://api.github.com/users/guilhermemaranhao/events{/privacy}","received_events_url":"https://api.github.com/users/guilhermemaranhao/received_events","type":"User","site_admin":false},"created_at":"2017-02-08T12:11:19Z","updated_at":"2017-02-08T12:11:19Z","author_association":"NONE","body":"Hello @jimczi , \r\n\r\nI'm facing a simpler issue related to query_string and stopwords and I'm suppose it has to do with 5.x version. In 2.4 version, I used query_string with default_operator: 'AND' and the analyzer: 'brazilian_stop_word' both set on it. And it worked perfectly: When one searched for some term containing a \"stopword\", the query_string ignored it and everything went fine.\r\nNow, in 5.x, the same search seems not ignoring the \"stopword\" and so nothing is returned. As the searched field was indexed with the stopword analyzer, the stopword isn't indexed.\r\nDoes anybody know if there was a change in 5.x query_string related to stopword analysis? I didn't find anything in the breaking changes.\r\n\r\nThanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278319232","html_url":"https://github.com/elastic/elasticsearch/issues/21712#issuecomment-278319232","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21712","id":278319232,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODMxOTIzMg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-02-08T12:43:46Z","updated_at":"2017-02-08T12:43:46Z","author_association":"MEMBER","body":"@guilhermemaranhao can you provide a simple recreation that exhibits the problem. I tried the following and it works fine:\r\n\r\n`````\r\nPUT t \r\n{\r\n   \"mappings\": {\r\n      \"page\": {\r\n         \"properties\": {\r\n            \"text\": {\r\n               \"type\": \"text\",\r\n               \"search_analyzer\": \"brazilian\",\r\n               \"analyzer\": \"brazilian\"\r\n            }\r\n         }\r\n      }\r\n   },\r\n   \"settings\": {\r\n      \"analysis\": {\r\n         \"filter\": {\r\n            \"brazilian_stop\": {\r\n               \"type\": \"stop\",\r\n               \"stopwords\": \"_brazilian_\"\r\n            }\r\n         },\r\n         \"analyzer\": {\r\n            \"brazilian\": {\r\n               \"tokenizer\": \"standard\",\r\n               \"filter\": [\r\n                  \"lowercase\",\r\n                  \"brazilian_stop\"\r\n               ]\r\n            }\r\n         }\r\n      }\r\n   }\r\n}\r\n\r\nGET t/_validate/query?explain\r\n{\r\n    \"query\": {\r\n        \"query_string\": {\r\n           \"query\": \"tudo está bem\",\r\n           \"default_field\": \"text\",\r\n           \"default_operator\": \"AND\",\r\n           \"analyzer\": \"brazilian\"\r\n        }\r\n    }\r\n}\r\n\r\nGET t/_validate/query?explain\r\n{\r\n    \"query\": {\r\n        \"query_string\": {\r\n           \"query\": \"tudo está bem\",\r\n           \"default_field\": \"text\",\r\n           \"default_operator\": \"AND\"\r\n        }\r\n    }\r\n}\r\n\r\n{\r\n   \"valid\": true,\r\n   \"_shards\": {\r\n      \"total\": 1,\r\n      \"successful\": 1,\r\n      \"failed\": 0\r\n   },\r\n   \"explanations\": [\r\n      {\r\n         \"index\": \"t\",\r\n         \"valid\": true,\r\n         \"explanation\": \"+text:está +text:bem\"\r\n      }\r\n   ]\r\n}\r\n`````","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278348283","html_url":"https://github.com/elastic/elasticsearch/issues/21712#issuecomment-278348283","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21712","id":278348283,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODM0ODI4Mw==","user":{"login":"guilhermemaranhao","id":5608250,"node_id":"MDQ6VXNlcjU2MDgyNTA=","avatar_url":"https://avatars1.githubusercontent.com/u/5608250?v=4","gravatar_id":"","url":"https://api.github.com/users/guilhermemaranhao","html_url":"https://github.com/guilhermemaranhao","followers_url":"https://api.github.com/users/guilhermemaranhao/followers","following_url":"https://api.github.com/users/guilhermemaranhao/following{/other_user}","gists_url":"https://api.github.com/users/guilhermemaranhao/gists{/gist_id}","starred_url":"https://api.github.com/users/guilhermemaranhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guilhermemaranhao/subscriptions","organizations_url":"https://api.github.com/users/guilhermemaranhao/orgs","repos_url":"https://api.github.com/users/guilhermemaranhao/repos","events_url":"https://api.github.com/users/guilhermemaranhao/events{/privacy}","received_events_url":"https://api.github.com/users/guilhermemaranhao/received_events","type":"User","site_admin":false},"created_at":"2017-02-08T14:47:40Z","updated_at":"2017-02-08T14:47:40Z","author_association":"NONE","body":"Thank you so much @jimczi ! \r\n\r\nI've just realized that I'm using some fields in the query_string that aren't analyzed with the brazilian_stop_word_analyzer. In the previous 2.4 version, all the fields were analyzed by this brazilian analyzer, that's why it worked.\r\n\r\nKind regards,\r\n\r\nGuilherme","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290669634","html_url":"https://github.com/elastic/elasticsearch/issues/21712#issuecomment-290669634","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21712","id":290669634,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDY2OTYzNA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-03-31T09:50:24Z","updated_at":"2017-03-31T09:50:24Z","author_association":"MEMBER","body":"@jimczi is this still an issue?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323715194","html_url":"https://github.com/elastic/elasticsearch/issues/21712#issuecomment-323715194","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21712","id":323715194,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzcxNTE5NA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-08-21T11:03:22Z","updated_at":"2017-08-21T11:03:22Z","author_association":"MEMBER","body":"Considering that we don't split on whitespace anymore in 6.0, this issue should not be a problem anymore unless explicit `AND`s are used. I think this is acceptable so I'll close this issue.","performed_via_github_app":null}]