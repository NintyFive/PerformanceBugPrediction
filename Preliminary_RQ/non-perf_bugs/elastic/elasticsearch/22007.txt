{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22007","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22007/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22007/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22007/events","html_url":"https://github.com/elastic/elasticsearch/issues/22007","id":193856266,"node_id":"MDU6SXNzdWUxOTM4NTYyNjY=","number":22007,"title":"S3 snapshot repo documentation wrong for \"read_only\"","user":{"login":"msimos","id":11743255,"node_id":"MDQ6VXNlcjExNzQzMjU1","avatar_url":"https://avatars3.githubusercontent.com/u/11743255?v=4","gravatar_id":"","url":"https://api.github.com/users/msimos","html_url":"https://github.com/msimos","followers_url":"https://api.github.com/users/msimos/followers","following_url":"https://api.github.com/users/msimos/following{/other_user}","gists_url":"https://api.github.com/users/msimos/gists{/gist_id}","starred_url":"https://api.github.com/users/msimos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msimos/subscriptions","organizations_url":"https://api.github.com/users/msimos/orgs","repos_url":"https://api.github.com/users/msimos/repos","events_url":"https://api.github.com/users/msimos/events{/privacy}","received_events_url":"https://api.github.com/users/msimos/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":442569761,"node_id":"MDU6TGFiZWw0NDI1Njk3NjE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.0.0","name":"v5.0.0","color":"dddddd","default":false,"description":null},{"id":492594588,"node_id":"MDU6TGFiZWw0OTI1OTQ1ODg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.1.2","name":"v5.1.2","color":"dddddd","default":false,"description":null},{"id":486905930,"node_id":"MDU6TGFiZWw0ODY5MDU5MzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.2.0","name":"v5.2.0","color":"dddddd","default":false,"description":null},{"id":334286612,"node_id":"MDU6TGFiZWwzMzQyODY2MTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.0-alpha1","name":"v6.0.0-alpha1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"assignees":[{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2016-12-06T19:02:12Z","updated_at":"2018-02-14T13:56:35Z","closed_at":"2016-12-08T15:58:11Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**:\r\n\r\nElasticsearch 5.0.0\r\n\r\n**Plugins installed**: []\r\n[msimos@msi-gs60 elasticsearch-5.0.0]$ bin/elasticsearch-plugin list --verbose\r\nPlugins directory: /home/msimos/Downloads/elasticsearch-5.0.0/plugins\r\nrepository-s3\r\n- Plugin information:\r\nName: repository-s3\r\nDescription: The S3 repository plugin adds S3 repositories\r\nVersion: 5.0.0\r\n * Classname: org.elasticsearch.plugin.repository.s3.S3RepositoryPlugin\r\nx-pack\r\n- Plugin information:\r\nName: x-pack\r\nDescription: Elasticsearch Expanded Pack Plugin\r\nVersion: 5.0.0\r\n * Classname: org.elasticsearch.xpack.XPackPlugin\r\n\r\n**JVM version**:\r\n\r\nOpenJDK 1.8.0-111\r\n\r\n**OS version**:\r\n\r\nFedora Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nDocumentation here states:\r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/plugins/5.0/repository-s3-repository.html\r\n\r\nread_only\r\nMakes repository read-only. Defaults to false.\r\n\r\nBut this doesn't appear to work.\r\n\r\n**Steps to reproduce**:\r\n\r\n[msimos@msi-gs60 es]$ curl -u elastic:changeme http://localhost:9200/_snapshot/s3_repo1?pretty\r\n{\r\n  \"s3_repo1\" : {\r\n    \"type\" : \"s3\",\r\n    \"settings\" : {\r\n      \"bucket\" : \"xxxxx.elasticsearch.org\",\r\n      \"base_path\" : \"/mikesimos\",\r\n      \"endpoint\" : \"s3.amazonaws.com\",\r\n      \"protocol\" : \"http\",\r\n      \"read_only\" : \"true\"\r\n    }\r\n  }\r\n}\r\n\r\n\r\n[msimos@msi-gs60 es]$ curl -XPUT -u elastic:changeme http://localhost:9200/_snapshot/s3_repo1/backup3?pretty\r\n{\r\n  \"accepted\" : true\r\n}\r\n\r\n\r\nThis should fail. However this works using \"readonly\": true works:\r\n\r\n[msimos@msi-gs60 es]$ curl -u elastic:changeme http://localhost:9200/_snapshot/s3_repo1?pretty       \r\n{\r\n  \"s3_repo1\" : {\r\n    \"type\" : \"s3\",\r\n    \"settings\" : {\r\n      \"bucket\" : \"xxxxx.elasticsearch.org\",\r\n      \"base_path\" : \"/mikesimos\",\r\n      \"endpoint\" : \"s3.amazonaws.com\",\r\n      \"protocol\" : \"http\",\r\n      \"readonly\" : \"true\"\r\n    }\r\n  }\r\n}\r\n[msimos@msi-gs60 es]$ curl -XPUT -u elastic:changeme http://localhost:9200/_snapshot/s3_repo1/backup3?pretty\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"repository_exception\",\r\n        \"reason\" : \"[s3_repo1] cannot create snapshot in a readonly repository\"\r\n      }\r\n    ],\r\n    \"type\" : \"repository_exception\",\r\n    \"reason\" : \"[s3_repo1] cannot create snapshot in a readonly repository\"\r\n  },\r\n  \"status\" : 500\r\n}\r\n\r\n\r\n\r\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}