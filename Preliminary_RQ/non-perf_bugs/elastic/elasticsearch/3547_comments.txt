[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22989922","html_url":"https://github.com/elastic/elasticsearch/issues/3547#issuecomment-22989922","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3547","id":22989922,"node_id":"MDEyOklzc3VlQ29tbWVudDIyOTg5OTIy","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-21T01:25:54Z","updated_at":"2013-08-21T01:25:54Z","author_association":"CONTRIBUTOR","body":"So I _think_ this is caused by the confidence being checked per shard and not rechecked when the results from the shards are merged together.  That'd be a problem because the input phrase's score is going to be different on different shards.  If the input phrase is rare it could be vastly different.  That'd be a problem because you might throw away great candidates on a shard where the input phrase scores well but keep garbage ones on a shard where the input phrase doesn't.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22991053","html_url":"https://github.com/elastic/elasticsearch/issues/3547#issuecomment-22991053","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3547","id":22991053,"node_id":"MDEyOklzc3VlQ29tbWVudDIyOTkxMDUz","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-21T02:02:16Z","updated_at":"2013-08-21T02:02:16Z","author_association":"CONTRIBUTOR","body":"So I modified the super heroes test to search for something in the corpus and the input phrase score varied across shards by two order of magnitude.\n\nSo I'm not really worried about throwing out really good suggestions on one shard because you can set shard_size > size and that won't happen.  The docs probably ought to be updated to reflect that.\n\nWhat I am worried about it that if confidence > 1 then the input phrase will never be returned from the shards but on shards where the input phrase scores low then bad suggestions will be returned.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23000049","html_url":"https://github.com/elastic/elasticsearch/issues/3547#issuecomment-23000049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3547","id":23000049,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMDAwMDQ5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-21T07:33:53Z","updated_at":"2013-08-21T07:33:53Z","author_association":"CONTRIBUTOR","body":"@nik9000 thanks for opening this! \n\n> So I modified the super heroes test to search for something in the corpus and the input phrase score varied across shards by two order of magnitude.\n\nI guess that is expected. Your data seems pretty lowish and therefore you might have large differences in term distribution etc. I don't think we can do much about that it somehow goes along the lines of distributed DF vs. local (per shard) DF.\n\n> What I am worried about it that if confidence > 1 then the input phrase will never be returned from the shards but on shards where the input phrase scores low then bad suggestions will be returned.\n\nhmm you mean we should calculate a global confidence for the input? I'd argue that this is the same discussion related to document frequency. I think this can easily happen if you very unbalanced shards ie. shard by type or so. But then you should also route you suggest request accordingly? Don't get me wrong, I am not saying this isn't a valid complain I'm just trying to figure out what and if a fix makes sense here. Do you have ideas?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23023369","html_url":"https://github.com/elastic/elasticsearch/issues/3547#issuecomment-23023369","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3547","id":23023369,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMDIzMzY5","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-21T14:59:45Z","updated_at":"2013-08-21T14:59:45Z","author_association":"CONTRIBUTOR","body":"It looks to me like if your shards are out of balance and you can't route your request appropriately then the phrase suggester is not going to work well for you because it uses shard local term frequency and total term count.  That makes sense and should probably be documented but it isn't my problem.\n\nMy problem is that my phrases are rare.  The phrase suggester does a good job of finding those rare phrases and suggesting rare phrases but if the user searches for a rare phrase then on one shard it'll have a high score and on the others its score will be low.  If the confidence is > 1 then you'll get suggestions only from the shards that don't contain the phrase and they won't be as good as the original phrase\n\nSo I have fix that throws those bad suggestions out by rechecking the cutoffScore during the reduce phrase.  I haven't rebased it or made sure it doesn't break any tests beyond those in SuggestSearchTests.  It does have a problem in that if your shards are unbalanced in might through out good suggestions.  I don't imagine I'll see this in production but some of the tests intentional work on very few documents.  I think this is a fair trade.  At least, it is for me.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23025920","html_url":"https://github.com/elastic/elasticsearch/issues/3547#issuecomment-23025920","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3547","id":23025920,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMDI1OTIw","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-21T15:32:35Z","updated_at":"2013-08-21T15:32:35Z","author_association":"CONTRIBUTOR","body":"The follow tests fail but seemed to fail at least some of the time before I made my change:\n- org.elasticsearch.test.integration.search.suggest.SuggestSearchTests.testShardFailures\n- org.elasticsearch.test.unit.cluster.routing.allocation.SameShardRoutingTests.sameHost\n- org.elasticsearch.test.unit.action.suggest.SuggestActionTests.testShardFailures\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23084802","html_url":"https://github.com/elastic/elasticsearch/issues/3547#issuecomment-23084802","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3547","id":23084802,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMDg0ODAy","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-22T11:59:17Z","updated_at":"2013-08-22T11:59:17Z","author_association":"CONTRIBUTOR","body":"@nik9000 I totally agree with you here that this can be a problem. I am just not 100% sure if that will do a really good job for most of the users. But on the other hand I don't have a good argument against it. So lets say we move forwards with this... I think your PR looks good, I have a couple of comments I will put on the PR and I know why those tests fail... not a big deal \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23495542","html_url":"https://github.com/elastic/elasticsearch/issues/3547#issuecomment-23495542","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3547","id":23495542,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNDk1NTQy","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-29T14:54:57Z","updated_at":"2013-08-29T14:54:57Z","author_association":"CONTRIBUTOR","body":"Thanks!\n","performed_via_github_app":null}]