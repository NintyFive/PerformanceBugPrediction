[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/94097576","html_url":"https://github.com/elastic/elasticsearch/issues/10653#issuecomment-94097576","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10653","id":94097576,"node_id":"MDEyOklzc3VlQ29tbWVudDk0MDk3NTc2","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-04-17T23:33:50Z","updated_at":"2015-04-17T23:33:50Z","author_association":"MEMBER","body":"The problem here is how geo shapes interact with lucene, mixed with the implementation of `include_in_parent` (note that this would also fail for `include_in_root`). Geo shapes values are generated while indexing using a stream of binary tokens. Due to the fact that these could be extremely memory intensive, this stream is not resettable.  So what happens here is the child doc exhausts the stream while indexing, then the parent tries to use the same stream, but it just gets an empty iteration.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96217390","html_url":"https://github.com/elastic/elasticsearch/issues/10653#issuecomment-96217390","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10653","id":96217390,"node_id":"MDEyOklzc3VlQ29tbWVudDk2MjE3Mzkw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-25T14:49:10Z","updated_at":"2015-04-25T14:49:10Z","author_association":"CONTRIBUTOR","body":"Thanks for the explanation @rjernst - given how expensive this is, i'd say that we shouldn't change this behaviour.  In fact, the `include_in_*` options were mostly a workaround for the early days of nested objects, when the query/agg framework was not as evolved.\n\nProbably all we need is a doc update.\n","performed_via_github_app":null}]