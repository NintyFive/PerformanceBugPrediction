{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41939","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41939/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41939/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41939/events","html_url":"https://github.com/elastic/elasticsearch/issues/41939","id":441652199,"node_id":"MDU6SXNzdWU0NDE2NTIxOTk=","number":41939,"title":"Enrich & Security","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false},"assignees":[{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-05-08T10:00:34Z","updated_at":"2019-11-12T13:08:07Z","closed_at":"2019-11-12T13:08:07Z","author_association":"MEMBER","active_lock_reason":null,"body":"Enrich processor uses a local allocated index, the enrich index. An enrich policy defines how the enrich index created and what indices and documents are sync-ed with the enrich index. An enrich policy is executed via the execute policy api. \r\n\r\nThe user executing a policy should have the following privileges:\r\n* Read and view_index_metadata privileges for the source indices that are defined in the policy.\r\n* Manage privileges to create and delete enrich indices, manage aliases and force merge.\r\n* Write privileges into the enrich indices.\r\n\r\nThe CRUD APIs for enrich policies will require cluster admin privileges. Also the execute\r\nand simulate APIs will require cluster admin privileges. A `manage_enrich` privilege will be \r\nintroduced in order to allow a user to do this. \r\n\r\nThe enrich index is regular index, so accessing it directly via regular read / write APIs will require the appropriate privileges. Pipelines with an enrich processor will be able to use this data too without any authorization check (because the enrich processor uses a locally allocated index shard), as long as the user is able to use the pipeline and is allowed to write into the targeted index. This means that, the user that executes a write request with a pipeline that uses an enrich  processor, is able to see the data of an enrich index in the index the write request is targeted for. (assuming that the user has read access to the index being written into)\r\n\r\nThis exposure of the enrich index is accepted, given that a the user that is allowed to read the original indices, explicitly configured these indices to be sync-ed by an enrich policy. The fact that an enrich processor uses a locally allocated enrich index shard is an implementation detail.\r\n\r\nCurrently there is no access control for pipelines (any authenticated user can use a pipeline), \r\nbut the idea is that this will be added at some point in the future via object level security. \r\n\r\nAlso the data of an enrich index will be visible in the simulate pipeline api. Given with what is described above and that this api requires cluster admin privileges, the should be ok.\r\n\r\nRelates to #32789\r\n\r\ncc: @tvernum \r\n\r\n- [x] elasticsearch PR #42677\r\n- [ ] update to kibanas roles (to be done after enrich is merged into master)\r\n- [ ] update the stack docs (to be done after enrich is merged into master)","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}