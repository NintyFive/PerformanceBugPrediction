{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22113","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22113/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22113/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22113/events","html_url":"https://github.com/elastic/elasticsearch/issues/22113","id":194950761,"node_id":"MDU6SXNzdWUxOTQ5NTA3NjE=","number":22113,"title":"Upgrade from 5.1.0 to 5.1.1 on Centos6 Makes a node unable to join the cluster","user":{"login":"primeroz","id":2085772,"node_id":"MDQ6VXNlcjIwODU3NzI=","avatar_url":"https://avatars0.githubusercontent.com/u/2085772?v=4","gravatar_id":"","url":"https://api.github.com/users/primeroz","html_url":"https://github.com/primeroz","followers_url":"https://api.github.com/users/primeroz/followers","following_url":"https://api.github.com/users/primeroz/following{/other_user}","gists_url":"https://api.github.com/users/primeroz/gists{/gist_id}","starred_url":"https://api.github.com/users/primeroz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/primeroz/subscriptions","organizations_url":"https://api.github.com/users/primeroz/orgs","repos_url":"https://api.github.com/users/primeroz/repos","events_url":"https://api.github.com/users/primeroz/events{/privacy}","received_events_url":"https://api.github.com/users/primeroz/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-12-12T11:27:12Z","updated_at":"2016-12-12T14:49:39Z","closed_at":"2016-12-12T14:49:39Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**: 5.1.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: openjdk version \"1.8.0_111\"\r\n\r\n\r\n**OS version**: Centos 6.8 \r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nA node running version 5.1.1 fail to join a cluster of 5.1.0 Nodes.\r\n\r\nExpected behaviour is to upgrade from 5.1.0 to 5.1.1 following the \"rolling upgrade steps\". Start the upgraded node and have it succesfully join the cluster\r\n\r\n**NOTE** that as reported in the forum discussion 5.1.0 was _not supposed to be publicly available_\r\n\r\nhttps://www.elastic.co/blog/elastic-stack-5-1-1-released\r\n> Yup, you read that right. Version 5.1.0 doesnâ€™t exist because, for a short period of time, the Elastic Yum and Apt repositories included unreleased binaries labeled 5.1.0. To avoid any confusion, and upgrade issues for the people that have installed these without realizing, we have decided to skip the 5.1.0 version and release 5.1.1 instead.\r\n\r\n\r\n**Steps to reproduce**:\r\n 1. Setup a 5.1.0 cluster\r\n 2. stop and upgrade one node to 5.1.1\r\n 3. start the upgraded node \r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n[2016-12-12T10:08:53,557][INFO ][o.e.n.Node               ] [infra-elk-es1.lon-dc.mintel.ad] initializing ...\r\n[2016-12-12T10:08:53,610][INFO ][o.e.e.NodeEnvironment    ] [infra-elk-es1.lon-dc.mintel.ad] using [1] data paths, mounts [[/data (/dev/vdb)]], net usabl\r\ne_space [397.8gb], net total_space [499.7gb], spins? [possibly], types [xfs]\r\n[2016-12-12T10:08:53,611][INFO ][o.e.e.NodeEnvironment    ] [infra-elk-es1.lon-dc.mintel.ad] heap size [7.9gb], compressed ordinary object pointers [true\r\n]\r\n[2016-12-12T10:08:54,674][INFO ][o.e.n.Node               ] [infra-elk-es1.lon-dc.mintel.ad] node name [infra-elk-es1.lon-dc.mintel.ad], node ID [vN6s_3-\r\nXS2i11w1v59o8dg]\r\n[2016-12-12T10:08:54,676][INFO ][o.e.n.Node               ] [infra-elk-es1.lon-dc.mintel.ad] version[5.1.1], pid[18954], build[5395e21/2016-12-06T12:36:1\r\n5.409Z], OS[Linux/2.6.32-642.6.2.el6.x86_64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_111/25.111-b15]\r\n[2016-12-12T10:08:55,317][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [aggs-matrix-stats]\r\n[2016-12-12T10:08:55,317][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [ingest-common]\r\n[2016-12-12T10:08:55,317][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [lang-expression]\r\n[2016-12-12T10:08:55,317][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [lang-groovy]\r\n[2016-12-12T10:08:55,317][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [lang-mustache]\r\n[2016-12-12T10:08:55,317][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [lang-painless]\r\n[2016-12-12T10:08:55,318][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [percolator]\r\n[2016-12-12T10:08:55,318][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [reindex]\r\n[2016-12-12T10:08:55,318][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [transport-netty3]\r\n[2016-12-12T10:08:55,318][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] loaded module [transport-netty4]\r\n[2016-12-12T10:08:55,318][INFO ][o.e.p.PluginsService     ] [infra-elk-es1.lon-dc.mintel.ad] no plugins loaded\r\n[2016-12-12T10:09:01,099][INFO ][o.e.n.Node               ] [infra-elk-es1.lon-dc.mintel.ad] initialized\r\n[2016-12-12T10:09:01,099][INFO ][o.e.n.Node               ] [infra-elk-es1.lon-dc.mintel.ad] starting ...\r\n[2016-12-12T10:09:01,223][INFO ][o.e.t.TransportService   ] [infra-elk-es1.lon-dc.mintel.ad] publish_address {172.31.0.6:9300}, bound_addresses {0.0.0.0:\r\n9300}\r\n[2016-12-12T10:09:01,228][INFO ][o.e.b.BootstrapCheck     ] [infra-elk-es1.lon-dc.mintel.ad] bound or publishing to a non-loopback or non-link-local addr\r\ness, enforcing bootstrap checks\r\n[2016-12-12T10:09:04,305][INFO ][o.e.d.z.ZenDiscovery     ] [infra-elk-es1.lon-dc.mintel.ad] failed to send join request to master [{infra-elk-es4.lon-dc\r\n.mintel.ad}{5CA_TtyUSDau2ZtJBKWzyQ}{y73HV3ReSi67NGuyk9Shhg}{172.31.1.232}{172.31.1.232:9300}], reason [RemoteTransportException[[Failed to deserialize ex\r\nception response from stream]]; nested: TransportSerializationException[Failed to deserialize exception response from stream]; nested: IllegalArgumentExc\r\neption[port out of range:2380801]; ]\r\n[2016-12-12T10:09:04,332][WARN ][o.e.t.n.Netty4Transport  ] [infra-elk-es1.lon-dc.mintel.ad] exception caught on transport layer [[id: 0xad57d6a8, L:/172\r\n.31.0.6:40484 - R:172.31.1.232/172.31.1.232:9300]], closing connection\r\njava.lang.IllegalStateException: Message not fully read (response) for requestId [14], handler [org.elasticsearch.transport.TransportService$ContextResto\r\nreResponseHandler/future(org.elasticsearch.transport.EmptyTransportResponseHandler@77d1e794)], error [true]; resetting\r\n```\r\n\r\n**Forum Discussion**\r\n\r\nhttps://discuss.elastic.co/t/upgrade-from-5-1-0-to-5-1-1-on-centos6-makes-a-node-unable-to-join-the-cluster/68693\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}