[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263460233","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-263460233","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":263460233,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzQ2MDIzMw==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T02:40:04Z","updated_at":"2016-11-29T02:40:04Z","author_association":"MEMBER","body":"But you are using must clauses here not should clauses. Why this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263464614","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-263464614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":263464614,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzQ2NDYxNA==","user":{"login":"fiefdx","id":3204360,"node_id":"MDQ6VXNlcjMyMDQzNjA=","avatar_url":"https://avatars1.githubusercontent.com/u/3204360?v=4","gravatar_id":"","url":"https://api.github.com/users/fiefdx","html_url":"https://github.com/fiefdx","followers_url":"https://api.github.com/users/fiefdx/followers","following_url":"https://api.github.com/users/fiefdx/following{/other_user}","gists_url":"https://api.github.com/users/fiefdx/gists{/gist_id}","starred_url":"https://api.github.com/users/fiefdx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fiefdx/subscriptions","organizations_url":"https://api.github.com/users/fiefdx/orgs","repos_url":"https://api.github.com/users/fiefdx/repos","events_url":"https://api.github.com/users/fiefdx/events{/privacy}","received_events_url":"https://api.github.com/users/fiefdx/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T03:12:42Z","updated_at":"2016-11-29T06:44:49Z","author_association":"NONE","body":"@dadoonet I use golang elastic.v3 client to build the DSL query, at some cases there is no 'should' clause under the bool query, I know I can check the query first, then, set \"minimum_should_match\" or not, but I think maybe elasticsearch service can do this itself. in elasticsearch version 2.3 this is fine. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263497836","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-263497836","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":263497836,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzQ5NzgzNg==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T07:36:36Z","updated_at":"2016-11-29T07:36:36Z","author_association":"MEMBER","body":"I can indeed reproduce it:\r\n\r\n```\r\nDELETE test\r\nPUT test\r\nPOST test/blog/_bulk\r\n{ \"index\":  { }}\r\n{ \"name\": \"this is a test\" }\r\n{ \"index\":  { }}\r\n{ \"name\": \"this is another test\" }\r\nGET test/blog/_search\r\n{\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"minimum_should_match\": \"1\",\r\n            \"must\": [\r\n                {\r\n                    \"match\": {\r\n                        \"name\": {\r\n                            \"query\": \"test\",\r\n                            \"type\": \"phrase\"\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    \"match\": {\r\n                        \"name\": {\r\n                            \"query\": \"a\",\r\n                            \"type\": \"phrase\"\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    \"match\": {\r\n                        \"name\": {\r\n                            \"query\": \"this\",\r\n                            \"type\": \"phrase\"\r\n                        }\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nNot sure what is the solution here but may be we should reject the query if `minimum_should_match` is used without any `should` clause? \r\n@jpountz WDYT?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263499206","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-263499206","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":263499206,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzQ5OTIwNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T07:44:58Z","updated_at":"2016-11-29T07:44:58Z","author_association":"CONTRIBUTOR","body":"This is the result of this change https://github.com/elastic/elasticsearch/pull/15571 which was opened because of https://github.com/elastic/elasticsearch/issues/15521.\r\n\r\nminimum_should_match used to be adjusted based on how many should clauses there were, and now it isn't.  @jpountz though this was a bug (https://github.com/elastic/elasticsearch/issues/15521#issuecomment-165777211) but I'm not sure I agree with him.  To satisfy correctness in an edge case, it's made working with min-should-match harder for the ordinary case.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263520849","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-263520849","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":263520849,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzUyMDg0OQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T09:33:33Z","updated_at":"2016-11-29T09:33:33Z","author_association":"CONTRIBUTOR","body":"I still think the current behaviour is better than the old one, ignoring parameters because we think they were put there by mistake feels wrong to me. If we want `minimum_should_match` to depend on the number of should clauses, we can use the conditional syntax? For instance based on the above use-case and query, I think the query should look like this:\r\n\r\n```\r\n{\r\n    \"from\" : 0,\r\n    \"size\" : 10,\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"minimum_should_match\": \"0<1\",\r\n            \"must\": [\r\n                {\r\n                    \"match\": {\r\n                        \"name\": {\r\n                            \"query\": \"test\",\r\n                            \"type\": \"phrase\"\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    \"match\": {\r\n                        \"name\": {\r\n                            \"query\": \"a\",\r\n                            \"type\": \"phrase\"\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    \"match\": {\r\n                        \"name\": {\r\n                            \"query\": \"this\",\r\n                            \"type\": \"phrase\"\r\n                        }\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThis will require 0 matching should clauses if the query has no should clauses and 1 otherwise.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263563769","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-263563769","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":263563769,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzU2Mzc2OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T12:59:20Z","updated_at":"2016-11-29T12:59:20Z","author_association":"CONTRIBUTOR","body":"@jpountz much better solution.  Closing","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279825301","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-279825301","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":279825301,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTgyNTMwMQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2017-02-14T20:26:06Z","updated_at":"2017-02-14T20:26:06Z","author_association":"MEMBER","body":"@djschny and I ran into an interesting variation of this issue during the training today. Here is the repro. I am not sure about `query_string` requests, but I was totally expecting the match query to fail with some meaningful error instead of silently returning no errors.\r\n\r\n```\r\ncurl -XDELETE \"localhost:9200/test?pretty\"\r\ncurl -XPUT \"localhost:9200/test/doc/1?pretty&refresh\" -d '{\r\n  \"foo\": \"bar baz\"\r\n}'\r\ncurl -XGET \"localhost:9200/test/_search?pretty\" -d '{\r\n  \"query\": {\r\n    \"match\": {\r\n      \"foo\": {\r\n        \"query\": \"bar baz\",\r\n        \"operator\": \"and\",\r\n        \"minimum_should_match\": 1\r\n      }\r\n    }\r\n  }\r\n}'\r\ncurl -XGET \"localhost:9200/test/_search?pretty\" -d '{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"query\": \"bar baz\",\r\n      \"default_operator\": \"and\",\r\n      \"minimum_should_match\": 1\r\n    }\r\n  }\r\n}'\r\ncurl -XGET \"localhost:9200/test/_search?pretty\" -d '{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"query\": \"+bar +baz\",\r\n      \"minimum_should_match\": 1\r\n    }\r\n  }\r\n}'\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279950591","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-279950591","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":279950591,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTk1MDU5MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-02-15T08:45:32Z","updated_at":"2017-02-15T08:45:32Z","author_association":"CONTRIBUTOR","body":"The same applies here - using `minimum_should_match` with `0<1` or `80%` both work correctly.  I'd say that using a percentage for matching against a query string makes much more sense than specifying an absolute value.  I think what @jpountz said still stands.\r\n\r\nWhat could be improved is the documentation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/374577471","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-374577471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":374577471,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NDU3NzQ3MQ==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2018-03-20T12:19:56Z","updated_at":"2018-03-20T12:19:56Z","author_association":"CONTRIBUTOR","body":"@jpountz do you think this change (which basically says that using `minimum_should_match: [value_greater_than_0]` with only `must` statements will match no documents) should be documented somehow? It is not clear from the three docs I looked at - [`bool` documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html), [`query_string` documentation](https://www.elastic.co/guide/en/elasticsearch/reference/6.2/query-dsl-query-string-query.html) (here the `minimum_should_match` combined with `default_operator: and` will lead to the same result), [`minimum_should_match` own page](https://www.elastic.co/guide/en/elasticsearch/reference/6.2/query-dsl-minimum-should-match.html) - that this is a tricky combination that users should be aware of.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/374584662","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-374584662","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":374584662,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NDU4NDY2Mg==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2018-03-20T12:47:00Z","updated_at":"2018-03-20T12:47:00Z","author_association":"CONTRIBUTOR","body":"I think that we need to improve the documentation. There is no indication of this change, and looking at the current behavior it changed since 2.x.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/424825103","html_url":"https://github.com/elastic/elasticsearch/issues/21844#issuecomment-424825103","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21844","id":424825103,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNDgyNTEwMw==","user":{"login":"leppaott","id":16340878,"node_id":"MDQ6VXNlcjE2MzQwODc4","avatar_url":"https://avatars1.githubusercontent.com/u/16340878?v=4","gravatar_id":"","url":"https://api.github.com/users/leppaott","html_url":"https://github.com/leppaott","followers_url":"https://api.github.com/users/leppaott/followers","following_url":"https://api.github.com/users/leppaott/following{/other_user}","gists_url":"https://api.github.com/users/leppaott/gists{/gist_id}","starred_url":"https://api.github.com/users/leppaott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leppaott/subscriptions","organizations_url":"https://api.github.com/users/leppaott/orgs","repos_url":"https://api.github.com/users/leppaott/repos","events_url":"https://api.github.com/users/leppaott/events{/privacy}","received_events_url":"https://api.github.com/users/leppaott/received_events","type":"User","site_admin":false},"created_at":"2018-09-26T18:38:12Z","updated_at":"2018-09-26T18:38:12Z","author_association":"NONE","body":"Add a mention of this to the docs please 👍 Got this when updating our 2.x elastic to 6.x.","performed_via_github_app":null}]