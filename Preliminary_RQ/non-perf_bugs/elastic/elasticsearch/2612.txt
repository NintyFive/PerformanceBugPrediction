{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2612","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2612/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2612/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2612/events","html_url":"https://github.com/elastic/elasticsearch/issues/2612","id":10594662,"node_id":"MDU6SXNzdWUxMDU5NDY2Mg==","number":2612,"title":"Explain API ignores search_type","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2013-02-04T03:14:48Z","updated_at":"2016-05-06T13:19:51Z","closed_at":"2016-05-06T13:19:46Z","author_association":"MEMBER","active_lock_reason":null,"body":"It appears that the Explain API ignores search_type.  I'm unsure if this is by design, or because of an underlying limitation, but thought it deserved an issue report.\n\nHere is an example query showing scoring disparity due to low doc count (5 docs) spread across 5 shards.  Perfectly normal for a `query_then_fetch` search_type:\n\n```\ncurl -XGET localhost:9200/startswith/test/_search?pretty -d '{                                                          \"query\": {\n        \"match_phrase_prefix\": {\n           \"title\": {\n             \"query\": \"d\",\n             \"max_expansions\": 5\n           }\n         }\n       }\n     }' | grep title\n\n      \"_score\" : 1.0, \"_source\" : {\"title\":\"drunk\"}\n      \"_score\" : 0.30685282, \"_source\" : {\"title\":\"dzone\"}\n      \"_score\" : 0.30685282, \"_source\" : {\"title\":\"data\"}\n      \"_score\" : 0.30685282, \"_source\" : {\"title\":\"drive\"}\n```\n\nSame query with search_type set to `dfs_query_then_fetch`, showing appropriate scoring:\n\n```\n curl -XGET 'localhost:9200/startswith/test/_search?pretty=true&search_type=dfs_query_then_fetch' -d '{\n        \"query\": {\n        \"match_phrase_prefix\": {\n           \"title\": {\n             \"query\": \"d\",\n             \"max_expansions\": 5\n           }\n         }\n       }\n     }' | grep title\n\n      \"_score\" : 1.9162908, \"_source\" : {\"title\":\"dzone\"}\n      \"_score\" : 1.9162908, \"_source\" : {\"title\":\"data\"}\n      \"_score\" : 1.9162908, \"_source\" : {\"title\":\"drunk\"}\n      \"_score\" : 1.9162908, \"_source\" : {\"title\":\"drive\"}\n```\n\nOk, with the verification out of the way, here are the corresponding Explain API examples for the \"dzone\" document, which in the above example has differential scoring depending on the search_type.  It appears that the Explain API completely ignores the search_type, since the score remains unaffected and maxDocs does not change.\n\n```\ncurl -XGET 'localhost:9200/startswith/test/gvgXfR5YRSaXu7PfFc4FkA/_explain?pretty=true&search_type=query_then_fetch' -d '{\n        \"query\": {\n        \"match_phrase_prefix\": {\n           \"title\": {\n             \"query\": \"d\",\n             \"max_expansions\": 5\n           }\n         }\n       }\n     }'\n{\n  \"ok\" : true,\n  \"_index\" : \"startswith\",\n  \"_type\" : \"test\",\n  \"_id\" : \"gvgXfR5YRSaXu7PfFc4FkA\",\n  \"matched\" : true,\n  \"explanation\" : {\n    \"value\" : 0.30685282,\n    \"description\" : \"fieldWeight(title:dzone in 0), product of:\",\n    \"details\" : [ {\n      \"value\" : 1.0,\n      \"description\" : \"tf(termFreq(title:dzone)=1)\"\n    }, {\n      \"value\" : 0.30685282,\n      \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n    }, {\n      \"value\" : 1.0,\n      \"description\" : \"fieldNorm(field=title, doc=0)\"\n    } ]\n  }\n```\n\nAnd now dfs_query_then_fetch:\n\n```\n#curl -XGET 'localhost:9200/startswith/test/gvgXfR5YRSaXu7PfFc4FkA/_explain?pretty=true&search_type=dfs_query_then_fetch' -d '{\n        \"query\": {\n        \"match_phrase_prefix\": {\n           \"title\": {\n             \"query\": \"d\",\n             \"max_expansions\": 5\n           }\n         }\n       }\n     }'\n{\n  \"ok\" : true,\n  \"_index\" : \"startswith\",\n  \"_type\" : \"test\",\n  \"_id\" : \"gvgXfR5YRSaXu7PfFc4FkA\",\n  \"matched\" : true,\n  \"explanation\" : {\n    \"value\" : 0.30685282,\n    \"description\" : \"fieldWeight(title:dzone in 0), product of:\",\n    \"details\" : [ {\n      \"value\" : 1.0,\n      \"description\" : \"tf(termFreq(title:dzone)=1)\"\n    }, {\n      \"value\" : 0.30685282,\n      \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n    }, {\n      \"value\" : 1.0,\n      \"description\" : \"fieldNorm(field=title, doc=0)\"\n    } ]\n  }\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}