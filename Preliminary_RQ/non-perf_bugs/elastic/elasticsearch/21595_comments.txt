[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/260966326","html_url":"https://github.com/elastic/elasticsearch/issues/21595#issuecomment-260966326","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21595","id":260966326,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDk2NjMyNg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-11-16T14:53:46Z","updated_at":"2016-11-16T14:53:46Z","author_association":"MEMBER","body":"Thanks for reporting, I think I see the issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/260972029","html_url":"https://github.com/elastic/elasticsearch/issues/21595#issuecomment-260972029","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21595","id":260972029,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDk3MjAyOQ==","user":{"login":"xgwu","id":10510416,"node_id":"MDQ6VXNlcjEwNTEwNDE2","avatar_url":"https://avatars2.githubusercontent.com/u/10510416?v=4","gravatar_id":"","url":"https://api.github.com/users/xgwu","html_url":"https://github.com/xgwu","followers_url":"https://api.github.com/users/xgwu/followers","following_url":"https://api.github.com/users/xgwu/following{/other_user}","gists_url":"https://api.github.com/users/xgwu/gists{/gist_id}","starred_url":"https://api.github.com/users/xgwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xgwu/subscriptions","organizations_url":"https://api.github.com/users/xgwu/orgs","repos_url":"https://api.github.com/users/xgwu/repos","events_url":"https://api.github.com/users/xgwu/events{/privacy}","received_events_url":"https://api.github.com/users/xgwu/received_events","type":"User","site_admin":false},"created_at":"2016-11-16T15:18:29Z","updated_at":"2016-11-16T15:18:29Z","author_association":"NONE","body":"@jasontedor thanks for quick responding!\n\nBesides global search timeout not working in v5.0.0,  the query body timeout  seems not functioning as good as in v2.4.0 under heavy search load.\n\nWe have a large cluster, with 120 data nodes running on 70 physical servers for Trillions of  logs search& analysis.   Search timeout in v2.4.0 protected the cluster pretty well by terminating expensive queries from inept users.\n\nThis been not the case since upgraded to v5.0.0 last weekend, some data nodes became wearing out its disk IO during peak usage time  on a daily basis and we have to restart some nodes quite frequently.\n\nWhen a node is wearing out , iostats shows consistent peak disk read and I observed from tasks management api that some queries seems running endless which however should have been timed out by the node.  Even after we stopped sending queries to the node, it  seemsed still trying very hard in executing its active search thread and search completed counter had no sign to increase.  We also tried other measures such as tuning down  search thread pool and queue length in hoping to reduce search concurrency and reject queries early during peak time but without any luck.\n\nBelow is one example output from tasks API when the node \"stuck\" in searching.\n\n {\n\n  \"nodes\": {\n    \"GS-XNaqeTRq3-hAJepD4RA\": {\n      \"name\": \"oy_data_weak_2_10.15.118.23_A\",\n      \"transport_address\": \"10.15.118.23:9301\",\n      \"host\": \"10.15.118.23\",\n      \"ip\": \"10.15.118.23:9301\",\n      \"roles\": [\n        \"data\",\n        \"ingest\"\n      ],\n      \"attributes\": {\n        \"boxtype\": \"weak\",\n        \"instance\": \"A\",\n        \"group\": \"2\"\n      },\n      \"tasks\": {\n        \"GS-XNaqeTRq3-hAJepD4RA:31750\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 31750,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479301391951,\n          \"running_time_in_nanos\": 1434167740809,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:30673\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 30673,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479301064457,\n          \"running_time_in_nanos\": 1761662192887,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:29467\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 29467,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479300706805,\n          \"running_time_in_nanos\": 2119314046172,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:33197\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 33197,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479301815548,\n          \"running_time_in_nanos\": 1010571268993,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:33198\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 33198,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479301815548,\n          \"running_time_in_nanos\": 1010570972118,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:27695\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 27695,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479300190778,\n          \"running_time_in_nanos\": 2635341006636,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:27697\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 27697,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479300190778,\n          \"running_time_in_nanos\": 2635340988791,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:34611\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 34611,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479302089801,\n          \"running_time_in_nanos\": 736317917130,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:27703\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 27703,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479300190779,\n          \"running_time_in_nanos\": 2635340096275,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:27704\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 27704,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/read/search[phase/query]\",\n          \"start_time_in_millis\": 1479300190779,\n          \"running_time_in_nanos\": 2635339708378,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:37049\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 37049,\n          \"type\": \"netty\",\n          \"action\": \"indices:data/write/bulk\",\n          \"start_time_in_millis\": 1479302739424,\n          \"running_time_in_nanos\": 86694868464,\n          \"cancellable\": false\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:37051\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 37051,\n          \"type\": \"transport\",\n          \"action\": \"indices:data/write/bulk[s]\",\n          \"start_time_in_millis\": 1479302739426,\n          \"running_time_in_nanos\": 86692652830,\n          \"cancellable\": false,\n          \"parent_task_id\": \"GS-XNaqeTRq3-hAJepD4RA:37049\"\n        },\n        \"GS-XNaqeTRq3-hAJepD4RA:37053\": {\n          \"node\": \"GS-XNaqeTRq3-hAJepD4RA\",\n          \"id\": 37053,\n          \"type\": \"transport\",\n          \"action\": \"indices:data/write/bulk[s]\",\n          \"start_time_in_millis\": 1479302739430,\n          \"running_time_in_nanos\": 86689387697,\n          \"cancellable\": false,\n          \"parent_task_id\": \"GS-XNaqeTRq3-hAJepD4RA:37049\"\n        }\n      }\n    }\n  }\n}\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/260977284","html_url":"https://github.com/elastic/elasticsearch/issues/21595#issuecomment-260977284","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21595","id":260977284,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDk3NzI4NA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-11-16T15:36:17Z","updated_at":"2016-11-16T15:36:17Z","author_association":"MEMBER","body":"Okay, I've confirmed what I see; I'll open a PR to fix soon.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/260995819","html_url":"https://github.com/elastic/elasticsearch/issues/21595#issuecomment-260995819","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21595","id":260995819,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDk5NTgxOQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-11-16T16:31:57Z","updated_at":"2016-11-16T16:31:57Z","author_association":"MEMBER","body":"I opened #21599.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/261021377","html_url":"https://github.com/elastic/elasticsearch/issues/21595#issuecomment-261021377","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21595","id":261021377,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MTAyMTM3Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-11-16T17:58:29Z","updated_at":"2016-11-16T17:58:29Z","author_association":"MEMBER","body":"This will be fixed in 5.0.2.\n","performed_via_github_app":null}]