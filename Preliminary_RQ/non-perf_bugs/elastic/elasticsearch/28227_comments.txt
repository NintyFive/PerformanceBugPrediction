[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/357917326","html_url":"https://github.com/elastic/elasticsearch/issues/28227#issuecomment-357917326","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28227","id":357917326,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NzkxNzMyNg==","user":{"login":"motherhubbard","id":3320683,"node_id":"MDQ6VXNlcjMzMjA2ODM=","avatar_url":"https://avatars0.githubusercontent.com/u/3320683?v=4","gravatar_id":"","url":"https://api.github.com/users/motherhubbard","html_url":"https://github.com/motherhubbard","followers_url":"https://api.github.com/users/motherhubbard/followers","following_url":"https://api.github.com/users/motherhubbard/following{/other_user}","gists_url":"https://api.github.com/users/motherhubbard/gists{/gist_id}","starred_url":"https://api.github.com/users/motherhubbard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/motherhubbard/subscriptions","organizations_url":"https://api.github.com/users/motherhubbard/orgs","repos_url":"https://api.github.com/users/motherhubbard/repos","events_url":"https://api.github.com/users/motherhubbard/events{/privacy}","received_events_url":"https://api.github.com/users/motherhubbard/received_events","type":"User","site_admin":false},"created_at":"2018-01-16T10:26:18Z","updated_at":"2018-01-16T10:29:17Z","author_association":"NONE","body":"I've started recording timings based on the number of items in the batch:\r\n\r\nItems       | Request size           | Elastic Duration (Range in ms)\r\n--------- | ------------------- | -------------------------------\r\n1               | 75273                      | 40 - 90\r\n2              | 160498                    | 100 - 200\r\n3              | 233460                   | 100 - 200\r\n4              | 271235                    | 100 - 200\r\n5              | 352107                    | 355 - 600\r\n6              | 391510                    | 355 - 600\r\n10             | 624568                  | 355 - 600\r\n20            | 1230996                 | 700 - 1200\r\n50            | 3031171                  | 1600 - 2500   (I start seeing GC warning messages at this point)\r\n60            | 3643834                | 2300 - 7470 ( the outlier had a very big GC pause: [2018-01-16T10:18:35,469][WARN ][o.e.m.j.JvmGcMonitorService] [main-single-node] [gc][322550] overhead, spent [4.2s] collecting in the last [4.7s])\r\n\r\nI am calculating the range over 10 requests for each row in the table.\r\n\r\nThere is no other load on the box at the same time. I have 8 CPUs on the server.\r\n\r\nAre these big GCs to be expected?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/357941259","html_url":"https://github.com/elastic/elasticsearch/issues/28227#issuecomment-357941259","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28227","id":357941259,"node_id":"MDEyOklzc3VlQ29tbWVudDM1Nzk0MTI1OQ==","user":{"login":"motherhubbard","id":3320683,"node_id":"MDQ6VXNlcjMzMjA2ODM=","avatar_url":"https://avatars0.githubusercontent.com/u/3320683?v=4","gravatar_id":"","url":"https://api.github.com/users/motherhubbard","html_url":"https://github.com/motherhubbard","followers_url":"https://api.github.com/users/motherhubbard/followers","following_url":"https://api.github.com/users/motherhubbard/following{/other_user}","gists_url":"https://api.github.com/users/motherhubbard/gists{/gist_id}","starred_url":"https://api.github.com/users/motherhubbard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/motherhubbard/subscriptions","organizations_url":"https://api.github.com/users/motherhubbard/orgs","repos_url":"https://api.github.com/users/motherhubbard/repos","events_url":"https://api.github.com/users/motherhubbard/events{/privacy}","received_events_url":"https://api.github.com/users/motherhubbard/received_events","type":"User","site_admin":false},"created_at":"2018-01-16T12:09:29Z","updated_at":"2018-01-16T12:10:50Z","author_association":"NONE","body":"Looking at the JVM stats, For our 3.6M input message we seem to be adding about 1G to the heap (excluding anything that may have been collected during the process):\r\nBefore request:\r\n\r\n``` \"mem\" : {\r\n          \"heap_used_in_bytes\" : 1706120912,\r\n          \"heap_used_percent\" : 32,\r\n          \"heap_committed_in_bytes\" : 5298978816,\r\n          \"heap_max_in_bytes\" : 5298978816,\r\n          \"non_heap_used_in_bytes\" : 168750512,\r\n          \"non_heap_committed_in_bytes\" : 220000256,\r\n          \"pools\" : {\r\n            \"young\" : {\r\n              \"used_in_bytes\" : 75764152,\r\n              \"max_in_bytes\" : 558432256,\r\n              \"peak_used_in_bytes\" : 558432256,\r\n              \"peak_max_in_bytes\" : 558432256\r\n            },\r\n            \"survivor\" : {\r\n              \"used_in_bytes\" : 44046728,\r\n              \"max_in_bytes\" : 69730304,\r\n              \"peak_used_in_bytes\" : 69730304,\r\n              \"peak_max_in_bytes\" : 69730304\r\n            },\r\n            \"old\" : {\r\n              \"used_in_bytes\" : 1586310032,\r\n              \"max_in_bytes\" : 4670816256,\r\n              \"peak_used_in_bytes\" : 4645066960,\r\n              \"peak_max_in_bytes\" : 4670816256\r\n            }\r\n          }\r\n        },\r\n        \"threads\" : {\r\n          \"count\" : 90,\r\n          \"peak_count\" : 102\r\n        },\r\n        \"gc\" : {\r\n          \"collectors\" : {\r\n            \"young\" : {\r\n              \"collection_count\" : 25418,\r\n              \"collection_time_in_millis\" : 3737009\r\n            },\r\n            \"old\" : {\r\n              \"collection_count\" : 367,\r\n              \"collection_time_in_millis\" : 121855\r\n            }\r\n          }\r\n        }, \r\n```\r\n\r\nafter request:\r\n\r\n``` \"mem\" : {\r\n          \"heap_used_in_bytes\" : 2642199544,\r\n          \"heap_used_percent\" : 49,\r\n          \"heap_committed_in_bytes\" : 5298978816,\r\n          \"heap_max_in_bytes\" : 5298978816,\r\n          \"non_heap_used_in_bytes\" : 168800432,\r\n          \"non_heap_committed_in_bytes\" : 220000256,\r\n          \"pools\" : {\r\n            \"young\" : {\r\n              \"used_in_bytes\" : 151948208,\r\n              \"max_in_bytes\" : 558432256,\r\n              \"peak_used_in_bytes\" : 558432256,\r\n              \"peak_max_in_bytes\" : 558432256\r\n            },\r\n            \"survivor\" : {\r\n              \"used_in_bytes\" : 26625440,\r\n              \"max_in_bytes\" : 69730304,\r\n              \"peak_used_in_bytes\" : 69730304,\r\n              \"peak_max_in_bytes\" : 69730304\r\n            },\r\n            \"old\" : {\r\n              \"used_in_bytes\" : 2463625896,\r\n              \"max_in_bytes\" : 4670816256,\r\n              \"peak_used_in_bytes\" : 4645066960,\r\n              \"peak_max_in_bytes\" : 4670816256\r\n            }\r\n          }\r\n        },\r\n        \"threads\" : {\r\n          \"count\" : 87,\r\n          \"peak_count\" : 102\r\n        },\r\n        \"gc\" : {\r\n          \"collectors\" : {\r\n            \"young\" : {\r\n              \"collection_count\" : 25426,\r\n              \"collection_time_in_millis\" : 3737708\r\n            },\r\n            \"old\" : {\r\n              \"collection_count\" : 367,\r\n              \"collection_time_in_millis\" : 121855\r\n            }\r\n          }\r\n        },  \r\n```\r\n\r\nIs this expected?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/358004871","html_url":"https://github.com/elastic/elasticsearch/issues/28227#issuecomment-358004871","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28227","id":358004871,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODAwNDg3MQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-01-16T15:45:08Z","updated_at":"2018-01-16T15:45:08Z","author_association":"CONTRIBUTOR","body":"What does the scripted update?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/358063033","html_url":"https://github.com/elastic/elasticsearch/issues/28227#issuecomment-358063033","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28227","id":358063033,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODA2MzAzMw==","user":{"login":"motherhubbard","id":3320683,"node_id":"MDQ6VXNlcjMzMjA2ODM=","avatar_url":"https://avatars0.githubusercontent.com/u/3320683?v=4","gravatar_id":"","url":"https://api.github.com/users/motherhubbard","html_url":"https://github.com/motherhubbard","followers_url":"https://api.github.com/users/motherhubbard/followers","following_url":"https://api.github.com/users/motherhubbard/following{/other_user}","gists_url":"https://api.github.com/users/motherhubbard/gists{/gist_id}","starred_url":"https://api.github.com/users/motherhubbard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/motherhubbard/subscriptions","organizations_url":"https://api.github.com/users/motherhubbard/orgs","repos_url":"https://api.github.com/users/motherhubbard/repos","events_url":"https://api.github.com/users/motherhubbard/events{/privacy}","received_events_url":"https://api.github.com/users/motherhubbard/received_events","type":"User","site_admin":false},"created_at":"2018-01-16T18:41:33Z","updated_at":"2018-01-16T18:41:33Z","author_association":"NONE","body":"@jpountz Thanks for responding to me.\r\n\r\nThe script updates the document in a number of places (its not easy for me to share the script) based on the params that are passed to it.\r\n\r\nTheres a couple simple updates to the top level fields and the rest are pushes to some of the arrays in the document (which will relate to the nested fields in the mappings). If you need me to convert the script to the obfuscated names I can try and do that.\r\n\r\nSorry for being a little vague, is there something specific you are thinking of?\r\n\r\nThe script typically runs in 1ms.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/358281514","html_url":"https://github.com/elastic/elasticsearch/issues/28227#issuecomment-358281514","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28227","id":358281514,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODI4MTUxNA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-01-17T11:50:07Z","updated_at":"2018-01-17T11:50:07Z","author_association":"CONTRIBUTOR","body":"Hi @motherhubbard, I think this question is better suited to the support forums over at https://discuss.elastic.co. We prefer to use Github issues only for bug reports and feature requests, and we think it's more likely this is a question than a bug report. I'm closing this as an issue here, but encourage you to ask this question in the forum instead. Please add a link to the forum discussion below so others can follow the thread. Many thanks.\r\n\r\nIt will be quite difficult to provide much help without being able to reproduce this behaviour. Please can you try and get things into a state that you can share, including your script and some example data that shows the same problem?","performed_via_github_app":null}]