{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16328","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16328/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16328/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16328/events","html_url":"https://github.com/elastic/elasticsearch/issues/16328","id":129999585,"node_id":"MDU6SXNzdWUxMjk5OTk1ODU=","number":16328,"title":"which operation has more priority in query_string?  AND or OR ","user":{"login":"gm06041","id":9133607,"node_id":"MDQ6VXNlcjkxMzM2MDc=","avatar_url":"https://avatars0.githubusercontent.com/u/9133607?v=4","gravatar_id":"","url":"https://api.github.com/users/gm06041","html_url":"https://github.com/gm06041","followers_url":"https://api.github.com/users/gm06041/followers","following_url":"https://api.github.com/users/gm06041/following{/other_user}","gists_url":"https://api.github.com/users/gm06041/gists{/gist_id}","starred_url":"https://api.github.com/users/gm06041/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gm06041/subscriptions","organizations_url":"https://api.github.com/users/gm06041/orgs","repos_url":"https://api.github.com/users/gm06041/repos","events_url":"https://api.github.com/users/gm06041/events{/privacy}","received_events_url":"https://api.github.com/users/gm06041/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-01-30T15:36:34Z","updated_at":"2016-01-31T16:19:22Z","closed_at":"2016-01-31T16:19:22Z","author_association":"NONE","active_lock_reason":null,"body":"i tested query_stirng like script below attached.(test ES version: 1.7.2)\nbut, i don't know why this result happened.\n\n(1) age:13 OR type:1 AND age:35 OR type:1       <strong>result=>  {\"name\":\"Paul\", \"age\":35, \"type\":1} </strong>\n(2) ((age:13 OR type:1) AND age:35) OR type:1   <strong>result=>  {\"name\":\"Paul\", \"age\":35, \"type\":1},{\"name\":\"Paul\", \"age\":13, \"type\":1}</strong>\n(3) age:13 OR (type:1 AND age:35) OR type:1     <strong>result=>  {\"name\":\"Paul\", \"age\":35, \"type\":1},{\"name\":\"Paul\", \"age\":13, \"type\":1}</strong>\n(4) (age:13 OR type:1) AND (age:35 OR type:1)     <strong>result=>  {\"name\":\"Paul\", \"age\":35, \"type\":1},{\"name\":\"Paul\", \"age\":13, \"type\":1}</strong>\n\n'(1)' query's result is different from '(2)', '(3)', '(4)'.\nif operation order is left to right, '(1)' query's result needes to be equal to be '(2)'.\nand if AND opeation has more priority,  '(1)' query's result needes to be equal to be '(3)'.\nbut nothing is matched. any reason?\n\n<pre>[root@hadoop1 bin]# curl -XPUT http://127.0.0.1:9200/test\n{\"acknowledged\":true}\n[root@hadoop1 bin]# curl -XPUT http://127.0.0.1:9200/test/mytype/1 -d '{\"name\":\"Paul\", \"age\":35, \"type\":1}'\n{\"_index\":\"test\",\"_type\":\"mytype\",\"_id\":\"1\",\"_version\":1,\"created\":true}\n[root@hadoop1 bin]# curl -XPUT http://127.0.0.1:9200/test/mytype/2 -d '{\"name\":\"Paul\", \"age\":13, \"type\":1}'\n{\"_index\":\"test\",\"_type\":\"mytype\",\"_id\":\"2\",\"_version\":1,\"created\":true}\n[root@hadoop1 bin]# curl -XPUT http://127.0.0.1:9200/test/mytype/3 -d '{\"name\":\"Paul\", \"age\":35, \"type\":2}'\n{\"_index\":\"test\",\"_type\":\"mytype\",\"_id\":\"3\",\"_version\":1,\"created\":true}\n[root@hadoop1 bin]# curl -XPOST localhost:9200/test/_search?pretty=true -d '{\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"age:13 OR type:1 AND age:35 OR type:1\"\n    }\n  }\n}'\n{\n  \"took\" : 2,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 1.125,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"mytype\",\n      \"_id\" : \"1\",\n      \"_score\" : 1.125,\n      \"_source\":{\"name\":\"Paul\", \"age\":35, \"type\":1}\n    } ]\n  }\n}\n[root@hadoop1 bin]# curl -XPOST localhost:9200/test/_search?pretty=true -d '{\n>   \"query\": {\n>     \"query_string\": {\n>       \"query\": \"((age:13 OR type:1) AND age:35) OR type:1\"\n>     }\n>   }\n> }'\n{\n  \"took\" : 1,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 2,\n    \"max_score\" : 1.25,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"mytype\",\n      \"_id\" : \"1\",\n      \"_score\" : 1.25,\n      \"_source\":{\"name\":\"Paul\", \"age\":35, \"type\":1}\n    }, {\n      \"_index\" : \"test\",\n      \"_type\" : \"mytype\",\n      \"_id\" : \"2\",\n      \"_score\" : 0.25,\n      \"_source\":{\"name\":\"Paul\", \"age\":13, \"type\":1}\n    } ]\n  }\n}\n[root@hadoop1 bin]# curl -XPOST localhost:9200/test/_search?pretty=true -d '{\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"age:13 OR (type:1 AND age:35) OR type:1\"\n    }\n  }\n}'\n{\n  \"took\" : 2,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 2,\n    \"max_score\" : 1.0,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"mytype\",\n      \"_id\" : \"1\",\n      \"_score\" : 1.0,\n      \"_source\":{\"name\":\"Paul\", \"age\":35, \"type\":1}\n    }, {\n      \"_index\" : \"test\",\n      \"_type\" : \"mytype\",\n      \"_id\" : \"2\",\n      \"_score\" : 0.6666667,\n      \"_source\":{\"name\":\"Paul\", \"age\":13, \"type\":1}\n    } ]\n  }\n}\n[root@hadoop1 bin]# curl -XPOST localhost:9200/test/_search?pretty=true -d '{\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"(age:13 OR type:1) AND (age:35 OR type:1)\"\n    }\n  }\n}'\n{\n  \"took\" : 2,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 2,\n    \"max_score\" : 1.25,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"mytype\",\n      \"_id\" : \"1\",\n      \"_score\" : 1.25,\n      \"_source\":{\"name\":\"Paul\", \"age\":35, \"type\":1}\n    }, {\n      \"_index\" : \"test\",\n      \"_type\" : \"mytype\",\n      \"_id\" : \"2\",\n      \"_score\" : 1.25,\n      \"_source\":{\"name\":\"Paul\", \"age\":13, \"type\":1}\n    } ]\n  }\n}</pre>\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}