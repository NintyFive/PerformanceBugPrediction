{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31545","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31545/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31545/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31545/events","html_url":"https://github.com/elastic/elasticsearch/issues/31545","id":335203790,"node_id":"MDU6SXNzdWUzMzUyMDM3OTA=","number":31545,"title":"Higher CPU usage during indexing in 6.3.0 compared to 6.2.4","user":{"login":"r-tock","id":11711723,"node_id":"MDQ6VXNlcjExNzExNzIz","avatar_url":"https://avatars2.githubusercontent.com/u/11711723?v=4","gravatar_id":"","url":"https://api.github.com/users/r-tock","html_url":"https://github.com/r-tock","followers_url":"https://api.github.com/users/r-tock/followers","following_url":"https://api.github.com/users/r-tock/following{/other_user}","gists_url":"https://api.github.com/users/r-tock/gists{/gist_id}","starred_url":"https://api.github.com/users/r-tock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r-tock/subscriptions","organizations_url":"https://api.github.com/users/r-tock/orgs","repos_url":"https://api.github.com/users/r-tock/repos","events_url":"https://api.github.com/users/r-tock/events{/privacy}","received_events_url":"https://api.github.com/users/r-tock/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2018-06-24T19:11:51Z","updated_at":"2019-07-05T11:17:45Z","closed_at":"2019-07-05T11:17:45Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\n6.3.0\r\n\r\n**Plugins installed**: []\r\nDefault + discovery-gce\r\n\r\n**JVM version** (`java -version`):\r\njava version \"10.0.1\" 2018-04-17\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux  4.9.0-4-amd64 #1 SMP Debian 4.9.65-3 (2017-12-03) x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nIn 6.2.4 during batch indexing the CPU rarely went over 60%. \r\nIn 6.3.0 during batch indexing the CPU is pegged at 100% \r\n\r\nTotal indexing time of our workload has increased 2x\r\nWe did Java 10 Upgrade as part of 6.3.0 upgrade which is the only other major change between the data and instances.\r\n\r\n**Steps to reproduce**:\r\n\r\nFeatures used:\r\nOur index is pretty vanilla with the exception of a suggest field and 1 suggest context field/\r\nCompletionSuggestion\r\nCompletion Context\r\n\r\nNumber of fields in the corpus ~100\r\n\r\n**Provide logs (if relevant)**:\r\nDuring batch indexing the only logs that are emitted are as follows\r\n\r\n```\r\n[2018-06-24T16:37:09,223][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][558867] overhead, spent [255ms] collecting in the last [1s]\r\n[2018-06-24T16:37:15,272][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][558873] overhead, spent [257ms] collecting in the last [1s]\r\n[2018-06-24T16:37:36,392][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][558894] overhead, spent [252ms] collecting in the last [1s]\r\n[2018-06-24T16:39:11,675][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][558989] overhead, spent [261ms] collecting in the last [1s]\r\n[2018-06-24T16:39:29,709][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][559007] overhead, spent [251ms] collecting in the last [1s]\r\n[2018-06-24T16:40:27,883][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][559065] overhead, spent [337ms] collecting in the last [1s]\r\n[2018-06-24T16:40:48,932][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][559086] overhead, spent [261ms] collecting in the last [1s]\r\n[2018-06-24T16:44:21,849][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][559298] overhead, spent [257ms] collecting in the last [1s]\r\n[2018-06-24T16:45:46,291][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][559382] overhead, spent [272ms] collecting in the last [1s]\r\n[2018-06-24T16:45:52,340][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][559388] overhead, spent [255ms] collecting in the last [1s]\r\n[2018-06-24T16:45:58,368][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][559394] overhead, spent [272ms] collecting in the last [1s]\r\n[2018-06-24T17:00:00,768][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][560234] overhead, spent [261ms] collecting in the last [1s]\r\n[2018-06-24T17:13:40,545][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][561051] overhead, spent [309ms] collecting in the last [1s]\r\n[2018-06-24T17:16:39,255][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][561229] overhead, spent [379ms] collecting in the last [1s]\r\n[2018-06-24T17:26:19,227][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][561807] overhead, spent [259ms] collecting in the last [1s]\r\n[2018-06-24T17:27:51,484][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][561899] overhead, spent [262ms] collecting in the last [1s]\r\n[2018-06-24T17:34:26,659][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][562293] overhead, spent [274ms] collecting in the last [1s]\r\n[2018-06-24T17:36:33,977][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][562420] overhead, spent [344ms] collecting in the last [1s]\r\n[2018-06-24T17:47:06,394][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][563049] overhead, spent [263ms] collecting in the last [1s]\r\n[2018-06-24T17:47:21,499][INFO ][o.e.m.j.JvmGcMonitorService] [entities-search-2017-12-11-37j8] [gc][563064] overhead, spent [263ms] collecting in the last [1s]\r\n```\r\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}