{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44172","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44172/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44172/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44172/events","html_url":"https://github.com/elastic/elasticsearch/issues/44172","id":466350639,"node_id":"MDU6SXNzdWU0NjYzNTA2Mzk=","number":44172,"title":"Pushing auto-follow-pattern results in a Null pointer exception on elasticsearch side","user":{"login":"seenkley","id":12306801,"node_id":"MDQ6VXNlcjEyMzA2ODAx","avatar_url":"https://avatars1.githubusercontent.com/u/12306801?v=4","gravatar_id":"","url":"https://api.github.com/users/seenkley","html_url":"https://github.com/seenkley","followers_url":"https://api.github.com/users/seenkley/followers","following_url":"https://api.github.com/users/seenkley/following{/other_user}","gists_url":"https://api.github.com/users/seenkley/gists{/gist_id}","starred_url":"https://api.github.com/users/seenkley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seenkley/subscriptions","organizations_url":"https://api.github.com/users/seenkley/orgs","repos_url":"https://api.github.com/users/seenkley/repos","events_url":"https://api.github.com/users/seenkley/events{/privacy}","received_events_url":"https://api.github.com/users/seenkley/received_events","type":"User","site_admin":false},"labels":[{"id":912824565,"node_id":"MDU6TGFiZWw5MTI4MjQ1NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CCR","name":":Distributed/CCR","color":"0e8a16","default":false,"description":"Issues around the Cross Cluster State Replication features"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-07-10T14:42:12Z","updated_at":"2019-07-16T21:24:25Z","closed_at":"2019-07-16T21:24:25Z","author_association":"NONE","active_lock_reason":null,"body":"Copy - paste from here https://discuss.elastic.co/t/pushing-auto-follow-pattern-results-in-a-null-pointer-exception-on-elasticsearch-side/189666/2\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n6.8.1\r\n**Plugins installed**: []\r\nnone.\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_212\"\r\nOpenJDK Runtime Environment (AdoptOpenJDK)(build 1.8.0_212-b04)\r\nOpenJDK 64-Bit Server VM (AdoptOpenJDK)(build 25.212-b04, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux ip-10-176-68-180 4.14.62-65.117.amzn1.x86_64 #1 SMP Fri Aug 10 20:03:52 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n\r\nSo, we installed elasticsearch 6.8.1 on 6 nodes and are trying to setup CCR with two clusters - 3 nodes each. License is activated and valid, remote settings are set (seed, nodes and cluster name). But now, somehow when I try to push the autofollow pattern like this\r\n\r\n``` \r\ncurl -X PUT \"localhost:9200/_ccr/auto_follow/AutoFollowerPatterns\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"remote_cluster\" : \"elastic-uswest\",\r\n  \"leader_index_patterns\" :\r\n  [\r\n    \"visit*\"\r\n  ],\r\n  \"follow_index_pattern\" : \"ccr-{{leader_index}}\"\r\n}\r\n'\r\n``` \r\nit results into that response:\r\n\r\n```\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"remote_transport_exception\",\r\n        \"reason\" : \"[10.176.70.184][10.176.70.184:9300][cluster:admin/xpack/ccr/auto_follow_pattern/put]\"\r\n      }\r\n    ],\r\n    \"type\" : \"null_pointer_exception\",\r\n    \"reason\" : null\r\n  },\r\n  \"status\" : 500\r\n}\r\n```\r\nDigging a bit deeper into the logs of elasticsearch, we can see this message:\r\n```\r\n[2019-07-09T10:10:49,510][WARN ][r.suppressed             ] [10.176.68.180] path: /_ccr/auto_follow/AutoFollowerPatterns, params: {name=AutoFollowerPatterns}\r\norg.elasticsearch.transport.RemoteTransportException: [10.176.69.160][10.176.69.160:9300][cluster:admin/xpack/ccr/auto_follow_pattern/put]\r\nCaused by: java.lang.NullPointerException\r\n        at org.elasticsearch.xpack.ccr.CcrLicenseChecker.hasPrivilegesToFollowIndices(CcrLicenseChecker.java:318) ~[?:?]\r\n        at org.elasticsearch.xpack.ccr.action.TransportPutAutoFollowPatternAction.lambda$masterOperation$2(TransportPutAutoFollowPatternAction.java:88) ~[?:?]\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:61) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.action.ActionListenerResponseHandler.handleResponse(ActionListenerResponseHandler.java:54) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1104) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.transport.TcpTransport$1.doRun(TcpTransport.java:985) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.common.util.concurrent.EsExecutors$DirectExecutorService.execute(EsExecutors.java:193) ~[elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.transport.TcpTransport.handleResponse(TcpTransport.java:977) [elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:952) [elasticsearch-6.8.1.jar:6.8.1]\r\n        at org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:763) [elasticsearch-6.8.1.jar:6.8.1]\r\n...\r\n```\r\nOur initial thought was, that the security module could cause the error - because of this word in the exception: hasPrivilegesToFollowIndices. So, we removed all unnecessary modules and the error still occurs.\r\n\r\n**Installed modules:**\r\n![image](https://user-images.githubusercontent.com/12306801/60977862-7482d600-a330-11e9-9df9-a252d9ee3b5b.png)\r\n\r\n\r\n**Steps to reproduce**:\r\nSadly, I cannot reproduce the bug. When I tried it, it always worked fine. It happened on this one particular environment and now we cannot fix it. \r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}