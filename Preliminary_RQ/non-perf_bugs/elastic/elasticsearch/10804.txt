{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10804","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10804/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10804/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10804/events","html_url":"https://github.com/elastic/elasticsearch/issues/10804","id":70894781,"node_id":"MDU6SXNzdWU3MDg5NDc4MQ==","number":10804,"title":"Infinity values at bounding-box when calculating the geo-bounds aggregate with many buckets","user":{"login":"plroit","id":1734563,"node_id":"MDQ6VXNlcjE3MzQ1NjM=","avatar_url":"https://avatars3.githubusercontent.com/u/1734563?v=4","gravatar_id":"","url":"https://api.github.com/users/plroit","html_url":"https://github.com/plroit","followers_url":"https://api.github.com/users/plroit/followers","following_url":"https://api.github.com/users/plroit/following{/other_user}","gists_url":"https://api.github.com/users/plroit/gists{/gist_id}","starred_url":"https://api.github.com/users/plroit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/plroit/subscriptions","organizations_url":"https://api.github.com/users/plroit/orgs","repos_url":"https://api.github.com/users/plroit/repos","events_url":"https://api.github.com/users/plroit/events{/privacy}","received_events_url":"https://api.github.com/users/plroit/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":204320058,"node_id":"MDU6TGFiZWwyMDQzMjAwNTg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.5.3","name":"v1.5.3","color":"dddddd","default":false,"description":null},{"id":182334038,"node_id":"MDU6TGFiZWwxODIzMzQwMzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.6.0","name":"v1.6.0","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2015-04-25T11:24:50Z","updated_at":"2015-10-22T13:07:16Z","closed_at":"2015-05-05T08:58:58Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nI am following the example at: \nhttp://www.elastic.co/guide/en/elasticsearch/guide/current/geo-bounds-agg.html\nto create an aggregation of some sample data according to their geohash cells, \nand return the geo-bounds of the result set in the bucket.\n\n```\n    \"aggs\": {\n        \"bucket\" : {\n            \"geohash_grid\" : {\n                \"field\": \"centroid\",\n                \"precision\": 8\n            },\n            \"aggs\": {\n                \"cell\": {\n                    \"geo_bounds\": {\n                        \"field\": \"centroid\"\n                    }\n                }\n            }\n        }\n    }\n```\n\nI have noticed that when my precision becomes higher the returned geo-bounds contain\ninfinity values for longitude and latitude. The bbox in every bounds object is of the following form: \n\n```\n                  \"bounds\": {\n                     \"top_left\": {\n                        \"lat\": 49.611142831107415,\n                        \"lon\": \"-Infinity\"\n                     },\n                     \"bottom_right\": {\n                        \"lat\": \"-Infinity\",\n                        \"lon\": \"-Infinity\"\n                     }\n                  }\n```\n\n(only top-left.lat changes)\n\nReducing the number of buckets by geo-filtering seems to help but is very limiting.\nFor example, I applied a geo-bounding-box filter with the bounds of a \nsingle geo-hash cell of precision 6, then geo-aggregated using precision 7,\nwith 32 buckets that returned fine. However geo-aggregating with precision 8\n(returning 1024 buckets) have produced the incorrect geo-bounds.\n\nThe mapping that I've used:\n\n```\n            \"properties\": {\n               \"centroid\": {\n                  \"type\": \"geo_point\",\n                  \"lat_lon\": true,\n                  \"geohash\": true,\n                  \"geohash_prefix\": true,\n                  \"geohash_precision\": 11\n               },\n               \"geom\": {\n                  \"type\": \"geo_shape\",\n                  \"tree_levels\": 10\n               },\n               \"name\": {\n                  \"type\": \"string\"\n               },\n               \"osmId\": {\n                  \"type\": \"long\"\n               },\n               \"type\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n               }\n            }\n```\n\nThanks\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}