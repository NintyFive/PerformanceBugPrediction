{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16920","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16920/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16920/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16920/events","html_url":"https://github.com/elastic/elasticsearch/issues/16920","id":138124353,"node_id":"MDU6SXNzdWUxMzgxMjQzNTM=","number":16920,"title":"Query time boost for _all field","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-03-03T09:25:37Z","updated_at":"2017-03-31T09:34:20Z","closed_at":"2017-03-31T09:34:20Z","author_association":"MEMBER","active_lock_reason":null,"body":"Index time boost in the _all field is currently done via payload. For each token/position we encode a float in the payload that is used at query time to influence the score of the query. The boost value is extracted from the mapping at index time when the value of a field is copied into _all.\nFor instance:\n\n```\n{\n    \"mappings\": {\n        \"type1\": {\n            \"properties\": {\n                \"title\": {\n                    \"type\": \"string\",\n                    \"boost\": 3.5\n                }\n            }\n        }\n    }\n}\n```\n\nwhen querying the `_all` field, words that originated from the `title` field will have their score multiplied by 3.5. Unfortunately you cannot change this value without reindexing your data.\n## Proposal\n\nNow that the dynamic boost at index time is prohibited (only field boost mapping is allowed) we could investigate an hybrid approach where instead of directly encoding a boost value in the payload we would encode a small number that refers to a class of score. \nSuppose you have 3 fields in your mapping and you want to be able to score them differently in the _all fields. By assigning 3 classes of score (0, 1, 2) it is easy to remap those classes at query time into different boost values.\nFor instance a query with index time boost could look like this:\n\n```\n{\n    \"mappings\": {\n        \"test\": {\n            \"properties\": {\n                \"title\": {\n                    \"type\": \"string\",\n                    \"payload\": 0\n                },\n                \"text\": {\n                    \"type\": \"string\",\n                    \"payload\": 1\n                },\n                \"author\": {\n                    \"type\": \"string\",\n                    \"payload\": 2\n                }\n            }\n        }\n    }\n}\n\n{\n   \"query\": {\n     \"payload_score_remap\": {\n         \"0\": 2.45,\n         \"1\": 3.45,\n         \"2\": 0.75,\n         \"mode\": \"max\"\n      },\n      \"query_string\": {\n         \"query\": \"foo bar\"\n      }\n   }\n}\n```\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}