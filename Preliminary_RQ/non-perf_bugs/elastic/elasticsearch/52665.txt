{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52665","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52665/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52665/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52665/events","html_url":"https://github.com/elastic/elasticsearch/issues/52665","id":569191178,"node_id":"MDU6SXNzdWU1NjkxOTExNzg=","number":52665,"title":"Tune the number of connections per remote cluster.","user":{"login":"Joseph-R","id":7227022,"node_id":"MDQ6VXNlcjcyMjcwMjI=","avatar_url":"https://avatars1.githubusercontent.com/u/7227022?v=4","gravatar_id":"","url":"https://api.github.com/users/Joseph-R","html_url":"https://github.com/Joseph-R","followers_url":"https://api.github.com/users/Joseph-R/followers","following_url":"https://api.github.com/users/Joseph-R/following{/other_user}","gists_url":"https://api.github.com/users/Joseph-R/gists{/gist_id}","starred_url":"https://api.github.com/users/Joseph-R/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Joseph-R/subscriptions","organizations_url":"https://api.github.com/users/Joseph-R/orgs","repos_url":"https://api.github.com/users/Joseph-R/repos","events_url":"https://api.github.com/users/Joseph-R/events{/privacy}","received_events_url":"https://api.github.com/users/Joseph-R/received_events","type":"User","site_admin":false},"labels":[{"id":146854632,"node_id":"MDU6TGFiZWwxNDY4NTQ2MzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Network","name":":Distributed/Network","color":"0e8a16","default":false,"description":"Http and internode communication implementations"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-02-21T21:22:58Z","updated_at":"2020-03-04T14:40:54Z","closed_at":"2020-02-27T16:46:53Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\n**Describe the feature**:  \r\nWe want to be able to define the number of connections per remote cluster.  **cluster.remote.connections_per_cluster** currently scoped to apply to all remote clusters configured.  We would prefer to be able to set or override this setting.  Ideally dynamically, through the cluster settings API.\r\n\r\nUse case:  We are using several smaller clusters (4-6 data nodes) and a few larger ones (60+ data nodes).  With cluster.remote.connections_per_cluster we are currently limited to our smallest cluster.  \r\n\r\n**Steps to reproduce**:\r\n```\r\n# Despite the name, cluster.remote.connections_per_cluster is not scoped per cluster.  \r\n# Tosses an illegal_argument_exception if you attempt to assign it per cluster:\r\n\r\njreid:~$ curl -k -X PUT 'https://cluster.fqdn.com:9200/_cluster/settings' -i -H \"Content-type: application/json\" -d '\r\n> {\r\n>   \"persistent\": {\r\n>     \"cluster\": {\r\n>       \"remote\": {\r\n>         \"cluster_1\": {\r\n>           \"connections_per_cluster\": 30,\r\n>           \"skip_unavailable\": \"true\",\r\n>           \"seeds\": [\"10.20.8.38:9300\",\"10.22.1.58:9300\",\"10.22.12.167:9300\",\"10.22.2.61:9300\",\"10.20.14.34:9300\",\"10.20.10.232:9300\"]\r\n>         },\r\n>         \"cluster_2\": {\r\n>           \"skip_unavailable\": \"true\",\r\n>           \"seeds\": [\"10.208.241.166:9300\",\"10.208.246.127:9300\",\"10.208.247.70:9300\",\"10.208.251.122:9300\"]\r\n>         },\r\n>         \"cluster_3\": {\r\n>           \"skip_unavailable\": \"true\",\r\n>           \"seeds\": [\"10.224.244.17:9300\",\"10.224.240.100:9300\",\"10.224.242.208:9300\"]\r\n>         }\r\n>       }\r\n>     }\r\n>   }\r\n> }\r\n> '\r\nHTTP/1.1 400 Bad Request\r\ncontent-type: application/json; charset=UTF-8\r\nContent-Length: 342\r\nConnection: keep-alive\r\n\r\n{\"error\":{\"root_cause\":[{\"type\":\"remote_transport_exception\",\"reason\":\"[elasticsearch-master-i-028d72107dd91e6e5][10.246.20.247:9300][cluster:admin/settings/update]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"persistent setting [cluster.remote.cluster_1.connections_per_cluster], not recognized\"},\"status\":400}\r\n\r\n# So cluster.remote.connections_per_cluster is a cluster-wide setting on our primary cluster, which will apply to each remote cluster specified.  Not ideal, especially for our setup where there are two relatively small clusters (4 data nodes each) and one larger one (60 nodes).  We are limited by our GCD between the clusters.\r\n\r\n# Even so, we get a \"not dynamically updateable\" error when attempting to apply via the API.  This setting needs to be changed in the elasticsearch.yml.  That is not particularly clear from the official documentation.\r\n\r\njreid:~$ curl -k -X PUT 'https://cluster.fqdn.com:9200/_cluster/settings' -i -H \"Content-type: application/json\" -d '\r\n> {\r\n>   \"persistent\": {\r\n>     \"cluster\": {\r\n>       \"remote\": {\r\n>         \"connections_per_cluster\": 4,\r\n>         \"cluster_1\": {\r\n>           \"skip_unavailable\": \"true\",\r\n>           \"seeds\": [\"10.20.8.38:9300\",\"10.22.1.58:9300\",\"10.22.12.167:9300\",\"10.22.2.61:9300\",\"10.20.14.34:9300\",\"10.20.10.232:9300\"]\r\n>         },\r\n>         \"cluster_2\": {\r\n>           \"skip_unavailable\": \"true\",\r\n>           \"seeds\": [\"10.208.241.166:9300\",\"10.208.246.127:9300\",\"10.208.247.70:9300\",\"10.208.251.122:9300\"]\r\n>         },\r\n>         \"cluster_3\": {\r\n>           \"skip_unavailable\": \"true\",\r\n>           \"seeds\": [\"10.224.244.17:9300\",\"10.224.240.100:9300\",\"10.224.242.208:9300\"]\r\n>         }\r\n>       }\r\n>     }\r\n>   }\r\n> }\r\n> '\r\nHTTP/1.1 400 Bad Request\r\ncontent-type: application/json; charset=UTF-8\r\nContent-Length: 350\r\nConnection: keep-alive\r\n\r\n{\"error\":{\"root_cause\":[{\"type\":\"remote_transport_exception\",\"reason\":\"[elasticsearch-master-i-028d72107dd91e6e5][10.246.20.247:9300][cluster:admin/settings/update]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"persistent setting [cluster.remote.connections_per_cluster], not dynamically updateable\"},\"status\":400}\r\n```","closed_by":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"performed_via_github_app":null}