[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/359885941","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-359885941","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":359885941,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTg4NTk0MQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-01-23T18:32:31Z","updated_at":"2018-01-23T18:32:31Z","author_association":"CONTRIBUTOR","body":"Ok. I can't reproduce this one but I have a theory and I'll push a clean up that might prevent this in the future. Might.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/359893527","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-359893527","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":359893527,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTg5MzUyNw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-01-23T18:57:36Z","updated_at":"2018-01-23T18:57:36Z","author_association":"CONTRIBUTOR","body":"I pushed eded5bc4f3776c9841a4995972f29c6c07d81c46 to try and prevent this from happening again but it might not work. I wasn't able to reproduce locally so it is kind of a shot in the dark.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/374621747","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-374621747","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":374621747,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NDYyMTc0Nw==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2018-03-20T14:39:07Z","updated_at":"2018-03-20T14:39:07Z","author_association":"MEMBER","body":"I searched through my mail and wasn't able to find another failure from this after the push Nik made, so I am closing this for now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409953265","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-409953265","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":409953265,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTk1MzI2NQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-08-02T14:48:29Z","updated_at":"2018-08-02T14:48:29Z","author_association":"MEMBER","body":"This seems to have occurred again in http://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+intake/2202","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409953390","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-409953390","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":409953390,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTk1MzM5MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-02T14:48:51Z","updated_at":"2018-08-02T14:48:51Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409959754","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-409959754","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":409959754,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTk1OTc1NA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-08-02T15:06:14Z","updated_at":"2018-08-02T15:06:14Z","author_association":"CONTRIBUTOR","body":":cry: \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/410649199","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-410649199","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":410649199,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMDY0OTE5OQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-08-06T09:37:47Z","updated_at":"2018-08-06T09:37:47Z","author_association":"CONTRIBUTOR","body":"Not sure if it helps, but in the logs I see an earlier assertion failure:\r\n\r\n```\r\n  2> WARNING: Uncaught exception in thread: Thread[elasticsearch[node_sd1][clusterApplierService#updateTask][T#1],5,TGRP-ReindexFailureTests]\r\n  2> java.lang.AssertionError\r\n  2>  at __randomizedtesting.SeedInfo.seed([401B0C5B3206920F]:0)\r\n  2>  at org.elasticsearch.index.search.stats.ShardSearchStats.onFreeScrollContext(ShardSearchStats.java:182)\r\n  2>  at org.elasticsearch.index.shard.SearchOperationListener$CompositeListener.onFreeScrollContext(SearchOperationListener.java:233)\r\n  2>  at org.elasticsearch.search.SearchService.freeContext(SearchService.java:638)\r\n  2>  at org.elasticsearch.search.SearchService.freeAllContextForIndex(SearchService.java:625)\r\n  2>  at org.elasticsearch.search.SearchService.afterIndexRemoved(SearchService.java:231)\r\n  2>  at org.elasticsearch.index.CompositeIndexEventListener.afterIndexRemoved(CompositeIndexEventListener.java:195)\r\n  2>  at org.elasticsearch.indices.IndicesService.removeIndex(IndicesService.java:557)\r\n  2>  at org.elasticsearch.indices.cluster.IndicesClusterStateService.deleteIndices(IndicesClusterStateService.java:285)\r\n  2>  at org.elasticsearch.indices.cluster.IndicesClusterStateService.applyClusterState(IndicesClusterStateService.java:219)\r\n  2>  at org.elasticsearch.cluster.service.ClusterApplierService.lambda$callClusterStateAppliers$6(ClusterApplierService.java:498)\r\n  2>  at java.lang.Iterable.forEach(Iterable.java:75)\r\n  2>  at org.elasticsearch.cluster.service.ClusterApplierService.callClusterStateAppliers(ClusterApplierService.java:495)\r\n  2>  at org.elasticsearch.cluster.service.ClusterApplierService.applyChanges(ClusterApplierService.java:482)\r\n  2>  at org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:432)\r\n  2>  at org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:161)\r\n  2>  at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:566)\r\n  2>  at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244)\r\n  2>  at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207)\r\n  2>  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n```\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423823516","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-423823516","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":423823516,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzgyMzUxNg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-09-23T15:12:28Z","updated_at":"2018-09-23T15:12:28Z","author_association":"CONTRIBUTOR","body":"I've added the 6.5.0 label to this. I'm honestly not that involved with reindex at this point so I'm not sure I'm the right person for this. But i don't think *anyone* is super involved in reindex right now.\r\n\r\nFor what it is worth: this looks to only be an issue on 6.x. The test is only muted in 6.x and i haven't seen a fairly of it in master.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453453645","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-453453645","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":453453645,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzQ1MzY0NQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-01-11T09:40:57Z","updated_at":"2019-01-11T09:41:36Z","author_association":"CONTRIBUTOR","body":"I've unmuted testResponseOnSearchFailure on 6.x (see 02509c71249). I don't think that this is a reindex bug, but as @DaveCTurner pointed out, a problem in another component. As there are no recent failures, there is nothing we can investigate here. I'm therefore closing this issue. If there are more occurrences of this, please reopen and provide a link to a recent failure.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495693131","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-495693131","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":495693131,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTY5MzEzMQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T16:13:29Z","updated_at":"2019-05-24T16:13:29Z","author_association":"MEMBER","body":"Another instance on master: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/3712/\r\n\r\n```\r\njava.lang.AssertionError: There are still [1] in-flight contexts. The first one's creation site is listed as the cause of this exception.\r\n\tat org.elasticsearch.search.MockSearchService.assertNoInFlightContext(MockSearchService.java:51)\r\n\tat org.elasticsearch.test.ESTestCase.lambda$ensureAllSearchContextsReleased$6(ESTestCase.java:503)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:862)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:836)\r\n\tat org.elasticsearch.test.ESTestCase.ensureAllSearchContextsReleased(ESTestCase.java:503)\r\n```\r\n```\r\nREPRODUCE WITH: ./gradlew :modules:reindex:test --tests \"org.elasticsearch.index.reindex.ReindexFailureTests.testResponseOnSearchFailure\" -Dtests.seed=25A63C7B43796EB8 -Dtests.security.manager=true -Dtests.locale=az -Dtests.timezone=Africa/Ceuta -Dcompiler.java=12 -Druntime.java=11\r\n```\r\n\r\nLog: [reindex.txt](https://github.com/elastic/elasticsearch/files/3217741/reindex.txt)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495693318","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-495693318","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":495693318,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTY5MzMxOA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T16:14:01Z","updated_at":"2019-05-24T16:14:01Z","author_association":"MEMBER","body":"/cc @henningandersen @tbrooks8 ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495694824","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-495694824","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":495694824,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTY5NDgyNA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T16:18:18Z","updated_at":"2019-05-24T16:18:18Z","author_association":"MEMBER","body":"It seems there's a race between releasing scrolls and deleting indices.\r\n\r\n```\r\n2> may 24, 2019 6:05:51 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n  2> WARNING: Uncaught exception in thread: Thread[elasticsearch[node_sd2][clusterApplierService#updateTask][T#1],5,TGRP-ReindexFailureTests]\r\n  2> java.lang.AssertionError\r\n  2> \tat __randomizedtesting.SeedInfo.seed([25A63C7B43796EB8]:0)\r\n  2> \tat org.elasticsearch.index.search.stats.ShardSearchStats.onFreeScrollContext(ShardSearchStats.java:166)\r\n  2> \tat org.elasticsearch.index.shard.SearchOperationListener$CompositeListener.onFreeScrollContext(SearchOperationListener.java:232)\r\n  2> \tat org.elasticsearch.search.SearchService.freeContext(SearchService.java:655)\r\n  2> \tat org.elasticsearch.search.SearchService.freeAllContextForIndex(SearchService.java:642)\r\n  2> \tat org.elasticsearch.search.SearchService.afterIndexRemoved(SearchService.java:273)\r\n  2> \tat org.elasticsearch.index.CompositeIndexEventListener.afterIndexRemoved(CompositeIndexEventListener.java:201)\r\n  2> \tat org.elasticsearch.indices.IndicesService.removeIndex(IndicesService.java:701)\r\n  2> \tat org.elasticsearch.indices.cluster.IndicesClusterStateService.deleteIndices(IndicesClusterStateService.java:321)\r\n  2> \tat org.elasticsearch.indices.cluster.IndicesClusterStateService.applyClusterState(IndicesClusterStateService.java:255)\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService.lambda$callClusterStateAppliers$5(ClusterApplierService.java:489)\r\n  2> \tat java.base/java.lang.Iterable.forEach(Iterable.java:75)\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService.callClusterStateAppliers(ClusterApplierService.java:487)\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService.applyChanges(ClusterApplierService.java:464)\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:418)\r\n  2> \tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:165)\r\n  2> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:687)\r\n  2> \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:252)\r\n  2> \tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:215)\r\n  2> \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n  2> \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n  2> \tat java.base/java.lang.Thread.run(Thread.java:834)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/496199779","html_url":"https://github.com/elastic/elasticsearch/issues/28053#issuecomment-496199779","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28053","id":496199779,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NjE5OTc3OQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-05-27T12:41:16Z","updated_at":"2019-05-27T12:41:16Z","author_association":"CONTRIBUTOR","body":"I think the race is between creating a new search context and deleting an index. When creating a new search context, we add it to the set of active contexts first and then notify listener. When deactivating a search context, we remove it from set of active contexts and then notify listener. This can go wrong, in case the deactivation happens between adding to the set and notifying the listener.\r\n#20916 mentions that `testSearchWhileIndexDeleted` failed during PR build, might be similar issue.","performed_via_github_app":null}]