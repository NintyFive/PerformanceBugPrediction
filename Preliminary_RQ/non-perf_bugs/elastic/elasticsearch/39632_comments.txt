[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469201076","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469201076","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469201076,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTIwMTA3Ng==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T10:27:47Z","updated_at":"2019-03-04T10:27:47Z","author_association":"CONTRIBUTOR","body":"Hello @hiimdoublej,\r\n\r\nIt would be helpful if you could provide some more info:\r\n\r\n- What do you mean rolling upgrade 6.3.0 -> 6.6.1. You say it's a single node cluster.\r\n- Did you change something in the OS: configuration, packages/kernel upgrade?\r\n- Could you provide the output of `dmesg`?\r\n- Can you set the `ulimit -c unlimited`, restart the instance and provide the core dump once it fails again?\r\n\r\nSome suggestions to try out:\r\n- Is it possible to move your node to another machine (suspecting h/w failure) and try it there?\r\n- Could you also try to run it with java 11 ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469209586","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469209586","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469209586,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTIwOTU4Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T10:54:20Z","updated_at":"2019-03-04T10:54:20Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469218996","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469218996","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469218996,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTIxODk5Ng==","user":{"login":"hiimdoublej","id":19603654,"node_id":"MDQ6VXNlcjE5NjAzNjU0","avatar_url":"https://avatars3.githubusercontent.com/u/19603654?v=4","gravatar_id":"","url":"https://api.github.com/users/hiimdoublej","html_url":"https://github.com/hiimdoublej","followers_url":"https://api.github.com/users/hiimdoublej/followers","following_url":"https://api.github.com/users/hiimdoublej/following{/other_user}","gists_url":"https://api.github.com/users/hiimdoublej/gists{/gist_id}","starred_url":"https://api.github.com/users/hiimdoublej/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hiimdoublej/subscriptions","organizations_url":"https://api.github.com/users/hiimdoublej/orgs","repos_url":"https://api.github.com/users/hiimdoublej/repos","events_url":"https://api.github.com/users/hiimdoublej/events{/privacy}","received_events_url":"https://api.github.com/users/hiimdoublej/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T11:27:23Z","updated_at":"2019-03-04T11:30:59Z","author_association":"NONE","body":"1. I followed [this official guide](https://www.elastic.co/guide/en/elasticsearch/reference/current/rolling-upgrades.html) to upgrade from 6.3.0 -> 6.6.1, hence I used the term 'rolling upgrade', maybe in my case just a simple 'upgrade' would do it, not trying to steer people off the wrong way here, sorry about that.\r\n2. I did not change anything system-wise, but I did change the number of cpu cores from 4 to 2 (since it's a gcp machine and we're reducing the cost) and reboot.\r\n3. I did not check `dmesg`, but now that you mentioned it, I took a look and made a [gist](https://gist.github.com/hiimdoublej/2ee657759ade9eda05b3d0f064b7fa63) with it, on line 429, it did say a volume was not mounted properly, I'll try to fix it and report back here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469224943","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469224943","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469224943,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTIyNDk0Mw==","user":{"login":"hiimdoublej","id":19603654,"node_id":"MDQ6VXNlcjE5NjAzNjU0","avatar_url":"https://avatars3.githubusercontent.com/u/19603654?v=4","gravatar_id":"","url":"https://api.github.com/users/hiimdoublej","html_url":"https://github.com/hiimdoublej","followers_url":"https://api.github.com/users/hiimdoublej/followers","following_url":"https://api.github.com/users/hiimdoublej/following{/other_user}","gists_url":"https://api.github.com/users/hiimdoublej/gists{/gist_id}","starred_url":"https://api.github.com/users/hiimdoublej/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hiimdoublej/subscriptions","organizations_url":"https://api.github.com/users/hiimdoublej/orgs","repos_url":"https://api.github.com/users/hiimdoublej/repos","events_url":"https://api.github.com/users/hiimdoublej/events{/privacy}","received_events_url":"https://api.github.com/users/hiimdoublej/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T11:50:05Z","updated_at":"2019-03-04T11:50:05Z","author_association":"NONE","body":"1. I fixed the volume with `fsck` , problem persists\r\n2. I did `sudo ulimit -c unlimited` then `sudo ulimit -a` to see it's set to unlimited , finally`sudo systemctl start elasticsearch` to run ES, in 15 minutes it crashed, but the `hs_err` file says that it failed to write core dumps and core dumps have been disabled....strange\r\nI'll try java 11 next and report back, thanks for your help.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469255586","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469255586","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469255586,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTI1NTU4Ng==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T13:38:25Z","updated_at":"2019-03-04T13:38:25Z","author_association":"CONTRIBUTOR","body":"1. Can you attach the new failure? (cannot write core dumps)\r\n2. Do you see any errors in the ES log file?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469272570","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469272570","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469272570,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTI3MjU3MA==","user":{"login":"hiimdoublej","id":19603654,"node_id":"MDQ6VXNlcjE5NjAzNjU0","avatar_url":"https://avatars3.githubusercontent.com/u/19603654?v=4","gravatar_id":"","url":"https://api.github.com/users/hiimdoublej","html_url":"https://github.com/hiimdoublej","followers_url":"https://api.github.com/users/hiimdoublej/followers","following_url":"https://api.github.com/users/hiimdoublej/following{/other_user}","gists_url":"https://api.github.com/users/hiimdoublej/gists{/gist_id}","starred_url":"https://api.github.com/users/hiimdoublej/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hiimdoublej/subscriptions","organizations_url":"https://api.github.com/users/hiimdoublej/orgs","repos_url":"https://api.github.com/users/hiimdoublej/repos","events_url":"https://api.github.com/users/hiimdoublej/events{/privacy}","received_events_url":"https://api.github.com/users/hiimdoublej/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T14:30:56Z","updated_at":"2019-03-04T14:37:26Z","author_association":"NONE","body":"1. The most recent failure is [here](https://gist.github.com/hiimdoublej/0b80441ad094483f59d5263794fdc049). I did a bit of research on `ulimit` ,I found out that in case the ES is started using `systemd`, I cannot simply do `ulimit -c unlimited`, I have to add `LimitCore=infinity` in my ES service file under the `[service]` directive. I'll check if core dumps are successful.\r\n2. No, just normal startup messages after silent failure in `elasticsearch.log`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469298558","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469298558","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469298558,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTI5ODU1OA==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T15:39:50Z","updated_at":"2019-03-04T15:40:51Z","author_association":"CONTRIBUTOR","body":"Once the node is started and before it fails:\r\nIs the cluster in green state or Is it still recovering shards?\r\nIs it idle or do you run operations (index/update/delete/search, etc.) ?\r\n\r\nCould you also provide the `elasticsearch.log` from the moment of a startup until the failure?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469353286","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469353286","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469353286,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTM1MzI4Ng==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T18:02:18Z","updated_at":"2019-03-04T18:02:18Z","author_association":"CONTRIBUTOR","body":"Another suggestion would be to try `niofs`: https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules-store.html","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469501994","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469501994","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469501994,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTUwMTk5NA==","user":{"login":"hiimdoublej","id":19603654,"node_id":"MDQ6VXNlcjE5NjAzNjU0","avatar_url":"https://avatars3.githubusercontent.com/u/19603654?v=4","gravatar_id":"","url":"https://api.github.com/users/hiimdoublej","html_url":"https://github.com/hiimdoublej","followers_url":"https://api.github.com/users/hiimdoublej/followers","following_url":"https://api.github.com/users/hiimdoublej/following{/other_user}","gists_url":"https://api.github.com/users/hiimdoublej/gists{/gist_id}","starred_url":"https://api.github.com/users/hiimdoublej/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hiimdoublej/subscriptions","organizations_url":"https://api.github.com/users/hiimdoublej/orgs","repos_url":"https://api.github.com/users/hiimdoublej/repos","events_url":"https://api.github.com/users/hiimdoublej/events{/privacy}","received_events_url":"https://api.github.com/users/hiimdoublej/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T01:50:57Z","updated_at":"2019-03-05T01:50:57Z","author_association":"NONE","body":"I got good news, so I set ES to use  `openjdk 11.0.2` then went to bed, the problem seems to go away....for now. Let me monitor it closely for like a day to see if the problem resurfaces. I'll report back. Thank you @matriv your suggested debug methods have been very helpful and I'm grateful for that.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469634866","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469634866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469634866,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTYzNDg2Ng==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T10:51:10Z","updated_at":"2019-03-05T10:51:10Z","author_association":"CONTRIBUTOR","body":"To anyone else reading this ticket, the reason why we suggested giving `niofs` a try is because it reads data from disk differently, and we speculated that what translates into a SEGV with `mmapfs` might translate into an `IOException` with `niofs` which could have given us more information about the root cause of the issue. The fact that the bug doesn't reproduce with Java 11 now suggests that Java 8 was doing something wrong that Java 11 fixed. We are unlikely to check what exactly given that the system exhibits some issues (see dmesg output) and that Java 11 appears to have addressed the issue.\r\n\r\nI'm closing the issue now. @hiimdoublej please reopen if the problem appears again with Java 11.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469706241","html_url":"https://github.com/elastic/elasticsearch/issues/39632#issuecomment-469706241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39632","id":469706241,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTcwNjI0MQ==","user":{"login":"hiimdoublej","id":19603654,"node_id":"MDQ6VXNlcjE5NjAzNjU0","avatar_url":"https://avatars3.githubusercontent.com/u/19603654?v=4","gravatar_id":"","url":"https://api.github.com/users/hiimdoublej","html_url":"https://github.com/hiimdoublej","followers_url":"https://api.github.com/users/hiimdoublej/followers","following_url":"https://api.github.com/users/hiimdoublej/following{/other_user}","gists_url":"https://api.github.com/users/hiimdoublej/gists{/gist_id}","starred_url":"https://api.github.com/users/hiimdoublej/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hiimdoublej/subscriptions","organizations_url":"https://api.github.com/users/hiimdoublej/orgs","repos_url":"https://api.github.com/users/hiimdoublej/repos","events_url":"https://api.github.com/users/hiimdoublej/events{/privacy}","received_events_url":"https://api.github.com/users/hiimdoublej/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T14:45:37Z","updated_at":"2019-03-05T14:45:37Z","author_association":"NONE","body":"Alright, I think it's safe to say that the problem's gone. It's been almost 24 hours since the `jdk` switch. For folks who wound up here please try `openjdk 11.0.2`","performed_via_github_app":null}]