{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32729","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32729/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32729/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32729/events","html_url":"https://github.com/elastic/elasticsearch/issues/32729","id":348947073,"node_id":"MDU6SXNzdWUzNDg5NDcwNzM=","number":32729,"title":"[DOCS] Refine full verification mode requirements for Transport layer TLS","user":{"login":"russcam","id":208231,"node_id":"MDQ6VXNlcjIwODIzMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/208231?v=4","gravatar_id":"","url":"https://api.github.com/users/russcam","html_url":"https://github.com/russcam","followers_url":"https://api.github.com/users/russcam/followers","following_url":"https://api.github.com/users/russcam/following{/other_user}","gists_url":"https://api.github.com/users/russcam/gists{/gist_id}","starred_url":"https://api.github.com/users/russcam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russcam/subscriptions","organizations_url":"https://api.github.com/users/russcam/orgs","repos_url":"https://api.github.com/users/russcam/repos","events_url":"https://api.github.com/users/russcam/events{/privacy}","received_events_url":"https://api.github.com/users/russcam/received_events","type":"User","site_admin":false},"labels":[{"id":912838655,"node_id":"MDU6TGFiZWw5MTI4Mzg2NTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Network","name":":Security/Network","color":"0e8a16","default":false,"description":"SSL/TLS, Security for NIO/Netty"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":{"login":"lcawl","id":26471269,"node_id":"MDQ6VXNlcjI2NDcxMjY5","avatar_url":"https://avatars0.githubusercontent.com/u/26471269?v=4","gravatar_id":"","url":"https://api.github.com/users/lcawl","html_url":"https://github.com/lcawl","followers_url":"https://api.github.com/users/lcawl/followers","following_url":"https://api.github.com/users/lcawl/following{/other_user}","gists_url":"https://api.github.com/users/lcawl/gists{/gist_id}","starred_url":"https://api.github.com/users/lcawl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lcawl/subscriptions","organizations_url":"https://api.github.com/users/lcawl/orgs","repos_url":"https://api.github.com/users/lcawl/repos","events_url":"https://api.github.com/users/lcawl/events{/privacy}","received_events_url":"https://api.github.com/users/lcawl/received_events","type":"User","site_admin":false},"assignees":[{"login":"lcawl","id":26471269,"node_id":"MDQ6VXNlcjI2NDcxMjY5","avatar_url":"https://avatars0.githubusercontent.com/u/26471269?v=4","gravatar_id":"","url":"https://api.github.com/users/lcawl","html_url":"https://github.com/lcawl","followers_url":"https://api.github.com/users/lcawl/followers","following_url":"https://api.github.com/users/lcawl/following{/other_user}","gists_url":"https://api.github.com/users/lcawl/gists{/gist_id}","starred_url":"https://api.github.com/users/lcawl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lcawl/subscriptions","organizations_url":"https://api.github.com/users/lcawl/orgs","repos_url":"https://api.github.com/users/lcawl/repos","events_url":"https://api.github.com/users/lcawl/events{/privacy}","received_events_url":"https://api.github.com/users/lcawl/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2018-08-09T01:31:47Z","updated_at":"2019-03-12T14:26:48Z","closed_at":"2019-03-12T14:26:47Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Relates: https://discuss.elastic.co/t/elasticsearch-tls-with-wildcard-san/139972/7\r\n\r\nThe documentation for configuring TLS on the Transport layer could be improved to provide additional detail when configuring `full` verification mode for TLS on the Transport layer.\r\n\r\nWhen specifying the hostname as `network.publish_host` or (`network.host`), the publish address resolves to the IP address on the network. For example, in config\r\n\r\n```\r\nnetwork.host: [\"data-0\"]\r\n```\r\n\r\nresults in\r\n```\r\n[2018-07-02T00:45:20,095][INFO ][o.e.t.TransportService   ] [data-0] publish_address {10.0.0.6:9300}, bound_addresses {10.0.0.6:9300}\r\n```\r\n\r\nand it looks like `NetworkService` always resolves a string host to an `InetAddress`:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/9b00f095b94c7fb6b568e5e36a264d2ae8c293c5/server/src/main/java/org/elasticsearch/common/network/NetworkService.java#L133-L176\r\n\r\nWhat this ultimately means is that a certificate with _only_ a DNS Subject Alternative Name can't be used with `full` verification mode for the Transport layer, _without_ also specifying an IP SAN, since communication on the Transport layer with other nodes will be using the IP address.\r\n\r\nI think the documentation should include a NOTE admonition or similar against `xpack.security.transport.ssl.verification_mode` under https://www.elastic.co/guide/en/elasticsearch/reference/6.3/security-settings.html#transport-tls-ssl-settings to indicate that a certificate must include an [ipAddress SAN](https://tools.ietf.org/html/rfc5280#section-4.2.1.6) to be used with `full` verification mode for the Transport layer.\r\n\r\nIt may also be worth calling this out in the `certutil` docs too at https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-tls.html#node-certificates ?\r\n\r\n\r\n\r\n","closed_by":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"performed_via_github_app":null}