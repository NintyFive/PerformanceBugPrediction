[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/36779692","html_url":"https://github.com/elastic/elasticsearch/issues/5345#issuecomment-36779692","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5345","id":36779692,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Nzc5Njky","user":{"login":"jillesvangurp","id":819187,"node_id":"MDQ6VXNlcjgxOTE4Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/819187?v=4","gravatar_id":"","url":"https://api.github.com/users/jillesvangurp","html_url":"https://github.com/jillesvangurp","followers_url":"https://api.github.com/users/jillesvangurp/followers","following_url":"https://api.github.com/users/jillesvangurp/following{/other_user}","gists_url":"https://api.github.com/users/jillesvangurp/gists{/gist_id}","starred_url":"https://api.github.com/users/jillesvangurp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jillesvangurp/subscriptions","organizations_url":"https://api.github.com/users/jillesvangurp/orgs","repos_url":"https://api.github.com/users/jillesvangurp/repos","events_url":"https://api.github.com/users/jillesvangurp/events{/privacy}","received_events_url":"https://api.github.com/users/jillesvangurp/received_events","type":"User","site_admin":false},"created_at":"2014-03-05T19:01:52Z","updated_at":"2014-03-05T19:01:52Z","author_association":"CONTRIBUTOR","body":"This bug may be false but there is an underlying problem that might cause me to see this that I discovered doing some more analysis on this:\n\nI had a bit of code that used search_type that worked fine with 0.90 but broke when I tried it with 1.0.1 (upgraded this afternoon) today in several ways:\n\nproblem #1: the exit condition changed.\n\nI used to parse the scrollId from the response and stop fetching new results when it was no longer included. Now I get the following response for the final page of results:\n\n{\n    \"_scroll_id\":\"c2NhbjswOzE7dG90YWxfaGl0czo3NDk2Ow==\",\n    \"took\":3,\n    \"timed_out\":false,\n    \"_shards\":{\n        \"total\":5,\n        \"successful\":4,\n        \"failed\":1,\n        \"failures\":[\n            {\n                \"status\":500,\n                \"reason\":\"SearchContextMissingException[No search context found for id [199]]\"\n            }\n        ]\n    },\n    \"hits\":{\n        \"total\":7496,\n        \"max_score\":0.0\n\"hits\":[...]\n\n```\n}\n```\n\n}\n\nSo it is actually reporting an error for the next page of results from one of the shards and includes the final results. This looks weird to me. The only way I have of deducing that this is the final page is to look at the failures object or to keep track of the number hits I've processed. That can't be right.\n\nproblem #2: the size parameter seems to work in a weird way.\n\nI'm not actually sure if that is a change or whether this was always broken. In any case, this seems to be per shard. So if I specify size=100, I actually get back 500 results per page, which would be the number of shards times the size. \n\nSo getting back to my original bug, I probably am getting the results but my code fails trying to fetch another page of results because of the broken exit condition.\n\nI would expect either the old behavior where the last result fetched no longer includes the scrollid. Alternatively, the API could be improved by explicitly including a next url and omitting that on the last page. My interpretation of the old behavior was to use the scrollid like this indeed. In any case, asking for the last page should not return any errors from any shard.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/36781258","html_url":"https://github.com/elastic/elasticsearch/issues/5345#issuecomment-36781258","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5345","id":36781258,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NzgxMjU4","user":{"login":"jillesvangurp","id":819187,"node_id":"MDQ6VXNlcjgxOTE4Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/819187?v=4","gravatar_id":"","url":"https://api.github.com/users/jillesvangurp","html_url":"https://github.com/jillesvangurp","followers_url":"https://api.github.com/users/jillesvangurp/followers","following_url":"https://api.github.com/users/jillesvangurp/following{/other_user}","gists_url":"https://api.github.com/users/jillesvangurp/gists{/gist_id}","starred_url":"https://api.github.com/users/jillesvangurp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jillesvangurp/subscriptions","organizations_url":"https://api.github.com/users/jillesvangurp/orgs","repos_url":"https://api.github.com/users/jillesvangurp/repos","events_url":"https://api.github.com/users/jillesvangurp/events{/privacy}","received_events_url":"https://api.github.com/users/jillesvangurp/received_events","type":"User","site_admin":false},"created_at":"2014-03-05T19:15:01Z","updated_at":"2014-03-05T19:15:01Z","author_association":"CONTRIBUTOR","body":"actually looking closer it turns out it was a pilot error after all. I was passing in the same scrollid instead of using the one in the request. \n\nThe minor issue of the pageSize above may be valid but that's explainable and probably not a big issue. So, closing this one.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/36785094","html_url":"https://github.com/elastic/elasticsearch/issues/5345#issuecomment-36785094","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5345","id":36785094,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Nzg1MDk0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-03-05T19:48:33Z","updated_at":"2014-03-05T19:48:33Z","author_association":"CONTRIBUTOR","body":"@jillesvangurp to explain: with the `scan` search type, there is no reduce phase, so `size` is actually per-shard, rather than per-request.  Each shard returns a max of `size` results.\n","performed_via_github_app":null}]