{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22580","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22580/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22580/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22580/events","html_url":"https://github.com/elastic/elasticsearch/issues/22580","id":200317071,"node_id":"MDU6SXNzdWUyMDAzMTcwNzE=","number":22580,"title":"[Regression] Template validation doesn't take into account template hierarchy (\"order\")","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-01-12T09:29:10Z","updated_at":"2017-01-12T09:42:11Z","closed_at":"2017-01-12T09:38:23Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Consider the following scenario:\r\n\r\n`default.json` defines some mappings for common fields and/or dynamic mapping shared by all indices in a cluster. Specifies order 1 and `template:*`.\r\n`default_en.json` defines language specific mappings for fields, e.g. `{ \"content\": {\"analyzer\":\"myenglish\"}}`. Specifies order 2 and `template:*_en`.\r\n`articles_en.json` defines articles mappings for the English language, and is using the `myenglish` analyzer defined on a previous template. Specifies order 3 and `template:english_en`.\r\n\r\nBefore v5 it worked because all templates were added, and only parsed, validated and applied on the event of index creation, using the order of precedence and applied along with the rest of the matching templates.\r\n\r\nOn v5 you will get the following error when putting articles_en.json : `MapperParsingException[analyzer [myenglish] not found for field [myfield]]` because it's been evaluated in isolation without taking other templates and index names into account.\r\n\r\nThis is a regression from pre-v5 versions, and in addition is not documented anywhere.\r\n\r\nPresumably relates to #8802 (apriori correctness validation vs actually testing using temp index creation). It would be nice to keep template validation (which is great feature!) but also take into account related templates (based on index creation). I'm aware it isn't trivial to do, but important for real-world usages of templates.","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}