[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/4596339","html_url":"https://github.com/elastic/elasticsearch/issues/1745#issuecomment-4596339","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1745","id":4596339,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1OTYzMzk=","user":{"login":"tvburger","id":1484662,"node_id":"MDQ6VXNlcjE0ODQ2NjI=","avatar_url":"https://avatars0.githubusercontent.com/u/1484662?v=4","gravatar_id":"","url":"https://api.github.com/users/tvburger","html_url":"https://github.com/tvburger","followers_url":"https://api.github.com/users/tvburger/followers","following_url":"https://api.github.com/users/tvburger/following{/other_user}","gists_url":"https://api.github.com/users/tvburger/gists{/gist_id}","starred_url":"https://api.github.com/users/tvburger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvburger/subscriptions","organizations_url":"https://api.github.com/users/tvburger/orgs","repos_url":"https://api.github.com/users/tvburger/repos","events_url":"https://api.github.com/users/tvburger/events{/privacy}","received_events_url":"https://api.github.com/users/tvburger/received_events","type":"User","site_admin":false},"created_at":"2012-03-20T14:27:40Z","updated_at":"2012-03-20T14:32:00Z","author_association":"NONE","body":"This would fix the issue...\n- Tom\n\n```\ndiff --git a/bin/elasticsearch b/bin/elasticsearch\nindex 4adb76c..696d900 100755\n--- a/bin/elasticsearch\n+++ b/bin/elasticsearch\n@@ -121,14 +121,21 @@ launch_service()\n         es_parms=\"$es_parms -Des.foreground=yes\"\n         exec \"$JAVA\" $JAVA_OPTS $ES_JAVA_OPTS $es_parms -Des.path.home=\"$ES_HOME\n                 org.elasticsearch.bootstrap.ElasticSearch\n+        status_code=$?\n     else\n         # Startup ElasticSearch, background it, and write the pid.\n         exec \"$JAVA\" $JAVA_OPTS $ES_JAVA_OPTS $es_parms -Des.path.home=\"$ES_HOME\n                     org.elasticsearch.bootstrap.ElasticSearch <&- &\n-        [ ! -z \"$pidpath\" ] && printf '%d' $! > \"$pidpath\"\n+        status_code=$?\n+        pid=$!\n+        if [ \"$status_code\" -eq 0 -a ! -z \"$pidpath\" ]; then\n+            printf '%d' \"$pid\" > \"$pidpath\"\n+            status_code=$?\n+        fi\n     fi\n\n-    return $?\n+    return \"$status_code\"\n }\n\n # Parse any command line options.\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22388952","html_url":"https://github.com/elastic/elasticsearch/issues/1745#issuecomment-22388952","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1745","id":22388952,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzg4OTUy","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2013-08-09T11:32:25Z","updated_at":"2013-08-09T11:32:25Z","author_association":"MEMBER","body":"This looks fixed to me in 0.90.3, though in a different way. Can you confirm it works for you as expected?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22825292","html_url":"https://github.com/elastic/elasticsearch/issues/1745#issuecomment-22825292","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1745","id":22825292,"node_id":"MDEyOklzc3VlQ29tbWVudDIyODI1Mjky","user":{"login":"tvburger","id":1484662,"node_id":"MDQ6VXNlcjE0ODQ2NjI=","avatar_url":"https://avatars0.githubusercontent.com/u/1484662?v=4","gravatar_id":"","url":"https://api.github.com/users/tvburger","html_url":"https://github.com/tvburger","followers_url":"https://api.github.com/users/tvburger/followers","following_url":"https://api.github.com/users/tvburger/following{/other_user}","gists_url":"https://api.github.com/users/tvburger/gists{/gist_id}","starred_url":"https://api.github.com/users/tvburger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvburger/subscriptions","organizations_url":"https://api.github.com/users/tvburger/orgs","repos_url":"https://api.github.com/users/tvburger/repos","events_url":"https://api.github.com/users/tvburger/events{/privacy}","received_events_url":"https://api.github.com/users/tvburger/received_events","type":"User","site_admin":false},"created_at":"2013-08-18T05:56:33Z","updated_at":"2013-08-18T05:56:33Z","author_association":"NONE","body":"Hi,\n\nIt looks like that in the master branch it is solved. Seen from the core issue I'm happy. I have some second thoughts on quality though, please see below.\n- Write PID On Failure?\n  There is off course still this question if you want to write the pid unconditionally. I would opt that only the pid is written when successfully the daemon is started. This is what I expected from a pid file, that a process with that pid exists.\n  We already know that no such process exists (anymore) since exec didn't return 0...\n  (explains the different of \"$status_code -eq 0 -a\" in the if statement.)\n- Failure When Writing PID Fails?\n  The last difference is, what to do if writing the pid file files... I take this into account on wether we are succesful, but then again, the daemon is running. Not a trivial decision. (Although some scripts most likely would not function properly without the pid file present, and thus already giving an early error seems a good option to me.)\n  This also explains why the name \"status_code\" and not \"execval\" was used in the above code snippet, because it is not only storing the return value of the exec call.\n\nAnyways, do what you like. ;)\n\nKind regards, Tom\n","performed_via_github_app":null}]