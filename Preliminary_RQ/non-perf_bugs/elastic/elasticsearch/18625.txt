{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18625","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18625/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18625/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18625/events","html_url":"https://github.com/elastic/elasticsearch/issues/18625","id":157296043,"node_id":"MDU6SXNzdWUxNTcyOTYwNDM=","number":18625,"title":"Templates defined in Dynamic Mapping are NOT processed in order","user":{"login":"androidkencai","id":1441830,"node_id":"MDQ6VXNlcjE0NDE4MzA=","avatar_url":"https://avatars2.githubusercontent.com/u/1441830?v=4","gravatar_id":"","url":"https://api.github.com/users/androidkencai","html_url":"https://github.com/androidkencai","followers_url":"https://api.github.com/users/androidkencai/followers","following_url":"https://api.github.com/users/androidkencai/following{/other_user}","gists_url":"https://api.github.com/users/androidkencai/gists{/gist_id}","starred_url":"https://api.github.com/users/androidkencai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/androidkencai/subscriptions","organizations_url":"https://api.github.com/users/androidkencai/orgs","repos_url":"https://api.github.com/users/androidkencai/repos","events_url":"https://api.github.com/users/androidkencai/events{/privacy}","received_events_url":"https://api.github.com/users/androidkencai/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2016-05-27T21:45:00Z","updated_at":"2016-05-31T20:10:49Z","closed_at":"2016-05-31T07:01:16Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**:\n1.7 or 2.2 \n\n**JVM version**:\n1.8.0_66\n\n**OS version**:\nOSX 10.11.5\n\n**Description of the problem including expected versus actual behavior**:\nAccording to the [dynamic-templates](https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-templates.html)\n\n> Templates are processed in order — the first matching template wins.\n\nin the test case below, it's expected to hit only the first template definition, **path_match_str_def**, but it seemed hit the one next and got the exceptions attached. \n\n**Steps to reproduce**:\n 1.mapping template \n\n``` javascript\n\"mappings\": {\n    \"sdr\": {\n      \"dynamic_templates\": [\n        {\n          \"path_match_str_def\": {\n            \"path_match\": \"mypath.*\",\n            \"match_mapping_type\": \"string\",\n            \"mapping\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\",\n              \"doc_values\": true\n            }\n          }\n        },\n        {\n          \"path_match_str_int\": {\n            \"path_match\": \"mypath.var_i*\",\n            \"mapping\": {\n              \"type\": \"long\",\n              \"index\": \"not_analyzed\",\n              \"doc_values\": true\n            }\n          }\n        }\n      ],\n      \"properties\": {\n        \"mypath\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"root\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\",\n              \"doc_values\": true\n            }\n          }\n        }\n      }\n    }\n  }\n```\n\n 2.document\n`{\n  \"mypath\": {\n    \"var_istring\": \"abcdef\"\n  }\n}`\n 3.got exceptions below\n\n``` java\nRemoteTransportException[[Living Laser][127.0.0.1:9300][indices:data/write/index[p]]]; nested: MapperParsingException[failed to parse [mypath.var_istring]]; nested: NumberFormatException[For input string: \"abcdef\"];\nCaused by: MapperParsingException[failed to parse [mypath.var_istring]]; nested: NumberFormatException[For input string: \"abcdef\"];\n    at org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:343)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:318)\n    at org.elasticsearch.index.mapper.DocumentParser.parseAndMergeUpdate(DocumentParser.java:765)\n    at org.elasticsearch.index.mapper.DocumentParser.parseDynamicValue(DocumentParser.java:652)\n    at org.elasticsearch.index.mapper.DocumentParser.parseValue(DocumentParser.java:451)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:271)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:315)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:335)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:261)\n    at org.elasticsearch.index.mapper.DocumentParser.innerParseDocument(DocumentParser.java:131)\n    at org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:79)\n    at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:304)\n    at org.elasticsearch.index.shard.IndexShard.prepareIndex(IndexShard.java:547)\n    at org.elasticsearch.index.shard.IndexShard.prepareIndexOnPrimary(IndexShard.java:529)\n    at org.elasticsearch.action.index.TransportIndexAction.prepareIndexOperationOnPrimary(TransportIndexAction.java:211)\n    at org.elasticsearch.action.index.TransportIndexAction.executeIndexRequestOnPrimary(TransportIndexAction.java:223)\n    at org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:157)\n    at org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:65)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.doRun(TransportReplicationAction.java:595)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:263)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:260)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:350)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NumberFormatException: For input string: \"abcdef\"\n    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\n    at java.lang.Long.parseLong(Long.java:589)\n    at java.lang.Long.parseLong(Long.java:631)\n    at org.elasticsearch.common.xcontent.support.AbstractXContentParser.longValue(AbstractXContentParser.java:145)\n    at org.elasticsearch.index.mapper.core.LongFieldMapper.innerParseCreateField(LongFieldMapper.java:275)\n    at org.elasticsearch.index.mapper.core.NumberFieldMapper.parseCreateField(NumberFieldMapper.java:241)\n    at org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:335)\n    ... 26 more\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}