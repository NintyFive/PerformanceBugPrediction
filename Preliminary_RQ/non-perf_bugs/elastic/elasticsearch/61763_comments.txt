[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/684118828","html_url":"https://github.com/elastic/elasticsearch/issues/61763#issuecomment-684118828","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61763","id":684118828,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NDExODgyOA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-09-01T00:28:02Z","updated_at":"2020-09-01T00:28:02Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/REST API)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/684161262","html_url":"https://github.com/elastic/elasticsearch/issues/61763#issuecomment-684161262","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61763","id":684161262,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NDE2MTI2Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-09-01T02:48:24Z","updated_at":"2020-09-01T02:48:24Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/CRUD)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/684161708","html_url":"https://github.com/elastic/elasticsearch/issues/61763#issuecomment-684161708","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61763","id":684161708,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NDE2MTcwOA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2020-09-01T02:49:46Z","updated_at":"2020-09-01T02:49:46Z","author_association":"MEMBER","body":"I think this falls under the distributed area as it's really about the behavior of bulk indexing requests (which I think CRUD includes), not about general infrastructure of all requests.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/684509356","html_url":"https://github.com/elastic/elasticsearch/issues/61763#issuecomment-684509356","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61763","id":684509356,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NDUwOTM1Ng==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2020-09-01T07:20:13Z","updated_at":"2020-09-01T07:20:13Z","author_association":"CONTRIBUTOR","body":"This looks like Kibana is not properly URL escaping the index name:\r\n\r\nIf I URL escape that index name using  https://www.urlencoder.org, I get `%25%7B%5B%40metadata%5D%5Bbeat%5D%7D-%25%7B%5B%40metadata%5D%5Bversion%5D%7D-2020.08.23`, and using that with curl works just fine.\r\n\r\n```\r\n$ curl localhost:9200/%25%7B%5B%40metadata%5D%5Bbeat%5D%7D-%25%7B%5B%40metadata%5D%5Bversion%5D%7D-2020.08.23\r\n{\"%{[@metadata][beat]}-%{[@metadata][version]}-2020.08.23\":{\"aliases\":{},\"mappings\":{},\"settings\":{\"index\":{\"creation_date\":\"1598944051293\",\"number_of_shards\":\"1\",\"number_of_replicas\":\"1\",\"uuid\":\"Lp0PuvbcRQeR2fkpZ9GhXw\",\"version\":{\"created\":\"7090099\"},\"provided_name\":\"%{[@metadata][beat]}-%{[@metadata][version]}-2020.08.23\"}}}}\r\n```\r\n\r\nKibana DEV console also does not look to properly escape either.\r\n\r\n```\r\nPOST /%{[@metadata][beat]}-%{[@metadata][version]}-2020.08.23/_doc/1\r\n{}\r\n```\r\nreturns \r\n```\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"invalid_index_name_exception\",\r\n        \"reason\" : \"Invalid index name [%7B[@metadata][beat]}-%7B[@metadata][version]}-2020.08.23], must be lowercase\",\r\n        \"index_uuid\" : \"_na_\",\r\n        \"index\" : \"%7B[@metadata][beat]}-%7B[@metadata][version]}-2020.08.23\"\r\n      }\r\n    ],\r\n    \"type\" : \"invalid_index_name_exception\",\r\n    \"reason\" : \"Invalid index name [%7B[@metadata][beat]}-%7B[@metadata][version]}-2020.08.23], must be lowercase\",\r\n    \"index_uuid\" : \"_na_\",\r\n    \"index\" : \"%7B[@metadata][beat]}-%7B[@metadata][version]}-2020.08.23\"\r\n  },\r\n  \"status\" : 400\r\n}\r\n```\r\n\r\nwhereas the properly escaped\r\n```\r\nPOST /%25%7B%5B%40metadata%5D%5Bbeat%5D%7D-%25%7B%5B%40metadata%5D%5Bversion%5D%7D-2020.08.23/_doc/1\r\n{}\r\n``` \r\nreturns\r\n```\r\n{\r\n  \"_index\" : \"%{[@metadata][beat]}-%{[@metadata][version]}-2020.08.23\",\r\n  \"_type\" : \"_doc\",\r\n  \"_id\" : \"1\",\r\n  \"_version\" : 3,\r\n  \"result\" : \"updated\",\r\n  \"_shards\" : {\r\n    \"total\" : 2,\r\n    \"successful\" : 1,\r\n    \"failed\" : 0\r\n  },\r\n  \"_seq_no\" : 3,\r\n  \"_primary_term\" : 1\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/685160326","html_url":"https://github.com/elastic/elasticsearch/issues/61763#issuecomment-685160326","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61763","id":685160326,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NTE2MDMyNg==","user":{"login":"cjcenizal","id":1238659,"node_id":"MDQ6VXNlcjEyMzg2NTk=","avatar_url":"https://avatars2.githubusercontent.com/u/1238659?v=4","gravatar_id":"","url":"https://api.github.com/users/cjcenizal","html_url":"https://github.com/cjcenizal","followers_url":"https://api.github.com/users/cjcenizal/followers","following_url":"https://api.github.com/users/cjcenizal/following{/other_user}","gists_url":"https://api.github.com/users/cjcenizal/gists{/gist_id}","starred_url":"https://api.github.com/users/cjcenizal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cjcenizal/subscriptions","organizations_url":"https://api.github.com/users/cjcenizal/orgs","repos_url":"https://api.github.com/users/cjcenizal/repos","events_url":"https://api.github.com/users/cjcenizal/events{/privacy}","received_events_url":"https://api.github.com/users/cjcenizal/received_events","type":"User","site_admin":false},"created_at":"2020-09-01T22:10:22Z","updated_at":"2020-09-01T22:10:22Z","author_association":"CONTRIBUTOR","body":"Thanks, @ywelsch! You're right. It looks like this encoding step might be missing in the Elasticsearch JS client. Once I can confirm where the problem resides (in the client or in Kibana), I'll close this.\r\n\r\n@elastic/es-clients I'm making a request to `transport.request` on the legacy client with this payload:\r\n\r\n```\r\n{\r\n    method: 'GET',\r\n    path: `/%{[@metadata][beat]}-%{[@metadata][version]}-2020.08.23`,\r\n    query: {\r\n      expand_wildcards: 'hidden,all',\r\n    },\r\n}\r\n```\r\n\r\nThe response is this error:\r\n\r\n```\r\ninvalid escape sequence `%{[' at index 0 of: %{[@metadata][beat]}-%{[@metadata][version]}-2020.08.23, allowed: [GET, HEAD, PUT, DELETE]\r\n```\r\n\r\nDoes the client expect the consumer to url-encode the path? Or should the client be responsible for that?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/685865559","html_url":"https://github.com/elastic/elasticsearch/issues/61763#issuecomment-685865559","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61763","id":685865559,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NTg2NTU1OQ==","user":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars0.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","site_admin":false},"created_at":"2020-09-02T16:54:35Z","updated_at":"2020-09-02T16:54:35Z","author_association":"MEMBER","body":"Hello! The js client is encoding only URL parameters and not the entire URL, see [here](https://github.com/elastic/elasticsearch-js/blob/e86d38087e8c774cdeadd11b083c5b82be6d3b84/api/api/indices.get.js#L96) for example.\r\nParameters are encoded with [`encodeURIComponent`](https://developer.mozilla.org/it/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent).\r\n\r\nI fear the issue might be caused by the difference between [`encodeURI`](https://developer.mozilla.org/it/docs/Web/JavaScript/Reference/Global_Objects/encodeURI) and [`encodeURIComponent`](https://developer.mozilla.org/it/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent). As far as I know `encodeURI` can't be used for encoding specific parts of the URL, only entire URLs.\r\nThe difference between the two methods is:\r\n- `encodeURIComponent()` encodes everything except these characters: `A-Z a-z 0-9 - _ . ! ~ * ' ( )`\r\n- `encodeURI()` ignores the same characters as `encodeURIComponent()`, and **also ignores** these: `; , / ? : @ & = + $ #`\r\n\r\nSide note, `transport.request` expects you to pass the URL already encoded. If you use the surface API of the client (`client.indices.get`), everything should be handled for you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/686064077","html_url":"https://github.com/elastic/elasticsearch/issues/61763#issuecomment-686064077","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61763","id":686064077,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NjA2NDA3Nw==","user":{"login":"cjcenizal","id":1238659,"node_id":"MDQ6VXNlcjEyMzg2NTk=","avatar_url":"https://avatars2.githubusercontent.com/u/1238659?v=4","gravatar_id":"","url":"https://api.github.com/users/cjcenizal","html_url":"https://github.com/cjcenizal","followers_url":"https://api.github.com/users/cjcenizal/followers","following_url":"https://api.github.com/users/cjcenizal/following{/other_user}","gists_url":"https://api.github.com/users/cjcenizal/gists{/gist_id}","starred_url":"https://api.github.com/users/cjcenizal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cjcenizal/subscriptions","organizations_url":"https://api.github.com/users/cjcenizal/orgs","repos_url":"https://api.github.com/users/cjcenizal/repos","events_url":"https://api.github.com/users/cjcenizal/events{/privacy}","received_events_url":"https://api.github.com/users/cjcenizal/received_events","type":"User","site_admin":false},"created_at":"2020-09-02T22:35:35Z","updated_at":"2020-09-02T22:35:35Z","author_association":"CONTRIBUTOR","body":"Thanks for your help @delvedor! We'll fix this on the Kibana side.","performed_via_github_app":null}]