{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9419","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9419/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9419/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9419/events","html_url":"https://github.com/elastic/elasticsearch/issues/9419","id":55492990,"node_id":"MDU6SXNzdWU1NTQ5Mjk5MA==","number":9419,"title":"Doc_values are ignored after upgrade to 1.3.7","user":{"login":"dimzak","id":4560173,"node_id":"MDQ6VXNlcjQ1NjAxNzM=","avatar_url":"https://avatars3.githubusercontent.com/u/4560173?v=4","gravatar_id":"","url":"https://api.github.com/users/dimzak","html_url":"https://github.com/dimzak","followers_url":"https://api.github.com/users/dimzak/followers","following_url":"https://api.github.com/users/dimzak/following{/other_user}","gists_url":"https://api.github.com/users/dimzak/gists{/gist_id}","starred_url":"https://api.github.com/users/dimzak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimzak/subscriptions","organizations_url":"https://api.github.com/users/dimzak/orgs","repos_url":"https://api.github.com/users/dimzak/repos","events_url":"https://api.github.com/users/dimzak/events{/privacy}","received_events_url":"https://api.github.com/users/dimzak/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2015-01-26T15:10:30Z","updated_at":"2015-04-23T12:42:28Z","closed_at":"2015-04-23T12:42:27Z","author_association":"NONE","active_lock_reason":null,"body":"We have daily indexes with a mapping for field `ts as doc_value`. \nMapping of ts field before and after upgrade:\n`GET /delivery-logs-index.prod-20150126/_mapping/`\nts part response:\n\n``` json\n \"ts\": {\n                  \"type\": \"date\",\n                  \"doc_values\": true,\n                  \"format\": \"dateOptionalTime\"\n               }\n```\n\nBut then when observing fielddata:\n`GET /delivery-logs-index.prod-20150126/_stats/fielddata?fields=ts`\nGot this:\n\n``` json\n{\n   \"_shards\": {\n      \"total\": 24,\n      \"successful\": 24,\n      \"failed\": 0\n   },\n   \"_all\": {\n      \"primaries\": {\n         \"fielddata\": {\n            \"memory_size_in_bytes\": 2407666208,\n            \"evictions\": 642,\n            \"fields\": {\n               \"ts\": {\n                  \"memory_size_in_bytes\": 767245688\n               }\n            }\n         }\n      },\n      \"total\": {\n         \"fielddata\": {\n            \"memory_size_in_bytes\": 4994980234,\n            \"evictions\": 1250,\n            \"fields\": {\n               \"ts\": {\n                  \"memory_size_in_bytes\": 1532342416\n               }\n            }\n         }\n      }\n   },\n   \"indices\": {\n      \"delivery-logs-index.prod-20150126\": {\n         \"primaries\": {\n            \"fielddata\": {\n               \"memory_size_in_bytes\": 2407666208,\n               \"evictions\": 642,\n               \"fields\": {\n                  \"ts\": {\n                     \"memory_size_in_bytes\": 767245688\n                  }\n               }\n            }\n         },\n         \"total\": {\n            \"fielddata\": {\n               \"memory_size_in_bytes\": 4994980234,\n               \"evictions\": 1250,\n               \"fields\": {\n                  \"ts\": {\n                     \"memory_size_in_bytes\": 1532342416\n                  }\n               }\n            }\n         }\n      }\n   }\n}\n```\n\nShouldn't it be always `0`???\n\nAnother strange thing is that when I try the same fielddata query for indexes BEFORE upgrade:\n`GET /delivery-logs-index.prod-20150121/_stats/fielddata?fields=ts`\n I got this:\n\n``` json\n{\n    \"_shards\": {\n        \"total\": 24,\n        \"successful\": 24,\n        \"failed\": 0\n    },\n    \"_all\": {\n        \"primaries\": {\n            \"fielddata\": {\n                \"memory_size_in_bytes\": 3001763154,\n                \"evictions\": 2655,\n                \"fields\": {}\n            }\n        },\n        \"total\": {\n            \"fielddata\": {\n                \"memory_size_in_bytes\": 5979477692,\n                \"evictions\": 4546,\n                \"fields\": {}\n            }\n        }\n    },\n    \"indices\": {\n        \"delivery-logs-index.prod-20150121\": {\n            \"primaries\": {\n                \"fielddata\": {\n                    \"memory_size_in_bytes\": 3001763154,\n                    \"evictions\": 2655,\n                    \"fields\": {}\n                }\n            },\n            \"total\": {\n                \"fielddata\": {\n                    \"memory_size_in_bytes\": 5979477692,\n                    \"evictions\": 4546,\n                    \"fields\": {}\n                }\n            }\n        }\n    }\n}\n```\n\nField `ts` is entirely missing(seems correct to me)!\n\nMapping for each daily index is used by a template which didn't change during upgrade.\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}