{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/35377","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35377/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35377/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35377/events","html_url":"https://github.com/elastic/elasticsearch/issues/35377","id":378760484,"node_id":"MDU6SXNzdWUzNzg3NjA0ODQ=","number":35377,"title":"vm.max_map_count bootcheck should be conditional on the use of index.store.type=mmapfs","user":{"login":"rubin55","id":6214491,"node_id":"MDQ6VXNlcjYyMTQ0OTE=","avatar_url":"https://avatars3.githubusercontent.com/u/6214491?v=4","gravatar_id":"","url":"https://api.github.com/users/rubin55","html_url":"https://github.com/rubin55","followers_url":"https://api.github.com/users/rubin55/followers","following_url":"https://api.github.com/users/rubin55/following{/other_user}","gists_url":"https://api.github.com/users/rubin55/gists{/gist_id}","starred_url":"https://api.github.com/users/rubin55/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rubin55/subscriptions","organizations_url":"https://api.github.com/users/rubin55/orgs","repos_url":"https://api.github.com/users/rubin55/repos","events_url":"https://api.github.com/users/rubin55/events{/privacy}","received_events_url":"https://api.github.com/users/rubin55/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-11-08T14:40:36Z","updated_at":"2018-11-20T12:47:50Z","closed_at":"2018-11-20T12:47:45Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 6.4.3, Build: default/tar/fe40335/2018-10-30T23:17:19.084789Z, JVM: 1.8.0_191\r\n\r\n**Plugins installed**: []\r\nnone\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_191\"\r\nOpenJDK Runtime Environment (build 1.8.0_191-b12)\r\nOpenJDK 64-Bit Server VM (build 25.191-b12, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux c061993b6527 4.9.93-linuxkit-aufs #1 SMP Wed Jun 6 16:55:56 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nCurrently, when Elasticsearch boots up and detects it is not just running on localhost, it will invoke the bootchecks mechanism to make sure various things are sanely configured. One of those checks is for the value of `vm.max_map_count` to be at least `262144`. \r\n\r\nBy default, Elasticsearch sets `index.store.type` to `fs` which means that Elasticsearch will select the performance-optimal index store type for the platform it's currently running on (see: https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules-store.html for details about the possible store types).\r\n\r\nThe value of `vm.max_map_count` is only relevant when index.store.type=mmapfs; Consequently, When an Elasticsearch instance is configured to use another store type like `niofs` or `simplefs`, it should not check for the value of `vm.max_map_count` because the value is irrelevant to the niofs and simplefs storage types.\r\n\r\n**Steps to reproduce**:\r\n \r\n 0. Run `sysctl -w vm.max_map_count=10000`\r\n 1. Set `index.store.type: niofs` in `elasticsearch.yml`\r\n 2. Set `network.host: _site_` in `elasticsearch.yml`\r\n 3. Start Elasticsearch and observe log output\r\n 4. Watch ERROR message from bootchecks mechanism due to vm.max_map_count being to low despite the fact you're not using the `mmapfs` index store type.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}