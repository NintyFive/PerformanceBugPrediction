{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41432","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41432/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41432/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41432/events","html_url":"https://github.com/elastic/elasticsearch/issues/41432","id":436133961,"node_id":"MDU6SXNzdWU0MzYxMzM5NjE=","number":41432,"title":"elasticsearch 6.6.1 jvm g1 crash report","user":{"login":"weizijun","id":5070449,"node_id":"MDQ6VXNlcjUwNzA0NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/5070449?v=4","gravatar_id":"","url":"https://api.github.com/users/weizijun","html_url":"https://github.com/weizijun","followers_url":"https://api.github.com/users/weizijun/followers","following_url":"https://api.github.com/users/weizijun/following{/other_user}","gists_url":"https://api.github.com/users/weizijun/gists{/gist_id}","starred_url":"https://api.github.com/users/weizijun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weizijun/subscriptions","organizations_url":"https://api.github.com/users/weizijun/orgs","repos_url":"https://api.github.com/users/weizijun/repos","events_url":"https://api.github.com/users/weizijun/events{/privacy}","received_events_url":"https://api.github.com/users/weizijun/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-04-23T11:20:18Z","updated_at":"2020-02-29T12:54:04Z","closed_at":"2020-02-29T12:54:04Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):6.6.1\r\n\r\n**Plugins installed**: [analysis-icu,analysis-ik]\r\n\r\n**JVM version** (`java -version`):11.0.2+9-LTS\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):3.10.0-514.16.1.es01.x86_64 #1 SMP Wed Oct 17 23:14:35 CST 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\njvm core, use G1 collector\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. 4w/s tps\r\n 2. 100+ shard on writing\r\n 3.\r\n\r\n**Provide logs (if relevant)**:\r\nhs_err_pid1291.log\r\n\r\n```\r\n#\r\n# A fatal error has been detected by the Java Runtime Environment:\r\n#\r\n#  SIGSEGV (0xb) at pc=0x00007f6915c2583d, pid=1291, tid=11011\r\n#\r\n# JRE version: Java(TM) SE Runtime Environment (11.0.2+9) (build 11.0.2+9-LTS)\r\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (11.0.2+9-LTS, mixed mode, tiered, compressed oops, g1 gc, linux-amd64)\r\n# Problematic frame:\r\n# J 46357 c2 org.elasticsearch.index.mapper.FieldMapper.parse(Lorg/elasticsearch/index/mapper/ParseContext;)V (103 bytes) @ 0x00007f6915c2583d [0x00007f6915c255e0+0x000000000000025d]\r\n#\r\n# Core dump will be written. Default location: Core dumps may be processed with \"/usr/local/bin/core_filter -P %P -p %p -e %e -t %t -S 5 -B 102400\" (or dumping to /home/data0/elasticsearch/core.1291)\r\n#\r\n# If you would like to submit a bug report, please visit:\r\n#   http://bugreport.java.com/bugreport/crash.jsp\r\n#\r\n\r\n---------------  S U M M A R Y ------------\r\n\r\nCommand Line: -Xms31g -Xmx31g -XX:+UseG1GC -XX:InitiatingHeapOccupancyPercent=75 -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.io.tmpdir=/tmp/elasticsearch.D46WgITT -XX:ErrorFile=logs/hs_err_pid%p.log -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m -Djava.locale.providers=COMPAT -XX:UseAVX=2 -Des.path.home=/data0/elasticsearch -Des.path.conf=/data0/elasticsearch/config -Des.distribution.flavor=default -Des.distribution.type=tar org.elasticsearch.bootstrap.Elasticsearch\r\n\r\nHost: Intel(R) Xeon(R) CPU E5-2650 v4 @ 2.20GHz, 48 cores, 64G, CentOS Linux release 7.2.1511 (Core)\r\nTime: Tue Apr 23 17:17:52 2019 CST elapsed time: 430710 seconds (4d 23h 38m 30s)\r\n\r\n---------------  T H R E A D  ---------------\r\n\r\nCurrent thread (0x00007f67d4081000):  JavaThread \"elasticsearch[log4-datanode-sf-054bc-95][write][T#12]\" daemon [_thread_in_Java, id=11011, stack(0x00007f672c8f6000,0x00007f672c9f7000)]\r\n\r\nStack: [0x00007f672c8f6000,0x00007f672c9f7000],  sp=0x00007f672c9f5068,  free space=1020k\r\nNative frames: (J=compiled Java code, A=aot compiled Java code, j=interpreted, Vv=VM code, C=native code)\r\nJ 46357 c2 org.elasticsearch.index.mapper.FieldMapper.parse(Lorg/elasticsearch/index/mapper/ParseContext;)V (103 bytes) @ 0x00007f6915c2583d [0x00007f6915c255e0+0x000000000000025d]\r\n\r\n[error occurred during error reporting (printing native stack), id 0xb, SIGSEGV (0xb) at pc=0x00007f6929fab834]\r\n\r\n\r\nsiginfo: si_signo: 11 (SIGSEGV), si_code: 0 (SI_USER), si_pid: 0 (invalid), si_uid: 0\r\n\r\nRegister to memory mapping:\r\n\r\nRAX=0x0000001390279278 is an oop: java.util.ArrayList\r\n{0x0000001390279278} - klass: 'java/util/ArrayList'\r\nRBX=0x000000139027ac2c is pointing into object: [Ljava.lang.Object;\r\n{0x000000139027abc0} - klass: 'java/lang/Object'[]\r\n - length: 33\r\nRCX=0x00000010472472f8 is an oop: org.elasticsearch.index.mapper.KeywordFieldMapper\r\n{0x00000010472472f8} - klass: 'org/elasticsearch/index/mapper/KeywordFieldMapper'\r\nRDX=0x0 is NULL\r\nRSP=0x00007f672c9f5068 is pointing into the stack for thread: 0x00007f67d4081000\r\nRBP=0x00000010472472f8 is an oop: org.elasticsearch.index.mapper.KeywordFieldMapper\r\n{0x00000010472472f8} - klass: 'org/elasticsearch/index/mapper/KeywordFieldMapper'\r\nRSI=0x00000017c149bda0 is a pointer to class:\r\norg.apache.lucene.document.SortedSetDocValuesField {0x00000017c149bda0}\r\nRDI=196552 is a compressed pointer to class: 0x00000017c082ffc8\r\njava.util.ArrayList {0x00000017c082ffc8}\r\nR8 =149196411 is a compressed pointer to object: org.elasticsearch.index.mapper.FieldMapper$MultiFields\r\n{0x00000010472473d8} - klass: 'org/elasticsearch/index/mapper/FieldMapper$MultiFields'\r\nR9 =149196415 is a compressed pointer to object: com.carrotsearch.hppc.ObjectObjectHashMap\r\n{0x00000010472473f8} - klass: 'com/carrotsearch/hppc/ObjectObjectHashMap'\r\nR10=0x00007f692bb01008 is an unknown value\r\nR11=0x0 is NULL\r\nR12=0x0000001000000000 is an unknown value\r\nR13=0x000000139027aa30 is an oop: java.util.ArrayList\r\n{0x000000139027aa30} - klass: 'java/util/ArrayList'\r\nR14=0x0000001390279140 is an oop: org.elasticsearch.index.mapper.ParseContext$InternalParseContext\r\n{0x0000001390279140} - klass: 'org/elasticsearch/index/mapper/ParseContext$InternalParseContext'\r\nR15=0x00007f67d4081000 is a thread\r\n\r\n\r\nRegisters:\r\nRAX=0x0000001390279278, RBX=0x000000139027ac2c, RCX=0x00000010472472f8, RDX=0x0000000000000000\r\nRSP=0x00007f672c9f5068, RBP=0x00000010472472f8, RSI=0x00000017c149bda0, RDI=0x000000000002ffc8\r\nR8 =0x0000000008e48e7b, R9 =0x0000000008e48e7f, R10=0x00007f692bb01008, R11=0x0000000000000000\r\nR12=0x0000001000000000, R13=0x000000139027aa30, R14=0x0000001390279140, R15=0x00007f67d4081000\r\nRIP=0x00007f6915c2583d, EFLAGS=0x0000000000010206, CSGSFS=0x411a000000000033, ERR=0x0000000000000004\r\n  TRAPNO=0x000000000000000e\r\n\r\nTop of Stack: (sp=0x00007f672c9f5068)\r\n0x00007f672c9f5068:   00007f6915f02950 0000001390279a90\r\n0x00007f672c9f5078:   0000001390279140 157340a600000003\r\n0x00007f672c9f5088:   000000103080ca00 0000001390279a90\r\n0x00007f672c9f5098:   0000001043d6fa78 0000001390279ac0\r\n...\r\n```","closed_by":{"login":"weizijun","id":5070449,"node_id":"MDQ6VXNlcjUwNzA0NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/5070449?v=4","gravatar_id":"","url":"https://api.github.com/users/weizijun","html_url":"https://github.com/weizijun","followers_url":"https://api.github.com/users/weizijun/followers","following_url":"https://api.github.com/users/weizijun/following{/other_user}","gists_url":"https://api.github.com/users/weizijun/gists{/gist_id}","starred_url":"https://api.github.com/users/weizijun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weizijun/subscriptions","organizations_url":"https://api.github.com/users/weizijun/orgs","repos_url":"https://api.github.com/users/weizijun/repos","events_url":"https://api.github.com/users/weizijun/events{/privacy}","received_events_url":"https://api.github.com/users/weizijun/received_events","type":"User","site_admin":false},"performed_via_github_app":null}