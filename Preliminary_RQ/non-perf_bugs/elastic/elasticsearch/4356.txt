{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4356","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4356/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4356/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4356/events","html_url":"https://github.com/elastic/elasticsearch/issues/4356","id":23848527,"node_id":"MDU6SXNzdWUyMzg0ODUyNw==","number":4356,"title":"Inconsistent search results when running proximity searches","user":{"login":"spaisey","id":4048991,"node_id":"MDQ6VXNlcjQwNDg5OTE=","avatar_url":"https://avatars3.githubusercontent.com/u/4048991?v=4","gravatar_id":"","url":"https://api.github.com/users/spaisey","html_url":"https://github.com/spaisey","followers_url":"https://api.github.com/users/spaisey/followers","following_url":"https://api.github.com/users/spaisey/following{/other_user}","gists_url":"https://api.github.com/users/spaisey/gists{/gist_id}","starred_url":"https://api.github.com/users/spaisey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spaisey/subscriptions","organizations_url":"https://api.github.com/users/spaisey/orgs","repos_url":"https://api.github.com/users/spaisey/repos","events_url":"https://api.github.com/users/spaisey/events{/privacy}","received_events_url":"https://api.github.com/users/spaisey/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":30486044,"node_id":"MDU6TGFiZWwzMDQ4NjA0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eregression","name":">regression","color":"d7e102","default":false,"description":null},{"id":65649829,"node_id":"MDU6TGFiZWw2NTY0OTgyOQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.8","name":"v0.90.8","color":"DDDDDD","default":false,"description":null},{"id":63637703,"node_id":"MDU6TGFiZWw2MzYzNzcwMw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.RC1","name":"v1.0.0.RC1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2013-12-06T10:22:07Z","updated_at":"2013-12-10T18:14:15Z","closed_at":"2013-12-06T22:11:11Z","author_association":"NONE","active_lock_reason":null,"body":"When running a simple query_string search, specifying the search fields (prefixed with the type), the search returns results as expected.\nWhen running a proximity search query_string, using the same search fields, the search fails. If I remove the type prefix from the search field name, the search works.\n# EXAMPLE:\n## Setup:\n\ncurl -XPUT 'http://localhost:9201/test/product/1' -d '{ \n    \"desc\": \"description of product one with something\" \n}'\ncurl -XPUT 'http://localhost:9200/test/product/2' -d '{ \n    \"desc\": \"description of product two with something else\" \n}'\ncurl -XPUT 'http://localhost:9200/test/product/3' -d '{ \n    \"desc\": \"description of product three with something else again\" \n}'\ncurl -XPUT 'http://localhost:9200/test/customer/1' -d '{ \n    \"desc\": \"description of customer one with something\" \n}'\ncurl -XPUT 'http://localhost:9200/test/customer/2' -d '{ \n    \"desc\": \"description of customer two with something else\" \n}'\ncurl -XPUT 'http://localhost:9200/test/customer/3' -d '{ \n    \"desc\": \"description of customer three with something else again\" \n}'\n## Simple Search:\n\ncurl -XPOST 'http://localhost:9200/test/_search?pretty=true' -d '{\n  \"query\" : {\n      \"query_string\" : {\n          \"query\" : \"description\",\n          \"fields\" : [\"customer.desc\", \"product.desc\"]\n      }\n  }\n}'\n## Failing proximity search:\n\ncurl -XPOST 'http://localhost:9200/test/_search?pretty=true' -d '{\n  \"query\" : {\n      \"query_string\" : {\n          \"query\" : \"\\\"customer else\\\"~5\",\n          \"fields\" : [\"customer.desc\", \"product.desc\"]\n      }\n  }\n}'\n## Successful proximity search:\n\ncurl -XPOST 'http://localhost:9200/test/_search?pretty=true' -d '{\n  \"query\" : {\n      \"query_string\" : {\n          \"query\" : \"\\\"customer else\\\"~5\",\n          \"fields\" : [\"desc\"]\n      }\n  }\n}'\n\nWe want to be able to allow the user to search specific fields, hence prefixing the 'desc' field with either 'customer' or 'product' (our real ES instance has many 'title' and 'desc' fields, so we need to prefix these fields with the type). Is this an incorrect use of fields, or a defect with proximity search?\n\nJava: 1.7.0_45\nES: 90.5\nOS: Windows 7\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}