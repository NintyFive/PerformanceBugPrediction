[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/484000554","html_url":"https://github.com/elastic/elasticsearch/issues/41298#issuecomment-484000554","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298","id":484000554,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDAwMDU1NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-04-17T09:02:33Z","updated_at":"2019-04-17T09:02:33Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/484000566","html_url":"https://github.com/elastic/elasticsearch/issues/41298#issuecomment-484000566","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298","id":484000566,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDAwMDU2Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-04-17T09:02:34Z","updated_at":"2019-04-17T09:02:34Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/484024413","html_url":"https://github.com/elastic/elasticsearch/issues/41298#issuecomment-484024413","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298","id":484024413,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDAyNDQxMw==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-04-17T10:15:26Z","updated_at":"2019-04-17T10:15:57Z","author_association":"CONTRIBUTOR","body":"@ChaosCA this sounds like a corruption at the lucene level. It is reading out the _source for a specific document when encountering this.\r\n\r\nFirst off, if you have replica of the `logs` index, it is possible that one of the replica does not have the issue. I think that if that was the case, simply rerunning reindex a few times should make it succeed, since the scroll query will eventually hit the good node. Otherwise, if you can find out which node holds the bad shard, you could shut that down and then retry the reindex operation.\r\n\r\nYou can also consider using the [`elasticsearch-shard`](https://www.elastic.co/guide/en/elasticsearch/reference/6.7/shard-tool.html) tool to repair, though you will then loose some data. That should be last resort.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/484162212","html_url":"https://github.com/elastic/elasticsearch/issues/41298#issuecomment-484162212","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298","id":484162212,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDE2MjIxMg==","user":{"login":"braunsonm","id":5280764,"node_id":"MDQ6VXNlcjUyODA3NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5280764?v=4","gravatar_id":"","url":"https://api.github.com/users/braunsonm","html_url":"https://github.com/braunsonm","followers_url":"https://api.github.com/users/braunsonm/followers","following_url":"https://api.github.com/users/braunsonm/following{/other_user}","gists_url":"https://api.github.com/users/braunsonm/gists{/gist_id}","starred_url":"https://api.github.com/users/braunsonm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/braunsonm/subscriptions","organizations_url":"https://api.github.com/users/braunsonm/orgs","repos_url":"https://api.github.com/users/braunsonm/repos","events_url":"https://api.github.com/users/braunsonm/events{/privacy}","received_events_url":"https://api.github.com/users/braunsonm/received_events","type":"User","site_admin":false},"created_at":"2019-04-17T16:24:29Z","updated_at":"2019-04-17T16:24:29Z","author_association":"NONE","body":"Unfortunately this is a single node cluster. Using elasticsearch-shard returns the following for all 5 shards:\r\n```\r\nException in thread \"main\" ElasticsearchException[Shard does not seem to be corrupted at /home/elasticsearch/data/elasticsearch/nodes/0/indices/zyqMtQmnSLePx1yfKibWYg/4]\r\n        at org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.lambda$execute$1(RemoveCorruptedShardDataCommand.java:367)\r\n        at org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.findAndProcessShardPath(RemoveCorruptedShardDataCommand.java:211)\r\n        at org.elasticsearch.index.shard.RemoveCorruptedShardDataCommand.execute(RemoveCorruptedShardDataCommand.java:297)\r\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n        at org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:77)\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n        at org.elasticsearch.cli.Command.main(Command.java:90)\r\n        at org.elasticsearch.index.shard.ShardToolCli.main(ShardToolCli.java:35)\r\n``` ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/485675827","html_url":"https://github.com/elastic/elasticsearch/issues/41298#issuecomment-485675827","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298","id":485675827,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NTY3NTgyNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-04-23T07:23:19Z","updated_at":"2019-04-23T07:23:19Z","author_association":"CONTRIBUTOR","body":"@henningandersen AFAICS, the `elasticsearch-shard` tool only checks shards that have a corruption marker. Given that the corruption here happened on read (and not on write), there is no corruption marker added by ES. I wonder if we should add a flag to the `elasticsearch-shard` tool that allows running a fully checkIndex in case there is no corruption marker (or make that even the default).\r\n\r\n@ChaosCA you have two options to detect the corruption: 1) temporarily adding a file to the shard's `index` folder whose name starts with `corrupted_` and then run the `elasticsearch-shard` tool again, or 2) use the `index.shard.check_on_startup` index setting (see https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#_static_index_settings), which requires closing the index, applying the index setting, and then reopening it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/487211540","html_url":"https://github.com/elastic/elasticsearch/issues/41298#issuecomment-487211540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298","id":487211540,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzIxMTU0MA==","user":{"login":"braunsonm","id":5280764,"node_id":"MDQ6VXNlcjUyODA3NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5280764?v=4","gravatar_id":"","url":"https://api.github.com/users/braunsonm","html_url":"https://github.com/braunsonm","followers_url":"https://api.github.com/users/braunsonm/followers","following_url":"https://api.github.com/users/braunsonm/following{/other_user}","gists_url":"https://api.github.com/users/braunsonm/gists{/gist_id}","starred_url":"https://api.github.com/users/braunsonm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/braunsonm/subscriptions","organizations_url":"https://api.github.com/users/braunsonm/orgs","repos_url":"https://api.github.com/users/braunsonm/repos","events_url":"https://api.github.com/users/braunsonm/events{/privacy}","received_events_url":"https://api.github.com/users/braunsonm/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T21:46:52Z","updated_at":"2019-04-26T21:46:52Z","author_association":"NONE","body":"@ywelsch Thank you, adding then `corrupted_` file and running the shard tool resolved my issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/496469984","html_url":"https://github.com/elastic/elasticsearch/issues/41298#issuecomment-496469984","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298","id":496469984,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NjQ2OTk4NA==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-05-28T11:04:05Z","updated_at":"2019-05-28T11:04:05Z","author_association":"CONTRIBUTOR","body":"We changed the shard CLI tool to always check shards, regardless of corruption marker. Closing this issue.","performed_via_github_app":null}]