[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/25314501","html_url":"https://github.com/elastic/elasticsearch/issues/3802#issuecomment-25314501","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3802","id":25314501,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzE0NTAx","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2013-09-29T04:56:14Z","updated_at":"2013-09-29T04:56:14Z","author_association":"MEMBER","body":"Don't forget to close bulk processor at the end and perhaps wait for some seconds.\nOtherwise the pending bulk actions won't be performed.\n\nHTH\n\n## \n\nDavid ;-)\nTwitter : @dadoonet / @elasticsearchfr / @scrutmydocs\n\nLe 29 sept. 2013 à 05:15, spancer notifications@github.com a écrit :\n\n> Hi Guys, \n> I'm using bulkProcessor to migrate index data from one cluster to another. To enhance the speed, i used bulkProcessor instead of using single BulkRequestBuilder. And I found the new index doc size is always less than the source cluster one.\n> \n> My test code is somewhat like below: \n> \n> int total = 0;\n> int pageSize = 50;\n> String oldIndexName = \"testold\";\n> String newIndexName = \"testnew\";\n> String indexDocType = \"test\";\n> Client sourceclient = ClientUtil.getSourceTransportClient();\n> Client targetclient = ClientUtil.getTargetTransportClient();\n> SearchResponse searchResponse = sourceclient.prepareSearch(oldIndexName).setSearchType(SearchType.SCAN)\n> .setQuery(matchAllQuery()).setSize(pageSize).setScroll(TimeValue.timeValueSeconds(20)).execute()\n> .actionGet();\n> ImmutableMap map = targetclient.admin().cluster().prepareState().execute().actionGet()\n> .getState().getMetaData().getIndices();\n> if (!map.containsKey(newIndexName))\n> targetclient\n> .admin()\n> .indices()\n> .prepareCreate(newIndexName)\n> .setSettings(\n> settingsBuilder().put(\"index.number_of_replicas\", 0).put(\"index.refresh_interval\", \"-1\"))\n> .execute().actionGet();\n> Thread.sleep(200);\n> BulkProcessor bulkProcessor = BulkProcessor.builder(targetclient, new BulkProcessor.Listener()\n> {\n> \n> ```\n>     @Override\n>     public void beforeBulk(long executionId, BulkRequest request)\n>     {\n> \n>     }\n> \n>     @Override\n>     public void afterBulk(long executionId, BulkRequest request, BulkResponse response)\n>     {\n>         if (response.hasFailures())\n>         {\n>             throw new RuntimeException(\"BulkResponse show failures: \" + response.buildFailureMessage());\n>         }\n>     }\n> \n>     @Override\n>     public void afterBulk(long executionId, BulkRequest request, Throwable failure)\n>     {\n>         throw new RuntimeException(\"Caught exception in bulk: \" + request + \", failure: \" + failure, failure);\n>     }\n> }).setConcurrentRequests(10).build();\n> \n> while (true)\n> {\n>     searchResponse = sourceclient.prepareSearchScroll(searchResponse.getScrollId())\n>             .setScroll(TimeValue.timeValueSeconds(20)).execute().actionGet();\n>     for (SearchHit hit : searchResponse.getHits())\n>     {\n> \n>         IndexRequestBuilder indexRequestBuilder = targetclient.prepareIndex(newIndexName, indexDocType, hit\n>                 .getSource().get(\"_id\").toString());\n>         indexRequestBuilder.setSource(hit.getSource());\n>         indexRequestBuilder.setOpType(IndexRequest.OpType.CREATE);\n>         bulkProcessor.add(indexRequestBuilder.request());\n>         total++;\n>     }\n>     System.out.println(\"Already migrated : \" + total + \" records!\");\n>     if (searchResponse.getHits().hits().length == 0)\n>     {\n>         break;\n>     }\n> }\n> ```\n> \n> I got no exception thrown out, and the ids of my docs are absolute unique. You guys can easily reproduce the issue using the above code. I don't know whether it's my error using of bulkProcessor or am I missing something? Or it's really a bug of bulkProcessor .\n> \n> Thanks, \n> Spancer\n> \n> —\n> Reply to this email directly or view it on GitHub.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/25315479","html_url":"https://github.com/elastic/elasticsearch/issues/3802#issuecomment-25315479","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3802","id":25315479,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzE1NDc5","user":{"login":"spancer","id":1046225,"node_id":"MDQ6VXNlcjEwNDYyMjU=","avatar_url":"https://avatars2.githubusercontent.com/u/1046225?v=4","gravatar_id":"","url":"https://api.github.com/users/spancer","html_url":"https://github.com/spancer","followers_url":"https://api.github.com/users/spancer/followers","following_url":"https://api.github.com/users/spancer/following{/other_user}","gists_url":"https://api.github.com/users/spancer/gists{/gist_id}","starred_url":"https://api.github.com/users/spancer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spancer/subscriptions","organizations_url":"https://api.github.com/users/spancer/orgs","repos_url":"https://api.github.com/users/spancer/repos","events_url":"https://api.github.com/users/spancer/events{/privacy}","received_events_url":"https://api.github.com/users/spancer/received_events","type":"User","site_admin":false},"created_at":"2013-09-29T06:55:13Z","updated_at":"2013-09-29T06:55:13Z","author_association":"NONE","body":"Yep. Thanks dodoonet, I'll make some test across it. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/25316513","html_url":"https://github.com/elastic/elasticsearch/issues/3802#issuecomment-25316513","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3802","id":25316513,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzE2NTEz","user":{"login":"spancer","id":1046225,"node_id":"MDQ6VXNlcjEwNDYyMjU=","avatar_url":"https://avatars2.githubusercontent.com/u/1046225?v=4","gravatar_id":"","url":"https://api.github.com/users/spancer","html_url":"https://github.com/spancer","followers_url":"https://api.github.com/users/spancer/followers","following_url":"https://api.github.com/users/spancer/following{/other_user}","gists_url":"https://api.github.com/users/spancer/gists{/gist_id}","starred_url":"https://api.github.com/users/spancer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spancer/subscriptions","organizations_url":"https://api.github.com/users/spancer/orgs","repos_url":"https://api.github.com/users/spancer/repos","events_url":"https://api.github.com/users/spancer/events{/privacy}","received_events_url":"https://api.github.com/users/spancer/received_events","type":"User","site_admin":false},"created_at":"2013-09-29T08:31:48Z","updated_at":"2013-09-29T08:31:48Z","author_association":"NONE","body":"Before calling bulk processor, wait some time, it does help. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/25353794","html_url":"https://github.com/elastic/elasticsearch/issues/3802#issuecomment-25353794","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3802","id":25353794,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzUzNzk0","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2013-09-30T11:43:01Z","updated_at":"2013-09-30T11:43:01Z","author_association":"MEMBER","body":"@spancer you don't have to wait, you can issue a refresh API call at the end of the bulk indexing process, to make sure you search on the data you already indexed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/25361115","html_url":"https://github.com/elastic/elasticsearch/issues/3802#issuecomment-25361115","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3802","id":25361115,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzYxMTE1","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2013-09-30T13:29:15Z","updated_at":"2013-09-30T13:29:15Z","author_association":"MEMBER","body":"Ah thanks @kimchy!\nStupid me. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/30645011","html_url":"https://github.com/elastic/elasticsearch/issues/3802#issuecomment-30645011","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3802","id":30645011,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjQ1MDEx","user":{"login":"spancer","id":1046225,"node_id":"MDQ6VXNlcjEwNDYyMjU=","avatar_url":"https://avatars2.githubusercontent.com/u/1046225?v=4","gravatar_id":"","url":"https://api.github.com/users/spancer","html_url":"https://github.com/spancer","followers_url":"https://api.github.com/users/spancer/followers","following_url":"https://api.github.com/users/spancer/following{/other_user}","gists_url":"https://api.github.com/users/spancer/gists{/gist_id}","starred_url":"https://api.github.com/users/spancer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spancer/subscriptions","organizations_url":"https://api.github.com/users/spancer/orgs","repos_url":"https://api.github.com/users/spancer/repos","events_url":"https://api.github.com/users/spancer/events{/privacy}","received_events_url":"https://api.github.com/users/spancer/received_events","type":"User","site_admin":false},"created_at":"2013-12-16T09:03:09Z","updated_at":"2013-12-16T09:03:09Z","author_association":"NONE","body":"@kimchy  Thanks, shay.\n","performed_via_github_app":null}]