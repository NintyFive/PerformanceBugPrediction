[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40722259","html_url":"https://github.com/elastic/elasticsearch/issues/5854#issuecomment-40722259","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5854","id":40722259,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzIyMjU5","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2014-04-17T14:49:00Z","updated_at":"2014-04-17T14:49:00Z","author_association":"CONTRIBUTOR","body":"the other approach, what lucene does, is to detect low cardinality (with respect to number of matching docs) and just collect with segment ords, and then convert over in a second pass. Imagine 1 billion docs with only 5 unique values, this saves a lot of cpu since you arent remapping the same stuff over and over.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40724244","html_url":"https://github.com/elastic/elasticsearch/issues/5854#issuecomment-40724244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5854","id":40724244,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzI0MjQ0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-04-17T15:05:47Z","updated_at":"2014-04-17T15:05:47Z","author_association":"MEMBER","body":"@jpountz Nice idea! The caveat here is that the largest segment does need to have all values, but for low cardinality fields this should already be the case.\n\n@rmuir That implies a feature using global ordinals (e.g. terms aggs) to change its behaviour (different execution mode). This nice thing about @jpountz trick is that it is behind the field data ordinals interface and features using it wouldn't know about, so it is a small change.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40725497","html_url":"https://github.com/elastic/elasticsearch/issues/5854#issuecomment-40725497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5854","id":40725497,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzI1NDk3","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2014-04-17T15:16:21Z","updated_at":"2014-04-17T15:16:21Z","author_association":"CONTRIBUTOR","body":"@martijnvg right, the two-pass approach requires a different execution mode, thats true, but it does not require any special alignment of ordinals, so its a more general optimization. When I applied this to apache solr last year, I think it doubled faceting performance for low cardinality fields: https://issues.apache.org/jira/browse/SOLR-5512\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40725849","html_url":"https://github.com/elastic/elasticsearch/issues/5854#issuecomment-40725849","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5854","id":40725849,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzI1ODQ5","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-04-17T15:19:11Z","updated_at":"2014-04-17T15:19:11Z","author_association":"CONTRIBUTOR","body":"@rmuir When @martijnvg and I worked on global ordinals for Elasticsearch, we considered building aggregations with segment ordinals first and merging in a final step, but this introduced some complexity as well since we would need to add logic to merge sub aggregation buckets together (on every Aggregator impl).\n\nOn the other hand, global ordinals are very appealing since we can use global ordinals directly as bucket ordinals.\n\nI think working with segment ordinals could be interesting for leaf terms aggregators though as in this case we don't need to merge sub aggregations.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40726845","html_url":"https://github.com/elastic/elasticsearch/issues/5854#issuecomment-40726845","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5854","id":40726845,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzI2ODQ1","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2014-04-17T15:27:32Z","updated_at":"2014-04-17T15:27:32Z","author_association":"CONTRIBUTOR","body":"When i benchmarked the change, it was as you would imagine, for high cardinality fields its slower to do two passes, too much overhead. The crazy heuristic to decide is something Mike came up with benchmarking lucene facets, I just stole it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40813042","html_url":"https://github.com/elastic/elasticsearch/issues/5854#issuecomment-40813042","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5854","id":40813042,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODEzMDQy","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-04-18T14:35:13Z","updated_at":"2014-04-18T14:35:13Z","author_association":"MEMBER","body":"> I think working with segment ordinals could be interesting for leaf terms aggregators though as in this case we don't need to merge sub aggregations.\n\n+1 to explore and add this for leaf terms aggs\n","performed_via_github_app":null}]