{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22254","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22254/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22254/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22254/events","html_url":"https://github.com/elastic/elasticsearch/issues/22254","id":196375217,"node_id":"MDU6SXNzdWUxOTYzNzUyMTc=","number":22254,"title":"Misleading deprecation notice regarding sorting by ascending count in terms aggregation","user":{"login":"naag","id":416860,"node_id":"MDQ6VXNlcjQxNjg2MA==","avatar_url":"https://avatars3.githubusercontent.com/u/416860?v=4","gravatar_id":"","url":"https://api.github.com/users/naag","html_url":"https://github.com/naag","followers_url":"https://api.github.com/users/naag/followers","following_url":"https://api.github.com/users/naag/following{/other_user}","gists_url":"https://api.github.com/users/naag/gists{/gist_id}","starred_url":"https://api.github.com/users/naag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/naag/subscriptions","organizations_url":"https://api.github.com/users/naag/orgs","repos_url":"https://api.github.com/users/naag/repos","events_url":"https://api.github.com/users/naag/events{/privacy}","received_events_url":"https://api.github.com/users/naag/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-12-19T10:08:43Z","updated_at":"2016-12-19T14:43:54Z","closed_at":"2016-12-19T12:11:35Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.4.2\r\n\r\n**Plugins installed**:\r\n\r\n- kopf\r\n\r\n**JVM version**: Oracle Java 1.8.0_111\r\n\r\n**OS version**: Ubuntu 14.04.5 LTS\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen sending a query with terms aggegration and no sorting or descending sort by `_count`, we get a deprecation log complaining that \"[deprecation.search.aggregations.bucket.terms] sorting by ascending count is deprecated and will be removed in the next major version\". It seems the deprecation logging is triggered in exactly the opposite case?\r\n\r\n**Steps to reproduce**:\r\n 1. `docker run -p 9200:9200 elasticsearch:2.4.2 -Des.logger.level=DEBUG`\r\n 2. `curl -XPOST -d'{\"foo\":1}' http://localhost:9200/test/test`\r\n 3. `curl -d'{\"aggs\":{\"test_agg\":{\"terms\":{\"field\":\"foo\",\"order\":{\"_count\":\"desc\"}}}},\"size\":0}' http://localhost:9200/test/_search`\r\n 4. OR `curl -d'{\"aggs\":{\"test_agg\":{\"terms\":{\"field\":\"foo\"}}},\"size\":0}' http://localhost:9200/test/_search`\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\n[2016-12-19 10:04:37,463][DEBUG][deprecation.search.aggregations.bucket.terms] sorting by ascending count is deprecated and will be removed in the next major version\r\n[2016-12-19 10:04:37,464][DEBUG][deprecation.search.aggregations.bucket.terms] sorting by ascending count is deprecated and will be removed in the next major version\r\n[2016-12-19 10:04:37,464][DEBUG][deprecation.search.aggregations.bucket.terms] sorting by ascending count is deprecated and will be removed in the next major version\r\n[2016-12-19 10:04:37,463][DEBUG][deprecation.search.aggregations.bucket.terms] sorting by ascending count is deprecated and will be removed in the next major version\r\n[2016-12-19 10:04:37,463][DEBUG][deprecation.search.aggregations.bucket.terms] sorting by ascending count is deprecated and will be removed in the next major version\r\n```\r\n\r\nQueries with `\"order\":{\"_count\":\"asc\"}` don't trigger the deprecation.\r\n\r\nWe're trying to prepare our upgrade from 2.x to 5.x, and in this process would like to completely clear all deprecated queries, but this severly hinders us. We could prepare a PR against 2.4.2 in case this helps.\r\n\r\nThanks!","closed_by":{"login":"naag","id":416860,"node_id":"MDQ6VXNlcjQxNjg2MA==","avatar_url":"https://avatars3.githubusercontent.com/u/416860?v=4","gravatar_id":"","url":"https://api.github.com/users/naag","html_url":"https://github.com/naag","followers_url":"https://api.github.com/users/naag/followers","following_url":"https://api.github.com/users/naag/following{/other_user}","gists_url":"https://api.github.com/users/naag/gists{/gist_id}","starred_url":"https://api.github.com/users/naag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/naag/subscriptions","organizations_url":"https://api.github.com/users/naag/orgs","repos_url":"https://api.github.com/users/naag/repos","events_url":"https://api.github.com/users/naag/events{/privacy}","received_events_url":"https://api.github.com/users/naag/received_events","type":"User","site_admin":false},"performed_via_github_app":null}