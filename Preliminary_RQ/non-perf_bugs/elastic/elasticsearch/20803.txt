{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20803","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20803/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20803/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20803/events","html_url":"https://github.com/elastic/elasticsearch/issues/20803","id":181688576,"node_id":"MDU6SXNzdWUxODE2ODg1NzY=","number":20803,"title":"Custom Analyzer does not work as a chain as expected.","user":{"login":"jzbahrai","id":8869623,"node_id":"MDQ6VXNlcjg4Njk2MjM=","avatar_url":"https://avatars2.githubusercontent.com/u/8869623?v=4","gravatar_id":"","url":"https://api.github.com/users/jzbahrai","html_url":"https://github.com/jzbahrai","followers_url":"https://api.github.com/users/jzbahrai/followers","following_url":"https://api.github.com/users/jzbahrai/following{/other_user}","gists_url":"https://api.github.com/users/jzbahrai/gists{/gist_id}","starred_url":"https://api.github.com/users/jzbahrai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzbahrai/subscriptions","organizations_url":"https://api.github.com/users/jzbahrai/orgs","repos_url":"https://api.github.com/users/jzbahrai/repos","events_url":"https://api.github.com/users/jzbahrai/events{/privacy}","received_events_url":"https://api.github.com/users/jzbahrai/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-10-07T14:49:48Z","updated_at":"2016-10-07T15:28:51Z","closed_at":"2016-10-07T15:28:51Z","author_association":"NONE","active_lock_reason":null,"body":"The settings are as follows:\n\n```\n   \"products_v2\": {\n      \"settings\": {\n         \"index\": {\n            \"creation_date\": \"1475684313640\",\n            \"analysis\": {\n               \"filter\": {\n                  \"english_keywords\": {\n                     \"ignore_case\": \"true\",\n                     \"type\": \"keyword_marker\",\n                     \"keywords_path\": \"analysis/exclude_stem.txt\"\n                  },\n                  \"synonym_expand\": {\n                     \"type\": \"synonym\",\n                     \"synonyms_path\": \"analysis/synonyms.txt\"\n                  },\n                  \"english_stemmer\": {\n                     \"type\": \"stemmer\",\n                     \"language\": \"english\"\n                  },\n                  \"english_stop\": {\n                     \"type\": \"stop\",\n                     \"stopwords\": \"_english_\"\n                  },\n                  \"english_possessive_stemmer\": {\n                     \"type\": \"stemmer\",\n                     \"language\": \"possessive_english\"\n                  },\n               \"char_filter\": {\n                  \"stem_mapping\": {\n                     \"type\": \"mapping\",\n                     \"mappings_path\": \"analysis/char_mappings.txt\"\n                  }\n               },\n               \"analyzer\": {\n                  \"synonyms_expand\": {\n                     \"filter\": [\n                        \"synonym_expand\",\n                        \"english_possessive_stemmer\",\n                        \"lowercase\",\n                        \"english_stop\",\n                        \"english_keywords\",\n                        \"english_stemmer\"\n                     ],\n                 \"type\": \"custom\",\n                  \"tokenizer\": \"standard\"\n                  }\n                }\n         }\n}\n```\n\nThe expected result after expansion for synonym is the following:\n\n```\nGET /products_v2/_analyze?analyzer=english&text=\"jell-o\"\n{\n   \"tokens\": [\n      {\n         \"token\": \"jell\",\n         \"start_offset\": 1,\n         \"end_offset\": 5,\n         \"type\": \"<ALPHANUM>\",\n         \"position\": 0\n      },\n      {\n         \"token\": \"o\",\n         \"start_offset\": 6,\n         \"end_offset\": 7,\n         \"type\": \"<ALPHANUM>\",\n         \"position\": 1\n      }\n   ]\n}\n```\n\nThe synonym I put in is jello=>jell-o\n\nThe result that I get after using the synonym analyzer\n\n```\nGET /products_v2/_analyze?analyzer=synonyms_expand&text=\"jello\"\n{\n   \"tokens\": [\n      {\n         \"token\": \"jell-o\",\n         \"start_offset\": 1,\n         \"end_offset\": 6,\n         \"type\": \"SYNONYM\",\n         \"position\": 0\n      }\n   ]\n}\n```\n\nThis doesn't seem right. I use the english chain after synonyms expanded.\nThe result should be the same as the one that I get when running:\nGET /products_v2/_analyze?analyzer=english&text=\"jell-o\"\n\nThe reason for this is because the standard analyzer gets applied first and only then do we apply the synonym analyzer\n\nWhat happens: \njello, the standard analyzer gets applied. There is no taken chain\nThen the word gets expanded to the synonym analzyer: jell-o\nAt this point there is no tokenization that happens to jell-o. The word doesn't change.\n\nWhen jell-o gets indexed -  it gets indexed using the english analyzer so \"jell o\". Therefore it doesn't change.  Is there anyway we can add a standard tokenizer to the chain of analysis after the synonym expansion happens? \n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}