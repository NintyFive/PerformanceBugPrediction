[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373573858","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373573858","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373573858,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzU3Mzg1OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T01:23:16Z","updated_at":"2018-03-16T01:23:16Z","author_association":"MEMBER","body":"Would you please take the PID of an Elasticsearch process and as the number of open file descriptors grows capture the output of `ls -al /proc/<PID>/fd` and send the output to me privately (first name at elastic.co)? You might want to repeat this a few times as it grows and grows so we can diff and easily see what it is growing on.\r\n\r\nWhen you say the node is crashing, do you have logs for this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373574033","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373574033","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373574033,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzU3NDAzMw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T01:24:11Z","updated_at":"2018-03-16T01:24:11Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373583856","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373583856","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373583856,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzU4Mzg1Ng==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T02:26:04Z","updated_at":"2018-03-16T02:26:04Z","author_association":"NONE","body":"Hi Jason,\r\n\r\nI've sent you several files with the output of `ls -al /proc/<PID>/fd ` on timestamps along 17 minutes, during which the open file descriptors increased from ~99k to ~105k.\r\n\r\nNodes reaching the ulimit actually crash the process. Here are the last few logs of a node which crashed:\r\n\r\n> [2018-03-14T03:27:47,930][WARN ][o.e.i.e.Engine           ] [prod-elasticsearch-data-028] [newlogs_20180314-01][1] failed to read latest segment infos on flush\r\njava.nio.file.FileSystemException: /mnt/nodes/0/indices/-mwGJUcDRXKRtezeXPaZSA/1/index: Too many open files\r\n    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:91) ~[?:?]\r\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102) ~[?:?]\r\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107) ~[?:?]\r\n    at sun.nio.fs.UnixFileSystemProvider.newDirectoryStream(UnixFileSystemProvider.java:427) ~[?:?]\r\n    at java.nio.file.Files.newDirectoryStream(Files.java:457) ~[?:1.8.0_151]\r\n    at org.apache.lucene.store.FSDirectory.listAll(FSDirectory.java:215) ~[lucene-core-7.2.1.jar:7.2.1 b2b6438b37073bee1fca40374e85bf91aa457c0b - ubuntu - 2018-01-10 00:48:43]\r\n    at org.apache.lucene.store.FSDirectory.listAll(FSDirectory.java:234) ~[lucene-core-7.2.1.jar:7.2.1 b2b6438b37073bee1fca40374e85bf91aa457c0b - ubuntu - 2018-01-10 00:48:43]\r\n    at org.apache.lucene.store.FilterDirectory.listAll(FilterDirectory.java:57) ~[lucene-core-7.2.1.jar:7.2.1 b2b6438b37073bee1fca40374e85bf91aa457c0b - ubuntu - 2018-01-10 00:48:43]\r\n    at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:655) ~[lucene-core-7.2.1.jar:7.2.1 b2b6438b37073bee1fca40374e85bf91aa457c0b - ubuntu - 2018-01-10 00:48:43]\r\n    at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:627) ~[lucene-core-7.2.1.jar:7.2.1 b2b6438b37073bee1fca40374e85bf91aa457c0b - ubuntu - 2018-01-10 00:48:43]\r\n    at org.apache.lucene.index.SegmentInfos.readLatestCommit(SegmentInfos.java:434) ~[lucene-core-7.2.1.jar:7.2.1 b2b6438b37073bee1fca40374e85bf91aa457c0b - ubuntu - 2018-01-10 00:48:43]\r\n    at org.elasticsearch.common.lucene.Lucene.readSegmentInfos(Lucene.java:123) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.store.Store.readSegmentsInfo(Store.java:202) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.store.Store.readLastCommittedSegmentsInfo(Store.java:187) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.engine.InternalEngine.refreshLastCommittedSegmentInfos(InternalEngine.java:1599) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.engine.InternalEngine.flush(InternalEngine.java:1570) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard.flush(IndexShard.java:1030) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard$4.doRun(IndexShard.java:2403) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:672) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_151]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_151]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\n[2018-03-14T03:27:48,040][WARN ][o.e.i.s.IndexShard       ] [prod-elasticsearch-data-028] [newlogs_20180314-01][1] failed to flush index\r\norg.elasticsearch.index.engine.FlushFailedEngineException: Flush failed\r\n    at org.elasticsearch.index.engine.InternalEngine.flush(InternalEngine.java:1568) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard.flush(IndexShard.java:1030) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard$4.doRun(IndexShard.java:2403) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:672) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.2.2.jar:6.2.2]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_151]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_151]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\nCaused by: java.nio.file.FileSystemException: /mnt/nodes/0/indices/-mwGJUcDRXKRtezeXPaZSA/1/translog/translog-24471.ckp: Too many open files\r\n    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:91) ~[?:?]\r\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102) ~[?:?]\r\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107) ~[?:?]\r\n    at sun.nio.fs.UnixCopyFile.copyFile(UnixCopyFile.java:243) ~[?:?]\r\n    at sun.nio.fs.UnixCopyFile.copy(UnixCopyFile.java:581) ~[?:?]\r\n    at sun.nio.fs.UnixFileSystemProvider.copy(UnixFileSystemProvider.java:253) ~[?:?]\r\n    at java.nio.file.Files.copy(Files.java:1274) ~[?:1.8.0_151]\r\n    at org.elasticsearch.index.translog.Translog.rollGeneration(Translog.java:1539) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.engine.InternalEngine.flush(InternalEngine.java:1560) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    ... 7 more\r\n[2018-03-14T03:27:48,398][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [prod-elasticsearch-data-028] fatal error in thread [elasticsearch[prod-elasticsearch-data-028][bulk][T#2]], exiting\r\njava.lang.AssertionError: Unexpected AlreadyClosedException\r\n    at org.elasticsearch.index.engine.InternalEngine.failOnTragicEvent(InternalEngine.java:1779) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.engine.InternalEngine.maybeFailEngine(InternalEngine.java:1796) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:904) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard.index(IndexShard.java:738) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard.applyIndexOperation(IndexShard.java:707) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard.applyIndexOperationOnReplica(IndexShard.java:680) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.performOpOnReplica(TransportShardBulkAction.java:518) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.performOnReplica(TransportShardBulkAction.java:480) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnReplica(TransportShardBulkAction.java:466) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnReplica(TransportShardBulkAction.java:72) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncReplicaAction.onResponse(TransportReplicationAction.java:567) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncReplicaAction.onResponse(TransportReplicationAction.java:530) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard$2.onResponse(IndexShard.java:2314) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard$2.onResponse(IndexShard.java:2292) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:238) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationPermit(IndexShard.java:2291) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncReplicaAction.doRun(TransportReplicationAction.java:641) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(TransportReplicationAction.java:513) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(TransportReplicationAction.java:493) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1555) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:672) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_151]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_151]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\nCaused by: org.apache.lucene.store.AlreadyClosedException: translog is already closed\r\n    at org.elasticsearch.index.translog.Translog.ensureOpen(Translog.java:1663) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.translog.Translog.add(Translog.java:504) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    at org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:886) ~[elasticsearch-6.2.2.jar:6.2.2]\r\n    ... 24 more\r\n\r\nCould this be related to #25005? [https://github.com/elastic/elasticsearch/pull/25005](#25005)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373644908","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373644908","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373644908,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzY0NDkwOA==","user":{"login":"farin99","id":683343,"node_id":"MDQ6VXNlcjY4MzM0Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/683343?v=4","gravatar_id":"","url":"https://api.github.com/users/farin99","html_url":"https://github.com/farin99","followers_url":"https://api.github.com/users/farin99/followers","following_url":"https://api.github.com/users/farin99/following{/other_user}","gists_url":"https://api.github.com/users/farin99/gists{/gist_id}","starred_url":"https://api.github.com/users/farin99/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farin99/subscriptions","organizations_url":"https://api.github.com/users/farin99/orgs","repos_url":"https://api.github.com/users/farin99/repos","events_url":"https://api.github.com/users/farin99/events{/privacy}","received_events_url":"https://api.github.com/users/farin99/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T08:52:15Z","updated_at":"2018-03-16T08:52:15Z","author_association":"NONE","body":"from running: `sudo lsof -p <es process>`\r\n90% of the file descriptors are from translog-xxxxx.tlog files. Seems like elastic never deletes these files","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373668023","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373668023","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373668023,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzY2ODAyMw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T10:16:53Z","updated_at":"2018-03-16T10:16:53Z","author_association":"MEMBER","body":"@farin99 can you describe how many active shards you have on each nodes - i.e., how many shards receive index operations in a 12 hours period ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373669972","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373669972","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373669972,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzY2OTk3Mg==","user":{"login":"ArielCoralogix","id":37430438,"node_id":"MDQ6VXNlcjM3NDMwNDM4","avatar_url":"https://avatars0.githubusercontent.com/u/37430438?v=4","gravatar_id":"","url":"https://api.github.com/users/ArielCoralogix","html_url":"https://github.com/ArielCoralogix","followers_url":"https://api.github.com/users/ArielCoralogix/followers","following_url":"https://api.github.com/users/ArielCoralogix/following{/other_user}","gists_url":"https://api.github.com/users/ArielCoralogix/gists{/gist_id}","starred_url":"https://api.github.com/users/ArielCoralogix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArielCoralogix/subscriptions","organizations_url":"https://api.github.com/users/ArielCoralogix/orgs","repos_url":"https://api.github.com/users/ArielCoralogix/repos","events_url":"https://api.github.com/users/ArielCoralogix/events{/privacy}","received_events_url":"https://api.github.com/users/ArielCoralogix/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T10:23:47Z","updated_at":"2018-03-16T10:23:47Z","author_association":"NONE","body":"Hey @bleskes \r\nAnswering for @farin99 here - we have a few hundreds of active shards per node. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373690377","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373690377","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373690377,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzY5MDM3Nw==","user":{"login":"amnons77","id":20814629,"node_id":"MDQ6VXNlcjIwODE0NjI5","avatar_url":"https://avatars2.githubusercontent.com/u/20814629?v=4","gravatar_id":"","url":"https://api.github.com/users/amnons77","html_url":"https://github.com/amnons77","followers_url":"https://api.github.com/users/amnons77/followers","following_url":"https://api.github.com/users/amnons77/following{/other_user}","gists_url":"https://api.github.com/users/amnons77/gists{/gist_id}","starred_url":"https://api.github.com/users/amnons77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amnons77/subscriptions","organizations_url":"https://api.github.com/users/amnons77/orgs","repos_url":"https://api.github.com/users/amnons77/repos","events_url":"https://api.github.com/users/amnons77/events{/privacy}","received_events_url":"https://api.github.com/users/amnons77/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T11:48:52Z","updated_at":"2018-03-16T11:48:52Z","author_association":"NONE","body":"Hey @bleskes,\r\n1. We have about 2600 shards that received an index operations in a 24H period.\r\n2. We tried to change the \"index.translog.retention.age\" to 30m for the indexes who holds that shards and it didn't reduced the amount of \"open_file_descriptors\".\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373700378","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373700378","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373700378,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzcwMDM3OA==","user":{"login":"amnons77","id":20814629,"node_id":"MDQ6VXNlcjIwODE0NjI5","avatar_url":"https://avatars2.githubusercontent.com/u/20814629?v=4","gravatar_id":"","url":"https://api.github.com/users/amnons77","html_url":"https://github.com/amnons77","followers_url":"https://api.github.com/users/amnons77/followers","following_url":"https://api.github.com/users/amnons77/following{/other_user}","gists_url":"https://api.github.com/users/amnons77/gists{/gist_id}","starred_url":"https://api.github.com/users/amnons77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amnons77/subscriptions","organizations_url":"https://api.github.com/users/amnons77/orgs","repos_url":"https://api.github.com/users/amnons77/repos","events_url":"https://api.github.com/users/amnons77/events{/privacy}","received_events_url":"https://api.github.com/users/amnons77/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T12:36:19Z","updated_at":"2018-03-16T12:36:19Z","author_association":"NONE","body":"@bleskes  \r\nSorry, my previous comment described the number of open shards on this entire cluster. We have about 100 open shards per node per 12 hours. \r\nBtw, this same setup works in parallel now (data fan out) on version 5.2 with no issues and about 5000 open file descriptors while the 6.2 cluster already exceeded 150,000 for some of the nodes.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373732667","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373732667","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373732667,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzczMjY2Nw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T14:36:40Z","updated_at":"2018-03-16T14:36:40Z","author_association":"MEMBER","body":"@amnons77 ok, if trimming the retention policy doesn't help we need figure out what's going on. Let's takes this to the forums to sort out. Can you post a message, including the output of nodes stats on http://discuss.elastic.co and link it here? once we know what it is we can, if needed, come back to github ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373751415","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373751415","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373751415,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mzc1MTQxNQ==","user":{"login":"ArielCoralogix","id":37430438,"node_id":"MDQ6VXNlcjM3NDMwNDM4","avatar_url":"https://avatars0.githubusercontent.com/u/37430438?v=4","gravatar_id":"","url":"https://api.github.com/users/ArielCoralogix","html_url":"https://github.com/ArielCoralogix","followers_url":"https://api.github.com/users/ArielCoralogix/followers","following_url":"https://api.github.com/users/ArielCoralogix/following{/other_user}","gists_url":"https://api.github.com/users/ArielCoralogix/gists{/gist_id}","starred_url":"https://api.github.com/users/ArielCoralogix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArielCoralogix/subscriptions","organizations_url":"https://api.github.com/users/ArielCoralogix/orgs","repos_url":"https://api.github.com/users/ArielCoralogix/repos","events_url":"https://api.github.com/users/ArielCoralogix/events{/privacy}","received_events_url":"https://api.github.com/users/ArielCoralogix/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T15:34:53Z","updated_at":"2018-03-16T15:34:53Z","author_association":"NONE","body":"Hey @bleskes I am referring to the ticket opened by our colleague @redlus on the Discuss forum: https://discuss.elastic.co/t/elasticsearch-6-2-2-nodes-crash-after-reaching-ulimit-setting/124172\r\nAlso, Lior ran  'GET /_stats?include_segment_file_sizes&level=shards' and send the result files from 3 different times to @nhat which is also active on that thread. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373886135","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373886135","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373886135,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mzg4NjEzNQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-17T01:58:06Z","updated_at":"2018-03-17T01:58:06Z","author_association":"MEMBER","body":"The translog for four of your shards (from three distinct indices) is behaving in an unanticipated way. Could you please share the index settings for:\r\n `DN_QfOruR5SMVRavPDnRfw`\r\n `rRrAxVZzSye4W_-exBocCA`\r\n `r-cR4xWkSFinkKg_RqiDsA`\r\n\r\n(from `/{index}/_settings`). I do not know the name of the indices that these correspond to, you will have to backtrace.\r\n\r\nAnd can you also share the shard stats for these indices (from `/{index}/_stats?level=shards&include_segment_file_sizes=true`). You can email them to the same email address that you used before.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373924697","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373924697","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373924697,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzkyNDY5Nw==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-03-17T14:35:50Z","updated_at":"2018-03-17T14:35:50Z","author_association":"MEMBER","body":"I opened #29125 to propose a fix for this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373926299","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373926299","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373926299,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzkyNjI5OQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-03-17T14:58:16Z","updated_at":"2018-03-17T14:58:16Z","author_association":"MEMBER","body":"The problem is that one replica got into an endless loop of flushing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373926323","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-373926323","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":373926323,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzkyNjMyMw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-17T14:58:32Z","updated_at":"2018-03-17T14:58:32Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375314577","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-375314577","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":375314577,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTMxNDU3Nw==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T13:56:03Z","updated_at":"2018-03-22T13:56:03Z","author_association":"NONE","body":"Hey @dnhatn @bleskes and @jasontedor,\r\n\r\nWe can confirm this affects v6.0.2 as well:\r\n![image](https://user-images.githubusercontent.com/7827282/37774494-052aa282-2de9-11e8-8772-0337685cbd52.png)\r\n\r\nAt 09:22 the node enters a state where the open file descriptors monotonically increase.\r\nThis is accompanied by higher load average, cpu, total indices actions and indices operation time.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/379690473","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-379690473","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":379690473,"node_id":"MDEyOklzc3VlQ29tbWVudDM3OTY5MDQ3Mw==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-04-09T09:25:13Z","updated_at":"2018-04-09T09:25:13Z","author_association":"NONE","body":"Commit #29125 changes the mechanism controlling the flush operation, and although it has been committed to the master, the latest elasticsearch version does not include it. We've therefore built v6.2.4-SNAPSHOT from the master and have been running it for the last two weeks in production-scale. The issue seems to have been solved, and everything works as expected:\r\n\r\n![image](https://user-images.githubusercontent.com/7827282/38490106-d8ebc398-3bf0-11e8-8531-c325837001cb.png)\r\n\r\nThank you for the quick response and handling of the issue!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/379691572","html_url":"https://github.com/elastic/elasticsearch/issues/29097#issuecomment-379691572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29097","id":379691572,"node_id":"MDEyOklzc3VlQ29tbWVudDM3OTY5MTU3Mg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-04-09T09:29:09Z","updated_at":"2018-04-09T09:29:09Z","author_association":"MEMBER","body":"@redlus thanks for testing and letting us know. Happy to hear it worked.","performed_via_github_app":null}]