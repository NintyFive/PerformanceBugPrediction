{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33952","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33952/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33952/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33952/events","html_url":"https://github.com/elastic/elasticsearch/issues/33952","id":362656264,"node_id":"MDU6SXNzdWUzNjI2NTYyNjQ=","number":33952,"title":"[ML-Dataframe] Job configuration storage design discussion for dataframe builder","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null},{"id":130371191,"node_id":"MDU6TGFiZWwxMzAzNzExOTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/WIP","name":"WIP","color":"fef2c0","default":false,"description":null},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-09-21T15:03:43Z","updated_at":"2018-12-17T23:11:55Z","closed_at":"2018-11-28T15:11:57Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Design discussion for ML dataframe builder https://github.com/elastic/elasticsearch/tree/feature/fib\r\n\r\nWork in progress.\r\n\r\n### Intro\r\n\r\nA dataframe builder job uses persistent task that can be created/deleted/started/stopped. This issue discusses ways to store the configuration of a dataframe builder job.\r\n\r\n#### Configuration payload\r\n\r\nA configuration object is supposed to be small, it contains fields like source and destination index and a list of aggregation configurations (which makes parsing tightly coupled to aggregations). In future there will be likely more options but it will remain relatively small.\r\n\r\n#### Problem\r\n\r\nThe biggest risk is breaking backwards compatibility and/or creating a road block for deprecating aggregations.\r\n\r\n#### Solutions\r\n\r\n##### A Do nothing - use cluster state\r\n\r\nUse persistent task to store the configuration, which means the config is stored in the cluster state and needs to be read back on cluster start.\r\n\r\n*pro*:\r\n- simplest\r\n\r\n*con*:\r\n- if the configuration becomes invalid, parsing breaks, node does not start\r\n\r\n##### B Careful Parsing\r\n\r\nSame as A, but wrap the parsing code with error handling to not cause total failure.\r\n\r\n*pro*:\r\n- does not fail if configuration gets invalid\r\n\r\n##### C deferred parsing \r\n\r\nStore the config in a blob to avoid parsing at startup and parse it on start of the persistent job\r\n\r\n*pro*:\r\n- does not fail if configuration gets invalid\r\n- does not slow down startup\r\n\r\n*con*\r\n- ugly blob in cluster state\r\n\r\n##### D Store configuration in index, only keep ID's in cluster state\r\n\r\nStore only the  (unique) job id in the cluster state and store the configs in a separate private index\r\n\r\n*pro*:\r\n- does not fail if configuration gets invalid\r\n- does not slow down startup\r\n- does not pollute cluster state (size)\r\n\r\n*con*:\r\n- extra logic, error handling","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}