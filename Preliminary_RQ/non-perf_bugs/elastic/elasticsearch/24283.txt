{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24283","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24283/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24283/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24283/events","html_url":"https://github.com/elastic/elasticsearch/issues/24283","id":223772868,"node_id":"MDU6SXNzdWUyMjM3NzI4Njg=","number":24283,"title":"Wrong checking of #23981 bug","user":{"login":"antdavidl","id":6018658,"node_id":"MDQ6VXNlcjYwMTg2NTg=","avatar_url":"https://avatars2.githubusercontent.com/u/6018658?v=4","gravatar_id":"","url":"https://api.github.com/users/antdavidl","html_url":"https://github.com/antdavidl","followers_url":"https://api.github.com/users/antdavidl/followers","following_url":"https://api.github.com/users/antdavidl/following{/other_user}","gists_url":"https://api.github.com/users/antdavidl/gists{/gist_id}","starred_url":"https://api.github.com/users/antdavidl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antdavidl/subscriptions","organizations_url":"https://api.github.com/users/antdavidl/orgs","repos_url":"https://api.github.com/users/antdavidl/repos","events_url":"https://api.github.com/users/antdavidl/events{/privacy}","received_events_url":"https://api.github.com/users/antdavidl/received_events","type":"User","site_admin":false},"labels":[{"id":537848274,"node_id":"MDU6TGFiZWw1Mzc4NDgyNzQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.3.1","name":"v5.3.1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":17,"created_at":"2017-04-24T10:26:54Z","updated_at":"2017-04-25T18:41:00Z","closed_at":"2017-04-24T13:31:55Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.3.1\r\n**JVM version**:  openjdk-1.8.0.131-2.b11.el7_3\r\n**OS version**: CentOS 7.3.1611 (Core)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI had just updated from 5.3.0 to 5.3.1 and then the node didn't like to start up. The logs indicates that there were indexes in the default folder where they should not be. However, this is exactly the folder in which always I have had my indexes!\r\n\r\nI think that the mechanism to control a potential misconfiguration after the fix of the bug #23981 in 5.3.1 is wrongly implemented when you have the default data folder explicitly defined in the configuration file.\r\n\r\nI had the following lines in my configuration file:\r\n\r\n```\r\n    path:\r\n        data: /var/lib/elasticsearch\r\n        logs: /var/log/elasticsearch\r\n```\r\n\r\nI was using the default data folder but anyway configuring it explicitly (since it is configurable by other means; ansible-stuff ...). \r\n\r\nIn order to raise the Elasticsearch service I have had to comment the path.data line and then it works fine:\r\n\r\n```\r\n    path:\r\n#        data: /var/lib/elasticsearch\r\n         logs: /var/log/elasticsearch\r\n```\r\n\r\nI think the problem is that the new code was checking if the data folder was being settled up and then check if the default data folder contains indexes, but ... what about if the default data folder is also a valid data folder included in the configuration?\r\n\r\nThanks!\r\n\r\n**Steps to reproduce**:\r\n 1. Update to 5.3.1 from 5.3.0 having the default data folder configured explicitly\r\n 2. Try to start the elastic search service\r\n\r\n**Provide logs (if relevant)**:\r\n[2017-04-24T11:45:12,480][INFO ][o.e.n.Node               ] [automation] initializing ...\r\n[2017-04-24T11:45:12,557][INFO ][o.e.e.NodeEnvironment    ] [automation] using [1] data paths, mounts [[/var/lib/elasticsearch (/dev/mapper/vg_data-lv_elastic)]], net usable_space [39gb], net total_space [58.9gb], spins? [possibly], types [ext4]\r\n[2017-04-24T11:45:12,557][INFO ][o.e.e.NodeEnvironment    ] [automation] heap size [1.9gb], compressed ordinary object pointers [true]\r\n[2017-04-24T11:45:13,691][ERROR][o.e.n.Node               ] [automation] detected index data in default.path.data [/var/lib/elasticsearch/nodes/0/indices] where there should not be any\r\n\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}