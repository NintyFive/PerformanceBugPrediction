[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22117622","html_url":"https://github.com/elastic/elasticsearch/issues/3442#issuecomment-22117622","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3442","id":22117622,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTE3NjIy","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-05T16:22:19Z","updated_at":"2013-08-05T16:22:19Z","author_association":"CONTRIBUTOR","body":"Hey @nik9000 thanks for opening this issue. I'm not sure if this is the right approach to go here since pure tokenization not always what you want. I think we should rather provide an API that provides a highlighted version of the corrected string or it should return plain offsets. Yet, why I think we should not plain tokenize is that if you have synonyms etc. in pre or post filters tokens will not correspond to actual corrected substrings.\n\nThe way I think we should do that is to provide pre and post tokens similar to the highlight API and return a \"highlighted\" version of the string. I think the big advantage of this is that you can display it directly to the user and I don't wanna overcomplicate the response format. We can also return actual offsets which will require some processing in the client which I would want to prevent. Yet, if you wanna take a look at implementing this, we are maintaining the splitted tokens until we are done and join them together. we can add a flag to `Correction` and highlight if it's a replacement?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22123637","html_url":"https://github.com/elastic/elasticsearch/issues/3442#issuecomment-22123637","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3442","id":22123637,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTIzNjM3","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-05T17:50:50Z","updated_at":"2013-08-05T17:50:50Z","author_association":"CONTRIBUTOR","body":"I agree with your point about the API.  Elasticsearch should do the highlighting.\nI agree with your point about synonyms but won't using the Corrections cause trouble with shingles?  If the whole search is corrected using a single shingle (which I think is likely for me) then we'd mark the whole thing as changed which isn't really useful.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22124924","html_url":"https://github.com/elastic/elasticsearch/issues/3442#issuecomment-22124924","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3442","id":22124924,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTI0OTI0","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-05T18:09:31Z","updated_at":"2013-08-05T18:09:31Z","author_association":"CONTRIBUTOR","body":"> I agree with your point about synonyms but won't using the Corrections cause trouble with shingles? If the whole search is corrected using a single shingle (which I think is likely for me) then we'd mark the whole thing as changed which isn't really useful.\n\ninternally we use shingles or ngrams to lookup the frequencies but those are only in the index and the bigrams / trigrams that are build from the query are build at runtime and not from the shingle filter so that each `Candidate` corresponds to a unigram. I will look closer into this tomorrow and provide some examples\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22174255","html_url":"https://github.com/elastic/elasticsearch/issues/3442#issuecomment-22174255","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3442","id":22174255,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTc0MjU1","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-06T12:08:35Z","updated_at":"2013-08-06T12:08:35Z","author_association":"CONTRIBUTOR","body":"Hey @nik9000 I think we can add this in a backwards compatible way by simply using a custom join function on `Correction` what we need is support for `pre_tag` & `post_tag` on the request side something like \n\n```\n\"suggest\": {\n    \"text\": \"findning differrences\",\n    \"phrase\":{\n      \"phrase\":{\n        \"field\": \"foo\",\n        \"max_errors\": 5\n        \"highlight\" : {\n          \"pre_tag\" : \"<b>\",\n          \"post_tag\" : \"</b>\"\n        }\n      }\n    }\n  }\n```\n\nso if `highlight` is set we will return the result highlighted like this:\n\n```\n\"options\" : [ {\n        \"text\" : \"<b>finding differences</b>\",\n        \"score\" : 0.49144784,\n\n```\n\ndoes this make sense? I think what we need here is a notion of a `boolean userInput;` in the `Candidate` class such that we can differentiate if this is actually a term that got suggested or not. We can easily make this distinction in NoisyChannelSpellChecker line 96. In Line 82 we actually check if it is a shingle or not and if so we ignore it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22185070","html_url":"https://github.com/elastic/elasticsearch/issues/3442#issuecomment-22185070","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3442","id":22185070,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTg1MDcw","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-06T15:03:07Z","updated_at":"2013-08-06T15:03:07Z","author_association":"CONTRIBUTOR","body":"@s1monw I think I'd prefer to return the unlighted version next to the highlighted version.  That way I don't have to re-strip the highlight components when building the suggestion query.\n\nHere is an updated curl testing script:\n\n``` bash\ncurl -XDELETE \"http://localhost:9200/test?pretty\"\ncurl -XPOST \"http://localhost:9200/test?pretty\" -d '{\n  \"settings\": {\n    \"index\": {\n      \"number_of_replicas\": 0\n      \"analysis\":{\n        \"analyzer\":{\n          \"suggest\":{\n            \"type\": \"custom\",\n            \"tokenizer\": \"standard\",\n            \"filter\": [ \"standard\", \"lowercase\", \"suggest_shingle\" ]\n          }\n        },\n        \"filter\":{\n          \"suggest_shingle\":{\n            \"type\": \"shingle\",\n            \"min_shingle_size\": 2,\n            \"max_shingle_size\": 5,\n            \"output_unigrams\": true\n          }\n        }\n      }\n    }\n  }\n}'\ncurl -XPOST \"http://localhost:9200/test/test/_mapping?pretty\" -d '{\n  \"test\":{\n    \"foo\":{\n      \"analyzer\":\"suggest\"\n    }\n  }\n}'\n\ncurl -XGET 'http://localhost:9200/_cluster/health?pretty=true&wait_for_status=yellow'\n\ncurl -XPOST \"http://localhost:9200/test/test?pretty\" -d '{\n  \"foo\": \"I love shingles for suggestions\"\n}'\n\ncurl -XPOST \"http://localhost:9200/test/test?pretty\" -d '{\n  \"foo\": \"but not for finding differences\"\n}'\n\nsleep 1\n\ncurl -XGET \"http://localhost:9200/test/test/_search?pretty\" -d '{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"suggest\": {\n    \"text\": \"findning differrences\",\n    \"phrase\":{\n      \"phrase\":{\n        \"field\": \"foo\",\n        \"max_errors\": 5\n      }\n    }\n  }\n}'\n\n\n\ncurl -XGET \"http://localhost:9200/test/test/_search?pretty\" -d '{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"suggest\": {\n    \"text\": \"findning differrences\",\n    \"phrase\":{\n      \"phrase\":{\n        \"field\": \"foo\",\n        \"max_errors\": 5,\n        \"highlight\": {\n          \"pre_tag\": \"<em>\",\n          \"post_tag\": \"</em>\"\n        }\n      }\n    }\n  }\n}'\n```\n\nThe first doesn't have highlighting enabled so the suggest section should look exactly like a search without this feature:\n\n``` json\n  \"suggest\" : {\n    \"phrase\" : [ {\n      \"text\" : \"findning differrences\",\n      \"offset\" : 0,\n      \"length\" : 21,\n      \"options\" : [ {\n        \"text\" : \"finding differences\",\n        \"score\" : 0.49144784\n      }, {\n        \"text\" : \"findning differences\",\n        \"score\" : 0.3803136\n      }, {\n        \"text\" : \"finding differrences\",\n        \"score\" : 0.37071815\n      } ]\n    } ]\n```\n\nand the second search should have highlighting like this:\n\n``` json\n  \"suggest\" : {\n    \"phrase\" : [ {\n      \"text\" : \"findning differrences\",\n      \"offset\" : 0,\n      \"length\" : 21,\n      \"options\" : [ {\n        \"text\" : \"finding differences\",\n        \"highlighted\" : \"<em>finding</em> <em>differences</em>\",\n        \"score\" : 0.49144784\n      }, {\n        \"text\" : \"findning differences\",\n        \"highlighted\" : \"findning <em>differences</em>\",\n        \"score\" : 0.3803136\n      }, {\n        \"text\" : \"finding differrences\",\n        \"highlighted\" : \"<em>finding</em> differrences\",\n        \"score\" : 0.37071815\n      } ]\n    } ]\n  }\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22185553","html_url":"https://github.com/elastic/elasticsearch/issues/3442#issuecomment-22185553","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3442","id":22185553,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTg1NTUz","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-06T15:08:41Z","updated_at":"2013-08-06T15:08:41Z","author_association":"CONTRIBUTOR","body":"oh that is an very good reason for having it side by side to the original suggestion....! agreed!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22202752","html_url":"https://github.com/elastic/elasticsearch/issues/3442#issuecomment-22202752","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3442","id":22202752,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjAyNzUy","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-06T19:03:57Z","updated_at":"2013-08-06T19:03:57Z","author_association":"CONTRIBUTOR","body":"@nik9000 I changed your commit message a bit and running tests now. I will push this very shortly! Unfortunately we can't add this to 0.90 at this point since it breaks the wire format. It's a pity though. But anyway thanks so much for adding this!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22236852","html_url":"https://github.com/elastic/elasticsearch/issues/3442#issuecomment-22236852","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3442","id":22236852,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjM2ODUy","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-07T08:29:53Z","updated_at":"2013-08-07T08:29:53Z","author_association":"CONTRIBUTOR","body":"Backported to 0.90 with version compatibility on the transport protocol. I kept the version checks for master (1.0) for now to have the same code in master and 0.90 but that doesn't mean a major version upgrade from 0.90 to 1.0 doesn't require a full cluster restart\n","performed_via_github_app":null}]