{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23382","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23382/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23382/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23382/events","html_url":"https://github.com/elastic/elasticsearch/issues/23382","id":210476271,"node_id":"MDU6SXNzdWUyMTA0NzYyNzE=","number":23382,"title":"JSON logging with discovery-ec2 plugin","user":{"login":"alex-voigt","id":10030355,"node_id":"MDQ6VXNlcjEwMDMwMzU1","avatar_url":"https://avatars0.githubusercontent.com/u/10030355?v=4","gravatar_id":"","url":"https://api.github.com/users/alex-voigt","html_url":"https://github.com/alex-voigt","followers_url":"https://api.github.com/users/alex-voigt/followers","following_url":"https://api.github.com/users/alex-voigt/following{/other_user}","gists_url":"https://api.github.com/users/alex-voigt/gists{/gist_id}","starred_url":"https://api.github.com/users/alex-voigt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alex-voigt/subscriptions","organizations_url":"https://api.github.com/users/alex-voigt/orgs","repos_url":"https://api.github.com/users/alex-voigt/repos","events_url":"https://api.github.com/users/alex-voigt/events{/privacy}","received_events_url":"https://api.github.com/users/alex-voigt/received_events","type":"User","site_admin":false},"labels":[{"id":151561891,"node_id":"MDU6TGFiZWwxNTE1NjE4OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Logging","name":":Core/Infra/Logging","color":"0e8a16","default":false,"description":"Log management and logging utilities"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-02-27T12:57:11Z","updated_at":"2018-03-14T01:16:28Z","closed_at":"2018-03-14T01:16:17Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.1.2\r\n\r\n**Plugins installed**: [discovery-ec2]\r\n\r\n**JVM version**: 1.8.0_121-8u121-b13-0ubuntu1.16.04.2-b13\r\n\r\n**OS version**: Ubuntu 16.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI am using a log4j2 log file configuration for logging to JSON format on a devbox.\r\n\r\nTo make this work I had to put a copy of the `jackson-databind-2.8.1.jar` and `jackson-annotations-2.8.1.jar` into the `/usr/share/elasticsearch/lib` folder. Works perfectly fine.\r\n\r\nBut our production system runs on AWS and requires additionally the `discovery-ec2` plugin. In combination it doesn't work because I am ending in up in the 'jar hell'.\r\n\r\n`java.lang.IllegalStateException: failed to load bundle [file:/usr/share/elasticsearch/plugins/discovery-ec2/httpcore-4.4.5.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/discovery-ec2-5.1.2.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/aws-java-sdk-core-1.10.69.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/commons-logging-1.1.3.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/commons-codec-1.10.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/aws-java-sdk-ec2-1.10.69.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/httpclient-4.5.2.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/jackson-databind-2.5.3.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/jackson-annotations-2.5.0.jar] due to jar hell\r\n\tat org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:327) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.plugins.PluginsService.<init>(PluginsService.java:132) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:294) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:229) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap$6.<init>(Bootstrap.java:214) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:214) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:306) [elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121) [elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112) [elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.cli.SettingCommand.execute(SettingCommand.java:54) [elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122) [elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.cli.Command.main(Command.java:88) [elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:89) [elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:82) [elasticsearch-5.1.2.jar:5.1.2]\r\nCaused by: java.lang.IllegalStateException: jar hell!\r\nclass: com.fasterxml.jackson.databind.AbstractTypeResolver\r\njar1: /usr/share/elasticsearch/lib/jackson-databind-2.8.1.jar\r\njar2: /usr/share/elasticsearch/plugins/discovery-ec2/jackson-databind-2.5.3.jar\r\n\tat org.elasticsearch.bootstrap.JarHell.checkClass(JarHell.java:277) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:187) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:325) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\t... 13 more\r\n[2017-02-27T12:09:14,988][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [] uncaught exception in thread [main]\r\norg.elasticsearch.bootstrap.StartupException: java.lang.IllegalStateException: failed to load bundle [file:/usr/share/elasticsearch/plugins/discovery-ec2/httpcore-4.4.5.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/discovery-ec2-5.1.2.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/aws-java-sdk-core-1.10.69.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/commons-logging-1.1.3.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/commons-codec-1.10.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/aws-java-sdk-ec2-1.10.69.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/httpclient-4.5.2.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/jackson-databind-2.5.3.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/jackson-annotations-2.5.0.jar] due to jar hell\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:125) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.cli.SettingCommand.execute(SettingCommand.java:54) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.cli.Command.main(Command.java:88) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:89) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:82) ~[elasticsearch-5.1.2.jar:5.1.2]\r\nCaused by: java.lang.IllegalStateException: failed to load bundle [file:/usr/share/elasticsearch/plugins/discovery-ec2/httpcore-4.4.5.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/discovery-ec2-5.1.2.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/aws-java-sdk-core-1.10.69.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/commons-logging-1.1.3.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/commons-codec-1.10.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/aws-java-sdk-ec2-1.10.69.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/httpclient-4.5.2.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/jackson-databind-2.5.3.jar, file:/usr/share/elasticsearch/plugins/discovery-ec2/jackson-annotations-2.5.0.jar] due to jar hell\r\n\tat org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:327) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.plugins.PluginsService.<init>(PluginsService.java:132) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:294) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:229) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap$6.<init>(Bootstrap.java:214) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:214) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:306) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\t... 6 more\r\nCaused by: java.lang.IllegalStateException: jar hell!\r\nclass: com.fasterxml.jackson.databind.AbstractTypeResolver\r\njar1: /usr/share/elasticsearch/lib/jackson-databind-2.8.1.jar\r\njar2: /usr/share/elasticsearch/plugins/discovery-ec2/jackson-databind-2.5.3.jar\r\n\tat org.elasticsearch.bootstrap.JarHell.checkClass(JarHell.java:277) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:187) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:325) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.plugins.PluginsService.<init>(PluginsService.java:132) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:294) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:229) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap$6.<init>(Bootstrap.java:214) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:214) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:306) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121) ~[elasticsearch-5.1.2.jar:5.1.2]\r\n\t... 6 more`\r\n\r\n\r\nWhen I remove those files out of the `/usr/share/elasticsearch/lib` again the syslog contains the following lines and logging in JSON format does not work anymore:\r\n\r\n\r\n`Feb 27 12:45:26 project-search systemd[1]: Started Elasticsearch.\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: 2017-02-27 12:45:27,055 main ERROR Unable to invoke factory method in class class org.apache.logging.log4j.core.layout.JsonLayout for element JSONLayout. java.lang.reflect.InvocationTargetException\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.reflect.Method.invoke(Method.java:498)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:132)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:942)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:882)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:498)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:227)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:239)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:530)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:258)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:116)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:83)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:272)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.SettingCommand.execute(SettingCommand.java:54)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.Command.main(Command.java:88)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:89)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:82)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: Caused by: java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/ser/FilterProvider\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.layout.JsonLayout.<init>(JsonLayout.java:814)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.layout.JsonLayout.createLayout(JsonLayout.java:922)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011... 24 more\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: Caused by: java.lang.ClassNotFoundException: com.fasterxml.jackson.databind.ser.FilterProvider\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011... 26 more\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: 2017-02-27 12:45:27,133 main ERROR Unable to invoke factory method in class class org.apache.logging.log4j.core.layout.JsonLayout for element JSONLayout. java.lang.reflect.InvocationTargetException\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.reflect.Method.invoke(Method.java:498)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:132)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:942)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:882)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:498)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:227)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:239)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:530)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:258)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:116)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:83)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:272)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.SettingCommand.execute(SettingCommand.java:54)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.Command.main(Command.java:88)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:89)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:82)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: Caused by: java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/ser/FilterProvider\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.layout.JsonLayout.<init>(JsonLayout.java:814)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.layout.JsonLayout.createLayout(JsonLayout.java:922)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011... 24 more\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: Caused by: java.lang.ClassNotFoundException: com.fasterxml.jackson.databind.ser.FilterProvider\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011... 26 more\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: 2017-02-27 12:45:27,140 main ERROR Unable to invoke factory method in class class org.apache.logging.log4j.core.layout.JsonLayout for element JSONLayout. java.lang.reflect.InvocationTargetException\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.reflect.Method.invoke(Method.java:498)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:132)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:942)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:882)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:498)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:227)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:239)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:530)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:258)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:116)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:83)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:272)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.SettingCommand.execute(SettingCommand.java:54)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.Command.main(Command.java:88)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:89)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:82)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: Caused by: java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/ser/FilterProvider\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.layout.JsonLayout.<init>(JsonLayout.java:814)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.layout.JsonLayout.createLayout(JsonLayout.java:922)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011... 24 more\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: Caused by: java.lang.ClassNotFoundException: com.fasterxml.jackson.databind.ser.FilterProvider\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011... 26 more\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: 2017-02-27 12:45:27,158 main ERROR Unable to invoke factory method in class class org.apache.logging.log4j.core.layout.JsonLayout for element JSONLayout. java.lang.reflect.InvocationTargetException\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.reflect.Method.invoke(Method.java:498)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:132)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:942)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:882)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:498)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:227)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:239)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:530)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:258)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:116)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:83)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:272)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.SettingCommand.execute(SettingCommand.java:54)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.cli.Command.main(Command.java:88)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:89)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:82)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: Caused by: java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/ser/FilterProvider\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.layout.JsonLayout.<init>(JsonLayout.java:814)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at org.apache.logging.log4j.core.layout.JsonLayout.createLayout(JsonLayout.java:922)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011... 24 more\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: Caused by: java.lang.ClassNotFoundException: com.fasterxml.jackson.databind.ser.FilterProvider\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\nFeb 27 12:45:27 project-search elasticsearch[9703]: #011... 26 more`\r\n\r\n\r\nIs there any way to get out of the jar hell with JSON logging and discovery plugin enabled? For me it looks like a bug in the Plugin because dependencies seem to influence the ES behaviour.","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}