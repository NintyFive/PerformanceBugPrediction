[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398770290","html_url":"https://github.com/elastic/elasticsearch/issues/31462#issuecomment-398770290","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31462","id":398770290,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODc3MDI5MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-20T14:29:50Z","updated_at":"2018-06-20T14:29:50Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398772619","html_url":"https://github.com/elastic/elasticsearch/issues/31462#issuecomment-398772619","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31462","id":398772619,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODc3MjYxOQ==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-06-20T14:36:08Z","updated_at":"2018-06-20T14:36:08Z","author_association":"CONTRIBUTOR","body":"Another identical failure, this time on 6.x:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-unix-compatibility/os=amazon/1132/console\r\n\r\n```\r\n17:43:08   1> [2018-06-20T05:43:05,769][INFO ][o.e.x.s.MultiClusterSearchWithSecurityYamlTestSuiteIT] Stash dump on test failure [{\r\n17:43:08   1>   \"stash\" : {\r\n17:43:08   1>     \"remote_ip\" : \"[::1]:46125\",\r\n17:43:08   1>     \"body\" : {\r\n17:43:08   1>       \"error\" : {\r\n17:43:08   1>         \"root_cause\" : [\r\n17:43:08   1>           {\r\n17:43:08   1>             \"type\" : \"security_exception\",\r\n17:43:08   1>             \"reason\" : \"action [indices:admin/shards/search_shards] is unauthorized for user [_system]\",\r\n17:43:08   1>             \"stack_trace\" : \"ElasticsearchSecurityException[action [indices:admin/shards/search_shards] is unauthorized for user [_system]]\r\n17:43:08   1> \tat org.elasticsearch.xpack.core.security.support.Exceptions.authorizationError(Exceptions.java:30)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationService.denialException(AuthorizationService.java:574)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationService.denial(AuthorizationService.java:552)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationService.authorize(AuthorizationService.java:157)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$inbound$2(ServerTransportFilter.java:147)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:173)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:167)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:149)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$inbound$3(ServerTransportFilter.java:150)\r\n17:43:08   1> \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:172)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:205)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:216)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:170)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:131)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:101)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.inbound(ServerTransportFilter.java:129)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:302)\r\n17:43:08   1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66)\r\n17:43:08   1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1663)\r\n17:43:08   1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n17:43:08   1> \tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:135)\r\n17:43:08   1> \tat org.elasticsearch.transport.TcpTransport.handleRequest(TcpTransport.java:1621)\r\n17:43:08   1> \tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:1485)\r\n17:43:08   1> \tat org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:62)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n17:43:08   1> \tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310)\r\n17:43:08   1> \tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:297)\r\n17:43:08   1> \tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:413)\r\n17:43:08   1> \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n17:43:08   1> \tat io.netty.handler.logging.LoggingHandler.channelRead(LoggingHandler.java:241)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n17:43:08   1> \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1359)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n17:43:08   1> \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n17:43:08   1> \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:935)\r\n17:43:08   1> \tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:134)\r\n17:43:08   1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645)\r\n17:43:08   1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:545)\r\n17:43:08   1> \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:499)\r\n17:43:08   1> \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459)\r\n17:43:08   1> \tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858)\r\n17:43:08   1> \tat java.lang.Thread.run(Thread.java:844)\r\n17:43:08   1> \"\r\n17:43:08   1>           }\r\n17:43:08   1>         ],\r\n17:43:08   1>         \"type\" : \"security_exception\",\r\n17:43:08   1>         \"reason\" : \"action [indices:admin/shards/search_shards] is unauthorized for user [_system]\",\r\n17:43:08   1>         \"stack_trace\" : \"ElasticsearchSecurityException[action [indices:admin/shards/search_shards] is unauthorized for user [_system]]\r\n17:43:08   1> \tat org.elasticsearch.xpack.core.security.support.Exceptions.authorizationError(Exceptions.java:30)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationService.denialException(AuthorizationService.java:574)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationService.denial(AuthorizationService.java:552)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationService.authorize(AuthorizationService.java:157)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$inbound$2(ServerTransportFilter.java:147)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:173)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:167)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:149)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$inbound$3(ServerTransportFilter.java:150)\r\n17:43:08   1> \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:172)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:205)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:216)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:170)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:131)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:101)\r\n17:43:08   1> \tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.inbound(ServerTransportFilter.java:129)\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400168731","html_url":"https://github.com/elastic/elasticsearch/issues/31462#issuecomment-400168731","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31462","id":400168731,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDE2ODczMQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-06-26T03:46:29Z","updated_at":"2018-06-26T03:46:29Z","author_association":"MEMBER","body":"Maybe this was caused by #31241?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400168847","html_url":"https://github.com/elastic/elasticsearch/issues/31462#issuecomment-400168847","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31462","id":400168847,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDE2ODg0Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-06-26T03:47:05Z","updated_at":"2018-06-26T03:47:05Z","author_association":"MEMBER","body":"@ywelsch Would you take a look at this one?","performed_via_github_app":null}]