[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/579881047","html_url":"https://github.com/elastic/elasticsearch/issues/51626#issuecomment-579881047","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51626","id":579881047,"node_id":"MDEyOklzc3VlQ29tbWVudDU3OTg4MTA0Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-29T17:56:37Z","updated_at":"2020-01-29T17:56:37Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Packaging)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/579881055","html_url":"https://github.com/elastic/elasticsearch/issues/51626#issuecomment-579881055","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51626","id":579881055,"node_id":"MDEyOklzc3VlQ29tbWVudDU3OTg4MTA1NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-29T17:56:39Z","updated_at":"2020-01-29T17:56:39Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-docs (>docs)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/579911010","html_url":"https://github.com/elastic/elasticsearch/issues/51626#issuecomment-579911010","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51626","id":579911010,"node_id":"MDEyOklzc3VlQ29tbWVudDU3OTkxMTAxMA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2020-01-29T19:07:39Z","updated_at":"2020-01-29T19:07:39Z","author_association":"MEMBER","body":"Thanks for opening this issue @soullivaneuh. A few comments:\r\n - jvm.options is fine for Docker usage, we should document that (bind mount it into the container, over `/usr/share/elasticsearch/config/jvm.options`)\r\n - it's okay that `-Xms1g` and `-Xmx1g` are present in the default `jvm.options` file in the container, as `ES_JAVA_OPTS` will override `jvm.options`, by design; you'll see both flags on the command line, but with the JVM, the last flag wins (so `-Xms1g -Xms2g` would end up with a `2g` heap)\r\n - this means that you don't need a custom image\r\n\r\nWe'll get the docs updated to clarify these points.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580155932","html_url":"https://github.com/elastic/elasticsearch/issues/51626#issuecomment-580155932","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51626","id":580155932,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDE1NTkzMg==","user":{"login":"soullivaneuh","id":1698357,"node_id":"MDQ6VXNlcjE2OTgzNTc=","avatar_url":"https://avatars0.githubusercontent.com/u/1698357?v=4","gravatar_id":"","url":"https://api.github.com/users/soullivaneuh","html_url":"https://github.com/soullivaneuh","followers_url":"https://api.github.com/users/soullivaneuh/followers","following_url":"https://api.github.com/users/soullivaneuh/following{/other_user}","gists_url":"https://api.github.com/users/soullivaneuh/gists{/gist_id}","starred_url":"https://api.github.com/users/soullivaneuh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/soullivaneuh/subscriptions","organizations_url":"https://api.github.com/users/soullivaneuh/orgs","repos_url":"https://api.github.com/users/soullivaneuh/repos","events_url":"https://api.github.com/users/soullivaneuh/events{/privacy}","received_events_url":"https://api.github.com/users/soullivaneuh/received_events","type":"User","site_admin":false},"created_at":"2020-01-30T09:12:30Z","updated_at":"2020-01-30T09:12:30Z","author_association":"NONE","body":"Maybe I didn't well understand how it works, but here is a ps:\r\n\r\n```\r\ngallart  19254  0.4  9.5 4021760 779140 ?      SLsl Jan29   4:22 /opt/jdk-13.0.1+9/bin/java -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.io.tmpdir=/tmp/elasticsearch-12316401923526476962 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m -Djava.locale.providers=COMPAT -XX:UseAVX=2 -Des.cgroups.hierarchy.override=/ -Xms256m -Xmx256m -Des.path.home=/usr/share/elasticsearch -Des.path.conf=/usr/share/elasticsearch/config -Des.distribution.flavor=default -Des.distribution.type=docker -cp /usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch -Ecluster.name=fusionauth -Ebootstrap.memory_lock=true\r\n```\r\n\r\nHere i removed the default option and put the env vars.\r\n\r\nAs you can see, the container consumes ~780Mo, this is far more than the limit I set. Also, if I setup multiple instances (staging server with auto-deploy) and the host RAM is full, the server is overloading consuming all the CPU resources for no reasons.\r\n\r\n> jvm.options is fine for Docker usage, we should document that (bind mount it into the container, over /usr/share/elasticsearch/config/jvm.options)\r\n\r\nWell, the issue is `jvm.options` from default image is quite full of options. I don't want to get rid of them, and it's quite ugly to copy a vendor config on our git project just to remove/change 2 settings. Don't you have something like `jvm.options.d` or something similar for override?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580709776","html_url":"https://github.com/elastic/elasticsearch/issues/51626#issuecomment-580709776","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51626","id":580709776,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDcwOTc3Ng==","user":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"created_at":"2020-01-31T12:12:54Z","updated_at":"2020-01-31T12:12:54Z","author_association":"CONTRIBUTOR","body":"@soullivaneuh can I confirm which image you are using - I pulled and ran `docker.elastic.co/elasticsearch/elasticsearch:6.3.2`, and the `ps` output contains:\r\n\r\n    /opt/jdk-10.0.2/bin/java\r\n\r\nwhich is different from your sample.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/581918273","html_url":"https://github.com/elastic/elasticsearch/issues/51626#issuecomment-581918273","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51626","id":581918273,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTkxODI3Mw==","user":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"created_at":"2020-02-04T13:50:26Z","updated_at":"2020-02-04T13:50:26Z","author_association":"CONTRIBUTOR","body":"Note that using `ps` doesn't report the Java heap size, because Elasticsearch and the JVM need memory for purposes other than the JVM heap. You can verify what heap size Elasticsearch is using with the `/_nodes` API e.g.\r\n\r\n```shell\r\ncurl localhost:9200/_nodes?human | jq '.nodes | map_values(.jvm.mem)'\r\n```\r\n\r\nIn all my experiments, configuring the heap settings via an environment variable e.g. `ES_JAVA_OPTS='-Xms256m -Xmx256m'` did what I expected, but please let me know if you try this and the `/_nodes` API doesn't give the correct number. You can also constrain total memory usage with Docker options.\r\n\r\nI'll see about what we can do to improve the documentation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/582062896","html_url":"https://github.com/elastic/elasticsearch/issues/51626#issuecomment-582062896","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51626","id":582062896,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MjA2Mjg5Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2020-02-04T18:59:35Z","updated_at":"2020-02-04T18:59:35Z","author_association":"MEMBER","body":">Don't you have something like `jvm.options.d` or something similar for override?\r\n\r\nWhen we initially designed `jvm.options` (#17675), we had considered this. At the time, designing for Docker use-cases wasn't something that we considered, although now it is. We've seen some other problems over the years (e.g., package users modifying their `jvm.options` and not getting new options when they upgrade because their package manager will preserve their modified `jvm.options` instead of taking the package-provided `jvm.options`). We've partially addressed this with the introduction of `jvm.options` (#48252) but something like `jvm.options.d` would indeed make that experience even better.\r\n\r\nI opened #51882.","performed_via_github_app":null}]