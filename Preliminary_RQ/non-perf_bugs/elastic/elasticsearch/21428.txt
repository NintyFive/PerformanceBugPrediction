{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21428","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21428/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21428/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21428/events","html_url":"https://github.com/elastic/elasticsearch/issues/21428","id":188266604,"node_id":"MDU6SXNzdWUxODgyNjY2MDQ=","number":21428,"title":"sending elasticsearch logs to logstash fails due to security manager","user":{"login":"gehel","id":1415765,"node_id":"MDQ6VXNlcjE0MTU3NjU=","avatar_url":"https://avatars1.githubusercontent.com/u/1415765?v=4","gravatar_id":"","url":"https://api.github.com/users/gehel","html_url":"https://github.com/gehel","followers_url":"https://api.github.com/users/gehel/followers","following_url":"https://api.github.com/users/gehel/following{/other_user}","gists_url":"https://api.github.com/users/gehel/gists{/gist_id}","starred_url":"https://api.github.com/users/gehel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gehel/subscriptions","organizations_url":"https://api.github.com/users/gehel/orgs","repos_url":"https://api.github.com/users/gehel/repos","events_url":"https://api.github.com/users/gehel/events{/privacy}","received_events_url":"https://api.github.com/users/gehel/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2016-11-09T14:54:52Z","updated_at":"2016-11-09T20:29:13Z","closed_at":"2016-11-09T18:39:56Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.4.1\r\n\r\n**Plugins installed**: [experimental-highlighter,extra,analysis-icu]\r\n\r\n**JVM version**: OpenJDK Runtime Environment (IcedTea 2.6.7) (7u111-2.6.7-0ubuntu0.14.04.3)\r\n\r\n**OS version**: Ubuntu Trusty (14.04)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWe are trying to send the logs of our elasticsearch search cluster to logstash with [logstash-gelf](https://github.com/mp911de/logstash-gelf) (yes, they are 2 different elasticsearch clusters). This fails due to security manager restrictions. I can't find the correct way to configure the security manager to allow logstash-gelf to send UDP packets. I tried following the [documentation I found](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-security.html) on security manager, but with no success.\r\n\r\nThe policy that I'm trying to use:\r\n\r\n    grant codeBase \"file:/usr/share/elasticsearch/lib/logstash-gelf.jar\" {\r\n      permission java.net.SocketPermission \"localhost:0\", \"listen,resolve\";\r\n    };\r\n\r\n\r\n**Steps to reproduce**:\r\n 1. add the logstash-gelf jar to elasticsearch libs\r\n 2. configure a gelf appender in logging configuration\r\n 3. add a policy rule in /usr/share/elasticsearch/.java.policy (also tried to configure it by adding  `-Djava.security.policy=file:///...` to `ES_JAVA_OPTS`\r\n 4. restart elasticsarch\r\n\r\nexpected: logs are sent to logstash\r\n\r\nactual: no logs are sent to logstash and exception is seen on console (see below)\r\n\r\nnote: this used to work fine with elasticsearch 1.7.5\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\nlog4j:ERROR Could not send GELF message: access denied (\"java.net.SocketPermission\" \"localhost:0\" \"listen,resolve\")\r\njava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"localhost:0\" \"listen,resolve\")\r\n\tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)\r\n\tat java.security.AccessController.checkPermission(AccessController.java:685)\r\n\tat java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n\tat java.lang.SecurityManager.checkListen(SecurityManager.java:1134)\r\n\tat sun.nio.ch.DatagramChannelImpl.bind(DatagramChannelImpl.java:689)\r\n\tat sun.nio.ch.DatagramSocketAdaptor.bind(DatagramSocketAdaptor.java:91)\r\n\tat biz.paluch.logging.gelf.intern.sender.GelfUDPSender.initiateChannel(GelfUDPSender.java:35)\r\n\tat biz.paluch.logging.gelf.intern.sender.GelfUDPSender.<init>(GelfUDPSender.java:28)\r\n\tat biz.paluch.logging.gelf.intern.sender.DefaultGelfSenderProvider.create(DefaultGelfSenderProvider.java:40)\r\n\tat biz.paluch.logging.gelf.intern.GelfSenderFactory.createSender(GelfSenderFactory.java:63)\r\n\tat biz.paluch.logging.gelf.intern.GelfSenderFactory.createSender(GelfSenderFactory.java:45)\r\n\tat biz.paluch.logging.gelf.log4j.GelfLogAppender.append(GelfLogAppender.java:95)\r\n\tat org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:251)\r\n\tat org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:66)\r\n\tat org.apache.log4j.Category.callAppenders(Category.java:206)\r\n\tat org.apache.log4j.Category.forcedLog(Category.java:391)\r\n\tat org.apache.log4j.Category.log(Category.java:856)\r\n\tat org.elasticsearch.common.logging.log4j.Log4jESLogger.internalInfo(Log4jESLogger.java:120)\r\n\tat org.elasticsearch.common.logging.support.AbstractESLogger.info(AbstractESLogger.java:81)\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:149)\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:140)\r\n\tat org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:143)\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:178)\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:270)\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)\r\n```","closed_by":{"login":"gehel","id":1415765,"node_id":"MDQ6VXNlcjE0MTU3NjU=","avatar_url":"https://avatars1.githubusercontent.com/u/1415765?v=4","gravatar_id":"","url":"https://api.github.com/users/gehel","html_url":"https://github.com/gehel","followers_url":"https://api.github.com/users/gehel/followers","following_url":"https://api.github.com/users/gehel/following{/other_user}","gists_url":"https://api.github.com/users/gehel/gists{/gist_id}","starred_url":"https://api.github.com/users/gehel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gehel/subscriptions","organizations_url":"https://api.github.com/users/gehel/orgs","repos_url":"https://api.github.com/users/gehel/repos","events_url":"https://api.github.com/users/gehel/events{/privacy}","received_events_url":"https://api.github.com/users/gehel/received_events","type":"User","site_admin":false},"performed_via_github_app":null}