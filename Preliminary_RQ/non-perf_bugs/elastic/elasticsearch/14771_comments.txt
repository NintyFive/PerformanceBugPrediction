[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157712121","html_url":"https://github.com/elastic/elasticsearch/issues/14771#issuecomment-157712121","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14771","id":157712121,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzcxMjEyMQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-18T13:24:39Z","updated_at":"2015-11-18T13:25:11Z","author_association":"CONTRIBUTOR","body":"This is weird for a few reasons...  \n- you can't sort on fields, only on the result of aggregations so the exception is correct\n- it shouldn't be returning a 503 response though\n- when I try it (full example below) on 2.0, I don't get this exception, which i should\n  \n  POST _bulk\n  {\"index\":{\"_index\":\"searchtests\",\"_type\":\"searchtest\",\"_id\":1}}\n  {\"id\":1,\"name\":\"one\",\"details\":\"This is the details of the document, very interesting\",\"circletest\":{\"type\":\"circle\",\"coordinates\":[45,45],\"radius\":\"100m\"},\"location\":[45,45],\"lift\":2.9,\"dateofdetails\":\"2015-10-26T19:19:38.5961045Z\"}\n  {\"index\":{\"_index\":\"searchtests\",\"_type\":\"searchtest\",\"_id\":2}}\n  {\"id\":2,\"name\":\"two\",\"details\":\"Details of the document two, leave it alone\",\"circletest\":{\"type\":\"circle\",\"coordinates\":[46,45],\"radius\":\"50m\"},\"location\":[46,45],\"lift\":2.5,\"dateofdetails\":\"2015-04-20T19:19:38.5961045Z\"}\n  {\"index\":{\"_index\":\"searchtests\",\"_type\":\"searchtest\",\"_id\":3}}\n  {\"id\":3,\"name\":\"three\",\"details\":\"This data is different\",\"circletest\":{\"type\":\"circle\",\"coordinates\":[37,42],\"radius\":\"80m\"},\"location\":[37,42],\"lift\":2.1,\"dateofdetails\":\"2015-10-12T19:19:38.5961045Z\"}\n\nFull example:\n\n```\nPOST searchtests/_search?search_type=count\n{\n  \"aggs\": {\n    \"testHistogramBucketAggregation\": {\n      \"date_histogram\": {\n        \"field\": \"dateofdetails\",\n        \"interval\": \"1M\",\n        \"format\": \"yyyy-MM-dd\",\n        \"offset\": \"1d\",\n        \"time_zone\": \"+02:00\",\n        \"order\": {\n          \"dateofdetails\": \"desc\"\n        },\n        \"min_doc_count\": 2,\n        \"extended_bounds\": {\n          \"min\": 0,\n          \"max\": 1000000\n        }\n      },\n      \"aggs\": {\n        \"tophits\": {\n          \"top_hits\": {}\n        }\n      }\n    }\n  }\n}\n```\n\n@colings86 any ideas?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157725324","html_url":"https://github.com/elastic/elasticsearch/issues/14771#issuecomment-157725324","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14771","id":157725324,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzcyNTMyNA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2015-11-18T14:15:21Z","updated_at":"2015-11-18T14:15:21Z","author_association":"MEMBER","body":"I get the same as @clintongormley.\n\nThis is a bug because an exception should be thrown and the status code returned should be 400 (bad request).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301287230","html_url":"https://github.com/elastic/elasticsearch/issues/14771#issuecomment-301287230","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14771","id":301287230,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTI4NzIzMA==","user":{"login":"qwerty4030","id":874677,"node_id":"MDQ6VXNlcjg3NDY3Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/874677?v=4","gravatar_id":"","url":"https://api.github.com/users/qwerty4030","html_url":"https://github.com/qwerty4030","followers_url":"https://api.github.com/users/qwerty4030/followers","following_url":"https://api.github.com/users/qwerty4030/following{/other_user}","gists_url":"https://api.github.com/users/qwerty4030/gists{/gist_id}","starred_url":"https://api.github.com/users/qwerty4030/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwerty4030/subscriptions","organizations_url":"https://api.github.com/users/qwerty4030/orgs","repos_url":"https://api.github.com/users/qwerty4030/repos","events_url":"https://api.github.com/users/qwerty4030/events{/privacy}","received_events_url":"https://api.github.com/users/qwerty4030/received_events","type":"User","site_admin":false},"created_at":"2017-05-14T02:43:55Z","updated_at":"2017-05-14T02:44:45Z","author_association":"CONTRIBUTOR","body":"As of #22343 `histogram` and `date_histogram` aggregation order will now be validated during the shard search phase. We now get the same validation errors as the `terms` agg when an invalid sub-aggregation is given in the order.\r\n```\r\nPUT i\r\n\r\nPOST i/_search\r\n{\r\n  \"aggs\": {\r\n    \"a\": {\r\n      \"date_histogram\": {\r\n        \"field\": \"f\", \r\n        \"interval\": \"day\", \r\n        \"order\": {\r\n          \"wrong\": \"asc\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nresponse:\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"aggregation_execution_exception\",\r\n        \"reason\": \"Invalid aggregator order path [wrong]. Unknown aggregation [wrong]\"\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"i\",\r\n        \"node\": \"jUa3xSiEQTayFeYCYHt2jg\",\r\n        \"reason\": {\r\n          \"type\": \"aggregation_execution_exception\",\r\n          \"reason\": \"Invalid aggregator order path [wrong]. Unknown aggregation [wrong]\"\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"status\": 500\r\n}\r\n```\r\nThe `order` code was refactored in #22343 so it will now be easier to move order validation for all aggregations to the query parsing phase as a follow up PR.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375381804","html_url":"https://github.com/elastic/elasticsearch/issues/14771#issuecomment-375381804","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14771","id":375381804,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTM4MTgwNA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T17:02:27Z","updated_at":"2018-03-22T17:02:27Z","author_association":"MEMBER","body":"@elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375388082","html_url":"https://github.com/elastic/elasticsearch/issues/14771#issuecomment-375388082","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14771","id":375388082,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTM4ODA4Mg==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T17:20:07Z","updated_at":"2018-03-22T17:20:07Z","author_association":"MEMBER","body":"Actually, closing in favor of #20003\r\n\r\nSorry for the noise :)","performed_via_github_app":null}]