{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29530","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29530/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29530/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29530/events","html_url":"https://github.com/elastic/elasticsearch/issues/29530","id":314651858,"node_id":"MDU6SXNzdWUzMTQ2NTE4NTg=","number":29530,"title":"Use soft-deletes to maintain document history","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"labels":[{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-04-16T13:30:27Z","updated_at":"2018-08-31T02:11:24Z","closed_at":"2018-08-31T02:11:24Z","author_association":"MEMBER","active_lock_reason":null,"body":"With the introduction of [soft-delete]((https://issues.apache.org/jira/browse/LUCENE-8200)) in Lucene, a history of a document can be maintained. This meta issue tracks work on migrating from hard-deletes to soft-deletes.\r\n\r\nCut over\r\n--------\r\n- [x] Replace hard-updates by soft-updates (https://github.com/elastic/elasticsearch/pull/29458)\r\n- [x] Replace hard-deletes by soft-deletes (https://github.com/elastic/elasticsearch/pull/29549)\r\n- [x] Index no-op (https://github.com/elastic/elasticsearch/pull/30226) \r\n- [x] Index stale operations (i.e. out of order) on replicas (https://github.com/elastic/elasticsearch/pull/29679)\r\n\r\nRetention and source\r\n--------------------\r\n- [x] Use SoftDeletesRetentionMergePolicy to maintain only the recent history (https://github.com/elastic/elasticsearch/pull/30335)\r\n- [x] Special merge strategy when `_source` is disabled (https://github.com/elastic/elasticsearch/pull/31106)\r\n- ~~Do not keep delete tombstones in version map. Delete tombstones can be queried from Lucene~~ (to be done in https://github.com/elastic/elasticsearch/issues/31637)\r\n\r\nTranslog\r\n--------\r\n- [x] Add API allows querying operations given a range of seq# (https://github.com/elastic/elasticsearch/pull/30120)\r\n- ~~Use `maxTimestamp` from engine for `autoGeneratedIdTimestamp`~~ (migrated to #30086)\r\n- [x] Replace translog by Lucene history in peer-recovery (https://github.com/elastic/elasticsearch/pull/30522)\r\n- [x] Replace translog by Lucene history in primary-replica resync (#33178)\r\n- [x] Only sends operations after the local checkpoint in peer-recovery (#33190)\r\n\r\nTBD\r\n-------\r\n- ~~Avoid having multiple docs for the same stale operation. We currently defer the dedup until the search time but we might revisit this decision to do it at the index time~~(to be done in #31637). \r\n\r\nMisc\r\n-------\r\n- [x] Store the reason of noop in its document tombstone (https://github.com/elastic/elasticsearch/pull/30570)\r\n- [x] Use exact numDocs in synced-flush (https://github.com/elastic/elasticsearch/pull/30228)\r\n- [x] Randomize soft-deletes settings (https://github.com/elastic/elasticsearch/pull/31585)\r\n- [x] Do not expose hard-deleted documents (#32333)","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}