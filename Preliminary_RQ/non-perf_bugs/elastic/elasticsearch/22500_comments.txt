[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271313740","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271313740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271313740,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTMxMzc0MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-01-09T15:30:28Z","updated_at":"2017-01-09T15:30:28Z","author_association":"CONTRIBUTOR","body":"Hi @Rogier75 \r\n\r\nCould you try removing the aggs and see if that resolves the issue?  Also, if you're able to provide a set of working documents and mappings etc that reliably trigger this failure, it would be very helpful.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271521313","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271521313","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271521313,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTUyMTMxMw==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2017-01-10T09:01:32Z","updated_at":"2017-01-10T09:23:34Z","author_association":"NONE","body":"I have not yet been able to produce any test data because any new index that I create does not trigger the bug.\r\n\r\nWhat I can see is the following:\r\n\r\n**Search and scroll _with_ aggregation**:\r\na. Old index with session.id type is string: search is successful, but scroll returns 0 hits.\r\nb. Old index with session.id type is text: search is successful, but scroll gets ReduceSearchPhaseException caused by NullPointerException\r\nc. New index >= 5.0 search and scroll are successful\r\n\r\n**Search and scroll _without_ aggregation**:\r\nSearch and scroll without aggregation is successful on both old and new indexes\r\n\r\nI now plan to reindex my data and or remove old data. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271564309","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271564309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271564309,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTU2NDMwOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-01-10T12:33:40Z","updated_at":"2017-01-10T12:33:40Z","author_association":"CONTRIBUTOR","body":"@jpountz any ideas what might be happening here?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271836552","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271836552","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271836552,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTgzNjU1Mg==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T10:43:04Z","updated_at":"2017-01-11T10:47:18Z","author_association":"NONE","body":"I was able to reproduce the empty scroll after a successful search. This has worked for me in the past even though mentioned [here](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-scroll.html) is:\r\n\r\n> If the request specifies aggregations, only the initial search response will contain the aggregations results.\r\n\r\nTo reproduce the empty scroll result on Elasticsearch 5.1.1:\r\n\r\n**Test data**: contains 18 documents with unique session.id\r\nhttps://gist.github.com/Rogier75/27136d1996dfc50c90c31ad07c75a1e9\r\n\r\n**Data mapping** (generated):\r\nhttps://gist.github.com/Rogier75/dfe6a6b0bcec81075a880d6090096193\r\n\r\n**Search query**: GET github_22500/_search/?scroll=1m\r\nhttps://gist.github.com/Rogier75/cd515adc269159ab08b45de29bd3333c\r\n\r\n**Search result**: successfully returns 10 hits\r\nhttps://gist.github.com/Rogier75/d4c135bfcc0a29b8daf0d27ff9f714eb\r\n\r\n**Scroll**: GET _search/scroll?scroll=1m\r\nDnF1ZXJ5VGhlbkZldGNoAgAAAAAAB7uQFjczYWFZNzVCU2MtSTA0TGQwbkpDaGcAAAAAAAezeBZkSUhyYXI4NVE3S19TX0cwRU9PdDhR\r\n\r\n**Scroll result**: is empty where expected 8 hits\r\n```\r\n{\r\n   \"_scroll_id\":\"DnF1ZXJ5VGhlbkZldGNoAgAAAAAAB7uQFjczYWFZNzVCU2MtSTA0TGQwbkpDaGcAAAAAAAezeBZkSUhyYXI4NVE3S19TX0cwRU9PdDhR\",\r\n   \"took\":1,\r\n   \"timed_out\":false,\r\n   \"_shards\":{\r\n      \"total\":2,\r\n      \"successful\":2,\r\n      \"failed\":0\r\n   },\r\n   \"hits\":{\r\n      \"total\":18,\r\n      \"max_score\":0,\r\n      \"hits\":[\r\n\r\n      ]\r\n   }\r\n}\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271840540","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271840540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271840540,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTg0MDU0MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T11:02:26Z","updated_at":"2017-01-11T11:02:26Z","author_association":"MEMBER","body":"I don't understand what you're trying to achieve. If you send a scroll query with `size:0` it is expected that you get no hits. In fact with `size:0` you are sure that the first query will return no hits and then your scroll is considered as finish.\r\nRegarding the aggregation only the initial query will return result for the aggs, subsequent queries with `_scroll` will not compute the aggregations. Can you explain why you use `size:0` and aggregations in a `scroll` query ? This is not intended to be used like this so unless you find a reproduction for the NPE I think we can consider that this issue is solved.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271849081","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271849081","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271849081,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTg0OTA4MQ==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T11:48:19Z","updated_at":"2017-01-11T11:59:15Z","author_association":"NONE","body":"@jimczi \r\nPlease bear with me for one second and let me explain what I'm trying to do. If you tell me that it is impossible than I will implement another solution:\r\n\r\nImagine the following 4 documents exist with a timestamp and session.id:\r\n1. timestamp: 18:50 session.id: 1\r\n2. timestamp: 18:55 session.id: 1\r\n3. timestamp: 19:00 session.id: 2\r\n4. timestamp: 19:05 session.id: 2\r\n\r\nI want to search and scroll and want to find one document for each unique session.id but get only the ones with the earliest timestamp. So in the above case I want to get document 1 and 3.\r\n\r\nIf I remove the size:0 I can scroll further but since there is no aggregated result I don't get the documents that I am querying for.\r\n\r\nI guess that it would be best for me to create a separate index to contain only (a duplicate of) those unique documents by session.id with the earliest time stamp. On that index I could then search and scroll without aggregation.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271854669","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271854669","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271854669,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTg1NDY2OQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T12:18:52Z","updated_at":"2017-01-11T12:18:52Z","author_association":"MEMBER","body":"You'll have to make the collapsing on the client side if you want to use the scroll. You could for instance do a query like:\r\n````\r\nGET _search?scroll=1m\r\n{\r\n  \"query\": {\r\n    \"exists\": {\r\n        \"field\": \"session\"\r\n    }\r\n  },\r\n  \"sort\": [\r\n     {\r\n        \"session\": {\r\n           \"order\": \"desc\"\r\n        },\r\n        \"timestamp\": {\r\n            \"order\": \"asc\"\r\n        }\r\n     }\r\n  ]\r\n}\r\n````\r\n... and then for each result set you would keep the first result of each session id.\r\nWe're also iterating on a collapse feature for search requests but only pagination would be possible (no scroll):\r\nhttps://github.com/elastic/elasticsearch/pull/22337","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271868926","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271868926","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271868926,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTg2ODkyNg==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T13:32:04Z","updated_at":"2017-01-11T13:32:04Z","author_association":"NONE","body":"Thanks @jimczi \r\n\r\n#22337 does look interesting as it supports pagination. Until that's final I will create a new index (or new type in an existing index) that contains the unique session documents with earliest time stamp. It's a small bit of duplication but it allows for search and scroll and pagination.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271905157","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271905157","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271905157,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTkwNTE1Nw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T15:51:00Z","updated_at":"2017-01-11T15:51:00Z","author_association":"MEMBER","body":"Though we should continue to investigate what's causing the NPE. I am reopening this issue because the NPE may be due to a bug and it would be beneficial to know what's causing it. Can you share your mapping and the steps you followed to reach the state where you get exceptions ? You're mentioning that you use an old index ? What does that mean ? You created the index in an older version and you've upgraded to 5.x ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271924804","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271924804","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271924804,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTkyNDgwNA==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T16:55:33Z","updated_at":"2017-01-11T16:58:47Z","author_association":"NONE","body":"To get the exact mapping at the time I wrote this issue I need to put back an old snapshot on a different host. I'll try to that tomorrow. Since then I have re-indexed my data and fields that had previously been generated as type text have now become type string. I actually think that the _string_ vs _text_ type has something to do with the issue.\r\n\r\nThe index was created in an older version after which I upgraded to 5.x. Is there a way to see in which version the index was created?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271980309","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-271980309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":271980309,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTk4MDMwOQ==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T20:11:28Z","updated_at":"2017-01-11T21:19:09Z","author_association":"NONE","body":"@jimczi \r\nI have recreated the NullPointerException.\r\n\r\nmapping:\r\nhttps://gist.github.com/Rogier75/752507cd3affd4235a249a9d27abedd2#file-github_22500_mapping-txt\r\n\r\ndata:\r\nhttps://gist.github.com/Rogier75/27136d1996dfc50c90c31ad07c75a1e9\r\n\r\nsearch query:\r\nhttps://gist.github.com/Rogier75/cd515adc269159ab08b45de29bd3333c\r\n\r\nSearch is successful\r\n\r\nScroll fails with ReduceSearchPhaseException Caused by NullPointerException\r\n\r\n\r\n_Update_:\r\nI deleted the index, created it again and now the NullPointerException does not happen. Sorry, but this is proving to be harder then I thought.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272012023","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-272012023","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":272012023,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjAxMjAyMw==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T22:12:02Z","updated_at":"2017-01-11T22:12:02Z","author_association":"NONE","body":"What we can learn from this is that it can happen on a newly created index in Elasticsearch 5.1.1 and is not related to the index being created in an older version.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272013027","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-272013027","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":272013027,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjAxMzAyNw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T22:15:42Z","updated_at":"2017-01-11T22:15:42Z","author_association":"MEMBER","body":"I cannot reproduce with my single node test and your recreation. If you reproduce can you keep the stack trace of the NPE and copy it here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272014436","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-272014436","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":272014436,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjAxNDQzNg==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T22:21:37Z","updated_at":"2017-01-11T22:21:37Z","author_association":"NONE","body":"```\r\n[2017-01-11T20:59:29,168][WARN ][r.suppressed             ] path: /_search/scroll, params: {scroll=1m}\r\norg.elasticsearch.action.search.ReduceSearchPhaseException: [reduce] inner finish failed\r\n        at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction.finishHim(SearchScrollQueryThenFetchAsyncAction.java:217) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction.executeFetchPhase(SearchScrollQueryThenFetchAsyncAction.java:175) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction.access$000(SearchScrollQueryThenFetchAsyncAction.java:44) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction$1.onResponse(SearchScrollQueryThenFetchAsyncAction.java:135) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction$1.onResponse(SearchScrollQueryThenFetchAsyncAction.java:129) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.action.ActionListenerResponseHandler.handleResponse(ActionListenerResponseHandler.java:46) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:978) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.TransportService$DirectResponseChannel.processResponse(TransportService.java:1055) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1039) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1029) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.DelegatingTransportChannel.sendResponse(DelegatingTransportChannel.java:58) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry$TransportChannelWrapper.sendResponse(RequestHandlerRegistry.java:111) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.action.search.SearchTransportService$8.messageReceived(SearchTransportService.java:317) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.action.search.SearchTransportService$8.messageReceived(SearchTransportService.java:313) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:577) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:527) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.1.1.jar:5.1.1]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0]\r\n        at java.lang.Thread.run(Thread.java:744) [?:1.8.0]\r\nCaused by: java.lang.NullPointerException\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372643456","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-372643456","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":372643456,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjY0MzQ1Ng==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T12:08:03Z","updated_at":"2018-03-13T12:08:03Z","author_association":"MEMBER","body":"@Rogier75 are you still able to reproduce this issue on recent (6.x) versions of Elasticsearch?\r\n\r\n/cc @elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375267359","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-375267359","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":375267359,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTI2NzM1OQ==","user":{"login":"Rogier75","id":23118927,"node_id":"MDQ6VXNlcjIzMTE4OTI3","avatar_url":"https://avatars2.githubusercontent.com/u/23118927?v=4","gravatar_id":"","url":"https://api.github.com/users/Rogier75","html_url":"https://github.com/Rogier75","followers_url":"https://api.github.com/users/Rogier75/followers","following_url":"https://api.github.com/users/Rogier75/following{/other_user}","gists_url":"https://api.github.com/users/Rogier75/gists{/gist_id}","starred_url":"https://api.github.com/users/Rogier75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rogier75/subscriptions","organizations_url":"https://api.github.com/users/Rogier75/orgs","repos_url":"https://api.github.com/users/Rogier75/repos","events_url":"https://api.github.com/users/Rogier75/events{/privacy}","received_events_url":"https://api.github.com/users/Rogier75/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T11:12:16Z","updated_at":"2018-03-22T11:12:16Z","author_association":"NONE","body":"I have not encountered this issue in ES version 6.x\n\n \n\nFrom: Colin Goodheart-Smithe <notifications@github.com> \nSent: Tuesday, 13 March 2018 13:09\nTo: elastic/elasticsearch <elasticsearch@noreply.github.com>\nCc: Rogier Taal <rogiertaal75@gmail.com>; Mention <mention@noreply.github.com>\nSubject: Re: [elastic/elasticsearch] ReduceSearchPhaseException Caused by NullPointerException (#22500)\n\n \n\n@Rogier75 <https://github.com/rogier75>  are you still able to reproduce this issue on recent (6.x) versions of Elasticsearch?\n\n/cc @elastic/es-search-aggs <https://github.com/orgs/elastic/teams/es-search-aggs> \n\n—\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub <https://github.com/elastic/elasticsearch/issues/22500#issuecomment-372643456> , or mute the thread <https://github.com/notifications/unsubscribe-auth/AWDET2xtBOoDWTug44Ar7Sgv6luLgM3Gks5td7bXgaJpZM4LePj7> .\n\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375273355","html_url":"https://github.com/elastic/elasticsearch/issues/22500#issuecomment-375273355","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22500","id":375273355,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTI3MzM1NQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T11:35:10Z","updated_at":"2018-03-22T11:35:10Z","author_association":"MEMBER","body":"@Rogier75 thanks for confirming. I am going to close this issue for now then. If you do manage to reproduce this on a 6.x cluster then please comment here with any details you have and we can re-open and try to track it down again.","performed_via_github_app":null}]