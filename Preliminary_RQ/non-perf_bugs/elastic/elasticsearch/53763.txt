{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53763","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53763/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53763/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53763/events","html_url":"https://github.com/elastic/elasticsearch/issues/53763","id":583987666,"node_id":"MDU6SXNzdWU1ODM5ODc2NjY=","number":53763,"title":"[ML] Datafeed does not start when allow_lazy_open is enabled","user":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"assignees":[{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-03-18T20:36:58Z","updated_at":"2020-03-24T10:01:14Z","closed_at":"2020-03-24T10:01:14Z","author_association":"NONE","active_lock_reason":null,"body":"Found in 7.7.0-SNAPSHOT `    \"build_hash\" : \"2f0aca992bb8c91c17603050807891cad2e41483\",\r\n    \"build_date\" : \"2020-03-16T02:52:34.086738Z\",`\r\n\r\n- 3 node cluster, all nodes acting as data, master and ml\r\n- All nodes are co-located on the same 16GB VM\r\n- `\"xpack.ml.max_machine_memory_percent\" : 16`\r\n\r\nI have a script that creates 16 jobs in succession. Each job requires 2GB model memory.\r\n\r\nThe first 3 jobs open and the datafeeds start. \r\nThe 4th job returns `opened:false` and the datafeed fails to start with the following:\r\n\r\n```\r\nopen job        {\"opened\":false}\r\nstart datafeed  {\"error\":{\"root_cause\":[{\"type\":\"status_exception\",\"reason\":\"Could not start datafeed, allocation explanation []\"}],\"type\":\"status_exception\",\"reason\":\"Could not ...\r\n```\r\n\r\nIn the job list, the job state is `opening` and the datafeed state is `stopped`. No errors are visible.\r\n\r\nAs one of the first 3 jobs completes, one of the `opening` jobs transitions its state to `opened`. However the datafeed remains `stopped`.\r\n\r\nThese are the job messages for a job that was lazy opening.\r\n![image](https://user-images.githubusercontent.com/4185750/77004816-a89aa600-6957-11ea-8241-e70fc4c358fb.png)\r\n\r\nExpected behavior would be for the datafeed to be `starting` and for it to start once resource became available (which would happen when one of the other jobs closed, in this scenario).\r\n\r\nOnce jobs have completed, I can manually start the datafeed on one of the `opened` jobs and it will complete without on-screen errors. (I cannot start one of the `opening` jobs, which is to be expected.)\r\n","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}