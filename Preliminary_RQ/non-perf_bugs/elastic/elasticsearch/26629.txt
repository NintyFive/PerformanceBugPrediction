{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26629","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26629/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26629/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26629/events","html_url":"https://github.com/elastic/elasticsearch/issues/26629","id":257420802,"node_id":"MDU6SXNzdWUyNTc0MjA4MDI=","number":26629,"title":"custom analyzer error for upgrade from es 2.4 to 5.5","user":{"login":"willard-kali","id":10024569,"node_id":"MDQ6VXNlcjEwMDI0NTY5","avatar_url":"https://avatars0.githubusercontent.com/u/10024569?v=4","gravatar_id":"","url":"https://api.github.com/users/willard-kali","html_url":"https://github.com/willard-kali","followers_url":"https://api.github.com/users/willard-kali/followers","following_url":"https://api.github.com/users/willard-kali/following{/other_user}","gists_url":"https://api.github.com/users/willard-kali/gists{/gist_id}","starred_url":"https://api.github.com/users/willard-kali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willard-kali/subscriptions","organizations_url":"https://api.github.com/users/willard-kali/orgs","repos_url":"https://api.github.com/users/willard-kali/repos","events_url":"https://api.github.com/users/willard-kali/events{/privacy}","received_events_url":"https://api.github.com/users/willard-kali/received_events","type":"User","site_admin":false},"labels":[{"id":151933706,"node_id":"MDU6TGFiZWwxNTE5MzM3MDY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eupgrade","name":">upgrade","color":"c7def8","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-09-13T15:18:52Z","updated_at":"2017-10-27T12:52:27Z","closed_at":"2017-10-27T12:52:27Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:\r\nI am working on upgrading ES from 2.4.0 to 5.5.0. The issue come when our custom analyzer for existing data in 2.4.0 can't work with ES 5.5.0\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n5.5.0\r\n**Plugins installed**: []\r\nno\r\n**JVM version** (`java -version`):\r\n1.8.0\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nsuse\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\n 1.install an es 2.4.0,create template with custom analyzer and make sure it can work\r\n 2.put multi data to es.\r\n 3.upgrade es from 2.4.0 to es 5.5.0 with no data loss, then start cluster.\r\n4. index which using the custom analyzer doesn't work, but others can still work. \r\n\r\n**Provide logs (if relevant)**:\r\nafter starting es 5.5.0 cluster, es indices of custom analyzer data is red.for example:\r\n\r\n> red    open   index-2017.09.01 _5kVf0JdQe2f4U9xRHUQ4g  20   0                                                  \r\n> red    open   index-2017.09.02 oJHgF926Q7qO7uEMUWwVqw  20   0                                                  \r\n> red    open   index-2017.09.04 OmUDO5WjTvCtwK4cfWqMiQ  20   0                                                  \r\n> red    open   index-2017.09.10 uLf86VbnREKtcY4rfpQsGg  20   0                                                  \r\n> red    open   index-2017.08.28 kohnPoCuSxSosnyQtk_UvQ  20   0                                                  \r\n> red    open   index-2017.09.05 XwhMN_F-S7mrObhfEOFBlw  20   0                                                  \r\n> red    open   index-2017.08.30 F4TdoX3JRL-PmTUEH_U7aw  20   0      \r\n\r\n                            \r\n\r\nand es logs report:\r\n\r\n> [2017-09-13T21:27:15,158][WARN ][o.e.i.c.IndicesClusterStateService] [nM8euBy] [[index-2017.09.05][10]] marking and sending shard failed due to [failed to update mapping for index]\r\n> org.elasticsearch.index.mapper.MapperParsingException: Failed to parse mapping [_default_]: analyzer [url_spliter] not found for field [URL]\r\n\r\nPS:url_spliter is the custom analyzer.\r\n\r\n> \"url_spliter\" : {\r\n>     \"pattern\" : \"[.|/]\",\r\n>     \"type\" : \"pattern\"\r\n> }\r\n\r\nI find a similar issue:\r\n[updatesettings](https://stackoverflow.com/questions/19758335/error-when-trying-to-update-the-settings)  and flowed it \r\nclose index -> update mapping -> reopen index.\r\nbut it doesn't help.\r\n\r\nFor the issue above, when upgrading ES from 2.4.0 to 5.5.0, how can  I keep the custom analyzer and make it still work for previous data?\r\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}