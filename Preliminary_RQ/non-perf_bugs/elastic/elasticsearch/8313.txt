{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8313","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8313/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8313/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8313/events","html_url":"https://github.com/elastic/elasticsearch/issues/8313","id":47443988,"node_id":"MDU6SXNzdWU0NzQ0Mzk4OA==","number":8313,"title":"Shards getting reshuffled across nodes during rolling restart.","user":{"login":"gibrown","id":820871,"node_id":"MDQ6VXNlcjgyMDg3MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/820871?v=4","gravatar_id":"","url":"https://api.github.com/users/gibrown","html_url":"https://github.com/gibrown","followers_url":"https://api.github.com/users/gibrown/followers","following_url":"https://api.github.com/users/gibrown/following{/other_user}","gists_url":"https://api.github.com/users/gibrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gibrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gibrown/subscriptions","organizations_url":"https://api.github.com/users/gibrown/orgs","repos_url":"https://api.github.com/users/gibrown/repos","events_url":"https://api.github.com/users/gibrown/events{/privacy}","received_events_url":"https://api.github.com/users/gibrown/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-10-31T20:59:39Z","updated_at":"2018-02-13T19:28:39Z","closed_at":"2015-11-21T20:22:01Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"There appears to be new behavior (introduced between 1.2.1 and 1.3.4) which causes shards to get juggled around between nodes when they get restarted. This of course makes restart take much longer.\n\nWe run some of our rolling restarts where we restart 4 nodes at a time to speed up the rolling restart. The recovery used to favor recovering shards from the local node. In this screenshot of disk space on different nodes (blue is live shards, and brown is other disk space used) the shards are getting randomly assigned across the nodes that were restarting.\n\n![Shard Shuffling](https://i.cloudup.com/xafnWLKeR2.png)\n\nLooking at the disk space on the nodes I see that each node has 75% more shards on disk than it should, which is exactly what you'd expect if ES is re-assigning all the shards randomly.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}