{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12676","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12676/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12676/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12676/events","html_url":"https://github.com/elastic/elasticsearch/issues/12676","id":99264860,"node_id":"MDU6SXNzdWU5OTI2NDg2MA==","number":12676,"title":"Unable to update document","user":{"login":"XDestination","id":2340164,"node_id":"MDQ6VXNlcjIzNDAxNjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/2340164?v=4","gravatar_id":"","url":"https://api.github.com/users/XDestination","html_url":"https://github.com/XDestination","followers_url":"https://api.github.com/users/XDestination/followers","following_url":"https://api.github.com/users/XDestination/following{/other_user}","gists_url":"https://api.github.com/users/XDestination/gists{/gist_id}","starred_url":"https://api.github.com/users/XDestination/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XDestination/subscriptions","organizations_url":"https://api.github.com/users/XDestination/orgs","repos_url":"https://api.github.com/users/XDestination/repos","events_url":"https://api.github.com/users/XDestination/events{/privacy}","received_events_url":"https://api.github.com/users/XDestination/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2015-08-05T18:09:10Z","updated_at":"2016-01-26T17:52:28Z","closed_at":"2016-01-26T17:52:28Z","author_association":"NONE","active_lock_reason":null,"body":"Following scenario: We are updating (upserting) lots of documents into an index in elasticsearch-cluster (2 data nodes). Today we increased the volume of those updates by roughly a factor of 10. After a few minutes (I would say 10 to 20) we suddenly saw lots of errors returned by elasticsearch. All of those were like the following one:\n\n`RemoteTransportException[[SERVER_NAME][inet[/SERVER_IP:9300]][update]]; nested: ElasticsearchIllegalArgumentException[failed to execute script]; nested: NoSuchElementException;`\n\nThe body of those requests always looks like that:\n    {\n        script: 'ctx._source.FIELD_1 = PARAM_1; ctx._source.FIELD_2 = PARAM_2',\n        params: {\n                PARAM_1: \"some string\",\n                PARAM_2: 124\n        },\n        upsert: {\n                PARAM_1: \"some string\",\n                PARAM_2: 124\n        }\n    }\n\nI played around a bit with the update and it worked (at least in this case) once I removed the update for FIELD_2/PARAM_2.\n\nAdditionally I tried a couple of things to fix the issue:\n- Repeating the requests after a few seconds\n- Reducing/Increasing the value of retry_on_conflict\n- Replacing retry_on_conflict by loop + loopcounter and a timeout\n\nNothing worked. In the end I restarted the data-node that was holding (at this time) all primary shards, which finally seemed to have solved it for now.\n\nAny ideas why this happened? Any suggestions what to try, in case it happens again?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}