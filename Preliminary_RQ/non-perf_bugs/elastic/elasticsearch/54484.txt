{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/54484","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54484/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54484/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54484/events","html_url":"https://github.com/elastic/elasticsearch/issues/54484","id":590960204,"node_id":"MDU6SXNzdWU1OTA5NjAyMDQ=","number":54484,"title":"Elastic Search update by query not reflecting correctly updated number of documents","user":{"login":"HighOnWater","id":30986640,"node_id":"MDQ6VXNlcjMwOTg2NjQw","avatar_url":"https://avatars1.githubusercontent.com/u/30986640?v=4","gravatar_id":"","url":"https://api.github.com/users/HighOnWater","html_url":"https://github.com/HighOnWater","followers_url":"https://api.github.com/users/HighOnWater/followers","following_url":"https://api.github.com/users/HighOnWater/following{/other_user}","gists_url":"https://api.github.com/users/HighOnWater/gists{/gist_id}","starred_url":"https://api.github.com/users/HighOnWater/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HighOnWater/subscriptions","organizations_url":"https://api.github.com/users/HighOnWater/orgs","repos_url":"https://api.github.com/users/HighOnWater/repos","events_url":"https://api.github.com/users/HighOnWater/events{/privacy}","received_events_url":"https://api.github.com/users/HighOnWater/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-03-31T09:51:42Z","updated_at":"2020-09-02T15:25:07Z","closed_at":"2020-09-02T15:19:52Z","author_association":"NONE","active_lock_reason":null,"body":"\r\nJava version: 1.8.0_151\r\nES Version: 7.4\r\nI am running an update by query call using the java rest [client](https://www.elastic.co/guide/en/elasticsearch/client/java-rest/master/java-rest-high-document-update-by-query.html)\r\n\r\nThis is my code: (extracted only the relevant part and updated some fields in the painless script)\r\n\r\n```\r\nUpdateByQueryRequest queryRequest = new UpdateByQueryRequest(indexName);\r\nScript script = new Script(ScriptType.INLINE, \"painless\", \"if (ctx._source.someKey == someVal) {ctx._source.someKey = someOtherVal;}\",Collections.emptyMap());\r\nqueryRequest.setScript(script);\r\nBulkByScrollResponse bulkResponse = aesClient.updateByQuery(queryRequest, RequestOptions.DEFAULT);\r\n```\r\n\r\nThe above code works fine, with the relevant documents getting updated. However, whenever I execute the following:\r\n```\r\nlong updatedDocs = bulkResponse.getUpdated();\r\n```\r\n\r\nThe value stored in ```updatedDocs``` doesn't reflect the actual number of documents getting updated. The value stored in it is the number of documents that it processed.\r\n\r\nAccording to the  [documentation](https://www.elastic.co/guide/en/elasticsearch/client/java-rest/master/java-rest-high-document-update-by-query.html#java-rest-high-document-update-by-query-response) it should return the number of documents updated. \r\n\r\nCan this be looked into.\r\nThanks.\r\n\r\n","closed_by":{"login":"swallez","id":213730,"node_id":"MDQ6VXNlcjIxMzczMA==","avatar_url":"https://avatars2.githubusercontent.com/u/213730?v=4","gravatar_id":"","url":"https://api.github.com/users/swallez","html_url":"https://github.com/swallez","followers_url":"https://api.github.com/users/swallez/followers","following_url":"https://api.github.com/users/swallez/following{/other_user}","gists_url":"https://api.github.com/users/swallez/gists{/gist_id}","starred_url":"https://api.github.com/users/swallez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swallez/subscriptions","organizations_url":"https://api.github.com/users/swallez/orgs","repos_url":"https://api.github.com/users/swallez/repos","events_url":"https://api.github.com/users/swallez/events{/privacy}","received_events_url":"https://api.github.com/users/swallez/received_events","type":"User","site_admin":false},"performed_via_github_app":null}