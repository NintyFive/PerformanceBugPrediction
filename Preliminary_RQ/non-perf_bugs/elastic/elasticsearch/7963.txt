{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7963","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7963/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7963/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7963/events","html_url":"https://github.com/elastic/elasticsearch/issues/7963","id":44706615,"node_id":"MDU6SXNzdWU0NDcwNjYxNQ==","number":7963,"title":"Elastic restart breaks search","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2014-10-02T16:18:43Z","updated_at":"2014-10-14T00:18:57Z","closed_at":"2014-10-10T11:42:36Z","author_association":"NONE","active_lock_reason":null,"body":"If I start with a clean data directory and:\n1) start elastic\n2) create index\n3) configure mapping\n4) index documents\n5) search (details below) \nI get the one result that I expect.\n\nIf I then stop and restart elastic and re-execute the same search, I get zero results (for my search).\n\nTheres probably something peculiar about the the mapping & the query I am executing, but the behaviour definitely changes after a restart.\n\nThe query I execute is:\n\n``` json\n{\n  \"from\" : 0,\n  \"size\" : 20,\n  \"query\" : {\n    \"filtered\" : {\n      \"query\" : {\n        \"match_all\" : { }\n      },\n      \"filter\" : {\n        \"and\" : {\n          \"filters\" : [ {\n            \"type\" : {\n              \"value\" : \"inventory\"\n            }\n          }, {\n            \"term\" : {\n              \"id\" : \"7774\"\n            }\n          } ]\n        }\n      }\n    }\n  }\n}\n```\n\nThe document looks something like:\n\n``` json\n{\n        \"brand\" : \"HAL\",\n        \"commodity\" : \"Aluminium\",\n        \"counterParty\" : \"Acme Aloominem Company\",\n        \"counterPartyCode\" : \"ACME\",\n        \"grade\" : \"99.7%\",\n        \"id\" : 7774,\n        \"indirectTaxRegion\" : null,\n        \"netGainLoss\" : 0.0000,\n        \"netGainLossUnitOfMeasure\" : \"MT\"\n      }\n```\n\nThe \"id\" is actually the id of the document.\nThe type is \"inventory\"\n\nMy index mappings are :\n\n``` json\n{\n  \"myindex\" : {\n    \"mappings\" : {\n      \"inventory\" : {\n        \"index_analyzer\" : \"default_index\",\n        \"search_analyzer\" : \"default_search\",\n        \"_all\" : {\n          \"auto_boost\" : true\n        },\n        \"properties\" : {\n          \"id\" : {\n            \"type\" : \"long\",\n            \"include_in_all\" : false\n          },\n          \"counterPartyCode\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n        }\n      }\n    }\n  }\n}\n```\n\nThere are more mappings, but I have \n\nNow, I acknowledge that there are some pecularities or questions that might arise:\nQ: \"Why are you using a term query using \"7774\" (ie string) instead of 7774 for a numerical (long) field or why are you not instead using a get operation?\"\n\nA: I present a simplified API to the User Interface - which either does a text-search (google style search) on the _all field, or it does an exact match on a given field. It just so happens that we pass Strings around - hence the string in the term query instead of a number.\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}