[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266435877","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-266435877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":266435877,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NjQzNTg3Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-12-12T13:52:54Z","updated_at":"2016-12-12T13:54:12Z","author_association":"MEMBER","body":"+1\r\n\r\nIn general Netty needs some love with respect to handling the security manager correctly so we'll have some work to do here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267838241","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-267838241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":267838241,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzgzODI0MQ==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2016-12-18T18:42:48Z","updated_at":"2016-12-18T18:47:00Z","author_association":"CONTRIBUTOR","body":"I've been able to make the modifications to netty necessary to move the \"accept\" permission to the transport plugin and get the transport and core tests passing (with creation of a mocksocket jar).\r\n\r\nI've had some issues with the azure plugin. That plugin uses com.sun.net.httpserver.HttpsServer for running some tests. it appears to me that HttpsServer is not calling doPriviledge when accepting connections.\r\n\r\n```\r\nif(!ServerImpl.this.terminating) { \r\n    SocketChannel var5 = ServerImpl.this.schan.accept();\r\n     if(ServerConfig.noDelay()) { \r\n        var5.socket().setTcpNoDelay(true); \r\n    }  \r\n    if(var5 != null) {\r\n         var5.configureBlocking(false);\r\n         SelectionKey var6 = var5.register(ServerImpl.this.selector, 1);\r\n         var7 = new HttpConnection();\r\n         var7.selectionKey = var6; \r\n        var7.setChannel(var5); \r\n        var6.attach(var7);\r\n         ServerImpl.this.requestStarted(var7); \r\n        ServerImpl.this.allConnections.add(var7);\r\n     } \r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267912583","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-267912583","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":267912583,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzkxMjU4Mw==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-12-19T08:54:54Z","updated_at":"2016-12-19T08:54:54Z","author_association":"CONTRIBUTOR","body":"@tbrooks8  amazing progress, would you mind linking the netty PRs / issues with this issue so we can track them. Also for all core changes can you make sure you open smallish PRs if possible?\r\n\r\n> I've had some issues with the azure plugin. That plugin uses com.sun.net.httpserver.HttpsServer for running some tests. it appears to me that HttpsServer is not calling doPriviledge when accepting connections.\r\n\r\nthat is super annoying. I am not 100% sure what we can do about this, I think first of all we gotta fix it in the JDK such that down the road we can remove whatever hack we add here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268068580","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-268068580","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":268068580,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODA2ODU4MA==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2016-12-19T20:24:36Z","updated_at":"2016-12-19T20:24:36Z","author_association":"CONTRIBUTOR","body":"I push the work that I have completed on the mocksocket here:\r\n\r\nhttps://github.com/elastic/mocksocket\r\n\r\nI have opened a Netty PR (netty/netty#6146)\r\n\r\nI will start making PRs to ES as I split up the work.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268187384","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-268187384","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":268187384,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODE4NzM4NA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-12-20T08:46:16Z","updated_at":"2016-12-20T08:46:16Z","author_association":"CONTRIBUTOR","body":"cool stuff - can you make the `https://github.com/elastic/mocksocket` repo public I don't think think there is anything private about this! :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268368515","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-268368515","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":268368515,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODM2ODUxNQ==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2016-12-20T21:46:08Z","updated_at":"2016-12-20T21:46:39Z","author_association":"CONTRIBUTOR","body":"I have opened a PR to integrate mocksocket into ElasticSearch. And replace raw usages of Sockets and ServerSockets in the ES tests.\r\n\r\n#22287","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268654126","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-268654126","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":268654126,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODY1NDEyNg==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2016-12-21T22:05:37Z","updated_at":"2017-01-23T01:24:37Z","author_association":"CONTRIBUTOR","body":"Based on the discussion in the status meeting today, I investigated applying permissions based on files opposed to a separate jar.\r\n\r\nSo I migrated `accept` out of the core security policy. And placed the following the in test-framework.policy:\r\n\r\n```\r\ngrant codeBase \"file:/path/to/elastic/elasticsearch/test/framework/build-idea/classes/test/\" {\r\n  permission java.net.SocketPermission \"*\", \"accept,resolve,connect\";\r\n };\r\n\r\ngrant codeBase \"file:/path/to/elastic/elasticsearch/test/framework/build-idea/classes/main/\" {\r\n   permission java.net.SocketPermission \"*\", \"accept,resolve,connect\";\r\n };\r\n```\r\n\r\nWith that change, any tests involving the `MockTCPTransport` passed. (Although the netty transport tests failed as they were not given permission.)\r\n\r\nThis approach seems to provide a way forward. Although my approach is certainly naive and hardcoded.\r\n\r\nI'm not immediately clear on what approach to take in order to make this solution robust. I see that we currently [parse the classpath and build up some system properties](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/bootstrap/Security.java#L194). Currently this works pretty well for jars. However, in the case of our code it is constantly rewriting the `codebase.main` and `codebase.test` system properties.\r\n\r\nSo when you run the \"core\" tests the following codebases are parsed:\r\n\r\n```\r\nfile:/path/to/elastic/elasticsearch/core/build-idea/classes/test/\r\nfile:/path/to/elastic/elasticsearch/core/build-idea/classes/main/\r\nfile:/path/to/elastic/elasticsearch/test/framework/build-idea/classes/main/\r\nfile:/path/to/elastic/elasticsearch/client/rest/build-idea/classes/main/\r\n```\r\n\r\nAnd for discovery-azure-classic plugin tests:\r\n\r\n```\r\nfile:/path/to/elastic/elasticsearch/plugins/discovery-azure-classic/build-idea/classes/test/\r\nfile:/path/to/elastic/elasticsearch/plugins/discovery-azure-classic/build-idea/classes/main/\r\nfile:/path/to/elastic/elasticsearch/plugins/discovery-azure-classic/build-idea/generated-resources/\r\nfile:/path/to/elastic/elasticsearch/core/build-idea/classes/main/\r\nfile:/path/to/elastic/elasticsearch/test/framework/build-idea/classes/main/\r\nfile:/path/to/elastic/elasticsearch/client/rest/build-idea/classes/main/\r\n```\r\n\r\nOur method of parsing the \"shortName\" means that the property will be `codebase.test`, `codebase.main`, or `codebase.generated-source`. And whichever one is parsed last \"wins\".\r\n\r\nI could work on implementing proper handling of this. Such as parsing these into:\r\n- `codebase.core.main`\r\n- `codebase.core.test`\r\n- `codebase.test.framework.main`\r\n- `codebase.test.framework.test`\r\n- `codebase.plugins.discovery-azure-classic.main`\r\n- `codebase.plugins.discovery-azure-classic.test`\r\n\r\nThose system properties could be accessed in security policy files to give certain packages permissions. \r\n\r\nMaybe this is not the easiest way forward? It's entirely possible that I missing a better way of doing this.\r\n\r\nAlso - I'm not sure what implications those changes would have for the distribution (when all the packages / modules are different jars).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268772176","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-268772176","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":268772176,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODc3MjE3Ng==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-12-22T10:34:52Z","updated_at":"2016-12-22T10:34:52Z","author_association":"CONTRIBUTOR","body":"++ this sounds like a plan @tbrooks8 \r\n\r\n> Also - I'm not sure what implications those changes would have for the distribution (when all the packages / modules are different jars).\r\n\r\nI think that will be fine since we don't use this in distribution. Our tests will catch if something is wrong since they use the real zip / tar.gz","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269269119","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-269269119","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":269269119,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTI2OTExOQ==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2016-12-27T04:44:17Z","updated_at":"2016-12-27T04:44:17Z","author_association":"CONTRIBUTOR","body":"I've spiked on this [here](https://github.com/tbrooks8/elasticsearch/commit/a100ea87dd1b0eed85eb078fdc694ad1156b4815#diff-3be67d43cef62609fb9f591011401559R198).\r\n\r\nI've been learning more about the `SecurityManager` and it seems that creating a `new Thread` inherits the permissions from where the thread was created. So giving \"discovery-azure-classic\" `SocketPermission` and wrapping https `start` in `doPrivileged {}` with proper permissions for  discovery-azure-classic works.\r\n\r\n```\r\nAccessController.doPrivileged((PrivilegedExceptionAction<Void>) () -> {\r\n            httpsServer.start();\r\n            httpServer.start();\r\n            return null;\r\n        });\r\n```\r\ncombined with:\r\n\r\n```\r\ngrant codeBase \"${codebase.elasticsearch.plugins.discovery-azure-classic.test}\" {\r\n  permission java.net.SocketPermission \"*\", \"accept,connect,resolve\";\r\n};\r\n\r\ngrant codeBase \"${codebase.elasticsearch.plugins.discovery-ec2.test}\" {\r\n  permission java.net.SocketPermission \"*\", \"accept,connect,resolve\";\r\n};\r\n\r\ngrant codeBase \"${codebase.elasticsearch.plugins.discovery-gce.test}\" {\r\n  permission java.net.SocketPermission \"*\", \"accept,connect,resolve\";\r\n};\r\n```\r\n\r\nallows all of the tests for those packages to pass.\r\n\r\nThere are a few things about this that are kind of ugly. If you run the tests in an IDE (like IntelliJ) the main classes remain in directories. If you run the tests using Gradle the main classes are placed in an JAR. This means that for test \"framework\" you must use two permissions for `MockTCPTransport` to work.\r\n\r\n```\r\ngrant codeBase \"${codebase.elasticsearch.test.framework.main}\" {\r\n  permission java.net.SocketPermission \"*\", \"accept,connect,resolve\";\r\n};\r\n\r\ngrant codeBase \"${codebase.framework-6.0.0-alpha1-SNAPSHOT.jar}\" {\r\n  permission java.net.SocketPermission \"*\", \"accept,connect,resolve\";\r\n};\r\n```\r\n\r\nI think that tomorrow I should explore moving the starting of the HTTPS and HTTP servers to the MockSocket JAR. And if that works then we should still be able to isolate all `SocketPermission` to that JAR for test packages. And avoid scattering `SocketPermission` to many different packages (framework main, framework test, ec2 test, azure test, etc).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269424765","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-269424765","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":269424765,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTQyNDc2NQ==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2016-12-28T04:41:23Z","updated_at":"2016-12-28T04:41:23Z","author_association":"CONTRIBUTOR","body":"Updates:\r\n\r\n1. I updated #22287 with changes to mocksocket that include wrapping the http/https servers.\r\n2. I pushed mocksocket to MavenCentral.\r\n3. I worked on integrating the netty snapshot based on my PR on this [branch](https://github.com/tbrooks8/elasticsearch/tree/integrate_netty_updates). With the netty snapshot + mocksocket PR, when I move the `accept` permissions out of core and to just netty/mocksocket the elasticsearch test suite passes.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269696228","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-269696228","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":269696228,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTY5NjIyOA==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2016-12-29T21:28:25Z","updated_at":"2016-12-29T21:31:35Z","author_association":"CONTRIBUTOR","body":"I've started exploring what is involved in removing `connect` and `resolve` from core.\r\n\r\nHere are some preliminary findings:\r\n\r\n1. `NetworkUtils` makes the following call that requires connect:\r\n- `NetworkInterface.getInetAddresses()`\r\n2. `MacAddressProvider` makes the following call that requires connect:\r\n- `NetworkInterface.getHardwareAddress()`\r\n3. `IfConfig` uses these two calls when logging.\r\n\r\nSo maybe these classes (or some of the code) will need to be moved to a dependency? Or something else?\r\n\r\nAs Simon pointed out various plugins (ec2, etc) will need permissions granted to a number of their dependencies (EC2Client, etc). I have not figured out complete lists of these yet.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270079287","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270079287","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270079287,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDA3OTI4Nw==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-01-03T09:48:51Z","updated_at":"2017-01-03T09:48:51Z","author_association":"CONTRIBUTOR","body":"`NetworkInterface.getInetAddresses()` & `NetworkInterface.getHardwareAddress()` supports the `getNetworkInformation` permission I think we should grant this to get rid of one of the problems.\r\n\r\nFor `IfConfig.logIfNecessary();` I wonder if we can move it into bootstrap instead then we can log it before we initialize the security manager? @jasontedor WDYT?\r\n\r\n> As Simon pointed out various plugins (ec2, etc) will need permissions granted to a number of their dependencies (EC2Client, etc). I have not figured out complete lists of these yet.\r\n\r\nyeah I think all the repositories need resolve an connect granted. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270773638","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270773638","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270773638,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDc3MzYzOA==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-05T22:16:27Z","updated_at":"2017-01-05T22:16:47Z","author_association":"CONTRIBUTOR","body":"@s1monw  I do not know if moving `IfConfig.logIfNecessary();` to bootstrap was decided on as the correct option, but I opened a PR with that work.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270825612","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270825612","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270825612,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDgyNTYxMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T03:55:05Z","updated_at":"2017-01-06T03:55:05Z","author_association":"MEMBER","body":"> For `IfConfig.logIfNecessary();` I wonder if we can move it into bootstrap instead then we can log it before we initialize the security manager? @jasontedor WDYT?\r\n\r\n+1","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270827115","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270827115","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270827115,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDgyNzExNQ==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T04:09:44Z","updated_at":"2017-01-06T17:39:02Z","author_association":"CONTRIBUTOR","body":"As a quick update - it does appear that if I grant permissions to a plugin, that does successfully grant permissions to all of the dependency jars. So after I add the `doPrivilege` blocks the plugins (ec2, gce, etc) should work.\r\n\r\nHowever, I identified a few other issues. In two places in core we currently need connect/resolve. In `NetworkService` ([here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/common/network/NetworkService.java#L266)) and `TcpTransport` ([here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/transport/TcpTransport.java#L822)).\r\n\r\nThoughts? Maybe this is similar to the `URLRepository` issue you originally identified?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270862571","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270862571","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270862571,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDg2MjU3MQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T09:15:39Z","updated_at":"2017-01-06T09:15:39Z","author_association":"CONTRIBUTOR","body":"> However, I identified a few other issues. In two places in core we currently need connect/resolve. In NetworkService (here) and TcpTransport (here).\r\n\r\nhmm I am starting to think maybe removing `connect, resolve` is too ambiguous. I don't think it's worth adding a specific jar we depend on to grant this permission so I wonder if we should stick with `accept` for now? @jasontedor  WDYT?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270954615","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270954615","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270954615,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk1NDYxNQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T17:21:20Z","updated_at":"2017-01-06T17:21:20Z","author_association":"MEMBER","body":"> However, I identified a few other issues. In two places in core we currently need connect/resolve. In `NetworkService` ([here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/common/network/InetAddresses.java#L352)) and `TcpTransport` ([here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/transport/TcpTransport.java#L822)).\r\n\r\n@tbrooks8 I think your first link here is not right? At least, I don't think what you link to needs permissions.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270956332","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270956332","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270956332,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk1NjMzMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T17:29:02Z","updated_at":"2017-01-06T17:29:02Z","author_association":"MEMBER","body":"I'm not sure @s1monw, I wonder if we can just add logic to `SecureSM` to handle these permissions the way that we want to (similar to how we handle `System#exit`). We already have a separate jar for this. Thoughts?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270958474","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270958474","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270958474,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk1ODQ3NA==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T17:38:46Z","updated_at":"2017-01-06T17:38:46Z","author_association":"CONTRIBUTOR","body":"@jasontedor I meant https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/common/network/NetworkService.java#L266","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270959042","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270959042","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270959042,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk1OTA0Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T17:41:15Z","updated_at":"2017-01-06T17:41:15Z","author_association":"MEMBER","body":"@tbrooks8 Okay, thanks for clarifying. That will require `resolve`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270959399","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270959399","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270959399,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk1OTM5OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T17:42:51Z","updated_at":"2017-01-06T17:43:00Z","author_association":"MEMBER","body":"Aren't both of the places that you link to only requiring `resolve`? I'm okay with `resolve`, it's `connect` that might be worth jumping through hoops for. Can you confirm @tbrooks8?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270963473","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270963473","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270963473,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk2MzQ3Mw==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T18:00:21Z","updated_at":"2017-01-06T18:00:21Z","author_association":"CONTRIBUTOR","body":"It looks to me that InetAddress.getAllByName(host) will only require resolve.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270964137","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-270964137","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":270964137,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk2NDEzNw==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T18:03:10Z","updated_at":"2017-01-06T18:03:48Z","author_association":"CONTRIBUTOR","body":"Inside `InetAddress.getAllByName0`:\r\n\r\n```\r\n if (check) {\r\n    SecurityManager security = System.getSecurityManager();\r\n    if (security != null) {\r\n        security.checkConnect(host, -1);\r\n    }\r\n}\r\n```\r\n\r\nWhich calls `SecurityManager.checkConnect`:\r\n\r\n```\r\npublic void checkConnect(String host, int port) {\r\n        if (host == null) {\r\n            throw new NullPointerException(\"host can't be null\");\r\n        }\r\n        if (!host.startsWith(\"[\") && host.indexOf(':') != -1) {\r\n            host = \"[\" + host + \"]\";\r\n        }\r\n        if (port == -1) {\r\n            checkPermission(new SocketPermission(host,\r\n                SecurityConstants.SOCKET_RESOLVE_ACTION));\r\n        } else {\r\n            checkPermission(new SocketPermission(host+\":\"+port,\r\n                SecurityConstants.SOCKET_CONNECT_ACTION));\r\n        }\r\n    }\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271212329","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-271212329","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":271212329,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTIxMjMyOQ==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-09T05:10:53Z","updated_at":"2017-01-09T05:10:53Z","author_association":"CONTRIBUTOR","body":"I explored Jason's thought quite a bit on Friday. It appears that moving connect to the plugins (and netty) and leaving resolve in core should be a viable strategy. \r\n\r\nI'm working on a PR to put `doPrivileged` blocks in the ec2, gce, and azure plugins.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271219921","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-271219921","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":271219921,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTIxOTkyMQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-01-09T06:45:08Z","updated_at":"2017-01-09T06:45:08Z","author_association":"CONTRIBUTOR","body":"cool thx for the update","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271638352","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-271638352","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":271638352,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTYzODM1Mg==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-10T17:21:05Z","updated_at":"2017-01-10T17:21:05Z","author_association":"CONTRIBUTOR","body":"I opened #22534 to wrap the `connect` operations in plugins.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272310791","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-272310791","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":272310791,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjMxMDc5MQ==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-12T22:57:57Z","updated_at":"2017-01-12T22:57:57Z","author_association":"CONTRIBUTOR","body":"- I opened PR #22572 that should remove a netty release as a blocker for migrating accept and connect.\r\n- I have investigated URLRepository and it does not appear to me that class makes socket connections (some of its plugin subclasses do, but I'm dealing with that in the plugin changes). Let me know if I am incorrect about that. \r\n- I opened PR #22603 to wrap connect operations in the rest client in doPrivileged. This is necessary for modules such as reindex.\r\n- @jasontedor has suggested that we add a permission like SpecialPermission(\"connect\") for socket specific permissions in ES. Maybe this is a new issue or task?\r\n- @s1monw suggested in PR #22534 that we leverage forbidden APIs to detect improper connect calls. Maybe this is another task for this issue?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272456001","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-272456001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":272456001,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjQ1NjAwMQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-01-13T14:31:28Z","updated_at":"2017-01-13T14:31:41Z","author_association":"CONTRIBUTOR","body":">  have investigated URLRepository and it does not appear to me that class makes socket connections (some of its plugin subclasses do, but I'm dealing with that in the plugin changes). Let me know if I am incorrect about that.\r\n\r\nthis might happen [here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobContainer.java#L105)?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272467902","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-272467902","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":272467902,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjQ2NzkwMg==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-13T15:19:57Z","updated_at":"2017-01-13T15:19:57Z","author_association":"CONTRIBUTOR","body":"Yep. I agree that looks like a connect. Thanks. I must of missed that.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/273675490","html_url":"https://github.com/elastic/elasticsearch/issues/22116#issuecomment-273675490","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22116","id":273675490,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MzY3NTQ5MA==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2017-01-19T03:53:17Z","updated_at":"2017-01-19T03:53:17Z","author_association":"CONTRIBUTOR","body":"I've looked into what is involved in moving `URLRepository` to a module. It looks pretty straightforward to me to move just `URLRepository`.\r\n\r\n@s1monw suggested that I move both of the core `Repository` classes (`URLRepository` and `FsRepository`). Unfortunately moving `FsRepository` looks more complicated. `MockRepository` extends `FsRepository`. The following core tests use `MockRepository`:\r\n\r\n- `BlobStoreFormatIT`\r\n- `DedicatedClusterSnapshotRestoreIT`\r\n- `MinThreadsSnapshotRestoreIT`\r\n- `RepositoriesIT`\r\n- `RepositoryUpgradabilityIT`\r\n- `RestoreBackwardsCompatIT`\r\n- `SharedClusterSnapshotRestoreIT`\r\n\r\nAnd the functionality seems to depend on `FsBlobStore` and `FsBlobContainer` (so the super class cannot simply be removed). \r\n\r\nI guess there are a couple of options:\r\n- Those tests be moved to the new repositories module\r\n- `MockRepository` be modified to stand alone without the `FSRepository` components. (Also maybe `MockRepository` should be moved to `test.framework` opposed to `core-tests`?)\r\n- Those tests be moved to an external qa package that depends on both `core` and `repositories`.\r\n- Some combination of the above? \r\n\r\nAlso - should this be completed in multiple PRs? Like an initial PR that moves `URLRepository` to modules that unblocks SocketPermission work. And then another issue/PR to tackle the moving `FSRepository`?","performed_via_github_app":null}]