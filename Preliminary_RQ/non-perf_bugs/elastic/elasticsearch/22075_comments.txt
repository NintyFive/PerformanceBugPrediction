[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266018012","html_url":"https://github.com/elastic/elasticsearch/issues/22075#issuecomment-266018012","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22075","id":266018012,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NjAxODAxMg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-12-09T13:50:17Z","updated_at":"2016-12-09T13:50:17Z","author_association":"MEMBER","body":"Can you add the exception you are seeing and if possible also the java code you use when this happens?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266030811","html_url":"https://github.com/elastic/elasticsearch/issues/22075#issuecomment-266030811","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22075","id":266030811,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NjAzMDgxMQ==","user":{"login":"muteri","id":24272054,"node_id":"MDQ6VXNlcjI0MjcyMDU0","avatar_url":"https://avatars3.githubusercontent.com/u/24272054?v=4","gravatar_id":"","url":"https://api.github.com/users/muteri","html_url":"https://github.com/muteri","followers_url":"https://api.github.com/users/muteri/followers","following_url":"https://api.github.com/users/muteri/following{/other_user}","gists_url":"https://api.github.com/users/muteri/gists{/gist_id}","starred_url":"https://api.github.com/users/muteri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muteri/subscriptions","organizations_url":"https://api.github.com/users/muteri/orgs","repos_url":"https://api.github.com/users/muteri/repos","events_url":"https://api.github.com/users/muteri/events{/privacy}","received_events_url":"https://api.github.com/users/muteri/received_events","type":"User","site_admin":false},"created_at":"2016-12-09T14:48:13Z","updated_at":"2016-12-09T14:48:36Z","author_association":"NONE","body":"The exception is :\r\n\r\n```\r\norg.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onFirstPhaseResult(AbstractSearchAsyncAction.java:204) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:139) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:51) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:984) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1091) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1069) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.DelegatingTransportChannel.sendResponse(DelegatingTransportChannel.java:68) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry$TransportChannelWrapper.sendResponse(RequestHandlerRegistry.java:123) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.lambda$messageReceived$0(SecurityServerTransportInterceptor.java:197) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.lambda$messageReceived$1(SecurityServerTransportInterceptor.java:210) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:109) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.lambda$messageReceived$2(SecurityServerTransportInterceptor.java:246) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:53) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$null$0(ServerTransportFilter.java:135) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:131) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:125) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:113) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$inbound$1(ServerTransportFilter.java:137) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:53) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$0(AuthenticationService.java:180) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$2(AuthenticationService.java:199) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:211) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:178) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:140) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:112) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.inbound(ServerTransportFilter.java:131) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:253) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:577) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:527) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_74]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_74]\r\n\tat java.lang.Thread.run(Thread.java:745) ~[na:1.8.0_74]\r\nCaused by: org.elasticsearch.transport.RemoteTransportException: [instance-0000000002][10.74.160.66:19642][indices:data/read/search[phase/query]]\r\nCaused by: org.elasticsearch.index.query.QueryShardException: No mapping found for [_score] in order to sort on\r\n\tat org.elasticsearch.search.sort.FieldSortBuilder.build(FieldSortBuilder.java:262) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.search.sort.SortBuilder.buildSort(SortBuilder.java:156) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:709) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:553) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:529) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:264) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:300) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:297) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.lambda$messageReceived$1(SecurityServerTransportInterceptor.java:208) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:109) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.lambda$messageReceived$2(SecurityServerTransportInterceptor.java:246) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:53) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$null$0(ServerTransportFilter.java:135) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:131) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:125) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:113) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$inbound$1(ServerTransportFilter.java:137) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:53) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$0(AuthenticationService.java:180) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$2(AuthenticationService.java:199) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:211) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:178) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:140) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:112) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.inbound(ServerTransportFilter.java:131) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:253) ~[x-pack-api-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:577) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:527) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_74]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_74]\r\n\tat java.lang.Thread.run(Thread.java:745) ~[na:1.8.0_74]\r\n```\r\n\r\nYou can use this sample code to reproduce :\r\n\r\n`SearchRequestBuilder builder = client.prepareSearch(\"g_contents\").setVersion(true);\r\n\r\n\t\tbuilder.setTypes(\"g_content\");\r\n\r\n\t\tHighlightBuilder highlightBuilder = new HighlightBuilder().field(\"fulltext.indexed_text\", 75, 3);\r\n\t\thighlightBuilder.requireFieldMatch(false);\r\n\t\tbuilder.highlighter(highlightBuilder);\r\n\t\tbuilder.setTrackScores(true);\r\n\r\n\t\tBoolQueryBuilder filteredQuery = QueryBuilders.boolQuery();\r\n\t\tfilteredQuery.should(QueryBuilders.termQuery(\"_all\", \"day\"));\r\n\r\n\t\tbuilder.setQuery(filteredQuery);\r\n\r\n\t\tbuilder.setExplain(false);\r\n\r\n\t\tbuilder.setFrom(0).setSize(100);\r\n\r\n\r\n\t\tSortBuilder sb = SortBuilders.fieldSort(\"_score\");\r\n\t\tsb.order(SortOrder.DESC);\r\n\t\tbuilder.addSort(sb);\r\n\r\n\r\n\t\tSearchResponse searchResponse;\r\n\r\n\t\tsearchResponse = builder.get();`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266034615","html_url":"https://github.com/elastic/elasticsearch/issues/22075#issuecomment-266034615","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22075","id":266034615,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NjAzNDYxNQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-12-09T15:03:29Z","updated_at":"2016-12-09T15:03:29Z","author_association":"MEMBER","body":"`SortBuilder sb = SortBuilders.fieldSort(\"_score\");`\r\n\r\n@muteri the problem here is you are trying to sort on a field called \"_score\" which doesn't exist in your document (not the `_score` field in the search respone). You should use `SortBuilder sb = SortBuilders.scoreSort();` to get a `ScoreSortBuilder` that is specialized for that. When using the `SearchRequest#addSort(field, SortOrder)\" like you mentioned above we check the field name, recognize its a \"special\" field and use the ScoreSortBuilder. When you explicitely specify a field score sorting we assume you use a document field name, hence the problem you are seeing. Can you check if this if this solves your problem?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267349213","html_url":"https://github.com/elastic/elasticsearch/issues/22075#issuecomment-267349213","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22075","id":267349213,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzM0OTIxMw==","user":{"login":"muteri","id":24272054,"node_id":"MDQ6VXNlcjI0MjcyMDU0","avatar_url":"https://avatars3.githubusercontent.com/u/24272054?v=4","gravatar_id":"","url":"https://api.github.com/users/muteri","html_url":"https://github.com/muteri","followers_url":"https://api.github.com/users/muteri/followers","following_url":"https://api.github.com/users/muteri/following{/other_user}","gists_url":"https://api.github.com/users/muteri/gists{/gist_id}","starred_url":"https://api.github.com/users/muteri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muteri/subscriptions","organizations_url":"https://api.github.com/users/muteri/orgs","repos_url":"https://api.github.com/users/muteri/repos","events_url":"https://api.github.com/users/muteri/events{/privacy}","received_events_url":"https://api.github.com/users/muteri/received_events","type":"User","site_admin":false},"created_at":"2016-12-15T15:03:23Z","updated_at":"2016-12-15T15:03:23Z","author_association":"NONE","body":"@cbuescher sorry for the delayed answer, you're right the issue was coming from \"_score\". With .scoreSort() everything works fine. Thanks a lot.\r\n","performed_via_github_app":null}]