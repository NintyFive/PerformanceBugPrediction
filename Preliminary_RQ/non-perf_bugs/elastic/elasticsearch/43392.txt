{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43392","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43392/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43392/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43392/events","html_url":"https://github.com/elastic/elasticsearch/issues/43392","id":458195473,"node_id":"MDU6SXNzdWU0NTgxOTU0NzM=","number":43392,"title":"StableMasterDisruptionIT.testStaleMasterNotHijackingMajority failing in CI","user":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2019-06-19T19:47:40Z","updated_at":"2019-06-24T10:02:27Z","closed_at":"2019-06-24T10:02:27Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In the last 6 days (since about June 13), there's been an uptick in failures pertaining to this test case. \r\n\r\nThe offending assertion looks like its:\r\n\r\n```java\r\n        // Wait for majority side to elect a new master\r\n        assertBusy(() -> {\r\n            for (final Map.Entry<String, List<Tuple<String, String>>> entry : masters.entrySet()) {\r\n                final List<Tuple<String, String>> transitions = entry.getValue();\r\n                assertTrue(entry.getKey() + \": \" + transitions,\r\n                    transitions.stream().anyMatch(transition -> transition.v2() != null));\r\n            }\r\n        });\r\n```\r\n\r\nFailing with: \r\n\r\n```\r\norg.elasticsearch.discovery.StableMasterDisruptionIT > testStaleMasterNotHijackingMajority FAILED\r\n--\r\njava.lang.AssertionError: node_t2: [Tuple [v1=node_t1, v2=null]]\r\nat __randomizedtesting.SeedInfo.seed([C5E917ABBDEFB99F:9AEF5AA49C346693]:0)\r\nat org.junit.Assert.fail(Assert.java:88)\r\nat org.junit.Assert.assertTrue(Assert.java:41)\r\nat org.elasticsearch.discovery.StableMasterDisruptionIT.lambda$testStaleMasterNotHijackingMajority$5(StableMasterDisruptionIT.java:226)\r\nat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:874)\r\nat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:848)\r\nat org.elasticsearch.discovery.StableMasterDisruptionIT.testStaleMasterNotHijackingMajority(StableMasterDisruptionIT.java:223)\r\nREPRODUCE WITH: ./gradlew :server:integTest --tests \"org.elasticsearch.discovery.StableMasterDisruptionIT.testStaleMasterNotHijackingMajority\" -Dtests.seed=C5E917ABBDEFB99F -Dtests.security.manager=true -Dtests.locale=en-GY -Dtests.timezone=SystemV/MST7MDT -Dcompiler.java=12 -Druntime.java=11\r\n```\r\n\r\nGradle Scan from 13th: https://scans.gradle.com/s/tfwcqwg266oam\r\nScan from today: https://scans.gradle.com/s/2edje7yces7zc","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}