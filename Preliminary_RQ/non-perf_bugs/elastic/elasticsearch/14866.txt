{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14866","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14866/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14866/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14866/events","html_url":"https://github.com/elastic/elasticsearch/issues/14866","id":117876902,"node_id":"MDU6SXNzdWUxMTc4NzY5MDI=","number":14866,"title":"Bulk items fail due to TranslogException via ClosedChannelException","user":{"login":"whitfin","id":5376378,"node_id":"MDQ6VXNlcjUzNzYzNzg=","avatar_url":"https://avatars0.githubusercontent.com/u/5376378?v=4","gravatar_id":"","url":"https://api.github.com/users/whitfin","html_url":"https://github.com/whitfin","followers_url":"https://api.github.com/users/whitfin/followers","following_url":"https://api.github.com/users/whitfin/following{/other_user}","gists_url":"https://api.github.com/users/whitfin/gists{/gist_id}","starred_url":"https://api.github.com/users/whitfin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/whitfin/subscriptions","organizations_url":"https://api.github.com/users/whitfin/orgs","repos_url":"https://api.github.com/users/whitfin/repos","events_url":"https://api.github.com/users/whitfin/events{/privacy}","received_events_url":"https://api.github.com/users/whitfin/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2015-11-19T18:27:42Z","updated_at":"2018-02-13T19:39:35Z","closed_at":"2015-11-26T13:47:38Z","author_association":"NONE","active_lock_reason":null,"body":"We recently made the jump to start testing ES 2.0 against our codebase, which was pretty straightforward with only a couple of changes on the Query DSL.\n\nHowever, once we put this into our test environment, we see constant streams of this (please note I have removed sensitive information, such as source, index and type):\n\n```\n[2015-11-19 18:21:10,865][DEBUG][action.bulk              ] [La Nuit] [pem:2015:47][5] failed to execute bulk item (index) index {[my-index][my-type][3279b5669abaf1458583678b37bbf2a2], source[{\"my-source\":true}]}\n[my-index][[my-index][5]] TranslogException[Failed to write operation [Index{id='3279b5669abaf1458583678b37bbf2a2', type='my-type'}]]; nested: ClosedChannelException;\n    at org.elasticsearch.index.translog.Translog.add(Translog.java:497)\n    at org.elasticsearch.index.engine.InternalEngine.innerIndex(InternalEngine.java:532)\n    at org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:447)\n    at org.elasticsearch.index.shard.IndexShard.index(IndexShard.java:556)\n    at org.elasticsearch.index.engine.Engine$Index.execute(Engine.java:815)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction.executeIndexRequestOnPrimary(TransportReplicationAction.java:1073)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardIndexOperation(TransportShardBulkAction.java:338)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:131)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.performOnPrimary(TransportReplicationAction.java:579)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase$1.doRun(TransportReplicationAction.java:452)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.nio.channels.ClosedChannelException\n    at sun.nio.ch.FileChannelImpl.ensureOpen(FileChannelImpl.java:110)\n    at sun.nio.ch.FileChannelImpl.write(FileChannelImpl.java:199)\n    at org.elasticsearch.common.io.Channels.writeToChannel(Channels.java:206)\n    at org.elasticsearch.index.translog.BufferingTranslogWriter.flush(BufferingTranslogWriter.java:75)\n    at org.elasticsearch.index.translog.BufferingTranslogWriter.add(BufferingTranslogWriter.java:62)\n    at org.elasticsearch.index.translog.Translog.add(Translog.java:489)\n    ... 13 more\n```\n\nThis is a pretty constant thing, and there seems to be nothing around about what might cause it. All of our ES settings are pretty much the defaults, and we haven't (deliberately) changed anything between versions. \n\nIs there some change in ES 2.0 which might explain the above, such as maybe tweaking default thread counts for bulk (etc)? If so, where would I start looking to resolve this exception?\n\nIf I had to guess at the rate of failure, I'd say that `> 50%` of bulk items receive this error. \n\nI'm not sure if this is related, but this is also showing up inside the logs; perhaps something regarding indexing is badly configured?\n\n```\n[2015-11-19 18:21:48,456][WARN ][indices.memory           ] [La Nuit] failed to set shard [my-index][4] index buffer to [309.3mb]\n```\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}