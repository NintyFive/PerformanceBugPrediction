{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26872","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26872/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26872/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26872/events","html_url":"https://github.com/elastic/elasticsearch/issues/26872","id":262588762,"node_id":"MDU6SXNzdWUyNjI1ODg3NjI=","number":26872,"title":"AccessControlException Despite plugin-security.policy","user":{"login":"varunsharma27","id":18154526,"node_id":"MDQ6VXNlcjE4MTU0NTI2","avatar_url":"https://avatars1.githubusercontent.com/u/18154526?v=4","gravatar_id":"","url":"https://api.github.com/users/varunsharma27","html_url":"https://github.com/varunsharma27","followers_url":"https://api.github.com/users/varunsharma27/followers","following_url":"https://api.github.com/users/varunsharma27/following{/other_user}","gists_url":"https://api.github.com/users/varunsharma27/gists{/gist_id}","starred_url":"https://api.github.com/users/varunsharma27/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/varunsharma27/subscriptions","organizations_url":"https://api.github.com/users/varunsharma27/orgs","repos_url":"https://api.github.com/users/varunsharma27/repos","events_url":"https://api.github.com/users/varunsharma27/events{/privacy}","received_events_url":"https://api.github.com/users/varunsharma27/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-10-03T21:13:55Z","updated_at":"2017-10-03T21:16:09Z","closed_at":"2017-10-03T21:16:09Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Elasticsearch Version: 5.4.0\r\njava version \"1.8.0_131\"\r\n> java.security.AccessControlException: access denied (\"java.lang.RuntimePermission\" \"accessDeclaredMembers\")\r\n> \tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:472) ~[?:1.8.0_131]\r\n> \tat java.security.AccessController.checkPermission(AccessController.java:884) ~[?:1.8.0_131]\r\n> \tat java.lang.SecurityManager.checkPermission(SecurityManager.java:549) ~[?:1.8.0_131]\r\n> \tat java.lang.Class.checkMemberAccess(Class.java:2348) ~[?:1.8.0_131]\r\n> \tat java.lang.Class.getDeclaredConstructors(Class.java:2019) ~[?:1.8.0_131]\r\n> \tat com.fasterxml.jackson.databind.util.ClassUtil.getConstructors(ClassUtil.java:966) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.introspect.AnnotatedClass.resolveCreators(AnnotatedClass.java:443) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.introspect.AnnotatedClass.getStaticMethods(AnnotatedClass.java:314) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.introspect.BasicBeanDescription.getFactoryMethods(BasicBeanDescription.java:486) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.BasicDeserializerFactory._addDeserializerFactoryMethods(BasicDeserializerFactory.java:669) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.BasicDeserializerFactory._constructDefaultValueInstantiator(BasicDeserializerFactory.java:320) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.BasicDeserializerFactory.findValueInstantiator(BasicDeserializerFactory.java:253) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.BasicDeserializerFactory.createMapDeserializer(BasicDeserializerFactory.java:1159) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.DeserializerCache._createDeserializer2(DeserializerCache.java:377) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.DeserializerCache._createDeserializer(DeserializerCache.java:349) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCache2(DeserializerCache.java:264) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCacheValueDeserializer(DeserializerCache.java:244) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.deser.DeserializerCache.findValueDeserializer(DeserializerCache.java:142) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.DeserializationContext.findRootValueDeserializer(DeserializationContext.java:476) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.ObjectMapper._findRootDeserializer(ObjectMapper.java:3899) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.ObjectMapper._readValue(ObjectMapper.java:3765) ~[?:?]\r\n> \tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:2123) ~[?:?]\r\n> \tat com.fasterxml.jackson.core.JsonParser.readValueAs(JsonParser.java:1650) ~[jackson-core-2.8.6.jar:2.8.6]\r\n> \tat com.auth0.jwt.impl.JsonNodeClaim.asMap(JsonNodeClaim.java:109) ~[?:?]\r\n> \tat com.fico.elasticsearch.authenticate.accesscontrol.User.lambda$fetchRolesFromToken$0(User.java:23) ~[?:?]\r\n> \tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_131]\r\n\r\nCode :-\r\n\r\n>     Map<String, Object> someMap = AccessController.doPrivileged((PrivilegedAction<Map<String, Object>>) () -> {\r\n>       Map<String, Object> temp1 = ((Claim) token.getClaim(\"some_claim\")).asMap();\r\n>       return temp1 ;\r\n>     });\r\n\r\nHowever when I run this code before it, it doesn't get any error but mine does :-\r\n\r\n>     SecurityManager sm = System.getSecurityManager();\r\n>     if (sm != null) {\r\n>       // unprivileged code such as scripts do not have SpecialPermission\r\n>       sm.checkPermission(new SpecialPermission());\r\n>     } \r\n\r\nI do have\r\n\r\n>   permission java.lang.RuntimePermission \"accessDeclaredMembers\";\r\n\r\nIn my plugin-security.policy and other code which relies on \"accessDeclaredMembers\" works fine but this one doesn't.","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}