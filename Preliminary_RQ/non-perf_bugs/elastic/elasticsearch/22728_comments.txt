[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/274224749","html_url":"https://github.com/elastic/elasticsearch/issues/22728#issuecomment-274224749","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22728","id":274224749,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NDIyNDc0OQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-01-21T02:04:18Z","updated_at":"2017-01-21T02:04:18Z","author_association":"MEMBER","body":"I wonder if this should be done in core instead so no need to implement that for each plugin?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/274229896","html_url":"https://github.com/elastic/elasticsearch/issues/22728#issuecomment-274229896","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22728","id":274229896,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NDIyOTg5Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-01-21T03:16:36Z","updated_at":"2017-01-21T03:16:36Z","author_association":"MEMBER","body":"I think it is only needed for cloud services. If there is an error from the filesystem, we should fail. Cloud systems are designed with this type of throttling in mind, but filesystems are not.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/274249588","html_url":"https://github.com/elastic/elasticsearch/issues/22728#issuecomment-274249588","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22728","id":274249588,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NDI0OTU4OA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-01-21T09:02:26Z","updated_at":"2017-01-21T09:02:26Z","author_association":"MEMBER","body":"> Cloud systems are designed with this type of throttling in mind, but filesystems are not.\r\n\r\nYes you're absolutely right and I actually checked our code and I can see that Google Storage and AWS S3 sdks already provide this out of the box.\r\nI did not check Azure SDK yet but if not provided in the SDK itself then we can implement our own version.\r\n\r\nSo quoting myself:\r\n\r\n> I wonder if this should be done in core instead so no need to implement that for each plugin?\r\n\r\nNo. :) \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/274602055","html_url":"https://github.com/elastic/elasticsearch/issues/22728#issuecomment-274602055","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22728","id":274602055,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NDYwMjA1NQ==","user":{"login":"JeffreyZZ","id":7685299,"node_id":"MDQ6VXNlcjc2ODUyOTk=","avatar_url":"https://avatars3.githubusercontent.com/u/7685299?v=4","gravatar_id":"","url":"https://api.github.com/users/JeffreyZZ","html_url":"https://github.com/JeffreyZZ","followers_url":"https://api.github.com/users/JeffreyZZ/followers","following_url":"https://api.github.com/users/JeffreyZZ/following{/other_user}","gists_url":"https://api.github.com/users/JeffreyZZ/gists{/gist_id}","starred_url":"https://api.github.com/users/JeffreyZZ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JeffreyZZ/subscriptions","organizations_url":"https://api.github.com/users/JeffreyZZ/orgs","repos_url":"https://api.github.com/users/JeffreyZZ/repos","events_url":"https://api.github.com/users/JeffreyZZ/events{/privacy}","received_events_url":"https://api.github.com/users/JeffreyZZ/received_events","type":"User","site_admin":false},"created_at":"2017-01-23T20:08:27Z","updated_at":"2017-01-23T20:08:27Z","author_association":"NONE","body":"The current exception handling and its retry logical in Azure plugin is already able to handle the exceptions thrown when writing the data into Azure Storage account, it includes the throttling exception. What’s more, we also introduced ExponentialRetry to enhance the retry logic to make sure that it has enough retries when the exceptions happened in my PR#22709. But based on our investigation, this doesn’t help on the throttling scenarios, because when the snapshot data size is too big, such as 9TB in our case, it’s beyond the capability of exception retries because throttling lasts over a long period of time. Since the root cause is the bandwidth limit of a single storage account, I think that enabling the sharding of snapshot across multiple storage accounts is the right way to go for it. \r\n\r\nAs we have consulted Azure Storage production team, they don't support accounts of higher IOPS, the only alternative solution is to shard the load across multiple storage accounts. I just added background investigation we did in PR#22709.\r\n\r\nclient.getDefaultRequestOptions().setRetryPolicyFactory(new RetryExponentialRetry(1000 * 30, 7));","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/277968817","html_url":"https://github.com/elastic/elasticsearch/issues/22728#issuecomment-277968817","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22728","id":277968817,"node_id":"MDEyOklzc3VlQ29tbWVudDI3Nzk2ODgxNw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-02-07T11:13:18Z","updated_at":"2017-02-07T11:13:18Z","author_association":"CONTRIBUTOR","body":"These values should be exposed as settings in the azure plugin, instead of being hard coded.","performed_via_github_app":null}]