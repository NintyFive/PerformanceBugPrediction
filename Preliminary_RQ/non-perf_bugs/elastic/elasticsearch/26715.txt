{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26715","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26715/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26715/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26715/events","html_url":"https://github.com/elastic/elasticsearch/issues/26715","id":258925234,"node_id":"MDU6SXNzdWUyNTg5MjUyMzQ=","number":26715,"title":"Collate queries in phrase suggester not matching correctly","user":{"login":"bencrouse","id":165111,"node_id":"MDQ6VXNlcjE2NTExMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/165111?v=4","gravatar_id":"","url":"https://api.github.com/users/bencrouse","html_url":"https://github.com/bencrouse","followers_url":"https://api.github.com/users/bencrouse/followers","following_url":"https://api.github.com/users/bencrouse/following{/other_user}","gists_url":"https://api.github.com/users/bencrouse/gists{/gist_id}","starred_url":"https://api.github.com/users/bencrouse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bencrouse/subscriptions","organizations_url":"https://api.github.com/users/bencrouse/orgs","repos_url":"https://api.github.com/users/bencrouse/repos","events_url":"https://api.github.com/users/bencrouse/events{/privacy}","received_events_url":"https://api.github.com/users/bencrouse/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"}],"state":"closed","locked":false,"assignee":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2017-09-19T18:50:57Z","updated_at":"2017-09-20T17:37:12Z","closed_at":"2017-09-20T10:08:32Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 5.2.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 1.8.0_112\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Darwin Bens-MacBook-Pro.local 16.7.0 Darwin Kernel Version 16.7.0: Thu Jun 15 17:36:27 PDT 2017; root:xnu-3789.70.16~2/RELEASE_X86_64 x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**: I'm trying to use the collate option to return info based on \"active\" documents (defined when I index the document). In the script below, I'd expect that the `collate_match` be `false` given this suggestion could not match because the document with the original word has `\"active\":\"false\"`. Instead, it's returning the suggestion.\r\n**Steps to reproduce**:\r\n```\r\ncurl -XPUT 'localhost:9200/test4?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"settings\": {\r\n    \"index\": {\r\n      \"number_of_shards\": 1,\r\n      \"analysis\": {\r\n        \"analyzer\": {\r\n          \"trigram\": {\r\n            \"type\": \"custom\",\r\n            \"tokenizer\": \"standard\",\r\n            \"filter\": [\"standard\", \"shingle\"]\r\n          }\r\n        },\r\n        \"filter\": {\r\n          \"shingle\": {\r\n            \"type\": \"shingle\",\r\n            \"min_shingle_size\": 2,\r\n            \"max_shingle_size\": 3\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"mappings\": {\r\n    \"test\": {\r\n      \"properties\": {\r\n        \"title\": {\r\n          \"type\": \"text\",\r\n          \"fields\": {\r\n            \"trigram\": {\r\n              \"type\": \"text\",\r\n              \"analyzer\": \"trigram\"\r\n            }\r\n          }\r\n        },\r\n        \"active\": {\r\n          \"type\": \"keyword\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n'\r\ncurl -XPOST 'localhost:9200/test4/test?refresh=true&pretty' -H 'Content-Type: application/json' -d'\r\n{\"title\": \"noble warriors\", \"active\": \"true\"}\r\n'\r\ncurl -XPOST 'localhost:9200/test4/test?refresh=true&pretty' -H 'Content-Type: application/json' -d'\r\n{\"title\": \"nobel prize\", \"active\": \"false\"}\r\n'\r\n\r\ncurl -XPOST 'localhost:9200/test4/_search?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"suggest\": {\r\n    \"text\" : \"noble prize\",\r\n    \"simple_phrase\" : {\r\n      \"phrase\" : {\r\n        \"field\" :  \"title.trigram\",\r\n        \"size\" :   1,\r\n        \"direct_generator\" : [ {\r\n          \"field\" :            \"title.trigram\",\r\n          \"suggest_mode\" :     \"always\",\r\n          \"min_word_length\" :  1\r\n        } ],\r\n        \"collate\": {\r\n          \"query\": { \r\n            \"inline\" : {\r\n              \"match\": {\r\n                \"active\" : \"true\" \r\n              }\r\n            }\r\n          },\r\n          \"prune\": true \r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n'\r\n\r\n\r\n```\r\n\r\nI get this output from that last query:\r\n```\r\n{\r\n  \"took\" : 2,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 1,\r\n    \"successful\" : 1,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 0,\r\n    \"max_score\" : 0.0,\r\n    \"hits\" : [ ]\r\n  },\r\n  \"suggest\" : {\r\n    \"simple_phrase\" : [\r\n      {\r\n        \"text\" : \"noble prize\",\r\n        \"offset\" : 0,\r\n        \"length\" : 11,\r\n        \"options\" : [\r\n          {\r\n            \"text\" : \"nobel prize\",\r\n            \"score\" : 0.5962314,\r\n            \"collate_match\" : true\r\n          }\r\n        ]\r\n      }\r\n    ]\r\n  }\r\n}\r\n```","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}