[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/231999394","html_url":"https://github.com/elastic/elasticsearch/issues/19382#issuecomment-231999394","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19382","id":231999394,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMTk5OTM5NA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-07-12T10:22:54Z","updated_at":"2016-07-12T10:22:54Z","author_association":"CONTRIBUTOR","body":"As far as i can tell, ES2 doesn't index the contents of the query into the `_all` field which makes sense, as the `query` field is disabled --  it isn't even parsed:\n\n```\nPUT t \n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"foo\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n\nPUT t/.percolator/1\n{\n  \"query\": {\n    \"match\": {\n      \"foo\": \"bar\"\n    }\n  },\n  \"one\": \"two\"\n}\n\nGET t/.percolator/_search\n{\n  \"aggs\": {\n    \"all_field\": {\n      \"terms\": {\n        \"field\": \"_all\",\n        \"size\": 10\n      }\n    }\n  }\n}\n```\n\nThis returns:\n\n```\n\"all_field\": {\n  \"doc_count_error_upper_bound\": 0,\n  \"sum_other_doc_count\": 0,\n  \"buckets\": [\n    {\n      \"key\": \"two\",\n      \"doc_count\": 1\n    }\n  ]\n}\n```\n\nThe `copy_to` parameter wouldn't help here either, as you can't copy an object to a `text` field.\n\nIn 5.0, the `query.extracted_terms` includes the extractable terms in the format `field\\0term`, so eg this works:\n\n```\nPUT t \n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"foo\": {\n          \"type\": \"text\"\n        },\n        \"query\": {\n          \"type\": \"percolator\"\n        }\n      }\n    }\n  }\n}\n\nPUT t/t/1\n{\n  \"query\": {\n    \"match\": {\n      \"foo\": \"bar\"\n    }\n  }\n}\n\nGET t/t/_search\n{\n  \"query\": {\n    \"match\": {\n      \"query.extracted_terms\": \"foo\\u0000bar\"\n    }\n  }\n}\n```\n\nBut I realise that this may not be the most useful format for your purposes. Honestly, I think the best solution is for you to extract the terms you want indexed yourself, and to add them as metadata.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/232012863","html_url":"https://github.com/elastic/elasticsearch/issues/19382#issuecomment-232012863","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19382","id":232012863,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMjAxMjg2Mw==","user":{"login":"mumpi","id":15247331,"node_id":"MDQ6VXNlcjE1MjQ3MzMx","avatar_url":"https://avatars2.githubusercontent.com/u/15247331?v=4","gravatar_id":"","url":"https://api.github.com/users/mumpi","html_url":"https://github.com/mumpi","followers_url":"https://api.github.com/users/mumpi/followers","following_url":"https://api.github.com/users/mumpi/following{/other_user}","gists_url":"https://api.github.com/users/mumpi/gists{/gist_id}","starred_url":"https://api.github.com/users/mumpi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mumpi/subscriptions","organizations_url":"https://api.github.com/users/mumpi/orgs","repos_url":"https://api.github.com/users/mumpi/repos","events_url":"https://api.github.com/users/mumpi/events{/privacy}","received_events_url":"https://api.github.com/users/mumpi/received_events","type":"User","site_admin":false},"created_at":"2016-07-12T11:21:06Z","updated_at":"2016-07-12T11:21:06Z","author_association":"NONE","body":"There might be another way round: For My EL 2 percolator I set a mapping \n...\n       \"query\": {\n            \"type\": \"object\",\n            \"enabled\": true\n        }\n...\nThis seems responsible for indexing the query. A listing of the actual mapping shows:\n\n`\"query\": {\n            \"properties\": {\n              \"query_string\": {\n                \"properties\": {\n                  \"default_field\": {\n                    \"type\": \"string\"\n                  },\n                  \"default_operator\": {\n                    \"type\": \"string\"\n                  },\n                  \"minimum_should_match\": {\n                    \"type\": \"string\"\n                  },\n                  \"query\": {\n                    \"type\": \"string\"\n                  }\n                }\n              }\n            }\n          },\n`\n\nSo - instead of applying \"copy_to\" to the percolator type field why not start from the object type and \"copy_to\" the percolator type? (I tried; but ES 5 refused).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/232013945","html_url":"https://github.com/elastic/elasticsearch/issues/19382#issuecomment-232013945","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19382","id":232013945,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMjAxMzk0NQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-07-12T11:24:59Z","updated_at":"2016-07-12T11:24:59Z","author_association":"MEMBER","body":"> (I tried; but ES 5 refused).\n\nThis is because the percolator from 5.0 now only works if a field of type `percolator` has been configured, whereas before an `object` field was required.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/232014634","html_url":"https://github.com/elastic/elasticsearch/issues/19382#issuecomment-232014634","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19382","id":232014634,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMjAxNDYzNA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-07-12T11:27:22Z","updated_at":"2016-07-12T11:27:22Z","author_association":"CONTRIBUTOR","body":"> This seems responsible for indexing the query. A listing of the actual mapping shows:\n\nYes, but you also end up creating lots and lots of indexed fields, some of which might end up causing mapping conflicts later on.  This is a no-go.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/232017244","html_url":"https://github.com/elastic/elasticsearch/issues/19382#issuecomment-232017244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19382","id":232017244,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMjAxNzI0NA==","user":{"login":"mumpi","id":15247331,"node_id":"MDQ6VXNlcjE1MjQ3MzMx","avatar_url":"https://avatars2.githubusercontent.com/u/15247331?v=4","gravatar_id":"","url":"https://api.github.com/users/mumpi","html_url":"https://github.com/mumpi","followers_url":"https://api.github.com/users/mumpi/followers","following_url":"https://api.github.com/users/mumpi/following{/other_user}","gists_url":"https://api.github.com/users/mumpi/gists{/gist_id}","starred_url":"https://api.github.com/users/mumpi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mumpi/subscriptions","organizations_url":"https://api.github.com/users/mumpi/orgs","repos_url":"https://api.github.com/users/mumpi/repos","events_url":"https://api.github.com/users/mumpi/events{/privacy}","received_events_url":"https://api.github.com/users/mumpi/received_events","type":"User","site_admin":false},"created_at":"2016-07-12T11:35:00Z","updated_at":"2016-07-12T11:35:00Z","author_association":"NONE","body":"hmm, i see. But instead of defining the query as \"object\" and \"enable\" it I could also specify the required properties / subproperties for - in my sample - the \"query_string\" query.\n\nAnd then \"copy_to\" the \"percolator\" type \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/232337641","html_url":"https://github.com/elastic/elasticsearch/issues/19382#issuecomment-232337641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19382","id":232337641,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMjMzNzY0MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-07-13T12:17:08Z","updated_at":"2016-07-13T12:17:08Z","author_association":"CONTRIBUTOR","body":"@mumpi reread my comment https://github.com/elastic/elasticsearch/issues/19382#issuecomment-232014634 where I explain why this is a bad idea (even though it may have worked in your situation).\n\nI don't think there is anything we can do here, so I'm going to close\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/232355900","html_url":"https://github.com/elastic/elasticsearch/issues/19382#issuecomment-232355900","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19382","id":232355900,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMjM1NTkwMA==","user":{"login":"mumpi","id":15247331,"node_id":"MDQ6VXNlcjE1MjQ3MzMx","avatar_url":"https://avatars2.githubusercontent.com/u/15247331?v=4","gravatar_id":"","url":"https://api.github.com/users/mumpi","html_url":"https://github.com/mumpi","followers_url":"https://api.github.com/users/mumpi/followers","following_url":"https://api.github.com/users/mumpi/following{/other_user}","gists_url":"https://api.github.com/users/mumpi/gists{/gist_id}","starred_url":"https://api.github.com/users/mumpi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mumpi/subscriptions","organizations_url":"https://api.github.com/users/mumpi/orgs","repos_url":"https://api.github.com/users/mumpi/repos","events_url":"https://api.github.com/users/mumpi/events{/privacy}","received_events_url":"https://api.github.com/users/mumpi/received_events","type":"User","site_admin":false},"created_at":"2016-07-13T13:33:17Z","updated_at":"2016-07-13T13:33:17Z","author_association":"NONE","body":"Thank you for your effort.\n","performed_via_github_app":null}]