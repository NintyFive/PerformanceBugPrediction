{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15069","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15069/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15069/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15069/events","html_url":"https://github.com/elastic/elasticsearch/issues/15069","id":119233559,"node_id":"MDU6SXNzdWUxMTkyMzM1NTk=","number":15069,"title":"_index not accessible inside external script file?","user":{"login":"chintan-shah-25","id":6856646,"node_id":"MDQ6VXNlcjY4NTY2NDY=","avatar_url":"https://avatars0.githubusercontent.com/u/6856646?v=4","gravatar_id":"","url":"https://api.github.com/users/chintan-shah-25","html_url":"https://github.com/chintan-shah-25","followers_url":"https://api.github.com/users/chintan-shah-25/followers","following_url":"https://api.github.com/users/chintan-shah-25/following{/other_user}","gists_url":"https://api.github.com/users/chintan-shah-25/gists{/gist_id}","starred_url":"https://api.github.com/users/chintan-shah-25/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chintan-shah-25/subscriptions","organizations_url":"https://api.github.com/users/chintan-shah-25/orgs","repos_url":"https://api.github.com/users/chintan-shah-25/repos","events_url":"https://api.github.com/users/chintan-shah-25/events{/privacy}","received_events_url":"https://api.github.com/users/chintan-shah-25/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-11-27T18:28:29Z","updated_at":"2015-11-28T12:09:50Z","closed_at":"2015-11-28T12:09:50Z","author_association":"NONE","active_lock_reason":null,"body":"I am able to run the following query successfully \n\n```\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"aggs\": {\n    \"stadt\": {\n      \"sum\": {\n        \"script\": \"_index['title']['energy'].tf()\"\n      }\n    }\n  },\n  \"size\": 0\n}\n```\n\nBut I dont want to enable `dynamic scripting` so I put the content of script into external file inside `es/config/scripts/tfscript.groovy`\n\nNow the following query throws exception\n\n```\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"aggs\": {\n    \"stadt\": {\n      \"sum\": {\n        \"script\": {\n          \"file\": \"tfscript\"\n        }\n      }\n    }\n  },\n  \"size\": 0\n}\n```\n\nThe exception is \n\n```\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:747)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:572)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:544)\n    at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:385)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$11.call(SearchServiceTransportAction.java:333)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$11.call(SearchServiceTransportAction.java:330)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.search.SearchParseException: [enerknol][0]: query[ConstantScore(*:*)],from[-1],size[0]: Parse Failure [Unexpected token START_OBJECT in [stadt].]\n    at org.elasticsearch.search.aggregations.metrics.NumericValuesSourceMetricsAggregatorParser.parse(NumericValuesSourceMetricsAggregatorParser.java:61)\n    at org.elasticsearch.search.aggregations.AggregatorParsers.parseAggregators(AggregatorParsers.java:148)\n    at org.elasticsearch.search.aggregations.AggregatorParsers.parseAggregators(AggregatorParsers.java:78)\n    at org.elasticsearch.search.aggregations.AggregationParseElement.parse(AggregationParseElement.java:60)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:731)\n```\n\nI searched for `Unexpected token START_OBJECT in [stadt]` but could not figure out anything.\nAm I missing something basic here?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}