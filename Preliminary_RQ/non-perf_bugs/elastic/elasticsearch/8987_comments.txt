[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67346756","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67346756","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67346756,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzQ2NzU2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-17T16:17:14Z","updated_at":"2014-12-17T16:17:14Z","author_association":"CONTRIBUTOR","body":"You appear to have started a node on an old data directory which contained `users_v2` (plus the alias setting), then started a node on the current data directory and imported `users_v3`.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67349766","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67349766","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67349766,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzQ5NzY2","user":{"login":"awick","id":427321,"node_id":"MDQ6VXNlcjQyNzMyMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/427321?v=4","gravatar_id":"","url":"https://api.github.com/users/awick","html_url":"https://github.com/awick","followers_url":"https://api.github.com/users/awick/followers","following_url":"https://api.github.com/users/awick/following{/other_user}","gists_url":"https://api.github.com/users/awick/gists{/gist_id}","starred_url":"https://api.github.com/users/awick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awick/subscriptions","organizations_url":"https://api.github.com/users/awick/orgs","repos_url":"https://api.github.com/users/awick/repos","events_url":"https://api.github.com/users/awick/events{/privacy}","received_events_url":"https://api.github.com/users/awick/received_events","type":"User","site_admin":false},"created_at":"2014-12-17T16:33:33Z","updated_at":"2014-12-17T16:33:33Z","author_association":"NONE","body":"No, I didn't change anything from my normal upgrade procedure.  Which is to edit a runes.sh script and change which directory to change into. 1.4.2 instead of 1.4.1 this time.  All other settings, config files, ... exactly the same.\n\nJust to be clear its the alias I deleted 6 months ago and not the index.  user_v2 and user_v3 both existed, just that users pointed to users_v3.\n\nAs another data point I just tried the upgrade on a second large cluster, this time going from 1.3.4 to 1.4.2 and all hell broke out.  users_v3 in this case disappeared, mappings/settings on many other of my indexes reverted to old mappings/settings, I had to delete a users_v1 index that was probably created with 0.20 or earlier that I've been dragging along.  Most interesting is I had changed a mapping from being static to dynamic and after the upgrade it went back to static.  Luckily i was above to downgrade to 1.4.1 and I'm back in business.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67353980","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67353980","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67353980,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzUzOTgw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-17T16:57:32Z","updated_at":"2014-12-17T16:57:32Z","author_association":"CONTRIBUTOR","body":"@awick ok - all the symptoms you describe are related to importing old index state files.  Question is: why?  Did you do a rolling upgrade or a full cluster restart?\n\nCan you upload the logs from the master (and other nodes too, if possible)?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67354210","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67354210","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67354210,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzU0MjEw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-17T16:58:53Z","updated_at":"2014-12-17T16:58:53Z","author_association":"CONTRIBUTOR","body":"Also, do you have any settings to do with dangling indices?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67354573","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67354573","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67354573,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzU0NTcz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-17T17:00:48Z","updated_at":"2014-12-17T17:00:48Z","author_association":"CONTRIBUTOR","body":"Also, in your data path on all nodes, how many subdirectories do you have under: `$cluster/nodes/`?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67363392","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67363392","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67363392,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzYzMzky","user":{"login":"awick","id":427321,"node_id":"MDQ6VXNlcjQyNzMyMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/427321?v=4","gravatar_id":"","url":"https://api.github.com/users/awick","html_url":"https://github.com/awick","followers_url":"https://api.github.com/users/awick/followers","following_url":"https://api.github.com/users/awick/following{/other_user}","gists_url":"https://api.github.com/users/awick/gists{/gist_id}","starred_url":"https://api.github.com/users/awick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awick/subscriptions","organizations_url":"https://api.github.com/users/awick/orgs","repos_url":"https://api.github.com/users/awick/repos","events_url":"https://api.github.com/users/awick/events{/privacy}","received_events_url":"https://api.github.com/users/awick/received_events","type":"User","site_admin":false},"created_at":"2014-12-17T17:55:55Z","updated_at":"2014-12-17T17:56:20Z","author_association":"NONE","body":"Sent you mail to your github email with link to logs and stuff, don't want to put it on github.\n\nI always do a full cluster restart.  I did restart the cluster several times after things went crazy which you'll notice in the logs.\n\nI don't change any of the defaults for dangling indices\n\nI run 3 nodes per machine, so there are three directories.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67621429","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67621429","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67621429,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NjIxNDI5","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-19T10:25:54Z","updated_at":"2014-12-19T10:25:54Z","author_association":"CONTRIBUTOR","body":"Hi @awick \n\nCurrently cluster and index states are only written on master nodes (although we have plans to change that, see https://github.com/elasticsearch/elasticsearch/issues/8823#issuecomment-66209745).\n\nYou're running a single master node, on the same box as two other data nodes.  The first time you restarted your master, it come up using port 9302. In other words, there were still two other nodes running on that box, and so it used path `data/cluster_name/nodes/2`.  This contained an old cluster state which caused your issues.\n\nFor now at least, you should make all of the nodes on your \"master\" box master eligible, otherwise you will see this problem again in the future.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67626716","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67626716","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67626716,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NjI2NzE2","user":{"login":"awick","id":427321,"node_id":"MDQ6VXNlcjQyNzMyMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/427321?v=4","gravatar_id":"","url":"https://api.github.com/users/awick","html_url":"https://github.com/awick","followers_url":"https://api.github.com/users/awick/followers","following_url":"https://api.github.com/users/awick/following{/other_user}","gists_url":"https://api.github.com/users/awick/gists{/gist_id}","starred_url":"https://api.github.com/users/awick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awick/subscriptions","organizations_url":"https://api.github.com/users/awick/orgs","repos_url":"https://api.github.com/users/awick/repos","events_url":"https://api.github.com/users/awick/events{/privacy}","received_events_url":"https://api.github.com/users/awick/received_events","type":"User","site_admin":false},"created_at":"2014-12-19T11:18:52Z","updated_at":"2014-12-19T11:18:52Z","author_association":"NONE","body":"Ok thanks, I'll just add a sleep so that the first node settles down as master.  Wonder why I don't see this issue with older versions.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67627077","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67627077","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67627077,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NjI3MDc3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-19T11:22:55Z","updated_at":"2014-12-19T11:22:55Z","author_association":"CONTRIBUTOR","body":"@awick Why not just configure the master to have a different path from the data nodes? It's a hell of a lot more likely to succeed than relying on sleep...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67631310","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67631310","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67631310,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NjMxMzEw","user":{"login":"awick","id":427321,"node_id":"MDQ6VXNlcjQyNzMyMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/427321?v=4","gravatar_id":"","url":"https://api.github.com/users/awick","html_url":"https://github.com/awick","followers_url":"https://api.github.com/users/awick/followers","following_url":"https://api.github.com/users/awick/following{/other_user}","gists_url":"https://api.github.com/users/awick/gists{/gist_id}","starred_url":"https://api.github.com/users/awick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awick/subscriptions","organizations_url":"https://api.github.com/users/awick/orgs","repos_url":"https://api.github.com/users/awick/repos","events_url":"https://api.github.com/users/awick/events{/privacy}","received_events_url":"https://api.github.com/users/awick/received_events","type":"User","site_admin":false},"created_at":"2014-12-19T12:14:18Z","updated_at":"2014-12-19T12:14:18Z","author_association":"NONE","body":"Ok, so I'll move the 0 node to that new directory hierarchy.  Do I rename 1 and 2 to 0 and 1 in the old directory hierarchy?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67631543","html_url":"https://github.com/elastic/elasticsearch/issues/8987#issuecomment-67631543","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8987","id":67631543,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NjMxNTQz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-19T12:17:29Z","updated_at":"2014-12-19T12:17:29Z","author_association":"CONTRIBUTOR","body":"yes, and set max local storage nodes to 2 (for the data nodes) and 1 (for the master)\n","performed_via_github_app":null}]