{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37856","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37856/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37856/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37856/events","html_url":"https://github.com/elastic/elasticsearch/issues/37856","id":403055969,"node_id":"MDU6SXNzdWU0MDMwNTU5Njk=","number":37856,"title":"Protecting cluster in elastic search from big queries","user":{"login":"nitin2goyal","id":4218157,"node_id":"MDQ6VXNlcjQyMTgxNTc=","avatar_url":"https://avatars1.githubusercontent.com/u/4218157?v=4","gravatar_id":"","url":"https://api.github.com/users/nitin2goyal","html_url":"https://github.com/nitin2goyal","followers_url":"https://api.github.com/users/nitin2goyal/followers","following_url":"https://api.github.com/users/nitin2goyal/following{/other_user}","gists_url":"https://api.github.com/users/nitin2goyal/gists{/gist_id}","starred_url":"https://api.github.com/users/nitin2goyal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nitin2goyal/subscriptions","organizations_url":"https://api.github.com/users/nitin2goyal/orgs","repos_url":"https://api.github.com/users/nitin2goyal/repos","events_url":"https://api.github.com/users/nitin2goyal/events{/privacy}","received_events_url":"https://api.github.com/users/nitin2goyal/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-01-25T08:39:33Z","updated_at":"2019-01-25T14:48:50Z","closed_at":"2019-01-25T14:48:50Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"PROBLEM\r\n\r\nWe have use case where we are running ES on 100s of nodes and we get a mix of long and small running concurrent queries, where long and short is defined by number of shards it executes on.\r\n\r\nhttps://discuss.elastic.co/t/long-query-starving-other-small-queries-and-slowing-down-the-cluster/163665?u=dextermorgan\r\n\r\nI know we have a feature where we can limit the number of concurrent shards per search request and protect our cluster form one big query but what if there are more concurrent big queries with small queries. It would still starve the small queries\r\n\r\nPROPOSAL\r\n\r\nI propose to introduce a new search queue, maybe called as search_fast with configurable threads and elasticsearch can schedule smaller queries on this queue in case \"search\" thread queue size is large. \r\n\r\nLet me know your thoughts regarding this and I can come up with a design and later, pull request.\r\n\r\nP.S.  - Something similar in YARN - https://hortonworks.com/blog/yarn-capacity-scheduler/\r\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}