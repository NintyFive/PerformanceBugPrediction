[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412693952","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-412693952","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":412693952,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjY5Mzk1Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-13T23:00:27Z","updated_at":"2018-08-13T23:00:27Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416584905","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-416584905","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":416584905,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjU4NDkwNQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-08-28T13:31:44Z","updated_at":"2018-08-28T13:31:44Z","author_association":"MEMBER","body":"Although on a different test method in the same test class, I think this is the same failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=java11,ES_RUNTIME_JAVA=java11,nodes=virtual&&linux/265/console . I can't repro either.\r\n\r\n```\r\n07:10:35   1> [2018-08-28T08:10:30,847][INFO ][o.e.i.IndicesRequestCacheIT] [testQueryRewriteDatesWithNow] after test\r\n07:10:35 FAILURE 2.58s J1 | IndicesRequestCacheIT.testQueryRewriteDatesWithNow <<< FAILURES!\r\n07:10:35    > Throwable #1: java.lang.AssertionError: \r\n07:10:35    > Expected: <2L>\r\n07:10:35    >      but: was <1L>\r\n07:10:35    > \tat __randomizedtesting.SeedInfo.seed([FACB28E405660D99:4EC92144B233E176]:0)\r\n07:10:35    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n07:10:35    > \tat org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewriteDatesWithNow(IndicesRequestCacheIT.java:349)\r\n07:10:35    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n07:10:35    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n07:10:35    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n07:10:35    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n07:10:35    > \tat java.base/java.lang.Thread.run(Thread.java:834)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419369425","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-419369425","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":419369425,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTM2OTQyNQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-09-07T08:48:12Z","updated_at":"2018-09-07T08:48:12Z","author_association":"MEMBER","body":"I merged https://github.com/elastic/elasticsearch/pull/33313 last week that should hopefully fix this and if not sure provide better information if it occurs again. I'm going to close this issue for now but please re-open if the issue re-occurs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/424361530","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-424361530","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":424361530,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNDM2MTUzMA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-09-25T14:17:21Z","updated_at":"2018-09-25T14:17:21Z","author_association":"MEMBER","body":"@colings86 after days of silence we have got two new failures in the last 10 hours. Could you take a look if they provide more information:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+release-tests/33/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=java11,ES_RUNTIME_JAVA=java8,nodes=virtual&&linux/22/console\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425895772","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-425895772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":425895772,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTg5NTc3Mg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-01T12:51:43Z","updated_at":"2018-10-01T12:51:43Z","author_association":"MEMBER","body":"I opened https://github.com/elastic/elasticsearch/pull/34180 to add some more logging information and hopefully see whats going on better","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426545855","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-426545855","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":426545855,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjU0NTg1NQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-03T07:59:20Z","updated_at":"2018-10-03T07:59:20Z","author_association":"MEMBER","body":"https://github.com/elastic/elasticsearch/pull/34180 is now merged. Please ping me if this fails again as the PR only adds debugging information.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437302458","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-437302458","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":437302458,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzMwMjQ1OA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T09:31:21Z","updated_at":"2018-11-09T09:31:21Z","author_association":"MEMBER","body":"Quick new datapoint on this, I just did a search in the recent CI failures and couldn't find any new occurances of both the IndicesRequestCacheIT.testQueryRewrite and the testQueryRewriteDatesWithNow case since Sep 25th. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440430588","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-440430588","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":440430588,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDQzMDU4OA==","user":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"created_at":"2018-11-20T21:10:27Z","updated_at":"2018-11-20T21:10:27Z","author_association":"CONTRIBUTOR","body":"Have a new instance of this: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/255/console\r\n\r\n```\r\n06:57:43   1> [2018-11-20T14:57:38,969][INFO ][o.e.i.IndicesRequestCacheIT] [testQueryRewrite] [IndicesRequestCacheIT#testQueryRewrite]: cleaning up after test\r\n06:57:43   1> [2018-11-20T14:57:39,018][INFO ][o.e.c.m.MetaDataDeleteIndexService] [node_sm2] [index/j7ReR8i1R1OIrDAmbZH9RA] deleting index\r\n06:57:43   1> [2018-11-20T14:57:39,113][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node_sm2] removing template [random_index_template]\r\n06:57:43   1> [2018-11-20T14:57:39,131][INFO ][o.e.i.IndicesRequestCacheIT] [testQueryRewrite] [IndicesRequestCacheIT#testQueryRewrite]: cleaned up after test\r\n06:57:43   1> [2018-11-20T14:57:39,131][INFO ][o.e.i.IndicesRequestCacheIT] [testQueryRewrite] after test\r\n06:57:43 FAILURE 13.2s J6 | IndicesRequestCacheIT.testQueryRewrite <<< FAILURES!\r\n06:57:43    > Throwable #1: java.lang.AssertionError: expected:<[6, 9, 0]> but was:<[5, 10, 0]>\r\n06:57:43    > \tat __randomizedtesting.SeedInfo.seed([48E304082D784C6:F59097E56A02A2F7]:0)\r\n06:57:43    > \tat org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:422)\r\n06:57:43    > \tat org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewrite(IndicesRequestCacheIT.java:144)\r\n06:57:43    > \tat java.lang.Thread.run(Thread.java:748)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441567881","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-441567881","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":441567881,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTU2Nzg4MQ==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2018-11-26T09:12:39Z","updated_at":"2018-11-26T09:12:39Z","author_association":"CONTRIBUTOR","body":"We have a couple more errors this weekend:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-unix-compatibility/os=centos/80/console\r\n\r\n```\r\njava.lang.AssertionError: \r\nExpected: <1L>\r\n     but: was <0L>\r\n\tat __randomizedtesting.SeedInfo.seed([43BC570BE27C13A6:F7BE5EAB5529FF49]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewriteDatesWithNow(IndicesRequestCacheIT.java:319)\r\n```\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-unix-compatibility/os=fedora/79/console\r\n\r\n```\r\nava.lang.AssertionError: \r\nExpected: <3L>\r\n     but: was <2L>\r\n\tat __randomizedtesting.SeedInfo.seed([9A2FA9AA40878B16:6B310E0FA852AD27]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewrite(IndicesRequestCacheIT.java:130)\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/449047986","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-449047986","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":449047986,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTA0Nzk4Ng==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T16:04:45Z","updated_at":"2018-12-20T16:04:45Z","author_association":"CONTRIBUTOR","body":"Not `testQueryRewrite`, but another test from `IndicesRequestCacheIT` failed on master intake.\r\n\r\nThis does NOT reproduce locally on me:\r\n./gradlew :server:integTest \\\r\n  -Dtests.seed=9708FF54BBAD3138 \\\r\n  -Dtests.class=org.elasticsearch.indices.IndicesRequestCacheIT \\\r\n  -Dtests.method=\"testCacheWithFilteredAlias\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es \\\r\n  -Dtests.timezone=America/Yellowknife \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n\r\nLog:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/928/console\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/457790038","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-457790038","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":457790038,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1Nzc5MDAzOA==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2019-01-26T01:46:44Z","updated_at":"2019-01-26T01:46:44Z","author_association":"MEMBER","body":"Another example just came up on 6.6.\r\n\r\nLink to the build: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.6+periodic/225\r\n\r\nCommand to reproduce:\r\n```\r\n./gradlew :server:integTest \\\r\n  -Dtests.seed=7D08E34E0F1FF7B9 \\\r\n  -Dtests.class=org.elasticsearch.indices.IndicesRequestCacheIT \\\r\n  -Dtests.method=\"testQueryRewriteDatesWithNow\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=he \\\r\n  -Dtests.timezone=America/Recife \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/461905461","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-461905461","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":461905461,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MTkwNTQ2MQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-02-08T18:48:38Z","updated_at":"2019-02-08T18:48:38Z","author_association":"MEMBER","body":"Haven't been able to replicate this yet, but had a thought: could time of test run be affecting the `testQueryRewriteDatesWithNow` tests?  E.g. if the test run happens over midnight in the specified timezone, maybe one of the values is falling out of the range and affecting how the query is rewritten (and values that match)?\r\n\r\nPerhaps the `gte` range could be rewritten to always go way past the last document?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466054389","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-466054389","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":466054389,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjA1NDM4OQ==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2019-02-21T15:58:30Z","updated_at":"2019-02-21T19:00:19Z","author_association":"CONTRIBUTOR","body":"I have done some investigations for `testQueryRewrite` test case. \r\n\r\nOn 6.x it fails from time to time, and [Colin's PR](https://github.com/elastic/elasticsearch/pull/33313) to use `forceMerge` will be [backported](https://github.com/elastic/elasticsearch/pull/39263) to 6.7 to help with failures.\r\n\r\nOn master (after Colin's change)  it fails very very occasionally. [Last failure](https://groups.google.com/a/elastic.co/forum/#!searchin/build-elasticsearch/%22IndicesRequestCacheIT.testQueryRewrite%22|sort:date/build-elasticsearch/pnVpc249J8k/GGtaFnmfAwAJ)  was in Nov, 2018.\r\nColin's log helped a lot to see why failure happens: \r\n\r\n```\r\n [2018-11-20T14:57:38,917][TRACE][o.e.i.IndicesRequestCache] [node_sd4] Cache hit for reader version [10] and request:\r\nShard: [index][2] \r\nSource:  {\"size\":0,\"timeout\":\"1d\",\"query\":{\"range\":{\"s\":{\"from\":null,\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}}}\r\n```\r\n\r\n```\r\n[2018-11-20T14:57:38,952][TRACE][o.e.i.IndicesRequestCache] [node_sd4] Cache miss for reader version [11] and request:\r\nShard: [index][2]\r\nSource:  {\"size\":0,\"timeout\":\"1d\",\"query\":{\"range\":{\"s\":{\"from\":null,\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}}}\r\n```\r\n\r\nThe second miss was supposed to be `hit` (the query is still the same). But it became a miss because cache got invalidated as the reader changed its version from 10 to 11.   The version change in the reader happens only where there is a [change introduced by IndexWriter](https://github.com/apache/lucene-solr/blob/master/lucene/core/src/java/org/apache/lucene/index/DirectoryReader.java#L390).  I am still not sure how any index change could happened here, as we are first doing blocking forceMerge and refresh before any searches. \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466339055","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-466339055","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":466339055,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjMzOTA1NQ==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T09:49:10Z","updated_at":"2019-02-22T09:49:10Z","author_association":"CONTRIBUTOR","body":"We had another failure last night, this time in a different test method on the same class:\r\n```\r\njava.lang.AssertionError: expected:<[1, 1, 0]> but was:<[0, 2, 0]>\r\n\tat __randomizedtesting.SeedInfo.seed([837DAA566443EF4B:C4AE44D1149A5879]:0)\r\n\tat org.junit.Assert.fail(Assert.java:88)\r\n\tat org.junit.Assert.failNotEquals(Assert.java:834)\r\n\tat org.junit.Assert.assertEquals(Assert.java:118)\r\n\tat org.junit.Assert.assertEquals(Assert.java:144)\r\n\tat org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:424)\r\n\tat org.elasticsearch.indices.IndicesRequestCacheIT.testCacheWithFilteredAlias(IndicesRequestCacheIT.java:406)\r\n```\r\n\r\nLink to build: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/1678/console\r\n\r\nReproduce line (doesn't reproduce, of course):\r\n```\r\nREPRODUCE WITH: ./gradlew :server:integTest \\\r\n  -Dtests.seed=837DAA566443EF4B \\\r\n  -Dtests.class=org.elasticsearch.indices.IndicesRequestCacheIT \\\r\n  -Dtests.method=\"testCacheWithFilteredAlias\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=sv-SE \\\r\n  -Dtests.timezone=Europe/Amsterdam \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466346622","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-466346622","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":466346622,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjM0NjYyMg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T10:14:58Z","updated_at":"2019-02-22T10:14:58Z","author_association":"MEMBER","body":"Relevant part of the logs for reader versions:\r\n```\r\n01:57:13   1> [2019-02-22T02:57:07,105][INFO ][o.e.p.PluginsService     ] [testCacheWithFilteredAlias] loaded plugin [org.elasticsearch.transport.nio.MockNioTransportPlugin]\r\n01:57:13   1> [2019-02-22T02:57:07,745][TRACE][o.e.i.IndicesRequestCache] [node_s2] Cache miss for reader version [7] and request:\r\n01:57:13   1>  Shard: [index][0]\r\n01:57:13   1> Source:\r\n01:57:13   1> {\"size\":0,\"query\":{\"range\":{\"created_at\":{\"from\":null,\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}}}\r\n01:57:13   1> [2019-02-22T02:57:07,808][TRACE][o.e.i.IndicesRequestCache] [node_s2] Cache miss for reader version [9] and request:\r\n01:57:13   1>  Shard: [index][0]\r\n01:57:13   1> Source:\r\n01:57:13   1> {\"size\":0,\"query\":{\"range\":{\"created_at\":{\"from\":null,\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}}}\r\n01:57:13   1> [2019-02-22T02:57:07,831][INFO ][o.e.i.IndicesRequestCacheIT] [testCacheWithFilteredAlias] [IndicesRequestCacheIT#testCacheWithFilteredAlias]: cleaning up after test\r\n01:57:13   1> [2019-02-22T02:57:07,863][INFO ][o.e.c.m.MetaDataDeleteIndexService] [node_s1] [index/tUjeiKVrRU2oaImpCPeTvQ] deleting index\r\n01:57:13   1> [2019-02-22T02:57:07,932][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node_s1] removing template [random_index_template]\r\n01:57:13   1> [2019-02-22T02:57:07,954][INFO ][o.e.i.IndicesRequestCacheIT] [testCacheWithFilteredAlias] [IndicesRequestCacheIT#testCacheWithFilteredAlias]: cleaned up after test\r\n01:57:13   1> [2019-02-22T02:57:07,954][INFO ][o.e.i.IndicesRequestCacheIT] [testCacheWithFilteredAlias] after test\r\n01:57:13 FAILURE 2.17s J6 | IndicesRequestCacheIT.testCacheWithFilteredAlias <<< FAILURES!\r\n01:57:13    > Throwable #1: java.lang.AssertionError: expected:<[1, 1, 0]> but was:<[0, 2, 0]>\r\n01:57:13    > \tat __randomizedtesting.SeedInfo.seed([837DAA566443EF4B:C4AE44D1149A5879]:0)\r\n01:57:13    > \tat org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:424)\r\n01:57:13    > \tat org.elasticsearch.indices.IndicesRequestCacheIT.testCacheWithFilteredAlias(IndicesRequestCacheIT.java:406)\r\n01:57:13    > \tat java.lang.Thread.run(Thread.java:748)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466355198","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-466355198","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":466355198,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjM1NTE5OA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T10:45:31Z","updated_at":"2019-02-22T10:45:31Z","author_association":"MEMBER","body":"The [forcemerge request before we start sending search requests](https://github.com/elastic/elasticsearch/blob/master/server/src/test/java/org/elasticsearch/indices/IndicesRequestCacheIT.java#L391) should be blocking until it completes. My only thoughts on how we could still end up with a refresh after this is:\r\n1. The forcemerge request timed out. I don't think this can be the case since the check on the response would fail if that happened\r\n2. The forcemerge is blocking but it doesn't block waiting for the subsequent refresh. If it does not wait for the refresh then its possible that there is a race condition between the search requests and the refresh particularly on CI workers with a high load. Not sure about this so we should investigate if this scenario is possible.\r\n3. A refresh from a merge is pending whilst the forcemerge refresh happens and completes (unblocking the test) and then the pending refresh happens changing the reader. Again I'm not sure if this is possible","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466357032","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-466357032","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":466357032,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjM1NzAzMg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T10:52:05Z","updated_at":"2019-02-22T10:52:05Z","author_association":"MEMBER","body":"> 2\\. The forcemerge is blocking but it doesn't block waiting for the subsequent refresh. If it does not wait for the refresh then its possible that there is a race condition between the search requests and the refresh particularly on CI workers with a high load. Not sure about this so we should investigate if this scenario is possible.\r\n\r\nFrom what I can see the flush operation is [synchronous with the forcemerge inside `InternalEngine`](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/index/engine/InternalEngine.java#L1893) so scenario 2 does not seem to be possible","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466360131","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-466360131","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":466360131,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjM2MDEzMQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T11:03:54Z","updated_at":"2019-02-22T11:05:01Z","author_association":"MEMBER","body":"One thing that might help, though I don't think will solve the issue entirely is to move the [refresh()](https://github.com/elastic/elasticsearch/blob/master/server/src/test/java/org/elasticsearch/indices/IndicesRequestCacheIT.java#L389) so its after the forcemerge request. The `testCacheWithFilteredAlias` is the only test method where we refresh and then forcemerge rather than the other way around. The reason I don't think it will solve the issue entirely is that the `testQueryRewrite` still fails.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467484448","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-467484448","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":467484448,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzQ4NDQ0OA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T15:31:12Z","updated_at":"2019-02-26T15:31:45Z","author_association":"CONTRIBUTOR","body":"Some failure analysis:\r\n\r\nColin introduced fixes of `forceMerge` in Sep 2018. Since then we had 17 [failures](https://build-stats.elastic.co/app/kibana#/discover?_g=(refreshInterval:(pause:!t,value:0),time:(from:'2018-09-03T04:00:00.000Z',mode:absolute,to:'2019-02-26T15:20:33.678Z'))&_a=(columns:!(_source),index:e58bf320-7efd-11e8-bf69-63c8ef516157,interval:auto,query:(language:lucene,query:'stacktrace:%22org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState%22'),sort:!(time,desc))) of `IndicesRequestCacheIT.assertCacheState`:\r\n\r\n<img width=\"1422\" alt=\"screenshot 2019-02-26 10 21 40\" src=\"https://user-images.githubusercontent.com/5738841/53423998-5aafaa80-39b0-11e9-9836-2eab41a3793d.png\">\r\n\r\nFrom these 17 failures:  \r\n- 15 with `testCacheWithFilteredAlias`\r\n- 1 with `testQueryRewrite`  on Nov 20, 2018 \r\n- 1 with `testQueryRewriteDates` on Sep 25, 2018\r\n\r\n#39401 should fix failures with `testCacheWithFilteredAlias`, then we are only left with two unaddressed failures that we can't explain and that have not happened for more than 3 months. We will monitor failures with `IndicesRequestCacheIT`, but if they don't happen again, we may think of closing this test failure issue. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467486883","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-467486883","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":467486883,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzQ4Njg4Mw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-02-26T15:36:56Z","updated_at":"2019-02-26T15:36:56Z","author_association":"MEMBER","body":"@mayya-sharipova I wonder if there is any more debug logging we could add to determine where the extra flush is coming from if the failures do re-occur? Maybe we could put some extra debug or trace logging in the flush code to log extra info when this happens?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/468018381","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-468018381","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":468018381,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODAxODM4MQ==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T20:30:31Z","updated_at":"2019-02-27T20:31:19Z","author_association":"CONTRIBUTOR","body":"@colings86 Looks like `IndexReader` updates its version (and hence invalidates a cache) in two scenarios:\r\n1) `IndexWriter` has written something new, created a new segment \r\n2) There was a flush operation (a new Lucene commit) even if there was not any new data.  I don't know what causes flush (translog causes it, synchronization?), and when it happens, but as you suggested I have created a PR #39475 to add extra debugging information for flush. This will help us to see if there was some unexpected flush operation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/473300731","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-473300731","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":473300731,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzMwMDczMQ==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2019-03-15T14:11:21Z","updated_at":"2019-03-15T14:11:21Z","author_association":"MEMBER","body":"Another failure in `testQueryRewriteDatesWithNow`  on 6.6\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.6+multijob-unix-compatibility/os=ubuntu-16.04&&immutable/172/console\r\n\r\n[test.log](https://github.com/elastic/elasticsearch/files/2971434/test.log)\r\n\r\nThe reproduce line, obviously it does not reproduce\r\n\r\n```\r\n./gradlew :server:integTest \\\r\n  -Dtests.seed=3E9D64409C145E8A \\\r\n  -Dtests.class=org.elasticsearch.indices.IndicesRequestCacheIT \\\r\n  -Dtests.method=\"testQueryRewriteDatesWithNow\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es-SV \\\r\n  -Dtests.timezone=Africa/Sao_Tome \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/519565146","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-519565146","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":519565146,"node_id":"MDEyOklzc3VlQ29tbWVudDUxOTU2NTE0Ng==","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"created_at":"2019-08-08T15:22:09Z","updated_at":"2019-08-08T15:22:09Z","author_association":"CONTRIBUTOR","body":"Another one in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.8+periodic/390/console\r\n\r\nFailure:\r\n\r\n```\r\nFAILURE 1.41s J7 | IndicesRequestCacheIT.testQueryRewriteDatesWithNow <<< FAILURES!\r\n17:44:20    > Throwable #1: java.lang.AssertionError: expected:<[1, 1]> but was:<[0, 2]>\r\n17:44:20    > \tat __randomizedtesting.SeedInfo.seed([C2622D4632A7E5E8:766024E685F20907]:0)\r\n17:44:20    > \tat org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:418)\r\n17:44:20    > \tat org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewriteDatesWithNow(IndicesRequestCacheIT.java:286)\r\n17:44:20    > \tat java.lang.Thread.run(Thread.java:748)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/540619848","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-540619848","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":540619848,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MDYxOTg0OA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2019-10-10T14:40:51Z","updated_at":"2019-10-10T14:40:51Z","author_association":"MEMBER","body":"Looks like we had another instance of it in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.8+matrix-java-periodic/ES_BUILD_JAVA=openjdk12,ES_RUNTIME_JAVA=adoptopenjdk8,nodes=general-purpose/256/console\r\n\r\n```\r\njava.lang.AssertionError: expected:<[2, 1]> but was:<[1, 2]>\r\n\tat __randomizedtesting.SeedInfo.seed([2F95A00A75A8377F:9B97A9AAC2FDDB90]:0)\r\n\tat org.junit.Assert.fail(Assert.java:88)\r\n\tat org.junit.Assert.failNotEquals(Assert.java:834)\r\n\tat org.junit.Assert.assertEquals(Assert.java:118)\r\n\tat org.junit.Assert.assertEquals(Assert.java:144)\r\n\tat org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:418)\r\n\tat org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewriteDatesWithNow(IndicesRequestCacheIT.java:295)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1750)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:938)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:974)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:988)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:947)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:832)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:883)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:894)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/582993748","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-582993748","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":582993748,"node_id":"MDEyOklzc3VlQ29tbWVudDU4Mjk5Mzc0OA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2020-02-06T16:39:34Z","updated_at":"2020-02-06T16:39:34Z","author_association":"MEMBER","body":"This test failed again today: https://gradle-enterprise.elastic.co/s/zbfbykxpdnfye\r\n\r\nwith the error:\r\n```\r\n:server:integTest  org.elasticsearch.indices.IndicesRequestCacheIT  testQueryRewrite (0.800s)\r\nexpected:<[6, 9, 0]> but was:<[5, 10, 0]>\r\njava.lang.AssertionError\r\n: \r\nexpected:<[6, 9, 0]> but was:<[5, 10, 0]>\r\nClose stacktrace\r\nat __randomizedtesting.SeedInfo.seed([3C191AB6FF3E40A2:CD07BD1317EB6693]:0)\r\nat org.junit.Assert.fail(Assert.java:88)\r\nat org.junit.Assert.failNotEquals(Assert.java:834)\r\nat org.junit.Assert.assertEquals(Assert.java:118)\r\nat org.junit.Assert.assertEquals(Assert.java:144)\r\nat org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:469)\r\nat org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewrite(IndicesRequestCacheIT.java:150)\r\n```\r\n\r\nBecause this test is failing regularly on master so I muted it in de4cf2b7f6e6b50dc7286b654b74c6f13863f0b3.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/583446732","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-583446732","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":583446732,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MzQ0NjczMg==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2020-02-07T15:16:29Z","updated_at":"2020-02-07T15:16:29Z","author_association":"CONTRIBUTOR","body":"It also fails on 7.x https://gradle-enterprise.elastic.co/s/tkfitlc3lhwmw\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew ':server:integTest' --tests \"org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewrite\" -Dtests.seed=7353DB5A0E87365D -Dtests.security.manager=true -Dtests.locale=sl-SI -Dtests.timezone=America/Hermosillo -Dcompiler.java=13\t\r\n  2> java.lang.AssertionError: expected:<[6, 9, 0]> but was:<[5, 10, 0]>\t\r\n        at __randomizedtesting.SeedInfo.seed([7353DB5A0E87365D:824D7CFFE652106C]:0)\t\r\n        at org.junit.Assert.fail(Assert.java:88)\t\r\n        at org.junit.Assert.failNotEquals(Assert.java:834)\t\r\n        at org.junit.Assert.assertEquals(Assert.java:118)\t\r\n        at org.junit.Assert.assertEquals(Assert.java:144)\t\r\n        at org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:469)\t\r\n        at org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewrite(IndicesRequestCacheIT.java:150)\r\n```\r\nI'll wait for one more failure before muting on 7.x as well.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/583520858","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-583520858","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":583520858,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MzUyMDg1OA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2020-02-07T17:40:07Z","updated_at":"2020-02-07T17:40:07Z","author_association":"CONTRIBUTOR","body":"Another time, and also `testQueryRewriteDatesWithNow` fails:\r\n```\r\nREPRODUCE WITH: ./gradlew ':server:integTest' --tests \"org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewrite\" -Dtests.seed=F4D7D8FF9792A390 -Dtests.security.manager=true -Dtests.locale=ms-MY -Dtests.timezone=America/Ensenada -Dcompiler.java=13\t\r\n\t\r\norg.elasticsearch.indices.IndicesRequestCacheIT > testQueryRewrite FAILED\t\r\n    java.lang.AssertionError: expected:<[3, 7, 0]> but was:<[2, 8, 0]>\t\r\n        at __randomizedtesting.SeedInfo.seed([F4D7D8FF9792A390:5C97F5A7F4785A1]:0)\t\r\n        at org.junit.Assert.fail(Assert.java:88)\t\r\n        at org.junit.Assert.failNotEquals(Assert.java:834)\t\r\n        at org.junit.Assert.assertEquals(Assert.java:118)\t\r\n        at org.junit.Assert.assertEquals(Assert.java:144)\t\r\n        at org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:469)\t\r\n        at org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewrite(IndicesRequestCacheIT.java:141)\t\r\n\t\r\nREPRODUCE WITH: ./gradlew ':server:integTest' --tests \"org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewriteDatesWithNow\" -Dtests.seed=F4D7D8FF9792A390 -Dtests.security.manager=true -Dtests.locale=ms-MY -Dtests.timezone=America/Ensenada -Dcompiler.java=13\t\r\n\t\r\norg.elasticsearch.indices.IndicesRequestCacheIT > testQueryRewriteDatesWithNow FAILED\t\r\n    java.lang.AssertionError: expected:<[2, 1, 0]> but was:<[1, 2, 0]>\t\r\n        at __randomizedtesting.SeedInfo.seed([F4D7D8FF9792A390:40D5D15F20C74F7F]:0)\t\r\n        at org.junit.Assert.fail(Assert.java:88)\t\r\n        at org.junit.Assert.failNotEquals(Assert.java:834)\t\r\n        at org.junit.Assert.assertEquals(Assert.java:118)\t\r\n        at org.junit.Assert.assertEquals(Assert.java:144)\t\r\n        at org.elasticsearch.indices.IndicesRequestCacheIT.assertCacheState(IndicesRequestCacheIT.java:469)\t\r\n        at org.elasticsearch.indices.IndicesRequestCacheIT.testQueryRewriteDatesWithNow(IndicesRequestCacheIT.java:305)\r\n```\r\n\r\nI'm going to mute this in both master and 7.x, please feel free to revert if I'm being too aggressive.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/583615892","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-583615892","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":583615892,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MzYxNTg5Mg==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-02-07T21:15:29Z","updated_at":"2020-02-07T21:16:50Z","author_association":"CONTRIBUTOR","body":"I've muted `testQueryRewriteDatesWithNow` in both `master` (55f303e469d94b4b10b703d1018afc5c206c6f30) and `7.x` (e5a9e44ca4de423b4b9e0e2458b1b4346b3b7816) since as mentioned above it has started failing with a similar error.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/603121758","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-603121758","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":603121758,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMzEyMTc1OA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2020-03-24T09:15:18Z","updated_at":"2020-03-24T09:15:18Z","author_association":"CONTRIBUTOR","body":"Muted `testQueryRewrite` on master.\r\nSee the following three build failures:\r\nhttps://gradle-enterprise.elastic.co/s/fhw4lkpjv5htu\r\nhttps://gradle-enterprise.elastic.co/s/6xl6mgypqp26w\r\nhttps://gradle-enterprise.elastic.co/s/4g5dsdqtiu5m6","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/603140463","html_url":"https://github.com/elastic/elasticsearch/issues/32827#issuecomment-603140463","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32827","id":603140463,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMzE0MDQ2Mw==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2020-03-24T09:54:38Z","updated_at":"2020-03-24T10:41:59Z","author_association":"CONTRIBUTOR","body":"Analyzing  console output from this build: https://gradle-enterprise.elastic.co/s/2gsqxhzsvwdjq\r\nexpected:<[3, 7, 0]> but was:<[2, 8, 0]>\r\n\r\n```\r\nquery: from\":\"2016-03-19\",\"to\":\"2016-03-25\"\r\n```\r\n Shard: [index][0]  _doesn't have any docs_\r\n[node_s1] Cache miss for reader version [5], max_doc[0] and request:\r\nSource:\r\n{\"size\":0,\"query\":{\"**match_none**\":{\"boost\":1.0}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n Shard: [index][1]  _doesn't have any docs_\r\n[node_s2] Cache miss for reader version [5], max_doc[0] and request:\r\nSource: {\"size\":0,\"query\":{\"**match_none**\":{\"boost\":1.0}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n Shard: [index][2]  has docs 2016-03-22  2016-03-24  **match_all**\r\n[node_s0] Cache miss for reader version [9], max_doc[3] and request:\r\nSource: {\"size\":0,\"query\":{\"range\":{\"s\":{\"from\":null,\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n Shard: [index][3]  has docs 2016-03-19  2016-03-21 **match_all**\r\n[node_s1] Cache miss for reader version [9], max_doc[3] and request:\r\nSource:{\"size\":0,\"query\":{\"range\":{\"s\":{\"from\":null,\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n Shard: [index][4]  _has docs 2016-03-25  2016-03-27_\r\n[node_s2] Cache miss for reader version [9], max_doc[3] and request:\r\nSource:{\"size\":0,\"query\":{\"range\":{\"s\":{\"from\":\"2016-03-19\",\"to\":\"2016-03-25\",\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n-----\r\n```\r\nquery: from\":\"2016-03-20\",\"to\":\"2016-03-26\"\r\n```\r\n\r\n Shard: [index][0]\r\n[node_s1] Cache hit for reader version [5], max_doc[0] and request:\r\nSource:{\"size\":0,\"query\":{\"**match_none**\":{\"boost\":1.0}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\nShard: [index][1]\r\n[node_s2] Cache hit for reader version [5], max_doc[0] and request:\r\nSource:{\"size\":0,\"query\":{\"**match_none\"**:{\"boost\":1.0}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n Shard: [index][2]    has docs 2016-03-22  2016-03-24  **match_all**\r\n[node_s0] Cache miss for reader version [9], max_doc[3] and request:\r\nSource:{\"size\":0,\"query\":{\"range\":{\"s\":{\"from\":null,\"to\":null,\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n Shard: [index][3]  has docs 2016-03-19  2016-03-21 \r\n[node_s1] Cache miss for reader version [9], max_doc[3] and request:\r\nSource:{\"size\":0,\"query\":{\"range\":{\"s\":{\"from\":\"2016-03-20\",\"to\":\"2016-03-26\",\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n Shard: [index][4]  _has docs 2016-03-25  2016-03-27_\r\n[node_s2] Cache miss for reader version [9], max_doc[3] and request:\r\nSource:{\"size\":0,\"query\":{\"range\":{\"s\":{\"from\":\"2016-03-20\",\"to\":\"2016-03-26\",\"include_lower\":true,\"include_upper\":true,\"boost\":1.0}}},\"aggregations\":{\"global\":{\"global\":{}}}}\r\n\r\n---\r\n\r\nShard: [index][2] as it rewrites to match_all for both queries should be a hit in the second time, but it was a miss. Looks like cache doesn't work well","performed_via_github_app":null}]