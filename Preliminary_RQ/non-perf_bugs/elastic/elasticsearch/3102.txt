{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3102","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3102/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3102/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3102/events","html_url":"https://github.com/elastic/elasticsearch/issues/3102","id":14835678,"node_id":"MDU6SXNzdWUxNDgzNTY3OA==","number":3102,"title":"Root search analyzer doesn't act as default for fields","user":{"login":"gakhov","id":929775,"node_id":"MDQ6VXNlcjkyOTc3NQ==","avatar_url":"https://avatars2.githubusercontent.com/u/929775?v=4","gravatar_id":"","url":"https://api.github.com/users/gakhov","html_url":"https://github.com/gakhov","followers_url":"https://api.github.com/users/gakhov/followers","following_url":"https://api.github.com/users/gakhov/following{/other_user}","gists_url":"https://api.github.com/users/gakhov/gists{/gist_id}","starred_url":"https://api.github.com/users/gakhov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gakhov/subscriptions","organizations_url":"https://api.github.com/users/gakhov/orgs","repos_url":"https://api.github.com/users/gakhov/repos","events_url":"https://api.github.com/users/gakhov/events{/privacy}","received_events_url":"https://api.github.com/users/gakhov/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2013-05-28T11:55:06Z","updated_at":"2014-12-24T15:59:59Z","closed_at":"2014-12-24T15:59:59Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Recently, we moved from version `0.19.11` to last stable `0.90.0` and found one very strange behavior that looks like an issue.\n\nIf on the item root level we have specified our custom `index_analyzer`, `search_analyzer` (or just `analyzer`), then `index_analyzer` works well, but not the `search_analyzer`. Also, fif we update existing mapping with explicitly specifying `search_analyzer` on the field level, then it still doesn't seem to work and ES uses standard one.\n### To reproduce:\n\nCreate a new index and define our custom analyzer `de_stem`: \n\n```\ncurl -XPUT 'http://localhost:9200/issue/' -d '{\"index\": {\"number_of_shards\": 1,\"analysis\": {\"filter\": {\"de_snowball\": {\"type\": \"snowball\",\"language\": \"German\"}},\"analyzer\": {\"de_stem\": {\"type\": \"custom\",\"tokenizer\": \"standard\",\"filter\": [\"lowercase\", \"de_snowball\"]}}}}},\"number_of_replicas\": 0}}'\n```\n\nPut mapping with specified `index_analyzer` and `search_analyzer` :\n\n```\ncurl -XPUT 'http://localhost:9200/issue/item/_mapping' -d '{\"item\": {\"index_analyzer\" : \"de_stem\",\"search_analyzer\" : \"de_stem\",\"properties\": {\"content\": {\"dynamic\": false,\"properties\": {\"body\": {\"type\": \"string\"}}}}}}}'\n```\n\nTry `search_analyzer` for the field `content.body` with Analyze API\n\n```\ncurl -XGET 'localhost:9200/issue/_analyze?pretty=true&field=content.body' -d 'Apple'\n```\n#### Actual result:\n\n```\n{\n  \"tokens\" : [ {\n    \"token\" : \"apple\",\n    \"start_offset\" : 0,\n    \"end_offset\" : 5,\n    \"type\" : \"<ALPHANUM>\",\n    \"position\" : 1\n  } ]\n}\n```\n#### Expected result:\n\n```\n{\n  \"tokens\" : [ {\n    \"token\" : \"appl\",\n    \"start_offset\" : 0,\n    \"end_offset\" : 5,\n    \"type\" : \"<ALPHANUM>\",\n    \"position\" : 1\n  } ]\n}\n```\n\nThe right (expected) result still possible to get, but with explicitly specified `search_analyzer`:\n\n```\ncurl -XGET 'localhost:9200/issue/_analyze?pretty=true&field=content.body&analyzer=de_stem' -d 'Apple'\n```\n### Index Analyzer is set well\n\nAs we see above, `search_analyzer` seems wasn't set, but `index_analyzer`  works well.\n\nLet's index a document:\n\n```\ncurl -PUT 'http://localhost:9200/issue/item/1' -d '{\"content\" : {\"body\": \"10 Things We Hate About Apple\"}}'\n```\n\nIf `index_analyzer` was set well to `de_stem` the word `Apple` should be indexed as `appl`, but not `apple` (as `standard` analyzer does).\n\nLet's search for `appl` first:\n\n```\ncurl -XGET 'http://localhost:9200/issue/_search?search_type=count&pretty=true' -d '{\"query\":{\"query_string\":{\"fields\":[\"content.body\"],\"query\":\"appl\"}}}'\n```\n\nIt works! We get back 1 result:\n\n```\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 0.0,\n    \"hits\" : [ ]\n  }\n```\n\nFor the word `apple`, as expected, it doesn't work since `search_analyzer` is standard, but  `index_analyzer` is `de_stem` (so, actual search term will stay `apple`, but indexed is `appl`):\n\n```\ncurl -XGET 'http://localhost:9200/issue/_search?search_type=count&pretty=true' -d '{\"query\":{\"query_string\":{\"fields\":[\"content.body\"],\"query\":\"apple\"}}}'\n```\n\n```\n  \"hits\" : {\n    \"total\" : 0,\n    \"max_score\" : 0.0,\n    \"hits\" : [ ]\n  }\n```\n### Specifying search analyzer with Put Mapping API doesn't help\n\nOk, i try to update mapping and specify explicitly `search analyzer` for `content.body` field on the existing index we created above:\n\n```\ncurl -PUT 'http://localhost:9200/issue/item/_mapping' -d '{\"item\": {\"properties\": {\"content\": {\"dynamic\": false,\"properties\": {\"body\": {\"type\": \"string\", \"search_analyzer\": \"de_stem\"}}}}}}'\n```\n\nResponse is `ok`, but the all problems described above stay the same. So, it seems the `search_analyzer` for the field `content.body` is still `standard`.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}