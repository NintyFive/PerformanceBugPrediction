{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15707","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15707/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15707/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15707/events","html_url":"https://github.com/elastic/elasticsearch/issues/15707","id":124326319,"node_id":"MDU6SXNzdWUxMjQzMjYzMTk=","number":15707,"title":"pipeline agg could return value of a not-exists buckets_path","user":{"login":"chenryn","id":1219655,"node_id":"MDQ6VXNlcjEyMTk2NTU=","avatar_url":"https://avatars3.githubusercontent.com/u/1219655?v=4","gravatar_id":"","url":"https://api.github.com/users/chenryn","html_url":"https://github.com/chenryn","followers_url":"https://api.github.com/users/chenryn/followers","following_url":"https://api.github.com/users/chenryn/following{/other_user}","gists_url":"https://api.github.com/users/chenryn/gists{/gist_id}","starred_url":"https://api.github.com/users/chenryn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenryn/subscriptions","organizations_url":"https://api.github.com/users/chenryn/orgs","repos_url":"https://api.github.com/users/chenryn/repos","events_url":"https://api.github.com/users/chenryn/events{/privacy}","received_events_url":"https://api.github.com/users/chenryn/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-12-30T09:40:04Z","updated_at":"2016-03-01T08:55:44Z","closed_at":"2016-03-01T08:55:44Z","author_association":"NONE","active_lock_reason":null,"body":"Percentiles metric aggregtaion returns a multi-value result. And I know I can write `buckets_path` for multi-value like `bucketsname.metricname`.\n\nBut, the key of percentiles metric agg result is named like 50.0, 90.0, those also use DOT!\n\nI try to delete the `.0`, and find something other more interesting: pipeline agg can return values of a not-exists `buckets_path`.\n\nHere is my request:\n\n```\n{\n  \"aggs\" : {\n    \"my_date_histo\" : {\n      \"date_histogram\" : {\n        \"field\" : \"@timestamp\",\n        \"interval\" : \"1h\"\n      },\n      \"aggs\" : {\n        \"pcttime\" : {\n        \"percentiles\" : { \"field\" : \"num_field\" }\n        },\n        \"the_movavg45\" : {\n          \"moving_avg\" : {\n            \"buckets_path\" : \"pcttime.45\",\n            \"window\" : 10,\n            \"model\" : \"simple\"\n          }\n        },\n        \"the_movavg50\" : {\n          \"moving_avg\" : {\n            \"buckets_path\" : \"pcttime.50\",\n            \"window\" : 10,\n            \"model\" : \"simple\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nAnd the result:\n\n```\n\"aggregations\" : {\n    \"my_date_histo\" : {\n      \"buckets\" : [ {\n        \"key_as_string\" : \"2015-12-24T02:00:00.000Z\",\n        \"key\" : 1450922400000,\n        \"doc_count\" : 1462,\n        \"pcttime\" : {\n          \"values\" : {\n            \"1.0\" : 8.61,\n            \"5.0\" : 50.0,\n            \"25.0\" : 259.7801169590643,\n            \"50.0\" : 506.6208791208792,\n            \"75.0\" : 752.2619047619047,\n            \"95.0\" : 946.6333333333332,\n            \"99.0\" : 994.0\n          }\n        }\n      }, {\n        \"key_as_string\" : \"2015-12-24T03:00:00.000Z\",\n        \"key\" : 1450926000000,\n        \"doc_count\" : 13077,\n        \"pcttime\" : {\n          \"values\" : {\n            \"1.0\" : 10.25333333333333,\n            \"5.0\" : 52.61263736263737,\n            \"25.0\" : 253.4788589832068,\n            \"50.0\" : 501.97747099662007,\n            \"75.0\" : 752.0346378551421,\n            \"95.0\" : 949.8349473684209,\n            \"99.0\" : 988.0\n          }\n        },\n        \"the_movavg45\" : {\n          \"value\" : 466.2075\n        },\n        \"the_movavg50\" : {\n          \"value\" : 506.6208791208792\n        }\n      }, {\n```\n\nThere are no 45( nor 45.0) in `pcttime.values` of percentiles metric aggregation. How can the pipeline got the value of `pcttime.45`?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}