{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/63091","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63091/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63091/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63091/events","html_url":"https://github.com/elastic/elasticsearch/issues/63091","id":712132635,"node_id":"MDU6SXNzdWU3MTIxMzI2MzU=","number":63091,"title":"CI: GCSCleanupTests fail","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2020-09-30T17:22:35Z","updated_at":"2020-10-05T14:50:59Z","closed_at":"2020-10-05T14:50:59Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Build scan**:\r\nhttps://gradle-enterprise.elastic.co/s/4z3szwzixwyyg/tests?toggled=WyI6eC1wYWNrOnNuYXBzaG90LXRvb2w6cWE6Z29vZ2xlLWNsb3VkLXN0b3JhZ2UtZ2NzdGhpcmRwYXJ0eXRlc3Qtb3JnLmVsYXN0aWNzZWFyY2guc25hcHNob3RzLWdjc2NsZWFudXB0ZXN0cyJd\r\n\r\n**Repro line**:\r\n```\r\n  1> [2020-09-30T21:13:02,303][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] before test\r\n  1> [2020-09-30T21:13:02,305][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] --> execute cleanup tool on empty repo, there is nothing to cleanup\r\n  1> [2020-09-30T21:13:02,428][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] Cleanup command output:\r\n  1> Obtaining latest index file generation and creation timestamp\r\n  1> No index-N files found. Repository is empty or corrupted? Exiting\r\n\r\n  1> [2020-09-30T21:13:02,438][DEPRECATION][o.e.d.c.m.MetadataCreateIndexService] [node_s_0] index [test-idx-1] matches multiple legacy templates [one_shard_index_template, random-soft-deletes-template], composable templates will only match a single template\r\n  1> [2020-09-30T21:13:02,452][INFO ][o.e.c.m.MetadataCreateIndexService] [node_s_0] [test-idx-1] creating index, cause [api], templates [random-soft-deletes-template, one_shard_index_template], shards [1]/[0]\r\n  1> [2020-09-30T21:13:02,679][INFO ][o.e.c.r.a.AllocationService] [node_s_0] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[test-idx-1][0]]]).\r\n  1> [2020-09-30T21:13:02,721][DEPRECATION][o.e.d.c.m.MetadataCreateIndexService] [node_s_0] index [test-idx-2] matches multiple legacy templates [one_shard_index_template, random-soft-deletes-template], composable templates will only match a single template\r\n  1> [2020-09-30T21:13:02,727][INFO ][o.e.c.m.MetadataCreateIndexService] [node_s_0] [test-idx-2] creating index, cause [api], templates [random-soft-deletes-template, one_shard_index_template], shards [1]/[0]\r\n  1> [2020-09-30T21:13:02,775][INFO ][o.e.c.r.a.AllocationService] [node_s_0] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[test-idx-2][0]]]).\r\n  1> [2020-09-30T21:13:02,794][DEPRECATION][o.e.d.c.m.MetadataCreateIndexService] [node_s_0] index [test-idx-3] matches multiple legacy templates [one_shard_index_template, random-soft-deletes-template], composable templates will only match a single template\r\n  1> [2020-09-30T21:13:02,799][INFO ][o.e.c.m.MetadataCreateIndexService] [node_s_0] [test-idx-3] creating index, cause [api], templates [random-soft-deletes-template, one_shard_index_template], shards [1]/[0]\r\n  1> [2020-09-30T21:13:02,838][INFO ][o.e.c.r.a.AllocationService] [node_s_0] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[test-idx-3][0]]]).\r\n  1> [2020-09-30T21:13:02,855][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] --> indexing some data\r\n  1> [2020-09-30T21:13:02,926][INFO ][o.e.c.m.MetadataMappingService] [node_s_0] [test-idx-1/bvgqIszGSo-8ZvVA3VFJRg] create_mapping [doc]\r\n  1> [2020-09-30T21:13:02,990][INFO ][o.e.c.m.MetadataMappingService] [node_s_0] [test-idx-2/nSr6fJXsQdawfpxJhhsI7Q] create_mapping [doc]\r\n  1> [2020-09-30T21:13:03,028][INFO ][o.e.c.m.MetadataMappingService] [node_s_0] [test-idx-3/Ag8FcvBaQ8asivVDhBoePg] create_mapping [doc]\r\n  1> [2020-09-30T21:13:03,717][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] Iteration number 1\r\n  1> [2020-09-30T21:13:03,717][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] --> create first snapshot\r\n  1> [2020-09-30T21:13:03,777][INFO ][o.e.s.SnapshotsService   ] [node_s_0] snapshot [test-repo:snap1/QwR-0bDVS-Kj10S_GDe2uA] started\r\n  1> [2020-09-30T21:13:04,895][INFO ][o.e.s.SnapshotsService   ] [node_s_0] snapshot [test-repo:snap1/QwR-0bDVS-Kj10S_GDe2uA] completed with state [SUCCESS]\r\n  1> [2020-09-30T21:13:04,949][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] --> execute cleanup tool, there is nothing to cleanup\r\n  1> [2020-09-30T21:13:05,261][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] Cleanup command output:\r\n  1> Obtaining latest index file generation and creation timestamp\r\n  1> Latest index file generation is 0\r\n  1> Latest index file creation timestamp is Wed Sep 30 21:13:04 AMT 2020\r\n  1> Shifted by safety gap creation timestamp is Wed Sep 30 21:13:04 AMT 2020\r\n  1> Reading latest index file\r\n  1> Failed to read [incompatible-snapshots] blob\r\n./gradlew ':x-pack:snapshot-tool:qa:google-cloud-storage:gcsThirdPartyTest' \\\r\n  --tests \"org.elasticsearch.snapshots.GCSCleanupTests.testCleanup\" \\\r\n  -Dtests.seed=EBDFEEEBDF79EE6A -Dtests.security.manager=false -Dtests.locale=es-DO -Dtests.timezone=Asia/Yerevan -Druntime.java=8\t\r\n```\r\n\r\n**Reproduces locally?**:\r\nI don't have the creds.\r\n\r\n**Applicable branches**:\r\n\r\n**Failure history**:\r\nLooks to have started failing on 2020-9-24:\r\nhttps://build-stats.elastic.co/goto/8c635f54f2b8231275d485652b34ba6c\r\n\r\n**Failure excerpt**:\r\n```\r\n  1> [2020-09-30T21:13:05,262][INFO ][o.e.s.GCSCleanupTests    ] [testCleanup] after test\r\n  1> [2020-09-30T21:13:05,264][INFO ][o.e.c.m.MetadataDeleteIndexService] [node_s_0] [test-idx-3/Ag8FcvBaQ8asivVDhBoePg] deleting index\r\n  1> [2020-09-30T21:13:05,265][INFO ][o.e.c.m.MetadataDeleteIndexService] [node_s_0] [test-idx-2/nSr6fJXsQdawfpxJhhsI7Q] deleting index\r\n  1> [2020-09-30T21:13:05,265][INFO ][o.e.c.m.MetadataDeleteIndexService] [node_s_0] [test-idx-1/bvgqIszGSo-8ZvVA3VFJRg] deleting index\r\n  2> REPRODUCE WITH: ./gradlew ':x-pack:snapshot-tool:qa:google-cloud-storage:gcsThirdPartyTest' --tests \"org.elasticsearch.snapshots.GCSCleanupTests.testCleanup\" -Dtests.seed=EBDFEEEBDF79EE6A -Dtests.security.manager=false -Dtests.locale=es-DO -Dtests.timezone=Asia/Yerevan -Druntime.java=8\r\n  2> java.io.IOException: com.google.cloud.RetryHelper$RetryHelperException: com.google.cloud.storage.StorageException: 404 Not Found\r\n    GET https://storage.googleapis.com/download/storage/v1/b/elasticsearch-ci-thirdparty/o/7.x%2Fincompatible-snapshots?alt=media\r\n    No such object: elasticsearch-ci-thirdparty/7.x/incompatible-snapshots\r\n        at __randomizedtesting.SeedInfo.seed([EBDFEEEBDF79EE6A:BBF5BD45A6D47EDF]:0)\r\n        at com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:141)\r\n        at sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65)\r\n        at sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109)\r\n        at sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103)\r\n        at java.io.InputStream.read(InputStream.java:101)\r\n        at org.elasticsearch.core.internal.io.Streams.copy(Streams.java:57)\r\n        at org.elasticsearch.core.internal.io.Streams.copy(Streams.java:91)\r\n        at org.elasticsearch.snapshots.AbstractRepository.getIncompatibleSnapshots(AbstractRepository.java:91)\r\n        at org.elasticsearch.snapshots.AbstractRepository.cleanup(AbstractRepository.java:173)\r\n        at org.elasticsearch.snapshots.AbstractCleanupCommand.execute(AbstractCleanupCommand.java:48)\r\n        at org.elasticsearch.snapshots.GCSCleanupTests.lambda$commandRunnable$0(GCSCleanupTests.java:101)\r\n\r\n        Caused by:\r\n        com.google.cloud.RetryHelper$RetryHelperException: com.google.cloud.storage.StorageException: 404 Not Found\r\n        GET https://storage.googleapis.com/download/storage/v1/b/elasticsearch-ci-thirdparty/o/7.x%2Fincompatible-snapshots?alt=media\r\n        No such object: elasticsearch-ci-thirdparty/7.x/incompatible-snapshots\r\n            at com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:54)\r\n            at com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123)\r\n            ... 10 more\r\n\r\n            Caused by:\r\n            com.google.cloud.storage.StorageException: 404 Not Found\r\n            GET https://storage.googleapis.com/download/storage/v1/b/elasticsearch-ci-thirdparty/o/7.x%2Fincompatible-snapshots?alt=media\r\n            No such object: elasticsearch-ci-thirdparty/7.x/incompatible-snapshots\r\n                at com.google.cloud.storage.StorageException.translate(StorageException.java:97)\r\n                at com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:728)\r\n                at com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127)\r\n                at com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124)\r\n                at com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105)\r\n                at com.google.cloud.RetryHelper.run(RetryHelper.java:76)\r\n                at com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50)\r\n                ... 11 more\r\n\r\n                Caused by:\r\n                com.google.api.client.googleapis.json.GoogleJsonResponseException: 404 Not Found\r\n                GET https://storage.googleapis.com/download/storage/v1/b/elasticsearch-ci-thirdparty/o/7.x%2Fincompatible-snapshots?alt=media\r\n                No such object: elasticsearch-ci-thirdparty/7.x/incompatible-snapshots\r\n                    at com.google.api.client.googleapis.json.GoogleJsonResponseException.from(GoogleJsonResponseException.java:149)\r\n                    at com.google.api.client.googleapis.services.json.AbstractGoogleJsonClientRequest.newExceptionOnError(AbstractGoogleJsonClientRequest.java:112)\r\n                    at com.google.api.client.googleapis.services.json.AbstractGoogleJsonClientRequest.newExceptionOnError(AbstractGoogleJsonClientRequest.java:39)\r\n                    at com.google.api.client.googleapis.services.AbstractGoogleClientRequest$1.interceptResponse(AbstractGoogleClientRequest.java:443)\r\n                    at com.google.api.client.http.HttpRequest.execute(HttpRequest.java:1108)\r\n                    at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeUnparsed(AbstractGoogleClientRequest.java:541)\r\n                    at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeUnparsed(AbstractGoogleClientRequest.java:474)\r\n                    at com.google.api.client.googleapis.services.AbstractGoogleClientRequest.executeMedia(AbstractGoogleClientRequest.java:502)\r\n                    at com.google.api.services.storage.Storage$Objects$Get.executeMedia(Storage.java:7029)\r\n                    at com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:723)\r\n                    ... 16 more\r\n  1> [2020-09-30T21:13:05,834][INFO ][o.e.s.GCSCleanupTests    ] [testNegativeSafetyGap] before test\r\n```\r\n\r\n","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}