{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16583","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16583/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16583/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16583/events","html_url":"https://github.com/elastic/elasticsearch/issues/16583","id":132725681,"node_id":"MDU6SXNzdWUxMzI3MjU2ODE=","number":16583,"title":"'size' parameter ignored when executing a function_score query","user":{"login":"ryanmcilmoyl","id":10815,"node_id":"MDQ6VXNlcjEwODE1","avatar_url":"https://avatars3.githubusercontent.com/u/10815?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanmcilmoyl","html_url":"https://github.com/ryanmcilmoyl","followers_url":"https://api.github.com/users/ryanmcilmoyl/followers","following_url":"https://api.github.com/users/ryanmcilmoyl/following{/other_user}","gists_url":"https://api.github.com/users/ryanmcilmoyl/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanmcilmoyl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanmcilmoyl/subscriptions","organizations_url":"https://api.github.com/users/ryanmcilmoyl/orgs","repos_url":"https://api.github.com/users/ryanmcilmoyl/repos","events_url":"https://api.github.com/users/ryanmcilmoyl/events{/privacy}","received_events_url":"https://api.github.com/users/ryanmcilmoyl/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"assignees":[{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2016-02-10T15:12:19Z","updated_at":"2016-02-12T16:45:10Z","closed_at":"2016-02-12T16:45:10Z","author_association":"NONE","active_lock_reason":null,"body":"It seems that the order of the keys in the search body matter when executing a function_score query.  Consider these 2 cURL requests:\n\n```\n    curl -d '{\n        \"query\":{\n            \"function_score\":{\n                \"random_score\":{},\n                \"query\":{\n                    \"bool\":{\n                        \"must\":{\"match\":{\"location\":\"London\"}}},\n                        \"filter\":{\"bool\":{\n                            \"must\":[\n                                {\"match\":{\"location\":\"London\"}},\n                                {\"term\":{\"state\":\"approved\"}},\n                                {\"range\":{\"num_reviews\":{\"gte\":3}}}\n                            ]\n                        }\n                    }\n                }\n            }\n        },\n        \"size\": 1\n        }' \"http://localhost:9200/agent_profiles_development/_search?pretty\"\n\nIn this case, size is ignored and the default of 10 is used.  If we move the `size` key as so:\n```\n\n```\ncurl -d '{\n    \"size\": 1,\n    \"query\":{\n        \"function_score\":{\n            \"random_score\":{},\n            \"query\":{\n                \"bool\":{\n                    \"must\":{\"match\":{\"location\":\"London\"}}},\n                    \"filter\":{\"bool\":{\n                        \"must\":[\n                            {\"match\":{\"location\":\"London\"}},\n                            {\"term\":{\"state\":\"approved\"}},\n                            {\"range\":{\"num_reviews\":{\"gte\":3}}}\n                        ]\n                    }\n                }\n            }\n        }\n    }\n    }' \"http://localhost:9200/agent_profiles_development/_search?pretty\"\n```\n\nThen it works as expected.\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}