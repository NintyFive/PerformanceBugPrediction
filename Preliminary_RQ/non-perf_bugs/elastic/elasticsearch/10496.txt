{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10496","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10496/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10496/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10496/events","html_url":"https://github.com/elastic/elasticsearch/issues/10496","id":67260601,"node_id":"MDU6SXNzdWU2NzI2MDYwMQ==","number":10496,"title":"Highlighting captures all fields regardless of a search query","user":{"login":"sarastinishi","id":1760979,"node_id":"MDQ6VXNlcjE3NjA5Nzk=","avatar_url":"https://avatars2.githubusercontent.com/u/1760979?v=4","gravatar_id":"","url":"https://api.github.com/users/sarastinishi","html_url":"https://github.com/sarastinishi","followers_url":"https://api.github.com/users/sarastinishi/followers","following_url":"https://api.github.com/users/sarastinishi/following{/other_user}","gists_url":"https://api.github.com/users/sarastinishi/gists{/gist_id}","starred_url":"https://api.github.com/users/sarastinishi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sarastinishi/subscriptions","organizations_url":"https://api.github.com/users/sarastinishi/orgs","repos_url":"https://api.github.com/users/sarastinishi/repos","events_url":"https://api.github.com/users/sarastinishi/events{/privacy}","received_events_url":"https://api.github.com/users/sarastinishi/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-04-09T01:57:15Z","updated_at":"2016-10-27T07:24:12Z","closed_at":"2015-04-09T07:37:29Z","author_association":"NONE","active_lock_reason":null,"body":"When searching for document with highlighting turned on all found keywords are highlighted regardless of a field. This means that when searching for some document with a **text** field \"africa\" and a **name** field \"return\" ES will highlight \"africa\" and \"return\" tokens in both text and title:\n\n```\n...\n\"highlight\": {\n   \"name\": [\n       \"[+highlight+]Return[-highlight-] from [+highlight+]Africa[-highlight-]\"\n   ],\n   \"text\": [\n      \"[+highlight+]Return[-highlight-] from [+highlight+]Africa[-highlight-]\\r\\nDate:\\r\\n\"\n   ]\n}\n...\n```\n\nHowever \"return\" token has to be highlighted within **name** and \"africa\" within **text** field only.\n\n![highlighting_issue_red](https://cloud.githubusercontent.com/assets/1760979/7059101/45f99422-deae-11e4-9fb9-41bcaa8923b8.png)\n\n```\n[ES]: \n{\n   \"status\": 200,\n   \"version\": {\n      \"number\": \"1.4.2\",\n      \"lucene_version\": \"4.10.2\"\n   },\n   \"tagline\": \"You Know, for Search\"\n}\n```\n\n```\n[FULL QUERY]:\nPOST documents/_search\n{\n   \"highlight\": {\n      \"pre_tags\": [\n         \"[+highlight+]\"\n      ],\n      \"post_tags\": [\n         \"[-highlight-]\"\n      ],\n      \"number_of_fragments\": 0,\n      \"fields\": {\n         \"text\": {},\n         \"name\": {}\n      }\n   },\n   \"query\": {\n      \"filtered\": {\n         \"query\": {\n            \"bool\": {\n               \"must\": [\n                  {\n                     \"bool\": {\n                        \"must\": [\n                           {\n                              \"bool\": {\n                                 \"must\": [\n                                    {\n                                       \"query_string\": {\n                                          \"query\": \"africa\",\n                                          \"fields\": [\n                                             \"text\"\n                                          ],\n                                          \"default_operator\": \"and\",\n                                          \"analyze_wildcard\": true\n                                       }\n                                    }\n                                 ]\n                              }\n                           },\n                           {\n                              \"bool\": {\n                                 \"must\": [\n                                    {\n                                       \"query_string\": {\n                                          \"query\": \"return\",\n                                          \"fields\": [\n                                             \"name\"\n                                          ],\n                                          \"default_operator\": \"and\",\n                                          \"analyze_wildcard\": true\n                                       }\n                                    }\n                                 ]\n                              }\n                           }\n                        ]\n                     }\n                  }\n               ]\n            }\n         },\n         \"filter\": {\n            \"ids\": {\n               \"values\": [\n                  \"cc1db8f5-80bd-48a1-9b3e-3256dd99b0db\"\n               ]\n            }\n         }\n      }\n   }\n}\n```\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}