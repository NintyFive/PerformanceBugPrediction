[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/443229825","html_url":"https://github.com/elastic/elasticsearch/issues/36114#issuecomment-443229825","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36114","id":443229825,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MzIyOTgyNQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-11-30T15:01:30Z","updated_at":"2018-11-30T15:01:30Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/443265703","html_url":"https://github.com/elastic/elasticsearch/issues/36114#issuecomment-443265703","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36114","id":443265703,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MzI2NTcwMw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-11-30T16:49:52Z","updated_at":"2018-11-30T16:49:52Z","author_association":"CONTRIBUTOR","body":"It looks like `read_only_allow_delete` is documented as \"Identical to `index.blocks.read_only` but allows deleting the index to free up resources.\" Deleting documents from an index actually makes the index bigger in the short run. In the long run we merge the documents out of the index and the index will shrink on disk. Those merges have to write a second copy of the live data and I'm pretty sure we won't start a merge that it looks like we don't have room to finish.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446621038","html_url":"https://github.com/elastic/elasticsearch/issues/36114#issuecomment-446621038","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36114","id":446621038,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjYyMTAzOA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-12-12T15:09:51Z","updated_at":"2018-12-12T15:09:51Z","author_association":"CONTRIBUTOR","body":"As @nik9000 pointed out, allowing document deletion will not immediately make the index smaller, but can even temporarily make it larger. We should improve the error message and documentation here, however. I'm marking the issue as adoptme (for the docs/error message change).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447261190","html_url":"https://github.com/elastic/elasticsearch/issues/36114#issuecomment-447261190","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36114","id":447261190,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzI2MTE5MA==","user":{"login":"makubi","id":458537,"node_id":"MDQ6VXNlcjQ1ODUzNw==","avatar_url":"https://avatars2.githubusercontent.com/u/458537?v=4","gravatar_id":"","url":"https://api.github.com/users/makubi","html_url":"https://github.com/makubi","followers_url":"https://api.github.com/users/makubi/followers","following_url":"https://api.github.com/users/makubi/following{/other_user}","gists_url":"https://api.github.com/users/makubi/gists{/gist_id}","starred_url":"https://api.github.com/users/makubi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/makubi/subscriptions","organizations_url":"https://api.github.com/users/makubi/orgs","repos_url":"https://api.github.com/users/makubi/repos","events_url":"https://api.github.com/users/makubi/events{/privacy}","received_events_url":"https://api.github.com/users/makubi/received_events","type":"User","site_admin":false},"created_at":"2018-12-14T09:04:00Z","updated_at":"2018-12-14T09:04:00Z","author_association":"NONE","body":"Hi @nik9000 and @ywelsch, thank you for the information.\r\n\r\nYou're right that the documentation for `index.blocks.read_only_allow_delete` is correct, because it does not mention that deleting documents is allowed. Maybe the information you provided here can be helpful for others, nevertheless.\r\n\r\nThanks.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/547973957","html_url":"https://github.com/elastic/elasticsearch/issues/36114#issuecomment-547973957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36114","id":547973957,"node_id":"MDEyOklzc3VlQ29tbWVudDU0Nzk3Mzk1Nw==","user":{"login":"wchrisdean","id":53786748,"node_id":"MDQ6VXNlcjUzNzg2NzQ4","avatar_url":"https://avatars2.githubusercontent.com/u/53786748?v=4","gravatar_id":"","url":"https://api.github.com/users/wchrisdean","html_url":"https://github.com/wchrisdean","followers_url":"https://api.github.com/users/wchrisdean/followers","following_url":"https://api.github.com/users/wchrisdean/following{/other_user}","gists_url":"https://api.github.com/users/wchrisdean/gists{/gist_id}","starred_url":"https://api.github.com/users/wchrisdean/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wchrisdean/subscriptions","organizations_url":"https://api.github.com/users/wchrisdean/orgs","repos_url":"https://api.github.com/users/wchrisdean/repos","events_url":"https://api.github.com/users/wchrisdean/events{/privacy}","received_events_url":"https://api.github.com/users/wchrisdean/received_events","type":"User","site_admin":false},"created_at":"2019-10-30T15:47:34Z","updated_at":"2019-10-30T15:47:34Z","author_association":"CONTRIBUTOR","body":"[doc issue triage]","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/634266378","html_url":"https://github.com/elastic/elasticsearch/issues/36114#issuecomment-634266378","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36114","id":634266378,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNDI2NjM3OA==","user":{"login":"lockewritesdocs","id":25848033,"node_id":"MDQ6VXNlcjI1ODQ4MDMz","avatar_url":"https://avatars2.githubusercontent.com/u/25848033?v=4","gravatar_id":"","url":"https://api.github.com/users/lockewritesdocs","html_url":"https://github.com/lockewritesdocs","followers_url":"https://api.github.com/users/lockewritesdocs/followers","following_url":"https://api.github.com/users/lockewritesdocs/following{/other_user}","gists_url":"https://api.github.com/users/lockewritesdocs/gists{/gist_id}","starred_url":"https://api.github.com/users/lockewritesdocs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lockewritesdocs/subscriptions","organizations_url":"https://api.github.com/users/lockewritesdocs/orgs","repos_url":"https://api.github.com/users/lockewritesdocs/repos","events_url":"https://api.github.com/users/lockewritesdocs/events{/privacy}","received_events_url":"https://api.github.com/users/lockewritesdocs/received_events","type":"User","site_admin":false},"created_at":"2020-05-26T20:38:57Z","updated_at":"2020-05-26T20:38:57Z","author_association":"CONTRIBUTOR","body":"Under [Dynamic index settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#dynamic-index-settings), the description for `index.blocks.read_only_allow_delete` reads:\r\n>Similar to index.blocks.read_only but also allows deleting the index to free up resources.\r\n\r\nAfter a bit of research, I propose the following changes:\r\n\r\n1. Consider removing \"to free up resources\" from the existing description, since that seems to be a misnomer based on the conversations above.\r\n\r\n1. Add the default, which appears to be `false` (based on [this line](https://github.com/elastic/elasticsearch/blob/117055d49e6bed1c553ed937c6a5a54e89a37f9a/server/src/main/java/org/elasticsearch/cluster/metadata/Metadata.java#L143)).\r\n\r\n1. Add a clarifying note to the effect of:\r\n>NOTE: Deleting documents from an index to release resources can increase the index size over time. Instead, consider _this other thing_.\r\n\r\nAdmittedly, I don't know what _this other thing_ is. Should we invite users to review the [General recommendations](https://www.elastic.co/guide/en/elasticsearch/reference/current/general-recommendations.html) and possibly [Tune for disk usage](https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-disk-usage.html)? @nik9000 and @ywelsch, I defer to your wisdom here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/634289481","html_url":"https://github.com/elastic/elasticsearch/issues/36114#issuecomment-634289481","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36114","id":634289481,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNDI4OTQ4MQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2020-05-26T21:28:51Z","updated_at":"2020-05-26T21:28:51Z","author_association":"CONTRIBUTOR","body":"Thanks for picking this up @lockewritesdocs. \r\n\r\nThere's two very distinct concepts here: deleting documents from an index, and deleting the index itself. Deleting documents from an index doesn't necessarily free up resources and may in fact consume additional resources, and is therefore not permitted when the read-only-allow-delete block is in place. Deleting the index itself does free up resources pretty much straight away, and is a sensible way to free up disk space and therefore release a read-only-allow-delete block.\r\n\r\nDelete-by-query is one way to delete documents from an index, and doesn't delete the index itself, so it's a special case of the above..\r\n\r\nTherefore:\r\n\r\n1. I think the \"to free up resources\" bit is correct, but perhaps we can clarify the distinction between the two concepts mentioned above.\r\n\r\n2. Elasticsearch adds and removes the read-only-allow-delete block automatically, so I think it might be misleading to document that the default is `false`. In fact I would like there to be stronger wording to discourage users from setting this block themselves: the intention is that it's only applied automatically.\r\n\r\n3. Adding a clarifying note seems reasonable, and _this other thing_ is deleting indices as opposed to deleting documents from indices.","performed_via_github_app":null}]