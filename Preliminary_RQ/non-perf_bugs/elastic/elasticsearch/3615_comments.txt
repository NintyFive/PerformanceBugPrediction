[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24712691","html_url":"https://github.com/elastic/elasticsearch/issues/3615#issuecomment-24712691","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3615","id":24712691,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NzEyNjkx","user":{"login":"junjun-zhang","id":1071695,"node_id":"MDQ6VXNlcjEwNzE2OTU=","avatar_url":"https://avatars2.githubusercontent.com/u/1071695?v=4","gravatar_id":"","url":"https://api.github.com/users/junjun-zhang","html_url":"https://github.com/junjun-zhang","followers_url":"https://api.github.com/users/junjun-zhang/followers","following_url":"https://api.github.com/users/junjun-zhang/following{/other_user}","gists_url":"https://api.github.com/users/junjun-zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/junjun-zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/junjun-zhang/subscriptions","organizations_url":"https://api.github.com/users/junjun-zhang/orgs","repos_url":"https://api.github.com/users/junjun-zhang/repos","events_url":"https://api.github.com/users/junjun-zhang/events{/privacy}","received_events_url":"https://api.github.com/users/junjun-zhang/received_events","type":"User","site_admin":false},"created_at":"2013-09-19T01:55:40Z","updated_at":"2013-09-19T01:55:40Z","author_association":"NONE","body":"With **\"join\": false** option, facet will produce desired result. When join is disabled, facet will apply to the nested documents instead of the joined root document. See https://github.com/elasticsearch/elasticsearch/issues/2606 for more details.\n\n``` javascript\n{\n   \"size\":0,\n   \"facets\":{\n      \"nested1\":{\n         \"terms\":{\n            \"field\":\"x\"\n         },\n         \"nested\":\"nested1\",\n         \"facet_filter\":{\n            \"nested\":{\n               \"path\":\"nested1\",\n               \"join\":false,\n               \"query\":{\n                  \"match_all\":{}\n               }\n            }\n         }\n      }\n   }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24738603","html_url":"https://github.com/elastic/elasticsearch/issues/3615#issuecomment-24738603","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3615","id":24738603,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NzM4NjAz","user":{"login":"btiernay","id":2717578,"node_id":"MDQ6VXNlcjI3MTc1Nzg=","avatar_url":"https://avatars3.githubusercontent.com/u/2717578?v=4","gravatar_id":"","url":"https://api.github.com/users/btiernay","html_url":"https://github.com/btiernay","followers_url":"https://api.github.com/users/btiernay/followers","following_url":"https://api.github.com/users/btiernay/following{/other_user}","gists_url":"https://api.github.com/users/btiernay/gists{/gist_id}","starred_url":"https://api.github.com/users/btiernay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/btiernay/subscriptions","organizations_url":"https://api.github.com/users/btiernay/orgs","repos_url":"https://api.github.com/users/btiernay/repos","events_url":"https://api.github.com/users/btiernay/events{/privacy}","received_events_url":"https://api.github.com/users/btiernay/received_events","type":"User","site_admin":false},"created_at":"2013-09-19T13:33:27Z","updated_at":"2013-09-19T13:33:33Z","author_association":"NONE","body":"@junjun-zhang  Ah, very nice. Didn't know that option existed as it is undocumented. Thanks :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24739716","html_url":"https://github.com/elastic/elasticsearch/issues/3615#issuecomment-24739716","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3615","id":24739716,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NzM5NzE2","user":{"login":"junjun-zhang","id":1071695,"node_id":"MDQ6VXNlcjEwNzE2OTU=","avatar_url":"https://avatars2.githubusercontent.com/u/1071695?v=4","gravatar_id":"","url":"https://api.github.com/users/junjun-zhang","html_url":"https://github.com/junjun-zhang","followers_url":"https://api.github.com/users/junjun-zhang/followers","following_url":"https://api.github.com/users/junjun-zhang/following{/other_user}","gists_url":"https://api.github.com/users/junjun-zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/junjun-zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/junjun-zhang/subscriptions","organizations_url":"https://api.github.com/users/junjun-zhang/orgs","repos_url":"https://api.github.com/users/junjun-zhang/repos","events_url":"https://api.github.com/users/junjun-zhang/events{/privacy}","received_events_url":"https://api.github.com/users/junjun-zhang/received_events","type":"User","site_admin":false},"created_at":"2013-09-19T13:48:48Z","updated_at":"2013-09-19T13:48:48Z","author_association":"NONE","body":"Yes, this should be documented, and maybe **\"join\":false** should be the default when **join** option is omitted. I assume more users expect nested facets work on nested docs instead of joined root docs.\n","performed_via_github_app":null}]