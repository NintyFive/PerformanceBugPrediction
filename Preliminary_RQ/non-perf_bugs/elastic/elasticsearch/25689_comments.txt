[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/315022170","html_url":"https://github.com/elastic/elasticsearch/issues/25689#issuecomment-315022170","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25689","id":315022170,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNTAyMjE3MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-07-13T09:19:07Z","updated_at":"2017-07-13T09:19:07Z","author_association":"MEMBER","body":"@talevy don't forget to assign people. ;) \r\n\r\n@ywelsch do you mind taking a look?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/315065878","html_url":"https://github.com/elastic/elasticsearch/issues/25689#issuecomment-315065878","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25689","id":315065878,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNTA2NTg3OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-07-13T12:41:28Z","updated_at":"2017-07-13T12:41:28Z","author_association":"CONTRIBUTOR","body":"Note that this is ES v5.2.\r\nWhat happened here is that there was a network partition, where a cluster state failed to be published to one of the nodes, and where the node did not notice that it was partitioned from the master, (i.e. the partition was shorter than the fault detection ping interval). This resulted in the cluster on the node being older than the one on the master, tripping an assertion that does not exist like that anymore on the master branch. Maybe fixed by https://github.com/elastic/elasticsearch/pull/25320?\r\n\r\nRelevant log lines:\r\n\r\n```\r\n1> [2017-07-11T15:28:25,024][INFO ][o.e.d.DiscoveryWithServiceDisruptionsIT] disruption scheme [network disruption (disruption type: network disconnects, disrupted links: bridge partition (super connected node: [node_t0], partition 1: [node_t2] and partition 2: [node_t1]))] added\r\n...\r\n1> [2017-07-11T15:28:25,058][TRACE][o.e.c.s.ClusterService   ] [node_t0] calling [org.elasticsearch.gateway.Gateway@271dd854] with change to version [6]\r\n  1> [2017-07-11T15:28:25,055][DEBUG][o.e.d.z.PublishClusterStateAction] [node_t2] failed to send cluster state to {node_t1}{r4Cc41HqTxCZmgFbEkWRuA}{MvXysgoDRbGP0GViujBZcw}{127.0.0.1}{127.0.0.1:30301}\r\n  1> org.elasticsearch.transport.SendRequestTransportException: [node_t1][127.0.0.1:30301][internal:discovery/zen/publish/send]\r\n  1> \tat org.elasticsearch.transport.TransportService.sendRequestInternal(TransportService.java:564) ~[main/:?]\r\n...\r\n1> [2017-07-11T15:28:25,068][INFO ][o.e.t.d.NetworkDisruption] stop disrupting (disruption scheme: network disconnects, disrupted links: bridge partition (super connected node: [node_t0], partition 1: [node_t2] and partition 2: [node_t1]))\r\n...\r\n1> [2017-07-11T15:28:25,085][DEBUG][o.e.d.DiscoveryWithServiceDisruptionsIT] indices [test] are green\r\n...\r\n > Throwable #1: java.lang.AssertionError: \r\n   > Expected: a value equal to or greater than <6L>\r\n   >      but: <5L> was less than <6L>\r\n   > \tat __randomizedtesting.SeedInfo.seed([F8108036B5FA3F4D:72D134C5E987D906]:0)\r\n   > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   > \tat org.elasticsearch.discovery.DiscoveryWithServiceDisruptionsIT.lambda$testAckedIndexing$3(DiscoveryWithServiceDisruptionsIT.java:591)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:662)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:636)\r\n   > \tat org.elasticsearch.discovery.DiscoveryWithServiceDisruptionsIT.testAckedIndexing(DiscoveryWithServiceDisruptionsIT.java:589)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/315435837","html_url":"https://github.com/elastic/elasticsearch/issues/25689#issuecomment-315435837","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25689","id":315435837,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNTQzNTgzNw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-07-14T18:40:40Z","updated_at":"2017-07-14T18:40:40Z","author_association":"MEMBER","body":"@ywelsch thanks for looking. Makes sense to me. I don't know if that PR fixed things as it was response to, I think, more recent refactoring in `TcpTransport` than 5.2. That said, there is no point in chasing such a race condition in the old code - it's been refactored anyway. I'm closing this.","performed_via_github_app":null}]