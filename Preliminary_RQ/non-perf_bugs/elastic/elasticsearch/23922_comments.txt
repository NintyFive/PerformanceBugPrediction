[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292538067","html_url":"https://github.com/elastic/elasticsearch/issues/23922#issuecomment-292538067","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23922","id":292538067,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjUzODA2Nw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-07T13:36:40Z","updated_at":"2017-04-07T13:36:40Z","author_association":"CONTRIBUTOR","body":"The first failure happens for the following reason:\r\n- 4 nodes (nodes 0, 1, 2, and 3) running with `minimum_master_nodes` set to 3\r\n- we stop 2 nodes (node 0 and 3)\r\n- wait for cluster block to be in place on all nodes\r\n- start 2 nodes (node 4 and node 5) and do a `prepareHealth().setWaitForNodes(\"4\")`\r\n- then do a search request\r\n\r\nThe search request runs into the `ClusterBlockException` as the `prepareHealth().setWaitForNodes(\"4\")` check succeeds on a cluster state that has nodes 1, 2, 3, and 4, i.e., only one of the two new nodes has joined the cluster and only one of the two dead nodes was removed by the master (removing the dead nodes only happens after there are again `minimum_master_nodes` nodes in the cluster).\r\n\r\nI pushed a3cceb8a00 which uses a method from `InternalTestCluster` that checks that the right nodes have rejoined the cluster.\r\n\r\nThe second failure is similar in nature, here the search fails for a shard on a dead node that has not been booted yet off the cluster. The fix above also fixes that situation.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298341073","html_url":"https://github.com/elastic/elasticsearch/issues/23922#issuecomment-298341073","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23922","id":298341073,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODM0MTA3Mw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-05-01T14:18:23Z","updated_at":"2017-05-01T14:18:23Z","author_association":"MEMBER","body":"@ywelsch is this recent failure related or something completely different? https://elasticsearch- ci.elastic.co/job/elastic+elasticsearch+5.x+multijob-darwin-compatibility/441","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298510559","html_url":"https://github.com/elastic/elasticsearch/issues/23922#issuecomment-298510559","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23922","id":298510559,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODUxMDU1OQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-05-02T06:47:11Z","updated_at":"2017-05-02T06:47:11Z","author_association":"CONTRIBUTOR","body":"@javanna that failure is different:\r\n\r\n```\r\nCaused by: java.lang.AssertionError: setting value but not in fetching mode\r\n\tat __randomizedtesting.SeedInfo.seed([362DF4A99D9305E5]:0)\r\n\tat org.elasticsearch.gateway.AsyncShardFetch$NodeEntry.doneFetching(AsyncShardFetch.java:372)\r\n\tat org.elasticsearch.gateway.AsyncShardFetch.processAsyncFetch(AsyncShardFetch.java:206)\r\n\tat org.elasticsearch.gateway.AsyncShardFetch$1.onResponse(AsyncShardFetch.java:275)\r\n\tat org.elasticsearch.gateway.AsyncShardFetch$1.onResponse(AsyncShardFetch.java:272)\r\n\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:88)\r\n\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:84)\r\n```\r\n\r\nIt's a duplicate of #24007. I'll talk to @dakrone to see if we can get this fixed today.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298843913","html_url":"https://github.com/elastic/elasticsearch/issues/23922#issuecomment-298843913","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23922","id":298843913,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODg0MzkxMw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-05-03T07:48:31Z","updated_at":"2017-05-03T07:48:31Z","author_association":"CONTRIBUTOR","body":"@javanna it's fixed here: #24434","performed_via_github_app":null}]