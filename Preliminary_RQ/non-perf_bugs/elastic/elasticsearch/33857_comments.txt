[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422790723","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-422790723","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":422790723,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjc5MDcyMw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T12:51:56Z","updated_at":"2018-09-19T12:51:56Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422807091","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-422807091","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":422807091,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjgwNzA5MQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T13:38:47Z","updated_at":"2018-09-19T13:38:47Z","author_association":"CONTRIBUTOR","body":"@jasontedor @bleskes any ideas here? I looked but it's really puzzeling","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423010347","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423010347","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423010347,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzAxMDM0Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T01:32:29Z","updated_at":"2018-09-20T01:32:29Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423069141","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423069141","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423069141,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzA2OTE0MQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T07:20:43Z","updated_at":"2018-09-20T07:20:43Z","author_association":"CONTRIBUTOR","body":"Relates #30962","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423069876","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423069876","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423069876,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzA2OTg3Ng==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T07:23:14Z","updated_at":"2018-09-20T07:23:14Z","author_association":"CONTRIBUTOR","body":"It's [failed again](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.6+multijob-windows-compatibility/12/console).\r\n\r\nI'm going to mute it on Windows unless someone says they need to capture more failure logs.\r\n ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423244745","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423244745","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423244745,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzI0NDc0NQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T16:19:07Z","updated_at":"2018-09-20T16:19:07Z","author_association":"CONTRIBUTOR","body":"I've reenabled the test on master (db327818dd0) and added DEBUG logging for `org.elasticsearch.index.store` which will possibly tell us whether the move failed because a previous delete in `renameTempFilesSafe` (where we catch exception and log as debug) failed. \r\nFor the person on test triage: If this test fails again on CI, please link the latest failure here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423496973","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423496973","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423496973,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzQ5Njk3Mw==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T11:09:40Z","updated_at":"2018-09-21T11:09:40Z","author_association":"CONTRIBUTOR","body":"Another failure today: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.6+multijob-windows-compatibility/14/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423502449","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423502449","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423502449,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzUwMjQ0OQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T11:36:48Z","updated_at":"2018-09-21T11:36:48Z","author_association":"CONTRIBUTOR","body":"Unfortunately that was on 5.6 (which does not have the extended logging, and which we forgot to mute). I've muted the test on 5.6 for now (a6aa7738d59).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423519328","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423519328","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423519328,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzUxOTMyOA==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T12:48:00Z","updated_at":"2018-09-21T12:48:00Z","author_association":"CONTRIBUTOR","body":"Now there's a master failure :)\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/14/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423729423","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423729423","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423729423,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzcyOTQyMw==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2018-09-22T09:10:16Z","updated_at":"2018-09-22T09:10:16Z","author_association":"CONTRIBUTOR","body":"`PartitionedRoutingIT.testShrinking` seems to have a similar issue:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-windows-compatibility/16/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423894230","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423894230","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423894230,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzg5NDIzMA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-09-24T07:28:35Z","updated_at":"2018-09-24T07:28:35Z","author_association":"CONTRIBUTOR","body":"Similar failures on 5.6, 6.x and master in the last 12 hours.\r\n\r\n```\r\ngradlew :core:integTest \\\r\n  -Dtests.seed=41732671CC43CCD8 \\\r\n  -Dtests.class=org.elasticsearch.routing.PartitionedRoutingIT \\\r\n  -Dtests.method=\"testShrinking\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-MA \\\r\n  -Dtests.timezone=Europe/Tirane\r\n```\r\n\r\nseems to be caused by AccessDeniedException\r\n\r\n```\r\nCaused by: java.nio.file.AccessDeniedException: C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+master+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J3\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_22FF5B1F0934DA81-001\\tempDir-002\\data\\nodes\\0\\indices\\nCj_PB_1SvemMgYmkmpqNw\\1\\index\\recovery.XyXJa1iLT_eQAR39YSXIKg._0.cfs -> C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+master+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J3\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_22FF5B1F0934DA81-001\\tempDir-002\\data\\nodes\\0\\indices\\nCj_PB_1SvemMgYmkmpqNw\\1\\index\\_0.cfs\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423935432","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-423935432","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":423935432,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzkzNTQzMg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-09-24T10:43:42Z","updated_at":"2018-09-24T10:43:42Z","author_association":"MEMBER","body":"fyi. recent master change built was: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/19/console\r\nTrying to get to the machine and take a look at the logs now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/424007207","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-424007207","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":424007207,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNDAwNzIwNw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-09-24T15:03:26Z","updated_at":"2018-09-24T15:03:26Z","author_association":"MEMBER","body":"Another recent one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/18/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425002899","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425002899","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425002899,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTAwMjg5OQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2018-09-27T08:23:35Z","updated_at":"2018-09-27T08:23:35Z","author_association":"CONTRIBUTOR","body":"I think this also affects `SplitIndexIT.testSplitFromOneToN`.\r\n\r\nThese two build logs contain the extra debugging info:\r\n\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/23/console\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/24/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425178187","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425178187","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425178187,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTE3ODE4Nw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-27T17:33:29Z","updated_at":"2018-09-27T17:33:29Z","author_association":"CONTRIBUTOR","body":"I spent some time trying to reproduce this by hand on one of the Windows CI workers. Although I never saw the test fail, I did see tests reporting the failures of recoveries for the reason quoted in the OP:\r\n\r\n```\r\n  1> org.elasticsearch.indices.recovery.RecoveryFailedException: [second_shrink][0]: Recovery failed from {node_sd2}{TO36W-4uR0GLz8RwgnmWXg}{vtq1HlXqTy-5ut_hiS2-TQ}{127.0.0.1}{127.0.0.1:52206} into {node_sd1}{VwtnN_EuS8aKva_oys857Q}{OCu18ksZRdKzsOChRaIFkw}{127.0.0.1}{127.0.0.1:52177}\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:283) [main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:81) [main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:628) [main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) [main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [main/:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) [?:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) [?:?]\r\n  1>    at java.lang.Thread.run(Thread.java:844) [?:?]\r\n  1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_sd2][127.0.0.1:52206][internal:index/shard/recovery/start_recovery]\r\n  1> Caused by: org.elasticsearch.index.engine.RecoveryEngineException: Phase[1] phase1 failed\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:174) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:99) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:51) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:108) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:105) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1448) ~[main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) ~[main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[main/:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) ~[?:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\r\n  1>    at java.lang.Thread.run(Thread.java:844) ~[?:?]\r\n  1> Caused by: org.elasticsearch.indices.recovery.RecoverFilesRecoveryException: Failed to transfer [7] files with total size of [8kb]\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.phase1(RecoverySourceHandler.java:422) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:172) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:99) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:51) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:108) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:105) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1448) ~[main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) ~[main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[main/:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) ~[?:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\r\n  1>    at java.lang.Thread.run(Thread.java:844) ~[?:?]\r\n  1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_sd1][127.0.0.1:52177][internal:index/shard/recovery/clean_files]\r\n  1> Caused by: java.nio.file.AccessDeniedException: C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+master+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J0\\temp\\org.elasticsearch.action.admin.indices.create.ShrinkIndexIT_3825ACCB7B6BF7DB-001\\tempDir-002\\data\\nodes\\1\\indices\\4EzGadc6Rpa77FYUbJVhvA\\0\\index\\recovery.uKRsdtvIQbmCSaJo9IlMzA._0.cfs -> C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+master+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J0\\temp\\org.elasticsearch.action.admin.indices.create.ShrinkIndexIT_3825ACCB7B6BF7DB-001\\tempDir-002\\data\\nodes\\1\\indices\\4EzGadc6Rpa77FYUbJVhvA\\0\\index\\_0.cfs\r\n  1>    at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:89) ~[?:?]\r\n  1>    at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[?:?]\r\n  1>    at sun.nio.fs.WindowsFileCopy.move(WindowsFileCopy.java:298) ~[?:?]\r\n  1>    at sun.nio.fs.WindowsFileSystemProvider.move(WindowsFileSystemProvider.java:288) ~[?:?]\r\n  1>    at org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-8.0.0-snapshot-7d0a7782fa.jar:8.0.0-snapshot-7d0a7782fa 7d0a7782fa7e99250bccfb4d3e995485c3f0ca19 - jimczi - 2018-09-18 14:02:40]\r\n  1>    at org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-8.0.0-snapshot-7d0a7782fa.jar:8.0.0-snapshot-7d0a7782fa 7d0a7782fa7e99250bccfb4d3e995485c3f0ca19 - jimczi - 2018-09-18 14:02:40]\r\n  1>    at java.nio.file.Files.move(Files.java:1413) ~[?:?]\r\n  1>    at org.apache.lucene.store.FSDirectory.rename(FSDirectory.java:303) ~[lucene-core-8.0.0-snapshot-7d0a7782fa.jar:8.0.0-snapshot-7d0a7782fa 7d0a7782fa7e99250bccfb4d3e995485c3f0ca19 - jimczi - 2018-09-18 14:02:34]\r\n  1>    at org.apache.lucene.store.MockDirectoryWrapper.rename(MockDirectoryWrapper.java:231) ~[lucene-test-framework-8.0.0-snapshot-7d0a7782fa.jar:8.0.0-snapshot-7d0a7782fa 7d0a7782fa7e99250bccfb4d3e995485c3f0ca19 - jimczi - 2018-09-18 14:02:34]\r\n  1>    at org.apache.lucene.store.FilterDirectory.rename(FilterDirectory.java:89) ~[lucene-core-8.0.0-snapshot-7d0a7782fa.jar:8.0.0-snapshot-7d0a7782fa 7d0a7782fa7e99250bccfb4d3e995485c3f0ca19 - jimczi - 2018-09-18 14:02:34]\r\n  1>    at org.apache.lucene.store.FilterDirectory.rename(FilterDirectory.java:89) ~[lucene-core-8.0.0-snapshot-7d0a7782fa.jar:8.0.0-snapshot-7d0a7782fa 7d0a7782fa7e99250bccfb4d3e995485c3f0ca19 - jimczi - 2018-09-18 14:02:34]\r\n  1>    at org.elasticsearch.index.store.Store.renameTempFilesSafe(Store.java:335) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.RecoveryTarget.renameAllTempFiles(RecoveryTarget.java:188) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.RecoveryTarget.cleanFiles(RecoveryTarget.java:444) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$CleanFilesRequestHandler.messageReceived(PeerRecoveryTargetService.java:561) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$CleanFilesRequestHandler.messageReceived(PeerRecoveryTargetService.java:555) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1448) ~[main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) ~[main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[main/:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) ~[?:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\r\n  1>    at java.lang.Thread.run(Thread.java:844) ~[?:?]\r\n```\r\n\r\nHere is a copy of the console output, including repeated test runs (of which the stack trace above is the last). This tarball also includes a Process Monitor log from this run, filtered to just the relevant paths: [33857.tar.gz](https://github.com/elastic/elasticsearch/files/2425198/33857.tar.gz)\r\n\r\nInteresting things to note from the process monitor log are:\r\n1. There's no other process involved here. I'm pretty sure that if this were Windows Defender then it'd also appear in this log.\r\n2. There seem to be repeated attempts to remove `_0.cfs` which result in `CANNOT DELETE`\r\n3. Finally we can see the rename results in `ACCESS DENIED`.\r\n\r\nI do not yet have a good idea for a next step on this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425355968","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425355968","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425355968,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTM1NTk2OA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T08:03:30Z","updated_at":"2018-09-28T08:03:30Z","author_association":"CONTRIBUTOR","body":"On repeated runs I do see occasional failures as per the OP (maybe 20% of the time, I've not done the stats in detail yet). I tried writing a test case that repeatedly hits the filesystem directly and could not reproduce this `AccessDeniedException`, so decided to turn my attention to all the Lucene-provided filesystem machinery that's in play here to see if I could rule that out as a source. The filesystem provider in use in a failing test is\r\n\r\n```\r\nHandleLimitFS(LeakFS(ShuffleFS(DisableFsyncFS(sun.nio.fs.WindowsFileSystemProvider@2d1a5acc))))\r\n```\r\n\r\nI was suspicious about that `DisableFsyncFS` in there (the rest look benign) so I added `@SuppressFileSystems(value = \"DisableFsyncFS\")` to the `ShrinkIndexIT` fixture, but still got failures. I then tried `@SuppressFileSystems(value = \"*\")` and still it fails - the filesystem provider in this case is confirmed to be a plain `sun.nio.fs.WindowsFileSystemProvider`. The story continues...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425364335","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425364335","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425364335,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTM2NDMzNQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T08:35:59Z","updated_at":"2018-09-28T08:35:59Z","author_association":"MEMBER","body":"We have more test failures on Windows with the same cause:\r\n\r\n5.6: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.6+multijob-windows-compatibility/27/console:\r\n\r\n`org.elasticsearch.routing.PartitionedRoutingIT#testShrinking()`\r\n\r\n<details>\r\n    <summary>Expand for stack trace</summary>\r\n<p><pre>\r\n[2018-09-27T18:57:01,933][WARN ][o.e.c.a.s.ShardStateAction] [node_s0] [index_2][0] received shard failed for shard id [[index_2][0]], allocation id [0Jyeijx5QoeBLzJ85Ym4uw], primary term [0], message [failed recovery], failure [RecoveryFailedException[[index_2][0]: Recovery failed from {node_s1}{UFRWgSweS6uUDivYiTC1-w}{4v-Ak5QCQ62QpeiZyzwK8w}{local}{local[368]} into {node_s0}{Povm-pMfSAaqPh8OcDkjHg}{3UCCMKflQTOz9cF4-uejCA}{local}{local[366]}]; nested: RemoteTransportException[[node_s0][local[366]][internal:index/shard/recovery/start_recovery]]; nested: RecoveryEngineException[Phase[1] phase1 failed]; nested: RecoverFilesRecoveryException[Failed to transfer [25] files with total size of [36.4kb]]; nested: RemoteTransportException[[node_s1][local[368]][internal:index/shard/recovery/clean_files]]; nested: AccessDeniedException[C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+5.6+multijob-windows-compatibility\\core\\build\\testrun\\integTest\\J0\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_D736F1C7B3CED870-001\\tempDir-002\\data\\nodes\\0\\indices\\qvLxi615Saym8cpW_c-H4Q\\0\\index\\recovery.AWYcZDdo0i__cHMcxiHN._0.cfs -> C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+5.6+multijob-windows-compatibility\\core\\build\\testrun\\integTest\\J0\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_D736F1C7B3CED870-001\\tempDir-002\\data\\nodes\\0\\indices\\qvLxi615Saym8cpW_c-H4Q\\0\\index\\_0.cfs]; ]\r\n[...]\r\nCaused by: java.nio.file.AccessDeniedException: C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+5.6+multijob-windows-compatibility\\core\\build\\testrun\\integTest\\J0\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_D736F1C7B3CED870-001\\tempDir-002\\data\\nodes\\0\\indices\\qvLxi615Saym8cpW_c-H4Q\\0\\index\\recovery.AWYcZDdo0i__cHMcxiHN._0.cfs -> C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+5.6+multijob-windows-compatibility\\core\\build\\testrun\\integTest\\J0\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_D736F1C7B3CED870-001\\tempDir-002\\data\\nodes\\0\\indices\\qvLxi615Saym8cpW_c-H4Q\\0\\index\\_0.cfs\r\n  at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83) ~[?:?]\r\n  at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97) ~[?:?]\r\n  at sun.nio.fs.WindowsFileCopy.move(WindowsFileCopy.java:301) ~[?:?]\r\n  at sun.nio.fs.WindowsFileSystemProvider.move(WindowsFileSystemProvider.java:287) ~[?:?]\r\n  at org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-6.6.1.jar:6.6.1 9aa465a89b64ff2dabe7b4d50c472de32c298683 - varunthacker - 2017-08-29 21:54:40]\r\n  at org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-6.6.1.jar:6.6.1 9aa465a89b64ff2dabe7b4d50c472de32c298683 - varunthacker - 2017-08-29 21:54:40]\r\n  at java.nio.file.Files.move(Files.java:1395) ~[?:1.8.0_181]\r\n  at org.apache.lucene.store.FSDirectory.rename(FSDirectory.java:297) ~[lucene-core-6.6.1.jar:6.6.1 9aa465a89b64ff2dabe7b4d50c472de32c298683 - varunthacker - 2017-08-29 21:54:39]\r\n  at org.apache.lucene.store.FilterDirectory.rename(FilterDirectory.java:88) ~[lucene-core-6.6.1.jar:6.6.1 9aa465a89b64ff2dabe7b4d50c472de32c298683 - varunthacker - 2017-08-29 21:54:39]\r\n  at org.apache.lucene.store.MockDirectoryWrapper.rename(MockDirectoryWrapper.java:229) ~[lucene-test-framework-6.6.1.jar:6.6.1 9aa465a89b64ff2dabe7b4d50c472de32c298683 - varunthacker - 2017-08-29 21:54:39]\r\n  at org.apache.lucene.store.FilterDirectory.rename(FilterDirectory.java:88) ~[lucene-core-6.6.1.jar:6.6.1 9aa465a89b64ff2dabe7b4d50c472de32c298683 - varunthacker - 2017-08-29 21:54:39]\r\n  at org.elasticsearch.index.store.Store.renameTempFilesSafe(Store.java:319) ~[main/:?]\r\n  at org.elasticsearch.indices.recovery.RecoveryTarget.renameAllTempFiles(RecoveryTarget.java:181) ~[main/:?]\r\n  at org.elasticsearch.indices.recovery.RecoveryTarget.cleanFiles(RecoveryTarget.java:406) ~[main/:?]\r\n  at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$CleanFilesRequestHandler.messageReceived(PeerRecoveryTargetService.java:486) ~[main/:?]\r\n  at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$CleanFilesRequestHandler.messageReceived(PeerRecoveryTargetService.java:480) ~[main/:?]\r\n  at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[main/:?]\r\n  at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[main/:?]\r\n  at org.elasticsearch.transport.local.LocalTransport$2.doRun(LocalTransport.java:390) ~[main/:?]\r\n</pre></p>\r\n</details>\r\n\r\n6.x: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-windows-compatibility/27/console\r\n\r\n`org.elasticsearch.routing.PartitionedRoutingIT#testShrinking()`\r\n\r\n<details>\r\n    <summary>Expand for stack trace</summary>\r\n<p><pre>\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [index_4][1]: Recovery failed from {node_s0}{7C-fb4R9RK-WS4Jk1WYXuQ}{BijPdN92Q32zPDZ9t_ldiA}{127.0.0.1}{127.0.0.1:55085} into {node_s1}{RqyKMgp3QZ-gu0IVK_U0AA}{I5djfftGTtmtr6bQbOAUJA}{127.0.0.1}{127.0.0.1:55086}\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:282) [main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:80) [main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:624) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n  1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_s0][127.0.0.1:55089][internal:index/shard/recovery/start_recovery]\r\n  1> Caused by: org.elasticsearch.index.engine.RecoveryEngineException: Phase[1] phase1 failed\r\n  1> \tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:174) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1350) ~[main/:?]\r\n  1> \t... 5 more\r\n  1> Caused by: org.elasticsearch.indices.recovery.RecoverFilesRecoveryException: Failed to transfer [13] files with total size of [19.3kb]\r\n  1> \tat org.elasticsearch.indices.recovery.RecoverySourceHandler.phase1(RecoverySourceHandler.java:424) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:172) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1350) ~[main/:?]\r\n  1> \t... 5 more\r\n  1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_s1][127.0.0.1:55090][internal:index/shard/recovery/clean_files]\r\n  1> Caused by: java.nio.file.AccessDeniedException: C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+6.x+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J2\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_CAE88D19276CD2B2-001\\tempDir-002\\data\\nodes\\1\\indices\\H6TUqJpRTRedJr1z26jubw\\1\\index\\recovery.fshzJJ1CQCelF3mD6b587Q._0.cfs -> C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+6.x+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J2\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_CAE88D19276CD2B2-001\\tempDir-002\\data\\nodes\\1\\indices\\H6TUqJpRTRedJr1z26jubw\\1\\index\\_0.cfs\r\n  1> \tat sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83) ~[?:?]\r\n  1> \tat sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97) ~[?:?]\r\n  1> \tat sun.nio.fs.WindowsFileCopy.move(WindowsFileCopy.java:301) ~[?:?]\r\n  1> \tat sun.nio.fs.WindowsFileSystemProvider.move(WindowsFileSystemProvider.java:287) ~[?:?]\r\n  1> \tat org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:01:16]\r\n  1> \tat java.nio.file.Files.move(Files.java:1395) ~[?:1.8.0_181]\r\n  1> \tat org.apache.lucene.store.FSDirectory.rename(FSDirectory.java:303) ~[lucene-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:01:13]\r\n  1> \tat org.apache.lucene.store.MockDirectoryWrapper.rename(MockDirectoryWrapper.java:231) ~[lucene-test-framework-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:01:13]\r\n  1> \tat org.apache.lucene.store.FilterDirectory.rename(FilterDirectory.java:89) ~[lucene-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:01:13]\r\n  1> \tat org.apache.lucene.store.FilterDirectory.rename(FilterDirectory.java:89) ~[lucene-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:01:13]\r\n  1> \tat org.elasticsearch.index.store.Store.renameTempFilesSafe(Store.java:334) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveryTarget.renameAllTempFiles(RecoveryTarget.java:188) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.RecoveryTarget.cleanFiles(RecoveryTarget.java:452) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$CleanFilesRequestHandler.messageReceived(PeerRecoveryTargetService.java:557) ~[main/:?]\r\n  1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$CleanFilesRequestHandler.messageReceived(PeerRecoveryTargetService.java:551) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1350) ~[main/:?]\r\n</pre></p>\r\n</details>\r\n\r\n6.4: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.4+multijob-windows-compatibility/28/console\r\n\r\n`org.elasticsearch.routing.PartitionedRoutingIT#testShrinking()`\r\n\r\n<details>\r\n    <summary>Expand for stack trace</summary>\r\n<p><pre>\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [index_4][3]: Recovery failed from {node_sd1}{O8l8bMuJTv2FfmOwRxXWgg}{1m7utzhqQjWidDUawrikfQ}{127.0.0.1}{127.0.0.1:63944} into {node_sd2}{IBcohRX6RB2qHr4S6wDBUQ}{Fa3f-veRRFOWmrrADglJ9A}{127.0.0.1}{127.0.0.1:63945}\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:282) [main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:80) [main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:623) [main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) [main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [main/:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n  1>    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n  1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_sd1][127.0.0.1:63944][internal:index/shard/recovery/start_recovery]\r\n  1> Caused by: org.elasticsearch.index.engine.RecoveryEngineException: Phase[1] phase1 failed\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:174) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1605) ~[main/:?]\r\n  1>    ... 5 more\r\n  1> Caused by: org.elasticsearch.indices.recovery.RecoverFilesRecoveryException: Failed to transfer [4] files with total size of [4.5kb]\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.phase1(RecoverySourceHandler.java:446) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:172) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1605) ~[main/:?]\r\n  1>    ... 5 more\r\n  1> Caused by: org.elasticsearch.indices.recovery.RecoverFilesRecoveryException: Failed to transfer [4] files with total size of [4.5kb]\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.phase1(RecoverySourceHandler.java:446) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:172) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1605) ~[main/:?]\r\n  1>    ... 5 more\r\n  1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_sd2][127.0.0.1:63945][internal:index/shard/recovery/clean_files]\r\n  1> Caused by: java.nio.file.AccessDeniedException: C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+6.4+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J2\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_1C4D221BAD62999F-001\\tempDir-002\\data\\nodes\\2\\indices\\SI6IoZJ5R_Wb4Nqx06oDmA\\3\\index\\recovery.CB9P345NRmmuu-tPzwjksg._0.cfs -> C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+6.4+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J2\\temp\\org.elasticsearch.routing.PartitionedRoutingIT_1C4D221BAD62999F-001\\tempDir-002\\data\\nodes\\2\\indices\\SI6IoZJ5R_Wb4Nqx06oDmA\\3\\index\\_0.cfs\r\n</pre></p>\r\n</details>\r\n\r\n\r\n`org.elasticsearch.action.admin.indices.create.SplitIndexIT#testCreateSplitIndexToN()`:\r\n\r\n<details>\r\n    <summary>Expand for stack trace</summary>\r\n<p><pre>\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [second_split][0]: Recovery failed from {node_sd2}{hcRrVZwPQ7e8MTakDgz_GQ}{wfXHyRV6RPW0sKTXdamhdA}{127.0.0.1}{127.0.0.1:58177} into {node_sd3}{VlMAJBDSTemm3IJZgPciLA}{zPecWbBiSWaagZwl7Q1l6g}{127.0.0.1}{127.0.0.1:58171}\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:282) [main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:80) [main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:623) [main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) [main/:?]\r\n  1>    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [main/:?]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n  1>    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n  1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_sd2][127.0.0.1:58177][internal:index/shard/recovery/start_recovery]\r\n  1> Caused by: org.elasticsearch.index.engine.RecoveryEngineException: Phase[1] phase1 failed\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:174) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1605) ~[main/:?]\r\n  1>    ... 5 more\r\n  1> Caused by: org.elasticsearch.indices.recovery.RecoverFilesRecoveryException: Failed to transfer [5] files with total size of [5.6kb]\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.phase1(RecoverySourceHandler.java:446) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:172) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1605) ~[main/:?]\r\n  1>    ... 5 more\r\n  1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_sd3][127.0.0.1:58171][internal:index/shard/recovery/clean_files]\r\n  1> Caused by: java.nio.file.AccessDeniedException: C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+6.4+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J2\\temp\\org.elasticsearch.action.admin.indices.create.SplitIndexIT_1C4D221BAD62999F-001\\tempDir-002\\data\\nodes\\3\\indices\\xKk-zXSXQsGpeMmq5ysVpA\\0\\index\\recovery._dztPVO1RBKeP7ZpRHIbiA._0.cfs -> C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+6.4+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J2\\temp\\org.elasticsearch.action.admin.indices.create.SplitIndexIT_1C4D221BAD62999F-001\\tempDir-002\\data\\nodes\\3\\indices\\xKk-zXSXQsGpeMmq5ysVpA\\0\\index\\_0.cfs\r\n  1>    at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83) ~[?:?]\r\n  1>    at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97) ~[?:?]\r\n  1>    at sun.nio.fs.WindowsFileCopy.move(WindowsFileCopy.java:301) ~[?:?]\r\n  1>    at sun.nio.fs.WindowsFileSystemProvider.move(WindowsFileSystemProvider.java:287) ~[?:?]\r\n  1>    at org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-7.4.0.jar:7.4.0 9060ac689c270b02143f375de0348b7f626adebc - jpountz - 2018-06-18 16:51:47]\r\n  1>    at org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-7.4.0.jar:7.4.0 9060ac689c270b02143f375de0348b7f626adebc - jpountz - 2018-06-18 16:51:47]\r\n  1>    at org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-7.4.0.jar:7.4.0 9060ac689c270b02143f375de0348b7f626adebc - jpountz - 2018-06-18 16:51:47]\r\n  1>    at org.apache.lucene.mockfile.FilterFileSystemProvider.move(FilterFileSystemProvider.java:147) ~[lucene-test-framework-7.4.0.jar:7.4.0 9060ac689c270b02143f375de0348b7f626adebc - jpountz - 2018-06-18 16:51:47]\r\n  1>    at java.nio.file.Files.move(Files.java:1395) ~[?:1.8.0_181]\r\n  1>    at org.apache.lucene.store.FSDirectory.rename(FSDirectory.java:303) ~[lucene-core-7.4.0.jar:7.4.0 9060ac689c270b02143f375de0348b7f626adebc - jpountz - 2018-06-18 16:51:45]\r\n  1>    at org.apache.lucene.store.FilterDirectory.rename(FilterDirectory.java:89) ~[lucene-core-7.4.0.jar:7.4.0 9060ac689c270b02143f375de0348b7f626adebc - jpountz - 2018-06-18 16:51:45]\r\n  1>    at org.apache.lucene.store.FilterDirectory.rename(FilterDirectory.java:89) ~[lucene-core-7.4.0.jar:7.4.0 9060ac689c270b02143f375de0348b7f626adebc - jpountz - 2018-06-18 16:51:45]\r\n  1>    at org.elasticsearch.index.store.Store.renameTempFilesSafe(Store.java:337) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.RecoveryTarget.renameAllTempFiles(RecoveryTarget.java:188) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.RecoveryTarget.cleanFiles(RecoveryTarget.java:439) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$CleanFilesRequestHandler.messageReceived(PeerRecoveryTargetService.java:556) ~[main/:?]\r\n  1>    at org.elasticsearch.indices.recovery.PeerRecoveryTargetService$CleanFilesRequestHandler.messageReceived(PeerRecoveryTargetService.java:550) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n  1>    at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1605) ~[main/:?]  \r\n</pre></p>\r\n</details>","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425369887","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425369887","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425369887,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTM2OTg4Nw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T08:56:25Z","updated_at":"2018-09-28T08:56:25Z","author_association":"CONTRIBUTOR","body":"Looking harder at the logs, what happens is:\r\n\r\n- we allocate two primary shards of `second_shrink` to one node\r\n- they recover from local shards (this is the shrink)\r\n- as soon as they start they are rebalanced to the other node\r\n- then we update the number of replicas to 1, allocating replicas on the first node\r\n\r\nHowever we failed to delete the unassigned shards from the first node after the rebalance (at least twice, maybe it succeeds, we're still looking). For some reason when we try and allocate a shard on top of the old directory it then fails with the `AccessDeniedException`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425381454","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425381454","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425381454,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTM4MTQ1NA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T09:39:22Z","updated_at":"2018-09-28T09:39:22Z","author_association":"CONTRIBUTOR","body":"Note that we're using `MMapDirectory` here. Setting `index.store.type: simplefs` yielded no failure in 10 iterations.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425401733","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425401733","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425401733,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTQwMTczMw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T11:04:57Z","updated_at":"2018-09-28T11:04:57Z","author_association":"CONTRIBUTOR","body":"I have tried to find a way to reproduce this with fewer moving parts, but so far this has failed. The following test passes.\r\n\r\n```\r\n/*\r\n * Licensed to Elasticsearch under one or more contributor\r\n * license agreements. See the NOTICE file distributed with\r\n * this work for additional information regarding copyright\r\n * ownership. Elasticsearch licenses this file to you under\r\n * the Apache License, Version 2.0 (the \"License\"); you may\r\n * not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing,\r\n * software distributed under the License is distributed on an\r\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n * KIND, either express or implied.  See the License for the\r\n * specific language governing permissions and limitations\r\n * under the License.\r\n */\r\npackage org.elasticsearch.action.admin.indices.create;\r\n\r\nimport org.apache.lucene.store.Directory;\r\nimport org.apache.lucene.store.FSDirectory;\r\nimport org.apache.lucene.store.IOContext;\r\nimport org.apache.lucene.store.IndexOutput;\r\nimport org.elasticsearch.Version;\r\nimport org.elasticsearch.cluster.metadata.IndexMetaData;\r\nimport org.elasticsearch.common.settings.Setting;\r\nimport org.elasticsearch.common.settings.Settings;\r\nimport org.elasticsearch.common.unit.TimeValue;\r\nimport org.elasticsearch.index.IndexSettings;\r\nimport org.elasticsearch.index.shard.ShardId;\r\nimport org.elasticsearch.index.store.Store;\r\nimport org.elasticsearch.test.DummyShardLock;\r\nimport org.elasticsearch.test.ESTestCase;\r\nimport org.elasticsearch.test.junit.annotations.TestLogging;\r\nimport org.elasticsearch.threadpool.TestThreadPool;\r\nimport org.elasticsearch.threadpool.ThreadPool;\r\n\r\nimport java.io.IOException;\r\nimport java.nio.file.Path;\r\nimport java.util.concurrent.CountDownLatch;\r\nimport java.util.concurrent.atomic.AtomicBoolean;\r\n\r\nimport static org.elasticsearch.cluster.metadata.IndexMetaData.INDEX_NUMBER_OF_REPLICAS_SETTING;\r\nimport static org.elasticsearch.cluster.metadata.IndexMetaData.INDEX_NUMBER_OF_SHARDS_SETTING;\r\nimport static org.elasticsearch.cluster.metadata.IndexMetaData.SETTING_INDEX_VERSION_CREATED;\r\nimport static org.elasticsearch.cluster.metadata.IndexMetaData.SETTING_NUMBER_OF_SHARDS;\r\nimport static org.elasticsearch.index.store.Store.INDEX_STORE_STATS_REFRESH_INTERVAL_SETTING;\r\n\r\n@TestLogging(\"org.elasticsearch:TRACE,index.store.deletes:TRACE\")\r\npublic class WindowsFilesystemTests extends ESTestCase {\r\n    public void testWindowsFilesystem() {\r\n        ThreadPool threadPool = new TestThreadPool(\"test\");\r\n        try {\r\n            final Path tempDir1 = createTempDir();\r\n            final IOContext ioContext = new IOContext();\r\n            final int attemptCount = 1000;\r\n            final CountDownLatch countDownLatch = new CountDownLatch(attemptCount);\r\n\r\n            try (Directory rawDirectory = FSDirectory.open(tempDir1)) {\r\n                logger.info(\"rawDirectory = {}\", rawDirectory);\r\n\r\n                final ShardId shardId = new ShardId(\"foo\", \"bar\", 0);\r\n                final Store store = new Store(shardId,\r\n                    new IndexSettings(IndexMetaData.builder(shardId.getIndexName())\r\n                        .settings(Settings.builder()\r\n                            .put(INDEX_NUMBER_OF_SHARDS_SETTING.getKey(), 1)\r\n                            .put(INDEX_NUMBER_OF_REPLICAS_SETTING.getKey(), 0)\r\n                            .put(SETTING_INDEX_VERSION_CREATED.getKey(), Version.CURRENT)\r\n                            .put(INDEX_STORE_STATS_REFRESH_INTERVAL_SETTING.getKey(), TimeValue.ZERO)).build(), Settings.EMPTY),\r\n                    rawDirectory, new DummyShardLock(shardId));\r\n\r\n                final AtomicBoolean queryStatsThreadCancelled = new AtomicBoolean();\r\n                final Thread queryStatsThread = new Thread(() -> {\r\n                    while (queryStatsThreadCancelled.get() == false) {\r\n                        try {\r\n                            store.stats();\r\n                        } catch (IOException e) {\r\n                            throw new AssertionError(\"unexpected\", e);\r\n                        }\r\n                    }\r\n                });\r\n                queryStatsThread.start();\r\n\r\n                final Directory directory = store.directory();\r\n                logger.info(\"directory = {}\", directory);\r\n\r\n                for (int i = 0; i < attemptCount; i++) {\r\n                    for (int j = 1; j <= 2; j++) {\r\n                        try (IndexOutput indexOutput = directory.createOutput(\"test-\" + i + \"-\" + j + \".dat\", ioContext)) {\r\n                            int longCount = randomIntBetween(100, 10000);\r\n                            for (int k = 0; k < longCount; k++) {\r\n                                indexOutput.writeLong(randomLong());\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                for (int i = 0; i < attemptCount; i++) {\r\n                    final String fileName1 = \"test-\" + i + \"-1.dat\";\r\n                    final String fileName2 = \"test-\" + i + \"-2.dat\";\r\n\r\n                    threadPool.generic().execute(() -> {\r\n                        try {\r\n                            directory.deleteFile(fileName1);\r\n                            Thread.sleep(randomIntBetween(1, 50));\r\n                        } catch (IOException | InterruptedException e) {\r\n                            countDownLatch.countDown();\r\n                            throw new AssertionError(\"unexpected\", e);\r\n                        }\r\n\r\n                        threadPool.generic().execute(() -> {\r\n                            try {\r\n                                directory.rename(fileName2, fileName1);\r\n                            } catch (IOException e) {\r\n                                countDownLatch.countDown();\r\n                                throw new AssertionError(\"unexpected\", e);\r\n                            }\r\n\r\n                            threadPool.generic().execute(() -> {\r\n                                try {\r\n                                    directory.deleteFile(fileName1);\r\n                                } catch (IOException e) {\r\n                                    throw new AssertionError(\"unexpected\", e);\r\n                                } finally {\r\n                                    countDownLatch.countDown();\r\n                                }\r\n                            });\r\n                        });\r\n                    });\r\n                }\r\n\r\n                countDownLatch.await();\r\n                queryStatsThreadCancelled.set(true);\r\n                queryStatsThread.join();\r\n            }\r\n        } catch (IOException | InterruptedException e) {\r\n            throw new AssertionError(\"exception\", e);\r\n        } finally {\r\n            threadPool.shutdown();\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425401898","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425401898","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425401898,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTQwMTg5OA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T11:05:45Z","updated_at":"2018-09-28T14:28:19Z","author_association":"CONTRIBUTOR","body":"One interesting side-question is why this happens more on tests to do with shrinking. I think this is the answer:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/c4b831645cb0369449d092a14ecaff4c04528141/server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java#L726-L727\r\n\r\nIn other cases, I guess an allocation that fails like this will retry (up to 5 times) and subsequent attempts will succeed.\r\n\r\n----\r\n\r\n**Correction:** subsequent attempts to allocate a copy of the shrunk index onto the node containing the source index will, I think, all fail, because of https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425438171 (unless either the source index is removed or closed, or else all the shared segments are merged away, neither of which seems very likely in this test).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425415146","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425415146","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425415146,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTQxNTE0Ng==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T12:08:28Z","updated_at":"2018-09-28T12:09:07Z","author_association":"CONTRIBUTOR","body":"To test this hypothesis, I tried writing a test that repeatedly allocates a shard to a node and then removes it, hoping to hit an allocation failure, with max retries set to 0:\r\n\r\n```\r\n@ClusterScope(scope = TEST, numDataNodes = 2)\r\n@TestLogging(\"org.elasticsearch:TRACE,index.store.deletes:TRACE\")\r\npublic class ReliableRecoveryIT extends ESIntegTestCase {\r\n    public void testReliableRecovery() {\r\n        prepareCreate(\"index\").setSettings(Settings.builder().put(indexSettings())\r\n            .put(INDEX_NUMBER_OF_SHARDS_SETTING.getKey(), 1)\r\n            .put(INDEX_NUMBER_OF_REPLICAS_SETTING.getKey(), 1)\r\n            .put(SETTING_ALLOCATION_MAX_RETRY.getKey(), 0))\r\n            .get();\r\n\r\n        ensureGreen(\"index\");\r\n\r\n        for (int i = 0; i < 20; i++) {\r\n            internalCluster().client().prepareBulk()\r\n                .add(new IndexRequest(\"index\", \"_doc\", null).source(\"{}\", XContentType.JSON))\r\n                .add(new IndexRequest(\"index\", \"_doc\", null).source(\"{}\", XContentType.JSON))\r\n                .add(new IndexRequest(\"index\", \"_doc\", null).source(\"{}\", XContentType.JSON))\r\n                .add(new IndexRequest(\"index\", \"_doc\", null).source(\"{}\", XContentType.JSON))\r\n                .add(new IndexRequest(\"index\", \"_doc\", null).source(\"{}\", XContentType.JSON))\r\n                .setRefreshPolicy(IMMEDIATE)\r\n                .get();\r\n        }\r\n\r\n        for (int i = 0; i < 10; i++) {\r\n            logger.info(\"--> removing replica [{}]\", i);\r\n            internalCluster().client().admin().indices().prepareUpdateSettings(\"index\").setSettings(\r\n                Settings.builder().put(INDEX_NUMBER_OF_REPLICAS_SETTING.getKey(), 0)).get();\r\n            logger.info(\"--> adding replica [{}]\", i);\r\n            internalCluster().client().admin().indices().prepareUpdateSettings(\"index\").setSettings(\r\n                Settings.builder().put(INDEX_NUMBER_OF_REPLICAS_SETTING.getKey(), 1)).get();\r\n            logger.info(\"--> awaiting green [{}]\", i);\r\n            ensureGreen(\"index\");\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThis passes. I'm mystified.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425415656","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425415656","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425415656,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTQxNTY1Ng==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T12:10:39Z","updated_at":"2018-09-28T12:10:39Z","author_association":"MEMBER","body":"> One interesting side-question is why this happens more on tests to do with shrinking. I think this is the answer:\r\n\r\nGood catch. We should clean these up IMO.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425438171","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425438171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425438171,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTQzODE3MQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T13:38:02Z","updated_at":"2018-09-28T13:54:19Z","author_association":"CONTRIBUTOR","body":"Ok, I've got it  \r\n\r\nThe following test passes on Windows (i.e. throws an `AccessDeniedException` on the `rename`). It seems that if you create a hard link to a file, and then delete the link, but the original file is still open, then you can't rename something else into the place where the hard link used to be.\r\n\r\n```\r\n    public void testWindowsFilesystem() throws IOException {\r\n        final Path directoryPath = createTempDir();\r\n        final IOContext ioContext = new IOContext();\r\n\r\n        try (Directory directory = FSDirectory.open(directoryPath)) {\r\n            logger.info(\"directory = {}\", directory);\r\n\r\n            final String fileName1 = \"test-1.dat\";\r\n            final String fileName2 = \"test-2.dat\";\r\n            final String fileName3 = \"test-3.dat\";\r\n\r\n            Files.write(directoryPath.resolve(fileName1), new byte[]{0}); // must be nonempty\r\n            Files.write(directoryPath.resolve(fileName2), new byte[0]); // empty file\r\n\r\n            try (IndexInput ignored = directory.openInput(fileName1, ioContext)) {\r\n                Files.createLink(directoryPath.resolve(fileName3), directoryPath.resolve(fileName1));\r\n                directory.deleteFile(fileName3);\r\n                expectThrows(AccessDeniedException.class, () -> directory.rename(fileName2, fileName3));\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\nMore precisely, attempts to delete `fileName3` while `fileName1` is still open will fail with `AccessDeniedException`, but we suppress these inside `FSDirectory`.\r\n\r\nThis only happens when using `MMapDirectory` and not `SimpleFSDirectory`.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425928062","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-425928062","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":425928062,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTkyODA2Mg==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-10-01T14:27:33Z","updated_at":"2018-10-01T21:08:57Z","author_association":"CONTRIBUTOR","body":"Still experiencing failure today on 6.4\r\n\r\nLog:  https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.4+multijob-windows-compatibility/34/console\r\n\r\nREPRODUCE WITH: gradlew :server:integTest \\\r\n  -Dtests.seed=544A239B8224F7C5 \\\r\n  -Dtests.class=org.elasticsearch.routing.PartitionedRoutingIT \\\r\n  -Dtests.method=\"testShrinking\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=en-CA \\\r\n  -Dtests.timezone=SystemV/YST9YDT\r\n\r\nand 6.x \r\nLog: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-windows-compatibility/35/console\r\n\r\n\r\n07:44:40 FAILURE 33.3s J2 | PartitionedRoutingIT.testShrinking <<< FAILURES!\r\n07:44:40    > Throwable #1: java.lang.AssertionError: timed out waiting for green state\r\n07:44:40    > \tat __randomizedtesting.SeedInfo.seed([544A239B8224F7C5:AE69E6F0A5B2602E]:0)\r\n07:44:40    > \tat org.elasticsearch.test.ESIntegTestCase.ensureColor(ESIntegTestCase.java:967)\r\n07:44:40    > \tat org.elasticsearch.test.ESIntegTestCase.ensureGreen(ESIntegTestCase.java:923)\r\n07:44:40    > \tat org.elasticsearch.test.ESIntegTestCase.ensureGreen(ESIntegTestCase.java:912)\r\n07:44:40    > \tat org.elasticsearch.routing.PartitionedRoutingIT.testShrinking(PartitionedRoutingIT.java:96)\r\n07:44:40    > \tat java.lang.Thread.run(Thread.java:748)\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426068690","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-426068690","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":426068690,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjA2ODY5MA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-10-01T21:26:19Z","updated_at":"2018-10-01T21:26:19Z","author_association":"CONTRIBUTOR","body":"I have muted `PartitionedRoutingIT:: testShrinking` test on 6.4 and 6.x on Windows","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427234429","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-427234429","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":427234429,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzIzNDQyOQ==","user":{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T03:19:01Z","updated_at":"2018-10-05T03:19:01Z","author_association":"CONTRIBUTOR","body":"saw again in 5.6 via https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.6+multijob-windows-compatibility/41/consoleText","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427394047","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-427394047","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":427394047,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzM5NDA0Nw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T14:55:28Z","updated_at":"2018-10-05T14:55:28Z","author_association":"MEMBER","body":"`master` still failing similarly:\r\n\r\n```\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/42/console\r\n```\r\n\r\n\r\n```\r\nREPRODUCE WITH: gradlew :server:integTest \\\r\n  -Dtests.seed=7379D1534EE3AFC8 \\\r\n  -Dtests.class=org.elasticsearch.routing.PartitionedRoutingIT \\\r\n  -Dtests.method=\"testShrinking\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=pl-PL \\\r\n  -Dtests.timezone=US/Arizona \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/429721408","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-429721408","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":429721408,"node_id":"MDEyOklzc3VlQ29tbWVudDQyOTcyMTQwOA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-10-15T06:18:30Z","updated_at":"2018-10-15T06:18:30Z","author_association":"CONTRIBUTOR","body":"We've worked out what's going on here so I've unassigned myself from this issue. Similar failures on Windows should be muted until we work out what to do with it - no need to report them here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/459647232","html_url":"https://github.com/elastic/elasticsearch/issues/33857#issuecomment-459647232","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33857","id":459647232,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1OTY0NzIzMg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-02-01T08:38:10Z","updated_at":"2019-02-01T08:38:10Z","author_association":"CONTRIBUTOR","body":"This is a Windows limitation with MMapDirectory we cannot do anything about -> Closing","performed_via_github_app":null}]