{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/49117","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49117/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49117/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49117/events","html_url":"https://github.com/elastic/elasticsearch/issues/49117","id":523126916,"node_id":"MDU6SXNzdWU1MjMxMjY5MTY=","number":49117,"title":"Painless unit tests force creation of local heap dump","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-11-14T21:56:08Z","updated_at":"2020-11-11T21:47:28Z","closed_at":"2019-12-11T23:39:07Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"We configure our test execution JVMs to [create a heap dump](https://github.com/elastic/elasticsearch/blob/1f3d1019e71dcc1aa8158b4a38139ed1227d381e/buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy#L648) on OOMEs by default. In the case of our painless tests however we have some coverage that forces an OOME and thus triggers a heap dump. Since heap dumps are expensive and this is an expected case we explicitly [disable this default behavior](https://github.com/elastic/elasticsearch/blob/3a3e5f6176134e12a64fb1306d4f9844a0243efb/modules/lang-painless/build.gradle#L45) specifically for the `lang-painless` module. It seems at some point we lost this behavior and we are getting heap dumps again. The suspicion is that this is unexpected fallout from using a `JvmArgumentProvider` to pass the heap dump options to the test JVM. We should refactor how we pass these arguments such that we can continue to override them on a per-project basis if desired.\r\n\r\nhttps://gradle-enterprise.elastic.co/s/wdnqxdzasqxve/console-log?task=:modules:lang-painless:test#L1\r\nhttps://gradle-enterprise.elastic.co/s/tmben7c43aock/console-log?task=:modules:lang-painless:test","closed_by":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"performed_via_github_app":null}