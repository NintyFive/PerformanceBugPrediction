{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21834","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21834/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21834/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21834/events","html_url":"https://github.com/elastic/elasticsearch/issues/21834","id":192074730,"node_id":"MDU6SXNzdWUxOTIwNzQ3MzA=","number":21834,"title":"Elasticsearch 1.5.2/2.3.4 periodic CPU spikes on windows 2012","user":{"login":"oldenbur","id":4369022,"node_id":"MDQ6VXNlcjQzNjkwMjI=","avatar_url":"https://avatars0.githubusercontent.com/u/4369022?v=4","gravatar_id":"","url":"https://api.github.com/users/oldenbur","html_url":"https://github.com/oldenbur","followers_url":"https://api.github.com/users/oldenbur/followers","following_url":"https://api.github.com/users/oldenbur/following{/other_user}","gists_url":"https://api.github.com/users/oldenbur/gists{/gist_id}","starred_url":"https://api.github.com/users/oldenbur/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oldenbur/subscriptions","organizations_url":"https://api.github.com/users/oldenbur/orgs","repos_url":"https://api.github.com/users/oldenbur/repos","events_url":"https://api.github.com/users/oldenbur/events{/privacy}","received_events_url":"https://api.github.com/users/oldenbur/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":146854632,"node_id":"MDU6TGFiZWwxNDY4NTQ2MzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Network","name":":Distributed/Network","color":"0e8a16","default":false,"description":"Http and internode communication implementations"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-11-28T18:00:34Z","updated_at":"2017-03-13T17:11:38Z","closed_at":"2017-03-13T17:11:38Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**: 1.5.2 and 2.3.4\r\n\r\n**JVM version**: 1.8.0_92\r\n\r\n**OS version**: Windows 2012\r\n\r\n**Description of the problem including expected versus actual behavior**: \r\nPeriodically, an elasticsearch instance running on some windows systems experience a sudden spike in CPU activity in the elasticsearch process and the indexing rate slows.  Here is a Java Mission Control flight recording that includes such a period: https://dl.dropboxusercontent.com/u/90795372/flight_recording_Elasticsearch4000.jfr \r\n\r\nThe configuration for the affected instances uses the default value for `index.store.type`. \r\n\r\nUsing information from the flight recording, we found a netty issue that might be relevant: https://github.com/netty/netty/issues/3857\r\n\r\nWe suspect that the problem is related to other processes on the system interacting with the WMI system, because when these systems are stopped the CPU spikes stop occurring.\r\n\r\n**Steps to reproduce**:\r\n 1. Install elasticsearch 1.5.2 or 2.3.4 on a windows and apply indexing load\r\n 2. Initiate another process to interact with the WMI system\r\n 3. Observe elasticsearch process CPU periodically increase dramatically and indexing rate slow \r\n\r\n**Provide logs (if relevant)**:\r\nIn the attached log usaseclm01.log.txt, the user reported two periods where CPU activity spiked to 100%: between 16:35 and 16:44, then again between 16:55 and 17:08. During both of these windows, elasticsearch appears to have been performing 20ish minute segment merges and was otherwise unresponsive.  We know this because during normal activity, a set of indices is deleted and re-created every 5 minutes (this can be seen elsewhere in the log file).\r\n\r\n[usaseclm01.log.txt](https://github.com/elastic/elasticsearch/files/667103/usaseclm01.log.txt)\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}