{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10253","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10253/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10253/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10253/events","html_url":"https://github.com/elastic/elasticsearch/issues/10253","id":64182138,"node_id":"MDU6SXNzdWU2NDE4MjEzOA==","number":10253,"title":"`min_score` not working in `function_score` query","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":190834096,"node_id":"MDU6TGFiZWwxOTA4MzQwOTY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.5.1","name":"v1.5.1","color":"dddddd","default":false,"description":null},{"id":182334038,"node_id":"MDU6TGFiZWwxODIzMzQwMzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.6.0","name":"v1.6.0","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"assignees":[{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2015-03-25T05:36:26Z","updated_at":"2018-02-14T13:39:48Z","closed_at":"2015-03-31T14:21:12Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The new `min_score` functionality in the `function_score` query doesn't seem to to work as advertised.  For instance:\n\n```\nDELETE t\n\nPUT t\n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"foo\": {\n          \"type\": \"nested\",\n          \"properties\": {\n            \"key\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"value\": {\n              \"type\": \"long\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\nPUT /t/t/1\n{\n  \"name\": \"test\",\n  \"foo\": [\n    {\n      \"key\": \"bar\",\n      \"value\": 10\n    },\n    {\n      \"key\": \"bar\",\n      \"value\": 20\n    },\n    {\n      \"key\": \"bar\",\n      \"value\": 30\n    },\n    {\n      \"key\": \"bar\",\n      \"value\": 40\n    }\n  ]\n}\n```\n\nThis query returns a score of 4 for the above document, which means that it should be filtered out by the `min_score` of `10`:\n\n```\nGET /_search\n{\n  \"query\": {\n    \"function_score\": {\n      \"boost_mode\": \"replace\",\n      \"min_score\": 10,\n      \"query\": {\n        \"nested\": {\n          \"path\": \"foo\",\n          \"score_mode\": \"sum\",\n          \"query\": {\n            \"constant_score\": {\n              \"filter\": {\n                \"match_all\": {}\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n","closed_by":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"performed_via_github_app":null}