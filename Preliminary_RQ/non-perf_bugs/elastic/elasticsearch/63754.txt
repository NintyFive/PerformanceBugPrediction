{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/63754","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63754/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63754/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63754/events","html_url":"https://github.com/elastic/elasticsearch/issues/63754","id":722440864,"node_id":"MDU6SXNzdWU3MjI0NDA4NjQ=","number":63754,"title":"SLM policy unexpectedly executed twice","user":{"login":"alisonelizabeth","id":5226211,"node_id":"MDQ6VXNlcjUyMjYyMTE=","avatar_url":"https://avatars1.githubusercontent.com/u/5226211?v=4","gravatar_id":"","url":"https://api.github.com/users/alisonelizabeth","html_url":"https://github.com/alisonelizabeth","followers_url":"https://api.github.com/users/alisonelizabeth/followers","following_url":"https://api.github.com/users/alisonelizabeth/following{/other_user}","gists_url":"https://api.github.com/users/alisonelizabeth/gists{/gist_id}","starred_url":"https://api.github.com/users/alisonelizabeth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alisonelizabeth/subscriptions","organizations_url":"https://api.github.com/users/alisonelizabeth/orgs","repos_url":"https://api.github.com/users/alisonelizabeth/repos","events_url":"https://api.github.com/users/alisonelizabeth/events{/privacy}","received_events_url":"https://api.github.com/users/alisonelizabeth/received_events","type":"User","site_admin":false},"labels":[{"id":912828538,"node_id":"MDU6TGFiZWw5MTI4Mjg1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/ILM+SLM","name":":Core/Features/ILM+SLM","color":"0e8a16","default":false,"description":"Index and Snapshot lifecycle management"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-10-15T15:28:41Z","updated_at":"2020-10-15T19:14:27Z","closed_at":"2020-10-15T19:14:27Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.9\r\n\r\n**Description of the problem including expected versus actual behavior**: A SLM policy is getting triggered twice at the same time daily.\r\n\r\nPolicy definition: \r\n\r\n```\r\n    \"policy\" : {\r\n      \"name\" : \"<snapshotrepo01-{now/d}>\",\r\n      \"schedule\" : \"0 30 1 * * ?\",\r\n      \"repository\" : \"Repo_01\",\r\n      \"config\" : {\r\n        \"indices\" : [ ]\r\n      },\r\n      \"retention\" : {\r\n        \"expire_after\" : \"20d\",\r\n        \"max_count\" : 20\r\n      }\r\n    },\r\n```\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n[2020-10-09T19:29:59,873][DEBUG][o.e.x.s.SnapshotLifecycleTask] [VST3ESATESTT01] snapshot lifecycle policy task triggered from job [Daily-Snapshots-2]\r\n[2020-10-09T19:29:59,873][INFO ][o.e.x.s.SnapshotLifecycleTask] [VST3ESATESTT01] snapshot lifecycle policy [Daily-Snapshots] issuing create snapshot [snapshotrepo01-daily-2020.10.10-gcgzdxlaq4iwjcyygzniag]\r\n[2020-10-09T19:29:59,905][INFO ][o.e.x.s.SnapshotLifecycleTask] [VST3ESATESTT01] snapshot lifecycle policy job [Daily-Snapshots-2] issued new snapshot creation for [snapshotrepo01-daily-2020.10.10-gcgzdxlaq4iwjcyygzniag] successfully\r\n[2020-10-09T19:29:59,971][INFO ][o.e.s.SnapshotsService   ] [VST3ESATESTT01] snapshot [Repo_01:snapshotrepo01-daily-2020.10.10-gcgzdxlaq4iwjcyygzniag/sOOFeP8vToeujQIAiSPBWQ] started\r\n[2020-10-09T19:30:00,049][DEBUG][o.e.x.s.SnapshotLifecycleTask] [VST3ESATESTT01] snapshot lifecycle policy task triggered from job [Daily-Snapshots-2]\r\n[2020-10-09T19:30:00,049][INFO ][o.e.x.s.SnapshotLifecycleTask] [VST3ESATESTT01] snapshot lifecycle policy [Daily-Snapshots] issuing create snapshot [snapshotrepo01-daily-2020.10.10-zjit3qp9ro6lnjas-zv-da]\r\n[2020-10-09T19:30:00,078][INFO ][o.e.x.s.SnapshotLifecycleTask] [VST3ESATESTT01] snapshot lifecycle policy job [Daily-Snapshots-2] issued new snapshot creation for [snapshotrepo01-daily-2020.10.10-zjit3qp9ro6lnjas-zv-da] successfully\r\n[2020-10-09T19:30:00,203][INFO ][o.e.s.SnapshotsService   ] [VST3ESATESTT01] snapshot [Repo_01:snapshotrepo01-daily-2020.10.10-zjit3qp9ro6lnjas-zv-da/k0vrURFyR5G3Vr8PxvF6xA] started\r\n[2020-10-09T19:31:00,774][DEBUG][o.e.x.s.SnapshotLifecycleTask] [VST3ESATESTT01] snapshot response for [Daily-Snapshots]: {\"snapshot\":{\"snapshot\":\"snapshotrepo01-daily-2020.10.10-gcgzdxlaq4iwjcyygzniag\",\"uuid\":\"sOOFeP8vToeujQIAiSPBWQ\",\"version_id\":7090299,\"version\":\"7.9.2\",\"indices\":[\".watcher-history-11-2020.10.07\",\"metricbeat-7.5.2-2020.06.12-000006\",\".slm-history-1-000007\",\".monitoring-kibana-7-2020.10.04\",\"kibana_sample_data_flights_restored\",\"metricbeat-7.5.1-2020.04.06-000003\",\".kibana-event-log-7.9.2-000001\",\".apm-agent-configuration\",\"winlogbeat-7.5.1-2020.10.10-002717\",\"metricbeat-7.5.2-2020.09.10-000009\",\".slm-history-1-000005\",\"metricbeat-7.4.2-2020.01.26-000002\",\".kibana_task_manager_2\",\".slm-history-1-000008\",\".security-7\",\"metricbeat-7.5.1-2020.05.06-000004\",\"filebeat-7.5.2-2020.07.05-000006\",\".kibana_3\",\"metricbeat-7.5.2-2020.07.12-000007\",\".monitoring-alerts-7\",\"ilm-history-2-000001\",\".monitoring-es-7-2020.10.06\",\"metricbeat-7.4.2-2020.07.24-000008\",\"metricbeat-7.5.1-2020.06.05-000005\",\"metricbeat-7.5.1-2020.08.05-000007\",\".watcher-history-11-2020.10.05\",\"kibana_sample_data_flights\",\"metricbeat-7.4.2-2020.03.26-000004\",\".monitoring-es-7-2020.10.05\",\".slm-history-1-000006\",\"ilm-history-2-000002\",\"filebeat-7.5.2-2020.03.07-000002\",\".monitoring-kibana-7-2020.10.05\",\"kibana_sample_data_flights_restored1\",\"metricbeat-7.5.1-2020.03.07-000002\",\".kibana_task_manager_1\",\".monitoring-kibana-7-2020.10.06\",\".slm-history-2-000002\",\"filebeat-7.4.2-2020.10.09-002645\",\".async-search\",\"filebeat-7.9.1-2020.10.03-000002\",\".monitoring-es-7-2020.10.09\",\"metricbeat-7.5.2-2020.03.14-000003\",\".monitoring-es-7-2020.10.04\",\".monitoring-kibana-7-2020.10.08\",\"metricbeat-7.4.2-2020.04.25-000005\",\"winlogbeat-7.5.2-2020.10.10-002724\",\".monitoring-es-7-2020.10.08\",\"filebeat-7.5.2-2020.08.04-000007\",\".triggered_watches\",\"filebeat-7.5.2-2020.09.03-000008\",\".kibana_1\",\".kibana-event-log-7.9.0-000002\",\".watcher-history-11-2020.10.08\",\".kibana-event-log-7.9.1-000002\",\"filebeat-7.4.2-2020.01.14-000001\",\"kibana_sample_data_ecommerce\",\"winlogbeat-7.5.2-2020.10.09-002723\",\"metricbeat-7.5.2-2020.02.13-000002\",\".monitoring-kibana-7-2020.10.07\",\"metricbeat-7.5.1-2020.09.04-000008\",\".slm-history-2-000001\",\".watcher-history-11-2020.06.15\",\".monitoring-es-7-2020.10.07\",\"winlogbeat-7.4.2-2020.10.10-002648\",\"filebeat-7.5.2-2020.05.06-000004\",\"nuix_stats\",\"winlogbeat-7.4.2-2020.10.09-002647\",\"metricbeat-7.4.2-2020.08.23-000009\",\"my-index-000001\",\".kibana_1_restored\",\"metricbeat-7.5.1-2020.07.06-000006\",\"soniccopy\",\".kibana-event-log-7.9.0-000001\",\"filebeat-7.5.2-2020.04.06-000003\",\"metricbeat-7.5.1-2020.02.06-000001\",\".monitoring-kibana-7-2020.10.10\",\".watcher-history-11-2020.10.10\",\"filebeat-7.4.2-2020.10.10-002646\",\"winlogbeat-7.4.2-2020.01.14-000001\",\"metricbeat-7.4.2-2020.09.22-000010\",\".management-beats\",\"metricbeat-7.4.2-2020.06.24-000007\",\".watcher-history-11-2020.10.04\",\"filebeat-7.9.1-2020.09.03-000001\",\"justin_test\",\"filebeat-7.5.2-2020.06.05-000005\",\".kibana-event-log-7.9.1-000001\",\"metricbeat-7.4.2-2020.02.25-000003\",\"metricbeat-7.5.2-2020.08.11-000008\",\".monitoring-kibana-7-2020.10.09\",\".watches\",\".watcher-history-11-2020.10.09\",\"kibana_sample_data_logs\",\"metricbeat-7.5.2-2020.04.13-000004\",\"metricbeat-7.5.2-2020.10.10-000010\",\".kibana_2\",\"metricbeat-7.4.2-2020.05.25-000006\",\"filebeat-7.5.2-2020.10.03-000009\",\".apm-custom-link\",\"metricbeat-7.5.2-2020.05.13-000005\",\"winlogbeat-7.5.1-2020.10.09-002716\",\"metricbeat-7.5.1-2020.10.04-000009\",\".watcher-history-11-2020.10.06\",\".monitoring-es-7-2020.10.10\"],\"data_streams\":[],\"include_global_state\":true,\"metadata\":{\"policy\":\"Daily-Snapshots\"},\"state\":\"SUCCESS\",\"start_time\":\"2020-10-10T02:29:59.905Z\",\"start_time_in_millis\":1602296999905,\"end_time\":\"2020-10-10T02:30:59.555Z\",\"end_time_in_millis\":1602297059555,\"duration_in_millis\":59650,\"failures\":[],\"shards\":{\"total\":105,\"failed\":0,\"successful\":105}}}\r\n[2020-10-09T19:31:00,774][INFO ][o.e.s.SnapshotsService   ] [VST3ESATESTT01] snapshot [Repo_01:snapshotrepo01-daily-2020.10.10-gcgzdxlaq4iwjcyygzniag/sOOFeP8vToeujQIAiSPBWQ] completed with state [SUCCESS]\r\n[2020-10-09T19:31:01,905][DEBUG][o.e.x.s.SnapshotLifecycleTask] [VST3ESATESTT01] snapshot response for [Daily-Snapshots]: {\"snapshot\":{\"snapshot\":\"snapshotrepo01-daily-2020.10.10-zjit3qp9ro6lnjas-zv-da\",\"uuid\":\"k0vrURFyR5G3Vr8PxvF6xA\",\"version_id\":7090299,\"version\":\"7.9.2\",\"indices\":[\".watcher-history-11-2020.10.07\",\"metricbeat-7.5.2-2020.06.12-000006\",\".slm-history-1-000007\",\".monitoring-kibana-7-2020.10.04\",\"metricbeat-7.5.1-2020.04.06-000003\",\"kibana_sample_data_flights_restored\",\".kibana-event-log-7.9.2-000001\",\".apm-agent-configuration\",\"winlogbeat-7.5.1-2020.10.10-002717\",\"metricbeat-7.5.2-2020.09.10-000009\",\".slm-history-1-000005\",\"metricbeat-7.4.2-2020.01.26-000002\",\".kibana_task_manager_2\",\".slm-history-1-000008\",\".security-7\",\"metricbeat-7.5.1-2020.05.06-000004\",\"filebeat-7.5.2-2020.07.05-000006\",\".kibana_3\",\".monitoring-alerts-7\",\"metricbeat-7.5.2-2020.07.12-000007\",\"ilm-history-2-000001\",\".monitoring-es-7-2020.10.06\",\"metricbeat-7.4.2-2020.07.24-000008\",\"metricbeat-7.5.1-2020.06.05-000005\",\"metricbeat-7.5.1-2020.08.05-000007\",\".watcher-history-11-2020.10.05\",\"kibana_sample_data_flights\",\"metricbeat-7.4.2-2020.03.26-000004\",\".monitoring-es-7-2020.10.05\",\".slm-history-1-000006\",\"ilm-history-2-000002\",\"filebeat-7.5.2-2020.03.07-000002\",\".monitoring-kibana-7-2020.10.05\",\"kibana_sample_data_flights_restored1\",\"metricbeat-7.5.1-2020.03.07-000002\",\".kibana_task_manager_1\",\".monitoring-kibana-7-2020.10.06\",\".slm-history-2-000002\",\"filebeat-7.4.2-2020.10.09-002645\",\".async-search\",\"filebeat-7.9.1-2020.10.03-000002\",\".monitoring-es-7-2020.10.09\",\"metricbeat-7.5.2-2020.03.14-000003\",\".monitoring-es-7-2020.10.04\",\"winlogbeat-7.5.2-2020.10.10-002724\",\".monitoring-kibana-7-2020.10.08\",\"metricbeat-7.4.2-2020.04.25-000005\",\".monitoring-es-7-2020.10.08\",\"filebeat-7.5.2-2020.08.04-000007\",\".triggered_watches\",\"filebeat-7.5.2-2020.09.03-000008\",\".kibana_1\",\".kibana-event-log-7.9.0-000002\",\".watcher-history-11-2020.10.08\",\"filebeat-7.4.2-2020.01.14-000001\",\".kibana-event-log-7.9.1-000002\",\"kibana_sample_data_ecommerce\",\"winlogbeat-7.5.2-2020.10.09-002723\",\"metricbeat-7.5.2-2020.02.13-000002\",\".monitoring-kibana-7-2020.10.07\",\".slm-history-2-000001\",\"metricbeat-7.5.1-2020.09.04-000008\",\".watcher-history-11-2020.06.15\",\".monitoring-es-7-2020.10.07\",\"filebeat-7.5.2-2020.05.06-000004\",\"winlogbeat-7.4.2-2020.10.10-002648\",\"nuix_stats\",\"metricbeat-7.4.2-2020.08.23-000009\",\"winlogbeat-7.4.2-2020.10.09-002647\",\"my-index-000001\",\"metricbeat-7.5.1-2020.07.06-000006\",\".kibana_1_restored\",\"soniccopy\",\".kibana-event-log-7.9.0-000001\",\"filebeat-7.5.2-2020.04.06-000003\",\"metricbeat-7.5.1-2020.02.06-000001\",\".monitoring-kibana-7-2020.10.10\",\".watcher-history-11-2020.10.10\",\"filebeat-7.4.2-2020.10.10-002646\",\"winlogbeat-7.4.2-2020.01.14-000001\",\"metricbeat-7.4.2-2020.09.22-000010\",\".management-beats\",\"metricbeat-7.4.2-2020.06.24-000007\",\".watcher-history-11-2020.10.04\",\"filebeat-7.9.1-2020.09.03-000001\",\"justin_test\",\".kibana-event-log-7.9.1-000001\",\"filebeat-7.5.2-2020.06.05-000005\",\"metricbeat-7.4.2-2020.02.25-000003\",\"metricbeat-7.5.2-2020.08.11-000008\",\".monitoring-kibana-7-2020.10.09\",\".watches\",\".watcher-history-11-2020.10.09\",\"metricbeat-7.5.2-2020.04.13-000004\",\"kibana_sample_data_logs\",\"metricbeat-7.5.2-2020.10.10-000010\",\".kibana_2\",\"metricbeat-7.4.2-2020.05.25-000006\",\"filebeat-7.5.2-2020.10.03-000009\",\"metricbeat-7.5.2-2020.05.13-000005\",\".apm-custom-link\",\"winlogbeat-7.5.1-2020.10.09-002716\",\"metricbeat-7.5.1-2020.10.04-000009\",\".watcher-history-11-2020.10.06\",\".monitoring-es-7-2020.10.10\"],\"data_streams\":[],\"include_global_state\":true,\"metadata\":{\"policy\":\"Daily-Snapshots\"},\"state\":\"SUCCESS\",\"start_time\":\"2020-10-10T02:30:00.109Z\",\"start_time_in_millis\":1602297000109,\"end_time\":\"2020-10-10T02:31:00.586Z\",\"end_time_in_millis\":1602297060586,\"duration_in_millis\":60477,\"failures\":[],\"shards\":{\"total\":105,\"failed\":0,\"successful\":105}}}\r\n[2020-10-09T19:31:01,905][INFO ][o.e.s.SnapshotsService   ] [VST3ESATESTT01] snapshot [Repo_01:snapshotrepo01-daily-2020.10.10-zjit3qp9ro6lnjas-zv-da/k0vrURFyR5G3Vr8PxvF6xA] completed with state [SUCCESS]\r\n```\r\n\r\nNote that job `Daily-Snapshots-2` is triggered at 2020-10-09T19:29:59 and 2020-10-09T19:30:00.\r\n\r\n","closed_by":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"performed_via_github_app":null}