[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63036632","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-63036632","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":63036632,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDM2NjMy","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T10:09:59Z","updated_at":"2014-11-14T10:09:59Z","author_association":"CONTRIBUTOR","body":"@costin @gmarz @Mpdreamz any ideas about this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63080061","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-63080061","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":63080061,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDgwMDYx","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T15:29:44Z","updated_at":"2014-11-14T15:29:44Z","author_association":"MEMBER","body":"No but sounds like something fun to investigate:\n\nhttp://edc.tversu.ru/elib/inf/0088/0596003943_secureprgckbk-chp-13-sect-3.html\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63084188","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-63084188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":63084188,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDg0MTg4","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T15:53:22Z","updated_at":"2014-11-14T15:53:22Z","author_association":"MEMBER","body":"@clintongormley I've wondered this myself.  I knew VirtualLock existed, but have never done anything with it.  I'll start looking into it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67859639","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-67859639","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":67859639,"node_id":"MDEyOklzc3VlQ29tbWVudDY3ODU5NjM5","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"created_at":"2014-12-22T16:47:41Z","updated_at":"2014-12-22T16:47:41Z","author_association":"MEMBER","body":"So after looking into this a bit, it does look possible to leverage `VirtualLock`.  However, it's important to note that `VirtualLock` works a bit more like `mlock` than it does `mlockall`, and thus is more tedious to implement as it requires more information and setup upfront (size of region to lock, memory needs to be allocated, etc).  Unfortunately, there is no equivalent `VirtualLockAll` in Windows.\n\nIn short, there are two key steps that need to be taken before calling `VirtualLock`:\n- Increase working set size of the process using [SetProcessWorkingSetSize](http://msdn.microsoft.com/en-us/library/windows/desktop/ms686234%28v=vs.85%29.aspx).  By default, Windows limits the working set size of a process to ~30 pages.\n\n> This limit is intentionally small to avoid severe performance degradation. Applications that need to lock larger numbers of pages must first call the SetProcessWorkingSetSize function to increase their minimum and maximum working set sizes.\n- Allocate the region of memory to lock using [VirtualAlloc](http://msdn.microsoft.com/en-us/library/windows/desktop/aa366887%28v=vs.85%29.aspx).\n\nI've started implementing this in my own branch, and so far the results look good.  It'll probably be much easier to discuss this once we have some code to look at, so I'll open a PR once I'm confident with the changes and we can take it from there.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67865552","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-67865552","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":67865552,"node_id":"MDEyOklzc3VlQ29tbWVudDY3ODY1NTUy","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-22T17:34:57Z","updated_at":"2014-12-22T17:34:57Z","author_association":"CONTRIBUTOR","body":"nice work @gmarz \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69075882","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-69075882","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":69075882,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MDc1ODgy","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"created_at":"2015-01-07T19:22:39Z","updated_at":"2015-01-07T19:22:39Z","author_association":"MEMBER","body":"Need to make a slight amendment to my previous comment above.\n\nAfter digging a bit further, I've learned that there is no need for `VirtualAlloc`.  It's only useful for allocating and locking _new_ memory, where in this case, we need to lock the current memory already allocated by the JVM (Xms).\n\nThe only way I've found this possible is to walk the JVM address space using [VirtualQueryEx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa366907) and lock each page individually.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100797730","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-100797730","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":100797730,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDc5NzczMA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-05-11T07:32:15Z","updated_at":"2015-05-11T07:32:15Z","author_association":"CONTRIBUTOR","body":"I reverted both 1.x and master commits since tests are failing\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100898844","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-100898844","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":100898844,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDg5ODg0NA==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-05-11T13:00:34Z","updated_at":"2015-05-11T13:00:34Z","author_association":"CONTRIBUTOR","body":"I think its just a silly test bug? The failing test asserts that mlockall didn't succeed on windows, but now it can since its supported:\n\n```\npublic void testMlockall() {\n    if (Constants.WINDOWS) {\n        assertFalse(\"Memory locking is not available on Windows platforms\", Natives.LOCAL_MLOCKALL);\n    }\n    ...\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100907444","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-100907444","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":100907444,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDkwNzQ0NA==","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"created_at":"2015-05-11T13:28:57Z","updated_at":"2015-05-11T13:28:57Z","author_association":"MEMBER","body":"@rmuir Yup.  I'm fixing this now.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100916460","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-100916460","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":100916460,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDkxNjQ2MA==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-05-11T13:55:58Z","updated_at":"2015-05-11T13:55:58Z","author_association":"CONTRIBUTOR","body":"I think we should just remove that whole assert. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100916636","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-100916636","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":100916636,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDkxNjYzNg==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-05-11T13:56:43Z","updated_at":"2015-05-11T13:56:43Z","author_association":"CONTRIBUTOR","body":"+1, my browser was a bit out of date.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100940024","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-100940024","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":100940024,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDk0MDAyNA==","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"created_at":"2015-05-11T15:15:05Z","updated_at":"2015-05-11T15:15:05Z","author_association":"MEMBER","body":"I've put back the change and fixed the tests in [1.x](https://github.com/elastic/elasticsearch/commit/1aa5c77d4460d1382aa23c19ffe2b1a389f38295) and [master](https://github.com/elastic/elasticsearch/commit/cc3f02c0a03686b915b846d1aff04cd90cf29914).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110158046","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-110158046","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":110158046,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDE1ODA0Ng==","user":{"login":"javadevmtl","id":2964042,"node_id":"MDQ6VXNlcjI5NjQwNDI=","avatar_url":"https://avatars2.githubusercontent.com/u/2964042?v=4","gravatar_id":"","url":"https://api.github.com/users/javadevmtl","html_url":"https://github.com/javadevmtl","followers_url":"https://api.github.com/users/javadevmtl/followers","following_url":"https://api.github.com/users/javadevmtl/following{/other_user}","gists_url":"https://api.github.com/users/javadevmtl/gists{/gist_id}","starred_url":"https://api.github.com/users/javadevmtl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javadevmtl/subscriptions","organizations_url":"https://api.github.com/users/javadevmtl/orgs","repos_url":"https://api.github.com/users/javadevmtl/repos","events_url":"https://api.github.com/users/javadevmtl/events{/privacy}","received_events_url":"https://api.github.com/users/javadevmtl/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T22:09:18Z","updated_at":"2015-06-08T22:09:18Z","author_association":"NONE","body":"I would gladly love to test this. Currently getting 100% usage in Windows with mapped files :)\nI have 128GB server and twice made it up to 100% mem usage and unresponssive ES node.\n\nSome details here: https://discuss.elastic.co/t/100-windows-memory-usage-but-no-oom/2089/4\nAnd here: http://serverfault.com/questions/697511/setting-memory-mapped-file-limit-for-windows\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110478145","html_url":"https://github.com/elastic/elasticsearch/issues/8480#issuecomment-110478145","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8480","id":110478145,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDQ3ODE0NQ==","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"created_at":"2015-06-09T19:32:21Z","updated_at":"2015-06-09T19:32:21Z","author_association":"MEMBER","body":"Hey @javadevmtl this is available in [1.6](https://www.elastic.co/blog/elasticsearch-1-6-0-released), which we just released today.\n\nWould be great if you could test this and provide any feedback.  Really interested in seeing what effect it has on the issue your experiencing.\n","performed_via_github_app":null}]