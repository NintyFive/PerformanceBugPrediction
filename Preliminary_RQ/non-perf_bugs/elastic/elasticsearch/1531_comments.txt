[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3139024","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-3139024","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":3139024,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzkwMjQ=","user":{"login":"karussell","id":129644,"node_id":"MDQ6VXNlcjEyOTY0NA==","avatar_url":"https://avatars0.githubusercontent.com/u/129644?v=4","gravatar_id":"","url":"https://api.github.com/users/karussell","html_url":"https://github.com/karussell","followers_url":"https://api.github.com/users/karussell/followers","following_url":"https://api.github.com/users/karussell/following{/other_user}","gists_url":"https://api.github.com/users/karussell/gists{/gist_id}","starred_url":"https://api.github.com/users/karussell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karussell/subscriptions","organizations_url":"https://api.github.com/users/karussell/orgs","repos_url":"https://api.github.com/users/karussell/repos","events_url":"https://api.github.com/users/karussell/events{/privacy}","received_events_url":"https://api.github.com/users/karussell/received_events","type":"User","site_admin":false},"created_at":"2011-12-14T12:49:00Z","updated_at":"2011-12-14T12:49:00Z","author_association":"CONTRIBUTOR","body":"link to discussion?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3398564","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-3398564","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":3398564,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTg1NjQ=","user":{"login":"gustavobmaia","id":585538,"node_id":"MDQ6VXNlcjU4NTUzOA==","avatar_url":"https://avatars3.githubusercontent.com/u/585538?v=4","gravatar_id":"","url":"https://api.github.com/users/gustavobmaia","html_url":"https://github.com/gustavobmaia","followers_url":"https://api.github.com/users/gustavobmaia/followers","following_url":"https://api.github.com/users/gustavobmaia/following{/other_user}","gists_url":"https://api.github.com/users/gustavobmaia/gists{/gist_id}","starred_url":"https://api.github.com/users/gustavobmaia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gustavobmaia/subscriptions","organizations_url":"https://api.github.com/users/gustavobmaia/orgs","repos_url":"https://api.github.com/users/gustavobmaia/repos","events_url":"https://api.github.com/users/gustavobmaia/events{/privacy}","received_events_url":"https://api.github.com/users/gustavobmaia/received_events","type":"User","site_admin":false},"created_at":"2012-01-07T21:58:08Z","updated_at":"2012-01-07T21:58:08Z","author_association":"NONE","body":"I have the same problem.\n\nI think it creates a cache of the fields you want to do the facet, so if you have many documents will have to have a lot of memory. Imagine that I have a billion documents, I'll never have enough memory to make facets.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3401500","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-3401500","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":3401500,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDE1MDA=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2012-01-08T11:05:58Z","updated_at":"2012-01-08T11:05:58Z","author_association":"MEMBER","body":"It depends on the number of terms you have for that field. The terms facet is not aimed to have facets on a \"body of text\", its more aimed at having facets on categories, tags, and the like.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3402701","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-3402701","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":3402701,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDI3MDE=","user":{"login":"gustavobmaia","id":585538,"node_id":"MDQ6VXNlcjU4NTUzOA==","avatar_url":"https://avatars3.githubusercontent.com/u/585538?v=4","gravatar_id":"","url":"https://api.github.com/users/gustavobmaia","html_url":"https://github.com/gustavobmaia","followers_url":"https://api.github.com/users/gustavobmaia/followers","following_url":"https://api.github.com/users/gustavobmaia/following{/other_user}","gists_url":"https://api.github.com/users/gustavobmaia/gists{/gist_id}","starred_url":"https://api.github.com/users/gustavobmaia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gustavobmaia/subscriptions","organizations_url":"https://api.github.com/users/gustavobmaia/orgs","repos_url":"https://api.github.com/users/gustavobmaia/repos","events_url":"https://api.github.com/users/gustavobmaia/events{/privacy}","received_events_url":"https://api.github.com/users/gustavobmaia/received_events","type":"User","site_admin":false},"created_at":"2012-01-08T15:55:41Z","updated_at":"2012-01-08T15:55:41Z","author_association":"NONE","body":"Today, I have a million and 4 million document tag when I do in every facet documents, I have a problem with OutOfMemory. I started the JVM with 4GB.\nThis is normal I have problem with OutOfMemory?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3403444","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-3403444","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":3403444,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDM0NDQ=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2012-01-08T18:12:07Z","updated_at":"2012-01-08T18:12:07Z","author_association":"MEMBER","body":"@gustavobbamaia it depends on what you facet on. All the values need to be loaded to memory for fast access.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3800850","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-3800850","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":3800850,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MDA4NTA=","user":{"login":"jsuchal","id":26342,"node_id":"MDQ6VXNlcjI2MzQy","avatar_url":"https://avatars0.githubusercontent.com/u/26342?v=4","gravatar_id":"","url":"https://api.github.com/users/jsuchal","html_url":"https://github.com/jsuchal","followers_url":"https://api.github.com/users/jsuchal/followers","following_url":"https://api.github.com/users/jsuchal/following{/other_user}","gists_url":"https://api.github.com/users/jsuchal/gists{/gist_id}","starred_url":"https://api.github.com/users/jsuchal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jsuchal/subscriptions","organizations_url":"https://api.github.com/users/jsuchal/orgs","repos_url":"https://api.github.com/users/jsuchal/repos","events_url":"https://api.github.com/users/jsuchal/events{/privacy}","received_events_url":"https://api.github.com/users/jsuchal/received_events","type":"User","site_admin":false},"created_at":"2012-02-03T17:42:07Z","updated_at":"2012-02-03T18:36:46Z","author_association":"NONE","body":"@kimchy Having a facet on a field with millions of entries and trying to only find top-N is a great interest for me. I have done some preliminary research how this can be done with fixed memory constraints. Basically I've spent several hours reading research papers.\n\nThe best solution I've found is called Count-Min Sketch (http://www.eecs.harvard.edu/~michaelm/CS222/countmin.pdf) or blog for non-academic readers (http://lkozma.net/blog/sketching-data-structures/) or this is a pretty good paper explaining a similar approach http://www.ece.uc.edu/~mazlack/dbm.w2010/Charikar.02.pdf\n\nThese algorithms however give approximate counts (with parametrizable error bounds), but that is something most users we can live with IMO.\n\nDespite academic jargon, proofs and equations everywhere this is actually pretty straightforward to implement. Any chance that this will land in ES?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/4115520","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-4115520","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":4115520,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTU1MjA=","user":{"login":"drewr","id":6202,"node_id":"MDQ6VXNlcjYyMDI=","avatar_url":"https://avatars3.githubusercontent.com/u/6202?v=4","gravatar_id":"","url":"https://api.github.com/users/drewr","html_url":"https://github.com/drewr","followers_url":"https://api.github.com/users/drewr/followers","following_url":"https://api.github.com/users/drewr/following{/other_user}","gists_url":"https://api.github.com/users/drewr/gists{/gist_id}","starred_url":"https://api.github.com/users/drewr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drewr/subscriptions","organizations_url":"https://api.github.com/users/drewr/orgs","repos_url":"https://api.github.com/users/drewr/repos","events_url":"https://api.github.com/users/drewr/events{/privacy}","received_events_url":"https://api.github.com/users/drewr/received_events","type":"User","site_admin":false},"created_at":"2012-02-22T19:03:55Z","updated_at":"2012-02-22T19:03:55Z","author_association":"MEMBER","body":"This has been biting us as well.  Tracked it down to `ordinals` List in FieldDataLoader.load().  With few segments and a query on a field with a large set of unique terms it can grow to a huge size even with a modest data size.  The fewer the segments, the larger maxDocs() becomes (seems to be max out at 1k in our setup), resulting in a duplication of that `1k*sizeof(int)` footprint as it adds a row to `ordinals` for every doc where a single term is present.\n\nWould you accept patches that use a different storage scheme or have you already planned out how you will address in 0.20?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/4116286","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-4116286","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":4116286,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTYyODY=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2012-02-22T19:15:12Z","updated_at":"2012-02-22T19:15:12Z","author_association":"MEMBER","body":"Which patch were you thinking about. I just commented on the another issue #1683, where I explained why the structure is as is.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/4117216","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-4117216","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":4117216,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTcyMTY=","user":{"login":"Alex-Ikanow","id":851950,"node_id":"MDQ6VXNlcjg1MTk1MA==","avatar_url":"https://avatars2.githubusercontent.com/u/851950?v=4","gravatar_id":"","url":"https://api.github.com/users/Alex-Ikanow","html_url":"https://github.com/Alex-Ikanow","followers_url":"https://api.github.com/users/Alex-Ikanow/followers","following_url":"https://api.github.com/users/Alex-Ikanow/following{/other_user}","gists_url":"https://api.github.com/users/Alex-Ikanow/gists{/gist_id}","starred_url":"https://api.github.com/users/Alex-Ikanow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Alex-Ikanow/subscriptions","organizations_url":"https://api.github.com/users/Alex-Ikanow/orgs","repos_url":"https://api.github.com/users/Alex-Ikanow/repos","events_url":"https://api.github.com/users/Alex-Ikanow/events{/privacy}","received_events_url":"https://api.github.com/users/Alex-Ikanow/received_events","type":"User","site_admin":false},"created_at":"2012-02-22T19:29:14Z","updated_at":"2012-02-22T19:33:19Z","author_association":"NONE","body":"@Drewr, others: In case it's useful: I solved a similar problem (related to having lists of terms, where the list could be \n\"large\" but was \"small\" on average) by keeping a separate index for documents with many list elements.\n\nEg I reduced my memory usage from ~14GB down to ~2GB by moving the \"worst\" ~0.1% documents into the new index (some more details are available in issue #1683 ref'd by Shay above, and the original thread in the es forum that spawned the issue).\n\nNote that if you are only faceting/searching on fields, then making the objects nested will also solve the memory problem (at the expense of some performance, though it wasn't noticeable for me). I couldn't do this for me one of my fields (geo-tags) because I needed them for custom scripts, hence the secondary workaround.\n\nAlso, despite Shay's warnings, I have had success using the \"soft\" cache (in my case sometimes people create facets on big fields once or twice and then don't use them again; obviously if you have a single facet or set of common facets that exceed memory then this is a terrible idea!)\n\n@Shay: My suggestion in #1683 was to have a hybrid storage, where most documents were stored as at present, but \"large\" (user-tunable parameter?) documents were stored \"the other way round\". (ie effectively an internal version of what I did with seperate indexes)\n\n(fwiw I think it's possible that \"good\" containers could let you do whole thing \"the other way round\", but every time I sketched down some thoughts I ended up needing to write it in C++!)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/4117449","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-4117449","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":4117449,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTc0NDk=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2012-02-22T19:32:20Z","updated_at":"2012-02-22T19:32:20Z","author_association":"MEMBER","body":"@Alex-Ikanow yea, agreed, other modes of storage / usage would be great. The first thing I want to do is to create that relevant abstraction (or improve on the current one) in elasticsearch, and be able to configure to use different models in the mappings (or dynamically detected and used). This will allow for better plugability that is missing today, and hopefully will help foster other implementations.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/20059942","html_url":"https://github.com/elastic/elasticsearch/issues/1531#issuecomment-20059942","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1531","id":20059942,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMDU5OTQy","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2013-06-26T16:11:17Z","updated_at":"2013-06-26T16:11:17Z","author_association":"MEMBER","body":"Closing this one for now. 0.90 brought great improvements in regard to high cardinality fields and memory consumption when doing faceting on these. In addition there are ideas about the different modes of storage/usage Shay mentioned above. I guess we should rather create different issues for those than using this issue.\n","performed_via_github_app":null}]