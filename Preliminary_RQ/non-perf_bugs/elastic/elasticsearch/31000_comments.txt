[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393514764","html_url":"https://github.com/elastic/elasticsearch/issues/31000#issuecomment-393514764","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31000","id":393514764,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MzUxNDc2NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-31T12:31:44Z","updated_at":"2018-05-31T12:31:44Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/552469090","html_url":"https://github.com/elastic/elasticsearch/issues/31000#issuecomment-552469090","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31000","id":552469090,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MjQ2OTA5MA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2019-11-11T14:33:15Z","updated_at":"2019-11-11T14:33:15Z","author_association":"MEMBER","body":"I finally got to doing some digging on this one. Indeed, it is a very peculiar bug, and I am not sure yet how to solve it, but I can now explain how it happens: this only happens when explaining a script score function that's part of a nested query inside a rescore section. \r\n\r\nWhen trying to explain the score function, we [run the script](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunction.java#L97) which ends up calling [LeafSearchLookup#setDocument](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/search/lookup/LeafSearchLookup.java#L67) which calls [SourceLookup#setSegmentAndDocument](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/search/lookup/SourceLookup.java#L99) that ends up zeroing the source that was previously loaded, as we are going through a different docId compared to the previous run (nested doc rather than parent doc).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/659368667","html_url":"https://github.com/elastic/elasticsearch/issues/31000#issuecomment-659368667","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31000","id":659368667,"node_id":"MDEyOklzc3VlQ29tbWVudDY1OTM2ODY2Nw==","user":{"login":"fhaase2","id":44052928,"node_id":"MDQ6VXNlcjQ0MDUyOTI4","avatar_url":"https://avatars2.githubusercontent.com/u/44052928?v=4","gravatar_id":"","url":"https://api.github.com/users/fhaase2","html_url":"https://github.com/fhaase2","followers_url":"https://api.github.com/users/fhaase2/followers","following_url":"https://api.github.com/users/fhaase2/following{/other_user}","gists_url":"https://api.github.com/users/fhaase2/gists{/gist_id}","starred_url":"https://api.github.com/users/fhaase2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fhaase2/subscriptions","organizations_url":"https://api.github.com/users/fhaase2/orgs","repos_url":"https://api.github.com/users/fhaase2/repos","events_url":"https://api.github.com/users/fhaase2/events{/privacy}","received_events_url":"https://api.github.com/users/fhaase2/received_events","type":"User","site_admin":false},"created_at":"2020-07-16T12:08:35Z","updated_at":"2020-07-16T12:08:35Z","author_association":"NONE","body":"@javanna do you have a suggestion how to make it still working? Is there some hack?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/664567160","html_url":"https://github.com/elastic/elasticsearch/issues/31000#issuecomment-664567160","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31000","id":664567160,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NDU2NzE2MA==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2020-07-27T18:34:31Z","updated_at":"2020-07-27T18:34:39Z","author_association":"MEMBER","body":"@fhaase2 unfortunately I can't think of a workaround that doesn't change meaning of the request. If you could rework the request to remove the 'script score' part, that would avoid this issue.\r\n\r\nI just opened a refactor #60179 that would fix this issue properly.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/664578442","html_url":"https://github.com/elastic/elasticsearch/issues/31000#issuecomment-664578442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31000","id":664578442,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NDU3ODQ0Mg==","user":{"login":"fhaase2","id":44052928,"node_id":"MDQ6VXNlcjQ0MDUyOTI4","avatar_url":"https://avatars2.githubusercontent.com/u/44052928?v=4","gravatar_id":"","url":"https://api.github.com/users/fhaase2","html_url":"https://github.com/fhaase2","followers_url":"https://api.github.com/users/fhaase2/followers","following_url":"https://api.github.com/users/fhaase2/following{/other_user}","gists_url":"https://api.github.com/users/fhaase2/gists{/gist_id}","starred_url":"https://api.github.com/users/fhaase2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fhaase2/subscriptions","organizations_url":"https://api.github.com/users/fhaase2/orgs","repos_url":"https://api.github.com/users/fhaase2/repos","events_url":"https://api.github.com/users/fhaase2/events{/privacy}","received_events_url":"https://api.github.com/users/fhaase2/received_events","type":"User","site_admin":false},"created_at":"2020-07-27T18:58:09Z","updated_at":"2020-07-27T18:58:09Z","author_association":"NONE","body":"@jtibshirani great, thanks for the answer.\r\n \r\nAs a workaround i thought about making a subsequent request after the explain request, just to retrieve the source of the documents using the Ids query. But this would be a hack, so ill better wait for the refactor #60179 ","performed_via_github_app":null}]