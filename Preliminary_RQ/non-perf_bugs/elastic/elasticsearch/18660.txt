{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18660","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18660/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18660/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18660/events","html_url":"https://github.com/elastic/elasticsearch/issues/18660","id":157696367,"node_id":"MDU6SXNzdWUxNTc2OTYzNjc=","number":18660,"title":"Increasing Number of Replicas - RecoveryFailedException and RemoteTransportException and NotSerializableExceptionWrapper","user":{"login":"cragun","id":2049267,"node_id":"MDQ6VXNlcjIwNDkyNjc=","avatar_url":"https://avatars1.githubusercontent.com/u/2049267?v=4","gravatar_id":"","url":"https://api.github.com/users/cragun","html_url":"https://github.com/cragun","followers_url":"https://api.github.com/users/cragun/followers","following_url":"https://api.github.com/users/cragun/following{/other_user}","gists_url":"https://api.github.com/users/cragun/gists{/gist_id}","starred_url":"https://api.github.com/users/cragun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cragun/subscriptions","organizations_url":"https://api.github.com/users/cragun/orgs","repos_url":"https://api.github.com/users/cragun/repos","events_url":"https://api.github.com/users/cragun/events{/privacy}","received_events_url":"https://api.github.com/users/cragun/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2016-05-31T15:11:01Z","updated_at":"2017-10-25T09:56:32Z","closed_at":"2016-05-31T18:24:09Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:\n  \"version\" : {\n    \"number\" : \"2.3.2\",\n    \"build_hash\" : \"b9e4a6acad4008027e4038f6abed7f7dba346f94\",\n    \"build_timestamp\" : \"2016-04-21T16:03:47Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"5.5.0\"\n  },\n\n**JVM version**:\njava version \"1.8.0_91\"\nJava(TM) SE Runtime Environment (build 1.8.0_91-b14)\nJava HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode)\n\n**OS version**:\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\n\n**Description of the problem including expected versus actual behavior**:\n\nI have a 5 node cluster. 50 indices.   110 shards.\nI had previously set the number of replicas to 0 to bulk load about 5 TB of data.  Now that all the indexing is complete and all nodes are green, all shards are STARTED, I would like to, obviously, increase the number of replicas to at least 1.   \n\nI issued the PUT to increase number_of_replicas for just one index, but the new shard gets stuck in INITIALIZING.  Upon examining the logs, I find a serious of exceptions, ranging from RecoveryFailedException, RemoteTransportException and NotSerializableExceptionWrapper. \n\nLogs are included below.   \n\n**Steps to reproduce**:\nincrease the number of replicas for the index ( in my case from 0 to 1 )\n{\n    \"index\" : {\n        \"number_of_replicas\" : 1\n    }\n} \n\n**Provide logs (if relevant)**:\n\n33604   RecoveryFailedException[[d-0516-ak][0]: Recovery failed from {AVES2}{GJq4BB0NQqepIogVu94eCQ}{172.31.32.129}{172.31.32.129:9300}{master=true} into {AVES1}{an91GFrhRXKhICZMgPKRJg}{172.31.35.8}{172.31.35.8:9300}{master=true}]; nested: RemoteTransportException[[AVES2][172.31.32.129:9300][internal:index/shard/recovery/start_recovery]]; nested: RecoveryEngineException[Phase[1] phase1 failed]; nested: RecoverFilesRecoveryException[Failed to transfer [100] files with total size of [8gb]]; nested: RemoteTransportException[[AVES1][172.31.35.8:9300][internal:index/shard/recovery/file_chunk]]; nested: NotSerializableExceptionWrapper[i_o_exception: Input/output error];\n 33605      at org.elasticsearch.indices.recovery.RecoveryTarget.doRecovery(RecoveryTarget.java:258)\n 33606      at org.elasticsearch.indices.recovery.RecoveryTarget.access$1100(RecoveryTarget.java:69)\n 33607      at org.elasticsearch.indices.recovery.RecoveryTarget$RecoveryRunner.doRun(RecoveryTarget.java:508)\n 33608      at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n 33609      at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n 33610      at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n 33611      at java.lang.Thread.run(Thread.java:745)\n 33612  Caused by: RemoteTransportException[[AVES2][172.31.32.129:9300][internal:index/shard/recovery/start_recovery]]; nested: RecoveryEngineException[Phase[1] phase1 failed]; nested: RecoverFilesRecoveryException[Failed to transfer [100] files with total size of [8gb]]; nested: RemoteTransportException[[AVES1][172.31.35.8:9300][internal:index/shard/recovery/file_chunk]]; nested: NotSerializableExceptionWrapper[i_o_exception: Input/output error];\n 33613  Caused by: [d-0516-ak][[d-0516-ak][0]] RecoveryEngineException[Phase[1] phase1 failed]; nested: RecoverFilesRecoveryException[Failed to transfer [100] files with total size of [8gb]]; nested: RemoteTransportException[[AVES1][172.31.35.8:9300][internal:index/shard/recovery/file_chunk]]; nested: NotSerializableExceptionWrapper[i_o_exception: Input/output error];\n 33614      at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:135)\n 33615      at org.elasticsearch.indices.recovery.RecoverySource.recover(RecoverySource.java:126)\n 33616      at org.elasticsearch.indices.recovery.RecoverySource.access$200(RecoverySource.java:52)\n 33617      at org.elasticsearch.indices.recovery.RecoverySource$StartRecoveryTransportRequestHandler.messageReceived(RecoverySource.java:135)\n 33618      at org.elasticsearch.indices.recovery.RecoverySource$StartRecoveryTransportRequestHandler.messageReceived(RecoverySource.java:132)\n 33619      at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n 33620      at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n 33621      at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:300)\n 33622      at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n 33623      at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n 33624      at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n 33625      at java.lang.Thread.run(Thread.java:745)\n 33626  Caused by: [d-0516-ak][[d-0516-ak][0]] RecoverFilesRecoveryException[Failed to transfer [100] files with total size of [8gb]]; nested: RemoteTransportException[[AVES1][172.31.35.8:9300][internal:index/shard/recovery/file_chunk]]; nested: NotSerializableExceptionWrapper[i_o_exception: Input/output error];\n 33627      at org.elasticsearch.indices.recovery.RecoverySourceHandler.phase1(RecoverySourceHandler.java:453)\n 33628      at org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:133)\n 33629      ... 11 more\n 33630  Caused by: RemoteTransportException[[AVES1][172.31.35.8:9300][internal:index/shard/recovery/file_chunk]]; nested: NotSerializableExceptionWrapper[i_o_exception: Input/output error];\n 33631      Suppressed: RemoteTransportException[[AVES1][172.31.35.8:9300][internal:index/shard/recovery/file_chunk]]; nested: NotSerializableExceptionWrapper[i_o_exception: Input/output error];\n 33632      Caused by: NotSerializableExceptionWrapper[i_o_exception: Input/output error]\n 33633          at sun.nio.ch.FileDispatcherImpl.force0(Native Method)\n 33634          at sun.nio.ch.FileDispatcherImpl.force(FileDispatcherImpl.java:76)\n 33635          at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:388)\n 33636          at org.apache.lucene.util.IOUtils.fsync(IOUtils.java:392)\n 33637          at org.apache.lucene.store.FSDirectory.fsync(FSDirectory.java:288)\n 33638          at org.apache.lucene.store.FSDirectory.sync(FSDirectory.java:232)\n 33639          at org.apache.lucene.store.FileSwitchDirectory.sync(FileSwitchDirectory.java:170)\n 33640          at org.apache.lucene.store.FilterDirectory.sync(FilterDirectory.java:78)\n 33641          at org.apache.lucene.store.FilterDirectory.sync(FilterDirectory.java:78)\n 33642          at org.elasticsearch.indices.recovery.RecoveryTarget$FileChunkTransportRequestHandler.messageReceived(RecoveryTarget.java:468)\n 33643          at org.elasticsearch.indices.recovery.RecoveryTarget$FileChunkTransportRequestHandler.messageReceived(RecoveryTarget.java:419)\n 33644          at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n 33645          at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n 33646          at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:300)\n 33647          at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n 33648          at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n 33649          at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n 33650          at java.lang.Thread.run(Thread.java:745)\n 33651      Suppressed: RemoteTransportException[[AVES1][172.31.35.8:9300][internal:index/shard/recovery/file_chunk]]; nested: NotSerializableExceptionWrapper[i_o_exception: Input/output error];\n 33652      Caused by: NotSerializableExceptionWrapper[i_o_exception: Input/output error]\n 33653          at sun.nio.ch.FileDispatcherImpl.force0(Native Method)\n 33654          at sun.nio.ch.FileDispatcherImpl.force(FileDispatcherImpl.java:76)\n 33655          at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:388)\n 33656          at org.apache.lucene.util.IOUtils.fsync(IOUtils.java:392)\n 33657          at org.apache.lucene.store.FSDirectory.fsync(FSDirectory.java:288)\n 33658          at org.apache.lucene.store.FSDirectory.sync(FSDirectory.java:232)\n 33659          at org.apache.lucene.store.FileSwitchDirectory.sync(FileSwitchDirectory.java:170)\n 33660          at org.apache.lucene.store.FilterDirectory.sync(FilterDirectory.java:78)\n 33661          at org.apache.lucene.store.FilterDirectory.sync(FilterDirectory.java:78)\n 33662          at org.elasticsearch.indices.recovery.RecoveryTarget$FileChunkTransportRequestHandler.messageReceived(RecoveryTarget.java:468)\n 33663          at org.elasticsearch.indices.recovery.RecoveryTarget$FileChunkTransportRequestHandler.messageReceived(RecoveryTarget.java:419)\n 33664          at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n 33665          at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n 33666          at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:300)\n 33667          at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n 33668          at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n 33669          at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n 33670          at java.lang.Thread.run(Thread.java:745)\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}