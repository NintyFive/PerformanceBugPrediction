[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258439451","html_url":"https://github.com/elastic/elasticsearch/issues/21277#issuecomment-258439451","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21277","id":258439451,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODQzOTQ1MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-11-04T14:03:44Z","updated_at":"2016-11-04T14:03:44Z","author_association":"CONTRIBUTOR","body":"Should this be a safeguard or just a hard limit?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258506541","html_url":"https://github.com/elastic/elasticsearch/issues/21277#issuecomment-258506541","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21277","id":258506541,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODUwNjU0MQ==","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2016-11-04T18:08:18Z","updated_at":"2016-11-04T18:08:18Z","author_association":"MEMBER","body":"Maybe a hard limit ?  Will defer to @ywelsch , not sure looking how many steps ahead becomes a problem here ..\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/536764300","html_url":"https://github.com/elastic/elasticsearch/issues/21277#issuecomment-536764300","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21277","id":536764300,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNjc2NDMwMA==","user":{"login":"probakowski","id":3896475,"node_id":"MDQ6VXNlcjM4OTY0NzU=","avatar_url":"https://avatars1.githubusercontent.com/u/3896475?v=4","gravatar_id":"","url":"https://api.github.com/users/probakowski","html_url":"https://github.com/probakowski","followers_url":"https://api.github.com/users/probakowski/followers","following_url":"https://api.github.com/users/probakowski/following{/other_user}","gists_url":"https://api.github.com/users/probakowski/gists{/gist_id}","starred_url":"https://api.github.com/users/probakowski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/probakowski/subscriptions","organizations_url":"https://api.github.com/users/probakowski/orgs","repos_url":"https://api.github.com/users/probakowski/repos","events_url":"https://api.github.com/users/probakowski/events{/privacy}","received_events_url":"https://api.github.com/users/probakowski/received_events","type":"User","site_admin":false},"created_at":"2019-09-30T21:39:36Z","updated_at":"2019-09-30T21:39:36Z","author_association":"CONTRIBUTOR","body":"@ywelsch @ppf2 is this still relevant today and something we want to act on?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/536894770","html_url":"https://github.com/elastic/elasticsearch/issues/21277#issuecomment-536894770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21277","id":536894770,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNjg5NDc3MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-10-01T06:50:16Z","updated_at":"2019-10-01T06:50:16Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/544476068","html_url":"https://github.com/elastic/elasticsearch/issues/21277#issuecomment-544476068","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21277","id":544476068,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NDQ3NjA2OA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-10-21T11:41:03Z","updated_at":"2019-10-21T11:41:03Z","author_association":"CONTRIBUTOR","body":"We (the @elastic/es-distributed team) discussed this on 2019-10-02. We noted that the kind of problem described in the OP is perhaps better controlled by the `node_concurrent_recoveries` settings since they apply per-node and they apply to all recoveries including those that happen when a cluster is recovering from a restart or an outage.\r\n\r\nThe reason to limit the number of concurrent rebalances is that in a healthy cluster it should be rare to need to do this kind of rebalancing, and in a sense that a rebalancing relocation is less important than a recovery that builds a lost replica, so by limiting them we leave the cluster with enough capacity to recover replicas quickly if needed. The main risk of setting this too high is that a major rebalancing event would prevent allocation of missing replicas (e.g. if an index rolls over) possibly for many minutes.\r\n\r\nWe also mentioned the case of adding new empty nodes to a cluster, in which we rely on balancing to move some shards onto the new nodes. It's hard to distinguish this case from the usual steady-state of a cluster, and there are other related issues (e.g. the hotspotting described in #17213) but we expected that kind of scaling event to be relatively rare. Again `node_concurrent_recoveries` seems an important safety mechanism even if `cluster_concurrent_rebalance` is temporarily increased.\r\n\r\nIt was quite a broad discussion that touched on other ideas, such as pausing or cancelling any low-priority rebalancing recoveries to make way for higher-priority ones.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/669233403","html_url":"https://github.com/elastic/elasticsearch/issues/21277#issuecomment-669233403","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21277","id":669233403,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTIzMzQwMw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2020-08-05T14:41:17Z","updated_at":"2020-08-05T14:41:17Z","author_association":"CONTRIBUTOR","body":"We (the @elastic/es-distributed team) discussed this again today and decided to close this issue on the grounds that we have not encountered very many cases in which the proposed safeguard would help.\r\n\r\nWe did note, however, that we had seen a case in which an excess of rebalancing shards caused a cluster to rebalance continuously for weeks. Reducing the concurrent rebalance limit stabilised the cluster relatively quickly. We didn't investigate further, but we decided to open #60747 which may have helped us to diagnose the underlying issue.","performed_via_github_app":null}]