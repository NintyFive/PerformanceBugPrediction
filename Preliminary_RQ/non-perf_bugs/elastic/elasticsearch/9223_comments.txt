[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69437108","html_url":"https://github.com/elastic/elasticsearch/issues/9223#issuecomment-69437108","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9223","id":69437108,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDM3MTA4","user":{"login":"meash-nrel","id":7649432,"node_id":"MDQ6VXNlcjc2NDk0MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/7649432?v=4","gravatar_id":"","url":"https://api.github.com/users/meash-nrel","html_url":"https://github.com/meash-nrel","followers_url":"https://api.github.com/users/meash-nrel/followers","following_url":"https://api.github.com/users/meash-nrel/following{/other_user}","gists_url":"https://api.github.com/users/meash-nrel/gists{/gist_id}","starred_url":"https://api.github.com/users/meash-nrel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meash-nrel/subscriptions","organizations_url":"https://api.github.com/users/meash-nrel/orgs","repos_url":"https://api.github.com/users/meash-nrel/repos","events_url":"https://api.github.com/users/meash-nrel/events{/privacy}","received_events_url":"https://api.github.com/users/meash-nrel/received_events","type":"User","site_admin":false},"created_at":"2015-01-10T03:29:06Z","updated_at":"2015-01-10T03:29:06Z","author_association":"NONE","body":"I tried a simpler template and it worked ... so went back to my original template here and starting taking out the mappings piece by piece to see root cause. \n\nEliminating this from the template makes it work as intended...\n\n```\n\"_timestamp\" : {\n                    \"enabled\" : true,\n                    \"store\": true,\n                    \"index\": \"not_analyzed\",\n                    \"format\" : \"date_time\",\n                    \"default\": null, \n                    \"path\" : \"timestamp\"\n                },\n```\n\nSo for some reason using the _timestamp feature in particular is causing this disappearance of indexes...\n\nIn order to circumvent the issue, I took out the _timestamp mapping and replaced it with an explicit \"date\" property instead.   Here is my new template that does NOT cause this issue:\n\n```\n{\n    \"template\" : \"test-*\",\n    \"order\" : 0,\n    \"settings\" : {\n        \"number_of_shards\" : 4,\n        \"number_of_replicas\" : 0, \n        \"refresh_interval\": \"1s\"\n    },\n    \"mappings\" : {\n        \"test-type\": {\n                \"dynamic\": false,\n                \"_all\": {\n                    \"enabled\": false\n                },\n                \"_source\": {\n                    \"enabled\": false\n                },\n                \"properties\": {\n                    \"timestamp\": {\n                        \"type\": \"date\",\n                        \"format\": \"date_time\",\n                        \"store\": true,\n                        \"index\": \"not_analyzed\"\n                    },\n                    \"node\": {\n                        \"type\": \"string\",\n                        \"store\": true,\n                        \"index\": \"not_analyzed\"\n                    },\n                    \"power\": {\n                        \"type\": \"integer\",\n                        \"store\": true,\n                        \"index\": \"not_analyzed\"\n                    }\n                }\n            }\n    }\n}\n```\n\nIndexes created from this template no longer disappear upon cluster restart.  So -- can work around at least to continue to use ES for my desired schema.  (Doesn't bring back my disappeared indexes though...)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69437169","html_url":"https://github.com/elastic/elasticsearch/issues/9223#issuecomment-69437169","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9223","id":69437169,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDM3MTY5","user":{"login":"meash-nrel","id":7649432,"node_id":"MDQ6VXNlcjc2NDk0MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/7649432?v=4","gravatar_id":"","url":"https://api.github.com/users/meash-nrel","html_url":"https://github.com/meash-nrel","followers_url":"https://api.github.com/users/meash-nrel/followers","following_url":"https://api.github.com/users/meash-nrel/following{/other_user}","gists_url":"https://api.github.com/users/meash-nrel/gists{/gist_id}","starred_url":"https://api.github.com/users/meash-nrel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meash-nrel/subscriptions","organizations_url":"https://api.github.com/users/meash-nrel/orgs","repos_url":"https://api.github.com/users/meash-nrel/repos","events_url":"https://api.github.com/users/meash-nrel/events{/privacy}","received_events_url":"https://api.github.com/users/meash-nrel/received_events","type":"User","site_admin":false},"created_at":"2015-01-10T03:29:56Z","updated_at":"2015-01-10T03:30:03Z","author_association":"NONE","body":"Made the issue title clearer given the new info that _timestamp is the culprit.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69438067","html_url":"https://github.com/elastic/elasticsearch/issues/9223#issuecomment-69438067","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9223","id":69438067,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDM4MDY3","user":{"login":"meash-nrel","id":7649432,"node_id":"MDQ6VXNlcjc2NDk0MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/7649432?v=4","gravatar_id":"","url":"https://api.github.com/users/meash-nrel","html_url":"https://github.com/meash-nrel","followers_url":"https://api.github.com/users/meash-nrel/followers","following_url":"https://api.github.com/users/meash-nrel/following{/other_user}","gists_url":"https://api.github.com/users/meash-nrel/gists{/gist_id}","starred_url":"https://api.github.com/users/meash-nrel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meash-nrel/subscriptions","organizations_url":"https://api.github.com/users/meash-nrel/orgs","repos_url":"https://api.github.com/users/meash-nrel/repos","events_url":"https://api.github.com/users/meash-nrel/events{/privacy}","received_events_url":"https://api.github.com/users/meash-nrel/received_events","type":"User","site_admin":false},"created_at":"2015-01-10T03:42:16Z","updated_at":"2015-01-10T03:42:16Z","author_association":"NONE","body":"Ok more testing of this issue - seems this mapping being in a template was not part of the issue at all, it's solely due to _timestamp in the mapping.   \n\nI created a new index w/o a template but using _timestamp, put in a document, and it too disappeared on cluster restart.\n- Create new index and type.\n\n```\nPUT http://localhost:9200/new_index\n {\n    \"settings\" : {\n        \"index\" : {\n            \"number_of_shards\" : 1,\n            \"number_of_replicas\" : 0, \n            \"refresh_interval\": \"1s\"\n        }\n    },\n    \"mappings\": {\n        \"power\": {\n            \"_timestamp\" : {\n                \"enabled\" : true,\n                \"store\": true,\n                \"index\": \"not_analyzed\",\n                \"format\" : \"date_time\",\n                \"default\": null, \n                \"path\" : \"timestamp\"\n            },\n            \"properties\": {\n                \"node\": {\n                    \"type\": \"string\",\n                    \"store\": true,\n                    \"index\": \"not_analyzed\"\n                },\n                \"power\": {\n                    \"type\": \"integer\",\n                    \"store\": true,\n                    \"index\": \"not_analyzed\"\n                }\n            }\n        }\n    }\n}\n```\n- Add a document.\n\n```\nPUT http://localhost:9200/new_index/power/1\n {\n    \"node\": \"n1111\",\n    \"power\": 200,\n    \"timestamp\": 1420737933000\n}\n```\n- Restart cluster ... and **index is missing**...\n- Redo the above, using explicit timestamp property instead of _timestamp.\n\n```\nPUT http://localhost:9200/new_index\n{\n    \"settings\" : {\n        \"index\" : {\n            \"number_of_shards\" : 1,\n            \"number_of_replicas\" : 0, \n            \"refresh_interval\": \"1s\"\n        }\n    },\n    \"mappings\": {\n        \"power\": {\n            \"properties\": {\n                \"timestamp\": {\n                    \"type\": \"date\",\n                    \"format\": \"date_time\",\n                    \"store\": true,\n                    \"index\": \"not_analyzed\"\n                },\n                \"node\": {\n                    \"type\": \"string\",\n                    \"store\": true,\n                    \"index\": \"not_analyzed\"\n                },\n                \"power\": {\n                    \"type\": \"integer\",\n                    \"store\": true,\n                    \"index\": \"not_analyzed\"\n                }\n            }\n        }\n    }\n}\n```\n- Put in data as before, restart cluster ... and index is there.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69451427","html_url":"https://github.com/elastic/elasticsearch/issues/9223#issuecomment-69451427","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9223","id":69451427,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDUxNDI3","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-01-10T10:37:40Z","updated_at":"2015-01-10T10:37:40Z","author_association":"MEMBER","body":"Thank you for reporting this with all those details. I can reproduce it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69451526","html_url":"https://github.com/elastic/elasticsearch/issues/9223#issuecomment-69451526","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9223","id":69451526,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDUxNTI2","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-01-10T10:41:09Z","updated_at":"2015-01-10T10:41:09Z","author_association":"MEMBER","body":"There is a NPE which most likely is causing this:\n\n```\njava.lang.NullPointerException\n    at org.elasticsearch.cluster.metadata.MappingMetaData.initMappers(MappingMetaData.java:358)\n    at org.elasticsearch.cluster.metadata.MappingMetaData.<init>(MappingMetaData.java:292)\n    at org.elasticsearch.cluster.metadata.IndexMetaData$Builder.fromXContent(IndexMetaData.java:661)\n    at org.elasticsearch.gateway.local.state.meta.LocalGatewayMetaState.loadIndex(LocalGatewayMetaState.java:505)\n    at org.elasticsearch.gateway.local.state.meta.LocalGatewayMetaState.clusterChanged(LocalGatewayMetaState.java:270)\n    at org.elasticsearch.gateway.local.LocalGateway.clusterChanged(LocalGateway.java:207)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:437)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:153)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69457547","html_url":"https://github.com/elastic/elasticsearch/issues/9223#issuecomment-69457547","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9223","id":69457547,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDU3NTQ3","user":{"login":"meash-nrel","id":7649432,"node_id":"MDQ6VXNlcjc2NDk0MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/7649432?v=4","gravatar_id":"","url":"https://api.github.com/users/meash-nrel","html_url":"https://github.com/meash-nrel","followers_url":"https://api.github.com/users/meash-nrel/followers","following_url":"https://api.github.com/users/meash-nrel/following{/other_user}","gists_url":"https://api.github.com/users/meash-nrel/gists{/gist_id}","starred_url":"https://api.github.com/users/meash-nrel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meash-nrel/subscriptions","organizations_url":"https://api.github.com/users/meash-nrel/orgs","repos_url":"https://api.github.com/users/meash-nrel/repos","events_url":"https://api.github.com/users/meash-nrel/events{/privacy}","received_events_url":"https://api.github.com/users/meash-nrel/received_events","type":"User","site_admin":false},"created_at":"2015-01-10T14:26:48Z","updated_at":"2015-01-10T14:26:48Z","author_association":"NONE","body":"@dadoonet - looks like you've located it.   Unsure when this appeared as I used _timestamp successfully before, I believe in 1.3.1. \n\nI assume from your stack trace of the NPE that this is an issue during cluster startup.  Would the fix now bring back the missing indices?   Meaning that now at cluster startup ES would properly load those indices and they'd be available again.\n\nThanks.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69459786","html_url":"https://github.com/elastic/elasticsearch/issues/9223#issuecomment-69459786","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9223","id":69459786,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDU5Nzg2","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-01-10T15:37:56Z","updated_at":"2015-01-10T15:37:56Z","author_association":"MEMBER","body":"@meash-nrel I just ran a test. Reproducing the bug with 1.4.2, then upgrading to 1.4.3-SNAPSHOT and the new version was able to read again old data. So `GET new_index` worked again. It means that you will be able to read again your data with the new version.\n","performed_via_github_app":null}]