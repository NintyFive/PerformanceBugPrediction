{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29324","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29324/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29324/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29324/events","html_url":"https://github.com/elastic/elasticsearch/issues/29324","id":310174783,"node_id":"MDU6SXNzdWUzMTAxNzQ3ODM=","number":29324,"title":"Query String Query with quote_field_suffix not using the quote_field_suffix field to search","user":{"login":"sherry-ger","id":11432120,"node_id":"MDQ6VXNlcjExNDMyMTIw","avatar_url":"https://avatars2.githubusercontent.com/u/11432120?v=4","gravatar_id":"","url":"https://api.github.com/users/sherry-ger","html_url":"https://github.com/sherry-ger","followers_url":"https://api.github.com/users/sherry-ger/followers","following_url":"https://api.github.com/users/sherry-ger/following{/other_user}","gists_url":"https://api.github.com/users/sherry-ger/gists{/gist_id}","starred_url":"https://api.github.com/users/sherry-ger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sherry-ger/subscriptions","organizations_url":"https://api.github.com/users/sherry-ger/orgs","repos_url":"https://api.github.com/users/sherry-ger/repos","events_url":"https://api.github.com/users/sherry-ger/events{/privacy}","received_events_url":"https://api.github.com/users/sherry-ger/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-03-30T21:38:27Z","updated_at":"2018-04-14T12:12:01Z","closed_at":"2018-04-04T15:29:10Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**\r\n6.2.3\r\n\r\n**Plugins installed**: []\r\nX-Pack\r\n\r\n**JVM version** (`java -version`):\r\n1.8.0_162\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nQuery string query with `quote_field_suffix` not using the correct field for search.  Simple query string query seems to work correctly.  Also, this works fine in version 5.6 and 6.0 alpha 2\r\n\r\n**Steps to reproduce**:\r\n\r\n```\r\nPUT testindex\r\n{\r\n  \"settings\": {\r\n    \"analysis\": {\r\n      \"analyzer\": {\r\n        \"english_exact\": {\r\n          \"tokenizer\": \"standard\",\r\n          \"filter\": [\r\n            \"lowercase\"\r\n          ]\r\n        }\r\n      }\r\n    },\r\n    \"number_of_shards\": 1,\r\n    \"number_of_replicas\": 0\r\n  },\r\n  \"mappings\": {\r\n    \"type\": {\r\n      \"properties\": {\r\n        \"body\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"english\",\r\n          \"fields\": {\r\n            \"exact\": {\r\n              \"type\": \"text\",\r\n              \"analyzer\": \"english_exact\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPUT testindex/type/1\r\n{\r\n  \"body\": \"Ski resort\"\r\n}\r\n\r\nPUT testindex/type/2\r\n{\r\n  \"body\": \"A pair of skis\"\r\n}\r\n\r\nPUT testindex/type/3\r\n{\r\n  \"body\": \"ski boots\"\r\n}\r\n\r\nPOST testindex/_refresh\r\n\r\nGET testindex/_search                               <-- works fine \r\n{\r\n  \"query\": {\r\n    \"simple_query_string\": {\r\n      \"fields\": [ \"body\" ],\r\n      \"quote_field_suffix\": \".exact\",\r\n      \"query\": \"\\\"ski boot\\\"\"\r\n    }\r\n  }\r\n}\r\n\r\nGET testindex/_search\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"fields\": [ \"body\" ],\r\n      \"quote_field_suffix\": \".exact\",\r\n      \"query\": \"\\\"ski boot\\\"\"\r\n    }\r\n  }\r\n}\r\n\r\nGET testindex/_validate/query?rewrite \r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"fields\": [ \"body\" ],\r\n      \"quote_field_suffix\": \".exact\",\r\n      \"query\": \"\\\"ski boot\\\"\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThe result of the rewrite seems to drop the `exact` multi-field.\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}