[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/141660368","html_url":"https://github.com/elastic/elasticsearch/issues/13571#issuecomment-141660368","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13571","id":141660368,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MTY2MDM2OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-19T12:29:55Z","updated_at":"2015-09-19T12:29:55Z","author_association":"CONTRIBUTOR","body":"Hi @marfago \n\nI've tried out what you say on 1.4.4 and I think you're incorrect about this having changed.  It depends entirely on how you index your geopoints.  For instance:\n\n```\nPUT t\n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"geolocation\": {\n          \"lat_lon\": true,\n          \"geohash_prefix\": true,\n          \"type\": \"geo_point\",\n          \"geohash\": true\n        }\n      }\n    }\n  }\n}\n\nPUT t/t/1\n{\n  \"geolocation\": \"37.768991279975,-122.41938924477\"\n}\n\nPUT t/t/2\n{\n  \"geolocation\": {\n    \"lat\": 37.768991279975,\n    \"lon\": -122.41938924477\n  }\n}\n\nGET _search\n{\n  \"fields\": [\n    \"geolocation.lat\",\n    \"geolocation.lon\",\n    \"geolocation\"\n  ]\n}\n```\n\nreturns the following:\n\n```\n  \"hits\": [\n     {\n        \"_index\": \"t\",\n        \"_type\": \"t\",\n        \"_id\": \"1\",\n        \"_score\": 1,\n        \"fields\": {\n           \"geolocation\": [\n              \"37.768991279975,-122.41938924477\"\n           ],\n           \"geolocation.lon\": [\n              \"37.768991279975,-122.41938924477\"\n           ],\n           \"geolocation.lat\": [\n              \"37.768991279975,-122.41938924477\"\n           ]\n        }\n     },\n     {\n        \"_index\": \"t\",\n        \"_type\": \"t\",\n        \"_id\": \"2\",\n        \"_score\": 1,\n        \"fields\": {\n           \"geolocation.lon\": [\n              -122.41938924477\n           ],\n           \"geolocation.lat\": [\n              37.768991279975\n           ]\n        }\n     }\n  ]\n```\n\nThe `fields` parameter is trying to extract the value from the `_source` field.  However, if you use the  fielddata_fields` parameter instead, then you get the actual lat/lon values consistently:\n\n```\nGET _search\n{\n  \"fielddata_fields\": [\n    \"geolocation.lat\",\n    \"geolocation.lon\",\n    \"geolocation\"\n  ]\n}\n```\n\nReturns:\n\n```\n  \"hits\": [\n     {\n        \"_index\": \"t\",\n        \"_type\": \"t\",\n        \"_id\": \"1\",\n        \"_score\": 1,\n        \"_source\": {\n           \"geolocation\": \"37.768991279975,-122.41938924477\"\n        },\n        \"fields\": {\n           \"geolocation\": [\n              {\n                 \"lat\": 37.768991279975,\n                 \"lon\": -122.41938924477\n              }\n           ],\n           \"geolocation.lon\": [\n              -122.41938924477\n           ],\n           \"geolocation.lat\": [\n              37.768991279975\n           ]\n        }\n     },\n     {\n        \"_index\": \"t\",\n        \"_type\": \"t\",\n        \"_id\": \"2\",\n        \"_score\": 1,\n        \"_source\": {\n           \"geolocation\": {\n              \"lat\": 37.768991279975,\n              \"lon\": -122.41938924477\n           }\n        },\n        \"fields\": {\n           \"geolocation\": [\n              {\n                 \"lat\": 37.768991279975,\n                 \"lon\": -122.41938924477\n              }\n           ],\n           \"geolocation.lon\": [\n              -122.41938924477\n           ],\n           \"geolocation.lat\": [\n              37.768991279975\n           ]\n        }\n     }\n  ]\n```\n","performed_via_github_app":null}]