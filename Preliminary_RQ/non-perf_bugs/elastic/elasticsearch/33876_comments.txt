[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423004508","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-423004508","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":423004508,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzAwNDUwOA==","user":{"login":"skearns64","id":1406684,"node_id":"MDQ6VXNlcjE0MDY2ODQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1406684?v=4","gravatar_id":"","url":"https://api.github.com/users/skearns64","html_url":"https://github.com/skearns64","followers_url":"https://api.github.com/users/skearns64/followers","following_url":"https://api.github.com/users/skearns64/following{/other_user}","gists_url":"https://api.github.com/users/skearns64/gists{/gist_id}","starred_url":"https://api.github.com/users/skearns64/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skearns64/subscriptions","organizations_url":"https://api.github.com/users/skearns64/orgs","repos_url":"https://api.github.com/users/skearns64/repos","events_url":"https://api.github.com/users/skearns64/events{/privacy}","received_events_url":"https://api.github.com/users/skearns64/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T00:55:43Z","updated_at":"2018-09-20T00:55:43Z","author_association":"CONTRIBUTOR","body":"@tsullivan - Instead of granting this privilege to the `kibana_system` user, would it be possible to always do the APM portion of the checks \"live\" as the logged in user, not as the `kibana` system user? I'm hesitant to grant read privileges to non-system indices to `kibana_system`, as it exposes a greater attack surface (and not an obvious one), were someone to compromise the `kibana` user.  \r\n\r\ncc @joshbressers @yaronp68 ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423007176","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-423007176","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":423007176,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzAwNzE3Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T01:13:10Z","updated_at":"2018-09-20T01:13:10Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423269607","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-423269607","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":423269607,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzI2OTYwNw==","user":{"login":"sqren","id":209966,"node_id":"MDQ6VXNlcjIwOTk2Ng==","avatar_url":"https://avatars3.githubusercontent.com/u/209966?v=4","gravatar_id":"","url":"https://api.github.com/users/sqren","html_url":"https://github.com/sqren","followers_url":"https://api.github.com/users/sqren/followers","following_url":"https://api.github.com/users/sqren/following{/other_user}","gists_url":"https://api.github.com/users/sqren/gists{/gist_id}","starred_url":"https://api.github.com/users/sqren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqren/subscriptions","organizations_url":"https://api.github.com/users/sqren/orgs","repos_url":"https://api.github.com/users/sqren/repos","events_url":"https://api.github.com/users/sqren/events{/privacy}","received_events_url":"https://api.github.com/users/sqren/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T17:35:25Z","updated_at":"2018-09-20T17:35:25Z","author_association":"NONE","body":"> Instead of granting this privilege to the kibana_system user, would it be possible to always do the APM portion of the checks \"live\" as the logged in user, not as the kibana system user? \r\n\r\nWe cannot guarantee the user will have access to `apm-*`, so the request could fail. I'm okay with that though, if we deem it an edge case.\r\nWhat do you think @tsullivan ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423284671","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-423284671","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":423284671,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzI4NDY3MQ==","user":{"login":"joshbressers","id":1692786,"node_id":"MDQ6VXNlcjE2OTI3ODY=","avatar_url":"https://avatars1.githubusercontent.com/u/1692786?v=4","gravatar_id":"","url":"https://api.github.com/users/joshbressers","html_url":"https://github.com/joshbressers","followers_url":"https://api.github.com/users/joshbressers/followers","following_url":"https://api.github.com/users/joshbressers/following{/other_user}","gists_url":"https://api.github.com/users/joshbressers/gists{/gist_id}","starred_url":"https://api.github.com/users/joshbressers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshbressers/subscriptions","organizations_url":"https://api.github.com/users/joshbressers/orgs","repos_url":"https://api.github.com/users/joshbressers/repos","events_url":"https://api.github.com/users/joshbressers/events{/privacy}","received_events_url":"https://api.github.com/users/joshbressers/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T18:23:09Z","updated_at":"2018-09-20T18:23:09Z","author_association":"NONE","body":"For the moment we should default to minimum privileges. I'm adding how to deal with things like this as a topic for the all hands. I think we have to decide where we want to draw our lines.\r\n\r\nThe Kibana user shouldn't have super user privileges, but it's equally silly for it to have too few.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423295102","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-423295102","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":423295102,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzI5NTEwMg==","user":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T18:57:04Z","updated_at":"2018-09-20T18:57:04Z","author_association":"MEMBER","body":"The API in question has won't really have a user-level context, so it would be awkward for it to require a user to have the privileges.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/424068263","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-424068263","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":424068263,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNDA2ODI2Mw==","user":{"login":"tsullivan","id":908371,"node_id":"MDQ6VXNlcjkwODM3MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/908371?v=4","gravatar_id":"","url":"https://api.github.com/users/tsullivan","html_url":"https://github.com/tsullivan","followers_url":"https://api.github.com/users/tsullivan/followers","following_url":"https://api.github.com/users/tsullivan/following{/other_user}","gists_url":"https://api.github.com/users/tsullivan/gists{/gist_id}","starred_url":"https://api.github.com/users/tsullivan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsullivan/subscriptions","organizations_url":"https://api.github.com/users/tsullivan/orgs","repos_url":"https://api.github.com/users/tsullivan/repos","events_url":"https://api.github.com/users/tsullivan/events{/privacy}","received_events_url":"https://api.github.com/users/tsullivan/received_events","type":"User","site_admin":false},"created_at":"2018-09-24T18:01:10Z","updated_at":"2018-09-24T18:01:10Z","author_association":"CONTRIBUTOR","body":"> Instead of granting this privilege to the kibana_system user, would it be possible to always do the APM portion of the checks \"live\" as the logged in user, not as the kibana system user?\r\n\r\n> We cannot guarantee the user will have access to apm-*, so the request could fail. I'm okay with that though, if we deem it an edge case.\r\nWhat do you think @tsullivan ?\r\n\r\nTelemetry for Kibana today does not to \"live\" checks for data the way that Elasticsearch information can be gathered live when Monitoring is disabled. This is a tech debt piece that remains because there isn't a great security model for user context on fetching live data from Kibana, partly due to Spaces making it likely the calling user will not have read access to all the objects in the .kibana index. But it means that there is no \"live\" pulling phase for Kibana telemetry. See: https://github.com/elastic/kibana/issues/21241, and there is also a story about this in the Kibana Platform team backlog in Clubhouse.\r\n\r\nAPM usage data only being available when Monitoring is enabled means that it gets initially stored there in the background task where the internal user queries for stats and uploads them to the Monitoring bulk endpoint to populate kibana_stats data.\r\n\r\nIt would be possible to piggy back other requests that authorized users have for APM stats and keep an updated document stored in the `.kibana` index. That way, the APM usage collector could get that information from `.kibana` instead of `apm-*`. That does mean a more complicated implementation model for @sqren to implement","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425483168","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-425483168","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":425483168,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTQ4MzE2OA==","user":{"login":"sqren","id":209966,"node_id":"MDQ6VXNlcjIwOTk2Ng==","avatar_url":"https://avatars3.githubusercontent.com/u/209966?v=4","gravatar_id":"","url":"https://api.github.com/users/sqren","html_url":"https://github.com/sqren","followers_url":"https://api.github.com/users/sqren/followers","following_url":"https://api.github.com/users/sqren/following{/other_user}","gists_url":"https://api.github.com/users/sqren/gists{/gist_id}","starred_url":"https://api.github.com/users/sqren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqren/subscriptions","organizations_url":"https://api.github.com/users/sqren/orgs","repos_url":"https://api.github.com/users/sqren/repos","events_url":"https://api.github.com/users/sqren/events{/privacy}","received_events_url":"https://api.github.com/users/sqren/received_events","type":"User","site_admin":false},"created_at":"2018-09-28T16:00:38Z","updated_at":"2018-09-29T11:45:36Z","author_association":"NONE","body":"> It would be possible to piggy back other requests that authorized users have for APM stats and keep an updated document stored in the .kibana index (...) That does mean a more complicated implementation model for @sqren to implement\r\n\r\nYes, this would be a more complicated implementation. Am I correct in understanding, that this would be a temporary solution, rather than the \"real solution\"? Depending on how far out a real solution is, we might go ahead and do this but I have a few concerns:\r\n\r\n - End user perf: it could make end user requests slower (since we'll add check check there, instead of in a background job)\r\n - tech debt: adding this to APM endpoints is not ideal, and something we will likely want to remove again in the future\r\n - Time: it could take a non-trivial amount of time to implement (sample logic, testing etc.)\r\n\r\n@jasonrhodes @makwarth any thoughts?\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425896122","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-425896122","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":425896122,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTg5NjEyMg==","user":{"login":"makwarth","id":841813,"node_id":"MDQ6VXNlcjg0MTgxMw==","avatar_url":"https://avatars3.githubusercontent.com/u/841813?v=4","gravatar_id":"","url":"https://api.github.com/users/makwarth","html_url":"https://github.com/makwarth","followers_url":"https://api.github.com/users/makwarth/followers","following_url":"https://api.github.com/users/makwarth/following{/other_user}","gists_url":"https://api.github.com/users/makwarth/gists{/gist_id}","starred_url":"https://api.github.com/users/makwarth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/makwarth/subscriptions","organizations_url":"https://api.github.com/users/makwarth/orgs","repos_url":"https://api.github.com/users/makwarth/repos","events_url":"https://api.github.com/users/makwarth/events{/privacy}","received_events_url":"https://api.github.com/users/makwarth/received_events","type":"User","site_admin":false},"created_at":"2018-10-01T12:52:54Z","updated_at":"2018-10-01T12:52:54Z","author_association":"NONE","body":"Discussed this with @sqren. We could temporarily do:\r\n\r\n- Piggy back on user requests, but only on the Services list page (APM homepage)\r\n- Store telemetry data in `.kibana` index\r\n- Have our usage collector query the `.kibana` index\r\n\r\n@tsullivan Where in the `.kibana` index should we store [our telemetry](https://github.com/elastic/telemetry/issues/55#issue-361015957) data exactly?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426685159","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-426685159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":426685159,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjY4NTE1OQ==","user":{"login":"tsullivan","id":908371,"node_id":"MDQ6VXNlcjkwODM3MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/908371?v=4","gravatar_id":"","url":"https://api.github.com/users/tsullivan","html_url":"https://github.com/tsullivan","followers_url":"https://api.github.com/users/tsullivan/followers","following_url":"https://api.github.com/users/tsullivan/following{/other_user}","gists_url":"https://api.github.com/users/tsullivan/gists{/gist_id}","starred_url":"https://api.github.com/users/tsullivan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsullivan/subscriptions","organizations_url":"https://api.github.com/users/tsullivan/orgs","repos_url":"https://api.github.com/users/tsullivan/repos","events_url":"https://api.github.com/users/tsullivan/events{/privacy}","received_events_url":"https://api.github.com/users/tsullivan/received_events","type":"User","site_admin":false},"created_at":"2018-10-03T15:40:11Z","updated_at":"2018-10-03T15:40:23Z","author_association":"CONTRIBUTOR","body":"> @tsullivan Where in the .kibana index should we store our telemetry data exactly?\r\n\r\nI'll refer you to the KQL telemetry PR for this, which is doing something similar and has gone through a few rounds of feedback already: https://github.com/elastic/kibana/pull/23547","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431865663","html_url":"https://github.com/elastic/elasticsearch/issues/33876#issuecomment-431865663","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33876","id":431865663,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTg2NTY2Mw==","user":{"login":"makwarth","id":841813,"node_id":"MDQ6VXNlcjg0MTgxMw==","avatar_url":"https://avatars3.githubusercontent.com/u/841813?v=4","gravatar_id":"","url":"https://api.github.com/users/makwarth","html_url":"https://github.com/makwarth","followers_url":"https://api.github.com/users/makwarth/followers","following_url":"https://api.github.com/users/makwarth/following{/other_user}","gists_url":"https://api.github.com/users/makwarth/gists{/gist_id}","starred_url":"https://api.github.com/users/makwarth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/makwarth/subscriptions","organizations_url":"https://api.github.com/users/makwarth/orgs","repos_url":"https://api.github.com/users/makwarth/repos","events_url":"https://api.github.com/users/makwarth/events{/privacy}","received_events_url":"https://api.github.com/users/makwarth/received_events","type":"User","site_admin":false},"created_at":"2018-10-22T15:17:39Z","updated_at":"2018-10-22T15:17:39Z","author_association":"NONE","body":"Closing for https://github.com/elastic/kibana/issues/24142","performed_via_github_app":null}]