[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366445066","html_url":"https://github.com/elastic/elasticsearch/issues/28713#issuecomment-366445066","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28713","id":366445066,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjQ0NTA2Ng==","user":{"login":"bra-fsn","id":820331,"node_id":"MDQ6VXNlcjgyMDMzMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/820331?v=4","gravatar_id":"","url":"https://api.github.com/users/bra-fsn","html_url":"https://github.com/bra-fsn","followers_url":"https://api.github.com/users/bra-fsn/followers","following_url":"https://api.github.com/users/bra-fsn/following{/other_user}","gists_url":"https://api.github.com/users/bra-fsn/gists{/gist_id}","starred_url":"https://api.github.com/users/bra-fsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bra-fsn/subscriptions","organizations_url":"https://api.github.com/users/bra-fsn/orgs","repos_url":"https://api.github.com/users/bra-fsn/repos","events_url":"https://api.github.com/users/bra-fsn/events{/privacy}","received_events_url":"https://api.github.com/users/bra-fsn/received_events","type":"User","site_admin":false},"created_at":"2018-02-17T14:31:02Z","updated_at":"2018-02-17T14:31:02Z","author_association":"NONE","body":"The unexpected character varies wildly:\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 146 hex: 92\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 159 hex: 9f\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 242 hex: f2\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 137 hex: 89\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 186 hex: ba\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 251 hex: fb\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 249 hex: f9\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 189 hex: bd\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 153 hex: 99\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 254 hex: fe\r\nCaused by: java.io.IOException: Invalid string; unexpected character: 139 hex: 8b\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366446089","html_url":"https://github.com/elastic/elasticsearch/issues/28713#issuecomment-366446089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28713","id":366446089,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjQ0NjA4OQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-02-17T14:48:47Z","updated_at":"2018-02-17T14:48:47Z","author_association":"CONTRIBUTOR","body":"Are all nodes on 6.2.1? Is this issue only occurring between certain nodes? Is the response different if you fire off a `GET /_nodes/stats` request on the master-eligible, the data, or the client nodes? Are all nodes but one reporting a failure in that case, or only a subset of the nodes?\r\nBefore we get into tcp dump territory, can you maybe reproduce this in a simple 2 node cluster (same hardware/OS)? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366463788","html_url":"https://github.com/elastic/elasticsearch/issues/28713#issuecomment-366463788","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28713","id":366463788,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjQ2Mzc4OA==","user":{"login":"bra-fsn","id":820331,"node_id":"MDQ6VXNlcjgyMDMzMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/820331?v=4","gravatar_id":"","url":"https://api.github.com/users/bra-fsn","html_url":"https://github.com/bra-fsn","followers_url":"https://api.github.com/users/bra-fsn/followers","following_url":"https://api.github.com/users/bra-fsn/following{/other_user}","gists_url":"https://api.github.com/users/bra-fsn/gists{/gist_id}","starred_url":"https://api.github.com/users/bra-fsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bra-fsn/subscriptions","organizations_url":"https://api.github.com/users/bra-fsn/orgs","repos_url":"https://api.github.com/users/bra-fsn/repos","events_url":"https://api.github.com/users/bra-fsn/events{/privacy}","received_events_url":"https://api.github.com/users/bra-fsn/received_events","type":"User","site_admin":false},"created_at":"2018-02-17T19:04:27Z","updated_at":"2018-02-17T19:05:07Z","author_association":"NONE","body":"Yes, all nodes are 6.2.1:\r\n``# curl -s 'http://localhost:9200/_cat/nodes?h=node.role,version' | sort | uniq -c\r\n  40 di 6.2.1\r\n   9 i  6.2.1\r\n   3 mi 6.2.1``\r\nThey only differ in their roles and JDK versions.\r\n\r\nI can only see these log entries on the three master(eliglible) nodes. BTW, we query only those for statistics.\r\nThere are many nodes involved, until now 29 of them, each of them are data (and client, mixed) nodes:\r\n``egrep 'exception caught on transport layer' all_masters.log | egrep -o 'remoteAddress.*}' | sort | uniq -c\r\n   2 remoteAddress=10.6.145.193/10.6.145.193:9300}\r\n   1 remoteAddress=10.6.145.195/10.6.145.195:9300}\r\n   2 remoteAddress=10.6.145.197/10.6.145.197:9300}\r\n   1 remoteAddress=10.6.145.199/10.6.145.199:9300}\r\n   4 remoteAddress=10.6.145.200/10.6.145.200:9300}\r\n   1 remoteAddress=10.6.145.201/10.6.145.201:9300}\r\n   1 remoteAddress=10.6.145.202/10.6.145.202:9300}\r\n   1 remoteAddress=10.6.145.203/10.6.145.203:9300}\r\n   1 remoteAddress=10.6.145.204/10.6.145.204:9300}\r\n   1 remoteAddress=10.6.145.206/10.6.145.206:9300}\r\n   1 remoteAddress=10.6.145.210/10.6.145.210:9300}\r\n   1 remoteAddress=10.6.145.211/10.6.145.211:9300}\r\n   1 remoteAddress=10.6.145.223/10.6.145.223:9300}\r\n   2 remoteAddress=10.6.145.225/10.6.145.225:9300}\r\n   1 remoteAddress=10.6.145.226/10.6.145.226:9300}\r\n   3 remoteAddress=10.6.145.227/10.6.145.227:9300}\r\n   3 remoteAddress=10.6.145.228/10.6.145.228:9300}\r\n   1 remoteAddress=10.6.145.232/10.6.145.232:9300}\r\n   2 remoteAddress=10.6.145.233/10.6.145.233:9300}\r\n   1 remoteAddress=10.6.145.234/10.6.145.234:9300}\r\n   3 remoteAddress=10.6.145.235/10.6.145.235:9300}\r\n   3 remoteAddress=10.6.145.236/10.6.145.236:9300}\r\n   1 remoteAddress=10.6.145.237/10.6.145.237:9300}\r\n   1 remoteAddress=10.6.145.239/10.6.145.239:9300}\r\n   3 remoteAddress=10.6.145.240/10.6.145.240:9300}\r\n   2 remoteAddress=10.6.145.241/10.6.145.241:9300}\r\n   2 remoteAddress=10.6.145.242/10.6.145.242:9300}\r\n   2 remoteAddress=10.6.145.243/10.6.145.243:9300}\r\n   2 remoteAddress=10.6.145.244/10.6.145.244:9300}\r\n``\r\nIt happens more often with some of them as you can see, but I can't point one as guilty.\r\nIt also happens on master-eliglible, but non-master nodes, the above contains their logs too.\r\n\r\nToday the log dates are:\r\n``[2018-02-17T00:15:46,519][WARN\r\n[2018-02-17T00:21:08,014][WARN\r\n[2018-02-17T02:16:04,699][WARN\r\n[2018-02-17T02:22:18,086][WARN\r\n[2018-02-17T02:25:28,047][WARN\r\n[2018-02-17T02:31:26,304][WARN\r\n[2018-02-17T02:35:43,636][WARN\r\n[2018-02-17T02:50:40,803][WARN\r\n[2018-02-17T02:55:27,373][WARN\r\n[2018-02-17T03:30:54,778][WARN\r\n[2018-02-17T03:55:15,757][WARN\r\n[2018-02-17T05:40:33,378][WARN\r\n[2018-02-17T05:40:48,091][WARN\r\n[2018-02-17T06:10:37,117][WARN\r\n[2018-02-17T06:10:49,796][WARN\r\n[2018-02-17T06:56:14,371][WARN\r\n[2018-02-17T07:11:15,700][WARN\r\n[2018-02-17T07:26:03,577][WARN\r\n[2018-02-17T07:30:39,050][WARN\r\n[2018-02-17T07:36:26,556][WARN\r\n[2018-02-17T08:06:04,656][WARN\r\n[2018-02-17T08:45:43,094][WARN\r\n[2018-02-17T08:55:47,759][WARN\r\n[2018-02-17T09:00:32,387][WARN\r\n[2018-02-17T09:45:45,487][WARN\r\n[2018-02-17T10:15:53,099][WARN\r\n[2018-02-17T10:20:38,481][WARN\r\n[2018-02-17T10:30:29,252][WARN\r\n[2018-02-17T11:00:27,803][WARN\r\n[2018-02-17T11:10:28,640][WARN\r\n[2018-02-17T11:50:43,091][WARN\r\n[2018-02-17T12:00:48,460][WARN\r\n[2018-02-17T12:35:25,549][WARN\r\n[2018-02-17T12:35:32,719][WARN\r\n[2018-02-17T12:50:30,927][WARN\r\n[2018-02-17T13:00:51,557][WARN\r\n[2018-02-17T13:35:25,834][WARN\r\n[2018-02-17T14:15:54,408][WARN\r\n[2018-02-17T14:25:36,535][WARN\r\n[2018-02-17T14:25:46,726][WARN\r\n[2018-02-17T15:10:28,747][WARN\r\n[2018-02-17T15:15:29,193][WARN\r\n[2018-02-17T15:50:16,142][WARN\r\n[2018-02-17T16:00:48,446][WARN\r\n[2018-02-17T16:00:57,826][WARN\r\n[2018-02-17T16:10:23,455][WARN\r\n[2018-02-17T16:20:25,079][WARN\r\n[2018-02-17T16:35:34,404][WARN\r\n[2018-02-17T16:40:28,779][WARN\r\n[2018-02-17T17:05:34,549][WARN\r\n``\r\nMost of them are close to 0 and 5 minutes which correlates with out statistics collection cronjob.\r\nIt doesn't happen on every _nodes/stats query. I've tried to fire some queries by hand, but nothing happened. Will try running the stats collector more often along with a tcpdump.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366466159","html_url":"https://github.com/elastic/elasticsearch/issues/28713#issuecomment-366466159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28713","id":366466159,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjQ2NjE1OQ==","user":{"login":"bra-fsn","id":820331,"node_id":"MDQ6VXNlcjgyMDMzMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/820331?v=4","gravatar_id":"","url":"https://api.github.com/users/bra-fsn","html_url":"https://github.com/bra-fsn","followers_url":"https://api.github.com/users/bra-fsn/followers","following_url":"https://api.github.com/users/bra-fsn/following{/other_user}","gists_url":"https://api.github.com/users/bra-fsn/gists{/gist_id}","starred_url":"https://api.github.com/users/bra-fsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bra-fsn/subscriptions","organizations_url":"https://api.github.com/users/bra-fsn/orgs","repos_url":"https://api.github.com/users/bra-fsn/repos","events_url":"https://api.github.com/users/bra-fsn/events{/privacy}","received_events_url":"https://api.github.com/users/bra-fsn/received_events","type":"User","site_admin":false},"created_at":"2018-02-17T19:40:57Z","updated_at":"2018-02-17T19:40:57Z","author_association":"NONE","body":"I could capture an error, I sent the dump and log in email to you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366506801","html_url":"https://github.com/elastic/elasticsearch/issues/28713#issuecomment-366506801","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28713","id":366506801,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjUwNjgwMQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-02-18T10:37:56Z","updated_at":"2018-02-18T10:37:56Z","author_association":"CONTRIBUTOR","body":"Thanks for the packet capture. I've had a look and I think I know what's going on.\r\n\r\nThe `AdaptiveSelectionStats` object (introduced in 6.1) serializes the `clientOutgoingConnections` map that's concurrently updated in `SearchTransportService`. Serializing the map consists of first writing the size of the map and then serializing the entries. If the number of entries changes while the map is being serialized, the size and number of entries go out of sync. The deserialization routine expects those to be in sync though. I've opened #28718 as a fix.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366629607","html_url":"https://github.com/elastic/elasticsearch/issues/28713#issuecomment-366629607","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28713","id":366629607,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjYyOTYwNw==","user":{"login":"bra-fsn","id":820331,"node_id":"MDQ6VXNlcjgyMDMzMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/820331?v=4","gravatar_id":"","url":"https://api.github.com/users/bra-fsn","html_url":"https://github.com/bra-fsn","followers_url":"https://api.github.com/users/bra-fsn/followers","following_url":"https://api.github.com/users/bra-fsn/following{/other_user}","gists_url":"https://api.github.com/users/bra-fsn/gists{/gist_id}","starred_url":"https://api.github.com/users/bra-fsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bra-fsn/subscriptions","organizations_url":"https://api.github.com/users/bra-fsn/orgs","repos_url":"https://api.github.com/users/bra-fsn/repos","events_url":"https://api.github.com/users/bra-fsn/events{/privacy}","received_events_url":"https://api.github.com/users/bra-fsn/received_events","type":"User","site_admin":false},"created_at":"2018-02-19T09:16:03Z","updated_at":"2018-02-19T09:16:03Z","author_association":"NONE","body":"The cluster is fine since yesterday with your latest patch:\r\nhttps://github.com/elastic/elasticsearch/pull/28718/commits/ef03a0e84e3309fe30d9b9238e7886b22e1d116c\r\nThanks for the quick fix!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/366631568","html_url":"https://github.com/elastic/elasticsearch/issues/28713#issuecomment-366631568","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28713","id":366631568,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjYzMTU2OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-02-19T09:24:05Z","updated_at":"2018-02-19T09:24:05Z","author_association":"CONTRIBUTOR","body":"Thanks for the detailed report and the packet dump. For anyone else running into this bug:\r\nThis can manifest when using the node stats call (`GET /_nodes/stats`), which queries adaptive replica selection stats by default, even if the feature is not used. The only workaround is to explicitly specify (all) the desired metrics `os,jvm,thread_pool,...` on the `GET /_nodes/stats` request to implicitly exclude the collection of the adaptive replica selection stats.","performed_via_github_app":null}]