{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/58532","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58532/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58532/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58532/events","html_url":"https://github.com/elastic/elasticsearch/issues/58532","id":645429026,"node_id":"MDU6SXNzdWU2NDU0MjkwMjY=","number":58532,"title":"MlDistributedFailureIT.testFullClusterRestart failed","user":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-06-25T09:57:10Z","updated_at":"2020-07-03T09:48:27Z","closed_at":"2020-07-03T09:41:54Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\r\nPlease fill out the following information, and ensure you have attempted\r\nto reproduce locally\r\n-->\r\n\r\n**Build scan**:\r\n\r\nhttps://gradle-enterprise.elastic.co/s/jeoql6ppg2iku/console-log?task=:x-pack:plugin:ml:internalClusterTest\r\n\r\n**Repro line**:\r\n\r\n`./gradlew ':x-pack:plugin:ml:internalClusterTest' --tests \"org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT.testFullClusterRestart\" -Dtests.seed=DD96E9D2F4821BAF -Dtests.security.manager=true -Dtests.locale=fr-BE -Dtests.timezone=US/Mountain -Druntime.java=11`\r\n\r\n**Reproduces locally?**:\r\n\r\nNo.\r\n\r\n**Applicable branches**:\r\n\r\n`master`\r\n\r\n**Failure history**:\r\n<!--\r\nLink to build stats and possible indication of when this started failing and how often it fails\r\n<https://build-stats.elastic.co/app/kibana>\r\n-->\r\n**Failure excerpt**:\r\n\r\n<details>\r\n\r\n<summary>`java.lang.AssertionError: failed to reach a stable cluster of [3] nodes. Tried via [node_t0].`</summary>\r\n\r\norg.elasticsearch.xpack.ml.integration.MlDistributedFailureIT > testFullClusterRestart FAILED\r\n    java.lang.AssertionError: failed to reach a stable cluster of [3] nodes. Tried via [node_t0]. last cluster state:\r\n    cluster uuid: DIXb_u8PSQe4QvzUrb8E9g [committed: true]\r\n    version: 64\r\n    state uuid: PbzLzbRtTVuznkxxS6LdXA\r\n    from_diff: false\r\n    meta data version: 56\r\n       coordination_metadata:\r\n          term: 4\r\n          last_committed_config: VotingConfiguration{libhdxGrQDCted5Sub97WQ,grRXwwwHR8WYarJGUllUpA,GOWk8mE8RXyF1-L_okWoSw}\r\n          last_accepted_config: VotingConfiguration{libhdxGrQDCted5Sub97WQ,grRXwwwHR8WYarJGUllUpA,GOWk8mE8RXyF1-L_okWoSw}\r\n          voting tombstones: []\r\n       [.ml-config/MZW2ZlLOT56WBeI8jDxqQQ]: v[9], mv[1], sv[2], av[1]\r\n          0: p_term [2], isa_ids [JYNICHv3RA2sxmU54Mvkvg, B82JZA2iSNWq0CWK5oIlJw]\r\n       [.ml-anomalies-shared/rwyxayFaQeaEmX4Rd2huSQ]: v[12], mv[1], sv[2], av[2]\r\n          0: p_term [2], isa_ids [NAd8QNw5QNaZs82sR6s2lQ, 7SI08RWpSz6p0BomCjOCyQ]\r\n       [.ml-annotations-6/QFh701rrRFusRV3p5L89oQ]: v[12], mv[1], sv[2], av[2]\r\n          0: p_term [2], isa_ids [Y7AXS8N8RnGJ3cdI_PhqcA, RkqtUhAASkaLrEGWWiNZBA]\r\n       [data/Oo5baM63RoCSadULUGgDUw]: v[6], mv[1], sv[1], av[1]\r\n          0: p_term [2], isa_ids [mYVzh39-RKiSq8VPNqg8wg, GSSkfs9gQ-K-JYH0R24v_w]\r\n       [.ml-state-000001/UW6lrZRYSK2DXNHrGY9B6A]: v[13], mv[1], sv[2], av[1]\r\n          0: p_term [2], isa_ids [yT6j-nKiS--cSbuTF-uoiw, GCzg69rwTgmxnqmN33HZ8A]\r\n       [.ml-notifications-000001/JHJYeK8STb6HnWQBLr73MQ]: v[10], mv[1], sv[2], av[1]\r\n          0: p_term [2], isa_ids [O_mgdTFnTf2Iun6JdEOk8Q, hNuzXg5PQUqEdC_fIXMyLQ]\r\n    metadata customs:\r\n       index_lifecycle: {\r\n      \"policies\" : {\r\n        \"ml-size-based-ilm-policy\" : {\r\n          \"policy\" : {\r\n            \"phases\" : {\r\n              \"hot\" : {\r\n                \"min_age\" : \"0ms\",\r\n                \"actions\" : {\r\n                  \"rollover\" : {\r\n                    \"max_size\" : \"50gb\"\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          },\r\n          \"headers\" : { },\r\n          \"version\" : 1,\r\n          \"modified_date\" : 1593076621794,\r\n          \"modified_date_string\" : \"2020-06-25T09:17:01.794Z\"\r\n        },\r\n        \"slm-history-ilm-policy\" : {\r\n          \"policy\" : {\r\n            \"phases\" : {\r\n              \"hot\" : {\r\n                \"min_age\" : \"0ms\",\r\n                \"actions\" : {\r\n                  \"rollover\" : {\r\n                    \"max_size\" : \"50gb\",\r\n                    \"max_age\" : \"30d\"\r\n                  }\r\n                }\r\n              },\r\n              \"delete\" : {\r\n                \"min_age\" : \"90d\",\r\n                \"actions\" : {\r\n                  \"delete\" : {\r\n                    \"delete_searchable_snapshot\" : true\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          },\r\n          \"headers\" : { },\r\n          \"version\" : 1,\r\n          \"modified_date\" : 1593076620773,\r\n          \"modified_date_string\" : \"2020-06-25T09:17:00.773Z\"\r\n        }\r\n      },\r\n      \"operation_mode\" : \"RUNNING\"\r\n    }   ingest: org.elasticsearch.ingest.IngestMetadata@398db12a   index-graveyard: IndexGraveyard[[]]   persistent_tasks: {\"last_allocation_id\":6,\"tasks\":[{\"id\":\"job-full-cluster-restart-job\",\"task\":{\"xpack/ml/job\":{\"params\":{\"job_id\":\"full-cluster-restart-job\",\"timeout\":\"1800000ms\",\"job\":{\"job_id\":\"full-cluster-restart-job\",\"job_type\":\"anomaly_detector\",\"job_version\":\"8.0.0\",\"create_time\":1593076638347,\"analysis_config\":{\"bucket_span\":\"1h\",\"detectors\":[{\"detector_description\":\"count\",\"function\":\"count\",\"detector_index\":0}],\"influencers\":[]},\"analysis_limits\":{\"model_memory_limit\":\"1024mb\",\"categorization_examples_limit\":4},\"data_description\":{\"time_field\":\"time\",\"time_format\":\"yyyy-MM-dd HH:mm:ss\"},\"model_snapshot_retention_days\":10,\"daily_model_snapshot_retention_after_days\":1,\"results_index_name\":\"shared\",\"allow_lazy_open\":false}},\"state\":{\"state\":\"opened\",\"allocation_id\":5}}},\"allocation_id\":5,\"assignment\":{\"executor_node\":\"GOWk8mE8RXyF1-L_okWoSw\",\"explanation\":\"\"},\"allocation_id_on_last_status_update\":5},{\"id\":\"datafeed-data_feed_id\",\"task\":{\"xpack/ml/datafeed\":{\"params\":{\"datafeed_id\":\"data_feed_id\",\"start\":\"0\",\"timeout\":\"20000ms\",\"job_id\":\"full-cluster-restart-job\",\"indices\":[\"data\"],\"indices_options\":{\"expand_wildcards\":[\"open\"],\"ignore_unavailable\":false,\"allow_no_indices\":true,\"ignore_throttled\":true}},\"state\":{\"state\":\"started\"}}},\"allocation_id\":6,\"assignment\":{\"executor_node\":\"GOWk8mE8RXyF1-L_okWoSw\",\"explanation\":\"\"},\"allocation_id_on_last_status_update\":6}]}\r\n    nodes: \r\n       {node_t1}{GOWk8mE8RXyF1-L_okWoSw}{FiJjhUD0SJ2bV6I07B82hQ}{127.0.0.1}{127.0.0.1:36407}{dilmr}{ml.machine_memory=101094690816, ml.max_open_jobs=20, xpack.installed=true}\r\n       {node_t0}{grRXwwwHR8WYarJGUllUpA}{oOGpoxPQQYa_HCc1HL1TDQ}{127.0.0.1}{127.0.0.1:41819}{dilmr}{ml.machine_memory=101094690816, ml.max_open_jobs=20, xpack.installed=true}\r\n       {node_t2}{libhdxGrQDCted5Sub97WQ}{OYVU1TxHS_muQKUQVNPnoA}{127.0.0.1}{127.0.0.1:41017}{dilmr}{ml.machine_memory=101094690816, ml.max_open_jobs=20, xpack.installed=true}, master\r\n    routing_table (version 8):\r\n    -- index [[.ml-config/MZW2ZlLOT56WBeI8jDxqQQ]]\r\n    ----shard_id [.ml-config][0]\r\n    --------[.ml-config][0], node[libhdxGrQDCted5Sub97WQ], [P], s[STARTED], a[id=B82JZA2iSNWq0CWK5oIlJw]\r\n    --------[.ml-config][0], node[grRXwwwHR8WYarJGUllUpA], [R], s[STARTED], a[id=JYNICHv3RA2sxmU54Mvkvg]\r\n\r\n    -- index [[.ml-annotations-6/QFh701rrRFusRV3p5L89oQ]]\r\n    ----shard_id [.ml-annotations-6][0]\r\n    --------[.ml-annotations-6][0], node[GOWk8mE8RXyF1-L_okWoSw], [P], s[STARTED], a[id=RkqtUhAASkaLrEGWWiNZBA]\r\n    --------[.ml-annotations-6][0], node[grRXwwwHR8WYarJGUllUpA], [R], s[STARTED], a[id=Y7AXS8N8RnGJ3cdI_PhqcA]\r\n\r\n    -- index [[.ml-anomalies-shared/rwyxayFaQeaEmX4Rd2huSQ]]\r\n    ----shard_id [.ml-anomalies-shared][0]\r\n    --------[.ml-anomalies-shared][0], node[GOWk8mE8RXyF1-L_okWoSw], [R], s[STARTED], a[id=NAd8QNw5QNaZs82sR6s2lQ]\r\n    --------[.ml-anomalies-shared][0], node[grRXwwwHR8WYarJGUllUpA], [P], s[STARTED], a[id=7SI08RWpSz6p0BomCjOCyQ]\r\n\r\n    -- index [[data/Oo5baM63RoCSadULUGgDUw]]\r\n    ----shard_id [data][0]\r\n    --------[data][0], node[GOWk8mE8RXyF1-L_okWoSw], [P], s[STARTED], a[id=GSSkfs9gQ-K-JYH0R24v_w]\r\n    --------[data][0], node[libhdxGrQDCted5Sub97WQ], [R], recovery_source[peer recovery], s[INITIALIZING], a[id=SxzR0FYRQf-YI2FykImH2A], unassigned_info[[reason=CLUSTER_RECOVERED], at[2020-06-25T09:18:18.429Z], delayed=false, allocation_status[no_attempt]]\r\n\r\n    -- index [[.ml-state-000001/UW6lrZRYSK2DXNHrGY9B6A]]\r\n    ----shard_id [.ml-state-000001][0]\r\n    --------[.ml-state-000001][0], node[GOWk8mE8RXyF1-L_okWoSw], [P], s[STARTED], a[id=yT6j-nKiS--cSbuTF-uoiw]\r\n    --------[.ml-state-000001][0], node[libhdxGrQDCted5Sub97WQ], [R], s[STARTED], a[id=GCzg69rwTgmxnqmN33HZ8A]\r\n\r\n    -- index [[.ml-notifications-000001/JHJYeK8STb6HnWQBLr73MQ]]\r\n    ----shard_id [.ml-notifications-000001][0]\r\n    --------[.ml-notifications-000001][0], node[libhdxGrQDCted5Sub97WQ], [P], s[STARTED], a[id=hNuzXg5PQUqEdC_fIXMyLQ]\r\n    --------[.ml-notifications-000001][0], node[grRXwwwHR8WYarJGUllUpA], [R], s[STARTED], a[id=O_mgdTFnTf2Iun6JdEOk8Q]\r\n\r\n    routing_nodes:\r\n    -----node_id[GOWk8mE8RXyF1-L_okWoSw][V]\r\n    --------[.ml-annotations-6][0], node[GOWk8mE8RXyF1-L_okWoSw], [P], s[STARTED], a[id=RkqtUhAASkaLrEGWWiNZBA]\r\n    --------[.ml-anomalies-shared][0], node[GOWk8mE8RXyF1-L_okWoSw], [R], s[STARTED], a[id=NAd8QNw5QNaZs82sR6s2lQ]\r\n    --------[data][0], node[GOWk8mE8RXyF1-L_okWoSw], [P], s[STARTED], a[id=GSSkfs9gQ-K-JYH0R24v_w]\r\n    --------[.ml-state-000001][0], node[GOWk8mE8RXyF1-L_okWoSw], [P], s[STARTED], a[id=yT6j-nKiS--cSbuTF-uoiw]\r\n    -----node_id[libhdxGrQDCted5Sub97WQ][V]\r\n    --------[.ml-config][0], node[libhdxGrQDCted5Sub97WQ], [P], s[STARTED], a[id=B82JZA2iSNWq0CWK5oIlJw]\r\n    --------[data][0], node[libhdxGrQDCted5Sub97WQ], [R], recovery_source[peer recovery], s[INITIALIZING], a[id=SxzR0FYRQf-YI2FykImH2A], unassigned_info[[reason=CLUSTER_RECOVERED], at[2020-06-25T09:18:18.429Z], delayed=false, allocation_status[no_attempt]]\r\n    --------[.ml-state-000001][0], node[libhdxGrQDCted5Sub97WQ], [R], s[STARTED], a[id=GCzg69rwTgmxnqmN33HZ8A]\r\n    --------[.ml-notifications-000001][0], node[libhdxGrQDCted5Sub97WQ], [P], s[STARTED], a[id=hNuzXg5PQUqEdC_fIXMyLQ]\r\n    -----node_id[grRXwwwHR8WYarJGUllUpA][V]\r\n    --------[.ml-config][0], node[grRXwwwHR8WYarJGUllUpA], [R], s[STARTED], a[id=JYNICHv3RA2sxmU54Mvkvg]\r\n    --------[.ml-annotations-6][0], node[grRXwwwHR8WYarJGUllUpA], [R], s[STARTED], a[id=Y7AXS8N8RnGJ3cdI_PhqcA]\r\n    --------[.ml-anomalies-shared][0], node[grRXwwwHR8WYarJGUllUpA], [P], s[STARTED], a[id=7SI08RWpSz6p0BomCjOCyQ]\r\n    --------[.ml-notifications-000001][0], node[grRXwwwHR8WYarJGUllUpA], [R], s[STARTED], a[id=O_mgdTFnTf2Iun6JdEOk8Q]\r\n    ---- unassigned\r\n        at __randomizedtesting.SeedInfo.seed([DD96E9D2F4821BAF:8CB9F8C301AE5300]:0)\r\n        at org.junit.Assert.fail(Assert.java:88)\r\n        at org.elasticsearch.test.ESIntegTestCase.ensureStableCluster(ESIntegTestCase.java:1162)\r\n        at org.elasticsearch.test.ESIntegTestCase.ensureStableCluster(ESIntegTestCase.java:1145)\r\n        at org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT.ensureStableClusterOnAllNodes(MlDistributedFailureIT.java:546)\r\n        at org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT.lambda$testFullClusterRestart$4(MlDistributedFailureIT.java:126)\r\n        at org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT.run(MlDistributedFailureIT.java:470)\r\n        at org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT.testFullClusterRestart(MlDistributedFailureIT.java:122)\r\n```\r\n\r\n</details>\r\n\r\n\r\n","closed_by":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"performed_via_github_app":null}