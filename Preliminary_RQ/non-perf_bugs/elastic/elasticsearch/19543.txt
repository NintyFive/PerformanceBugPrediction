{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19543","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19543/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19543/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19543/events","html_url":"https://github.com/elastic/elasticsearch/issues/19543","id":166900473,"node_id":"MDU6SXNzdWUxNjY5MDA0NzM=","number":19543,"title":"Inconsistent handling of constant_score.filter","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-07-21T19:38:13Z","updated_at":"2018-02-14T13:32:52Z","closed_at":"2017-06-05T15:23:51Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:2.3.4\r\n\r\n**JVM version**:1.7 latest\r\n\r\n**OS version**:Win10\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhile bool query \"filter\" accepts array of queries and use AND to combine them,\r\nconstant_score and filtered query \"filter\" element also takes array of queries without exception but result seem to be non deterministic - neither \"OR\" no \"AND\" not even sure what.\r\n\r\nExample - following query should return 0 hits but it returns number of hits one of the queries would produce and not even consistently first or second\r\n\r\n```\r\n{\r\n  \"query\": {\r\n    \"constant_score\": {\r\n      \"filter\": [\r\n        {\r\n          \"terms\": {\r\n            \"date.fy\": [\r\n              2016\r\n            ]\r\n          }\r\n        },\r\n        {\r\n          \"terms\": {\r\n            \"date.fy\": [\r\n              2015\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nIt would be very nice to have it support array of queries like bool.filter does or at least thro exception if it is considered invalid\r\n\r\nAlso in case of bool.filter (and bool.must), use of array is not clearly documented https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html\r\n\r\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}