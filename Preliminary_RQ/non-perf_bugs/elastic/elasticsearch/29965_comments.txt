[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384132954","html_url":"https://github.com/elastic/elasticsearch/issues/29965#issuecomment-384132954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29965","id":384132954,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMjk1NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-12-02T17:25:16Z","updated_at":"2018-04-25T01:34:00Z","author_association":"COLLABORATOR","body":"*Original comment by @costin:*\n\nThis issue will get addressed post-alpha or after we migrate to `composite` aggs (LINK REDACTED) since using nested terms aggregations make the ordering hard/impossible.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398386747","html_url":"https://github.com/elastic/elasticsearch/issues/29965#issuecomment-398386747","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29965","id":398386747,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODM4Njc0Nw==","user":{"login":"chenfh5","id":8369671,"node_id":"MDQ6VXNlcjgzNjk2NzE=","avatar_url":"https://avatars2.githubusercontent.com/u/8369671?v=4","gravatar_id":"","url":"https://api.github.com/users/chenfh5","html_url":"https://github.com/chenfh5","followers_url":"https://api.github.com/users/chenfh5/followers","following_url":"https://api.github.com/users/chenfh5/following{/other_user}","gists_url":"https://api.github.com/users/chenfh5/gists{/gist_id}","starred_url":"https://api.github.com/users/chenfh5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenfh5/subscriptions","organizations_url":"https://api.github.com/users/chenfh5/orgs","repos_url":"https://api.github.com/users/chenfh5/repos","events_url":"https://api.github.com/users/chenfh5/events{/privacy}","received_events_url":"https://api.github.com/users/chenfh5/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T12:48:57Z","updated_at":"2018-06-19T12:48:57Z","author_association":"NONE","body":"I also encountered such a problem.\r\n`group by` then add `order by` would be an important used scenario, but it seems not working. The test clauses list here, whether I am in the right way to spell them?\r\n**es**: v6.3.0\r\n**jdk**: 1.8.0_172\r\n**dataset**: geonames(rename to bm)\r\n\r\n```\r\n# working in order\r\ncurl -X POST \"$HOST/_xpack/sql?format=txt\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"query\": \"SELECT * FROM bm ORDER BY longitude DESC limit 3\",\r\n    \"fetch_size\": 3\r\n}'\r\n```\r\n\r\n```\r\n# working in group\r\ncurl -X POST \"$HOST/_xpack/sql?format=txt\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"query\": \"SELECT country_code, SUM(population) AS sum_pop FROM bm WHERE population >= 0 GROUP BY country_code\",\r\n    \"fetch_size\": 11\r\n}'\r\n```\r\n\r\n```\r\n# not working in group-order\r\ncurl -X POST \"$HOST/_xpack/sql?format=txt\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"query\": \"SELECT country_code, SUM(population) AS sum_pop FROM bm WHERE population >= 0 GROUP BY country_code ORDER BY sum_pop\",\r\n    \"fetch_size\": 11\r\n}'\r\n```\r\n\r\n![three es-sql response](https://user-images.githubusercontent.com/8369671/41598003-93cc522a-7401-11e8-93d0-4ff9cdff3675.png)\r\n\r\n[](url)\r\n<br>\r\nIn the case group-order, I think the [Bucket Sort Aggregation](https://www.elastic.co/guide/en/elasticsearch/reference/6.3/search-aggregations-pipeline-bucket-sort-aggregation.html) function could be used to implement it. When I translate the `only group clause` into DSL, then add the `Bucket Sort Aggregation`, the response is as expected.\r\n\r\n<br>\r\nI could attach the response snapshot of all the test clauses if necessary.\r\n\r\n<br>\r\nBR","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398406801","html_url":"https://github.com/elastic/elasticsearch/issues/29965#issuecomment-398406801","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29965","id":398406801,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODQwNjgwMQ==","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T13:53:17Z","updated_at":"2018-06-19T13:53:17Z","author_association":"MEMBER","body":"@chenfh5 thank you for trying out Elasticsearch SQL.\r\n\r\nAs the error message indicates, it is not possible to order on fields not used for grouping. Bucket Sort agg would not help since it sorts only the results in the current page not across the entire query.\r\nWhich is why it is not used.\r\n\r\nIf you'd like to sort by multiple fields, try grouping them as such.\r\n\r\nP.S. In the future, please open new issues instead of commenting on old ones (which you can link to).","performed_via_github_app":null}]