[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263288993","html_url":"https://github.com/elastic/elasticsearch/issues/21820#issuecomment-263288993","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21820","id":263288993,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzI4ODk5Mw==","user":{"login":"paullovessearch","id":1406946,"node_id":"MDQ6VXNlcjE0MDY5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/1406946?v=4","gravatar_id":"","url":"https://api.github.com/users/paullovessearch","html_url":"https://github.com/paullovessearch","followers_url":"https://api.github.com/users/paullovessearch/followers","following_url":"https://api.github.com/users/paullovessearch/following{/other_user}","gists_url":"https://api.github.com/users/paullovessearch/gists{/gist_id}","starred_url":"https://api.github.com/users/paullovessearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paullovessearch/subscriptions","organizations_url":"https://api.github.com/users/paullovessearch/orgs","repos_url":"https://api.github.com/users/paullovessearch/repos","events_url":"https://api.github.com/users/paullovessearch/events{/privacy}","received_events_url":"https://api.github.com/users/paullovessearch/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T14:46:18Z","updated_at":"2016-11-28T14:46:18Z","author_association":"NONE","body":"Thanks @markharwood for this comprehensive summary.\r\n\r\nIn the real world, there may be a data source for the parent document, but it may be controlled by another group in the company to which the search team has no access. Or it may be managed by a legacy system and the owners of that system are too nervous to allow another reader.\r\n\r\nAnd besides, just the extra effort of 1) ingesting a second stream from a second system, and 2) having to restate all of your child documents with a parent ID (rather than just specifying a field when the index is created, for example) is onerous.\r\n\r\nLots of examples also exist where the parent ID just comes from a counter or accumulator, and there is no actual parent record, per-se. In some of these cases, the parent ID document may be quickly abandoned (for example, due to a rollback).\r\n\r\nFinally, there are examples where the parent ID is merely the grouping attribute. Such as the host name for a web crawler. There is no \"document\" which represents the \"host name\" (perhaps the Who-is entry?) but people are crawling HTML pages, and not who-is entries. Besides, crawling the entire who-is is unrealistic.\r\n\r\nAnd finally, when determining duplicate or near-duplicate documents, we are simply stamping a \"grouping ID\" on a set of documents. There is no 'parent document' in this scenario, merely a set of documents with the same similarity hash or the same grouping ID.\r\n\r\nThanks,\r\nPaul","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263295686","html_url":"https://github.com/elastic/elasticsearch/issues/21820#issuecomment-263295686","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21820","id":263295686,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzI5NTY4Ng==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T15:11:11Z","updated_at":"2016-11-28T15:11:11Z","author_association":"CONTRIBUTOR","body":"Thanks for the examples, Paul.\r\nI suppose a third option is for elasticsearch to auto-create missing parent docs when orphan child docs are added (otherwise they will be invisible to parent-child searches). This could be an option for those systems with no feed for parent docs.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263305860","html_url":"https://github.com/elastic/elasticsearch/issues/21820#issuecomment-263305860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21820","id":263305860,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzMwNTg2MA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T15:46:22Z","updated_at":"2016-11-28T15:46:22Z","author_association":"CONTRIBUTOR","body":"Something like this in the mapping:\r\n\r\n\t{\r\n\t \"my_child_mapping\":{\r\n\t   \"_parent\":{\r\n\t\t \"type\" : \"my_parent\",\r\n\t\t \"referential_integrity\" : \"none/strict/auto_create\"\r\n\t   }\r\n\t}\r\n\t\r\n\"none\" is where we are today.\r\n\"strict\" checks for parent, errors when missing\r\n\"auto_create\" checks for parent, creates when missing","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263308325","html_url":"https://github.com/elastic/elasticsearch/issues/21820#issuecomment-263308325","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21820","id":263308325,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzMwODMyNQ==","user":{"login":"paullovessearch","id":1406946,"node_id":"MDQ6VXNlcjE0MDY5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/1406946?v=4","gravatar_id":"","url":"https://api.github.com/users/paullovessearch","html_url":"https://github.com/paullovessearch","followers_url":"https://api.github.com/users/paullovessearch/followers","following_url":"https://api.github.com/users/paullovessearch/following{/other_user}","gists_url":"https://api.github.com/users/paullovessearch/gists{/gist_id}","starred_url":"https://api.github.com/users/paullovessearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paullovessearch/subscriptions","organizations_url":"https://api.github.com/users/paullovessearch/orgs","repos_url":"https://api.github.com/users/paullovessearch/repos","events_url":"https://api.github.com/users/paullovessearch/events{/privacy}","received_events_url":"https://api.github.com/users/paullovessearch/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T15:54:16Z","updated_at":"2016-11-28T15:54:16Z","author_association":"NONE","body":"Auto creating the parents feels like a brittle architecture to me. Too many opportunities for the parent to be missing or extra parents (after children are deleted) and all that. Especially when there are failures and rollbacks and so-on.\r\n\r\nParent-child joins require an in-memory map of parentId to/from childId. My recommendation is to simply build that map based on a field in the document. And then, in the searching logic, change any reference to an actual parent record with a search operator which returns as if the parent record exists and it only had a single field (the parent ID).\r\n\r\nFinally, there will need to be a configuration on the index to route records to shards based on the field value.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263308639","html_url":"https://github.com/elastic/elasticsearch/issues/21820#issuecomment-263308639","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21820","id":263308639,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzMwODYzOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T15:55:12Z","updated_at":"2016-11-28T15:55:12Z","author_association":"CONTRIBUTOR","body":"> Auto creating the parents feels like a brittle architecture to me. \r\n++\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263329950","html_url":"https://github.com/elastic/elasticsearch/issues/21820#issuecomment-263329950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21820","id":263329950,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzMyOTk1MA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T17:07:30Z","updated_at":"2016-11-28T17:07:30Z","author_association":"CONTRIBUTOR","body":">Auto creating the parents feels like a brittle architecture to me. \r\n\r\nThe status quo is already \"brittle\". Orphaned children are not include in parent/child query results.\r\nPerhaps the phrase \"referential integrity\" is too strong here (expectations of cascading deletes etc) but as a convenience to clients we could perform some additional checks more cheaply than the clients could.\r\nGranted though, inserting physical docs purely to satisfy the needs of an existing query impl feels ugly.\r\n\r\n>My recommendation is to simply build that map\r\n\r\nI had a word with parent/child guru @martijnvg and changing the way parent/child collects results to support absent parent docs is \"non-trivial\".\r\n\r\nPerhaps this is a dead-end then. The good news is @jimczi has another proposal we can discuss in a different issue which I will link to when it emerges.\r\n\r\n\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263341140","html_url":"https://github.com/elastic/elasticsearch/issues/21820#issuecomment-263341140","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21820","id":263341140,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzM0MTE0MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T17:47:15Z","updated_at":"2016-11-28T17:47:15Z","author_association":"MEMBER","body":"@markharwood @paullovessearch I opened https://github.com/elastic/elasticsearch/issues/21833 \r\n\r\nI think it can be a good compromise between pagination of terms aggregations and simple field collapsing where pagination is needed. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263531346","html_url":"https://github.com/elastic/elasticsearch/issues/21820#issuecomment-263531346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21820","id":263531346,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzUzMTM0Ng==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T10:18:24Z","updated_at":"2016-11-29T10:18:24Z","author_association":"CONTRIBUTOR","body":"Closing in favour of https://github.com/elastic/elasticsearch/issues/21833","performed_via_github_app":null}]