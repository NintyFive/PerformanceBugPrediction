[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238373529","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238373529","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238373529,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM3MzUyOQ==","user":{"login":"adrianocrestani","id":7266694,"node_id":"MDQ6VXNlcjcyNjY2OTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/7266694?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianocrestani","html_url":"https://github.com/adrianocrestani","followers_url":"https://api.github.com/users/adrianocrestani/followers","following_url":"https://api.github.com/users/adrianocrestani/following{/other_user}","gists_url":"https://api.github.com/users/adrianocrestani/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianocrestani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianocrestani/subscriptions","organizations_url":"https://api.github.com/users/adrianocrestani/orgs","repos_url":"https://api.github.com/users/adrianocrestani/repos","events_url":"https://api.github.com/users/adrianocrestani/events{/privacy}","received_events_url":"https://api.github.com/users/adrianocrestani/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T20:53:13Z","updated_at":"2016-08-08T20:53:13Z","author_association":"NONE","body":"@abeyad , do you know if the memory leak has been fixed? Just limiting the retries does not mean it fixed the memory leak.\n\nDo you know if #18467 will be pushed to 2.x releases? It is a bug and it drastically affects the whole cluster when it happens. However, #18467 is flagged as Enhancement, so I am afraid it won't get the necessary priority :(\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238376302","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238376302","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238376302,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM3NjMwMg==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T21:02:28Z","updated_at":"2016-08-08T21:02:28Z","author_association":"CONTRIBUTOR","body":"@adrianocrestani From what I understood from your description, you weren't OOM'ing but rather just experiencing memory pressure buildup, which would be expected if you keep trying to allocate all these resources for a shard that isn't properly starting over and over and over again in quick succession.  Its not a memory leak as such but just memory pressure buildup. \n\nI don't think it will be back ported to 2.x as it is a pretty sizable change and while its definitely a big issue for cluster stability, the ultimate solution that will return your cluster to stability and allow you to create usable indices is to include the required synonyms dictionary.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238379847","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238379847","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238379847,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM3OTg0Nw==","user":{"login":"adrianocrestani","id":7266694,"node_id":"MDQ6VXNlcjcyNjY2OTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/7266694?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianocrestani","html_url":"https://github.com/adrianocrestani","followers_url":"https://api.github.com/users/adrianocrestani/followers","following_url":"https://api.github.com/users/adrianocrestani/following{/other_user}","gists_url":"https://api.github.com/users/adrianocrestani/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianocrestani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianocrestani/subscriptions","organizations_url":"https://api.github.com/users/adrianocrestani/orgs","repos_url":"https://api.github.com/users/adrianocrestani/repos","events_url":"https://api.github.com/users/adrianocrestani/events{/privacy}","received_events_url":"https://api.github.com/users/adrianocrestani/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T21:15:20Z","updated_at":"2016-08-08T21:15:20Z","author_association":"NONE","body":"@abeyad , I disagree, it is definitely a leak. Even after major GC, a node with 256MB of heap and no shards allocated is stuck at 99% of used heap. That is definitely a leak. To add to that, when the synonym dictionary is deployed, it files OOM when it tries to finally allocate the shard.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238385323","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238385323","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238385323,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM4NTMyMw==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T21:36:00Z","updated_at":"2016-08-08T21:36:00Z","author_association":"CONTRIBUTOR","body":"@adrianocrestani let me try to reproduce the situation with your outlined steps and get back to you\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238385536","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238385536","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238385536,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM4NTUzNg==","user":{"login":"adrianocrestani","id":7266694,"node_id":"MDQ6VXNlcjcyNjY2OTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/7266694?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianocrestani","html_url":"https://github.com/adrianocrestani","followers_url":"https://api.github.com/users/adrianocrestani/followers","following_url":"https://api.github.com/users/adrianocrestani/following{/other_user}","gists_url":"https://api.github.com/users/adrianocrestani/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianocrestani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianocrestani/subscriptions","organizations_url":"https://api.github.com/users/adrianocrestani/orgs","repos_url":"https://api.github.com/users/adrianocrestani/repos","events_url":"https://api.github.com/users/adrianocrestani/events{/privacy}","received_events_url":"https://api.github.com/users/adrianocrestani/received_events","type":"User","site_admin":false},"created_at":"2016-08-08T21:36:48Z","updated_at":"2016-08-08T21:36:48Z","author_association":"NONE","body":"@abeyad thanks!\n\nHere is something else to support my statement: \"Our analysis tells that your application is suffering from memory leak. It can cause OutOfMemoryError, JVM to freeze, poor response time and high CPU consumption.\"\n\nhttp://gceasy.io/my-gc-report.jsp?p=L2hvbWUvcmFtL3VwbG9hZC9pbnN0YW5jZTEvc2hhcmVkLzIwMTYtOC04L2djLmxvZy0yMS0zNS00Nw==\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238453365","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238453365","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238453365,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODQ1MzM2NQ==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T04:54:19Z","updated_at":"2016-08-09T04:54:19Z","author_association":"CONTRIBUTOR","body":"@adrianocrestani I was able to reproduce the heap usage spikes following your instructions. I took a cursory glance at the heap dump produced and it looks like the problem is in Guice.  I'll look in detail tomorrow and provide feedback.  Thanks for the easy-to-follow instructions to reproduce!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238562196","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238562196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238562196,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODU2MjE5Ng==","user":{"login":"adrianocrestani","id":7266694,"node_id":"MDQ6VXNlcjcyNjY2OTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/7266694?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianocrestani","html_url":"https://github.com/adrianocrestani","followers_url":"https://api.github.com/users/adrianocrestani/followers","following_url":"https://api.github.com/users/adrianocrestani/following{/other_user}","gists_url":"https://api.github.com/users/adrianocrestani/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianocrestani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianocrestani/subscriptions","organizations_url":"https://api.github.com/users/adrianocrestani/orgs","repos_url":"https://api.github.com/users/adrianocrestani/repos","events_url":"https://api.github.com/users/adrianocrestani/events{/privacy}","received_events_url":"https://api.github.com/users/adrianocrestani/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T14:01:32Z","updated_at":"2016-08-09T14:01:32Z","author_association":"NONE","body":"@abeyad I am happy you could reproduce it :)\n\nShould we re-open this bug then?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238662543","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238662543","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238662543,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODY2MjU0Mw==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T19:23:55Z","updated_at":"2016-08-09T19:23:55Z","author_association":"CONTRIBUTOR","body":"@adrianocrestani I looked at the heap dump and the problem is within Guice. Its actually a manifestation of this Guice issue: https://github.com/google/guice/issues/756\n\nGuice has subsequently fixed this issue with a significant patch.  In Elasticsearch, we are using our own custom implementation of Guice that we forked from the main Guice project but haven't kept it much in sync with Guice. The result is that back porting the fix for this issue to our custom Guice implementation will be non-trivial.  We are actually moving away from using Guice entirely and in 5.x, significant parts of our code base that used Guice before (including index creation, which caused this behavior to manifest) no longer use Guice.  Hence you won't see this same index creation problem with 5.x.\n\nIt is not likely that we will be spending time fixing Guice for this scenario, especially since its an edge case - failed index creation attempts due to missing file(s).  The memory leak issue is indeed real, but given that there are tools to monitor your cluster in case of nodes climbing up in heap usage, it is not difficult to detect that there is an issue and remove the node in question until the problem is remedied.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238681136","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238681136","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238681136,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODY4MTEzNg==","user":{"login":"adrianocrestani","id":7266694,"node_id":"MDQ6VXNlcjcyNjY2OTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/7266694?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianocrestani","html_url":"https://github.com/adrianocrestani","followers_url":"https://api.github.com/users/adrianocrestani/followers","following_url":"https://api.github.com/users/adrianocrestani/following{/other_user}","gists_url":"https://api.github.com/users/adrianocrestani/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianocrestani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianocrestani/subscriptions","organizations_url":"https://api.github.com/users/adrianocrestani/orgs","repos_url":"https://api.github.com/users/adrianocrestani/repos","events_url":"https://api.github.com/users/adrianocrestani/events{/privacy}","received_events_url":"https://api.github.com/users/adrianocrestani/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T20:30:36Z","updated_at":"2016-08-09T20:30:36Z","author_association":"NONE","body":"@abeyad thanks again for looking into it.\n\nI agree it is an edge case and that I think we know how to recover our cluster when that happens.\n\nMy other big concern is how a node that is very responsive due to GC pauses can make the whole cluster unresponsive. Shouldn't masters just kick that node out? I believe the cluster should be more resilient in those cases.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238681411","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238681411","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238681411,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODY4MTQxMQ==","user":{"login":"adrianocrestani","id":7266694,"node_id":"MDQ6VXNlcjcyNjY2OTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/7266694?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianocrestani","html_url":"https://github.com/adrianocrestani","followers_url":"https://api.github.com/users/adrianocrestani/followers","following_url":"https://api.github.com/users/adrianocrestani/following{/other_user}","gists_url":"https://api.github.com/users/adrianocrestani/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianocrestani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianocrestani/subscriptions","organizations_url":"https://api.github.com/users/adrianocrestani/orgs","repos_url":"https://api.github.com/users/adrianocrestani/repos","events_url":"https://api.github.com/users/adrianocrestani/events{/privacy}","received_events_url":"https://api.github.com/users/adrianocrestani/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T20:31:32Z","updated_at":"2016-08-09T20:31:32Z","author_association":"NONE","body":"I would appreciate if you could remove the link saying that this bug was fixed in #18467 and it is a duplicate of #18417.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238726104","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-238726104","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":238726104,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODcyNjEwNA==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T23:43:19Z","updated_at":"2016-08-09T23:43:19Z","author_association":"CONTRIBUTOR","body":"@adrianocrestani I removed the comment.  Thank you for filing this issue and the comprehensive instructions that enabled getting to the bottom of it much quicker!\n\nUnresponsive nodes would be removed from the cluster by master if they don't respond to pings within a certain amount of time.  The default is 30 seconds, but it can be configured via the `discovery.zen.fd.ping_timeout` setting: see https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery-zen.html#fault-detection\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252070674","html_url":"https://github.com/elastic/elasticsearch/issues/19879#issuecomment-252070674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19879","id":252070674,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjA3MDY3NA==","user":{"login":"adrianocrestani","id":7266694,"node_id":"MDQ6VXNlcjcyNjY2OTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/7266694?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianocrestani","html_url":"https://github.com/adrianocrestani","followers_url":"https://api.github.com/users/adrianocrestani/followers","following_url":"https://api.github.com/users/adrianocrestani/following{/other_user}","gists_url":"https://api.github.com/users/adrianocrestani/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianocrestani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianocrestani/subscriptions","organizations_url":"https://api.github.com/users/adrianocrestani/orgs","repos_url":"https://api.github.com/users/adrianocrestani/repos","events_url":"https://api.github.com/users/adrianocrestani/events{/privacy}","received_events_url":"https://api.github.com/users/adrianocrestani/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T19:54:49Z","updated_at":"2016-10-06T19:54:49Z","author_association":"NONE","body":"I have verified that it is fixed on ES 5.x (5.0 beta1)\n","performed_via_github_app":null}]