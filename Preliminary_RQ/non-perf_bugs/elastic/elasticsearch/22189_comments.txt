[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267594796","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267594796","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267594796,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzU5NDc5Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T13:33:00Z","updated_at":"2016-12-16T13:33:00Z","author_association":"CONTRIBUTOR","body":"Looks like you have networking problems. I don't know if you have any customs settings, or where you're running Elasticsearch etc.  More info would be helpful.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267603142","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267603142","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267603142,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzYwMzE0Mg==","user":{"login":"sinsonglew","id":12896760,"node_id":"MDQ6VXNlcjEyODk2NzYw","avatar_url":"https://avatars1.githubusercontent.com/u/12896760?v=4","gravatar_id":"","url":"https://api.github.com/users/sinsonglew","html_url":"https://github.com/sinsonglew","followers_url":"https://api.github.com/users/sinsonglew/followers","following_url":"https://api.github.com/users/sinsonglew/following{/other_user}","gists_url":"https://api.github.com/users/sinsonglew/gists{/gist_id}","starred_url":"https://api.github.com/users/sinsonglew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sinsonglew/subscriptions","organizations_url":"https://api.github.com/users/sinsonglew/orgs","repos_url":"https://api.github.com/users/sinsonglew/repos","events_url":"https://api.github.com/users/sinsonglew/events{/privacy}","received_events_url":"https://api.github.com/users/sinsonglew/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T14:17:36Z","updated_at":"2016-12-16T15:26:16Z","author_association":"NONE","body":"@clintongormley , total 8 nodes, three of them are master eligible. we run elastic on virtual machines. It's definitely that network is fine. we tried elastic 1.x, it works very well.  elasticsearch.yml posted as follows:\r\n\r\n```\r\ncluster.name: demo\r\nnode.name: node237\r\n\r\nnetwork.host: 10.xx.85.xx\r\ntransport.tcp.port: 9371\r\nhttp.port: 9200\r\n\r\ndiscovery.zen.ping.unicast.hosts: [\"10.xx.85.aa:9371\", \"10.xx.85.bb:9371\", \"10.xx.85.cc:9371\"]\r\ndiscovery.zen.minimum_master_nodes: 2\r\ndiscovery.zen.ping_timeout: 17s\r\n\r\ngateway.recover_after_nodes: 8\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267619276","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267619276","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267619276,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzYxOTI3Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T15:30:23Z","updated_at":"2016-12-16T15:30:23Z","author_association":"CONTRIBUTOR","body":"1.x used multicast, you may well find that it was using different network cards etc than the ones configured.  It still looks to me like you have a networking issue here, or possibly different config on one of the nodes?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267624930","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267624930","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267624930,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzYyNDkzMA==","user":{"login":"georgecao","id":1426758,"node_id":"MDQ6VXNlcjE0MjY3NTg=","avatar_url":"https://avatars0.githubusercontent.com/u/1426758?v=4","gravatar_id":"","url":"https://api.github.com/users/georgecao","html_url":"https://github.com/georgecao","followers_url":"https://api.github.com/users/georgecao/followers","following_url":"https://api.github.com/users/georgecao/following{/other_user}","gists_url":"https://api.github.com/users/georgecao/gists{/gist_id}","starred_url":"https://api.github.com/users/georgecao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/georgecao/subscriptions","organizations_url":"https://api.github.com/users/georgecao/orgs","repos_url":"https://api.github.com/users/georgecao/repos","events_url":"https://api.github.com/users/georgecao/events{/privacy}","received_events_url":"https://api.github.com/users/georgecao/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T15:53:49Z","updated_at":"2016-12-16T15:53:49Z","author_association":"NONE","body":"@clintongormley , I work with @sinsonglew on the same team.  Does ElasticSearch 5.1.1 require specific network cards? What's your concerns and how we check it out?  If we have 10 nodes to form one cluster, what's elasticsearch.yml should look like?  It's wired that we reduce the number of nodes from 10 to 3, then the cluster becomes stable, but increase the number of nodes from 3 to 4 or 5, it happens again. \r\n\r\nAny idea?\r\nThanks in advance. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267691265","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267691265","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267691265,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzY5MTI2NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T20:42:56Z","updated_at":"2016-12-16T20:42:56Z","author_association":"MEMBER","body":"@georgecao I think there are a couple of things going on.\r\n\r\nFirst you say you have 10 nodes, I presume you don't run dedicated master nodes. If that's the case then setting `discovery.zen.minimum_master_nodes` to `2` is dangerous as your 10 nodes can split to form 3 clusters of 3 nodes each. You should set it to `6` (a majority). That said, it's not clear to me why this explains network disconnects.\r\n\r\nIt seems the nodes discover the master fine (and try to join it), so I don't think it's a question of multicast based discovery. \r\n\r\nIt seems something is off with the network there are a lot of timeouts and disconnect errors in the log you shared. Since you masked the IPs (good!) it's hard for me to check they all make sense. In ES each node has the local ip it binds to and the IP it publishes (i.e., the IP people should use to connect to it). Can you check those make sense?\r\n\r\nFinally, I was wondering how you ended up with 17s in `discovery.zen.ping_timeout: 17s` ?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267731625","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267731625","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267731625,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzczMTYyNQ==","user":{"login":"sinsonglew","id":12896760,"node_id":"MDQ6VXNlcjEyODk2NzYw","avatar_url":"https://avatars1.githubusercontent.com/u/12896760?v=4","gravatar_id":"","url":"https://api.github.com/users/sinsonglew","html_url":"https://github.com/sinsonglew","followers_url":"https://api.github.com/users/sinsonglew/followers","following_url":"https://api.github.com/users/sinsonglew/following{/other_user}","gists_url":"https://api.github.com/users/sinsonglew/gists{/gist_id}","starred_url":"https://api.github.com/users/sinsonglew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sinsonglew/subscriptions","organizations_url":"https://api.github.com/users/sinsonglew/orgs","repos_url":"https://api.github.com/users/sinsonglew/repos","events_url":"https://api.github.com/users/sinsonglew/events{/privacy}","received_events_url":"https://api.github.com/users/sinsonglew/received_events","type":"User","site_admin":false},"created_at":"2016-12-17T01:02:59Z","updated_at":"2016-12-17T01:02:59Z","author_association":"NONE","body":"@Boaz, at first, 10 nodes without dedicated roles settings were experimented, the minimum master nodes set up with 6, we can't get a full started cluster, so we have to decrease the total nodes to 3, it works, then 4, it failed. We have another dc, so 8 nodes with 3 master eligible got tried again, it repeated. We can't figure out where there is something wrong. Thanks!\r\n\r\n发自我的 Windows Phone\r\n________________________________\r\nFrom: Boaz Leskes<mailto:notifications@github.com>\r\nSent: ‎2016/‎12/‎17 4:43\r\nTo: elastic/elasticsearch<mailto:elasticsearch@noreply.github.com>\r\nCc: sinsonglew<mailto:sinsonglew@live.com>; Mention<mailto:mention@noreply.github.com>\r\nSubject: Re: [elastic/elasticsearch] elastic 5.1.1 master node always pinged time out, failed to form a cluster (#22189)\r\n\r\n\r\n@georgecao<https://github.com/georgecao> I think there are a couple of things going on.\r\n\r\nFirst you say you have 10 nodes, I presume you don't run dedicated master nodes. If that's the case then setting discovery.zen.minimum_master_nodes to 2 is dangerous as your 10 nodes can split to form 3 clusters of 3 nodes each. You should set it to 6 (a majority). That said, it's not clear to me why this explains network disconnects.\r\n\r\nIt seems the nodes discover the master fine (and try to join it), so I don't think it's a question of multicast based discovery.\r\n\r\nIt seems something is off with the network there are a lot of timeouts and disconnect errors in the log you shared. Since you masked the IPs (good!) it's hard for me to check they all make sense. In ES each node has the local ip it binds to and the IP it publishes (i.e., the IP people should use to connect to it). Can you check those make sense?\r\n\r\nFinally, I was wondering how you ended up with 17s in discovery.zen.ping_timeout: 17s ?\r\n\r\n—\r\nYou are receiving this because you were mentioned.\r\nReply to this email directly, view it on GitHub<https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267691265>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AMTJ-MTYkyb5ivp6gt3i9wUbXxWWbTAnks5rIvfvgaJpZM4LOBBu>.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267767460","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267767460","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267767460,"node_id":"MDEyOklzc3VlQ29tbWVudDI2Nzc2NzQ2MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-12-17T15:06:39Z","updated_at":"2016-12-17T15:06:39Z","author_association":"MEMBER","body":"@sinsonglew everything points at network issues. Can you check the IPs of the published address?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267802609","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267802609","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267802609,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzgwMjYwOQ==","user":{"login":"sinsonglew","id":12896760,"node_id":"MDQ6VXNlcjEyODk2NzYw","avatar_url":"https://avatars1.githubusercontent.com/u/12896760?v=4","gravatar_id":"","url":"https://api.github.com/users/sinsonglew","html_url":"https://github.com/sinsonglew","followers_url":"https://api.github.com/users/sinsonglew/followers","following_url":"https://api.github.com/users/sinsonglew/following{/other_user}","gists_url":"https://api.github.com/users/sinsonglew/gists{/gist_id}","starred_url":"https://api.github.com/users/sinsonglew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sinsonglew/subscriptions","organizations_url":"https://api.github.com/users/sinsonglew/orgs","repos_url":"https://api.github.com/users/sinsonglew/repos","events_url":"https://api.github.com/users/sinsonglew/events{/privacy}","received_events_url":"https://api.github.com/users/sinsonglew/received_events","type":"User","site_admin":false},"created_at":"2016-12-18T04:21:28Z","updated_at":"2016-12-18T04:26:29Z","author_association":"NONE","body":"@bleskes, @clintongormley, we downgrade netty from 4 to 3 by setting `transport.type=netty3`\r\n`http.type=netty3` , problem sovled, it's not a network issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267807134","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267807134","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267807134,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzgwNzEzNA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-12-18T07:08:16Z","updated_at":"2016-12-18T07:08:16Z","author_association":"MEMBER","body":"> we downgrade netty from 4 to 3 by setting transport.type=netty3\r\nhttp.type=netty3 , problem sovled, it's not a network issue.\r\n\r\nThank you for this clue. We will investigate and get back to you as soon as possible.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267973937","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-267973937","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":267973937,"node_id":"MDEyOklzc3VlQ29tbWVudDI2Nzk3MzkzNw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-12-19T14:15:58Z","updated_at":"2016-12-19T14:15:58Z","author_association":"MEMBER","body":"Can you share some more details:\r\n - node specs (especially heap size but general specs as well)\r\n - from your kernel version I think that you're running RHEL 6, can you confirm?\r\n - logs from a node and the master (there is no need to mask the IP addresses, from your configuration I see that you're in 10.0.0.0/8 which is a private IP address space; masking will just make it harder-than-necessary to read)\r\n - are the nodes accessible over HTTP (e.g., `GET /`)?\r\n - what is going on on the cluster when this happens (heavy indexing, searching, etc.)?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268224026","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-268224026","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":268224026,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODIyNDAyNg==","user":{"login":"georgecao","id":1426758,"node_id":"MDQ6VXNlcjE0MjY3NTg=","avatar_url":"https://avatars0.githubusercontent.com/u/1426758?v=4","gravatar_id":"","url":"https://api.github.com/users/georgecao","html_url":"https://github.com/georgecao","followers_url":"https://api.github.com/users/georgecao/followers","following_url":"https://api.github.com/users/georgecao/following{/other_user}","gists_url":"https://api.github.com/users/georgecao/gists{/gist_id}","starred_url":"https://api.github.com/users/georgecao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/georgecao/subscriptions","organizations_url":"https://api.github.com/users/georgecao/orgs","repos_url":"https://api.github.com/users/georgecao/repos","events_url":"https://api.github.com/users/georgecao/events{/privacy}","received_events_url":"https://api.github.com/users/georgecao/received_events","type":"User","site_admin":false},"created_at":"2016-12-20T11:48:50Z","updated_at":"2016-12-20T11:48:50Z","author_association":"NONE","body":"> node specs (especially heap size but general specs as well)\r\n\r\nIn **jvm.options**, we specify the heap size and enable gc logs and log to a file by setting\r\n```\r\n-Xms25g\r\n-Xmx25g\r\n# ensure the directory exists\r\n-Xloggc:/path/to/gc/log.file\r\n```\r\nand keep the other configurations as same as the default ones.\r\n\r\n> from your kernel version I think that you're running RHEL 6, can you confirm?\r\n\r\n`lsb_release -a` prints **CentOS release 6.4 (Final)**\r\n\r\n> are the nodes accessible over HTTP (e.g., GET /)?\r\n\r\nYes, but very slow.\r\n\r\n> what is going on on the cluster when this happens (heavy indexing, searching, etc.)?\r\n\r\nThe cluster do nothing special. This happens just after we install the ElasticSearch 5.1.1, then we try to start the cluster, which means there are no indexing, no searching and no data on any node.\r\n\r\n> logs from a node and the master (there is no need to mask the IP addresses, from your configuration I see that you're in 10.0.0.0/8 which is a private IP address space; masking will just make it harder-than-necessary to read)\r\n\r\nIndeed, the private IP is safe to publish, but the hostname is not.   Will update logs including the private IP.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268722266","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-268722266","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":268722266,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODcyMjI2Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-12-22T05:31:01Z","updated_at":"2016-12-22T05:31:01Z","author_association":"MEMBER","body":"> Yes, but very slow.\r\n\r\nThis is very suspicious, and I suspect that if we can understand this we might be able to unlock what is going on here.\r\n\r\nHow many cores do your machines have?\r\n\r\nDo you see anything in the GC logs?\r\n\r\nCan you start the JVMs with these flags?\r\n\r\n```\r\n-XX:+PrintGCDetails\r\n-XX:+PrintGCTimeStamps\r\n-XX:+PrintGCDateStamps\r\n-XX:+PrintClassHistogram\r\n-XX:+PrintTenuringDistribution\r\n-XX:+PrintGCApplicationStoppedTime\r\n-XX:+PrintGCApplicationConcurrentTime\r\n-Xloggc:/path/to/gc/log.file\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269158291","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269158291","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269158291,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTE1ODI5MQ==","user":{"login":"aqlu","id":5010463,"node_id":"MDQ6VXNlcjUwMTA0NjM=","avatar_url":"https://avatars0.githubusercontent.com/u/5010463?v=4","gravatar_id":"","url":"https://api.github.com/users/aqlu","html_url":"https://github.com/aqlu","followers_url":"https://api.github.com/users/aqlu/followers","following_url":"https://api.github.com/users/aqlu/following{/other_user}","gists_url":"https://api.github.com/users/aqlu/gists{/gist_id}","starred_url":"https://api.github.com/users/aqlu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aqlu/subscriptions","organizations_url":"https://api.github.com/users/aqlu/orgs","repos_url":"https://api.github.com/users/aqlu/repos","events_url":"https://api.github.com/users/aqlu/events{/privacy}","received_events_url":"https://api.github.com/users/aqlu/received_events","type":"User","site_admin":false},"created_at":"2016-12-26T04:10:53Z","updated_at":"2016-12-26T04:10:53Z","author_association":"NONE","body":"We upgrade 2.3.2 to 5.1.1, And encountered the same problem with @sinsonglew ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269263003","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269263003","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269263003,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTI2MzAwMw==","user":{"login":"aqlu","id":5010463,"node_id":"MDQ6VXNlcjUwMTA0NjM=","avatar_url":"https://avatars0.githubusercontent.com/u/5010463?v=4","gravatar_id":"","url":"https://api.github.com/users/aqlu","html_url":"https://github.com/aqlu","followers_url":"https://api.github.com/users/aqlu/followers","following_url":"https://api.github.com/users/aqlu/following{/other_user}","gists_url":"https://api.github.com/users/aqlu/gists{/gist_id}","starred_url":"https://api.github.com/users/aqlu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aqlu/subscriptions","organizations_url":"https://api.github.com/users/aqlu/orgs","repos_url":"https://api.github.com/users/aqlu/repos","events_url":"https://api.github.com/users/aqlu/events{/privacy}","received_events_url":"https://api.github.com/users/aqlu/received_events","type":"User","site_admin":false},"created_at":"2016-12-27T03:11:10Z","updated_at":"2016-12-27T03:11:10Z","author_association":"NONE","body":" @sinsonglew we tried to downgrade netty from 4 to 3, but can not resolved this problem.\r\n\r\nWe found some phenomenon:\r\n1. when the throughput is relatively low, there is no node left. \r\n2. Master node is never left.\r\n\r\nI tried to setting `discovery.zen.fd.ping_retries: 6`, but has no effect.\r\n\r\n**Elasticsearch version:** 5.1.1\r\n**Plugins installed:** [x-pack]  disabled security plugin\r\n**JVM version:** Java(TM) SE Runtime Environment (build 1.8.0_74-b02)\r\n**OS version:** CentOS release 6.7 (Final) 2.6.32-573.8.1.el6.x86_64 #1 SMP Tue Nov 10 18:01:38 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nthere is my config:\r\n```yml\r\ncluster.name: prod_elasticsearch\r\nnode.name: es-log-193\r\npath.data: /home/elasticsearch/data\r\nnetwork.host: 0.0.0.0\r\ndiscovery.zen.ping.unicast.hosts: [\"192.168.65.188\",\"192.168.65.189\",\"192.168.65.190\",\"192.168.65.191\",\"192.168.65.187\",\"192.168.65.192\"]\r\nxpack.monitoring.collection.interval: 30s\r\nxpack.monitoring.history.duration: 3d\r\nhttp.cors.enabled: true\r\nhttp.cors.allow-origin: '*'\r\nxpack.security.enabled: false\r\nthread_pool.index.queue_size: 8000\r\nthread_pool.search.queue_size: 8000\r\nthread_pool.bulk.queue_size: 8000\r\npath.repo: [\"/home/elasticsearch/ES_backup\"]\r\ndiscovery.zen.fd.ping_retries: 6\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269376805","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269376805","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269376805,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTM3NjgwNQ==","user":{"login":"RobertTheProfessional","id":1852571,"node_id":"MDQ6VXNlcjE4NTI1NzE=","avatar_url":"https://avatars2.githubusercontent.com/u/1852571?v=4","gravatar_id":"","url":"https://api.github.com/users/RobertTheProfessional","html_url":"https://github.com/RobertTheProfessional","followers_url":"https://api.github.com/users/RobertTheProfessional/followers","following_url":"https://api.github.com/users/RobertTheProfessional/following{/other_user}","gists_url":"https://api.github.com/users/RobertTheProfessional/gists{/gist_id}","starred_url":"https://api.github.com/users/RobertTheProfessional/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RobertTheProfessional/subscriptions","organizations_url":"https://api.github.com/users/RobertTheProfessional/orgs","repos_url":"https://api.github.com/users/RobertTheProfessional/repos","events_url":"https://api.github.com/users/RobertTheProfessional/events{/privacy}","received_events_url":"https://api.github.com/users/RobertTheProfessional/received_events","type":"User","site_admin":false},"created_at":"2016-12-27T20:13:34Z","updated_at":"2016-12-27T20:13:34Z","author_association":"NONE","body":"@sinsonglew @aqlu Just upgraded our 10 node cluster from 2.4.1 and suffering what seems to be similar issues.\r\n\r\nI've downgraded the netty clients on both the transports and http clients to version 3 from 4 and adjusted the keepalive timers on the all of the hosts but my nodes are still suffering the pinging issues every few hours.\r\n\r\n```\r\n[2016-12-27T19:25:07,916][INFO ][o.e.d.z.ZenDiscovery     ] [Data Six] master_left [{Master One}{VLblVsoKQnK82vCcn8aU7w}{pIwD1j5ESESvFQ0ZCoe8GQ}{x.x.x.7}{x.x.x.7:9300}{rack=Masters}], reason [failed to ping, tried [3] times, each with  maximum [30s] timeout]\r\n[2016-12-27T19:25:07,917][WARN ][o.e.d.z.ZenDiscovery     ] [Data Six] master left (reason = failed to ping, tried [3] times, each with  maximum [30s] timeout), current nodes: nodes: \r\n\t{Data Four}{v4GIb5n7SSess4fUCBCbsQ}{PirkGa3rQ1KtX89FNC3xuQ}{x.x.x.11}{x.x.x.11:9300}{rack=Search Load Balancers}\r\n\t{Data Eight}{4_ly1NagS7-2fp9z5KiIHQ}{AKs98d44TSCS0BOYhA4Idg}{x.x.x.22}{x.x.x.22:9300}{rack=Data Stores}\r\n\t{Data Five}{sxEkv3nBSjaa3OkNN6kZnQ}{Q6ReG88NSQi5VButwrIDCA}{x.x.x.12}{x.x.x.12:9300}{rack=Data Stores}\r\n\t{Kibana}{Raicx_zzTyGqedAwRCsxNw}{obZmcC9BQA2dFtXQXpx4ug}{x.x.x.15}{x.x.x.15:9300}{rack=Visualization Server}\r\n\t{Data Nine}{9C9GxU7LQgyixJtvWcpc-Q}{WXtLtBasTJ2kFCnZNYlQqw}{x.x.x.23}{x.x.x.23:9300}{rack=Data Stores}\r\n\t{Data Seven}{52kTpnu9SeWTI_smXBu3tA}{_q9bPoezSrOYGVS8nQoXLQ}{x.x.x.21}{x.x.x.21:9300}{rack=Data Stores}\r\n\t{Logstash One}{Pg0J5PhEQU-6dRaoV8tXxQ}{PcY7w0fARiW2p43VRvC6YA}{x.x.x.17}{x.x.x.17:9300}{rack=Ingestion Server}\r\n\t{Data Ten}{tJUQk8MiQqC4QqJI-hWmmA}{d5d5YkVjRgqM7OieRxtedQ}{x.x.x.24}{x.x.x.24:9300}{rack=Data Stores}\r\n\t{Master Two}{j4B-jvfeT2CAESG5sElJXg}{1lVXxxDXTde5VkUF0UH29Q}{x.x.x.8}{x.x.x.8:9300}{rack=Masters}\r\n\t{Master Three}{iQzn2UDZQ-27zZIPrIW-8Q}{nSmaCPW5RWSy7L9L5EaYow}{x.x.x.9}{x.x.x.9:9300}{rack=Masters}\r\n\t{Data Six}{6iptJ5_wQ4aHDs1DYwc2SQ}{Z7IJ_XrmTHGK-FWJEmUgsw}{x.x.x.13}{x.x.x.13:9300}{rack=Data Stores}, local\r\n\t{Data One}{W9KXL56rRJeXDsyBV-J1nA}{uz8gReByRmmZsvz52saFkQ}{x.x.x.4}{x.x.x.4:9300}{rack=Data Stores}\r\n\t{Data Two}{cba4LbEiTDSzWGEvlvLwwA}{KGkQe5I1RSG5Q3bVH7Mrrw}{x.x.x.5}{x.x.x.5:9300}{rack=Data Stores}\r\n\t{Data Three}{wCjYdTB_RTO2QkqmCoE40w}{gJHQonRMSXSjiD43PcVdXw}{x.x.x.6}{x.x.x.6:9300}{rack=Data Stores}\r\n`````","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269410550","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269410550","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269410550,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTQxMDU1MA==","user":{"login":"sinsonglew","id":12896760,"node_id":"MDQ6VXNlcjEyODk2NzYw","avatar_url":"https://avatars1.githubusercontent.com/u/12896760?v=4","gravatar_id":"","url":"https://api.github.com/users/sinsonglew","html_url":"https://github.com/sinsonglew","followers_url":"https://api.github.com/users/sinsonglew/followers","following_url":"https://api.github.com/users/sinsonglew/following{/other_user}","gists_url":"https://api.github.com/users/sinsonglew/gists{/gist_id}","starred_url":"https://api.github.com/users/sinsonglew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sinsonglew/subscriptions","organizations_url":"https://api.github.com/users/sinsonglew/orgs","repos_url":"https://api.github.com/users/sinsonglew/repos","events_url":"https://api.github.com/users/sinsonglew/events{/privacy}","received_events_url":"https://api.github.com/users/sinsonglew/received_events","type":"User","site_admin":false},"created_at":"2016-12-28T01:37:22Z","updated_at":"2016-12-28T01:37:22Z","author_association":"NONE","body":"@aqlu, what's your setting for **discovery.zen.minimum_master_nodes**, you said when throughput is low, it works fine, vice versa. it is how high the throughput is that make cluster out of function. Did  cpu, memory usage are in safety line, how complex your query are ? Try optimize your query may be the first option.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269411044","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269411044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269411044,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTQxMTA0NA==","user":{"login":"sinsonglew","id":12896760,"node_id":"MDQ6VXNlcjEyODk2NzYw","avatar_url":"https://avatars1.githubusercontent.com/u/12896760?v=4","gravatar_id":"","url":"https://api.github.com/users/sinsonglew","html_url":"https://github.com/sinsonglew","followers_url":"https://api.github.com/users/sinsonglew/followers","following_url":"https://api.github.com/users/sinsonglew/following{/other_user}","gists_url":"https://api.github.com/users/sinsonglew/gists{/gist_id}","starred_url":"https://api.github.com/users/sinsonglew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sinsonglew/subscriptions","organizations_url":"https://api.github.com/users/sinsonglew/orgs","repos_url":"https://api.github.com/users/sinsonglew/repos","events_url":"https://api.github.com/users/sinsonglew/events{/privacy}","received_events_url":"https://api.github.com/users/sinsonglew/received_events","type":"User","site_admin":false},"created_at":"2016-12-28T01:42:44Z","updated_at":"2016-12-28T01:42:44Z","author_association":"NONE","body":"@RobertTheProfessional , you said every few hours the cluster will lose nodes. When that happened, can you provide any other info about business query frequency, lcpu load and so on.\r\n\r\nAlso try a different master node to exclude machine issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269412605","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269412605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269412605,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTQxMjYwNQ==","user":{"login":"RobertTheProfessional","id":1852571,"node_id":"MDQ6VXNlcjE4NTI1NzE=","avatar_url":"https://avatars2.githubusercontent.com/u/1852571?v=4","gravatar_id":"","url":"https://api.github.com/users/RobertTheProfessional","html_url":"https://github.com/RobertTheProfessional","followers_url":"https://api.github.com/users/RobertTheProfessional/followers","following_url":"https://api.github.com/users/RobertTheProfessional/following{/other_user}","gists_url":"https://api.github.com/users/RobertTheProfessional/gists{/gist_id}","starred_url":"https://api.github.com/users/RobertTheProfessional/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RobertTheProfessional/subscriptions","organizations_url":"https://api.github.com/users/RobertTheProfessional/orgs","repos_url":"https://api.github.com/users/RobertTheProfessional/repos","events_url":"https://api.github.com/users/RobertTheProfessional/events{/privacy}","received_events_url":"https://api.github.com/users/RobertTheProfessional/received_events","type":"User","site_admin":false},"created_at":"2016-12-28T02:01:41Z","updated_at":"2016-12-28T02:01:41Z","author_association":"NONE","body":"@sinsonglew The nodes are on an OpenStack virtualization platform. We have three master nodes at 4 vCPUs, 16GB RAM and 4GB heap locked to the ES process. There's ten data nodes are 16 vCPUs, 64GB RAM with 31GB of RAM locked to the ES process. Currently we're indexing at a rate of 5,000 documents a second and as a result the heap on a few of the nodes tend to average around 27GB before the garbage collector kicks in. Previously we had a six node cluster with a three master/three data node but the cluster was failing constantly due to a high index rate. The index that's been causing the issues is averaging 38 million documents that are loaded dynamically through Logstash's JSON filter.\r\n\r\nI attached a screenshot of one of the problematic nodes, although most of the nodes suffer from a failure to ping the master.\r\n\r\n<img width=\"1756\" alt=\"screen shot 2016-12-27 at 8 47 02 pm\" src=\"https://cloud.githubusercontent.com/assets/1852571/21511986/b126e112-cc75-11e6-92eb-964b8117d60b.png\">","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269415373","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269415373","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269415373,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTQxNTM3Mw==","user":{"login":"aqlu","id":5010463,"node_id":"MDQ6VXNlcjUwMTA0NjM=","avatar_url":"https://avatars0.githubusercontent.com/u/5010463?v=4","gravatar_id":"","url":"https://api.github.com/users/aqlu","html_url":"https://github.com/aqlu","followers_url":"https://api.github.com/users/aqlu/followers","following_url":"https://api.github.com/users/aqlu/following{/other_user}","gists_url":"https://api.github.com/users/aqlu/gists{/gist_id}","starred_url":"https://api.github.com/users/aqlu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aqlu/subscriptions","organizations_url":"https://api.github.com/users/aqlu/orgs","repos_url":"https://api.github.com/users/aqlu/repos","events_url":"https://api.github.com/users/aqlu/events{/privacy}","received_events_url":"https://api.github.com/users/aqlu/received_events","type":"User","site_admin":false},"created_at":"2016-12-28T02:34:19Z","updated_at":"2016-12-28T02:34:19Z","author_association":"NONE","body":"@sinsonglew here is my nodes info, 5 master and data node,  2 data only node:\r\n```\r\n192.168.65.193 59 89 16 8.64 8.29 8.17 mdi - es-log-193\r\n192.168.65.189 32 92 20 5.77 6.23 5.90 mdi - es-log-189\r\n192.168.65.190 72 91 20 4.94 5.48 5.31 mdi - es-log-190\r\n192.168.65.188 31 90 30 6.20 6.32 5.87 di  - es-log-188\r\n192.168.65.191 42 90 29 5.26 5.66 5.34 di  - es-log-191\r\n192.168.65.187 51 91 20 4.59 5.22 5.18 mdi * es-log-187\r\n192.168.65.192 15 91 18 6.06 6.33 5.88 mdi - es-log-192\r\n```\r\nWe setting **discovery.zen.minimum_master_nodes ** is **3** . This ES cluster is our log cluster, usually use bulk index, query is less. And this cluster working fine at ES v2.3.2.\r\nCPU and memory are in noraml range:\r\n![image](https://cloud.githubusercontent.com/assets/5010463/21512300/ba95ecd6-cce6-11e6-824c-45506c503821.png)\r\n\r\n@RobertTheProfessional It seems more guys encounter with this trouble.\r\n\r\n@clintongormley @bleskes @jasontedor \r\nDo you have any ideas?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269417456","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269417456","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269417456,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTQxNzQ1Ng==","user":{"login":"RobertTheProfessional","id":1852571,"node_id":"MDQ6VXNlcjE4NTI1NzE=","avatar_url":"https://avatars2.githubusercontent.com/u/1852571?v=4","gravatar_id":"","url":"https://api.github.com/users/RobertTheProfessional","html_url":"https://github.com/RobertTheProfessional","followers_url":"https://api.github.com/users/RobertTheProfessional/followers","following_url":"https://api.github.com/users/RobertTheProfessional/following{/other_user}","gists_url":"https://api.github.com/users/RobertTheProfessional/gists{/gist_id}","starred_url":"https://api.github.com/users/RobertTheProfessional/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RobertTheProfessional/subscriptions","organizations_url":"https://api.github.com/users/RobertTheProfessional/orgs","repos_url":"https://api.github.com/users/RobertTheProfessional/repos","events_url":"https://api.github.com/users/RobertTheProfessional/events{/privacy}","received_events_url":"https://api.github.com/users/RobertTheProfessional/received_events","type":"User","site_admin":false},"created_at":"2016-12-28T02:56:39Z","updated_at":"2016-12-28T02:56:39Z","author_association":"NONE","body":"@aqlu Yeah this issue cropped up immediately after upgrading to 5.1.1. Judging by both of our statistics, I'm starting to believe the garbage collection process is getting in the way of the node pinging the master node.\r\n\r\n<img width=\"1697\" alt=\"screen shot 2016-12-27 at 9 47 04 pm\" src=\"https://cloud.githubusercontent.com/assets/1852571/21512832/3e9cc224-cc7f-11e6-96c8-9f1e029b33ac.png\">\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269427856","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269427856","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269427856,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTQyNzg1Ng==","user":{"login":"sinsonglew","id":12896760,"node_id":"MDQ6VXNlcjEyODk2NzYw","avatar_url":"https://avatars1.githubusercontent.com/u/12896760?v=4","gravatar_id":"","url":"https://api.github.com/users/sinsonglew","html_url":"https://github.com/sinsonglew","followers_url":"https://api.github.com/users/sinsonglew/followers","following_url":"https://api.github.com/users/sinsonglew/following{/other_user}","gists_url":"https://api.github.com/users/sinsonglew/gists{/gist_id}","starred_url":"https://api.github.com/users/sinsonglew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sinsonglew/subscriptions","organizations_url":"https://api.github.com/users/sinsonglew/orgs","repos_url":"https://api.github.com/users/sinsonglew/repos","events_url":"https://api.github.com/users/sinsonglew/events{/privacy}","received_events_url":"https://api.github.com/users/sinsonglew/received_events","type":"User","site_admin":false},"created_at":"2016-12-28T05:25:07Z","updated_at":"2016-12-28T05:25:07Z","author_association":"NONE","body":"@aqlu , how did you assign shards allocation ? what's your setting of  index **refresh_interval** ? \r\ntry to adjust **refresh_interval** bigger.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269433615","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-269433615","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":269433615,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTQzMzYxNQ==","user":{"login":"aqlu","id":5010463,"node_id":"MDQ6VXNlcjUwMTA0NjM=","avatar_url":"https://avatars0.githubusercontent.com/u/5010463?v=4","gravatar_id":"","url":"https://api.github.com/users/aqlu","html_url":"https://github.com/aqlu","followers_url":"https://api.github.com/users/aqlu/followers","following_url":"https://api.github.com/users/aqlu/following{/other_user}","gists_url":"https://api.github.com/users/aqlu/gists{/gist_id}","starred_url":"https://api.github.com/users/aqlu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aqlu/subscriptions","organizations_url":"https://api.github.com/users/aqlu/orgs","repos_url":"https://api.github.com/users/aqlu/repos","events_url":"https://api.github.com/users/aqlu/events{/privacy}","received_events_url":"https://api.github.com/users/aqlu/received_events","type":"User","site_admin":false},"created_at":"2016-12-28T06:39:26Z","updated_at":"2016-12-28T06:39:26Z","author_association":"NONE","body":"@sinsonglew \r\nhere is my refresh and shards setting:\r\n```\r\n\"refresh_interval\": \"5s\"\r\n\"number_of_shards\": \"14\"\r\n\"number_of_replicas\": \"1\"\r\n```\r\nI can try to set up value of **refresh_interval**， But I think this is not root cause of the problem.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270410325","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-270410325","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":270410325,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDQxMDMyNQ==","user":{"login":"ygersie","id":6005868,"node_id":"MDQ6VXNlcjYwMDU4Njg=","avatar_url":"https://avatars3.githubusercontent.com/u/6005868?v=4","gravatar_id":"","url":"https://api.github.com/users/ygersie","html_url":"https://github.com/ygersie","followers_url":"https://api.github.com/users/ygersie/followers","following_url":"https://api.github.com/users/ygersie/following{/other_user}","gists_url":"https://api.github.com/users/ygersie/gists{/gist_id}","starred_url":"https://api.github.com/users/ygersie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ygersie/subscriptions","organizations_url":"https://api.github.com/users/ygersie/orgs","repos_url":"https://api.github.com/users/ygersie/repos","events_url":"https://api.github.com/users/ygersie/events{/privacy}","received_events_url":"https://api.github.com/users/ygersie/received_events","type":"User","site_admin":false},"created_at":"2017-01-04T16:10:51Z","updated_at":"2017-01-04T16:11:48Z","author_association":"NONE","body":"Same problem here. Have a test cluster running with both 2.4.3 and 5.1.1. Both are benchmarked with a very simple Go script to ingest as much data as possible. We can get 2.4.3 on it's knees without any issues regarding node disconnections, just high load. 5.1.1 intermittently has the same issues as described multiple times before in this thread.\r\n\r\nSetup with both versions the same:\r\n\r\n3 - master nodes\r\n3 - client nodes\r\n16 - data nodes\r\n\r\n```\r\ndiscovery.zen.fd.ping_interval: 1s\r\ndiscovery.zen.fd.ping_timeout: 5s\r\ndiscovery.zen.fd.ping_retries: 3\r\ndiscovery.zen.minimum_master_nodes: 2\r\n```\r\n\r\nI've looked at GC patterns but they seem normal. No excessive GC times as far as I can tell.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270411566","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-270411566","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":270411566,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDQxMTU2Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-01-04T16:15:23Z","updated_at":"2017-01-04T16:15:23Z","author_association":"MEMBER","body":"@dropje86 Are you running any monitoring agent that periodically makes stats calls to Elasticsearch (e.g., to `/_nodes/stats`)?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270411899","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-270411899","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":270411899,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDQxMTg5OQ==","user":{"login":"ygersie","id":6005868,"node_id":"MDQ6VXNlcjYwMDU4Njg=","avatar_url":"https://avatars3.githubusercontent.com/u/6005868?v=4","gravatar_id":"","url":"https://api.github.com/users/ygersie","html_url":"https://github.com/ygersie","followers_url":"https://api.github.com/users/ygersie/followers","following_url":"https://api.github.com/users/ygersie/following{/other_user}","gists_url":"https://api.github.com/users/ygersie/gists{/gist_id}","starred_url":"https://api.github.com/users/ygersie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ygersie/subscriptions","organizations_url":"https://api.github.com/users/ygersie/orgs","repos_url":"https://api.github.com/users/ygersie/repos","events_url":"https://api.github.com/users/ygersie/events{/privacy}","received_events_url":"https://api.github.com/users/ygersie/received_events","type":"User","site_admin":false},"created_at":"2017-01-04T16:16:40Z","updated_at":"2017-01-04T16:16:40Z","author_association":"NONE","body":"@jasontedor yes, in the case of 2.4.3 we run marvel-agent and with 5.1.1 we run with x-pack installed.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270412387","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-270412387","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":270412387,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDQxMjM4Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-01-04T16:18:23Z","updated_at":"2017-01-04T16:18:23Z","author_association":"MEMBER","body":"@dropje86 Sadly, I suspect that you're being bitten by #22285; the fix is #22317 (and relates to #22314) and will be released in 5.1.2. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270412987","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-270412987","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":270412987,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDQxMjk4Nw==","user":{"login":"ygersie","id":6005868,"node_id":"MDQ6VXNlcjYwMDU4Njg=","avatar_url":"https://avatars3.githubusercontent.com/u/6005868?v=4","gravatar_id":"","url":"https://api.github.com/users/ygersie","html_url":"https://github.com/ygersie","followers_url":"https://api.github.com/users/ygersie/followers","following_url":"https://api.github.com/users/ygersie/following{/other_user}","gists_url":"https://api.github.com/users/ygersie/gists{/gist_id}","starred_url":"https://api.github.com/users/ygersie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ygersie/subscriptions","organizations_url":"https://api.github.com/users/ygersie/orgs","repos_url":"https://api.github.com/users/ygersie/repos","events_url":"https://api.github.com/users/ygersie/events{/privacy}","received_events_url":"https://api.github.com/users/ygersie/received_events","type":"User","site_admin":false},"created_at":"2017-01-04T16:20:37Z","updated_at":"2017-01-04T16:20:37Z","author_association":"NONE","body":"I would be fine with that ;) Came across that issue before I saw this one, but I don't see any related exceptions in the master logs. I'm just getting a ping timeout to the master from a suffering data node and the active master reports transport disconnections to that data node.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270415527","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-270415527","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":270415527,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDQxNTUyNw==","user":{"login":"RobertTheProfessional","id":1852571,"node_id":"MDQ6VXNlcjE4NTI1NzE=","avatar_url":"https://avatars2.githubusercontent.com/u/1852571?v=4","gravatar_id":"","url":"https://api.github.com/users/RobertTheProfessional","html_url":"https://github.com/RobertTheProfessional","followers_url":"https://api.github.com/users/RobertTheProfessional/followers","following_url":"https://api.github.com/users/RobertTheProfessional/following{/other_user}","gists_url":"https://api.github.com/users/RobertTheProfessional/gists{/gist_id}","starred_url":"https://api.github.com/users/RobertTheProfessional/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RobertTheProfessional/subscriptions","organizations_url":"https://api.github.com/users/RobertTheProfessional/orgs","repos_url":"https://api.github.com/users/RobertTheProfessional/repos","events_url":"https://api.github.com/users/RobertTheProfessional/events{/privacy}","received_events_url":"https://api.github.com/users/RobertTheProfessional/received_events","type":"User","site_admin":false},"created_at":"2017-01-04T16:29:56Z","updated_at":"2017-01-04T16:29:56Z","author_association":"NONE","body":"@jasontedor Interestingly, I'm using a modified version of Kopf that makes constant `/_nodes/stats` calls to all of the nodes in my cluster. That could be the reason as to why the nodes are having transport issues with the master nodes?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271109990","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-271109990","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":271109990,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTEwOTk5MA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-01-07T21:02:33Z","updated_at":"2017-01-07T21:02:33Z","author_association":"MEMBER","body":"I think that this is addressed by #22452; please reopen if not.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/337101544","html_url":"https://github.com/elastic/elasticsearch/issues/22189#issuecomment-337101544","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22189","id":337101544,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNzEwMTU0NA==","user":{"login":"chien918","id":11696281,"node_id":"MDQ6VXNlcjExNjk2Mjgx","avatar_url":"https://avatars0.githubusercontent.com/u/11696281?v=4","gravatar_id":"","url":"https://api.github.com/users/chien918","html_url":"https://github.com/chien918","followers_url":"https://api.github.com/users/chien918/followers","following_url":"https://api.github.com/users/chien918/following{/other_user}","gists_url":"https://api.github.com/users/chien918/gists{/gist_id}","starred_url":"https://api.github.com/users/chien918/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chien918/subscriptions","organizations_url":"https://api.github.com/users/chien918/orgs","repos_url":"https://api.github.com/users/chien918/repos","events_url":"https://api.github.com/users/chien918/events{/privacy}","received_events_url":"https://api.github.com/users/chien918/received_events","type":"User","site_admin":false},"created_at":"2017-10-17T02:46:31Z","updated_at":"2017-10-17T02:46:31Z","author_association":"NONE","body":"Give an advision: please make sure the node opens the port 9300. ","performed_via_github_app":null}]