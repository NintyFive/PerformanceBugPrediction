[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385712941","html_url":"https://github.com/elastic/elasticsearch/issues/30306#issuecomment-385712941","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30306","id":385712941,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTcxMjk0MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-01T16:17:11Z","updated_at":"2018-05-01T16:17:11Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385763132","html_url":"https://github.com/elastic/elasticsearch/issues/30306#issuecomment-385763132","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30306","id":385763132,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTc2MzEzMg==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-05-01T19:20:34Z","updated_at":"2018-05-01T19:20:34Z","author_association":"MEMBER","body":"I pushed cdae8ff5a0760862548834a1c9c96b71e5a8ff77 to hopefully get a bit more information about the authorization failure","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385763161","html_url":"https://github.com/elastic/elasticsearch/issues/30306#issuecomment-385763161","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30306","id":385763161,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTc2MzE2MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-01T19:20:43Z","updated_at":"2018-05-01T19:20:43Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385763994","html_url":"https://github.com/elastic/elasticsearch/issues/30306#issuecomment-385763994","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30306","id":385763994,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTc2Mzk5NA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-05-01T19:24:15Z","updated_at":"2018-05-01T19:24:15Z","author_association":"MEMBER","body":"This has also failed on 6.x as noted by @bleskes via email https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+periodic/1913","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386361128","html_url":"https://github.com/elastic/elasticsearch/issues/30306#issuecomment-386361128","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30306","id":386361128,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjM2MTEyOA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-05-03T16:48:43Z","updated_at":"2018-05-03T16:48:43Z","author_association":"MEMBER","body":"For closure, I pushed https://github.com/elastic/elasticsearch/commit/9573492a9ee7dc7c5f184e6be854ddc0d82608d8 to fix this failure after seeing https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=ubuntu&&virtual/2397/console fail earlier today.\r\n\r\nWith the added debug logging we never see any authentication attempts on node-1. However, upon further review the last log line reveals an issue:\r\n\r\n[2018-05-03T13:19:02,645][INFO ][o.e.l.LicenseService     ] [node-1] license [898943ad-c458-4728-b883-6e4c83e8a073] mode [basic] - valid\r\n\r\nThe license doesn't enable authentication/authorization, which may take effect while the request is in flight and we throw an exception from security that results in a 401. In this case, the request has made it into the AuthenticationService prior to the license change to basic. The license changes to basic and then we try to iterate over the realms (either for token extraction or authentication). Since the license does not enable authentication, the realms iterator is empty so authentication fails and the 401 is returned.","performed_via_github_app":null}]