{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21236","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21236/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21236/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21236/events","html_url":"https://github.com/elastic/elasticsearch/issues/21236","id":186532810,"node_id":"MDU6SXNzdWUxODY1MzI4MTA=","number":21236,"title":"Postings Highlight not working with boost and fuzziness in query_string","user":{"login":"kirduk","id":219283,"node_id":"MDQ6VXNlcjIxOTI4Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/219283?v=4","gravatar_id":"","url":"https://api.github.com/users/kirduk","html_url":"https://github.com/kirduk","followers_url":"https://api.github.com/users/kirduk/followers","following_url":"https://api.github.com/users/kirduk/following{/other_user}","gists_url":"https://api.github.com/users/kirduk/gists{/gist_id}","starred_url":"https://api.github.com/users/kirduk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kirduk/subscriptions","organizations_url":"https://api.github.com/users/kirduk/orgs","repos_url":"https://api.github.com/users/kirduk/repos","events_url":"https://api.github.com/users/kirduk/events{/privacy}","received_events_url":"https://api.github.com/users/kirduk/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-11-01T13:24:44Z","updated_at":"2017-07-26T08:24:50Z","closed_at":"2017-07-26T08:24:50Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.4\r\n**Plugins installed:** [head, hq]\r\n**JVM version**: Java HotSpot(TM) 64-Bit Server VM (build 25.101-b13, mixed mode)\r\n**OS version**: CentOS Linux release 7.1.1503 (Core)\r\n\r\nHello,\r\n\r\nI am using query_string with postings highlight which is not working in case when token marked with fuzinnes and boost (`red~1^0.5 OR blue^0.5~1`).\r\n\r\n_**Steps to reproduce:**_\r\n\r\n**Create index:**\r\n```\r\n{\r\n\t\"mappings\": {\r\n\t\t\"type1\": {\r\n\t\t\t\"properties\": {\r\n\t\t\t\t\"colours\": {\r\n\t\t\t\t\t\"type\": \"string\",\r\n\t\t\t\t\t\"index_options\": \"offsets\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\n**Add data:**\r\n```\r\n{\r\n\t\"colours\": \"red blue green black white\"\r\n}\r\n```\r\n\r\n**Search:**\r\n```\r\n{\r\n\t\"query\": {\r\n\t\t\"bool\": {\r\n\t\t\t\"must\": {\r\n\t\t\t\t\"query_string\": {\r\n\t\t\t\t\t\"query\": \"red~1^0.5 OR blue^0.5~1 OR green~1 OR black^0.5 OR white~\",\r\n\t\t\t\t\t\"default_field\": \"colours\",\r\n\t\t\t\t\t\"fuzziness\": \"2\",\r\n\t\t\t\t\t\"minimum_should_match\": \"2\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\"highlight\": {\r\n\t\t\"require_field_match\": true,\r\n\t\t\"fields\": {\r\n\t\t\t\"colours\": {\r\n\t\t\t\t\"type\": \"postings\",\r\n\t\t\t\t\"number_of_fragments\": 30\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\n**Result:**\r\n\r\n```\r\n{\r\n\t\"took\": 8,\r\n\t\"timed_out\": false,\r\n\t\"_shards\": {\r\n\t\t\"total\": 5,\r\n\t\t\"successful\": 5,\r\n\t\t\"failed\": 0\r\n\t},\r\n\t\"hits\": {\r\n\t\t\"total\": 1,\r\n\t\t\"max_score\": 0.2833413,\r\n\t\t\"hits\": [\r\n\t\t\t{\r\n\t\t\t\t\"_index\": \"test\",\r\n\t\t\t\t\"_type\": \"type1\",\r\n\t\t\t\t\"_id\": \"AVggCfbJyjombHmjJimj\",\r\n\t\t\t\t\"_score\": 0.2833413,\r\n\t\t\t\t\"_source\": {\r\n\t\t\t\t\t\"colours\": \"red blue green black white\"\r\n\t\t\t\t},\r\n\t\t\t\t\"highlight\": {\r\n\t\t\t\t\t\"colours\": [\r\n\t\t\t\t\t\t\"red blue <em>green</em> <em>black</em> <em>white</em>\"\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n}\r\n```\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}