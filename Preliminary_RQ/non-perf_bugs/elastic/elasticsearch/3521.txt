{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3521","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3521/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3521/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3521/events","html_url":"https://github.com/elastic/elasticsearch/issues/3521","id":18152219,"node_id":"MDU6SXNzdWUxODE1MjIxOQ==","number":3521,"title":"odd scoring behaviour / inconsistent scoring","user":{"login":"lmenezes","id":750074,"node_id":"MDQ6VXNlcjc1MDA3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/750074?v=4","gravatar_id":"","url":"https://api.github.com/users/lmenezes","html_url":"https://github.com/lmenezes","followers_url":"https://api.github.com/users/lmenezes/followers","following_url":"https://api.github.com/users/lmenezes/following{/other_user}","gists_url":"https://api.github.com/users/lmenezes/gists{/gist_id}","starred_url":"https://api.github.com/users/lmenezes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lmenezes/subscriptions","organizations_url":"https://api.github.com/users/lmenezes/orgs","repos_url":"https://api.github.com/users/lmenezes/repos","events_url":"https://api.github.com/users/lmenezes/events{/privacy}","received_events_url":"https://api.github.com/users/lmenezes/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":51048736,"node_id":"MDU6TGFiZWw1MTA0ODczNg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.4","name":"v0.90.4","color":"DDDDDD","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":11,"created_at":"2013-08-16T11:31:39Z","updated_at":"2013-08-17T13:03:55Z","closed_at":"2013-08-16T19:18:52Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"unfortunately i wasn't able to reproduce this in the usual way, but here is the case:\n\nI have a query such as \n\n```\n{ \"from\": 0, \"size\": 10, \"query\": { \"bool\": {  \"must\": [ {\"match_all\":{}},{ \"constant_score\": { \"filter\": { \"terms\": { \"id\": [...] } } } } ] } }, \"fields\": \"\", \"sort\": [ { \"_score\": {} }, { \"id\": { \"order\": \"desc\" } } ] }\n```\n\nto the terms filter, i pass a list of ids(anywhere between 1 and 200k unique ids).\n\nwhen executing this query multiple times i get different results. so, investigating a little i traced it to the score not being constant sometimes(not what i expected at all).\n\ni ran the same query a few times with explain set to true and getting only the last document, and here is what i got:\n\n```\n_explanation: {\nvalue: 1.264911\ndescription: sum of:\ndetails: [\n{\nvalue: 0.94868326\ndescription: ConstantScore(*:*)^3.0, product of:\ndetails: [\n{\nvalue: 3\ndescription: boost\n}\n{\nvalue: 0.31622776\ndescription: queryNorm\n}\n]\n}\n{\nvalue: 0.31622776\ndescription: ConstantScore...\n```\n\nand then \n\n```\n_explanation: {\nvalue: 1.4142135\ndescription: sum of:\ndetails: [\n{\nvalue: 0.70710677\ndescription: ConstantScore(*:*), product of:\ndetails: [\n{\nvalue: 1\ndescription: boost\n}\n{\nvalue: 0.70710677\ndescription: queryNorm\n}\n]\n}\n{\nvalue: 0.70710677\ndescription: ConstantScore...\n```\n\nso, here i would expect this query to ALWAYS have the same score, and also, that every document scores exactly the same. \nit could even seem ok if the score wasnt constant across requests, but not really that documents score differently.\n- i do know i don't need the \"match_all\" query, but that's the way i managed to reproduce it on our cluster. without that, the score for the documents would always be 1 and i could not reproduce this behaviour.\n\n*\\* hope thats clear enough... but let me know if you need more info, or even the complete output for the explain(its pretty big)\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}