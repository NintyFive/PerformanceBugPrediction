[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471667832","html_url":"https://github.com/elastic/elasticsearch/issues/39933#issuecomment-471667832","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39933","id":471667832,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTY2NzgzMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T18:38:00Z","updated_at":"2019-03-11T18:38:00Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471708712","html_url":"https://github.com/elastic/elasticsearch/issues/39933#issuecomment-471708712","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39933","id":471708712,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTcwODcxMg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T20:14:00Z","updated_at":"2019-03-11T20:14:00Z","author_association":"CONTRIBUTOR","body":"I think the bug here is that a restoring index is no longer appearing in `_cat/indices`. @albertzaharovits this looks related to #38824, and in particular the following line https://github.com/elastic/elasticsearch/pull/38824/files#diff-bfeab4b634ba416b081c4d23a01b1fc8R413 where indices with missing index stats are removed from the output. If multiple indices are restored from a snapshot, it's possible that for some indices none of the primary shards are assigned (as we throttle the number of simultaneously recovering shards). If none of the shards of an index are assigned, that index will not turn up in the indices stats, and the above change will therefore filter it out.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471709052","html_url":"https://github.com/elastic/elasticsearch/issues/39933#issuecomment-471709052","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39933","id":471709052,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTcwOTA1Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T20:14:34Z","updated_at":"2019-03-11T20:14:34Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471725108","html_url":"https://github.com/elastic/elasticsearch/issues/39933#issuecomment-471725108","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39933","id":471725108,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTcyNTEwOA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T20:52:41Z","updated_at":"2019-03-11T20:52:41Z","author_association":"CONTRIBUTOR","body":"@ywelsch I think you're right. The change introducing this bug hides indices for which the indices stats API returns empty. From what I understand, indices in the process of being restored also don't appear in the indices stats response.\r\n\r\nThe simple fix, i.e. to include such indices from the cluster state, will expose names that the user is not authorized to see.\r\nI will mull over it, but my guts feeling for a solution would be to expose these in some API (not reading them from cluster state). Would it make sense to expose them in the indices stats output? I realize this is not exactly the scope of the indices stats API, but given the similarity of the outputs between *indices stats* and *_cat/indices* failing to show them in the former compared to the latter might be seen like a bug as well.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471933858","html_url":"https://github.com/elastic/elasticsearch/issues/39933#issuecomment-471933858","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39933","id":471933858,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTkzMzg1OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-03-12T10:01:06Z","updated_at":"2019-03-12T10:01:06Z","author_association":"CONTRIBUTOR","body":"> given the similarity of the outputs between indices stats and _cat/indices failing to show them in the former compared to the latter might be seen like a bug as well\r\n\r\nI agree that that is confusing. If we want to address that, then it becomes a much larger discussion though.\r\n\r\nI wonder if we can instead use a `GetIndexRequest` instead of a `ClusterStateRequest` to get the list of indices to consider for the output","performed_via_github_app":null}]