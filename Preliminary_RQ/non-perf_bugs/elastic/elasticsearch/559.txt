{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/559","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/559/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/559/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/559/events","html_url":"https://github.com/elastic/elasticsearch/issues/559","id":466311,"node_id":"MDU6SXNzdWU0NjYzMTE=","number":559,"title":"Geo search fails to find some docs when wrapping over IDL","user":{"login":"andreiz","id":40809,"node_id":"MDQ6VXNlcjQwODA5","avatar_url":"https://avatars0.githubusercontent.com/u/40809?v=4","gravatar_id":"","url":"https://api.github.com/users/andreiz","html_url":"https://github.com/andreiz","followers_url":"https://api.github.com/users/andreiz/followers","following_url":"https://api.github.com/users/andreiz/following{/other_user}","gists_url":"https://api.github.com/users/andreiz/gists{/gist_id}","starred_url":"https://api.github.com/users/andreiz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreiz/subscriptions","organizations_url":"https://api.github.com/users/andreiz/orgs","repos_url":"https://api.github.com/users/andreiz/repos","events_url":"https://api.github.com/users/andreiz/events{/privacy}","received_events_url":"https://api.github.com/users/andreiz/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":58413,"node_id":"MDU6TGFiZWw1ODQxMw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.14.0","name":"v0.14.0","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2010-12-09T23:46:33Z","updated_at":"2010-12-10T06:39:28Z","closed_at":"2010-12-10T06:39:28Z","author_association":"NONE","active_lock_reason":null,"body":"It seems that the geo_bounding_box query fails to find some documents when the box crosses over the IDL (international date line). To reproduce (in 0.13.1):\n\n```\ncurl -XPUT 'http://localhost:9200/test' -d'{ index : { number_of_shards : 1, number_of_replicas : 0 } }';\n\ncurl -XPUT 'http://localhost:9200/test/place/_mapping' -d'\n{\n    \"place\" : {\n        \"_all\" : {\"enabled\" : false},\n        \"properties\" : {\n            \"user_id\" : {\"type\" : \"integer\", \"index\" : \"not_analyzed\"},\n            \"title\" : {\"type\" : \"string\", \"boost\" : 1.5, \"analyzer\" : \"eulang\"},\n            \"notes\" : {\"type\" : \"string\", \"analyzer\" : \"eulang\"},\n            \"tags\" : {\"type\" : \"string\", \"index_name\" : \"tag\", \"boost\" : 1.5, \"analyzer\" : \"eulang\"},\n            \"created_on\" : {\"type\" : \"date\", \"format\" : \"YYYY-MM-DD HH:mm:ss\"},\n            \"geo\" : {\"type\" : \"geo_point\"},\n            \"privacy\" : {\"type\" : \"integer\", \"index\" : \"not_analyzed\"}\n        }\n    }\n}'\n\ncurl http://localhost:9200/test/place/10 -d'{\"user_id\": 880, \"privacy\": 2000, \"notes\": \"\", \"tags\": [], \"created_on\": \"2010-12-09 08:05:17\", \"title\": \"Place in Stockholm\", \"geo\": {\"lat\": 59.328355000000002, \"lon\": 18.036842}}';\n\ncurl http://localhost:9200/test/place/20 -d'{\"user_id\": 534, \"privacy\": 2000, \"notes\": \"\", \"tags\": [], \"created_on\": \"2010-11-26 10:22:38\", \"title\": \"Place in Montréal\", \"geo\": {\"lat\": 45.509526999999999, \"lon\": -73.570986000000005}}';\n```\n\nThis fails to find the doc titled \"Place in Stockholm\":\n\n```\ncurl 'http://localhost:9200/test/_search' -d'\n{\n    \"query\": {\n        \"filtered\": {\n            \"filter\": {\n                \"and\": [\n                    {\n                        \"term\": {\n                            \"user_id\": 880\n                        }\n                    },\n                    {\n                        \"geo_bounding_box\": {\n                            \"geo\": {         \n                                \"bottom_right\": {\n                                    \"lat\": -66.668903999999998, \n                                    \"lon\": 113.96875            \n                                },                              \n                                \"top_left\": {                   \n                                    \"lat\": 74.579421999999994,  \n                                    \"lon\": 143.5                \n                                }                               \n                            }                                   \n                        }                                       \n                    }                                          \n                ]                                              \n            },\n            \"query\": {\n                \"match_all\": {}\n            }\n        }\n    }\n}'\n{\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"hits\":{\"total\":0,\"max_score\":null,\"hits\":[]}}\n```\n\nBut this does find the place title \"Place in Montréal\":\n\n```\ncurl 'http://localhost:9200/test/_search' -d'\n{\n    \"query\": {\n        \"filtered\": {\n            \"filter\": {\n                \"and\": [\n                    {\n                        \"term\": {\n                            \"user_id\": 534\n                        }\n                    },\n                    {\n                        \"geo_bounding_box\": {\n                            \"geo\": {\n                                \"bottom_right\": {\n                                    \"lat\": -66.668903999999998,\n                                    \"lon\": 113.96875\n                                },\n                                \"top_left\": {\n                                    \"lat\": 74.579421999999994,\n                                    \"lon\": 143.5\n                                }\n                            }\n                        }\n                    }\n                ]\n            },\n            \"query\": {\n                \"match_all\": {}\n            }\n        }\n    }\n}'\n{\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"hits\" {\"total\":1,\"max_score\":1.0,\"hits\":[{\"_index\":\"test\",\"_type\":\"place\",\"_id\":\"20\",\"_score\":1.0, \"_source\" : {\"user_id\": 534, \"privacy\": 2000, \"notes\": \"\", \"tags\": [], \"created_on\": \"2010-11-26 10:22:38\", \"title\": \"Place in Montréal\", \"geo\": {\"lat\": 45.509526999999999, \"lon\": -73.570986000000005}}}]}}\n```\n\nBoth of those places fall within the bounding box, though.\n","closed_by":null,"performed_via_github_app":null}