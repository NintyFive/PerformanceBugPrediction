{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9788","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9788/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9788/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9788/events","html_url":"https://github.com/elastic/elasticsearch/issues/9788","id":58356259,"node_id":"MDU6SXNzdWU1ODM1NjI1OQ==","number":9788,"title":"ElasticSearch analyzer not working with nested query","user":{"login":"cgurjar","id":5134957,"node_id":"MDQ6VXNlcjUxMzQ5NTc=","avatar_url":"https://avatars0.githubusercontent.com/u/5134957?v=4","gravatar_id":"","url":"https://api.github.com/users/cgurjar","html_url":"https://github.com/cgurjar","followers_url":"https://api.github.com/users/cgurjar/followers","following_url":"https://api.github.com/users/cgurjar/following{/other_user}","gists_url":"https://api.github.com/users/cgurjar/gists{/gist_id}","starred_url":"https://api.github.com/users/cgurjar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgurjar/subscriptions","organizations_url":"https://api.github.com/users/cgurjar/orgs","repos_url":"https://api.github.com/users/cgurjar/repos","events_url":"https://api.github.com/users/cgurjar/events{/privacy}","received_events_url":"https://api.github.com/users/cgurjar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-02-20T13:59:20Z","updated_at":"2015-03-01T05:38:06Z","closed_at":"2015-02-27T23:53:09Z","author_association":"NONE","active_lock_reason":null,"body":"I have created an index with the following mapping\n\n```\nPUT test1\n{\n  \"mappings\": {\n    \"searchText\": {\n      \"properties\": {\n        \"catalogue_product\": {\n          \"type\": \"nested\",\n          \"properties\": {\n            \"id\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"long_desc\": {\n              \"type\": \"nested\",\n              \"properties\": {\n                \"translation\": {\n                  \"type\": \"nested\",\n                  \"properties\": {\n                    \"en-GB\": {\n                      \"type\": \"string\",\n                      \"anlayzer\": \"snowball\"\n                    },\n                    \"fr-FR\": {\n                      \"type\": \"string\",\n                      \"anlayzer\": \"snowball\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nI have put one record using\n\n```\nPUT /test1/searchText/1\n{\n  \"catalogue_product\": {\n    \"id\": \"18437\",\n    \"long_desc\": {\n      \"translation\": {\n        \"en-GB\": \"C120 - circuit breaker - C120H - 4P - 125A - B curve\",\n        \"fr-FR\": \"Disjoncteur C120H 4P 125A courbe B 15000A\"\n      }\n    }\n  }\n}\n```\n\nThen if i do a search for the word\n\"breaker\"\ninside\n\n\"catalogue_product.long_desc.translation.en-GB\"\nI get the added record\n\n```\nPOST /test1/searchText/_search\n{\n  \"query\": {\n    \"nested\": {\n      \"path\": \"catalogue_product.long_desc.translation\",\n      \"query\": {\n        \"match\": {\n          \"catalogue_product.long_desc.translation.en-GB\": \"breaker\"\n        }\n      }\n    }\n  }\n}\n```\n\nif replace the word\n\n\"breaker\"\nwith\n\n\"breakers\"\n, I dont get any records in spite of the en-GB field having analyzer=snowball in the mapping\n\n```\nPOST /test1/searchText/_search\n{\n  \"query\": {\n    \"nested\": {\n      \"path\": \"catalogue_product.long_desc.translation\",\n      \"query\": {\n        \"match\": {\n          \"catalogue_product.long_desc.translation.en-GB\": \"breakers\"\n        }\n      }\n    }\n  }\n}\n```\n\nI am going crazy with this. Where am I going wrong? I tried a new mapping with analyzer as english instead of snowball, but that did not work either :( Any help is appreciated\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}