{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19878","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19878/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19878/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19878/events","html_url":"https://github.com/elastic/elasticsearch/issues/19878","id":170014666,"node_id":"MDU6SXNzdWUxNzAwMTQ2NjY=","number":19878,"title":"ClusterSettings causes many unwanted class initializers to run","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-08-08T20:15:31Z","updated_at":"2018-03-14T08:08:40Z","closed_at":"2018-03-14T08:08:40Z","author_association":"MEMBER","active_lock_reason":null,"body":"All built-in cluster settings are registered in `ClusterSettings`. Since the settings that are registered there usually live in a service class, the moment that `ClusterSettings` is initialized, the class initializers for all these classes run. We have had problems in the past with class initializers running at unexpected times, and we have had situations like the `NettyUtils` class initializer that we had to take extra care to ensure that initialization was not performed until after the security manager was installed lest we end up unknowingly opening the door to unsafe / native code (after the Netty modularization, this is no longer an issue, but it's used to explain the sorts of issues that can arise).\n\nI do not think that we should do this. I think that the settings objects should be moved to dedicated settings classes (e.g., [BootstrapSettings](https://github.com/elastic/elasticsearch/blob/f547886a9b3cd50911ae518da3c327d7a32ad0b0/core/src/main/java/org/elasticsearch/bootstrap/BootstrapSettings.java)) so we can avoid having to reason about these complicated class initialization issues.\n\nI'm marking this as a [Meta](https://github.com/elastic/elasticsearch/labels/Meta) issue, it's too big to pull off in one PR and instead should be done in lots of little PRs.\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}