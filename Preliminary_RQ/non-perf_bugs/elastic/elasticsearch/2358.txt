{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2358","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2358/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2358/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2358/events","html_url":"https://github.com/elastic/elasticsearch/issues/2358","id":7845622,"node_id":"MDU6SXNzdWU3ODQ1NjIy","number":2358,"title":"geo_shape \"contains\" relation is backwards - should be \"within\"","user":{"login":"IamJeffG","id":2002703,"node_id":"MDQ6VXNlcjIwMDI3MDM=","avatar_url":"https://avatars1.githubusercontent.com/u/2002703?v=4","gravatar_id":"","url":"https://api.github.com/users/IamJeffG","html_url":"https://github.com/IamJeffG","followers_url":"https://api.github.com/users/IamJeffG/followers","following_url":"https://api.github.com/users/IamJeffG/following{/other_user}","gists_url":"https://api.github.com/users/IamJeffG/gists{/gist_id}","starred_url":"https://api.github.com/users/IamJeffG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IamJeffG/subscriptions","organizations_url":"https://api.github.com/users/IamJeffG/orgs","repos_url":"https://api.github.com/users/IamJeffG/repos","events_url":"https://api.github.com/users/IamJeffG/events{/privacy}","received_events_url":"https://api.github.com/users/IamJeffG/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"assignees":[{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2012-10-25T00:05:10Z","updated_at":"2018-10-15T03:54:34Z","closed_at":"2015-12-11T23:15:57Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I don't want to bikeshed, but I believe the \"contains\" relation in geo_shape queries and filters does the opposite of what \"contains\" means in GIS circles.  Rather, the relation actually performs a \"within\".\n\nThe confusion comes from the fact that the DSL is not explicit about how the query/filter should be read.  Compare:\n- \"Give me all results where the indexed document's shape contains this filter shape.\"\n- \"Give me all results where this filter shape contains the indexed document's shape.\"\n\nThe Elasticsearch DSL does have some precedent for the ordering, specifically that they should be read as in the first ordering (indexed documents are the subject, query terms are the sentence's object).  For example, the \"has_child\" filter's behavior \"Gives all results where the indexed (parent) document has_(a)_child matching the query.\"\n\nObserve that the commonly accepted spatial relation semantics (e.g. http://en.wikipedia.org/wiki/DE-9IM) assert that \"A contains B\" is equivalent to \"B within A\".\n\nFor the Elasticsearch DSL to be both self-consistent and correct, the [currently implemented behavior](http://www.elasticsearch.org/guide/reference/query-dsl/geo-shape-filter.html)\n\n> Finds those indexed shapes which are fully contained within the filter shape. Any shapes will additional area outside of the filter shape are excluded.\n\nshould instead be named \"within\".  In fact, you used the word \"within\" to define the \"contains\" relationship.  The relationship you describe is indeed \"within\".\n\nBy contrast, a true \"contains\" relationship would have been defined like so:\n\n> contains â€“ Finds those indexed shapes that contain the filter shape.  The filter shape will not contain any points outside the shapes returned.\n\nIt would be great to rename this predicate now while 0.20 is brand new and you've still listed it as \"experimental\", before the wrong semantics catch on and confusion begins.\n","closed_by":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"performed_via_github_app":null}