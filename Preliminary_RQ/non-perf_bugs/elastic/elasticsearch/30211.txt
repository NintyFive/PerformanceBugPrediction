{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30211","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30211/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30211/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30211/events","html_url":"https://github.com/elastic/elasticsearch/issues/30211","id":318479730,"node_id":"MDU6SXNzdWUzMTg0Nzk3MzA=","number":30211,"title":"Strict Type Checking on Import (or strict type usage for scripts)","user":{"login":"OlivierPetri","id":38720194,"node_id":"MDQ6VXNlcjM4NzIwMTk0","avatar_url":"https://avatars2.githubusercontent.com/u/38720194?v=4","gravatar_id":"","url":"https://api.github.com/users/OlivierPetri","html_url":"https://github.com/OlivierPetri","followers_url":"https://api.github.com/users/OlivierPetri/followers","following_url":"https://api.github.com/users/OlivierPetri/following{/other_user}","gists_url":"https://api.github.com/users/OlivierPetri/gists{/gist_id}","starred_url":"https://api.github.com/users/OlivierPetri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OlivierPetri/subscriptions","organizations_url":"https://api.github.com/users/OlivierPetri/orgs","repos_url":"https://api.github.com/users/OlivierPetri/repos","events_url":"https://api.github.com/users/OlivierPetri/events{/privacy}","received_events_url":"https://api.github.com/users/OlivierPetri/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"assignees":[{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2018-04-27T16:53:35Z","updated_at":"2018-05-02T17:17:46Z","closed_at":"2018-05-02T17:17:46Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\nCurrently ES will check the _format_ of input data against the field type, but it does not stick to the specified type when supplying field content to scripts (see example below). \r\n\r\nThis leads to confusing results and hard to track bugs in client applications.\r\n\r\nDesired feature:\r\nImplement different level of type checking:\r\nSTRICT : Do not accept \"123\" for numeric input, only 123.\r\nBEST_EFFORT: Convert \"123\" to 123 (desired default behaviour).\r\nLEGACY: Current behaviour.\r\n\r\nAlternatively controle (and cast!) document fields when handed to scripts (see below).\r\n\r\n## Example for current behaviour.\r\nGiven the following mapping:\r\n\r\n```\r\nPUT sumtest\r\n{\r\n\t\"mappings\" : {\r\n\t\"doc\" : {\r\n\t\"properties\" : {\r\n\t\t\"NRA\" : { \"type\" : \"integer\" },\r\n\t\t\"NRB\" : { \"type\" : \"integer\" }\r\n\t}\r\n\t}\r\n\t}\r\n}\r\n```\r\n\r\nand the following input\r\n\r\nPUT sumtest/doc/1\r\n{\r\n\t\"NRA\" : 12,\r\n\t\"NRB\" : 34\r\n}\r\n\r\nPUT sumtest/doc/2\r\n{\r\n\t\"NRA\" : \"12\",\r\n\t\"NRB\" : \"34\"\r\n}\r\n\r\nThe script expression \r\n`doc['NRA'] + doc['NRB']`\r\nwill return 46 for item 1 and \"1234\" for item 2. The second result ist quite surprising for unsuspecting users.\r\n\r\nThe expression\r\n`ctx._source.NRA + ctx._source.NRB`\r\nyields the same result.","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}