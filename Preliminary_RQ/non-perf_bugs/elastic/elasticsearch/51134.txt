{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51134","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51134/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51134/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51134/events","html_url":"https://github.com/elastic/elasticsearch/issues/51134","id":551198297,"node_id":"MDU6SXNzdWU1NTExOTgyOTc=","number":51134,"title":"Problem: \"unable to create new native thread\" and es can not survive several second after start","user":{"login":"wuyudian1","id":10414890,"node_id":"MDQ6VXNlcjEwNDE0ODkw","avatar_url":"https://avatars3.githubusercontent.com/u/10414890?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyudian1","html_url":"https://github.com/wuyudian1","followers_url":"https://api.github.com/users/wuyudian1/followers","following_url":"https://api.github.com/users/wuyudian1/following{/other_user}","gists_url":"https://api.github.com/users/wuyudian1/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyudian1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyudian1/subscriptions","organizations_url":"https://api.github.com/users/wuyudian1/orgs","repos_url":"https://api.github.com/users/wuyudian1/repos","events_url":"https://api.github.com/users/wuyudian1/events{/privacy}","received_events_url":"https://api.github.com/users/wuyudian1/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-01-17T04:53:46Z","updated_at":"2020-01-21T10:07:03Z","closed_at":"2020-01-21T10:07:02Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\nProblem: \"unable to create new native thread\" and es can not survive several second after start\r\n\r\n**Elasticsearch version** :\r\n```\r\nVersion: 6.3.1, Build: default/zip/eb782d0/2018-06-29T21:59:26.107521Z, JVM: 1.8.0_191\r\n```\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\n```\r\njava version \"1.8.0_191\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_191-b12)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)\r\n```\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n```\r\nLinux prod-ofc-s-ops-001 4.4.0-170-generic #199-Ubuntu SMP Thu Nov 14 01:45:04 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n**jvm.options**\r\n```ini\r\n-Xms32g\r\n-Xmx32g\r\n-XX:+UseConcMarkSweepGC\r\n-XX:CMSInitiatingOccupancyFraction=75\r\n-XX:+UseCMSInitiatingOccupancyOnly\r\n-XX:+AlwaysPreTouch\r\n-Xss1m\r\n-Djava.awt.headless=true\r\n-Dfile.encoding=UTF-8\r\n-Djna.nosys=true\r\n-XX:-OmitStackTraceInFastThrow\r\n-Dio.netty.noUnsafe=true\r\n-Dio.netty.noKeySetOptimization=true\r\n-Dio.netty.recycler.maxCapacityPerThread=0\r\n-Dlog4j.shutdownHookEnabled=false\r\n-Dlog4j2.disable.jmx=true\r\n-Djava.io.tmpdir=${ES_TMPDIR}\r\n-XX:+HeapDumpOnOutOfMemoryError\r\n-XX:HeapDumpPath=data\r\n-XX:ErrorFile=logs/hs_err_pid%p.log\r\n8:-XX:+PrintGCDetails\r\n8:-XX:+PrintGCDateStamps\r\n8:-XX:+PrintTenuringDistribution\r\n8:-XX:+PrintGCApplicationStoppedTime\r\n8:-Xloggc:logs/gc.log\r\n8:-XX:+UseGCLogFileRotation\r\n8:-XX:NumberOfGCLogFiles=32\r\n8:-XX:GCLogFileSize=64m\r\n9-:-Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m\r\n9-:-Djava.locale.providers=COMPAT\r\n```\r\n**elasticsearch.yml**\r\n```yml\r\ncluster.name: xxxx\r\ndiscovery.zen.minimum_master_nodes: 1\r\ndiscovery.zen.ping.unicast.hosts: ['10.45.0.33']\r\nnode.name: prod-ofc-s-ops-001\r\nnode.master: true\r\nnetwork.host: 0.0.0.0\r\ntransport.tcp.port: 9300\r\nhttp.port: 9200\r\npath.data: /data/es/data\r\n```\r\n**ubuntu$ ulimit -a**\r\n```bash\r\ncore file size          (blocks, -c) unlimited\r\ndata seg size           (kbytes, -d) unlimited\r\nscheduling priority             (-e) 0\r\nfile size               (blocks, -f) unlimited\r\npending signals                 (-i) 321537\r\nmax locked memory       (kbytes, -l) 64\r\nmax memory size         (kbytes, -m) unlimited\r\nopen files                      (-n) 1000000\r\npipe size            (512 bytes, -p) 8\r\nPOSIX message queues     (bytes, -q) 819200\r\nreal-time priority              (-r) 0\r\nstack size              (kbytes, -s) 8192\r\ncpu time               (seconds, -t) unlimited\r\nmax user processes              (-u) unlimited\r\nvirtual memory          (kbytes, -v) unlimited\r\nfile locks                      (-x) unlimited\r\n```\r\n**pstree -p|wc -l**\r\n```\r\n13258\r\n```\r\n**cat /proc/sys/kernel/pid_max**\r\n```\r\n1000000\r\n```\r\n\r\n**Steps to reproduce**:\r\nI don't how to reproduce it in another server, because there are more than 800 indices in my esã€‚\r\nI think it's very hard to reproduce.\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n...\r\n[2020-01-17T12:34:29,594][INFO ][o.e.m.j.JvmGcMonitorService] [prod-ofc-s-ops-001] [gc][143] overhead, spent [279ms] collecting in the last [1s]\r\n[2020-01-17T12:35:00,561][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [prod-ofc-s-ops-001] fatal error in thread [elasticsearch[prod-ofc-s-ops-001][write][T#28]], exiting\r\njava.lang.OutOfMemoryError: unable to create new native thread\r\n        at java.lang.Thread.start0(Native Method) ~[?:1.8.0_191]\r\n        at java.lang.Thread.start(Thread.java:717) ~[?:1.8.0_191]\r\n        at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:957) ~[?:1.8.0_191]\r\n        at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:1025) ~[?:1.8.0_191]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167) ~[?:1.8.0_191]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_191]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_191]\r\n```\r\n","closed_by":{"login":"andreidan","id":1217601,"node_id":"MDQ6VXNlcjEyMTc2MDE=","avatar_url":"https://avatars2.githubusercontent.com/u/1217601?v=4","gravatar_id":"","url":"https://api.github.com/users/andreidan","html_url":"https://github.com/andreidan","followers_url":"https://api.github.com/users/andreidan/followers","following_url":"https://api.github.com/users/andreidan/following{/other_user}","gists_url":"https://api.github.com/users/andreidan/gists{/gist_id}","starred_url":"https://api.github.com/users/andreidan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreidan/subscriptions","organizations_url":"https://api.github.com/users/andreidan/orgs","repos_url":"https://api.github.com/users/andreidan/repos","events_url":"https://api.github.com/users/andreidan/events{/privacy}","received_events_url":"https://api.github.com/users/andreidan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}