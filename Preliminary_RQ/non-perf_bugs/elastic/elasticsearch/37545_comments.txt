[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/454857931","html_url":"https://github.com/elastic/elasticsearch/issues/37545#issuecomment-454857931","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37545","id":454857931,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDg1NzkzMQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-01-16T17:03:46Z","updated_at":"2019-01-16T17:03:46Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/454858168","html_url":"https://github.com/elastic/elasticsearch/issues/37545#issuecomment-454858168","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37545","id":454858168,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDg1ODE2OA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-01-16T17:04:28Z","updated_at":"2019-01-16T17:04:28Z","author_association":"MEMBER","body":"Note: this might be related to https://github.com/elastic/elasticsearch/issues/30300, since various tests resort to force-killing jobs when they are in `FAILED` status.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/454895119","html_url":"https://github.com/elastic/elasticsearch/issues/37545#issuecomment-454895119","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37545","id":454895119,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDg5NTExOQ==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-01-16T18:49:39Z","updated_at":"2019-01-16T18:49:39Z","author_association":"MEMBER","body":"https://github.com/elastic/elasticsearch/pull/32615/files\r\n\r\nThat PR addressed a bug we had a while back around the temp dir being cleaned up by the OS, the error of the file not being created is similar. \r\n\r\nI would have thought that these tests would have the fix...I am reaching out to others who would know more. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/455141330","html_url":"https://github.com/elastic/elasticsearch/issues/37545#issuecomment-455141330","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37545","id":455141330,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTE0MTMzMA==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2019-01-17T11:36:01Z","updated_at":"2019-01-17T11:36:01Z","author_association":"MEMBER","body":"> 09:52:23 [2019-01-16T14:45:06,927][WARN ][r.suppressed ] [node-0] path: /_xpack/ml/anomaly_detectors/_all/_close, params: {job_id=_all, force=true}\r\n09:52:23 org.elasticsearch.ElasticsearchException: Failed to force close job [_all] with [1] failures, rethrowing last, all Exceptions: [the task with id job-post-data-job doesn't exist]\r\n\r\nThis is because of the change to move the ml config out of the cluster state. Previously a job not found error was returned but now it is difficult to check the job's existence in the transport action. The problem is described in #34747\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/455237072","html_url":"https://github.com/elastic/elasticsearch/issues/37545#issuecomment-455237072","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37545","id":455237072,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTIzNzA3Mg==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-01-17T16:29:56Z","updated_at":"2019-01-17T16:29:56Z","author_association":"CONTRIBUTOR","body":"> That PR addressed a bug we had a while back around the temp dir being cleaned up by the OS, the error of the file not being created is similar.\r\n\r\nThe error message is the same but the cause of the problem is almost certainly different.  A huge number of tests running in GCP failed yesterday due to the extreme slowness of the VMs.  We expect the named pipes to open within 10 seconds of requesting the `controller` start the `autodetect` process.  I suspect yesterday whatever was causing the slowness in GCP meant this didn't happen.\r\n\r\nThe problem that #32615 was working around was sub-directories of the `/tmp` directory getting deleted by `systemd` after 10 days - the tests are slow but not _that_ slow.\r\n\r\n> Previously a job not found error was returned but now it is difficult to check the job's existence in the transport action. The problem is described in #34747\r\n\r\n#34747 is describing the problem with error reporting, but it seems to me that there's a more fundamental issue here that `_all` can now suffer \"job does not exist\" errors.  Whether they're reported as \"job does not exist\" or \"job is not open\" is of secondary importance to the fact that it seems crazy from a user perspective that `_all` would ever include something that didn't exist.\r\n\r\nNow that evaluation of `_all` means doing a search I guess there's a danger that something that search finds gets deleted before the endpoint gets a chance to operate on the expansion of `_all`.  So we should probably change the error handling of endpoints that can work on `_all` to silently ignore errors due to items not existing by the time the main function runs.\r\n\r\n> And finally, a bunch of these tests start to stall right when the autodetect process throws those errors\r\n\r\nIt looks like the other ML tests in the list failed for the same reason as the test that's analyzed in detail - `autodetect` didn't create its named pipes within 10 seconds.  The 10 second wait for named pipes explains why they took over 10 seconds.  (On a machine that performs sensibly it should only take a few milliseconds.)\r\n\r\nThe security and watcher ones seem to have just taken that long unrelated to ML.  When I saw the list I initially thought ML had left a hung task behind that the `waitForPendingTasks` cleanup was waiting on, but looking at the log more closely the time seems to have been spent inside the test:\r\n\r\n```\r\n  1> [2019-01-16T08:44:02,928][INFO ][o.e.x.t.r.XPackRestIT    ] [test] [p0=token/10_basic/Test invalidate token] before test\r\n  1> [2019-01-16T08:44:18,174][INFO ][o.e.x.t.r.XPackRestIT    ] [test] [p0=token/10_basic/Test invalidate token] after test\r\n```\r\n\r\nand:\r\n\r\n```\r\n  1> [2019-01-16T08:47:00,127][INFO ][o.e.x.t.r.XPackRestIT    ] [test] [p0=watcher/ack_watch/40_reset_ack_after_unmet_action_condition/Ensure that ack status is reset after unmet action condition] before test\r\n  1> [2019-01-16T08:47:13,514][INFO ][o.e.x.t.r.XPackRestIT    ] [test] [p0=watcher/ack_watch/40_reset_ack_after_unmet_action_condition/Ensure that ack status is reset after unmet action condition] after test\r\n```\r\n\r\nMaybe those tests don't usually take that long, but I suspect they were slower in this build due to the unexplained general slowness in GCP yesterday.\r\n\r\n### Summary\r\n\r\nThe actual test failure reported in this issue is due to the unreasonable slowness of VMs that caused a huge number of test failures yesterday.\r\n\r\n**BUT**\r\n\r\nThe problem that occurred during the force-close that was caused by the spurious failure _is_ a problem that could affect real users and that we should try to address.  It's not going to be very common, so shouldn't be considered a blocker for 6.6.0, but it's clearly not right for an `_all` operation to fail due to attempting to operate on an item that doesn't exist.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/455246067","html_url":"https://github.com/elastic/elasticsearch/issues/37545#issuecomment-455246067","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37545","id":455246067,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTI0NjA2Nw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-01-17T16:53:51Z","updated_at":"2019-01-17T16:53:51Z","author_association":"MEMBER","body":"Thanks for the detailed analysis @droberts195!  Makes sense re: the slowness... I was thinking this was a legit failure because the autodetect failure didn't look like a timeout on the surface, but in retrospect it does make sense that it was just a different manifestation of the timeout stuff we're seeing elsewhere.\r\n\r\nGoing to add this symptom to the infra ticket as well, since it sounds like these named pipes failing are a pretty extreme example of the issues (even more so than the other timeouts that were failing).  Thanks!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458475963","html_url":"https://github.com/elastic/elasticsearch/issues/37545#issuecomment-458475963","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37545","id":458475963,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODQ3NTk2Mw==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-01-29T09:49:16Z","updated_at":"2019-01-29T09:49:16Z","author_association":"CONTRIBUTOR","body":"I have raised a dedicated issue, #37959, for the underlying problem that this test failure revealed, because it's hard to quickly see the thing that needs to be fixed within this long issue.","performed_via_github_app":null}]