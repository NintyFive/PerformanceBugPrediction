{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14528/events","html_url":"https://github.com/elastic/elasticsearch/issues/14528","id":115094842,"node_id":"MDU6SXNzdWUxMTUwOTQ4NDI=","number":14528,"title":"Exceptions in general","user":{"login":"designermonkey","id":221344,"node_id":"MDQ6VXNlcjIyMTM0NA==","avatar_url":"https://avatars1.githubusercontent.com/u/221344?v=4","gravatar_id":"","url":"https://api.github.com/users/designermonkey","html_url":"https://github.com/designermonkey","followers_url":"https://api.github.com/users/designermonkey/followers","following_url":"https://api.github.com/users/designermonkey/following{/other_user}","gists_url":"https://api.github.com/users/designermonkey/gists{/gist_id}","starred_url":"https://api.github.com/users/designermonkey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/designermonkey/subscriptions","organizations_url":"https://api.github.com/users/designermonkey/orgs","repos_url":"https://api.github.com/users/designermonkey/repos","events_url":"https://api.github.com/users/designermonkey/events{/privacy}","received_events_url":"https://api.github.com/users/designermonkey/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2015-11-04T16:42:11Z","updated_at":"2015-11-05T15:39:09Z","closed_at":"2015-11-05T15:39:09Z","author_association":"NONE","active_lock_reason":null,"body":"Hi guys,\n\nI'm using the elasticsearch-php library to build applications with, and there is one thing that really bugs me; Exceptions.\n\nNow @polyfractal and the other contributors have done an exceptional job there, but they can't be blamed for poor exception output. What I mean is that the main exception I get is a `BadRequest400Exception`, which is pretty generic, and has to be because the value returned from elasticsearch itself is as the following:\n\n``` json\n{\n    \"error\": \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[5gPjjrRuSxiYzNBtadLr3Q][live][0]: SearchParseException[[live][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"match_all\\\":[]},\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"nested\\\":{\\\"path\\\":\\\"hierarchy\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"term\\\":{\\\"hierarchy.level\\\":1}},{\\\"term\\\":{\\\"hierarchy.path\\\":\\\"\\\\/tips\\\"}}]}}}},{\\\"nested\\\":{\\\"path\\\":\\\"schedule\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[],\\\"must_not\\\":{\\\"terms\\\":{\\\"schedule.type\\\":[\\\"withheld\\\"]}}}}}}]}}}},\\\"sort\\\":{\\\"schedule.start\\\":{\\\"order\\\":\\\"desc\\\",\\\"nested_filter\\\":{\\\"term\\\":{\\\"schedule.type\\\":\\\"published\\\"}}}},\\\"from\\\":0,\\\"size\\\":12}]]]; nested: QueryParsingException[[live] [nested] failed to find nested object under path [hierarchy]]; }{[5gPjjrRuSxiYzNBtadLr3Q][live][1]: SearchParseException[[live][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"match_all\\\":[]},\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"nested\\\":{\\\"path\\\":\\\"hierarchy\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"term\\\":{\\\"hierarchy.level\\\":1}},{\\\"term\\\":{\\\"hierarchy.path\\\":\\\"\\\\/tips\\\"}}]}}}},{\\\"nested\\\":{\\\"path\\\":\\\"schedule\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[],\\\"must_not\\\":{\\\"terms\\\":{\\\"schedule.type\\\":[\\\"withheld\\\"]}}}}}}]}}}},\\\"sort\\\":{\\\"schedule.start\\\":{\\\"order\\\":\\\"desc\\\",\\\"nested_filter\\\":{\\\"term\\\":{\\\"schedule.type\\\":\\\"published\\\"}}}},\\\"from\\\":0,\\\"size\\\":12}]]]; nested: QueryParsingException[[live] [nested] failed to find nested object under path [hierarchy]]; }{[5gPjjrRuSxiYzNBtadLr3Q][live][2]: SearchParseException[[live][2]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"match_all\\\":[]},\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"nested\\\":{\\\"path\\\":\\\"hierarchy\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"term\\\":{\\\"hierarchy.level\\\":1}},{\\\"term\\\":{\\\"hierarchy.path\\\":\\\"\\\\/tips\\\"}}]}}}},{\\\"nested\\\":{\\\"path\\\":\\\"schedule\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[],\\\"must_not\\\":{\\\"terms\\\":{\\\"schedule.type\\\":[\\\"withheld\\\"]}}}}}}]}}}},\\\"sort\\\":{\\\"schedule.start\\\":{\\\"order\\\":\\\"desc\\\",\\\"nested_filter\\\":{\\\"term\\\":{\\\"schedule.type\\\":\\\"published\\\"}}}},\\\"from\\\":0,\\\"size\\\":12}]]]; nested: QueryParsingException[[live] [nested] failed to find nested object under path [hierarchy]]; }{[5gPjjrRuSxiYzNBtadLr3Q][live][3]: SearchParseException[[live][3]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"match_all\\\":[]},\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"nested\\\":{\\\"path\\\":\\\"hierarchy\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"term\\\":{\\\"hierarchy.level\\\":1}},{\\\"term\\\":{\\\"hierarchy.path\\\":\\\"\\\\/tips\\\"}}]}}}},{\\\"nested\\\":{\\\"path\\\":\\\"schedule\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[],\\\"must_not\\\":{\\\"terms\\\":{\\\"schedule.type\\\":[\\\"withheld\\\"]}}}}}}]}}}},\\\"sort\\\":{\\\"schedule.start\\\":{\\\"order\\\":\\\"desc\\\",\\\"nested_filter\\\":{\\\"term\\\":{\\\"schedule.type\\\":\\\"published\\\"}}}},\\\"from\\\":0,\\\"size\\\":12}]]]; nested: QueryParsingException[[live] [nested] failed to find nested object under path [hierarchy]]; }{[5gPjjrRuSxiYzNBtadLr3Q][live][4]: SearchParseException[[live][4]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"match_all\\\":[]},\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"nested\\\":{\\\"path\\\":\\\"hierarchy\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"term\\\":{\\\"hierarchy.level\\\":1}},{\\\"term\\\":{\\\"hierarchy.path\\\":\\\"\\\\/tips\\\"}}]}}}},{\\\"nested\\\":{\\\"path\\\":\\\"schedule\\\",\\\"filter\\\":{\\\"bool\\\":{\\\"must\\\":[],\\\"must_not\\\":{\\\"terms\\\":{\\\"schedule.type\\\":[\\\"withheld\\\"]}}}}}}]}}}},\\\"sort\\\":{\\\"schedule.start\\\":{\\\"order\\\":\\\"desc\\\",\\\"nested_filter\\\":{\\\"term\\\":{\\\"schedule.type\\\":\\\"published\\\"}}}},\\\"from\\\":0,\\\"size\\\":12}]]]; nested: QueryParsingException[[live] [nested] failed to find nested object under path [hierarchy]]; }]\",\n    \"status\": 400\n}\n```\n\nThis is a very small Json object with a message string that is a mix of strings and Json objects. How is this ever supposed to be parsed into useful information for an API to use to create more specific exceptions?\n\nAs elasticsearch is a Json outputting application, then surely some better responses can come from it's exceptions? I'd like to be able to better ascertain what went wrong in my applications, without having to do some expensive string matching to figure this out.\n\nI'm not trying to just moan, believe me, as 90% of the time this stuff works a charm, but when it doesn't (even if it's my stupid fault) I'd like some better information.\n","closed_by":{"login":"designermonkey","id":221344,"node_id":"MDQ6VXNlcjIyMTM0NA==","avatar_url":"https://avatars1.githubusercontent.com/u/221344?v=4","gravatar_id":"","url":"https://api.github.com/users/designermonkey","html_url":"https://github.com/designermonkey","followers_url":"https://api.github.com/users/designermonkey/followers","following_url":"https://api.github.com/users/designermonkey/following{/other_user}","gists_url":"https://api.github.com/users/designermonkey/gists{/gist_id}","starred_url":"https://api.github.com/users/designermonkey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/designermonkey/subscriptions","organizations_url":"https://api.github.com/users/designermonkey/orgs","repos_url":"https://api.github.com/users/designermonkey/repos","events_url":"https://api.github.com/users/designermonkey/events{/privacy}","received_events_url":"https://api.github.com/users/designermonkey/received_events","type":"User","site_admin":false},"performed_via_github_app":null}