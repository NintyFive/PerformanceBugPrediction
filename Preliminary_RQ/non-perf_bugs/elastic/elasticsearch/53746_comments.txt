[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/600731876","html_url":"https://github.com/elastic/elasticsearch/issues/53746#issuecomment-600731876","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53746","id":600731876,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMDczMTg3Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-03-18T16:28:58Z","updated_at":"2020-03-18T16:28:58Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo (:Analytics/Aggregations)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/617959699","html_url":"https://github.com/elastic/elasticsearch/issues/53746#issuecomment-617959699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53746","id":617959699,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNzk1OTY5OQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2020-04-22T18:42:25Z","updated_at":"2020-04-22T18:42:25Z","author_association":"MEMBER","body":"We have two ways of implementing this feature: incrementing the usage counter on the parser invocation and by incrementing the counter on ValuesSourceRegistry access.\r\n\r\nIn case of parser, we can count high level invocations. Basically for each search that contains one aggregation of a certain type we will count it as one use. Unfortunately, on this level we will not have information about value type the aggregation is executed one. So for example if a percentiles was executed we will not know if it was executed on histogram data type or not.\r\n\r\nIn case of ValuesSourceRegistry access counters, we will now the type, but we will count each shard access as a separate invocation. So, if we execute a single search with a single aggregation on 2 indices with 5 shards each, we will count his as 10 invocation. We can do some tricks like counting it only on shard 0. In this case it will be counted as 2 invocations.  ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/617970854","html_url":"https://github.com/elastic/elasticsearch/issues/53746#issuecomment-617970854","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53746","id":617970854,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNzk3MDg1NA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2020-04-22T19:03:13Z","updated_at":"2020-04-22T19:03:13Z","author_association":"MEMBER","body":"I'm tentatively leaning towards the second option.  I think it'd be more useful to know the complete list of aggs being used, as well as which field types they are being used against... even if it means they are \"over-counted\" by doing it per-shard.  My feeling is that the absolute numbers don't matter as much as relative numbers?  \r\n\r\nE.g. as an administrator I think I'd care that an expensive `scripted-metric` might be running two orders of magnitude more than all the other aggs, but not necessarily care about the exact numbers. So it's all relative and doesn't really rely on precise once-per-query counting. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/617977128","html_url":"https://github.com/elastic/elasticsearch/issues/53746#issuecomment-617977128","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53746","id":617977128,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNzk3NzEyOA==","user":{"login":"giladgal","id":1180461,"node_id":"MDQ6VXNlcjExODA0NjE=","avatar_url":"https://avatars3.githubusercontent.com/u/1180461?v=4","gravatar_id":"","url":"https://api.github.com/users/giladgal","html_url":"https://github.com/giladgal","followers_url":"https://api.github.com/users/giladgal/followers","following_url":"https://api.github.com/users/giladgal/following{/other_user}","gists_url":"https://api.github.com/users/giladgal/gists{/gist_id}","starred_url":"https://api.github.com/users/giladgal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giladgal/subscriptions","organizations_url":"https://api.github.com/users/giladgal/orgs","repos_url":"https://api.github.com/users/giladgal/repos","events_url":"https://api.github.com/users/giladgal/events{/privacy}","received_events_url":"https://api.github.com/users/giladgal/received_events","type":"User","site_admin":false},"created_at":"2020-04-22T19:15:26Z","updated_at":"2020-04-22T19:15:26Z","author_association":"CONTRIBUTOR","body":"I agree between these two the second option seems better.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/617995921","html_url":"https://github.com/elastic/elasticsearch/issues/53746#issuecomment-617995921","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53746","id":617995921,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNzk5NTkyMQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2020-04-22T19:45:07Z","updated_at":"2020-04-22T19:45:07Z","author_association":"MEMBER","body":"Thanks! I am going with the second option then.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/619071196","html_url":"https://github.com/elastic/elasticsearch/issues/53746#issuecomment-619071196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53746","id":619071196,"node_id":"MDEyOklzc3VlQ29tbWVudDYxOTA3MTE5Ng==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2020-04-24T15:12:09Z","updated_at":"2020-04-24T15:12:09Z","author_association":"MEMBER","body":"At the end of the day @not-napoleon found a good place to make a single call per parsing while having values source type in hand.","performed_via_github_app":null}]