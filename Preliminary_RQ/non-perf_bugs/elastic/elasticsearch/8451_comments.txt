[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62724158","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-62724158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":62724158,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNzI0MTU4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-12T14:22:21Z","updated_at":"2014-11-12T14:22:21Z","author_association":"CONTRIBUTOR","body":"Hi @satishmallik \n\nAfter an OOM, the JVM is in an undefined state, and you should restart it.  There is no point in continuing after that.  The more important question that you need to answer is: why are you getting OOMs in the client? \n\nIt looks like you are running the Marvel exported inside your node client, is that correct?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62725586","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-62725586","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":62725586,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNzI1NTg2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-12T14:31:38Z","updated_at":"2014-11-12T14:31:38Z","author_association":"CONTRIBUTOR","body":"@satishmallik what else are you doing on this client node? how much heap does it have? I'd love to figure out what is using up all of the memory.\n\nCould you send the output of these requests please:\n\n```\ncurl localhost:9200/_nodes > nodes_info.json\ncurl localhost:9200/_nodes/stats > nodes_stats.json\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62729564","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-62729564","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":62729564,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNzI5NTY0","user":{"login":"satishmallik","id":8112171,"node_id":"MDQ6VXNlcjgxMTIxNzE=","avatar_url":"https://avatars2.githubusercontent.com/u/8112171?v=4","gravatar_id":"","url":"https://api.github.com/users/satishmallik","html_url":"https://github.com/satishmallik","followers_url":"https://api.github.com/users/satishmallik/followers","following_url":"https://api.github.com/users/satishmallik/following{/other_user}","gists_url":"https://api.github.com/users/satishmallik/gists{/gist_id}","starred_url":"https://api.github.com/users/satishmallik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/satishmallik/subscriptions","organizations_url":"https://api.github.com/users/satishmallik/orgs","repos_url":"https://api.github.com/users/satishmallik/repos","events_url":"https://api.github.com/users/satishmallik/events{/privacy}","received_events_url":"https://api.github.com/users/satishmallik/received_events","type":"User","site_admin":false},"created_at":"2014-11-12T14:53:12Z","updated_at":"2014-11-12T14:53:12Z","author_association":"NONE","body":"Hi clinton,\nWe have 9 node production cluster and 3 node marvel cluster. Out of 9 nodes 3 are master, 3 are data and 3 are client nodes. We hit OOM on one of client nodes. We have allocated 2G of RAM for JVM on a 3.5G RAM client machine.\n\nI am not able to attach json file here. Can you share me any location where I can upload it,\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62746278","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-62746278","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":62746278,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNzQ2Mjc4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-12T16:26:39Z","updated_at":"2014-11-12T16:26:39Z","author_association":"CONTRIBUTOR","body":"Hi @satishmallik \n\nYou can send them to me at clinton dot gormley at elasticsearch dot com\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62756515","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-62756515","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":62756515,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNzU2NTE1","user":{"login":"satishmallik","id":8112171,"node_id":"MDQ6VXNlcjgxMTIxNzE=","avatar_url":"https://avatars2.githubusercontent.com/u/8112171?v=4","gravatar_id":"","url":"https://api.github.com/users/satishmallik","html_url":"https://github.com/satishmallik","followers_url":"https://api.github.com/users/satishmallik/followers","following_url":"https://api.github.com/users/satishmallik/following{/other_user}","gists_url":"https://api.github.com/users/satishmallik/gists{/gist_id}","starred_url":"https://api.github.com/users/satishmallik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/satishmallik/subscriptions","organizations_url":"https://api.github.com/users/satishmallik/orgs","repos_url":"https://api.github.com/users/satishmallik/repos","events_url":"https://api.github.com/users/satishmallik/events{/privacy}","received_events_url":"https://api.github.com/users/satishmallik/received_events","type":"User","site_admin":false},"created_at":"2014-11-12T17:24:56Z","updated_at":"2014-11-12T17:24:56Z","author_association":"NONE","body":"I sent it to your email id. Please have a look,\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63011808","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-63011808","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":63011808,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDExODA4","user":{"login":"satishmallik","id":8112171,"node_id":"MDQ6VXNlcjgxMTIxNzE=","avatar_url":"https://avatars2.githubusercontent.com/u/8112171?v=4","gravatar_id":"","url":"https://api.github.com/users/satishmallik","html_url":"https://github.com/satishmallik","followers_url":"https://api.github.com/users/satishmallik/followers","following_url":"https://api.github.com/users/satishmallik/following{/other_user}","gists_url":"https://api.github.com/users/satishmallik/gists{/gist_id}","starred_url":"https://api.github.com/users/satishmallik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/satishmallik/subscriptions","organizations_url":"https://api.github.com/users/satishmallik/orgs","repos_url":"https://api.github.com/users/satishmallik/repos","events_url":"https://api.github.com/users/satishmallik/events{/privacy}","received_events_url":"https://api.github.com/users/satishmallik/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T05:11:37Z","updated_at":"2014-11-14T05:11:37Z","author_association":"NONE","body":"Marvel exporter is running on each of 9 nodes including client on which we saw OOM.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63028595","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-63028595","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":63028595,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDI4NTk1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T09:20:44Z","updated_at":"2014-11-14T09:20:44Z","author_association":"CONTRIBUTOR","body":"Hi @satishmallik \n\nI looked at your node info/stats.  Couple of things to note:\n- You are using the Azul JVM, which is not supported\n- You have swap enabled, which can cause slow GCs.  Windows does not support mlockall, so disabling swap is the only way to go here\n- Your merges are being heavily throttled, which means that merges are not keeping up with your indexing.  Have you set the merge throttling to some custom value? If not, try allowing higher throughput and see if your disks can keep up. If not, then you need faster disks or more data nodes.\n\nAnd that's about all I could see.  I didn't see anything unusual in the clients.  Are you sending massive bulk requests through the clients? Or returning massive result sets?  \n\nI'd suggest doing a heap dump of a client that has full memory, to see what is taking up all of the heap.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63074099","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-63074099","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":63074099,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDc0MDk5","user":{"login":"satishmallik","id":8112171,"node_id":"MDQ6VXNlcjgxMTIxNzE=","avatar_url":"https://avatars2.githubusercontent.com/u/8112171?v=4","gravatar_id":"","url":"https://api.github.com/users/satishmallik","html_url":"https://github.com/satishmallik","followers_url":"https://api.github.com/users/satishmallik/followers","following_url":"https://api.github.com/users/satishmallik/following{/other_user}","gists_url":"https://api.github.com/users/satishmallik/gists{/gist_id}","starred_url":"https://api.github.com/users/satishmallik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/satishmallik/subscriptions","organizations_url":"https://api.github.com/users/satishmallik/orgs","repos_url":"https://api.github.com/users/satishmallik/repos","events_url":"https://api.github.com/users/satishmallik/events{/privacy}","received_events_url":"https://api.github.com/users/satishmallik/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T14:49:20Z","updated_at":"2014-11-14T14:49:20Z","author_association":"NONE","body":"Hi Clinton,\nThanks for looking into this,\n\nFew questions\n1) Which JVMs are officially supported by Elasticsearch? With Azule we are seeing GC running quite frequently and CPU/Memory usage remains quite high\n\n2) I have to experiment with disabling SWAP on ES nodes,\n\n3) We had earlier deployed ES 1.1.3 which was throttling merges. We already have moved to ES 1.3.4, but we didn't delete our earlier index which was created by ES1.1.3. We are using Azure Blob store for our index storage. \n\nOur client node is currently acting both as ingestion and query nodes. We are doing heavy bulk indexing and yes we do return 1000 results. We are doing multi term aggregation. But we are planning to move away from multi term aggregation model.\n\nIn general how can we figure that merge is throttling or, not during indexing? Apart our segments count and deleted documents (25%) are quite high. We are not doing any optimization on index. Any suggestions on controlling segment count and deleted documents? \n\nHow can we control CPU/Mem usage on data nodes? Data nodes are dual core nodes having 14G of RAM.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63076157","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-63076157","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":63076157,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDc2MTU3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T15:03:16Z","updated_at":"2014-11-14T15:04:05Z","author_association":"CONTRIBUTOR","body":"> 1) Which JVMs are officially supported by Elasticsearch? With Azule we are seeing GC running quite frequently and CPU/Memory usage remains quite high\n\nOpenJDK and Oracle's Java\n\n> 3) We had earlier deployed ES 1.1.3 which was throttling merges. We already have moved to ES 1.3.4, but we didn't delete our earlier index which was created by ES1.1.3. We are using Azure Blob store for our index storage.\n\nNot sure what throughput you'll get on Azure, but it is worth trying to play with the throttling.  By default we throttle to 20MB/s, but you can increase this value (see http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/index-modules-store.html#store-throttling).  You want to keep an eye on your search latencies, because search will fight with indexing for I/O. That's why we throttle by default. \n\n> Our client node is currently acting both as ingestion and query nodes. We are doing heavy bulk indexing and yes we do return 1000 results. We are doing multi term aggregation. But we are planning to move away from multi term aggregation model.\n\nThousand**S** of results? or 1,000 total? If thousands, then you should look at using the scroll API instead.\n\n> In general how can we figure that merge is throttling or, not during indexing? Apart our segments count and deleted documents (25%) are quite high. We are not doing any optimization on index. Any suggestions on controlling segment count and deleted documents?\n\nYou can measure how much throttling is happening by looking at:\n\n```\nGET /_nodes/stats/indices/store,indexing\n```\n\nYou shouldn't need to optimize. As long as there is enough I/O available, then the background merge process will handle things just fine.\n\n> How can we control CPU/Mem usage on data nodes? Data nodes are dual core nodes having 14G of RAM.\n\nUse them less? :)  You need to figure out where the memory is being used, etc.  There's no simple answer to this.  I suggest reading the Administration section of the Definitive Guide: http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/administration.html\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76510556","html_url":"https://github.com/elastic/elasticsearch/issues/8451#issuecomment-76510556","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8451","id":76510556,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NTEwNTU2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-02-28T04:50:54Z","updated_at":"2015-02-28T04:50:54Z","author_association":"CONTRIBUTOR","body":"No more info provided. Closing\n","performed_via_github_app":null}]