{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48624","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48624/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48624/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48624/events","html_url":"https://github.com/elastic/elasticsearch/issues/48624","id":513831550,"node_id":"MDU6SXNzdWU1MTM4MzE1NTA=","number":48624,"title":"[Feature Request] return updated docs on updateByQuery API calls","user":{"login":"gmmorris","id":386208,"node_id":"MDQ6VXNlcjM4NjIwOA==","avatar_url":"https://avatars3.githubusercontent.com/u/386208?v=4","gravatar_id":"","url":"https://api.github.com/users/gmmorris","html_url":"https://github.com/gmmorris","followers_url":"https://api.github.com/users/gmmorris/followers","following_url":"https://api.github.com/users/gmmorris/following{/other_user}","gists_url":"https://api.github.com/users/gmmorris/gists{/gist_id}","starred_url":"https://api.github.com/users/gmmorris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmmorris/subscriptions","organizations_url":"https://api.github.com/users/gmmorris/orgs","repos_url":"https://api.github.com/users/gmmorris/repos","events_url":"https://api.github.com/users/gmmorris/events{/privacy}","received_events_url":"https://api.github.com/users/gmmorris/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-10-29T10:44:14Z","updated_at":"2019-10-30T19:30:31Z","closed_at":"2019-10-30T19:30:31Z","author_association":"NONE","active_lock_reason":null,"body":"Hi Team,\r\nOur work optimising Kibana's Task Manager has unearthed a few places where we believe we can improve performance significantly if we could get a change made to the `updateByQuery` API.\r\n\r\n**Describe the feature**:\r\n*The Use Case*\r\nWe currently use an `updateByQuery` API call to find tasks which are ready to be picked up and we use the `update` to mark these tasks by updating the relevant documents by marking them (updating a field to have the UUID of the current Kibana, though that's immaterial).\r\n\r\nOnce the `updateByQuery` has completed (we call this the `query & mark` phase), we then need to make a `search` call in order to find all the documents we've just updated (called the `sweep and collect` phase).\r\n\r\nThis has two drawbacks:\r\n1.  We need to make two calls, the `query & mark` followed by the `sweep and collect`, in order to achieve a stage that we believe could be done in one call- find the relevant tasks and \"claim\" them so that no other Kibana can do the same.\r\n2. We have to wait for the `refresh` to take place before we can make the `sweep and collect`, forcing us to use `refresh:true` on the `updateByQuery` call.\r\n\r\n*Proposed Solution*\r\nWhat we'd like you to consider is making it possible to request that the `updateByQuery` call actually return the documents that have been updated by the query.\r\nThis would save us the second api call (which will make us _faster_) and would mean waiting for the refresh isn't needed.\r\n\r\nif it helps, we can definitely live with this limitation existing on this, such as `max_docs` being specified.\r\n\r\nCheers","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}