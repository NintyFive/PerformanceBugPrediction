{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20552","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20552/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20552/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20552/events","html_url":"https://github.com/elastic/elasticsearch/issues/20552","id":177756920,"node_id":"MDU6SXNzdWUxNzc3NTY5MjA=","number":20552,"title":"v5 ranking: Shorter text no longer better than longer one?","user":{"login":"cwurm","id":694597,"node_id":"MDQ6VXNlcjY5NDU5Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/694597?v=4","gravatar_id":"","url":"https://api.github.com/users/cwurm","html_url":"https://github.com/cwurm","followers_url":"https://api.github.com/users/cwurm/followers","following_url":"https://api.github.com/users/cwurm/following{/other_user}","gists_url":"https://api.github.com/users/cwurm/gists{/gist_id}","starred_url":"https://api.github.com/users/cwurm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cwurm/subscriptions","organizations_url":"https://api.github.com/users/cwurm/orgs","repos_url":"https://api.github.com/users/cwurm/repos","events_url":"https://api.github.com/users/cwurm/events{/privacy}","received_events_url":"https://api.github.com/users/cwurm/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-09-19T11:05:32Z","updated_at":"2016-10-18T08:48:58Z","closed_at":"2016-09-19T11:29:45Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version**:\n5.0.0-alpha5\n\n**Plugins installed**:\ningest-geoip\ningest-user-agent\nx-pack\n\n**JVM version**:\nHotspot 1.8.0_60\n\n**OS version**:\nOS X 10.11.6\n\n**Description of the problem including expected versus actual behavior**:\nIn v5, the default ranking algo was changed to BM25. This should change things like an over-influence of common terms and that's good. But should it change how a short, well-matching doc is ordered compared to a much longer, less-matching doc?\n\n**Steps to reproduce**:\n- Index short doc:\n\n```\nDELETE test2\n\nPUT test2/test/0\n{\n  \"text\": \"Roger Federer\"\n}\n\n```\n- Insert longer doc:\n\n```\nPUT test2/test/1\n{\n  \"text\": \"Needing Time to Recover, Roger Federer Will Miss the Rest of the Season\"\n}\n```\n- Search:\n\n`GET test2/_search?q=federer`\n- Result:\n\n```\n{\n  \"took\": 1,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": 2,\n    \"max_score\": 0.26286605,\n    \"hits\": [\n      {\n        \"_index\": \"test2\",\n        \"_type\": \"test\",\n        \"_id\": \"1\",\n        \"_score\": 0.26286605,\n        \"_source\": {\n          \"text\": \"Needing Time to Recover, Roger Federer Will Miss the Rest of the Season\"\n        }\n      },\n      {\n        \"_index\": \"test2\",\n        \"_type\": \"test\",\n        \"_id\": \"0\",\n        \"_score\": 0.16358379,\n        \"_source\": {\n          \"text\": \"Roger Federer\"\n        }\n      }\n    ]\n  }\n}\n```\n\nIntuitively, it should be the other way around (and it is in pre-5.0 times).\n- Explain\n\nLooking at the output of the Explain API this is caused by the longer text getting a higher score on `avgFieldLength` and `fieldLength`. I was under the impression BM25 reduces the influence the field length has, but maintains the usual correlation, i.e. shorter is better.\n\n```\n{\n  \"took\": 1,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": 2,\n    \"max_score\": 0.26286605,\n    \"hits\": [\n      {\n        \"_shard\": \"[test2][3]\",\n        \"_node\": \"sUr9FfStT3KFrr1Ku7liXQ\",\n        \"_index\": \"test2\",\n        \"_type\": \"test\",\n        \"_id\": \"1\",\n        \"_score\": 0.26286605,\n        \"_source\": {\n          \"text\": \"Needing Time to Recover, Roger Federer Will Miss the Rest of the Season\"\n        },\n        \"_explanation\": {\n          \"value\": 0.26286605,\n          \"description\": \"weight(_all:federer in 0) [PerFieldSimilarity], result of:\",\n          \"details\": [\n            {\n              \"value\": 0.26286605,\n              \"description\": \"score(doc=0,freq=1.0 = termFreq=1.0\\n), product of:\",\n              \"details\": [\n                {\n                  \"value\": 0.2876821,\n                  \"description\": \"idf(docFreq=1, docCount=1)\",\n                  \"details\": []\n                },\n                {\n                  \"value\": 0.913738,\n                  \"description\": \"tfNorm, computed from:\",\n                  \"details\": [\n                    {\n                      \"value\": 1,\n                      \"description\": \"termFreq=1.0\",\n                      \"details\": []\n                    },\n                    {\n                      \"value\": 1.2,\n                      \"description\": \"parameter k1\",\n                      \"details\": []\n                    },\n                    {\n                      \"value\": 0.75,\n                      \"description\": \"parameter b\",\n                      \"details\": []\n                    },\n                    {\n                      \"value\": 13,\n                      \"description\": \"avgFieldLength\",\n                      \"details\": []\n                    },\n                    {\n                      \"value\": 16,\n                      \"description\": \"fieldLength\",\n                      \"details\": []\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      },\n      {\n        \"_shard\": \"[test2][0]\",\n        \"_node\": \"sUr9FfStT3KFrr1Ku7liXQ\",\n        \"_index\": \"test2\",\n        \"_type\": \"test\",\n        \"_id\": \"0\",\n        \"_score\": 0.16358379,\n        \"_source\": {\n          \"text\": \"Roger Federer\"\n        },\n        \"_explanation\": {\n          \"value\": 0.16358379,\n          \"description\": \"weight(_all:federer in 1) [PerFieldSimilarity], result of:\",\n          \"details\": [\n            {\n              \"value\": 0.16358379,\n              \"description\": \"score(doc=1,freq=1.0 = termFreq=1.0\\n), product of:\",\n              \"details\": [\n                {\n                  \"value\": 0.18232156,\n                  \"description\": \"idf(docFreq=2, docCount=2)\",\n                  \"details\": []\n                },\n                {\n                  \"value\": 0.89722675,\n                  \"description\": \"tfNorm, computed from:\",\n                  \"details\": [\n                    {\n                      \"value\": 1,\n                      \"description\": \"termFreq=1.0\",\n                      \"details\": []\n                    },\n                    {\n                      \"value\": 1.2,\n                      \"description\": \"parameter k1\",\n                      \"details\": []\n                    },\n                    {\n                      \"value\": 0.75,\n                      \"description\": \"parameter b\",\n                      \"details\": []\n                    },\n                    {\n                      \"value\": 2,\n                      \"description\": \"avgFieldLength\",\n                      \"details\": []\n                    },\n                    {\n                      \"value\": 2.56,\n                      \"description\": \"fieldLength\",\n                      \"details\": []\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}