[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471479074","html_url":"https://github.com/elastic/elasticsearch/issues/39905#issuecomment-471479074","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39905","id":471479074,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTQ3OTA3NA==","user":{"login":"jporzelt","id":5166883,"node_id":"MDQ6VXNlcjUxNjY4ODM=","avatar_url":"https://avatars0.githubusercontent.com/u/5166883?v=4","gravatar_id":"","url":"https://api.github.com/users/jporzelt","html_url":"https://github.com/jporzelt","followers_url":"https://api.github.com/users/jporzelt/followers","following_url":"https://api.github.com/users/jporzelt/following{/other_user}","gists_url":"https://api.github.com/users/jporzelt/gists{/gist_id}","starred_url":"https://api.github.com/users/jporzelt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jporzelt/subscriptions","organizations_url":"https://api.github.com/users/jporzelt/orgs","repos_url":"https://api.github.com/users/jporzelt/repos","events_url":"https://api.github.com/users/jporzelt/events{/privacy}","received_events_url":"https://api.github.com/users/jporzelt/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T10:10:05Z","updated_at":"2019-03-11T10:10:05Z","author_association":"NONE","body":"This bug also affects me in a customer project. \r\nThank you for the detailed description!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471565128","html_url":"https://github.com/elastic/elasticsearch/issues/39905#issuecomment-471565128","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39905","id":471565128,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTU2NTEyOA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T14:37:39Z","updated_at":"2019-03-11T14:37:39Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471578025","html_url":"https://github.com/elastic/elasticsearch/issues/39905#issuecomment-471578025","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39905","id":471578025,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTU3ODAyNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T15:07:05Z","updated_at":"2019-03-11T15:07:05Z","author_association":"MEMBER","body":"While the other issues you linked were actual bugs I don't think that this one should be labelled as such. Let me explain why. The `simple_query_string` treats whitespaces as operator by default, this means that the query `Frankfurt am Main` is splitted into `Frankfurt`, `am`, `Main` prior to analysis. \r\nThe analysis part consists of building one query for each field using the analyzer defined on the field. These queries are then merged in a disjunction (e.g.: `title_en:frankfurt OR title_de:frankfurt) and finally the disjunctions are combined to create the root query (e.g.:  `(title_en:frankfurt OR tile_de:frankfurt) AND (title_en:am OR tile_de:am) ...`). Since you're searching on different languages I don't think you should mix the fields based on whitespace but rather build one query per analyzer. That's what we call the `cross_fields` mode in the `multi_match` query:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html#type-cross-fields\r\nSwitching to this mode will create one query per analyzer (language) resulting in something like:\r\n````\r\n((+(title_text_en:Frankfurt | content_text_en:Frankfurt) +(title_text_en:am | content_text_en:am) +(title_text_en:Main | content_text_en:Main)) | (+(title_text_de:Frankfurt | content_text_de:Frankfurt) +(title_text_de:Main | content_text_de:Main)))\r\n````\r\nwhich is what I'd expect from a query that targets different languages ?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/472073559","html_url":"https://github.com/elastic/elasticsearch/issues/39905#issuecomment-472073559","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39905","id":472073559,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjA3MzU1OQ==","user":{"login":"jporzelt","id":5166883,"node_id":"MDQ6VXNlcjUxNjY4ODM=","avatar_url":"https://avatars0.githubusercontent.com/u/5166883?v=4","gravatar_id":"","url":"https://api.github.com/users/jporzelt","html_url":"https://github.com/jporzelt","followers_url":"https://api.github.com/users/jporzelt/followers","following_url":"https://api.github.com/users/jporzelt/following{/other_user}","gists_url":"https://api.github.com/users/jporzelt/gists{/gist_id}","starred_url":"https://api.github.com/users/jporzelt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jporzelt/subscriptions","organizations_url":"https://api.github.com/users/jporzelt/orgs","repos_url":"https://api.github.com/users/jporzelt/repos","events_url":"https://api.github.com/users/jporzelt/events{/privacy}","received_events_url":"https://api.github.com/users/jporzelt/received_events","type":"User","site_admin":false},"created_at":"2019-03-12T16:24:10Z","updated_at":"2019-03-12T16:24:10Z","author_association":"NONE","body":"Thank you @jimczi  for the explanation. \r\nSo is this then the same if I would split up the query in should clauses of a boolean query like (using the example from above):\r\n```\r\ncurl -XPOST -H \"Content-Type: application/json\" localhost:9200/mytest/_search?pretty -d '{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"should\": [\r\n        {\r\n          \"simple_query_string\": {\r\n            \"query\": \"Frankfurt am Main\",\r\n            \"fields\": [\r\n              \"content_text_de\"\r\n            ],\r\n            \"default_operator\": \"and\"\r\n          }\r\n        },\r\n        {\r\n          \"simple_query_string\": {\r\n            \"query\": \"Frankfurt am Main\",\r\n            \"fields\": [\r\n              \"content_text_en\"\r\n            ],\r\n            \"default_operator\": \"and\"\r\n          }\r\n        },\r\n        {\r\n          \"simple_query_string\": {\r\n            \"query\": \"Frankfurt am Main\",\r\n            \"fields\": [\r\n              \"title_text_de\"\r\n            ],\r\n            \"default_operator\": \"and\"\r\n          }\r\n        },\r\n        {\r\n          \"simple_query_string\": {\r\n            \"query\": \"Frankfurt am Main\",\r\n            \"fields\": [\r\n              \"title_text_en\"\r\n            ],\r\n            \"default_operator\": \"and\"\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}'\r\n```\r\n\r\nThis seems to work. This still supports the Boolean operators (that's why I'm using the `simple_query_string`) and handle stop words correctly. \r\n\r\nDo you see any problem with this approach?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/472160364","html_url":"https://github.com/elastic/elasticsearch/issues/39905#issuecomment-472160364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39905","id":472160364,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjE2MDM2NA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-12T20:06:15Z","updated_at":"2019-03-12T20:06:15Z","author_association":"MEMBER","body":"Yes this approach would work, the other solution if you still want to use a single `simple_query_string` with multiple fields is to disable the whitespace operator by setting the [`flag` option](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html#supported-flags) like this:\r\n````\r\n\"simple_query_string\" : {\r\n            \"query\" : \"Frankfurt am Main\",\r\n            \"flags\" : \"OR|AND\",\r\n            \"fields\": [\"*_text_*\"],\r\n        }\r\n````\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/472988655","html_url":"https://github.com/elastic/elasticsearch/issues/39905#issuecomment-472988655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39905","id":472988655,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mjk4ODY1NQ==","user":{"login":"xrammit","id":3740851,"node_id":"MDQ6VXNlcjM3NDA4NTE=","avatar_url":"https://avatars3.githubusercontent.com/u/3740851?v=4","gravatar_id":"","url":"https://api.github.com/users/xrammit","html_url":"https://github.com/xrammit","followers_url":"https://api.github.com/users/xrammit/followers","following_url":"https://api.github.com/users/xrammit/following{/other_user}","gists_url":"https://api.github.com/users/xrammit/gists{/gist_id}","starred_url":"https://api.github.com/users/xrammit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xrammit/subscriptions","organizations_url":"https://api.github.com/users/xrammit/orgs","repos_url":"https://api.github.com/users/xrammit/repos","events_url":"https://api.github.com/users/xrammit/events{/privacy}","received_events_url":"https://api.github.com/users/xrammit/received_events","type":"User","site_admin":false},"created_at":"2019-03-14T17:54:52Z","updated_at":"2019-03-14T17:54:52Z","author_association":"NONE","body":"Thanks @jimczi and @jporzelt for the explanation and the suggested solutions!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/645302895","html_url":"https://github.com/elastic/elasticsearch/issues/39905#issuecomment-645302895","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39905","id":645302895,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NTMwMjg5NQ==","user":{"login":"tinhte96","id":28956560,"node_id":"MDQ6VXNlcjI4OTU2NTYw","avatar_url":"https://avatars2.githubusercontent.com/u/28956560?v=4","gravatar_id":"","url":"https://api.github.com/users/tinhte96","html_url":"https://github.com/tinhte96","followers_url":"https://api.github.com/users/tinhte96/followers","following_url":"https://api.github.com/users/tinhte96/following{/other_user}","gists_url":"https://api.github.com/users/tinhte96/gists{/gist_id}","starred_url":"https://api.github.com/users/tinhte96/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tinhte96/subscriptions","organizations_url":"https://api.github.com/users/tinhte96/orgs","repos_url":"https://api.github.com/users/tinhte96/repos","events_url":"https://api.github.com/users/tinhte96/events{/privacy}","received_events_url":"https://api.github.com/users/tinhte96/received_events","type":"User","site_admin":false},"created_at":"2020-06-17T10:53:54Z","updated_at":"2020-06-17T10:53:54Z","author_association":"NONE","body":" if i remove whitespace operator like @jimczi mentionned above, the prohibited clause seems not work anymore, even i add an extra (+) before (-). There are a closed issue about this, but the problem seems still there https://github.com/elastic/elasticsearch/issues/9633 . I also posted my question in elastic forum https://discuss.elastic.co/t/simple-query-string-minus-doesnt-work-if-whitespace-not-specified-in-flags/237347","performed_via_github_app":null}]