{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28269","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28269/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28269/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28269/events","html_url":"https://github.com/elastic/elasticsearch/issues/28269","id":289363286,"node_id":"MDU6SXNzdWUyODkzNjMyODY=","number":28269,"title":"[Ingest] Ingest Node cannot find pipeline that exists","user":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2018-01-17T18:14:09Z","updated_at":"2018-03-08T23:23:00Z","closed_at":"2018-03-08T23:23:00Z","author_association":"MEMBER","active_lock_reason":null,"body":"I ran into an issue, which I cannot reproduce, where a set of ingest nodes were complaining that they could not find an ingest pipeline during an ordinary `_bulk` request that used it. This followed a single node cluster being upgraded from 6.1.1 to 6.1.2 by adding a new node, then decommissioning the old node. While trying to debug the issue, two other nodes were added, which were also ingest nodes.\r\n\r\nI **was** able to see the Ingest pipeline by requesting it directly:\r\n\r\n```http\r\nGET /_ingest/pipeline/xpack_monitoring_6\r\n```\r\n\r\nas well as via the cluster state:\r\n\r\n```http\r\nGET /_cluster/state/metadata?filter_path=metadata.ingest.pipeline\r\n```\r\n\r\nIn both cases, it returned the expected ingest pipeline:\r\n\r\n```json\r\n{\r\n  \"xpack_monitoring_6\": {\r\n    \"description\": \"This is a placeholder pipeline for Monitoring API version 6 so that future versions may fix breaking changes.\",\r\n    \"version\": 6010099,\r\n    \"processors\": []\r\n  }\r\n}\r\n```\r\n\r\n### Workaround\r\n\r\nFixing the issue was simple, but it's unclear what was actually wrong. Simply delete, then replace the exact same ingest pipeline with the same name (it's possible that the `DELETE` step is unnecessary):\r\n\r\n```http\r\nDELETE /_ingest/pipeline/xpack_monitoring_6\r\n\r\nPUT /_ingest/pipeline/xpack_monitoring_6\r\n{\r\n  \"description\": \"This is a placeholder pipeline for Monitoring API version 6 so that future versions may fix breaking changes.\",\r\n  \"version\": 6010099,\r\n  \"processors\": []\r\n}\r\n```\r\n\r\nFrom that point onward it began to work.","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}