{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3088","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3088/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3088/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3088/events","html_url":"https://github.com/elastic/elasticsearch/issues/3088","id":14719267,"node_id":"MDU6SXNzdWUxNDcxOTI2Nw==","number":3088,"title":"\"no index mapper found for field\" bulk indexing in 0.90","user":{"login":"philayres","id":294874,"node_id":"MDQ6VXNlcjI5NDg3NA==","avatar_url":"https://avatars0.githubusercontent.com/u/294874?v=4","gravatar_id":"","url":"https://api.github.com/users/philayres","html_url":"https://github.com/philayres","followers_url":"https://api.github.com/users/philayres/followers","following_url":"https://api.github.com/users/philayres/following{/other_user}","gists_url":"https://api.github.com/users/philayres/gists{/gist_id}","starred_url":"https://api.github.com/users/philayres/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philayres/subscriptions","organizations_url":"https://api.github.com/users/philayres/orgs","repos_url":"https://api.github.com/users/philayres/repos","events_url":"https://api.github.com/users/philayres/events{/privacy}","received_events_url":"https://api.github.com/users/philayres/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":37906074,"node_id":"MDU6TGFiZWwzNzkwNjA3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.1","name":"v0.90.1","color":"DDDDDD","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2013-05-24T12:22:06Z","updated_at":"2014-01-23T19:42:06Z","closed_at":"2013-05-24T15:40:57Z","author_association":"NONE","active_lock_reason":null,"body":"Today I've been getting horrible performance on 0.90 server I upgraded last week. Running on Ubuntu, Ruby 1.9.3, Rails 3.2.3, with the Stretcher gem.\n\nThe issue is in bulk indexing Twitter data, with JSON very similar to the response shown at: https://dev.twitter.com/docs/api/1.1/get/statuses/user_timeline, except the user node of each item is removed and is instead a parent document (although I don't think that is the issue).\n\nMy mappings are intentionally kept simple, using dynamic mappings to add fields. Everything has been working fine to this point. Now I'm getting the following error, bringing the server to its knees.\n\nThe error is:\n[2013-05-23 22:13:01,792][WARN ][index.merge.scheduler    ] [Rocket Racer] [twitter_history_76816072][1] failed to merge\norg.elasticsearch.ElasticSearchIllegalStateException: no index mapper found for field: [entities.description.urls.display_url]\n        at org.elasticsearch.index.codec.PerFieldMappingPostingFormatCodec.getPostingsFormatForField(PerFieldMappingPostingFormatCodec.java:52)\n        at org.apache.lucene.codecs.lucene42.Lucene42Codec$1.getPostingsFormatForField(Lucene42Codec.java:59)\n        at org.apache.lucene.codecs.perfield.PerFieldPostingsFormat$FieldsWriter.addField(PerFieldPostingsFormat.java:102)\n        at org.apache.lucene.codecs.FieldsConsumer.merge(FieldsConsumer.java:71)\n        at org.apache.lucene.index.SegmentMerger.mergeTerms(SegmentMerger.java:383)\n        at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:116)\n        at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:3693)\n        at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3296)\n        at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:401)\n        at org.apache.lucene.index.TrackingConcurrentMergeScheduler.doMerge(TrackingConcurrentMergeScheduler.java:91)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:478)\n[2013-05-23 22:13:01,939][WARN ][index.engine.robin       ] [Rocket Racer] [twitter_history_76816072][1] failed engine\norg.apache.lucene.index.MergePolicy$MergeException: org.elasticsearch.ElasticSearchIllegalStateException: no index mapper found for field: [entities.description.urls.display_url]\n        at org.elasticsearch.index.merge.scheduler.ConcurrentMergeSchedulerProvider$CustomConcurrentMergeScheduler.handleMergeException(ConcurrentMergeSchedulerProvider.java:100)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:514)\nCaused by: org.elasticsearch.ElasticSearchIllegalStateException: no index mapper found for field: [entities.description.urls.display_url]\n        at org.elasticsearch.index.codec.PerFieldMappingPostingFormatCodec.getPostingsFormatForField(PerFieldMappingPostingFormatCodec.java:52)\n        at org.apache.lucene.codecs.lucene42.Lucene42Codec$1.getPostingsFormatForField(Lucene42Codec.java:59)\n        at org.apache.lucene.codecs.perfield.PerFieldPostingsFormat$FieldsWriter.addField(PerFieldPostingsFormat.java:102)\n        at org.apache.lucene.codecs.FieldsConsumer.merge(FieldsConsumer.java:71)\n        at org.apache.lucene.index.SegmentMerger.mergeTerms(SegmentMerger.java:383)\n        at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:116)\n        at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:3693)\n        at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3296)\n        at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:401)\n        at org.apache.lucene.index.TrackingConcurrentMergeScheduler.doMerge(TrackingConcurrentMergeScheduler.java:91)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:478)\n[2013-05-23 22:13:04,187][WARN ][cluster.action.shard     ] [Rocket Racer] sending failed shard for [twitter_history_76816072][1], node[_1cPivHASUOzVcgQ2fK0_A], [P], s[INITIALIZING], reason [engine failure, message [MergeException[org.elasticsearch.ElasticSearchIllegalStateException: no index mapper found for field: [entities.description.urls.display_url]]; nested: ElasticSearchIllegalStateException[no index mapper found for field: [entities.description.urls.display_url]]; ]]\n[2013-05-23 22:13:04,234][WARN ][cluster.action.shard     ] [Rocket Racer] received shard failed for [twitter_history_76816072][1], node[_1cPivHASUOzVcgQ2fK0_A], [P], s[INITIALIZING], reason [engine failure, message [MergeException[org.elasticsearch.ElasticSearchIllegalStateException: no index mapper found for field: [entities.description.urls.display_url]]; nested: ElasticSearchIllegalStateException[no index mapper found for field: [entities.description.urls.display_url]]; ]]\n[2013-05-23 22:13:07,433][WARN ][indices.cluster          ] [Rocket Racer] [twitter_history_76816072][1] master [[Rocket Racer][_1cPivHASUOzVcgQ2fK0_A][inet[/10.178.13.201:9300]]] marked shard as started, but shard have not been created, mark shard as failed\n[2013-05-23 22:13:07,446][WARN ][cluster.action.shard     ] [Rocket Racer] sending failed shard for [twitter_history_76816072][1], node[_1cPivHASUOzVcgQ2fK0_A], [P], s[STARTED], reason [master [Rocket Racer][_1cPivHASUOzVcgQ2fK0_A][inet[/10.178.13.201:9300]] marked shard as started, but shard have not been created, mark shard as failed]\n[2013-05-23 22:13:07,446][WARN ][cluster.action.shard     ] [Rocket Racer] received shard failed for [twitter_history_76816072][1], node[_1cPivHASUOzVcgQ2fK0_A], [P], s[STARTED], reason [master [Rocket Racer][_1cPivHASUOzVcgQ2fK0_A][inet[/10.178.13.201:9300]] marked shard as started, but shard have not been created, mark shard as failed]\n\nThe best guess I have is that some random data is breaking the creation of new mappings. The same is happening on the same index in both production and test environments. Other indexes with the same initial mappings but different Twitter data content are not exhibiting the same error. \n\nI'm trying to capture the data, although there is a mass of it. Therefore before I go too far, has anybody got any clue how I can start to identify the source of the problem?\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}