{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3309","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3309/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3309/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3309/events","html_url":"https://github.com/elastic/elasticsearch/issues/3309","id":16572372,"node_id":"MDU6SXNzdWUxNjU3MjM3Mg==","number":3309,"title":"Script based sorting is applied only after pagination","user":{"login":"peschlowp","id":1713347,"node_id":"MDQ6VXNlcjE3MTMzNDc=","avatar_url":"https://avatars1.githubusercontent.com/u/1713347?v=4","gravatar_id":"","url":"https://api.github.com/users/peschlowp","html_url":"https://github.com/peschlowp","followers_url":"https://api.github.com/users/peschlowp/followers","following_url":"https://api.github.com/users/peschlowp/following{/other_user}","gists_url":"https://api.github.com/users/peschlowp/gists{/gist_id}","starred_url":"https://api.github.com/users/peschlowp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peschlowp/subscriptions","organizations_url":"https://api.github.com/users/peschlowp/orgs","repos_url":"https://api.github.com/users/peschlowp/repos","events_url":"https://api.github.com/users/peschlowp/events{/privacy}","received_events_url":"https://api.github.com/users/peschlowp/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":45109570,"node_id":"MDU6TGFiZWw0NTEwOTU3MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.3","name":"v0.90.3","color":"DDDDDD","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2013-07-10T11:29:19Z","updated_at":"2013-07-15T13:44:58Z","closed_at":"2013-07-15T13:44:58Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When a query requests both sorting and pagination, the expected behavior is that sorting is executed _before_ pagination. And indeed this is the actual behavior when the query requests sorting on a field level. However, when doing script based sorting, it seems that sorting is only executed _after_ pagination. This is behavior is unexpected and especially surprising because the same sort may yield different results depending on whether it is specified on a field level or via a script.\n\nExample\n\nSuppose we have 100 files indexed, named \"file001\", \"file002\", ..., \"file100\", with the file name being stored in a \"filename\" field. Then the following query\n\n```\n{\n  \"from\" : 0,\n  \"size\" : 10,\n  \"query\" : {\n    \"match_all\" : { }\n  },\n  \"sort\" : [ {\n    \"filename\" : {\n      \"order\" : \"asc\"\n    }\n  } ]\n}\n```\n\nyields the expected ordering \"file001\", \"file002\", ..., \"file010\". The seemingly equivalent query\n\n```\n{\n  \"from\" : 0,\n  \"size\" : 10,\n  \"query\" : {\n    \"match_all\" : { }\n  },\n  \"sort\" : [ {\n    \"_script\" : {\n      \"script\" : \"doc['filename'].value\",\n      \"type\" : \"string\"\n    }\n  } ]\n}\n```\n\nmay return, for example, \"file005\", \"file007\", \"file020\", \"file027\", \"file035\", \"file050\", \"file067\", \"file080\", \"file092\", \"file097\". Which is pretty useless and certainly not what the client would expect.\n\nThis behavior was observed in ElasticSearch 0.90.2, but I didn't test previous versions.\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}