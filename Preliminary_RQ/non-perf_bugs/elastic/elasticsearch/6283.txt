{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6283","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6283/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6283/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6283/events","html_url":"https://github.com/elastic/elasticsearch/issues/6283","id":34084292,"node_id":"MDU6SXNzdWUzNDA4NDI5Mg==","number":6283,"title":"Registering a custom parser to be used an instance per thread","user":{"login":"jkot","id":1260637,"node_id":"MDQ6VXNlcjEyNjA2Mzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1260637?v=4","gravatar_id":"","url":"https://api.github.com/users/jkot","html_url":"https://github.com/jkot","followers_url":"https://api.github.com/users/jkot/followers","following_url":"https://api.github.com/users/jkot/following{/other_user}","gists_url":"https://api.github.com/users/jkot/gists{/gist_id}","starred_url":"https://api.github.com/users/jkot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkot/subscriptions","organizations_url":"https://api.github.com/users/jkot/orgs","repos_url":"https://api.github.com/users/jkot/repos","events_url":"https://api.github.com/users/jkot/events{/privacy}","received_events_url":"https://api.github.com/users/jkot/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2014-05-22T14:01:50Z","updated_at":"2014-05-23T10:29:23Z","closed_at":"2014-05-23T10:03:42Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, as [requested on Twitter](https://twitter.com/kimchy/status/469261081136103424), I'm describing an issue I encountered yesterday.\n\nI registered a custom query parser, relevant snippets:\n\n```\n// in RegisterJsonQueryParser.java: \nindicesQueriesRegistry.addQueryParser(parser); \n\n// in SirenJsonParserModule.java:\nbind(RegisterJsonQueryParser.class); \n\n// in SirenPlugin.java:\nmodule.addQueryParser(SirenJsonParser.NAME, SirenJsonParser.class); \n```\n\nWhen issuing a query, I see a lot of different exceptions (ConcurrentModificationException, NullPointerException, ...). The problem is that `SirenJsonParser` is not thread-safe and ElasticSearch uses a single instance of it from different threads.\n\nIn comparison, this was never a problem in Solr.\n\nShould I register my parser differently? I looked at the API but didn't notice anything relevant.\n\nFor now I'm creating a new parser in each SirenJsonParser.parse() call.\n\nI'm using ElasticSearch `1.1.1`.\n","closed_by":{"login":"jkot","id":1260637,"node_id":"MDQ6VXNlcjEyNjA2Mzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1260637?v=4","gravatar_id":"","url":"https://api.github.com/users/jkot","html_url":"https://github.com/jkot","followers_url":"https://api.github.com/users/jkot/followers","following_url":"https://api.github.com/users/jkot/following{/other_user}","gists_url":"https://api.github.com/users/jkot/gists{/gist_id}","starred_url":"https://api.github.com/users/jkot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkot/subscriptions","organizations_url":"https://api.github.com/users/jkot/orgs","repos_url":"https://api.github.com/users/jkot/repos","events_url":"https://api.github.com/users/jkot/events{/privacy}","received_events_url":"https://api.github.com/users/jkot/received_events","type":"User","site_admin":false},"performed_via_github_app":null}