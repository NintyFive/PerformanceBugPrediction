{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21221","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21221/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21221/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21221/events","html_url":"https://github.com/elastic/elasticsearch/issues/21221","id":186390510,"node_id":"MDU6SXNzdWUxODYzOTA1MTA=","number":21221,"title":"Restore original update bulk item request on retry","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":777829541,"node_id":"MDU6TGFiZWw3Nzc4Mjk1NDE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.3","name":"v6.0.3","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-10-31T20:35:11Z","updated_at":"2018-03-20T14:35:18Z","closed_at":"2018-03-20T14:35:17Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Currently, when we execute a update request as part of bulk, \r\nthe update request is translated to a `index` or `delete` request \r\nat the shard level for primary execution and the translated request \r\nis set for replica execution. If the shard bulk request throws an exception, \r\nwe restore the original version and version type for all bulk item requests \r\nbut we don't restore the original update request (instead we use the \r\ntranslated update request). Opening this issue to figure out how to properly \r\nrestore update requests in bulk in case of failure in shard bulk execution. \r\n\r\nsee https://github.com/elastic/elasticsearch/pull/19105#discussion_r85712023 ","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}