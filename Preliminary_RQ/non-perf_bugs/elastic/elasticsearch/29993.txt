{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29993/events","html_url":"https://github.com/elastic/elasticsearch/issues/29993","id":317450545,"node_id":"MDU6SXNzdWUzMTc0NTA1NDU=","number":29993,"title":"[ML] Consider pausing datafeeds if the indices being queried are in recovery","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-03-27T08:43:30Z","updated_at":"2020-07-03T18:01:06Z","closed_at":"2020-07-03T18:01:06Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"*Original comment by @droberts195:*\n\nML datafeeds query an index pattern periodically to supply data to ML jobs.  They currently have no knowledge of cluster events that affect the availability of those indices.\r\n\r\nWe could improve this by querying the [indices recovery API](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-recovery.html) using the same index pattern before doing each datafeed search, and skipping the search if any of the matched indices are in a state that would lead to incomplete results.\r\n\r\nThis was suggested by @uric in Tahoe related to the snapshot/restore problem, but actually it has wider benefits for other situations that cause indices to be in recovery.\r\n\r\nSo far the problems we've seen with ML datafeeds causing problems in Cloud have been due to snapshot/restore, but making this change could preemptively prevent future problems that we have not yet observed with other recovery events interacting with ML datafeeds.","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}