{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3779","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3779/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3779/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3779/events","html_url":"https://github.com/elastic/elasticsearch/issues/3779","id":20050953,"node_id":"MDU6SXNzdWUyMDA1MDk1Mw==","number":3779,"title":"date_histogram facet with numeric interval is incorrect for negative timestamps (pre-1970)","user":{"login":"gareth","id":4975,"node_id":"MDQ6VXNlcjQ5NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/4975?v=4","gravatar_id":"","url":"https://api.github.com/users/gareth","html_url":"https://github.com/gareth","followers_url":"https://api.github.com/users/gareth/followers","following_url":"https://api.github.com/users/gareth/following{/other_user}","gists_url":"https://api.github.com/users/gareth/gists{/gist_id}","starred_url":"https://api.github.com/users/gareth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gareth/subscriptions","organizations_url":"https://api.github.com/users/gareth/orgs","repos_url":"https://api.github.com/users/gareth/repos","events_url":"https://api.github.com/users/gareth/events{/privacy}","received_events_url":"https://api.github.com/users/gareth/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2013-09-25T15:49:55Z","updated_at":"2014-01-22T11:51:19Z","closed_at":"2014-01-22T11:51:19Z","author_association":"NONE","active_lock_reason":null,"body":"Here are 4 musicians born in different decades:\n\n```\ncurl -XPUT http://localhost:9200/musicians/will/jones -d '{\"name\": \"Will Jones\", \"born\": \"1928-05-14\"}'\ncurl -XPUT http://localhost:9200/musicians/will/smith -d '{\"name\": \"Will Smith\", \"born\": \"1968-09-25\"}'\ncurl -XPUT http://localhost:9200/musicians/will/iam -d '{\"name\": \"will.i.am\", \"born\": \"1975-03-15\"}'\ncurl -XPUT http://localhost:9200/musicians/will/young -d '{\"name\": \"Will Young\", \"born\": \"1982-01-20\"}'\n```\n\nTo facet these by decade I am using `interval: 315576000000` although I realise this will result in boundaries which are out by a few days per decade (due to leap years/seconds).\n\n```\ncurl http://localhost:9200/musicians/will/_search -d '{ \"query\": { \"match_all\": {} }, \"facets\": { \"year\": { \"date_histogram\": { \"field\": \"born\", \"interval\": 315576000000 } } } }' | python -mjson.tool\n\n[…],\n\"facets\": {\n    \"year\": {\n        \"_type\": \"date_histogram\",\n        \"entries\": [\n            {\n                \"count\": 1,\n                \"time\": -1262304000000\n            },\n            {\n                \"count\": 2,\n                \"time\": 0\n            },\n            {\n                \"count\": 1,\n                \"time\": 315576000000\n            }\n        ]\n    }\n},\n[…],\n```\n\nNote that the facet has merged two results into the facet with time=0 (1970s). Also, Will Jones has been put into the 1930s bucket.\n\n```\nruby -e 'puts Time.at(-1262304000000 / 1000)'\n1930-01-01 00:00:00 +0000\n```\n\nIt seems like timestamps have been grouped by rounding negative numbers towards zero rather than rounding down?\n\nFor reference:\n\n```\ncurl -XGET http://localhost:9200/\n{\n  \"ok\" : true,\n  \"status\" : 200,\n  \"name\" : \"Obliterator\",\n  \"version\" : {\n    \"number\" : \"0.90.5\",\n    \"build_hash\" : \"c8714e8e0620b62638f660f6144831792b9dedee\",\n    \"build_timestamp\" : \"2013-09-17T12:50:20Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.4\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}