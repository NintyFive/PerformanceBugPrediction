{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3200","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3200/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3200/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3200/events","html_url":"https://github.com/elastic/elasticsearch/issues/3200","id":15682276,"node_id":"MDU6SXNzdWUxNTY4MjI3Ng==","number":3200,"title":"Elasticsearch Highlighting problem (0.90.1)","user":{"login":"kuttiKumarv","id":97300,"node_id":"MDQ6VXNlcjk3MzAw","avatar_url":"https://avatars1.githubusercontent.com/u/97300?v=4","gravatar_id":"","url":"https://api.github.com/users/kuttiKumarv","html_url":"https://github.com/kuttiKumarv","followers_url":"https://api.github.com/users/kuttiKumarv/followers","following_url":"https://api.github.com/users/kuttiKumarv/following{/other_user}","gists_url":"https://api.github.com/users/kuttiKumarv/gists{/gist_id}","starred_url":"https://api.github.com/users/kuttiKumarv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kuttiKumarv/subscriptions","organizations_url":"https://api.github.com/users/kuttiKumarv/orgs","repos_url":"https://api.github.com/users/kuttiKumarv/repos","events_url":"https://api.github.com/users/kuttiKumarv/events{/privacy}","received_events_url":"https://api.github.com/users/kuttiKumarv/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":45109570,"node_id":"MDU6TGFiZWw0NTEwOTU3MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.3","name":"v0.90.3","color":"DDDDDD","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2013-06-18T11:38:36Z","updated_at":"2013-07-08T13:21:04Z","closed_at":"2013-07-08T12:49:25Z","author_association":"NONE","active_lock_reason":null,"body":"I am working on  upgradion of elasticsearch from 0.20.2 to 0.90.1 and come across the following issue.\nElasticsearch Highlighting was working fine(getting results as we expected) in 0.20.2, but the same doesnâ€™t work in ES 0.90.1 \"type\": \"pattern\",\n\nSteps to reproduce the issue\n\nEnvironment:\nJDK 1.7,Windows 7, elasticsearch 0.90.1, used elasticsearch head plugin to create/query documents\n\nStep 1:-\nDefined mappings and settings for index(test_hightlight)/type(hightlight).\n\nhttp://localhost:9200/test_hightlight   [POST]\n\n{\n  \"settings\": {\n    \"index\": {\n      \"number_of_shards\": 6,\n      \"number_of_replicas\": 2,\n      \"analysis\": {\n        \"analyzer\": {\n          \"CommaAnalyzer\": {\n            \"type\": \"pattern\",\n            \"flags\": \"DOTALL\",\n            \"lowercase\": \"true\",\n            \"pattern\": \"\\,\",\n            \"stopwords\": \"_none_\"\n          }\n        }\n      }\n    }\n  },\n  \"mappings\": {\n    \"hightlight\": {\n      \"properties\": {\n        \"documentName\": {\n          \"analyzer\": \"CommaAnalyzer\",\n          \"type\": \"string\"\n        },\n        \"description\": {\n          \"analyzer\": \"CommaAnalyzer\",\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n\nStep2: \nIndexed following documents to newly created Index.\n\n```\nhttp://localhost:9200/test_hightlight/hightlight/1001  [POST]\n{\n    \"documentName\":\"business Contract JSON business vendor and rep credentialing program ensures that Kutti Kumar and reps you are doing business with meet your requirements and are sound business partners With the business Small Business Package you can be where the buyers business are Not only do you get Business access to more than Business 1800 business hospitals you can BUSINESS promote your business in the only credentialed supplier sourcing tool used by Business healthcare organizations across business the country\",\n    \"description\":\"Manage Kutti Kumar access and influence permissions Monitor Kutti Kumar sanction and financial details\"\n\n}\n\nhttp://localhost:9200/test_hightlight/hightlight/1002  [POST]\n{\n    \"documentName\":\"business JSON Communicating and managing those standards across all of your vendors can be a coordination nightmare Let business manage it for you Kutti Kumar\",\n    \"description\":\"notifications and management enable you to have better insight to your business Kutti Kumar\"\n\n}\n\nhttp://localhost:9200/test_hightlight/hightlight/1003  [POST]\n{\n  \"documentName\": \"Kutti Kumar business JSON Communicating and managing those standards across all of your vendors can be a coordination nightmare Let business manage it for Kutti Kumar\",\n  \"description\": \"Kutti Kumar notifications and management enable Kutti Kumar to have better insight to your business\"\n}\n```\n\nStep3:\nExecuted the following query \n\nURL:http://localhost:9200/test_hightlight/  \nQuery:\n\n{\n  \"timeout\": 60000,\n  \"query\": {\n    \"bool\": {\n      \"must\": {\n        \"query_string\": {\n          \"query\": \"business\",\n          \"default_operator\": \"and\"\n        }\n      }\n    }\n  },\n  \"explain\": false,\n  \"highlight\": {\n    \"pre_tags\": [\n      \"<em>\"\n    ],\n    \"post_tags\": [\n      \"</em>\"\n    ],\n    \"fields\": {\n      \"documentName\": {\n        \"fragment_size\": 20,\n        \"number_of_fragments\": 5,\n        \"fragment_offset\": 0\n      }\n    }\n  }\n}\n\nGot the following error\n\n{\n\n```\ntook: 20\ntimed_out: false\n_shards: {\n    total: 6\n    successful: 3\n    failed: 3\n    failures: [\n        {\n            index: test_hightlight\n            shard: 3\n            status: 500\n            reason: FetchPhaseExecutionException[[test_hightlight][3]: query[_all:business],from[0],size[10]: Fetch Failed [Failed to highlight field [documentName]]]; nested: IOException[Stream closed]; \n        }\n        {\n            index: test_hightlight\n            shard: 4\n            status: 500\n            reason: FetchPhaseExecutionException[[test_hightlight][4]: query[_all:business],from[0],size[10]: Fetch Failed [Failed to highlight field [documentName]]]; nested: IOException[Stream closed]; \n        }\n        {\n            index: test_hightlight\n            shard: 5\n            status: 500\n            reason: FetchPhaseExecutionException[[test_hightlight][5]: query[_all:business],from[0],size[10]: Fetch Failed [Failed to highlight field [documentName]]]; nested: IOException[Stream closed]; \n        }\n    ]\n}\nhits: {\n    total: 3\n    max_score: 0.12557761\n    hits: [ ]\n}\n```\n\n}\n\nNote: The same query is working as we expected with Elasticsearch 0.20.2\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}