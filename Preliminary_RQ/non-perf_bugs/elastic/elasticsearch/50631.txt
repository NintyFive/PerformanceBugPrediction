{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50631/events","html_url":"https://github.com/elastic/elasticsearch/issues/50631","id":545331771,"node_id":"MDU6SXNzdWU1NDUzMzE3NzE=","number":50631,"title":"RPM update to 7.5.1 prevents start of elasticsearch","user":{"login":"erempel","id":8525120,"node_id":"MDQ6VXNlcjg1MjUxMjA=","avatar_url":"https://avatars3.githubusercontent.com/u/8525120?v=4","gravatar_id":"","url":"https://api.github.com/users/erempel","html_url":"https://github.com/erempel","followers_url":"https://api.github.com/users/erempel/followers","following_url":"https://api.github.com/users/erempel/following{/other_user}","gists_url":"https://api.github.com/users/erempel/gists{/gist_id}","starred_url":"https://api.github.com/users/erempel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erempel/subscriptions","organizations_url":"https://api.github.com/users/erempel/orgs","repos_url":"https://api.github.com/users/erempel/repos","events_url":"https://api.github.com/users/erempel/events{/privacy}","received_events_url":"https://api.github.com/users/erempel/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"assignees":[{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false}],"milestone":null,"comments":17,"created_at":"2020-01-04T20:57:57Z","updated_at":"2020-11-11T21:54:51Z","closed_at":"2020-02-14T19:41:30Z","author_association":"NONE","active_lock_reason":null,"body":"Platform: Redhat EL 7.7 (systemd)\r\nPrevious ES package:  elasticsearch-7.4.2-1.x86_64\r\nUpgraded ES package: elasticsearch-7.5.1-1.x86_64\r\n\r\nES forum post at\r\nhttps://discuss.elastic.co/t/elasticsearch-7-5-1-rpm-update-prevents-restart-of-service/213636\r\n\r\nmade me look into things more.\r\n\r\nAfter the upgrade and host reboot, the ES service would not start and gave the error\r\n\r\nException in thread \"main\" org.elasticsearch.bootstrap.BootstrapException: org.elasticsearch.cli.UserException: unable to create temporary keystore at [/etc/elasticsearch/elasticsearch.keystore.tmp], write permissions required for [/etc/elasticsearch] or run [elasticsearch-keystore upgrade]\r\n\r\nI can confirm that there is a \"posttrans scriptlet\" in the RPM used used during the upgrade and that the scriptlet containes the commands to perform the keystore upgrade, and that this scriptet was run at the time of the update (we upgrade automatically starting at 04:00)\r\n\r\n% ls -al /etc/elasticsearch/.elasticsearch.keystore.initial_md5sum\r\n-rw-r--r--    1 root          elasticsearch     0 Jan  1 04:34 .elasticsearch.keystore.initial_md5sum\r\n\r\nAdding group write permissions to the /etc/elasticsearch directory permitted the service to start, which create or rewrote the keystore file.\r\n\r\n% ls -al /etc/elasticsearch/elasticsearch.keystore\r\n-rw-rw----    1 elasticsearch elasticsearch   199 Jan  2 14:57 elasticsearch.keystore\r\n\r\nTwo things I note\r\n\r\n1. The posttrans scriptlet sets the owner:group of the keystore file to root:elasticsearch however, after the service started the file is owned by elasticsearch:elasticsearch\r\n\r\n2. The md5sum output file is of size 0, which indicates to me that the posttrans scriptlet failed to create the initial keystore file, or perhaps ran the \"else\" clause of the posttrans scriptlet which only created the md5sum file.\r\n\r\n","closed_by":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"performed_via_github_app":null}