{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/60889","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60889/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60889/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60889/events","html_url":"https://github.com/elastic/elasticsearch/issues/60889","id":676105623,"node_id":"MDU6SXNzdWU2NzYxMDU2MjM=","number":60889,"title":"Stackoverflow in Response ","user":{"login":"skombijohn","id":4631128,"node_id":"MDQ6VXNlcjQ2MzExMjg=","avatar_url":"https://avatars3.githubusercontent.com/u/4631128?v=4","gravatar_id":"","url":"https://api.github.com/users/skombijohn","html_url":"https://github.com/skombijohn","followers_url":"https://api.github.com/users/skombijohn/followers","following_url":"https://api.github.com/users/skombijohn/following{/other_user}","gists_url":"https://api.github.com/users/skombijohn/gists{/gist_id}","starred_url":"https://api.github.com/users/skombijohn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skombijohn/subscriptions","organizations_url":"https://api.github.com/users/skombijohn/orgs","repos_url":"https://api.github.com/users/skombijohn/repos","events_url":"https://api.github.com/users/skombijohn/events{/privacy}","received_events_url":"https://api.github.com/users/skombijohn/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"}],"state":"closed","locked":false,"assignee":{"login":"andreidan","id":1217601,"node_id":"MDQ6VXNlcjEyMTc2MDE=","avatar_url":"https://avatars2.githubusercontent.com/u/1217601?v=4","gravatar_id":"","url":"https://api.github.com/users/andreidan","html_url":"https://github.com/andreidan","followers_url":"https://api.github.com/users/andreidan/followers","following_url":"https://api.github.com/users/andreidan/following{/other_user}","gists_url":"https://api.github.com/users/andreidan/gists{/gist_id}","starred_url":"https://api.github.com/users/andreidan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreidan/subscriptions","organizations_url":"https://api.github.com/users/andreidan/orgs","repos_url":"https://api.github.com/users/andreidan/repos","events_url":"https://api.github.com/users/andreidan/events{/privacy}","received_events_url":"https://api.github.com/users/andreidan/received_events","type":"User","site_admin":false},"assignees":[{"login":"andreidan","id":1217601,"node_id":"MDQ6VXNlcjEyMTc2MDE=","avatar_url":"https://avatars2.githubusercontent.com/u/1217601?v=4","gravatar_id":"","url":"https://api.github.com/users/andreidan","html_url":"https://github.com/andreidan","followers_url":"https://api.github.com/users/andreidan/followers","following_url":"https://api.github.com/users/andreidan/following{/other_user}","gists_url":"https://api.github.com/users/andreidan/gists{/gist_id}","starred_url":"https://api.github.com/users/andreidan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreidan/subscriptions","organizations_url":"https://api.github.com/users/andreidan/orgs","repos_url":"https://api.github.com/users/andreidan/repos","events_url":"https://api.github.com/users/andreidan/events{/privacy}","received_events_url":"https://api.github.com/users/andreidan/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2020-08-10T12:41:06Z","updated_at":"2020-09-01T13:54:43Z","closed_at":"2020-09-01T13:54:43Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.8\r\n\r\n**Plugins installed**: [] none\r\n\r\n**JVM version** (`java -version`): shipped version\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Windows 10 64bit\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI am in a migration process from \"legacy\" index templates to the new composed templates.\r\nAs I introduced the composed templates into my application, I will have to remove existing legacy index templates in a \"changelog\" step.\r\n\r\nTo test my code, I created a test, that will boot up the actual elasticsearch 7.8 with the actual new composed templates.\r\nThen (in my test only) I create a handful of legacy templates, to allow testing the removal code.\r\n\r\nWhen inserting one of the legacy templates, I get an stackoverflow in some RegEx matching.\r\n\r\nIn fact, I debugged that to the point, where the response is parsed. The response contains a \"warning header\", which in my case contains the following error:\r\n\r\n(Note: the actual template names are pseudonymized here for company reasons...)\r\n\r\n`299 Elasticsearch-7.8.0-757314695644ea9a1dc2fecd26d1a43856725e65 \"legacy template [default] has index patterns [*] matching patterns from existing composable templates [templateA, templateB, ...] with patterns (templateA=> [templateA*],templateB=> [templateB*],... => [...*],...); this template [default] may be ignored in favor of a composable template at index creation time\"`\r\n\r\nTo clear this up:\r\nIn my legacy templates there was a \"default\" template with some settings, that are meant to match all actual indices with the old \"inheritance\" style mechanism with order 0 and so on. Therefore the matching pattern of the \"default\" template was \"*\".\r\n\r\nThe follow up code, see stacktrace below, will try to do some matching of some kind against a monster regexp. \r\nSomewhere in there, a stackoverflow occurs..\r\n\r\nStacktrace:\r\n`\r\nmatch:4614, Pattern$Branch (java.util.regex)\r\nmatch0:4293, Pattern$Curly (java.util.regex)\r\nmatch:4248, Pattern$Curly (java.util.regex)\r\nmatch:3812, Pattern$BmpCharProperty (java.util.regex)\r\nmatch0:4293, Pattern$Curly (java.util.regex)\r\nmatch:4248, Pattern$Curly (java.util.regex)\r\nmatch:3812, Pattern$BmpCharProperty (java.util.regex)\r\nmatch0:4293, Pattern$Curly (java.util.regex)\r\nmatch:4248, Pattern$Curly (java.util.regex)\r\nmatch:3986, Pattern$Slice (java.util.regex)\r\nmatch:1270, Matcher (java.util.regex)\r\nmatches:604, Matcher (java.util.regex)\r\nassertWarningValue:194, Response (org.elasticsearch.client)\r\nextractWarningValueFromWarningHeader:185, Response (org.elasticsearch.client)\r\ngetWarnings:207, Response (org.elasticsearch.client)\r\nconvertResponse:278, RestClient (org.elasticsearch.client)\r\nperformRequest:261, RestClient (org.elasticsearch.client)\r\nperformRequest:235, RestClient (org.elasticsearch.client)\r\ninternalPerformRequest:1611, RestHighLevelClient (org.elasticsearch.client)\r\nperformRequest:1581, RestHighLevelClient (org.elasticsearch.client)\r\nperformRequestAndParseEntity:1551, RestHighLevelClient (org.elasticsearch.client)\r\nputTemplate:1279, IndicesClient (org.elasticsearch.client)\r\naddLegacyTemplate:59, RemoveLegacyTemplatesIT (my.secret.package)`\r\n`\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Boot up an empty cluster of ES 7.8\r\n 2. Insert some composable templates and some index templates with matchPatters like \"indexA*\", \"indexB*\" etc.\r\n 3. After that, insert the following LEGACY template:\r\n\r\n`\r\n{\r\n  \"order\": 0,\r\n  \"version\": 1,\r\n  \"index_patterns\": [\r\n    \"*\"\r\n  ],\r\n  \"settings\": {\r\n    \"index\": {\r\n      \"number_of_shards\": \"2\",\r\n      \"auto_expand_replicas\": \"0-2\",\r\n      \"number_of_replicas\": \"0\",\r\n      \"max_result_window\": 5000000,\r\n      \"search\": {\r\n        \"idle\": {\r\n          \"after\": \"10s\"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"mappings\": {\r\n    \"dynamic\": false,\r\n    \"properties\": {\r\n      \"createdAt\": {\r\n        \"type\": \"date\",\r\n        \"format\": \"epoch_millis\"\r\n      },\r\n      \"lastChange\": {\r\n        \"type\": \"date\",\r\n        \"format\": \"epoch_millis\"\r\n      }\r\n    }\r\n  },\r\n  \"aliases\": {}\r\n}\r\n`\r\n4. The above mentioned response can be seen in RestClient#convertResponse.\r\n5. When that code invokes Response#getWarnings, the StackOverflow will occur.\r\n\r\n\r\n","closed_by":{"login":"andreidan","id":1217601,"node_id":"MDQ6VXNlcjEyMTc2MDE=","avatar_url":"https://avatars2.githubusercontent.com/u/1217601?v=4","gravatar_id":"","url":"https://api.github.com/users/andreidan","html_url":"https://github.com/andreidan","followers_url":"https://api.github.com/users/andreidan/followers","following_url":"https://api.github.com/users/andreidan/following{/other_user}","gists_url":"https://api.github.com/users/andreidan/gists{/gist_id}","starred_url":"https://api.github.com/users/andreidan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreidan/subscriptions","organizations_url":"https://api.github.com/users/andreidan/orgs","repos_url":"https://api.github.com/users/andreidan/repos","events_url":"https://api.github.com/users/andreidan/events{/privacy}","received_events_url":"https://api.github.com/users/andreidan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}