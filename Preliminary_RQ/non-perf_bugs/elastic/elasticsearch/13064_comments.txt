[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134376166","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-134376166","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":134376166,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDM3NjE2Ng==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-08-24T20:50:36Z","updated_at":"2015-08-24T20:50:36Z","author_association":"MEMBER","body":"@RanadeepPolavarapu the `inner_hits` syntax in the query dsl doesn't support proper nested. For now you should use the top level `inner_hits` syntax: https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-inner-hits.html#top-level-inner-hits\n\nThis issue is related to this ticket: #11118\nAlthough this ticket is about parent/child inner hits, the the nested inner_hits in the query dsl doesn't work there too and this should be fixed\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134543253","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-134543253","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":134543253,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDU0MzI1Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-08-25T10:00:00Z","updated_at":"2015-08-25T10:00:00Z","author_association":"CONTRIBUTOR","body":"Closing as duplicate of #11118\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/135437348","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-135437348","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":135437348,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNTQzNzM0OA==","user":{"login":"RanadeepPolavarapu","id":7084995,"node_id":"MDQ6VXNlcjcwODQ5OTU=","avatar_url":"https://avatars1.githubusercontent.com/u/7084995?v=4","gravatar_id":"","url":"https://api.github.com/users/RanadeepPolavarapu","html_url":"https://github.com/RanadeepPolavarapu","followers_url":"https://api.github.com/users/RanadeepPolavarapu/followers","following_url":"https://api.github.com/users/RanadeepPolavarapu/following{/other_user}","gists_url":"https://api.github.com/users/RanadeepPolavarapu/gists{/gist_id}","starred_url":"https://api.github.com/users/RanadeepPolavarapu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RanadeepPolavarapu/subscriptions","organizations_url":"https://api.github.com/users/RanadeepPolavarapu/orgs","repos_url":"https://api.github.com/users/RanadeepPolavarapu/repos","events_url":"https://api.github.com/users/RanadeepPolavarapu/events{/privacy}","received_events_url":"https://api.github.com/users/RanadeepPolavarapu/received_events","type":"User","site_admin":false},"created_at":"2015-08-27T13:48:30Z","updated_at":"2015-08-27T13:48:30Z","author_association":"NONE","body":"@martijnvg How could I replicate that query correctly using top level `inner_hits`? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/135524830","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-135524830","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":135524830,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNTUyNDgzMA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-08-27T19:04:22Z","updated_at":"2015-08-27T19:04:22Z","author_association":"MEMBER","body":"@RanadeepPolavarapu the following query should work:\n\n```\ncurl -XGET \"http://localhost:9200/_search\" -d'\n{\n  \"query\": {\n    \"nested\": {\n      \"path\": \"cars\",\n      \"query\": {\n        \"nested\": {\n          \"path\": \"cars.manufacturers\",\n          \"query\": {\n            \"match\": {\n              \"cars.manufacturers.country\": \"Japan\"\n            }\n          }\n        }\n      }\n    }\n  },\n  \"inner_hits\": {\n    \"cars\": {\n      \"path\": {\n        \"cars\": {\n          \"query\": {\n            \"nested\": {\n              \"path\": \"cars.manufacturers\",\n              \"query\": {\n                \"match\": {\n                  \"cars.manufacturers.country\": \"Japan\"\n                }\n              }\n            }\n          },\n          \"inner_hits\": {\n            \"manufacturers\": {\n              \"path\": {\n                \"cars.manufacturers\": {\n                  \"query\": {\n                    \"match\": {\n                      \"cars.manufacturers.country\": \"Japan\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}'\n```\n\nDownside that It is more verbose, because the query needs to be repeated on each nested level. When the embedded query dsl `inner_hits` syntax also properly supports multiple level of nested object fields and parent child relations then your query should work too.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/177971934","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-177971934","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":177971934,"node_id":"MDEyOklzc3VlQ29tbWVudDE3Nzk3MTkzNA==","user":{"login":"abulhol","id":4851778,"node_id":"MDQ6VXNlcjQ4NTE3Nzg=","avatar_url":"https://avatars3.githubusercontent.com/u/4851778?v=4","gravatar_id":"","url":"https://api.github.com/users/abulhol","html_url":"https://github.com/abulhol","followers_url":"https://api.github.com/users/abulhol/followers","following_url":"https://api.github.com/users/abulhol/following{/other_user}","gists_url":"https://api.github.com/users/abulhol/gists{/gist_id}","starred_url":"https://api.github.com/users/abulhol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abulhol/subscriptions","organizations_url":"https://api.github.com/users/abulhol/orgs","repos_url":"https://api.github.com/users/abulhol/repos","events_url":"https://api.github.com/users/abulhol/events{/privacy}","received_events_url":"https://api.github.com/users/abulhol/received_events","type":"User","site_admin":false},"created_at":"2016-02-01T13:28:06Z","updated_at":"2016-02-01T13:28:06Z","author_association":"NONE","body":"+1 \nI am wondering why the reference includes this paragraph:\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-inner-hits.html#hierarchical-nested-inner-hits\nwhich seems exactly the part that is not working\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251129440","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-251129440","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":251129440,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTEyOTQ0MA==","user":{"login":"black-square","id":3925065,"node_id":"MDQ6VXNlcjM5MjUwNjU=","avatar_url":"https://avatars3.githubusercontent.com/u/3925065?v=4","gravatar_id":"","url":"https://api.github.com/users/black-square","html_url":"https://github.com/black-square","followers_url":"https://api.github.com/users/black-square/followers","following_url":"https://api.github.com/users/black-square/following{/other_user}","gists_url":"https://api.github.com/users/black-square/gists{/gist_id}","starred_url":"https://api.github.com/users/black-square/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/black-square/subscriptions","organizations_url":"https://api.github.com/users/black-square/orgs","repos_url":"https://api.github.com/users/black-square/repos","events_url":"https://api.github.com/users/black-square/events{/privacy}","received_events_url":"https://api.github.com/users/black-square/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T14:57:43Z","updated_at":"2016-10-03T14:57:43Z","author_association":"NONE","body":"This bug is closed as well as #11118, but the original example from @RanadeepPolavarapu still doesn't work on 2.4. Should it be reopen again?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251226171","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-251226171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":251226171,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTIyNjE3MQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T21:02:36Z","updated_at":"2016-10-03T21:02:36Z","author_association":"MEMBER","body":"@black-square The bug was only fixed in 5.0.x. Fixing it required a refactoring that didn't make its way back in 2.4\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297621949","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-297621949","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":297621949,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzYyMTk0OQ==","user":{"login":"abhishek5678","id":27953347,"node_id":"MDQ6VXNlcjI3OTUzMzQ3","avatar_url":"https://avatars1.githubusercontent.com/u/27953347?v=4","gravatar_id":"","url":"https://api.github.com/users/abhishek5678","html_url":"https://github.com/abhishek5678","followers_url":"https://api.github.com/users/abhishek5678/followers","following_url":"https://api.github.com/users/abhishek5678/following{/other_user}","gists_url":"https://api.github.com/users/abhishek5678/gists{/gist_id}","starred_url":"https://api.github.com/users/abhishek5678/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abhishek5678/subscriptions","organizations_url":"https://api.github.com/users/abhishek5678/orgs","repos_url":"https://api.github.com/users/abhishek5678/repos","events_url":"https://api.github.com/users/abhishek5678/events{/privacy}","received_events_url":"https://api.github.com/users/abhishek5678/received_events","type":"User","site_admin":false},"created_at":"2017-04-27T06:16:38Z","updated_at":"2017-04-27T06:16:38Z","author_association":"NONE","body":"Hi Guys,\r\nIn this data when i am trying with one level nested data then it's working fine but when i am adding one more nested data then it's not working  if anybody will be knows about that  then please reply me.I am sending my document data and mapping file also.\r\n\r\nPOST /test_word14/doc/1\r\n{\r\n    \"name\": \"Diseases of the blood and blood-forming organs and certain disorders involving the immune mechanism (D50-D89)\",\r\n    \"depth\": 1,\r\n\t\"children\": [{\r\n\t\t\"name\": \"Nutritional anemias (D50-D53)\",\r\n\t\t\"depth\": 2,\r\n\t\t\"children\": [{\r\n\t\t\t\"code\": \"D50\",\r\n\t\t\t\"name\": \"Iron deficiency anemia\",\r\n\t\t\t\"depth\": 3,\r\n\t\t\t\"children\": [{\r\n\t\t\t\t\"code\": \"D50.0\",\r\n\t\t\t\t\"name\": \"Iron deficiency anemia secondary to blood loss (chronic)\",\r\n\t\t\t\t\"depth\": 4\r\n\t\t\t}, {\r\n\t\t\t\t\"code\": \"D50.1\",\r\n\t\t\t\t\"name\": \"Sideropenic dysphagia\",\r\n\t\t\t\t\"depth\": 4\r\n\t\t\t}, {\r\n\t\t\t\t\"code\": \"D50.8\",\r\n\t\t\t\t\"name\": \"Other iron deficiency anemias\",\r\n\t\t\t\t\"depth\": 4\r\n\t\t\t}, {\r\n\t\t\t\t\"code\": \"D50.9\",\r\n\t\t\t\t\"name\": \"Iron deficiency anemia, unspecified\",\r\n\t\t\t\t\"depth\": 4\r\n\t\t\t}]\r\n\t\t}]\r\n\t}]\r\n}\r\n\r\n(mapping file)\r\nPUT /test_word16\r\n{\r\n  \"mappings\": {\r\n    \"doc\": { \r\n      \"properties\": {\r\n        \"name\":            { \"type\": \"string\" },\r\n        \"depth\":           {\"type\":\"long\"},\r\n        \"children\": { \r\n          \"type\":             \"nested\",\r\n          \"properties\": {\r\n            \"name\":       { \"type\": \"string\" },\r\n            \"depth\":          { \"type\": \"long\"   },\r\n        \"children\": { \r\n          \"type\":             \"nested\",\r\n          \"properties\": {\r\n            \"code\":           { \"type\": \"string\" },\r\n            \"name\":       { \"type\": \"string\" },\r\n            \"depth\":          { \"type\": \"long\"   },\r\n            \"children\":   { \r\n              \"type\":         \"nested\",\r\n              \"properties\": {\r\n                \"code\":     { \"type\": \"string\" },\r\n                \"name\":    { \"type\": \"string\" },\r\n                \"depth\":     { \"type\": \"long\" },\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n}\r\n}\r\n}\r\n}\r\n\r\n\r\nplease tell me what is the query i am applying here.i am applying the query like this:\r\nGET /icd10_codes/doc/_search\r\n{\r\n  \"_source\": false,\r\n  \"query\": {\r\n    \"nested\": {\r\n      \"path\": \"children\",\r\n      \"query\": {\r\n    \"nested\": {\r\n      \"path\": \"children.children\",\r\n \"query\": {\r\n    \"nested\": {\r\n      \"path\": \"children.children.children\",\r\n      \"query\": {\r\n        \"bool\": {\r\n          \"must\": [\r\n            {\r\n              \"match\": {\r\n                \"children.children.name\": \"Iron\"\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      },\r\n       \"inner_hits\": {        \r\n        \"_source\": {\r\n          \"excludes\":[\"name\"]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n}\r\n}\r\n}","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297627064","html_url":"https://github.com/elastic/elasticsearch/issues/13064#issuecomment-297627064","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13064","id":297627064,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzYyNzA2NA==","user":{"login":"abhishek5678","id":27953347,"node_id":"MDQ6VXNlcjI3OTUzMzQ3","avatar_url":"https://avatars1.githubusercontent.com/u/27953347?v=4","gravatar_id":"","url":"https://api.github.com/users/abhishek5678","html_url":"https://github.com/abhishek5678","followers_url":"https://api.github.com/users/abhishek5678/followers","following_url":"https://api.github.com/users/abhishek5678/following{/other_user}","gists_url":"https://api.github.com/users/abhishek5678/gists{/gist_id}","starred_url":"https://api.github.com/users/abhishek5678/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abhishek5678/subscriptions","organizations_url":"https://api.github.com/users/abhishek5678/orgs","repos_url":"https://api.github.com/users/abhishek5678/repos","events_url":"https://api.github.com/users/abhishek5678/events{/privacy}","received_events_url":"https://api.github.com/users/abhishek5678/received_events","type":"User","site_admin":false},"created_at":"2017-04-27T06:48:31Z","updated_at":"2017-04-27T06:48:31Z","author_association":"NONE","body":"Hi @RanadeepPolavarapu\r\n\r\nwhen i am running your example then it is not working it's showing like that:Unknown key for a START_OBJECT in [inner_hits]","performed_via_github_app":null}]