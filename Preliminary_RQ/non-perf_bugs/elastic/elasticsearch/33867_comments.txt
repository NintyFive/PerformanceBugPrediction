[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422855509","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-422855509","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":422855509,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjg1NTUwOQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T15:50:39Z","updated_at":"2018-09-19T15:50:39Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427050845","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-427050845","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":427050845,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzA1MDg0NQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2018-10-04T14:56:16Z","updated_at":"2018-10-04T15:02:44Z","author_association":"MEMBER","body":"We looked at this in the test triage meeting. From the failure output we can see that there are actually only five out of six nodes reporting that they have indexed data (e.g. here from the first assertion error):\r\n\r\n```\r\nFound node buckets [{doc_count=2431, key=node-2}, {doc_count=2175, key=node-1}, {doc_count=1983, key=upgraded-node-0}, {doc_count=1794, key=upgraded-node-1}, {doc_count=891, key=node-0}]\r\n```\r\n\r\nSo one possibility is that one of the nodes had a problem indexing data and for that we'd need to inspect cluster logs when the next failure occurs. Another observation is that this only occurs in 6.x so this might indicate a bug in 6.x.\r\n\r\nFor the person on test triage: If this occurs another time, please grab the cluster logs and attach it here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435357877","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-435357877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":435357877,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTM1Nzg3Nw==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T12:06:42Z","updated_at":"2018-11-02T12:06:42Z","author_association":"MEMBER","body":"Another failure with the same assertion \r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.4+multijob-unix-compatibility/os=opensuse/33/console\r\n\r\n```\r\n   > Throwable #1: java.lang.AssertionError: Found node buckets [{doc_count=630, key=upgraded-node-1}]\r\n   > Expected: a collection with size <0>\r\n   >      but: collection size was <1>\r\n   > \tat __randomizedtesting.SeedInfo.seed([81138282C946761F:E6C0C1D0729FD284]:0)\r\n   > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.assertNumUniqueNodeNameBuckets(IndexAuditUpgradeIT.java:126)\r\n   > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.lambda$testAuditLogs$0(IndexAuditUpgradeIT.java:70)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:829)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:803)\r\n   > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.testAuditLogs(IndexAuditUpgradeIT.java:68)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > \tSuppressed: java.lang.AssertionError: Found node buckets [{doc_count=83, key=upgraded-node-1}]\r\n   > Expected: a collection with size <0>\r\n   >      but: collection size was <1>\r\n   > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   > \t\tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.assertNumUniqueNodeNameBuckets(IndexAuditUpgradeIT.java:126)\r\n   > \t\tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.lambda$testAuditLogs$0(IndexAuditUpgradeIT.java:70)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:817)\r\n   > \t\t... 39 more\r\n...\r\n```\r\nLogs are attached\r\n\r\n[IndexAuditUpgradeIT-Logs.zip](https://github.com/elastic/elasticsearch/files/2542345/IndexAuditUpgradeIT-Logs.zip)\r\n\r\nThere is no log for node `upgradedClusterTestCluster node0` as the test failed in the 2 thirds upgraded stage\r\n\r\n\r\n```\r\n./gradlew :x-pack:qa:rolling-upgrade:without-system-key:v5.6.13-SNAPSHOT#twoThirdsUpgradedTestRunner \\\r\n  -Dtests.seed=81138282C946761F \\\r\n  -Dtests.class=org.elasticsearch.upgrades.IndexAuditUpgradeIT \\\r\n  -Dtests.method=\"testAuditLogs\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=pt-PT \\\r\n  -Dtests.timezone=GB-Eire\r\n```\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/435407749","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-435407749","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":435407749,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNTQwNzc0OQ==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-11-02T14:58:24Z","updated_at":"2018-11-02T14:58:24Z","author_association":"MEMBER","body":"@albertzaharovits since you have some of the auditing code fresh in mind, can you please take a look at this test failure?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441560631","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-441560631","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":441560631,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTU2MDYzMQ==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2018-11-26T08:47:01Z","updated_at":"2018-11-26T08:47:01Z","author_association":"CONTRIBUTOR","body":"This failure seems to have happened four times during this weekend in 6.x. For example:\r\n\r\n```\r\n./gradlew :x-pack:qa:rolling-upgrade:with-system-key:v6.4.2#upgradedClusterTestRunner \\\r\n  -Dtests.seed=F17834F8C8394574 \\\r\n  -Dtests.class=org.elasticsearch.upgrades.IndexAuditUpgradeIT \\\r\n  -Dtests.method=\"testAuditLogs\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=is-IS \\\r\n  -Dtests.timezone=SystemV/MST7 \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nI am muting the test","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/443922787","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-443922787","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":443922787,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MzkyMjc4Nw==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-12-04T00:27:16Z","updated_at":"2018-12-04T00:27:16Z","author_association":"CONTRIBUTOR","body":"Another one of these happened today, doesn't reproduce locally\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+periodic/288/console\r\n\r\n[build-288.txt.zip](https://github.com/elastic/elasticsearch/files/2641784/build-288.txt.zip)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/443924766","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-443924766","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":443924766,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MzkyNDc2Ng==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-12-04T00:36:56Z","updated_at":"2018-12-04T00:36:56Z","author_association":"CONTRIBUTOR","body":"Muted on 6.x - https://github.com/elastic/elasticsearch/commit/521751e7f1790fc364f324de551b96cc7ab2887f","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/445076085","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-445076085","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":445076085,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTA3NjA4NQ==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2018-12-07T00:07:45Z","updated_at":"2018-12-07T00:07:45Z","author_association":"CONTRIBUTOR","body":"Another on 6.5 https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.5+bwc-tests/120/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446137993","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-446137993","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":446137993,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjEzNzk5Mw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-12-11T09:46:43Z","updated_at":"2018-12-11T09:46:43Z","author_association":"MEMBER","body":"Another failure on 6.5 branch: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.5+bwc-tests/138/console\r\n\r\n```\r\n1> [2018-12-10T16:01:26,213][INFO ][o.e.u.IndexAuditUpgradeIT] [testAuditLogs] after test\r\nFAILURE 12.1s | IndexAuditUpgradeIT.testAuditLogs <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: Found node buckets [{doc_count=1405, key=upgraded-node-1}, {doc_count=284, key=upgraded-node-2}]\r\n   > Expected: a collection with size <3>\r\n   >      but: collection size was <2>\r\n   >    at __randomizedtesting.SeedInfo.seed([57554E0963E78375:30860D5BD83E27EE]:0)\r\n   >    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   >    at org.elasticsearch.upgrades.IndexAuditUpgradeIT.assertNumUniqueNodeNameBuckets(IndexAuditUpgradeIT.java:125)\r\n   >    at org.elasticsearch.upgrades.IndexAuditUpgradeIT.lambda$testAuditLogs$0(IndexAuditUpgradeIT.java:68)\r\n   >    at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:848)\r\n   >    at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:822)\r\n   >    at org.elasticsearch.upgrades.IndexAuditUpgradeIT.testAuditLogs(IndexAuditUpgradeIT.java:66)\r\n   >    at java.lang.Thread.run(Thread.java:748)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453317297","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-453317297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":453317297,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzMxNzI5Nw==","user":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"created_at":"2019-01-11T00:28:01Z","updated_at":"2019-01-11T00:28:01Z","author_association":"CONTRIBUTOR","body":"Another one on 6.5\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.5+bwc-tests/262/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/462948442","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-462948442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":462948442,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Mjk0ODQ0Mg==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2019-02-12T21:45:09Z","updated_at":"2019-02-12T21:45:09Z","author_association":"MEMBER","body":"@albertzaharovits fixed this in #38286","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490136035","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-490136035","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":490136035,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDEzNjAzNQ==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2019-05-07T15:45:24Z","updated_at":"2019-05-07T15:45:24Z","author_association":"CONTRIBUTOR","body":"Another occurence: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.7+bwc-tests/359/consoleFull\r\n\r\nReproduction line:\r\n```\r\n./gradlew :x-pack:qa:rolling-upgrade:with-system-key:v6.0.0#twoThirdsUpgradedTestRunner \\\r\n  -Dtests.seed=53BD6CE84200B7B4 \\\r\n  -Dtests.class=org.elasticsearch.upgrades.IndexAuditUpgradeIT \\\r\n  -Dtests.method=\"testAuditLogs\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=zh \\\r\n  -Dtests.timezone=Indian/Mahe \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nerror message:\r\n```\r\n08:41:03 FAILURE 33.5s | IndexAuditUpgradeIT.testAuditLogs <<< FAILURES!\r\n08:41:03    > Throwable #1: java.lang.AssertionError: Found node buckets [{doc_count=143, key=upgraded-node-1}]\r\n08:41:03    > Expected: a collection with size <2>\r\n08:41:03    >      but: collection size was <1>\r\n08:41:03    > \tat __randomizedtesting.SeedInfo.seed([53BD6CE84200B7B4:346E2FBAF9D9132F]:0)\r\n08:41:03    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n08:41:03    > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.assertNumUniqueNodeNameBuckets(IndexAuditUpgradeIT.java:126)\r\n08:41:03    > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.lambda$testAuditLogs$0(IndexAuditUpgradeIT.java:69)\r\n08:41:03    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:858)\r\n08:41:03    > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.testAuditLogs(IndexAuditUpgradeIT.java:67)\r\n08:41:03    > \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nHere are the [full logs](https://github.com/elastic/elasticsearch/files/3153428/IndexAuditUpgradeIT.testAuditLogs.txt.zip).\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490510090","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-490510090","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":490510090,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDUxMDA5MA==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T14:32:28Z","updated_at":"2019-05-08T14:32:59Z","author_association":"MEMBER","body":"Additional failures:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.7+bwc-tests/362/consoleFull\r\n\r\nMessage:\r\n```\r\n03:44:10 FAILURE 33.7s | IndexAuditUpgradeIT.testAuditLogs <<< FAILURES!\r\n03:44:10    > Throwable #1: java.lang.AssertionError: Found node buckets [{doc_count=32, key=upgraded-node-1}]\r\n03:44:10    > Expected: a collection with size <2>\r\n03:44:10    >      but: collection size was <1>\r\n03:44:10    > \tat __randomizedtesting.SeedInfo.seed([E59897C6A188BE7C:824BD4941A511AE7]:0)\r\n03:44:10    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n03:44:10    > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.assertNumUniqueNodeNameBuckets(IndexAuditUpgradeIT.java:126)\r\n03:44:10    > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.lambda$testAuditLogs$0(IndexAuditUpgradeIT.java:69)\r\n03:44:10    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:858)\r\n03:44:10    > \tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.testAuditLogs(IndexAuditUpgradeIT.java:67)\r\n03:44:10    > \tat java.lang.Thread.run(Thread.java:748)\r\n03:44:10    > \tSuppressed: java.lang.AssertionError: Found node buckets [{doc_count=32, key=upgraded-node-1}]\r\n```\r\nNoticed there were issues when the second upgraded node entered the cluster, but unsure if that is a possible cause, or if it is an effect of the test failing. \r\n\r\nOther failures:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.8+bwc-tests/24\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490608282","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-490608282","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":490608282,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDYwODI4Mg==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T18:56:02Z","updated_at":"2019-05-08T18:56:02Z","author_association":"MEMBER","body":"\r\nAnother failure complaining of `IndexAuditUpgradeIT.testAuditLogs`\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.8+bwc-tests/25/consoleFull\r\n\r\n```\r\n ./gradlew :x-pack:qa:rolling-upgrade:with-system-key:v6.0.1#twoThirdsUpgradedTestRunner -Dtests.seed=45291CCC37B84082 -Dtests.class=org.elasticsearch.upgrades.IndexAuditUpgradeIT -Dtests.method=\"testAuditLogs\" -Dtests.security.manager=true -Dtests.locale=es-ES -Dtests.timezone=SystemV/AST4ADT -Dcompiler.java=12 -Druntime.java=8\r\n```\r\n\r\n```\r\n13:23:34    > Expected: a collection with size <1>\r\n13:23:34    >      but: collection size was <0>\r\n13:23:34    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n13:23:34    > \t\tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.masterIsNewVersion(IndexAuditUpgradeIT.java:135)\r\n13:23:34    > \t\tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.expectedNumUniqueNodeNameBuckets(IndexAuditUpgradeIT.java:79)\r\n13:23:34    > \t\tat org.elasticsearch.upgrades.IndexAuditUpgradeIT.lambda$testAuditLogs$0(IndexAuditUpgradeIT.java:69)\r\n13:23:34    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:846)\r\n13:23:34    > \t\t... 38 more\r\n```\r\nAdditional interesting trace lower down the stack\r\n```\r\nThrowable #2: org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:41677], URI [/_snapshot/_all], status line [HTTP/1.1 503 Service Unavailable]\r\n13:23:34    > {\"error\":{\"root_cause\":[{\"type\":\"master_not_discovered_exception\",\"reason\":null}],\"type\":\"master_not_discovered_exception\",\"reason\":null},\"status\":503}\r\n13:23:34    > \tat org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:936)\r\n13:23:34    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:233)\r\n13:23:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.wipeSnapshots(ESRestTestCase.java:516)\r\n13:23:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.wipeCluster(ESRestTestCase.java:454)\r\n13:23:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:275)\r\n13:23:34    > \tat java.lang.Thread.run(Thread.java:748)\r\n13:23:34    > Caused by: org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:41677], URI [/_snapshot/_all], status line [HTTP/1.1 503 Service Unavailable]\r\n13:23:34    > {\"error\":{\"root_cause\":[{\"type\":\"master_not_discovered_exception\",\"reason\":null}],\"type\":\"master_not_discovered_exception\",\"reason\":null},\"status\":503}\r\n13:23:34    > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:552)\r\n13:23:34    > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:537)\r\n13:23:34    > \tat org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n13:23:34    > \tat org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n13:23:34    > \tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n13:23:34    > \tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n13:23:34    > \tat org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n13:23:34    > \tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n13:23:34    > \tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n13:23:34    > \tat org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n13:23:34    > \tat org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n13:23:34    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n13:23:34    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n13:23:34    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n13:23:34    > \tat org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n13:23:34    > \tat org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n13:23:34    > \t... 1 more\r\n```\r\n\r\nIt is unclear to me if `IndexAuditUpgradeIT.testAuditLogs` failing is causing the cluster instability (and thus causing many other Integration tests to subsequently fail), or vice versa (the cluster instability causing the test to fail).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/581588535","html_url":"https://github.com/elastic/elasticsearch/issues/33867#issuecomment-581588535","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33867","id":581588535,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTU4ODUzNQ==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T19:53:02Z","updated_at":"2020-02-03T19:53:02Z","author_association":"CONTRIBUTOR","body":"We don't run these tests anymore.","performed_via_github_app":null}]