{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18393","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18393/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18393/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18393/events","html_url":"https://github.com/elastic/elasticsearch/issues/18393","id":155212924,"node_id":"MDU6SXNzdWUxNTUyMTI5MjQ=","number":18393,"title":"Unassigned shards after complete cluster failure (All nodes down)","user":{"login":"vineet01","id":13980705,"node_id":"MDQ6VXNlcjEzOTgwNzA1","avatar_url":"https://avatars2.githubusercontent.com/u/13980705?v=4","gravatar_id":"","url":"https://api.github.com/users/vineet01","html_url":"https://github.com/vineet01","followers_url":"https://api.github.com/users/vineet01/followers","following_url":"https://api.github.com/users/vineet01/following{/other_user}","gists_url":"https://api.github.com/users/vineet01/gists{/gist_id}","starred_url":"https://api.github.com/users/vineet01/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vineet01/subscriptions","organizations_url":"https://api.github.com/users/vineet01/orgs","repos_url":"https://api.github.com/users/vineet01/repos","events_url":"https://api.github.com/users/vineet01/events{/privacy}","received_events_url":"https://api.github.com/users/vineet01/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-05-17T09:20:50Z","updated_at":"2016-05-17T11:46:10Z","closed_at":"2016-05-17T09:53:07Z","author_association":"NONE","active_lock_reason":null,"body":"ES version 2.3.1 \n\nI have a 3 node cluster, all 3 nodes are master-eligible and data nodes. I have tested cases when any one node is down, or any two nodes are down. Everything works perfectly fine and single node which is up is able to serve requests and shows yellow cluster health status which is expected. \n\nHowever when i bring all nodes down and start only one node, cluster status stays \"red\" and shard allocation never happens (tried also with cluster.routing.allocation.enable: all) , however if i start any one of other two nodes it gets back to normal, i get this in logs :-\n\norg.elasticsearch.cluster.block.ClusterBlockException: blocked by: [SERVICE_UNAVAILABLE/1/state not recovered / initialized];\n\n17 May 2016 14:37:24,778 DEBUG  gateway:82 - [myhostname.com] [my-index][1] found 1 allocations of [my-index][1], node[null], [P], v[0], s[UNASSIGNED], unassigned_info[[reason=CLUSTER_RECOVERED], at[2016-05-17T09:07:08.627Z]], highest version: [186]\n\n17 May 2016 14:37:24,778 DEBUG  gateway:89 - [myhostname.com] [my-index][1]: not allocating, number_of_allocated_shards_found [1]\n\nI am using unicast for node discovery, and 2 replicas.\n\nindex.number_of_replicas: 2\n\nNot sure if its the expected behavior.\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}