[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/420399783","html_url":"https://github.com/elastic/elasticsearch/issues/33611#issuecomment-420399783","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33611","id":420399783,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDM5OTc4Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-09-11T19:45:10Z","updated_at":"2018-09-11T19:55:41Z","author_association":"MEMBER","body":"Ouch this is a bad bug, I can reproduce with this recreation:\r\n\r\n````\r\nPUT example\r\n{ \r\n       \"doc\": {\r\n\t   \"properties\": {\r\n\t\t\"text\": {\r\n\t\t\t\"type\": \"text\",\r\n\t\t\t\"similarity\": \"classic\"\r\n\t\t}\r\n\t   }\r\n      }\r\n} \r\n\r\nPOST example/doc/_mappings\r\n{ \r\n\t\"properties\": {\r\n\t\t\"text\": {\r\n\t\t\t\"type\": \"text\",\r\n\t\t\t\"similarity\": \"classic\",\r\n\t\t\t\"fielddata\": true\r\n\t\t}\r\n\t}\r\n} \r\n`````\r\nThe second command fails with the following error:\r\n````\r\n{\r\n    \"error\": {\r\n        \"root_cause\": [\r\n            {\r\n                \"type\": \"illegal_argument_exception\",\r\n                \"reason\": \"Mapper for [text] conflicts with existing mapping in other types:\\n[mapper [text] has different [similarity]]\"\r\n            }\r\n        ],\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"Mapper for [text] conflicts with existing mapping in other types:\\n[mapper [text] has different [similarity]]\"\r\n    },\r\n    \"status\": 400\r\n}\r\n````\r\nThe bug was introduced in 6.3 where it is now impossible to update a field if it uses an explicit similarity. I think I know why this bug occurs but I need to understand why it was never caught in our tests.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/420399844","html_url":"https://github.com/elastic/elasticsearch/issues/33611#issuecomment-420399844","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33611","id":420399844,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDM5OTg0NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-11T19:45:24Z","updated_at":"2018-09-11T19:45:24Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/420995089","html_url":"https://github.com/elastic/elasticsearch/issues/33611#issuecomment-420995089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33611","id":420995089,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDk5NTA4OQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-09-13T12:50:59Z","updated_at":"2018-09-13T12:50:59Z","author_association":"MEMBER","body":"I just merged the fix in the 6.4 branch so it will be part of 6.4.1 when it's released.\r\nThanks for reporting @kylelyk !","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/421412089","html_url":"https://github.com/elastic/elasticsearch/issues/33611#issuecomment-421412089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33611","id":421412089,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTQxMjA4OQ==","user":{"login":"kylelyk","id":3401359,"node_id":"MDQ6VXNlcjM0MDEzNTk=","avatar_url":"https://avatars1.githubusercontent.com/u/3401359?v=4","gravatar_id":"","url":"https://api.github.com/users/kylelyk","html_url":"https://github.com/kylelyk","followers_url":"https://api.github.com/users/kylelyk/followers","following_url":"https://api.github.com/users/kylelyk/following{/other_user}","gists_url":"https://api.github.com/users/kylelyk/gists{/gist_id}","starred_url":"https://api.github.com/users/kylelyk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kylelyk/subscriptions","organizations_url":"https://api.github.com/users/kylelyk/orgs","repos_url":"https://api.github.com/users/kylelyk/repos","events_url":"https://api.github.com/users/kylelyk/events{/privacy}","received_events_url":"https://api.github.com/users/kylelyk/received_events","type":"User","site_admin":false},"created_at":"2018-09-14T16:26:04Z","updated_at":"2018-09-14T16:26:04Z","author_association":"NONE","body":"Would it be possible for this issue to be back ported to 6.3 since prevents us from using 6.3 completely? We're using AWS hosted ES so we don't know how long it will be before they have 6.4 and there are several fixes in 6.3 that we would like to take advantage of in the meantime.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/421437411","html_url":"https://github.com/elastic/elasticsearch/issues/33611#issuecomment-421437411","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33611","id":421437411,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTQzNzQxMQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-09-14T17:58:36Z","updated_at":"2018-09-14T17:58:36Z","author_association":"MEMBER","body":"Sorry @kylelyk that's not possible. We publish bugfix releases for the last minor of the current and last major version (5.6.x and 6.4.x at the moment) so you'll need to wait for 6.4.1.","performed_via_github_app":null}]