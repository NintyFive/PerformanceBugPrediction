{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39754","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39754/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39754/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39754/events","html_url":"https://github.com/elastic/elasticsearch/issues/39754","id":417892527,"node_id":"MDU6SXNzdWU0MTc4OTI1Mjc=","number":39754,"title":"testCountAllIndicesNoQuery fails","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1222918656,"node_id":"MDU6TGFiZWwxMjIyOTE4NjU2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.0","name":"v7.2.0","color":"DDDDDD","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"assignees":[{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-03-06T16:22:34Z","updated_at":"2019-06-12T22:02:19Z","closed_at":"2019-06-12T22:02:18Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.0+multijob-unix-compatibility/os=ubuntu-18.04&&immutable/56/console\r\n\r\nHere is the `REPRODUCE WITH` line:\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :client:rest-high-level:integTestRunner \\\r\n  -Dtests.seed=6C5D5F5D2AF87ABE \\\r\n  -Dtests.class=org.elasticsearch.client.SearchIT \\\r\n  -Dtests.method=\"testCountAllIndicesNoQuery\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=lt \\\r\n  -Dtests.timezone=Brazil/East \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nHowever this doesn't reproduce for me. There's not a lot in the logs, but here it is:\r\n\r\n```\r\nSuite: org.elasticsearch.client.SearchIT\r\n  1> [2019-03-06T07:27:59,138][INFO ][o.e.c.SearchIT           ] [testCountAllIndicesNoQuery] before test\r\n  1> [2019-03-06T07:27:59,140][INFO ][o.e.c.SearchIT           ] [testCountAllIndicesNoQuery] initializing REST clients against [http://[::1]:45017]\r\n  2> REPRODUCE WITH: ./gradlew :client:rest-high-level:integTestRunner -Dtests.seed=6C5D5F5D2AF87ABE -Dtests.class=org.elasticsearch.client.SearchIT -Dtests.method=\"testCountAllIndicesNoQuery\" -Dtests.security.manager=true -Dtests.locale=lt -Dtests.timezone=Brazil/East -Dcompiler.java=11 -Druntime.java=8\r\n  1> [2019-03-06T07:27:59,286][WARN ][o.e.c.RestClient         ] [testCountAllIndicesNoQuery] request [PUT http://[::1]:45017/index/type/1] returned 1 warnings: [299 Elasticsearch-7.0.0-SNAPSHOT-65b44ee \"[types removal] Specifying types in document index requests is deprecated, use the typeless endpoints instead (/{index}/_doc/{id}, /{index}/_doc, or /{index}/_create/{id}).\"]\r\n  1> [2019-03-06T07:27:59,295][WARN ][o.e.c.RestClient         ] [testCountAllIndicesNoQuery] request [PUT http://[::1]:45017/index/type/2] returned 1 warnings: [299 Elasticsearch-7.0.0-SNAPSHOT-65b44ee \"[types removal] Specifying types in document index requests is deprecated, use the typeless endpoints instead (/{index}/_doc/{id}, /{index}/_doc, or /{index}/_create/{id}).\"]\r\n  1> [2019-03-06T07:27:59,304][WARN ][o.e.c.RestClient         ] [testCountAllIndicesNoQuery] request [PUT http://[::1]:45017/index/type/3] returned 1 warnings: [299 Elasticsearch-7.0.0-SNAPSHOT-65b44ee \"[types removal] Specifying types in document index requests is deprecated, use the typeless endpoints instead (/{index}/_doc/{id}, /{index}/_doc, or /{index}/_create/{id}).\"]\r\n  1> [2019-03-06T07:27:59,312][WARN ][o.e.c.RestClient         ] [testCountAllIndicesNoQuery] request [PUT http://[::1]:45017/index/type/4] returned 1 warnings: [299 Elasticsearch-7.0.0-SNAPSHOT-65b44ee \"[types removal] Specifying types in document index requests is deprecated, use the typeless endpoints instead (/{index}/_doc/{id}, /{index}/_doc, or /{index}/_create/{id}).\"]\r\n  1> [2019-03-06T07:27:59,320][WARN ][o.e.c.RestClient         ] [testCountAllIndicesNoQuery] request [PUT http://[::1]:45017/index/type/5] returned 1 warnings: [299 Elasticsearch-7.0.0-SNAPSHOT-65b44ee \"[types removal] Specifying types in document index requests is deprecated, use the typeless endpoints instead (/{index}/_doc/{id}, /{index}/_doc, or /{index}/_create/{id}).\"]\r\n  1> [2019-03-06T07:27:59,938][INFO ][o.e.c.SearchIT           ] [testCountAllIndicesNoQuery] Unexpected hit count, was expecting 12 hits but got: {\"took\":4,\"timed_out\":false,\"_shards\":{\"total\":6,\"successful\":6,\"skipped\":0,\"failed\":0},\"hits\":{\"total\":{\"value\":13,\"relation\":\"eq\"},\"max_score\":1.0,\"hits\":[{\"_index\":\".tasks\",\"_type\":\"task\",\"_id\":\"mOsNh9LZSPu1OI8SS_Znmg:13240\",\"_score\":1.0,\"_source\":{\"completed\":true,\"task\":{\"node\":\"mOsNh9LZSPu1OI8SS_Znmg\",\"id\":13240,\"type\":\"transport\",\"action\":\"cluster:admin/xpack/upgrade\",\"description\":\"\",\"start_time_in_millis\":1551868078904,\"running_time_in_nanos\":354993,\"cancellable\":true,\"headers\":{}},\"error\":{\"type\":\"illegal_state_exception\",\"reason\":\"Index [test] cannot be upgraded\"}}},{\"_index\":\"index\",\"_type\":\"type\",\"_id\":\"1\",\"_score\":1.0,\"_source\":{\"type\":\"type1\",\"num\":10,\"num2\":50}},{\"_index\":\"index\",\"_type\":\"type\",\"_id\":\"2\",\"_score\":1.0,\"_source\":{\"type\":\"type1\",\"num\":20,\"num2\":40}},{\"_index\":\"index\",\"_type\":\"type\",\"_id\":\"3\",\"_score\":1.0,\"_source\":{\"type\":\"type1\",\"num\":50,\"num2\":35}},{\"_index\":\"index\",\"_type\":\"type\",\"_id\":\"4\",\"_score\":1.0,\"_source\":{\"type\":\"type2\",\"num\":100,\"num2\":10}},{\"_index\":\"index\",\"_type\":\"type\",\"_id\":\"5\",\"_score\":1.0,\"_source\":{\"type\":\"type2\",\"num\":100,\"num2\":10}},{\"_index\":\"index1\",\"_type\":\"_doc\",\"_id\":\"1\",\"_score\":1.0,\"_source\":{\"field\":\"value1\",\"rating\":7}},{\"_index\":\"index1\",\"_type\":\"_doc\",\"_id\":\"2\",\"_score\":1.0,\"_source\":{\"field\":\"value2\"}},{\"_index\":\"index2\",\"_type\":\"_doc\",\"_id\":\"3\",\"_score\":1.0,\"_source\":{\"field\":\"value1\",\"rating\":\"good\"}},{\"_index\":\"index2\",\"_type\":\"_doc\",\"_id\":\"4\",\"_score\":1.0,\"_source\":{\"field\":\"value2\"}},{\"_index\":\"index3\",\"_type\":\"_doc\",\"_id\":\"5\",\"_score\":1.0,\"_source\":{\"field\":\"value1\"}},{\"_index\":\"index3\",\"_type\":\"_doc\",\"_id\":\"6\",\"_score\":1.0,\"_source\":{\"field\":\"value2\"}},{\"_index\":\"index4\",\"_type\":\"_doc\",\"_id\":\"1\",\"_score\":1.0,\"_source\":{\"field1\":\"value1\",\"field2\":\"value2\"}}]}}\r\n  1> [2019-03-06T07:28:00,131][INFO ][o.e.c.SearchIT           ] [testCountAllIndicesNoQuery] after test\r\nFAILURE 1.01s | SearchIT.testCountAllIndicesNoQuery <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: expected:<12> but was:<13>\r\n   > \tat __randomizedtesting.SeedInfo.seed([6C5D5F5D2AF87ABE:9976862BA0CBD654]:0)\r\n   > \tat org.elasticsearch.client.SearchIT.testCountAllIndicesNoQuery(SearchIT.java:1336)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n```","closed_by":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"performed_via_github_app":null}