{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16728","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16728/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16728/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16728/events","html_url":"https://github.com/elastic/elasticsearch/issues/16728","id":134749963,"node_id":"MDU6SXNzdWUxMzQ3NDk5NjM=","number":16728,"title":"Documentation is misleading regarding write consistency","user":{"login":"haizaar","id":58201,"node_id":"MDQ6VXNlcjU4MjAx","avatar_url":"https://avatars1.githubusercontent.com/u/58201?v=4","gravatar_id":"","url":"https://api.github.com/users/haizaar","html_url":"https://github.com/haizaar","followers_url":"https://api.github.com/users/haizaar/followers","following_url":"https://api.github.com/users/haizaar/following{/other_user}","gists_url":"https://api.github.com/users/haizaar/gists{/gist_id}","starred_url":"https://api.github.com/users/haizaar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/haizaar/subscriptions","organizations_url":"https://api.github.com/users/haizaar/orgs","repos_url":"https://api.github.com/users/haizaar/repos","events_url":"https://api.github.com/users/haizaar/events{/privacy}","received_events_url":"https://api.github.com/users/haizaar/received_events","type":"User","site_admin":false},"labels":[{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-02-19T01:56:38Z","updated_at":"2016-02-28T22:56:24Z","closed_at":"2016-02-28T22:56:24Z","author_association":"NONE","active_lock_reason":null,"body":"The [guide](https://www.elastic.co/guide/en/elasticsearch/guide/master/distrib-write.html) says:\n\n> Here is the sequence of steps necessary to successfully create, index, or delete a document on both the primary and any replica shards:\n> 1. The client sends a create, index, or delete request to Node 1.\n> 2. The node uses the documentâ€™s _id to determine that the document belongs to shard 0. It forwards the request to Node 3, where the primary copy of shard 0 is currently allocated.\n> 3. Node 3 executes the request on the primary shard. If it is successful, it forwards the request in parallel to the replica shards on Node 1 and Node 2. **Once _all_ of the replica** shards report success, Node 3 reports success to the coordinating node, which reports success to the client.\n\nHowever according to the latest resiliency talk from Elastic{ON} 2016, this is not the case, otherwise #7572 would not happen. According to the presenter (and the [comment](https://github.com/elastic/elasticsearch/issues/7572#issuecomment-59893514) in the issue), the actual situation is as follows:\n1. Primary shard receives indexing request\n2. Primary shard checks that all/quorum replicas are online and fails request otherwise\n3. Primary shard performs index operation on itself\n4. Primary shard acks success to the client\n5. Primary shard sends indexing request to replicas\n\nThe documentation is very misleading making a reader to believe that by the time he gets ack, its data already exists on all/quorum replicas, i.e. safe; and that's not the case.\n\nI think that this behavior should be clearly outlined, until this issue is fixed in 5.x, both in the guide link above and in the [reference](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-consistency).\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}