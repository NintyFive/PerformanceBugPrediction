[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431667588","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-431667588","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":431667588,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTY2NzU4OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-21T13:11:29Z","updated_at":"2018-10-21T13:11:29Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431772439","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-431772439","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":431772439,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTc3MjQzOQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-22T08:31:34Z","updated_at":"2018-10-22T08:31:34Z","author_association":"MEMBER","body":"@azulay7 using the example you pasted above I am not able to reproduce the issue on 6.2.4 or the latest 6.x or master branches. in all cases the receive 0 hits back when performing the `exists` query on the `grade` field","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432162689","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-432162689","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":432162689,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjE2MjY4OQ==","user":{"login":"azulay7","id":19120,"node_id":"MDQ6VXNlcjE5MTIw","avatar_url":"https://avatars1.githubusercontent.com/u/19120?v=4","gravatar_id":"","url":"https://api.github.com/users/azulay7","html_url":"https://github.com/azulay7","followers_url":"https://api.github.com/users/azulay7/followers","following_url":"https://api.github.com/users/azulay7/following{/other_user}","gists_url":"https://api.github.com/users/azulay7/gists{/gist_id}","starred_url":"https://api.github.com/users/azulay7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azulay7/subscriptions","organizations_url":"https://api.github.com/users/azulay7/orgs","repos_url":"https://api.github.com/users/azulay7/repos","events_url":"https://api.github.com/users/azulay7/events{/privacy}","received_events_url":"https://api.github.com/users/azulay7/received_events","type":"User","site_admin":false},"created_at":"2018-10-23T09:06:19Z","updated_at":"2018-10-23T09:06:19Z","author_association":"NONE","body":"Hi. @colings86, thank you for checking this out.\r\nI know for sure that putting `\"null_value\": -1` on the mapping causes the issue.\r\n\r\nCan you please re-check yourself, if you put the mapping for grade field?\r\n`GET person/_mapping`\r\nyou should get on grade property:\r\n> \"null_value\": -1\r\n\r\n\r\nThank you very much :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432193732","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-432193732","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":432193732,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjE5MzczMg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-23T10:36:32Z","updated_at":"2018-10-23T10:36:32Z","author_association":"MEMBER","body":"@azulay7 I ran it again on another fresh install of Elasticsearch 6.2.4 but unfortunately I'm still not able to reproduce the error (I also tried again with the latest 6.x and master branches without success too). This is the console output for the commands I ran against Elasticsearch:\r\n\r\n```\r\n➜  11:32:34 elasticsearch-6.2.4 $  curl -XPUT \"http://localhost:9200/person?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"nickname\": {\r\n          \"type\": \"text\",\r\n          \"fields\": {\r\n            \"keyword\": {\r\n              \"type\": \"keyword\",\r\n              \"ignore_above\": 256,\r\n              \"null_value\": \"null\"\r\n            }\r\n          }\r\n        },\r\n        \"grade\": {\r\n          \"type\": \"double\",\r\n          \"null_value\": -1\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n{\r\n  \"acknowledged\" : true,\r\n  \"shards_acknowledged\" : true,\r\n  \"index\" : \"person\"\r\n}\r\n➜  11:33:08 elasticsearch-6.2.4 $  curl -XGET \"http://localhost:9200/person/?pretty\" -H 'Content-Type: application/json'\r\n{\r\n  \"person\" : {\r\n    \"aliases\" : { },\r\n    \"mappings\" : {\r\n      \"_doc\" : {\r\n        \"properties\" : {\r\n          \"grade\" : {\r\n            \"type\" : \"double\",\r\n            \"null_value\" : -1.0\r\n          },\r\n          \"nickname\" : {\r\n            \"type\" : \"text\",\r\n            \"fields\" : {\r\n              \"keyword\" : {\r\n                \"type\" : \"keyword\",\r\n                \"null_value\" : \"null\",\r\n                \"ignore_above\" : 256\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"creation_date\" : \"1540290787216\",\r\n        \"number_of_shards\" : \"5\",\r\n        \"number_of_replicas\" : \"1\",\r\n        \"uuid\" : \"B8cvUNZ3S32U-4RkPSF4dA\",\r\n        \"version\" : {\r\n          \"created\" : \"6020499\"\r\n        },\r\n        \"provided_name\" : \"person\"\r\n      }\r\n    }\r\n  }\r\n}\r\n➜  11:33:12 elasticsearch-6.2.4 $ curl -XPOST \"http://localhost:9200/person/_doc/1?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"name\": \"David\",\r\n  \"nickname\": null,\r\n  \"grade\": null\r\n}'\r\n{\r\n  \"_index\" : \"person\",\r\n  \"_type\" : \"_doc\",\r\n  \"_id\" : \"1\",\r\n  \"_version\" : 1,\r\n  \"result\" : \"created\",\r\n  \"_shards\" : {\r\n    \"total\" : 2,\r\n    \"successful\" : 1,\r\n    \"failed\" : 0\r\n  },\r\n  \"_seq_no\" : 0,\r\n  \"_primary_term\" : 1\r\n}\r\n➜  11:33:28 elasticsearch-6.2.4 $  curl -XGET \"http://localhost:9200/person/_search?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"size\": 0,\r\n  \"query\": {\r\n    \"exists\": {\r\n      \"field\": \"grade\"\r\n    }\r\n  }\r\n}'\r\n{\r\n  \"took\" : 44,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"skipped\" : 0,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 1,\r\n    \"max_score\" : 0.0,\r\n    \"hits\" : [ ]\r\n  }\r\n}\r\n```\r\n\r\nAre you able to reproduce this issue on a completely fresh install of 6.2.4?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432194110","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-432194110","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":432194110,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjE5NDExMA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-23T10:37:52Z","updated_at":"2018-10-23T10:37:52Z","author_association":"MEMBER","body":"Actually I see that I misread your description above. The` total.hits` is where the error is and above I too see it as `1` but the actual hits returned is empty. This is indeed a bug. Sorry for the confusion earlier","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432196427","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-432196427","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":432196427,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjE5NjQyNw==","user":{"login":"azulay7","id":19120,"node_id":"MDQ6VXNlcjE5MTIw","avatar_url":"https://avatars1.githubusercontent.com/u/19120?v=4","gravatar_id":"","url":"https://api.github.com/users/azulay7","html_url":"https://github.com/azulay7","followers_url":"https://api.github.com/users/azulay7/followers","following_url":"https://api.github.com/users/azulay7/following{/other_user}","gists_url":"https://api.github.com/users/azulay7/gists{/gist_id}","starred_url":"https://api.github.com/users/azulay7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azulay7/subscriptions","organizations_url":"https://api.github.com/users/azulay7/orgs","repos_url":"https://api.github.com/users/azulay7/repos","events_url":"https://api.github.com/users/azulay7/events{/privacy}","received_events_url":"https://api.github.com/users/azulay7/received_events","type":"User","site_admin":false},"created_at":"2018-10-23T10:45:17Z","updated_at":"2018-10-23T10:45:17Z","author_association":"NONE","body":"@colings86, Great!! Hope to hear for any progress :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432201758","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-432201758","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":432201758,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjIwMTc1OA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-23T11:04:23Z","updated_at":"2018-10-23T11:04:23Z","author_association":"MEMBER","body":"@azulay7 actually looking again at this its not a bug but expected behaviour.\r\n\r\nFirstly the difference in the number of hits returned being `0` and the `total.hits: 1` is explained by the `size: 0` in the request.\r\n\r\nSecondly I would expect the `total.hits` to be returned as `1` for the `grade` field because the document does have a value for that field since you configured a `null_value`. This means the field exists because at index time the `null` is replaced by the `null_value` you configured. The same behaviour occurs if you run the search request on the `nickname.keyword` field which also has a `null_value` configured. Searching on the `nickname` field returns `total.hits: 0` because there is no `null_value` configured (in fact `null_value` is not supported for `text` fields) so nothing is indexed for the document in the `nickname` field and so an exists query will return no hits","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432535039","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-432535039","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":432535039,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjUzNTAzOQ==","user":{"login":"azulay7","id":19120,"node_id":"MDQ6VXNlcjE5MTIw","avatar_url":"https://avatars1.githubusercontent.com/u/19120?v=4","gravatar_id":"","url":"https://api.github.com/users/azulay7","html_url":"https://github.com/azulay7","followers_url":"https://api.github.com/users/azulay7/followers","following_url":"https://api.github.com/users/azulay7/following{/other_user}","gists_url":"https://api.github.com/users/azulay7/gists{/gist_id}","starred_url":"https://api.github.com/users/azulay7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azulay7/subscriptions","organizations_url":"https://api.github.com/users/azulay7/orgs","repos_url":"https://api.github.com/users/azulay7/repos","events_url":"https://api.github.com/users/azulay7/events{/privacy}","received_events_url":"https://api.github.com/users/azulay7/received_events","type":"User","site_admin":false},"created_at":"2018-10-24T06:53:59Z","updated_at":"2018-10-24T06:53:59Z","author_association":"NONE","body":"@colings86 I understand your perspective answer.. but I am bit confused on 'null_value':\r\n1. first of all, I thought that null_value is being stored under the hood and really repalce null in the document. because if I search for the document I get original null.\r\n`GET person/_search`\r\nresult:\r\n\r\n> \"_source\": {\r\n          \"name\": \"David\",\r\n          \"nickname\": null,\r\n          \"grade\": null\r\n        }\r\n\r\n only when I query aggs, I get \"null_value\"\r\n\r\n`GET person/_search\r\n{\r\n  \"aggs\":{\r\n    \"nickname\":{\r\n      \"terms\": {\r\n        \"field\": \"nickname.keyword\",\r\n        \"size\": 10\r\n      }\r\n    }\r\n  }\r\n}`\r\n\r\neventually what I am trying to perform is to query exists on thus field, can you advice me ho to do soo?\r\n\r\nI thought about doing aggs and count if I have only 1 bucket of null_value, and the total docs of it is equal to my all my document..\r\nbut it's a complex and quite expensive than exists query.\r\n\r\n\r\nthank for attention,\r\nI do really appreciate it :)\r\n ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432578898","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-432578898","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":432578898,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjU3ODg5OA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-24T09:13:40Z","updated_at":"2018-10-24T09:13:40Z","author_association":"MEMBER","body":"@azulay7 The `_source` is never modified by Elasticsearch and always returns the exact JSON that was used int eh index request at index time, this is why the `_source` shows `null` for fields with a `null_value`. The reason for doing this is that it gives you the original document you indexed rather than a response that contains all the modifications that are made to surface the document better in searches. \r\n\r\nIf you want to perform an exists query that also filters out documents which have the null value you can combine an exists query with a term query for the null value in a boolean query and this should achieve what you are looking for?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/432923614","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-432923614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":432923614,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMjkyMzYxNA==","user":{"login":"azulay7","id":19120,"node_id":"MDQ6VXNlcjE5MTIw","avatar_url":"https://avatars1.githubusercontent.com/u/19120?v=4","gravatar_id":"","url":"https://api.github.com/users/azulay7","html_url":"https://github.com/azulay7","followers_url":"https://api.github.com/users/azulay7/followers","following_url":"https://api.github.com/users/azulay7/following{/other_user}","gists_url":"https://api.github.com/users/azulay7/gists{/gist_id}","starred_url":"https://api.github.com/users/azulay7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azulay7/subscriptions","organizations_url":"https://api.github.com/users/azulay7/orgs","repos_url":"https://api.github.com/users/azulay7/repos","events_url":"https://api.github.com/users/azulay7/events{/privacy}","received_events_url":"https://api.github.com/users/azulay7/received_events","type":"User","site_admin":false},"created_at":"2018-10-25T05:53:16Z","updated_at":"2018-10-25T05:53:16Z","author_association":"NONE","body":"@colings86 Thank you for clarifying this point for me. I understand why elasitc preserve the original \r\n`_source`.\r\n\r\nand yes I'm looking for a query like this. can you add example of your own?\r\nit will be really helpful.\r\n\r\nThanks!\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/433354906","html_url":"https://github.com/elastic/elasticsearch/issues/34677#issuecomment-433354906","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34677","id":433354906,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMzM1NDkwNg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-10-26T09:55:17Z","updated_at":"2018-10-26T09:55:17Z","author_association":"MEMBER","body":"Something liek this should give the desired result:\r\n\r\n```\r\nGET person/_search\r\n{\r\n  \"size\": 0,\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"exists\": {\r\n            \"field\": \"grade\"\r\n          }\r\n        },\r\n        {\r\n          \"bool\": {\r\n            \"must_not\": [\r\n              {\r\n                \"term\": {\r\n                  \"grade\": -1\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null}]