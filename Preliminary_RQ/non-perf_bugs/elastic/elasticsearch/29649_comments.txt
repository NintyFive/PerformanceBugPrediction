[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383479402","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-383479402","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":383479402,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzQ3OTQwMg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-04-23T07:24:03Z","updated_at":"2018-04-23T07:24:03Z","author_association":"MEMBER","body":"Thanks @redlus. It looks similar to other issue we saw. I'm going to look closer at this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383499063","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-383499063","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":383499063,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzQ5OTA2Mw==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-04-23T08:39:55Z","updated_at":"2018-04-23T08:39:55Z","author_association":"NONE","body":"Thanks. Is there an open issue for what you mentioned?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383554512","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-383554512","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":383554512,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzU1NDUxMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-23T12:17:14Z","updated_at":"2018-04-23T12:17:14Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383557167","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-383557167","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":383557167,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzU1NzE2Nw==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-04-23T12:27:30Z","updated_at":"2018-04-23T12:27:30Z","author_association":"NONE","body":"@tlrx a quick update:\r\nI've deleted all the repositories from elasticsearch, and created new (empty) repositories with the same name but pointing to a different container name within the Azure blob storage account. Snapshots are created, restored and deleted without errors.\r\n\r\nThis seems to indicate that repositories and snapshots created with elasticsearch 5.2.2 have some collision with create / restore / delete snapshot commands run on the same repos from elasticsearch 6.2.3.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383559380","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-383559380","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":383559380,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzU1OTM4MA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-04-23T12:35:26Z","updated_at":"2018-04-23T12:35:26Z","author_association":"MEMBER","body":"> This seems to indicate that repositories and snapshots created with elasticsearch 5.2.2 have some collision with create / restore / delete snapshot commands run on the same repos from elasticsearch 6.2.3.\r\n\r\nJust to double check, does it mean that two clusters in different versions where writing to the same repository (Azure container) at the same time?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383577134","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-383577134","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":383577134,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzU3NzEzNA==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-04-23T13:35:05Z","updated_at":"2018-04-23T13:35:05Z","author_association":"NONE","body":"There were two phases. First, v5.2.2 successfully created snapshots and v6.2.3 successfully restored snapshots. Then the old v5.2.2 cluster was taken down, and v6.2.3 was now trying to create snapshots onto the same repo - resulting in the NullPointerException above.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383854346","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-383854346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":383854346,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Mzg1NDM0Ng==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-04-24T08:48:51Z","updated_at":"2018-04-24T08:48:51Z","author_association":"MEMBER","body":"> This seems to indicate that repositories and snapshots created with elasticsearch 5.2.2 have some collision with create / restore / delete snapshot commands run on the same repos from elasticsearch 6.2.3.\r\n\r\nThanks for your responses. \r\n\r\nIn your case, you snapshotted data from 5.2.2 and restored them on 6.2.3. We usually advise to upgrade to the latest 5.x version first and then move to the next major version (see https://www.elastic.co/guide/en/elasticsearch/reference/6.2/setup-upgrade.html).\r\n\r\nAlso, according to the [the documentation](\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/modules-snapshots.html):\r\n\r\n> The snapshot format can change across major versions, so if you have clusters on different major versions trying to write the same repository, new snapshots written by one version will not be visible to the other. While setting the repository to readonly on all but one of the clusters should work with multiple clusters differing by one major version, it is not a supported configuration.\r\n\r\nIt means that the repository created using the 5.2.2 cluster must only be accessed by this 5.2.2 cluster for creating or deleting snapshots. \r\n\r\nThe cluster 6.2.3 can register the 5.2.2 repository too but it must be read-only. This way the 6.2.3 cluster can restore data from 5.2.2 but cannot create or delete snapshots. \r\n\r\nIf you want to create snapshots of the 6.2.3 cluster then you have to register a new repository in a different container/bucket/folder, as you did.\r\n\r\n> Is there an open issue for what you mentioned?\r\n\r\nFinally found it :) See #29052 where a user had a similar issue than yours and the pull request #26127 that fixed the issue #25878.\r\n\r\nI'm going to close this issue in favor of #29052.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383861902","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-383861902","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":383861902,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Mzg2MTkwMg==","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"created_at":"2018-04-24T09:14:12Z","updated_at":"2018-04-24T09:14:12Z","author_association":"NONE","body":"Ok, thanks for the update.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384355243","html_url":"https://github.com/elastic/elasticsearch/issues/29649#issuecomment-384355243","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29649","id":384355243,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDM1NTI0Mw==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-04-25T16:46:54Z","updated_at":"2018-04-25T16:46:54Z","author_association":"MEMBER","body":"Thanks @redlus, the description of your problem helped me to find a reproducible scenario where such NPE is thrown. See #30140 for some boring information :)","performed_via_github_app":null}]