{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5255","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5255/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5255/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5255/events","html_url":"https://github.com/elastic/elasticsearch/issues/5255","id":28254478,"node_id":"MDU6SXNzdWUyODI1NDQ3OA==","number":5255,"title":"geo_distance - can't filter by inner (object) type ` UncheckedExecutionException - java.lang.NumberFormatException`","user":{"login":"g00fy-","id":843807,"node_id":"MDQ6VXNlcjg0MzgwNw==","avatar_url":"https://avatars3.githubusercontent.com/u/843807?v=4","gravatar_id":"","url":"https://api.github.com/users/g00fy-","html_url":"https://github.com/g00fy-","followers_url":"https://api.github.com/users/g00fy-/followers","following_url":"https://api.github.com/users/g00fy-/following{/other_user}","gists_url":"https://api.github.com/users/g00fy-/gists{/gist_id}","starred_url":"https://api.github.com/users/g00fy-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/g00fy-/subscriptions","organizations_url":"https://api.github.com/users/g00fy-/orgs","repos_url":"https://api.github.com/users/g00fy-/repos","events_url":"https://api.github.com/users/g00fy-/events{/privacy}","received_events_url":"https://api.github.com/users/g00fy-/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"assignees":[{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false}],"milestone":null,"comments":17,"created_at":"2014-02-25T15:14:26Z","updated_at":"2014-12-29T12:45:07Z","closed_at":"2014-12-29T12:45:07Z","author_association":"NONE","active_lock_reason":null,"body":"According to [docs](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-geo-distance-filter.html) I should be able to filter by inner (not nested) object attribute (in my case place.point)\n\nMy mapping looks like:\n\n``` javascript\n{\n  \"proposalsets\": {\n    \"_parent\": {\n      \"type\": \"service\"\n    },\n    \"_ttl\": {\n      \"enabled\": true\n    },\n    \"properties\": {\n      \"place\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"name\": {\n            \"type\": \"string\",\n            \"index\": \"analyzed\",\n            \"analyzer\": \"polish\",\n            \"fields\": {\n              \"raw\": {\n                \"type\": \"string\",\n                \"index\": \"not_analyzed\"\n              }\n            }\n          },\n          \"point\": {\n            \"type\": \"geo_point\",\n            \"fielddata\": {\n              \"format\": \"compressed\",\n              \"precision\": \"3m\"\n            }\n          },\n          \"city\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nThe query I am trygin to execute is :\n\n``` javascript\n{\n   \"query\": {\n      \"filtered\": {\n         \"filter\": {\n            \"geo_distance\": {\n               \"distance\": \"100km\",\n               \"place.point\": {\n                  \"lat\": 40.73,\n                  \"lon\": -74.1\n               }\n            }\n         }\n      }\n   }\n}\n```\n\n``` javascript\n{\n   \"error\": \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[OnU2dSO5ROKwYQWpQzpmEA][pl][5]: QueryPhaseExecutionException[[pl][5]: query[filtered(ConstantScore(GeoDistanceFilter(place.point, SLOPPY_ARC, 100000.0, 40.73, -74.1)))->cache(_type:proposalsets)],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[java.lang.NumberFormatException: For input string: \\\"@\\u0018B\\\"]; nested: UncheckedExecutionException[java.lang.NumberFormatException: For input string: \\\"@\\u0018B\\\"]; nested: NumberFormatException[For input string: \\\"@\\u0018B\\\"]; }{[OnU2dSO5ROKwYQWpQzpmEA][pl][4]: QueryPhaseExecutionException[[pl][4]: query[filtered(ConstantScore(GeoDistanceFilter(place.point, SLOPPY_ARC, 100000.0, 40.73, -74.1)))->cache(_type:proposalsets)],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[java.lang.NumberFormatException: empty String]; nested: UncheckedExecutionException[java.lang.NumberFormatException: empty String]; nested: NumberFormatException[empty String]; }{[OnU2dSO5ROKwYQWpQzpmEA][pl][7]: QueryPhaseExecutionException[[pl][7]: query[filtered(ConstantScore(GeoDistanceFilter(place.point, SLOPPY_ARC, 100000.0, 40.73, -74.1)))->cache(_type:proposalsets)],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[java.lang.NumberFormatException: For input string: \\\"(`\\u0012:v\\n~\\\"]; nested: UncheckedExecutionException[java.lang.NumberFormatException: For input string: \\\"(`\\u0012:v\\n~\\\"]; nested: NumberFormatException[For input string: \\\"(`\\u0012:v\\n~\\\"]; }{[OnU2dSO5ROKwYQWpQzpmEA][pl][6]: QueryPhaseExecutionException[[pl][6]: query[filtered(ConstantScore(GeoDistanceFilter(place.point, SLOPPY_ARC, 100000.0, 40.73, -74.1)))->cache(_type:proposalsets)],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[java.lang.NumberFormatException: For input string: \\\"@%\\\"]; nested: UncheckedExecutionException[java.lang.NumberFormatException: For input string: \\\"@%\\\"]; nested: NumberFormatException[For input string: \\\"@%\\\"]; }{[OnU2dSO5ROKwYQWpQzpmEA][pl][1]: QueryPhaseExecutionException[[pl][1]: query[filtered(ConstantScore(GeoDistanceFilter(place.point, SLOPPY_ARC, 100000.0, 40.73, -74.1)))->cache(_type:proposalsets)],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[java.lang.NumberFormatException: For input string: \\\"$\\\"]; nested: UncheckedExecutionException[java.lang.NumberFormatException: For input string: \\\"$\\\"]; nested: NumberFormatException[For input string: \\\"$\\\"]; }{[OnU2dSO5ROKwYQWpQzpmEA][pl][0]: QueryPhaseExecutionException[[pl][0]: query[filtered(ConstantScore(GeoDistanceFilter(place.point, SLOPPY_ARC, 100000.0, 40.73, -74.1)))->cache(_type:proposalsets)],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[java.lang.NumberFormatException: For input string: \\\"@\\u0019&\\\"]; nested: UncheckedExecutionException[java.lang.NumberFormatException: For input string: \\\"@\\u0019&\\\"]; nested: NumberFormatException[For input string: \\\"@\\u0019&\\\"]; }{[OnU2dSO5ROKwYQWpQzpmEA][pl][3]: QueryPhaseExecutionException[[pl][3]: query[filtered(ConstantScore(GeoDistanceFilter(place.point, SLOPPY_ARC, 100000.0, 40.73, -74.1)))->cache(_type:proposalsets)],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[java.lang.NumberFormatException: For input string: \\\"$\\f\\u0001C\\\"]; nested: UncheckedExecutionException[java.lang.NumberFormatException: For input string: \\\"$\\f\\u0001C\\\"]; nested: NumberFormatException[For input string: \\\"$\\f\\u0001C\\\"]; }{[OnU2dSO5ROKwYQWpQzpmEA][pl][2]: QueryPhaseExecutionException[[pl][2]: query[filtered(ConstantScore(GeoDistanceFilter(place.point, SLOPPY_ARC, 100000.0, 40.73, -74.1)))->cache(_type:proposalsets)],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[java.lang.NumberFormatException: For input string: \\\"$\\\"]; nested: UncheckedExecutionException[java.lang.NumberFormatException: For input string: \\\"$\\\"]; nested: NumberFormatException[For input string: \\\"$\\\"]; }]\",\n   \"status\": 500\n}\n```\n\nThis happens even when the index is empty (but has mapping). \nWhen I move the point from the place to the root of the document, there seems to be no problem.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}