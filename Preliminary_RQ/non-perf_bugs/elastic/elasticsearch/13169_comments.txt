[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/135599761","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-135599761","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":135599761,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNTU5OTc2MQ==","user":{"login":"rayward","id":1217111,"node_id":"MDQ6VXNlcjEyMTcxMTE=","avatar_url":"https://avatars1.githubusercontent.com/u/1217111?v=4","gravatar_id":"","url":"https://api.github.com/users/rayward","html_url":"https://github.com/rayward","followers_url":"https://api.github.com/users/rayward/followers","following_url":"https://api.github.com/users/rayward/following{/other_user}","gists_url":"https://api.github.com/users/rayward/gists{/gist_id}","starred_url":"https://api.github.com/users/rayward/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rayward/subscriptions","organizations_url":"https://api.github.com/users/rayward/orgs","repos_url":"https://api.github.com/users/rayward/repos","events_url":"https://api.github.com/users/rayward/events{/privacy}","received_events_url":"https://api.github.com/users/rayward/received_events","type":"User","site_admin":false},"created_at":"2015-08-28T01:29:24Z","updated_at":"2015-08-28T01:38:32Z","author_association":"NONE","body":"Also getting a similar error on a `_parent` field which I have on only one type.\n\n```\n\"_parent\": {\n  \"type\": \"product\",\n  \"fielddata\": {\n    \"loading\": \"eager_global_ordinals\"\n  }\n}\n```\n\n```\njava.lang.IllegalStateException: unable to upgrade the mappings for the index [myindex], reason: [Mapper for [_parent] conflicts with existing mapping in other types:\n[mapper [_parent] is used by multiple types. Set update_all_types to true to update [fielddata] across all types.]]\n```\n\nAlso, the migration plugin only had informational messages (eg. `required` on `_routing`), nothing that would stop an upgrade.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/135764396","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-135764396","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":135764396,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNTc2NDM5Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-08-28T12:37:31Z","updated_at":"2015-08-28T12:37:31Z","author_association":"CONTRIBUTOR","body":"Hi @rayward \n\nThanks for testing out the beta, and for reporting these bugs.  I think the analyzer problem will be fixed by https://github.com/rjernst/elasticsearch/commit/2e4a053b4283f941999e5ab580f3883c36c952b7 but the _parent issue needs further investigation.\n\nTo reproduce, create this index on 1.x:\n\n```\nPUT /test\n{\n  \"mappings\": {\n    \"parent\": {},\n    \"child\": {\n      \"_parent\": {\n        \"type\": \"parent\",\n        \"fielddata\": {\n          \"loading\": \"eager_global_ordinals\"\n        }\n      }\n    }\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136276860","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-136276860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":136276860,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjI3Njg2MA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-08-31T06:07:39Z","updated_at":"2015-08-31T06:07:39Z","author_association":"MEMBER","body":"I agree the first issue described should be fixed by #13206.\n\nThe issue with `_parent` is a known issue, and unavoidable at this time (without further refactoring of how mappings work). @clintongormley There are two types in your example, `parent`, and `child`. Because parent is added first (types are added one at a time), it gets the default `_parent` setup with lazy loading. When the second `child` type is parsed, the `_parent` field is now different.\n\nThe problem is that all types have a `_parent` field. To fix this, we need to selectively add `_parent` (only when the user actually specifies it for the type), but that is much different than we do today (all meta fields are added to all types). I'm also not sure what effect not having `_parent` on all types would have an existing parent/child code.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136349466","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-136349466","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":136349466,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjM0OTQ2Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-08-31T11:54:16Z","updated_at":"2015-08-31T11:54:16Z","author_association":"CONTRIBUTOR","body":"@martijnvg could you comment on https://github.com/elastic/elasticsearch/issues/13169#issuecomment-136276860 please?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136694467","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-136694467","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":136694467,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjY5NDQ2Nw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-09-01T12:23:51Z","updated_at":"2015-09-01T12:23:51Z","author_association":"MEMBER","body":"@rjernst @clintongormley I think it may work. I'm going to try out if making the `_parent` optional is working out.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136735644","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-136735644","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":136735644,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjczNTY0NA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-09-01T14:16:14Z","updated_at":"2015-09-01T14:16:14Z","author_association":"MEMBER","body":"Internally removing  the _parent field from DocumentMapper works out for the old p/c implementation, but not for the new implementation (that uses doc values and Lucene's JoinUtil). The disabled `_parent` for parent types is used to write to a doc values join field and if the parent field is removed has_child/has_parent won't be able to work because parent docs don't write to the join field.\n\nJust thinking out loud, but what we can try to do is:\n1) Remove the notion of 'active' from the parent field\n2) add the notion that a document can be a child or a parent\n3) all type we always have a _parent field in the mapping\n4) but it only gets used by documents if it either is a parent or a child\n5) I think this way all _parent fields in all types can have the same settings. (besides the `type` there are pointing to, but that is ok)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136974040","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-136974040","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":136974040,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjk3NDA0MA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T08:20:40Z","updated_at":"2015-09-02T08:20:40Z","author_association":"CONTRIBUTOR","body":"Maybe the bug is that `loading` should be allowed to be different across types? The `_parent` field actually stores data in a field that depends on the type name (_parent#type) so having different settings per type does not introduce inconsistencies at the Lucene level?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137145852","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-137145852","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":137145852,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzE0NTg1Mg==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T16:06:32Z","updated_at":"2015-09-02T16:06:32Z","author_association":"MEMBER","body":"> The _parent field actually stores data in a field that depends on the type name (_parent#type) so having different settings per type\n\nMaybe the problem is we aren't using this name in map of field types? If we use that as the key, instead of `_parent` we won't have any conflicts.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137197262","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-137197262","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":137197262,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzE5NzI2Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T18:18:51Z","updated_at":"2015-09-02T18:18:51Z","author_association":"CONTRIBUTOR","body":"@rjernst you mean internally, rather than in the API?  Using it in the API would make it difficult to explain\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137203356","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-137203356","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":137203356,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzIwMzM1Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T18:37:11Z","updated_at":"2015-09-02T18:37:11Z","author_association":"MEMBER","body":"Yes, I mean internally.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137452096","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-137452096","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":137452096,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzQ1MjA5Ng==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-09-03T13:46:53Z","updated_at":"2015-09-03T13:46:53Z","author_association":"MEMBER","body":"@rjernst @jpountz I like the idea of internally mapping the _parent field under a name that takes the type into account. I quickly checked this and this seem to work out. Both the upgrade works without an error and has_child/has_parent queries work. \n\nHowever after running some more tests, I realized that there are other issues. One can include the `_parent` field in the search hits, query by `_parent` field or sort by it. In these case we lookup the field mapping and that doesn't map correctly. There is no `_parent` field, but fields with `_parent*` prefix. Not sure how to resolve this. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137459472","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-137459472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":137459472,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzQ1OTQ3Mg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-09-03T14:01:30Z","updated_at":"2015-09-03T14:01:30Z","author_association":"CONTRIBUTOR","body":"Hmm, so maybe we should be able to have 2 field types? One called _parent that would only be stored and another one called _parent#type that would only be doc-valued?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137462220","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-137462220","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":137462220,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzQ2MjIyMA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-09-03T14:12:31Z","updated_at":"2015-09-03T14:12:31Z","author_association":"MEMBER","body":"Right, that would solve it, just not sure how to would like. The ParentFieldMapper can only produce one `MappedFieldType`. We then need to add another field mapper?\n\nTaking a step back, maybe just allowing the the `loading` part of field data settings to be different is okay for 2.0? This is a much smaller change. We can then work on a  better fix for 2.x and 3.0. The fact that `ParentFieldMapper` now embeds more fields then it used to should be addressed? We maybe break it out in different fields (multiple unique join fields that connects docs of a different type).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137788434","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-137788434","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":137788434,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzc4ODQzNA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-09-04T16:47:58Z","updated_at":"2015-09-04T16:47:58Z","author_association":"MEMBER","body":"Yesterday we discussed that _parent field should use an unique internal field type name per type. So that when the mapping compatibility check is performed no check would fail since each field would be unique and having different field data settings wouldn't matter.\n\nMaking that change has one important implication the `_parent` field can't used directly in many places in all the APIs. The most notable place would be in the query dsl and we decided that we should have a `_parent_id` query to cover this. Also how we lookup the `_parent` id for search hits in the _search api requires a special sub fetch phase. \n\nI went a head and made change: https://github.com/martijnvg/elasticsearch/commit/26e2e5d95d2b3a3f778a759ed7a7ea2de9b09842\n\nHowever things got tricky and I had to make more changes that I would like:\n- Due to difference of p/c query implementation, several checks had to be in place to make sure that the right fields were picked.\n- Sorting and aggregating by _parent field wouldn't work too. Whether we should remain to support this is a good question (I lean towards not). \n- To maintain the support for specifying the parent id in the `_parent` field in a document required a very subtle change for 1.x indices. (this is no longer allowed in 2.x indices)\n- In the field data cache we would end up with multiple _parent field entries per field type. (not sure if this is bad)\n- Clear cache by _parent field wouldn't work too.\n\nThe change grew to a level that I'm not comfortable porting it back to 2.0 and I think we should completely revise the _parent field. For example with the new implementation we don't need to store _parent indexed and stored field. The join doc values fields are sufficient. The _parent Lucene fields just exist for the old parent child implementation. Also if we going to revise types this is going to have a big impact on the _parent field (if it still exists then).\n\nI think for 2.0 we need to make a compromise in order to keep the change small and low risk. Disabling the field data settings would work, but that wouldn't be nice for all the other fields. So I think disabling the field type compatibility check on the _parent field is maybe the right workaround for now:\nhttps://github.com/martijnvg/elasticsearch/commits/mapping/disable_compatibility_check_for_parent_field\n\nThe only field type related setting that can be set on _parent field is field data loading. All the other settings aren't configurable. I think that makes this workaround better then disabling field data settings for all fields.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138085593","html_url":"https://github.com/elastic/elasticsearch/issues/13169#issuecomment-138085593","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13169","id":138085593,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODA4NTU5Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-06T13:21:23Z","updated_at":"2015-09-06T13:21:23Z","author_association":"CONTRIBUTOR","body":"@martijnvg ++\n","performed_via_github_app":null}]