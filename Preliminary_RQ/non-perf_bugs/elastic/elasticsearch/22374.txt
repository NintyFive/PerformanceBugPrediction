{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22374","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22374/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22374/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22374/events","html_url":"https://github.com/elastic/elasticsearch/issues/22374","id":198057959,"node_id":"MDU6SXNzdWUxOTgwNTc5NTk=","number":22374,"title":"Elastic Search \"should\" clause is not working as expected when \"should\", \"must\" and \"must_not\" clause are present.","user":{"login":"bandikishores","id":10301623,"node_id":"MDQ6VXNlcjEwMzAxNjIz","avatar_url":"https://avatars3.githubusercontent.com/u/10301623?v=4","gravatar_id":"","url":"https://api.github.com/users/bandikishores","html_url":"https://github.com/bandikishores","followers_url":"https://api.github.com/users/bandikishores/followers","following_url":"https://api.github.com/users/bandikishores/following{/other_user}","gists_url":"https://api.github.com/users/bandikishores/gists{/gist_id}","starred_url":"https://api.github.com/users/bandikishores/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bandikishores/subscriptions","organizations_url":"https://api.github.com/users/bandikishores/orgs","repos_url":"https://api.github.com/users/bandikishores/repos","events_url":"https://api.github.com/users/bandikishores/events{/privacy}","received_events_url":"https://api.github.com/users/bandikishores/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-12-29T19:38:23Z","updated_at":"2017-04-15T12:18:53Z","closed_at":"2016-12-30T05:07:06Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.1.1\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: 1.8.0_91\r\n\r\n**OS version**: Ubuntu 16.04 LTS\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen searching in Elastic Search using POST request.\r\n_Expected:_\r\nWhen \"should\", \"must\" and \"must_not\" clause are all present, then all 3 needs to be considered for selection.\r\n_Actual:_\r\nThe \"should\" clause is being ignored when \"should\", \"must\" and \"must_not\" clause are all present. Search basically ignores \"should\" and considers just \"must\",\"must_not\".\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Upload the data provided [here](https://raw.githubusercontent.com/elastic/elasticsearch/master/docs/src/test/resources/accounts.json) into elastic search.\r\n2. Fire below request:\r\n```\r\ncurl -XPOST 'localhost:9200/bank/account/_search?pretty' -d'\r\n    {\r\n      \"query\": {\r\n        \"bool\": {\r\n          \"should\": [\r\n            { \"match\": { \"address\": \"lane\" } },\r\n            { \"match_phrase\": { \"address\": \"mill avenue\" } }\r\n          ],\r\n          \"must\": [\r\n            { \"match\": { \"age\": \"38\" } }\r\n          ],\r\n          \"must_not\": [\r\n            { \"match\": { \"state\": \"ID\" } }\r\n          ]\r\n        }\r\n      },\r\n      \"from\": 0,\r\n      \"size\": 1,\r\n      \"_source\": [\"account_number\", \"balance\", \"firstname\", \"lastname\", \"age\", \"email\", \"address\", \"state\"],\r\n      \"sort\": [\r\n        { \"account_number\": \"asc\" },\r\n        { \"balance\": \"desc\"}\r\n      ]\r\n    }'\r\n```\r\n\r\n3. Response:\r\n```\r\n{\r\n  \"took\" : 6,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 36,\r\n    \"max_score\" : null,\r\n    \"hits\" : [\r\n      {\r\n        \"_index\" : \"bank\",\r\n        \"_type\" : \"account\",\r\n        \"_id\" : \"21\",\r\n        \"_score\" : null,\r\n        \"_source\" : {\r\n          \"account_number\" : 21,\r\n          \"firstname\" : \"Estella\",\r\n          \"address\" : \"859 Portal Street\",\r\n          \"balance\" : 7004,\r\n          \"state\" : \"WV\",\r\n          \"age\" : 38,\r\n          \"email\" : \"estellapaul@zillatide.com\",\r\n          \"lastname\" : \"Paul\"\r\n        },\r\n        \"sort\" : [\r\n          21,\r\n          7004\r\n        ]\r\n      }\r\n    ]\r\n  }\r\n}\r\n\r\n```\r\n\r\nResult:\r\nThe record with address **\"859 Portal Street\"** was received and **it doesn't contain \"lane\" or \"mill avenue\"**.\r\n\r\n\r\n","closed_by":{"login":"bandikishores","id":10301623,"node_id":"MDQ6VXNlcjEwMzAxNjIz","avatar_url":"https://avatars3.githubusercontent.com/u/10301623?v=4","gravatar_id":"","url":"https://api.github.com/users/bandikishores","html_url":"https://github.com/bandikishores","followers_url":"https://api.github.com/users/bandikishores/followers","following_url":"https://api.github.com/users/bandikishores/following{/other_user}","gists_url":"https://api.github.com/users/bandikishores/gists{/gist_id}","starred_url":"https://api.github.com/users/bandikishores/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bandikishores/subscriptions","organizations_url":"https://api.github.com/users/bandikishores/orgs","repos_url":"https://api.github.com/users/bandikishores/repos","events_url":"https://api.github.com/users/bandikishores/events{/privacy}","received_events_url":"https://api.github.com/users/bandikishores/received_events","type":"User","site_admin":false},"performed_via_github_app":null}