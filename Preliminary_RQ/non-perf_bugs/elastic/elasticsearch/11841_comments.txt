[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114878199","html_url":"https://github.com/elastic/elasticsearch/issues/11841#issuecomment-114878199","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11841","id":114878199,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDg3ODE5OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-24T14:05:10Z","updated_at":"2015-06-24T14:05:10Z","author_association":"CONTRIBUTOR","body":"Hi @dmfenton \n\nThe geohash would need to be stored in order to be accessible, but there seems to be no way to set it to stored, eg with this mapping:\n\n```\n    \"centroid\": {\n      \"type\": \"geo_point\",\n      \"geohash\": true,\n      \"geohash_prefix\": true,\n      \"geohash_precision\": 8,\n      \"store\": true\n    }\n```\n\nthis request:\n\n```\nGET _mapping/field/centroid*?include_defaults\n```\n\nreturns\n\n```\n       \"centroid\": {\n           \"full_name\": \"centroid\",\n           \"mapping\": {\n              \"centroid\": {\n                 \"type\": \"geo_point\",\n                 \"boost\": 1,\n                 \"index\": \"not_analyzed\",\n                 \"store\": true,\n                 \"doc_values\": false,\n                 \"term_vector\": \"no\",\n                 \"norms\": {\n                    \"enabled\": false\n                 },\n                 \"index_options\": \"docs\",\n                 \"analyzer\": \"_keyword\",\n                 \"similarity\": \"default\",\n                 \"fielddata\": {},\n                 \"path\": \"full\",\n                 \"lat_lon\": false,\n                 \"geohash\": true,\n                 \"geohash_prefix\": true,\n                 \"geohash_precision\": 8,\n                 \"validate\": true,\n                 \"normalize\": true\n              }\n           }\n        }\n```\n\n@nknize would exposing the ability to set the geohash as stored make sense?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114880802","html_url":"https://github.com/elastic/elasticsearch/issues/11841#issuecomment-114880802","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11841","id":114880802,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDg4MDgwMg==","user":{"login":"dmfenton","id":7832202,"node_id":"MDQ6VXNlcjc4MzIyMDI=","avatar_url":"https://avatars1.githubusercontent.com/u/7832202?v=4","gravatar_id":"","url":"https://api.github.com/users/dmfenton","html_url":"https://github.com/dmfenton","followers_url":"https://api.github.com/users/dmfenton/followers","following_url":"https://api.github.com/users/dmfenton/following{/other_user}","gists_url":"https://api.github.com/users/dmfenton/gists{/gist_id}","starred_url":"https://api.github.com/users/dmfenton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmfenton/subscriptions","organizations_url":"https://api.github.com/users/dmfenton/orgs","repos_url":"https://api.github.com/users/dmfenton/repos","events_url":"https://api.github.com/users/dmfenton/events{/privacy}","received_events_url":"https://api.github.com/users/dmfenton/received_events","type":"User","site_admin":false},"created_at":"2015-06-24T14:11:57Z","updated_at":"2015-06-24T14:12:53Z","author_association":"NONE","body":"Thanks @clintongormley. Just want to draw attention to my real use case.\n\nAs a user, I want to know how many unique geohashes will be returned for a given filtered aggregation, without transporting all the data over the wire.\n\nEven better,\n\nAs a user, I want to request a geohash aggregation with a limit of x unique geohashes and have the response automatically determine the precision to send.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373520613","html_url":"https://github.com/elastic/elasticsearch/issues/11841#issuecomment-373520613","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11841","id":373520613,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzUyMDYxMw==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T20:58:00Z","updated_at":"2018-03-15T20:58:00Z","author_association":"CONTRIBUTOR","body":"I believe the behavior has slightly changed over time. Today this is the expected behavior:\r\n\r\nhttps://github.com/elastic/elasticsearch/issues/28875#issuecomment-370891928\r\n\r\nClosing","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373526343","html_url":"https://github.com/elastic/elasticsearch/issues/11841#issuecomment-373526343","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11841","id":373526343,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzUyNjM0Mw==","user":{"login":"dmfenton","id":7832202,"node_id":"MDQ6VXNlcjc4MzIyMDI=","avatar_url":"https://avatars1.githubusercontent.com/u/7832202?v=4","gravatar_id":"","url":"https://api.github.com/users/dmfenton","html_url":"https://github.com/dmfenton","followers_url":"https://api.github.com/users/dmfenton/followers","following_url":"https://api.github.com/users/dmfenton/following{/other_user}","gists_url":"https://api.github.com/users/dmfenton/gists{/gist_id}","starred_url":"https://api.github.com/users/dmfenton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmfenton/subscriptions","organizations_url":"https://api.github.com/users/dmfenton/orgs","repos_url":"https://api.github.com/users/dmfenton/repos","events_url":"https://api.github.com/users/dmfenton/events{/privacy}","received_events_url":"https://api.github.com/users/dmfenton/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T21:19:12Z","updated_at":"2018-03-15T21:19:12Z","author_association":"NONE","body":"@talevy That wasn't a very helpful closing message. I don't see anything in that comment that shows the ability to aggregate or return a calculated geohash.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373527871","html_url":"https://github.com/elastic/elasticsearch/issues/11841#issuecomment-373527871","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11841","id":373527871,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzUyNzg3MQ==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T21:25:18Z","updated_at":"2018-03-15T21:26:40Z","author_association":"CONTRIBUTOR","body":"@dmfenton I apologize I misunderstood the original intent of this issue. I was weighing the title heavily and missed some of the details discussed\r\n\r\nThere is no auto-tuning of precision that is available, but by running a cardinality aggregation\r\non the keyword-valued geohash multifields (potentially scripted to check cardinality against each precision 1-12) to find out how many buckets you expect. Given the output of that, you can see which precision is best to use?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373528599","html_url":"https://github.com/elastic/elasticsearch/issues/11841#issuecomment-373528599","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11841","id":373528599,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzUyODU5OQ==","user":{"login":"dmfenton","id":7832202,"node_id":"MDQ6VXNlcjc4MzIyMDI=","avatar_url":"https://avatars1.githubusercontent.com/u/7832202?v=4","gravatar_id":"","url":"https://api.github.com/users/dmfenton","html_url":"https://github.com/dmfenton","followers_url":"https://api.github.com/users/dmfenton/followers","following_url":"https://api.github.com/users/dmfenton/following{/other_user}","gists_url":"https://api.github.com/users/dmfenton/gists{/gist_id}","starred_url":"https://api.github.com/users/dmfenton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmfenton/subscriptions","organizations_url":"https://api.github.com/users/dmfenton/orgs","repos_url":"https://api.github.com/users/dmfenton/repos","events_url":"https://api.github.com/users/dmfenton/events{/privacy}","received_events_url":"https://api.github.com/users/dmfenton/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T21:28:04Z","updated_at":"2018-03-15T21:28:04Z","author_association":"NONE","body":"@talevy thank you very much for the follow up. Can I actually return the calculated geohash from the source document?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373530967","html_url":"https://github.com/elastic/elasticsearch/issues/11841#issuecomment-373530967","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11841","id":373530967,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzUzMDk2Nw==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T21:37:24Z","updated_at":"2018-03-15T21:37:24Z","author_association":"CONTRIBUTOR","body":"@dmfenton \r\nthis is what I meant\r\n\r\ncalculating expected number of buckets per-precision for geohashes:\r\n```\r\nGET geohash_agg_test/location/_search\r\n{\r\n  \"size\": 0,\r\n  \"aggs\": {\r\n    \"my_hack\": {\r\n      \"cardinality\": {\r\n        \"script\": {\r\n        \"source\": \"doc['gisPoint.geohash'].value.substring(0, params.precision)\",\r\n        \"params\": {\r\n          \"precision\": 1\r\n        }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nIf you would like to retrieve the geohash, you must update the example mapping to explicitly [store](https://www.elastic.co/guide/en/elasticsearch/reference/6.0/mapping-store.html) the value of `gisPoint.geohash`\r\n\r\nexample:\r\n\r\n```\r\nPUT geohash_agg_test\r\n{\r\n  \"mappings\": {\r\n    \"location\": {\r\n      \"properties\": {\r\n        \"gisPoint\": {\r\n          \"type\": \"geo_point\",\r\n          \"fields\": {\r\n            \"geohash\": {\r\n              \"store\": true,\r\n              \"type\": \"keyword\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// retrieving the value\r\n\r\nGET geohash_agg_test/location/_search\r\n{\r\n  \"size\": 1,\r\n  \"stored_fields\": [\"gisPoint.geohash\"], \r\n  \"query\": {\r\n    \"match\": {\r\n      \"_id\": 1\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373531187","html_url":"https://github.com/elastic/elasticsearch/issues/11841#issuecomment-373531187","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11841","id":373531187,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzUzMTE4Nw==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T21:38:19Z","updated_at":"2018-03-15T21:38:19Z","author_association":"CONTRIBUTOR","body":"Let me know if that answers your questions! once again, I apologize for the incorrect evaluation of this issue when closing","performed_via_github_app":null}]