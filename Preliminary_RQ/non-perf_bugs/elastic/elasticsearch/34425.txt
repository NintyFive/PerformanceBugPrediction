{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34425","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34425/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34425/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34425/events","html_url":"https://github.com/elastic/elasticsearch/issues/34425","id":369740240,"node_id":"MDU6SXNzdWUzNjk3NDAyNDA=","number":34425,"title":"Canâ€™t get Top Level Inner Hits with search results in 6.x","user":{"login":"benbenwilde","id":3302573,"node_id":"MDQ6VXNlcjMzMDI1NzM=","avatar_url":"https://avatars3.githubusercontent.com/u/3302573?v=4","gravatar_id":"","url":"https://api.github.com/users/benbenwilde","html_url":"https://github.com/benbenwilde","followers_url":"https://api.github.com/users/benbenwilde/followers","following_url":"https://api.github.com/users/benbenwilde/following{/other_user}","gists_url":"https://api.github.com/users/benbenwilde/gists{/gist_id}","starred_url":"https://api.github.com/users/benbenwilde/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benbenwilde/subscriptions","organizations_url":"https://api.github.com/users/benbenwilde/orgs","repos_url":"https://api.github.com/users/benbenwilde/repos","events_url":"https://api.github.com/users/benbenwilde/events{/privacy}","received_events_url":"https://api.github.com/users/benbenwilde/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-10-12T23:21:18Z","updated_at":"2018-10-17T20:59:01Z","closed_at":"2018-10-12T23:28:59Z","author_association":"NONE","active_lock_reason":null,"body":"I'm trying to execute a query that returns a set of results while also including an independently filtered set of inner hits for those results.\r\n\r\nThis was easy in version 2.x, since I could add a top level inner hits section to the request with it's own independent filter. This way, I could return only the inner hits that I needed without changing the query.\r\n\r\nNow in 6.x, the only way I see that I can do this is by making two separate round trip requests to the cluster which is definitely not ideal.\r\n\r\nHow can do this in a single request?\r\n\r\n- - - - - - - - - - -\r\n\r\nHere is the request I was successfully using in 2.x, that i would like to replicate in 6.x:\r\n`POST index1/parent/_search`\r\n```\r\n{\r\n    \"from\": 0,\r\n    \"size\": 100,\r\n    \"sort\": [\r\n        {\r\n            \"time\": {\r\n                \"order\": \"desc\"\r\n            }\r\n        }\r\n    ],\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"must\": [\r\n                {\r\n                    \"terms\": {\r\n                        \"thingIds\": [\r\n                            \"thing/345\"\r\n                        ]\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    },\r\n    \"inner_hits\": {\r\n        \"comments\": {\r\n            \"type\": {\r\n                \"child\": {\r\n                    \"query\": {\r\n                        \"terms\": {\r\n                            \"doc.userId\": [\r\n                                \"u/1234\"\r\n                            ]\r\n                        }\r\n                    },\r\n                    \"size\": 1000\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}