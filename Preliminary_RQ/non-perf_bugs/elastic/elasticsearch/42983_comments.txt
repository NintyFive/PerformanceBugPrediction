[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499915930","html_url":"https://github.com/elastic/elasticsearch/issues/42983#issuecomment-499915930","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","id":499915930,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTkxNTkzMA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T14:52:27Z","updated_at":"2019-06-07T14:52:27Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500040094","html_url":"https://github.com/elastic/elasticsearch/issues/42983#issuecomment-500040094","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","id":500040094,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDA0MDA5NA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T21:10:49Z","updated_at":"2019-06-07T21:10:49Z","author_association":"CONTRIBUTOR","body":"This sounds like the issue fixed by #39629. Are you running your nodes in containers? Can you set\r\n\r\n    logger.org.elasticsearch.cluster.service: TRACE\r\n\r\nand reproduce the problem, then share the full logs including stack traces?\r\n\r\n> Looks like we try to connect to ourself...\r\n\r\nThat message looks normal to me.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500041637","html_url":"https://github.com/elastic/elasticsearch/issues/42983#issuecomment-500041637","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","id":500041637,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDA0MTYzNw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T21:16:30Z","updated_at":"2019-06-07T21:16:30Z","author_association":"CONTRIBUTOR","body":"Also, what is the response from `cat /proc/sys/net/ipv4/tcp_retries2`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500334060","html_url":"https://github.com/elastic/elasticsearch/issues/42983#issuecomment-500334060","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","id":500334060,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDMzNDA2MA==","user":{"login":"svagner","id":2765622,"node_id":"MDQ6VXNlcjI3NjU2MjI=","avatar_url":"https://avatars0.githubusercontent.com/u/2765622?v=4","gravatar_id":"","url":"https://api.github.com/users/svagner","html_url":"https://github.com/svagner","followers_url":"https://api.github.com/users/svagner/followers","following_url":"https://api.github.com/users/svagner/following{/other_user}","gists_url":"https://api.github.com/users/svagner/gists{/gist_id}","starred_url":"https://api.github.com/users/svagner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/svagner/subscriptions","organizations_url":"https://api.github.com/users/svagner/orgs","repos_url":"https://api.github.com/users/svagner/repos","events_url":"https://api.github.com/users/svagner/events{/privacy}","received_events_url":"https://api.github.com/users/svagner/received_events","type":"User","site_admin":false},"created_at":"2019-06-10T08:23:09Z","updated_at":"2019-06-10T08:23:09Z","author_association":"NONE","body":"Hi! It is running in common NS (not in container).  \r\n```net.ipv4.tcp_retries2 = 5``` But I'm not sure that it is related with any retransmission (I didn't notice any abnormal retransmission rate). There is tcp info for connection between 2 masters:\r\n```\r\n\t cubic wscale:8,8 rto:201 rtt:0.218/0.02 ato:40 mss:1448 rcvmss:1448 advmss:1448 cwnd:16 bytes_acked:15563815 bytes_received:16633592 segs_out:28836 segs_in:28172 send 850.2Mbps lastsnd:40785421 lastrcv:40785420 lastack:27003 pacing_rate 1695.5Mbps rcv_rtt:2.5 rcv_space:29200\r\n\t cubic wscale:8,8 rto:201 rtt:0.212/0.017 ato:40 mss:1448 rcvmss:1448 advmss:1448 cwnd:16 bytes_acked:15692475 bytes_received:16783234 segs_out:28952 segs_in:28287 send 874.3Mbps lastsnd:40725644 lastrcv:40725643 lastack:27387 pacing_rate 1745.4Mbps rcv_rtt:1.875 rcv_space:29200\r\n\t cubic wscale:8,8 rto:201 rtt:0.217/0.025 ato:40 mss:1448 rcvmss:1448 advmss:1448 cwnd:16 bytes_acked:16873298 bytes_received:18031235 segs_out:29888 segs_in:29167 send 854.1Mbps lastsnd:10894 lastrcv:10889 lastack:10890 pacing_rate 1708.2Mbps rcv_rtt:2.125 rcv_space:29200\r\n\t cubic wscale:8,8 rto:203 rtt:2.775/1.396 ato:40 mss:1448 rcvmss:608 advmss:1448 cwnd:10 bytes_acked:388185 bytes_received:74851 segs_out:17134 segs_in:16893 send 41.7Mbps lastsnd:37115932 lastrcv:37115930 lastack:27388 pacing_rate 83.5Mbps rcv_rtt:5 rcv_space:29200\r\n\t cubic wscale:8,8 rto:201 rtt:0.23/0.021 ato:40 mss:1448 rcvmss:1448 advmss:1448 cwnd:16 bytes_acked:17047770 bytes_received:18223325 segs_out:29979 segs_in:29253 send 805.8Mbps lastsnd:45092 lastrcv:45090 lastack:15035 pacing_rate 1609.9Mbps rcv_rtt:2.125 rcv_space:29200\r\n\t cubic wscale:8,8 rto:200 rtt:0.09/0.045 mss:1448 rcvmss:536 advmss:1448 cwnd:10 bytes_acked:1 segs_out:16594 segs_in:16593 send 1287.1Mbps lastsnd:249555262 lastrcv:249951356 lastack:11644 pacing_rate 2574.2Mbps rcv_space:29200\r\n\t cubic wscale:8,8 rto:201 rtt:0.229/0.012 ato:40 mss:1448 rcvmss:1448 advmss:1448 cwnd:16 bytes_acked:16928763 bytes_received:18083291 segs_out:29929 segs_in:29200 send 809.4Mbps lastsnd:45051 lastrcv:45048 lastack:14972 pacing_rate 1616.1Mbps rcv_rtt:2.375 rcv_space:29200\r\n\t cubic wscale:8,8 rto:200 rtt:0.062/0.031 mss:1448 rcvmss:536 advmss:1448 cwnd:10 bytes_acked:1 segs_out:16594 segs_in:16593 send 1868.4Mbps lastsnd:249555262 lastrcv:249951356 lastack:11644 pacing_rate 3736.8Mbps rcv_space:29200\r\n\t cubic wscale:8,8 rto:201 rtt:0.338/0.033 ato:40 mss:1448 rcvmss:536 advmss:1448 cwnd:10 bytes_acked:90762673 bytes_received:5236308 segs_out:498700 segs_in:249372 send 342.7Mbps lastsnd:741 lastrcv:741 lastack:741 pacing_rate 683.7Mbps rcv_rtt:329129 rcv_space:29463\r\n\t cubic wscale:8,8 rto:201 rtt:0.068/0.027 ato:40 mss:1448 rcvmss:536 advmss:1448 cwnd:10 bytes_acked:59 bytes_received:25 segs_out:16596 segs_in:16595 send 1703.5Mbps lastsnd:249555262 lastrcv:249555206 lastack:11645 pacing_rate 3407.1Mbps rcv_space:29200\r\n\t cubic wscale:8,8 rto:201 rtt:0.216/0.02 ato:40 mss:1448 rcvmss:1448 advmss:1448 cwnd:16 bytes_acked:15550449 bytes_received:16619443 segs_out:28814 segs_in:28151 send 858.1Mbps lastsnd:40725638 lastrcv:40725635 lastack:27391 pacing_rate 1714.2Mbps rcv_rtt:2 rcv_space:29200\r\n```\r\n I'll be able to reproduce issue with trace logging tomorrow.\r\nThanks a lot for your help!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500337575","html_url":"https://github.com/elastic/elasticsearch/issues/42983#issuecomment-500337575","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","id":500337575,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDMzNzU3NQ==","user":{"login":"svagner","id":2765622,"node_id":"MDQ6VXNlcjI3NjU2MjI=","avatar_url":"https://avatars0.githubusercontent.com/u/2765622?v=4","gravatar_id":"","url":"https://api.github.com/users/svagner","html_url":"https://github.com/svagner","followers_url":"https://api.github.com/users/svagner/followers","following_url":"https://api.github.com/users/svagner/following{/other_user}","gists_url":"https://api.github.com/users/svagner/gists{/gist_id}","starred_url":"https://api.github.com/users/svagner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/svagner/subscriptions","organizations_url":"https://api.github.com/users/svagner/orgs","repos_url":"https://api.github.com/users/svagner/repos","events_url":"https://api.github.com/users/svagner/events{/privacy}","received_events_url":"https://api.github.com/users/svagner/received_events","type":"User","site_admin":false},"created_at":"2019-06-10T08:35:49Z","updated_at":"2019-06-10T08:35:49Z","author_association":"NONE","body":"For more information there is config for master nodes:\r\n/etc/elasticsearch/elasticsearch.yml\r\n```\r\ncluster.name: search7\r\npath.data: /var/lib/elasticsearch\r\npath.logs: /var/log/elasticsearch\r\ncluster.initial_master_nodes: [\"masterv7-1001\", \"masterv7-1002\", \"masterv7-1003\", \"masterv7-1004\", \"masterv7-1005\"]\r\nnode.name: masterv7-1003\r\nnode.attr.rack: Z0000004\r\nnode.attr.availability_zone: west\r\nnode.data: false\r\nnode.master: true\r\nnode.max_local_storage_nodes: 1\r\naction.destructive_requires_name: true\r\nbootstrap.memory_lock: true\r\nbootstrap.system_call_filter: false\r\ncluster.routing.allocation.awareness.attributes: rack\r\ncluster.routing.allocation.allow_rebalance: indices_all_active\r\ncluster.routing.allocation.node_initial_primaries_recoveries: 10\r\nindices.recovery.max_bytes_per_sec: 100mb\r\ncluster.routing.allocation.node_concurrent_incoming_recoveries: 15\r\ncluster.routing.allocation.node_concurrent_outgoing_recoveries: 15\r\ndiscovery.seed_providers: file\r\ndiscovery.zen.master_election.ignore_non_master_pings: true\r\nhttp.host: 127.0.0.1\r\ntransport.host: _site:ipv4_\r\nindices.fielddata.cache.size: 70%\r\ncluster.routing.allocation.disk.threshold_enabled: true\r\ncluster.routing.allocation.disk.watermark.high: 90%\r\ncluster.routing.allocation.enable: all\r\ncluster.routing.allocation.cluster_concurrent_rebalance: 15\r\ncluster.info.update.interval: 5m\r\nthread_pool.write.queue_size: 1000\r\nthread_pool.search.queue_size: 10000\r\ncluster.fault_detection.leader_check.timeout: 2s\r\ncluster.fault_detection.leader_check.retry_count: 3\r\nsearch.max_buckets: 50000\r\n```\r\n/etc/elasticsearch/unicast_hosts.txt:\r\n```\r\nmasterv7-1001\r\nmasterv7-1002\r\nmasterv7-1003\r\nmasterv7-1004\r\nmasterv7-1005\r\n```\r\nAll DNS queries are coming to local dns cache. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500340604","html_url":"https://github.com/elastic/elasticsearch/issues/42983#issuecomment-500340604","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","id":500340604,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDM0MDYwNA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-06-10T08:46:29Z","updated_at":"2019-06-10T08:46:29Z","author_association":"CONTRIBUTOR","body":"```\r\ncluster.fault_detection.leader_check.timeout: 2s\r\ncluster.fault_detection.leader_check.retry_count: 3\r\n```\r\n\r\nI recommend against setting these away from the default. With your config, you will see an unnecessary master election if the master spends even a few seconds in GC.\r\n\r\n```\r\nnet.ipv4.tcp_retries2 = 5\r\n```\r\n\r\nGood. This means the connection to the master should be detected as failed around 5-6 seconds after executing `echo c > /proc/sysrq-trigger`, triggering an immediate master election. IMO this is a better way to detect total master failure than `cluster.fault_detection.leader_check` because it is insensitive to application-level pauses like GC.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500745156","html_url":"https://github.com/elastic/elasticsearch/issues/42983#issuecomment-500745156","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","id":500745156,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDc0NTE1Ng==","user":{"login":"svagner","id":2765622,"node_id":"MDQ6VXNlcjI3NjU2MjI=","avatar_url":"https://avatars0.githubusercontent.com/u/2765622?v=4","gravatar_id":"","url":"https://api.github.com/users/svagner","html_url":"https://github.com/svagner","followers_url":"https://api.github.com/users/svagner/followers","following_url":"https://api.github.com/users/svagner/following{/other_user}","gists_url":"https://api.github.com/users/svagner/gists{/gist_id}","starred_url":"https://api.github.com/users/svagner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/svagner/subscriptions","organizations_url":"https://api.github.com/users/svagner/orgs","repos_url":"https://api.github.com/users/svagner/repos","events_url":"https://api.github.com/users/svagner/events{/privacy}","received_events_url":"https://api.github.com/users/svagner/received_events","type":"User","site_admin":false},"created_at":"2019-06-11T08:38:40Z","updated_at":"2019-06-11T08:38:40Z","author_association":"NONE","body":"Hi! There is logs from nodes 1001,1002,1004,1005 (1003 was master, crashed) while:\r\n```\r\n$ es_cluster_settings 127.0.0.1:9200 '.transient.logger'\r\n{\r\n  \"org\": {\r\n    \"elasticsearch\": {\r\n      \"cluster\": {\r\n        \"service\": \"TRACE\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nhttps://gist.github.com/svagner/f803434e4e4251a98001f1ccc48342e4","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500756561","html_url":"https://github.com/elastic/elasticsearch/issues/42983#issuecomment-500756561","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42983","id":500756561,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDc1NjU2MQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-06-11T09:09:59Z","updated_at":"2019-06-11T09:09:59Z","author_association":"CONTRIBUTOR","body":"Thanks. Your logs are ambiguous because they don't include stack traces, nor the name of the component emitting the log message. They are at least consistent with the problem solved by #39629; for instance, here's a 30-second wait before a \"failed to connect\" message.\r\n\r\n```\r\n2019-06-11T10:14:34.103+02:00 masterv7-1005 elasticsearch[24579] failed to join {masterv7-1001}{WQKwhB2aQkSl-SquZhfVdA}{CnPB2JStTWOyYD3lNJVyAw}{10.197.217.168}{10.197.217.168:9300}{availability_zone=west, ml.machine_memory=134835867648, rack=Z0000001, ml.max_open_jobs=20, xpack.installed=true} with JoinRequest{sourceNode={masterv7-1005}{Cz1NUYmESjW3NTz_tYE8ag}{NgpE8uGPTGaE1UjsBldrgg}{10.198.26.193}{10.198.26.193:9300}{availability_zone=west, ml.machine_memory=134836662272, rack=Z0000002, xpack.installed=true, ml.max_open_jobs=20}, optionalJoin=Optional[Join{term=33, lastAcceptedTerm=31, lastAcceptedVersion=1002, sourceNode={masterv7-1005}{Cz1NUYmESjW3NTz_tYE8ag}{NgpE8uGPTGaE1UjsBldrgg}{10.198.26.193}{10.198.26.193:9300}{availability_zone=west, ml.machine_memory=134836662272, rack=Z0000002, xpack.installed=true, ml.max_open_jobs=20}, targetNode={masterv7-1001}{WQKwhB2aQkSl-SquZhfVdA}{CnPB2JStTWOyYD3lNJVyAw}{10.197.217.168}{10.197.217.168:9300}{availability_zone=west, ml.machine_memory=134835867648, rack=Z0000001, ml.max_open_jobs=20, xpack.installed=true}}]}\r\n2019-06-11T10:15:03.815+02:00 masterv7-1005 elasticsearch[24579] failed to connect to node {masterv7-1003}{DJqWBwA4T9ebbdDBtIjwfQ}{Rrs73W8nRKOcgeaZeadbdA}{10.197.180.144}{10.197.180.144:9300}{availability_zone=west, ml.machine_memory=134835855360, rack=Z0000003, ml.max_open_jobs=20, xpack.installed=true} (tried [1] times)\r\n```\r\n\r\nClosing this as a duplicate of #29025, but if the problem persists after upgrading to 7.2.0 we can continue to investigate here.","performed_via_github_app":null}]