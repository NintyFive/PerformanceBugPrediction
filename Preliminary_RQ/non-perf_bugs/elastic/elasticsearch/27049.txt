{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27049","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27049/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27049/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27049/events","html_url":"https://github.com/elastic/elasticsearch/issues/27049","id":266771719,"node_id":"MDU6SXNzdWUyNjY3NzE3MTk=","number":27049,"title":"Make it easier to optimize search with better analysis","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2017-10-19T09:09:44Z","updated_at":"2018-06-04T07:55:30Z","closed_at":"2018-06-04T07:55:30Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"We have a number of filters that can help make search faster:\r\n - shingles for faster phrases\r\n - ngrams for infix search\r\n - edge n-grams for prefix/suffix search\r\n\r\nYet leveraging them to improve search speed typically makes Elasticsearch much harder to use since query parsers are not aware of whether these filters are in use.\r\n\r\nTo give the example of prefix search, I'm wondering whether we should add a `MappedFieldType.prefixQuery` factory method that would be called by query parsers. Regular `text` fields would still create a `PrefixQuery` but we could have a new field type that would be optimized for prefix search which would automatically add a filter to the analysis chain at index time. It would be like the edge n-gram filter except that it would add a marker to differenciate prefixes from actual terms. For instance if we want to optimize prefix queries for prefixes that would be up to 4 chars, we could analyze `foobar` as [`foobar`, `\\0f`, `\\0fo`, `\\0foo`, `\\0foob`]. I'm using `\\0` here but anything that can help differenciate prefixes from the original term while preventing collisions would work.\r\n\r\nThen at search time, `MappedFieldType.prefixQuery` would look at the length of the term and prepend a `\\0` and run a `term` query if there are 4 chars or less, and run a regular `PrefixQuery` otherwise.\r\n\r\nWe could do the same for infix search or phrase queries using similar ideas.","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}