[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384130080","html_url":"https://github.com/elastic/elasticsearch/issues/29775#issuecomment-384130080","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29775","id":384130080,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMDA4MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T09:40:11Z","updated_at":"2018-04-25T01:19:33Z","author_association":"COLLABORATOR","body":"*Original comment by @droberts195:*\n\nThere's a dilemma here about what \"next candidate\" or \"suitable substitute\" means.\r\n\r\nIf these terms mean the newest non-corrupt model snapshot then we might be doing users a disservice in silently reverting to this.  Consider the case where a user has deliberately rolled back to a snapshot that laster turns out to be corrupt.  Then we silently restore a different snapshot.\r\n\r\nMaybe we need to remember if the active model snapshot for a job is one the user specifically selected or a periodic one?\r\n\r\nAlso, in terms of the code change for this, it might be nice to introduce a method that checks that a snapshot and its corresponding state documents are complete.  Then we can call this in various places:\r\n\r\n* When opening a job\r\n* Before setting the active snapshot ID in the job cluster state\r\n* In test assertions","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384130082","html_url":"https://github.com/elastic/elasticsearch/issues/29775#issuecomment-384130082","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29775","id":384130082,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMDA4Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T09:44:04Z","updated_at":"2018-04-25T01:19:33Z","author_association":"COLLABORATOR","body":"*Original comment by @dimitris-athanasiou:*\n\nWe could also follow a more conservative approach here. We can check if the snapshot matching the job's `model_snapshot_id` is valid and if not simply fail to open the job. Then, the user can decide on her own by setting to a different snapshot before retrying to open the job.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384130083","html_url":"https://github.com/elastic/elasticsearch/issues/29775#issuecomment-384130083","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29775","id":384130083,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMDA4Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-11-14T15:01:51Z","updated_at":"2018-04-25T01:19:33Z","author_association":"COLLABORATOR","body":"*Original comment by @sophiec20:*\n\nThis will be less of an issue for UI users, once we have snapshot mgmt UI available. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384130086","html_url":"https://github.com/elastic/elasticsearch/issues/29775#issuecomment-384130086","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29775","id":384130086,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMDA4Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-01-09T18:17:40Z","updated_at":"2018-04-25T01:19:33Z","author_association":"COLLABORATOR","body":"*Original comment by @dimitris-athanasiou:*\n\nBumping this to 6.3.0","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476125285","html_url":"https://github.com/elastic/elasticsearch/issues/29775#issuecomment-476125285","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29775","id":476125285,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjEyNTI4NQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-03-25T09:55:02Z","updated_at":"2019-03-25T09:55:02Z","author_association":"CONTRIBUTOR","body":"> This will be less of an issue for UI users, once we have snapshot mgmt UI available\r\n\r\nI agree.\r\n\r\nI don't think we should add any magic into the backend to silently switch to a different model snapshot.  It will lead to a support case where the user supplies a screenshot showing a discontinuity in anomaly detection and then we'll have to work out why that happened via a painstaking trawl of the cluster logs.\r\n\r\n> In the case when a node fails in the middle of persisting state\r\n\r\nIt's not _any_ node; it's the specific node that holds the `.ml-state` index.  And then for the user to notice that this happened the job has to fail before it has a chance to do another background persist, or else the `.ml-state` index has to remain unavailable for several hours.  So a pretty rare occurrence.\r\n\r\nIf we had a UI where users could select an alternative model snapshot to roll back to after a snapshot becomes corrupt then it would be:\r\n\r\n1. Possible for the user to recover without help in this rare situation\r\n2. The reason for any noticeable discontinuity in anomaly detection would be clear","performed_via_github_app":null}]