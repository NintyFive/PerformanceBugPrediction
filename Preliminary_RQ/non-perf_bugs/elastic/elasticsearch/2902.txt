{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2902","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2902/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2902/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2902/events","html_url":"https://github.com/elastic/elasticsearch/issues/2902","id":13246296,"node_id":"MDU6SXNzdWUxMzI0NjI5Ng==","number":2902,"title":"Return HTTP 413 (Request Entity Too Large) when http.max_content_length exceeded","user":{"login":"dbertram","id":864848,"node_id":"MDQ6VXNlcjg2NDg0OA==","avatar_url":"https://avatars3.githubusercontent.com/u/864848?v=4","gravatar_id":"","url":"https://api.github.com/users/dbertram","html_url":"https://github.com/dbertram","followers_url":"https://api.github.com/users/dbertram/followers","following_url":"https://api.github.com/users/dbertram/following{/other_user}","gists_url":"https://api.github.com/users/dbertram/gists{/gist_id}","starred_url":"https://api.github.com/users/dbertram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbertram/subscriptions","organizations_url":"https://api.github.com/users/dbertram/orgs","repos_url":"https://api.github.com/users/dbertram/repos","events_url":"https://api.github.com/users/dbertram/events{/privacy}","received_events_url":"https://api.github.com/users/dbertram/received_events","type":"User","site_admin":false},"labels":[{"id":152517143,"node_id":"MDU6TGFiZWwxNTI1MTcxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/REST%20API","name":":Core/Infra/REST API","color":"0e8a16","default":false,"description":"REST infrastructure and utilities"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2013-04-16T13:30:43Z","updated_at":"2017-10-25T03:19:55Z","closed_at":"2016-12-16T11:13:14Z","author_association":"NONE","active_lock_reason":null,"body":"Currently elasticsearch drops the connection if http.max_content_length is exceeded. While this is acceptable behavior based on RFC2616 (http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.14), it's not particularly friendly to client libraries.\n\nDepending on the library being used, it can be difficult to determine the exact size of the HTTP request prior to actually sending it. Additionally, when the connection is simply closed, it leaves the underlying cause of the problem somewhat ambiguous without also inspecting the elasticsearch logs.\n\n**Proposed change:** add an option to return HTTP 413 when http.max_content_length is exceeded instead of just dropping the connection.\n\n**Steps to repro the current behavior:**\n1. Set http.max_content_length = 1kb in elasticsearch.yml\n2. Create a test index:\n   curl -XPUT 'http://localhost:9200/testindex/'\n3. Index a case that exceeds http.max_content_length:\n   curl -v -XPUT 'http://localhost:9200/testindex/testtype/1' -d '{\n     \"message\": \"large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message large message\"\n   }'\n\nExpected: HTTP status code 413 (Request Entity Too Large)\n\nActual: Dropped connection client-side, and a TooLongFrameException in elasticsearch log\n\nHere's the output from curl:\n\n```\n* About to connect() to localhost port 9200 (#0)\n*   Trying 127.0.0.1... connected\n* Connected to localhost (127.0.0.1) port 9200 (#0)\n> PUT /testindex/testtype/1 HTTP/1.1\n> User-Agent: curl/7.20.1 (i686-pc-cygwin) libcurl/7.20.1 OpenSSL/0.9.8o zlib/1.2.5 libidn/1.18 libssh2/1.2.5\n> Host: localhost:9200\n> Accept: */*\n> Content-Length: 1026\n> Content-Type: application/x-www-form-urlencoded\n> Expect: 100-continue\n>\n< HTTP/1.1 100 Continue\n* Empty reply from server\n* Connection #0 to host localhost left intact\ncurl: (52) Empty reply from server\n* Closing connection #0\n```\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}