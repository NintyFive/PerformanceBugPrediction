[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580963041","html_url":"https://github.com/elastic/elasticsearch/issues/51780#issuecomment-580963041","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51780","id":580963041,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDk2MzA0MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-02-01T00:06:40Z","updated_at":"2020-02-01T00:06:40Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml/Transform)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/582307603","html_url":"https://github.com/elastic/elasticsearch/issues/51780#issuecomment-582307603","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51780","id":582307603,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MjMwNzYwMw==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2020-02-05T09:02:34Z","updated_at":"2020-02-05T09:02:34Z","author_association":"CONTRIBUTOR","body":"@jeffvestal \r\n\r\nThanks for the report and the detailed step to reproduce, very helpful!\r\n\r\nI found a problem in your mappings. You configured the transform with an output field `labels.step.max` however, your mapping configuration maps `labels.step` to `scaled_float` instead of `labels.step.max`. With other words your mapping configuration lacks another level of nesting.\r\n\r\nIf you configure your mapping like this, your example should work:\r\n```\r\nPUT test_dest_05\r\n{\r\n  \"mappings\": {\r\n    \"properties\": {\r\n      \"trace\": {\r\n        \"properties\": {\r\n          \"id\": {\r\n            \"type\": \"keyword\"\r\n          }\r\n        }\r\n      },\r\n      \"labels\": {\r\n        \"properties\": {\r\n          \"step\": {\r\n            \"properties\": {\r\n              \"max\": {\r\n                \"type\": \"scaled_float\",\r\n                \"scaling_factor\": 1000000\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nSo the answer to your found isues: \r\n\r\nIssue 1: mapping deduction for scaled float fails due to omitting scaling_factor\r\n\r\nIssue 2: error handling of mapping errors, in #51307 we addressed this already. Starting in `7.7` the transform won't retry 10 times and the error message will contain a hint about the mapping conflict\r\n\r\nTherefore issue 1 remains, I will change the title accordingly.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/582562496","html_url":"https://github.com/elastic/elasticsearch/issues/51780#issuecomment-582562496","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51780","id":582562496,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MjU2MjQ5Ng==","user":{"login":"jeffvestal","id":53237856,"node_id":"MDQ6VXNlcjUzMjM3ODU2","avatar_url":"https://avatars0.githubusercontent.com/u/53237856?v=4","gravatar_id":"","url":"https://api.github.com/users/jeffvestal","html_url":"https://github.com/jeffvestal","followers_url":"https://api.github.com/users/jeffvestal/followers","following_url":"https://api.github.com/users/jeffvestal/following{/other_user}","gists_url":"https://api.github.com/users/jeffvestal/gists{/gist_id}","starred_url":"https://api.github.com/users/jeffvestal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeffvestal/subscriptions","organizations_url":"https://api.github.com/users/jeffvestal/orgs","repos_url":"https://api.github.com/users/jeffvestal/repos","events_url":"https://api.github.com/users/jeffvestal/events{/privacy}","received_events_url":"https://api.github.com/users/jeffvestal/received_events","type":"User","site_admin":false},"created_at":"2020-02-05T19:07:15Z","updated_at":"2020-02-05T19:07:15Z","author_association":"NONE","body":"@hendrikmuhs Thanks for the info on the mapping, good catch on that.  \r\n\r\nI should have included the original use case. \r\nUsing the apm-* index and original dynamic mapping template (created by apm) we are writing a value to labels.step, which gets mapped to a scaled_float automatically.  \r\n`        \"labels\" : {\r\n          \"dynamic\" : \"true\",\r\n          \"properties\" : {\r\n            \"step\" : {\r\n              \"type\" : \"scaled_float\",\r\n              \"scaling_factor\" : 1000000.0\r\n            }\r\n          }\r\n        }\r\n`\r\n\r\nI'm using transforms to, among other things, get the max(labels.step).  Originally when I started the transforms job, it wasn't able to create the destination index so I created the mapping manually to test if the job it would still fail (though as you pointed out I missed a nesting!) \r\n\r\nYou messaged me your solution to falling back to using a float in the transform, which would be fine in my case at least. ","performed_via_github_app":null}]