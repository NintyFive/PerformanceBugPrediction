{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41436","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41436/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41436/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41436/events","html_url":"https://github.com/elastic/elasticsearch/issues/41436","id":436195759,"node_id":"MDU6SXNzdWU0MzYxOTU3NTk=","number":41436,"title":"[CI] Tests that are running at midnight and assert on log contents can fail because the log rolls over","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"assignees":[{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-04-23T13:43:34Z","updated_at":"2020-11-11T21:55:50Z","closed_at":"2019-07-18T10:07:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"There is a failure in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.0+packaging-tests/306/console that took me a while to understand.\r\n\r\nThe error is this:\r\n\r\n```\r\n1) test42BundledJdkRemoved(org.elasticsearch.packaging.test.OssDebBasicTests)\r\njava.lang.AssertionError: \r\nExpected: a string containing \"/usr/lib/jvm/java-8-openjdk-amd64/jre\"\r\n     but: was \"[2019-04-23T00:00:02,240][INFO ][o.e.d.DiscoveryModule    ] [packer-virtualbox-iso-1528442324] using discovery type [zen] and seed hosts providers [settings]\r\n[2019-04-23T00:00:02,548][INFO ][o.e.n.Node               ] [packer-virtualbox-iso-1528442324] initialized\r\n[2019-04-23T00:00:02,548][INFO ][o.e.n.Node               ] [packer-virtualbox-iso-1528442324] starting ...\r\n[2019-04-23T00:00:02,636][INFO ][o.e.t.TransportService   ] [packer-virtualbox-iso-1528442324] publish_address {127.0.0.1:9300}, bound_addresses {[::1]:9300}, {127.0.0.1:9300}\r\n[2019-04-23T00:00:02,643][WARN ][o.e.b.BootstrapChecks    ] [packer-virtualbox-iso-1528442324] the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured\r\n[2019-04-23T00:00:02,653][INFO ][o.e.c.c.ClusterBootstrapService] [packer-virtualbox-iso-1528442324] no discovery configuration found, will perform best-effort cluster bootstrapping after [3s] unless existing master is discovered\r\n[2019-04-23T00:00:02,795][INFO ][o.e.c.s.MasterService    ] [packer-virtualbox-iso-1528442324] elected-as-master ([1] nodes joined)[{packer-virtualbox-iso-1528442324}{sjbbwqAqSlqxMWo74zo2PQ}{2Qe-mtCQSTKyp9nbqj1i_g}{127.0.0.1}{127.0.0.1:9300} elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_], term: 2, version: 7, reason: master node changed {previous [], current [{packer-virtualbox-iso-1528442324}{sjbbwqAqSlqxMWo74zo2PQ}{2Qe-mtCQSTKyp9nbqj1i_g}{127.0.0.1}{127.0.0.1:9300}]}\r\n[2019-04-23T00:00:02,809][INFO ][o.e.c.s.ClusterApplierService] [packer-virtualbox-iso-1528442324] master node changed {previous [], current [{packer-virtualbox-iso-1528442324}{sjbbwqAqSlqxMWo74zo2PQ}{2Qe-mtCQSTKyp9nbqj1i_g}{127.0.0.1}{127.0.0.1:9300}]}, term: 2, version: 7, reason: Publication{term=2, version=7}\r\n[2019-04-23T00:00:02,835][INFO ][o.e.g.GatewayService     ] [packer-virtualbox-iso-1528442324] recovered [0] indices into cluster_state\r\n[2019-04-23T00:00:02,839][INFO ][o.e.h.AbstractHttpServerTransport] [packer-virtualbox-iso-1528442324] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200}\r\n[2019-04-23T00:00:02,839][INFO ][o.e.n.Node               ] [packer-virtualbox-iso-1528442324] started\r\n[2019-04-23T00:00:02,977][INFO ][o.e.c.m.MetaDataCreateIndexService] [packer-virtualbox-iso-1528442324] [library] creating index, cause [auto(bulk api)], templates [], shards [1]/[1], mappings []\r\n[2019-04-23T00:00:03,229][INFO ][o.e.c.m.MetaDataMappingService] [packer-virtualbox-iso-1528442324] [library/KW8GCkWKS22L_-uo0JoCfw] create_mapping [book]\r\n[2019-04-23T00:00:03,370][INFO ][o.e.c.m.MetaDataDeleteIndexService] [packer-virtualbox-iso-1528442324] [library/KW8GCkWKS22L_-uo0JoCfw] deleting index\r\n[2019-04-23T00:00:04,186][INFO ][o.e.c.m.MetaDataCreateIndexService] [packer-virtualbox-iso-1528442324] [library] creating index, cause [auto(bulk api)], templates [], shards [1]/[1], mappings []\r\n[2019-04-23T00:00:04,234][INFO ][o.e.c.m.MetaDataMappingService] [packer-virtualbox-iso-1528442324] [library/iQ_gggZtTm-K1SDFnelhVg] create_mapping [book]\r\n[2019-04-23T00:00:04,278][INFO ][o.e.c.m.MetaDataDeleteIndexService] [packer-virtualbox-iso-1528442324] [library/iQ_gggZtTm-K1SDFnelhVg] deleting index\r\n[2019-04-23T00:00:04,296][INFO ][o.e.n.Node               ] [packer-virtualbox-iso-1528442324] stopping ...\r\n[2019-04-23T00:00:04,313][INFO ][o.e.n.Node               ] [packer-virtualbox-iso-1528442324] stopped\r\n[2019-04-23T00:00:04,313][INFO ][o.e.n.Node               ] [packer-virtualbox-iso-1528442324] closing ...\r\n[2019-04-23T00:00:04,321][INFO ][o.e.n.Node               ] [packer-virtualbox-iso-1528442324] closed\r\n\"\r\n```\r\n\r\nI assume it's trying to find `/usr/lib/jvm/java-8-openjdk-amd64/jre` in the log line that looks similar to this:\r\n\r\n```\r\n[2019-04-23T13:51:22,273][INFO ][o.e.n.Node               ] [node-0] JVM home [/usr/lib/jvm/java-8-openjdk-amd64/jre]\r\n```\r\n\r\nThat log line isn't present at all in the failing log file, presumably because it was logged before midnight and hence when the test checks the contents of the latest log file shortly after midnight it's not in there but in the previous day's log file.\r\n\r\nTo be robust against log file rolling, tests that check for particular log messages could also check the previous day's logs.","closed_by":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}