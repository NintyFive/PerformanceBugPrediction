{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12197","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12197/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12197/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12197/events","html_url":"https://github.com/elastic/elasticsearch/issues/12197","id":94564603,"node_id":"MDU6SXNzdWU5NDU2NDYwMw==","number":12197,"title":"Serial Diff aggregator problem","user":{"login":"olivere","id":134848,"node_id":"MDQ6VXNlcjEzNDg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/134848?v=4","gravatar_id":"","url":"https://api.github.com/users/olivere","html_url":"https://github.com/olivere","followers_url":"https://api.github.com/users/olivere/followers","following_url":"https://api.github.com/users/olivere/following{/other_user}","gists_url":"https://api.github.com/users/olivere/gists{/gist_id}","starred_url":"https://api.github.com/users/olivere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/olivere/subscriptions","organizations_url":"https://api.github.com/users/olivere/orgs","repos_url":"https://api.github.com/users/olivere/repos","events_url":"https://api.github.com/users/olivere/events{/privacy}","received_events_url":"https://api.github.com/users/olivere/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-07-12T13:13:42Z","updated_at":"2015-07-13T09:30:45Z","closed_at":"2015-07-13T08:06:11Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hello!\n\nI've been experimenting with the new [`serial_diff`](https://www.elastic.co/guide/en/elasticsearch/reference/master/search-aggregations-pipeline-serialdiff-aggregation.html) aggregator in master branch and get an error. Is this an error, or am I doing it wrong?\n\n``` sh\n#!/bin/sh\ncurl -s -XPUT 'localhost:9200/test-es20' -d '{\n  \"mappings\": {\n    \"order\": {\n      \"properties\": {\n        \"article\": { \"type\": \"string\" },\n        \"price\": { \"type\": \"float\" },\n                \"time\": { \"type\":\"date\", \"format\": \"YYYY-MM-dd\" }\n      }\n    }\n  }\n}'\n\n# Add some documents\ncurl -s -XPUT 'localhost:9200/test-es20/order/1' -d '{\"article\":\"MacBook\",\"price\":1200,\"time\":\"2015-01-02\"}'\ncurl -s -XPUT 'localhost:9200/test-es20/order/2' -d '{\"article\":\"Dell XPS\",\"price\":1600,\"time\":\"2015-01-08\"}'\ncurl -s -XPUT 'localhost:9200/test-es20/order/3' -d '{\"article\":\"iPad\",\"price\":600,\"time\":\"2015-02-01\"}'\n\n# Serial diff\ncurl -s -XGET 'localhost:9200/test-es20/_search?pretty' -d '{\n  \"aggregations\": {\n    \"sales_per_month\": {\n      \"aggregations\": {\n        \"sales\": {\n          \"sum\": {\n            \"field\": \"price\"\n          }\n        },\n        \"the_diff\": {\n          \"serial_diff\": {\n            \"buckets_path\": \"sales\",\n            \"lag\": 1\n          }\n        }\n      },\n      \"date_histogram\": {\n        \"field\": \"time\",\n        \"interval\": \"month\"\n      }\n    }\n  },\n  \"query\": {\n    \"match_all\": {}\n  }\n}'\n```\n\nResult:\n\n``` json\n{\n  \"error\" : {\n    \"root_cause\" : [ {\n      \"type\" : \"search_parse_exception\",\n      \"reason\" : \"Could not find aggregator type [serial_diff] in [the_diff]\",\n      \"line\" : 11,\n      \"col\" : 11\n    } ],\n    \"type\" : \"search_phase_execution_exception\",\n    \"reason\" : \"all shards failed\",\n    \"phase\" : \"query\",\n    \"grouped\" : true,\n    \"failed_shards\" : [ {\n      \"shard\" : 0,\n      \"index\" : \"test-es20\",\n      \"node\" : \"SvAbVOMMSp23QbSCyHFGQA\",\n      \"reason\" : {\n        \"type\" : \"search_parse_exception\",\n        \"reason\" : \"Could not find aggregator type [serial_diff] in [the_diff]\",\n        \"line\" : 11,\n        \"col\" : 11\n      }\n    } ]\n  },\n  \"status\" : 400\n}\n```\n","closed_by":{"login":"olivere","id":134848,"node_id":"MDQ6VXNlcjEzNDg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/134848?v=4","gravatar_id":"","url":"https://api.github.com/users/olivere","html_url":"https://github.com/olivere","followers_url":"https://api.github.com/users/olivere/followers","following_url":"https://api.github.com/users/olivere/following{/other_user}","gists_url":"https://api.github.com/users/olivere/gists{/gist_id}","starred_url":"https://api.github.com/users/olivere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/olivere/subscriptions","organizations_url":"https://api.github.com/users/olivere/orgs","repos_url":"https://api.github.com/users/olivere/repos","events_url":"https://api.github.com/users/olivere/events{/privacy}","received_events_url":"https://api.github.com/users/olivere/received_events","type":"User","site_admin":false},"performed_via_github_app":null}