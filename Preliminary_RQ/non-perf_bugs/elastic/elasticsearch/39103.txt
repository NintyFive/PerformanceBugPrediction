{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39103","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39103/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39103/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39103/events","html_url":"https://github.com/elastic/elasticsearch/issues/39103","id":411853111,"node_id":"MDU6SXNzdWU0MTE4NTMxMTE=","number":39103,"title":"Rollup search: search by rollup job created with '1m'  interval is not working properly ","user":{"login":"alexwizp","id":20072247,"node_id":"MDQ6VXNlcjIwMDcyMjQ3","avatar_url":"https://avatars0.githubusercontent.com/u/20072247?v=4","gravatar_id":"","url":"https://api.github.com/users/alexwizp","html_url":"https://github.com/alexwizp","followers_url":"https://api.github.com/users/alexwizp/followers","following_url":"https://api.github.com/users/alexwizp/following{/other_user}","gists_url":"https://api.github.com/users/alexwizp/gists{/gist_id}","starred_url":"https://api.github.com/users/alexwizp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexwizp/subscriptions","organizations_url":"https://api.github.com/users/alexwizp/orgs","repos_url":"https://api.github.com/users/alexwizp/repos","events_url":"https://api.github.com/users/alexwizp/events{/privacy}","received_events_url":"https://api.github.com/users/alexwizp/received_events","type":"User","site_admin":false},"labels":[{"id":912843355,"node_id":"MDU6TGFiZWw5MTI4NDMzNTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Rollup","name":":Analytics/Rollup","color":"0e8a16","default":false,"description":"Turn fine-grained time-based data into coarser-grained data"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-02-19T10:30:53Z","updated_at":"2019-02-19T13:01:12Z","closed_at":"2019-02-19T13:01:12Z","author_association":"NONE","active_lock_reason":null,"body":"**Steps to reproduce:**\r\n\r\n1. Add some of our default sample data e.g. 'Sample Data Flights'  (index: kibana_sample_data_flights)\r\n2. Create a Rollup job by that index. In my example I've created a rollup-index with name: r20 **(important: set '1m' interval for your data_histogram field )**\r\n3. Try to search by multiple intervals: 2m, 3m, etc. **It works only for 1m!**\r\n\r\n**Expected result:**  search by multiple intervals should work (2m, 3m, 4m)\r\n**Actual result:**  currently it works only for **1m** interval. \r\n\r\n**Rollup job configuration:**\r\n```\r\n{\r\n  \"config\": {\r\n    \"id\": \"r20\",\r\n    \"index_pattern\": \"kibana_sample_data_flights\",\r\n    \"rollup_index\": \"r20\",\r\n    \"cron\": \"0 6 * * * ?\",\r\n    \"groups\": {\r\n      \"date_histogram\": {\r\n        \"interval\": \"1m\",\r\n        \"field\": \"timestamp\",\r\n        \"delay\": \"1m\",\r\n        \"time_zone\": \"UTC\"\r\n      },\r\n      \"histogram\": {\r\n        \"interval\": 10,\r\n        \"fields\": [\r\n          \"AvgTicketPrice\",\r\n          \"dayOfWeek\",\r\n          \"DistanceKilometers\"\r\n        ]\r\n      },\r\n      \"terms\": {\r\n        \"fields\": [\r\n          \"AvgTicketPrice\",\r\n          \"Carrier\",\r\n          \"Dest\",\r\n          \"DestRegion\"\r\n        ]\r\n      }\r\n    },\r\n    \"metrics\": [\r\n      {\r\n        \"field\": \"AvgTicketPrice\",\r\n        \"metrics\": [\r\n          \"avg\",\r\n          \"min\",\r\n          \"sum\",\r\n          \"value_count\",\r\n          \"max\"\r\n        ]\r\n      },\r\n      {\r\n        \"field\": \"dayOfWeek\",\r\n        \"metrics\": [\r\n          \"avg\",\r\n          \"max\",\r\n          \"min\",\r\n          \"sum\",\r\n          \"value_count\"\r\n        ]\r\n      }\r\n    ],\r\n    \"timeout\": \"20s\",\r\n    \"page_size\": 1000\r\n  },\r\n  \"status\": {\r\n    \"job_state\": \"started\",\r\n    \"current_position\": {\r\n      \"AvgTicketPrice.histogram\": 110,\r\n      \"AvgTicketPrice.terms\": 110.79991149902344,\r\n      \"Carrier.terms\": \"ES-Air\",\r\n      \"Dest.terms\": \"Dubai International Airport\",\r\n      \"DestRegion.terms\": \"SE-BD\",\r\n      \"DistanceKilometers.histogram\": 40,\r\n      \"dayOfWeek.histogram\": 0,\r\n      \"timestamp.date_histogram\": 1550570580000\r\n    },\r\n    \"upgraded_doc_id\": true\r\n  },\r\n  \"stats\": {\r\n    \"pages_processed\": 4,\r\n    \"documents_processed\": 2701,\r\n    \"rollups_indexed\": 2701,\r\n    \"trigger_count\": 1,\r\n    \"index_time_in_ms\": 317,\r\n    \"index_total\": 3,\r\n    \"index_failures\": 0,\r\n    \"search_time_in_ms\": 77,\r\n    \"search_total\": 4,\r\n    \"search_failures\": 0\r\n  }\r\n}\r\n\r\n```\r\n**Query to ES:**\r\nGET r20/_rollup_search\r\n```\r\n{\r\n\t\"size\": 0,\r\n\t\"query\": {\r\n\t\t\"bool\": {\r\n\t\t\t\"must\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"range\": {\r\n\t\t\t\t\t\t\"timestamp\": {\r\n\t\t\t\t\t\t\t\"gte\": 1550463050080,\r\n\t\t\t\t\t\t\t\"lte\": 1550464228892,\r\n\t\t\t\t\t\t\t\"format\": \"epoch_millis\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"filter\": [],\r\n\t\t\t\"should\": [],\r\n\t\t\t\"must_not\": []\r\n\t\t}\r\n\t},\r\n\t\"aggs\": {\r\n\t\t\"timeseries\": {\r\n\t\t\t\"date_histogram\": {\r\n\t\t\t\t\"field\": \"timestamp\",\r\n\t\t\t\t\"interval\": \"2m\",\r\n\t\t\t\t\"min_doc_count\": 0,\r\n\t\t\t\t\"time_zone\": \"UTC\",\r\n\t\t\t\t\"extended_bounds\": {\r\n\t\t\t\t\t\"min\": 1550463050080,\r\n\t\t\t\t\t\"max\": 1550464228892\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\n**Error Response:** \r\n![image](https://user-images.githubusercontent.com/20072247/53008350-3bfa6280-344a-11e9-8d53-73149991970b.png)\r\n\r\n\r\n","closed_by":{"login":"alexwizp","id":20072247,"node_id":"MDQ6VXNlcjIwMDcyMjQ3","avatar_url":"https://avatars0.githubusercontent.com/u/20072247?v=4","gravatar_id":"","url":"https://api.github.com/users/alexwizp","html_url":"https://github.com/alexwizp","followers_url":"https://api.github.com/users/alexwizp/followers","following_url":"https://api.github.com/users/alexwizp/following{/other_user}","gists_url":"https://api.github.com/users/alexwizp/gists{/gist_id}","starred_url":"https://api.github.com/users/alexwizp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexwizp/subscriptions","organizations_url":"https://api.github.com/users/alexwizp/orgs","repos_url":"https://api.github.com/users/alexwizp/repos","events_url":"https://api.github.com/users/alexwizp/events{/privacy}","received_events_url":"https://api.github.com/users/alexwizp/received_events","type":"User","site_admin":false},"performed_via_github_app":null}