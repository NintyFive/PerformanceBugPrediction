{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436/events","html_url":"https://github.com/elastic/elasticsearch/issues/29436","id":312709287,"node_id":"MDU6SXNzdWUzMTI3MDkyODc=","number":29436,"title":"Moving replica shard involves primary shard, even across zones","user":{"login":"klahnakoski","id":2334429,"node_id":"MDQ6VXNlcjIzMzQ0Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/2334429?v=4","gravatar_id":"","url":"https://api.github.com/users/klahnakoski","html_url":"https://github.com/klahnakoski","followers_url":"https://api.github.com/users/klahnakoski/followers","following_url":"https://api.github.com/users/klahnakoski/following{/other_user}","gists_url":"https://api.github.com/users/klahnakoski/gists{/gist_id}","starred_url":"https://api.github.com/users/klahnakoski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klahnakoski/subscriptions","organizations_url":"https://api.github.com/users/klahnakoski/orgs","repos_url":"https://api.github.com/users/klahnakoski/repos","events_url":"https://api.github.com/users/klahnakoski/events{/privacy}","received_events_url":"https://api.github.com/users/klahnakoski/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-04-09T22:23:36Z","updated_at":"2018-04-10T10:38:53Z","closed_at":"2018-04-10T00:23:31Z","author_association":"NONE","active_lock_reason":null,"body":"It appears a MoveAllocationCommand on a replica shard copies the primary shard rather than copying the replica.\r\n\r\n**Elasticsearch version**: 6.1.2\r\n\r\n**JVM version** 8u131\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nIt appears a MoveAllocationCommand on a replica shard copies the primary shard rather than copying the replica. I suspect this because moving a shard from B to C causes large network activity on A where the primary shard is located.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1.  Setup 3 ES nodes, \"A\", \"B\" and \"C\"\r\n 2.  Create an index with 1 shard and 1 replica\r\n 3.  Disable allocation\r\n 4.  Let primary shard be on A, and replica shard on B\r\n 5.  Send a `_cluster/reroute` command to move the replica from B to C\r\n 6.  Notice A gets involved.\r\n\r\nThis behaviour is bad because ES has a tendency to put all primary shards on one node, overwhelming the node, resulting in slow shard movement. Also, shard movement happening in one zone causes network traffic between zones if the primary is elsewhere.\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}