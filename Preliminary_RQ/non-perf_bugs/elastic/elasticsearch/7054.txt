{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7054","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7054/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7054/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7054/events","html_url":"https://github.com/elastic/elasticsearch/issues/7054","id":38878169,"node_id":"MDU6SXNzdWUzODg3ODE2OQ==","number":7054,"title":"Index broken on 'No space left on device' even after freeing disk and restarting","user":{"login":"seut","id":219690,"node_id":"MDQ6VXNlcjIxOTY5MA==","avatar_url":"https://avatars0.githubusercontent.com/u/219690?v=4","gravatar_id":"","url":"https://api.github.com/users/seut","html_url":"https://github.com/seut","followers_url":"https://api.github.com/users/seut/followers","following_url":"https://api.github.com/users/seut/following{/other_user}","gists_url":"https://api.github.com/users/seut/gists{/gist_id}","starred_url":"https://api.github.com/users/seut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seut/subscriptions","organizations_url":"https://api.github.com/users/seut/orgs","repos_url":"https://api.github.com/users/seut/repos","events_url":"https://api.github.com/users/seut/events{/privacy}","received_events_url":"https://api.github.com/users/seut/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-07-28T10:29:26Z","updated_at":"2014-07-28T10:39:21Z","closed_at":"2014-07-28T10:39:21Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"If a node's data device disk runs out of space, freeing the disk and restarting the node will not bring the index back to life in some circumstances.\nIt seems like this happens only if a index request is corrupting the translog.\nOccurred on ES 1.2.2. \n\nSteps to reproduce with 1 Node setup:\n- Create a small disk: on OS X: Disk Utility: New image of 500 MB, called \"SmallImageES\".\n  Mount that disk.\n- Create required folders: \n  mkdir -p /Volumes/SmallImageES/{es,rnd}\n- Configure ES; specify the path to refer to said disk:\n  config/elasticsearch.yml:\n  \n  path:\n   data: /Volumes/SmallImageES/es/data\n   logs: /Volumes/SmallImageES/es/logs\n- Start the ES node\n- Index a couple of documents with the little Python script 'es.py'\n  (https://gist.github.com/lumannnn/b5d93ac486e367d7f9f4#file-es-py).\n- Start filling up the disk: `cat /dev/random >> /Volumes/SmallImageES/rnd/rnd.txt`\n- Wait until disk is full (verify also with e.g. `du -hc /Volumes/SmallImageES/`)\n- See console output and/or log\n- Shutdown 'es.py' and ES node.\n- Free disk space: `rm /Volumes/SmallImageES/rnd/rnd.txt`\n- Start ES node\n- See console output and/or log\n\nThis steps will not always reproduce the problem, but running this multiple times should result in a broken index.\n\nLog outputs of a run where the IndexRequest occurs and the index stays broken even after freeing up the disk and restarting the node: \nhttps://gist.github.com/lumannnn/cabc2ae15dac68914176\nhttps://gist.github.com/lumannnn/21d00ee9c71d0bafa126  (startup output)\n\nLog output of a run where only the SegmentMerge fails and freeing up the disk and restarting the cluster results in a working index:\nhttps://gist.github.com/lumannnn/f6ee6f8f87d314bba936\nhttps://gist.github.com/lumannnn/6e88c287f2a4db03f06f (startup output)\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}