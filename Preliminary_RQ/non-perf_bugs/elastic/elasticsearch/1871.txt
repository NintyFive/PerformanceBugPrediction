{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1871","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1871/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1871/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1871/events","html_url":"https://github.com/elastic/elasticsearch/issues/1871","id":4168446,"node_id":"MDU6SXNzdWU0MTY4NDQ2","number":1871,"title":"Index issues on restarts with defaults","user":{"login":"arimus","id":228394,"node_id":"MDQ6VXNlcjIyODM5NA==","avatar_url":"https://avatars0.githubusercontent.com/u/228394?v=4","gravatar_id":"","url":"https://api.github.com/users/arimus","html_url":"https://github.com/arimus","followers_url":"https://api.github.com/users/arimus/followers","following_url":"https://api.github.com/users/arimus/following{/other_user}","gists_url":"https://api.github.com/users/arimus/gists{/gist_id}","starred_url":"https://api.github.com/users/arimus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arimus/subscriptions","organizations_url":"https://api.github.com/users/arimus/orgs","repos_url":"https://api.github.com/users/arimus/repos","events_url":"https://api.github.com/users/arimus/events{/privacy}","received_events_url":"https://api.github.com/users/arimus/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2012-04-18T08:38:19Z","updated_at":"2012-04-30T17:26:47Z","closed_at":"2012-04-21T03:18:54Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch 0.19.2\nInit script:  https://github.com/arimus/log-processing/blob/master/rpmbuild/SOURCES/init.d-elasticsearch\nJava version: java-1.6.0-openjdk-1.6.0.0-1.43.1.10.6.el6_2.x86_64\n\nThis issue is predictable and happens every restart.  I've seen other posts that seem related to indexes in memory, however I'm using the defaults which should be indexes on disk.  FYI, I have anywhere from 1k-2k messages/sec coming in through the rabbitmq-river and have about 100M+ entries in elasticsearch.  I'm restarting as messages are flooding in.\n\nAdditionally...I have had to kill elasticsearch manually and restart it.  I did have a couple logstash instances with embedded elasticsearch 0.19.2 fire up and multicast try to connect to this elasticsearch instance, which gave me the following exceptions in the logs.  Not sure if either of those issues could have corrupted my indexes somehow...?\n\nAny ideas would be appreciated.\n# MULTICAST EXCEPTIONS\n\n[2012-04-14 15:28:25,270][WARN ][discovery.zen.ping.multicast] [Fusion] failed to connect to requesting node [DuQuesne, Jacques][NycDaOkvTX66fpepYRPEXA][inet[/xxxx:9301]]{client\norg.elasticsearch.transport.ConnectTransportException: [DuQuesne, Jacques][inet[/xxxx:9301]] connect_timeout[30s]\n        at org.elasticsearch.transport.netty.NettyTransport.connectToChannels(NettyTransport.java:560)\n        at org.elasticsearch.transport.netty.NettyTransport.connectToNode(NettyTransport.java:503)\n        at org.elasticsearch.transport.netty.NettyTransport.connectToNode(NettyTransport.java:482)\n        at org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:128)\n        at org.elasticsearch.discovery.zen.ping.multicast.MulticastZenPing$Receiver$1.run(MulticastZenPing.java:530)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:679)\nCaused by: java.net.ConnectException: Connection timed out\n        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)\n        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:592)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioClientSocketPipelineSink$Boss.connect(NioClientSocketPipelineSink.java:400)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioClientSocketPipelineSink$Boss.processSelectedKeys(NioClientSocketPipelineSink.java:362)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioClientSocketPipelineSink$Boss.run(NioClientSocketPipelineSink.java:284)\n        at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:102)\n        at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        ... 3 more\n# INDEX EXCEPTIONS\n\nFailed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't]]]\n[2012-04-18 03:19:38,765][WARN ][indices.cluster          ] [Charlie-27] [logstash-2012.04.14][2] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't\n    at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:107)\n    at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:177)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n    at java.lang.Thread.run(Thread.java:679)\n[2012-04-18 03:19:38,789][WARN ][cluster.action.shard     ] [Charlie-27] sending failed shard for [logstash-2012.04.14][2], node[I__43ZnNSxSUyZzjuwagPg], [P], s[INITIALIZING], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't]]]\n[2012-04-18 03:19:38,789][WARN ][cluster.action.shard     ] [Charlie-27] received shard failed for [logstash-2012.04.14][2], node[I__43ZnNSxSUyZzjuwagPg], [P], s[INITIALIZING], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't]]]\n[2012-04-18 03:19:38,947][WARN ][indices.cluster          ] [Charlie-27] [logstash-2012.04.14][2] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't\n    at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:107)\n    at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:177)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n    at java.lang.Thread.run(Thread.java:679)\n[2012-04-18 03:19:38,953][WARN ][cluster.action.shard     ] [Charlie-27] sending failed shard for [logstash-2012.04.14][2], node[I__43ZnNSxSUyZzjuwagPg], [P], s[INITIALIZING], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't]]]\n[2012-04-18 03:19:38,953][WARN ][cluster.action.shard     ] [Charlie-27] received shard failed for [logstash-2012.04.14][2], node[I__43ZnNSxSUyZzjuwagPg], [P], s[INITIALIZING], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't]]]\n[2012-04-18 03:19:39,310][WARN ][indices.cluster          ] [Charlie-27] [logstash-2012.04.14][2] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't\n    at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:107)\n    at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:177)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n    at java.lang.Thread.run(Thread.java:679)\n[2012-04-18 03:19:39,315][WARN ][cluster.action.shard     ] [Charlie-27] sending failed shard for [logstash-2012.04.14][2], node[I__43ZnNSxSUyZzjuwagPg], [P], s[INITIALIZING], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't]]]\n[2012-04-18 03:19:39,315][WARN ][cluster.action.shard     ] [Charlie-27] received shard failed for [logstash-2012.04.14][2], node[I__43ZnNSxSUyZzjuwagPg], [P], s[INITIALIZING], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2012.04.14][2] shard allocated for local recovery (post api), should exists, but doesn't]]]\n[2012-04-18 03:19:39,697][INFO ][river.rabbitmq           ] [Charlie-27] [rabbitmq][my_river] creating rabbitmq river, host [localhost], port [5672], user [guest], vhost [/]\n[2012-04-18 03:19:39,814][INFO ][river.rabbitmq           ] [Charlie-27] [rabbitmq][logstash-sl01] creating rabbitmq river, host [216.70.64.111], port [5672], user [guest], vhost [/]\n","closed_by":{"login":"arimus","id":228394,"node_id":"MDQ6VXNlcjIyODM5NA==","avatar_url":"https://avatars0.githubusercontent.com/u/228394?v=4","gravatar_id":"","url":"https://api.github.com/users/arimus","html_url":"https://github.com/arimus","followers_url":"https://api.github.com/users/arimus/followers","following_url":"https://api.github.com/users/arimus/following{/other_user}","gists_url":"https://api.github.com/users/arimus/gists{/gist_id}","starred_url":"https://api.github.com/users/arimus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arimus/subscriptions","organizations_url":"https://api.github.com/users/arimus/orgs","repos_url":"https://api.github.com/users/arimus/repos","events_url":"https://api.github.com/users/arimus/events{/privacy}","received_events_url":"https://api.github.com/users/arimus/received_events","type":"User","site_admin":false},"performed_via_github_app":null}