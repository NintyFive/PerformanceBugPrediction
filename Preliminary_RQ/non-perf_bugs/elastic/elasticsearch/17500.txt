{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17500","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17500/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17500/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17500/events","html_url":"https://github.com/elastic/elasticsearch/issues/17500","id":145610881,"node_id":"MDU6SXNzdWUxNDU2MTA4ODE=","number":17500,"title":"Double wildcard in string query causes incorrect highlighting for plain and fast vectors highlighters","user":{"login":"luckywin","id":13034955,"node_id":"MDQ6VXNlcjEzMDM0OTU1","avatar_url":"https://avatars1.githubusercontent.com/u/13034955?v=4","gravatar_id":"","url":"https://api.github.com/users/luckywin","html_url":"https://github.com/luckywin","followers_url":"https://api.github.com/users/luckywin/followers","following_url":"https://api.github.com/users/luckywin/following{/other_user}","gists_url":"https://api.github.com/users/luckywin/gists{/gist_id}","starred_url":"https://api.github.com/users/luckywin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luckywin/subscriptions","organizations_url":"https://api.github.com/users/luckywin/orgs","repos_url":"https://api.github.com/users/luckywin/repos","events_url":"https://api.github.com/users/luckywin/events{/privacy}","received_events_url":"https://api.github.com/users/luckywin/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-04-04T07:51:24Z","updated_at":"2016-11-25T15:53:58Z","closed_at":"2016-11-25T15:53:58Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 1.5.2, 2.2.1\n\n**JVM version**: java version \"1.8.0_60\" (Java HotSpot(TM) 64-Bit Server VM (build 25.60-b23, mixed mode))\n\n**OS version**: Windows 7 Enterprize Service Pack 1\n\n**Description of the problem including expected versus actual behavior**:\nExpected same highlight results for query `*` and queries `**`, `*?` but in fact they are totally different.\n\n**Steps to reproduce**:\nCreate following mapping:\n\n```\nPUT http://localhost:9200/index/_mapping/sometype \n{\n    \"properties\" : {\n        \"sometext\" : {\n            \"type\" : \"string\",\n            \"term_vector\" : \"with_positions_offsets\"\n        }\n    }\n}\n```\n\nPost data\n\n```\nPOST http://localhost:9200/index/sometype\n{\n    \"sometext\" : \"A supervisor is responsible for the productivity and actions of a small group of     employees. The supervisor has several manager-like roles, responsibilities, and powers. Two of the key differences between a supervisor and a manager are (1) the supervisor does not typically have hire and fire authority, and (2) the supervisor does not have budget authority.\"\n}\n```\n\nQuery data with highlithing\n\n```\nPOST http://localhost:9200/index/sometype/_search\n{\n    \"query\" : {\n        \"query_string\" : {\n            \"query\" : \"**\",\n            \"fields\" : [\"sometext\"]\n        }\n    },\n    \"highlight\" : {\n        \"pre_tags\" : [\"<em>\"],\n        \"post_tags\" : [\"</em>\"],\n        \"order\" : \"score\",\n        \"require_field_match\" : true,\n        \"fields\" : {\n            sometext : {\n                \"fragment_size\" : 150,\n                \"number_of_fragments\" : 1\n            }\n        }\n    }\n}\n```\n\nand you will got following (incorrect) highlighting:\n\n```\n\"highlight\" : {\n    \"sometext\" : [\"responsibilities, <em>and</em> <em>powers</em>. <em>Two</em> <em>of</em> <em>the</em> <em>key</em> <em>differences</em> <em>between</em> <em>a</em> <em>supervisor</em> <em>and</em> <em>a</em> <em>manager</em> <em>are</em> (<em>1</em>) <em>the</em> <em>supervisor</em> <em>does</em> <em>not</em> <em>typically</em> <em>have</em> <em>hire</em> <em>and</em> <em>fire</em> <em>authority</em>, and\"]\n}\n```\n\nThe same highlighting results are produced by query `*?`.\nOn plain highlighter (I just added `\"type\" : \"plain\"` to highlight) result looks a bit different (but still incorrect):\n\n```\n\"highlight\" : {\n    \"sometext\" : [\", <em>responsibilities</em>, <em>and</em> <em>powers</em>. <em>Two</em> <em>of</em> <em>the</em> <em>key</em> <em>differences</em> <em>between</em> <em>a</em> <em>supervisor</em> <em>and</em> <em>a</em> <em>manager</em> <em>are</em> (<em>1</em>) <em>the</em> <em>supervisor</em> <em>does</em> <em>not</em> <em>typically</em> <em>have</em> <em>hire</em> <em>and</em> <em>fire</em> <em>authority</em>, <em>and</em> (<em>2</em>) <em>the</em> <em>supervisor</em> <em>does</em> <em>not</em> <em>have</em> <em>budget</em> <em>authority</em>.\"]\n}\n```\n\nBut when query is `*` - nothing returned by highlighter.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}