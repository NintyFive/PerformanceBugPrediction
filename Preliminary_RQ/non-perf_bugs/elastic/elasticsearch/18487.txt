{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18487","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18487/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18487/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18487/events","html_url":"https://github.com/elastic/elasticsearch/issues/18487","id":155976654,"node_id":"MDU6SXNzdWUxNTU5NzY2NTQ=","number":18487,"title":"Date math not correctly rounding down to nearest week","user":{"login":"jamiecuthill","id":779188,"node_id":"MDQ6VXNlcjc3OTE4OA==","avatar_url":"https://avatars0.githubusercontent.com/u/779188?v=4","gravatar_id":"","url":"https://api.github.com/users/jamiecuthill","html_url":"https://github.com/jamiecuthill","followers_url":"https://api.github.com/users/jamiecuthill/followers","following_url":"https://api.github.com/users/jamiecuthill/following{/other_user}","gists_url":"https://api.github.com/users/jamiecuthill/gists{/gist_id}","starred_url":"https://api.github.com/users/jamiecuthill/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamiecuthill/subscriptions","organizations_url":"https://api.github.com/users/jamiecuthill/orgs","repos_url":"https://api.github.com/users/jamiecuthill/repos","events_url":"https://api.github.com/users/jamiecuthill/events{/privacy}","received_events_url":"https://api.github.com/users/jamiecuthill/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-05-20T14:32:17Z","updated_at":"2016-05-23T10:06:06Z","closed_at":"2016-05-23T10:06:06Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3.1\n\n**JVM version**: \njava version \"1.8.0_77\"\nJava(TM) SE Runtime Environment (build 1.8.0_77-b03)\nJava HotSpot(TM) 64-Bit Server VM (build 25.77-b03, mixed mode)\n\n**OS version**: Ubuntu 14.04\n\n**Description of the problem including expected versus actual behavior**:\n\nWhen performing a query using date math documents are returned outside my specified range.  \n\n**Steps to reproduce**:\n\nCreate a test index: \n\n```\ncurl -X POST -d '{\n  \"mappings\": {\n    \"testdoc\": {\n      \"properties\": {\n        \"date\": {\n          \"type\": \"date\",\n          \"format\": \"epoch_second\" \n        }\n      }\n    }\n  }\n}' \"http://localhost:9200/testindex2\"\n```\n\nAdd Test Documents: \n\n```\ncurl -X POST -d '{\n\"name\": \"02/05 12:00\",\n\"date\":  1462190400\n}' \"http://localhost:9200/testindex2/testdoc\"\n\ncurl -X POST -d '{\n\"name\": \"09/05 12:00\",\n\"date\":  1462795200\n}' \"http://localhost:9200/testindex2/testdoc\"\n\ncurl -X POST -d '{\n\"name\": \"10/05 12:00\",\n\"date\":  1462881600\n}' \"http://localhost:9200/testindex2/testdoc\"\n\ncurl -X POST -H \"Cache-Control: no-cache\" -H \"Postman-Token: bf19a167-d4da-c5fc-77b3-c127c697b27c\" -d '{\n\"name\": \"11/05 12:00\",\n\"date\":  1462968000\n}' \"http://localhost:9200/testindex2/testdoc\"\n```\n\nPerform Query: \n\n```\ncurl -X POST -d '{\n    \"size\": 10,\n    \"query\": {\n\n                \"range\": {\n                    \"date\": {\n                        \"from\": \"2016-05-20||-2w/w\",\n                        \"to\": \"2016-05-20||-1w/w\",\n                        \"format\": \"yyyy-MM-dd\"\n                    }\n                }\n\n    }\n\n}' \"http://localhost:9200/testindex2/_search\"\n```\n\nWhich results in: \n\n``` json\n{\n  \"took\": 1,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": 4,\n    \"max_score\": 1,\n    \"hits\": [\n      {\n        \"_index\": \"testindex2\",\n        \"_type\": \"testdoc\",\n        \"_id\": \"AVTOfD2XAfCW5pJcjlpV\",\n        \"_score\": 1,\n        \"_source\": {\n          \"name\": \"11/05 12:00\",\n          \"date\": 1462968000\n        }\n      },\n      {\n        \"_index\": \"testindex2\",\n        \"_type\": \"testdoc\",\n        \"_id\": \"AVTOe8HXAfCW5pJcjlpT\",\n        \"_score\": 1,\n        \"_source\": {\n          \"name\": \"09/05 12:00\",\n          \"date\": 1462795200\n        }\n      },\n      {\n        \"_index\": \"testindex2\",\n        \"_type\": \"testdoc\",\n        \"_id\": \"AVTOfAgMAfCW5pJcjlpU\",\n        \"_score\": 1,\n        \"_source\": {\n          \"name\": \"10/05 12:00\",\n          \"date\": 1462881600\n        }\n      },\n      {\n        \"_index\": \"testindex2\",\n        \"_type\": \"testdoc\",\n        \"_id\": \"AVTOe24dAfCW5pJcjlpS\",\n        \"_score\": 1,\n        \"_source\": {\n          \"name\": \"02/05 12:00\",\n          \"date\": 1462190400\n        }\n      }\n    ]\n  }\n}\n```\n\nI expected only two documents to be returned and that the two returned should be named \"02/05 12:00\" and \"09/05 12:00\"\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}