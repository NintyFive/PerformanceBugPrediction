{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32739","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32739/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32739/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32739/events","html_url":"https://github.com/elastic/elasticsearch/issues/32739","id":349058851,"node_id":"MDU6SXNzdWUzNDkwNTg4NTE=","number":32739,"title":"SimpleKdcLdapServerTests.testPrincipalCreationAndSearchOnLdap fails sporadically ","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"assignees":[{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2018-08-09T09:57:15Z","updated_at":"2019-02-07T10:44:05Z","closed_at":"2018-10-16T23:56:46Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Logs: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=java10,ES_RUNTIME_JAVA=java8,nodes=virtual&&linux/226/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+periodic/2514/console\r\n\r\nreproduction line (does not reproduce locally), failed once before on August 3 on the ccr branhc in CI. \r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:security:test \\\r\n  -Dtests.seed=D3ABF0085A9FA9D7 \\\r\n  -Dtests.class=org.elasticsearch.xpack.security.authc.kerberos.SimpleKdcLdapServerTests \\\r\n  -Dtests.method=\"testPrincipalCreationAndSearchOnLdap\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=en \\\r\n  -Dtests.timezone=America/Argentina/Cordoba\r\n```\r\n\r\nRelevant logs:\r\n```\r\n19:18:51   1> [2018-08-08T14:18:39,944][INFO ][o.e.x.s.a.k.KerberosTicketValidatorTests] [testValidKebrerosTicket] before test\r\n19:18:51   2> REPRODUCE WITH: ./gradlew :x-pack:plugin:security:test -Dtests.seed=199D7AB2E045185D -Dtests.class=org.elasticsearch.xpack.security.authc.kerberos.KerberosTicketValidatorTests -Dtests.method=\"testValidKebrerosTicket\" -Dtests.security.manager=true -Dtests.locale=de-AT -Dtests.timezone=America/Rankin_Inlet\r\n19:18:51   1> [2018-08-08T14:18:40,249][INFO ][o.a.k.k.k.i.LdapIdentityBackend] [testValidKebrerosTicket] Initializing the Ldap identity backend.\r\n19:18:51   1> [2018-08-08T14:18:40,402][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.18060.0.0.1\r\n19:18:51   1> [2018-08-08T14:18:40,405][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.7\r\n19:18:51   1> [2018-08-08T14:18:40,409][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.2\r\n19:18:51   2> REPRODUCE WITH: ./gradlew :x-pack:plugin:security:test -Dtests.seed=199D7AB2E045185D -Dtests.class=org.elasticsearch.xpack.security.authc.kerberos.KerberosTicketValidatorTests -Dtests.method=\"testValidKebrerosTicket\" -Dtests.security.manager=true -Dtests.locale=de-AT -Dtests.timezone=America/Rankin_Inlet\r\n19:18:51   1> [2018-08-08T14:18:40,412][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.18\r\n19:18:51   1> [2018-08-08T14:18:40,414][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.319\r\n19:18:51   1> [2018-08-08T14:18:40,416][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.3\r\n19:18:51   1> [2018-08-08T14:18:40,418][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.4203.1.10.1\r\n19:18:51   1> [2018-08-08T14:18:40,420][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.473\r\n19:18:51   1> [2018-08-08T14:18:40,421][INFO ][o.a.d.a.l.c.o.DefaultLdapCodecService] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.474\r\n19:18:51   1> [2018-08-08T14:18:40,423][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.18060.0.0.1\r\n19:18:51   1> [2018-08-08T14:18:40,424][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.7\r\n19:18:51   1> [2018-08-08T14:18:40,424][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.2\r\n19:18:51   1> [2018-08-08T14:18:40,424][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.18\r\n19:18:51   1> [2018-08-08T14:18:40,424][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.319\r\n19:18:51   1> [2018-08-08T14:18:40,424][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.3\r\n19:18:51   1> [2018-08-08T14:18:40,424][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.4203.1.10.1\r\n19:18:51   1> [2018-08-08T14:18:40,426][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.42.2.27.8.5.1\r\n19:18:51   1> [2018-08-08T14:18:40,427][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.9\r\n19:18:51   1> [2018-08-08T14:18:40,429][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 2.16.840.1.113730.3.4.10\r\n19:18:51   1> [2018-08-08T14:18:40,430][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.4203.1.9.1.3\r\n19:18:51   1> [2018-08-08T14:18:40,432][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.4203.1.9.1.4\r\n19:18:51   1> [2018-08-08T14:18:40,434][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.4203.1.9.1.1\r\n19:18:51   1> [2018-08-08T14:18:40,435][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.3.6.1.4.1.4203.1.9.1.2\r\n19:18:51   1> [2018-08-08T14:18:40,435][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.473\r\n19:18:51   1> [2018-08-08T14:18:40,435][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.474\r\n19:18:51   1> [2018-08-08T14:18:40,437][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.841\r\n19:18:51   1> [2018-08-08T14:18:40,442][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.417\r\n19:18:51   1> [2018-08-08T14:18:40,446][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.1413\r\n19:18:51   1> [2018-08-08T14:18:40,450][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled control factory: 1.2.840.113556.1.4.528\r\n19:18:51   1> [2018-08-08T14:18:40,458][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled extended operation factory: 1.3.6.1.1.8\r\n19:18:51   1> [2018-08-08T14:18:40,464][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled extended operation factory: 1.3.6.1.4.1.18060.0.1.8\r\n19:18:51   1> [2018-08-08T14:18:40,472][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled extended operation factory: 1.3.6.1.4.1.18060.0.1.3\r\n19:18:51   1> [2018-08-08T14:18:40,479][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled extended operation factory: 1.3.6.1.4.1.18060.0.1.6\r\n19:18:51   1> [2018-08-08T14:18:40,483][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled extended operation factory: 1.3.6.1.4.1.18060.0.1.5\r\n19:18:51   1> [2018-08-08T14:18:40,491][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled extended operation factory: 1.3.6.1.4.1.4203.1.11.1\r\n19:18:51   1> [2018-08-08T14:18:40,498][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled extended operation factory: 1.3.6.1.4.1.4203.1.11.3\r\n19:18:51   1> [2018-08-08T14:18:40,505][INFO ][o.a.d.a.l.c.s.CodecFactoryUtil] [testValidKebrerosTicket] Registered pre-bundled extended operation factory: 1.3.6.1.4.1.1466.20037\r\n19:18:51   1> [2018-08-08T14:18:41,366][INFO ][o.e.x.s.a.k.KerberosTicketValidatorTests] [testValidKebrerosTicket] after test\r\n19:18:51 ERROR   1.45s J3 | KerberosTicketValidatorTests.testValidKebrerosTicket <<< FAILURES!\r\n19:18:51    > Throwable #1: java.security.AccessControlException: access denied (\"java.lang.RuntimePermission\" \"accessClassInPackage.sun.reflect\")\r\n19:18:51    > \tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)\r\n19:18:51    > \tat java.security.AccessController.checkPermission(AccessController.java:884)\r\n19:18:51    > \tat java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n19:18:51    > \tat java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1564)\r\n19:18:51    > \tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:329)\r\n19:18:51    > \tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n19:18:51    > \tat org.apache.mina.core.future.DefaultIoFuture.checkDeadLock(DefaultIoFuture.java:279)\r\n19:18:51    > \tat org.apache.mina.core.future.DefaultIoFuture.await0(DefaultIoFuture.java:241)\r\n19:18:51    > \tat org.apache.mina.core.future.DefaultIoFuture.awaitUninterruptibly(DefaultIoFuture.java:174)\r\n19:18:51    > \tat org.apache.directory.ldap.client.api.LdapNetworkConnection.writeRequest(LdapNetworkConnection.java:4252)\r\n19:18:51    > \tat org.apache.directory.ldap.client.api.LdapNetworkConnection.bindAsync(LdapNetworkConnection.java:1389)\r\n19:18:51    > \tat org.apache.directory.ldap.client.api.LdapNetworkConnection.bind(LdapNetworkConnection.java:1292)\r\n19:18:51    > \tat org.apache.directory.ldap.client.api.AbstractLdapConnection.bind(AbstractLdapConnection.java:130)\r\n19:18:51    > \tat org.apache.directory.ldap.client.api.AbstractLdapConnection.bind(AbstractLdapConnection.java:114)\r\n19:18:51    > \tat org.apache.kerby.kerberos.kdc.identitybackend.LdapIdentityBackend.startConnection(LdapIdentityBackend.java:100)\r\n19:18:51    > \tat org.apache.kerby.kerberos.kdc.identitybackend.LdapIdentityBackend.doInitialize(LdapIdentityBackend.java:111)\r\n19:18:51    > \tat org.apache.kerby.kerberos.kerb.identity.backend.AbstractIdentityBackend.initialize(AbstractIdentityBackend.java:67)\r\n19:18:51    > \tat org.apache.kerby.kerberos.kerb.server.KdcUtil.getBackend(KdcUtil.java:115)\r\n19:18:51    > \tat org.apache.kerby.kerberos.kerb.server.impl.AbstractInternalKdcServer.init(AbstractInternalKdcServer.java:65)\r\n19:18:51    > \tat org.apache.kerby.kerberos.kerb.server.KdcServer.init(KdcServer.java:256)\r\n19:18:51    > \tat org.apache.kerby.kerberos.kerb.server.SimpleKdcServer.init(SimpleKdcServer.java:155)\r\n19:18:51    > \tat org.elasticsearch.xpack.security.authc.kerberos.SimpleKdcLdapServer.prepareKdcServerAndStart(SimpleKdcLdapServer.java:150)\r\n19:18:51    > \tat org.elasticsearch.xpack.security.authc.kerberos.SimpleKdcLdapServer.init(SimpleKdcLdapServer.java:104)\r\n19:18:51    > \tat org.elasticsearch.xpack.security.authc.kerberos.SimpleKdcLdapServer.access$000(SimpleKdcLdapServer.java:39)\r\n19:18:51    > \tat org.elasticsearch.xpack.security.authc.kerberos.SimpleKdcLdapServer$2.run(SimpleKdcLdapServer.java:89)\r\n19:18:51    > \tat org.elasticsearch.xpack.security.authc.kerberos.SimpleKdcLdapServer$2.run(SimpleKdcLdapServer.java:86)\r\n19:18:51    > \tat java.security.AccessController.doPrivileged(Native Method)\r\n19:18:51    > \tat org.elasticsearch.xpack.security.authc.kerberos.SimpleKdcLdapServer.<init>(SimpleKdcLdapServer.java:86)\r\n19:18:51    > \tat org.elasticsearch.xpack.security.authc.kerberos.KerberosTestCase.startSimpleKdcLdapServer(KerberosTestCase.java:105)\r\n19:18:51    > \tat java.lang.Thread.run(Thread.java:748)Throwable #2: java.lang.NullPointerException\r\n19:18:51    > \tat org.elasticsearch.xpack.security.authc.kerberos.KerberosTestCase.tearDownMiniKdc(KerberosTestCase.java:128)\r\n19:18:51    > \tat java.lang.Thread.run(Thread.java:748)\r\n```","closed_by":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"performed_via_github_app":null}