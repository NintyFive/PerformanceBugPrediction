[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59519143","html_url":"https://github.com/elastic/elasticsearch/issues/8140#issuecomment-59519143","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8140","id":59519143,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTE5MTQz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T14:17:48Z","updated_at":"2014-10-17T14:17:48Z","author_association":"CONTRIBUTOR","body":"thanks for reporting @jillesvangurp - we'll take a look\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59529312","html_url":"https://github.com/elastic/elasticsearch/issues/8140#issuecomment-59529312","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8140","id":59529312,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTI5MzEy","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T15:24:26Z","updated_at":"2014-10-17T15:24:26Z","author_association":"MEMBER","body":"@jillesvangurp I think I found a small issue where there is a small window of time that a field is unset, but the warmer that needs is running.  In order to confirm this can you share how you start the embedded node and run your test? (for example you wait for green status before running?) Sharing code snippets how the node is brought up before the tests run would even be more helpful.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59529957","html_url":"https://github.com/elastic/elasticsearch/issues/8140#issuecomment-59529957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8140","id":59529957,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTI5OTU3","user":{"login":"jillesvangurp","id":819187,"node_id":"MDQ6VXNlcjgxOTE4Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/819187?v=4","gravatar_id":"","url":"https://api.github.com/users/jillesvangurp","html_url":"https://github.com/jillesvangurp","followers_url":"https://api.github.com/users/jillesvangurp/followers","following_url":"https://api.github.com/users/jillesvangurp/following{/other_user}","gists_url":"https://api.github.com/users/jillesvangurp/gists{/gist_id}","starred_url":"https://api.github.com/users/jillesvangurp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jillesvangurp/subscriptions","organizations_url":"https://api.github.com/users/jillesvangurp/orgs","repos_url":"https://api.github.com/users/jillesvangurp/repos","events_url":"https://api.github.com/users/jillesvangurp/events{/privacy}","received_events_url":"https://api.github.com/users/jillesvangurp/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T15:28:37Z","updated_at":"2014-10-17T15:28:37Z","author_association":"CONTRIBUTOR","body":"Sure no problem:\n\n```\n            String defaultIndexDirectory = \"target/data-\"+UUID.randomUUID().toString();\n            String indexDir = config.getString(\"estestserver.indexdir\",defaultIndexDirectory);\n            String logDir = config.getString(\"estestserver.logdir\",defaultIndexDirectory + \"/logs\");\n            String esPort = config.getString(\"estestserver.port\",\"9299\");\n            File file = new File(defaultIndexDirectory);\n            file.mkdirs();\n            LOG.info(\"using \" + file.getAbsolutePath() + \" for es data and logs\");\n            Settings settings = ImmutableSettings.settingsBuilder()\n                    .put(\"name\", \"test-node-\"+RandomStringUtils.randomAlphabetic(5))\n                    .put(\"cluster.name\", \"linko-dev-cluster-\"+RandomStringUtils.randomAlphabetic(5))\n                    .put(\"index.gateway.type\", \"none\")\n                    .put(\"gateway.type\", \"none\")\n                    .put(\"discovery.zen.ping.multicast.ping.enabled\", \"false\")\n                    .put(\"discovery.zen.ping.multicast.enabled\", \"false\")\n                    .put(\"path.data\", indexDir)\n                    .put(\"path.logs\", logDir)\n                    .put(\"foreground\", \"true\")\n                    .put(\"http.port\", esPort)\n                    .put(\"http.cors.enabled\", \"true\")\n                    .put(\"http.cors.allow-origin\",\"/https?:\\\\/\\\\/(localhost|kibana.*\\\\.linko\\\\.io)(:[0-9]+)?/\")\n                    .build();\n\n            LOG.info(settings.toDelimitedString(';'));\n\n            NodeBuilder nodeBuilder = NodeBuilder.nodeBuilder()\n                    .settings(settings)\n                    .loadConfigSettings(false);\n            node = nodeBuilder\n                    .build();\n\n\n            // register a shutdown hook\n            Runtime.getRuntime().addShutdownHook(new Thread() {\n                @Override\n                public void run() {\n                    node.close();\n                }\n            });\n            node.start();\n\n            // wait until the shards are ready\n            node.client().admin().cluster().prepareHealth().setWaitForGreenStatus().execute().actionGet();\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59606767","html_url":"https://github.com/elastic/elasticsearch/issues/8140#issuecomment-59606767","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8140","id":59606767,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NjA2NzY3","user":{"login":"jillesvangurp","id":819187,"node_id":"MDQ6VXNlcjgxOTE4Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/819187?v=4","gravatar_id":"","url":"https://api.github.com/users/jillesvangurp","html_url":"https://github.com/jillesvangurp","followers_url":"https://api.github.com/users/jillesvangurp/followers","following_url":"https://api.github.com/users/jillesvangurp/following{/other_user}","gists_url":"https://api.github.com/users/jillesvangurp/gists{/gist_id}","starred_url":"https://api.github.com/users/jillesvangurp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jillesvangurp/subscriptions","organizations_url":"https://api.github.com/users/jillesvangurp/orgs","repos_url":"https://api.github.com/users/jillesvangurp/repos","events_url":"https://api.github.com/users/jillesvangurp/events{/privacy}","received_events_url":"https://api.github.com/users/jillesvangurp/received_events","type":"User","site_admin":false},"created_at":"2014-10-18T10:39:42Z","updated_at":"2014-10-18T10:39:42Z","author_association":"CONTRIBUTOR","body":"One additional bit of information that I just realized may be relevant here is that we have a parent child relation between user and usercontact. So, the exception is happening when it is doing something with the child type. For reference, here's a gist with the full mapping for the index: https://gist.github.com/jillesvangurp/d0cd29573b876f9cc4d3\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59607049","html_url":"https://github.com/elastic/elasticsearch/issues/8140#issuecomment-59607049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8140","id":59607049,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NjA3MDQ5","user":{"login":"jillesvangurp","id":819187,"node_id":"MDQ6VXNlcjgxOTE4Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/819187?v=4","gravatar_id":"","url":"https://api.github.com/users/jillesvangurp","html_url":"https://github.com/jillesvangurp","followers_url":"https://api.github.com/users/jillesvangurp/followers","following_url":"https://api.github.com/users/jillesvangurp/following{/other_user}","gists_url":"https://api.github.com/users/jillesvangurp/gists{/gist_id}","starred_url":"https://api.github.com/users/jillesvangurp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jillesvangurp/subscriptions","organizations_url":"https://api.github.com/users/jillesvangurp/orgs","repos_url":"https://api.github.com/users/jillesvangurp/repos","events_url":"https://api.github.com/users/jillesvangurp/events{/privacy}","received_events_url":"https://api.github.com/users/jillesvangurp/received_events","type":"User","site_admin":false},"created_at":"2014-10-18T10:50:34Z","updated_at":"2014-10-18T10:51:02Z","author_association":"CONTRIBUTOR","body":"Also, we're using testNg and surefire. The elasticsearch node is started in a @BeforeSuite. We use a very large threadcount and randomized order to surface any issues related to inter test dependencies and stability of our system. This pretty much means all our integration test classes are starting at the same time. We generally use randomized test data and there are a lot of calls to /_refresh to ensure indices are committed in each tests. \n\n```\n<plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-surefire-plugin</artifactId>\n                <configuration>\n                    <parallel>classes</parallel>\n                    <threadCount>50</threadCount>\n                    <runOrder>random</runOrder>\n                    <argLine>-Xms1024m -Xmx2048m</argLine>\n                    <properties>\n                        <property>\n                            <name>listener</name>\n                            <value>io.linko.ng.testutil.TestProgressLogger</value>\n                        </property>\n                    </properties>\n                </configuration>\n            </plugin>\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59770996","html_url":"https://github.com/elastic/elasticsearch/issues/8140#issuecomment-59770996","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8140","id":59770996,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NzcwOTk2","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-10-20T14:59:15Z","updated_at":"2014-10-20T14:59:15Z","author_association":"MEMBER","body":"Thanks for the provided information @jillesvangurp \n\nI opened: #8168 for this issue. Are you able to verify if the non fatal NPE doesn't occur any more with this fix in your test infrastructure?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59774652","html_url":"https://github.com/elastic/elasticsearch/issues/8140#issuecomment-59774652","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8140","id":59774652,"node_id":"MDEyOklzc3VlQ29tbWVudDU5Nzc0NjUy","user":{"login":"jillesvangurp","id":819187,"node_id":"MDQ6VXNlcjgxOTE4Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/819187?v=4","gravatar_id":"","url":"https://api.github.com/users/jillesvangurp","html_url":"https://github.com/jillesvangurp","followers_url":"https://api.github.com/users/jillesvangurp/followers","following_url":"https://api.github.com/users/jillesvangurp/following{/other_user}","gists_url":"https://api.github.com/users/jillesvangurp/gists{/gist_id}","starred_url":"https://api.github.com/users/jillesvangurp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jillesvangurp/subscriptions","organizations_url":"https://api.github.com/users/jillesvangurp/orgs","repos_url":"https://api.github.com/users/jillesvangurp/repos","events_url":"https://api.github.com/users/jillesvangurp/events{/privacy}","received_events_url":"https://api.github.com/users/jillesvangurp/received_events","type":"User","site_admin":false},"created_at":"2014-10-20T15:11:16Z","updated_at":"2014-10-20T15:11:16Z","author_association":"CONTRIBUTOR","body":"No problem. Unfortunately, most of our builds don't trigger this exception; so it is a bit hard for me to confirm. I've only spotted it twice out of dozens of test runs over the past week. If you issue another beta, I'll be able to depend on that at least.\n","performed_via_github_app":null}]