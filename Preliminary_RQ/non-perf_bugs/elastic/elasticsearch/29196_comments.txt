[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375084675","html_url":"https://github.com/elastic/elasticsearch/issues/29196#issuecomment-375084675","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29196","id":375084675,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTA4NDY3NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T20:28:28Z","updated_at":"2018-03-21T20:28:28Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383847471","html_url":"https://github.com/elastic/elasticsearch/issues/29196#issuecomment-383847471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29196","id":383847471,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Mzg0NzQ3MQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-04-24T08:25:12Z","updated_at":"2018-04-24T08:25:12Z","author_association":"MEMBER","body":"@nknize could you take a look at this one?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388173824","html_url":"https://github.com/elastic/elasticsearch/issues/29196#issuecomment-388173824","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29196","id":388173824,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODE3MzgyNA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-05-10T20:21:52Z","updated_at":"2018-05-10T20:21:52Z","author_association":"MEMBER","body":"The current [implementation](https://github.com/apache/lucene-solr/blob/bf71650ad7d9cd95084c1a58d12caa11025c0e4f/lucene/sandbox/src/java/org/apache/lucene/document/LatLonPoint.java#L205) in lucene excludes edges most of the time due to the way rounding is implemented. Basically, the query in the example is converted into: \r\n\r\n```\r\nGET /test/_validate/query?explain\r\n{\r\n  \"query\": {\r\n    \"geo_bounding_box\": {\r\n      \"Location\": {\r\n        \"top_left\": [\r\n          -83.106,\r\n          28\r\n        ],\r\n        \"bottom_right\": [\r\n          -80.106,\r\n          27\r\n        ]\r\n      },\r\n      \"validation_method\": \"STRICT\",\r\n      \"type\": \"MEMORY\",\r\n      \"ignore_unmapped\": false,\r\n      \"boost\": 1\r\n    }\r\n  }\r\n}\r\n```\r\n```\r\n{\r\n  \"valid\": true,\r\n  \"_shards\": {\r\n    \"total\": 1,\r\n    \"successful\": 1,\r\n    \"failed\": 0\r\n  },\r\n  \"explanations\": [\r\n    {\r\n      \"index\": \"test\",\r\n      \"valid\": true,\r\n      \"explanation\": \"Location:[27.00000002514571 TO 27.999999965541065],[-83.10599997639656 TO -80.10600007139146]\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nAs far as I can [see](https://github.com/apache/lucene-solr/blob/45c48da54ad2bf09fd4c9559ba1c776ad9460d82/lucene/sandbox/src/test/org/apache/lucene/document/TestLatLonPoint.java#L32) this is intentional (although undocumented) behaviour. Should we convert this into a documentation issue? @nknize, @jpountz what do you think? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388407689","html_url":"https://github.com/elastic/elasticsearch/issues/29196#issuecomment-388407689","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29196","id":388407689,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODQwNzY4OQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-05-11T16:01:53Z","updated_at":"2018-05-11T16:01:53Z","author_association":"MEMBER","body":"Discussed this with @jpountz. This is indeed an intended behavior introduced in [LUCENE-7166](https://issues.apache.org/jira/browse/LUCENE-7166). Geopoints have limited precision and as a result they are rounded. Geopoints are always rounded down during index time. During the query time upper boundaries of the bounding boxes are rounded down, while lower boundaries are rounded up. As a result the points along on the lower bounds (bottom and left edges of the bounding box) might not make it into the bounding box due to the rounding error. \r\n\r\nI am going to change this issue to documentation issue and add some clarification to docs. ","performed_via_github_app":null}]