{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34717","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34717/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34717/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34717/events","html_url":"https://github.com/elastic/elasticsearch/issues/34717","id":372584319,"node_id":"MDU6SXNzdWUzNzI1ODQzMTk=","number":34717,"title":"Data path and migration ES 2.x -> 5.x -> 6.x","user":{"login":"bsibaud","id":25824640,"node_id":"MDQ6VXNlcjI1ODI0NjQw","avatar_url":"https://avatars1.githubusercontent.com/u/25824640?v=4","gravatar_id":"","url":"https://api.github.com/users/bsibaud","html_url":"https://github.com/bsibaud","followers_url":"https://api.github.com/users/bsibaud/followers","following_url":"https://api.github.com/users/bsibaud/following{/other_user}","gists_url":"https://api.github.com/users/bsibaud/gists{/gist_id}","starred_url":"https://api.github.com/users/bsibaud/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsibaud/subscriptions","organizations_url":"https://api.github.com/users/bsibaud/orgs","repos_url":"https://api.github.com/users/bsibaud/repos","events_url":"https://api.github.com/users/bsibaud/events{/privacy}","received_events_url":"https://api.github.com/users/bsibaud/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-10-22T16:03:30Z","updated_at":"2018-10-22T16:54:14Z","closed_at":"2018-10-22T16:54:14Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\n\r\n2.3.5 -> full cluster upgrade -> 5.5.2 -> reindex + full cluster upgrade -> 6.2.4 (without plugin)\r\n\r\n(same issue with 2.4.6 -> full cluster upgrade -> 5.6.10 -> reindex + rolling upgrade -> 6.2.4 anyway)\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): \r\n\r\njava version \"1.8.0_181\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_181-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\nCentOS 7 (amd64)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nIt looks like\r\n- ES 2.x reads/writes in \"path.data / cluster.name\"  directory\r\n- ES 2.x migrated into ES 5.x,  reads/writes in \"path.data / cluster.name\"  directory too\r\n- but new installation of ES 5.x reads/writes in \"path.data\" directory\r\n(so ES 5.x is able to read/write in both \"path.data/cluster.name\" and \"path.data\" directories)\r\n- migrated or new ES 6.x reads/writes in \"path.data\" directory only.\r\n\r\nSo indices migrated from ES 2.x to 5.x (and reindexed) are not available in ES 6.x.\r\n\r\nI needed to move files from \"path.data / cluster.name\" into \"path.data\" to recover previous indices.\r\n\r\nAs far as I know, this caveat is not mentioned in Breaking Changes or Upgrade process.\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/setup-upgrade.html only mentions \"You must delete or reindex any indices created in 2.x before upgrading.\" but that's not enough (you need to reindex, but also to move data on disk or change your path.data).\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. install ES 2.3.5 mono-node\r\n 2. insert a document\r\n 3. stop and full cluster upgrade to ES 5.5.2\r\n 4. insert new document\r\n 5. reindex former document from ES 2.3.5 to be ES 6.x compatible\r\n 6. stop and full cluster upgrade to ES 6.2.4\r\n 7. insert new document\r\n 8. list indices: only the last document from ES 6.x is available (because data from ES 2.x/5.x is stored in  \"path.data / cluster.name\" and ES 6.x has started to store in \"path.data\" only).","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}