{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33752","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33752/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33752/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33752/events","html_url":"https://github.com/elastic/elasticsearch/issues/33752","id":360791143,"node_id":"MDU6SXNzdWUzNjA3OTExNDM=","number":33752,"title":"[CI] ParentIdAggIT.testParentIdAggregation failed","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":962378555,"node_id":"MDU6TGFiZWw5NjIzNzg1NTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.5.0","name":"v6.5.0","color":"Dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"assignees":[{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false}],"milestone":null,"comments":11,"created_at":"2018-09-17T09:41:38Z","updated_at":"2018-10-18T15:00:11Z","closed_at":"2018-10-18T15:00:11Z","author_association":"MEMBER","active_lock_reason":null,"body":"Build: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+periodic/2/console\r\n\r\nThis does not reproduced locally for me so far:\r\n```\r\n./gradlew :server:integTest \\\r\n  -Dtests.seed=4AF65CDEFFB3B80B \\\r\n  -Dtests.class=org.elasticsearch.search.aggregations.bucket.ParentIdAggIT \\\r\n  -Dtests.method=\"testParentIdAggregation\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=pt-PT \\\r\n  -Dtests.timezone=America/Blanc-Sablon \\\r\n  -Dcompiler.java=10 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nFailure:\r\n```\r\n23:34:09 ERROR   0.47s J0 | ParentIdAggIT.testParentIdAggregation <<< FAILURES!\r\n23:34:09    > Throwable #1: java.util.NoSuchElementException\r\n23:34:09    > \tat __randomizedtesting.SeedInfo.seed([4AF65CDEFFB3B80B:244B697A07093F1F]:0)\r\n23:34:09    > \tat java.util.AbstractList$Itr.next(AbstractList.java:364)\r\n23:34:09    > \tat org.elasticsearch.search.aggregations.bucket.ParentIdAggIT.testParentIdAggregation(ParentIdAggIT.java:56)\r\n23:34:09    > \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nLater on there are connection exceptions in the log, but I guess they could be due to an unclean shutdown:\r\n```\r\n23:34:09   1> [2018-09-14T17:34:09,340][WARN ][o.e.c.NodeConnectionsService] [node_sc3] failed to connect to node {node_s1}{WRWl6YZtSDaWqY8uMTNkkw}{f2pm5eBYQja1XF7fFoDRaw}{127.0.0.1}{127.0.0.1:36048} (tried [1] times)\r\n23:34:09   1> org.elasticsearch.transport.ConnectTransportException: [node_s1][127.0.0.1:36048] connect_exception\r\n23:34:09   1> \tat org.elasticsearch.transport.TcpChannel.awaitConnected(TcpChannel.java:165) ~[main/:?]\r\n23:34:09   1> \tat org.elasticsearch.transport.TcpTransport.openConnection(TcpTransport.java:454) ~[main/:?]\r\n23:34:09   1> \tat org.elasticsearch.transport.TcpTransport.openConnection(TcpTransport.java:117) ~[main/:?]\r\n23:34:09   1> \tat org.elasticsearch.transport.ConnectionManager.internalOpenConnection(ConnectionManager.java:238) ~[main/:?]\r\n23:34:09   1> \tat org.elasticsearch.transport.ConnectionManager.connectToNode(ConnectionManager.java:120) ~[main/:?]\r\n23:34:09   1> \tat org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:369) ~[main/:?]\r\n23:34:09   1> \tat org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:356) ~[main/:?]\r\n23:34:09   1> \tat org.elasticsearch.cluster.NodeConnectionsService.validateAndConnectIfNeeded(NodeConnectionsService.java:153) [main/:?]\r\n23:34:09   1> \tat org.elasticsearch.cluster.NodeConnectionsService$1.doRun(NodeConnectionsService.java:106) [main/:?]\r\n23:34:09   1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723) [main/:?]\r\n23:34:09   1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [main/:?]\r\n23:34:09   1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n23:34:09   1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n23:34:09   1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n23:34:09   1> Caused by: java.net.ConnectException: Connection refused\r\n23:34:09   1> \tat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:?]\r\n23:34:09   1> \tat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:?]\r\n23:34:09   1> \tat org.elasticsearch.transport.nio.channel.NioSocketChannel.internalFinish(NioSocketChannel.java:174) ~[framework-6.5.0-SNAPSHOT.jar:6.5.0-SNAPSHOT]\r\n23:34:09   1> \tat org.elasticsearch.transport.nio.channel.NioSocketChannel.finishConnect(NioSocketChannel.java:152) ~[framework-6.5.0-SNAPSHOT.jar:6.5.0-SNAPSHOT]\r\n23:34:09   1> \tat org.elasticsearch.transport.nio.SocketSelector.attemptConnect(SocketSelector.java:221) ~[framework-6.5.0-SNAPSHOT.jar:6.5.0-SNAPSHOT]\r\n23:34:09   1> \tat org.elasticsearch.transport.nio.SocketSelector.setupChannel(SocketSelector.java:210) ~[framework-6.5.0-SNAPSHOT.jar:6.5.0-SNAPSHOT]\r\n23:34:09   1> \tat org.elasticsearch.transport.nio.SocketSelector.setUpNewChannels(SocketSelector.java:198) ~[framework-6.5.0-SNAPSHOT.jar:6.5.0-SNAPSHOT]\r\n23:34:09   1> \tat org.elasticsearch.transport.nio.SocketSelector.preSelect(SocketSelector.java:75) ~[framework-6.5.0-SNAPSHOT.jar:6.5.0-SNAPSHOT]\r\n23:34:09   1> \tat org.elasticsearch.transport.nio.ESSelector.singleLoop(ESSelector.java:102) ~[framework-6.5.0-SNAPSHOT.jar:6.5.0-SNAPSHOT]\r\n23:34:09   1> \tat org.elasticsearch.transport.nio.ESSelector.runLoop(ESSelector.java:78) ~[framework-6.5.0-SNAPSHOT.jar:6.5.0-SNAPSHOT]\r\n23:34:09   1> \t... 1 more\r\n```","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}