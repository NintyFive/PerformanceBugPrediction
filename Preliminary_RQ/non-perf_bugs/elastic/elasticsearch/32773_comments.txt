[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412047589","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-412047589","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":412047589,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjA0NzU4OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T10:46:25Z","updated_at":"2018-08-10T10:46:25Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412062896","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-412062896","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":412062896,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjA2Mjg5Ng==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T12:06:04Z","updated_at":"2018-08-10T12:06:04Z","author_association":"MEMBER","body":"@polyfractal could you take a look at this one?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412116539","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-412116539","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":412116539,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjExNjUzOQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T15:24:11Z","updated_at":"2018-08-10T15:24:11Z","author_association":"MEMBER","body":"Hm, I'm not positive what's going on here but I have a guess.  Will open a PR with a test fix and get Jim's opinion.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412991558","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-412991558","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":412991558,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjk5MTU1OA==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T19:41:14Z","updated_at":"2018-08-14T19:41:14Z","author_association":"CONTRIBUTOR","body":"I'm not sure if this is strictly related but this failure on 6.x is from one of the lines added in b32fbbe5181428e1b3a12f626ffe2eded79a0b38\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+matrix-java-periodic/ES_BUILD_JAVA=java10,ES_RUNTIME_JAVA=java10,nodes=virtual&&linux/236/console\r\n\r\nFull log is too large to upload sorry. Doesn't reproduce for me\r\n\r\n```\r\n  1> [2018-08-14T13:17:05,638][INFO ][o.e.x.r.FullClusterRestartIT] [testRollupIDSchemeAfterRestart] after test                                               \r\nERROR   10.5s | FullClusterRestartIT.testRollupIDSchemeAfterRestart <<< FAILURES!                                                                             \r\n   > Throwable #1: org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:45233], URI [_xpack/rollup/job/rollup-id-test/_stop], status line [HTTP/1.1 404 Not Found]          \r\n   > {\"error\":{\"root_cause\":[{\"type\":\"resource_not_found_exception\",\"reason\":\"Task for Rollup Job [rollup-id-test] not found\"}],\"type\":\"resource_not_found_exception\",\"reason\":\"Task for Rollup Job [rollup-id-test] not found\"},\"status\":404}                                                                              \r\n   >    at __randomizedtesting.SeedInfo.seed([452BE0CB85C8B7F5:1D45C2F60A154182]:0)                                                                           \r\n   >    at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:920)                                                                     >    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:227)                                                                            \r\n   >    at org.elasticsearch.xpack.restart.FullClusterRestartIT.testRollupIDSchemeAfterRestart(FullClusterRestartIT.java:416)                                 \r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)                                                                     \r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)                                                   \r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)                                           \r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:564)          \r\n   >    at java.base/java.lang.Thread.run(Thread.java:844)                     \r\n   > Caused by: org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:45233], URI [_xpack/rollup/job/rollup-id-test/_stop], status line [HTTP/1.1 404 Not Found]             \r\n   > {\"error\":{\"root_cause\":[{\"type\":\"resource_not_found_exception\",\"reason\":\"Task for Rollup Job [rollup-id-test] not found\"}],\"type\":\"resource_not_found_exception\",\"reason\":\"Task for Rollup Job [rollup-id-test] not found\"},\"status\":404}                                                                              \r\n   >    at org.elasticsearch.client.RestClient$1.completed(RestClient.java:540)                                                                               \r\n   >    at org.elasticsearch.client.RestClient$1.completed(RestClient.java:529)                                                                               \r\n   >    at org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)                                                                             \r\n   >    at org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)                      \r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)                                           \r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)                                                \r\n   >    at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)                                          \r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)                                                        \r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)                                                        \r\n   >    at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)                                                        \r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)                                                                    \r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)                                                        \r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)                                                       \r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)                                                             \r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)                                                                     \r\n   >    at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)                                    \r\n   >    ... 1 more \r\n```\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:qa:full-cluster-restart:without-system-key:v6.3.3-SNAPSHOT#upgradedClusterTestRunner -Dtests.seed=452BE0CB85C8B7F5 -Dtests.class=org.elasticsearch.xpack.restart.FullClusterRestartIT -Dtests.method=\"testRollupIDSchemeAfterRestart\" -Dtests.security.manager=true -Dtests.locale=id-ID -Dtests.timezone=Africa/Freetown -Dcompiler.java=10 -Druntime.java=10\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413007459","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-413007459","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":413007459,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzAwNzQ1OQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T20:36:44Z","updated_at":"2018-08-14T20:36:44Z","author_association":"MEMBER","body":"Grr, I think it's trying to stop the job before the task is fully initialized.  I should have left the awaitBusy for the persistent task.\r\n\r\nI'll take care of this shortly... if it keeps failing before I get there feel free to mute.  Sorry for the noise!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413567936","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-413567936","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":413567936,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzU2NzkzNg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-08-16T14:36:34Z","updated_at":"2018-08-16T14:36:34Z","author_association":"CONTRIBUTOR","body":"I just AwaitFix'ed this test.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/417807894","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-417807894","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":417807894,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzgwNzg5NA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-08-31T22:48:22Z","updated_at":"2018-08-31T22:48:22Z","author_association":"MEMBER","body":"Thanks Adrien.\r\n\r\nI _think_ this test is fixed now.  But if it fails again, I'll re-evaluate how we're doing things in the test and see if there's a way to rewrite it to be less flaky.\r\n\r\nSorry for the noise everyone!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/421972974","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-421972974","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":421972974,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTk3Mjk3NA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-17T11:15:22Z","updated_at":"2018-09-17T11:15:55Z","author_association":"CONTRIBUTOR","body":"This test is a gift that keeps on giving ðŸ˜ \r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+bwc-tests/3/console failed as follows:\r\n\r\n```\r\njava.util.NoSuchElementException\r\n\tat __randomizedtesting.SeedInfo.seed([E7E5A73C8428AF07:BF8B85010BF55970]:0)\r\n\tat java.util.HashMap$HashIterator.nextNode(HashMap.java:1444)\r\n\tat java.util.HashMap$ValueIterator.next(HashMap.java:1471)\r\n\tat org.elasticsearch.xpack.restart.FullClusterRestartIT.assertRollUpJob(FullClusterRestartIT.java:651)\r\n\tat org.elasticsearch.xpack.restart.FullClusterRestartIT.testRollupIDSchemeAfterRestart(FullClusterRestartIT.java:392)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1750)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:938)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:974)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:988)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:947)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:832)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:883)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:894)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nAllegedly, but not for me:\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:qa:full-cluster-restart:with-system-key:v6.3.2#upgradedClusterTestRunner \\\r\n  -Dtests.seed=E7E5A73C8428AF07 \\\r\n  -Dtests.class=org.elasticsearch.xpack.restart.FullClusterRestartIT \\\r\n  -Dtests.method=\"testRollupIDSchemeAfterRestart\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=vi-VN \\\r\n  -Dtests.timezone=Atlantic/Stanley \\\r\n  -Dcompiler.java=10 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nI wonder if perhaps the following line should have an `equalTo(\"started\")` in it so it waits for things to settle down after the restart?\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/d725416f686c62cd2d6130c910a6f09897ebe5e0/x-pack/qa/full-cluster-restart/src/test/java/org/elasticsearch/xpack/restart/FullClusterRestartIT.java#L392","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422056317","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-422056317","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":422056317,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjA1NjMxNw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-09-17T15:13:35Z","updated_at":"2018-09-17T15:13:35Z","author_association":"MEMBER","body":"Gift that keeps on giving indeed :(\r\n\r\n>I wonder if perhaps the following line should have an equalTo(\"started\") in it so it waits for things to settle down after the restart?\r\n\r\nUnfortunately, it does that in `assertRollupJob()`:  https://github.com/elastic/elasticsearch/blob/d725416f686c62cd2d6130c910a6f09897ebe5e0/x-pack/qa/full-cluster-restart/src/test/java/org/elasticsearch/xpack/restart/FullClusterRestartIT.java#L634\r\n\r\nThe failure seems to be during the assertion of the job details, as provided by the Tasks API.  This occurs after we have confirmed the job exists in the GetRollupJob API (which means the persistent task exists).\r\n\r\nI wonder if we need another await in there, to account for the allocated task taking slightly longer to \"exist\" after the persistent task is created.  Not sure, will poke around some today.  \r\n\r\nUgh. :(","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422447376","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-422447376","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":422447376,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjQ0NzM3Ng==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T15:48:55Z","updated_at":"2018-09-18T15:48:55Z","author_association":"CONTRIBUTOR","body":"> Unfortunately, it does that in assertRollupJob():\r\n\r\nSo it does, sorry, I must have misread something.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422450264","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-422450264","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":422450264,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjQ1MDI2NA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T15:57:15Z","updated_at":"2018-09-18T15:57:15Z","author_association":"MEMBER","body":"No worries, if that'd been the case I would have been overjoyed at a simple fix :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427395653","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-427395653","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":427395653,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzM5NTY1Mw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T15:00:14Z","updated_at":"2018-10-05T15:00:14Z","author_association":"MEMBER","body":"Another one:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+bwc-tests/61/console\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:qa:full-cluster-restart:without-system-key:v6.3.2#upgradedClusterTestRunner \\\r\n  -Dtests.seed=3E23E8BB6F6FE2BC \\\r\n  -Dtests.class=org.elasticsearch.xpack.restart.FullClusterRestartIT \\\r\n  -Dtests.method=\"testRollupIDSchemeAfterRestart\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=is \\\r\n  -Dtests.timezone=America/Metlakatla \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460254458","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-460254458","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":460254458,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDI1NDQ1OA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T13:44:43Z","updated_at":"2019-02-04T13:44:43Z","author_association":"CONTRIBUTOR","body":"@polyfractal if something were to wipe all the persistent tasks from the cluster state in between the upgraded cluster starting up and `FullClusterRestartIT.testRollupIDSchemeAfterRestart` running, could that explain the failures that have been seen in this issue?  I ask because `FullClusterRestartIT.testSnapshotRestore` sometimes does just that (depending on the order in which the tests run) - see https://github.com/elastic/elasticsearch/issues/36816#issuecomment-460252646.  Also, even when `FullClusterRestartIT.testSnapshotRestore` doesn't cause the persistent tasks to be wiped out, it can cause their assignments to become stale, so cause them to be reassigned to the other node in the cluster part way through the series of assertions that `FullClusterRestartIT.testRollupIDSchemeAfterRestart` is making.  Could _that_ cause the test failures that were observed?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460299686","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-460299686","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":460299686,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDI5OTY4Ng==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T15:51:52Z","updated_at":"2019-02-04T15:51:52Z","author_association":"MEMBER","body":"@droberts195 Oh! Yes, I bet that would/could have caused some of these failures.  This test:\r\n\r\n1. Creates a job, indexes some data, makes sure everything looks good\r\n2. Upgrades and restarts cluster\r\n3. Ensures the job created in step 1 is active/ready\r\n4. Stops and restarts the job to check a certain flag has changed\r\n\r\nStep 3. would definitely break if the state were wiped in between 1 and 3, since the job wouldn't exist and the assertions would fail (which is what the failures in this issue are showing).\r\n\r\nI don't _think_ shifting assignments would cause failures in this case, since we're just asserting that the job exists somewhere and has been upgraded correctly.  But if the state were totally wiped away I certainly would.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460825827","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-460825827","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":460825827,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDgyNTgyNw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-02-05T22:16:48Z","updated_at":"2019-02-05T22:16:48Z","author_association":"MEMBER","body":"Oops, closed via that test fix which predated the ^^ comments.  I think the fix in #38218 probably contributed to some of the failures, but the snapshot/restore could easily have contributed to the others. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/474081462","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-474081462","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":474081462,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDA4MTQ2Mg==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2019-03-18T20:10:57Z","updated_at":"2019-03-18T20:10:57Z","author_association":"MEMBER","body":"This has reappeared in the 6.6 BWC tests\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.6+bwc-tests/313/console.\r\n\r\n```\r\nExpected: iterable over [\"3310683722\", \"rollup-id-test$ehY4NAyVSy8xxUDZrNXXIA\"] in any order\r\n     but: Not matched: \"621059582\"\r\n\t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\t\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\t\tat org.elasticsearch.xpack.restart.FullClusterRestartIT.lambda$testRollupIDSchemeAfterRestart$5(FullClusterRestartIT.java:413)\r\n\t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:836)\r\n\t\t... 39 more\r\n\tSuppressed: java.lang.AssertionError: \r\nExpected: <2>\r\n     but: was <3>\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/474086741","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-474086741","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":474086741,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDA4Njc0MQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-03-18T20:25:29Z","updated_at":"2019-03-18T20:25:29Z","author_association":"MEMBER","body":"Thanks for the ping.  Looks like it might be a missed backport.  Investigating","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/474602805","html_url":"https://github.com/elastic/elasticsearch/issues/32773#issuecomment-474602805","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32773","id":474602805,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDYwMjgwNQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-03-19T22:04:45Z","updated_at":"2019-03-19T22:04:45Z","author_association":"MEMBER","body":"Ok, backported to 6.6.  I believe that particular fix has been fully backported, so if it fails again it may be the issue @droberts195 mentioned... or something else.\r\n\r\nClosing for now. :crossed_fingers: ","performed_via_github_app":null}]