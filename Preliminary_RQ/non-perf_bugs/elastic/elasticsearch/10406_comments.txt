[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89131271","html_url":"https://github.com/elastic/elasticsearch/issues/10406#issuecomment-89131271","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10406","id":89131271,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MTMxMjcx","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2015-04-03T02:41:32Z","updated_at":"2015-04-03T02:41:32Z","author_association":"CONTRIBUTOR","body":"Thanks for the detailed report, @ravlio!\nCurrently, there is a hard limit of at most 256 duplicated analyzed form per (lucene) segment, after which the suggestion entries are ignored. It seems like you have hit that limit.\nIn this case, the analyzed form of \"car\" must have exceeded that limit in some segments and hence you see missing suggestions. \nA work-around might be to use multiple surface forms to represent \"car\", s.t. none of the surface forms hit this limit. \nThis is a known issue, we are working towards removing this limitation.  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/92022019","html_url":"https://github.com/elastic/elasticsearch/issues/10406#issuecomment-92022019","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10406","id":92022019,"node_id":"MDEyOklzc3VlQ29tbWVudDkyMDIyMDE5","user":{"login":"ravlio","id":2349151,"node_id":"MDQ6VXNlcjIzNDkxNTE=","avatar_url":"https://avatars1.githubusercontent.com/u/2349151?v=4","gravatar_id":"","url":"https://api.github.com/users/ravlio","html_url":"https://github.com/ravlio","followers_url":"https://api.github.com/users/ravlio/followers","following_url":"https://api.github.com/users/ravlio/following{/other_user}","gists_url":"https://api.github.com/users/ravlio/gists{/gist_id}","starred_url":"https://api.github.com/users/ravlio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ravlio/subscriptions","organizations_url":"https://api.github.com/users/ravlio/orgs","repos_url":"https://api.github.com/users/ravlio/repos","events_url":"https://api.github.com/users/ravlio/events{/privacy}","received_events_url":"https://api.github.com/users/ravlio/received_events","type":"User","site_admin":false},"created_at":"2015-04-12T09:17:02Z","updated_at":"2015-04-12T09:17:02Z","author_association":"NONE","body":"Finally, I have found a trick to solve problem with limitations. Simply we append each input word with set of random characters (5 chars length is enough to for getting unique words). Another hint is to make first character of appending numeric. \n\nSo the indexing now looks like:\n\n```\n\"suggest\": {\n         \"input\": [\"best card to buy\", \"best1dricj\", \"car1vjtiw\", \"buy1clskq\"], // \"to\" is a stopword and omitted\n         \"output\" : \"best car to buy\", // output is required to get whole phrase in results instead of searchable words \n         \"weight\": 123\n      }\n```\n\nThe \"**1**\" digit prevents cases when word and random string form other words. For example, in some case  we can get randomly word \"**cardhsqoe**\" which besides \"**car**\" will be also searched by \"**card**\" giving inaccurate results. Maybe is is possible to more unique character like \"**#**\", need to try.\n\nThis solution words perfectly in 20m index. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297759564","html_url":"https://github.com/elastic/elasticsearch/issues/10406#issuecomment-297759564","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10406","id":297759564,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzc1OTU2NA==","user":{"login":"trompx","id":6394620,"node_id":"MDQ6VXNlcjYzOTQ2MjA=","avatar_url":"https://avatars3.githubusercontent.com/u/6394620?v=4","gravatar_id":"","url":"https://api.github.com/users/trompx","html_url":"https://github.com/trompx","followers_url":"https://api.github.com/users/trompx/followers","following_url":"https://api.github.com/users/trompx/following{/other_user}","gists_url":"https://api.github.com/users/trompx/gists{/gist_id}","starred_url":"https://api.github.com/users/trompx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trompx/subscriptions","organizations_url":"https://api.github.com/users/trompx/orgs","repos_url":"https://api.github.com/users/trompx/repos","events_url":"https://api.github.com/users/trompx/events{/privacy}","received_events_url":"https://api.github.com/users/trompx/received_events","type":"User","site_admin":false},"created_at":"2017-04-27T16:03:12Z","updated_at":"2017-04-27T16:43:21Z","author_association":"NONE","body":"Hello,\r\n\r\nES version: 5.2\r\n\r\nThanks a lot for the solution @ravlio. Unfortunatly, it is not fully working in my case. I have less data so I don't really know what may be the bug.\r\n\r\nI have 15 strings composed of multiple words : `word1 word2 word3 word4 ...`\r\nword1 is common to all of those 15 strings.\r\nI index as input all permutation of those words (I have between 30-1000 inputs for each indexed documents).\r\n```\r\n\"suggest\": {\r\n         \"input\": [\"word1\", \"word2\", \"word3\", \"word4\", \"word1 word2\", \"word1 word3\" and so on...],\r\n         \"output\" : \"word1 word2 word3 word4\",\r\n         \"weight\": 1000\r\n}\r\n```\r\nSearching for word1 was only returning 2 strings.\r\n\r\nI tried adding a random string at the end of each input:\r\n```\r\n\"suggest\": {\r\n         \"input\": [\"word1$rnd1\", \"word2$rnd2\", \"word3$rnd3\", \"word4$rnd4\", \"word1 word2$rnd5\", \"word1 word3$rnd6\" and so on...],\r\n         \"output\" : \"word1 word2 word3 word4\",\r\n         \"weight\": 1000\r\n}\r\n```\r\nNow I get more results, but only 5 out of 15.\r\n\r\nDid you find a better solution?\r\n\r\n@areek Did you come up with something to remove that limitation?\r\n@ravlio did you use anything not default for the mapping?\r\n\r\nThank you\r\n\r\n**Update** : the problem happens when not setting weight, or setting a common weight for all strings. When setting weight per input, I get all the strings. Is this expected behaviour?","performed_via_github_app":null}]