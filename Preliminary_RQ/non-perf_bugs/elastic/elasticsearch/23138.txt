{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23138","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23138/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23138/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23138/events","html_url":"https://github.com/elastic/elasticsearch/issues/23138","id":207140479,"node_id":"MDU6SXNzdWUyMDcxNDA0Nzk=","number":23138,"title":"MatchQuery use Date with Elasticsearch5.2.0,catch java.lang.IllegalArgumentException: Invalid format","user":{"login":"engimatic","id":14733591,"node_id":"MDQ6VXNlcjE0NzMzNTkx","avatar_url":"https://avatars1.githubusercontent.com/u/14733591?v=4","gravatar_id":"","url":"https://api.github.com/users/engimatic","html_url":"https://github.com/engimatic","followers_url":"https://api.github.com/users/engimatic/followers","following_url":"https://api.github.com/users/engimatic/following{/other_user}","gists_url":"https://api.github.com/users/engimatic/gists{/gist_id}","starred_url":"https://api.github.com/users/engimatic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/engimatic/subscriptions","organizations_url":"https://api.github.com/users/engimatic/orgs","repos_url":"https://api.github.com/users/engimatic/repos","events_url":"https://api.github.com/users/engimatic/events{/privacy}","received_events_url":"https://api.github.com/users/engimatic/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-02-13T07:26:09Z","updated_at":"2017-06-13T17:51:34Z","closed_at":"2017-02-13T09:07:38Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:5.2.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**:1.8.0_121-b13\r\n\r\n**OS version**:Centos6.8\r\n\r\nWhen I update my Elasticsearch from 2.2.1 to 5.2.0,some of my code run with error\r\nWhen I want to get data from Elasticsearch use above method,I hava catch the error like this \r\n\r\n```\r\nprivate <T> ArrayList<T> connectES(Date timestamp, String index, String type, Class<T> clazz) {\r\n\r\n        ArrayList<T> values = new ArrayList<>();\r\n        if (!client.admin().indices().prepareExists(index).execute().actionGet().isExists()) {\r\n            System.out.println(\"索引\" + index + \"不存在\");\r\n            return values;\r\n        }\r\n\r\n        SearchResponse scrollResp = client.prepareSearch(index)\r\n                .setTypes(type).setSearchType(SearchType.QUERY_THEN_FETCH)\r\n                .setQuery(QueryBuilders.matchQuery(\"start_timestamp\", timestamp))\r\n                .setScroll(new TimeValue(60000))\r\n                .setSize(10000).execute().actionGet();\r\n\r\n\r\n        System.out.println(scrollResp.getHits().getTotalHits());\r\n\r\n\r\n        while (true) {\r\n            for (SearchHit hit : scrollResp.getHits().getHits()) {\r\n                T value = JSON.parseObject(hit.sourceAsString(), clazz);\r\n                values.add(value);\r\n            }\r\n            scrollResp = client.prepareSearchScroll(scrollResp.getScrollId()).setScroll(new TimeValue(60000)).execute\r\n                    ().actionGet();\r\n            //Break condition: No hits are returned\r\n            if (scrollResp.getHits().getHits().length == 0) {\r\n                break;\r\n            }\r\n        }\r\n        return values;\r\n    }\r\n```\r\n`Caused by: RemoteTransportException[[node-hot][10.128.9.207:9300][indices:data/read/search[phase/query]]]; nested: QueryShardException[failed to create query: {\r\n  \"match\" : {\r\n    \"start_timestamp\" : {\r\n      \"query\" : \"2017-02-13T07:00:00.000Z\",\r\n      \"operator\" : \"OR\",\r\n      \"prefix_length\" : 0,\r\n      \"max_expansions\" : 50,\r\n      \"fuzzy_transpositions\" : true,\r\n      \"lenient\" : false,\r\n      \"zero_terms_query\" : \"NONE\",\r\n      \"boost\" : 1.0\r\n    }\r\n  }\r\n}]; nested: IllegalArgumentException[Invalid format: \"Mon Feb 13 15:00:00 CST 2017\"];\r\nCaused by: [http-stat-session-2017.02.09/0eW3RdA6QButDqpNWF2uLg] QueryShardException[failed to create query: {\r\n  \"match\" : {\r\n    \"start_timestamp\" : {\r\n      \"query\" : \"2017-02-13T07:00:00.000Z\",\r\n      \"operator\" : \"OR\",\r\n      \"prefix_length\" : 0,\r\n      \"max_expansions\" : 50,\r\n      \"fuzzy_transpositions\" : true,\r\n      \"lenient\" : false,\r\n      \"zero_terms_query\" : \"NONE\",\r\n      \"boost\" : 1.0\r\n    }\r\n  }\r\n}]; nested: IllegalArgumentException[Invalid format: \"Mon Feb 13 15:00:00 CST 2017\"];\r\n\tat org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:333)\r\n\tat org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:311)\r\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:671)\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:540)\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:516)\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:251)\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:298)\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:295)\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69)\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1488)\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:596)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: java.lang.IllegalArgumentException: Invalid format: \"Mon Feb 13 15:00:00 CST 2017\"\r\n\tat org.joda.time.format.DateTimeParserBucket.doParseMillis(DateTimeParserBucket.java:187)\r\n\tat org.joda.time.format.DateTimeFormatter.parseMillis(DateTimeFormatter.java:826)\r\n\tat org.elasticsearch.index.mapper.LegacyDateFieldMapper$DateFieldType.parseValue(LegacyDateFieldMapper.java:265)\r\n\tat org.elasticsearch.index.mapper.LegacyDateFieldMapper$DateFieldType.indexedValueForSearch(LegacyDateFieldMapper.java:277)\r\n\tat org.elasticsearch.index.mapper.TermBasedFieldType.termQuery(TermBasedFieldType.java:54)\r\n\tat org.elasticsearch.index.mapper.LegacyNumberFieldMapper$NumberFieldType.termQuery(LegacyNumberFieldMapper.java:117)\r\n\tat org.elasticsearch.index.search.MatchQuery.termQuery(MatchQuery.java:279)\r\n\tat org.elasticsearch.index.search.MatchQuery.blendTermQuery(MatchQuery.java:402)\r\n\tat org.elasticsearch.index.search.MatchQuery.parse(MatchQuery.java:243)\r\n\tat org.elasticsearch.index.query.MatchQueryBuilder.doToQuery(MatchQueryBuilder.java:466)\r\n\tat org.elasticsearch.index.query.AbstractQueryBuilder.toQuery(AbstractQueryBuilder.java:97)\r\n\tat org.elasticsearch.index.query.QueryShardContext.lambda$toQuery$1(QueryShardContext.java:312)\r\n\tat org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:329)\r\n\t... 14 more`\r\n","closed_by":{"login":"engimatic","id":14733591,"node_id":"MDQ6VXNlcjE0NzMzNTkx","avatar_url":"https://avatars1.githubusercontent.com/u/14733591?v=4","gravatar_id":"","url":"https://api.github.com/users/engimatic","html_url":"https://github.com/engimatic","followers_url":"https://api.github.com/users/engimatic/followers","following_url":"https://api.github.com/users/engimatic/following{/other_user}","gists_url":"https://api.github.com/users/engimatic/gists{/gist_id}","starred_url":"https://api.github.com/users/engimatic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/engimatic/subscriptions","organizations_url":"https://api.github.com/users/engimatic/orgs","repos_url":"https://api.github.com/users/engimatic/repos","events_url":"https://api.github.com/users/engimatic/events{/privacy}","received_events_url":"https://api.github.com/users/engimatic/received_events","type":"User","site_admin":false},"performed_via_github_app":null}