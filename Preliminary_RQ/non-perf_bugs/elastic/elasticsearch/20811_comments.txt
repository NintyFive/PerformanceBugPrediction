[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252384058","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252384058","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252384058,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjM4NDA1OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-10-07T23:29:47Z","updated_at":"2016-10-07T23:29:47Z","author_association":"MEMBER","body":"Sorry, but there is not nearly enough to reproduce here; can you start by sharing your script? I find it dubious that the script engine is attempting to access that class without provocation. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252384800","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252384800","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252384800,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjM4NDgwMA==","user":{"login":"darshanmehta10","id":12479117,"node_id":"MDQ6VXNlcjEyNDc5MTE3","avatar_url":"https://avatars3.githubusercontent.com/u/12479117?v=4","gravatar_id":"","url":"https://api.github.com/users/darshanmehta10","html_url":"https://github.com/darshanmehta10","followers_url":"https://api.github.com/users/darshanmehta10/followers","following_url":"https://api.github.com/users/darshanmehta10/following{/other_user}","gists_url":"https://api.github.com/users/darshanmehta10/gists{/gist_id}","starred_url":"https://api.github.com/users/darshanmehta10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshanmehta10/subscriptions","organizations_url":"https://api.github.com/users/darshanmehta10/orgs","repos_url":"https://api.github.com/users/darshanmehta10/repos","events_url":"https://api.github.com/users/darshanmehta10/events{/privacy}","received_events_url":"https://api.github.com/users/darshanmehta10/received_events","type":"User","site_admin":false},"created_at":"2016-10-07T23:36:29Z","updated_at":"2016-10-07T23:59:10Z","author_association":"NONE","body":"Hey @jasontedor,\n\nThanks for the quick reply, the script is just updates a couple of fields in source, e.g.:\n\n`if(userId){`\n  `ctx._source.user.id = userId`\n`}`\n\n`if(userName){`\n  `ctx._source.user.name = userName`\n}`\n\nThis script hasn't changed recently. Looks like something to do with security/permissions? SecurityConstants.java class does not seem to have anyting that prevents it from being loaded.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252386042","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252386042","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252386042,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjM4NjA0Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-10-07T23:47:51Z","updated_at":"2016-10-07T23:47:51Z","author_association":"MEMBER","body":"Yes, it's clearly a permissions issue but we need to come to an understanding why that class is being loaded here. Your script looks innocent, can you please provide a more detailed reproduction?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252387028","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252387028","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252387028,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjM4NzAyOA==","user":{"login":"darshanmehta10","id":12479117,"node_id":"MDQ6VXNlcjEyNDc5MTE3","avatar_url":"https://avatars3.githubusercontent.com/u/12479117?v=4","gravatar_id":"","url":"https://api.github.com/users/darshanmehta10","html_url":"https://github.com/darshanmehta10","followers_url":"https://api.github.com/users/darshanmehta10/followers","following_url":"https://api.github.com/users/darshanmehta10/following{/other_user}","gists_url":"https://api.github.com/users/darshanmehta10/gists{/gist_id}","starred_url":"https://api.github.com/users/darshanmehta10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshanmehta10/subscriptions","organizations_url":"https://api.github.com/users/darshanmehta10/orgs","repos_url":"https://api.github.com/users/darshanmehta10/repos","events_url":"https://api.github.com/users/darshanmehta10/events{/privacy}","received_events_url":"https://api.github.com/users/darshanmehta10/received_events","type":"User","site_admin":false},"created_at":"2016-10-07T23:58:10Z","updated_at":"2016-10-08T00:18:04Z","author_association":"NONE","body":"Here is the Java code that executes update request:\n\n`UpdateRequest updateRequest = new UpdateRequest();`\n`updateRequest.script(\"update\", ScriptType.FILE);`\n`updateRequest.scriptParams(getUpdateScriptParams());`\n`updateRequest.retryOnConflict(5);`\n`updateRequest.upsert(//byte array);`\n\n`UpdateResponse response = client.update(updateRequest).actionGet();`\n\nupdate.groovy is accessible to elasticsearch (to cross check, I tried changing the file name and got Script not found error). The script itself does not load Security packages/classes. Maybe it's Elasticsearch's groovy engine that tries to load them?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252392429","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252392429","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252392429,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjM5MjQyOQ==","user":{"login":"darshanmehta10","id":12479117,"node_id":"MDQ6VXNlcjEyNDc5MTE3","avatar_url":"https://avatars3.githubusercontent.com/u/12479117?v=4","gravatar_id":"","url":"https://api.github.com/users/darshanmehta10","html_url":"https://github.com/darshanmehta10","followers_url":"https://api.github.com/users/darshanmehta10/followers","following_url":"https://api.github.com/users/darshanmehta10/following{/other_user}","gists_url":"https://api.github.com/users/darshanmehta10/gists{/gist_id}","starred_url":"https://api.github.com/users/darshanmehta10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshanmehta10/subscriptions","organizations_url":"https://api.github.com/users/darshanmehta10/orgs","repos_url":"https://api.github.com/users/darshanmehta10/repos","events_url":"https://api.github.com/users/darshanmehta10/events{/privacy}","received_events_url":"https://api.github.com/users/darshanmehta10/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T01:04:05Z","updated_at":"2016-10-08T01:04:05Z","author_association":"NONE","body":"I am able to execure the script using _search endpoint (as explained [here](https://www.elastic.co/blog/running-groovy-scripts-without-dynamic-scripting)). However, when I try to execute it from Java app (using the code above), it fails with ClassNotFound error. Maybe I need to look into java policy files?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252393507","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252393507","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252393507,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjM5MzUwNw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T01:21:27Z","updated_at":"2016-10-08T01:21:27Z","author_association":"CONTRIBUTOR","body":"Just to confirm: that client is a TransportClient, right? You aren't\nrunning ES in the same JVM as your app?\n\nOn Oct 7, 2016 9:04 PM, \"darshanmehta10\" notifications@github.com wrote:\n\n> I am able to execure the script using _search endpoint (as explained here\n> https://www.elastic.co/blog/running-groovy-scripts-without-dynamic-scripting).\n> However, when I try to execute it from Java app (using the code above), it\n> fails with ClassNotFound error. Maybe I need to look into java policy files?\n> \n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252392429,\n> or mute the thread\n> https://github.com/notifications/unsubscribe-auth/AANLosRSM4EgQIElQ0uVXSWRhmqpI4Erks5qxuwJgaJpZM4KRiT_\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252393850","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252393850","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252393850,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjM5Mzg1MA==","user":{"login":"darshanmehta10","id":12479117,"node_id":"MDQ6VXNlcjEyNDc5MTE3","avatar_url":"https://avatars3.githubusercontent.com/u/12479117?v=4","gravatar_id":"","url":"https://api.github.com/users/darshanmehta10","html_url":"https://github.com/darshanmehta10","followers_url":"https://api.github.com/users/darshanmehta10/followers","following_url":"https://api.github.com/users/darshanmehta10/following{/other_user}","gists_url":"https://api.github.com/users/darshanmehta10/gists{/gist_id}","starred_url":"https://api.github.com/users/darshanmehta10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshanmehta10/subscriptions","organizations_url":"https://api.github.com/users/darshanmehta10/orgs","repos_url":"https://api.github.com/users/darshanmehta10/repos","events_url":"https://api.github.com/users/darshanmehta10/events{/privacy}","received_events_url":"https://api.github.com/users/darshanmehta10/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T01:27:02Z","updated_at":"2016-10-08T01:27:02Z","author_association":"NONE","body":"Yes, that's correct.\n\nOn 8 Oct 2016 2:22 a.m., \"Nik Everett\" notifications@github.com wrote:\n\n> Just to confirm: that client is a TransportClient, right? You aren't\n> running ES in the same JVM as your app?\n> \n> On Oct 7, 2016 9:04 PM, \"darshanmehta10\" notifications@github.com wrote:\n> \n> > I am able to execure the script using _search endpoint (as explained here\n> > <https://www.elastic.co/blog/running-groovy-scripts-\n> > without-dynamic-scripting>).\n> > However, when I try to execute it from Java app (using the code above),\n> > it\n> > fails with ClassNotFound error. Maybe I need to look into java policy\n> > files?\n> > \n> > —\n> > You are receiving this because you are subscribed to this thread.\n> > Reply to this email directly, view it on GitHub\n> > <https://github.com/elastic/elasticsearch/issues/20811#\n> > issuecomment-252392429>,\n> > or mute the thread\n> > <https://github.com/notifications/unsubscribe-auth/\n> > AANLosRSM4EgQIElQ0uVXSWRhmqpI4Erks5qxuwJgaJpZM4KRiT_>\n> > .\n> \n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252393507,\n> or mute the thread\n> https://github.com/notifications/unsubscribe-auth/AL5qjaKPwA9mKySNAAduSAoMgnrHDbI9ks5qxvBTgaJpZM4KRiT_\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252396183","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252396183","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252396183,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjM5NjE4Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T02:09:27Z","updated_at":"2016-10-08T02:09:53Z","author_association":"MEMBER","body":"> Maybe I need to look into java policy files?\n\nWe want to understand why this is happening first, the goal is not to just paper over the problem.  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252421631","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252421631","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252421631,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjQyMTYzMQ==","user":{"login":"darshanmehta10","id":12479117,"node_id":"MDQ6VXNlcjEyNDc5MTE3","avatar_url":"https://avatars3.githubusercontent.com/u/12479117?v=4","gravatar_id":"","url":"https://api.github.com/users/darshanmehta10","html_url":"https://github.com/darshanmehta10","followers_url":"https://api.github.com/users/darshanmehta10/followers","following_url":"https://api.github.com/users/darshanmehta10/following{/other_user}","gists_url":"https://api.github.com/users/darshanmehta10/gists{/gist_id}","starred_url":"https://api.github.com/users/darshanmehta10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshanmehta10/subscriptions","organizations_url":"https://api.github.com/users/darshanmehta10/orgs","repos_url":"https://api.github.com/users/darshanmehta10/repos","events_url":"https://api.github.com/users/darshanmehta10/events{/privacy}","received_events_url":"https://api.github.com/users/darshanmehta10/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T12:19:38Z","updated_at":"2016-10-08T12:20:25Z","author_association":"NONE","body":"I have enabled the trace logging in the app and can see the following exception when the app starts up:\n\n`java.lang.ClassNotFoundException: groovy.lang.GroovyClassLoader\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:381) ~[na:1.8.0_101]\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[na:1.8.0_101]\n        at org.springframework.boot.loader.LaunchedURLClassLoader.doLoadClass(LaunchedURLClassLoader.java:178) ~[elasticsearch-indexer.jar!/:1.1.1.SNAPSHOT]\n        at org.springframework.boot.loader.LaunchedURLClassLoader.loadClass(LaunchedURLClassLoader.java:142) ~[elasticsearch-indexer.jar!/:1.1.1.SNAPSHOT]\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[na:1.8.0_101]\n        at org.elasticsearch.script.ScriptModule.configure(ScriptModule.java:94) ~[elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.AbstractModule.configure(AbstractModule.java:60) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.spi.Elements$RecordingBinder.install(Elements.java:204) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.spi.Elements.getElements(Elements.java:85) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.InjectorShell$Builder.build(InjectorShell.java:130) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:99) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:93) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:70) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.ModulesBuilder.createInjector(ModulesBuilder.java:59) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.node.internal.InternalNode.<init>(InternalNode.java:210) [elasticsearch-1.7.2.jar!/:na]`\n\nThere is another CNF for LuceneExpression as well:\n\n`java.lang.ClassNotFoundException: org.apache.lucene.expressions.Expression\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:381) ~[na:1.8.0_101]\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[na:1.8.0_101]\n        at org.springframework.boot.loader.LaunchedURLClassLoader.doLoadClass(LaunchedURLClassLoader.java:178) ~[elasticsearch-indexer.jar!/:1.1.1.SNAPSHOT]\n        at org.springframework.boot.loader.LaunchedURLClassLoader.loadClass(LaunchedURLClassLoader.java:142) ~[elasticsearch-indexer.jar!/:1.1.1.SNAPSHOT]\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[na:1.8.0_101]\n        at org.elasticsearch.script.ScriptModule.configure(ScriptModule.java:108) ~[elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.AbstractModule.configure(AbstractModule.java:60) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.spi.Elements$RecordingBinder.install(Elements.java:204) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.spi.Elements.getElements(Elements.java:85) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.InjectorShell$Builder.build(InjectorShell.java:130) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:99) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:93) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:70) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.common.inject.ModulesBuilder.createInjector(ModulesBuilder.java:59) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.node.internal.InternalNode.<init>(InternalNode.java:210) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:159) [elasticsearch-1.7.2.jar!/:na]\n        at org.elasticsearch.node.NodeBuilder.node(NodeBuilder.java:166) [elasticsearch-1.7.2.jar!/:na]`\n\nNot sure whether SecurityConstants error has anything to do with this, but I would add the required dependencies now and will see how it goes.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252422313","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252422313","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252422313,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjQyMjMxMw==","user":{"login":"darshanmehta10","id":12479117,"node_id":"MDQ6VXNlcjEyNDc5MTE3","avatar_url":"https://avatars3.githubusercontent.com/u/12479117?v=4","gravatar_id":"","url":"https://api.github.com/users/darshanmehta10","html_url":"https://github.com/darshanmehta10","followers_url":"https://api.github.com/users/darshanmehta10/followers","following_url":"https://api.github.com/users/darshanmehta10/following{/other_user}","gists_url":"https://api.github.com/users/darshanmehta10/gists{/gist_id}","starred_url":"https://api.github.com/users/darshanmehta10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshanmehta10/subscriptions","organizations_url":"https://api.github.com/users/darshanmehta10/orgs","repos_url":"https://api.github.com/users/darshanmehta10/repos","events_url":"https://api.github.com/users/darshanmehta10/events{/privacy}","received_events_url":"https://api.github.com/users/darshanmehta10/received_events","type":"User","site_admin":false},"created_at":"2016-10-08T12:35:12Z","updated_at":"2016-10-08T12:35:12Z","author_association":"NONE","body":"After adding the dependencies, CNF error for Expression is gone. However, the original error still persists.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252478944","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252478944","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252478944,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjQ3ODk0NA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-10-09T10:41:17Z","updated_at":"2016-10-09T10:41:17Z","author_association":"CONTRIBUTOR","body":"It sounds like your installation is messed up.  Presumably the node restarted at some stage and all the deps that were previously loaded are now now found?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252481460","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252481460","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252481460,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjQ4MTQ2MA==","user":{"login":"darshanmehta10","id":12479117,"node_id":"MDQ6VXNlcjEyNDc5MTE3","avatar_url":"https://avatars3.githubusercontent.com/u/12479117?v=4","gravatar_id":"","url":"https://api.github.com/users/darshanmehta10","html_url":"https://github.com/darshanmehta10","followers_url":"https://api.github.com/users/darshanmehta10/followers","following_url":"https://api.github.com/users/darshanmehta10/following{/other_user}","gists_url":"https://api.github.com/users/darshanmehta10/gists{/gist_id}","starred_url":"https://api.github.com/users/darshanmehta10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshanmehta10/subscriptions","organizations_url":"https://api.github.com/users/darshanmehta10/orgs","repos_url":"https://api.github.com/users/darshanmehta10/repos","events_url":"https://api.github.com/users/darshanmehta10/events{/privacy}","received_events_url":"https://api.github.com/users/darshanmehta10/received_events","type":"User","site_admin":false},"created_at":"2016-10-09T11:36:34Z","updated_at":"2016-10-09T11:36:34Z","author_association":"NONE","body":"Yes, the node restarted itself and we are seeing these errors since then (we haven't made any change in scripts). So, it looks like installation/permissions issue.\nHowever, we are seeing the error from all the other nodes as well (we have 7 node cluster) which is a bit odd. Do you think we should try restarting the affected node (or all the nodes one by one, in the worst case)? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252554035","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252554035","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252554035,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjU1NDAzNQ==","user":{"login":"darshanmehta10","id":12479117,"node_id":"MDQ6VXNlcjEyNDc5MTE3","avatar_url":"https://avatars3.githubusercontent.com/u/12479117?v=4","gravatar_id":"","url":"https://api.github.com/users/darshanmehta10","html_url":"https://github.com/darshanmehta10","followers_url":"https://api.github.com/users/darshanmehta10/followers","following_url":"https://api.github.com/users/darshanmehta10/following{/other_user}","gists_url":"https://api.github.com/users/darshanmehta10/gists{/gist_id}","starred_url":"https://api.github.com/users/darshanmehta10/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darshanmehta10/subscriptions","organizations_url":"https://api.github.com/users/darshanmehta10/orgs","repos_url":"https://api.github.com/users/darshanmehta10/repos","events_url":"https://api.github.com/users/darshanmehta10/events{/privacy}","received_events_url":"https://api.github.com/users/darshanmehta10/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T07:50:26Z","updated_at":"2016-10-10T07:53:59Z","author_association":"NONE","body":"@clintongormley looks like there was a problem with installation. We have done a rolling restart of all the nodes and that exception is gone now. However, we are now seeing a different error:\n\n`org.elasticsearch.ElasticsearchIllegalArgumentException: failed to execute script\nat org.elasticsearch.action.update.UpdateHelper.prepare(UpdateHelper.java:202)\nat org.elasticsearch.action.update.TransportUpdateAction.shardOperation(TransportUpdateAction.java:176)\nat org.elasticsearch.action.update.TransportUpdateAction.shardOperation(TransportUpdateAction.java:170)\nat org.elasticsearch.action.support.single.instance.TransportInstanceSingleOperationAction$AsyncSingleAction$1.run(TransportInstanceSingleOperationAction.java:187)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\nat java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: NullPointerException[Cannot set property 'id' on null object]\nat org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:274)\nat org.elasticsearch.action.update.UpdateHelper.prepare(UpdateHelper.java:198)`\n\nBelow is the json document:\n\n``` json\n{\n    \"id\": \"6uqgrnSyBfVOrEvtexwZig==\",\n    \"createdDate\": 1469699160000,\n    \"title\": \"Neues Harry Potter Buch\",\n    \"user\": {\n        \"id\": \"1e54a466-ed26-486f-8771-2480bacb5c80\",\n        \"userName\": \"hamburgmagazin\",\n        \"name\": \"hamburgmagazin\"\n    }\n}\n```\n\nEven though it has id and username, we get the NPE while executing the script. Looks similar to [this](https://github.com/elastic/elasticsearch/issues/17845) bug.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252555610","html_url":"https://github.com/elastic/elasticsearch/issues/20811#issuecomment-252555610","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20811","id":252555610,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjU1NTYxMA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T08:00:47Z","updated_at":"2016-10-10T08:00:47Z","author_association":"CONTRIBUTOR","body":"Given that we have an explanation for the original problem, I'm going to close this issue.\n\n> Even though it has id and username, we get the NPE while executing the script. Looks similar to this bug.\n\nWe never confirmed that #17845 was a bug or not.  I was unable to replicate it and I assume the reporter was as well, as we never heard back from them.  If you manage to come up with a recreation, then feel free to open a new ticket.\n","performed_via_github_app":null}]