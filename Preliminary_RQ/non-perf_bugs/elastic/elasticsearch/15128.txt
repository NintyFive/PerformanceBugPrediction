{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15128","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15128/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15128/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15128/events","html_url":"https://github.com/elastic/elasticsearch/issues/15128","id":119601015,"node_id":"MDU6SXNzdWUxMTk2MDEwMTU=","number":15128,"title":"Elasticsearch data corruption after disk expention","user":{"login":"Idofriedman","id":15324592,"node_id":"MDQ6VXNlcjE1MzI0NTky","avatar_url":"https://avatars1.githubusercontent.com/u/15324592?v=4","gravatar_id":"","url":"https://api.github.com/users/Idofriedman","html_url":"https://github.com/Idofriedman","followers_url":"https://api.github.com/users/Idofriedman/followers","following_url":"https://api.github.com/users/Idofriedman/following{/other_user}","gists_url":"https://api.github.com/users/Idofriedman/gists{/gist_id}","starred_url":"https://api.github.com/users/Idofriedman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Idofriedman/subscriptions","organizations_url":"https://api.github.com/users/Idofriedman/orgs","repos_url":"https://api.github.com/users/Idofriedman/repos","events_url":"https://api.github.com/users/Idofriedman/events{/privacy}","received_events_url":"https://api.github.com/users/Idofriedman/received_events","type":"User","site_admin":false},"labels":[{"id":152510590,"node_id":"MDU6TGFiZWwxNTI1MTA1OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Recovery","name":":Distributed/Recovery","color":"0e8a16","default":false,"description":"Anything around constructing a new shard, either from a local or a remote source."},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-11-30T23:00:38Z","updated_at":"2016-02-14T18:25:56Z","closed_at":"2016-02-14T18:25:56Z","author_association":"NONE","active_lock_reason":null,"body":"When expanding an existing disk on a machine, (ec2) elasticsearch does not work correctly with the allocated space.\n\nIt does recognize that the new space is available and allocates shards to the node BUT once the shards get there there the below error is reported:\n\n[2015-11-30 00:01:49,502][WARN ][cluster.action.shard     ] [ES01] [indexname][18] received shard failed for [indexname][18], node[xvIIzsByRt-Ku-t-wLSKyA], relocating [5QhU1g2rQDK-AqTyUMmYMw], [P], s[INITIALIZING], indexUUID [rrS6H6hHTkixYnmTv3th2Q], reason [shard failure [failed recovery][RecoveryFailedException[[indexname][18]: Recovery failed from [ES08][5QhU1g2rQDK-AqTyUMmYMw][PreProd-ElasticSearch-m4.xl-ES08][inet[/XXX.XX.X.XXX:9300]]{master=true} into [ES12][xvIIzsByRt-Ku-t-wLSKyA][ip-XXX-XX-X-XXX][inet[/XXX.XX.XX.XXX:9300]]{master=true}]; nested: RemoteTransportException[[ES08][inet[/XXX.XX.X.XXX:9300]][internal:index/shard/recovery/start_recovery]]; nested: RecoveryEngineException[[indexname][18] Phase[1] Execution failed]; nested: RecoverFilesRecoveryException[[indexname][18] Failed to transfer [127] files with total size of [5gb]]; nested: RemoteTransportException[[ES12][inet[/XXX.XX.X.XXX:9300]][internal:index/shard/recovery/file_chunk]]; nested: FileNotFoundException[/es_data/ebs/PreProd/nodes/0/indices/indexname/18/index/recovery.1448841041953.segments_1x (No space left on device)]; ]\n\nThe error is reported although there is lots of it and it is updated in in node stats as well.\n\nThe issue is resolved in most cases by rebooting the node, this updates ES on the new space in a more complete way and the allocation succeeds.\n\nThe big problem here is that in most cases we had corruption on some of the data.\n\n10x \n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}