[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265401782","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-265401782","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":265401782,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQwMTc4Mg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T09:44:26Z","updated_at":"2016-12-07T09:44:26Z","author_association":"MEMBER","body":"I wonder how complex this would be and if it's worth it given that on the long run we want to get rid of the _all field. The new `all_fields` mode already works it seems, should we just document that this is the recommended solution over highlighting against the `_all` field?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265409469","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-265409469","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":265409469,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQwOTQ2OQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T10:18:43Z","updated_at":"2016-12-07T10:18:43Z","author_association":"MEMBER","body":"> I wonder how complex this would be and if it's worth it given that on the long run we want to get rid of the _all field\r\n\r\nI think it's fairly easy to do for the `plain` and the `unified` highlighter. Since we won't get rid of the _all field in 5.x I think it can still be useful. \r\n\r\n> The new all_fields mode already works it seems, should we just document that this is the recommended solution over highlighting against the _all field?\r\n\r\nAbsolutely, the `all_fields` mode is a perfect fit since it will create dedicated queries for each field. When using `_all` we only have one query and the analyzer that creates the query might be different than the one set on the explicit field. Still I wonder if we should try to fix the discrepancy since we don't know when we will remove the _all field completely ?\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265421612","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-265421612","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":265421612,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQyMTYxMg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T11:16:05Z","updated_at":"2016-12-07T11:16:05Z","author_association":"MEMBER","body":"I don't know, my personal opinion is that highlighting the `_all` field with `require_field_match` set to `true` means not understanding what highlighting is and does. Certainly this comes from having changed the default `require_field_match` value to `true`, which happened some versions ago. The `_all` field is a separate field, we never hid that. But I totally see that users have different expectations on this matter.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265425558","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-265425558","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":265425558,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQyNTU1OA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T11:37:12Z","updated_at":"2016-12-07T11:37:12Z","author_association":"MEMBER","body":"Just to be clear this issue is not about highlighting the `_all` field. It's about highlighting a field with a query that contains reference to `_all`.\r\n\r\nFor instance the following query (using `query_string`):\r\n````\r\ntext:foo category:other bar\r\n````\r\n\r\nwould only highlight \"foo\" if `require_field_match` is set to true for the \"text\" field. The word \"bar\" would not be highlighted since it \"targets\" the `_all` field. Since the _all field contains a copy of the text field we might want to include this word to the highlighting of `text` even when `require_field_match` is true ? \r\n ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265428917","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-265428917","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":265428917,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQyODkxNw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T11:55:27Z","updated_at":"2016-12-07T11:55:27Z","author_association":"MEMBER","body":"Ok, thanks for clarifying that. This sounds better than I initially thought, it's not about highlighting `_all` but rather searching on `_all` and highlighting other fields, that will never have a match as the field with a match was `_all`. This is the perfect usecase for `require_field_match` set to `false`, but when set to `false` `foo` would also be highlighted in the `category` field and `other` in the `text` field. We would like to relax `require_field_match` only for the `bar` term, which is searched against the `_all` field and highlighted against other fields, but `require_field_match` can only be set globally.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265460759","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-265460759","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":265460759,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQ2MDc1OQ==","user":{"login":"Bargs","id":6239176,"node_id":"MDQ6VXNlcjYyMzkxNzY=","avatar_url":"https://avatars3.githubusercontent.com/u/6239176?v=4","gravatar_id":"","url":"https://api.github.com/users/Bargs","html_url":"https://github.com/Bargs","followers_url":"https://api.github.com/users/Bargs/followers","following_url":"https://api.github.com/users/Bargs/following{/other_user}","gists_url":"https://api.github.com/users/Bargs/gists{/gist_id}","starred_url":"https://api.github.com/users/Bargs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bargs/subscriptions","organizations_url":"https://api.github.com/users/Bargs/orgs","repos_url":"https://api.github.com/users/Bargs/repos","events_url":"https://api.github.com/users/Bargs/events{/privacy}","received_events_url":"https://api.github.com/users/Bargs/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T14:28:27Z","updated_at":"2016-12-07T14:28:27Z","author_association":"NONE","body":"Nailed it @javanna. If a Kibana user has an index pattern that matches some indices with `_all` enabled and some with it disabled, they might get results where highlighting appears to be broken:\r\n\r\n![screen shot 2016-11-16 at 3 01 17 pm](https://cloud.githubusercontent.com/assets/6239176/20363590/cad55bbc-ac0d-11e6-8e78-616fb96ef815.png)\r\n\r\nThe first red rectangle comes from an index with `_all` disabled (hence using the new all query), the second red rectangle from an index with `_all` enabled.\r\n\r\nEven if all the indices have `_all` enabled, the highlighting would be much improved if we could relax `require_field_match` just on the `_all` field. It's a long time request from Kibana users.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266987021","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-266987021","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":266987021,"node_id":"MDEyOklzc3VlQ29tbWVudDI2Njk4NzAyMQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-12-14T09:34:29Z","updated_at":"2016-12-14T09:34:29Z","author_association":"CONTRIBUTOR","body":"How about we solve it like this:  use a `highlight_query` that uses `all_fields` mode and `require_field_match: true` - that way we get consistent and correct highlighting, no?\r\n\r\nGiven that (a) we've never had good highlighting on the _all field and (b) we're moving towards removing it, I'd much rather not spend any time on adding workarounds.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266996096","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-266996096","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":266996096,"node_id":"MDEyOklzc3VlQ29tbWVudDI2Njk5NjA5Ng==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-12-14T10:14:28Z","updated_at":"2016-12-14T10:14:28Z","author_association":"MEMBER","body":">  that way we get consistent and correct highlighting, no?\r\n\r\nyes and yes. The `all_fields` is perfect for the highlighter, query terms are correctly analyzed for each highlighted field.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267001050","html_url":"https://github.com/elastic/elasticsearch/issues/22017#issuecomment-267001050","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22017","id":267001050,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzAwMTA1MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-12-14T10:37:41Z","updated_at":"2016-12-14T10:37:41Z","author_association":"CONTRIBUTOR","body":"OK - so no changes required on our side.  Kibana can use this solution instead: https://github.com/elastic/elasticsearch/issues/22017#issuecomment-266987021","performed_via_github_app":null}]