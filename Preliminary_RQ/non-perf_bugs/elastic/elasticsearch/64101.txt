{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/64101","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64101/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64101/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/64101/events","html_url":"https://github.com/elastic/elasticsearch/issues/64101","id":728639429,"node_id":"MDU6SXNzdWU3Mjg2Mzk0Mjk=","number":64101,"title":"Long tail shard query inference","user":{"login":"calm4wei","id":8858257,"node_id":"MDQ6VXNlcjg4NTgyNTc=","avatar_url":"https://avatars2.githubusercontent.com/u/8858257?v=4","gravatar_id":"","url":"https://api.github.com/users/calm4wei","html_url":"https://github.com/calm4wei","followers_url":"https://api.github.com/users/calm4wei/followers","following_url":"https://api.github.com/users/calm4wei/following{/other_user}","gists_url":"https://api.github.com/users/calm4wei/gists{/gist_id}","starred_url":"https://api.github.com/users/calm4wei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calm4wei/subscriptions","organizations_url":"https://api.github.com/users/calm4wei/orgs","repos_url":"https://api.github.com/users/calm4wei/repos","events_url":"https://api.github.com/users/calm4wei/events{/privacy}","received_events_url":"https://api.github.com/users/calm4wei/received_events","type":"User","site_admin":false},"labels":[{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-10-24T02:45:25Z","updated_at":"2020-10-26T09:25:47Z","closed_at":"2020-10-26T09:25:47Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nPlease first search existing issues for the feature you are requesting;\r\nit may already exist, even as a closed issue.\r\n-->\r\n\r\n<!--\r\nDescribe the feature.\r\n\r\nPlease give us as much context as possible about the feature. For example,\r\nyou could include a story about a time when you wanted to use the feature,\r\nand also tell us what you had to do instead. The last part is helpful\r\nbecause it gives us an idea of how much harder your life is without the\r\nfeature.\r\n\r\n-->\r\nA search request will be forwarded to all independent shards, but sometimes because a certain shard query takes too long, resulting in high latency for the entire request.\r\nIf when distributing requests to specific shards, first determine the load status and gc status of the node where the shard is located, and then choose to forward the request to the shard copy on the node with low load, which will be an effective way to avoid the long tail of the query means.\r\nOf course, when the request is forwarded to the shard copy of the low-load node, the long tail of the query may also occur. We define a metric value to clearly distinguish the state of the long tail of the query under what circumstances. Assuming that a query request involves a distributed query of n shards, the time to forward the shard query is t1, and the query time after receiving `n-1` shard request results is t2. If the query time of the `nth` shard exceeds `(t2-t1)*2`, it is regarded as a long tail node. Therefore, this metric value can use `(t2-t1)*2` as the basis for judgment.\r\n\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}