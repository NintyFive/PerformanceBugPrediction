{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27014","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27014/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27014/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27014/events","html_url":"https://github.com/elastic/elasticsearch/issues/27014","id":265524297,"node_id":"MDU6SXNzdWUyNjU1MjQyOTc=","number":27014,"title":"Storing JSON array as string in elasticsearch","user":{"login":"jyotiskab","id":6498738,"node_id":"MDQ6VXNlcjY0OTg3Mzg=","avatar_url":"https://avatars1.githubusercontent.com/u/6498738?v=4","gravatar_id":"","url":"https://api.github.com/users/jyotiskab","html_url":"https://github.com/jyotiskab","followers_url":"https://api.github.com/users/jyotiskab/followers","following_url":"https://api.github.com/users/jyotiskab/following{/other_user}","gists_url":"https://api.github.com/users/jyotiskab/gists{/gist_id}","starred_url":"https://api.github.com/users/jyotiskab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jyotiskab/subscriptions","organizations_url":"https://api.github.com/users/jyotiskab/orgs","repos_url":"https://api.github.com/users/jyotiskab/repos","events_url":"https://api.github.com/users/jyotiskab/events{/privacy}","received_events_url":"https://api.github.com/users/jyotiskab/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-10-14T21:14:07Z","updated_at":"2018-12-19T04:38:42Z","closed_at":"2017-10-15T07:26:04Z","author_association":"NONE","active_lock_reason":null,"body":"I am observing some strange behavior coming out of Elasticsearch (using 5.2) and it's impossible to debug-- as there are no errors thrown nor am I able to find similar issues/documentation online. \r\n\r\nI'm storing a JSON array as a \"string\" in elasticsearch (using python's json.dumps()) -- long story short, I have to do it this way. However, when I do a DSL query, only the JSON arrays (stored as a singular string) containing 1 object are shown. If more than 1, then it just returns an empty bucket 0 objects. I'm storing them in a field called \"metadata\". \r\n\r\n\r\nI'm very confused why only a subset of the data is shown, and other data (with more than 1 object in json array) is ignored. The data is encoded as string. I know for a fact the data stored in index. I can see it in kibana \"discovery\" -- as I can see large JSON strings with multiple objects.\r\n\r\n\r\nExample 1 (JSON String w/ 1 object):\r\n\r\n    \r\n\r\n> [{\"score\": 0.8829717636108398, \"height\": 0.875460147857666, \"width\":\r\n> 0.3455989360809326, \"y\": 0.08105117082595825, \"x\": 0.5616265535354614, \"note\": \"box1\"}]\r\n\r\nExample 2:\r\n\r\n\r\n> [{\"score\": 0.8829717636108398, \"height\": 0.875460147857666, \"width\":\r\n> 0.3455989360809326, \"y\": 0.08105117082595825, \"x\": 0.5616265535354614, \"note\": \"box1\"}, {\"score\": 0.6821991136108398, \"height\":\r\n> 0.875460147857666, \"width\": 0.3455989360809326, \"y\": 0.08105117082595825, \"x\": 0.5616265535354614, \"note\": \"box2\"}]\r\n\r\nHere is my query:\r\n\r\n    {\r\n      \"query\": {\r\n        \"bool\": {\r\n          \"must\": [\r\n            {\r\n              \"query_string\": {\r\n                \"analyze_wildcard\": true,\r\n                \"query\": \"*\"\r\n              }\r\n            },\r\n            {\r\n              \"range\": {\r\n                \"created_at\": {\r\n                  \"gte\": 1508012482796,\r\n                  \"lte\": 1508014282797,\r\n                  \"format\": \"epoch_millis\"\r\n                }\r\n              }\r\n            }\r\n          ],\r\n          \"must_not\": []\r\n        }\r\n      },\r\n      \"size\": 0,\r\n      \"_source\": {\r\n        \"excludes\": []\r\n      },\r\n      \"aggs\": {\r\n        \"5\": {\r\n          \"terms\": {\r\n            \"field\": \"metadata.keyword\",\r\n            \"size\": 31,\r\n            \"order\": {\r\n              \"_count\": \"desc\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n\r\nThis query only returns strings with 1 object. See below:\r\n\r\n    {\r\n      \"took\": 4,\r\n      \"timed_out\": false,\r\n      \"_shards\": {\r\n        \"total\": 5,\r\n        \"successful\": 5,\r\n        \"failed\": 0\r\n      },\r\n      \"hits\": {\r\n        \"total\": 4214,\r\n        \"max_score\": 0,\r\n        \"hits\": []\r\n      },\r\n      \"aggregations\": {\r\n        \"5\": {\r\n          \"doc_count_error_upper_bound\": 0,\r\n          \"sum_other_doc_count\": 35,\r\n          \"buckets\": [\r\n            {\r\n              \"key\": \"[]\",\r\n              \"doc_count\": 102\r\n            },\r\n            {\r\n              \"key\": \"{}\",\r\n              \"doc_count\": 8\r\n            },\r\n            {\r\n              \"key\": \"[{\\\"score\\\": 0.9015679955482483, \\\"height\\\": 0.8632315695285797, \\\"width\\\": 0.343660831451416, \\\"y\\\": 0.08102986216545105, \\\"x\\\": 0.5559845566749573, \\\"note\\\": \\\"box11\\\"}]\",\r\n              \"doc_count\": 6\r\n            },\r\n            {\r\n              \"key\": \"[{\\\"score\\\": 0.6365205645561218, \\\"height\\\": 0.9410756528377533, \\\"width\\\": 0.97696852684021, \\\"y\\\": 0.04701271653175354, \\\"x\\\": 0.013666868209838867, \\\"note\\\": \\\"box17\\\"}]\",\r\n              \"doc_count\": 4\r\n            },\r\n    ...\r\n    }\r\n\r\nAs observed, only data with JSON strings with 1 objects (i.e. [{..}]) are returned/visible. It's completely ignoring the strings with multiple objects (i.e. [{...},{...}]).\r\n\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"jyotiskab","id":6498738,"node_id":"MDQ6VXNlcjY0OTg3Mzg=","avatar_url":"https://avatars1.githubusercontent.com/u/6498738?v=4","gravatar_id":"","url":"https://api.github.com/users/jyotiskab","html_url":"https://github.com/jyotiskab","followers_url":"https://api.github.com/users/jyotiskab/followers","following_url":"https://api.github.com/users/jyotiskab/following{/other_user}","gists_url":"https://api.github.com/users/jyotiskab/gists{/gist_id}","starred_url":"https://api.github.com/users/jyotiskab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jyotiskab/subscriptions","organizations_url":"https://api.github.com/users/jyotiskab/orgs","repos_url":"https://api.github.com/users/jyotiskab/repos","events_url":"https://api.github.com/users/jyotiskab/events{/privacy}","received_events_url":"https://api.github.com/users/jyotiskab/received_events","type":"User","site_admin":false},"performed_via_github_app":null}