[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/554269711","html_url":"https://github.com/elastic/elasticsearch/issues/49140#issuecomment-554269711","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49140","id":554269711,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDI2OTcxMQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-11-15T08:50:22Z","updated_at":"2019-11-15T08:50:22Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/554273681","html_url":"https://github.com/elastic/elasticsearch/issues/49140#issuecomment-554273681","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49140","id":554273681,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDI3MzY4MQ==","user":{"login":"przemekwitek","id":19312454,"node_id":"MDQ6VXNlcjE5MzEyNDU0","avatar_url":"https://avatars3.githubusercontent.com/u/19312454?v=4","gravatar_id":"","url":"https://api.github.com/users/przemekwitek","html_url":"https://github.com/przemekwitek","followers_url":"https://api.github.com/users/przemekwitek/followers","following_url":"https://api.github.com/users/przemekwitek/following{/other_user}","gists_url":"https://api.github.com/users/przemekwitek/gists{/gist_id}","starred_url":"https://api.github.com/users/przemekwitek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/przemekwitek/subscriptions","organizations_url":"https://api.github.com/users/przemekwitek/orgs","repos_url":"https://api.github.com/users/przemekwitek/repos","events_url":"https://api.github.com/users/przemekwitek/events{/privacy}","received_events_url":"https://api.github.com/users/przemekwitek/received_events","type":"User","site_admin":false},"created_at":"2019-11-15T09:02:27Z","updated_at":"2019-11-15T09:02:27Z","author_association":"CONTRIBUTOR","body":"Turns out that although fields like `day`, `hour`, etc. exist in the mapping, they do not exist in any document. That's why the query fails to find results.\r\n\r\nMapping:\r\n```\r\n{\r\n  \"barcelona_accidents\": {\r\n    \"mappings\": {\r\n      \"properties\": {\r\n        \"@timestamp\": {\r\n          \"type\": \"date\"\r\n        },\r\n        \"day\": {\r\n          \"type\": \"short\"\r\n        },\r\n        \"district_name\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"doc\": {\r\n          \"properties\": {\r\n            \"@timestamp\": {\r\n              \"type\": \"date\"\r\n            },\r\n            \"day\": {\r\n              \"type\": \"long\"\r\n            },\r\n            \"district_name\": {\r\n              \"type\": \"text\",\r\n              \"fields\": {\r\n                \"keyword\": {\r\n                  \"type\": \"keyword\",\r\n                  \"ignore_above\": 256\r\n                }\r\n              }\r\n            },\r\n            \"hour\": {\r\n              \"type\": \"long\"\r\n            },\r\n            \"id\": {\r\n              \"type\": \"text\",\r\n              \"fields\": {\r\n                \"keyword\": {\r\n                  \"type\": \"keyword\",\r\n                  \"ignore_above\": 256\r\n                }\r\n              }\r\n            },\r\n            \"location\": {\r\n              \"properties\": {\r\n                \"lat\": {\r\n                  \"type\": \"float\"\r\n                },\r\n                \"lon\": {\r\n                  \"type\": \"float\"\r\n                }\r\n              }\r\n            },\r\n            \"mild_injuries\": {\r\n              \"type\": \"long\"\r\n            },\r\n            \"month\": {\r\n              \"type\": \"text\",\r\n              \"fields\": {\r\n                \"keyword\": {\r\n                  \"type\": \"keyword\",\r\n                  \"ignore_above\": 256\r\n                }\r\n              }\r\n            },\r\n            \"part_of_the_day\": {\r\n              \"type\": \"text\",\r\n              \"fields\": {\r\n                \"keyword\": {\r\n                  \"type\": \"keyword\",\r\n                  \"ignore_above\": 256\r\n                }\r\n              }\r\n            },\r\n            \"serious_injuries\": {\r\n              \"type\": \"long\"\r\n            },\r\n            \"street\": {\r\n              \"type\": \"text\",\r\n              \"fields\": {\r\n                \"keyword\": {\r\n                  \"type\": \"keyword\",\r\n                  \"ignore_above\": 256\r\n                }\r\n              }\r\n            },\r\n            \"vehicles_involved\": {\r\n              \"type\": \"long\"\r\n            },\r\n            \"victims\": {\r\n              \"type\": \"long\"\r\n            },\r\n            \"weekday\": {\r\n              \"type\": \"text\",\r\n              \"fields\": {\r\n                \"keyword\": {\r\n                  \"type\": \"keyword\",\r\n                  \"ignore_above\": 256\r\n                }\r\n              }\r\n            }\r\n          }\r\n        },\r\n        \"hour\": {\r\n          \"type\": \"short\"\r\n        },\r\n        \"id\": {\r\n          \"type\": \"text\"\r\n        },\r\n        \"location\": {\r\n          \"type\": \"geo_point\"\r\n        },\r\n        \"mild_injuries\": {\r\n          \"type\": \"short\"\r\n        },\r\n        \"month\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"part_of_the_day\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"serious_injuries\": {\r\n          \"type\": \"short\"\r\n        },\r\n        \"street\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"vehicles_involved\": {\r\n          \"type\": \"short\"\r\n        },\r\n        \"victims\": {\r\n          \"type\": \"short\"\r\n        },\r\n        \"weekday\": {\r\n          \"type\": \"keyword\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nDocuments:\r\n```\r\n{\r\n  \"took\": 1,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 1,\r\n    \"successful\": 1,\r\n    \"skipped\": 0,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": {\r\n      \"value\": 10000,\r\n      \"relation\": \"gte\"\r\n    },\r\n    \"max_score\": 1,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"barcelona_accidents\",\r\n        \"_id\": \"NAawx2gBoWuqnhwrb0Ry\",\r\n        \"_score\": 1,\r\n        \"_source\": {\r\n          \"doc\": {\r\n            \"id\": \"2017S000002    \",\r\n            \"district_name\": \"Eixample\",\r\n            \"street\": \"GV CORTS CATALANES                                \",\r\n            \"weekday\": \"Sunday\",\r\n            \"month\": \"January\",\r\n            \"day\": 1,\r\n            \"hour\": 2,\r\n            \"part_of_the_day\": \"Night\",\r\n            \"mild_injuries\": 1,\r\n            \"serious_injuries\": 0,\r\n            \"victims\": 1,\r\n            \"vehicles_involved\": 2,\r\n            \"location\": {\r\n              \"lat\": 41.39968,\r\n              \"lon\": 2.1823759999999996\r\n            },\r\n            \"@timestamp\": \"2017-01-01T00:00:00\"\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/554279974","html_url":"https://github.com/elastic/elasticsearch/issues/49140#issuecomment-554279974","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49140","id":554279974,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDI3OTk3NA==","user":{"login":"przemekwitek","id":19312454,"node_id":"MDQ6VXNlcjE5MzEyNDU0","avatar_url":"https://avatars3.githubusercontent.com/u/19312454?v=4","gravatar_id":"","url":"https://api.github.com/users/przemekwitek","html_url":"https://github.com/przemekwitek","followers_url":"https://api.github.com/users/przemekwitek/followers","following_url":"https://api.github.com/users/przemekwitek/following{/other_user}","gists_url":"https://api.github.com/users/przemekwitek/gists{/gist_id}","starred_url":"https://api.github.com/users/przemekwitek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/przemekwitek/subscriptions","organizations_url":"https://api.github.com/users/przemekwitek/orgs","repos_url":"https://api.github.com/users/przemekwitek/repos","events_url":"https://api.github.com/users/przemekwitek/events{/privacy}","received_events_url":"https://api.github.com/users/przemekwitek/received_events","type":"User","site_admin":false},"created_at":"2019-11-15T09:20:19Z","updated_at":"2019-11-15T09:22:35Z","author_association":"CONTRIBUTOR","body":"After talking to @dimitris-athanasiou, we agreed that the data extractor behavior is correct, i.e. the extractor should require all the analysable fields to exist for the outlier detection analysis (which does not support missing values).\r\n\r\nSo in order to run the analysis correctly the user should exclude the missing fields explicitly from their analysis using:\r\n```\r\n{\r\n  ...\r\n  \"analyzed_fields\": {\r\n    \"excludes\": [ \"day\", \"hour\", \"mild_injuries\", \"serious_injuries\", \"vehicles_involved\", \"victims\" ]\r\n  },\r\n  ...\r\n}\r\n```\r\n\r\nIn order to improve the UX, the memory estimation endpoint should throw early if it sees no analysable data so that the user is not confused that they receive \"0\" estimation.","performed_via_github_app":null}]