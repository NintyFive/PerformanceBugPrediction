{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18882","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18882/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18882/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18882/events","html_url":"https://github.com/elastic/elasticsearch/issues/18882","id":160358234,"node_id":"MDU6SXNzdWUxNjAzNTgyMzQ=","number":18882,"title":"Duplicate Data  problem ","user":{"login":"Git-Rajkumar","id":16772146,"node_id":"MDQ6VXNlcjE2NzcyMTQ2","avatar_url":"https://avatars3.githubusercontent.com/u/16772146?v=4","gravatar_id":"","url":"https://api.github.com/users/Git-Rajkumar","html_url":"https://github.com/Git-Rajkumar","followers_url":"https://api.github.com/users/Git-Rajkumar/followers","following_url":"https://api.github.com/users/Git-Rajkumar/following{/other_user}","gists_url":"https://api.github.com/users/Git-Rajkumar/gists{/gist_id}","starred_url":"https://api.github.com/users/Git-Rajkumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Git-Rajkumar/subscriptions","organizations_url":"https://api.github.com/users/Git-Rajkumar/orgs","repos_url":"https://api.github.com/users/Git-Rajkumar/repos","events_url":"https://api.github.com/users/Git-Rajkumar/events{/privacy}","received_events_url":"https://api.github.com/users/Git-Rajkumar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-06-15T07:44:53Z","updated_at":"2016-06-15T07:53:00Z","closed_at":"2016-06-15T07:53:00Z","author_association":"NONE","active_lock_reason":null,"body":"I have problem to push mysql data to elasticsearch using mysql replicator. \n\n I have two table for chat__user and chat_message.\n\nchat_user:\n\n```\n   id    name  socketid\n\n   1     raj    123\n   2     kumar   1234\n```\n\nchat_message:\n\n```\n  id   chat_from  chat_to  message\n\n   1      123     1235       hello\n   2      1235    123        how can i help you? \n   3      123     1235       HOw track my order?\n```\n\n then, John this two tables Using  \"chat_message.chat_from = chat_user.socketid OR chat_message.chat_to = chat_user.socketid\"\n\n  Myquery:\n\n```\n    SELECT * FROM `chat_message` INNER JOIN `chat_user` ON chat_message.chat_from = chat_user.socketid OR chat_message.chat_to = chat_user.socketid\n```\n\nResult:\n\n```\nchat_from  chat_to  message                    id   name  socketid \n\n123        1235     hello                      1    raj    123 \n1235        123        how can i help you?     1    raj    123 \n123        1235     HOw track my order?        1    raj    123 \n```\n\nIf I push this data to elasticsearch, only push last row data.\n\n```\n 123        1235     HOw track my order?        1    raj    123 \n```\n\nBecause Duplication occur in primary key  I set primary key chat_user id is a primary key in td-agent configuration file. \n\nTd-Agent Configuration File:\n\n```\n    ####\n  ## Output descriptions:\n  ##\n  # HTTP input\n  # POST http://localhost:8888/<tag>?json=<json>\n  # POST http://localhost:8888/td.myapp.login?json={\"user\"%3A\"me\"}\n  # @see http://docs.fluentd.org/articles/in_http\n  <source>\n    @type http\n    port 8888\n  </source>\n\n  ## live debugging agent\n  <source>\n    @type debug_agent\n    bind localhost\n    port 24230\n  </source>\n\n  ####\n  ## Examples:\n  ##\n\n\n  <source>\n    @type mysql_replicator\n    host localhost\n    username root\n    password gworks.mobi2\n    database livechat\n    query SELECT * FROM `chat_message` INNER JOIN `chat_user` ON chat_message.chat_from = chat_user.socketid OR chat_message.chat_to = chat_user.socketid;\n    primary_key id \n    interval 10s  \n    enable_delete yes\n    tag replicator.history5.histestb.${event}.${primary_key}\n  </source>\n  <match replicator.**>\n   @type stdout\n  </match>\n\n  <match replicator.**>\n    @type mysql_replicator_elasticsearch\n    host localhost\n    port 9200\n    tag_format (?<index_name>[^\\.]+)\\.(?<type_name>[^\\.]+)\\.(?<event>[^\\.]+)\\.(?<primary_key>[^\\.]+)$\n    flush_interval 5s\n    max_retry_wait 1800\n    flush_at_shutdown yes \n    buffer_type file\n    buffer_path /var/log/td-agent/buffer/mysql_replicator_elasticsearch.*\n  </match>\n```\n\nI need to push all  data to elasticsearch, Suggest me  How to solve this Problem? .\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}