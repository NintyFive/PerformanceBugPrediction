[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/45336627","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-45336627","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":45336627,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzM2NjI3","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2014-06-06T13:33:19Z","updated_at":"2014-06-06T13:33:19Z","author_association":"CONTRIBUTOR","body":"@brwe, we talked about this with regards to hand rolled scoring a few weeks ago.  I just encountered a use for it myself with costly (to set up) script filters.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/45793119","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-45793119","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":45793119,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NzkzMTE5","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2014-06-11T20:11:40Z","updated_at":"2014-06-11T20:11:40Z","author_association":"CONTRIBUTOR","body":"So it turns out that, at  least in MVEL, scripts do have a cache they can work with.  This is me using it to cache a compiled regex that I want to run against the source:\n\n``` js\n         \"filter\": {\n            \"script\": {\n               \"script\": \"import org.apache.lucene.util.automaton.*;source_text = _source.get(\\\"source_text\\\");if (source_text == null) {false} else {if (automaton == null) {automaton = new CharacterRunAutomaton(new RegExp(pattern).toAutomaton());}automaton.run(source_text)}\",\n               \"params\": {\n                  \"pattern\": \".*(catapult).*\",\n                  \"automaton\": null      <--------- This creates a _writable_ slot \n               }\n            }\n         }\n```\n\nIts not fast because I'm loading source everywhere.  But it is 10x faster then compiling the regex on every script execution.\n\n@dakrone, would a horrible hack like this survive the groovy switch?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/47325658","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-47325658","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":47325658,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzI1NjU4","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2014-06-27T09:44:27Z","updated_at":"2014-06-27T09:44:27Z","author_association":"MEMBER","body":"@nik9000 just want you to know I've seen this, once we've hammered out some of the initial Groovy issues I'll do some testing with this to see whether it is possible/feasible.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52772393","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-52772393","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":52772393,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzcyMzkz","user":{"login":"alexsv","id":383632,"node_id":"MDQ6VXNlcjM4MzYzMg==","avatar_url":"https://avatars3.githubusercontent.com/u/383632?v=4","gravatar_id":"","url":"https://api.github.com/users/alexsv","html_url":"https://github.com/alexsv","followers_url":"https://api.github.com/users/alexsv/followers","following_url":"https://api.github.com/users/alexsv/following{/other_user}","gists_url":"https://api.github.com/users/alexsv/gists{/gist_id}","starred_url":"https://api.github.com/users/alexsv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexsv/subscriptions","organizations_url":"https://api.github.com/users/alexsv/orgs","repos_url":"https://api.github.com/users/alexsv/repos","events_url":"https://api.github.com/users/alexsv/events{/privacy}","received_events_url":"https://api.github.com/users/alexsv/received_events","type":"User","site_admin":false},"created_at":"2014-08-20T12:47:15Z","updated_at":"2014-08-20T12:47:15Z","author_association":"NONE","body":"Currently I'm solving some groovy issue - it's good to provide some sort of 'initialization' of the script, for example the place to put class definition, import, object creation and in 'script' only call this object method. This could solve many problems. Also It's good to support _scripts index as well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61154121","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-61154121","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":61154121,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMTU0MTIx","user":{"login":"shadow000fire","id":1693492,"node_id":"MDQ6VXNlcjE2OTM0OTI=","avatar_url":"https://avatars3.githubusercontent.com/u/1693492?v=4","gravatar_id":"","url":"https://api.github.com/users/shadow000fire","html_url":"https://github.com/shadow000fire","followers_url":"https://api.github.com/users/shadow000fire/followers","following_url":"https://api.github.com/users/shadow000fire/following{/other_user}","gists_url":"https://api.github.com/users/shadow000fire/gists{/gist_id}","starred_url":"https://api.github.com/users/shadow000fire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shadow000fire/subscriptions","organizations_url":"https://api.github.com/users/shadow000fire/orgs","repos_url":"https://api.github.com/users/shadow000fire/repos","events_url":"https://api.github.com/users/shadow000fire/events{/privacy}","received_events_url":"https://api.github.com/users/shadow000fire/received_events","type":"User","site_admin":false},"created_at":"2014-10-30T19:19:37Z","updated_at":"2014-10-30T19:19:37Z","author_association":"CONTRIBUTOR","body":"Would this be specific to non-Java scripts a guess? I assume a native script could simple keep a static variable that would serve the purpose of existing across executions.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83718299","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-83718299","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":83718299,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNzE4Mjk5","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-03-19T18:58:09Z","updated_at":"2015-03-19T18:58:09Z","author_association":"MEMBER","body":"@dakrone did you make any progress on this? I am curious on what you had in mind, and whether it is still doable or not.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83720641","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-83720641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":83720641,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNzIwNjQx","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-03-19T19:09:42Z","updated_at":"2015-03-19T19:09:42Z","author_association":"CONTRIBUTOR","body":"@shadow000fire, a static variable would work pretty poorly given that it could be run on multiple requests across multiple threads.  A ThreadLocal would have leakage issues, I think.  OTOH a native script might just be able to use a class variable - I haven't checked but I imagine the class is built once per request.  There _should_ be something for native scripts though.\n\n@javanna, the writable slot trick in groovy _works_ but its a little bit horrible.  I imagine expression language wouldn't be able to do things like assign variables.....\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83769145","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-83769145","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":83769145,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNzY5MTQ1","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2015-03-19T21:37:45Z","updated_at":"2015-03-19T21:37:45Z","author_association":"MEMBER","body":"@javanna I haven't made any progress on this yet, feel free to grab it :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83945872","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-83945872","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":83945872,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTQ1ODcy","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-03-20T08:04:25Z","updated_at":"2015-03-20T08:04:25Z","author_association":"MEMBER","body":"I marked this for discussion, I am personally not sure we should support something like this, it sounds scary, but maybe it's just me. Also, if we do we need to find a way to make it work for all of the different engines.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/84053640","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-84053640","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":84053640,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MDUzNjQw","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-03-20T15:49:45Z","updated_at":"2015-03-20T15:49:45Z","author_association":"CONTRIBUTOR","body":"> I marked this for discussion, I am personally not sure we should support something like this, it sounds scary, but maybe it's just me.\n> I suppose it'd give you some way to consume a ton of memory.  I was just using it for holding precocmpiled automata.  It only had to work across a single request.  Its the same sort of attack vector as creating a huge collection in groovy in a while true loop.\n> \n> Also, if we do we need to find a way to make it work for all of the different engines.\n> Maybe its only a feature in one.  I dunno.  We're probably going to abandon scripts pretty soon, especially if we can get fast rolling restarts from index sealing.  In that case it doesn't make a huge difference for me.\n\nThis, btw, is why I stopped submitting patches for the builtin highlighters - it because a huge pain to implement everything three times with three different mindsets.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/84053876","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-84053876","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":84053876,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MDUzODc2","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-03-20T15:50:58Z","updated_at":"2015-03-20T15:50:58Z","author_association":"CONTRIBUTOR","body":"> This, btw, is why I stopped submitting patches for the builtin highlighters - it because a huge pain to implement everything three times with three different mindsets.\n\nyou really read my mind... the highlighter situation is a nightmare and we have to fix this one way or the other!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158640935","html_url":"https://github.com/elastic/elasticsearch/issues/6428#issuecomment-158640935","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6428","id":158640935,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODY0MDkzNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-21T13:32:28Z","updated_at":"2015-11-21T13:32:28Z","author_association":"CONTRIBUTOR","body":"This is too risky to expose with generic script engines.  If you want a cache in scripts then I think a native script is the only way to go here.\n","performed_via_github_app":null}]