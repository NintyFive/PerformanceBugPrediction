[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/288049683","html_url":"https://github.com/elastic/elasticsearch/issues/23557#issuecomment-288049683","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23557","id":288049683,"node_id":"MDEyOklzc3VlQ29tbWVudDI4ODA0OTY4Mw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-03-21T11:23:41Z","updated_at":"2017-03-21T11:23:41Z","author_association":"MEMBER","body":"Hi @jjbursik ,\r\nthe indices options api can definitely be improved, especially how it is exposed in our Java API.\r\n\r\nThat said, your REST call doesn't doesn't provide any indices options after all. The right separator between the different arguments is `&` and not `,`. You end up passing in a huge string (`ignore_unavailable=true,allow_no_indices=true,expand_wildcards_open=true,expand_wildcards_closed=false,allow_alisases_to_multiple_indices=true,forbid_closed_indices=false`) for the `ignore_unavailable` option, which gets ignored  as it is not  a boolean value (this will cause an error in 6.0, see #22200). \r\n\r\nThe only valid arguments in your REST call are `pretty&search_type=dfs_query_then_fetch`. That has the same effect as not passing in any indices options, hence using the default indices options for `SearchRequest` : `IndicesOptions#strictExpandOpenAndForbidClosed`. The forbid closed is the important part here, which is an internal flag that defines whether closed indices are to be treated as unavailable or not (varies api by api). This bit is implicitly set to false in `IndicesOptions#lenientExpandOpen` which causes the error you are seeing. You could create lenient indices options with forbid closed set to true this way: `IndicesOption.fromOptions(true, true, true, false, IndicesOption.strictExpandOpenAndForbidClosed)`.\r\n\r\nYour REST call though should return an error when performed against a closed index, or an alias that points to at least one closed index, something like this:\r\n\r\n```\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"index_closed_exception\",\r\n        \"reason\" : \"closed\",\r\n        \"index_uuid\" : \"hcUaFRjURxO6Yu6RvqY63g\",\r\n        \"index\" : \"test2\"\r\n      }\r\n    ],\r\n    \"type\" : \"index_closed_exception\",\r\n    \"reason\" : \"closed\",\r\n    \"index_uuid\" : \"hcUaFRjURxO6Yu6RvqY63g\",\r\n    \"index\" : \"test2\"\r\n  },\r\n  \"status\" : 403\r\n}\r\n```\r\n\r\nAlso, when you say that you didn't expect to have to use the wildcard in your index name, that is correct. Do keep in mind though that one thing is expanding wildcard expressions, controlled via `expand_wildcards` option, and another thing is ignoring unavailable indices when provided explicitly, controlled via `ignore_unavailable`.\r\n\r\nConclusion:\r\n1) check your REST call, it should return an error as a closed index is being hit and indices options are not lenient. \r\n2) Provide `ignore_unavailable=true` to the REST call with explicit index names to make it lenient, meaning that closed indices will not be hit.\r\n3) Update your Java api code to do the same by initializing indices options this way: `IndicesOption.fromOptions(true, true, true, false, IndicesOption.strictExpandOpenAndForbidClosed)`\r\n","performed_via_github_app":null}]