{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8858","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8858/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8858/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8858/events","html_url":"https://github.com/elastic/elasticsearch/issues/8858","id":51485968,"node_id":"MDU6SXNzdWU1MTQ4NTk2OA==","number":8858,"title":"ngram tokenizer + fvh highlighter + copy_to = Failed to highlight field","user":{"login":"kbolay","id":2110384,"node_id":"MDQ6VXNlcjIxMTAzODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/2110384?v=4","gravatar_id":"","url":"https://api.github.com/users/kbolay","html_url":"https://github.com/kbolay","followers_url":"https://api.github.com/users/kbolay/followers","following_url":"https://api.github.com/users/kbolay/following{/other_user}","gists_url":"https://api.github.com/users/kbolay/gists{/gist_id}","starred_url":"https://api.github.com/users/kbolay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbolay/subscriptions","organizations_url":"https://api.github.com/users/kbolay/orgs","repos_url":"https://api.github.com/users/kbolay/repos","events_url":"https://api.github.com/users/kbolay/events{/privacy}","received_events_url":"https://api.github.com/users/kbolay/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-12-09T21:44:48Z","updated_at":"2016-11-24T19:18:02Z","closed_at":"2016-11-24T19:18:02Z","author_association":"NONE","active_lock_reason":null,"body":"Create the index.\nPOST http://localhost:9200/highlight_test/\n\n``` json\n{\n  \"settings\":{\n    \"index\":{\n      \"number_of_shards\":1,\n      \"number_of_replicas\":0\n    },\n    \"analysis\":{\n      \"tokenizer\":{\n        \"ngram_1_to_3_tokenizer\":{\n          \"type\":\"nGram\",\n          \"min_gram\":\"1\",\n          \"max_gram\":\"3\",\n          \"token_chars\":[\n            \"letter\",\n            \"digit\",\n            \"punctuation\",\n            \"symbol\"\n          ]\n        }\n      },\n      \"analyzer\":{\n        \"contains_analyzer\":{\n          \"tokenizer\":\"ngram_1_to_3_tokenizer\",\n          \"filter\":[\n            \"lowercase\"\n          ]\n        }\n      }\n    }\n  },\n  \"mappings\":{\n    \"entry\":{\n      \"properties\":{\n        \"name\":{\n          \"type\":\"string\",\n          \"analyzer\":\"contains_analyzer\",\n          \"term_vector\":\"with_positions_offsets\"\n        },\n        \"alt_name\":{\n      \"type\":\"string\",\n       \"copy_to\":\"name\"\n    }\n      }\n    }\n  }\n}\n```\n\nAdd a simple document\nPOST http://localhost:9200/highlight_test/entry/\n\n``` json\n{\n \"name\":\"test name\",\n \"alt_name\":\"alt test name\"\n}\n```\n\nSearch w/ highlighting\nPOST http://localhost:9200/highlight_test/entry/_search\n\n``` json\n{\n  \"size\":10,\n  \"query\":{\n    \"match\":{\n      \"name\":\"t\"\n    }\n  },\n  \"highlight\":{\n    \"fields\":{\n      \"name\":{}\n    }\n  }\n}\n```\n\nResults in \n\n``` json\n{\n    \"error\": \"SearchPhaseExecutionException[Failed to execute phase [query_fetch], all shards failed; shardFailures {[C1yh6a_YROawOvZYd2QVNw][highlight_test][0]: FetchPhaseExecutionException[[highlight_test][0]: query[filtered(name:t)->cache(_type:entry)],from[0],size[10]: Fetch Failed [Failed to highlight field [name]]]; nested: StringIndexOutOfBoundsException[String index out of range: 12]; }]\",\n    \"status\": 500\n}\n```\n\nIt makes sense to me that the \"alt_name\" field value may not be highlighter friendly, since the value probably comes from the _source document. If this is the intended functionality please add this information to the highlight documentation.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}