{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/56497","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56497/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56497/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56497/events","html_url":"https://github.com/elastic/elasticsearch/issues/56497","id":615624234,"node_id":"MDU6SXNzdWU2MTU2MjQyMzQ=","number":56497,"title":"Different behaviors but both look buggy for docs.deleted in 6.8 and 7.6","user":{"login":"kunisen","id":30574753,"node_id":"MDQ6VXNlcjMwNTc0NzUz","avatar_url":"https://avatars2.githubusercontent.com/u/30574753?v=4","gravatar_id":"","url":"https://api.github.com/users/kunisen","html_url":"https://github.com/kunisen","followers_url":"https://api.github.com/users/kunisen/followers","following_url":"https://api.github.com/users/kunisen/following{/other_user}","gists_url":"https://api.github.com/users/kunisen/gists{/gist_id}","starred_url":"https://api.github.com/users/kunisen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kunisen/subscriptions","organizations_url":"https://api.github.com/users/kunisen/orgs","repos_url":"https://api.github.com/users/kunisen/repos","events_url":"https://api.github.com/users/kunisen/events{/privacy}","received_events_url":"https://api.github.com/users/kunisen/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"},{"id":1967497573,"node_id":"MDU6TGFiZWwxOTY3NDk3NTcz","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Docs","name":"Team:Docs","color":"fef2c0","default":false,"description":"Meta label for docs team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2020-05-11T06:28:17Z","updated_at":"2020-05-13T14:07:16Z","closed_at":"2020-05-13T14:07:16Z","author_association":"NONE","active_lock_reason":null,"body":"I found ES 6.7/6.8 and ES 7.6 behave differently for `docs.deleted` counter.\r\nBut both look not correct or at least not easy to understand the logic\r\n\r\n## ES 6.7 & 6.8\r\n\r\n### Expected result\r\n\r\nWhen performing `DELETE <index>/_doc/<doc_id>`, `docs.deleted` should increase 1.\r\n\r\n### Symptom (Actual result)\r\n\r\n`docs.deleted` shows 0 when deleting the document. (Clear up immediately)\r\n\r\n### Repro Steps\r\n\r\n```\r\n# create index and put docs\r\nDELETE my_test\r\nPUT my_test\r\n{\"settings\":{\"number_of_replicas\":0,\"number_of_shards\":1}}\r\n\r\nPUT my_test/_doc/1\r\n{\"title\":\"aaa\"}\r\n\r\nPUT my_test/_doc/2\r\n{\"title\":\"bbb\"}\r\n\r\n# delete\r\nDELETE my_test/_doc/1\r\n\r\n# check docs.deleted\r\nGET _cat/indices?v&index=my_test&h=index,health,status,docs.deleted\r\n\r\n# response\r\nindex   health status docs.deleted\r\nmy_test green  open              0\r\n\r\n```\r\n\r\n## ES 7.6\r\n\r\n### Expected result\r\n\r\nWhen performing `DELETE <index>/_doc/<doc_id>`, `docs.deleted` should increase 1.\r\n\r\n### Symptom (Actual result)\r\n\r\n`docs.deleted` shows 2 when deleting a single document. (Increased wrongly.)\r\n\r\n### Repro Steps\r\n\r\n```\r\n# create index and put docs\r\nDELETE my_test\r\nPUT my_test\r\n{\"settings\":{\"number_of_replicas\":0,\"number_of_shards\":1}}\r\n\r\nPUT my_test/_doc/1\r\n{\"title\":\"aaa\"}\r\n\r\nPUT my_test/_doc/2\r\n{\"title\":\"bbb\"}\r\n\r\n# delete\r\nDELETE my_test/_doc/1\r\n\r\n# check docs.deleted\r\nGET _cat/indices?v&index=my_test&h=index,health,status,docs.deleted\r\n\r\n# response\r\nindex   health status docs.deleted\r\nmy_test green  open              2\r\n```\r\n\r\n## Side notes\r\n\r\n- In 7.6, doc update will make `docs.deleted` increase 1, which is the correct and expected behavior (As the document is deleted and indexed again internally, even for partial update.)\r\n\r\n- But in 6.7/6.8, doc update doesn't trigger a `docs.deleted` increment, which appears to be another bug...\r\n\r\n\r\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}