[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/230802906","html_url":"https://github.com/elastic/elasticsearch/issues/19286#issuecomment-230802906","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19286","id":230802906,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMDgwMjkwNg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2016-07-06T15:11:29Z","updated_at":"2016-07-06T15:11:29Z","author_association":"CONTRIBUTOR","body":"Elasticsearch does not provide exactly-once delivery guarantees. If you want to avoid duplicates you can provide an explicit document id, for example:\n\n```\ncurl -XPOST 'localhost:9200/_bulk' -d '\n           {\"index\":{\"_index\" : \"index1\", \"_type\": \"test\", \"_id\" : \"1\"}}\n           {\"counter\": \"1\", \"package\": \"1/1000\"}\n           {\"index\":{\"_index\" : \"index1\", \"_type\": \"test\", \"_id\" : \"2\"}}\n           {\"counter\": \"2\", \"package\": \"1/1000\"}\n           ...\n           {\"index\":{\"_index\" : \"index1\", \"_type\": \"test\", \"_id\" : \"3\"}}\n           {\"counter\": \"100\", \"package\": \"1/1000\"}\n'\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/230809118","html_url":"https://github.com/elastic/elasticsearch/issues/19286#issuecomment-230809118","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19286","id":230809118,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMDgwOTExOA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-07-06T15:32:07Z","updated_at":"2016-07-06T15:32:07Z","author_association":"MEMBER","body":"> Elasticsearch does not provide exactly-once delivery guarantees.\n\nI get what Yannick means, but I'm not sure this statement is 100% clear.  The problem is more that the API you are using is built for a one off usage. The main reason is that those documents do not have an id, which means ES will auto generate a unique one. , When you send twice, ES has no way of know that they are really the same documents and it will generate a new id for those.\n\nIf you need these kind of things you should generate your own ids (see http://blog.mikemccandless.com/2014/05/choosing-fast-unique-identifier-uuid.html ) and use those in your requests. Another alternative, is to use the Ids ES returns in the response for bulks for the retries. Of course, this means you need to actually get the response and store that information.\n","performed_via_github_app":null}]