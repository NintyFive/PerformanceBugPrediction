{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45427","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45427/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45427/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45427/events","html_url":"https://github.com/elastic/elasticsearch/issues/45427","id":479384261,"node_id":"MDU6SXNzdWU0NzkzODQyNjE=","number":45427,"title":"OutOfMemory with high Index Writer Memory Usage","user":{"login":"Elias481","id":38512369,"node_id":"MDQ6VXNlcjM4NTEyMzY5","avatar_url":"https://avatars2.githubusercontent.com/u/38512369?v=4","gravatar_id":"","url":"https://api.github.com/users/Elias481","html_url":"https://github.com/Elias481","followers_url":"https://api.github.com/users/Elias481/followers","following_url":"https://api.github.com/users/Elias481/following{/other_user}","gists_url":"https://api.github.com/users/Elias481/gists{/gist_id}","starred_url":"https://api.github.com/users/Elias481/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Elias481/subscriptions","organizations_url":"https://api.github.com/users/Elias481/orgs","repos_url":"https://api.github.com/users/Elias481/repos","events_url":"https://api.github.com/users/Elias481/events{/privacy}","received_events_url":"https://api.github.com/users/Elias481/received_events","type":"User","site_admin":false},"labels":[{"id":146854632,"node_id":"MDU6TGFiZWwxNDY4NTQ2MzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Network","name":":Distributed/Network","color":"0e8a16","default":false,"description":"Http and internode communication implementations"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-08-11T15:58:27Z","updated_at":"2019-08-11T19:49:06Z","closed_at":"2019-08-11T19:36:12Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.3.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): e.g. 11.0.1+13\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nAfter some time of indexing (no other load on the single-node cluster) using bulk-api, the index writer memory usage raises straight up and an OOM happens.\r\nThe Heap is not really big as elasticsearch is used as backend for an application with not too much data. But I assume there wouldn't be a problem if the index writer memory would stick at around 200MB out of the 2GB and not raise towards 1GB at some point in time.\r\nWhat does the metric index_writer_memory_in_bytes mean and how to limit this particular region or calculate the max. needed bytes for this area to avoid crashes?\r\nAlso: why is the circuit breaker not accounting for this huge portion of heap memory? (We currently need to let the circuit breaker run in `use_real_memory: false` mode as it looks it counts uncollected garbage as used memory which shouldn't cause requests to fail but trigger a stop-the-world full-gc before to free some memory, so I cannot say whether circuit breaker would help agains OOM in these cases shich could be the case...)\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Start ES\r\n 2. Start bulk-indexing some documents in small chunks\r\n 3. Wait some time till OOM cause ES to stop\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}