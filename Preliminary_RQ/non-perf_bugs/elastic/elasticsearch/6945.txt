{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6945","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6945/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6945/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6945/events","html_url":"https://github.com/elastic/elasticsearch/issues/6945","id":38313824,"node_id":"MDU6SXNzdWUzODMxMzgyNA==","number":6945,"title":"Use Lucene's IDVersionPostingsFormat for _uid field","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-07-21T15:27:38Z","updated_at":"2015-11-21T16:58:15Z","closed_at":"2015-11-21T16:37:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Lucene's new ID+version optimized postings format (https://issues.apache.org/jira/browse/LUCENE-5675 ) should work well for the _uid field.\n\nFirst, it stores the version with each _uid value directly in the terms index/dict, so we don't need a separate numeric DV lookup (saves one seek & some CPU).\n\nSecond, in certain cases it can know just by looking at the in-RAM terms index that a given segment does not contain and ID with a version > X, which can speed up the optimistic concurrency case (\"update doc as long as indexed version is <= N).  But taking advantage of this is tricky because ES lets the app pick its version semantics, so I think for this issue we should simply focus on switching to IDVPF and storing/retrieving the version in the terms dict instead of numeric DV.\n\nThis issue should also fix tests to randomize whether this PF is used for _uid.\n\nWe need to be careful w/ back-compat here as well, because this PF has no back-compat insurance from Lucene (it's not a core PF), and we also must recognize and read \"old\" segments that stored the version in numeric DV, on a segment by segment basis.\n","closed_by":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"performed_via_github_app":null}