{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19224","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19224/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19224/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19224/events","html_url":"https://github.com/elastic/elasticsearch/issues/19224","id":163481640,"node_id":"MDU6SXNzdWUxNjM0ODE2NDA=","number":19224,"title":"Open file descriptors go up after increasing index.merge.policy.max_merged_segment","user":{"login":"mkelkarbv","id":8582461,"node_id":"MDQ6VXNlcjg1ODI0NjE=","avatar_url":"https://avatars1.githubusercontent.com/u/8582461?v=4","gravatar_id":"","url":"https://api.github.com/users/mkelkarbv","html_url":"https://github.com/mkelkarbv","followers_url":"https://api.github.com/users/mkelkarbv/followers","following_url":"https://api.github.com/users/mkelkarbv/following{/other_user}","gists_url":"https://api.github.com/users/mkelkarbv/gists{/gist_id}","starred_url":"https://api.github.com/users/mkelkarbv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkelkarbv/subscriptions","organizations_url":"https://api.github.com/users/mkelkarbv/orgs","repos_url":"https://api.github.com/users/mkelkarbv/repos","events_url":"https://api.github.com/users/mkelkarbv/events{/privacy}","received_events_url":"https://api.github.com/users/mkelkarbv/received_events","type":"User","site_admin":false},"labels":[{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2016-07-01T22:04:06Z","updated_at":"2018-02-13T20:35:36Z","closed_at":"2017-05-17T09:14:51Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 1.7.3\n\n**JVM version**: openjdk version \"1.8.0_65\"\nOpenJDK Runtime Environment (build 1.8.0_65-b17)\nOpenJDK 64-Bit Server VM (build 25.65-b01, mixed mode)\n\n**OS version**: Amazon linux 3.14.35-28.38.amzn1.x86_64\n\n**Description of the problem including expected versus actual behavior**:\nWe have multi gigabyte indices in our cluster, and we started noticing degraded performance over time ( our response times degraded by 20ms-40ms each month ). \n\nIn many of these indices, several segments had about 3gb of data, and percentage of deleted documents was about 1%-2%. I thought the default max size limit of 5gb was possibly getting in the way of merging those segments, so I decided to increase it up to 15G, expecting ES to merge more and decrease segments. But when I increased the max size to 15gb, open file descriptor usage climbed up from 3.4k range to 3.8k-4k range, and degraded our response times. No new merges happened as a result of this change.\n\nWhen the limit was set back to 2G, merges started happening and open file descriptor usage dropped. Further decreasing the limit to 1G had the same effect. \n\n**Steps to reproduce**:\n1. increase  index.merge.policy.max_merged_segment to 15G. \n2. watch how file descriptor usage goes up...\n\n**Provide logs (if relevant)**:   I could not find anything in the logs to explain the behavior.\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}