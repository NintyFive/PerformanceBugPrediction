[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/215508527","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-215508527","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":215508527,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNTUwODUyNw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-28T17:49:27Z","updated_at":"2016-04-28T17:49:27Z","author_association":"CONTRIBUTOR","body":"Sorry @manioc2015 but there's just too much noise here for me to follow what's happening.  Could you reduce your recreation to something simple, and point out exactly what problem I should look for?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/215944199","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-215944199","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":215944199,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNTk0NDE5OQ==","user":{"login":"manioc2015","id":10515438,"node_id":"MDQ6VXNlcjEwNTE1NDM4","avatar_url":"https://avatars0.githubusercontent.com/u/10515438?v=4","gravatar_id":"","url":"https://api.github.com/users/manioc2015","html_url":"https://github.com/manioc2015","followers_url":"https://api.github.com/users/manioc2015/followers","following_url":"https://api.github.com/users/manioc2015/following{/other_user}","gists_url":"https://api.github.com/users/manioc2015/gists{/gist_id}","starred_url":"https://api.github.com/users/manioc2015/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/manioc2015/subscriptions","organizations_url":"https://api.github.com/users/manioc2015/orgs","repos_url":"https://api.github.com/users/manioc2015/repos","events_url":"https://api.github.com/users/manioc2015/events{/privacy}","received_events_url":"https://api.github.com/users/manioc2015/received_events","type":"User","site_admin":false},"created_at":"2016-04-30T07:31:29Z","updated_at":"2016-04-30T07:31:29Z","author_association":"NONE","body":"OK I reduced the amount of data in my example. As you can see, each aggregation of each drilldown has the same exact value of \"300.1\" this is incorrect. It should be bound to the breakdown of each bucket within each sub-aggregation.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216200377","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-216200377","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":216200377,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjIwMDM3Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-02T10:59:52Z","updated_at":"2016-05-02T10:59:52Z","author_association":"CONTRIBUTOR","body":"When you \"step-up\" to the parent document with `reverse_nested`, you lose the context of the nested document that you were in, so the `lineItems.totalPrice` refers to all nested documents.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216335058","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-216335058","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":216335058,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjMzNTA1OA==","user":{"login":"manioc2015","id":10515438,"node_id":"MDQ6VXNlcjEwNTE1NDM4","avatar_url":"https://avatars0.githubusercontent.com/u/10515438?v=4","gravatar_id":"","url":"https://api.github.com/users/manioc2015","html_url":"https://github.com/manioc2015","followers_url":"https://api.github.com/users/manioc2015/followers","following_url":"https://api.github.com/users/manioc2015/following{/other_user}","gists_url":"https://api.github.com/users/manioc2015/gists{/gist_id}","starred_url":"https://api.github.com/users/manioc2015/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/manioc2015/subscriptions","organizations_url":"https://api.github.com/users/manioc2015/orgs","repos_url":"https://api.github.com/users/manioc2015/repos","events_url":"https://api.github.com/users/manioc2015/events{/privacy}","received_events_url":"https://api.github.com/users/manioc2015/received_events","type":"User","site_admin":false},"created_at":"2016-05-02T19:21:57Z","updated_at":"2016-05-02T19:21:57Z","author_association":"NONE","body":"@clintongormley can you confirm that once we \"step up\" to the parent document, we can't step \"back down\"? This is what I need to accomplish.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216482358","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-216482358","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":216482358,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjQ4MjM1OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-03T09:47:07Z","updated_at":"2016-05-03T09:47:07Z","author_association":"CONTRIBUTOR","body":"@manioc2015 you can't step down to the same nested doc without adding the same filtering that you used originally\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216483123","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-216483123","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":216483123,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjQ4MzEyMw==","user":{"login":"manioc2015","id":10515438,"node_id":"MDQ6VXNlcjEwNTE1NDM4","avatar_url":"https://avatars0.githubusercontent.com/u/10515438?v=4","gravatar_id":"","url":"https://api.github.com/users/manioc2015","html_url":"https://github.com/manioc2015","followers_url":"https://api.github.com/users/manioc2015/followers","following_url":"https://api.github.com/users/manioc2015/following{/other_user}","gists_url":"https://api.github.com/users/manioc2015/gists{/gist_id}","starred_url":"https://api.github.com/users/manioc2015/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/manioc2015/subscriptions","organizations_url":"https://api.github.com/users/manioc2015/orgs","repos_url":"https://api.github.com/users/manioc2015/repos","events_url":"https://api.github.com/users/manioc2015/events{/privacy}","received_events_url":"https://api.github.com/users/manioc2015/received_events","type":"User","site_admin":false},"created_at":"2016-05-03T09:51:20Z","updated_at":"2016-05-03T09:51:20Z","author_association":"NONE","body":"@clintongormley that's my point. I did step back down into the same nested doc.\n\n```\n                                                \"aggs\": {\n                                                    \"totalLineItems\": {\n                                                        \"aggs\": {\n                                                            \"totalLineItems\": {\n                                                                \"sum\": {\n                                                                    \"field\": \"lineItems.totalPrice\"\n                                                                }\n                                                            }\n                                                        },\n                                                        \"nested\": {\n                                                            \"path\": \"lineItems\"\n                                                        }\n                                                    }\n                                                }\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216484487","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-216484487","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":216484487,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjQ4NDQ4Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-03T09:58:12Z","updated_at":"2016-05-03T09:58:12Z","author_association":"CONTRIBUTOR","body":"No @manioc2015 - as soon as you step up, you lose context\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216485365","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-216485365","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":216485365,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjQ4NTM2NQ==","user":{"login":"manioc2015","id":10515438,"node_id":"MDQ6VXNlcjEwNTE1NDM4","avatar_url":"https://avatars0.githubusercontent.com/u/10515438?v=4","gravatar_id":"","url":"https://api.github.com/users/manioc2015","html_url":"https://github.com/manioc2015","followers_url":"https://api.github.com/users/manioc2015/followers","following_url":"https://api.github.com/users/manioc2015/following{/other_user}","gists_url":"https://api.github.com/users/manioc2015/gists{/gist_id}","starred_url":"https://api.github.com/users/manioc2015/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/manioc2015/subscriptions","organizations_url":"https://api.github.com/users/manioc2015/orgs","repos_url":"https://api.github.com/users/manioc2015/repos","events_url":"https://api.github.com/users/manioc2015/events{/privacy}","received_events_url":"https://api.github.com/users/manioc2015/received_events","type":"User","site_admin":false},"created_at":"2016-05-03T10:03:11Z","updated_at":"2016-05-03T10:03:11Z","author_association":"NONE","body":"@clintongormley I don't get it. Pardon my ignorance. Are you saying I can't step back into the nested doc by declaring \"nested\" once I step out by doing a \"reverse_nested\" call? Better yet, can you possibly show me what the correct query would be?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216485508","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-216485508","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":216485508,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjQ4NTUwOA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-03T10:03:57Z","updated_at":"2016-05-03T10:03:57Z","author_association":"CONTRIBUTOR","body":"Please ask questions like these in the forum instead: https://discuss.elastic.co/\n\nThe github issues list is reserved for bug reports and feature requests only.\n\nthanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/219170940","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-219170940","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":219170940,"node_id":"MDEyOklzc3VlQ29tbWVudDIxOTE3MDk0MA==","user":{"login":"manioc2015","id":10515438,"node_id":"MDQ6VXNlcjEwNTE1NDM4","avatar_url":"https://avatars0.githubusercontent.com/u/10515438?v=4","gravatar_id":"","url":"https://api.github.com/users/manioc2015","html_url":"https://github.com/manioc2015","followers_url":"https://api.github.com/users/manioc2015/followers","following_url":"https://api.github.com/users/manioc2015/following{/other_user}","gists_url":"https://api.github.com/users/manioc2015/gists{/gist_id}","starred_url":"https://api.github.com/users/manioc2015/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/manioc2015/subscriptions","organizations_url":"https://api.github.com/users/manioc2015/orgs","repos_url":"https://api.github.com/users/manioc2015/repos","events_url":"https://api.github.com/users/manioc2015/events{/privacy}","received_events_url":"https://api.github.com/users/manioc2015/received_events","type":"User","site_admin":false},"created_at":"2016-05-13T22:06:22Z","updated_at":"2016-05-13T22:06:22Z","author_association":"NONE","body":"@clintongormley: you said \"you can't step down to the same nested doc without adding the same filtering that you used originally\".\n\nBut i did add the same filtering that I used originally:\n\n```\n                                                \"aggs\": {\n                                                    \"totalLineItems\": {\n                                                        \"aggs\": {\n                                                            \"totalLineItems\": {\n                                                                \"sum\": {\n                                                                    \"field\": \"lineItems.totalPrice\"\n                                                                }\n                                                            }\n                                                        },\n                                                        \"nested\": {\n                                                            \"path\": \"lineItems\"\n                                                        }\n                                                    }\n                                                }\n```\n\n...and the results aren't correct. Can you please explain?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/381629804","html_url":"https://github.com/elastic/elasticsearch/issues/18005#issuecomment-381629804","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18005","id":381629804,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MTYyOTgwNA==","user":{"login":"swaroopgupta12","id":31399313,"node_id":"MDQ6VXNlcjMxMzk5MzEz","avatar_url":"https://avatars3.githubusercontent.com/u/31399313?v=4","gravatar_id":"","url":"https://api.github.com/users/swaroopgupta12","html_url":"https://github.com/swaroopgupta12","followers_url":"https://api.github.com/users/swaroopgupta12/followers","following_url":"https://api.github.com/users/swaroopgupta12/following{/other_user}","gists_url":"https://api.github.com/users/swaroopgupta12/gists{/gist_id}","starred_url":"https://api.github.com/users/swaroopgupta12/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swaroopgupta12/subscriptions","organizations_url":"https://api.github.com/users/swaroopgupta12/orgs","repos_url":"https://api.github.com/users/swaroopgupta12/repos","events_url":"https://api.github.com/users/swaroopgupta12/events{/privacy}","received_events_url":"https://api.github.com/users/swaroopgupta12/received_events","type":"User","site_admin":false},"created_at":"2018-04-16T14:59:38Z","updated_at":"2018-04-16T14:59:38Z","author_association":"NONE","body":"@clintongormley: I too have a similar challenge to solve.\r\nCan anyone please guide me to solve for this kind of problem?","performed_via_github_app":null}]