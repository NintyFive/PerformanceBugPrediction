{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22689","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22689/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22689/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22689/events","html_url":"https://github.com/elastic/elasticsearch/issues/22689","id":201865038,"node_id":"MDU6SXNzdWUyMDE4NjUwMzg=","number":22689,"title":"Running integration tests with testing framework requires java.lang.RuntimePermission","user":{"login":"wallecnik","id":8803026,"node_id":"MDQ6VXNlcjg4MDMwMjY=","avatar_url":"https://avatars2.githubusercontent.com/u/8803026?v=4","gravatar_id":"","url":"https://api.github.com/users/wallecnik","html_url":"https://github.com/wallecnik","followers_url":"https://api.github.com/users/wallecnik/followers","following_url":"https://api.github.com/users/wallecnik/following{/other_user}","gists_url":"https://api.github.com/users/wallecnik/gists{/gist_id}","starred_url":"https://api.github.com/users/wallecnik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wallecnik/subscriptions","organizations_url":"https://api.github.com/users/wallecnik/orgs","repos_url":"https://api.github.com/users/wallecnik/repos","events_url":"https://api.github.com/users/wallecnik/events{/privacy}","received_events_url":"https://api.github.com/users/wallecnik/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2017-01-19T13:47:17Z","updated_at":"2017-04-11T13:55:03Z","closed_at":"2017-04-11T13:52:09Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.1.2\r\n\r\n**Plugins installed**: none\r\n\r\n**JVM version**: openjdk version \"1.8.0_66\"\r\n\r\n**OS version**: MacOS Sierra 10.12.2\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWe are currently in process of migrating to ES v5. Before we were running on 2.1.1. We have some ESIntegration tests which are using java testing framework. If i try to run simple integration test, the test fails on some runtime permissions:\r\n\r\n    @ESIntegTestCase.ClusterScope(scope = ESIntegTestCase.Scope.TEST)\r\n    public class ESTestES extends ESIntegTestCase {\r\n    \r\n        @Test\r\n        public void basicUsage() throws ExecutionException, InterruptedException {\r\n            client().prepareIndex(\"test\", \"test\", \"1\")\r\n                    .setSource(Collections.singletonMap(\"keyField\", \"keyValue\"))\r\n                    .execute().get();\r\n        }\r\n    \r\n    }\r\n\r\nI'm not sure if this is desired behaviour at version 5 or not. Before everything was working somehow \"out of the box\" :-)\r\n\r\n**Full log**:\r\n\r\n```\r\n[2017-01-19T14:37:01,097][WARN ][o.e.b.JNANatives         ] Unable to lock JVM Memory: error=78, reason=Function not implemented\r\n[2017-01-19T14:37:01,100][WARN ][o.e.b.JNANatives         ] This can result in part of the JVM being swapped out.\r\njava.security.AccessControlException: access denied (\"java.lang.RuntimePermission\" \"accessDeclaredMembers\")\r\n\r\n\tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)\r\n\tat java.security.AccessController.checkPermission(AccessController.java:884)\r\n\tat java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n\tat java.lang.Class.checkMemberAccess(Class.java:2348)\r\n\tat java.lang.Class.getDeclaredMethods(Class.java:1974)\r\n\tat org.junit.internal.MethodSorter.getDeclaredMethods(MethodSorter.java:54)\r\n\tat org.junit.runners.model.TestClass.scanAnnotatedMembers(TestClass.java:65)\r\n\tat org.junit.runners.model.TestClass.<init>(TestClass.java:57)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$12.run(RandomizedRunner.java:1053)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$12.run(RandomizedRunner.java:1050)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.getAnnotatedFieldValues(RandomizedRunner.java:1050)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.withClassRules(RandomizedRunner.java:885)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:674)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$200(RandomizedRunner.java:140)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$2.run(RandomizedRunner.java:598)\r\n\r\nREPRODUCE WITH: gradle null -Dtests.seed=9A8F64168F65BE0D -Dtests.class=com.mycroftmind.dg.common.elastic.ESTestES -Dtests.locale=cs-CZ -Dtests.timezone=Europe/Prague\r\nNOTE: Mac OS X 10.12.2 x86_64/Oracle Corporation 1.8.0_66 (64-bit)/cpus=4,threads=1,free=95621936,total=128974848\r\nNOTE: All tests run in this JVM: [ESTestES]\r\n2017-01-19 14:37:01,549 Thread-1 ERROR Unable to unregister MBeans java.security.AccessControlException: access denied (\"javax.management.MBeanServerPermission\" \"createMBeanServer\")\r\n\tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)\r\n\tat java.security.AccessController.checkPermission(AccessController.java:884)\r\n\tat java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n\tat java.lang.management.ManagementFactory.getPlatformMBeanServer(ManagementFactory.java:465)\r\n\tat org.apache.logging.log4j.core.jmx.Server.unregisterLoggerContext(Server.java:236)\r\n\tat org.apache.logging.log4j.core.LoggerContext.stop(LoggerContext.java:300)\r\n\tat org.apache.logging.log4j.core.config.Configurator.shutdown(Configurator.java:336)\r\n\tat org.elasticsearch.test.ESTestCase.lambda$static$0(ESTestCase.java:158)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n\r\n\r\nProcess finished with exit code 255\r\n```\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}