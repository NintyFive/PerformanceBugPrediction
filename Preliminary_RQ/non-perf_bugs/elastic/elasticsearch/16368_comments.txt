[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/178626303","html_url":"https://github.com/elastic/elasticsearch/issues/16368#issuecomment-178626303","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16368","id":178626303,"node_id":"MDEyOklzc3VlQ29tbWVudDE3ODYyNjMwMw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-02T15:14:04Z","updated_at":"2016-02-02T15:14:04Z","author_association":"CONTRIBUTOR","body":"You can no longer use type names as a prefix for field paths.  And you can't access a child document's values when you're in the context of the parent (and vice versa).  They are completely separate documents.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/178643306","html_url":"https://github.com/elastic/elasticsearch/issues/16368#issuecomment-178643306","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16368","id":178643306,"node_id":"MDEyOklzc3VlQ29tbWVudDE3ODY0MzMwNg==","user":{"login":"temsa","id":174621,"node_id":"MDQ6VXNlcjE3NDYyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/174621?v=4","gravatar_id":"","url":"https://api.github.com/users/temsa","html_url":"https://github.com/temsa","followers_url":"https://api.github.com/users/temsa/followers","following_url":"https://api.github.com/users/temsa/following{/other_user}","gists_url":"https://api.github.com/users/temsa/gists{/gist_id}","starred_url":"https://api.github.com/users/temsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/temsa/subscriptions","organizations_url":"https://api.github.com/users/temsa/orgs","repos_url":"https://api.github.com/users/temsa/repos","events_url":"https://api.github.com/users/temsa/events{/privacy}","received_events_url":"https://api.github.com/users/temsa/received_events","type":"User","site_admin":false},"created_at":"2016-02-02T15:41:16Z","updated_at":"2016-02-02T15:41:16Z","author_association":"NONE","body":"@clintongormley I need this feature... If not I will be stuck with a ES 1.x ?\n\nShould I be able to create a plugin to support accessing parent document ? I could maybe add `parent['foo'].value` in the scripts, the same way there is `doc['bar'].value`, is it achievable ? Will there be a huge cost in term of performance or should it be not too far from 1.x performances?\n\nWhere should I start to add something available inside scripts ? I've been reading the source of elasticsearch core for about an hour and the source of 2 plugins too, I'm on the way but I did not really found where to start for now...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/179860868","html_url":"https://github.com/elastic/elasticsearch/issues/16368#issuecomment-179860868","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16368","id":179860868,"node_id":"MDEyOklzc3VlQ29tbWVudDE3OTg2MDg2OA==","user":{"login":"temsa","id":174621,"node_id":"MDQ6VXNlcjE3NDYyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/174621?v=4","gravatar_id":"","url":"https://api.github.com/users/temsa","html_url":"https://github.com/temsa","followers_url":"https://api.github.com/users/temsa/followers","following_url":"https://api.github.com/users/temsa/following{/other_user}","gists_url":"https://api.github.com/users/temsa/gists{/gist_id}","starred_url":"https://api.github.com/users/temsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/temsa/subscriptions","organizations_url":"https://api.github.com/users/temsa/orgs","repos_url":"https://api.github.com/users/temsa/repos","events_url":"https://api.github.com/users/temsa/events{/privacy}","received_events_url":"https://api.github.com/users/temsa/received_events","type":"User","site_admin":false},"created_at":"2016-02-04T14:16:36Z","updated_at":"2016-02-04T14:16:36Z","author_association":"NONE","body":"@clintongormley  ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183771737","html_url":"https://github.com/elastic/elasticsearch/issues/16368#issuecomment-183771737","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16368","id":183771737,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Mzc3MTczNw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-13T23:41:04Z","updated_at":"2016-02-13T23:41:04Z","author_association":"CONTRIBUTOR","body":"@temsa the parent is in a completely separate document. accessing it will perform horribly. this is why we don't support it.  Denormalise your data instead.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183916004","html_url":"https://github.com/elastic/elasticsearch/issues/16368#issuecomment-183916004","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16368","id":183916004,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzkxNjAwNA==","user":{"login":"temsa","id":174621,"node_id":"MDQ6VXNlcjE3NDYyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/174621?v=4","gravatar_id":"","url":"https://api.github.com/users/temsa","html_url":"https://github.com/temsa","followers_url":"https://api.github.com/users/temsa/followers","following_url":"https://api.github.com/users/temsa/following{/other_user}","gists_url":"https://api.github.com/users/temsa/gists{/gist_id}","starred_url":"https://api.github.com/users/temsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/temsa/subscriptions","organizations_url":"https://api.github.com/users/temsa/orgs","repos_url":"https://api.github.com/users/temsa/repos","events_url":"https://api.github.com/users/temsa/events{/privacy}","received_events_url":"https://api.github.com/users/temsa/received_events","type":"User","site_admin":false},"created_at":"2016-02-14T16:30:56Z","updated_at":"2016-02-14T16:34:46Z","author_association":"NONE","body":"@clintongormley it would mean updating about ~500 000 documents rather than ~500 every ~30s. I'm not sure it would perform that much less horribly, are you ?\n\nBTW it works well enough on 1.x, how differently would it perform in 2.x with a good enough plugin ? What is the difference in the design between 1.x and 2.x preventing 2.x to have it ?\n\nThx\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/184186399","html_url":"https://github.com/elastic/elasticsearch/issues/16368#issuecomment-184186399","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16368","id":184186399,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NDE4NjM5OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-15T12:27:34Z","updated_at":"2016-02-15T12:27:34Z","author_association":"CONTRIBUTOR","body":"@temsa if it worked on 1.x, it was by chance, and only sometimes.  this was never supported\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/184367204","html_url":"https://github.com/elastic/elasticsearch/issues/16368#issuecomment-184367204","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16368","id":184367204,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NDM2NzIwNA==","user":{"login":"temsa","id":174621,"node_id":"MDQ6VXNlcjE3NDYyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/174621?v=4","gravatar_id":"","url":"https://api.github.com/users/temsa","html_url":"https://github.com/temsa","followers_url":"https://api.github.com/users/temsa/followers","following_url":"https://api.github.com/users/temsa/following{/other_user}","gists_url":"https://api.github.com/users/temsa/gists{/gist_id}","starred_url":"https://api.github.com/users/temsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/temsa/subscriptions","organizations_url":"https://api.github.com/users/temsa/orgs","repos_url":"https://api.github.com/users/temsa/repos","events_url":"https://api.github.com/users/temsa/events{/privacy}","received_events_url":"https://api.github.com/users/temsa/received_events","type":"User","site_admin":false},"created_at":"2016-02-15T20:03:40Z","updated_at":"2016-02-15T20:03:40Z","author_association":"NONE","body":"@clintongormley okay, I guess I have a lot of chance as it worked for several versions (1.4.5 up to 1.7x with no issue but something totally unrelated concerning geopoint mapping in script_fields, which seems fixed in 2.x, and not backported to 1.x ...).\n\nFrom an external point of view it does not look like that it is much different from `inner fields`, is that ?\n\nBTW, your only role here seems to be telling me explicitly its an abuse of ElasticSearch, that this is bad, and this is not a feature, just something incidental, like a bug, etc. Ok, understood, really.\n\nMaybe you can albeit redirect me to someone else or some documentation, or even some code to look at ? This would be a bit more helpful, and would answer a bit to my questions, so I can make this horribly performing plugin, at least for myself ? or give me an alternative to this plugin ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185257006","html_url":"https://github.com/elastic/elasticsearch/issues/16368#issuecomment-185257006","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16368","id":185257006,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTI1NzAwNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-17T15:34:20Z","updated_at":"2016-02-17T15:34:20Z","author_association":"CONTRIBUTOR","body":"@temsa here's an example demonstrating what i'm talking about.  This works in exactly the same way on 1.7.5 and 2.2.0:\n\n```\nPUT test\n{\n  \"mappings\": {\n    \"parent\": {},\n    \"child\": {\n      \"_parent\": {\n        \"type\": \"parent\"\n      }\n    }\n  }\n}\n\nPUT test/parent/1\n{\n  \"parent\": 5\n}\n\nPUT test/child/2?parent=1\n{\n  \"child\": 10\n}\n```\n\nNow we run a `has_parent` query - the main query only returns values in the child document (as only child documents have a parent, while inner hits in the `has_parent` clause returns only values in the parent document:\n\n```\nGET test/_search\n{\n  \"script_fields\": {\n    \"parent\": {\n      \"script\": \"doc['parent'].value\"\n    },\n    \"child\": {\n      \"script\": \"doc['child'].value\"\n    }\n  },\n  \"query\": {\n    \"has_parent\": {\n      \"type\": \"parent\",\n      \"inner_hits\": {\n        \"script_fields\": {\n          \"parent\": {\n            \"script\": \"doc['parent'].value\"\n          },\n          \"child\": {\n            \"script\": \"doc['child'].value\"\n          }\n        }\n      },\n      \"query\": {\n        \"match_all\": {}\n      }\n    }\n  }\n}\n```\n\nAnd the reverse is true when running a `has_child` query:\n\n```\nGET test/_search\n{\n  \"script_fields\": {\n    \"parent\": {\n      \"script\": \"doc['parent'].value\"\n    },\n    \"child\": {\n      \"script\": \"doc['child'].value\"\n    }\n  },\n  \"query\": {\n    \"has_child\": {\n      \"type\": \"child\",\n      \"inner_hits\": {\n        \"script_fields\": {\n          \"parent\": {\n            \"script\": \"doc['parent'].value\"\n          },\n          \"child\": {\n            \"script\": \"doc['child'].value\"\n          }\n        }\n      },\n      \"query\": {\n        \"match_all\": {}\n      }\n    }\n  }\n}\n```\n\nSo unless you are talking about something else (which would have been instantly apparent had you provided a curl example of what you were doing) then your statement that you could access parent and child values within the same query context seems to be false.\n","performed_via_github_app":null}]