[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264192859","html_url":"https://github.com/elastic/elasticsearch/issues/21913#issuecomment-264192859","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21913","id":264192859,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDE5Mjg1OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-12-01T14:52:52Z","updated_at":"2016-12-01T14:52:52Z","author_association":"CONTRIBUTOR","body":"@chenryn could you upload the stack trace as well please?\r\n\r\nAlso, any chance you could try this out in 5.0 (and with painless) to see if you can still reproduce it?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264203816","html_url":"https://github.com/elastic/elasticsearch/issues/21913#issuecomment-264203816","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21913","id":264203816,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDIwMzgxNg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-12-01T15:31:00Z","updated_at":"2016-12-01T15:31:00Z","author_association":"CONTRIBUTOR","body":"> I'm sure all logs has such field\r\n\r\nIs that also true for documents that do not match `\"logtype\" : \"apache\"`, or documents that are deleted but have not been expunged by a merge yet? There is no guarantee that the filter executes after the query (or vice versa), so the script could be evaluated against any document of the index, including deleted ones as I suggested in my previous sentence.\r\n\r\nI am also curious whether this starts failing after all documents have been returned or any time. I see follow up requests after the one that complains that `apache.method` is missing have 17 failures too, what is the error for those?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264222836","html_url":"https://github.com/elastic/elasticsearch/issues/21913#issuecomment-264222836","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21913","id":264222836,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDIyMjgzNg==","user":{"login":"chenryn","id":1219655,"node_id":"MDQ6VXNlcjEyMTk2NTU=","avatar_url":"https://avatars3.githubusercontent.com/u/1219655?v=4","gravatar_id":"","url":"https://api.github.com/users/chenryn","html_url":"https://github.com/chenryn","followers_url":"https://api.github.com/users/chenryn/followers","following_url":"https://api.github.com/users/chenryn/following{/other_user}","gists_url":"https://api.github.com/users/chenryn/gists{/gist_id}","starred_url":"https://api.github.com/users/chenryn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenryn/subscriptions","organizations_url":"https://api.github.com/users/chenryn/orgs","repos_url":"https://api.github.com/users/chenryn/repos","events_url":"https://api.github.com/users/chenryn/events{/privacy}","received_events_url":"https://api.github.com/users/chenryn/received_events","type":"User","site_admin":false},"created_at":"2016-12-01T16:36:41Z","updated_at":"2016-12-01T16:36:41Z","author_association":"NONE","body":"@clintongormley No 5.0 on production env now, I will try to reproduce this on my laptop later.(Midnight in China now)\r\n@jpountz This is a pure appending ELK use case, we would delete any logs. And sorry, I don't understand what mean is \"Is that also true for documents that do not match `logtype:apache`\"?\r\nThe first time failed, only one failure message as I paste above, then the following times, 17 failure messages were:\r\n```\r\n  \"failures\" : [ {\r\n      \"shard\" : -1,\r\n      \"index\" : null,\r\n      \"reason\" : {\r\n        \"type\" : \"search_context_missing_exception\",\r\n        \"reason\" : \"No search context found for id [11404942]\"\r\n      }\r\n    }, {\r\n      \"shard\" : -1,\r\n      \"index\" : null,\r\n      \"reason\" : {\r\n        \"type\" : \"search_context_missing_exception\",\r\n        \"reason\" : \"No search context found for id [11404944]\"\r\n      }\r\n    }, {\r\n      \"shard\" : -1,\r\n      \"index\" : null,\r\n      \"reason\" : {\r\n        \"type\" : \"search_context_missing_exception\",\r\n        \"reason\" : \"No search context found for id [11404943]\"\r\n      }\r\n    }, {\r\n```\r\nI think that because those search contexts were destoried by the first exception.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264252513","html_url":"https://github.com/elastic/elasticsearch/issues/21913#issuecomment-264252513","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21913","id":264252513,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDI1MjUxMw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-12-01T18:26:40Z","updated_at":"2016-12-01T18:26:40Z","author_association":"CONTRIBUTOR","body":"> This is a pure appending ELK use case\r\n\r\nOK. Good to know.\r\n\r\n> Is that also true for documents that do not match logtype:apache\"\r\n\r\nI was wondering whether you had any document at all in your `logstash-201611*` indices that do not have a value for `apache.method`, including those that do not match the query that you put in the `must` clause: `\"term\" : { \"logtype\" : \"apache\" }`. What is the result of the below aggregation?\r\n\r\n```\r\ncurl -s -XGET 'http://192.168.1.81:9200/logstash-201611*/_search' -d '{\r\n  \"size\": 0,\r\n  \"aggs\": {\r\n    \"missing_method\": {\r\n      \"missing\": {\r\n        \"field\": \"apache.method\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264366104","html_url":"https://github.com/elastic/elasticsearch/issues/21913#issuecomment-264366104","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21913","id":264366104,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDM2NjEwNA==","user":{"login":"chenryn","id":1219655,"node_id":"MDQ6VXNlcjEyMTk2NTU=","avatar_url":"https://avatars3.githubusercontent.com/u/1219655?v=4","gravatar_id":"","url":"https://api.github.com/users/chenryn","html_url":"https://github.com/chenryn","followers_url":"https://api.github.com/users/chenryn/followers","following_url":"https://api.github.com/users/chenryn/following{/other_user}","gists_url":"https://api.github.com/users/chenryn/gists{/gist_id}","starred_url":"https://api.github.com/users/chenryn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenryn/subscriptions","organizations_url":"https://api.github.com/users/chenryn/orgs","repos_url":"https://api.github.com/users/chenryn/repos","events_url":"https://api.github.com/users/chenryn/events{/privacy}","received_events_url":"https://api.github.com/users/chenryn/received_events","type":"User","site_admin":false},"created_at":"2016-12-02T03:42:13Z","updated_at":"2016-12-02T03:42:13Z","author_association":"NONE","body":"@jpountz yes, there are other \"logtype\"s. But how could an outside event break the must query?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267277118","html_url":"https://github.com/elastic/elasticsearch/issues/21913#issuecomment-267277118","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21913","id":267277118,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzI3NzExOA==","user":{"login":"chenryn","id":1219655,"node_id":"MDQ6VXNlcjEyMTk2NTU=","avatar_url":"https://avatars3.githubusercontent.com/u/1219655?v=4","gravatar_id":"","url":"https://api.github.com/users/chenryn","html_url":"https://github.com/chenryn","followers_url":"https://api.github.com/users/chenryn/followers","following_url":"https://api.github.com/users/chenryn/following{/other_user}","gists_url":"https://api.github.com/users/chenryn/gists{/gist_id}","starred_url":"https://api.github.com/users/chenryn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenryn/subscriptions","organizations_url":"https://api.github.com/users/chenryn/orgs","repos_url":"https://api.github.com/users/chenryn/repos","events_url":"https://api.github.com/users/chenryn/events{/privacy}","received_events_url":"https://api.github.com/users/chenryn/received_events","type":"User","site_admin":false},"created_at":"2016-12-15T09:18:36Z","updated_at":"2016-12-15T09:18:36Z","author_association":"NONE","body":"@clintongormley I try this on 5.0.0 with both groovy and painless, no error happen.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372782486","html_url":"https://github.com/elastic/elasticsearch/issues/21913#issuecomment-372782486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21913","id":372782486,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjc4MjQ4Ng==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T19:04:31Z","updated_at":"2018-03-13T19:04:31Z","author_association":"CONTRIBUTOR","body":"@jpountz Is this still worth discussing or can this be closed?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/487223215","html_url":"https://github.com/elastic/elasticsearch/issues/21913#issuecomment-487223215","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21913","id":487223215,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzIyMzIxNQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T22:42:00Z","updated_at":"2019-04-26T22:42:00Z","author_association":"MEMBER","body":"There have been improvements in the handling of missing values in scripts and the associated documentation. Scripts never return null anymore, and instead should be checked for \"no values\" using `size() == 0` on the returned list of values from `doc`. Thus I think this issue can be closed.","performed_via_github_app":null}]