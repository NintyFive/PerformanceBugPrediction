[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/221209587","html_url":"https://github.com/elastic/elasticsearch/issues/18520#issuecomment-221209587","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18520","id":221209587,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTIwOTU4Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-24T09:05:57Z","updated_at":"2016-05-24T09:05:57Z","author_association":"CONTRIBUTOR","body":"Hi @butsjoh \n\nNothing to do with nested queries.  The issue is that the field is not analyzed, so is indexed as `BE`, but the `lowercase_expanded_terms` param (which applies to wildcards) in the query string query defaults to `true`.\n\nDuplicate of https://github.com/elastic/elasticsearch/issues/9978\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/221249183","html_url":"https://github.com/elastic/elasticsearch/issues/18520#issuecomment-221249183","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18520","id":221249183,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTI0OTE4Mw==","user":{"login":"butsjoh","id":96848,"node_id":"MDQ6VXNlcjk2ODQ4","avatar_url":"https://avatars2.githubusercontent.com/u/96848?v=4","gravatar_id":"","url":"https://api.github.com/users/butsjoh","html_url":"https://github.com/butsjoh","followers_url":"https://api.github.com/users/butsjoh/followers","following_url":"https://api.github.com/users/butsjoh/following{/other_user}","gists_url":"https://api.github.com/users/butsjoh/gists{/gist_id}","starred_url":"https://api.github.com/users/butsjoh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butsjoh/subscriptions","organizations_url":"https://api.github.com/users/butsjoh/orgs","repos_url":"https://api.github.com/users/butsjoh/repos","events_url":"https://api.github.com/users/butsjoh/events{/privacy}","received_events_url":"https://api.github.com/users/butsjoh/received_events","type":"User","site_admin":false},"created_at":"2016-05-24T12:09:55Z","updated_at":"2016-05-24T12:09:55Z","author_association":"NONE","body":"@clintongormley Sorry but i do not fully understand your response. How could i then change my situation in order to make it work. You have to agree that the id field in the mapping i posted is also not analyzed but there the wildcard (location_*) works and for a field in the nested object it does not? Do you then recommend setting lowercase_expanded_terms to false for the nested query?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/221250701","html_url":"https://github.com/elastic/elasticsearch/issues/18520#issuecomment-221250701","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18520","id":221250701,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTI1MDcwMQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-24T12:16:55Z","updated_at":"2016-05-24T12:16:55Z","author_association":"CONTRIBUTOR","body":"> You have to agree that the id field in the mapping i posted is also not analyzed but there the wildcard (location_*) \n\nYes, the `id` field is `not_analyzed`, but the value you're indexing is already lower case, so it matches.  If you change the ID value to `LOCATION_FOO` and search that field for `LOC*`, it won't find anything either.\n\n> Do you then recommend setting lowercase_expanded_terms to false for the nested query?\n\nAs long as you're only planning on using wildcards on `not_analyzed` fields, then yes :)  If you want to use it on analyzed fields too, then you'll have the same problem but in reverse.\n\nThis is not an easy problem to solve, which is why #9978 is marked as high hanging fruit. It requires a big rewrite of our analysis framework.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/221251225","html_url":"https://github.com/elastic/elasticsearch/issues/18520#issuecomment-221251225","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18520","id":221251225,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTI1MTIyNQ==","user":{"login":"butsjoh","id":96848,"node_id":"MDQ6VXNlcjk2ODQ4","avatar_url":"https://avatars2.githubusercontent.com/u/96848?v=4","gravatar_id":"","url":"https://api.github.com/users/butsjoh","html_url":"https://github.com/butsjoh","followers_url":"https://api.github.com/users/butsjoh/followers","following_url":"https://api.github.com/users/butsjoh/following{/other_user}","gists_url":"https://api.github.com/users/butsjoh/gists{/gist_id}","starred_url":"https://api.github.com/users/butsjoh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butsjoh/subscriptions","organizations_url":"https://api.github.com/users/butsjoh/orgs","repos_url":"https://api.github.com/users/butsjoh/repos","events_url":"https://api.github.com/users/butsjoh/events{/privacy}","received_events_url":"https://api.github.com/users/butsjoh/received_events","type":"User","site_admin":false},"created_at":"2016-05-24T12:19:22Z","updated_at":"2016-05-24T12:19:22Z","author_association":"NONE","body":"Ok i think i got it. So in order for my to avoid setting lowercase_expanded_terms to false i could analyse the field i am searching on with applying a lowercase filter on it in the mapping. Correct?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/221802704","html_url":"https://github.com/elastic/elasticsearch/issues/18520#issuecomment-221802704","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18520","id":221802704,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTgwMjcwNA==","user":{"login":"butsjoh","id":96848,"node_id":"MDQ6VXNlcjk2ODQ4","avatar_url":"https://avatars2.githubusercontent.com/u/96848?v=4","gravatar_id":"","url":"https://api.github.com/users/butsjoh","html_url":"https://github.com/butsjoh","followers_url":"https://api.github.com/users/butsjoh/followers","following_url":"https://api.github.com/users/butsjoh/following{/other_user}","gists_url":"https://api.github.com/users/butsjoh/gists{/gist_id}","starred_url":"https://api.github.com/users/butsjoh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butsjoh/subscriptions","organizations_url":"https://api.github.com/users/butsjoh/orgs","repos_url":"https://api.github.com/users/butsjoh/repos","events_url":"https://api.github.com/users/butsjoh/events{/privacy}","received_events_url":"https://api.github.com/users/butsjoh/received_events","type":"User","site_admin":false},"created_at":"2016-05-26T07:56:39Z","updated_at":"2016-05-26T07:56:39Z","author_association":"NONE","body":"So i can indeed confirm if you apply a lowercase filter on the country_code field (by setting up a analyzer in the mapping) i don't need to set lowercase_expanded_terms to false anymore and a query_string search for B\\* or b\\* will return both documents.\n\nthnx for this clarification\n","performed_via_github_app":null}]