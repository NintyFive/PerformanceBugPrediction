[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160939223","html_url":"https://github.com/elastic/elasticsearch/issues/15059#issuecomment-160939223","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15059","id":160939223,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDkzOTIyMw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T11:23:07Z","updated_at":"2015-12-01T11:23:07Z","author_association":"MEMBER","body":"I just looked and we can optimize some minor things, like only construct the setting once per index and not once per shard as we do now. That said, even 7200 operations shouldn't take 6s. How big are your settings?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160954309","html_url":"https://github.com/elastic/elasticsearch/issues/15059#issuecomment-160954309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15059","id":160954309,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDk1NDMwOQ==","user":{"login":"centic9","id":548322,"node_id":"MDQ6VXNlcjU0ODMyMg==","avatar_url":"https://avatars0.githubusercontent.com/u/548322?v=4","gravatar_id":"","url":"https://api.github.com/users/centic9","html_url":"https://github.com/centic9","followers_url":"https://api.github.com/users/centic9/followers","following_url":"https://api.github.com/users/centic9/following{/other_user}","gists_url":"https://api.github.com/users/centic9/gists{/gist_id}","starred_url":"https://api.github.com/users/centic9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/centic9/subscriptions","organizations_url":"https://api.github.com/users/centic9/orgs","repos_url":"https://api.github.com/users/centic9/repos","events_url":"https://api.github.com/users/centic9/events{/privacy}","received_events_url":"https://api.github.com/users/centic9/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T12:29:30Z","updated_at":"2015-12-01T12:29:30Z","author_association":"CONTRIBUTOR","body":"The cluster was in a bit of stress at that time, that might have added some lag to the overall processing. Unfortunately I do not see how many times it was actually called with this type of CPU analysis. But I will do a more detailed sampling to get better numbers to rule out that other threads did steal most of the time here actually...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160961706","html_url":"https://github.com/elastic/elasticsearch/issues/15059#issuecomment-160961706","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15059","id":160961706,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDk2MTcwNg==","user":{"login":"centic9","id":548322,"node_id":"MDQ6VXNlcjU0ODMyMg==","avatar_url":"https://avatars0.githubusercontent.com/u/548322?v=4","gravatar_id":"","url":"https://api.github.com/users/centic9","html_url":"https://github.com/centic9","followers_url":"https://api.github.com/users/centic9/followers","following_url":"https://api.github.com/users/centic9/following{/other_user}","gists_url":"https://api.github.com/users/centic9/gists{/gist_id}","starred_url":"https://api.github.com/users/centic9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/centic9/subscriptions","organizations_url":"https://api.github.com/users/centic9/orgs","repos_url":"https://api.github.com/users/centic9/repos","events_url":"https://api.github.com/users/centic9/events{/privacy}","received_events_url":"https://api.github.com/users/centic9/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T12:56:05Z","updated_at":"2015-12-01T12:56:05Z","author_association":"CONTRIBUTOR","body":"Ok, the overall time is not that high on a healthy cluster, but the percentage is still quite high. In a quick test the 6 calls of a cluster-state-change to the 6 cluster-nodes with take 3795 ms combined (aprox 630ms on each node), the re-building of the Settings takes 1091ms or 182ms on each node.\n\nThis is with 620 indices and 6978 primary as well as replica shards (not productive, just testing where ES breaks :) )\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160989061","html_url":"https://github.com/elastic/elasticsearch/issues/15059#issuecomment-160989061","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15059","id":160989061,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDk4OTA2MQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T14:51:30Z","updated_at":"2015-12-01T14:51:30Z","author_association":"MEMBER","body":"@centic9 OK, fair enough. I've opened a PR with the small optimization (more of simplification in my mind). I think we're good here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161036492","html_url":"https://github.com/elastic/elasticsearch/issues/15059#issuecomment-161036492","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15059","id":161036492,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTAzNjQ5Mg==","user":{"login":"centic9","id":548322,"node_id":"MDQ6VXNlcjU0ODMyMg==","avatar_url":"https://avatars0.githubusercontent.com/u/548322?v=4","gravatar_id":"","url":"https://api.github.com/users/centic9","html_url":"https://github.com/centic9","followers_url":"https://api.github.com/users/centic9/followers","following_url":"https://api.github.com/users/centic9/following{/other_user}","gists_url":"https://api.github.com/users/centic9/gists{/gist_id}","starred_url":"https://api.github.com/users/centic9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/centic9/subscriptions","organizations_url":"https://api.github.com/users/centic9/orgs","repos_url":"https://api.github.com/users/centic9/repos","events_url":"https://api.github.com/users/centic9/events{/privacy}","received_events_url":"https://api.github.com/users/centic9/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T17:13:12Z","updated_at":"2015-12-01T17:13:12Z","author_association":"CONTRIBUTOR","body":"Great, looks nice, that should reduce the number of calls from 14000 to 700 in my case, which should provide quite a noticeable improvement. Thanks!\n","performed_via_github_app":null}]