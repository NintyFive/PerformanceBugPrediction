[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289090765","html_url":"https://github.com/elastic/elasticsearch/issues/23737#issuecomment-289090765","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23737","id":289090765,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTA5MDc2NQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-03-24T17:34:16Z","updated_at":"2017-03-24T17:34:16Z","author_association":"MEMBER","body":"Hi @mrec, \r\nplease ask questions like these in the forum instead: https://discuss.elastic.co/. The github issues list is reserved for bug reports and feature requests only. Thanks!\r\n\r\nThe difference is made by `analyze_wildcard`. If you set it to `false` you should get the expected result. That seems to show that the classic tokenizer leaves the `.` only when it's between tokens. Have a look at the analyze api output for the following requests:\r\n\r\n```\r\nGET /mrec/_analyze?text=T.A&tokenizer=classic\r\n#. is kept\r\n\r\nGET /mrec/_analyze?text=T.&tokenizer=classic\r\n#. is dropped\r\n```\r\n\r\nThe former shows how your documents get analyzed, while the latter shows how the `T.*` token which contains a wildcard gets analyzed (only if you set `analyze_wildcard` to `true`).\r\n\r\nAlso looking at the explain output for your query would have showed the problem, as the query doesn't contain the `.`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289097442","html_url":"https://github.com/elastic/elasticsearch/issues/23737#issuecomment-289097442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23737","id":289097442,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTA5NzQ0Mg==","user":{"login":"mrec","id":4206148,"node_id":"MDQ6VXNlcjQyMDYxNDg=","avatar_url":"https://avatars0.githubusercontent.com/u/4206148?v=4","gravatar_id":"","url":"https://api.github.com/users/mrec","html_url":"https://github.com/mrec","followers_url":"https://api.github.com/users/mrec/followers","following_url":"https://api.github.com/users/mrec/following{/other_user}","gists_url":"https://api.github.com/users/mrec/gists{/gist_id}","starred_url":"https://api.github.com/users/mrec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrec/subscriptions","organizations_url":"https://api.github.com/users/mrec/orgs","repos_url":"https://api.github.com/users/mrec/repos","events_url":"https://api.github.com/users/mrec/events{/privacy}","received_events_url":"https://api.github.com/users/mrec/received_events","type":"User","site_admin":false},"created_at":"2017-03-24T17:53:31Z","updated_at":"2017-03-24T17:53:31Z","author_association":"NONE","body":"Yes, I understand that the classic tokenizer is dropping a `.` in suffix position but not in infix position; that's described in the doc I linked. My point is that at least for `T.?*`, and probably for `T.*`, the caller is very obviously wanting to match an indexed term where the `.`  is **not** the last character, and therefore the `.` before the wildcard should not be treated as the last character and should not be dropped when analyzing the query.\r\n\r\nI understand that turning off `analyze_wildcard` would solve this specific case, but would almost certainly break other cases; there's a reason that flag exists.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289099497","html_url":"https://github.com/elastic/elasticsearch/issues/23737#issuecomment-289099497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23737","id":289099497,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTA5OTQ5Nw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-03-24T17:59:07Z","updated_at":"2017-03-24T17:59:07Z","author_association":"MEMBER","body":"I understand what you mean @mrec . Unfortunately the way `analyze_wildcard` works is different though. I wasn't suggesting to remove `analyze_wildcard`, rather to show how it makes the difference. I would look into using a different analyzer that always keeps the `.`. Would that be an option?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289105090","html_url":"https://github.com/elastic/elasticsearch/issues/23737#issuecomment-289105090","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23737","id":289105090,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTEwNTA5MA==","user":{"login":"mrec","id":4206148,"node_id":"MDQ6VXNlcjQyMDYxNDg=","avatar_url":"https://avatars0.githubusercontent.com/u/4206148?v=4","gravatar_id":"","url":"https://api.github.com/users/mrec","html_url":"https://github.com/mrec","followers_url":"https://api.github.com/users/mrec/followers","following_url":"https://api.github.com/users/mrec/following{/other_user}","gists_url":"https://api.github.com/users/mrec/gists{/gist_id}","starred_url":"https://api.github.com/users/mrec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrec/subscriptions","organizations_url":"https://api.github.com/users/mrec/orgs","repos_url":"https://api.github.com/users/mrec/repos","events_url":"https://api.github.com/users/mrec/events{/privacy}","received_events_url":"https://api.github.com/users/mrec/received_events","type":"User","site_admin":false},"created_at":"2017-03-24T18:19:13Z","updated_at":"2017-03-24T18:19:13Z","author_association":"NONE","body":"> I would look into using a different analyzer that always keeps the `.`. Would that be an option?\r\n\r\nUnfortunately we're searching against multiple fields with different analyzers. The field we *want* this wildcard to match is already using a different analyzer designed for symbols, which doesn't have this problem. The false positives are coming from a more general arbitrary-text field which does use the classic tokenizer.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289121374","html_url":"https://github.com/elastic/elasticsearch/issues/23737#issuecomment-289121374","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23737","id":289121374,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTEyMTM3NA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-03-24T19:26:08Z","updated_at":"2017-03-24T19:26:08Z","author_association":"MEMBER","body":"Maybe you could change the query analyzer then rather than the field analyzer? I am afraid with classic tokenizer and analyze_wildcards you are not going to get what you want.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289124109","html_url":"https://github.com/elastic/elasticsearch/issues/23737#issuecomment-289124109","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23737","id":289124109,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTEyNDEwOQ==","user":{"login":"mrec","id":4206148,"node_id":"MDQ6VXNlcjQyMDYxNDg=","avatar_url":"https://avatars0.githubusercontent.com/u/4206148?v=4","gravatar_id":"","url":"https://api.github.com/users/mrec","html_url":"https://github.com/mrec","followers_url":"https://api.github.com/users/mrec/followers","following_url":"https://api.github.com/users/mrec/following{/other_user}","gists_url":"https://api.github.com/users/mrec/gists{/gist_id}","starred_url":"https://api.github.com/users/mrec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrec/subscriptions","organizations_url":"https://api.github.com/users/mrec/orgs","repos_url":"https://api.github.com/users/mrec/repos","events_url":"https://api.github.com/users/mrec/events{/privacy}","received_events_url":"https://api.github.com/users/mrec/received_events","type":"User","site_admin":false},"created_at":"2017-03-24T19:38:26Z","updated_at":"2017-03-24T19:38:26Z","author_association":"NONE","body":"Maybe, though I'm not sure what we'd change it to. By the way, the standard analyzer tokenizes `T.A` and `T.` the same way as the classic tokenizer, and has the exact same problem with wildcards. \r\n\r\nIt's probably worth us experimenting with `analyze_wildcards` again and seeing just how bad the problems are and whether they're easier to work around than this is. Ah well. Thanks for the response, anyway; I didn't have high hopes of getting this fixed, but it's good to have a concrete answer to refer to.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289127151","html_url":"https://github.com/elastic/elasticsearch/issues/23737#issuecomment-289127151","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23737","id":289127151,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTEyNzE1MQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-03-24T19:52:40Z","updated_at":"2017-03-24T19:52:40Z","author_association":"MEMBER","body":"Maybe you could open a [discuss post](https://discuss.elastic.co/ ), I think it is more appropriate than an issue and others may chime in as well with other ideas.","performed_via_github_app":null}]