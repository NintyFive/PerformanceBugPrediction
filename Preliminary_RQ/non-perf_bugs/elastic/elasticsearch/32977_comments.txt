[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414200312","html_url":"https://github.com/elastic/elasticsearch/issues/32977#issuecomment-414200312","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32977","id":414200312,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDIwMDMxMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-20T05:22:07Z","updated_at":"2018-08-20T05:22:07Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414200822","html_url":"https://github.com/elastic/elasticsearch/issues/32977#issuecomment-414200822","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32977","id":414200822,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDIwMDgyMg==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-08-20T05:26:08Z","updated_at":"2018-08-20T05:38:07Z","author_association":"CONTRIBUTOR","body":"@mhmen it would be helpful if you could provide a short, complete reproduction that indexes documents then highlights the incorrect behavior. Please also let us know the version of elasticsearch you are using.\r\n\r\nI had to install fonts to see the characters from the example, in case anyone else doesn't have the fonts, these are: \r\n\r\n\r\n| Unicode character | Oct | Dec | Hex | HTML |\r\n|--------------------------|----------|-------|-------|-------|\r\n| arabic letter gaf     | 03257 | 1711 | 0x6AF | &#1711;|\r\n| arabic letter tcheh | 03206 | 1670 | 0x686 | &#1670;|\r\n| arabic letter peh    | 03176 | 1662 | 0x67E | &#1662;|\r\n| arabic letter jeh     | 03230 | 1688 | 0x698 | &#1688;|\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414217987","html_url":"https://github.com/elastic/elasticsearch/issues/32977#issuecomment-414217987","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32977","id":414217987,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDIxNzk4Nw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-08-20T07:07:46Z","updated_at":"2018-08-20T07:07:46Z","author_association":"CONTRIBUTOR","body":"If it helps, a small reproduction looks like the following, in an empty cluster with the `analysis-icu` plugin:\r\n\r\n```\r\nPUT /i\r\n{\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"dynamic\": \"strict\",\r\n      \"properties\": {\r\n        \"f\": {\r\n          \"type\": \"keyword\",\r\n          \"fields\": {\r\n            \"sort_fa_IR\": {\r\n              \"country\": \"IR\",\r\n              \"language\": \"fa\",\r\n              \"type\": \"icu_collation_keyword\",\r\n              \"index\": false\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"settings\": {\r\n    \"number_of_shards\": 1,\r\n    \"number_of_replicas\": 0\r\n  }\r\n}\r\n\r\n# 200 OK\r\n# {\r\n#   \"shards_acknowledged\": true,\r\n#   \"acknowledged\": true,\r\n#   \"index\": \"i\"\r\n# }\r\n\r\nPUT /i/_doc/_bulk?refresh\r\n{\"index\":{}}\r\n{\"f\":\"ژ\"}\r\n{\"index\":{}}\r\n{\"f\":\"پ\"}\r\n{\"index\":{}}\r\n{\"f\":\"چ\"}\r\n{\"index\":{}}\r\n{\"f\":\"گ\"}\r\n\r\n# 200 OK\r\n\r\nGET /_search\r\n{\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  },\r\n  \"sort\": \"f.sort_fa_IR\"\r\n}\r\n\r\n# 200 OK\r\n# {\r\n#   \"took\": 8,\r\n#   \"_shards\": {\r\n#     \"skipped\": 0,\r\n#     \"successful\": 1,\r\n#     \"total\": 1,\r\n#     \"failed\": 0\r\n#   },\r\n#   \"timed_out\": false,\r\n#   \"hits\": {\r\n#     \"max_score\": null,\r\n#     \"total\": 4,\r\n#     \"hits\": [\r\n#       {\r\n#         \"_type\": \"_doc\",\r\n#         \"_score\": null,\r\n#         \"_source\": {\r\n#           \"f\": \"پ\"\r\n#         },\r\n#         \"_id\": \"qa8iVmUBDLtXL047cQBS\",\r\n#         \"_index\": \"i\",\r\n#         \"sort\": [\r\n#           \"጑A†倀\\u0001\"\r\n#         ]\r\n#       },\r\n#       {\r\n#         \"_type\": \"_doc\",\r\n#         \"_score\": null,\r\n#         \"_source\": {\r\n#           \"f\": \"چ\"\r\n#         },\r\n#         \"_id\": \"qq8iVmUBDLtXL047cQBS\",\r\n#         \"_index\": \"i\",\r\n#         \"sort\": [\r\n#           \"ጠA†倀\\u0001\"\r\n#         ]\r\n#       },\r\n#       {\r\n#         \"_type\": \"_doc\",\r\n#         \"_score\": null,\r\n#         \"_source\": {\r\n#           \"f\": \"ژ\"\r\n#         },\r\n#         \"_id\": \"qK8iVmUBDLtXL047cQBR\",\r\n#         \"_index\": \"i\",\r\n#         \"sort\": [\r\n#           \"ፀA†倀\\u0001\"\r\n#         ]\r\n#       },\r\n#       {\r\n#         \"_type\": \"_doc\",\r\n#         \"_score\": null,\r\n#         \"_source\": {\r\n#           \"f\": \"گ\"\r\n#         },\r\n#         \"_id\": \"q68iVmUBDLtXL047cQBS\",\r\n#         \"_index\": \"i\",\r\n#         \"sort\": [\r\n#           \"፠A†倀\\u0001\"\r\n#         ]\r\n#       }\r\n#     ]\r\n#   }\r\n# }\r\n```\r\n\r\nThe resulting order is the same as the order of the unicode code points, which is presumably incorrect, but it'd be awfully helpful to know what the expected order of these documents is.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418983472","html_url":"https://github.com/elastic/elasticsearch/issues/32977#issuecomment-418983472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32977","id":418983472,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODk4MzQ3Mg==","user":{"login":"mhmen","id":30195386,"node_id":"MDQ6VXNlcjMwMTk1Mzg2","avatar_url":"https://avatars1.githubusercontent.com/u/30195386?v=4","gravatar_id":"","url":"https://api.github.com/users/mhmen","html_url":"https://github.com/mhmen","followers_url":"https://api.github.com/users/mhmen/followers","following_url":"https://api.github.com/users/mhmen/following{/other_user}","gists_url":"https://api.github.com/users/mhmen/gists{/gist_id}","starred_url":"https://api.github.com/users/mhmen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhmen/subscriptions","organizations_url":"https://api.github.com/users/mhmen/orgs","repos_url":"https://api.github.com/users/mhmen/repos","events_url":"https://api.github.com/users/mhmen/events{/privacy}","received_events_url":"https://api.github.com/users/mhmen/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T06:45:58Z","updated_at":"2018-09-06T09:24:18Z","author_association":"NONE","body":"Thank you for your replies\r\nThe resulting sort on the 4th comment is correct.\r\nBut the problem I say is that for example the Unicode character 1662 in Persian alphabetical sort is located between 1576 and 1578, and this puts the character 1662 after the other two if sort is done by the Unicode code points.\r\nThe characters' alphabetical order is as below:\r\n1662 is between 1576 and 1578,\r\n1670 is between 1580 and 1581,\r\n1688 is between 1586 and 1587,\r\n1711 is between 1705 and 1604\r\nand 1711 is the other form of Arabic letter kaf with Unicode of 1603.\r\nI don't know how it is handled, but when I use .net OrderBy method it works perfect for Persian alphabet.\r\nThis Wikipedia article gets a good idea of what the Persian alphabet looks like:\r\n[https://en.wikipedia.org/wiki/Persian_alphabet](https://en.wikipedia.org/wiki/Persian_alphabet)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419027505","html_url":"https://github.com/elastic/elasticsearch/issues/32977#issuecomment-419027505","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32977","id":419027505,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTAyNzUwNQ==","user":{"login":"mhmen","id":30195386,"node_id":"MDQ6VXNlcjMwMTk1Mzg2","avatar_url":"https://avatars1.githubusercontent.com/u/30195386?v=4","gravatar_id":"","url":"https://api.github.com/users/mhmen","html_url":"https://github.com/mhmen","followers_url":"https://api.github.com/users/mhmen/followers","following_url":"https://api.github.com/users/mhmen/following{/other_user}","gists_url":"https://api.github.com/users/mhmen/gists{/gist_id}","starred_url":"https://api.github.com/users/mhmen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhmen/subscriptions","organizations_url":"https://api.github.com/users/mhmen/orgs","repos_url":"https://api.github.com/users/mhmen/repos","events_url":"https://api.github.com/users/mhmen/events{/privacy}","received_events_url":"https://api.github.com/users/mhmen/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T09:26:57Z","updated_at":"2018-09-06T09:26:57Z","author_association":"NONE","body":"Such problem exists in java I think\r\n[https://stackoverflow.com/questions/43497368/sorting-arraylist-in-alphabetical-orderpersian](https://stackoverflow.com/questions/43497368/sorting-arraylist-in-alphabetical-orderpersian)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419452190","html_url":"https://github.com/elastic/elasticsearch/issues/32977#issuecomment-419452190","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32977","id":419452190,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTQ1MjE5MA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-09-07T14:12:27Z","updated_at":"2018-09-07T14:12:27Z","author_association":"CONTRIBUTOR","body":"@mhmen  It would be very helpful if you follow the format of filing a new issue and provided us with steps to reproduce your problem with showing where is the bug and your expected output, so we would not guess what is the problem. Because so far, unfortunately,  we are not able to identify what is the problem. \r\n\r\n> But the problem I say is that for example the Unicode character 1662 in Persian alphabetical sort is located between 1576 and 1578, and this puts the character 1662 after the other two if sort is done by the Unicode code points.\r\n> The characters' alphabetical order is as below:\r\n> 1662 is between 1576 and 1578,\r\n\r\nSo, I've got three characters: \r\nپ - 1662 - pe\r\n1576 - ب - be\r\n1578 - ت - te\r\n\r\nAs you noted according to the rules of persian alphabet, they should be sorted as : 1576 - ب - be, 1662 - pe, 1578 - ت - te.   And that is the exact order that you will get if you use `\"icu_collation_keyword\"` as @DaveCTurner  suggested. So your solution is just to use `\"icu_collation_keyword\"` .\r\n\r\n```js\r\nPUT /i\r\n{\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"dynamic\": \"strict\",\r\n      \"properties\": {\r\n        \"f\": {\r\n          \"type\": \"keyword\",\r\n          \"fields\": {\r\n            \"sort_fa_IR\": {\r\n              \"country\": \"IR\",\r\n              \"language\": \"fa\",\r\n              \"type\": \"icu_collation_keyword\",\r\n              \"index\": false\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"settings\": {\r\n    \"number_of_shards\": 1,\r\n    \"number_of_replicas\": 0\r\n  }\r\n}\r\n\r\nPUT /i/_doc/_bulk?refresh\r\n{ \"index\" : { \"_index\" : \"i\", \"_type\" : \"_doc\", \"_id\" : \"1\" } }\r\n{\"f\": \"ب\"}\r\n{ \"index\" : { \"_index\" : \"i\", \"_type\" : \"_doc\", \"_id\" : \"2\" } }\r\n{\"f\": \"ت\"}\r\n{ \"index\" : { \"_index\" : \"i\", \"_type\" : \"_doc\", \"_id\" : \"3\" } }\r\n{\"f\": \"پ\"}\r\n\r\nGET i/_search\r\n{\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  },\r\n  \"sort\": \"f.sort_fa_IR\"\r\n}\r\n\r\n{\r\n\t\"took\": 77,\r\n\t\"timed_out\": false,\r\n\t\"_shards\": {\r\n\t\t\"total\": 1,\r\n\t\t\"successful\": 1,\r\n\t\t\"skipped\": 0,\r\n\t\t\"failed\": 0\r\n\t},\r\n\t\"hits\": {\r\n\t\t\"total\": 3,\r\n\t\t\"max_score\": null,\r\n\t\t\"hits\": [\r\n\t\t\t{\r\n\t\t\t\t\"_index\": \"mayyatest0\",\r\n\t\t\t\t\"_type\": \"_doc\",\r\n\t\t\t\t\"_id\": \"1\",\r\n\t\t\t\t\"_score\": null,\r\n\t\t\t\t\"_source\": {\r\n\t\t\t\t\t\"f\": \"ب\"    \r\n\t\t\t\t},\r\n\t\t\t\t\"sort\": [\r\n\t\t\t\t\t\"ጏA†倀\u0001\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"_index\": \"mayyatest0\",\r\n\t\t\t\t\"_type\": \"_doc\",\r\n\t\t\t\t\"_id\": \"3\",\r\n\t\t\t\t\"_score\": null,\r\n\t\t\t\t\"_source\": {\r\n\t\t\t\t\t\"f\": \"پ\"\r\n\t\t\t\t},\r\n\t\t\t\t\"sort\": [\r\n\t\t\t\t\t\"጑A†倀\u0001\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"_index\": \"mayyatest0\",\r\n\t\t\t\t\"_type\": \"_doc\",\r\n\t\t\t\t\"_id\": \"2\",\r\n\t\t\t\t\"_score\": null,\r\n\t\t\t\t\"_source\": {\r\n\t\t\t\t\t\"f\": \"ت\"\r\n\t\t\t\t},\r\n\t\t\t\t\"sort\": [\r\n\t\t\t\t\t\"ጕA†倀\u0001\"\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n}\r\n\r\n```\r\n\r\nIf we are missing something, please let us know with the exact steps to reproduce the problem.\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419620299","html_url":"https://github.com/elastic/elasticsearch/issues/32977#issuecomment-419620299","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32977","id":419620299,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTYyMDI5OQ==","user":{"login":"mhmen","id":30195386,"node_id":"MDQ6VXNlcjMwMTk1Mzg2","avatar_url":"https://avatars1.githubusercontent.com/u/30195386?v=4","gravatar_id":"","url":"https://api.github.com/users/mhmen","html_url":"https://github.com/mhmen","followers_url":"https://api.github.com/users/mhmen/followers","following_url":"https://api.github.com/users/mhmen/following{/other_user}","gists_url":"https://api.github.com/users/mhmen/gists{/gist_id}","starred_url":"https://api.github.com/users/mhmen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhmen/subscriptions","organizations_url":"https://api.github.com/users/mhmen/orgs","repos_url":"https://api.github.com/users/mhmen/repos","events_url":"https://api.github.com/users/mhmen/events{/privacy}","received_events_url":"https://api.github.com/users/mhmen/received_events","type":"User","site_admin":false},"created_at":"2018-09-08T07:31:39Z","updated_at":"2018-09-08T07:32:01Z","author_association":"NONE","body":"Thank you very much\r\nIt seems it's working.\r\nAnother question is can I change the mapping in this way without reindexing the data indexed before?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419646319","html_url":"https://github.com/elastic/elasticsearch/issues/32977#issuecomment-419646319","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32977","id":419646319,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTY0NjMxOQ==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-09-08T14:33:40Z","updated_at":"2018-09-08T14:33:40Z","author_association":"CONTRIBUTOR","body":"@mhmen  you are welcome.\r\n\r\n> can I change the mapping in this way without reindexing the data indexed before?\r\n\r\nNo, it is not possible. You can add another field as a part of multi-fields (as shown in the example) which will affect only new inserted documents; for previously inserted documents this new field will be empty.\r\n\r\nClosing this ticket, as it is not an issue!\r\n\r\n","performed_via_github_app":null}]