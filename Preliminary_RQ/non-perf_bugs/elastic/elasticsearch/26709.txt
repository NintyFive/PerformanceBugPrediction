{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26709","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26709/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26709/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26709/events","html_url":"https://github.com/elastic/elasticsearch/issues/26709","id":258844160,"node_id":"MDU6SXNzdWUyNTg4NDQxNjA=","number":26709,"title":"Broken mapper-murmur3 java plugin for local nodes","user":{"login":"AlexKolpa","id":3596362,"node_id":"MDQ6VXNlcjM1OTYzNjI=","avatar_url":"https://avatars2.githubusercontent.com/u/3596362?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexKolpa","html_url":"https://github.com/AlexKolpa","followers_url":"https://api.github.com/users/AlexKolpa/followers","following_url":"https://api.github.com/users/AlexKolpa/following{/other_user}","gists_url":"https://api.github.com/users/AlexKolpa/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexKolpa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexKolpa/subscriptions","organizations_url":"https://api.github.com/users/AlexKolpa/orgs","repos_url":"https://api.github.com/users/AlexKolpa/repos","events_url":"https://api.github.com/users/AlexKolpa/events{/privacy}","received_events_url":"https://api.github.com/users/AlexKolpa/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-09-19T14:34:25Z","updated_at":"2017-09-19T14:52:42Z","closed_at":"2017-09-19T14:48:56Z","author_association":"NONE","active_lock_reason":null,"body":"Bug report:\r\n\r\n**Elasticsearch version**: 5.3.3\r\n\r\n**Plugins installed**: [analysis-icu, x-pack, mapper-murmur3]\r\n\r\n**JVM version**: 1.8.0_144\r\n\r\n**OS version**: 4.12.8-2-ARCH\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nSince 5.2.0, the signature of `FieldMapper.parseCreateField` has changed from using `Field` to `IndexableField` (see 1792f1bb2b58aa6502466b3a06a9fb138e61b447 for change).\r\nAdditionally, in v5.0.0-beta1 the package for `TypeParsers` was changed from `org.elasticsearch.index.mapper.core` to `org.elasticsearch.index.mapper` (see 0d6ac57acf0d94315abd5d2dda48aac30e56246a for change).\r\n\r\nBecause the `org.elasticsearch.plugin:mapper-murmur3` is still on `5.0.0-alpha5`, it is not compatible with any release since ` v5.0.0-beta1` due to the aforementioned incompatible changes. Ideally a new version for this plugin would be released that is compatible with the latest versions. Right now we are forced to fork this plugin for our tests, where we set up a local node with these plugins.\r\n\r\n**Steps to reproduce**:\r\n\r\nUsing `org.elasticsearch:elasticsearch:5.3.3` and `org.elasticsearch.plugin:mapper-murmur3:5.0.0-alpha5`, extend and initialize a `Node` as follows:\r\n\r\n```java\r\nimport org.elasticsearch.common.settings.Settings;\r\nimport org.elasticsearch.node.InternalSettingsPreparer;\r\nimport org.elasticsearch.node.Node;\r\nimport org.elasticsearch.plugin.mapper.MapperMurmur3Plugin;\r\n\r\nprivate class NodeWithPlugins extends Node {\r\n\tNodeWithPlugins(Settings settings, Collection<Class<? extends Plugin>> classpathPlugins) {\r\n\t\tsuper(InternalSettingsPreparer.prepareEnvironment(settings, null), classpathPlugins);\r\n\t}\r\n\r\n\tpublic static void main(String[] args) {\r\n\t\tNode node = new NodeWithPlugins(<settings>, new ArrayList<>(MapperMurmur3Plugin.class));\r\n\t\tnode.start();\r\n\t}\r\n}\r\n```\r\n\r\n**Provide logs (if relevant)**: Here is the ClassDefNotFoundError:\r\n\r\n```java\r\njava.lang.NoClassDefFoundError: org/elasticsearch/index/mapper/core/TypeParsers\r\n\tat org.elasticsearch.index.mapper.murmur3.Murmur3FieldMapper$TypeParser.parse(Murmur3FieldMapper.java:99)\r\n\tat org.elasticsearch.index.mapper.TypeParsers.parseMultiField(TypeParsers.java:340)\r\n\tat org.elasticsearch.index.mapper.TypeParsers.parseField(TypeParsers.java:274)\r\n\tat org.elasticsearch.index.mapper.KeywordFieldMapper$TypeParser.parse(KeywordFieldMapper.java:158)\r\n\tat org.elasticsearch.index.mapper.ObjectMapper$TypeParser.parseProperties(ObjectMapper.java:277)\r\n\tat org.elasticsearch.index.mapper.ObjectMapper$TypeParser.parseObjectOrDocumentTypeProperties(ObjectMapper.java:199)\r\n\tat org.elasticsearch.index.mapper.RootObjectMapper$TypeParser.parse(RootObjectMapper.java:102)\r\n\tat org.elasticsearch.index.mapper.DocumentMapperParser.parse(DocumentMapperParser.java:111)\r\n\tat org.elasticsearch.index.mapper.DocumentMapperParser.parse(DocumentMapperParser.java:91)\r\n\tat org.elasticsearch.index.mapper.MapperService.internalMerge(MapperService.java:327)\r\n\tat org.elasticsearch.index.mapper.MapperService.merge(MapperService.java:258)\r\n\tat org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$1.execute(MetaDataCreateIndexService.java:371)\r\n\tat org.elasticsearch.cluster.ClusterStateUpdateTask.execute(ClusterStateUpdateTask.java:45)\r\n\tat org.elasticsearch.cluster.service.ClusterService.executeTasks(ClusterService.java:679)\r\n\tat org.elasticsearch.cluster.service.ClusterService.calculateTaskOutputs(ClusterService.java:658)\r\n\tat org.elasticsearch.cluster.service.ClusterService.runTasks(ClusterService.java:617)\r\n\tat org.elasticsearch.cluster.service.ClusterService$UpdateTask.run(ClusterService.java:1117)\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569)\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:238)\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:201)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.lang.ClassNotFoundException: org.elasticsearch.index.mapper.core.TypeParsers\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:381)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:335)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n\t... 23 more\r\n```","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}