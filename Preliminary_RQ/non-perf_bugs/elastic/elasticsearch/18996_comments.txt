[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227439140","html_url":"https://github.com/elastic/elasticsearch/issues/18996#issuecomment-227439140","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","id":227439140,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzQzOTE0MA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T13:28:15Z","updated_at":"2016-06-21T13:37:01Z","author_association":"MEMBER","body":"This has nothing to do with the serialization of the `ClusterStatsNodeResponse`, `vfs` is a JBoss thing and this silliness with JBoss and jar paths is a known issue. That said, I think we can address this. Can you try building Elasticsearch with this patch and let me know if it resolves the issue? I'll follow-up with a PR if it does.\n\n``` diff\ndiff --git a/core/src/main/java/org/elasticsearch/Build.java b/core/src/main/java/org/elasticsearch/Build.java\nindex f844e3b..7b2b829 100644\n--- a/core/src/main/java/org/elasticsearch/Build.java\n+++ b/core/src/main/java/org/elasticsearch/Build.java\n@@ -19,16 +19,11 @@\n\n package org.elasticsearch;\n\n-import org.elasticsearch.common.SuppressForbidden;\n-import org.elasticsearch.common.io.PathUtils;\n import org.elasticsearch.common.io.stream.StreamInput;\n import org.elasticsearch.common.io.stream.StreamOutput;\n\n import java.io.IOException;\n-import java.net.URISyntaxException;\n import java.net.URL;\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n import java.util.jar.JarInputStream;\n import java.util.jar.Manifest;\n\n@@ -47,9 +42,9 @@ public class Build {\n         final String date;\n         final boolean isSnapshot;\n\n-        Path path = getElasticsearchCodebase();\n-        if (path.toString().endsWith(\".jar\")) {\n-            try (JarInputStream jar = new JarInputStream(Files.newInputStream(path))) {\n+        final URL url = getElasticsearchCodebase();\n+        if (url.toString().endsWith(\".jar\")) {\n+            try (JarInputStream jar = new JarInputStream(url.openStream())) {\n                 Manifest manifest = jar.getManifest();\n                 shortHash = manifest.getMainAttributes().getValue(\"Change\");\n                 date = manifest.getMainAttributes().getValue(\"Build-Date\");\n@@ -80,14 +75,8 @@ public class Build {\n     /**\n      * Returns path to elasticsearch codebase path\n      */\n-    @SuppressForbidden(reason = \"looks up path of elasticsearch.jar directly\")\n-    static Path getElasticsearchCodebase() {\n-        URL url = Build.class.getProtectionDomain().getCodeSource().getLocation();\n-        try {\n-            return PathUtils.get(url.toURI());\n-        } catch (URISyntaxException bogus) {\n-            throw new RuntimeException(bogus);\n-        }\n+    static URL getElasticsearchCodebase() {\n+        return Build.class.getProtectionDomain().getCodeSource().getLocation();\n     }\n\n     private String shortHash;\ndiff --git a/core/src/test/java/org/elasticsearch/BuildTests.java b/core/src/test/java/org/elasticsearch/BuildTests.java\nindex f02d2f2..7bff832 100644\n--- a/core/src/test/java/org/elasticsearch/BuildTests.java\n+++ b/core/src/test/java/org/elasticsearch/BuildTests.java\n@@ -22,16 +22,16 @@ package org.elasticsearch;\n import org.elasticsearch.test.ESTestCase;\n\n import java.io.IOException;\n-import java.nio.file.AccessMode;\n-import java.nio.file.Path;\n+import java.io.InputStream;\n+import java.net.URL;\n\n public class BuildTests extends ESTestCase {\n\n     /** Asking for the jar metadata should not throw exception in tests, no matter how configured */\n     public void testJarMetadata() throws IOException {\n-        Path path = Build.getElasticsearchCodebase();\n+        URL url = Build.getElasticsearchCodebase();\n         // throws exception if does not exist, or we cannot access it\n-        path.getFileSystem().provider().checkAccess(path, AccessMode.READ);\n+        try (InputStream ignored = url.openStream()) {}\n         // these should never be null\n         assertNotNull(Build.CURRENT.date());\n         assertNotNull(Build.CURRENT.shortHash());\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227448756","html_url":"https://github.com/elastic/elasticsearch/issues/18996#issuecomment-227448756","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","id":227448756,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzQ0ODc1Ng==","user":{"login":"fassisrosa","id":17320639,"node_id":"MDQ6VXNlcjE3MzIwNjM5","avatar_url":"https://avatars0.githubusercontent.com/u/17320639?v=4","gravatar_id":"","url":"https://api.github.com/users/fassisrosa","html_url":"https://github.com/fassisrosa","followers_url":"https://api.github.com/users/fassisrosa/followers","following_url":"https://api.github.com/users/fassisrosa/following{/other_user}","gists_url":"https://api.github.com/users/fassisrosa/gists{/gist_id}","starred_url":"https://api.github.com/users/fassisrosa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fassisrosa/subscriptions","organizations_url":"https://api.github.com/users/fassisrosa/orgs","repos_url":"https://api.github.com/users/fassisrosa/repos","events_url":"https://api.github.com/users/fassisrosa/events{/privacy}","received_events_url":"https://api.github.com/users/fassisrosa/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T14:00:43Z","updated_at":"2016-06-21T14:00:43Z","author_association":"NONE","body":"I completely agree this is a JBoss silliness, it just reflects on the deserialization of this instance... Thanks for the super quick response... I'll give it a try and post my results here. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227463717","html_url":"https://github.com/elastic/elasticsearch/issues/18996#issuecomment-227463717","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","id":227463717,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzQ2MzcxNw==","user":{"login":"fassisrosa","id":17320639,"node_id":"MDQ6VXNlcjE3MzIwNjM5","avatar_url":"https://avatars0.githubusercontent.com/u/17320639?v=4","gravatar_id":"","url":"https://api.github.com/users/fassisrosa","html_url":"https://github.com/fassisrosa","followers_url":"https://api.github.com/users/fassisrosa/followers","following_url":"https://api.github.com/users/fassisrosa/following{/other_user}","gists_url":"https://api.github.com/users/fassisrosa/gists{/gist_id}","starred_url":"https://api.github.com/users/fassisrosa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fassisrosa/subscriptions","organizations_url":"https://api.github.com/users/fassisrosa/orgs","repos_url":"https://api.github.com/users/fassisrosa/repos","events_url":"https://api.github.com/users/fassisrosa/events{/privacy}","received_events_url":"https://api.github.com/users/fassisrosa/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T14:48:23Z","updated_at":"2016-06-21T14:48:49Z","author_association":"NONE","body":"Works like a charm for me (as url for JBoss ends in 'jar/' not 'jar' this ends up in 'Unknown' version).\nIf you can make this go into product (alpha4 onwards) that would be absolutely fantastic. \n\nThanks so much for the incredibly quick turnaround!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227469400","html_url":"https://github.com/elastic/elasticsearch/issues/18996#issuecomment-227469400","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","id":227469400,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzQ2OTQwMA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T15:05:15Z","updated_at":"2016-06-21T15:07:35Z","author_association":"MEMBER","body":"> Works like a charm for me (as url for JBoss ends in 'jar/' not 'jar' this ends up in 'Unknown' version.\n\nMore silliness; this appears to be [JBCL-177](https://issues.jboss.org/browse/JBCL-177) and I'm inclined to _not_ work around it here but at least we avoid the `vfs` provider not found now.\n\n> If you can make this go into product (alpha4 onwards) that would be absolutely fantastic.\n\nI'll try, no promises on alpha4.\n\n> Thanks so much for the incredibly quick turnaround!\n\nThanks for testing!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227504116","html_url":"https://github.com/elastic/elasticsearch/issues/18996#issuecomment-227504116","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","id":227504116,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzUwNDExNg==","user":{"login":"fassisrosa","id":17320639,"node_id":"MDQ6VXNlcjE3MzIwNjM5","avatar_url":"https://avatars0.githubusercontent.com/u/17320639?v=4","gravatar_id":"","url":"https://api.github.com/users/fassisrosa","html_url":"https://github.com/fassisrosa","followers_url":"https://api.github.com/users/fassisrosa/followers","following_url":"https://api.github.com/users/fassisrosa/following{/other_user}","gists_url":"https://api.github.com/users/fassisrosa/gists{/gist_id}","starred_url":"https://api.github.com/users/fassisrosa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fassisrosa/subscriptions","organizations_url":"https://api.github.com/users/fassisrosa/orgs","repos_url":"https://api.github.com/users/fassisrosa/repos","events_url":"https://api.github.com/users/fassisrosa/events{/privacy}","received_events_url":"https://api.github.com/users/fassisrosa/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T17:00:24Z","updated_at":"2016-06-21T17:00:24Z","author_association":"NONE","body":"No worries on JBCL-177. The trailing '/' does not impact me at all... it does generate the 'Unknown' but I can live with it for now. Avoiding the 'vfs' provider issue does it.\n\nWhatever you can do to make it to product is really appreciated. :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227505044","html_url":"https://github.com/elastic/elasticsearch/issues/18996#issuecomment-227505044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","id":227505044,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzUwNTA0NA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T17:03:35Z","updated_at":"2016-06-21T17:03:35Z","author_association":"MEMBER","body":"> Whatever you can do to make it to product is really appreciated. :)\n\nThe fix is integrated and will be in alpha4. :smile:\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227505615","html_url":"https://github.com/elastic/elasticsearch/issues/18996#issuecomment-227505615","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","id":227505615,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzUwNTYxNQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T17:05:44Z","updated_at":"2016-06-21T17:05:44Z","author_association":"MEMBER","body":"I've marked you as eligible for the [Pioneer Program](https://www.elastic.co/blog/elastic-pioneer-program); thanks for reporting!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227519020","html_url":"https://github.com/elastic/elasticsearch/issues/18996#issuecomment-227519020","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","id":227519020,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzUxOTAyMA==","user":{"login":"fassisrosa","id":17320639,"node_id":"MDQ6VXNlcjE3MzIwNjM5","avatar_url":"https://avatars0.githubusercontent.com/u/17320639?v=4","gravatar_id":"","url":"https://api.github.com/users/fassisrosa","html_url":"https://github.com/fassisrosa","followers_url":"https://api.github.com/users/fassisrosa/followers","following_url":"https://api.github.com/users/fassisrosa/following{/other_user}","gists_url":"https://api.github.com/users/fassisrosa/gists{/gist_id}","starred_url":"https://api.github.com/users/fassisrosa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fassisrosa/subscriptions","organizations_url":"https://api.github.com/users/fassisrosa/orgs","repos_url":"https://api.github.com/users/fassisrosa/repos","events_url":"https://api.github.com/users/fassisrosa/events{/privacy}","received_events_url":"https://api.github.com/users/fassisrosa/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T17:52:56Z","updated_at":"2016-06-21T17:52:56Z","author_association":"NONE","body":"Thanks! :)\n","performed_via_github_app":null}]