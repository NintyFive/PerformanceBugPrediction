{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26758","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26758/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26758/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26758/events","html_url":"https://github.com/elastic/elasticsearch/issues/26758","id":259906332,"node_id":"MDU6SXNzdWUyNTk5MDYzMzI=","number":26758,"title":"[CI] org.elasticsearch.index.reindex.CancelTests","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2017-09-22T18:55:42Z","updated_at":"2018-02-13T19:41:34Z","closed_at":"2018-01-30T23:11:43Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"It looks like the reindex response times out because some slice tasks don't complete in time (though they do appear to all acknowledge the cancellation). I couldn't find a cause. Neither of these reproduce, and they fail very rarely.\r\n\r\n1. \r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.5+multijob-unix-compatibility/os=fedora/141\r\n\r\n```\r\nERROR   32.1s J0 | CancelTests.testUpdateByQueryCancelWithWorkers <<< FAILURES!\r\n   > Throwable #1: java.lang.RuntimeException: Exception while waiting for the response. Running tasks: {\"tasks\":{\"ip0U-jljTBy-m2SBtaJb1g:2794\":{\"node\":\"ip0U-jljTBy-m2SBtaJb1g\",\"id\":2794,\"type\":\"transport\",\"action\":\"indices:data/write/update/byquery\",\"status\":{\"slice_id\":3,\"total\":102,\"updated\":1,\"created\":0,\"deleted\":0,\"batches\":1,\"version_conflicts\":0,\"noops\":0,\"retries\":{\"bulk\":0,\"search\":0},\"throttled_millis\":0,\"requests_per_second\":0.0,\"canceled\":\"by user request\",\"throttled_until_millis\":9223372006812},\"description\":\"update-by-query [reindex-cancel-index]\",\"start_time_in_millis\":1505837598023,\"running_time_in_nanos\":30191506121,\"cancellable\":true,\"parent_task_id\":\"ip0U-jljTBy-m2SBtaJb1g:2754\"},\"ip0U-jljTBy-m2SBtaJb1g:2796\":{\"node\":\"ip0U-jljTBy-m2SBtaJb1g\",\"id\":2796,\"type\":\"transport\",\"action\":\"indices:data/write/update/byquery\",\"status\":{\"slice_id\":4,\"total\":62,\"updated\":1,\"created\":0,\"deleted\":0,\"batches\":1,\"version_conflicts\":0,\"noops\":0,\"retries\":{\"bulk\":0,\"search\":0},\"throttled_millis\":0,\"requests_per_second\":0.0,\"canceled\":\"by user request\",\"throttled_until_millis\":9223372006813},\"description\":\"update-by-query [reindex-cancel-index]\",\"start_time_in_millis\":1505837598024,\"running_time_in_nanos\":30190750346,\"cancellable\":true,\"parent_task_id\":\"ip0U-jljTBy-m2SBtaJb1g:2754\"}}}\r\n   > \tat __randomizedtesting.SeedInfo.seed([75824B2D7BD47309:BA7D75A63797A55B]:0)\r\n   > \tat org.elasticsearch.index.reindex.CancelTests.testCancel(CancelTests.java:168)\r\n   > \tat org.elasticsearch.index.reindex.CancelTests.testUpdateByQueryCancelWithWorkers(CancelTests.java:249)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: java.util.concurrent.TimeoutException: Timeout waiting for task.\r\n   > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:232)\r\n   > \tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:67)\r\n   > \tat org.elasticsearch.index.reindex.CancelTests.testCancel(CancelTests.java:164)\r\n   > \t... 38 more\r\n```\r\n\r\n```\r\n  2> REPRODUCE WITH: gradle :modules:reindex:test -Dtests.seed=75824B2D7BD47309 -Dtests.class=org.elasticsearch.index.reindex.CancelTests -Dtests.method=\"testUpdateByQueryCancelWithWorkers\" -Dtests.security.manager=true -Dtests.locale=vi -Dtests.timezone=Africa/Addis_Ababa\r\n```\r\n\r\n[build-141-CancelTests.txt](https://github.com/elastic/elasticsearch/files/1325536/build-141-CancelTests.txt)\r\n\r\n\r\n2. \r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.5+multijob-unix-compatibility/os=fedora/147\r\n\r\n```\r\nERROR   30.8s J0 | CancelTests.testDeleteByQueryCancelWithWorkers <<< FAILURES!\r\n   > Throwable #1: java.lang.RuntimeException: Exception while waiting for the response. Running tasks: {\"tasks\":{\"hyCyfCVLTeezK3EWp56Kkg:5514\":{\"node\":\"hyCyfCVLTeezK3EWp56Kkg\",\"id\":5514,\"type\":\"transport\",\"action\":\"indices:data/write/delete/byquery\",\"status\":{\"slice_id\":4,\"total\":22,\"updated\":0,\"created\":0,\"deleted\":10,\"batches\":10,\"version_conflicts\":0,\"noops\":0,\"retries\":{\"bulk\":0,\"search\":0},\"throttled_millis\":0,\"requests_per_second\":0.0,\"canceled\":\"by user request\",\"throttled_until_millis\":9223372006847},\"description\":\"delete-by-query [reindex-cancel-index]\",\"start_time_in_millis\":1506007215407,\"running_time_in_nanos\":30092761872,\"cancellable\":true,\"parent_task_id\":\"hyCyfCVLTeezK3EWp56Kkg:5491\"},\"hyCyfCVLTeezK3EWp56Kkg:5492\":{\"node\":\"hyCyfCVLTeezK3EWp56Kkg\",\"id\":5492,\"type\":\"transport\",\"action\":\"indices:data/write/delete/byquery\",\"status\":{\"slice_id\":0,\"total\":20,\"updated\":0,\"created\":0,\"deleted\":13,\"batches\":13,\"version_conflicts\":0,\"noops\":0,\"retries\":{\"bulk\":0,\"search\":0},\"throttled_millis\":0,\"requests_per_second\":0.0,\"canceled\":\"by user request\",\"throttled_until_millis\":9223372006847},\"description\":\"delete-by-query [reindex-cancel-index]\",\"start_time_in_millis\":1506007215384,\"running_time_in_nanos\":30116660285,\"cancellable\":true,\"parent_task_id\":\"hyCyfCVLTeezK3EWp56Kkg:5491\"}}}\r\n   > \tat __randomizedtesting.SeedInfo.seed([C3AA7D4DC8ACFF46:8CDCB30F1668EBA1]:0)\r\n   > \tat org.elasticsearch.index.reindex.CancelTests.testCancel(CancelTests.java:168)\r\n   > \tat org.elasticsearch.index.reindex.CancelTests.testDeleteByQueryCancelWithWorkers(CancelTests.java:259)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: java.util.concurrent.TimeoutException: Timeout waiting for task.\r\n   > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:232)\r\n   > \tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:67)\r\n   > \tat org.elasticsearch.index.reindex.CancelTests.testCancel(CancelTests.java:164)\r\n   > \t... 38 more\r\n```\r\n\r\n```\r\n  2> REPRODUCE WITH: gradle :modules:reindex:test -Dtests.seed=C3AA7D4DC8ACFF46 -Dtests.class=org.elasticsearch.index.reindex.CancelTests -Dtests.method=\"testDeleteByQueryCancelWithWorkers\" -Dtests.security.manager=true -Dtests.locale=sl-SI -Dtests.timezone=Europe/Zurich\r\n```\r\n\r\n[build-147-CancelTests.txt](https://github.com/elastic/elasticsearch/files/1325537/build-147-CancelTests.txt)\r\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}