[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63291998","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-63291998","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":63291998,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMjkxOTk4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T11:30:16Z","updated_at":"2014-11-17T11:30:16Z","author_association":"CONTRIBUTOR","body":"Hi @aaneja \n\nClosing in favour of #8424\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63344776","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-63344776","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":63344776,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzQ0Nzc2","user":{"login":"aaneja","id":1797669,"node_id":"MDQ6VXNlcjE3OTc2Njk=","avatar_url":"https://avatars2.githubusercontent.com/u/1797669?v=4","gravatar_id":"","url":"https://api.github.com/users/aaneja","html_url":"https://github.com/aaneja","followers_url":"https://api.github.com/users/aaneja/followers","following_url":"https://api.github.com/users/aaneja/following{/other_user}","gists_url":"https://api.github.com/users/aaneja/gists{/gist_id}","starred_url":"https://api.github.com/users/aaneja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aaneja/subscriptions","organizations_url":"https://api.github.com/users/aaneja/orgs","repos_url":"https://api.github.com/users/aaneja/repos","events_url":"https://api.github.com/users/aaneja/events{/privacy}","received_events_url":"https://api.github.com/users/aaneja/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T17:50:14Z","updated_at":"2014-11-17T17:50:14Z","author_association":"NONE","body":"I read the related issue and the documentation for date rounding (http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-date-format.html#date-math)\n\nIt appears that date rounding is to the nearest second - if this is so, and I want millisecond precision is my only option passing range values as UNIX millisecond timestamps ?\n(If I use : \n\n```\n{\n  \"range\": {\n    \"context.data.eventTime\": {\n      \"gte\": \"1415804099000\",\n      \"lte\": \"1415804100000\"\n    }\n  }\n}\n```\n\nI get right results - no records match)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63346471","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-63346471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":63346471,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzQ2NDcx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T18:00:33Z","updated_at":"2014-11-17T18:00:33Z","author_association":"CONTRIBUTOR","body":"Rounding only happens if you specify it, eg \"some_date/d\"\n\nWhat's happening is that the `date_format` that you're using (`dateOptionalTime`) doesn't include milliseconds. So milliseconds are being ignored both in the values that you index AND in the range clause.  Try using `basic_date_time`.  See http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-date-format.html#built-in\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63351396","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-63351396","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":63351396,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzUxMzk2","user":{"login":"aaneja","id":1797669,"node_id":"MDQ6VXNlcjE3OTc2Njk=","avatar_url":"https://avatars2.githubusercontent.com/u/1797669?v=4","gravatar_id":"","url":"https://api.github.com/users/aaneja","html_url":"https://github.com/aaneja","followers_url":"https://api.github.com/users/aaneja/followers","following_url":"https://api.github.com/users/aaneja/following{/other_user}","gists_url":"https://api.github.com/users/aaneja/gists{/gist_id}","starred_url":"https://api.github.com/users/aaneja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aaneja/subscriptions","organizations_url":"https://api.github.com/users/aaneja/orgs","repos_url":"https://api.github.com/users/aaneja/repos","events_url":"https://api.github.com/users/aaneja/events{/privacy}","received_events_url":"https://api.github.com/users/aaneja/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T18:32:21Z","updated_at":"2014-11-17T18:32:21Z","author_association":"NONE","body":"I think `dateOptionalTime` does include milliseconds on indexing. As you see from above one of the records has timestamp : \"2014-11-12T14:55:00.1458607Z\" which in UNIX milliseconds is 1415804100145.\n\nI ran a query with \n\n```\n{\n  \"range\": {\n    \"context.data.eventTime\": {\n      \"gte\": \"1415804100145\",\n      \"lte\": \"1415804100145\"\n    }\n  }\n}\n```\n\nand this record matched. If I try the same range filter with 1415804100146 - 1415804100149 no records match \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63351754","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-63351754","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":63351754,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzUxNzU0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T18:34:42Z","updated_at":"2014-11-17T18:34:42Z","author_association":"CONTRIBUTOR","body":"Hmm you may be right - I'll have to take another look at this one tomorrow\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63682373","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-63682373","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":63682373,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNjgyMzcz","user":{"login":"aaneja","id":1797669,"node_id":"MDQ6VXNlcjE3OTc2Njk=","avatar_url":"https://avatars2.githubusercontent.com/u/1797669?v=4","gravatar_id":"","url":"https://api.github.com/users/aaneja","html_url":"https://github.com/aaneja","followers_url":"https://api.github.com/users/aaneja/followers","following_url":"https://api.github.com/users/aaneja/following{/other_user}","gists_url":"https://api.github.com/users/aaneja/gists{/gist_id}","starred_url":"https://api.github.com/users/aaneja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aaneja/subscriptions","organizations_url":"https://api.github.com/users/aaneja/orgs","repos_url":"https://api.github.com/users/aaneja/repos","events_url":"https://api.github.com/users/aaneja/events{/privacy}","received_events_url":"https://api.github.com/users/aaneja/received_events","type":"User","site_admin":false},"created_at":"2014-11-19T17:50:45Z","updated_at":"2014-11-19T17:50:45Z","author_association":"NONE","body":"Ping. Any updates on what the expected behavior of `dateOptionalTime` should be ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64183925","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-64183925","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":64183925,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTgzOTI1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-24T11:51:26Z","updated_at":"2014-11-24T11:51:26Z","author_association":"CONTRIBUTOR","body":"Hi @aaneja \n\nSo you're correct: `dateOptionalTime` does include milliseconds.  But I can't replicate your findings.  Your query correctly returns no results when I run it.  I tried on 1.2.1, 1.3.4, and 1.4.0.\n\nDo you perhaps have another field with the same name but a different mapping?  Can you provide a working recreation of this issue? What version of Elasticsearch are you running?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65731094","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-65731094","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":65731094,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NzMxMDk0","user":{"login":"aaneja","id":1797669,"node_id":"MDQ6VXNlcjE3OTc2Njk=","avatar_url":"https://avatars2.githubusercontent.com/u/1797669?v=4","gravatar_id":"","url":"https://api.github.com/users/aaneja","html_url":"https://github.com/aaneja","followers_url":"https://api.github.com/users/aaneja/followers","following_url":"https://api.github.com/users/aaneja/following{/other_user}","gists_url":"https://api.github.com/users/aaneja/gists{/gist_id}","starred_url":"https://api.github.com/users/aaneja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aaneja/subscriptions","organizations_url":"https://api.github.com/users/aaneja/orgs","repos_url":"https://api.github.com/users/aaneja/repos","events_url":"https://api.github.com/users/aaneja/events{/privacy}","received_events_url":"https://api.github.com/users/aaneja/received_events","type":"User","site_admin":false},"created_at":"2014-12-05T00:50:34Z","updated_at":"2014-12-05T00:50:34Z","author_association":"NONE","body":"Here's a repro -\n`GET /`\nResponse  -\n\n```\n{\n   \"status\": 200,\n   \"name\": \"Terror\",\n   \"version\": {\n      \"number\": \"1.3.2\",\n      \"build_hash\": \"dee175dbe2f254f3f26992f5d7591939aaefd12f\",\n      \"build_timestamp\": \"2014-08-13T14:29:30Z\",\n      \"build_snapshot\": false,\n      \"lucene_version\": \"4.9\"\n   },\n   \"tagline\": \"You Know, for Search\"\n}\n```\n\nThen -\n\n```\nDELETE /megacorp/tweet\n\nPUT /megacorp/_mapping/tweet\n{\n    \"tweet\" : {\n        \"properties\": {\n              \"eventTime\": {\n                \"type\": \"date\",\n                \"format\": \"dateOptionalTime\"\n              }\n            }\n    }\n}\n\nPUT /megacorp/tweet/1?pretty\n{\n  \"eventTime\": 1415832900146\n}\n\nPUT /megacorp/tweet/2?pretty\n{\n  \"eventTime\": 1415832900597\n}\n\n\nPOST /megacorp/tweet/_search\n{\n  \"size\": 14,\n  \"_source\": \"eventTime\",\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"range\": {\n                \"eventTime\": {\n                  \"gte\": \"2014-11-12T22:54:00Z\",\n                  \"lte\": \"2014-11-12T22:55:00Z\"\n                }\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n\n\nPOST /megacorp/tweet/_search\n{\n  \"size\": 14,\n  \"_source\": \"eventTime\",\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"range\": {\n                \"eventTime\": {\n                  \"gte\": 1415832840000,\n                  \"lte\": 1415832900000\n                }\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\nThe last two queries should be, IMO, equivalent.\nHowever I get incorrect results in the first one; the second one correctly matches no records\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65862589","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-65862589","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":65862589,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODYyNTg5","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2014-12-05T22:08:58Z","updated_at":"2014-12-05T22:08:58Z","author_association":"MEMBER","body":"I've tracked this down to a bug in the date parser and am working on a fix.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66207623","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-66207623","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":66207623,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MjA3NjIz","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2014-12-08T23:24:26Z","updated_at":"2014-12-08T23:24:26Z","author_association":"MEMBER","body":"I have a fix in #8834.  Note that this is really a first step towards eliminating the two different parsing functions in the date math parser (see #8598).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66368652","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-66368652","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":66368652,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MzY4NjUy","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2014-12-09T22:16:14Z","updated_at":"2014-12-09T22:16:14Z","author_association":"MEMBER","body":"After discussing the further, I think the best immediate fix here is to set `mapping.date.round_ceil = false`.  This should fix the problem described above (essentially doing via configuration what my patch in #8834 does).  In order to not introduce breaking behavior, I am going to drop #8834 entirely and work on the full removal of `mapping.date.round_ceil` for #8598.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66554752","html_url":"https://github.com/elastic/elasticsearch/issues/8490#issuecomment-66554752","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8490","id":66554752,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NTU0NzUy","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2014-12-11T01:18:01Z","updated_at":"2014-12-11T01:18:01Z","author_association":"MEMBER","body":"I'm closing this in favor of #8598 which will be fixed for 2.0.\n","performed_via_github_app":null}]