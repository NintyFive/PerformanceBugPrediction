{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11529","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11529/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11529/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11529/events","html_url":"https://github.com/elastic/elasticsearch/issues/11529","id":85916716,"node_id":"MDU6SXNzdWU4NTkxNjcxNg==","number":11529,"title":"similarity model is not parsed at mappings","user":{"login":"yu-dk","id":1012110,"node_id":"MDQ6VXNlcjEwMTIxMTA=","avatar_url":"https://avatars0.githubusercontent.com/u/1012110?v=4","gravatar_id":"","url":"https://api.github.com/users/yu-dk","html_url":"https://github.com/yu-dk","followers_url":"https://api.github.com/users/yu-dk/followers","following_url":"https://api.github.com/users/yu-dk/following{/other_user}","gists_url":"https://api.github.com/users/yu-dk/gists{/gist_id}","starred_url":"https://api.github.com/users/yu-dk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yu-dk/subscriptions","organizations_url":"https://api.github.com/users/yu-dk/orgs","repos_url":"https://api.github.com/users/yu-dk/repos","events_url":"https://api.github.com/users/yu-dk/events{/privacy}","received_events_url":"https://api.github.com/users/yu-dk/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"assignees":[{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2015-06-07T16:41:42Z","updated_at":"2015-06-09T10:46:07Z","closed_at":"2015-06-09T10:46:06Z","author_association":"NONE","active_lock_reason":null,"body":"Dear ES developers, I have been troubled by this issue for two days -- really need help\nit's about use custom similarity module in ES. \nI wrote my own SimilarityProvider module as here, https://github.com/aimeida/tryES2/tree/master/src/main/java/com/unsilo/paysim\ncompiled it to a jar file and throw to ES lib path. \n\nthen I try send the following index:\n\n``` javascript\nPUT /test\n{\n  \"settings\" : {\n  \"similarity\" : {\n    \"my_similarity1\" : {\n       \"type\": \"com.unsilo.paysim.index.PayWeightSimilarityProvider\"\n      },\n    \"my_similarity2\" : {\n          \"type\" : \"DFR\",\n          \"basic_model\": \"g\",\n            \"after_effect\" : \"l\",\n            \"normalization\" : \"h2\",\n            \"normalization.h2.c\" : \"3.0\"\n      }\n  }\n  }\n}\n\nPUT /test/docs/_mapping\n{\n      \"properties\" : {\n        \"content\" : {\n          \"type\": \"string\",\n          \"similarity\" : \"my_similarity2\"\n        }\n      }\n}\n```\n\neverything works fine. Now I want to see the mappings that has been parsed, \n\n``` javascript\nGET /test/_mappings\n```\n\ngives me the right results (note that my_similarity2 is part of the ES similarity modules)\n\n``` javascript\n {\n   \"test\": {\n      \"mappings\": {\n         \"docs\": {\n            \"properties\": {\n               \"content\": {\n                  \"type\": \"string\",\n                  \"similarity\": \"my_similarity2\"\n               }\n            }\n         }\n      }\n   }\n}\n```\n\nHowever, when I try to set the mapping using my own similarity modules,\n\n``` javascript\nPUT /test/docs/_mapping\n{\n      \"properties\" : {\n        \"content\" : {\n          \"type\": \"string\",\n          \"similarity\" : \"my_similarity1\"\n        }\n      }\n}\n```\n\nES doesn't report any error, so I check the mapping again:\n\n``` javascript\nGET /test/_mappings\n```\n\nIt's obvious that my similarity setting is completely ignored!!\n\n``` javascript\n {\n   \"test\": {\n      \"mappings\": {\n         \"docs\": {\n            \"properties\": {\n               \"content\": {\n                  \"type\": \"string\"\n               }\n            }\n         }\n      }\n   }\n}\n```\n\nI really don't understand what happens... the settings seems to be right\n\n``` javascript\n{\n   \"test\": {\n      \"settings\": {\n         \"index\": {\n            \"creation_date\": \"1433694379354\",\n            \"number_of_shards\": \"5\",\n            \"number_of_replicas\": \"1\",\n            \"version\": {\n               \"created\": \"1050199\"\n            },\n            \"uuid\": \"0v33M9g5TYaKVWxymyhNLQ\",\n            \"similarity\": {\n               \"my_similarity1\": {\n                  \"type\": \"com.unsilo.paysim.index.PayWeightSimilarityProvider\"\n               },\n               \"my_similarity2\": {\n                  \"basic_model\": \"g\",\n                  \"type\": \"DFR\",\n                  \"normalization\": \"h2\",\n                  \"normalization.h2\": {\n                     \"c\": \"3.0\"\n                  },\n                  \"after_effect\": \"l\"\n               }\n            }\n         }\n      }\n   }\n}\n```\n\nI haven't been able to run ES in debug mode yet, so can't figure out what is wrong. Moreover, I also tried writing the similarity module as a plugin, the same thing happens -- ES doesn't register(properly) or call my module at all...\n\nPlease share your opinions and ideas !\n","closed_by":{"login":"yu-dk","id":1012110,"node_id":"MDQ6VXNlcjEwMTIxMTA=","avatar_url":"https://avatars0.githubusercontent.com/u/1012110?v=4","gravatar_id":"","url":"https://api.github.com/users/yu-dk","html_url":"https://github.com/yu-dk","followers_url":"https://api.github.com/users/yu-dk/followers","following_url":"https://api.github.com/users/yu-dk/following{/other_user}","gists_url":"https://api.github.com/users/yu-dk/gists{/gist_id}","starred_url":"https://api.github.com/users/yu-dk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yu-dk/subscriptions","organizations_url":"https://api.github.com/users/yu-dk/orgs","repos_url":"https://api.github.com/users/yu-dk/repos","events_url":"https://api.github.com/users/yu-dk/events{/privacy}","received_events_url":"https://api.github.com/users/yu-dk/received_events","type":"User","site_admin":false},"performed_via_github_app":null}