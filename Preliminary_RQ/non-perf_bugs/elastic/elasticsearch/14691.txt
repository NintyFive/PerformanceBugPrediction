{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14691","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14691/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14691/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14691/events","html_url":"https://github.com/elastic/elasticsearch/issues/14691","id":116361111,"node_id":"MDU6SXNzdWUxMTYzNjExMTE=","number":14691,"title":"Percentiles aggregation: method parsing issues","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":{"login":"debadair","id":362578,"node_id":"MDQ6VXNlcjM2MjU3OA==","avatar_url":"https://avatars1.githubusercontent.com/u/362578?v=4","gravatar_id":"","url":"https://api.github.com/users/debadair","html_url":"https://github.com/debadair","followers_url":"https://api.github.com/users/debadair/followers","following_url":"https://api.github.com/users/debadair/following{/other_user}","gists_url":"https://api.github.com/users/debadair/gists{/gist_id}","starred_url":"https://api.github.com/users/debadair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/debadair/subscriptions","organizations_url":"https://api.github.com/users/debadair/orgs","repos_url":"https://api.github.com/users/debadair/repos","events_url":"https://api.github.com/users/debadair/events{/privacy}","received_events_url":"https://api.github.com/users/debadair/received_events","type":"User","site_admin":false},"assignees":[{"login":"debadair","id":362578,"node_id":"MDQ6VXNlcjM2MjU3OA==","avatar_url":"https://avatars1.githubusercontent.com/u/362578?v=4","gravatar_id":"","url":"https://api.github.com/users/debadair","html_url":"https://github.com/debadair","followers_url":"https://api.github.com/users/debadair/followers","following_url":"https://api.github.com/users/debadair/following{/other_user}","gists_url":"https://api.github.com/users/debadair/gists{/gist_id}","starred_url":"https://api.github.com/users/debadair/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/debadair/subscriptions","organizations_url":"https://api.github.com/users/debadair/orgs","repos_url":"https://api.github.com/users/debadair/repos","events_url":"https://api.github.com/users/debadair/events{/privacy}","received_events_url":"https://api.github.com/users/debadair/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2015-11-11T15:44:21Z","updated_at":"2018-07-31T21:45:15Z","closed_at":"2018-07-31T21:45:14Z","author_association":"MEMBER","active_lock_reason":null,"body":"Currently, although tdigest is the default method, `compression` can only be set if it's wrapped in a `tdigest` object:\n\n```\n{\n    \"aggs\" : {\n        \"load_time_outlier\" : {\n            \"percentiles\" : {\n                \"field\" : \"load_time\",\n                \"tdigest\": {\n                    \"compression\": 200\n                }\n            }\n        }\n    }\n}\n```\n\nOtherwise, the following exception is thrown: `Unexpected token VALUE_NUMBER in [load_time_outlier].`\n\nThe [documentation](https://www.elastic.co/guide/en/elasticsearch/reference/2.0/search-aggregations-metrics-percentile-aggregation.html#search-aggregations-metrics-percentile-aggregation-compression) however states that it can be set at the root agg level:\n\n```\n{\n    \"aggs\" : {\n        \"load_time_outlier\" : {\n            \"percentiles\" : {\n                \"field\" : \"load_time\",\n                \"compression\" : 200 \n            }\n        }\n    }\n}\n```\n\nOn a similar note, the hdr histogram can only be provided as an object as well:\n\n```\n{\n    \"aggs\" : {\n        \"load_time_outlier\" : {\n            \"percentiles\" : {\n                \"field\" : \"load_time\",\n                \"hdr\": {\n                    \"number_of_significant_value_digits\" : 3\n                }\n            }\n        }\n    }\n}\n```\n\nbut the documentation states that it can be specified as so:\n\n```\n{\n    \"aggs\" : {\n        \"load_time_outlier\" : {\n            \"percentiles\" : {\n                \"field\" : \"load_time\",\n                \"percents\" : [95, 99, 99.9],\n                \"method\" : \"hdr\", \n                \"number_of_significant_value_digits\" : 3 \n            }\n        }\n    }\n}\n```\n\nI think the objects make sense, since there are options that only pertain to certain methods, but I think `compression` should still be allowed at the root level if a method isn't specified, since tdigest is taken by default.\n","closed_by":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"performed_via_github_app":null}