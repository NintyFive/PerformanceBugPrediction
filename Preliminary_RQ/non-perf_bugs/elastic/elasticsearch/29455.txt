{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29455","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29455/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29455/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29455/events","html_url":"https://github.com/elastic/elasticsearch/issues/29455","id":313016315,"node_id":"MDU6SXNzdWUzMTMwMTYzMTU=","number":29455,"title":"Cross-Cluster search security exception in Chrome","user":{"login":"DaveyDevOps","id":34562546,"node_id":"MDQ6VXNlcjM0NTYyNTQ2","avatar_url":"https://avatars0.githubusercontent.com/u/34562546?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveyDevOps","html_url":"https://github.com/DaveyDevOps","followers_url":"https://api.github.com/users/DaveyDevOps/followers","following_url":"https://api.github.com/users/DaveyDevOps/following{/other_user}","gists_url":"https://api.github.com/users/DaveyDevOps/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveyDevOps/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveyDevOps/subscriptions","organizations_url":"https://api.github.com/users/DaveyDevOps/orgs","repos_url":"https://api.github.com/users/DaveyDevOps/repos","events_url":"https://api.github.com/users/DaveyDevOps/events{/privacy}","received_events_url":"https://api.github.com/users/DaveyDevOps/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-04-10T17:19:28Z","updated_at":"2018-04-11T21:14:02Z","closed_at":"2018-04-10T20:17:03Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):  \r\nVersion: 6.2.2, Build: 10b1edd/2018-02-16T19:01:30.685723Z, JVM: 1.8.0_121\r\nand \r\nVersion: 5.6.6, Build: 7d99d36/2018-01-09T23:55:47.880Z, JVM: 1.8.0_121\r\n\r\n**Plugins installed**: [x-pack, repository-hdfs]\r\n\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_121\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_121-tdc1-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nSLES Linux  3.0.101-0.113.TDC.1.R.0-default  SMP Fri Dec 9 04:51:20 PST 2016 (ca32437) x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Chrome version:**\r\nVersion 65.0.3325.181 (Official Build) (64-bit)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWe setup a proof of concept Cross-cluster search between our \"local\" 6x cluster and \"remote\" 5x cluster. \r\nWe were able to achieve the same results described in the [examples.](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cross-cluster-search.html)\r\nHowever did some additional exploration of how cross-cluster search behaves. \r\nIn Chrome:\r\n`https://our.elastic.url/5x:remote_index,local_index/_search` \r\nbehaves as expected but searching the remote index alone \r\n`https://our.elastic.url/5x:remote_index/_search`\r\nreturns\r\n```json\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"security_exception\",\r\n        \"reason\": \"action [indices:admin/shards/search_shards] requires authentication\",\r\n        \"header\": {\r\n          \"WWW-Authenticate\": \"Basic realm=\\\"security\\\" charset=\\\"UTF-8\\\"\"\r\n        }\r\n      }\r\n    ],\r\n    \"type\": \"transport_exception\",\r\n    \"reason\": \"unable to communicate with remote cluster [DEV35x]\",\r\n    \"caused_by\": {\r\n      \"type\": \"security_exception\",\r\n      \"reason\": \"action [indices:admin/shards/search_shards] requires authentication\",\r\n      \"header\": {\r\n        \"WWW-Authenticate\": \"Basic realm=\\\"security\\\" charset=\\\"UTF-8\\\"\"\r\n      }\r\n    }\r\n  },\r\n  \"status\": 500\r\n}\r\n```\r\nChrome developer tools show that the authenticate header is not being sent in the request (missing a 401 check/response?). \r\n\r\nThe same call (searching the remote index alone) return results in Kibana DEV tools, Internet Explorer and curl. \r\n\r\nWhile the behavior seems to be limited to Chrome I thought it was still good to share. \r\nThank you.  \r\n\r\n**Steps to reproduce**:\r\n\r\nInitially both clusters were hosted on the same set of machines. Later tested on separate machines, today I tested between two 6x clusters and continue to see the security exception.  \r\n\r\n 1. Setup Cross-cluster search to a `remote_cluster` and create a `remote_index` where authentication will be required\r\n 2.  In Kibana DEV tools `GET /remote_cluster:remote_index/_search` should return results\r\n 3. Access from Chrome `https://elastichost:port/remote_cluster:remote_index/_search` should return the security exception \r\n \r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}