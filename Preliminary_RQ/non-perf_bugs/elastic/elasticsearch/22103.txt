{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22103","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22103/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22103/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22103/events","html_url":"https://github.com/elastic/elasticsearch/issues/22103","id":194852696,"node_id":"MDU6SXNzdWUxOTQ4NTI2OTY=","number":22103,"title":"No logging when using layout.type = JSONLayout","user":{"login":"eht16","id":617017,"node_id":"MDQ6VXNlcjYxNzAxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/617017?v=4","gravatar_id":"","url":"https://api.github.com/users/eht16","html_url":"https://github.com/eht16","followers_url":"https://api.github.com/users/eht16/followers","following_url":"https://api.github.com/users/eht16/following{/other_user}","gists_url":"https://api.github.com/users/eht16/gists{/gist_id}","starred_url":"https://api.github.com/users/eht16/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eht16/subscriptions","organizations_url":"https://api.github.com/users/eht16/orgs","repos_url":"https://api.github.com/users/eht16/repos","events_url":"https://api.github.com/users/eht16/events{/privacy}","received_events_url":"https://api.github.com/users/eht16/received_events","type":"User","site_admin":false},"labels":[{"id":151561891,"node_id":"MDU6TGFiZWwxNTE1NjE4OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Logging","name":":Core/Infra/Logging","color":"0e8a16","default":false,"description":"Log management and logging utilities"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2016-12-11T20:07:02Z","updated_at":"2018-07-07T02:37:23Z","closed_at":"2016-12-23T14:39:41Z","author_association":"NONE","active_lock_reason":null,"body":"I tried to configure log4j2 to log JSON to a file.\r\nMy config:\r\n```properties\r\nappender.json_file.type = file\r\nappender.json_file.name = json_file\r\nappender.json_file.fileName = ${sys:es.logs}-json.log\r\nappender.json_file.layout.type = JSONLayout\r\nappender.json_file.layout.compact = true\r\nappender.json_file.layout.eventEol = true\r\n\r\nrootLogger.appenderRef.json_file.ref = json_file\r\n```\r\nFirst of, I got a backtrace like this:\r\n```\r\nDec 11 08:27:05 jankok elasticsearch[17255]: 2016-12-11 08:27:05,823 main ERROR Unable to invoke factory method in class class org.apache.logging.log4j.core.layout.JsonLayout for element JSONLayout. java.lang.reflect.InvocationTargetException\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at java.lang.reflect.Method.invoke(Method.java:498)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:132)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:942)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:882)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:874)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:498)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:227)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:239)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:530)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:258)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:116)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:83)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:272)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.cli.SettingCommand.execute(SettingCommand.java:54)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:96)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.cli.Command.main(Command.java:62)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:89)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:82)\r\nDec 11 08:27:05 jankok elasticsearch[17255]: Caused by: java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/ser/FilterProvider\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.layout.JsonLayout.<init>(JsonLayout.java:814)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at org.apache.logging.log4j.core.layout.JsonLayout.createLayout(JsonLayout.java:922)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         ... 24 more\r\nDec 11 08:27:05 jankok elasticsearch[17255]: Caused by: java.lang.ClassNotFoundException: com.fasterxml.jackson.databind.ser.FilterProvider\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)\r\nDec 11 08:27:05 jankok elasticsearch[17255]:         at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n```\r\n\r\nAfter downloading http://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-annotations/2.8.1/jackson-annotations-2.8.1.jar and http://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.8.1/jackson-databind-2.8.1.jar to /usr/share/elasticsearch/lib, the backtraces were gone but I also get no logging in JSON.\r\nThe logfile for the JSON appender keeps empty while normal logging continues to work.\r\n\r\n\r\nI'm not sure if I'm doing something wrong in some way or if JSON logging is simply not supported yet (maybe related to #8786).","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}