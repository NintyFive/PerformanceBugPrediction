{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26780","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26780/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26780/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26780/events","html_url":"https://github.com/elastic/elasticsearch/issues/26780","id":260352759,"node_id":"MDU6SXNzdWUyNjAzNTI3NTk=","number":26780,"title":"allow date math on 'now' with || operator and add recursive '||' processing","user":{"login":"rcrezende","id":604872,"node_id":"MDQ6VXNlcjYwNDg3Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/604872?v=4","gravatar_id":"","url":"https://api.github.com/users/rcrezende","html_url":"https://github.com/rcrezende","followers_url":"https://api.github.com/users/rcrezende/followers","following_url":"https://api.github.com/users/rcrezende/following{/other_user}","gists_url":"https://api.github.com/users/rcrezende/gists{/gist_id}","starred_url":"https://api.github.com/users/rcrezende/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rcrezende/subscriptions","organizations_url":"https://api.github.com/users/rcrezende/orgs","repos_url":"https://api.github.com/users/rcrezende/repos","events_url":"https://api.github.com/users/rcrezende/events{/privacy}","received_events_url":"https://api.github.com/users/rcrezende/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2017-09-25T17:20:36Z","updated_at":"2018-06-04T16:06:45Z","closed_at":"2018-06-04T16:06:44Z","author_association":"NONE","active_lock_reason":null,"body":"Because of only this 'else', there are two ways to do date math. If you use 'now' you can't use '||' operator. If you don't use 'now' you have to use '||' operators. See it here:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/ee802ad63c0f21d697a5095dd05dc6f94626ee4d/core/src/main/java/org/elasticsearch/common/joda/DateMathParser.java#L63\r\n\r\nThis special case adds unnecessary complexity when generating queries programatically.\r\n\r\nWithout such else, and maybe adding a code that keeps looking for additional '||', the user code can always just append ('||' + term) without special casing.\r\n\r\nif that is implemented, an expression like `\"now||-1d/d\"` is accepted.\r\nif the recursive \"||\" makes sense, then the expression `\"now||-1d/d||-1d||-1d\"` is also valid. Which could be interpreted two ways: or the last overrides all, so `-1d` is the only rounding operation applied. Or the result is `-1d` + rounding, then applied to this result `-2d`.","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}