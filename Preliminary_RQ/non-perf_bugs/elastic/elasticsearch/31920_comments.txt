[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403845715","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-403845715","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":403845715,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzg0NTcxNQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-10T14:36:24Z","updated_at":"2018-07-10T14:36:24Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403846240","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-403846240","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":403846240,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzg0NjI0MA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-07-10T14:37:50Z","updated_at":"2018-07-10T14:37:50Z","author_association":"MEMBER","body":"@ydzhu What information are you hoping to get from an avg aggregation when the document count is zero? Note that one reason that we emit null for the value in this case is that JSON does not support infinite and NaN values","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404204825","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-404204825","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":404204825,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDIwNDgyNQ==","user":{"login":"ydzhu","id":16932294,"node_id":"MDQ6VXNlcjE2OTMyMjk0","avatar_url":"https://avatars3.githubusercontent.com/u/16932294?v=4","gravatar_id":"","url":"https://api.github.com/users/ydzhu","html_url":"https://github.com/ydzhu","followers_url":"https://api.github.com/users/ydzhu/followers","following_url":"https://api.github.com/users/ydzhu/following{/other_user}","gists_url":"https://api.github.com/users/ydzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/ydzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydzhu/subscriptions","organizations_url":"https://api.github.com/users/ydzhu/orgs","repos_url":"https://api.github.com/users/ydzhu/repos","events_url":"https://api.github.com/users/ydzhu/events{/privacy}","received_events_url":"https://api.github.com/users/ydzhu/received_events","type":"User","site_admin":false},"created_at":"2018-07-11T15:09:37Z","updated_at":"2018-07-11T15:09:37Z","author_association":"NONE","body":"Because we need to handle this exceptional case at our programmer,  I hope to get zero when the document count is zero which is consistent with the actual situation.  Better I can get null or zero by set up parameter at API when document count is zero. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404209395","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-404209395","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":404209395,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDIwOTM5NQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-07-11T15:22:18Z","updated_at":"2018-07-11T15:22:18Z","author_association":"MEMBER","body":"A zero average is not quite the same as no documents.  E.g. a mixture of positive and negative values can give you a zero average:\r\n\r\n`((5 + -5 + 2 + -2) / 4) == 0`\r\n\r\nWhereas no documents at all is a division by zero situation:\r\n\r\n` 0 / 0 == undefined`\r\n\r\nThat's why we don't use zero as the return value when there are no documents, since zero is a valid, numerical answer whereas no documents is an empty set, and has no numerical value.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404215854","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-404215854","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":404215854,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDIxNTg1NA==","user":{"login":"ydzhu","id":16932294,"node_id":"MDQ6VXNlcjE2OTMyMjk0","avatar_url":"https://avatars3.githubusercontent.com/u/16932294?v=4","gravatar_id":"","url":"https://api.github.com/users/ydzhu","html_url":"https://github.com/ydzhu","followers_url":"https://api.github.com/users/ydzhu/followers","following_url":"https://api.github.com/users/ydzhu/following{/other_user}","gists_url":"https://api.github.com/users/ydzhu/gists{/gist_id}","starred_url":"https://api.github.com/users/ydzhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydzhu/subscriptions","organizations_url":"https://api.github.com/users/ydzhu/orgs","repos_url":"https://api.github.com/users/ydzhu/repos","events_url":"https://api.github.com/users/ydzhu/events{/privacy}","received_events_url":"https://api.github.com/users/ydzhu/received_events","type":"User","site_admin":false},"created_at":"2018-07-11T15:40:23Z","updated_at":"2018-07-11T15:40:23Z","author_association":"NONE","body":"@polyfractal  Although that it cause some trouble, I agree with your idea. Thanks for your help.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/457536556","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-457536556","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":457536556,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NzUzNjU1Ng==","user":{"login":"larrycinnabar","id":6866571,"node_id":"MDQ6VXNlcjY4NjY1NzE=","avatar_url":"https://avatars2.githubusercontent.com/u/6866571?v=4","gravatar_id":"","url":"https://api.github.com/users/larrycinnabar","html_url":"https://github.com/larrycinnabar","followers_url":"https://api.github.com/users/larrycinnabar/followers","following_url":"https://api.github.com/users/larrycinnabar/following{/other_user}","gists_url":"https://api.github.com/users/larrycinnabar/gists{/gist_id}","starred_url":"https://api.github.com/users/larrycinnabar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larrycinnabar/subscriptions","organizations_url":"https://api.github.com/users/larrycinnabar/orgs","repos_url":"https://api.github.com/users/larrycinnabar/repos","events_url":"https://api.github.com/users/larrycinnabar/events{/privacy}","received_events_url":"https://api.github.com/users/larrycinnabar/received_events","type":"User","site_admin":false},"created_at":"2019-01-25T10:59:26Z","updated_at":"2019-01-25T11:19:28Z","author_association":"NONE","body":"@polyfractal \r\n\r\nBut is this possible to detect such situations in script inside `AvgAggregation`?\r\nScript won't work. Script is not even tried to executed (I assume, you check if you have no items to be averaged, so you just return null, without trying to do the script)\r\n\r\nIf such script will work - it will be a good thing:\r\n```\r\n\"avg\":{  \r\n  \"field\":\"index\",\r\n  \"script\":{  \r\n    \"lang\":\"painless\",\r\n    \"source\":\"if (_value == null) {return 0} else {return _value}\"\r\n  }\r\n}\r\n```\r\n\r\n\r\n### Why is this important?\r\n\r\nThe result of such avg aggregation can be used as a reference in another `bucket_script` aggregation. \r\nIf a `bucket_script` has a path that points to such result of `null` Averaging Agg - this `bucket_script` aggregation is silently ignored. It can't be handled inside its script too, because it's just not executed at all","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/457606125","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-457606125","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":457606125,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NzYwNjEyNQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-01-25T15:18:23Z","updated_at":"2019-01-25T15:18:23Z","author_association":"MEMBER","body":"Agreed that for a script, we should be allowing the script to inspect the value and choose for itself.  That's unfortunately just a bug at the moment, due to how the pipeline framework works :(","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/594317034","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-594317034","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":594317034,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDMxNzAzNA==","user":{"login":"longvd89","id":4578323,"node_id":"MDQ6VXNlcjQ1NzgzMjM=","avatar_url":"https://avatars3.githubusercontent.com/u/4578323?v=4","gravatar_id":"","url":"https://api.github.com/users/longvd89","html_url":"https://github.com/longvd89","followers_url":"https://api.github.com/users/longvd89/followers","following_url":"https://api.github.com/users/longvd89/following{/other_user}","gists_url":"https://api.github.com/users/longvd89/gists{/gist_id}","starred_url":"https://api.github.com/users/longvd89/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/longvd89/subscriptions","organizations_url":"https://api.github.com/users/longvd89/orgs","repos_url":"https://api.github.com/users/longvd89/repos","events_url":"https://api.github.com/users/longvd89/events{/privacy}","received_events_url":"https://api.github.com/users/longvd89/received_events","type":"User","site_admin":false},"created_at":"2020-03-04T04:14:11Z","updated_at":"2020-03-04T04:14:11Z","author_association":"NONE","body":"if i have 10 documents and AVG aggregation:   { \"aggs\" : { \"avg_grade\" : { \"avg\" : { \"field\" : \"grade\" } } } }\r\nbut 1 document have grade = undefined (or not exist field grade in document). I have question : the value of AVG is is calculated on 10 documents or  9 documents (have value of grade )","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/594550272","html_url":"https://github.com/elastic/elasticsearch/issues/31920#issuecomment-594550272","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31920","id":594550272,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDU1MDI3Mg==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2020-03-04T14:19:30Z","updated_at":"2020-03-04T14:19:30Z","author_association":"MEMBER","body":"@longvd89 the forums are probably better place for this kind of question in the future.\r\n\r\nBut to answer your question: documents that do not have the field (or the field is `null`) will not be included in the calculation.  E.g. aggregations skip documents that don't have the field unless `missing` parameter is configured to give a default.\r\n\r\nSo only 9 documents would be averaged in your case.","performed_via_github_app":null}]