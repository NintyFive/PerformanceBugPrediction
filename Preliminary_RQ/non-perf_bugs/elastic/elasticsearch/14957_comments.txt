[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159249975","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-159249975","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":159249975,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTI0OTk3NQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T12:14:31Z","updated_at":"2015-11-24T12:14:31Z","author_association":"CONTRIBUTOR","body":"well spotted, thanks!  Simple recreation, that runs on 2.1 (or on 1.7 and upgrades without warning to 2.1):\n\n```\nPUT t\n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"foo\": {\n          \"type\": \"string\",\n          \"fields\": {\n            \"bar.baz\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\nPUT t/t/1\n{\n  \"foo\": \"test\"\n}\n\nGET t/t/_search\n{\n  \"query\": {\n    \"match\": {\n      \"foo.bar.baz\": \"test\"\n    }\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159334571","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-159334571","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":159334571,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTMzNDU3MQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-24T16:50:19Z","updated_at":"2015-11-24T16:50:19Z","author_association":"MEMBER","body":"I think it's the same root cause as described for the mapper attachment plugin. Linking to it here https://github.com/elastic/elasticsearch-mapper-attachments/issues/169\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160666619","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-160666619","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":160666619,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDY2NjYxOQ==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2015-11-30T15:45:47Z","updated_at":"2015-11-30T15:45:47Z","author_association":"CONTRIBUTOR","body":"I took a look and must admit I do not fully understand what the issue is.\n\n@brusic What exactly is the error you see? I wrote a test for the example and all seems well (https://github.com/brwe/elasticsearch/commit/43e94268e4d59d85b46fb204275d3b24c288bad6#diff-523d9598b02bfef9341f7aa20ebfdf47R543). The ContentPath builds the field path not the name and if I understand correctly that contains as many dots as there are levels.\nI think I am missing something?\n\n@clintongormley We should not be able to create multi fields with dots in the name, that is a bug for sure. I'll try to fix\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160753913","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-160753913","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":160753913,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDc1MzkxMw==","user":{"login":"brusic","id":354105,"node_id":"MDQ6VXNlcjM1NDEwNQ==","avatar_url":"https://avatars1.githubusercontent.com/u/354105?v=4","gravatar_id":"","url":"https://api.github.com/users/brusic","html_url":"https://github.com/brusic","followers_url":"https://api.github.com/users/brusic/followers","following_url":"https://api.github.com/users/brusic/following{/other_user}","gists_url":"https://api.github.com/users/brusic/gists{/gist_id}","starred_url":"https://api.github.com/users/brusic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brusic/subscriptions","organizations_url":"https://api.github.com/users/brusic/orgs","repos_url":"https://api.github.com/users/brusic/repos","events_url":"https://api.github.com/users/brusic/events{/privacy}","received_events_url":"https://api.github.com/users/brusic/received_events","type":"User","site_admin":false},"created_at":"2015-11-30T20:35:44Z","updated_at":"2015-11-30T20:36:42Z","author_association":"CONTRIBUTOR","body":"It all depends on how strict should Elasticsearch should be regarding non-dots-in-field names. Better yet, what is the difference between a field name and a path?\n\nAt the Lucene level, multifield will create a field name with a dot in it. Inspected a one-shard index with Luke, and the fields created using the fields syntax will have a dot. Clinton's example does not fully show the impact since it uses a field name with a dot. Using 'bar' instead of 'bar.baz'.\n\n```\n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"foo\": {\n          \"type\": \"string\",\n          \"fields\": {\n            \"bar\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\nPUT t/t/1\n{\n  \"foo\": \"test\"\n}\n\nGET t/t/_search\n{\n  \"query\": {\n    \"match\": {\n      \"foo.bar\": \"test\"\n    }\n  }\n}\n```\n\nA field name of foo.bar was created. Is this field name allowed? There was a discussion on the mailing list were these field names were getting flagged as incorrect when a user attempted to upgrade:\n\nhttps://discuss.elastic.co/t/elasticsearch-2-mapping/34366/9\n\nEither dots should never be allowed or the fields created with multifields should not be flagged as incorrect since they are paths and not field names.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160756952","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-160756952","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":160756952,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDc1Njk1Mg==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-11-30T20:47:42Z","updated_at":"2015-11-30T20:47:42Z","author_association":"MEMBER","body":"> A field name of foo.bar was created\n\nThis isn't true. We do not create a field with name `foo.bar`. We create the equivalent of the following mapping:\n\n```\n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"foo\": {\n          \"type\": \"string\",\n          \"copy_to\": \"foo.bar\",\n          \"properties\": {\n            \"bar\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nThe `name` of a field is _just_ the name. In this case, the `name` of the multi field is `bar`.  It's path is how you access it in a query, which uses dots to separate path elements. So `bar` is underneath a `foo` field, and so its path is `foo.bar`. This path is why dots are no longer allowed in field names: we cannot distinguish between `foo.bar` being a field on its own, or an object field `foo` with a subfield `bar`.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160757687","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-160757687","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":160757687,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDc1NzY4Nw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-11-30T20:49:45Z","updated_at":"2015-11-30T20:49:45Z","author_association":"MEMBER","body":"FYI, the mapping I showed there wont' actually work IIRC. It was just used to explain how multi fields work conceptually.  Only an `object` field can have `properties` (ie subfields) hence why the general purpose `fields` exists for concrete data types.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160975724","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-160975724","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":160975724,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDk3NTcyNA==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T13:51:49Z","updated_at":"2015-12-01T13:51:49Z","author_association":"CONTRIBUTOR","body":"I think the confusion stems from the ambiguous use of the words `field name`. We have 1) a _Lucene_ field name which can contain as many dots as needed (we create them for example [here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/index/mapper/core/StringFieldMapper.java#L306) and this is also what we can see in Luke) and 2) a `field name` in _elasticsearch mapping_ which is just the innermost identifier for a value in a nested json structure and may not contain any dots in elasticsearch mapping.\n\nFor example:\n\n```\n{\n  \"a\": {\n     \"b\": {\n        \"c\":  \"All mappings and no play makes Britta a dull programmer\"\n     }\n  }\n}\n```\n\n1) will be `a.b.c`\n2) will be `c` \n\nThe path we were talking about before is `a.b` and is needed on Lucene level I think to distinguish `a.b.c` for example from another field that also has the name `c` but is nested in objects `d` and `e` (and therefore has path `d.e`). \nLet me know if this makes sense.\n\nAlso, @brusic just to be sure: did you actually encounter any error? We only check the elasticsearch field name for dots, the Lucene field names are untouched by that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160998729","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-160998729","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":160998729,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDk5ODcyOQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T15:18:53Z","updated_at":"2015-12-01T15:18:53Z","author_association":"MEMBER","body":">   The path we were talking about before is a.b\n\nOne minore correction: path would be `a.b.c` there. It is like path vs name for File in java. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161411744","html_url":"https://github.com/elastic/elasticsearch/issues/14957#issuecomment-161411744","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14957","id":161411744,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTQxMTc0NA==","user":{"login":"brusic","id":354105,"node_id":"MDQ6VXNlcjM1NDEwNQ==","avatar_url":"https://avatars1.githubusercontent.com/u/354105?v=4","gravatar_id":"","url":"https://api.github.com/users/brusic","html_url":"https://github.com/brusic","followers_url":"https://api.github.com/users/brusic/followers","following_url":"https://api.github.com/users/brusic/following{/other_user}","gists_url":"https://api.github.com/users/brusic/gists{/gist_id}","starred_url":"https://api.github.com/users/brusic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brusic/subscriptions","organizations_url":"https://api.github.com/users/brusic/orgs","repos_url":"https://api.github.com/users/brusic/repos","events_url":"https://api.github.com/users/brusic/events{/privacy}","received_events_url":"https://api.github.com/users/brusic/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T19:45:43Z","updated_at":"2015-12-02T19:45:43Z","author_association":"CONTRIBUTOR","body":"I agree with Britta in that the confusion is related to the ambiguity of the words field name, which I acknowledged in my previous comment. I have not seen the error myself, but have seen it a couple of times on the forum. Since I was curious what was happening behind the scenes, I checked it out myself, only looking at the Lucene field names.\n\nIf someone else has a problem with upgrading, they can create a new issue.\n","performed_via_github_app":null}]