{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18626","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18626/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18626/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18626/events","html_url":"https://github.com/elastic/elasticsearch/issues/18626","id":157335971,"node_id":"MDU6SXNzdWUxNTczMzU5NzE=","number":18626,"title":"Dynamic Scripting With Watcher - JSON Key-Value Inversed","user":{"login":"hasancansaral","id":704385,"node_id":"MDQ6VXNlcjcwNDM4NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/704385?v=4","gravatar_id":"","url":"https://api.github.com/users/hasancansaral","html_url":"https://github.com/hasancansaral","followers_url":"https://api.github.com/users/hasancansaral/followers","following_url":"https://api.github.com/users/hasancansaral/following{/other_user}","gists_url":"https://api.github.com/users/hasancansaral/gists{/gist_id}","starred_url":"https://api.github.com/users/hasancansaral/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hasancansaral/subscriptions","organizations_url":"https://api.github.com/users/hasancansaral/orgs","repos_url":"https://api.github.com/users/hasancansaral/repos","events_url":"https://api.github.com/users/hasancansaral/events{/privacy}","received_events_url":"https://api.github.com/users/hasancansaral/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-05-28T12:14:35Z","updated_at":"2016-05-30T18:23:10Z","closed_at":"2016-05-30T18:23:10Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:\n1.5\n\n**JVM version**:\n1.8.0_91\n\n**OS version**:\nUbuntu 14.04 LTS Desktop\n\n**Description of the problem including expected versus actual behavior**:\n\n**Steps to reproduce**:\n1. Create an index `PUT some_type`\n2. Create a watcher:\n   \n   ```\n    {\n      \"trigger\": {\n        \"schedule\": {\n          \"interval\": \"5s\"\n        }\n      },\n      \"input\" : {\n        \"search\" : {\n          \"request\" : {\n            \"indices\" : [ \"<some_index>\" ],\n            \"types\" : [ \"<some_type>\" ],\n            \"body\" : {\n              \"query\" : {\n                \"range\": {\n                  \"_timestamp\": {\n                    \"gte\": \"now-5s\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      },\n      \"transform\" : {\n        \"script\" : \"return [ json: groovy.json.JsonOutput.toJson(ctx.payload.hits.hits)]\"\n      },\n      \"actions\" : {\n        \"some_webhook\" : {\n          \"webhook\" : {\n            \"method\" : \"POST\",\n            \"host\" : \"<some_ip>\",\n            \"port\" : <some_port>,\n            \"path\": \"<some_endpoint>\",\n            \"body\" : \"{{ctx.payload.json}}\"\n          }\n        }\n      }\n    }\n   ```\n3. When nothing matches the search, the output is:\n   \n   `{ '0': '' }`\n4. When a document matches the search, the output is:\n\n`{ '{\"_index\":\"<some_index>\",\"_type\":\"<some_type>\",\"_source\":{\"<some_key>\":\"<some_value>\", ...},\"_id\":\"<doc_id>\",\"_score\":1.0}': '' }`\n\nWhere `ctx.payload.json` should already be a valid JSON without any need for a key, since `ctx.payload.hits.hits` should be a valid JSON array.\n\nBasically, the data is being posted as the key of the JSON, if a document matches the search, and again '0' as the key of the JSON when no documents match the search. I would appreciate any help, thanks.\n","closed_by":{"login":"hasancansaral","id":704385,"node_id":"MDQ6VXNlcjcwNDM4NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/704385?v=4","gravatar_id":"","url":"https://api.github.com/users/hasancansaral","html_url":"https://github.com/hasancansaral","followers_url":"https://api.github.com/users/hasancansaral/followers","following_url":"https://api.github.com/users/hasancansaral/following{/other_user}","gists_url":"https://api.github.com/users/hasancansaral/gists{/gist_id}","starred_url":"https://api.github.com/users/hasancansaral/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hasancansaral/subscriptions","organizations_url":"https://api.github.com/users/hasancansaral/orgs","repos_url":"https://api.github.com/users/hasancansaral/repos","events_url":"https://api.github.com/users/hasancansaral/events{/privacy}","received_events_url":"https://api.github.com/users/hasancansaral/received_events","type":"User","site_admin":false},"performed_via_github_app":null}