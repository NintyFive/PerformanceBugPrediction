{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10334","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10334/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10334/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10334/events","html_url":"https://github.com/elastic/elasticsearch/issues/10334","id":65382224,"node_id":"MDU6SXNzdWU2NTM4MjIyNA==","number":10334,"title":"Elasticsearch inner_hits query results in ArrayOutOfBoundsException","user":{"login":"mariusdw","id":11732659,"node_id":"MDQ6VXNlcjExNzMyNjU5","avatar_url":"https://avatars2.githubusercontent.com/u/11732659?v=4","gravatar_id":"","url":"https://api.github.com/users/mariusdw","html_url":"https://github.com/mariusdw","followers_url":"https://api.github.com/users/mariusdw/followers","following_url":"https://api.github.com/users/mariusdw/following{/other_user}","gists_url":"https://api.github.com/users/mariusdw/gists{/gist_id}","starred_url":"https://api.github.com/users/mariusdw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mariusdw/subscriptions","organizations_url":"https://api.github.com/users/mariusdw/orgs","repos_url":"https://api.github.com/users/mariusdw/repos","events_url":"https://api.github.com/users/mariusdw/events{/privacy}","received_events_url":"https://api.github.com/users/mariusdw/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-03-31T06:59:16Z","updated_at":"2018-02-14T13:26:52Z","closed_at":"2015-04-03T07:19:31Z","author_association":"NONE","active_lock_reason":null,"body":"Hi! Please have a look at the following. Elastic is throwing an ArrayOutOfBoundsException when requesting inner_hits in my search query. The query works fine if inner_hits is not included. I feel this is a bug in elasticsearch. To  reproduce:\n\n<pre><code>curl -XPOST 'http://localhost:9200/twitter'\n\ncurl -XPOST 'http://localhost:9200/twitter/_mapping/tweet' -d '\n{\n    \"tweet\": {\n        \"properties\": {\n            \"comments\": {\n                \"properties\": {\n                    \"messages\": {\n                        \"type\": \"nested\",\n                        \"properties\": {\n                            \"message\": {\n                                \"type\" : \"string\", \n                                \"index\": \"not_analyzed\"\n                            }   \n                        }\n                    } \n                }\n            }\n        }\n    }\n}'\n\ncurl -XPOST 'http://localhost:9200/twitter/tweet' -d '\n{\n    \"comments\": {\n        \"messages\": [\n            {\"message\": \"Nice website\"},\n            {\"message\": \"Worst ever\"}\n        ]\n    }\n}'\n\ncurl -XGET 'http://localhost:9200/twitter/tweet/_search' -d '\n{\n    \"query\": {\n        \"nested\": {\n            \"path\": \"comments.messages\",\n            \"query\": {\n                \"match\": {\"comments.messages.message\": \"Nice website\"}\n            },\n            \"inner_hits\" : {}\n        }\n    }\n}'\n\nResponse:\n\n{\"took\":54,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":4,\"failed\":1,\"failures\":[{\"index\":\"twitter\",\"shard\":4,\"status\":500,\"reason\":\"ArrayIndexOutOfBoundsException[-1]\"}]},\"hits\":{\"total\":1,\"max_score\":1.4054651,\"hits\":[]}}\n\n</code></pre>\n\n\nShould the document not have been returned with the \"Nice website\" comment in the inner_hits array?\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}