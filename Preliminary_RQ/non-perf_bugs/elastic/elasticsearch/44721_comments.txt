[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/514084298","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-514084298","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":514084298,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDA4NDI5OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-07-23T07:13:30Z","updated_at":"2019-07-23T07:13:30Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/514186699","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-514186699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":514186699,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDE4NjY5OQ==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2019-07-23T12:23:44Z","updated_at":"2019-07-23T12:23:44Z","author_association":"CONTRIBUTOR","body":"@zofog do you get an error? If so, can you share this along with any stacktraces (if any) in logs?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/514256503","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-514256503","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":514256503,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDI1NjUwMw==","user":{"login":"zofog","id":12159957,"node_id":"MDQ6VXNlcjEyMTU5OTU3","avatar_url":"https://avatars0.githubusercontent.com/u/12159957?v=4","gravatar_id":"","url":"https://api.github.com/users/zofog","html_url":"https://github.com/zofog","followers_url":"https://api.github.com/users/zofog/followers","following_url":"https://api.github.com/users/zofog/following{/other_user}","gists_url":"https://api.github.com/users/zofog/gists{/gist_id}","starred_url":"https://api.github.com/users/zofog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zofog/subscriptions","organizations_url":"https://api.github.com/users/zofog/orgs","repos_url":"https://api.github.com/users/zofog/repos","events_url":"https://api.github.com/users/zofog/events{/privacy}","received_events_url":"https://api.github.com/users/zofog/received_events","type":"User","site_admin":false},"created_at":"2019-07-23T15:18:18Z","updated_at":"2019-07-23T15:18:18Z","author_association":"NONE","body":"@astefan I get the following error, I'm assuming because the content being returned from the / root site is not what's expected. \r\n\r\n`Unexpected driver error occurred while connecting to database. Unsupported Content-Type: text/html; charset=utf-8`\r\n\r\nThe error from SQL CLI is:\r\n`Exception in thread \"main\" java.lang.IllegalStateException: Unsupported Content-Type: text/html; charset=utf-8\r\n        at org.elasticsearch.xpack.sql.client.HttpClient.readFrom(HttpClient.java:159)\r\n        at org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.request(JreHttpUrlConnection.java:155)\r\n        at org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$4(HttpClient.java:129)\r\n        at org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.http(JreHttpUrlConnection.java:65)\r\n        at org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$5(HttpClient.java:128)\r\n        at java.security.AccessController.doPrivileged(Native Method)\r\n        at org.elasticsearch.xpack.sql.client.HttpClient.get(HttpClient.java:127)\r\n        at org.elasticsearch.xpack.sql.client.HttpClient.serverInfo(HttpClient.java:60)\r\n        at org.elasticsearch.xpack.sql.cli.command.CliSession.checkConnection(CliSession.java:63)\r\n        at org.elasticsearch.xpack.sql.cli.Cli.checkConnection(Cli.java:138)\r\n        at org.elasticsearch.xpack.sql.cli.Cli.execute(Cli.java:128)\r\n        at org.elasticsearch.xpack.sql.cli.Cli.execute(Cli.java:110)\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n        at org.elasticsearch.cli.Command.main(Command.java:90)\r\n        at org.elasticsearch.xpack.sql.cli.Cli.main(Cli.java:58)`\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/514258415","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-514258415","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":514258415,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDI1ODQxNQ==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2019-07-23T15:22:45Z","updated_at":"2019-07-23T15:22:45Z","author_association":"CONTRIBUTOR","body":"@zofog what was the command line you used to start the CLI?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/514271325","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-514271325","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":514271325,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDI3MTMyNQ==","user":{"login":"zofog","id":12159957,"node_id":"MDQ6VXNlcjEyMTU5OTU3","avatar_url":"https://avatars0.githubusercontent.com/u/12159957?v=4","gravatar_id":"","url":"https://api.github.com/users/zofog","html_url":"https://github.com/zofog","followers_url":"https://api.github.com/users/zofog/followers","following_url":"https://api.github.com/users/zofog/following{/other_user}","gists_url":"https://api.github.com/users/zofog/gists{/gist_id}","starred_url":"https://api.github.com/users/zofog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zofog/subscriptions","organizations_url":"https://api.github.com/users/zofog/orgs","repos_url":"https://api.github.com/users/zofog/repos","events_url":"https://api.github.com/users/zofog/events{/privacy}","received_events_url":"https://api.github.com/users/zofog/received_events","type":"User","site_admin":false},"created_at":"2019-07-23T15:53:24Z","updated_at":"2019-07-23T15:54:17Z","author_association":"NONE","body":"@astefan, just want to be clear that my environment is understood so you're not chasing ghosts. \r\n\r\nElasticsearch (coordinating node) and Kibana run on the same server. Everything is reverse proxied with Nginx. This configuration works perfectly for our needs and has been in production for over a year. No issues with users getting to Kibana and clients connecting to the REST endpoint. \r\n\r\nhttps://myhost.example.com  -> Kibana (localhost:5601)\r\nhttps://myhost.example.com/rest/ -> ES (localhost:9200)\r\n\r\nWhen I configure the JDBC driver as `jdbc:es://https://myhost.example.com:443/rest/`, I can see in my Nginx logs a GET call to https://myhost.example.com/?error_trace, which is where Kibana is responding from. \r\n\r\nI'm using DBeaver 6.1.2 to test the JDBC provider. When configured as above, I get the error :\r\n\r\n`2019-07-23 08:13:37.325 - Connect with 'jdbc:es://https://myhost.example.com:443/rest/' (elastic_search_jdbc-16c1f652212-154f8454d38c3e5b)\r\n2019-07-23 08:13:38.230 - Connection failed (elastic_search_jdbc-16c1f652212-154f8454d38c3e5b)\r\n2019-07-23 08:13:38.235 - org.jkiss.dbeaver.model.exec.DBCConnectException: Unexpected driver error occurred while connecting to database\r\norg.jkiss.dbeaver.model.exec.DBCConnectException: Unexpected driver error occurred while connecting to database\r\n\tat org.jkiss.dbeaver.model.impl.jdbc.JDBCDataSource.openConnection(JDBCDataSource.java:185)\r\n\tat org.jkiss.dbeaver.ext.generic.model.GenericDataSource.openConnection(GenericDataSource.java:124)\r\n\tat org.jkiss.dbeaver.model.impl.jdbc.JDBCExecutionContext.connect(JDBCExecutionContext.java:89)\r\n\tat org.jkiss.dbeaver.model.impl.jdbc.JDBCRemoteInstance.initializeMainContext(JDBCRemoteInstance.java:88)\r\n\tat org.jkiss.dbeaver.model.impl.jdbc.JDBCRemoteInstance.<init>(JDBCRemoteInstance.java:54)\r\n\tat org.jkiss.dbeaver.model.impl.jdbc.JDBCDataSource.initializeRemoteInstance(JDBCDataSource.java:105)\r\n\tat org.jkiss.dbeaver.ext.generic.model.GenericDataSource.<init>(GenericDataSource.java:106)\r\n\tat org.jkiss.dbeaver.ext.generic.model.meta.GenericMetaModel.createDataSourceImpl(GenericMetaModel.java:69)\r\n\tat org.jkiss.dbeaver.ext.generic.GenericDataSourceProvider.openDataSource(GenericDataSourceProvider.java:95)\r\n\tat org.jkiss.dbeaver.registry.DataSourceDescriptor.connect(DataSourceDescriptor.java:778)\r\n\tat org.jkiss.dbeaver.runtime.jobs.ConnectJob.run(ConnectJob.java:70)\r\n\tat org.jkiss.dbeaver.ui.dialogs.connection.ConnectionWizard$ConnectionTester.run(ConnectionWizard.java:237)\r\n\tat org.jkiss.dbeaver.model.runtime.AbstractJob.run(AbstractJob.java:102)\r\n\tat org.eclipse.core.internal.jobs.Worker.run(Worker.java:63)\r\nCaused by: java.lang.IllegalStateException: Unsupported Content-Type: text/html; charset=utf-8\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.readFrom(HttpClient.java:159)\r\n\tat org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.request(JreHttpUrlConnection.java:155)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$4(HttpClient.java:129)\r\n\tat org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.http(JreHttpUrlConnection.java:65)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$5(HttpClient.java:128)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.get(HttpClient.java:127)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.serverInfo(HttpClient.java:60)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcHttpClient.fetchServerInfo(JdbcHttpClient.java:93)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcHttpClient.<init>(JdbcHttpClient.java:47)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcConnection.<init>(JdbcConnection.java:53)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcConnection.<init>(JdbcConnection.java:48)\r\n\tat org.elasticsearch.xpack.sql.jdbc.EsDriver.connect(EsDriver.java:76)\r\n\tat org.jkiss.dbeaver.model.impl.jdbc.JDBCDataSource.lambda$0(JDBCDataSource.java:148)\r\n\tat org.jkiss.dbeaver.model.impl.jdbc.JDBCDataSource.openConnection(JDBCDataSource.java:157)\r\n\t... 13 more`\r\n\r\nWhen I try the same URL with the SQL CLI: `elasticsearch-sql-cli.bat https://myuser:mypassword@myhost.example.com:443/rest/`. I get the error:\r\n\r\n`Exception in thread \"main\" java.lang.IllegalStateException: Unsupported Content-Type: text/html; charset=utf-8 at org.elasticsearch.xpack.sql.client.HttpClient.readFrom(HttpClient.java:159) at org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.request(JreHttpUrlConnection.java:155) at org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$4(HttpClient.java:129) at org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.http(JreHttpUrlConnection.java:65) at org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$5(HttpClient.java:128) at java.security.AccessController.doPrivileged(Native Method) at org.elasticsearch.xpack.sql.client.HttpClient.get(HttpClient.java:127) at org.elasticsearch.xpack.sql.client.HttpClient.serverInfo(HttpClient.java:60) at org.elasticsearch.xpack.sql.cli.command.CliSession.checkConnection(CliSession.java:63) at org.elasticsearch.xpack.sql.cli.Cli.checkConnection(Cli.java:138) at org.elasticsearch.xpack.sql.cli.Cli.execute(Cli.java:128) at org.elasticsearch.xpack.sql.cli.Cli.execute(Cli.java:110) at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) at org.elasticsearch.cli.Command.main(Command.java:90) at org.elasticsearch.xpack.sql.cli.Cli.main(Cli.java:58)`\r\n\r\nSeems to me, somewhere in the sql client code the /rest/ path is being removed from the URL. \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/514274338","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-514274338","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":514274338,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDI3NDMzOA==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2019-07-23T16:00:52Z","updated_at":"2019-07-23T16:00:52Z","author_association":"CONTRIBUTOR","body":"Thank you for the detailed additional info. It's a bug, indeed. Managed to reproduce it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/514978263","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-514978263","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":514978263,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNDk3ODI2Mw==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T09:50:46Z","updated_at":"2019-07-25T09:50:46Z","author_association":"CONTRIBUTOR","body":"master (8.0.0): https://github.com/elastic/elasticsearch/commit/06dea859e8fddada868941aaae15e83b4f64babe\r\n7.x (7.4.0): https://github.com/elastic/elasticsearch/commit/fd74b63602270e2117392543517bb635dfb3f22a\r\n7.3 (7.3.1): https://github.com/elastic/elasticsearch/commit/9d4f78ff9e5808f884e7eb17b4fd3256707832c0\r\n7.2 (7.2.2): https://github.com/elastic/elasticsearch/commit/64bc3a060d43948d7e6ebc4f04fa8cb046e5036d\r\n6.8 (6.8.3): https://github.com/elastic/elasticsearch/commit/3a7f34f12bcee101c936deb12753231939ce0d09","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/515502824","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-515502824","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":515502824,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTUwMjgyNA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2019-07-26T15:43:45Z","updated_at":"2019-07-26T15:43:45Z","author_association":"CONTRIBUTOR","body":"@astefan FYI the release note process relies on having versions on pull requests only, so I removed them from this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/519373141","html_url":"https://github.com/elastic/elasticsearch/issues/44721#issuecomment-519373141","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44721","id":519373141,"node_id":"MDEyOklzc3VlQ29tbWVudDUxOTM3MzE0MQ==","user":{"login":"lendo","id":82283,"node_id":"MDQ6VXNlcjgyMjgz","avatar_url":"https://avatars3.githubusercontent.com/u/82283?v=4","gravatar_id":"","url":"https://api.github.com/users/lendo","html_url":"https://github.com/lendo","followers_url":"https://api.github.com/users/lendo/followers","following_url":"https://api.github.com/users/lendo/following{/other_user}","gists_url":"https://api.github.com/users/lendo/gists{/gist_id}","starred_url":"https://api.github.com/users/lendo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lendo/subscriptions","organizations_url":"https://api.github.com/users/lendo/orgs","repos_url":"https://api.github.com/users/lendo/repos","events_url":"https://api.github.com/users/lendo/events{/privacy}","received_events_url":"https://api.github.com/users/lendo/received_events","type":"User","site_admin":false},"created_at":"2019-08-08T05:41:57Z","updated_at":"2019-08-08T05:46:06Z","author_association":"NONE","body":"sun/net/www/protocol/http/HttpURLConnection.java\r\n<img width=\"386\" alt=\"7CB86FA6-2522-4770-BBB7-218D777F6FC9\" src=\"https://user-images.githubusercontent.com/82283/62677852-456c8c80-b9e2-11e9-9ae3-885901ac20c4.png\">\r\n\r\nPropose: use **Apache HttpClient** instead of java.net.HttpURLConnection in org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.java","performed_via_github_app":null}]