{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44640","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44640/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44640/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44640/events","html_url":"https://github.com/elastic/elasticsearch/issues/44640","id":470500371,"node_id":"MDU6SXNzdWU0NzA1MDAzNzE=","number":44640,"title":"basic_date illegal_argument_exception vs yyyyMMdd","user":{"login":"tstilwell","id":12650309,"node_id":"MDQ6VXNlcjEyNjUwMzA5","avatar_url":"https://avatars2.githubusercontent.com/u/12650309?v=4","gravatar_id":"","url":"https://api.github.com/users/tstilwell","html_url":"https://github.com/tstilwell","followers_url":"https://api.github.com/users/tstilwell/followers","following_url":"https://api.github.com/users/tstilwell/following{/other_user}","gists_url":"https://api.github.com/users/tstilwell/gists{/gist_id}","starred_url":"https://api.github.com/users/tstilwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tstilwell/subscriptions","organizations_url":"https://api.github.com/users/tstilwell/orgs","repos_url":"https://api.github.com/users/tstilwell/repos","events_url":"https://api.github.com/users/tstilwell/events{/privacy}","received_events_url":"https://api.github.com/users/tstilwell/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"assignees":[{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-07-19T19:27:24Z","updated_at":"2020-04-22T16:04:14Z","closed_at":"2020-04-22T16:04:13Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** : 7.2.0\r\n\r\n**Plugins installed**: none\r\n\r\n**JVM version** :\r\nopenjdk version \"1.8.0_191\"\r\nOpenJDK Runtime Environment (build 1.8.0_191-b12)\r\nOpenJDK 64-Bit Server VM (build 25.191-b12, mixed mode)\r\n\r\n**OS version**: CentOS Linux release 7.6.1810 (Core) x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen trying to map a date field to accept either `yyyyMMdd` or `yyyy-MM-ddTHH:mm:ss.SSSZ`, according to 7.2 documentation it looks like specifying `\"format\": \"basic_date||strict_date_optional_time\"` should work, and the mapping should be accepted. However, trying to put a mapping with the above fails (haven't even indexed any documents at this point - the mapping itself fails):\r\n\r\n`{\"error\":{\"root_cause\":[{\"type\":\"illegal_argument_exception\",\"reason\":\"formatters must have the same time zone\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"formatters must have the same time zone\"},\"status\":400}`\r\n\r\nHowever, specifying `\"format\": \"yyyyMMdd||strict_date_optional_time\"` works, and the mapping is accepted. \r\n\r\nObviously something to do with switch from joda to java. `basic_date||strict_date_optional_time` worked in versions of ES prior to v7.\r\n\r\n**Steps to reproduce**:\r\n\r\nBroken:\r\n```\r\nPUT localhost:9200/my_index\r\n{\r\n  \"mappings\": {\r\n    \"date_detection\": false,\r\n    \"properties\": {\r\n      \"myDate\": {\r\n        \"type\":   \"date\",\r\n        \"format\": \"basic_date||strict_date_optional_time\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nresult:\r\n`{\"error\":{\"root_cause\":[{\"type\":\"illegal_argument_exception\",\"reason\":\"formatters must have the same time zone\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"formatters must have the same time zone\"},\"status\":400}`\r\n\r\nWorking example (from docs one would assume basic_date and yyyyMMdd are synonymous):\r\n```\r\nPUT localhost:9200/my_index\r\n{\r\n  \"mappings\": {\r\n    \"date_detection\": false,\r\n    \"properties\": {\r\n      \"myDate\": {\r\n        \"type\":   \"date\",\r\n        \"format\": \"yyyyMMdd||strict_date_optional_time\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nresult:\r\n```\r\n{\"acknowledged\":true}\r\n```\r\n\r\n\r\n","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}