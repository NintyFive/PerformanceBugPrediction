{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23067","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23067/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23067/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23067/events","html_url":"https://github.com/elastic/elasticsearch/issues/23067","id":206448889,"node_id":"MDU6SXNzdWUyMDY0NDg4ODk=","number":23067,"title":"2.3.3 heap used too high，jvm eden percent 100%，not crash ","user":{"login":"keenbo","id":1872588,"node_id":"MDQ6VXNlcjE4NzI1ODg=","avatar_url":"https://avatars0.githubusercontent.com/u/1872588?v=4","gravatar_id":"","url":"https://api.github.com/users/keenbo","html_url":"https://github.com/keenbo","followers_url":"https://api.github.com/users/keenbo/followers","following_url":"https://api.github.com/users/keenbo/following{/other_user}","gists_url":"https://api.github.com/users/keenbo/gists{/gist_id}","starred_url":"https://api.github.com/users/keenbo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keenbo/subscriptions","organizations_url":"https://api.github.com/users/keenbo/orgs","repos_url":"https://api.github.com/users/keenbo/repos","events_url":"https://api.github.com/users/keenbo/events{/privacy}","received_events_url":"https://api.github.com/users/keenbo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-02-09T09:30:57Z","updated_at":"2017-02-10T00:17:06Z","closed_at":"2017-02-09T12:26:11Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**:2.3.3\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**:1.8_091\r\n\r\n**OS version**:linux-3.10.101kernel\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWe deploy 12 es nodes in 3 machine. After we insert 1 billion record into es cluster and Meanwhile,we also send query request to es for search. After 3 day passed, es's jvm heap FGC frequently.the node's jvm gcutil looks like that: total 3.8GB for ES_HEAP, 2.6GB for jvm's old gen, and the old gen used is 100%.\r\nWe stop all write and read request,but the old gen used could not decrease. the old gen used is 100%.\r\nwe clear cache of es,but the old gen used only decrease to 96%.\r\n**Steps to reproduce**:\r\n 1.use config see below\r\n 2.do insert and query \r\n 3.after data increase to 1 billion, heap used become 100%.\r\n\r\n**Provide logs (if relevant)**:\r\n[2017-02-05 11:58:38,221][INFO ][monitor.jvm              ] [xxx] [gc][old][1332853][268813] duration [5s], collections [1]/[5.1s], total [5s]/[17.2h], memory [3.8gb]->[2.8gb]/[3.8gb], all_pools {[young] [1gb]->[166.8mb]/[1gb]}{[survivor] [130.7mb]->[0b]/[136.5mb]}{[old] [2.6gb]->[2.6gb]/[2.6gb]}\r\n[2017-02-05 12:04:39,450][INFO ][monitor.jvm              ] [xxx] [gc][old][1333207][268917] duration [6.2s], collections [1]/[6.5s], total [6.2s]/[17.2h], memory [3.8gb]->[2.8gb]/[3.8gb], all_pools {[young] [1gb]->[165.2mb]/[1gb]}{[survivor] [111mb]->[0b]/[136.5mb]}{[old] [2.6gb]->[2.6gb]/[2.6gb]}\r\n[2017-02-05 12:10:10,528][INFO ][monitor.jvm              ] [xxx] [gc][old][1333531][269014] duration [6.1s], collections [1]/[6.7s], total [6.1s]/[17.2h], memory [3.8gb]->[2.8gb]/[3.8gb], all_pools {[young] [1gb]->[167.1mb]/[1gb]}{[survivor] [97.3mb]->[0b]/[136.5mb]}{[old] [2.6gb]->[2.6gb]/[2.6gb]}\r\n[2017-02-05 12:33:23,673][INFO ][monitor.jvm              ] [xxx] [gc][old][1334903][269423] duration [5.1s], collections [1]/[5.3s], total [5.1s]/[17.3h], memory [3.8gb]->[2.8gb]/[3.8gb], all_pools {[young] [1gb]->[168.3mb]/[1gb]}{[survivor] [119.5mb]->[0b]/[136.5mb]}{[old] [2.6gb]->[2.6gb]/[2.6gb]}\r\n[2017-02-05 14:12:11,023][INFO ][monitor.jvm              ] [xxx] [gc][old][1340737][271155] duration [5s], collections [1]/[5.8s], total [5s]/[17.4h], memory [3.8gb]->[2.8gb]/[3.8gb], all_pools {[young] [1gb]->[166.2mb]/[1gb]}{[survivor] [128.7mb]->[0b]/[136.5mb]}{[old] [2.6gb]->[2.6gb]/[2.6gb]}\r\n\r\n<!--\r\nIf you are filing a feature request, please remove the above bug\r\nreport block and provide responses for all of the below items.\r\n-->\r\n\r\n**Describe the feature**:\r\nAfter we restart the es node,the head become normal.\r\n\r\n```\r\nOur elasticsearch.yml:\r\nnode.master: false\r\n node.data: true\r\n node.zone: findbugs_grp9\r\n#\r\n# Add custom attributes to the node:\r\n#\r\n# node.rack: r1\r\n#\r\n# ----------------------------------- Paths ------------------------------------\r\n#\r\n# Path to directory where to store the data (separate multiple locations by comma):\r\n#\r\n path.data: /data1/es_Data_2017-01-20_164005/es_0/data\r\n#\r\n# Path to log files:\r\n#\r\n path.logs: /data1/es_Data_2017-01-20_164005/es_0/logs\r\n#\r\n# ---------------------------------- indices -----------------------------------\r\n index.number_of_shards: 12\r\n index.number_of_replicas: 1\r\n# index.refresh_interval: \"10s\"\r\n\r\n# ----------------------------------- Threadpool -----------------------------------\r\n threadpool.bulk.queue_size: 400\r\n\r\n# ----------------------------------- Memory -----------------------------------\r\n#\r\n# Lock the memory on startup:\r\n#\r\n bootstrap.mlockall: true\r\n#\r\n# Make sure that the `ES_HEAP_SIZE` environment variable is set to about half the memory\r\n# available on the system and that the owner of the process is allowed to use this limit.\r\n#\r\n# Elasticsearch performs poorly when the system is swapping the memory.\r\n#\r\n# ---------------------------------- Network -----------------------------------\r\n#\r\n# Set the bind address to a specific IP (IPv4 or IPv6):\r\n#\r\n network.host: xxx\r\n#\r\n# Set a custom port for HTTP:\r\n#\r\n http.port: 9200\r\n transport.tcp.port: 9300\r\n#\r\n# For more information, see the documentation at:\r\n# <http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-network.html>\r\n#\r\n# --------------------------------- Discovery ----------------------------------\r\n#\r\n# Pass an initial list of hosts to perform discovery when new node is started:\r\n# The default list of hosts is [\"127.0.0.1\", \"[::1]\"]\r\n#\r\n discovery.zen.ping.multicast.enabled: false\r\n discovery.zen.ping.unicast.hosts: [\"xxx:9309\",\"100.65.8.219:9309\",\"10.231.135.40:9309\"]\r\n# Prevent the \"split brain\" by configuring the majority of nodes (total number of nodes / 2 + 1):\r\n#\r\n discovery.zen.minimum_master_nodes: 2\r\n#\r\n# For more information, see the documentation at:\r\n# <http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html>\r\n#\r\n# ---------------------------------- Gateway -----------------------------------\r\n#\r\n# Block initial recovery after a full cluster restart until N nodes are started:\r\n#\r\n gateway.recover_after_data_nodes: 4\r\n #gateway.recover_after_nodes: 4\r\n gateway.expected_data_nodes: 8\r\n gateway.recover_after_time: 5m\r\n#\r\n# For more information, see the documentation at:\r\n# <http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-gateway.html>\r\n#\r\n# ---------------------------------- Various -----------------------------------\r\n#\r\n# Disable starting multiple nodes on a single system:\r\n#\r\n# node.max_local_storage_nodes: 4\r\n#\r\n# Require explicit names when deleting indices:\r\n#\r\n# action.destructive_requires_name: true\r\n#\r\n# ---------------------------------- Cluster -----------------------------------\r\n cluster.routing.allocation.awareness.attributes: zone\r\n cluster.routing.allocation.awareness.force.zone.values: findbugs_grp9,findbugs_grp219,findbugs_grp40\r\n\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}