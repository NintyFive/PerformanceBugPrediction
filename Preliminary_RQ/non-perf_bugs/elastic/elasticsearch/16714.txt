{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16714","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16714/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16714/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16714/events","html_url":"https://github.com/elastic/elasticsearch/issues/16714","id":134522974,"node_id":"MDU6SXNzdWUxMzQ1MjI5NzQ=","number":16714,"title":"ES 2.2 java security feature breaks OSS plugins","user":{"login":"sscarduzio","id":1327189,"node_id":"MDQ6VXNlcjEzMjcxODk=","avatar_url":"https://avatars3.githubusercontent.com/u/1327189?v=4","gravatar_id":"","url":"https://api.github.com/users/sscarduzio","html_url":"https://github.com/sscarduzio","followers_url":"https://api.github.com/users/sscarduzio/followers","following_url":"https://api.github.com/users/sscarduzio/following{/other_user}","gists_url":"https://api.github.com/users/sscarduzio/gists{/gist_id}","starred_url":"https://api.github.com/users/sscarduzio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sscarduzio/subscriptions","organizations_url":"https://api.github.com/users/sscarduzio/orgs","repos_url":"https://api.github.com/users/sscarduzio/repos","events_url":"https://api.github.com/users/sscarduzio/events{/privacy}","received_events_url":"https://api.github.com/users/sscarduzio/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-02-18T09:17:11Z","updated_at":"2016-05-07T11:55:13Z","closed_at":"2016-02-18T11:17:17Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This problem was introduced in 2.2, works fine with 2.1.1 and lower.\n\nI have an Elasticsearch opensource plugin that needs reflection to inspect the originating address of HTTP requests.\n\nIn ES 2.2 they introduced security permissions for plugins, following the instructions, I added a grant in the plugin-security.policy file with the following:\n\n```\ngrant {\n  permission java.lang.reflect.ReflectPermission \"suppressAccessChecks\";\n};\n```\n\nNow upon installation of the plugin, I can see this (as anticipated in the docs). So I assume the request for permission is successfully kicking in.\n\n```\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@     WARNING: plugin requires additional permissions     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n* java.lang.reflect.ReflectPermission suppressAccessChecks\nSee http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html\nfor descriptions of what these permissions allow and the associated risks.\nInstalled readonlyrest into /elasticsearch/plugins/readonlyrest\n```\n\nHowever, from my function that actually uses reflection, still see this error...\n\n```\njava.security.AccessControlException: access denied (\"java.lang.reflect.ReflectPermission\" \"suppressAccessChecks\")\n    at java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)\n    at java.security.AccessController.checkPermission(AccessController.java:884)\n    at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\n    at java.lang.reflect.AccessibleObject.setAccessible(AccessibleObject.java:128)\n    at org.elasticsearch.plugin.readonlyrest.acl.blocks.rules.impl.HostsRule.getAddress(HostsRule.java:76)\n    at org.elasticsearch.plugin.readonlyrest.acl.blocks.rules.impl.HostsRule.match(HostsRule.java:130)\n    at org.elasticsearch.plugin.readonlyrest.acl.blocks.Block.check(Block.java:104)\n    at org.elasticsearch.plugin.readonlyrest.acl.ACL.check(ACL.java:48)\n    at org.elasticsearch.plugin.readonlyrest.ReadonlyRestAction$1.process(ReadonlyRestAction.java:60)\n    at org.elasticsearch.rest.RestController$ControllerFilterChain.continueProcessing(RestController.java:265)\n```\n\nIs there something missing? I have no clue.\n","closed_by":{"login":"sscarduzio","id":1327189,"node_id":"MDQ6VXNlcjEzMjcxODk=","avatar_url":"https://avatars3.githubusercontent.com/u/1327189?v=4","gravatar_id":"","url":"https://api.github.com/users/sscarduzio","html_url":"https://github.com/sscarduzio","followers_url":"https://api.github.com/users/sscarduzio/followers","following_url":"https://api.github.com/users/sscarduzio/following{/other_user}","gists_url":"https://api.github.com/users/sscarduzio/gists{/gist_id}","starred_url":"https://api.github.com/users/sscarduzio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sscarduzio/subscriptions","organizations_url":"https://api.github.com/users/sscarduzio/orgs","repos_url":"https://api.github.com/users/sscarduzio/repos","events_url":"https://api.github.com/users/sscarduzio/events{/privacy}","received_events_url":"https://api.github.com/users/sscarduzio/received_events","type":"User","site_admin":false},"performed_via_github_app":null}