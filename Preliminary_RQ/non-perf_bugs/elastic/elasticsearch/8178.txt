{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8178","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8178/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8178/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8178/events","html_url":"https://github.com/elastic/elasticsearch/issues/8178","id":46391720,"node_id":"MDU6SXNzdWU0NjM5MTcyMA==","number":8178,"title":"rack awareness allocation and allocation filtering lead to unassigned shards","user":{"login":"kamaradclimber","id":503537,"node_id":"MDQ6VXNlcjUwMzUzNw==","avatar_url":"https://avatars1.githubusercontent.com/u/503537?v=4","gravatar_id":"","url":"https://api.github.com/users/kamaradclimber","html_url":"https://github.com/kamaradclimber","followers_url":"https://api.github.com/users/kamaradclimber/followers","following_url":"https://api.github.com/users/kamaradclimber/following{/other_user}","gists_url":"https://api.github.com/users/kamaradclimber/gists{/gist_id}","starred_url":"https://api.github.com/users/kamaradclimber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamaradclimber/subscriptions","organizations_url":"https://api.github.com/users/kamaradclimber/orgs","repos_url":"https://api.github.com/users/kamaradclimber/repos","events_url":"https://api.github.com/users/kamaradclimber/events{/privacy}","received_events_url":"https://api.github.com/users/kamaradclimber/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"},{"id":110557212,"node_id":"MDU6TGFiZWwxMTA1NTcyMTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/high%20hanging%20fruit","name":"high hanging fruit","color":"fc6149","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-10-21T13:15:12Z","updated_at":"2018-03-20T09:53:09Z","closed_at":"2018-03-20T09:53:09Z","author_association":"NONE","active_lock_reason":null,"body":"Using shard awareness and allocation filtering together may lead to unassigned shard.\n\nTo reproduce:\n- 3 nodes cluster (2 with `node.flavor: type1`, the other one with `node.flavor: type2`)\n- shard are required to have 2 copies\n- use `cluster.routing.allocation.awareness.attributes: flavor`\n- use `routing.allocation.require: type1` on index template\n\nOn index creation, shard primary will be set on a `type1` node, its copy will stay unassigned.\n\nThe full description of the scenario leading to this issue is described on #8104 and https://groups.google.com/forum/#!topic/elasticsearch/wbVIsDzYLDM\n\nInvestigation in the code show that \n- shard allocation on `type2` node is ruled out because of allocation filter\n- shard allocation on `type1` nodes are ruled out because of rack awareness\n\nThose rules should cooperate and I expect the shard replica to go to the second `type1` node.\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}