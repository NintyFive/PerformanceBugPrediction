{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39151","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39151/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39151/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39151/events","html_url":"https://github.com/elastic/elasticsearch/issues/39151","id":412115745,"node_id":"MDU6SXNzdWU0MTIxMTU3NDU=","number":39151,"title":" ReindexWithSecurityClientYamlTestSuiteIT fails in FIPS mode","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"labels":[{"id":912838655,"node_id":"MDU6TGFiZWw5MTI4Mzg2NTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Network","name":":Security/Network","color":"0e8a16","default":false,"description":"SSL/TLS, Security for NIO/Netty"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1287946339,"node_id":"MDU6TGFiZWwxMjg3OTQ2MzM5","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-rc1","name":"v7.0.0-rc1","color":"dddddd","default":false,"description":""},{"id":1222918656,"node_id":"MDU6TGFiZWwxMjIyOTE4NjU2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.0","name":"v7.2.0","color":"DDDDDD","default":false,"description":""},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"assignees":[{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-02-19T20:44:04Z","updated_at":"2019-03-25T01:40:36Z","closed_at":"2019-02-20T07:37:52Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"reproduction:\r\n\r\n```\r\n./gradlew :x-pack:qa:reindex-tests-with-security:integTestRunner\r\n  -Dtests.class=org.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT\r\n  -Druntime.java=8FIPS \\\r\n  -Djavax.net.ssl.keyStorePassword=password \\\r\n  -Djavax.net.ssl.trustStorePassword=password\r\n```\r\n\r\nfailed tests:\r\n\r\n```\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/10_reindex/Using a script to write to an index to which you don't have access is forbidden}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/10_reindex/Using a script to write to an index to which you don't have access is forbidden}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/15_reindex_from_remote/Reindex from remote as superuser works}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/15_reindex_from_remote/Reindex from remote as superuser works}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/20_update_by_query/Reindex misses hidden fields}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/20_update_by_query/Reindex misses hidden fields}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/20_update_by_query/Update_by_query with runas user works}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/20_update_by_query/Update_by_query with runas user works}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/30_delete_by_query/Delete_by_query misses hidden fields}\r\norg.elasticsearch.xpack.security.ReindexWithSecurityClientYamlTestSuiteIT test {yaml=/30_delete_by_query/Delete_by_query misses hidden fields}\r\n```\r\n\r\nstacktrace:\r\n\r\n```\r\njavax.net.ssl.SSLHandshakeException: General SSLEngine problem\r\n\tat org.elasticsearch.client.RestClient.extractAndWrapCause(RestClient.java:799)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:225)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:212)\r\n\tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.readVersionsFromCatNodes(ESClientYamlSuiteTestCase.java:298)\r\n\tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.initAndResetContext(ESClientYamlSuiteTestCase.java:124)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1750)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:972)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:988)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:947)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:832)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:883)\r\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:894)\r\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\r\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\r\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\r\n\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\r\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\r\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: javax.net.ssl.SSLHandshakeException: General SSLEngine problem\r\n\tat sun.security.ssl.Handshaker.checkThrown(Handshaker.java:1521)\r\n\tat sun.security.ssl.SSLEngineImpl.checkTaskThrown(SSLEngineImpl.java:528)\r\n\tat sun.security.ssl.SSLEngineImpl.writeAppRecord(SSLEngineImpl.java:1197)\r\n\tat sun.security.ssl.SSLEngineImpl.wrap(SSLEngineImpl.java:1165)\r\n\tat javax.net.ssl.SSLEngine.wrap(SSLEngine.java:469)\r\n\tat org.apache.http.nio.reactor.ssl.SSLIOSession.doWrap(SSLIOSession.java:263)\r\n\tat org.apache.http.nio.reactor.ssl.SSLIOSession.doHandshake(SSLIOSession.java:301)\r\n\tat org.apache.http.nio.reactor.ssl.SSLIOSession.isAppInputReady(SSLIOSession.java:509)\r\n\tat org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:120)\r\n\tat org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n\tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n\tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n\tat org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n\tat org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n\tat org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:591)\r\n\t... 1 more\r\nCaused by: javax.net.ssl.SSLHandshakeException: General SSLEngine problem\r\n\tat sun.security.ssl.Alerts.getSSLException(Alerts.java:192)\r\n\tat sun.security.ssl.SSLEngineImpl.fatal(SSLEngineImpl.java:1709)\r\n\tat sun.security.ssl.Handshaker.fatalSE(Handshaker.java:318)\r\n\tat sun.security.ssl.Handshaker.fatalSE(Handshaker.java:310)\r\n\tat sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1639)\r\n\tat sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:223)\r\n\tat sun.security.ssl.Handshaker.processLoop(Handshaker.java:1037)\r\n\tat sun.security.ssl.Handshaker$1.run(Handshaker.java:970)\r\n\tat sun.security.ssl.Handshaker$1.run(Handshaker.java:967)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat sun.security.ssl.Handshaker$DelegatedTask.run(Handshaker.java:1459)\r\n\tat org.apache.http.nio.reactor.ssl.SSLIOSession.doRunTask(SSLIOSession.java:281)\r\n\tat org.apache.http.nio.reactor.ssl.SSLIOSession.doHandshake(SSLIOSession.java:339)\r\n\t... 9 more\r\nCaused by: sun.security.validator.ValidatorException: PKIX path validation failed: java.security.cert.CertPathValidatorException: Could not validate certificate: certificate expired on 20280714050706GMT+00:00\r\n\tat sun.security.validator.PKIXValidator.doValidate(PKIXValidator.java:362)\r\n\tat sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:270)\r\n\tat sun.security.validator.Validator.validate(Validator.java:262)\r\n\tat sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:324)\r\n\tat sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:281)\r\n\tat sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:136)\r\n\tat sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1626)\r\n\t... 17 more\r\nCaused by: java.security.cert.CertPathValidatorException: Could not validate certificate: certificate expired on 20280714050706GMT+00:00\r\n\tat org.bouncycastle.jcajce.provider.RFC3280CertPathUtilities.processCertA(Unknown Source)\r\n\tat org.bouncycastle.jcajce.provider.PKIXCertPathValidatorSpi.engineValidate(Unknown Source)\r\n\tat java.security.cert.CertPathValidator.validate(CertPathValidator.java:292)\r\n\tat sun.security.validator.PKIXValidator.doValidate(PKIXValidator.java:357)\r\n\t... 23 more\r\nCaused by: java.security.cert.CertificateExpiredException: certificate expired on 20280714050706GMT+00:00\r\n\tat org.bouncycastle.jcajce.provider.X509CertificateObject.checkValidity(Unknown Source)\r\n\t... 27 more\r\n```\r\n\r\ncertificate expired?\r\n\r\n\r\n\r\nsome CI links:\r\n\r\n- https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+matrix-java-periodic/ES_BUILD_JAVA=java11,ES_RUNTIME_JAVA=java8fips,nodes=immutable&&linux&&docker/25/console\r\n- https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=openjdk12,ES_RUNTIME_JAVA=java8fips,nodes=immutable&&linux&&docker/242/console","closed_by":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"performed_via_github_app":null}