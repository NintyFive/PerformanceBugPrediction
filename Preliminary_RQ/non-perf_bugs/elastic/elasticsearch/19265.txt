{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19265","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19265/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19265/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19265/events","html_url":"https://github.com/elastic/elasticsearch/issues/19265","id":163824047,"node_id":"MDU6SXNzdWUxNjM4MjQwNDc=","number":19265,"title":"FVH doesn't highlight nested fields","user":{"login":"sfcgeorge","id":885003,"node_id":"MDQ6VXNlcjg4NTAwMw==","avatar_url":"https://avatars3.githubusercontent.com/u/885003?v=4","gravatar_id":"","url":"https://api.github.com/users/sfcgeorge","html_url":"https://github.com/sfcgeorge","followers_url":"https://api.github.com/users/sfcgeorge/followers","following_url":"https://api.github.com/users/sfcgeorge/following{/other_user}","gists_url":"https://api.github.com/users/sfcgeorge/gists{/gist_id}","starred_url":"https://api.github.com/users/sfcgeorge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sfcgeorge/subscriptions","organizations_url":"https://api.github.com/users/sfcgeorge/orgs","repos_url":"https://api.github.com/users/sfcgeorge/repos","events_url":"https://api.github.com/users/sfcgeorge/events{/privacy}","received_events_url":"https://api.github.com/users/sfcgeorge/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2016-07-05T10:56:48Z","updated_at":"2020-10-16T01:29:26Z","closed_at":"2016-07-13T06:36:04Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.2.2\n\n**JVM version**: 1.8.0_25\n\n**OS version**: OS X 10.11.5\n\n**Description of the problem including expected versus actual behavior**:  \nFast Vector Highlighter doesn't highlight nested fields, whereas Plain Highlighter does (but has a [fragment_size bug](https://github.com/elastic/elasticsearch/issues/9442) so I can't use it). I would expect FVH to be able to highlight everything.\n\n**Steps to reproduce**:\n\n``` sh\ncurl -XPUT 'localhost:9200/nested_fvh?pretty' -d '{\n  \"mappings\": {\n    \"type1\": {\n      \"properties\": {\n        \"nested1\": {\n          \"type\": \"nested\",\n          \"properties\": {\n            \"field1\": { \n              \"type\": \"string\", \n              \"term_vector\" : \"with_positions_offsets\" \n            }\n          }\n        }\n      }\n    }\n  }\n}\n'\n\ncurl -XPUT 'localhost:9200/nested_fvh/type1/1?pretty' -d '{\n  \"nested1\": {\n    \"field1\": \"Hello World!\"\n  }\n}\n'\n\n\ncurl -XGET 'http://localhost:9200/nested_fvh/type1/_search?pretty' -d '{\n  \"query\": {\n    \"nested\": {\n      \"path\": \"nested1\",\n      \"query\": {\n        \"match\": {\n          \"nested1.field1\": \"hello\"\n        }\n      }\n    }\n  },\n  \"highlight\": {\n    \"fields\": {\n      \"nested1.field1\": { \n        \"type\": \"fvh\"\n      }\n    }\n  }\n}\n'\n```\n\n**Output (fvh)**:\n<details>\n<summary>\n\nFVH doesn't highlight nested</summary>\n\n\n\n``` json\n{\n  \"took\" : 3,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 0.4231198,\n    \"hits\" : [ {\n      \"_index\" : \"nested_fvh\",\n      \"_type\" : \"type1\",\n      \"_id\" : \"1\",\n      \"_score\" : 0.4231198,\n      \"_source\" : {\n        \"nested1\" : {\n          \"field1\" : \"Hello World!\"\n        }\n      }\n    } ]\n  }\n}\n```\n\n</details>\n\n**Output (plain)**:\n<details>\n<summary>\n\nPlain does highlight nested</summary>\n\n\n\n``` json\n{\n  \"took\" : 3,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 0.4231198,\n    \"hits\" : [ {\n      \"_index\" : \"nested_fvh\",\n      \"_type\" : \"type1\",\n      \"_id\" : \"1\",\n      \"_score\" : 0.4231198,\n      \"_source\" : {\n        \"nested1\" : {\n          \"field1\" : \"Hello World!\"\n        }\n      },\n      \"highlight\" : {\n        \"nested1.field1\" : [ \"<em>Hello</em> World!\" ]\n      }\n    } ]\n  }\n}\n```\n\n</details>\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}