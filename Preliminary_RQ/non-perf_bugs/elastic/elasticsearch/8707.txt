{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8707","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8707/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8707/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8707/events","html_url":"https://github.com/elastic/elasticsearch/issues/8707","id":50428271,"node_id":"MDU6SXNzdWU1MDQyODI3MQ==","number":8707,"title":"CorruptIndex after restart ES, footer mismatch","user":{"login":"mehmetgunturkun","id":3748385,"node_id":"MDQ6VXNlcjM3NDgzODU=","avatar_url":"https://avatars2.githubusercontent.com/u/3748385?v=4","gravatar_id":"","url":"https://api.github.com/users/mehmetgunturkun","html_url":"https://github.com/mehmetgunturkun","followers_url":"https://api.github.com/users/mehmetgunturkun/followers","following_url":"https://api.github.com/users/mehmetgunturkun/following{/other_user}","gists_url":"https://api.github.com/users/mehmetgunturkun/gists{/gist_id}","starred_url":"https://api.github.com/users/mehmetgunturkun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehmetgunturkun/subscriptions","organizations_url":"https://api.github.com/users/mehmetgunturkun/orgs","repos_url":"https://api.github.com/users/mehmetgunturkun/repos","events_url":"https://api.github.com/users/mehmetgunturkun/events{/privacy}","received_events_url":"https://api.github.com/users/mehmetgunturkun/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2014-11-29T15:05:49Z","updated_at":"2020-07-06T03:55:22Z","closed_at":"2014-12-06T21:44:56Z","author_association":"NONE","active_lock_reason":null,"body":"Hey everyone, \nI have an index, called metadata, with 5 shards and 1 replicas, After restart ES, index cannot be fully-recovered . All primary shards are recovered properly. However two of the shards were remained unassigned. \nES version: 1.3.2\nWhen I executed this command:\n\ncurl -XGET \"http:/localhost:9200/_cat/shards\n\nmetadata 2  p  STARTED 7712779 4.2gb ip-1 Motormouth \nmetadata 2  r   STARTED 7712779 4.2gb ip-2 Harold \"Happy\" Hogan \nmetadata 0  p  STARTED 7714351 4.1gb ip-2 Harold \"Happy\" Hogan \nmetadata 0  r   UNASSIGNED \nmetadata 3  p  STARTED 7711363 4.6gb ip-1 Motormouth \nmetadata 3  r   STARTED 7711363 4.6gb ip-2 Harold \"Happy\" Hogan \nmetadata 1  p  STARTED 7712560 4.2gb ip-2 Harold \"Happy\" Hogan \nmetadata 1  r   UNASSIGNED \nmetadata 4  p  STARTED 7714620 2.7gb ip-1 Motormouth \nmetadata 4  r   STARTED 7714620 2.7gb ip-2 Harold \"Happy\" Hogan\n## When I try to allocate for shards: 0 and 1 for Motormouth it gives an exception like that:\n\n[2014-11-29 15:01:58,383][WARN ][index.engine.internal    ] [Motormouth] [metadata][0] failed engine [corrupted preexisting index]\n[2014-11-29 15:01:58,384][WARN ][indices.cluster          ] [Motormouth] [metadata][0] failed to start shard\norg.apache.lucene.index.CorruptIndexException: [metadata][0] Corrupted index [corrupted_3gXTXI3KQtm2e1WPsFntkg] caused by: CorruptIndexException[codec footer mismatch: actual footer=1308690703 vs expected footer=-1071082520 (resource: NIOFSIndexInput(path=\"/var/lib/elasticsearch/elasticsearch/nodes/0/indices/metadata/0/index/_8x9g.fdt\"))]\n    at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:343)\n    at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:328)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.applyInitializingShard(IndicesClusterStateService.java:727)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.applyNewOrUpdatedShards(IndicesClusterStateService.java:580)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.clusterChanged(IndicesClusterStateService.java:184)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:444)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:153)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n\n---\n\n2014-11-29 15:01:58,437][WARN ][index.engine.internal    ] [Motormouth] [metadata][1] failed engine [corrupted preexisting index]\n[2014-11-29 15:01:58,437][WARN ][indices.cluster          ] [Motormouth] [metadata][1] failed to start shard\norg.apache.lucene.index.CorruptIndexException: [metadata][1] Corrupted index [corrupted_P-smhoB-SEeM7kHiTsIEug] caused by: CorruptIndexException[codec footer mismatch: actual footer=-262453147 vs expected footer=-1071082520 (resource: NIOFSIndexInput(path=\"/var/lib/elasticsearch/elasticsearch/nodes/0/indices/metadata/1/index/_avoi_es090_0.doc\"))]\n    at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:343)\n    at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:328)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.applyInitializingShard(IndicesClusterStateService.java:727)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.applyNewOrUpdatedShards(IndicesClusterStateService.java:580)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.clusterChanged(IndicesClusterStateService.java:184)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:444)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:153)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n\n---\n\nHope someone can help.\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}