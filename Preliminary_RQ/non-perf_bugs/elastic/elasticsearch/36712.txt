{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36712","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36712/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36712/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36712/events","html_url":"https://github.com/elastic/elasticsearch/issues/36712","id":391730255,"node_id":"MDU6SXNzdWUzOTE3MzAyNTU=","number":36712,"title":"Indices stats API should provide external refresh stats","user":{"login":"clandry94","id":5351125,"node_id":"MDQ6VXNlcjUzNTExMjU=","avatar_url":"https://avatars0.githubusercontent.com/u/5351125?v=4","gravatar_id":"","url":"https://api.github.com/users/clandry94","html_url":"https://github.com/clandry94","followers_url":"https://api.github.com/users/clandry94/followers","following_url":"https://api.github.com/users/clandry94/following{/other_user}","gists_url":"https://api.github.com/users/clandry94/gists{/gist_id}","starred_url":"https://api.github.com/users/clandry94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clandry94/subscriptions","organizations_url":"https://api.github.com/users/clandry94/orgs","repos_url":"https://api.github.com/users/clandry94/repos","events_url":"https://api.github.com/users/clandry94/events{/privacy}","received_events_url":"https://api.github.com/users/clandry94/received_events","type":"User","site_admin":false},"labels":[{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2018-12-17T14:13:01Z","updated_at":"2019-03-15T21:06:54Z","closed_at":"2019-03-15T21:06:54Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the feature**:\r\n\r\nCurrently, refresh stats are contained at the index level are an average of all shard refreshes within that index and exposed through the `_stats` api. Likewise, individual shards do collect refresh statistics, but only for `INTERNAL` refresh events and these statistics are not publicly accessible through the rest API. \r\n\r\nI'm proposing the following two features to be added to elasticsearch:\r\n1) A mechanism or data structure to distinguish between `EXTERNAL` and `INTERNAL` refreshes within shards \r\n~2) Extending the `_stats` to provide shard level refresh statistics.~ this is already implemented e.g.\r\n```\r\nGET /my_index/_stats/refresh\r\n```\r\nwould respond with\r\n```\r\n{\r\n  \"_shards\" : {\r\n    \"total\" : 800,\r\n    \"successful\" : 800,\r\n    \"failed\" : 0\r\n  },\r\n  \"_all\" : {\r\n    \"primaries\" : {\r\n      \"refresh\" : {\r\n        \"total\" : 3952969,\r\n        \"total_time_in_millis\" : 325583210,\r\n        \"listeners\" : 0\r\n      }\r\n    },\r\n    \"total\" : {\r\n      \"refresh\" : {\r\n        \"total\" : 7898248,\r\n        \"total_time_in_millis\" : 649856023,\r\n        \"listeners\" : 0\r\n      }\r\n    }\r\n  },\r\n  \"indices\" : {\r\n    \"products.3\" : {\r\n      \"uuid\" : \"rFXl6ARRXRIiXVjKlh4qLEw\",\r\n      \"primaries\" : {\r\n        \"refresh\" : {\r\n          \"total\" : 3952969,\r\n          \"total_time_in_millis\" : 325583210,\r\n          \"listeners\" : 0\r\n        }\r\n      },\r\n      \"total\" : {\r\n        \"refresh\" : {\r\n          \"total\" : 7898248,\r\n          \"total_time_in_millis\" : 649856023,\r\n          \"listeners\" : 0\r\n        }\r\n      }\r\n     \"shards\": [\r\n       { \r\n         \"id\": 1,\r\n         \"refresh\" : {\r\n          \"total\" : 9050918,\r\n          \"total_time_in_millis\" : 948194819,\r\n          \"listeners\" : 0\r\n        }\r\n      },\r\n      { \r\n         \"id\": 2,\r\n         \"refresh\" : {\r\n          \"total\" : 412740,\r\n          \"total_time_in_millis\" : 4921479849,\r\n          \"listeners\" : 0\r\n        }\r\n      },\r\n     ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nRelated issue and prior discussion with @s1monw  https://github.com/elastic/elasticsearch/issues/36541 \r\n\r\nI can take on this and start working on it if all looks good üëç ","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}