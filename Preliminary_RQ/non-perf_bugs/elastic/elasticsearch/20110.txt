{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20110","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20110/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20110/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20110/events","html_url":"https://github.com/elastic/elasticsearch/issues/20110","id":172577256,"node_id":"MDU6SXNzdWUxNzI1NzcyNTY=","number":20110,"title":"Tribe enabled with a cluster with unknown host returned for DNS exits even if some clusters are accessible ","user":{"login":"rzenker","id":1151721,"node_id":"MDQ6VXNlcjExNTE3MjE=","avatar_url":"https://avatars1.githubusercontent.com/u/1151721?v=4","gravatar_id":"","url":"https://api.github.com/users/rzenker","html_url":"https://github.com/rzenker","followers_url":"https://api.github.com/users/rzenker/followers","following_url":"https://api.github.com/users/rzenker/following{/other_user}","gists_url":"https://api.github.com/users/rzenker/gists{/gist_id}","starred_url":"https://api.github.com/users/rzenker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rzenker/subscriptions","organizations_url":"https://api.github.com/users/rzenker/orgs","repos_url":"https://api.github.com/users/rzenker/repos","events_url":"https://api.github.com/users/rzenker/events{/privacy}","received_events_url":"https://api.github.com/users/rzenker/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-08-22T23:17:16Z","updated_at":"2016-08-23T12:52:58Z","closed_at":"2016-08-23T12:52:57Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3.5 (using https://hub.docker.com/_/elasticsearch/)\n\n**Plugins installed**: head, license, cloud-aws, marvel-agent (marvel is disabled on tribe and master-only nodes)\n\n**JVM version**: https://hub.docker.com/_/elasticsearch/\n\n**OS version**: https://hub.docker.com/_/elasticsearch/\n\n**Description of the problem including expected versus actual behavior**:\nConfigure tribe for all possible remote clusters, but only some may be available at a single time.  This configuration uses service discovery and DNS because the IPs will be dynamic. If a cluster is not yet up or DNS fails to resolve a remote entry, elasticsearch exits.  If i configure only the DNS cluster entries that are up at the time of startup, then it appears to work as intended.\n\nMy assumption is that it would continue retrying at a backoff interval and serving requests for the clusters it can successfully connect to.  I'm not sure if this behavior would also affect an extended WAN outage, but would prefer a similar robust behavior.\n\n**Steps to reproduce**:\n1.  Configure tribe nodes with DNS with at least one being unknown host at startup:\n\n``` \"-Des.node.data=false\",\n     \"-Des.node.master=false\",\n     \"-Des.marvel.enabled=false\",\n     \"-Des.tribe.dc1.cluster.name=dc1-elasticsearch\",\n     \"-Des.tribe.dc1.discovery.zen.ping.unicast.hosts=master-elasticsearch-dc1\",\n     \"-Des.tribe.dc2.cluster.name=dc2-elasticsearch\",\n     \"-Des.tribe.dc2.discovery.zen.ping.unicast.hosts=master-elasticsearch-dc2\",\n```\n1.  elasticsearch will exit with exception below.\n\n**Provide logs (if relevant)**:\nException in thread \"main\" java.lang.IllegalArgumentException: Failed to resolve address for [master-elasticsearch-dc2]\nLikely root cause: java.net.UnknownHostException: master-elasticsearch-dc2: unknown error\n        at java.net.Inet6AddressImpl.lookupAllHostAddr(Native Method)\n        at java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:928)\n        at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1323)\n        at java.net.InetAddress.getAllByName0(InetAddress.java:1276)\n        at java.net.InetAddress.getAllByName(InetAddress.java:1192)\n        at java.net.InetAddress.getAllByName(InetAddress.java:1126)\n        at org.elasticsearch.transport.netty.NettyTransport.parse(NettyTransport.java:733)\n        at org.elasticsearch.transport.netty.NettyTransport.addressesFromString(NettyTransport.java:685)\n        at org.elasticsearch.transport.TransportService.addressesFromString(TransportService.java:424)\n        at org.elasticsearch.discovery.zen.ping.unicast.UnicastZenPing.<init>(UnicastZenPing.java:160)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)\n        at <<<guice>>>\n        at org.elasticsearch.node.Node.<init>(Node.java:213)\n        at org.elasticsearch.tribe.TribeClientNode.<init>(TribeClientNode.java:35)\n        at org.elasticsearch.tribe.TribeService.<init>(TribeService.java:146)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)\n        at <<<guice>>>\n        at org.elasticsearch.node.Node.<init>(Node.java:213)\n        at org.elasticsearch.node.Node.<init>(Node.java:140)\n        at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:143)\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:178)\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:270)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}