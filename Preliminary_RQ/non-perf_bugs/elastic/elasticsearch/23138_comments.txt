[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279312957","html_url":"https://github.com/elastic/elasticsearch/issues/23138#issuecomment-279312957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23138","id":279312957,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTMxMjk1Nw==","user":{"login":"engimatic","id":14733591,"node_id":"MDQ6VXNlcjE0NzMzNTkx","avatar_url":"https://avatars1.githubusercontent.com/u/14733591?v=4","gravatar_id":"","url":"https://api.github.com/users/engimatic","html_url":"https://github.com/engimatic","followers_url":"https://api.github.com/users/engimatic/followers","following_url":"https://api.github.com/users/engimatic/following{/other_user}","gists_url":"https://api.github.com/users/engimatic/gists{/gist_id}","starred_url":"https://api.github.com/users/engimatic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/engimatic/subscriptions","organizations_url":"https://api.github.com/users/engimatic/orgs","repos_url":"https://api.github.com/users/engimatic/repos","events_url":"https://api.github.com/users/engimatic/events{/privacy}","received_events_url":"https://api.github.com/users/engimatic/received_events","type":"User","site_admin":false},"created_at":"2017-02-13T07:31:16Z","updated_at":"2017-02-13T07:31:16Z","author_association":"NONE","body":"Otherwith,when I try to use rangeQuery,I hava also catch with some error\r\n```\r\nprivate <T> ArrayList<T> connectES2(Calendar timestamp, String index, String type, Class<T> clazz) {\r\n\r\n        ArrayList<T> values = new ArrayList<>();\r\n        if (!client.admin().indices().prepareExists(index).execute().actionGet().isExists()) {\r\n            System.out.println(\"索引\" + index + \"不存在\");\r\n            return values;\r\n        }\r\n        timestamp.add(Calendar.SECOND,10);\r\n        Date end = timestamp.getTime();\r\n        timestamp.add(Calendar.MINUTE,-1);\r\n        Date start = timestamp.getTime();\r\n        SearchResponse scrollResp = client.prepareSearch(index)\r\n                .setTypes(type).setSearchType(SearchType.QUERY_THEN_FETCH)\r\n                .setQuery(QueryBuilders.rangeQuery(\"start_timestamp\").from(start).to(end))\r\n                .setScroll(new TimeValue(60000))\r\n                .setSize(10000).execute().actionGet();\r\n\r\n\r\n        System.out.println(scrollResp.getHits().getTotalHits());\r\n\r\n\r\n        while (true) {\r\n            for (SearchHit hit : scrollResp.getHits().getHits()) {\r\n                T value = JSON.parseObject(hit.sourceAsString(), clazz);\r\n                values.add(value);\r\n            }\r\n            scrollResp = client.prepareSearchScroll(scrollResp.getScrollId()).setScroll(new TimeValue(60000)).execute\r\n                    ().actionGet();\r\n            //Break condition: No hits are returned\r\n            if (scrollResp.getHits().getHits().length == 0) {\r\n                break;\r\n            }\r\n        }\r\n        return values;\r\n    }\r\n```\r\n```\r\nException in thread \"main\" Failed to execute phase [query], all shards failed; shardFailures {[sMXWKy4XSFOVQ1d8oZFWyw][http-stat-session-2017.02.09][0]: RemoteTransportException[[node-hot][10.128.9.207:9300][indices:data/read/search[phase/query]]]; nested: ElasticsearchParseException[failed to parse date field [Mon Feb 13 14:59:10 CST 2017] with format [strict_date_optional_time||epoch_millis]]; nested: IllegalArgumentException[Parse failure at index [0] of [Mon Feb 13 14:59:10 CST 2017]]; }{[sMXWKy4XSFOVQ1d8oZFWyw][http-stat-session-2017.02.09][1]: RemoteTransportException[[node-hot][10.128.9.207:9300][indices:data/read/search[phase/query]]]; nested: ElasticsearchParseException[failed to parse date field [Mon Feb 13 14:59:10 CST 2017] with format [strict_date_optional_time||epoch_millis]]; nested: IllegalArgumentException[Parse failure at index [0] of [Mon Feb 13 14:59:10 CST 2017]]; }{[sMXWKy4XSFOVQ1d8oZFWyw][http-stat-session-2017.02.09][2]: RemoteTransportException[[node-hot][10.128.9.207:9300][indices:data/read/search[phase/query]]]; nested: ElasticsearchParseException[failed to parse date field [Mon Feb 13 14:59:10 CST 2017] with format [strict_date_optional_time||epoch_millis]]; nested: IllegalArgumentException[Parse failure at index [0] of [Mon Feb 13 14:59:10 CST 2017]]; }{[sMXWKy4XSFOVQ1d8oZFWyw][http-stat-session-2017.02.09][3]: RemoteTransportException[[node-hot][10.128.9.207:9300][indices:data/read/search[phase/query]]]; nested: ElasticsearchParseException[failed to parse date field [Mon Feb 13 14:59:10 CST 2017] with format [strict_date_optional_time||epoch_millis]]; nested: IllegalArgumentException[Parse failure at index [0] of [Mon Feb 13 14:59:10 CST 2017]]; }{[sMXWKy4XSFOVQ1d8oZFWyw][http-stat-session-2017.02.09][4]: RemoteTransportException[[node-hot][10.128.9.207:9300][indices:data/read/search[phase/query]]]; nested: ElasticsearchParseException[failed to parse date field [Mon Feb 13 14:59:10 CST 2017] with format [strict_date_optional_time||epoch_millis]]; nested: IllegalArgumentException[Parse failure at index [0] of [Mon Feb 13 14:59:10 CST 2017]]; }\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onFirstPhaseResult(AbstractSearchAsyncAction.java:208)\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.access$100(AbstractSearchAsyncAction.java:52)\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:143)\r\n\tat org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:51)\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1024)\r\n\tat org.elasticsearch.transport.TcpTransport.lambda$handleException$17(TcpTransport.java:1411)\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:109)\r\n\tat org.elasticsearch.transport.TcpTransport.handleException(TcpTransport.java:1409)\r\n\tat org.elasticsearch.transport.TcpTransport.handlerResponseError(TcpTransport.java:1401)\r\n\tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:1345)\r\n\tat org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:74)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:363)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:349)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:341)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:293)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:280)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:396)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:248)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:363)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:349)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:341)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1334)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:363)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:349)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:926)\r\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:129)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:642)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:527)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:481)\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:441)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: RemoteTransportException[[node-hot][10.128.9.207:9300][indices:data/read/search[phase/query]]]; nested: ElasticsearchParseException[failed to parse date field [Mon Feb 13 14:59:10 CST 2017] with format [strict_date_optional_time||epoch_millis]]; nested: IllegalArgumentException[Parse failure at index [0] of [Mon Feb 13 14:59:10 CST 2017]];\r\nCaused by: ElasticsearchParseException[failed to parse date field [Mon Feb 13 14:59:10 CST 2017] with format [strict_date_optional_time||epoch_millis]]; nested: IllegalArgumentException[Parse failure at index [0] of [Mon Feb 13 14:59:10 CST 2017]];\r\n\tat org.elasticsearch.common.joda.DateMathParser.parseDateTime(DateMathParser.java:213)\r\n\tat org.elasticsearch.common.joda.DateMathParser.parse(DateMathParser.java:66)\r\n\tat org.elasticsearch.index.mapper.LegacyDateFieldMapper$DateFieldType.parseToMilliseconds(LegacyDateFieldMapper.java:396)\r\n\tat org.elasticsearch.index.mapper.LegacyDateFieldMapper$DateFieldType.isFieldWithinQuery(LegacyDateFieldMapper.java:350)\r\n\tat org.elasticsearch.index.query.RangeQueryBuilder.getRelation(RangeQueryBuilder.java:462)\r\n\tat org.elasticsearch.index.query.RangeQueryBuilder.doRewrite(RangeQueryBuilder.java:469)\r\n\tat org.elasticsearch.index.query.AbstractQueryBuilder.rewrite(AbstractQueryBuilder.java:264)\r\n\tat org.elasticsearch.search.builder.SearchSourceBuilder.rewrite(SearchSourceBuilder.java:860)\r\n\tat org.elasticsearch.search.internal.ShardSearchLocalRequest.rewrite(ShardSearchLocalRequest.java:232)\r\n\tat org.elasticsearch.search.internal.ShardSearchTransportRequest.rewrite(ShardSearchTransportRequest.java:166)\r\n\tat org.elasticsearch.search.SearchService.createSearchContext(SearchService.java:584)\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:534)\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:516)\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:251)\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:298)\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:295)\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69)\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1488)\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:596)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: java.lang.IllegalArgumentException: Parse failure at index [0] of [Mon Feb 13 14:59:10 CST 2017]\r\n\tat org.elasticsearch.common.joda.DateMathParser.parseDateTime(DateMathParser.java:207)\r\n\t... 22 more\r\n\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279330158","html_url":"https://github.com/elastic/elasticsearch/issues/23138#issuecomment-279330158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23138","id":279330158,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTMzMDE1OA==","user":{"login":"engimatic","id":14733591,"node_id":"MDQ6VXNlcjE0NzMzNTkx","avatar_url":"https://avatars1.githubusercontent.com/u/14733591?v=4","gravatar_id":"","url":"https://api.github.com/users/engimatic","html_url":"https://github.com/engimatic","followers_url":"https://api.github.com/users/engimatic/followers","following_url":"https://api.github.com/users/engimatic/following{/other_user}","gists_url":"https://api.github.com/users/engimatic/gists{/gist_id}","starred_url":"https://api.github.com/users/engimatic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/engimatic/subscriptions","organizations_url":"https://api.github.com/users/engimatic/orgs","repos_url":"https://api.github.com/users/engimatic/repos","events_url":"https://api.github.com/users/engimatic/events{/privacy}","received_events_url":"https://api.github.com/users/engimatic/received_events","type":"User","site_admin":false},"created_at":"2017-02-13T09:07:38Z","updated_at":"2017-02-13T09:07:38Z","author_association":"NONE","body":"I have resolved this issue.\r\nThe resolve method is easy.\r\nWith elastic2.2,we can use java.util.Date,but in elastic5.2,we should use org.joda.time.DateTime.Just do it like this\r\n```\r\npre: QueryBuilders.matchQuery(\"start_timestamp\", timestamp)\r\ncurrent: QueryBuilders.matchQuery(\"start_timestamp\", new DateTime(timestamp))\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308196333","html_url":"https://github.com/elastic/elasticsearch/issues/23138#issuecomment-308196333","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23138","id":308196333,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODE5NjMzMw==","user":{"login":"jayrorodrigues","id":27500380,"node_id":"MDQ6VXNlcjI3NTAwMzgw","avatar_url":"https://avatars0.githubusercontent.com/u/27500380?v=4","gravatar_id":"","url":"https://api.github.com/users/jayrorodrigues","html_url":"https://github.com/jayrorodrigues","followers_url":"https://api.github.com/users/jayrorodrigues/followers","following_url":"https://api.github.com/users/jayrorodrigues/following{/other_user}","gists_url":"https://api.github.com/users/jayrorodrigues/gists{/gist_id}","starred_url":"https://api.github.com/users/jayrorodrigues/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jayrorodrigues/subscriptions","organizations_url":"https://api.github.com/users/jayrorodrigues/orgs","repos_url":"https://api.github.com/users/jayrorodrigues/repos","events_url":"https://api.github.com/users/jayrorodrigues/events{/privacy}","received_events_url":"https://api.github.com/users/jayrorodrigues/received_events","type":"User","site_admin":false},"created_at":"2017-06-13T17:51:34Z","updated_at":"2017-06-13T17:51:34Z","author_association":"NONE","body":"Thank's.","performed_via_github_app":null}]