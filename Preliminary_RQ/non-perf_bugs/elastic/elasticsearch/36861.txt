{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36861","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36861/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36861/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36861/events","html_url":"https://github.com/elastic/elasticsearch/issues/36861","id":392745584,"node_id":"MDU6SXNzdWUzOTI3NDU1ODQ=","number":36861,"title":"Java High Level Rest Client cannot parse weighted_avg result","user":{"login":"xpando","id":69182,"node_id":"MDQ6VXNlcjY5MTgy","avatar_url":"https://avatars2.githubusercontent.com/u/69182?v=4","gravatar_id":"","url":"https://api.github.com/users/xpando","html_url":"https://github.com/xpando","followers_url":"https://api.github.com/users/xpando/followers","following_url":"https://api.github.com/users/xpando/following{/other_user}","gists_url":"https://api.github.com/users/xpando/gists{/gist_id}","starred_url":"https://api.github.com/users/xpando/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xpando/subscriptions","organizations_url":"https://api.github.com/users/xpando/orgs","repos_url":"https://api.github.com/users/xpando/repos","events_url":"https://api.github.com/users/xpando/events{/privacy}","received_events_url":"https://api.github.com/users/xpando/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-12-19T19:28:36Z","updated_at":"2019-01-03T21:43:23Z","closed_at":"2019-01-02T21:54:11Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n  \"version\" : {\r\n    \"number\" : \"6.5.2\",\r\n    \"build_flavor\" : \"default\",\r\n    \"build_type\" : \"rpm\",\r\n    \"build_hash\" : \"9434bed\",\r\n    \"build_date\" : \"2018-11-29T23:58:20.891072Z\",\r\n    \"build_snapshot\" : false,\r\n    \"lucene_version\" : \"7.5.0\",\r\n    \"minimum_wire_compatibility_version\" : \"5.6.0\",\r\n    \"minimum_index_compatibility_version\" : \"5.0.0\"\r\n  }\r\n\r\nHigh level rest client version from build.gradle:\r\n    compile group: 'org.elasticsearch', name: 'elasticsearch', version: '6.5.4'\r\n    compile group: 'org.elasticsearch.client', name: 'elasticsearch-rest-high-level-client', version: '6.5.4'\r\n\r\n\r\n**Plugins installed**: \r\n[]\r\n\r\n**JVM version** (`java -version`): \r\njava version \"1.8.0_181\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_181-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nDarwin dfindley-macbook.local 18.2.0 Darwin Kernel Version 18.2.0: Fri Oct  5 19:41:49 PDT 2018; root:xnu-4903.221.2~2/RELEASE_X86_64 x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. create a terms aggregation with a weighted_avg sub aggregation.\r\n\r\nThe query is produced just fine and a correct response is returned from the ElasticSearch server but an exception is thrown on parsing the result. See log below.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\norg.elasticsearch.common.xcontent.NamedObjectNotFoundException: [1:389] unable to parse Aggregation with name [weighted_avg]: parser not found\r\n\tat org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:132)\r\n\tat org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433)\r\n\tat org.elasticsearch.common.xcontent.XContentParserUtils.parseTypedKeysObject(XContentParserUtils.java:153)\r\n\tat org.elasticsearch.search.aggregations.bucket.terms.ParsedTerms$ParsedBucket.parseTermsBucketXContent(ParsedTerms.java:139)\r\n\tat org.elasticsearch.search.aggregations.bucket.terms.ParsedLongTerms$ParsedBucket.fromXContent(ParsedLongTerms.java:82)\r\n\tat org.elasticsearch.search.aggregations.ParsedMultiBucketAggregation.lambda$declareMultiBucketAggregationFields$0(ParsedMultiBucketAggregation.java:75)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseValue(ObjectParser.java:314)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseArray(ObjectParser.java:308)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parseSub(ObjectParser.java:329)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parse(ObjectParser.java:168)\r\n\tat org.elasticsearch.common.xcontent.ObjectParser.parse(ObjectParser.java:131)\r\n\tat org.elasticsearch.search.aggregations.bucket.terms.ParsedLongTerms.fromXContent(ParsedLongTerms.java:42)\r\n\tat org.elasticsearch.client.RestHighLevelClient.lambda$getDefaultNamedXContents$38(RestHighLevelClient.java:1850)\r\n\tat org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141)\r\n\tat org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433)\r\n\tat org.elasticsearch.common.xcontent.XContentParserUtils.parseTypedKeysObject(XContentParserUtils.java:153)\r\n\tat org.elasticsearch.search.aggregations.Aggregations.fromXContent(Aggregations.java:141)\r\n\tat org.elasticsearch.action.search.SearchResponse.innerFromXContent(SearchResponse.java:289)\r\n\tat org.elasticsearch.action.search.SearchResponse.fromXContent(SearchResponse.java:248)\r\n\tat org.elasticsearch.client.RestHighLevelClient.parseEntity(RestHighLevelClient.java:1793)\r\n\tat org.elasticsearch.client.RestHighLevelClient.lambda$performRequestAndParseEntity$9(RestHighLevelClient.java:1526)\r\n\tat org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1610)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1563)\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1525)\r\n\tat org.elasticsearch.client.RestHighLevelClient.search(RestHighLevelClient.java:990)\r\n```\r\n","closed_by":{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false},"performed_via_github_app":null}