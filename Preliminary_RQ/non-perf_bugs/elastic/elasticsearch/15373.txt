{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15373","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15373/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15373/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15373/events","html_url":"https://github.com/elastic/elasticsearch/issues/15373","id":121516297,"node_id":"MDU6SXNzdWUxMjE1MTYyOTc=","number":15373,"title":"tribe node: failed to send join request to master","user":{"login":"rogerwelin","id":3634535,"node_id":"MDQ6VXNlcjM2MzQ1MzU=","avatar_url":"https://avatars3.githubusercontent.com/u/3634535?v=4","gravatar_id":"","url":"https://api.github.com/users/rogerwelin","html_url":"https://github.com/rogerwelin","followers_url":"https://api.github.com/users/rogerwelin/followers","following_url":"https://api.github.com/users/rogerwelin/following{/other_user}","gists_url":"https://api.github.com/users/rogerwelin/gists{/gist_id}","starred_url":"https://api.github.com/users/rogerwelin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rogerwelin/subscriptions","organizations_url":"https://api.github.com/users/rogerwelin/orgs","repos_url":"https://api.github.com/users/rogerwelin/repos","events_url":"https://api.github.com/users/rogerwelin/events{/privacy}","received_events_url":"https://api.github.com/users/rogerwelin/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2015-12-10T15:49:45Z","updated_at":"2016-05-10T18:34:30Z","closed_at":"2016-02-14T19:00:22Z","author_association":"NONE","active_lock_reason":null,"body":"I'm running 2 clusters and cannot get a tribe node to connect to them. Im running ES 2.1 on every ES nodes, including the tribe node.\n\nClusterA has only one node and clusterB has only one node\n\n> ClusterA:\n> cluster.name: clusterA \n> node.name: nodeA\n> node.master: true\n> node.data: true\n> network.host: 0.0.0.0\n> http.port: 9200\n> transport.tcp.port: 9300\n> discovery.zen.ping.multicast.enabled: false\n> discovery.zen.ping.unicast.hosts: [\"dns-name-for-clusterA:9300\"]\n\nConfiguration for tribe node (for simplicity sake I only trying here to connect to clusterA):\n\n> cluster.name: elasticsearch-tribe\n> node.name: tribe-node\n> tribe.t1.path.conf: /etc/elasticsearch/tribe.yml  #14573 \n> tribe.t1.cluster.name: clusterA\n> tribe.t1.discovery.zen.multicast.enabled: false\n> tribe.t1.discovery.zen.ping.unicast.hosts: [\"dns-name-for-clusterA:9300\"]\n> network.host: 0.0.0.0\n> http.port: 9201\n> transport.tcp.port: 9301\n\nWhen starting both tribe and cluster this is shown in the ES tribe log:\n\n> [2015-12-10 16:30:29,576][INFO ][discovery                ] [tribe-node/t1] clusterA/bcjwWrFiRw6ixzNxW9pLRA\n> [2015-12-10 16:30:48,723][INFO ][discovery.zen            ] [tribe-node/t1] failed to send join request to master [{....}{R-LGKQuaRaObh89PJbmPig}{ip-number}{ip-number:9300}{max_local_storage_nodes=1, master=true}], reason [RemoteTransportException[[dns-name][10.85.96.85:9300][internal:discovery/zen/join]]; nested: IllegalStateException[Node [{dns-name}{R-LGKQuaRaObh89PJbmPig}{ip-number}{ip-number:9300}{max_local_storage_nodes=1, master=true}] not master for join request]; ]\n> [2015-12-10 16:30:59,577][WARN ][discovery                ] [tribe-node/t1] waited for 30s and no initial state was set by the discovery\n> [2015-12-10 16:30:59,579][INFO ][node                     ] [tribe-node/t1] started\n> [2015-12-10 16:30:59,579][INFO ][node                     ] [tribe-node] started\n> [2015-12-10 16:32:25,784][INFO ][discovery.zen            ] [tribe-node/t1] failed to send join request to master [{ip-number}{R-LGKQuaRaObh89PJbmPig}{ip-number}{ip-number:9300}{max_local_storage_nodes=1, master=true}], reason [RemoteTransportException[[dns-name][ipnumber:9300][internal:discovery/zen/join]]; nested: IllegalStateException[Node [{dnsname}{R-LGKQuaRaObh89PJbmPig}{ipnumber}{ipnumber:9300}{max_local_storage_nodes=1, master=true}] not master for join request]; ]\n\nAnd on clusterA:s log it adds the tribe node and removes it repeatedly:\n\n> [2015-12-10 16:32:28,807][INFO ][cluster.service          ] [dnsname] new_master {dnsname}{R-LGKQuaRaObh89PJbmPig}{ip-number}{ip-number:9300}{max_local_storage_nodes=1, master=true}, r\n> eason: zen-disco-join(elected_as_master, [0] joins received)\n> [2015-12-10 16:32:28,849][INFO ][cluster.service          ] [dnsname] added {{tribe-node/t1}{bcjwWrFiRw6ixzNxW9pLRA}{127.0.0.1}{127.0.0.1:9300}{data=false, client=true},}, reason: zen-disco-join(join from\n>  node[{tribe-node/t1}{bcjwWrFiRw6ixzNxW9pLRA}{127.0.0.1}{127.0.0.1:9300}{data=false, client=true}])\n> [2015-12-10 16:32:58,854][WARN ][discovery.zen.publish    ] [dnsname] timed out waiting for all nodes to process published state [14](timeout [30s], pending nodes: [{tribe-node/t1}{bcjwWrFiRw6ixzNxW9pLRA\n> }{127.0.0.1}{127.0.0.1:9300}{data=false, client=true}])\n> [2015-12-10 16:32:58,857][WARN ][cluster.service          ] [dnsname] cluster state update task [zen-disco-join(join from node[{tribe-node/t1}{bcjwWrFiRw6ixzNxW9pLRA}{127.0.0.1}{127.0.0.1:9300}{data=false\n> , client=true}])] took 30s above the warn threshold of 30s\n> [2015-12-10 16:32:58,860][INFO ][cluster.service          ] [dnsname] removed {{tribe-node/t1}{bcjwWrFiRw6ixzNxW9pLRA}{127.0.0.1}{127.0.0.1:9300}{data=false, client=true},}, reason: zen-disco-node_failed(\n> {tribe-node/t1}{bcjwWrFiRw6ixzNxW9pLRA}{127.0.0.1}{127.0.0.1:9300}{data=false, client=true}), reason failed to ping, tried [3] times, each with maximum [30s] timeout\n\nWhat am I doing wrong here? I've tried several different configuration changes but cannot get it to work. Also I have had no problem with the exact same setup wiith ES 1.4.4\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}