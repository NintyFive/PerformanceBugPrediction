{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18996/events","html_url":"https://github.com/elastic/elasticsearch/issues/18996","id":161425098,"node_id":"MDU6SXNzdWUxNjE0MjUwOTg=","number":18996,"title":"TransportClient's ClusterStatsResponse deserialization failing within JBoss 6.1 (new issue in 5.0.0-alpha3)","user":{"login":"fassisrosa","id":17320639,"node_id":"MDQ6VXNlcjE3MzIwNjM5","avatar_url":"https://avatars0.githubusercontent.com/u/17320639?v=4","gravatar_id":"","url":"https://api.github.com/users/fassisrosa","html_url":"https://github.com/fassisrosa","followers_url":"https://api.github.com/users/fassisrosa/followers","following_url":"https://api.github.com/users/fassisrosa/following{/other_user}","gists_url":"https://api.github.com/users/fassisrosa/gists{/gist_id}","starred_url":"https://api.github.com/users/fassisrosa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fassisrosa/subscriptions","organizations_url":"https://api.github.com/users/fassisrosa/orgs","repos_url":"https://api.github.com/users/fassisrosa/repos","events_url":"https://api.github.com/users/fassisrosa/events{/privacy}","received_events_url":"https://api.github.com/users/fassisrosa/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2016-06-21T12:34:45Z","updated_at":"2017-05-09T08:15:25Z","closed_at":"2016-06-21T15:14:48Z","author_association":"NONE","active_lock_reason":null,"body":"Within JBoss 6.1, calling TransportClient::admin().cluster().prepareClusterStats().get() breaks in 5.0.0-alpha3, used to work fine in 5.0.0-alpha2\n\n**Elasticsearch version**: 5.0.0-alpha3\n\n**JVM version**: 1.8.0_92\n\n**OS version**: Windows 2012 R2\n\n**Description of the problem including expected versus actual behavior**:\n\nWe are using TransportClient within JBoss 6.1.\n\nIn 5.0.0-alpha2 we were able to make the following call:\n\n```\nClusterStatsResponse clusterStatsResponse = client.admin().cluster().prepareClusterStats().get();\n```\n\nNow when we do the same call in 5.0.0-alpha3 we are getting the following exception:\n\n```\njava.nio.file.FileSystemNotFoundException: Provider \"vfs\" not installed\n```\n\n**Steps to reproduce**:\n1. Have the call to TransportClient::admin().cluster().prepareClusterStats().get() within JBoss 6.1\n\n**Provide logs (if relevant)**: Full exception from logs (only client side, not errors on elasticsearch side):\n\nTransportSerializationException[Failed to deserialize response of type [org.elasticsearch.action.admin.cluster.stats.ClusterStatsResponse]]; nested: ExceptionInInitializerError; nested: FileSystemNotFoundException[Provider \"vfs\" not installed];\n    at org.elasticsearch.transport.netty.MessageChannelHandler.handleResponse(MessageChannelHandler.java:172)\n    at org.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(MessageChannelHandler.java:143)\n    at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n    at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462)\n    at org.jboss.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443)\n    at org.jboss.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:310)\n    at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n    at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n    at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n    at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n    at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n    at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337)\n    at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n    at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n    at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n    at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.ExceptionInInitializerError\n    at org.elasticsearch.action.admin.cluster.node.info.NodeInfo.readFrom(NodeInfo.java:199)\n    at org.elasticsearch.action.admin.cluster.node.info.NodeInfo.readNodeInfo(NodeInfo.java:191)\n    at org.elasticsearch.action.admin.cluster.stats.ClusterStatsNodeResponse.readFrom(ClusterStatsNodeResponse.java:85)\n    at org.elasticsearch.action.admin.cluster.stats.ClusterStatsNodeResponse.readNodeResponse(ClusterStatsNodeResponse.java:74)\n    at org.elasticsearch.common.io.stream.StreamInput.readList(StreamInput.java:769)\n    at org.elasticsearch.action.admin.cluster.stats.ClusterStatsResponse.readNodesFrom(ClusterStatsResponse.java:102)\n    at org.elasticsearch.action.support.nodes.BaseNodesResponse.readFrom(BaseNodesResponse.java:110)\n    at org.elasticsearch.action.admin.cluster.stats.ClusterStatsResponse.readFrom(ClusterStatsResponse.java:85)\n    at org.elasticsearch.transport.netty.MessageChannelHandler.handleResponse(MessageChannelHandler.java:169)\n    ... 23 more\nCaused by: java.nio.file.FileSystemNotFoundException: Provider \"vfs\" not installed\n    at java.nio.file.Paths.get(Paths.java:147)\n    at org.elasticsearch.common.io.PathUtils.get(PathUtils.java:75)\n    at org.elasticsearch.Build.getElasticsearchCodebase(Build.java:87)\n    at org.elasticsearch.Build.<clinit>(Build.java:50)\n    ... 32 more\n\n**Describe the feature**:\n\nLooks like some changes were made into alpha3 in the way the ClusterStatsResponse object is deserialized, this is impacting our client usage within JBoss 6.1.\n\nDetails of cause of issue:\n\n+) Making the call to getting ClusterStatsResponse, elasticsearch server returns stream that needs to be deserialized into ClusterStatsResponse.\n+) ClusterStatsResponse inherits from BaseNodesResponse.\n+) readFrom method in BaseNodesResponse now has a call to 'readNodesFrom' (line 110 of BaseNodesResponse, alpha3 tag).\n+) 'readNodesFrom' in ClusterStatsResponse calls readNodeResponse (line 102 of ClusterStatsResponse, alpha3 tag).\n+) Eventually call makes it to ClusterStatsNodeResponse::readFrom, taht class NodeInfo.readNodeInfo (line 85 of ClusterStatsNodeResponse, alpha3 tag).\n+) NodeInfo::readNodeInfo ends up calling NodeInfo::readFrom which calls Build.readBuild (line 199 of NodeInfo, alpha 3 tag).\n+) Calling Build.readBuild forces the Build class static block to be executed to populate 'CURRENT'.\n+) The code in getElasticsearchCodebase uses java nio (see lines 85-87 of Build, alpha3 tag). The URL returned within JBoss 6.1 is 'vfs://'.\n*) There is no file system provider for 'vfs://' so exception is thrown.\n\nThis use is only for client, which probably does not care much for Build.CURRENT anyway? \nCould this code be changed to either lazily calculate 'CURRRENT' or to set it to 'Unknown' if an exception is thrown attempting\nto call 'getLeasticsearchCodebase' (probably better as we cannot really calculate the current build with current code)? \nAs it stands, this code cannot be used within JBoss 6.1.\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}