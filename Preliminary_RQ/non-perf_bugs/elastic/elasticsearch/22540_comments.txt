[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271733636","html_url":"https://github.com/elastic/elasticsearch/issues/22540#issuecomment-271733636","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22540","id":271733636,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTczMzYzNg==","user":{"login":"andreybratukhin","id":426632,"node_id":"MDQ6VXNlcjQyNjYzMg==","avatar_url":"https://avatars0.githubusercontent.com/u/426632?v=4","gravatar_id":"","url":"https://api.github.com/users/andreybratukhin","html_url":"https://github.com/andreybratukhin","followers_url":"https://api.github.com/users/andreybratukhin/followers","following_url":"https://api.github.com/users/andreybratukhin/following{/other_user}","gists_url":"https://api.github.com/users/andreybratukhin/gists{/gist_id}","starred_url":"https://api.github.com/users/andreybratukhin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreybratukhin/subscriptions","organizations_url":"https://api.github.com/users/andreybratukhin/orgs","repos_url":"https://api.github.com/users/andreybratukhin/repos","events_url":"https://api.github.com/users/andreybratukhin/events{/privacy}","received_events_url":"https://api.github.com/users/andreybratukhin/received_events","type":"User","site_admin":false},"created_at":"2017-01-10T23:40:27Z","updated_at":"2017-01-10T23:40:27Z","author_association":"NONE","body":"Also it ignores forced analyzer:\r\n```\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n       \"query\": \"*DEF*\", \"analyze_wildcard\": true, \"analyzer\": \"my_custom_lowercase\"\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271834320","html_url":"https://github.com/elastic/elasticsearch/issues/22540#issuecomment-271834320","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22540","id":271834320,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTgzNDMyMA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T10:32:43Z","updated_at":"2017-01-11T10:32:43Z","author_association":"MEMBER","body":"@andreybratukhin https://github.com/elastic/elasticsearch/pull/21919 has been merged to 5.2 only. \r\n5.1.1 does not have this change and as you described has a bug when a custom analyzer is used.\r\nIn this version the normalization of the wildcard term is not working when a custom analyzer is set.\r\nThis is fixed by https://github.com/elastic/elasticsearch/pull/21919 which applies the normalization to custom analyzer. It works with prefix query on 5.1.1 because we analyze the string (as opposed to only normalize) to find the last token on which the prefix should be applied. \r\nBottom line is that ES 5.2 will not be affected by this bug, thanks for the report !","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271935372","html_url":"https://github.com/elastic/elasticsearch/issues/22540#issuecomment-271935372","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22540","id":271935372,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTkzNTM3Mg==","user":{"login":"andreybratukhin","id":426632,"node_id":"MDQ6VXNlcjQyNjYzMg==","avatar_url":"https://avatars0.githubusercontent.com/u/426632?v=4","gravatar_id":"","url":"https://api.github.com/users/andreybratukhin","html_url":"https://github.com/andreybratukhin","followers_url":"https://api.github.com/users/andreybratukhin/followers","following_url":"https://api.github.com/users/andreybratukhin/following{/other_user}","gists_url":"https://api.github.com/users/andreybratukhin/gists{/gist_id}","starred_url":"https://api.github.com/users/andreybratukhin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreybratukhin/subscriptions","organizations_url":"https://api.github.com/users/andreybratukhin/orgs","repos_url":"https://api.github.com/users/andreybratukhin/repos","events_url":"https://api.github.com/users/andreybratukhin/events{/privacy}","received_events_url":"https://api.github.com/users/andreybratukhin/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T17:32:51Z","updated_at":"2017-01-11T17:32:51Z","author_association":"NONE","body":"I haven't seen the version marker for the pull request. Thank you for clarification.\r\n\r\nDo you have any suggestions for a workaround to 5.1.1 issue with custom analyzer and wildcards?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/271943058","html_url":"https://github.com/elastic/elasticsearch/issues/22540#issuecomment-271943058","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22540","id":271943058,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTk0MzA1OA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-01-11T17:58:36Z","updated_at":"2017-01-11T17:58:36Z","author_association":"MEMBER","body":"Unfortunately not :(\r\nThough you should be very careful with wildcards. Leading wildcard like in your example are very costly so my suggestion would be to forbid them ;) See `allow_leading_wildcard` in https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html ? \r\n","performed_via_github_app":null}]