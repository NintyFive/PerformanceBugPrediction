{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22375","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22375/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22375/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22375/events","html_url":"https://github.com/elastic/elasticsearch/issues/22375","id":198058553,"node_id":"MDU6SXNzdWUxOTgwNTg1NTM=","number":22375,"title":"Elastic Search Bulk is ignoring the last operation provided in the json","user":{"login":"bandikishores","id":10301623,"node_id":"MDQ6VXNlcjEwMzAxNjIz","avatar_url":"https://avatars3.githubusercontent.com/u/10301623?v=4","gravatar_id":"","url":"https://api.github.com/users/bandikishores","html_url":"https://github.com/bandikishores","followers_url":"https://api.github.com/users/bandikishores/followers","following_url":"https://api.github.com/users/bandikishores/following{/other_user}","gists_url":"https://api.github.com/users/bandikishores/gists{/gist_id}","starred_url":"https://api.github.com/users/bandikishores/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bandikishores/subscriptions","organizations_url":"https://api.github.com/users/bandikishores/orgs","repos_url":"https://api.github.com/users/bandikishores/repos","events_url":"https://api.github.com/users/bandikishores/events{/privacy}","received_events_url":"https://api.github.com/users/bandikishores/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2016-12-29T19:42:58Z","updated_at":"2016-12-30T05:06:53Z","closed_at":"2016-12-30T05:06:53Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.1.1\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: 1.8.0_91\r\n\r\n**OS version**: Ubuntu 16.04 LTS\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen using the bulk upload feature of elastic search, the last operation mentioned in the JSON is being ignored.\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Post the below request with 5 operations.\r\n2. The response contains just confirmation of 4 Operations.\r\n\r\nThis is my **Request**:\r\n\r\n    curl -XPOST 'localhost:9200/customer/external/_bulk?pretty&pretty' -d'\r\n    \r\n    {\"update\":{\"_id\":\"1\"}}\r\n    {\"doc\": { \"name\": \"Update - John Doe becomes Jane Doe\" } }\r\n    \r\n    {\"delete\":{\"_id\":\"4\"}}\r\n    \r\n    {\"index\":{\"_id\":\"3\"}}\r\n    {\"name\": \"Create or Update - New Jane Doe\" }\r\n    \r\n    {\"create\":{\"_id\":\"4\"}}\r\n    {\"name\": \"Only Create - New Jane Doe\" }\r\n    \r\n    {\"create\":{\"_id\":\"5\"}}\r\n    {\"name\": \"Only Create - New Jane Doe 1\" }'\r\n\r\nThe **Response** Contains just 4 Outputs instead of 5 : \r\n\r\n    {\r\n      \"took\": 100,\r\n      \"errors\": false,\r\n      \"items\": [\r\n        {\r\n          \"update\": {\r\n            \"_index\": \"customer\",\r\n            \"_type\": \"external\",\r\n            \"_id\": \"1\",\r\n            \"_version\": 9,\r\n            \"result\": \"noop\",\r\n            \"_shards\": {\r\n              \"total\": 2,\r\n              \"successful\": 1,\r\n              \"failed\": 0\r\n            },\r\n            \"status\": 200\r\n          }\r\n        },\r\n        {\r\n          \"delete\": {\r\n            \"found\": true,\r\n            \"_index\": \"customer\",\r\n            \"_type\": \"external\",\r\n            \"_id\": \"4\",\r\n            \"_version\": 4,\r\n            \"result\": \"deleted\",\r\n            \"_shards\": {\r\n              \"total\": 2,\r\n              \"successful\": 1,\r\n              \"failed\": 0\r\n            },\r\n            \"status\": 200\r\n          }\r\n        },\r\n        {\r\n          \"index\": {\r\n            \"_index\": \"customer\",\r\n            \"_type\": \"external\",\r\n            \"_id\": \"3\",\r\n            \"_version\": 7,\r\n            \"result\": \"updated\",\r\n            \"_shards\": {\r\n              \"total\": 2,\r\n              \"successful\": 1,\r\n              \"failed\": 0\r\n            },\r\n            \"created\": false,\r\n            \"status\": 200\r\n          }\r\n        },\r\n        {\r\n          \"create\": {\r\n            \"_index\": \"customer\",\r\n            \"_type\": \"external\",\r\n            \"_id\": \"4\",\r\n            \"_version\": 5,\r\n            \"result\": \"created\",\r\n            \"_shards\": {\r\n              \"total\": 2,\r\n              \"successful\": 1,\r\n              \"failed\": 0\r\n            },\r\n            \"created\": true,\r\n            \"status\": 201\r\n          }\r\n        }\r\n      ]\r\n    }\r\n\r\n\r\nIn my scenario, **the customer with id \"5\" (name: \"Only Create - New Jane Doe 1\") was never created**. If I remove this last request (id:5) then even id:4 is not getting created. \r\n\r\nIts always skipping the last request.\r\n\r\nI did a search to get all documents for customer index, but id:5 was not present.\r\n\r\n","closed_by":{"login":"bandikishores","id":10301623,"node_id":"MDQ6VXNlcjEwMzAxNjIz","avatar_url":"https://avatars3.githubusercontent.com/u/10301623?v=4","gravatar_id":"","url":"https://api.github.com/users/bandikishores","html_url":"https://github.com/bandikishores","followers_url":"https://api.github.com/users/bandikishores/followers","following_url":"https://api.github.com/users/bandikishores/following{/other_user}","gists_url":"https://api.github.com/users/bandikishores/gists{/gist_id}","starred_url":"https://api.github.com/users/bandikishores/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bandikishores/subscriptions","organizations_url":"https://api.github.com/users/bandikishores/orgs","repos_url":"https://api.github.com/users/bandikishores/repos","events_url":"https://api.github.com/users/bandikishores/events{/privacy}","received_events_url":"https://api.github.com/users/bandikishores/received_events","type":"User","site_admin":false},"performed_via_github_app":null}