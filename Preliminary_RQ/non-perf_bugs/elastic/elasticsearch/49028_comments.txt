[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/553314286","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-553314286","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":553314286,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MzMxNDI4Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-11-13T09:23:35Z","updated_at":"2019-11-13T09:23:35Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Search)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/555166308","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-555166308","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":555166308,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NTE2NjMwOA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-11-18T19:16:20Z","updated_at":"2019-11-18T19:16:20Z","author_association":"MEMBER","body":"We discussed this issue in our search meeting and we've spotted two enhancements that could help to retrieve values more easily:\r\n* The `field_caps` API should expose the source path of the field if it's not present in the `_source` (alias, multi-fields, ...): https://github.com/elastic/elasticsearch/issues/49264\r\n* The format of values when retrieving the `_source` should be customizable in order to allow a `date` for instance to be returned as a timestamp since epoch rather than a string. This feature would be equivalent to the `format` option of the `docvalues_field` but it would be applied in the original source directly.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/584201981","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-584201981","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":584201981,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NDIwMTk4MQ==","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"created_at":"2020-02-10T16:14:49Z","updated_at":"2020-02-10T16:14:49Z","author_association":"MEMBER","body":"Discussed in the meeting today, adding team-discuss to clarify the remaining scope once @jimczi is back (are we okay with the current plan or do we need to do a higher level api to handle the retrieval).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/584202954","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-584202954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":584202954,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NDIwMjk1NA==","user":{"login":"joshdevins","id":181622,"node_id":"MDQ6VXNlcjE4MTYyMg==","avatar_url":"https://avatars2.githubusercontent.com/u/181622?v=4","gravatar_id":"","url":"https://api.github.com/users/joshdevins","html_url":"https://github.com/joshdevins","followers_url":"https://api.github.com/users/joshdevins/followers","following_url":"https://api.github.com/users/joshdevins/following{/other_user}","gists_url":"https://api.github.com/users/joshdevins/gists{/gist_id}","starred_url":"https://api.github.com/users/joshdevins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshdevins/subscriptions","organizations_url":"https://api.github.com/users/joshdevins/orgs","repos_url":"https://api.github.com/users/joshdevins/repos","events_url":"https://api.github.com/users/joshdevins/events{/privacy}","received_events_url":"https://api.github.com/users/joshdevins/received_events","type":"User","site_admin":false},"created_at":"2020-02-10T16:16:48Z","updated_at":"2020-02-10T16:16:48Z","author_association":"MEMBER","body":"I can imagine this as being necessary as well for feature extraction for our planned LTR work, both at training and inference time to extract document only features (i.e. features that are not query/context dependent).\r\n/cc @davidkyle @jtibshirani ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/589287443","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-589287443","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":589287443,"node_id":"MDEyOklzc3VlQ29tbWVudDU4OTI4NzQ0Mw==","user":{"login":"wylieconlon","id":666475,"node_id":"MDQ6VXNlcjY2NjQ3NQ==","avatar_url":"https://avatars2.githubusercontent.com/u/666475?v=4","gravatar_id":"","url":"https://api.github.com/users/wylieconlon","html_url":"https://github.com/wylieconlon","followers_url":"https://api.github.com/users/wylieconlon/followers","following_url":"https://api.github.com/users/wylieconlon/following{/other_user}","gists_url":"https://api.github.com/users/wylieconlon/gists{/gist_id}","starred_url":"https://api.github.com/users/wylieconlon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wylieconlon/subscriptions","organizations_url":"https://api.github.com/users/wylieconlon/orgs","repos_url":"https://api.github.com/users/wylieconlon/repos","events_url":"https://api.github.com/users/wylieconlon/events{/privacy}","received_events_url":"https://api.github.com/users/wylieconlon/received_events","type":"User","site_admin":false},"created_at":"2020-02-20T20:15:33Z","updated_at":"2020-02-20T20:15:33Z","author_association":"MEMBER","body":"We have run into this problem in Kibana, where we are primarily asking users to interact with dotted field names like `system.cpu.user.pct` or `url.keyword` in building their visualizations.  \r\nBecause the dotted names are what we train users to see, we keep a cache of the dotted names from the `field_caps` API (the index pattern object), and use this when asking users to build queries or visualizations. Why don't the `_search` APIs construct dotted paths for us?\r\n\r\nProposal: Add a new parameter `fields` to the _search API which implements the high-level retrieval described here, combining the behavior of `_source` and `docvalue_fields`. It is important for use in Kibana to support unlimited wildcards. It is important for us to be able to display the entire document using a query like `fields: '*'` or `fields: ['system.cpu.*']`.\r\n\r\nThe kibana sample data contains both `text` and `keyword` mappings, and is a good illustration of the response shape that I would expect:\r\n\r\n```\r\nPOST kibana_sample_data_logs/_search\r\n{\r\n  \"query\": { \"match_all\": {} },\r\n  \"_source\": \"\",\r\n  \"fields\": [{ \"field\": \"*\" }],\r\n  \"size\": 10\r\n}\r\n```\r\n\r\n```\r\n\"fields\": {\r\n  \"bytes\": [ 8679 ],\r\n  \"extension\": \"\",\r\n  \"extension.keyword\" : [ \"\" ],\r\n  \"geo.coordinates\" : [ \"32.69899999257177, -94.94886112399399\" ],\r\n  \"geo.src\" : [ \"CN\" ],\r\n  \"geo.dest\" : [ \"IT\" ],\r\n  \"geo.srcdest\" : [ \"CN:IT\" ]\r\n  \"host\": \"www.elastic.co\",\r\n  \"host.keyword\" : [ \"www.elastic.co\" ],\r\n  \"machine.os\" : \"win xp\",\r\n  \"machine.os.keyword\" : [ \"win xp\" ],\r\n  \"machine.ram\" : 11811160064,\r\n  \"response\": 200,\r\n  \"response.keyword\": [\"200\"],\r\n  \"tags\": [\"success\",\"info\"],\r\n  \"tags.keyword\": [\"info\", \"success\", \"info\", \"success\"],\r\n}\r\n```\r\n\r\nThe example request is easy to write for any user of Elasticsearch, and the response contains information that is from both `doc_values` and `_source`. This is a simple, high-level API that we could work with. Unfortunately, this isn't possible by combining any of the APIs that exist today for a few reasons.\r\n\r\n## Limitations of current APIs\r\n\r\nI have been testing with ECS-based schemas like metricbeat, which on my cluster contains 3904 named paths in the mapping. Not all of these fields are actively used, but because the mapping is so large it causes problems. Here are the limitations I've found\r\n\r\n1. `_source: \"*\"` does not include multi-mapped or alias fields\r\n1. Making a `_source` request with a list of 3904 paths like `_source: [...]` causes the error:\r\n    ```\r\n    {\r\n      \"type\" : \"too_complex_to_determinize_exception\",\r\n      \"reason\" : \"Determinizing automaton with 235539 states and 239442 transitions would result in more than 10000 states.\"\r\n    }\r\n    ```\r\n2. It's not possible to get all docvalues with a wildcard on small indices. The query `docvalue_fields: [{ field: \"*\" }]` throws an error if there are any `text` fields at all:\r\n   > Fielddata is disabled on text fields by default. Set fielddata=true on [request] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.\r\n2. It's not possible to get all docvalues on a large mapping like metricbeat. The request `docvalue_fields: [{ field: \"*\" }]` causes the error\r\n    > Trying to retrieve too many docvalue_fields. Must be less than or equal to: [100] but was [2588]. This limit can be set by changing the [index.max_docvalue_fields_search] index level setting.\r\n3. Listing too many paths in the request for `docvalue_fields` also causes the same error:\r\n    > Trying to retrieve too many docvalue_fields. Must be less than or equal to: [100] but was [3900]. This limit can be set by changing the [index.max_docvalue_fields_search] index level setting.\r\n\r\nAll of these limitations make it hard to avoid using `_source`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/593241377","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-593241377","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":593241377,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MzI0MTM3Nw==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2020-03-02T06:26:09Z","updated_at":"2020-03-02T06:26:09Z","author_association":"MEMBER","body":"I caught up with @jimczi offline to clarify our earlier discussion. Instead of immediately pushing ahead with the `source_path` (#49264) and formatters changes, we'd like to step back and consider the problem in a more end-to-end way. Like this, we can consider a coordinated API change that addresses the use case in a more direct + user-friendly way.\r\n\r\nWe can continue the discussion about field retrieval on this issue, building on @wylieconlon's helpful analysis. I'll remove 'team discuss' for now, but we can add it back if there's a particular item we'd like to discuss in person.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/595669852","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-595669852","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":595669852,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTY2OTg1Mg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-03-06T09:00:17Z","updated_at":"2020-03-06T09:00:17Z","author_association":"CONTRIBUTOR","body":"+1 to move forward with something along the lines of @wylieconlon 's above proposal.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/597363968","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-597363968","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":597363968,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NzM2Mzk2OA==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2020-03-10T23:10:28Z","updated_at":"2020-03-10T23:10:28Z","author_association":"MEMBER","body":"Great, I've assigned this to myself and am working on a design doc. Once the design is more settled I'll post it here or open a new meta-issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/615365090","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-615365090","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":615365090,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTM2NTA5MA==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2020-04-17T17:16:08Z","updated_at":"2020-04-17T17:16:27Z","author_association":"MEMBER","body":"I opened a meta-issue to track implementation details: https://github.com/elastic/elasticsearch/issues/55363.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/665279289","html_url":"https://github.com/elastic/elasticsearch/issues/49028#issuecomment-665279289","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49028","id":665279289,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NTI3OTI4OQ==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2020-07-28T20:58:42Z","updated_at":"2020-07-28T20:58:42Z","author_association":"MEMBER","body":"Closing, since the feature branch was merged in #60100. ","performed_via_github_app":null}]