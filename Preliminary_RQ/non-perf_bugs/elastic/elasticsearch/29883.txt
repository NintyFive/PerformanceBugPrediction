{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29883","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29883/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29883/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29883/events","html_url":"https://github.com/elastic/elasticsearch/issues/29883","id":317448952,"node_id":"MDU6SXNzdWUzMTc0NDg5NTI=","number":29883,"title":"[CI] Problems in Sql-Cli tests during packagingTest  ","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"labels":[{"id":912794284,"node_id":"MDU6TGFiZWw5MTI3OTQyODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/SQL","name":":Query Languages/SQL","color":"0e8a16","default":false,"description":"SQL querying"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-03-20T11:17:48Z","updated_at":"2019-02-07T08:34:15Z","closed_at":"2018-07-02T22:01:06Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"*Original comment by @cbuescher:*\n\nLink to build failure:\r\nLINK REDACTED\r\n\r\nNot reproducable so far with:\r\n```\r\n./gradlew :x-pack-elasticsearch:qa:vagrant:vagrantOpensuse42#packagingTest -Dtests.seed=BE37A3A77B44D5E1 \r\n```\r\n\r\nProblems seem to be starting with problems setting up the kibana user in SQL-Cli tests:\r\n```\r\n10:47:02 Starting process 'command 'vagrant''. Working directory: /var/lib/jenkins/workspace/elastic+x-pack-elasticsearch+master+packaging-tests/elasticsearch-extra/x-pack-elasticsearch/qa/vagrant Command: vagrant ssh opensuse-42 --command cd $BATS_ARCHIVES && sudo bats --tap $BATS_TESTS/*.bats\r\n10:47:02 Successfully started process 'command 'vagrant''\r\n10:47:02 1..41\r\n10:47:02 ok 1 [X-PACK] install x-pack\r\n10:47:02 ok 2 [X-PACK] verify x-pack installation\r\n10:47:02 ok 3 [X-PACK] verify croneval works\r\n10:47:02 ok 4 [TAR BOOTSTRAP PASSWORD] add bootstrap.password setting\r\n10:47:02 ok 5 [TAR BOOTSTRAP PASSWORD] test bootstrap.password is in setting list\r\n10:47:02 ok 6 [TAR BOOTSTRAP PASSWORD] test auto generated passwords with modified bootstrap.password\r\n10:47:02 ok 7 [TAR BOOTSTRAP PASSWORD] test sql-cli\r\n10:47:02 ok 8 [TAR BOOTSTRAP PASSWORD] test sql-cli when user refuses password\r\n10:47:03 ok 9 [TAR BOOTSTRAP PASSWORD] stop Elasticsearch\r\n10:47:03 ok 10 [RPM BOOTSTRAP PASSWORD] add bootstrap.password setting\r\n10:47:03 ok 11 [RPM BOOTSTRAP PASSWORD] test bootstrap.password is in setting list\r\n10:47:15 not ok 12 [RPM BOOTSTRAP PASSWORD] test auto generated passwords with modified bootstrap.password\r\n10:47:15 not ok 12 [RPM BOOTSTRAP PASSWORD] test auto generated passwords with modified bootstrap.password\r\n10:47:15 # (in test file /project/build/bats/tests/25_package_bootstrap_password.bats, line 122)\r\n10:47:15 # (in test file /project/build/bats/tests/25_package_bootstrap_password.bats, line 122)\r\n10:47:15 #   `false' failed\r\n10:47:15 #   `false' failed\r\n10:47:15 # Expected x-pack setup-passwords tool exit code to be zero but got [75]\r\n10:47:15 # Initiating the setup of passwords for reserved users elastic,kibana,logstash_system,beats_system.\r\n10:47:15 # The passwords will be randomly generated and printed to the console.\r\n10:47:15 # Please confirm that you would like to continue [y/N]\r\n10:47:15 # \r\n10:47:15 # \r\n10:47:15 # Connection failure to: http://127.0.0.1:9200/_xpack/security/user/kibana/_password?pretty failed: Read timed out\r\n10:47:15 # \r\n10:47:15 # ERROR: Failed to set password for user [kibana].\r\n```\r\n\r\nThere seem to be problems connecting to port 9201 from the tests also:\r\n```\r\n10:47:15 # Testing if ES ports are open:\r\n10:47:15 # port 9200 on host 127.0.0.1 is open\r\n10:47:15 # /project/build/bats/utils/utils.bash: connect: Connection refused\r\n10:47:15 # /project/build/bats/utils/utils.bash: line 424: /dev/tcp/127.0.0.1/9201: Connection refused\r\n10:47:15 # port 9201 on host 127.0.0.1 is not open\r\n10:47:15 APSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n10:47:15 # \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:573) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n10:47:15 # \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_144]\r\n10:47:15 # \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_144]\r\n10:47:15 # \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_144]\r\n10:47:15 # The logfile at /var/log/messages doesn't exist\r\n10:47:15 # Current java processes:\r\n10:47:15 # elastic+ 28155 93.4 16.2 4661312 1324840 ?     Ssl  10:45   1:12 /usr/bin/java -Xms1g -Xmx1g -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.io.tmpdir=/tmp/elasticsearch.I14xJ5WN -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/lib/elasticsearch -XX:ErrorFile=/var/log/elasticsearch/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/log/elasticsearch/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Des.path.home=/usr/share/elasticsearch -Des.path.conf=/etc/elasticsearch -cp /usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch -p /var/run/elasticsearch/elasticsearch.pid --quiet\r\n10:47:15 # Testing if ES ports are open:\r\n10:47:15 # port 9200 on host 127.0.0.1 is open\r\n10:47:15 # /project/build/bats/utils/utils.bash: connect: Connection refused\r\n10:47:15 # /project/build/bats/utils/utils.bash: line 424: /dev/tcp/127.0.0.1/9201: Connection refused\r\n10:47:15 # port 9201 on host 127.0.0.1 is not open\r\n10:47:42 not ok 13 [RPM BOOTSTRAP PASSWORD] test sql-cli\r\n10:47:42 not ok 13 [RPM BOOTSTRAP PASSWORD] test sql-cli\r\n10:47:42 # (in test file /project/build/bats/tests/25_package_bootstrap_password.bats, line 164)\r\n10:47:42 # (in test file /project/build/bats/tests/25_package_bootstrap_password.bats, line 164)\r\n10:47:42 #   `false' failed\r\n10:47:42 #   `false' failed\r\n10:47:42 # {\r\n10:47:42 #   \"error\" : {\r\n10:47:42 #     \"root_cause\" : [\r\n10:47:42 #       {\r\n10:47:42 #         \"type\" : \"security_exception\",\r\n10:47:42 #         \"reason\" : \"failed to authenticate user [elastic]\",\r\n10:47:42 #         \"header\" : {\r\n10:47:42 #           \"WWW-Authenticate\" : \"Basic realm=\\\"security\\\" charset=\\\"UTF-8\\\"\"\r\n10:47:42 #         }\r\n10:47:42 #       }\r\n10:47:42 #     ],\r\n10:47:42 #     \"type\" : \"security_exception\",\r\n10:47:42 #     \"reason\" : \"failed to authenticate user [elastic]\",\r\n10:47:42 #     \"header\" : {\r\n10:47:42 #       \"WWW-Authenticate\" : \"Basic realm=\\\"security\\\" charset=\\\"UTF-8\\\"\"\r\n10:47:42 #     }\r\n10:47:42 #   },\r\n10:47:42 #   \"status\" : 401\r\n10:47:42 # }\r\n10:47:42 # SQL cli failed:\\nMar 20, 2018 10:47:40 AM org.jline.utils.Log logr\r\n10:47:42 # WARNING: Unable to create a system terminal, creating a dumb terminal (enable debug logging for more information)\r\n10:47:42 # password: Client Exception [java.sql.SQLInvalidAuthorizationSpecException: failed to authenticate user [elastic]]\r\n10:47:42 # org.elasticsearch.xpack.sql.client.shared.ClientException: java.sql.SQLInvalidAuthorizationSpecException: failed to authenticate user [elastic]\r\n10:47:42 # \tat org.elasticsearch.xpack.sql.cli.command.CliSession.checkConnection(CliSession.java:77)\r\n10:47:42 # \tat org.elasticsearch.xpack.sql.cli.Cli.checkConnection(Cli.java:142)\r\n10:47:42 # \tat org.elasticsearch.xpack.sql.cli.Cli.execute(Cli.java:132)\r\n10:47:42 # \tat org.elasticsearch.xpack.sql.cli.Cli.execute(Cli.java:114)\r\n10:47:42 # \tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n10:47:42 # \tat org.elasticsearch.cli.Command.main(Command.java:90)\r\n10:47:42 # \tat org.elasticsearch.xpack.sql.cli.Cli.main(Cli.java:62)\r\n10:47:42 # Caused by: java.sql.SQLInvalidAuthorizationSpecException: failed to authenticate user [elastic]\r\n10:47:42 # \tat org.elasticsearch.xpack.sql.client.shared.JreHttpUrlConnection$SqlExceptionType.asException(JreHttpUrlConnection.java:318)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.shared.JreHttpUrlConnection.parserError(JreHttpUrlConnection.java:195)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.shared.JreHttpUrlConnection.request(JreHttpUrlConnection.java:170)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$3(HttpClient.java:138)\r\n10:47:43 # {\r\n10:47:43 #   \"error\" : {\r\n10:47:43 #     \"root_cause\" : [\r\n10:47:43 #       {\r\n10:47:43 #         \"type\" : \"security_exception\",\r\n10:47:43 #         \"reason\" : \"failed to authenticate user [elastic]\",\r\n10:47:43 #         \"header\" : {\r\n10:47:43 #           \"WWW-Authenticate\" : \"Basic realm=\\\"security\\\" charset=\\\"UTF-8\\\"\"\r\n10:47:43 #         }\r\n10:47:43 #       }\r\n10:47:43 #     ],\r\n10:47:43 #     \"type\" : \"security_exception\",\r\n10:47:43 #     \"reason\" : \"failed to authenticate user [elastic]\",\r\n10:47:43 #     \"header\" : {\r\n10:47:43 #       \"WWW-Authenticate\" : \"Basic realm=\\\"security\\\" charset=\\\"UTF-8\\\"\"\r\n10:47:43 #     }\r\n10:47:43 #   },\r\n10:47:43 #   \"status\" : 401\r\n10:47:43 # }\r\n10:47:43 # SQL cli failed:\\nMar 20, 2018 10:47:40 AM org.jline.utils.Log logr\r\n10:47:43 # WARNING: Unable to create a system terminal, creating a dumb terminal (enable debug logging for more information)\r\n10:47:43 # password: Client Exception [java.sql.SQLInvalidAuthorizationSpecException: failed to authenticate user [elastic]]\r\n10:47:43 # org.elasticsearch.xpack.sql.client.shared.ClientException: java.sql.SQLInvalidAuthorizationSpecException: failed to authenticate user [elastic]\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.cli.command.CliSession.checkConnection(CliSession.java:77)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.cli.Cli.checkConnection(Cli.java:142)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.cli.Cli.execute(Cli.java:132)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.cli.Cli.execute(Cli.java:114)\r\n10:47:43 # \tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124)\r\n10:47:43 # \tat org.elasticsearch.cli.Command.main(Command.java:90)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.cli.Cli.main(Cli.java:62)\r\n10:47:43 # Caused by: java.sql.SQLInvalidAuthorizationSpecException: failed to authenticate user [elastic]\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.shared.JreHttpUrlConnection$SqlExceptionType.asException(JreHttpUrlConnection.java:318)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.shared.JreHttpUrlConnection.parserError(JreHttpUrlConnection.java:195)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.shared.JreHttpUrlConnection.request(JreHttpUrlConnection.java:170)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$3(HttpClient.java:138)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.shared.JreHttpUrlConnec# \tat org.elasticsearch.xpack.sql.client.shared.JreHttpUrlConnec\r\n10:47:43 tion.http(JreHttpUrlConnection.java:74)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$4(HttpClient.java:137)\r\n10:47:43 # \tat java.security.AccessController.doPrivileged(Native Method)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.HttpClient.get(HttpClient.java:136)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.HttpClient.serverInfo(HttpClient.java:76)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.cli.command.CliSession.checkConnection(CliSession.java:75)\r\n10:47:43 # \t... 6 more\r\n10:47:43 # ERROR: Cannot communicate with the server LINK REDACTED This version of CLI only works with Elasticsearch version v7.0.0-alpha1 [7c0e26d]\r\n10:47:43 tion.http(JreHttpUrlConnection.java:74)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$4(HttpClient.java:137)\r\n10:47:43 # \tat java.security.AccessController.doPrivileged(Native Method)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.HttpClient.get(HttpClient.java:136)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.client.HttpClient.serverInfo(HttpClient.java:76)\r\n10:47:43 # \tat org.elasticsearch.xpack.sql.cli.command.CliSession.checkConnection(CliSession.java:75)\r\n10:47:43 # \t... 6 more\r\n10:47:43 # ERROR: Cannot communicate with the server LINK REDACTED This version of CLI only works with Elasticsearch version v7.0.0-alpha1 [7c0e26d]\r\n```","closed_by":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"performed_via_github_app":null}