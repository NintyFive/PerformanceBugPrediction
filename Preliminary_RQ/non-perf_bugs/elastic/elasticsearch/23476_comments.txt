[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/291428065","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-291428065","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":291428065,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MTQyODA2NQ==","user":{"login":"nilabhsagar","id":20436609,"node_id":"MDQ6VXNlcjIwNDM2NjA5","avatar_url":"https://avatars0.githubusercontent.com/u/20436609?v=4","gravatar_id":"","url":"https://api.github.com/users/nilabhsagar","html_url":"https://github.com/nilabhsagar","followers_url":"https://api.github.com/users/nilabhsagar/followers","following_url":"https://api.github.com/users/nilabhsagar/following{/other_user}","gists_url":"https://api.github.com/users/nilabhsagar/gists{/gist_id}","starred_url":"https://api.github.com/users/nilabhsagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilabhsagar/subscriptions","organizations_url":"https://api.github.com/users/nilabhsagar/orgs","repos_url":"https://api.github.com/users/nilabhsagar/repos","events_url":"https://api.github.com/users/nilabhsagar/events{/privacy}","received_events_url":"https://api.github.com/users/nilabhsagar/received_events","type":"User","site_admin":false},"created_at":"2017-04-04T08:19:34Z","updated_at":"2017-04-04T08:19:34Z","author_association":"CONTRIBUTOR","body":"Hi, Any update on this feature?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/291428840","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-291428840","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":291428840,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MTQyODg0MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-04-04T08:23:03Z","updated_at":"2017-04-04T08:23:03Z","author_association":"MEMBER","body":"@areek @clintongormley can you voice an opinion?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292863534","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-292863534","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":292863534,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Mjg2MzUzNA==","user":{"login":"nilabhsagar","id":20436609,"node_id":"MDQ6VXNlcjIwNDM2NjA5","avatar_url":"https://avatars0.githubusercontent.com/u/20436609?v=4","gravatar_id":"","url":"https://api.github.com/users/nilabhsagar","html_url":"https://github.com/nilabhsagar","followers_url":"https://api.github.com/users/nilabhsagar/followers","following_url":"https://api.github.com/users/nilabhsagar/following{/other_user}","gists_url":"https://api.github.com/users/nilabhsagar/gists{/gist_id}","starred_url":"https://api.github.com/users/nilabhsagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilabhsagar/subscriptions","organizations_url":"https://api.github.com/users/nilabhsagar/orgs","repos_url":"https://api.github.com/users/nilabhsagar/repos","events_url":"https://api.github.com/users/nilabhsagar/events{/privacy}","received_events_url":"https://api.github.com/users/nilabhsagar/received_events","type":"User","site_admin":false},"created_at":"2017-04-10T06:47:05Z","updated_at":"2017-04-10T06:47:05Z","author_association":"CONTRIBUTOR","body":"@areek @clintongormley Looking forward to know your opinion.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294725366","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-294725366","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":294725366,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDcyNTM2Ng==","user":{"login":"nilabhsagar","id":20436609,"node_id":"MDQ6VXNlcjIwNDM2NjA5","avatar_url":"https://avatars0.githubusercontent.com/u/20436609?v=4","gravatar_id":"","url":"https://api.github.com/users/nilabhsagar","html_url":"https://github.com/nilabhsagar","followers_url":"https://api.github.com/users/nilabhsagar/followers","following_url":"https://api.github.com/users/nilabhsagar/following{/other_user}","gists_url":"https://api.github.com/users/nilabhsagar/gists{/gist_id}","starred_url":"https://api.github.com/users/nilabhsagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilabhsagar/subscriptions","organizations_url":"https://api.github.com/users/nilabhsagar/orgs","repos_url":"https://api.github.com/users/nilabhsagar/repos","events_url":"https://api.github.com/users/nilabhsagar/events{/privacy}","received_events_url":"https://api.github.com/users/nilabhsagar/received_events","type":"User","site_admin":false},"created_at":"2017-04-18T08:19:04Z","updated_at":"2017-04-18T08:19:04Z","author_association":"CONTRIBUTOR","body":"Hi, Any update on this feature?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/295678936","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-295678936","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":295678936,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NTY3ODkzNg==","user":{"login":"devikiranr","id":17249381,"node_id":"MDQ6VXNlcjE3MjQ5Mzgx","avatar_url":"https://avatars2.githubusercontent.com/u/17249381?v=4","gravatar_id":"","url":"https://api.github.com/users/devikiranr","html_url":"https://github.com/devikiranr","followers_url":"https://api.github.com/users/devikiranr/followers","following_url":"https://api.github.com/users/devikiranr/following{/other_user}","gists_url":"https://api.github.com/users/devikiranr/gists{/gist_id}","starred_url":"https://api.github.com/users/devikiranr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/devikiranr/subscriptions","organizations_url":"https://api.github.com/users/devikiranr/orgs","repos_url":"https://api.github.com/users/devikiranr/repos","events_url":"https://api.github.com/users/devikiranr/events{/privacy}","received_events_url":"https://api.github.com/users/devikiranr/received_events","type":"User","site_admin":false},"created_at":"2017-04-20T10:47:30Z","updated_at":"2017-04-20T10:47:30Z","author_association":"NONE","body":"Filtered Auto Suggestions on nested model had spawned out of a genuine requirement from a Product in our organization. We are currently using our fork of the Elasticsearch main repo for this and are having to merge with the release branch on every release of Elasticsearch. Hoping to have a good discussion on this and move ahead in the right direction. We have the code, analysis , benchmark numbers ready and are eager to implement the changes/ suggestions from you to take it to the next level.\r\nWe strongly believe that this will add value to many Elasticsearch users who are work on nested model and require filtered autosuggestions.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/295714860","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-295714860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":295714860,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NTcxNDg2MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-04-20T12:21:04Z","updated_at":"2017-04-20T12:21:04Z","author_association":"CONTRIBUTOR","body":"Why can't you just use `copy_to` to copy the nested values up to the top level?  As in:\r\n\r\n```\r\n{\r\n  \"mappings\": {\r\n    \"Provider\": {\r\n      \"properties\": {\r\n        \"name\": {\r\n          \"type\": \"text\"\r\n        },\r\n        \"Products\": {\r\n          \"type\": \"nested\",\r\n          \"properties\": {\r\n            \"ProdName\": {\r\n              \"type\": \"text\",\r\n              \"copy_to\": \"product_name\"\r\n            },\r\n            \"ProdType\": {\r\n              \"type\": \"text\",\r\n              \"copy_to\": \"product_type\"\r\n            }\r\n```\r\n\r\nThen you can just use `product_name` and `product_type` as your context fields.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/295794720","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-295794720","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":295794720,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NTc5NDcyMA==","user":{"login":"nilabhsagar","id":20436609,"node_id":"MDQ6VXNlcjIwNDM2NjA5","avatar_url":"https://avatars0.githubusercontent.com/u/20436609?v=4","gravatar_id":"","url":"https://api.github.com/users/nilabhsagar","html_url":"https://github.com/nilabhsagar","followers_url":"https://api.github.com/users/nilabhsagar/followers","following_url":"https://api.github.com/users/nilabhsagar/following{/other_user}","gists_url":"https://api.github.com/users/nilabhsagar/gists{/gist_id}","starred_url":"https://api.github.com/users/nilabhsagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilabhsagar/subscriptions","organizations_url":"https://api.github.com/users/nilabhsagar/orgs","repos_url":"https://api.github.com/users/nilabhsagar/repos","events_url":"https://api.github.com/users/nilabhsagar/events{/privacy}","received_events_url":"https://api.github.com/users/nilabhsagar/received_events","type":"User","site_admin":false},"created_at":"2017-04-20T16:08:30Z","updated_at":"2017-04-20T16:08:30Z","author_association":"CONTRIBUTOR","body":"By using copy_to we loose the relationship between nested entities field. \r\nConsider below Mapping and a sample document\r\n\r\n**Mapping**\r\n\r\n```\r\n{\r\n  \"mappings\": {\r\n    \"Provider\": {\r\n      \"properties\": {\r\n        \"name\": {\r\n          \"type\": \"text\"\r\n        },\r\n        \"ProdName\": {\r\n          \"type\": \"text\"\r\n        },\r\n        \"ProdType\": {\r\n          \"type\": \"text\"\r\n        },\r\n        \"Products\": {\r\n          \"type\": \"nested\",\r\n          \"properties\": {\r\n            \"ProdName\": {\r\n              \"type\": \"text\",\r\n              \"copy_to\": \"ProdName\"\r\n            },\r\n            \"ProdType\": {\r\n              \"type\": \"text\",\r\n              \"copy_to\": \"ProdType\"\r\n            }\r\n          }\r\n        },\r\n        \"suggest\": {\r\n          \"type\": \"completion\",\r\n          \"contexts\": [\r\n            {\r\n              \"name\": \"ProdName\",\r\n              \"type\": \"category\",\r\n              \"path\": \"ProdName\"\r\n            },\r\n            {\r\n              \"name\": \"ProdType\",\r\n              \"type\": \"category\",\r\n              \"path\": \"ProdType\"\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Docuement-1**\r\n\r\n```\r\n{\r\n  \"name\": \"Simon\",\r\n  \"suggest\": {\r\n    \"input\": [\"Simon\"]\r\n  },\r\n  \"Products\": [\r\n    {\r\n      \"ProdName\": \"UHC Choice Plus\",\r\n      \"ProdType\": \"TypeA\"\r\n    },\r\n    {\r\n      \"ProdName\": \"UHC Choice Plus EPO\",\r\n      \"ProdType\": \"TypeB\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n**Docuement-2**\r\n\r\n```\r\n{\r\n  \"name\": \"Simran\",\r\n  \"suggest\": {\r\n    \"input\": [\"Simran\"]\r\n  },\r\n  \"Products\": [\r\n    {\r\n      \"ProdName\": \"UHC Choice Plus\",\r\n      \"ProdType\": \"TypeB\"\r\n    },\r\n    {\r\n      \"ProdName\": \"UHC Choice Plus EPO\",\r\n      \"ProdType\": \"TypeA\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nOnce the document is indexed, the suggestion context values will be as below\r\n**Docuement-1**\r\n\r\n\"ProdType\": [\"TypeA\",\"TypeB\"]\r\n\"ProdName\": [\"UHC Choice Plus\",\"UHC Choice Plus EPO\"]\r\n\r\n**Docuement-2**\r\n\r\n\"ProdType\": [\"TypeB\",\"TypeA\"]\r\n\"ProdName\": [\"UHC Choice Plus\",\"UHC Choice Plus EPO\"]\r\n\r\nHere we can see that the relationship between the ProdName and ProdType is lost; Now if some one is looking for suggestions having prefix as \"sim\" and with the contexts as [\"ProdName\": UHC Choice Plus\", \"ProdType\": \"TypeA\"], both \"Simon\" and \"Simran\" will surface as suggestions. However, going by the document structure only \"Simon\" should have surfaced.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296201015","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-296201015","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":296201015,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjIwMTAxNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-04-21T14:10:20Z","updated_at":"2017-04-21T14:10:20Z","author_association":"CONTRIBUTOR","body":"Hi @nilabhsagar \r\n\r\nWe discussed this in our FixItFriday session today.  This is a problem that could be worked around by combining the various nested fields into a single top-level context (eg combining `ProdType` and `ProdName` into a single context).\r\n\r\nWhile this may not be as convenient as your suggestion, we are not keen to expand the completion suggester in this direction.  It is already a complex memory hungry beast, and implementing your feature request would make it more so, not least because the addition of so many contexts will cause an automaton complexity explosion.\r\n\r\nIf this code works for you, then fine, I suggest that you convert it into a plugin that will make it easier for you to use than having to fork ES on every release. But we don't want to take the suggester in this direction.  \r\n\r\nActually, we'd like to rethink how our suggesters are implemented and come up with an easier, simpler approach than we have currently but that is going to be a major project.\r\n\r\nthanks anyway","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297073529","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-297073529","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":297073529,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzA3MzUyOQ==","user":{"login":"nilabhsagar","id":20436609,"node_id":"MDQ6VXNlcjIwNDM2NjA5","avatar_url":"https://avatars0.githubusercontent.com/u/20436609?v=4","gravatar_id":"","url":"https://api.github.com/users/nilabhsagar","html_url":"https://github.com/nilabhsagar","followers_url":"https://api.github.com/users/nilabhsagar/followers","following_url":"https://api.github.com/users/nilabhsagar/following{/other_user}","gists_url":"https://api.github.com/users/nilabhsagar/gists{/gist_id}","starred_url":"https://api.github.com/users/nilabhsagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilabhsagar/subscriptions","organizations_url":"https://api.github.com/users/nilabhsagar/orgs","repos_url":"https://api.github.com/users/nilabhsagar/repos","events_url":"https://api.github.com/users/nilabhsagar/events{/privacy}","received_events_url":"https://api.github.com/users/nilabhsagar/received_events","type":"User","site_admin":false},"created_at":"2017-04-25T15:45:14Z","updated_at":"2017-04-25T15:45:14Z","author_association":"CONTRIBUTOR","body":"Hi @clintongormley,\r\n\r\nThe suggestion for combining the fields into a single top-level context inherently has a complexity which we have addressed with this feature request. By using the solution provided by us, a user of ES nested model will be:\r\n\r\n- Able to use this functionality by just using simple mapping and query.\r\n- No coding effort will be required to create and copy context fields.\r\n- Able to cope up with the data model changes.\r\n- Will be free from analyzing the data model required for auto suggestion feature.\r\n- Will get Nested model as a complete package for their problem at hand.\r\n\r\nRegarding your memory usage concern, we do have some benchmark numbers to share which is performed on a real data set with 5 level of nesting. Since, we are dealing with nested model it is quite obvious that there will be lot of duplication and FST will provide a really good compression to minimize the memory footprint. I am attaching below the benchmark results for your reference.\r\n\r\n**Benchmark system configuration**\r\n![image](https://cloud.githubusercontent.com/assets/20436609/25393583/8009a9fc-29f9-11e7-9b73-f4a9bfbeb866.png)\r\n\r\n**Using XAnalysingSuggester**\r\n![image](https://cloud.githubusercontent.com/assets/20436609/25393729/ddaf7122-29f9-11e7-822c-afee5eb505c7.png)\r\n\r\n**Using NRTSuggester** \r\n![image](https://cloud.githubusercontent.com/assets/20436609/25393646/a037a79c-29f9-11e7-9bac-918c6a4838d7.png)\r\n\r\nThere are few points about the NRTSuggester based implementation, where we can see that the memory usage is too high. This is due to the fact that every context term is getting appended with doc id and hence FST is poorly compressed. This can certainly be addressed.\r\n\r\nWe see this will be a nice feature addition to Nested model or rather a foundation step for filtered auto suggestion on nested model. Looking forward to know your opinion.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298168598","html_url":"https://github.com/elastic/elasticsearch/issues/23476#issuecomment-298168598","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23476","id":298168598,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODE2ODU5OA==","user":{"login":"devikiranr","id":17249381,"node_id":"MDQ6VXNlcjE3MjQ5Mzgx","avatar_url":"https://avatars2.githubusercontent.com/u/17249381?v=4","gravatar_id":"","url":"https://api.github.com/users/devikiranr","html_url":"https://github.com/devikiranr","followers_url":"https://api.github.com/users/devikiranr/followers","following_url":"https://api.github.com/users/devikiranr/following{/other_user}","gists_url":"https://api.github.com/users/devikiranr/gists{/gist_id}","starred_url":"https://api.github.com/users/devikiranr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/devikiranr/subscriptions","organizations_url":"https://api.github.com/users/devikiranr/orgs","repos_url":"https://api.github.com/users/devikiranr/repos","events_url":"https://api.github.com/users/devikiranr/events{/privacy}","received_events_url":"https://api.github.com/users/devikiranr/received_events","type":"User","site_admin":false},"created_at":"2017-04-29T13:19:25Z","updated_at":"2017-04-29T13:19:25Z","author_association":"NONE","body":"@clintongormley \r\nAt present there is no work around for this in elasticsearch. Combining the filter fields into a top level context field would let go of the relationship between them. \r\nTo explain from the document structure above;\r\n```\r\nfor \" Simon\" , \r\n\t\"UHC Choice Plus\" was a \"TypeA\" product  \r\n        \"UHC Choice Plus EPO\" was a \"Type B\" product```\r\n```\r\n```\r\nfor \"Simran\"\r\n\t\"UHC Choice Plus\" was a \"TypeB\" product  \r\n        \"UHC Choice Plus EPO\" was a \"Type A\" product\r\n```\r\nfor the above scenario, the \"top-level context\" field values getting indexed against both the documents would be;\r\n`\"ProdType_ProdName\": [\"TypeA\",\"TypeB\",\"UHC Choice Plus\",\"UHC Choice Plus EPO\"]`\r\n\r\nto reiterate;\r\n _The requirement at our end was to have autosuggestion on the top level \"name\" field which is filtered by the \"ProdType\" and \"ProdName\" fields._ \r\n\r\nNow consider the below query:\r\n```prefix: \"sim\"\r\nfilter :{\r\n\t\"ProdType\":\"Type A\",\r\n\t\"ProdName\": \"UHC Choice Plus\"\r\n} \r\n\r\n```\r\nThe expectation was to get those names as suggestions which had _\"UHC Choice Plus\" as a \"Type A\"_ product. (more of an **AND** ) i.e. _only \"Simon\" should have surfaced_.\r\n\r\nWhile the top level context, would not be able to handle this as it would not know if for a given \"name\" the document had a nested product with the specified \"ProdName\" and \"ProdType\". Hence _both \"Simran\" & \"Simon\" would surface_.","performed_via_github_app":null}]