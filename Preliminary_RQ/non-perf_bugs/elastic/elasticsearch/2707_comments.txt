[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/14221366","html_url":"https://github.com/elastic/elasticsearch/issues/2707#issuecomment-14221366","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2707","id":14221366,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjIxMzY2","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-02-28T07:54:40Z","updated_at":"2013-02-28T07:54:40Z","author_association":"CONTRIBUTOR","body":"hey, can you provide a gist with json / curl statements that reproduce your problem?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/14320305","html_url":"https://github.com/elastic/elasticsearch/issues/2707#issuecomment-14320305","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2707","id":14320305,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzIwMzA1","user":{"login":"lukapor","id":3388840,"node_id":"MDQ6VXNlcjMzODg4NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/3388840?v=4","gravatar_id":"","url":"https://api.github.com/users/lukapor","html_url":"https://github.com/lukapor","followers_url":"https://api.github.com/users/lukapor/followers","following_url":"https://api.github.com/users/lukapor/following{/other_user}","gists_url":"https://api.github.com/users/lukapor/gists{/gist_id}","starred_url":"https://api.github.com/users/lukapor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukapor/subscriptions","organizations_url":"https://api.github.com/users/lukapor/orgs","repos_url":"https://api.github.com/users/lukapor/repos","events_url":"https://api.github.com/users/lukapor/events{/privacy}","received_events_url":"https://api.github.com/users/lukapor/received_events","type":"User","site_admin":false},"created_at":"2013-03-02T01:23:18Z","updated_at":"2013-03-02T01:23:18Z","author_association":"NONE","body":"I provide small test  https://github.com/lukapor/customsimilarity\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/14324036","html_url":"https://github.com/elastic/elasticsearch/issues/2707#issuecomment-14324036","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2707","id":14324036,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzI0MDM2","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-03-02T06:35:24Z","updated_at":"2013-03-02T06:35:24Z","author_association":"CONTRIBUTOR","body":"thanks @lukapor I will look into this and try to figure out what the problem is\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/14325749","html_url":"https://github.com/elastic/elasticsearch/issues/2707#issuecomment-14325749","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2707","id":14325749,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzI1NzQ5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-03-02T09:49:41Z","updated_at":"2013-03-02T09:49:41Z","author_association":"CONTRIBUTOR","body":"hey,\n\nI didn't try it but from looking at it I think you are missing to add the similarityprovider in you plugin.\n\nregister it in BcsocialSimilarityPlugin.java \n\n``` java\npublic void onModule(SimilarityModule module) {\n  module.addSimilarity(\"bcsocial\", BcsocialSimilarityProvider.class);\n}\n```\n\nthen when you create the index just do: \n\n``` json\n{\n   \"settings\":{\n      \"index\":{\n         \"number_of_shards\":1,\n         \"number_of_replicas\":1\n      },\n      \"similarity\":{\n         \"index\":{\n            \"type\":\"bcsocial\"\n         },\n         \"search\":{\n            \"type\":\"bcsocial\"\n         }\n      }\n   }\n}\n```\n\nthis should pick up your similarity then.\n\nPlease report back if that works\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/14555988","html_url":"https://github.com/elastic/elasticsearch/issues/2707#issuecomment-14555988","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2707","id":14555988,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTU1OTg4","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-03-07T12:00:08Z","updated_at":"2013-03-07T12:00:08Z","author_association":"CONTRIBUTOR","body":"hey, did you try my recommendations? any updates on this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/14562231","html_url":"https://github.com/elastic/elasticsearch/issues/2707#issuecomment-14562231","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2707","id":14562231,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTYyMjMx","user":{"login":"lukapor","id":3388840,"node_id":"MDQ6VXNlcjMzODg4NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/3388840?v=4","gravatar_id":"","url":"https://api.github.com/users/lukapor","html_url":"https://github.com/lukapor","followers_url":"https://api.github.com/users/lukapor/followers","following_url":"https://api.github.com/users/lukapor/following{/other_user}","gists_url":"https://api.github.com/users/lukapor/gists{/gist_id}","starred_url":"https://api.github.com/users/lukapor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukapor/subscriptions","organizations_url":"https://api.github.com/users/lukapor/orgs","repos_url":"https://api.github.com/users/lukapor/repos","events_url":"https://api.github.com/users/lukapor/events{/privacy}","received_events_url":"https://api.github.com/users/lukapor/received_events","type":"User","site_admin":false},"created_at":"2013-03-07T14:10:21Z","updated_at":"2013-03-07T14:10:21Z","author_association":"NONE","body":"Simon hello.\n\nYes i did but it didnt work. This weekend we planned to replace our core lucene search imlementation with elastic search(0.20.5) - with our own similarity provider on our product (http://www.bcsocial.io). \n\nSo next week i have a little bit more time - and i get deep into it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/14564525","html_url":"https://github.com/elastic/elasticsearch/issues/2707#issuecomment-14564525","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2707","id":14564525,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTY0NTI1","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-03-07T14:52:41Z","updated_at":"2013-03-07T14:52:41Z","author_association":"CONTRIBUTOR","body":"alright I looked into it and found the problems:\n1. you need to register the provider\n\n``` java\npublic void onModule(SimilarityModule module) {\n  module.addSimilarity(\"bcsocial\", BcsocialSimilarityProvider.class);\n}\n```\n1. add a es-plugin.property\n\nadd src/main/resources/es-plugin.properties\n\n```\nplugin=org.elasticsearch.bcsocial.similarity.BcsocialSimilarityPlugin\n```\n1. make sure you add a mapping\n   when you create the index you need to set the similarity type in your mapping not in the settings\n\n``` json\n{\n   \"settings\":{\n      \"index\":{\n         \"number_of_shards\":1,\n         \"number_of_replicas\":1\n      }\n   },\n   \"mappings\":{\n      \"entry\":{\n         \"properties\":{\n            \"message\":{\n               \"type\":\"string\",\n               \"similarity\":\"bcsocial\"\n            }\n         }\n      }\n   }\n}\n```\n\nthen you can search \n\n``` json\n$ ./Search.bat | python -mjson.tool\n{\n    \"_shards\": {\n        \"failed\": 0, \n        \"successful\": 1, \n        \"total\": 1\n    }, \n    \"hits\": {\n        \"hits\": [\n            {\n                \"_id\": \"1\", \n                \"_index\": \"test\", \n                \"_score\": 1.4142135, \n                \"_source\": {\n                    \"message\": \"test custum similarity\", \n                    \"user\": \"luka\"\n                }, \n                \"_type\": \"entry\"\n            }\n        ], \n        \"max_score\": 1.4142135, \n        \"total\": 1\n    }, \n    \"timed_out\": false, \n    \"took\": 1\n}\n```\n\nand the normal script:\n\n``` json\n$ ./SearchNormal.bat | python -mjson.tool\n{\n    \"_shards\": {\n        \"failed\": 0, \n        \"successful\": 1, \n        \"total\": 1\n    }, \n    \"hits\": {\n        \"hits\": [\n            {\n                \"_id\": \"1\", \n                \"_index\": \"test_normal\", \n                \"_score\": 0.2169777, \n                \"_source\": {\n                    \"message\": \"test default similarity\", \n                    \"user\": \"luka\"\n                }, \n                \"_type\": \"entry\"\n            }\n        ], \n        \"max_score\": 0.2169777, \n        \"total\": 1\n    }, \n    \"timed_out\": false, \n    \"took\": 2\n}\n```\n\nI guess this is what you wanted... I will close the issue its a topic for the mailing list.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/15550768","html_url":"https://github.com/elastic/elasticsearch/issues/2707#issuecomment-15550768","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2707","id":15550768,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NTUwNzY4","user":{"login":"lukapor","id":3388840,"node_id":"MDQ6VXNlcjMzODg4NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/3388840?v=4","gravatar_id":"","url":"https://api.github.com/users/lukapor","html_url":"https://github.com/lukapor","followers_url":"https://api.github.com/users/lukapor/followers","following_url":"https://api.github.com/users/lukapor/following{/other_user}","gists_url":"https://api.github.com/users/lukapor/gists{/gist_id}","starred_url":"https://api.github.com/users/lukapor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukapor/subscriptions","organizations_url":"https://api.github.com/users/lukapor/orgs","repos_url":"https://api.github.com/users/lukapor/repos","events_url":"https://api.github.com/users/lukapor/events{/privacy}","received_events_url":"https://api.github.com/users/lukapor/received_events","type":"User","site_admin":false},"created_at":"2013-03-27T20:24:28Z","updated_at":"2013-03-27T20:24:28Z","author_association":"NONE","body":"Finnaly I have time to test new version of elasticsearch. It is fantastic. Great work.\n\nI manage to create plugin with own similarity and create index with field similarity. And everything si ok. Term queries scoring is correct.\n\nWhen i use prefix query with (constant_score_boolean) i think that default similarity is taken (below i see that queryNorm is not 1). If i choose scoring_boolean option it work ok (because it takes PerFieldSimilarity) , but I need constant_score_boolean.\nIs any setting to set default search similarity\n\nthank in advance\n\nquery:\n{\n  \"from\": 0,\n  \"size\": 10,\n  \"explain\" : true,\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"prefix\": {\n            \"message\": {\n              \"value\": \"te\",\n               \"boost\": 2,\n           \"rewrite\" :\"constant_score_boolean\",\n             }\n          }\n        },\n        {\n          \"term\": {\n            \"message\": {\n               \"value\": \"similarity\",\n               \"boost\": 2\n             }\n          }\n        }\n      ]\n    }\n  }\n}\n\nresult:\n\n```\n  \"_explanation\" : {\n    \"value\" : 2.8944273,\n    \"description\" : \"sum of:\",\n    \"details\" : [ {\n      \"value\" : 0.8944272,\n      \"description\" : \"ConstantScore(message:test^2.0 message:testiram^2.0)^\n```\n\n2.0, product of:\",\n          \"details\" : [ {\n            \"value\" : 2.0,\n            \"description\" : \"boost\"\n          }, {\n            \"value\" : 0.4472136,\n            \"description\" : \"queryNorm\"\n          } ]\n        }, {\n          \"value\" : 2.0,\n          \"description\" : \"weight(message:similarity^2.0 in 0) [PerFieldSimilari\nty], result of:\",\n          \"details\" : [ {\n            \"value\" : 2.0,\n            \"description\" : \"score(doc=0,freq=1.0 = termFreq=1.0\\n), product of:\n\",\n            \"details\" : [ {\n              \"value\" : 2.0,\n              \"description\" : \"queryWeight, product of:\",\n              \"details\" : [ {\n                \"value\" : 2.0,\n                \"description\" : \"boost\"\n              }, {\n                \"value\" : 1.0,\n                \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n              }, {\n                \"value\" : 1.0,\n                \"description\" : \"queryNorm\"\n              } ]\n            }, {\n              \"value\" : 1.0,\n              \"description\" : \"fieldWeight in 0, product of:\",\n              \"details\" : [ {\n                \"value\" : 1.0,\n                \"description\" : \"tf(freq=1.0), with freq of:\",\n                \"details\" : [ {\n                  \"value\" : 1.0,\n                  \"description\" : \"termFreq=1.0\"\n                } ]\n              }, {\n                \"value\" : 1.0,\n                \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n              }, {\n                \"value\" : 1.0,\n                \"description\" : \"fieldNorm(doc=0)\"\n              } ]\n            } ]\n          } ]\n        } ]\n      }\n    } ]\n  }\n","performed_via_github_app":null}]