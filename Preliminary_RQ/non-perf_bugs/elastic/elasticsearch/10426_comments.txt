[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89510312","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-89510312","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":89510312,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NTEwMzEy","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-04-04T06:11:18Z","updated_at":"2015-04-04T06:11:18Z","author_association":"MEMBER","body":"Thx @aphyr . In general I can give a quick answer to, while we research the rest:\n\n> Have you considered looking in to an epoch/term/generation scheme?\n\nThis is indeed the current plan.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/91546379","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-91546379","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":91546379,"node_id":"MDEyOklzc3VlQ29tbWVudDkxNTQ2Mzc5","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-04-10T12:58:15Z","updated_at":"2015-04-10T12:58:15Z","author_association":"MEMBER","body":"We have made some effort to reproduce this failure. In general, we see GC as just another disruption that can happen, the same way we view network issues and file corruptions. If anyone is interested in the work we do there, the [org.elasticsearch.test.disruption](https://github.com/elastic/elasticsearch/tree/master/src/test/java/org/elasticsearch/test/disruption) package and [DiscoveryWithServiceDisruptionsTests](https://github.com/elastic/elasticsearch/blob/master/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java) are a good place to look.\n\nIn the Jepsen runs that failed for us, Jepsen created an index and have paused the master node's JVM where the primary of one of the index shards was allocated to that master node. At the time the JVM was paused, no other replica of this shard was fully initialized after initial creation. Because the master JVM was pause, other nodes elected another master but that cluster had no copies left for that specific shard. This left the cluster at a red state. When the node is unpaused it rejoins the cluster. The shard is not re-allocated because we require a qurom of copies to assign a primary (in order to make sure we do not reuse a dated copy). As such the cluster stays red and all the data previously indexed into this shard is not available for searches.\n\nWhen we changed Jepsen to wait for all replicas to be assigned before starting the nemsis, the failure doesn't happen anymore. This change, and some other improvements are part this [PR](https://github.com/aphyr/jepsen/pull/51) to Jepsen.\n\nThat said, because of the similar nature between GC and an unresponsive network, there is still small window to loose documents which is captured by #7572 and documented [on the resiliency status page](http://www.elastic.co/guide/en/elasticsearch/resiliency/current/#_loss_of_documents_during_network_partition_status_ongoing)\n\n@aphyr can you confirm that changes in the [PR](https://github.com/aphyr/jepsen/pull/51) offers the same behavior for you?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/93182887","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-93182887","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":93182887,"node_id":"MDEyOklzc3VlQ29tbWVudDkzMTgyODg3","user":{"login":"aphyr","id":3748,"node_id":"MDQ6VXNlcjM3NDg=","avatar_url":"https://avatars3.githubusercontent.com/u/3748?v=4","gravatar_id":"","url":"https://api.github.com/users/aphyr","html_url":"https://github.com/aphyr","followers_url":"https://api.github.com/users/aphyr/followers","following_url":"https://api.github.com/users/aphyr/following{/other_user}","gists_url":"https://api.github.com/users/aphyr/gists{/gist_id}","starred_url":"https://api.github.com/users/aphyr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aphyr/subscriptions","organizations_url":"https://api.github.com/users/aphyr/orgs","repos_url":"https://api.github.com/users/aphyr/repos","events_url":"https://api.github.com/users/aphyr/events{/privacy}","received_events_url":"https://api.github.com/users/aphyr/received_events","type":"User","site_admin":false},"created_at":"2015-04-15T04:15:18Z","updated_at":"2015-04-15T04:15:18Z","author_association":"NONE","body":"Thanks for this, @bleskes! I have been super busy with a few other issues but this is the last one I have to clear before talks go! I'll take a look tomorrow morning. :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/94950019","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-94950019","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":94950019,"node_id":"MDEyOklzc3VlQ29tbWVudDk0OTUwMDE5","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-04-21T21:39:27Z","updated_at":"2015-04-21T21:39:27Z","author_association":"MEMBER","body":"@aphyr re our previous discussion of:\n\n> > Have you considered looking in to an epoch/term/generation scheme?\n> > This is indeed the current plan.\n\nIf you're curious - I've open a (high level) issue describing our current thinking - see #10708 . \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96918655","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-96918655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":96918655,"node_id":"MDEyOklzc3VlQ29tbWVudDk2OTE4NjU1","user":{"login":"aphyr","id":3748,"node_id":"MDQ6VXNlcjM3NDg=","avatar_url":"https://avatars3.githubusercontent.com/u/3748?v=4","gravatar_id":"","url":"https://api.github.com/users/aphyr","html_url":"https://github.com/aphyr","followers_url":"https://api.github.com/users/aphyr/followers","following_url":"https://api.github.com/users/aphyr/following{/other_user}","gists_url":"https://api.github.com/users/aphyr/gists{/gist_id}","starred_url":"https://api.github.com/users/aphyr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aphyr/subscriptions","organizations_url":"https://api.github.com/users/aphyr/orgs","repos_url":"https://api.github.com/users/aphyr/repos","events_url":"https://api.github.com/users/aphyr/events{/privacy}","received_events_url":"https://api.github.com/users/aphyr/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T05:35:14Z","updated_at":"2015-04-28T05:35:14Z","author_association":"NONE","body":"I've merged your PR, and can confirm that ES still drops documents when a primary process is paused.\n\n``` clj\n{:valid? false,\n :lost \"#{1761}\",\n :recovered\n \"#{0 2..3 8 30 51 73 97 119 141 165 187 211 233 257 279 302 324 348 371 394 436 457 482 504 527 550 572 597 619 642 664 688 711 734 758 781 804 827 850 894 911 934 957 979 1003 1025 1049 1071 1092 1117 1138 1163 1185 1208 1230 1253 1277 1299 1342 1344 1350 1372 1415 1439 1462 1485 1508 1553 1576 1599 1623 1645 1667 1690 1714 1736 1779 1803 1825 1848 1871 1893 1917 1939 1964 1985 2010 2031 2054 2077 2100 2123 2146 2169 2192}\",\n :ok \"#{0..1344 1346..1392 1394..1530 1532..1760 1762..2203}\",\n :recovered-frac 24/551,\n :unexpected-frac 0,\n :unexpected \"#{}\",\n :lost-frac 1/2204,\n :ok-frac 550/551}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/97094610","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-97094610","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":97094610,"node_id":"MDEyOklzc3VlQ29tbWVudDk3MDk0NjEw","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T14:58:53Z","updated_at":"2015-04-28T14:58:53Z","author_association":"MEMBER","body":"@aphyr thanks for running it! I think the PR helps remove the index not being in a green state before starting the test as a cause of document loss (not the only cause). I will keep running the test with additional logging to try and reproduce the failure you see.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383888722","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-383888722","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":383888722,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Mzg4ODcyMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-24T10:51:29Z","updated_at":"2018-04-24T10:51:29Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/571786948","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-571786948","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":571786948,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTc4Njk0OA==","user":{"login":"edeak","id":7586335,"node_id":"MDQ6VXNlcjc1ODYzMzU=","avatar_url":"https://avatars0.githubusercontent.com/u/7586335?v=4","gravatar_id":"","url":"https://api.github.com/users/edeak","html_url":"https://github.com/edeak","followers_url":"https://api.github.com/users/edeak/followers","following_url":"https://api.github.com/users/edeak/following{/other_user}","gists_url":"https://api.github.com/users/edeak/gists{/gist_id}","starred_url":"https://api.github.com/users/edeak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edeak/subscriptions","organizations_url":"https://api.github.com/users/edeak/orgs","repos_url":"https://api.github.com/users/edeak/repos","events_url":"https://api.github.com/users/edeak/events{/privacy}","received_events_url":"https://api.github.com/users/edeak/received_events","type":"User","site_admin":false},"created_at":"2020-01-07T21:44:00Z","updated_at":"2020-01-07T21:44:00Z","author_association":"NONE","body":"any updates on this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/585726453","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-585726453","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":585726453,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTcyNjQ1Mw==","user":{"login":"matthiasg","id":231889,"node_id":"MDQ6VXNlcjIzMTg4OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/231889?v=4","gravatar_id":"","url":"https://api.github.com/users/matthiasg","html_url":"https://github.com/matthiasg","followers_url":"https://api.github.com/users/matthiasg/followers","following_url":"https://api.github.com/users/matthiasg/following{/other_user}","gists_url":"https://api.github.com/users/matthiasg/gists{/gist_id}","starred_url":"https://api.github.com/users/matthiasg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthiasg/subscriptions","organizations_url":"https://api.github.com/users/matthiasg/orgs","repos_url":"https://api.github.com/users/matthiasg/repos","events_url":"https://api.github.com/users/matthiasg/events{/privacy}","received_events_url":"https://api.github.com/users/matthiasg/received_events","type":"User","site_admin":false},"created_at":"2020-02-13T12:12:48Z","updated_at":"2020-02-13T12:12:48Z","author_association":"NONE","body":"@edeak indeed! A little unnerving to see this issue still open (either it is done and this was just an oversight or they did not fix it ?). Either way a shame for all the work that @aphyr put into this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/585732917","html_url":"https://github.com/elastic/elasticsearch/issues/10426#issuecomment-585732917","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10426","id":585732917,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTczMjkxNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2020-02-13T12:30:56Z","updated_at":"2020-02-13T12:30:56Z","author_association":"CONTRIBUTOR","body":"The issues found here were caused by problems in both the data replication subsystem as well as the cluster coordination subsystem, upon which the data replication relies as well for correctness. All known issues in this area relating to this problem have since been fixed. As part of the [sequence numbers effort](https://github.com/elastic/elasticsearch/issues/10708), we've introduced *primary terms* that allow rejecting invalid requests from the logical past. With the new cluster coordination subsystem introduced in ES 7 (#32006), the remaining known coordination-level issues (\"[Repeated network partitions can cause cluster state updates to be lost](https://www.elastic.co/guide/en/elasticsearch/resiliency/current/index.html)\") have been fixed as well.","performed_via_github_app":null}]