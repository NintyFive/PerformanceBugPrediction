{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/55161","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55161/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55161/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55161/events","html_url":"https://github.com/elastic/elasticsearch/issues/55161","id":599616940,"node_id":"MDU6SXNzdWU1OTk2MTY5NDA=","number":55161,"title":"ES fails to connect to master node after IP address changed ","user":{"login":"ChristianWeissCG","id":38951887,"node_id":"MDQ6VXNlcjM4OTUxODg3","avatar_url":"https://avatars0.githubusercontent.com/u/38951887?v=4","gravatar_id":"","url":"https://api.github.com/users/ChristianWeissCG","html_url":"https://github.com/ChristianWeissCG","followers_url":"https://api.github.com/users/ChristianWeissCG/followers","following_url":"https://api.github.com/users/ChristianWeissCG/following{/other_user}","gists_url":"https://api.github.com/users/ChristianWeissCG/gists{/gist_id}","starred_url":"https://api.github.com/users/ChristianWeissCG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChristianWeissCG/subscriptions","organizations_url":"https://api.github.com/users/ChristianWeissCG/orgs","repos_url":"https://api.github.com/users/ChristianWeissCG/repos","events_url":"https://api.github.com/users/ChristianWeissCG/events{/privacy}","received_events_url":"https://api.github.com/users/ChristianWeissCG/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-04-14T14:29:03Z","updated_at":"2020-04-21T06:36:13Z","closed_at":"2020-04-14T15:35:10Z","author_association":"NONE","active_lock_reason":null,"body":"After i changed the IP of all nodes in my ES cluster (4 VMs, each with docker image v6.6.1), my elasticsearch cluster is still trying to access the master node on the old IP of that master node. \r\n\r\nHost OS and within the container i can resolve the FQDN (e.g. with dig and ping) and i get the correct/new IP (new is: 10.60.7.40; old is 10.3.2.37).  (in elasticsearch.yml i use FQDNs instead of IPs) \r\n\r\nI use FQDNs in config/elasticsearch.yml:\r\n```\r\ndiscovery.zen.ping.unicast.hosts: ['cgbsel1.my.internal', 'cgbsel2.my.internal', 'cgbsel3.my.internal', 'cgbsel4.my.internal']\r\n```\r\n\r\nEven setting:\r\n```\r\n-Des.networkaddress.cache.ttl=1\r\n-Des.networkaddress.cache.negative.ttl=1\r\n```\r\nin config/jvm.options did not make ES to forget the old IP.\r\n(BTW: it is confiremed that this file is loaded by ES, verified with a \"byintentioninvalid\" value for both options, which results in an expected error)\r\n\r\nLog of node 3 (hostname: cgbsel3) while trying to connect to node 1 (master, hostname: cgbsel1):\r\n```\r\n...\r\n[2020-04-14T11:34:56,706][INFO ][o.e.n.Node               ] [cgbsel3] initialized\r\n[2020-04-14T11:34:56,706][INFO ][o.e.n.Node               ] [cgbsel3] starting ...\r\n[2020-04-14T11:34:56,939][INFO ][o.e.t.TransportService   ] [cgbsel3] publish_address {10.60.7.42:9300}, bound_addresses {0.0.0.0:9300}\r\n[2020-04-14T11:34:57,097][INFO ][o.e.b.BootstrapChecks    ] [cgbsel3] bound or publishing to a non-loopback address, enforcing bootstrap checks\r\n[2020-04-14T11:35:27,155][WARN ][o.e.n.Node               ] [cgbsel3] timed out while waiting for initial discovery state - timeout: 30s\r\n[2020-04-14T11:35:27,171][INFO ][o.e.h.n.Netty4HttpServerTransport] [cgbsel3] publish_address {10.60.7.42:9200}, bound_addresses {0.0.0.0:9200}\r\n[2020-04-14T11:35:27,171][INFO ][o.e.n.Node               ] [cgbsel3] started\r\n[2020-04-14T11:35:30,213][WARN ][o.e.d.z.ZenDiscovery     ] [cgbsel3] failed to connect to master [{cgbsel1}{HASH_REMOVED}{HASH_REMOVED}{10.3.2.37}{10.3.2.37:9300}{ml.machine_memory=16657203200, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}], retrying...\r\norg.elasticsearch.transport.ConnectTransportException: [cgbsel1][10.3.2.37:9300] connect_timeout[30s]\r\n\tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onTimeout(TcpTransport.java:1576) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:660) [elasticsearch-6.6.1.jar:6.6.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n[2020-04-14T11:36:03,243][WARN ][o.e.d.z.ZenDiscovery     ] [cgbsel3] failed to connect to master [{cgbsel1}{HASH_REMOVED}{HASH_REMOVED}{10.3.2.37}{10.3.2.37:9300}{ml.machine_memory=16657203200, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}], retrying...\r\norg.elasticsearch.transport.ConnectTransportException: [cgbsel1][10.3.2.37:9300] connect_timeout[30s]\r\n\tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onTimeout(TcpTransport.java:1576) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:660) [elasticsearch-6.6.1.jar:6.6.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n[2020-04-14T11:36:25,785][WARN ][r.suppressed             ] [cgbsel3] path: /graylog_*/_alias, params: {expand_wildcards=open, index=graylog_*}\r\norg.elasticsearch.discovery.MasterNotDiscoveredException: null\r\n\tat org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$4.onTimeout(TransportMasterNodeAction.java:262) [elasticsearch-6.6.1.jar:6.6.1]\r\n\tat org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onTimeout(ClusterStateObserver.java:322) [elasticsearch-6.6.1.jar:6.6.1]\r\n\tat org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.onTimeout(ClusterStateObserver.java:249) [elasticsearch-6.6.1.jar:6.6.1]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService$NotifyTimeout.run(ClusterApplierService.java:564) [elasticsearch-6.6.1.jar:6.6.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:660) [elasticsearch-6.6.1.jar:6.6.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n[2020-04-14T11:36:36,267][WARN ][o.e.d.z.ZenDiscovery     ] [cgbsel3] failed to connect to master [{cgbsel1}{HASH_REMOVED}{HASH_REMOVED}{10.3.2.37}{10.3.2.37:9300}{ml.machine_memory=16657203200, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}], retrying...\r\norg.elasticsearch.transport.ConnectTransportException: [cgbsel1][10.3.2.37:9300] connect_timeout[30s]\r\n\tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onTimeout(TcpTransport.java:1576) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:660) [elasticsearch-6.6.1.jar:6.6.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n...\r\n```\r\n\r\n\r\nWhy is ES still trying to use the old IP?  Why is the old IP reboot-save? Where is it persisted? \r\nHow to flush/replace old IP in ES?","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}