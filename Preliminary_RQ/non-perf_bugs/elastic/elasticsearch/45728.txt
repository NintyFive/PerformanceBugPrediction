{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45728","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45728/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45728/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45728/events","html_url":"https://github.com/elastic/elasticsearch/issues/45728","id":482804065,"node_id":"MDU6SXNzdWU0ODI4MDQwNjU=","number":45728,"title":"Enhance logging when configured realms are not available in current license","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967499607,"node_id":"MDU6TGFiZWwxOTY3NDk5NjA3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Security","name":"Team:Security","color":"fef2c0","default":false,"description":"Meta label for security team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-08-20T11:30:05Z","updated_at":"2020-11-04T23:43:53Z","closed_at":"2020-11-04T23:43:53Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"We generally handle this case well and print relevant logs in `AuthenticationService#consumeUser` : \r\n\r\n```\r\nlogger.warn(\"Authentication failed using realms [{}].\" +\r\n                            \" Realms [{}] were skipped because they are not permitted on the current license\",\r\n```\r\n\r\nThere are however cases when the `AuthenticationToken` extraction fails and we end up with a null token for the configured realms, in which cases we don't enter in `consumeUser` and never log this information. \r\n\r\nAn example of this is when only the PKI realm is configured on a license that doesn't allow it ( i.e. Basic ) where we won't print anything in the logs, making it harder for users to troubleshoot the authentication error they get. \r\n\r\nI believe that the case with PKI is unique, as SAML and OIDC have relevant logging on the REST layer, but we should verify that adequate information is logged in all cases. ","closed_by":{"login":"ywangd","id":2344308,"node_id":"MDQ6VXNlcjIzNDQzMDg=","avatar_url":"https://avatars3.githubusercontent.com/u/2344308?v=4","gravatar_id":"","url":"https://api.github.com/users/ywangd","html_url":"https://github.com/ywangd","followers_url":"https://api.github.com/users/ywangd/followers","following_url":"https://api.github.com/users/ywangd/following{/other_user}","gists_url":"https://api.github.com/users/ywangd/gists{/gist_id}","starred_url":"https://api.github.com/users/ywangd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywangd/subscriptions","organizations_url":"https://api.github.com/users/ywangd/orgs","repos_url":"https://api.github.com/users/ywangd/repos","events_url":"https://api.github.com/users/ywangd/events{/privacy}","received_events_url":"https://api.github.com/users/ywangd/received_events","type":"User","site_admin":false},"performed_via_github_app":null}