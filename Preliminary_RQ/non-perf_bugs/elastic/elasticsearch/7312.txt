{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7312","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7312/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7312/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7312/events","html_url":"https://github.com/elastic/elasticsearch/issues/7312","id":40488787,"node_id":"MDU6SXNzdWU0MDQ4ODc4Nw==","number":7312,"title":"Aggregations: DateHistogram with negative 'pre_offset' or 'post_offset' value ends with \"Message not fully read (response) for\"","user":{"login":"marcelog","id":527356,"node_id":"MDQ6VXNlcjUyNzM1Ng==","avatar_url":"https://avatars2.githubusercontent.com/u/527356?v=4","gravatar_id":"","url":"https://api.github.com/users/marcelog","html_url":"https://github.com/marcelog","followers_url":"https://api.github.com/users/marcelog/followers","following_url":"https://api.github.com/users/marcelog/following{/other_user}","gists_url":"https://api.github.com/users/marcelog/gists{/gist_id}","starred_url":"https://api.github.com/users/marcelog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcelog/subscriptions","organizations_url":"https://api.github.com/users/marcelog/orgs","repos_url":"https://api.github.com/users/marcelog/repos","events_url":"https://api.github.com/users/marcelog/events{/privacy}","received_events_url":"https://api.github.com/users/marcelog/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111540092,"node_id":"MDU6TGFiZWwxMTE1NDAwOTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.4.0.Beta1","name":"v1.4.0.Beta1","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2014-08-18T13:41:24Z","updated_at":"2014-08-21T13:30:22Z","closed_at":"2014-08-21T13:30:22Z","author_association":"NONE","active_lock_reason":null,"body":"Hey guys,\n\nWe're using version 1.3.2 and Oracle JRE: 1.7.0_67. The cluster has 3 nodes (2 data nodes and 1 used only to route searches).\n\nThere is a separate (different named) cluster of 1 node using marvel to collect statistics from the first one. No other nodes in the network, and no custom/manually made java clients around.\n\nAs the title says, when doing a DateHistogramAggregation using a negative value for either **pre_offset** or **post_offset** yields the message:\n\n\" [transport.netty          ]  Message not fully read (response) for [69208] handler org.elasticsearch.search.action.SearchServiceTransportAction$6@f58070b, error [false], resetting\" in the logs.\n\nNote that every other query works flawlessly. This is only reproduceable when using the arguments _pre_offset_ and/or _post_offset_ in a DateHistogram with a negative value and with more than 1 node in the cluster.\n\nFacts so far:\n- Gist with the output of [_nodes?jvm=true&pretty](https://gist.github.com/marcelog/010c0bdb1c6bf9b664f1).\n- Gist with [sample query](https://gist.github.com/marcelog/d96f5ad06944da1231d7)\n- **Same query**, but **without negative values** in _pre_offset_ and _post_offset_ **works** (it doesn't return the results we expect, of course, but no errors/warnings are shown in the logs)\n- This [previous issue](https://github.com/elasticsearch/elasticsearch/issues/5178) doesn't seem to be related, there are no other nodes in the network and there are no \"custom\" java clients around either. \n- The sample query **works when there is only one node in the cluster** and we start to get these error messages when adding more nodes (2 will suffice to reproduce the issue).\n\nAny ideas? In the meantime, we solved the issue by using _pre_zone_ and _post_zone_ instead of _pre_offset_ and _post_offset_. Negative values are ok, and everything is running smoothly with those (we tried index, search, and snapshot operations).  No error messages in the logs.\n\nThanks in advance,\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}