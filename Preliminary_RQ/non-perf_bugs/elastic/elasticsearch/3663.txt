{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3663","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3663/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3663/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3663/events","html_url":"https://github.com/elastic/elasticsearch/issues/3663","id":19301956,"node_id":"MDU6SXNzdWUxOTMwMTk1Ng==","number":3663,"title":"NodeDoesNotExistOnMasterException Handling","user":{"login":"anandnalya","id":66878,"node_id":"MDQ6VXNlcjY2ODc4","avatar_url":"https://avatars1.githubusercontent.com/u/66878?v=4","gravatar_id":"","url":"https://api.github.com/users/anandnalya","html_url":"https://github.com/anandnalya","followers_url":"https://api.github.com/users/anandnalya/followers","following_url":"https://api.github.com/users/anandnalya/following{/other_user}","gists_url":"https://api.github.com/users/anandnalya/gists{/gist_id}","starred_url":"https://api.github.com/users/anandnalya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anandnalya/subscriptions","organizations_url":"https://api.github.com/users/anandnalya/orgs","repos_url":"https://api.github.com/users/anandnalya/repos","events_url":"https://api.github.com/users/anandnalya/events{/privacy}","received_events_url":"https://api.github.com/users/anandnalya/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"assignees":[{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2013-09-11T06:40:18Z","updated_at":"2015-01-26T08:45:39Z","closed_at":"2015-01-26T08:45:39Z","author_association":"NONE","active_lock_reason":null,"body":"This is related to #2117 \n\nI'm able to reproduce a slight variation with the following steps:\nSet discovery.zen.minimum_master_nodes = 2 and node.max_local_storage_nodes = 1. These nodes are deployed on NFS so that in case a machine is fails, an ES process can be started on the same data path from a different machine. Each machine has access to data directories for all es nodes.\n\nThe Initial deployment was:\n- ES1 - Node1:9300 (path.data=/nfs/node1)\n- ES2 - Node2:9300 (path.data=/nfs/node2)\n- ES3 - Node3:9300 (path.data=/nfs/node3)\n\nThen I took the following steps:\n1. Killed the network on Node2, which resulted in a cluster with two nodes (ES1,ES3). ES2 process was still running on Node2.\n2. Started new es process on Node1 with path.data=/nfs/node2. I was assuming since node.max_local_storage_nodes = 1, it will not start as ES2 on Node2:9300 already has lock on it, but it started anyways. The cluster now looked like\n- ES1 - Node1:9300 (path.data=/nfs/node1)\n- ES2 - Node1:9301 (path.data=/nfs/node2)\n- ES3 - Node3:9300 (path.data=/nfs/node3)\n\nES2 - Node2:9300 (path.data=/nfs/node2) was still running but not part of the cluster.\n3. I started the network on Node2 which resulted in following two clusters:\n- Cluster1:\n  - ES1 - Node1:9300 (path.data=/nfs/node1)\n  - ES2 - Node1:9301 (path.data=/nfs/node2)\n  - ES3 - Node3:9300 (path.data=/nfs/node3)\n- Cluster2:\n  - ES1 - Node1:9300 (path.data=/nfs/node1)\n  - ES2 - Node2:9300 (path.data=/nfs/node2)\n\nNow, Node1:9300 is participating in both the clusters\n\nThis happens because of the way NodeDoesNotExistOnMasterException is handled at https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/discovery/zen/fd/MasterFaultDetection.java#L315\n\nWhen Node2 comes into network, it sees that it is no longer a part of the cluster and starts master election resulting in a new master.\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}