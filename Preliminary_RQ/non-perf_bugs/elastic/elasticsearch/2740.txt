{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2740","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2740/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2740/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2740/events","html_url":"https://github.com/elastic/elasticsearch/issues/2740","id":11742227,"node_id":"MDU6SXNzdWUxMTc0MjIyNw==","number":2740,"title":"Percolating based on More Like This queries returns \"incorrect\" results","user":{"login":"brycenz","id":184451,"node_id":"MDQ6VXNlcjE4NDQ1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/184451?v=4","gravatar_id":"","url":"https://api.github.com/users/brycenz","html_url":"https://github.com/brycenz","followers_url":"https://api.github.com/users/brycenz/followers","following_url":"https://api.github.com/users/brycenz/following{/other_user}","gists_url":"https://api.github.com/users/brycenz/gists{/gist_id}","starred_url":"https://api.github.com/users/brycenz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brycenz/subscriptions","organizations_url":"https://api.github.com/users/brycenz/orgs","repos_url":"https://api.github.com/users/brycenz/repos","events_url":"https://api.github.com/users/brycenz/events{/privacy}","received_events_url":"https://api.github.com/users/brycenz/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2013-03-07T01:32:09Z","updated_at":"2014-08-08T10:33:56Z","closed_at":"2014-08-08T10:33:56Z","author_association":"NONE","active_lock_reason":null,"body":"When a more like this query is added to the percolator for a given index the results of percolating a document through the query are inconsistent with what you would get if you re-ran the MLT query against the index. The document being percolated may match the MLT query in the percolator, but may not be contained in the results of the MLT being ran against the index.\n\nThe reason for this is that the MLT query uses the document frequency of the terms, and number of documents in the index, to weight the term frequency in the MLT like text in order to generate the score for the given term, i.e.:\n      float idf = similarity.idf(docFreq, numDocs);\n      float score = tf \\* idf;\n\nSince the index that is being used to generate the document frequency and number of documents contains just the singular document being percolated this causes the score to be vastly different (i.e. common terms in the index are not discounted).\n\nTherefore when the rewrite is performed on the MoreLikeThisQuery from within the PercolatorExecutor (via search / createNormalizedWeight / rewrite(query) - in IndexSearcher) it would be more correct to use the IndexReader defined for the index associated with this percolated query to calculate the document frequency and number of documents.\n\nNot sure if using the \"correct\" index to rewrite other queries would make similar improvements with other query types.\n\n(Note: this is based on my understanding of this code which might be slightly off and is based on 0.19.10)\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}