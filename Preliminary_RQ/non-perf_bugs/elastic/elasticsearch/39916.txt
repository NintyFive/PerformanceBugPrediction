{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39916","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39916/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39916/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39916/events","html_url":"https://github.com/elastic/elasticsearch/issues/39916","id":419450482,"node_id":"MDU6SXNzdWU0MTk0NTA0ODI=","number":39916,"title":"Multiple date formats in date_histogram aggregation","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1283161565,"node_id":"MDU6TGFiZWwxMjgzMTYxNTY1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.7.1","name":"v6.7.1","color":"dddddd","default":false,"description":""},{"id":1302526309,"node_id":"MDU6TGFiZWwxMzAyNTI2MzA5","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-rc2","name":"v7.0.0-rc2","color":"dddddd","default":false,"description":""},{"id":1222918656,"node_id":"MDU6TGFiZWwxMjIyOTE4NjU2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.0","name":"v7.2.0","color":"DDDDDD","default":false,"description":""},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-03-11T12:45:06Z","updated_at":"2019-04-03T14:38:51Z","closed_at":"2019-03-27T07:35:14Z","author_association":"MEMBER","active_lock_reason":null,"body":"The following worked in `6.x`\r\n\r\n```json\r\n\"date_histogram\": {\r\n    \"extended_bounds\": {\r\n        \"max\": \"2016-06-06T12:01:02.123\",\r\n        \"min\": \"2014-06-06T12:01:02.123\"\r\n    },\r\n    \"field\": \"startedOn\",\r\n    \"format\": \"yyyy-MM-dd'T'HH:mm:ss||date_optional_time\",\r\n    \"interval\": \"month\",\r\n    \"min_doc_count\": 2,\r\n    \"missing\": \"2015-06-06T12:01:02.123\",\r\n    \"order\": {\r\n         \"_count\": \"asc\"\r\n    }\r\n}\r\n```\r\n\r\nIn `7.0.0-beta1` it fails with the following:\r\n\r\n```json\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"parse_exception\",\r\n        \"reason\" : \"failed to parse date field [2014-06-06T12:01:02.123] with format [yyyy-MM-dd'T'HH:mm:ss||date_optional_time]: [Text '2014-06-06T12:01:02.123' could not be parsed, unparsed text found at index 19]\",\r\n        \"stack_trace\" : \"ElasticsearchParseException[failed to parse date field [2014-06-06T12:01:02.123] with format [yyyy-MM-dd'T'HH:mm:ss||date_optional_time]: [Text '2014-06-06T12:01:02.123' could not be parsed, unparsed text found at index 19]]; nested: DateTimeParseException[Text '2014-06-06T12:01:02.123' could not be parsed, unparsed text found at index 19];\\r\\n\\tat org.elasticsearch.common.time.JavaDateMathParser.parseDateTime(JavaDateMathParser.java:233)\\r\\n\\tat org.elasticsearch.common.time.JavaDateMathParser.parse(JavaDateMathParser.java:75)\\r\\n\\tat org.elasticsearch.search.DocValueFormat$DateTime.parseLong(DocValueFormat.java:229)\\r\\n\\tat org.elasticsearch.search.aggregations.bucket.histogram.ExtendedBounds.parseAndValidate(ExtendedBounds.java:156)\\r\\n\\tat org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregationBuilder.innerBuild(DateHistogramAggregationBuilder.java:455)\\r\\n\\tat org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:315)\\r\\n\\tat org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:39)\\r\\n\\tat org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:139)\\r\\n\\tat org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:333)\\r\\n\\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:800)\\r\\n\\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:607)\\r\\n\\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:582)\\r\\n\\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:385)\\r\\n\\tat org.elasticsearch.search.SearchService.access$100(SearchService.java:123)\\r\\n\\tat org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:357)\\r\\n\\tat org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:353)\\r\\n\\tat org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1068)\\r\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\r\\n\\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41)\\r\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751)\\r\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\r\\n\\tat java.base/java.lang.Thread.run(Thread.java:834)\\r\\nCaused by: java.time.format.DateTimeParseException: Text '2014-06-06T12:01:02.123' could not be parsed, unparsed text found at index 19\\r\\n\\tat java.base/java.time.format.DateTimeFormatter.parseResolved0(DateTimeFormatter.java:2049)\\r\\n\\tat java.base/java.time.format.DateTimeFormatter.parse(DateTimeFormatter.java:1874)\\r\\n\\tat org.elasticsearch.common.time.JavaDateMathParser.parseDateTime(JavaDateMathParser.java:223)\\r\\n\\t... 23 more\\r\\n\"\r\n      }\r\n    ],\r\n```\r\n\r\nSpecifying only\r\n\r\n```json\r\n    \"format\": \"date_optional_time\",\r\n```\r\n\r\nResults in no error however.","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}