[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/340901510","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-340901510","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":340901510,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDkwMTUxMA==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2017-10-31T20:46:17Z","updated_at":"2017-10-31T20:46:17Z","author_association":"CONTRIBUTOR","body":"Do you have any logs you can share from the node that dies due to OOM?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/340937936","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-340937936","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":340937936,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDkzNzkzNg==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-10-31T23:35:29Z","updated_at":"2017-10-31T23:35:29Z","author_association":"NONE","body":"I can try to get one but I think it's happening because my cluster is a little under sized in relation to the ingest rate. I am more concerned about why the failure renders the cluster unusable. I expect to lose data nodes.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/340944078","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-340944078","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":340944078,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDk0NDA3OA==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2017-11-01T00:19:16Z","updated_at":"2017-11-01T00:19:16Z","author_association":"CONTRIBUTOR","body":"@russellday may be so, but logs will definitely help lead to the cause","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341429934","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341429934","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341429934,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQyOTkzNA==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T14:00:54Z","updated_at":"2017-11-02T20:56:36Z","author_association":"NONE","body":"I have hit the issue again. After bout 10 hours of ingestion on the server /_cat/nodes reports 1 of the data nodes is no longer present. The node itself is actually running  but cannot communicate with the master.\r\n{\r\n  \"cluster_name\" : \"removed\",\r\n  \"status\" : \"red\",\r\n  \"timed_out\" : false,\r\n  \"number_of_nodes\" : 45,\r\n  \"number_of_data_nodes\" : 34,\r\n  \"active_primary_shards\" : 2319,\r\n  \"active_shards\" : 3070,\r\n  \"relocating_shards\" : 0,\r\n  \"initializing_shards\" : 25,\r\n  \"unassigned_shards\" : 74,\r\n  \"delayed_unassigned_shards\" : 74,\r\n  \"number_of_pending_tasks\" : 142848,\r\n  \"number_of_in_flight_fetch\" : 0,\r\n  \"task_max_waiting_in_queue_millis\" : 1849884,\r\n  \"active_shards_percent_as_number\" : 96.87598611549384\r\n}\r\n\r\nLog from the master node (grepped on instance ID = i-0cb4dc7bc907acb08 the data node that is out of the cluster)\r\n\r\n[2017-11-02T13:25:01,689][INFO ][o.e.c.m.MetaDataMappingService] [ip_r3.2xlarge_i-099746d14bfafaceb] [a-apps-000049/hgTFPuiJR96laS2JaIR1vg] update_mapping [Event]\r\n[2017-11-02T13:25:25,645][DEBUG][o.e.a.a.c.n.s.TransportNodesStatsAction] [ip_r3.2xlarge_i-099746d14bfafaceb] failed to execute on node [4la7TcDWRVqhMwEDQ9GucQ]\r\norg.elasticsearch.transport.ReceiveTimeoutTransportException: [ip_2.2xlarge_i-0cb4dc7bc907acb08][ip:8193][cluster:monitor/nodes/stats[n]] request_id [11224061] timed out after [15000ms]\r\n\tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:869) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:458) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_141]\r\n--\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_141]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_141]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_141]\r\nCaused by: org.elasticsearch.transport.ReceiveTimeoutTransportException: [54.147.210.141_t2.2xlarge_i-0cb4dc7bc907acb08][ip:8193][cluster:monitor/nodes/stats[n]] request_id [11224061] timed out after [15000ms]\r\n\tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:869) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\t... 4 more\r\n[2017-11-02T13:25:27,223][WARN ][o.e.t.TransportService   ] [ip_r3.2xlarge_i-099746d14bfafaceb] Received response for a request that has timed out, sent [16578ms] ago, timed out [1578ms] ago, action [cluster:monitor/nodes/stats[n]], node [{ip_t2.2xlarge_i-0cb4dc7bc907acb08}{4la7TcDWRVqhMwEDQ9GucQ}{IAm78ZOYTv-JFLM5ijgK4g}{ip}{ip:8193}{availability_zone=us-east-1a, instance_type=t2.2xlarge, external_ip=54.147.210.141, tags=Data}], id [11224061]\r\n[2017-11-02T13:25:28,920][INFO ][o.e.c.r.a.DiskThresholdMonitor] [ip_r3.2xlarge_i-099746d14bfafaceb] low disk watermark [80%] exceeded on [9j66xKfnRR6sXViYoDuL2Q][ip_c3.8xlarge_i-0b17df3c4edfe229c][/mnt/raid/data/nodes/0] free: 86.3gb[13.7%], replicas will not be assigned to this node\r\n[2017-11-02T13:25:28,920][INFO ][o.e.c.r.a.DiskThresholdMonitor] [ip_r3.2xlarge_i-099746d14bfafaceb] low disk watermark [80%] exceeded on [GiG8oFwbRiK6f27rH84cyQ][ip_t2.2xlarge_i-0ee3daefb64d7c7c8][/mnt/raid/data/nodes/0] free: 140.9gb[17.9%], replicas will not be assigned to this node\r\n[2017-11-02T13:25:28,920][WARN ][o.e.c.r.a.DiskThresholdMonitor] [ip_r3.2xlarge_i-099746d14bfafaceb] high disk watermark [90%] exceeded on [wCWDNAvmQ-W2SUk8LnE6mg][ip_t2.2xlarge_i-002c1b345ee73a497][/mnt/raid/data/nodes/0] free: 0b[0%], shards will be relocated away from this node\r\n--\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_141]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_141]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_141]\r\n[2017-11-02T13:27:21,408][WARN ][o.e.d.z.PublishClusterStateAction] [ip_r3.2xlarge_i-099746d14bfafaceb] timed out waiting for all nodes to process published state [10133] (timeout [30s], pending nodes: [{ip_t2.2xlarge_i-0cb4dc7bc907acb08}{4la7TcDWRVqhMwEDQ9GucQ}{IAm78ZOYTv-JFLM5ijgK4g}{ip}{ip:8193}{availability_zone=us-east-1a, instance_type=t2.2xlarge, external_ip=ip, tags=Data}])","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341434903","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341434903","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341434903,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQzNDkwMw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T14:16:48Z","updated_at":"2017-11-02T14:16:48Z","author_association":"MEMBER","body":"Would you please share the output of `/_cat/pending_tasks` (in a gist, for example).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341445866","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341445866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341445866,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ0NTg2Ng==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T14:50:14Z","updated_at":"2017-11-02T14:51:18Z","author_association":"NONE","body":"Shard-Failed (pending tasks had already cleared but at the time that is what was in the queue)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341450102","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341450102","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341450102,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ1MDEwMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T15:02:46Z","updated_at":"2017-11-02T15:02:46Z","author_association":"MEMBER","body":"@russellday I want to see the actual tasks, I am expecting that it must be filled with duplicates for the same shard but I want to see this with my own eyes on your pending tasks list.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341472679","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341472679","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341472679,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ3MjY3OQ==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T16:09:30Z","updated_at":"2017-11-02T16:09:30Z","author_association":"NONE","body":"I actually had the output in a terminal window (gist below). It's our suspicion as well that they are duplicates. We simply do not have enough shards to account for that many tasks.\r\n\r\nhttps://gist.github.com/russellday/093e0f7084f24eb4a29d9da229695d7c\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341473405","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341473405","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341473405,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ3MzQwNQ==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T16:11:37Z","updated_at":"2017-11-02T16:11:37Z","author_association":"NONE","body":"@jasontedor does _cat/pending_tasks provide enough detail to confirm they are duplicates? It only gives you the insertOrder, timeInQueue, and priority source columns?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341476053","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341476053","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341476053,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ3NjA1Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T16:19:53Z","updated_at":"2017-11-02T16:19:53Z","author_association":"MEMBER","body":"No, it doesn't give enough, it doesn't give the shard that failed, now I have to look up when we added that.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341477416","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341477416","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341477416,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ3NzQxNg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T16:24:02Z","updated_at":"2017-11-02T16:24:02Z","author_association":"MEMBER","body":"Sadly it was not until 5.6 that we added more information here for shard started and we have not yet added more information for shard failed. 😢\r\n\r\nHow about your logs, do they have lots of messages of the form `marking and sending shard failed due to` for the same index/shard copy?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341477750","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341477750","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341477750,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ3Nzc1MA==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T16:25:09Z","updated_at":"2017-11-02T16:25:09Z","author_association":"NONE","body":"@jasontedor If were to go with the assumption that they are duplicates (which is likely correct). What would that indicate and how could I clear that queue of tasks? In our cluster, we are using the rollover API and taking snapshots on indexes once they are rolled over. At that point they are no longer ingesting and backed up so we set the replica count to zero. We are not overly concerned with the data, since we can restore or potentially re-ingest for a given time period. However, the huge pending task list results in an outage.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341480079","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341480079","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341480079,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ4MDA3OQ==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T16:32:11Z","updated_at":"2017-11-02T20:57:28Z","author_association":"NONE","body":"@jasontedor \r\n[2017-11-02T13:29:24,379][WARN ][o.e.c.a.s.ShardStateAction] [ip_r3.2xlarge_i-099746d14bfafaceb] [largeapp-removed-000014][0] received shard failed for shard id [[largeapp-removed-000014][0]], allocation id [LcBdeCsfTPWZETj7Kk7ypg], primary term [1], message [failed to perform indices:data/write/bulk[s] on replica [largeapp-removed-000014][0], node[4la7TcDWRVqhMwEDQ9GucQ], [R], s[STARTED], a[id=LcBdeCsfTPWZETj7Kk7ypg]], failure [NodeDisconnectedException[[ip_t2.2xlarge_i-0cb4dc7bc907acb08][ip:8193][indices:data/write/bulk[s][r]] disconnected]]\r\norg.elasticsearch.transport.NodeDisconnectedException: [ip_t2.2xlarge_i-0cb4dc7bc907acb08][ip:8193][indices:data/write/bulk[s][r]] disconnected","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341485564","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341485564","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341485564,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ4NTU2NA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T16:49:13Z","updated_at":"2017-11-02T16:49:13Z","author_association":"CONTRIBUTOR","body":"I wonder if the high number of tasks are an effect, not the cause for the troubles here.\r\n\r\nFrom the logs that you showed above, we see:\r\n\r\n```\r\n[2017-11-02T13:27:21,408][WARN ][o.e.d.z.PublishClusterStateAction] [54.157.56.12_r3.2xlarge_i-099746d14bfafaceb] timed out waiting for all nodes to process published state [10133] (timeout [30s], pending nodes: [{54.147.210.141_t2.2xlarge_i-0cb4dc7bc907acb08}{4la7TcDWRVqhMwEDQ9GucQ}{IAm78ZOYTv-JFLM5ijgK4g}{172.31.15.252}{172.31.15.252:8193}{availability_zone=us-east-1a, instance_type=t2.2xlarge, external_ip=54.147.210.141, tags=Data}])\r\n```\r\n\r\nmeans that cluster state publishing was halted for 30 seconds. Many tasks can accumulate during that time. I wonder how fast cluster state publishing in general is in your cluster, i.e., whether the master has trouble publishing the cluster state, so has issues to keep up with the number of incoming tasks.\r\nCan you enable debug logging for \"cluster.service\" on the master node?\r\n\r\n```\r\nPUT /_cluster/settings\r\n{\r\n  \"transient\": {\r\n    \"logger.org.elasticsearch.cluster.service\": \"debug\"\r\n  }\r\n}\r\n```\r\n\r\nThis should tell us in the master logs how fast cluster state publishing is.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341489078","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341489078","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341489078,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTQ4OTA3OA==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T16:59:58Z","updated_at":"2017-11-02T16:59:58Z","author_association":"NONE","body":"@ywelsch - Yes, I have made the setting change and I will re-enable ingestion. I think what you are suggesting makes a lot of sense. This cluster receives a very high rate of ingestion, it might be struggling to keep up. We do see a good bit of put-mappings in the pending_tasks since we are ingesting some dynamic data.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341515972","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341515972","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341515972,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTUxNTk3Mg==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-02T18:27:13Z","updated_at":"2017-11-02T18:27:13Z","author_association":"NONE","body":"@ywelsch - Turned on ingest again and lost another data node. I have the entire log file but I tried to cherry pick examples of the items that seemed relevant.\r\n\r\nhttps://gist.github.com/russellday/ed2dda7be149845671098da29f7c117e","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341658353","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341658353","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341658353,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTY1ODM1Mw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-11-03T09:46:03Z","updated_at":"2017-11-03T09:46:03Z","author_association":"CONTRIBUTOR","body":"Can you provide the full log file? Excerpts are not really going to help here. If you don't want to share it publicly, you can send it to my_first_name@elastic.co\r\nAlso can you share some information about the size of your cluster state? Using dynamic mappings in a cluster with high ingestion rates is a bad idea.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/341775674","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-341775674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":341775674,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MTc3NTY3NA==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-03T17:39:00Z","updated_at":"2017-11-03T17:39:00Z","author_association":"NONE","body":"@ywelsch - you have mail","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/342242493","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-342242493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":342242493,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MjI0MjQ5Mw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-11-06T18:34:25Z","updated_at":"2017-11-06T18:34:25Z","author_association":"CONTRIBUTOR","body":"I've had a look at the logs, which confirms my theory above that tasks are an effect, not the cause for the troubles. What's interesting is that once a node fails, it takes a long time for that node to be booted from the cluster. Every cluster state happening after that node dropped takes 30 seconds then (i.e. timeout), because the master waits for all nodes to apply the cluster state update (which the faulty node never does, but this node does not seem to be dropped or booted from the cluster either). \r\n\r\nThere are cases where the cluster state update takes even longer than 30 seconds, see\r\n\r\n```\r\n[2017-11-02T14:11:20,553][WARN ][o.e.c.s.ClusterService   ] [34.224.89.99_r3.2xlarge_i-0ab5787c61924c821] cluster state update task [zen-disco-receive(from master [master {54.157.56.12_r3.2xlarge_i-099746d14bfafaceb}{d4_cBqcYT2Gy4hoqTp2cSQ}{tOeAuZhoQwSiyX5vf74cdw}{172.31.20.173}{172.31.20.173:8193}{availability_zone=us-east-1b, instance_type=r3.2xlarge, external_ip=54.157.56.12, tags=Master} committed version [10165]])] took [3.7m] above the warn threshold of 30s\r\n```\r\n\r\nwhere it took more than 3 minutes, the reason being issues to connect to nodes, see for example:\r\n\r\n```\r\n[2017-11-02T14:11:17,535][WARN ][o.e.c.NodeConnectionsService] [34.224.89.99_r3.2xlarge_i-0ab5787c61924c821] failed to connect to node {54.82.189.132_m4.4xlarge_i-09cf7a79c4bb3b28a}{mj-8PwXnSs6HTpSYbsGsqg}{fw807l-hSkKz0vt6ckwWwg}{172.31.22.244}{172.31.22.244:8193}{availability_zone=us-east-1b, instance_type=m4.4xlarge, external_ip=54.82.189.132, tags=Client} (tried [1] times)\r\norg.elasticsearch.transport.ConnectTransportException: [54.82.189.132_m4.4xlarge_i-09cf7a79c4bb3b28a][172.31.22.244:8193] connect_timeout[30s]\r\n\tat org.elasticsearch.transport.netty4.Netty4Transport.connectToChannels(Netty4Transport.java:379) ~[?:?]\r\n\tat org.elasticsearch.transport.TcpTransport.connectToNode(TcpTransport.java:413) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.TcpTransport.connectToNode(TcpTransport.java:387) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:291) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.cluster.NodeConnectionsService.validateNodeConnected(NodeConnectionsService.java:113) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.cluster.NodeConnectionsService.connectToNodes(NodeConnectionsService.java:86) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.cluster.service.ClusterService.runTasksForExecutor(ClusterService.java:700) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.cluster.service.ClusterService$UpdateTask.run(ClusterService.java:920) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:458) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:238) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:201) [elasticsearch-5.1.1.jar:5.1.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_141]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_141]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_141]\r\nCaused by: io.netty.channel.ConnectTimeoutException: connection timed out: 172.31.22.244/172.31.22.244:8193\r\n\tat io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe$1.run(AbstractNioChannel.java:267) ~[?:?]\r\n\tat io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38) ~[?:?]\r\n\tat io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:120) ~[?:?]\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) ~[?:?]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:418) ~[?:?]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:454) ~[?:?]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:873) ~[?:?]\r\n\t... 1 more\r\n```\r\n\r\nThis means that the master was blocked for nearly 4 minutes to do anything meaningful, causing the large list of tasks.\r\n\r\nI'm not sure why the fault detection has trouble to kick the node out. Are you perhaps taking heap dumps on OOM of the data/client nodes? It looks a bit like the connection to the failed node is in some kind of limbo state? Is there anything special around your networking setup?\r\n\r\nAlso, **can you upgrade to the latest ES version** (we have made some changes around connection handling) and check if you still hit the same problem there?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/342316927","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-342316927","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":342316927,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MjMxNjkyNw==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-06T22:59:27Z","updated_at":"2017-11-06T22:59:27Z","author_association":"NONE","body":"@ywelsch - Thanks for the confirmation. We are not doing anything out of the norm on any of the nodes. We will upgrade today and see if we still encounter the same behavior.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/343036548","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-343036548","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":343036548,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzAzNjU0OA==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-09T03:26:16Z","updated_at":"2017-11-09T03:26:16Z","author_association":"NONE","body":"@ywelsch - Same results on 5.6.2.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/343038431","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-343038431","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":343038431,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzAzODQzMQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-09T03:40:47Z","updated_at":"2017-11-09T03:40:47Z","author_association":"MEMBER","body":"@russellday That’s not the latest version. The latest is 5.6.4, and the fixes that are referenced appear in 5.6.3 and 5.6.4, I wouldn’t expect any benefit from 5.6.2 for this issue. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/343040770","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-343040770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":343040770,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzA0MDc3MA==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-09T03:59:02Z","updated_at":"2017-11-09T03:59:02Z","author_association":"NONE","body":"@jasontedor - Thanks! I will try to get 5.6.4 pushed tomorrow and let you know.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/343676302","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-343676302","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":343676302,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzY3NjMwMg==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-11T16:25:38Z","updated_at":"2017-11-11T16:25:38Z","author_association":"NONE","body":"@jasontedor - same results on 5.6.4","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/344212910","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-344212910","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":344212910,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NDIxMjkxMA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-11-14T10:24:09Z","updated_at":"2017-11-14T10:24:09Z","author_association":"CONTRIBUTOR","body":"Can you reproduce the same behavior if you simply kill a node (with `kill -9`)? Are you taking heap dumps on OOMs? How long do those take? Have you made changes to the fault detection settings?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/344330498","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-344330498","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":344330498,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NDMzMDQ5OA==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-14T17:15:29Z","updated_at":"2017-11-14T17:15:29Z","author_association":"NONE","body":"@ywelsch - killing a node does not exhibit the same behavior. The recovery in that scenario is normal, a reasonable amount of shard-failed tasks and quick recovery. Not taking heap dumps on the OOM's currently and no changes to the fault detection. I have not investigated the OOM heaps since this test is using instances that I expect will fail on a regular basis. The hope was we can handle replacing failed nodes quickly and maintain cluster availability.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/344346295","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-344346295","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":344346295,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NDM0NjI5NQ==","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"created_at":"2017-11-14T18:07:44Z","updated_at":"2017-11-14T18:07:44Z","author_association":"NONE","body":"@ywelsch - Sent you a log an update via email.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352371044","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-352371044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":352371044,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjM3MTA0NA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-12-18T09:26:51Z","updated_at":"2017-12-18T09:26:51Z","author_association":"CONTRIBUTOR","body":"I've gotten the logs via e-mail, which were unfortunately not from the active master node, so I asked for those as well. No response to that, so I'm closing this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363698131","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-363698131","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":363698131,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzY5ODEzMQ==","user":{"login":"jgq2008303393","id":657140,"node_id":"MDQ6VXNlcjY1NzE0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/657140?v=4","gravatar_id":"","url":"https://api.github.com/users/jgq2008303393","html_url":"https://github.com/jgq2008303393","followers_url":"https://api.github.com/users/jgq2008303393/followers","following_url":"https://api.github.com/users/jgq2008303393/following{/other_user}","gists_url":"https://api.github.com/users/jgq2008303393/gists{/gist_id}","starred_url":"https://api.github.com/users/jgq2008303393/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgq2008303393/subscriptions","organizations_url":"https://api.github.com/users/jgq2008303393/orgs","repos_url":"https://api.github.com/users/jgq2008303393/repos","events_url":"https://api.github.com/users/jgq2008303393/events{/privacy}","received_events_url":"https://api.github.com/users/jgq2008303393/received_events","type":"User","site_admin":false},"created_at":"2018-02-07T08:47:59Z","updated_at":"2018-02-07T08:48:52Z","author_association":"NONE","body":"@russellday @ywelsch Any result about this issue? We have encounted very similar problem:\r\nhttps://discuss.elastic.co/t/half-dead-node-lead-to-cluster-hang/113658","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/365077638","html_url":"https://github.com/elastic/elasticsearch/issues/27194#issuecomment-365077638","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","id":365077638,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTA3NzYzOA==","user":{"login":"azsolinsky","id":22183636,"node_id":"MDQ6VXNlcjIyMTgzNjM2","avatar_url":"https://avatars3.githubusercontent.com/u/22183636?v=4","gravatar_id":"","url":"https://api.github.com/users/azsolinsky","html_url":"https://github.com/azsolinsky","followers_url":"https://api.github.com/users/azsolinsky/followers","following_url":"https://api.github.com/users/azsolinsky/following{/other_user}","gists_url":"https://api.github.com/users/azsolinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/azsolinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azsolinsky/subscriptions","organizations_url":"https://api.github.com/users/azsolinsky/orgs","repos_url":"https://api.github.com/users/azsolinsky/repos","events_url":"https://api.github.com/users/azsolinsky/events{/privacy}","received_events_url":"https://api.github.com/users/azsolinsky/received_events","type":"User","site_admin":false},"created_at":"2018-02-12T22:01:32Z","updated_at":"2018-02-12T22:13:46Z","author_association":"NONE","body":"in the instance @russellday reported, logs on the master are spewing:\r\n\r\n```\r\n[2018-02-12T22:00:17,463][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [v5-2018-02-09-08-shared][3] received shard failed for shard id [[v5-2018-02-09-08-shared][3]], allocation id [7chbXHqMTOSHxmkUikYsDA], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,464][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [shrink-v5-2018-01-19-12-shared][1] received shard failed for shard id [[shrink-v5-2018-01-19-12-shared][1]], allocation id [is_1YwAPSLSQs159Eo-l_A], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,466][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [v5-2018-02-06-10-shared][5] received shard failed for shard id [[v5-2018-02-06-10-shared][5]], allocation id [v2PGlZ94RiaUlJMmZONKig], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,470][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [v5-2018-02-09-03-shared][9] received shard failed for shard id [[v5-2018-02-09-03-shared][9]], allocation id [JGkx1bXfTTqNBWMybB7B_A], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,472][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [shrink-v5-2017-12-03-09-shared][0] received shard failed for shard id [[shrink-v5-2017-12-03-09-shared][0]], allocation id [PB8nrR4qQFOY7sxt6AH5GQ], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,474][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [shrink-v5-2017-12-17-07-shared][0] received shard failed for shard id [[shrink-v5-2017-12-17-07-shared][0]], allocation id [mhcHnOkiT_-xA7HaNhng4w], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,476][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [shrink-v5-2018-01-05-05-shared][0] received shard failed for shard id [[shrink-v5-2018-01-05-05-shared][0]], allocation id [ju_4pa67T7yBbFv8JE1bEg], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,477][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [shrink-v5-2017-12-08-17-shared][0] received shard failed for shard id [[shrink-v5-2017-12-08-17-shared][0]], allocation id [O6OIe2TpQpSqIhceuGiiVA], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,479][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [v5-2018-02-01-03-shared][5] received shard failed for shard id [[v5-2018-02-01-03-shared][5]], allocation id [fs70Ik4mTk6Ch9asOrP-Yw], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,482][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [shrink-v5-2018-01-05-13-shared][1] received shard failed for shard id [[shrink-v5-2018-01-05-13-shared][1]], allocation id [PEK-HPElSoeT6ZiTNsXVkw], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n[2018-02-12T22:00:17,484][WARN ][o.e.c.a.s.ShardStateAction] [<redacted>_m4.16xlarge_i-03f84c85e0a871309] [v5-2018-02-09-06-shared][6] received shard failed for shard id [[v5-2018-02-09-06-shared][6]], allocation id [Ve5FGUFTTeCMONTDCZWXrg], primary term [0], message [master {<redacted>_m4.16xlarge_i-03f84c85e0a871309}{eef-RM2vTzWWDLKy4WI0VQ}{Q3WrsXuZQjS6gcY98mKPZQ}{172.31.61.188}{172.31.61.188:8193}{availability_zone=us-east-1b, instance_type=m4.16xlarge, external_ip=<redacted>, tags=Master} has not removed previously failed shard. resending shard failure]\r\n```\r\n\r\nexcerpt from pending tasks:\r\n\r\n    \"number_of_pending_tasks\": 126510,\r\n\r\n  7642    1h HIGH      shard-failed\r\n  7643    1h HIGH      shard-failed\r\n  7420    1h HIGH      shard-failed\r\n  7645    1h HIGH      shard-failed\r\n  7646    1h HIGH      shard-failed\r\n  7647    1h HIGH      shard-failed\r\n  7648    1h HIGH      shard-failed\r\n  7649    1h HIGH      shard-failed\r\n  7913    1h HIGH      shard-failed\r\n  7651    1h HIGH      shard-failed\r\n  7916    1h HIGH      shard-failed\r\n  7653    1h HIGH      shard-failed\r\n  7654    1h HIGH      shard-failed\r\n  7655    1h HIGH      shard-failed\r\n  7924    1h HIGH      shard-failed\r\n  7657    1h HIGH      shard-failed\r\n  7658    1h HIGH      shard-failed\r\n  7659    1h HIGH      shard-failed\r\n  7932    1h HIGH      shard-failed\r\n  7661    1h HIGH      shard-failed\r\n  7662    1h HIGH      shard-failed\r\n  7663    1h HIGH      shard-failed\r\n  7664    1h HIGH      shard-failed\r\n  7665    1h HIGH      shard-failed","performed_via_github_app":null}]