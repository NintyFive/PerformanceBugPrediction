{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16593/events","html_url":"https://github.com/elastic/elasticsearch/issues/16593","id":132821571,"node_id":"MDU6SXNzdWUxMzI4MjE1NzE=","number":16593,"title":"Performing derivatives on arbitrary aggregations. ","user":{"login":"kennycason","id":2858428,"node_id":"MDQ6VXNlcjI4NTg0Mjg=","avatar_url":"https://avatars1.githubusercontent.com/u/2858428?v=4","gravatar_id":"","url":"https://api.github.com/users/kennycason","html_url":"https://github.com/kennycason","followers_url":"https://api.github.com/users/kennycason/followers","following_url":"https://api.github.com/users/kennycason/following{/other_user}","gists_url":"https://api.github.com/users/kennycason/gists{/gist_id}","starred_url":"https://api.github.com/users/kennycason/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kennycason/subscriptions","organizations_url":"https://api.github.com/users/kennycason/orgs","repos_url":"https://api.github.com/users/kennycason/repos","events_url":"https://api.github.com/users/kennycason/events{/privacy}","received_events_url":"https://api.github.com/users/kennycason/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2016-02-10T21:24:51Z","updated_at":"2018-03-26T15:49:11Z","closed_at":"2018-03-26T15:35:25Z","author_association":"NONE","active_lock_reason":null,"body":"I was looking into implementing the derivative pipeline into our aggregations. \nFor example, we may return a sum aggregation of numeric type (post likes) that has been segmented previously by a string type (channel, fb/twitter/etc). Also specifically in our case they were bucketed under a date_range aggregation.\n\nI noticed that derivatives could only be provided if parent aggregation was a histogram or a date histogram. Is there any plan or desire to support derivatives (and other pipeline metrics for the general case of numeric aggregations? I'm guessing there would also be some work around the gap policy.\n\nI also noticed an issue with parsing the bucket path when i have an aggregation with a name containing a \".\" (like I have below), I was able to fix that by just renaming to \"_\"\n\nsample query where i'd like to have derivatives for:\n`\"sum\":{  \"field\":\"post.likes_count\" }`\nthe request:\n\n``` json\n{  \n   \"aggregations\":{  \n      \"date_range_buckets\":{  \n         \"date_range\":{  \n            \"field\":\"post.creation_date\",\n            \"ranges\":[  \n               {  \n                  \"from\":\"2015-12-15T00:00:00.000Z\",\n                  \"to\":\"2015-12-21T00:00:00.000Z\"\n               },\n               {  \n                  \"from\":\"2015-12-21T00:00:00.000Z\",\n                  \"to\":\"2016-01-01T00:00:00.000Z\"\n               }\n            ]\n         },\n         \"aggregations\":{  \n              \"channel\":{  \n                   \"terms\":{  \n                      \"field\":\"internal.channel\"\n                   },\n                   \"aggregations\":{  \n                      \"post_likes_count\":{  \n                         \"sum\":{  \n                            \"field\":\"post.likes_count\"\n                         }\n                      }\n                   }\n               }\n         }\n      }\n   },\n   \"size\": 0\n}\n```\n\nThanks, let me know if i'm just missing something obvious. :)\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}