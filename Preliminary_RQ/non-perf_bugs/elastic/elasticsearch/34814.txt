{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34814","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34814/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34814/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34814/events","html_url":"https://github.com/elastic/elasticsearch/issues/34814","id":373552864,"node_id":"MDU6SXNzdWUzNzM1NTI4NjQ=","number":34814,"title":"[Monitoring] Cluster Status alert triggers on transient yellow status","user":{"login":"DaveyDevOps","id":34562546,"node_id":"MDQ6VXNlcjM0NTYyNTQ2","avatar_url":"https://avatars0.githubusercontent.com/u/34562546?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveyDevOps","html_url":"https://github.com/DaveyDevOps","followers_url":"https://api.github.com/users/DaveyDevOps/followers","following_url":"https://api.github.com/users/DaveyDevOps/following{/other_user}","gists_url":"https://api.github.com/users/DaveyDevOps/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveyDevOps/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveyDevOps/subscriptions","organizations_url":"https://api.github.com/users/DaveyDevOps/orgs","repos_url":"https://api.github.com/users/DaveyDevOps/repos","events_url":"https://api.github.com/users/DaveyDevOps/events{/privacy}","received_events_url":"https://api.github.com/users/DaveyDevOps/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2018-10-24T15:50:34Z","updated_at":"2020-07-08T13:59:50Z","closed_at":"2018-10-26T20:42:36Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 6.3.1, Build: default/zip/eb782d0/2018-06-29T21:59:26.107521Z, JVM: 1.8.0_162\r\n\r\n**Plugins installed**: [x-pack, hdfs-repository]\r\n\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_162\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_162-b34)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.162-b34, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux hostname 4.4.114-92.64-default #1 SMP Thu Feb 1 19:18:19 UTC 2018 (c6ce5db) x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n/x-pack/plugin/monitoring/src/main/resources/monitoring/watches/elasticsearch_cluster_status.json \r\nThe included watch will trigger with yellow status but clear at next run. \r\nWhen a new index is created it is natural for there to be \"missing\" replica as shards are started. \r\n\r\nWould like to see the watch account for this behavior, maybe status should be checked twice before triggering?\r\n\r\nWait for active shards might be an option to avoid the yellow status, but prefer not to set that across all index and for all subsequent writes when only concerned about index creation. \r\n\r\n**Steps to reproduce**:\r\nWe have set default number of replica to be 1 using a default template. Monitoring collection interval has been increased to 1 minute to reduce load on the system. \r\n\r\n 1. Create a new index (with at least 1 replica), should be able to observe status change in logs (active master) \r\n 2. Watch will only trigger if monitoring data collection coincides with status being yellow\r\n\r\n**Provide logs (if relevant)**:\r\n> Sent: Monday, October 22, 2018 12:08 PM\r\n> To: AdminEmail\r\n> Subject: [NEW] X-Pack Monitoring: Cluster Status (UUID) [YELLOW]\r\n>\r\n> Elasticsearch cluster status is yellow. Allocate missing replica shards.\r\n\r\n> Sent: Monday, October 22, 2018 12:10 PM\r\n> To: AdminEmail\r\n> Subject: [RESOLVED] X-Pack Monitoring: Cluster Status (UUID) [GREEN]\r\n> \r\n> This cluster alert has been resolved: Elasticsearch cluster status is yellow. Allocate missing replica shards.\r\n\r\nShowing status change as new indices are created\r\n```\r\n[2018-10-21T19:00:04,341][INFO ][o.e.c.r.a.AllocationService] [master-hostname] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[.monitoring-es-6-2018.10.22][0]] ...]).\r\n[2018-10-21T19:00:06,931][INFO ][o.e.c.r.a.AllocationService] [master-hostname] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[.monitoring-kibana-6-2018.10.22][0]] ...]).\r\n[2018-10-21T19:00:23,796][INFO ][o.e.c.r.a.AllocationService] [master-hostname] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[.monitoring-logstash-6-2018.10.22][0]] ...]).\r\n```\r\n","closed_by":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}