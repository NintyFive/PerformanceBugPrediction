{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6405","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6405/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6405/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6405/events","html_url":"https://github.com/elastic/elasticsearch/issues/6405","id":34949727,"node_id":"MDU6SXNzdWUzNDk0OTcyNw==","number":6405,"title":"date_histogram extendedBounds(DateTime,DateTime) failed when using format option","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-06-04T11:16:45Z","updated_at":"2016-07-26T13:08:39Z","closed_at":"2016-07-26T13:08:39Z","author_association":"MEMBER","active_lock_reason":null,"body":"This code was working in elasticsearch 1.1.1:\n\n``` java\nSearchResponse response = esClient.prepareSearch(\"person\")\n  .addAggregation(\n    AggregationBuilders.dateHistogram(\"by_year\")\n      .field(\"dateOfBirth\")\n      .minDocCount(0)\n      .interval(DateHistogram.Interval.YEAR)\n      .extendedBounds(DateTime.parse(\"1940\"), DateTime.parse(\"2009\"))\n      .format(\"YYYY\")\n  )\n  .execute().actionGet();\n```\n\nFrom elasticsearch 1.2.0, it fails with:\n\n```\n[2014-06-04 12:54:38,337][DEBUG][action.search.type       ] [Karla Sofen] [person][0], node[wTCLjroMSk-3LPUx3dIdlA], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@300f4bad] lastShard [true]\norg.elasticsearch.ElasticsearchParseException: failed to parse date field [1940-01-01T00:00:00.000Z], tried both date format [YYYY], and timestamp number\n    at org.elasticsearch.common.joda.DateMathParser.parseStringValue(DateMathParser.java:226)\n    at org.elasticsearch.common.joda.DateMathParser.parse(DateMathParser.java:68)\n    at org.elasticsearch.common.joda.DateMathParser.parse(DateMathParser.java:42)\n    at org.elasticsearch.search.aggregations.support.format.ValueParser$DateMath.parseLong(ValueParser.java:96)\n    at org.elasticsearch.search.aggregations.bucket.histogram.ExtendedBounds.processAndValidate(ExtendedBounds.java:52)\n    at org.elasticsearch.search.aggregations.bucket.histogram.HistogramAggregator$Factory.create(HistogramAggregator.java:178)\n    at org.elasticsearch.search.aggregations.bucket.histogram.HistogramAggregator$Factory.create(HistogramAggregator.java:137)\n    at org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.create(ValuesSourceAggregatorFactory.java:54)\n    at org.elasticsearch.search.aggregations.AggregatorFactories.createAndRegisterContextAware(AggregatorFactories.java:52)\n    at org.elasticsearch.search.aggregations.AggregatorFactories.createTopLevelAggregators(AggregatorFactories.java:145)\n    at org.elasticsearch.search.aggregations.AggregationPhase.preProcess(AggregationPhase.java:79)\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:99)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:257)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:206)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:203)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:517)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:724)\nCaused by: java.lang.IllegalArgumentException: Invalid format: \"1940-01-01T00:00:00.000Z\" is malformed at \"-01-01T00:00:00.000Z\"\n    at org.elasticsearch.common.joda.time.format.DateTimeFormatter.parseMillis(DateTimeFormatter.java:754)\n    at org.elasticsearch.common.joda.DateMathParser.parseStringValue(DateMathParser.java:220)\n    ... 18 more\n```\n\nOf course, it works nicely when using `extendedBounds(String, String)` instead of `extendedBounds(DateTime, DateTime)`:\n\n``` java\nSearchResponse response = esClient.prepareSearch(\"person\")\n  .addAggregation(\n    AggregationBuilders.dateHistogram(\"by_year\")\n      .field(\"dateOfBirth\")\n      .minDocCount(0)\n      .interval(DateHistogram.Interval.YEAR)\n      .extendedBounds(\"1940\", \"2009\")\n      .format(\"YYYY\")\n  )\n  .execute().actionGet();\n```\n\nAs it was working in 1.1.1, should we consider this as a regression or is it by design?\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}