[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/141968872","html_url":"https://github.com/elastic/elasticsearch/issues/13674#issuecomment-141968872","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13674","id":141968872,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MTk2ODg3Mg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-21T13:08:43Z","updated_at":"2015-09-21T13:08:43Z","author_association":"CONTRIBUTOR","body":"> ```\n>     createIndex(...);\n>     ensureGreen(...);\n> ```\n\nIn this particular case my guess is that the native script isn't being executed at all because there are no results. If there are results then I'm wrong here.\n\nIs there any chance you could post a gist or even a small reproduction project?\n\nIf you happen to still be around and want a faster conversation you can reach out to me in #elasticsearch on freenode. I'm `manybubbles` there.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/141969520","html_url":"https://github.com/elastic/elasticsearch/issues/13674#issuecomment-141969520","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13674","id":141969520,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MTk2OTUyMA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-21T13:11:57Z","updated_at":"2015-09-21T13:11:57Z","author_association":"CONTRIBUTOR","body":"> Is there any chance you could post a gist or even a small reproduction project?\n\nIt'd probably be even better if you could reproduce this with a bash script and curl - but I'll take what I can get.\n\n> scripted fetch fields, scripted metrics also don't propagate any thrown exceptions.\n> e.g. AggregationBuilders.sum(\"sum\").script(...)\n> e.g. AggregationBuilders.scriptedMetric(...)\n\nHmmm. These _could_ be consistent with my theory about no hits not triggering it. Or not. \n\n> however, the following integration test, that used to work with ES-1.7.1, now fails\n\nHmmm. Curiouser and curiouser.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/141995639","html_url":"https://github.com/elastic/elasticsearch/issues/13674#issuecomment-141995639","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13674","id":141995639,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MTk5NTYzOQ==","user":{"login":"drallax","id":14543491,"node_id":"MDQ6VXNlcjE0NTQzNDkx","avatar_url":"https://avatars1.githubusercontent.com/u/14543491?v=4","gravatar_id":"","url":"https://api.github.com/users/drallax","html_url":"https://github.com/drallax","followers_url":"https://api.github.com/users/drallax/followers","following_url":"https://api.github.com/users/drallax/following{/other_user}","gists_url":"https://api.github.com/users/drallax/gists{/gist_id}","starred_url":"https://api.github.com/users/drallax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drallax/subscriptions","organizations_url":"https://api.github.com/users/drallax/orgs","repos_url":"https://api.github.com/users/drallax/repos","events_url":"https://api.github.com/users/drallax/events{/privacy}","received_events_url":"https://api.github.com/users/drallax/received_events","type":"User","site_admin":false},"created_at":"2015-09-21T14:15:41Z","updated_at":"2015-09-21T14:15:41Z","author_association":"NONE","body":"Thanks for getting back on this so quickly.\nThe source code I posted was a reduced down sketch of what is actually happening, and yes, in reality we do hit documents, so I expect there is a regression somewhere.\nI'll see if i can get you some fully working examples (probably as ES integration tests) of the oddities we're seeing here\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/141998334","html_url":"https://github.com/elastic/elasticsearch/issues/13674#issuecomment-141998334","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13674","id":141998334,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MTk5ODMzNA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-21T14:26:38Z","updated_at":"2015-09-21T14:26:38Z","author_association":"CONTRIBUTOR","body":"> I'll see if i can get you some fully working examples (probably as ES integration tests) of the oddities we're seeing here\n\nThanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142008003","html_url":"https://github.com/elastic/elasticsearch/issues/13674#issuecomment-142008003","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13674","id":142008003,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjAwODAwMw==","user":{"login":"drallax","id":14543491,"node_id":"MDQ6VXNlcjE0NTQzNDkx","avatar_url":"https://avatars1.githubusercontent.com/u/14543491?v=4","gravatar_id":"","url":"https://api.github.com/users/drallax","html_url":"https://github.com/drallax","followers_url":"https://api.github.com/users/drallax/followers","following_url":"https://api.github.com/users/drallax/following{/other_user}","gists_url":"https://api.github.com/users/drallax/gists{/gist_id}","starred_url":"https://api.github.com/users/drallax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drallax/subscriptions","organizations_url":"https://api.github.com/users/drallax/orgs","repos_url":"https://api.github.com/users/drallax/repos","events_url":"https://api.github.com/users/drallax/events{/privacy}","received_events_url":"https://api.github.com/users/drallax/received_events","type":"User","site_admin":false},"created_at":"2015-09-21T15:02:13Z","updated_at":"2015-09-21T15:06:32Z","author_association":"NONE","body":"found the problem:\nthe search response that ES-2.0 server-side returns looks like this (perfectly fine):\n\n```\n{\n  \"took\" : 108,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 3,\n    \"successful\" : 2,\n    \"failed\" : 1,\n    \"failures\" : [ {\n      \"shard\" : 2,\n      \"index\" : \"test\",\n      \"node\" : \"jsoxbkP9QDGnl5lSIHYBvQ\",\n      \"reason\" : {\n        \"type\" : \"script_exception\",\n        \"reason\" : \"missing parameter: field\"\n      }\n    } ]\n  },\n  \"hits\" : {\n    \"total\" : 0,\n    \"max_score\" : null,\n    \"hits\" : [ ]\n  },\n  }\n}\n```\n\nHowever, our tests fail since\n\n```\n_client.prepareSearch().....execute().actionGet()\n```\n\nbehaves differently from before\nin ES-1.7.1 and earlier, it would throw an exception,\nin ES-2.0.0-beta1/2, it will NOT throw an exception anymore,\nbut we end up with a SearchResponse in our hands that we can check for failed shards.\n(The same difference exists when adding an Actionlistener to the SearchRequest:\nin ES-1.7.1 ActionListener.onFailure() is triggered,\nin ES-2.0.0 ActionListener.onResponse() is called instead\n)\n\nI am not sure if this qualifies as a bug or intended behaviour?\nIf the latter, it would be nice if the release notes/migration guide \nwould mention that in the Java API (all?) responses now have to be checked for failed shards.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142010937","html_url":"https://github.com/elastic/elasticsearch/issues/13674#issuecomment-142010937","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13674","id":142010937,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjAxMDkzNw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-21T15:11:45Z","updated_at":"2015-09-21T15:11:45Z","author_association":"CONTRIBUTOR","body":"That makes sense to me.\n\n@clintongormley - I think we have our answer to why.\n\nI don't think we can call this a bug - it was probably intentional and being relied on for node to node communication - but it is a pain. It certainly should be in the list of breaking changes.\n\nI've been thinking a lot about how a real Java API for elasticsearch (compared to coopting the internode communications API like we do now) would behave lately and I'm not sure what the right thing to do in this situation is. There was a failure and so the user should know about it so an exception makes sense. But the failure wasn't complete and you can learn _something_ from the response so throwing an exception feels a bit like throwing the baby out with the bathwater. Maybe throwing an exception the contains a reference to the original request....\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142022609","html_url":"https://github.com/elastic/elasticsearch/issues/13674#issuecomment-142022609","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13674","id":142022609,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjAyMjYwOQ==","user":{"login":"drallax","id":14543491,"node_id":"MDQ6VXNlcjE0NTQzNDkx","avatar_url":"https://avatars1.githubusercontent.com/u/14543491?v=4","gravatar_id":"","url":"https://api.github.com/users/drallax","html_url":"https://github.com/drallax","followers_url":"https://api.github.com/users/drallax/followers","following_url":"https://api.github.com/users/drallax/following{/other_user}","gists_url":"https://api.github.com/users/drallax/gists{/gist_id}","starred_url":"https://api.github.com/users/drallax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drallax/subscriptions","organizations_url":"https://api.github.com/users/drallax/orgs","repos_url":"https://api.github.com/users/drallax/repos","events_url":"https://api.github.com/users/drallax/events{/privacy}","received_events_url":"https://api.github.com/users/drallax/received_events","type":"User","site_admin":false},"created_at":"2015-09-21T15:47:55Z","updated_at":"2015-09-21T15:47:55Z","author_association":"NONE","body":"Sounds great :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/145983960","html_url":"https://github.com/elastic/elasticsearch/issues/13674#issuecomment-145983960","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13674","id":145983960,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTk4Mzk2MA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-10-06T20:10:13Z","updated_at":"2015-10-06T20:10:13Z","author_association":"CONTRIBUTOR","body":"I've taken this one. For now I'll see about getting it documented. I'll make sure to bring this up against the Java API when that gets started.\n","performed_via_github_app":null}]