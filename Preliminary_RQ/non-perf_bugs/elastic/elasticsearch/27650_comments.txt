[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/349029468","html_url":"https://github.com/elastic/elasticsearch/issues/27650#issuecomment-349029468","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27650","id":349029468,"node_id":"MDEyOklzc3VlQ29tbWVudDM0OTAyOTQ2OA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-12-04T17:05:20Z","updated_at":"2017-12-04T17:05:20Z","author_association":"MEMBER","body":"This is basically a git cherry pick fail. I fixed it only to lose it when I was cleaning up the commits... Thx Lee!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/421324019","html_url":"https://github.com/elastic/elasticsearch/issues/27650#issuecomment-421324019","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27650","id":421324019,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTMyNDAxOQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-09-14T11:05:41Z","updated_at":"2018-09-14T11:05:41Z","author_association":"MEMBER","body":"@bleskes it looks like it failed again with exactly the same error message:\r\n\r\n```\r\njava.lang.AssertionError: \r\nExpected: <110>\r\n     but: was <60>\r\n\tat __randomizedtesting.SeedInfo.seed([887030CB7438355C:821F498F69CEB96]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.upgrades.RecoveryIT.assertCount(RecoveryIT.java:168)\r\n\tat org.elasticsearch.upgrades.RecoveryIT.testRecoveryWithConcurrentIndexing(RecoveryIT.java:156)\r\n```\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :qa:rolling-upgrade:v5.6.12-SNAPSHOT#upgradedClusterTestRunner \\\r\n  -Dtests.seed=887030CB7438355C \\\r\n  -Dtests.class=org.elasticsearch.upgrades.RecoveryIT \\\r\n  -Dtests.method=\"testRecoveryWithConcurrentIndexing\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=fr-FR \\\r\n  -Dtests.timezone=CNT \\\r\n  -Dcompiler.java=10 \\\r\n  -Druntime.java=8FIPS \\\r\n  -Djavax.net.ssl.keyStorePassword=password \\\r\n  -Djavax.net.ssl.trustStorePassword=password\r\n```\r\n\r\nCI: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+matrix-java-periodic/ES_BUILD_JAVA=java10,ES_RUNTIME_JAVA=java8fips,nodes=virtual&&linux/297/console\r\n\r\n\r\nShould this be cherry-picked somewhere else as well?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423003428","html_url":"https://github.com/elastic/elasticsearch/issues/27650#issuecomment-423003428","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27650","id":423003428,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzAwMzQyOA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T00:48:40Z","updated_at":"2018-09-20T17:23:03Z","author_association":"MEMBER","body":"I think this test fails because we rollback a replica to the global checkpoint(https://github.com/elastic/elasticsearch/pull/33473) but do not restore its history on promotion. This should be fixed by https://github.com/elastic/elasticsearch/pull/33616.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423265617","html_url":"https://github.com/elastic/elasticsearch/issues/27650#issuecomment-423265617","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27650","id":423265617,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzI2NTYxNw==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T17:23:18Z","updated_at":"2018-09-20T17:23:18Z","author_association":"MEMBER","body":"Fixed by #33616.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423375324","html_url":"https://github.com/elastic/elasticsearch/issues/27650#issuecomment-423375324","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27650","id":423375324,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzM3NTMyNA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T00:22:05Z","updated_at":"2018-09-21T00:22:05Z","author_association":"MEMBER","body":"This fails on 6.x: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+intake/46/console\r\n\r\n```\r\nFAILURE 1.54s | RecoveryIT.testRecoveryWithConcurrentIndexing <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: \r\n   > Expected: <110>\r\n   >      but: was <60>\r\n   > \tat __randomizedtesting.SeedInfo.seed([AD22BB7534737F0E:2D737F26B6D7A1C4]:0)\r\n   > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n   > \tat org.elasticsearch.upgrades.RecoveryIT.assertCount(RecoveryIT.java:168)\r\n   > \tat org.elasticsearch.upgrades.RecoveryIT.testRecoveryWithConcurrentIndexing(RecoveryIT.java:156)\r\n```\r\n\r\nLog: [testRecoveryWithConcurrentIndexing.txt.zip](https://github.com/elastic/elasticsearch/files/2403473/testRecoveryWithConcurrentIndexing.txt.zip)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423375354","html_url":"https://github.com/elastic/elasticsearch/issues/27650#issuecomment-423375354","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27650","id":423375354,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzM3NTM1NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T00:22:15Z","updated_at":"2018-09-21T00:22:15Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423457580","html_url":"https://github.com/elastic/elasticsearch/issues/27650#issuecomment-423457580","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27650","id":423457580,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzQ1NzU4MA==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T08:33:41Z","updated_at":"2018-09-21T08:33:41Z","author_association":"CONTRIBUTOR","body":"Another failure here: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-unix-compatibility/os=centos/14/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423640355","html_url":"https://github.com/elastic/elasticsearch/issues/27650#issuecomment-423640355","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27650","id":423640355,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzY0MDM1NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-09-21T19:03:11Z","updated_at":"2018-09-21T19:03:11Z","author_association":"MEMBER","body":"I think this has to do with the rollback of the engine on a replica in the case where the new primary was promoted but existing ops don't have seq# (primary was on an old node). In that case, no resync happens and we lose the data that wasn't committed on the replica. I discussed this  @dnhatn and he will work on fixes, but with a lesser priority then CCR. We should consider this a blocker. Marking as such.","performed_via_github_app":null}]