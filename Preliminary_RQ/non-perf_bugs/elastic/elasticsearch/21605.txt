{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21605","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21605/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21605/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21605/events","html_url":"https://github.com/elastic/elasticsearch/issues/21605","id":189860245,"node_id":"MDU6SXNzdWUxODk4NjAyNDU=","number":21605,"title":"Cardinality aggregation of IP address field returns value_as_string formatted as an IP address ","user":{"login":"neuroticnetworks","id":3965137,"node_id":"MDQ6VXNlcjM5NjUxMzc=","avatar_url":"https://avatars0.githubusercontent.com/u/3965137?v=4","gravatar_id":"","url":"https://api.github.com/users/neuroticnetworks","html_url":"https://github.com/neuroticnetworks","followers_url":"https://api.github.com/users/neuroticnetworks/followers","following_url":"https://api.github.com/users/neuroticnetworks/following{/other_user}","gists_url":"https://api.github.com/users/neuroticnetworks/gists{/gist_id}","starred_url":"https://api.github.com/users/neuroticnetworks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/neuroticnetworks/subscriptions","organizations_url":"https://api.github.com/users/neuroticnetworks/orgs","repos_url":"https://api.github.com/users/neuroticnetworks/repos","events_url":"https://api.github.com/users/neuroticnetworks/events{/privacy}","received_events_url":"https://api.github.com/users/neuroticnetworks/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-11-16T21:59:41Z","updated_at":"2016-11-18T13:55:56Z","closed_at":"2016-11-18T13:55:56Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.4.1\r\n\r\n**Plugins installed**: Shield, ES Restlog, Marvel agent, Kopf\r\n\r\n**JVM version**: 1.8.0.60\r\n\r\n**OS version**: Centos\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nIf you run a cardinality aggregation on a IP address field, you get both a(n approximate) distinct count of IP addresses, as well as a `value_as_string` field formatted as an IP address\r\n\r\n**Steps to reproduce**:\r\n 1. execute the following query on an index that contains an IP field (cleverly named `ip`)\r\n\r\n```\r\n{\r\n  \"size\": 0,\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [],\r\n      \"should\": [],\r\n      \"must_not\": [],\r\n      \"filter\": [\r\n        {\r\n          \"range\": {\r\n            \"@timestamp\": {\r\n              \"gte\": \"now-1d/d\",\r\n              \"lt\": \"now/d\"\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  \"aggs\": {\r\n    \"distinct_ips\": {\r\n      \"cardinality\": {\r\n        \"field\": \"ip\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n 2. You will get output that looks something like this:\r\n```\r\n{\r\n    \"_shards\": {\r\n        \"failed\": 0,\r\n        \"successful\": 504,\r\n        \"total\": 504\r\n    },\r\n    \"aggregations\": {\r\n        \"distinct_ips\": {\r\n            \"value\": 6448500,\r\n            \"value_as_string\": \"0.98.101.116\"\r\n        }\r\n    },\r\n    \"hits\": {\r\n        \"hits\": [],\r\n        \"max_score\": 0.0,\r\n        \"total\": 79012098\r\n    },\r\n    \"timed_out\": false,\r\n    \"took\": 1676\r\n}\r\n```\r\n \r\n\r\nNot a huge deal by any means, but wanted to call it to your attention. Timestamps exhibit the same behavior. Strictly numeric fields (ints, floats, etc) do not. ","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}