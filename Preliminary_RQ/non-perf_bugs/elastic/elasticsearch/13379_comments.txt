[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138718973","html_url":"https://github.com/elastic/elasticsearch/issues/13379#issuecomment-138718973","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13379","id":138718973,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODcxODk3Mw==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2015-09-08T22:13:48Z","updated_at":"2015-09-08T22:13:48Z","author_association":"CONTRIBUTOR","body":"I think this is a bug in `InternalEngine.flush()`. When we flush we call `refresh()` and `translog.commit()` in the wrong order here: https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java#L759\nThis leaves a short gap in which we can't get a document from translog and index. \nThe test fails reliable for me but when I switch the order it passes.\nI will work on a unit test and make a pr.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138812717","html_url":"https://github.com/elastic/elasticsearch/issues/13379#issuecomment-138812717","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13379","id":138812717,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODgxMjcxNw==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-09-09T07:34:13Z","updated_at":"2015-09-09T07:34:13Z","author_association":"CONTRIBUTOR","body":"> I think this is a bug in InternalEngine.flush(). When we flush we call refresh() and translog.commit() in the wrong order here:\n\nwhoa!!! good catch we need a get and commit stress test... that reproduces this problem in isolation\n","performed_via_github_app":null}]