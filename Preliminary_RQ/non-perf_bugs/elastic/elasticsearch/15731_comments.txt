[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/168537639","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-168537639","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":168537639,"node_id":"MDEyOklzc3VlQ29tbWVudDE2ODUzNzYzOQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-01-03T20:16:23Z","updated_at":"2016-01-03T20:16:23Z","author_association":"CONTRIBUTOR","body":"Actually this is typically the kind of use-case for which the `avg` aggregation supports scripts. Any reason why you're not happy with scripts?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/168540292","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-168540292","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":168540292,"node_id":"MDEyOklzc3VlQ29tbWVudDE2ODU0MDI5Mg==","user":{"login":"lquerel","id":657994,"node_id":"MDQ6VXNlcjY1Nzk5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/657994?v=4","gravatar_id":"","url":"https://api.github.com/users/lquerel","html_url":"https://github.com/lquerel","followers_url":"https://api.github.com/users/lquerel/followers","following_url":"https://api.github.com/users/lquerel/following{/other_user}","gists_url":"https://api.github.com/users/lquerel/gists{/gist_id}","starred_url":"https://api.github.com/users/lquerel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lquerel/subscriptions","organizations_url":"https://api.github.com/users/lquerel/orgs","repos_url":"https://api.github.com/users/lquerel/repos","events_url":"https://api.github.com/users/lquerel/events{/privacy}","received_events_url":"https://api.github.com/users/lquerel/received_events","type":"User","site_admin":false},"created_at":"2016-01-03T20:56:22Z","updated_at":"2016-01-03T20:56:22Z","author_association":"NONE","body":"The weighted average is equals to sum(value-i \\* weight-i) / sum(weight-i). Value and Weight are dynamic values extracted from a set of documents. Currently the script only returns the value for each document so I don't see any mathematical way to compute easily a weighted average without the weight for each document knowing that currently the result of the script is summed and divided at the end by the number of values (and not the sum of weights). \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169172672","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-169172672","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":169172672,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTE3MjY3Mg==","user":{"login":"lquerel","id":657994,"node_id":"MDQ6VXNlcjY1Nzk5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/657994?v=4","gravatar_id":"","url":"https://api.github.com/users/lquerel","html_url":"https://github.com/lquerel","followers_url":"https://api.github.com/users/lquerel/followers","following_url":"https://api.github.com/users/lquerel/following{/other_user}","gists_url":"https://api.github.com/users/lquerel/gists{/gist_id}","starred_url":"https://api.github.com/users/lquerel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lquerel/subscriptions","organizations_url":"https://api.github.com/users/lquerel/orgs","repos_url":"https://api.github.com/users/lquerel/repos","events_url":"https://api.github.com/users/lquerel/events{/privacy}","received_events_url":"https://api.github.com/users/lquerel/received_events","type":"User","site_admin":false},"created_at":"2016-01-05T23:55:51Z","updated_at":"2016-01-06T00:02:59Z","author_association":"NONE","body":"I sent a pull request with the implementation of the first approach based on the script attribute.\n\nhttps://github.com/elastic/elasticsearch/pull/15781\n\nFor info, this pull request solves this issue too: https://github.com/elastic/elasticsearch/issues/8486\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169476965","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-169476965","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":169476965,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTQ3Njk2NQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T22:03:54Z","updated_at":"2016-01-06T22:03:54Z","author_association":"CONTRIBUTOR","body":"> The weighted average is equals to sum(value-i \\* weight-i) / sum(weight-i). Value and Weight are dynamic values extracted from a set of documents. Currently the script only returns the value for each document so I don't see any mathematical way to compute easily a weighted average without the weight for each document knowing that currently the result of the script is summed and divided at the end by the number of values (and not the sum of weights).\n\nRight, this involves some client-side logic, something like (not tested):\n\n```\n{\n  \"aggs\": {\n    \"weighted_sum\": {\n      \"sum\": {\n        \"script\": {\n          \"inline\": \"doc['value'].value * doc['weight'].value\"\n        }\n      }\n    },\n    \"sum_of_weights\": {\n      \"sum\": {\n        \"field\": \"weight\"\n        }\n      }\n    }\n  }\n}\n```\n\nAnd then you would need to divide the `weighted_sum` value by `sum_of_weights`. I can understand that this is less convenient that that eg you can't use it with kibana so I'm open to discussing adding a way to do weighted averages easily. But I would like to make sure there is enough demand for it before (so that the feature is worth maintaining) and have a discussion about what to do if either the source of values or weights is missing in a document or multi-valued. If we can't come with a nice API then I'd rather not implement the feature. I'll mark this issue as `discuss` so that others chime in.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169499607","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-169499607","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":169499607,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTQ5OTYwNw==","user":{"login":"lquerel","id":657994,"node_id":"MDQ6VXNlcjY1Nzk5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/657994?v=4","gravatar_id":"","url":"https://api.github.com/users/lquerel","html_url":"https://github.com/lquerel","followers_url":"https://api.github.com/users/lquerel/followers","following_url":"https://api.github.com/users/lquerel/following{/other_user}","gists_url":"https://api.github.com/users/lquerel/gists{/gist_id}","starred_url":"https://api.github.com/users/lquerel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lquerel/subscriptions","organizations_url":"https://api.github.com/users/lquerel/orgs","repos_url":"https://api.github.com/users/lquerel/repos","events_url":"https://api.github.com/users/lquerel/events{/privacy}","received_events_url":"https://api.github.com/users/lquerel/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T23:43:18Z","updated_at":"2016-03-01T09:17:53Z","author_association":"NONE","body":"Thank for your response.\n\nWith this approach, how can you order the result of the weighted average? With my proposal it's done directly by the coordinator node with the following query.\n\n```\n{\n  \"aggs\": {\n    \"myAggr\": {\n      \"terms\": {\n        \"field\": \"dimension\",\n        \"order\": { \"weightedAgv\": \"desc\"}\n      },  \n      \"aggs\": {\n          \"weightedAvg\": {\"avg\" : { \"script\" : \"[value: doc['latency'].value, weight: doc['transaction'].value]\" }}\n       }\n    }\n}\n```\n\nExcept if I'm wrong, but with your approach I need to sort client side and means potentially loading a lot of data. Right ? \nIMO it's a second good reason (with kibana) to support this feature natively. I will be very happy to help if needed. \n\nMulti-valued values/weights are implemented in my pull request as follow:\n\n**Standard average**\n\n```\n{ \"avg\" : { \"script\" : \"doc['latency'].value\" }} } \n```\n\nBy default the weight is equals to 1.\n\n**Weighted average (single-valued)**\n\n```\n{ \"avg\" : { \"script\" : \"[value: doc['latency'].value, weight: doc['transaction'].value]\" }}} \n```\n\n**Weighted average (multi-valued)**\n\n```\n{ \"avg\" : { \"script\" : \"[values: doc['latency'].value, weights: doc['transaction'].value]\" }}} \n```\n\nWeights is optional, if not provided then by default weight=1 for each value.\nIf weights.size() < values.size() then by default weight=1 for each value without corresponding weight.\nOtherwise we use the corresponding weight.\n\nGeneral remark: when the weight field is missing in the original doc then by default weight=1.\n\nFor the second approach exposed in my initial proposal, the idea is the same. In the current API the property 'field' is used to identify the value or the list of values used to compute the average. I suggest to introduce an optional property 'weight' to identify the value of the list of values used to determine all weights.\n\nIs it good/general enough to implement the feature? Thanks in advance for your response.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186425342","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-186425342","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":186425342,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjQyNTM0Mg==","user":{"login":"elephantum","id":71321,"node_id":"MDQ6VXNlcjcxMzIx","avatar_url":"https://avatars3.githubusercontent.com/u/71321?v=4","gravatar_id":"","url":"https://api.github.com/users/elephantum","html_url":"https://github.com/elephantum","followers_url":"https://api.github.com/users/elephantum/followers","following_url":"https://api.github.com/users/elephantum/following{/other_user}","gists_url":"https://api.github.com/users/elephantum/gists{/gist_id}","starred_url":"https://api.github.com/users/elephantum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elephantum/subscriptions","organizations_url":"https://api.github.com/users/elephantum/orgs","repos_url":"https://api.github.com/users/elephantum/repos","events_url":"https://api.github.com/users/elephantum/events{/privacy}","received_events_url":"https://api.github.com/users/elephantum/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T21:52:26Z","updated_at":"2016-02-19T21:52:26Z","author_association":"NONE","body":"+1 for any reasonable solution. Weighted average is a common case in any business-related dashboard. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206489094","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-206489094","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":206489094,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjQ4OTA5NA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T17:58:45Z","updated_at":"2016-04-06T17:58:45Z","author_association":"CONTRIBUTOR","body":"Thinking about it a bit more: the only reason to not do it on client side is to be able to order by sub aggregation. However sorting by sub aggregation has the drawback of making counts very inaccurate, I am actually more thinking of deprecating the ability to sort by sub aggregations and by asending count because of that. So I don't think we should add a weighted average aggregation (or add weighting support to the avg agg) just to be able to sort by it.\n\n> If weights.size() < values.size() then by default weight=1 for each value without corresponding weight.\n\nThis won't work since elasticsearch does not maintain the order of values in fielddata: they always come in ascending order. So if your original document has `{value: [5, 1], weight: [2,3]}`, we will actually use a weight of 2 for 1 and 3 for 5.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/228308158","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-228308158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":228308158,"node_id":"MDEyOklzc3VlQ29tbWVudDIyODMwODE1OA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-06-24T10:08:01Z","updated_at":"2016-06-24T10:08:01Z","author_association":"CONTRIBUTOR","body":"We just discussed it in Fixit Friday. We like the feature but would like to verify that there is traction for this feature before implementating it. Also we need to figure out a clear API, especially about what happens with multi-valued fields or missing values.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/228394899","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-228394899","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":228394899,"node_id":"MDEyOklzc3VlQ29tbWVudDIyODM5NDg5OQ==","user":{"login":"lquerel","id":657994,"node_id":"MDQ6VXNlcjY1Nzk5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/657994?v=4","gravatar_id":"","url":"https://api.github.com/users/lquerel","html_url":"https://github.com/lquerel","followers_url":"https://api.github.com/users/lquerel/followers","following_url":"https://api.github.com/users/lquerel/following{/other_user}","gists_url":"https://api.github.com/users/lquerel/gists{/gist_id}","starred_url":"https://api.github.com/users/lquerel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lquerel/subscriptions","organizations_url":"https://api.github.com/users/lquerel/orgs","repos_url":"https://api.github.com/users/lquerel/repos","events_url":"https://api.github.com/users/lquerel/events{/privacy}","received_events_url":"https://api.github.com/users/lquerel/received_events","type":"User","site_admin":false},"created_at":"2016-06-24T16:35:15Z","updated_at":"2016-06-24T16:35:49Z","author_association":"NONE","body":"Good news.\n\nProposal: add a new aggregation to compute weighted average.\n\n```\n{ \n    \"weigthed-avg\" : { \n        \"field-value\" : string,      [mandatory]\n        \"field-weight\": string,     [mandatory]\n        \"missing-value\": int,      [optional, default 0]\n        \"missing-weight\": int     [optional, default 1]\n    } \n}\n```\n\nThe management of multi-values fields was already described before in this thread.\n\nWeighted average computed as: sum(field-value[i] \\* field-weight[i]) / sum(field-weight[i])\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258273101","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-258273101","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":258273101,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODI3MzEwMQ==","user":{"login":"kylevarisco","id":20878374,"node_id":"MDQ6VXNlcjIwODc4Mzc0","avatar_url":"https://avatars2.githubusercontent.com/u/20878374?v=4","gravatar_id":"","url":"https://api.github.com/users/kylevarisco","html_url":"https://github.com/kylevarisco","followers_url":"https://api.github.com/users/kylevarisco/followers","following_url":"https://api.github.com/users/kylevarisco/following{/other_user}","gists_url":"https://api.github.com/users/kylevarisco/gists{/gist_id}","starred_url":"https://api.github.com/users/kylevarisco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kylevarisco/subscriptions","organizations_url":"https://api.github.com/users/kylevarisco/orgs","repos_url":"https://api.github.com/users/kylevarisco/repos","events_url":"https://api.github.com/users/kylevarisco/events{/privacy}","received_events_url":"https://api.github.com/users/kylevarisco/received_events","type":"User","site_admin":false},"created_at":"2016-11-03T21:03:15Z","updated_at":"2016-11-03T21:03:15Z","author_association":"NONE","body":"I'd love to see this in ElasticSearch.  In our business (commodity trading/marketing/logistics), weighted averages are the main metric that we use - weighted average sales prices, weighted average transport costs, etc.  I think this would be a very useful addition - currently we are having to calculate sums in Elastic, and then pull those results to a middle tier where the weighted averages are calculated.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/261781611","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-261781611","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":261781611,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MTc4MTYxMQ==","user":{"login":"smartlocating","id":14272441,"node_id":"MDQ6VXNlcjE0MjcyNDQx","avatar_url":"https://avatars1.githubusercontent.com/u/14272441?v=4","gravatar_id":"","url":"https://api.github.com/users/smartlocating","html_url":"https://github.com/smartlocating","followers_url":"https://api.github.com/users/smartlocating/followers","following_url":"https://api.github.com/users/smartlocating/following{/other_user}","gists_url":"https://api.github.com/users/smartlocating/gists{/gist_id}","starred_url":"https://api.github.com/users/smartlocating/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smartlocating/subscriptions","organizations_url":"https://api.github.com/users/smartlocating/orgs","repos_url":"https://api.github.com/users/smartlocating/repos","events_url":"https://api.github.com/users/smartlocating/events{/privacy}","received_events_url":"https://api.github.com/users/smartlocating/received_events","type":"User","site_admin":false},"created_at":"2016-11-20T14:30:59Z","updated_at":"2016-11-20T14:30:59Z","author_association":"NONE","body":"@lquerel @jpountz what is your current recommendation for getting a single-value weighted average? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264836065","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-264836065","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":264836065,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDgzNjA2NQ==","user":{"login":"hilalgur","id":9599802,"node_id":"MDQ6VXNlcjk1OTk4MDI=","avatar_url":"https://avatars1.githubusercontent.com/u/9599802?v=4","gravatar_id":"","url":"https://api.github.com/users/hilalgur","html_url":"https://github.com/hilalgur","followers_url":"https://api.github.com/users/hilalgur/followers","following_url":"https://api.github.com/users/hilalgur/following{/other_user}","gists_url":"https://api.github.com/users/hilalgur/gists{/gist_id}","starred_url":"https://api.github.com/users/hilalgur/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hilalgur/subscriptions","organizations_url":"https://api.github.com/users/hilalgur/orgs","repos_url":"https://api.github.com/users/hilalgur/repos","events_url":"https://api.github.com/users/hilalgur/events{/privacy}","received_events_url":"https://api.github.com/users/hilalgur/received_events","type":"User","site_admin":false},"created_at":"2016-12-05T11:54:21Z","updated_at":"2016-12-05T11:54:21Z","author_association":"NONE","body":"Hi,\r\nI have same problem. I want to weighted average on ES-5.0.0. I did something:\r\n```\r\nGET titubb56k/ihale/_search \r\n{\r\n  \"aggs\": {\r\n    \"myAggr\": {\r\n      \"terms\": {\r\n        \"field\": \"UrunNo\",\r\n        \"order\": { \"weightedAvg\": \"desc\"}\r\n      },  \r\n      \"aggs\": {\r\n          \"weightedAvg\": { \"avg\" : { \"script\" : \"[values: doc['BirimFiyat'].value, weights: doc['Adet'].value]\" }}\r\n       }    }  }  }\r\n```\r\nand I have error:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"parsing_exception\",\r\n        \"reason\": \"Unexpected token VALUE_STRING [script] in [weightedAvg].\",\r\n        \"line\": 9,\r\n        \"col\": 49\r\n      }\r\n    ],\r\n    \"type\": \"parsing_exception\",\r\n    \"reason\": \"Unexpected token VALUE_STRING [script] in [weightedAvg].\",\r\n    \"line\": 9,\r\n    \"col\": 49\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\nWhat is the problem? Or weighted average is possible on ES-5.0.0","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265416008","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-265416008","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":265416008,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQxNjAwOA==","user":{"login":"hilalgur","id":9599802,"node_id":"MDQ6VXNlcjk1OTk4MDI=","avatar_url":"https://avatars1.githubusercontent.com/u/9599802?v=4","gravatar_id":"","url":"https://api.github.com/users/hilalgur","html_url":"https://github.com/hilalgur","followers_url":"https://api.github.com/users/hilalgur/followers","following_url":"https://api.github.com/users/hilalgur/following{/other_user}","gists_url":"https://api.github.com/users/hilalgur/gists{/gist_id}","starred_url":"https://api.github.com/users/hilalgur/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hilalgur/subscriptions","organizations_url":"https://api.github.com/users/hilalgur/orgs","repos_url":"https://api.github.com/users/hilalgur/repos","events_url":"https://api.github.com/users/hilalgur/events{/privacy}","received_events_url":"https://api.github.com/users/hilalgur/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T10:48:04Z","updated_at":"2016-12-07T10:49:04Z","author_association":"NONE","body":"I did,\r\n```\r\n\r\nPOST ortalama/avg/_search\r\n{\r\n  \"size\": 3,\r\n    \"query\": {\r\n    \"term\": {\r\n      \"IdareKodu\":  \"4\"\r\n      }\r\n    },\r\n\r\n  \"aggs\": {\r\n    \"gunluk_satis\": {\r\n      \"terms\": {\r\n        \"field\": \"IdareKodu\"\r\n      },\r\n      \"aggs\": {\r\n        \"pay\": {\r\n          \"sum\": {\r\n            \"script\": {\r\n              \"lang\": \"expression\",\r\n              \"inline\": \"doc['BirimFiyat'] * doc['Adet']\"\r\n            }\r\n          }\r\n        },\r\n       \r\n        \"payda\": {\r\n          \"sum\": {\r\n            \"script\": {\r\n              \"lang\": \"expression\",\r\n              \"inline\": \"doc['Adet']\"\r\n            }\r\n          }\r\n        },\r\n        \"sonuc\": {\r\n                    \"bucket_script\": {\r\n                        \"buckets_path\": {\r\n                          \"Pay\": \"pay\",\r\n                          \"Payda\": \"payda\"\r\n                        },\r\n                        \"script\": \"params.Pay / params.Payda\"\r\n                    }\r\n                }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n```\r\n\r\nThat worked","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/285272459","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-285272459","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":285272459,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NTI3MjQ1OQ==","user":{"login":"lquerel","id":657994,"node_id":"MDQ6VXNlcjY1Nzk5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/657994?v=4","gravatar_id":"","url":"https://api.github.com/users/lquerel","html_url":"https://github.com/lquerel","followers_url":"https://api.github.com/users/lquerel/followers","following_url":"https://api.github.com/users/lquerel/following{/other_user}","gists_url":"https://api.github.com/users/lquerel/gists{/gist_id}","starred_url":"https://api.github.com/users/lquerel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lquerel/subscriptions","organizations_url":"https://api.github.com/users/lquerel/orgs","repos_url":"https://api.github.com/users/lquerel/repos","events_url":"https://api.github.com/users/lquerel/events{/privacy}","received_events_url":"https://api.github.com/users/lquerel/received_events","type":"User","site_admin":false},"created_at":"2017-03-09T07:05:51Z","updated_at":"2017-03-09T07:05:51Z","author_association":"NONE","body":"@jpountz what is the conclusion?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298375248","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-298375248","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":298375248,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODM3NTI0OA==","user":{"login":"jediwarpraptor","id":17027856,"node_id":"MDQ6VXNlcjE3MDI3ODU2","avatar_url":"https://avatars3.githubusercontent.com/u/17027856?v=4","gravatar_id":"","url":"https://api.github.com/users/jediwarpraptor","html_url":"https://github.com/jediwarpraptor","followers_url":"https://api.github.com/users/jediwarpraptor/followers","following_url":"https://api.github.com/users/jediwarpraptor/following{/other_user}","gists_url":"https://api.github.com/users/jediwarpraptor/gists{/gist_id}","starred_url":"https://api.github.com/users/jediwarpraptor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jediwarpraptor/subscriptions","organizations_url":"https://api.github.com/users/jediwarpraptor/orgs","repos_url":"https://api.github.com/users/jediwarpraptor/repos","events_url":"https://api.github.com/users/jediwarpraptor/events{/privacy}","received_events_url":"https://api.github.com/users/jediwarpraptor/received_events","type":"User","site_admin":false},"created_at":"2017-05-01T17:04:54Z","updated_at":"2017-05-01T17:04:54Z","author_association":"NONE","body":"Any update on a native-ish weighted Average?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/318753341","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-318753341","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":318753341,"node_id":"MDEyOklzc3VlQ29tbWVudDMxODc1MzM0MQ==","user":{"login":"darrencruse","id":1283688,"node_id":"MDQ6VXNlcjEyODM2ODg=","avatar_url":"https://avatars3.githubusercontent.com/u/1283688?v=4","gravatar_id":"","url":"https://api.github.com/users/darrencruse","html_url":"https://github.com/darrencruse","followers_url":"https://api.github.com/users/darrencruse/followers","following_url":"https://api.github.com/users/darrencruse/following{/other_user}","gists_url":"https://api.github.com/users/darrencruse/gists{/gist_id}","starred_url":"https://api.github.com/users/darrencruse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darrencruse/subscriptions","organizations_url":"https://api.github.com/users/darrencruse/orgs","repos_url":"https://api.github.com/users/darrencruse/repos","events_url":"https://api.github.com/users/darrencruse/events{/privacy}","received_events_url":"https://api.github.com/users/darrencruse/received_events","type":"User","site_admin":false},"created_at":"2017-07-28T20:24:08Z","updated_at":"2017-07-28T20:24:08Z","author_association":"NONE","body":"Just a note that I'm disappointed this hasn't made it in - I'm working for an agriculture company and it's common to do calculations that are weighted by the area of farmers fields.\r\n\r\ni.e. the search is matching attributes in the indexed documents (representing fields) to select a subset of all possible fields, and the field documents have other values to average, along with the area of each field.  So the goal is to do averages on the values weighting them more for bigger fields and less for smaller fields, with different searches used for the selection (might be region of the country, type of crop being grown etc. etc).\r\n\r\n(giving the detail JIC there's still a thought this isn't a common need - maybe I'm biased because of my problem but I think this really *is* a common need, and also hoping feedback if people think this can be done client side - I've racked my brain about this and I don't see how it can be?) \r\n\r\nAnyway I'd gotten a little excited that I'd landed on the \"bucket_script\" solution like @hilalgur showed above.\r\n\r\nThen disappointed again when it seems there no way to get a Kibana visualization to use a query that needs a \"bucket_script\" (seems it only supports plain \"script\" and it seems to *have* to generate the ES query itself it doesn't seem possible to completely tell it the ES query you want it to use AFAICT).\r\n\r\natm I'm thinking we might have to ditch Kibana and go with doing charts ourself atop the ES queries which use \"bucket_script\".   Seems ashame though Kibana seems pretty nice in a lot of ways otherwise.\r\n\r\n \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/331036363","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-331036363","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":331036363,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMTAzNjM2Mw==","user":{"login":"jdimeo","id":1071438,"node_id":"MDQ6VXNlcjEwNzE0Mzg=","avatar_url":"https://avatars0.githubusercontent.com/u/1071438?v=4","gravatar_id":"","url":"https://api.github.com/users/jdimeo","html_url":"https://github.com/jdimeo","followers_url":"https://api.github.com/users/jdimeo/followers","following_url":"https://api.github.com/users/jdimeo/following{/other_user}","gists_url":"https://api.github.com/users/jdimeo/gists{/gist_id}","starred_url":"https://api.github.com/users/jdimeo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdimeo/subscriptions","organizations_url":"https://api.github.com/users/jdimeo/orgs","repos_url":"https://api.github.com/users/jdimeo/repos","events_url":"https://api.github.com/users/jdimeo/events{/privacy}","received_events_url":"https://api.github.com/users/jdimeo/received_events","type":"User","site_admin":false},"created_at":"2017-09-21T02:52:20Z","updated_at":"2017-09-21T02:52:20Z","author_association":"NONE","body":"I'm interested from the perspective of downsampling old documents. If, for example, I'm dropping 99 out of 100 documents > 1 year old, 9 out of 10 > 6 months old, and all documents < 6 months old, I would love it if I could configure aggregations (including but not limited to average) to appropriately weight the old documents x100 or x10 so that I can re-create the original counts with some margin of error/approximation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/331906082","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-331906082","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":331906082,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMTkwNjA4Mg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T14:50:29Z","updated_at":"2017-09-25T14:50:29Z","author_association":"CONTRIBUTOR","body":"I think it's becoming obvious that there is traction for this feature, so let's give it a try? Let's just make sure that the documentation is clear as to how the weight is computed in case of missing values or multiple values.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/331907614","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-331907614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":331907614,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMTkwNzYxNA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T14:55:17Z","updated_at":"2017-09-25T14:55:17Z","author_association":"CONTRIBUTOR","body":"As far as I'm concerned, I'd like it to be a new aggregation rather than adding options to the `avg` aggregation, as well as clearly separating options that applies to values from those that apply to the weight, eg.\r\n\r\n```\r\n{\r\n  \"weighted_average\": {\r\n    \"weight\": {\r\n      \"field\": \"w\",\r\n      \"mode\": \"min\",\r\n      \"missing\": 1\r\n    },\r\n    \"values\": {\r\n      \"field\": \"poularity\"\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/338526285","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-338526285","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":338526285,"node_id":"MDEyOklzc3VlQ29tbWVudDMzODUyNjI4NQ==","user":{"login":"cicisoso","id":3799302,"node_id":"MDQ6VXNlcjM3OTkzMDI=","avatar_url":"https://avatars2.githubusercontent.com/u/3799302?v=4","gravatar_id":"","url":"https://api.github.com/users/cicisoso","html_url":"https://github.com/cicisoso","followers_url":"https://api.github.com/users/cicisoso/followers","following_url":"https://api.github.com/users/cicisoso/following{/other_user}","gists_url":"https://api.github.com/users/cicisoso/gists{/gist_id}","starred_url":"https://api.github.com/users/cicisoso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cicisoso/subscriptions","organizations_url":"https://api.github.com/users/cicisoso/orgs","repos_url":"https://api.github.com/users/cicisoso/repos","events_url":"https://api.github.com/users/cicisoso/events{/privacy}","received_events_url":"https://api.github.com/users/cicisoso/received_events","type":"User","site_admin":false},"created_at":"2017-10-23T01:37:02Z","updated_at":"2017-10-23T01:37:02Z","author_association":"NONE","body":"any plan updated about weighted average?  @jpountz  will you put this feature in next release? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/338564074","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-338564074","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":338564074,"node_id":"MDEyOklzc3VlQ29tbWVudDMzODU2NDA3NA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-10-23T06:55:04Z","updated_at":"2017-10-23T06:55:04Z","author_association":"CONTRIBUTOR","body":"> any plan updated about weighted average?\r\n\r\nIt's currently labelled as an `adoptme` meaning it is waiting for someone to pick it up.\r\n\r\n> will you put this feature in next release?\r\n\r\nProbably not.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356435340","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-356435340","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":356435340,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NjQzNTM0MA==","user":{"login":"rsmything","id":11719983,"node_id":"MDQ6VXNlcjExNzE5OTgz","avatar_url":"https://avatars0.githubusercontent.com/u/11719983?v=4","gravatar_id":"","url":"https://api.github.com/users/rsmything","html_url":"https://github.com/rsmything","followers_url":"https://api.github.com/users/rsmything/followers","following_url":"https://api.github.com/users/rsmything/following{/other_user}","gists_url":"https://api.github.com/users/rsmything/gists{/gist_id}","starred_url":"https://api.github.com/users/rsmything/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rsmything/subscriptions","organizations_url":"https://api.github.com/users/rsmything/orgs","repos_url":"https://api.github.com/users/rsmything/repos","events_url":"https://api.github.com/users/rsmything/events{/privacy}","received_events_url":"https://api.github.com/users/rsmything/received_events","type":"User","site_admin":false},"created_at":"2018-01-09T22:29:30Z","updated_at":"2018-01-09T22:29:30Z","author_association":"NONE","body":"Anyone can help to calculate weighted mean based on the count of each value as the weight\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356496545","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-356496545","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":356496545,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NjQ5NjU0NQ==","user":{"login":"viranch","id":302106,"node_id":"MDQ6VXNlcjMwMjEwNg==","avatar_url":"https://avatars1.githubusercontent.com/u/302106?v=4","gravatar_id":"","url":"https://api.github.com/users/viranch","html_url":"https://github.com/viranch","followers_url":"https://api.github.com/users/viranch/followers","following_url":"https://api.github.com/users/viranch/following{/other_user}","gists_url":"https://api.github.com/users/viranch/gists{/gist_id}","starred_url":"https://api.github.com/users/viranch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/viranch/subscriptions","organizations_url":"https://api.github.com/users/viranch/orgs","repos_url":"https://api.github.com/users/viranch/repos","events_url":"https://api.github.com/users/viranch/events{/privacy}","received_events_url":"https://api.github.com/users/viranch/received_events","type":"User","site_admin":false},"created_at":"2018-01-10T04:28:25Z","updated_at":"2018-01-10T04:28:25Z","author_association":"NONE","body":"I'm also interested in downsampling my documents like @jdimeo but need weighted average.\r\n\r\n@jdimeo were you able to build a work around? I'm thinking of writing a middleware that will calculate weighted average from counts stored with the downsampled documents.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356529945","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-356529945","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":356529945,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NjUyOTk0NQ==","user":{"login":"rsmything","id":11719983,"node_id":"MDQ6VXNlcjExNzE5OTgz","avatar_url":"https://avatars0.githubusercontent.com/u/11719983?v=4","gravatar_id":"","url":"https://api.github.com/users/rsmything","html_url":"https://github.com/rsmything","followers_url":"https://api.github.com/users/rsmything/followers","following_url":"https://api.github.com/users/rsmything/following{/other_user}","gists_url":"https://api.github.com/users/rsmything/gists{/gist_id}","starred_url":"https://api.github.com/users/rsmything/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rsmything/subscriptions","organizations_url":"https://api.github.com/users/rsmything/orgs","repos_url":"https://api.github.com/users/rsmything/repos","events_url":"https://api.github.com/users/rsmything/events{/privacy}","received_events_url":"https://api.github.com/users/rsmything/received_events","type":"User","site_admin":false},"created_at":"2018-01-10T08:10:30Z","updated_at":"2018-01-10T08:10:30Z","author_association":"NONE","body":"Please help to make right aggregation\r\n\r\n> \r\nInvalid pipeline aggregation named [weighted_mean] of type [bucket_script]. Only sibling pipeline aggregations are allowed at the top level\r\n\r\n\r\n```\r\n{\r\n  \"size\": 0,\r\n  \"aggs\": {\r\n    \"overall\": {\r\n      \"terms\": {\r\n        \"field\": \"days\",\r\n      },\r\n      \"aggs\": {\r\n        \"summary\": {\r\n          \"sum\": {\r\n            \"script\": {\r\n              lang: \"expression\",\r\n              inline: \"doc['days'] * _score\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"total\": {\r\n      sum_bucket: {\r\n        \"buckets_path\": \"overall>summary\"\r\n      }\r\n    },\r\n    \"count\": {\r\n      value_count: {\r\n        \"script\": {\r\n          \"source\": \"doc['days'].value\"\r\n        }\r\n      }\r\n    },\r\n    \"weighted_mean\": {\r\n      \"bucket_script\": {\r\n        \"buckets_path\": {\r\n          \"Total\": \"total\",\r\n          \"Count\": \"count\"\r\n        },\r\n        \"script\": \"params.Total / params.Count\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356603926","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-356603926","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":356603926,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NjYwMzkyNg==","user":{"login":"jdimeo","id":1071438,"node_id":"MDQ6VXNlcjEwNzE0Mzg=","avatar_url":"https://avatars0.githubusercontent.com/u/1071438?v=4","gravatar_id":"","url":"https://api.github.com/users/jdimeo","html_url":"https://github.com/jdimeo","followers_url":"https://api.github.com/users/jdimeo/followers","following_url":"https://api.github.com/users/jdimeo/following{/other_user}","gists_url":"https://api.github.com/users/jdimeo/gists{/gist_id}","starred_url":"https://api.github.com/users/jdimeo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdimeo/subscriptions","organizations_url":"https://api.github.com/users/jdimeo/orgs","repos_url":"https://api.github.com/users/jdimeo/repos","events_url":"https://api.github.com/users/jdimeo/events{/privacy}","received_events_url":"https://api.github.com/users/jdimeo/received_events","type":"User","site_admin":false},"created_at":"2018-01-10T13:36:22Z","updated_at":"2018-01-10T13:36:22Z","author_association":"NONE","body":"@viranch no workaround, sorry- we're just not implementing downsampling for now","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372630301","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-372630301","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":372630301,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjYzMDMwMQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T11:13:42Z","updated_at":"2018-03-13T11:13:42Z","author_association":"MEMBER","body":"@elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416391371","html_url":"https://github.com/elastic/elasticsearch/issues/15731#issuecomment-416391371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15731","id":416391371,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjM5MTM3MQ==","user":{"login":"lquerel","id":657994,"node_id":"MDQ6VXNlcjY1Nzk5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/657994?v=4","gravatar_id":"","url":"https://api.github.com/users/lquerel","html_url":"https://github.com/lquerel","followers_url":"https://api.github.com/users/lquerel/followers","following_url":"https://api.github.com/users/lquerel/following{/other_user}","gists_url":"https://api.github.com/users/lquerel/gists{/gist_id}","starred_url":"https://api.github.com/users/lquerel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lquerel/subscriptions","organizations_url":"https://api.github.com/users/lquerel/orgs","repos_url":"https://api.github.com/users/lquerel/repos","events_url":"https://api.github.com/users/lquerel/events{/privacy}","received_events_url":"https://api.github.com/users/lquerel/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T22:37:00Z","updated_at":"2018-08-27T22:37:00Z","author_association":"NONE","body":"Happy to see that you finally integrated this feature.","performed_via_github_app":null}]