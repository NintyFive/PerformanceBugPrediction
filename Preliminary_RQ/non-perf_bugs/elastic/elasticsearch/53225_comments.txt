[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/595803304","html_url":"https://github.com/elastic/elasticsearch/issues/53225#issuecomment-595803304","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53225","id":595803304,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTgwMzMwNA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-03-06T14:53:55Z","updated_at":"2020-03-06T14:53:55Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/CCR)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/597420120","html_url":"https://github.com/elastic/elasticsearch/issues/53225#issuecomment-597420120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53225","id":597420120,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NzQyMDEyMA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2020-03-11T03:03:03Z","updated_at":"2020-03-11T03:03:03Z","author_association":"MEMBER","body":"```\r\n  2> mar 06, 2020 5:25:28 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n  2> WARNING: Uncaught exception in thread: Thread[elasticsearch[followerd3][ccr][T#22],5,TGRP-IndexFollowingIT]\r\n  2> org.elasticsearch.transport.NoSuchRemoteClusterException: no such remote cluster: [leader_cluster]\r\n  2> \tat __randomizedtesting.SeedInfo.seed([6CB3F4DF8251DFB5]:0)\r\n  2> \tat org.elasticsearch.transport.RemoteClusterService.getRemoteClusterConnection(RemoteClusterService.java:205)\r\n  2> \tat org.elasticsearch.transport.RemoteClusterService.ensureConnected(RemoteClusterService.java:188)\r\n  2> \tat org.elasticsearch.transport.RemoteClusterAwareClient.doExecute(RemoteClusterAwareClient.java:48)\r\n  2> \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:377)\r\n  2> \tat org.elasticsearch.client.support.AbstractClient$ClusterAdmin.execute(AbstractClient.java:661)\r\n  2> \tat org.elasticsearch.client.support.AbstractClient$ClusterAdmin.state(AbstractClient.java:691)\r\n  2> \tat org.elasticsearch.xpack.ccr.action.CcrRequests.getIndexMetadata(CcrRequests.java:59)\r\n  2> \tat org.elasticsearch.xpack.ccr.action.ShardFollowTasksExecutor$1.innerUpdateMapping(ShardFollowTasksExecutor.java:144)\r\n  2> \tat org.elasticsearch.xpack.ccr.action.ShardFollowNodeTask.updateMapping(ShardFollowNodeTask.java:481)\r\n  2> \tat org.elasticsearch.xpack.ccr.action.ShardFollowNodeTask.lambda$updateMapping$17(ShardFollowNodeTask.java:482)\r\n  2> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:688)\r\n  2> \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n  2> \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n```\r\n\r\nI will take a closer look tomorrow.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/653551477","html_url":"https://github.com/elastic/elasticsearch/issues/53225#issuecomment-653551477","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53225","id":653551477,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzU1MTQ3Nw==","user":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"created_at":"2020-07-03T13:33:50Z","updated_at":"2020-07-03T14:33:22Z","author_association":"CONTRIBUTOR","body":"@dnhatn by any chance this was not backported to 6.8 ? Do you think it is worth a backport?\r\nthere was a very similar failure in that test on that branch\r\n```\r\njava.lang.AssertionError: incorrect global checkpoint {\"remote_cluster\":\"leader_cluster\",\"follow_shard_index\":\"index2\",\"follow_shard_index_uuid\":\"6PI3qVcLS12o7i-_cGFeEw\",\"follow_shard_shard\":1,\"leader_shard_index\":\"index1\",\"leader_shard_index_uuid\":\"OiYzpvIbThCOK_FB8uuSCA\",\"leader_shard_shard\":1,\"max_read_request_operation_count\":9016,\"max_write_request_operation_count\":5120,\"max_outstanding_read_requests\":12,\"max_outstanding_write_requests\":9,\"max_read_request_size\":\"30573350b\",\"max_write_request_size\":\"9223372036854775807b\",\"max_write_buffer_count\":2147483647,\"max_write_buffer_size\":\"512mb\",\"max_retry_delay\":\"10ms\",\"read_poll_timeout\":\"10ms\",\"headers\":{}}\r\nExpected: <171L>\r\n     but: was <-1L>\r\n\tat __randomizedtesting.SeedInfo.seed([3C886A4EEAD67EB9:FA33AFE3CB28BE11]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.elasticsearch.xpack.ccr.IndexFollowingIT.lambda$assertTask$53(IndexFollowingIT.java:1386)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:906)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:880)\r\n\tat org.elasticsearch.xpack.ccr.IndexFollowingIT.testUpdateRemoteConfigsDuringFollowing(IndexFollowingIT.java:1257)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:567)\r\n```\r\nhttps://gradle-enterprise.elastic.co/s/ysedpzc6m6ilc\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew ':x-pack:plugin:ccr:internalClusterTest' \\\r\n  -Dtests.seed=3C886A4EEAD67EB9 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.IndexFollowingIT \\\r\n  -Dtests.method=\"testUpdateRemoteConfigsDuringFollowing\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ro \\\r\n  -Dtests.timezone=SystemV/PST8PDT \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=12\r\n```\r\n\r\ninterestingly `SystemV/PST8PDT` is used. This is 6.8 so I guess joda is used, which does not support that timezone (it is only supported by java.time).\r\ncould this be that there are nodes in 7 and 6.8 in this test?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/653713128","html_url":"https://github.com/elastic/elasticsearch/issues/53225#issuecomment-653713128","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53225","id":653713128,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzcxMzEyOA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2020-07-04T03:02:51Z","updated_at":"2020-07-04T03:02:51Z","author_association":"MEMBER","body":"I think this is the reason. I will work on a fix.\r\n\r\n>   1> [2020-07-03T06:09:36,080][WARN ][o.e.x.c.a.ShardFollowNodeTask] [followerd3] shard follow task encounter non-retryable error\r\n  1> java.util.concurrent.RejectedExecutionException: connect queue is full\r\n  1> \tat org.elasticsearch.transport.RemoteClusterConnection$ConnectHandler.connect(RemoteClusterConnection.java:445) [elasticsearch-6.8.11-SNAPSHOT.jar:6.8.11-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.RemoteClusterConnection$ConnectHandler.connect(RemoteClusterConnection.java:427) [elasticsearch-6.8.11-SNAPSHOT.jar:6.8.11-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.RemoteClusterConnection.ensureConnected(RemoteClusterConnection.java:221) [elasticsearch-6.8.11-SNAPSHOT.jar:6.8.11-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.RemoteClusterService.ensureConnected(RemoteClusterService.java:393) [elasticsearch-6.8.11-SNAPSHOT.jar:6.8.11-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.RemoteClusterAwareClient.doExecute(RemoteClusterAwareClient.java:50) [elasticsearch-6.8.11-SNAPSHOT.jar:6.8.11-SNAPSHOT]\r\n  1> \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:403) [elasticsearch-6.8.11-SNAPSHOT.jar:6.8.11-SNAPSHOT]\r\n  1> \tat org.elasticsearch.xpack.ccr.action.ShardFollowTasksExecutor$1.innerSendShardChangesRequest(ShardFollowTasksExecutor.java:267) [main/:?]\r\n  1> \tat org.elasticsearch.xpack.ccr.action.ShardFollowNodeTask.sendShardChangesRequest(ShardFollowNodeTask.java:289) [main/:?]\r\n  1> \tat org.elasticsearch.xpack.ccr.action.ShardFollowNodeTask.lambda$sendShardChangesRequest$4(ShardFollowNodeTask.java:320) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [elasticsearch-6.8.11-SNAPSHOT.jar:6.8.11-SNAPSHOT]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n  1> \tat java.lang.Thread.run(Thread.java:835) [?:?]","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/653804815","html_url":"https://github.com/elastic/elasticsearch/issues/53225#issuecomment-653804815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53225","id":653804815,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzgwNDgxNQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2020-07-04T19:53:31Z","updated_at":"2020-07-04T19:53:31Z","author_association":"MEMBER","body":"I've opened https://github.com/elastic/elasticsearch/pull/59036.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/655261541","html_url":"https://github.com/elastic/elasticsearch/issues/53225#issuecomment-655261541","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53225","id":655261541,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTI2MTU0MQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2020-07-08T03:32:36Z","updated_at":"2020-07-08T03:32:36Z","author_association":"MEMBER","body":"Fixed in https://github.com/elastic/elasticsearch/pull/59036.","performed_via_github_app":null}]