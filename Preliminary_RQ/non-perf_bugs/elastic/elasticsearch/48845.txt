{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48845","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48845/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48845/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48845/events","html_url":"https://github.com/elastic/elasticsearch/issues/48845","id":517148196,"node_id":"MDU6SXNzdWU1MTcxNDgxOTY=","number":48845,"title":"Score with too many digits gets scrambled in last places","user":{"login":"JanecekJ","id":18347353,"node_id":"MDQ6VXNlcjE4MzQ3MzUz","avatar_url":"https://avatars2.githubusercontent.com/u/18347353?v=4","gravatar_id":"","url":"https://api.github.com/users/JanecekJ","html_url":"https://github.com/JanecekJ","followers_url":"https://api.github.com/users/JanecekJ/followers","following_url":"https://api.github.com/users/JanecekJ/following{/other_user}","gists_url":"https://api.github.com/users/JanecekJ/gists{/gist_id}","starred_url":"https://api.github.com/users/JanecekJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JanecekJ/subscriptions","organizations_url":"https://api.github.com/users/JanecekJ/orgs","repos_url":"https://api.github.com/users/JanecekJ/repos","events_url":"https://api.github.com/users/JanecekJ/events{/privacy}","received_events_url":"https://api.github.com/users/JanecekJ/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"assignees":[{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-11-04T13:21:24Z","updated_at":"2019-11-21T13:53:57Z","closed_at":"2019-11-21T13:53:57Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 7.4.2\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** : 1.8.0_221\r\n\r\n**OS version** : 18.04.2-Ubuntu\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nUsing elasticsearch 7.4.2 we encountered a strange behavior.\r\nWhile using function_score query with [script_score](https://www.elastic.co/guide/en/elasticsearch/reference/7.4/query-dsl-function-score-query.html#function-script-score) and resulting score with many digits, the final score is changed from the number returned  by script.\r\n\r\nExpected result: 1234567890\r\nActual result: 1.23456794E9\r\n\r\nThe problem is the last digits change from **890** to **940**.\r\n\r\nIs it possible, that between the calculation of score and final result, the score is temporarily stored in, for example, float field, causing a loss of precision?\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Create index:\r\nPUT /test\r\n```\r\n{\r\n    \"settings\" : {\r\n        \"number_of_shards\" : 1,\r\n        \"number_of_replicas\" : 1\r\n    }\r\n}\r\n```\r\n\r\n 2. Index items:\r\n```\r\nPOST /test/_doc/\r\n{\r\n    \"user\" : \"kimchy\",\r\n    \"post_date\" : \"2009-11-15T14:12:12\",\r\n    \"message\" : \"trying out Elasticsearch\"\r\n}\r\n\r\nPOST /test/_doc/\r\n{\r\n    \"user\" : \"kimchy 2\",\r\n    \"post_date\" : \"2010-11-15T14:12:12\",\r\n    \"message\" : \"trying out Elasticsearchanother time\"\r\n}\r\n```\r\n\r\n 3. Query search:\r\n```\r\nGET /test/_search\r\n{\r\n    \"explain\": true,\r\n    \"size\": 5,\r\n    \"query\": {\r\n        \"function_score\": {\r\n            \"query\": {\r\n                \"match_all\": {}\r\n            },\r\n            \"script_score\" : {\r\n                \"script\" : {\r\n                  \"inline\": \"1234567890\"\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n4. Results in:\r\nThe first hit\r\n<pre>\r\n\"max_score\": 1.23456794E9,\r\n\"hits\": [\r\n    {\r\n        \"_shard\": \"[test][0]\",\r\n        \"_node\": \"hBT4HfzdSX6QKBBHpkdmKA\",\r\n        \"_index\": \"test\",\r\n        \"_type\": \"_doc\",\r\n        \"_id\": \"zl9QNm4BspuaxsAfOjks\",\r\n        \"_score\": <b>1.23456794E9</b>,\r\n        \"_source\": {\r\n            \"user\": \"kimchy\",\r\n            \"post_date\": \"2009-11-15T14:12:12\",\r\n            \"message\": \"trying out Elasticsearch\"\r\n        },\r\n        \"_explanation\": {\r\n            \"value\": <b>1.23456794E9</b>,\r\n            \"description\": \"function score, product of:\",\r\n            \"details\": [\r\n                {\r\n                    \"value\": 1.0,\r\n                    \"description\": \"*:*\",\r\n                    \"details\": []\r\n                },\r\n                {\r\n                    \"value\": <b>1.23456794E9</b>,\r\n                    \"description\": \"min of:\",\r\n                    \"details\": [\r\n                        {\r\n                            \"value\": <b>1.23456794E9</b>,\r\n                            \"description\": \"script score function, computed with script:\\\"Script{type=inline, lang='painless', idOrCode='<b>1234567890</b>', options={}, params={}}\\\"\",\r\n                            \"details\": [\r\n                                {\r\n                                    \"value\": 1.0,\r\n                                    \"description\": \"_score: \",\r\n                                    \"details\": [\r\n                                        {\r\n                                            \"value\": 1.0,\r\n                                            \"description\": \"*:*\",\r\n                                            \"details\": []\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"value\": 3.4028235E38,\r\n                            \"description\": \"maxBoost\",\r\n                            \"details\": []\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        }\r\n    }\r\n</pre>\r\n","closed_by":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"performed_via_github_app":null}