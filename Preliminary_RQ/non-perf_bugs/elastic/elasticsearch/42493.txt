{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42493","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42493/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42493/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42493/events","html_url":"https://github.com/elastic/elasticsearch/issues/42493","id":448051166,"node_id":"MDU6SXNzdWU0NDgwNTExNjY=","number":42493,"title":"Elasticsearch plugins can no longer define sibiling pipeline aggregator","user":{"login":"tools4origins","id":8068386,"node_id":"MDQ6VXNlcjgwNjgzODY=","avatar_url":"https://avatars1.githubusercontent.com/u/8068386?v=4","gravatar_id":"","url":"https://api.github.com/users/tools4origins","html_url":"https://github.com/tools4origins","followers_url":"https://api.github.com/users/tools4origins/followers","following_url":"https://api.github.com/users/tools4origins/following{/other_user}","gists_url":"https://api.github.com/users/tools4origins/gists{/gist_id}","starred_url":"https://api.github.com/users/tools4origins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tools4origins/subscriptions","organizations_url":"https://api.github.com/users/tools4origins/orgs","repos_url":"https://api.github.com/users/tools4origins/repos","events_url":"https://api.github.com/users/tools4origins/events{/privacy}","received_events_url":"https://api.github.com/users/tools4origins/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2019-05-24T08:48:39Z","updated_at":"2019-10-10T16:59:08Z","closed_at":"2019-06-05T19:18:24Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** : v7.0.1, v7.1.0\r\n**Plugins installed**: []\r\n**JVM version** (`java -version`): Any\r\n**OS version** (`uname -a` if on a Unix-like system): Any\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nSince the PR https://github.com/elastic/elasticsearch/pull/34658 it no longer is possible to define a custom sibling pipeline aggregation as all SiblingPipelineAggregator constructors are package-private.\r\n\r\nA plugin we developed add such metrics in ES 5 and ES 6, unfortunately because of this change we cannot adapt the code for ES 7.\r\n\r\nMy guess is that the constructor accessibility change was done without having plugin development in mind (tagging you @polyfractal as, as the author of the PR, you may be able to confirm that?).\r\n\r\nCould it be set back to public?\r\n\r\nSimilar limitations are caused by package-private constructors and final methods in the org.elasticsearch.search.aggregations module. Those one can be bypassed by duplicating code instead of inheriting.\r\n\r\nThe issue with SiblingPipelineAggregator is that there is [a check in aggregation phase](https://github.com/elastic/elasticsearch/blob/c1de8c29db228bb633f6766684874ed3321d7200/server/src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java#L138\r\n) that specifically check `pipelineAggregator instanceof SiblingPipelineAggregator` so we must inherit SiblingPipelineAggregator to define a sibling pipeline aggregator. But we no longer can :(.\r\n\r\nWe would highly appreciate a accessibility change for SiblingPipelineAggregator constructors, I assume for other constructors and final method the design has more reasons to exist and it doesn't restrict us even though it make our code a bit uglier.\r\n\r\n**Steps to reproduce**:\r\n\r\nWith this class defined:\r\n```\r\npackage com.organization.customplugin.elasticsearch.search.aggregations.pipeline;\r\n\r\nimport org.elasticsearch.search.aggregations.pipeline.SiblingPipelineAggregator;\r\n\r\nimport java.util.Map;\r\n\r\n\r\npublic abstract class PublicSiblingPipelineAggregator extends SiblingPipelineAggregator {\r\n    PublicSiblingPipelineAggregator(String name, String[] bucketsPaths, Map<String, Object> metaData) {\r\n        super(name, bucketsPaths, metaData);\r\n    }\r\n}\r\n```\r\n\r\nThis compilation error is raised:\r\n`error: PublicSiblingPipelineAggregator(String,String[],Map<String,Object>) is not public in PublicSiblingPipelineAggregator; cannot be accessed from outside package\r\n`\r\n\r\nDependencies:\r\n\r\n```\r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>org.elasticsearch</groupId>\r\n            <artifactId>elasticsearch</artifactId>\r\n            <version>7.1.0</version>\r\n            <scope>compile</scope>\r\n        </dependency>\r\n    </dependencies>\r\n```","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}