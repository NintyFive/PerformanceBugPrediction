[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53070931","html_url":"https://github.com/elastic/elasticsearch/issues/7391#issuecomment-53070931","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7391","id":53070931,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDcwOTMx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-08-22T14:58:59Z","updated_at":"2014-08-22T14:58:59Z","author_association":"CONTRIBUTOR","body":"Hi @hxuanji \n\nYou are, unfortunately, correct. The WDF does generate new positions, which breaks the token filter contract.  This is how it is in Lucene and currently there are no plans to change this in Lucene.\n\nYou can't use phrase queries with WDF.\n\nYou may be able to achieve what you want with the [pattern capture](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/analysis-pattern-capture-tokenfilter.html#analysis-pattern-capture-tokenfilter) instead.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53247771","html_url":"https://github.com/elastic/elasticsearch/issues/7391#issuecomment-53247771","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7391","id":53247771,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjQ3Nzcx","user":{"login":"hxuanji","id":4996057,"node_id":"MDQ6VXNlcjQ5OTYwNTc=","avatar_url":"https://avatars0.githubusercontent.com/u/4996057?v=4","gravatar_id":"","url":"https://api.github.com/users/hxuanji","html_url":"https://github.com/hxuanji","followers_url":"https://api.github.com/users/hxuanji/followers","following_url":"https://api.github.com/users/hxuanji/following{/other_user}","gists_url":"https://api.github.com/users/hxuanji/gists{/gist_id}","starred_url":"https://api.github.com/users/hxuanji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hxuanji/subscriptions","organizations_url":"https://api.github.com/users/hxuanji/orgs","repos_url":"https://api.github.com/users/hxuanji/repos","events_url":"https://api.github.com/users/hxuanji/events{/privacy}","received_events_url":"https://api.github.com/users/hxuanji/received_events","type":"User","site_admin":false},"created_at":"2014-08-25T10:09:49Z","updated_at":"2014-08-25T10:09:49Z","author_association":"NONE","body":"Hi @clintongormley,\n\nI have another question about it. Assume I modify the setting of the filters into:\n\n```\n\"dot_delimiter\":\n                    {\n                        \"type\" : \"pattern_capture\",\n                        \"preserve_original\" : 1,\n                        \"patterns\" : [\n                          \"([\\\\p{Ll}\\\\p{Lu}]+\\\\d*|\\\\d+)\"\n                       ]\n                    },\n                    \"words_delimiter\":\n                    {\n                        \"type\" : \"pattern_capture\",\n                        \"preserve_original\" : 1,\n                        \"patterns\" : [\n                          \"(\\\\p{Ll}+|\\\\p{Lt}+|\\\\p{Lu}+\\\\p{Ll}+|\\\\p{Lu}+)\",\n                          \"(\\\\d+)\"\n                       ]\n                    }\n```\n\nNow, the token position should be the same. \nNow if I got the document:\n\n```\n{\"name\": \"942430__n.jpg\"}\n```\n\nIts token result of the two analyzers would be\n\n```\nfielda_index    942430__n.jpg(1) 942430(1) n(1) jpg(1)\nfielda_search   942430__n.jpg(1) 942430(1) n(1) jpg(1)\n```\n\nAs we see, the token positions are all located at pos 1. \nBut under this situation, I use the command: \n\n```\n{\"from\": 0, \"size\": 100, \"query\":{\"match\": {\"name\":{\"query\":\"942430__n.jpg\", \"operator\" : \"and\"}}}}\n```\n\nto query, but why does the result are included some documents whose tokens include only \"n\", such as {\"name\":\"n\" } ? \n\nThe reproducible gist: https://gist.github.com/hxuanji/8e58c0ffb391ced49439\n\nAlthough I make sure the \"and\" operator, it seems only make sure the condition between \"positions\" not the \"tokens\". Does it make sense?\n\nIt seems I have some misunderstanding about the \"matching rule\" of \"and\" function.\n\nThanks a lot.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53248849","html_url":"https://github.com/elastic/elasticsearch/issues/7391#issuecomment-53248849","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7391","id":53248849,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjQ4ODQ5","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-08-25T10:23:59Z","updated_at":"2014-08-25T10:23:59Z","author_association":"CONTRIBUTOR","body":"Hi @hxuanji \n\nA trick for figuring out exactly what the query is doing is to use the `validate-query` API with the `explain` option:\n\n```\ncurl -XPOST \"http://localhost:9200/test/main/_validate/query?explain\" -d'\n{\n  \"query\": {\n    \"match\": {\n      \"name\": {\n        \"query\": \"942430__n.jpg\",\n        \"operator\": \"and\"\n      }\n    }\n  }\n}'\n```\n\nThis outputs:\n\n```\n     \"explanation\": \"filtered(name:942430__n.jpg name:942430 name:n name:jpg)->cache(_type:main)\"\n```\n\nSo any of the terms in the same position are allowed.  The `and` operator doesn't affect \"stacked\" terms.  The reason for this is that these terms are like synonyms.  You require one of the synonyms to be in position 0, but not all of them.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/53251437","html_url":"https://github.com/elastic/elasticsearch/issues/7391#issuecomment-53251437","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7391","id":53251437,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjUxNDM3","user":{"login":"hxuanji","id":4996057,"node_id":"MDQ6VXNlcjQ5OTYwNTc=","avatar_url":"https://avatars0.githubusercontent.com/u/4996057?v=4","gravatar_id":"","url":"https://api.github.com/users/hxuanji","html_url":"https://github.com/hxuanji","followers_url":"https://api.github.com/users/hxuanji/followers","following_url":"https://api.github.com/users/hxuanji/following{/other_user}","gists_url":"https://api.github.com/users/hxuanji/gists{/gist_id}","starred_url":"https://api.github.com/users/hxuanji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hxuanji/subscriptions","organizations_url":"https://api.github.com/users/hxuanji/orgs","repos_url":"https://api.github.com/users/hxuanji/repos","events_url":"https://api.github.com/users/hxuanji/events{/privacy}","received_events_url":"https://api.github.com/users/hxuanji/received_events","type":"User","site_admin":false},"created_at":"2014-08-25T11:04:19Z","updated_at":"2014-08-25T11:04:19Z","author_association":"NONE","body":"Hi, @clintongormley \nI got it!  Thanks for your help.\n\nIvan\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/72014315","html_url":"https://github.com/elastic/elasticsearch/issues/7391#issuecomment-72014315","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7391","id":72014315,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMDE0MzE1","user":{"login":"dklotz","id":2143593,"node_id":"MDQ6VXNlcjIxNDM1OTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2143593?v=4","gravatar_id":"","url":"https://api.github.com/users/dklotz","html_url":"https://github.com/dklotz","followers_url":"https://api.github.com/users/dklotz/followers","following_url":"https://api.github.com/users/dklotz/following{/other_user}","gists_url":"https://api.github.com/users/dklotz/gists{/gist_id}","starred_url":"https://api.github.com/users/dklotz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dklotz/subscriptions","organizations_url":"https://api.github.com/users/dklotz/orgs","repos_url":"https://api.github.com/users/dklotz/repos","events_url":"https://api.github.com/users/dklotz/events{/privacy}","received_events_url":"https://api.github.com/users/dklotz/received_events","type":"User","site_admin":false},"created_at":"2015-01-29T12:11:03Z","updated_at":"2015-01-29T12:11:03Z","author_association":"NONE","body":"@clintongormley I think this problem with the positions of the `word_delimiter` filter should be mentioned on the respective reference / guide pages... Just ran into the same thing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270996341","html_url":"https://github.com/elastic/elasticsearch/issues/7391#issuecomment-270996341","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7391","id":270996341,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDk5NjM0MQ==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2017-01-06T20:20:50Z","updated_at":"2017-01-06T20:20:50Z","author_association":"CONTRIBUTOR","body":"I am trying to fix this issue in Lucene: https://issues.apache.org/jira/browse/LUCENE-7619\r\n\r\nIt would mean you need to include c:WordDelimiterGraphFilter (once it's released) in your search-time analyzer.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301390224","html_url":"https://github.com/elastic/elasticsearch/issues/7391#issuecomment-301390224","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7391","id":301390224,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTM5MDIyNA==","user":{"login":"vsiv","id":935772,"node_id":"MDQ6VXNlcjkzNTc3Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/935772?v=4","gravatar_id":"","url":"https://api.github.com/users/vsiv","html_url":"https://github.com/vsiv","followers_url":"https://api.github.com/users/vsiv/followers","following_url":"https://api.github.com/users/vsiv/following{/other_user}","gists_url":"https://api.github.com/users/vsiv/gists{/gist_id}","starred_url":"https://api.github.com/users/vsiv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vsiv/subscriptions","organizations_url":"https://api.github.com/users/vsiv/orgs","repos_url":"https://api.github.com/users/vsiv/repos","events_url":"https://api.github.com/users/vsiv/events{/privacy}","received_events_url":"https://api.github.com/users/vsiv/received_events","type":"User","site_admin":false},"created_at":"2017-05-15T06:47:07Z","updated_at":"2017-05-15T06:47:34Z","author_association":"NONE","body":"WordDelimiterGraphFilter is now released and available in v5.4. FYI to those who stumble upon this thread. thanks @mikemccand for this!!\r\n\r\nV","performed_via_github_app":null}]