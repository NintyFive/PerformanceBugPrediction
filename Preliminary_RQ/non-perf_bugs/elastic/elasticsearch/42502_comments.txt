[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495553829","html_url":"https://github.com/elastic/elasticsearch/issues/42502#issuecomment-495553829","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42502","id":495553829,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTU1MzgyOQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T10:01:30Z","updated_at":"2019-05-24T10:01:30Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/495570568","html_url":"https://github.com/elastic/elasticsearch/issues/42502#issuecomment-495570568","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42502","id":495570568,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NTU3MDU2OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-05-24T10:47:32Z","updated_at":"2019-05-24T10:47:32Z","author_association":"CONTRIBUTOR","body":"This was fixed in https://github.com/elastic/elasticsearch/pull/39384, but unfortunately not backported ðŸ˜ž I've backported it now to all branches.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/501657092","html_url":"https://github.com/elastic/elasticsearch/issues/42502#issuecomment-501657092","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42502","id":501657092,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMTY1NzA5Mg==","user":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"created_at":"2019-06-13T11:05:50Z","updated_at":"2019-06-13T11:05:50Z","author_association":"CONTRIBUTOR","body":"interestingly the change was backported to 7.1 but I the issue reapeared\r\n```\r\nREPRODUCE WITH: ./gradlew :server:integTest --tests \"org.elasticsearch.indices.recovery.IndexPrimaryRelocationIT.testPrimaryRelocationWhileIndexing\" \\\r\n  -Dtests.seed=741D0A45431135A0 \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es-BO \\\r\n  -Dtests.timezone=Europe/Vaduz \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=8\r\n\r\nREPRODUCE WITH: ./gradlew :server:integTest --tests \"org.elasticsearch.indices.recovery.IndexPrimaryRelocationIT.testPrimaryRelocationWhileIndexing\" \\\r\n  -Dtests.seed=741D0A45431135A0 \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es-BO \\\r\n  -Dtests.timezone=Europe/Vaduz \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=8\r\n\r\nREPRODUCE WITH: ./gradlew :server:integTest --tests \"org.elasticsearch.indices.recovery.IndexPrimaryRelocationIT.testPrimaryRelocationWhileIndexing\" \\\r\n  -Dtests.seed=741D0A45431135A0 \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es-BO \\\r\n  -Dtests.timezone=Europe/Vaduz \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=8\r\n```\r\ndoes not reproduce locally for me\r\n\r\nhttps://scans.gradle.com/s/q2vcb5fa2ocyu","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/501676072","html_url":"https://github.com/elastic/elasticsearch/issues/42502#issuecomment-501676072","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42502","id":501676072,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMTY3NjA3Mg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-06-13T12:11:55Z","updated_at":"2019-06-13T12:11:55Z","author_association":"CONTRIBUTOR","body":"> interestingly the change was backported to 7.1 but I the issue reapeared\r\n\r\nwhat makes you think it's the same issue? Because it's the same test failing?\r\n\r\nThis is a different assertion error in a different place (see below), for which we should create a fresh issue instead of resurrecting an unrelated old one. I understand it's not always easy to figure out whether it's the same cause or a different one, but if the error message changes, please add that information to the GH issue.\r\n\r\nThe failure here is:\r\n\r\n```\r\njava.lang.AssertionError: \r\n    Expected: <false>\r\n         but: was <true>\r\n        at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n        at org.junit.Assert.assertThat(Assert.java:956)\r\n        at org.junit.Assert.assertThat(Assert.java:923)\r\n        at org.elasticsearch.indices.recovery.IndexPrimaryRelocationIT.testPrimaryRelocationWhileIndexing(IndexPrimaryRelocationIT.java:88)\r\n\r\n    com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=1107, name=Thread-12, state=RUNNABLE, group=TGRP-IndexPrimaryRelocationIT]\r\n\r\n        Caused by:\r\n        NodeClosedException[node closed {node_t0}{WudnTnG0R6OF2NJV0sWbQQ}{dzlZPFaQTFWmAZ2dbj8v_Q}{127.0.0.1}{127.0.0.1:35137}]\r\n```\r\n\r\nThe UncaughtExceptionError is just a side effect of the previous assertion tripping. The assertion that trips indicates that a request took longer than a minute to complete.\r\n\r\nThe actual problem here is that the nodes seem to be freezing during the test, with fault detection of the 2 nodes noticing that the respective other is not responding.\r\n\r\nThis does not look to be anything specific to this test, and might indicate an infrastructure problem.\r\n\r\n```\r\n  1> [2019-06-13T10:47:58,545][TRACE][o.e.i.s.IndexShard       ] [node_t0] [test][0] refresh with source [schedule]\r\n  1> [2019-06-13T10:48:08,806][DEBUG][o.e.c.c.LeaderChecker    ] [node_t1] 1 consecutive failures (limit [cluster.fault_detection.leader_check.retry_count] is 3) with leader [{node_t0}{WudnTnG0R6OF2NJV0sWbQQ}{dzlZPFaQTFWmAZ2dbj8v_Q}{127.0.0.1}{127.0.0.1:35137}]\r\n  1> org.elasticsearch.transport.ReceiveTimeoutTransportException: [node_t0][127.0.0.1:35137][internal:coordination/fault_detection/leader_check] request_id [225] timed out after [10006ms]\r\n  1> \tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:1026) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n  1> [2019-06-13T10:48:08,806][DEBUG][o.e.c.c.FollowersChecker ] [node_t0] FollowerChecker{discoveryNode={node_t1}{9ysSabFGS-msrN6aRmOxrQ}{YjxB2namSy2PzoMx1-Zi8Q}{127.0.0.1}{127.0.0.1:58527}, failureCountSinceLastSuccess=1, [cluster.fault_detection.follower_check.retry_count]=3} failed, retrying\r\n  1> org.elasticsearch.transport.ReceiveTimeoutTransportException: [node_t1][127.0.0.1:58527][internal:coordination/fault_detection/follower_check] request_id [300] timed out after [10006ms]\r\n  1> \tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:1026) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n  1> [2019-06-13T10:48:20,807][DEBUG][o.e.c.c.FollowersChecker ] [node_t0] FollowerChecker{discoveryNode={node_t1}{9ysSabFGS-msrN6aRmOxrQ}{YjxB2namSy2PzoMx1-Zi8Q}{127.0.0.1}{127.0.0.1:58527}, failureCountSinceLastSuccess=1, [cluster.fault_detection.follower_check.retry_count]=3} failed, retrying\r\n  1> org.elasticsearch.transport.ReceiveTimeoutTransportException: [node_t1][127.0.0.1:58527][internal:coordination/fault_detection/follower_check] request_id [302] timed out after [10005ms]\r\n  1> \tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:1026) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n  1> [2019-06-13T10:48:20,807][DEBUG][o.e.c.c.LeaderChecker    ] [node_t1] 1 consecutive failures (limit [cluster.fault_detection.leader_check.retry_count] is 3) with leader [{node_t0}{WudnTnG0R6OF2NJV0sWbQQ}{dzlZPFaQTFWmAZ2dbj8v_Q}{127.0.0.1}{127.0.0.1:35137}]\r\n  1> org.elasticsearch.transport.ReceiveTimeoutTransportException: [node_t0][127.0.0.1:35137][internal:coordination/fault_detection/leader_check] request_id [227] timed out after [10006ms]\r\n  1> \tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:1026) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n...\r\n  1> [2019-06-13T10:48:31,808][DEBUG][o.e.c.c.LeaderChecker    ] [node_t1] 2 consecutive failures (limit [cluster.fault_detection.leader_check.retry_count] is 3) with leader [{node_t0}{WudnTnG0R6OF2NJV0sWbQQ}{dzlZPFaQTFWmAZ2dbj8v_Q}{127.0.0.1}{127.0.0.1:35137}]\r\n  1> org.elasticsearch.transport.ReceiveTimeoutTransportException: [node_t0][127.0.0.1:35137][internal:coordination/fault_detection/leader_check] request_id [228] timed out after [10006ms]\r\n  1> \tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:1026) [main/:?]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [main/:?]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n...\r\n  1> [2019-06-13T10:48:57,635][DEBUG][o.e.c.c.Coordinator      ] [node_t1] onLeaderFailure: coordinator becoming CANDIDATE in term 1 (was FOLLOWER, lastKnownLeader was [Optional[{node_t0}{WudnTnG0R6OF2NJV0sWbQQ}{dzlZPFaQTFWmAZ2dbj8v_Q}{127.0.0.1}{127.0.0.1:35137}]])\r\n  1> [2019-06-13T10:48:57,635][WARN ][o.e.t.TransportService   ] [node_t1] Received response for a request that has timed out, sent [23815ms] ago, timed out [13809ms] ago, action [internal:coordination/fault_detection/leader_check], node [{node_t0}{WudnTnG0R6OF2NJV0sWbQQ}{dzlZPFaQTFWmAZ2dbj8v_Q}{127.0.0.1}{127.0.0.1:35137}], id [230]\r\n  1> [2019-06-13T10:48:57,635][TRACE][o.e.a.b.TransportShardBulkAction] [node_t0] [[test][0]] op [indices:data/write/bulk[s]] completed on primary for request [BulkShardRequest [[test][0]] containing [index {[test][type][56wGUGsBkv9vA_k2l0cB], source[{\"auto\":true}]}]]\r\n  1> [2019-06-13T10:48:57,635][TRACE][o.e.a.b.TransportShardBulkAction] [node_t0] operation succeeded. action [indices:data/write/bulk[s]],request [BulkShardRequest [[test][0]] containing [index {[test][type][56wGUGsBkv9vA_k2l0cB], source[{\"auto\":true}]}]]\r\n  1> [2019-06-13T10:48:57,635][INFO ][o.e.i.r.IndexPrimaryRelocationIT] [testPrimaryRelocationWhileIndexing] [IndexPrimaryRelocationIT#testPrimaryRelocationWhileIndexing]: cleaning up after test\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/502015210","html_url":"https://github.com/elastic/elasticsearch/issues/42502#issuecomment-502015210","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42502","id":502015210,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjAxNTIxMA==","user":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"created_at":"2019-06-14T08:15:37Z","updated_at":"2019-06-14T08:15:37Z","author_association":"CONTRIBUTOR","body":"@ywelsch apologies, I probably should have spend more time investigating this failure before reopening. I wrongly assumed that same testmethod and a recent change/fix would mean that this could be the same problem. ","performed_via_github_app":null}]