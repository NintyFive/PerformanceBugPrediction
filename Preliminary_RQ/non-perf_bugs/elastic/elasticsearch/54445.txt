{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54445/events","html_url":"https://github.com/elastic/elasticsearch/issues/54445","id":590445990,"node_id":"MDU6SXNzdWU1OTA0NDU5OTA=","number":54445,"title":"ensureGreen() times out in IdpRestTestCase tests","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"labels":[{"id":912838879,"node_id":"MDU6TGFiZWw5MTI4Mzg4Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Security","name":":Security/Security","color":"0e8a16","default":false,"description":"Security issues without another label"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"assignees":[{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false}],"milestone":null,"comments":13,"created_at":"2020-03-30T16:59:51Z","updated_at":"2020-04-01T10:04:24Z","closed_at":"2020-04-01T10:04:23Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"example: https://gradle-enterprise.elastic.co/s/mjzehzprhvqrc/console-log?task=:x-pack:plugin:identity-provider:qa:idp-rest-tests:integTestRunner\r\n\r\n```\r\nrg.elasticsearch.xpack.idp.ManageServiceProviderRestIT > testCreateAndDeleteServiceProvider FAILED\r\n    java.net.SocketTimeoutException: 60 000 milliseconds timeout on connection http-outgoing-5 [ACTIVE]\r\n        at __randomizedtesting.SeedInfo.seed([3B3A4454B4129FCA:1D5BE0E74B4A6BC3]:0)\r\n        at org.elasticsearch.client.RestClient.extractAndWrapCause(RestClient.java:808)\r\n        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:248)\r\n        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:251)\r\n        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:235)\r\n        at org.elasticsearch.test.rest.ESRestTestCase.ensureHealth(ESRestTestCase.java:969)\r\n        at org.elasticsearch.test.rest.ESRestTestCase.ensureHealth(ESRestTestCase.java:962)\r\n        at org.elasticsearch.test.rest.ESRestTestCase.ensureGreen(ESRestTestCase.java:949)\r\n        at org.elasticsearch.xpack.idp.ManageServiceProviderRestIT.testCreateAndDeleteServiceProvider(ManageServiceProviderRestIT.java:54)\r\n\r\n        Caused by:\r\n        java.net.SocketTimeoutException: 60 000 milliseconds timeout on connection http-outgoing-5 [ACTIVE]\r\n            at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.timeout(HttpAsyncRequestExecutor.java:387)\r\n            at org.apache.http.impl.nio.client.InternalIODispatch.onTimeout(InternalIODispatch.java:92)\r\n            at org.apache.http.impl.nio.client.InternalIODispatch.onTimeout(InternalIODispatch.java:39)\r\n            at org.apache.http.impl.nio.reactor.AbstractIODispatch.timeout(AbstractIODispatch.java:175)\r\n            at org.apache.http.impl.nio.reactor.BaseIOReactor.sessionTimedOut(BaseIOReactor.java:261)\r\n            at org.apache.http.impl.nio.reactor.AbstractIOReactor.timeoutCheck(AbstractIOReactor.java:502)\r\n            at org.apache.http.impl.nio.reactor.BaseIOReactor.validate(BaseIOReactor.java:211)\r\n            at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:280)\r\n            at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n            at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:591)\r\n            at java.base/java.lang.Thread.run(Thread.java:834)\r\nREPRODUCE WITH: ./gradlew ':x-pack:plugin:identity-provider:qa:idp-rest-tests:integTestRunner' --tests \"org.elasticsearch.xpack.idp.ManageServiceProviderRestIT.testCreateAndDeleteServiceProvider\" -Dtests.seed=3B3A4454B4129FCA -Dtests.security.manager=true -Dtests.locale=uk-UA -Dtests.timezone=America/Santarem -Dcompiler.java=13\r\n```\r\n\r\nI also hit this in https://github.com/elastic/elasticsearch/pull/54215 where there are two test methods and this would always happen only on the second test of the two that would run. I traced it to the fact that the template was deleted after the first test case ran and then we'd fail to re-create it ( because there was no cluster update received to trigger that (?) ) and solve it temporarily with https://github.com/elastic/elasticsearch/pull/54215/files#diff-f7bdad16f322fc2d554401ea074400b5R1132 but this doesn't seem to apply here where we have only one test. \r\n\r\nAnother data point is that this is not reproducible locally, while the https://github.com/elastic/elasticsearch/pull/54215 were","closed_by":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"performed_via_github_app":null}