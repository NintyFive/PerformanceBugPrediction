{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37330","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37330/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37330/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37330/events","html_url":"https://github.com/elastic/elasticsearch/issues/37330","id":398023764,"node_id":"MDU6SXNzdWUzOTgwMjM3NjQ=","number":37330,"title":"Date math does not respect locale settings","user":{"login":"floragunn","id":11678154,"node_id":"MDQ6VXNlcjExNjc4MTU0","avatar_url":"https://avatars3.githubusercontent.com/u/11678154?v=4","gravatar_id":"","url":"https://api.github.com/users/floragunn","html_url":"https://github.com/floragunn","followers_url":"https://api.github.com/users/floragunn/followers","following_url":"https://api.github.com/users/floragunn/following{/other_user}","gists_url":"https://api.github.com/users/floragunn/gists{/gist_id}","starred_url":"https://api.github.com/users/floragunn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/floragunn/subscriptions","organizations_url":"https://api.github.com/users/floragunn/orgs","repos_url":"https://api.github.com/users/floragunn/repos","events_url":"https://api.github.com/users/floragunn/events{/privacy}","received_events_url":"https://api.github.com/users/floragunn/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-01-10T21:31:56Z","updated_at":"2019-01-22T11:04:29Z","closed_at":"2019-01-22T11:04:29Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 7.0.0-alpha2, Build: default/tar/a30e8c2/2018-12-17T12:33:32.311168Z, JVM: 11\r\n\r\n**Plugins installed**: []\r\nnone\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"11\" 2018-09-25\r\nOpenJDK Runtime Environment 18.9 (build 11+28)\r\nOpenJDK 64-Bit Server VM 18.9 (build 11+28, mixed mode)\r\n\r\nas well as:\r\n\r\njava version \"1.8.0_181\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_181-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nOSX 10.13.6\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nDate Math does not respect locale\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\nAdd these lines to jvm.options and start elasticsearch:\r\n```\r\n#Thai locale th-TH-u-nu-thai-x-lvariant-TH\r\n-Duser.language=th\r\n-Duser.country=TH\r\n-Duser.variant=u-nu-thai\r\n```\r\n\r\nAfter ES is up execute\r\n```\r\ncurl -X PUT \"localhost:9200/%3Clogstash-%7Bnow%2Fd%7D%3E/_doc/1\" -H 'Content-Type: application/json' -d' {\r\n     \"year 2019 is in thai\" : \"2562\"\r\n}\r\n '\r\n\r\n{\"_index\":\"logstash-2019.01.10\",\"_type\":\"_doc\",\"_id\":\"1\",\"_version\":1,\"result\":\"created\",\"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\"_seq_no\":0,\"_primary_term\":1}\r\n```\r\nThe index `logstash-2019.01.10` was created but expected was `logstash-2562.01.10`\r\n\r\nThe logfiles however shows the rigth date:\r\n```\r\n[2562-01-10T22:10:30,315][INFO ][o.e.n.Node               ] [Kosh.local] version[7.0.0-alpha2], pid[27529], build[default/tar/a30e8c2/2018-12-17T12:33:32.311168Z], OS[Mac OS X/10.13.6/x86_64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/11/11+28]\r\n[2562-01-10T22:10:30,315][INFO ][o.e.n.Node               ] [Kosh.local] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Duser.language=th, -Duser.country=TH, -Duser.variant=u-nu-thai, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/var/folders/t3/plqkshnd0rnbr38rvx8dcblm0000gn/T/elasticsearch-13163066237771623398, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m, -Djava.locale.providers=COMPAT, -XX:UseAVX=2, -Dio.netty.allocator.type=unpooled, -Des.path.home=/Users/xxx/Downloads/elasticsearch-7.0.0-alpha2, -Des.path.conf=/Users/xxx/Downloads/elasticsearch-7.0.0-alpha2/config, -Des.distribution.flavor=default, -Des.distribution.type=tar]\r\n[2562-01-10T22:10:30,316][WARN ][o.e.n.Node               ] [Kosh.local] version [7.0.0-alpha2] is a pre-release version of Elasticsearch and is not suitable for production\r\n\r\n```\r\n\r\nIf for whatever reasons date math (or date handling in general) within Elasticsearch is always ISO and does not respect the locale then at least it needs to be clearly documented.","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}