[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372960005","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-372960005","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":372960005,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjk2MDAwNQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T09:39:31Z","updated_at":"2018-03-14T09:39:31Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373029752","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373029752","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373029752,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzAyOTc1Mg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T13:57:55Z","updated_at":"2018-03-14T13:57:55Z","author_association":"MEMBER","body":"@tlrx have you seen this before?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373048360","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373048360","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373048360,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzA0ODM2MA==","user":{"login":"gkozyryatskyy","id":7124946,"node_id":"MDQ6VXNlcjcxMjQ5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7124946?v=4","gravatar_id":"","url":"https://api.github.com/users/gkozyryatskyy","html_url":"https://github.com/gkozyryatskyy","followers_url":"https://api.github.com/users/gkozyryatskyy/followers","following_url":"https://api.github.com/users/gkozyryatskyy/following{/other_user}","gists_url":"https://api.github.com/users/gkozyryatskyy/gists{/gist_id}","starred_url":"https://api.github.com/users/gkozyryatskyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gkozyryatskyy/subscriptions","organizations_url":"https://api.github.com/users/gkozyryatskyy/orgs","repos_url":"https://api.github.com/users/gkozyryatskyy/repos","events_url":"https://api.github.com/users/gkozyryatskyy/events{/privacy}","received_events_url":"https://api.github.com/users/gkozyryatskyy/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T14:49:44Z","updated_at":"2018-03-14T14:49:44Z","author_association":"NONE","body":"If this helps, all the snapshots, Im trying to remove, done on elasticsearch 5.4.0 version. \r\n\r\nAlso I have 4 different environments with same elasticsearch version and configs, but this problem I experienced just on single environment... So I think the problem is in specific snapshot...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373078506","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373078506","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373078506,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzA3ODUwNg==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T16:08:42Z","updated_at":"2018-03-14T16:08:42Z","author_association":"MEMBER","body":"It reminds me of #26127, but it was fixed in 5.6.0 and in 26127 it was failing because failure reason was null, but it looks like it fails here because snapshotId [is null](https://github.com/elastic/elasticsearch/blob/5.6/core/src/main/java/org/elasticsearch/repositories/RepositoryData.java#L357). So, it is probably a different issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373081933","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373081933","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373081933,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzA4MTkzMw==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T16:17:39Z","updated_at":"2018-03-14T16:17:39Z","author_association":"MEMBER","body":"@gkozyryatskyy Would it be possible that, at a given time, two environments accessed to the same repository to write a snapshot?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373087615","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373087615","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373087615,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzA4NzYxNQ==","user":{"login":"gkozyryatskyy","id":7124946,"node_id":"MDQ6VXNlcjcxMjQ5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7124946?v=4","gravatar_id":"","url":"https://api.github.com/users/gkozyryatskyy","html_url":"https://github.com/gkozyryatskyy","followers_url":"https://api.github.com/users/gkozyryatskyy/followers","following_url":"https://api.github.com/users/gkozyryatskyy/following{/other_user}","gists_url":"https://api.github.com/users/gkozyryatskyy/gists{/gist_id}","starred_url":"https://api.github.com/users/gkozyryatskyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gkozyryatskyy/subscriptions","organizations_url":"https://api.github.com/users/gkozyryatskyy/orgs","repos_url":"https://api.github.com/users/gkozyryatskyy/repos","events_url":"https://api.github.com/users/gkozyryatskyy/events{/privacy}","received_events_url":"https://api.github.com/users/gkozyryatskyy/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T16:33:01Z","updated_at":"2018-03-14T16:33:55Z","author_association":"NONE","body":"@tlrx theoretically, yes.. this is **dev** environment =( Someone can up few environments with one snapshot configs... ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373296702","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373296702","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373296702,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzI5NjcwMg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T08:22:43Z","updated_at":"2018-03-15T08:22:43Z","author_association":"MEMBER","body":"@gkozyryatskyy I've seen similar issue when two different clusters are accessing the same S3 repository (more exactly, the same S3 bucket): one environment is creating a snapshot while another environment is deleting a snapshot. This is a quite rare situation, as the creation and deletion must be executed exactly at the same time, but it can still happen, specially when there's a lot of indices/documents involves in the snapshot.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373437180","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373437180","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373437180,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzQzNzE4MA==","user":{"login":"gkozyryatskyy","id":7124946,"node_id":"MDQ6VXNlcjcxMjQ5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7124946?v=4","gravatar_id":"","url":"https://api.github.com/users/gkozyryatskyy","html_url":"https://github.com/gkozyryatskyy","followers_url":"https://api.github.com/users/gkozyryatskyy/followers","following_url":"https://api.github.com/users/gkozyryatskyy/following{/other_user}","gists_url":"https://api.github.com/users/gkozyryatskyy/gists{/gist_id}","starred_url":"https://api.github.com/users/gkozyryatskyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gkozyryatskyy/subscriptions","organizations_url":"https://api.github.com/users/gkozyryatskyy/orgs","repos_url":"https://api.github.com/users/gkozyryatskyy/repos","events_url":"https://api.github.com/users/gkozyryatskyy/events{/privacy}","received_events_url":"https://api.github.com/users/gkozyryatskyy/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T16:25:28Z","updated_at":"2018-03-15T16:25:28Z","author_association":"NONE","body":"@tlrx \r\nThank you a lot for your responses!\r\n\r\n- Is there any way to understand that it is my case?\r\n- How can I do a \"hotfix\" for this? Should I delete all the snapshots and create new one? Or I can delete some specific one? Or I can cleanup something from s3 bucket?\r\n- It any case, I think will be nice, to make some fix in the code for this to not cause NullPointer.. But it is on you.. =)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373503620","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373503620","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373503620,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzUwMzYyMA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T19:57:41Z","updated_at":"2018-03-15T19:57:41Z","author_association":"MEMBER","body":"> Is there any way to understand that it is my case?\r\n\r\nThat's not easy - do you think that your case is similar to the situation I explained in https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373296702? If so, they we have an explanation.\r\n\r\n> How can I do a \"hotfix\" for this? Should I delete all the snapshots and create new one? Or I can delete some specific one? Or I can cleanup something from s3 bucket?\r\n\r\nI think that the best fix would be to create a new repository, in a different S3 bucket (or a sub path of the same bucket, see `base_path` option), and have a single cluster that can write snapshots to it and the other clusters have this repository with the `read_only` option. \r\n\r\n> It any case, I think will be nice, to make some fix in the code for this to not cause NullPointer.. But it is on you.. =)\r\n\r\nI'd love to have a fix for S3 and concurrent access :) But S3 is not a filesystem: it's a replicated, distributed, consistent-after-write blob storage system. We can't really implements locks or atomic writes with it, so we cannot have any strong guarantees except that an uploaded file will appear (after some undefined time) in the S3 bucket. If you need strong guarantees then you should consider using a real filesystem.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373655997","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373655997","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373655997,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzY1NTk5Nw==","user":{"login":"gkozyryatskyy","id":7124946,"node_id":"MDQ6VXNlcjcxMjQ5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7124946?v=4","gravatar_id":"","url":"https://api.github.com/users/gkozyryatskyy","html_url":"https://github.com/gkozyryatskyy","followers_url":"https://api.github.com/users/gkozyryatskyy/followers","following_url":"https://api.github.com/users/gkozyryatskyy/following{/other_user}","gists_url":"https://api.github.com/users/gkozyryatskyy/gists{/gist_id}","starred_url":"https://api.github.com/users/gkozyryatskyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gkozyryatskyy/subscriptions","organizations_url":"https://api.github.com/users/gkozyryatskyy/orgs","repos_url":"https://api.github.com/users/gkozyryatskyy/repos","events_url":"https://api.github.com/users/gkozyryatskyy/events{/privacy}","received_events_url":"https://api.github.com/users/gkozyryatskyy/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T09:37:17Z","updated_at":"2018-03-16T09:37:17Z","author_association":"NONE","body":"@tlrx \r\nThank you a lot for your responses!\r\n\r\nIf this info helps you, Im able to delete/snapshot to this repo with elasticsearch 5.4.0. So it is not just S3 problem... Theoretically, snapshot logic can be reverted to 5.4.0 version and will work.\r\n\r\nSo for now, Im thinking to delete everything with older db version and start creating new snapshots with new db version... Changing the bucket or base path is not an option right now, because it is bound to environment name and will cause renaming/changing the environment just because of db snapshots...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373677948","html_url":"https://github.com/elastic/elasticsearch/issues/29052#issuecomment-373677948","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","id":373677948,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzY3Nzk0OA==","user":{"login":"gkozyryatskyy","id":7124946,"node_id":"MDQ6VXNlcjcxMjQ5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7124946?v=4","gravatar_id":"","url":"https://api.github.com/users/gkozyryatskyy","html_url":"https://github.com/gkozyryatskyy","followers_url":"https://api.github.com/users/gkozyryatskyy/followers","following_url":"https://api.github.com/users/gkozyryatskyy/following{/other_user}","gists_url":"https://api.github.com/users/gkozyryatskyy/gists{/gist_id}","starred_url":"https://api.github.com/users/gkozyryatskyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gkozyryatskyy/subscriptions","organizations_url":"https://api.github.com/users/gkozyryatskyy/orgs","repos_url":"https://api.github.com/users/gkozyryatskyy/repos","events_url":"https://api.github.com/users/gkozyryatskyy/events{/privacy}","received_events_url":"https://api.github.com/users/gkozyryatskyy/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T10:52:36Z","updated_at":"2018-03-29T15:40:19Z","author_association":"NONE","body":"@tlrx \r\nOk, here is what I did:\r\n- I create temp FS repo and backup there\r\n- I manually delete everything from backup bucket with backup path prefix\r\n- I run new, first snapshot in same repo/bucker/path prefix and it was succeeded.","performed_via_github_app":null}]