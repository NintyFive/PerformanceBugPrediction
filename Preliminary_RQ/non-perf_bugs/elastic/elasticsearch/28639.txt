{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28639","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28639/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28639/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28639/events","html_url":"https://github.com/elastic/elasticsearch/issues/28639","id":296432469,"node_id":"MDU6SXNzdWUyOTY0MzI0Njk=","number":28639,"title":"Feature Request : Compare results of two queries","user":{"login":"tblake84","id":5753800,"node_id":"MDQ6VXNlcjU3NTM4MDA=","avatar_url":"https://avatars3.githubusercontent.com/u/5753800?v=4","gravatar_id":"","url":"https://api.github.com/users/tblake84","html_url":"https://github.com/tblake84","followers_url":"https://api.github.com/users/tblake84/followers","following_url":"https://api.github.com/users/tblake84/following{/other_user}","gists_url":"https://api.github.com/users/tblake84/gists{/gist_id}","starred_url":"https://api.github.com/users/tblake84/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tblake84/subscriptions","organizations_url":"https://api.github.com/users/tblake84/orgs","repos_url":"https://api.github.com/users/tblake84/repos","events_url":"https://api.github.com/users/tblake84/events{/privacy}","received_events_url":"https://api.github.com/users/tblake84/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-02-12T16:13:59Z","updated_at":"2018-02-16T15:41:47Z","closed_at":"2018-02-16T15:41:47Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Feature request -->\r\nThis feature request is a result of a post on Reddit in which r/warkolm asked that I open a feature request.\r\n\r\nI would like a simplified way to compare the results of two queries.  Basically, what I am trying to do is correlate two data sets using a specific field in data set 'A' to see if it exists in a specific field of data set 'B'.  Right now, I am doing this using a pretty rough bash script which pulls the results of my first query into an array and iterates through it querying dataset 'B' for the value.  Below is an example of what I am doing in my script with two indices, \"twitter\" and \"facebook\" (\"twitter\" contains user tweet history and \"facebook\" contains user account information).  So here, I am trying to find users that tweeted a specific message, then query 'facebook' to see if they also have an account there and if so, output the information to a logfile.  For an analogy, I am trying to do the same exact thing that VLOOKUP does in Excel.\r\n\r\n```shell\r\n# Check dataset 'tweet' to see what users sent the message \"foobar\"\r\nusers=($(curl -XGET http://localhost:9200/twitter/tweet/_search -d \"{\r\n  \"_source\": [\"user\"],\r\n  \"size\": 300,\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [\r\n        {\"match\": { \"message\" : \"foobar\" }}\r\n      ]\r\n    }\r\n  }\r\n}\" | jq . | grep user | awk '{print $2}' | sed 's/\\\"//g' | sed 's/\\,//g' | sort -u))\r\n\r\n# For each user that tweeted the message 'foobar', query if their account is active\r\nfor user in ${users[@]}; do\r\nfbaccount=($(curl -XGET http://localhost:9200/facebook/accounts/_search -d \"{\r\n  \\\"_source\\\": [\\\"status\\\"],\r\n  \\\"query\\\": {\r\n    \\\"term\\\": {\\\"user\\\" : \"${user}\"}\r\n  }\r\n}\" | jq . | grep status | awk '{print $2}' | sed 's/\\\"//g' | sed 's/\\,//g' | sort -u))\r\n\r\n# Print all users who tweeted \"foobar\" and have a facebook profile to logfile\r\nif [[ ${fbaccount} == \"active\" ]]; then\r\n  printf \"${user}\\n\" >> logfile\r\nfi  \r\ndone\r\n```\r\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}