[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22485957","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-22485957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":22485957,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNDg1OTU3","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-12T11:02:24Z","updated_at":"2013-08-12T11:02:24Z","author_association":"CONTRIBUTOR","body":"Thanks for opening this. do you feel like attaching a pullrequest? I'd be happy to help you sketching out the functionality here!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22491422","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-22491422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":22491422,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNDkxNDIy","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-12T13:04:22Z","updated_at":"2013-08-12T13:04:22Z","author_association":"CONTRIBUTOR","body":"So I had a similar problem that came from filters: I was getting phrases that exist in the index but were filtered out on subsequent searches with the same filter set.  I've since mostly worked around the problem by splitting my index along the most common filter.  So if it isn't that much more work to get it to include filters that'd be great.  If OTOH, you do something like only return suggestions that match an n-gram then by all means just do that and ignore me.  I'd still use it and it'd probably be faster in the end.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22492411","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-22492411","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":22492411,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNDkyNDEx","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-12T13:23:26Z","updated_at":"2013-08-12T13:23:26Z","author_association":"CONTRIBUTOR","body":"folks, I don't think we can filter the process of drawing candidates etc. since performance will suffer badly. What I can imagine is to execute a match query with each suggestoin that is returned to make a decision to drop them or not. Yet, this will allow for filtering for sure but it will only be a helper to prune the result list. if this is ok for you guys I think we can certainly do that!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23484780","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-23484780","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":23484780,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNDg0Nzgw","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-08-29T12:20:33Z","updated_at":"2013-08-29T12:20:33Z","author_association":"CONTRIBUTOR","body":"@nik9000 do you wanna take a look at this. I won't be able to do in the near future.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23489724","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-23489724","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":23489724,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNDg5NzI0","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-08-29T13:40:40Z","updated_at":"2013-08-29T13:40:40Z","author_association":"CONTRIBUTOR","body":"I can take a look sometime in the next few days, yeah.  We just deployed our elasticsearch software to a much larger group of users yesterday so I'm getting a bunch of high priority bugs that aren't (yet) this.  What I'll do is file this issue as a medium priority one on my side and pick it up when I've cleared everything higher.\n\nSo what'd be most useful for me would be to have an api like this:\n\n``` bash\ncurl -XPOST 'localhost:9200/_search' -d {\n  \"suggest\" : {\n    \"text\" : \"Xor the Got-Jewel\",\n    \"simple_phrase\" : {\n      \"phrase\" : {\n        \"field\" : \"body\",\n        \"size\" : 5,\n        \"shard_size\": 10,\n        \"confidence\": 2.0,\n        \"filter_replace_string\": \"{}\",\n        \"filter\": {\n          \"bool\" : {\n                \"must\" : {\n                    \"query\": { \"match_phrase\" : { \"body\" : \"{}\", \"slop\": 3 } }\n                },\n                \"must_not\" : {\n                    \"range\" : {\n                        \"age\" : { \"from\" : 10, \"to\" : 20 }\n                    }\n                },\n                \"should\" : [\n                    {\n                        \"term\" : { \"tag\" : \"sometag\" }\n                    },\n                    {\n                        \"term\" : { \"tag\" : \"sometagtag\" }\n                    }\n                ]\n            }\n        }\n      }\n    }\n  }\n}\n```\n\nI can see how this could be a performance problem but caching should kick in and help with most of the filters.  Also, if you set your confidence nice and high you might not have to do this _too_ many time.\n\nAnd another thing, you'd have to crank up the `shard_size` value or you might end up filtering out all the suggestions that come from the shards.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23935956","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-23935956","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":23935956,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTM1OTU2","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-09-06T12:19:26Z","updated_at":"2013-09-06T12:19:26Z","author_association":"CONTRIBUTOR","body":"Now that I'm digging into this I like this API better\n\n`````` bash\ncurl -XPOST 'localhost:9200/_search' -d {\n  \"suggest\" : {\n    \"text\" : \"Xor the Got-Jewel\",\n    \"simple_phrase\" : {\n      \"phrase\" : {\n        \"field\" : \"body\",\n        \"size\" : 5,\n        \"shard_size\": 10,\n        \"confidence\": 2.0,\n        \"filter\": {\n          \"bool\" : {\n                \"must_not\" : {\n                    \"range\" : {\n                        \"age\" : { \"from\" : 10, \"to\" : 20 }\n                    }\n                },\n                \"should\" : [\n                    {\n                        \"term\" : { \"tag\" : \"sometag\" }\n                    },\n                    {\n                        \"term\" : { \"tag\" : \"sometagtag\" }\n                    }\n                ]\n            }\n        }\n      }\n    }\n  }\n}```\nInternally I'd build a bool filter containing a phrase_match against the field against which we generate suggestions and the filter you passes in.  This is less fiddly to code and allows some simple syntax shortcuts:\n```bash\ncurl -XPOST 'localhost:9200/_search' -d {\n  \"suggest\" : {\n    \"text\" : \"Xor the Got-Jewel\",\n    \"simple_phrase\" : {\n      \"phrase\" : {\n        \"field\" : \"body\",\n        \"size\" : 5,\n        \"shard_size\": 10,\n        \"confidence\": 2.0,\n        \"filter\": \"yes\"\n      }\n    }\n  }\n}```\nwhich would add the phrase_match and\n```bash\ncurl -XPOST 'localhost:9200/twitter/_search?pretty=true' -d '\n{\n    \"query\" : {\n        \"term\" : { \"message\" : \"something\" }\n    },\n    \"filter\" : {\n        \"term\" : { \"tag\" : \"green\" }\n    }\n    \"suggest\" : {\n        \"text\" : \"Xor the Got-Jewel\",\n        \"simple_phrase\" : {\n            \"phrase\" : {\n                \"field\" : \"body\",\n                \"size\" : 5,\n                \"shard_size\": 10,\n                \"confidence\": 2.0,\n                \"filter\": \"query\"\n            }\n        }\n    }\n}'\n``````\n\nwhich would go and get the filters from the top level query.\n\nI'm still concerned about how slow this might be.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24454770","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-24454770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":24454770,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NDU0Nzcw","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-09-14T19:08:20Z","updated_at":"2013-09-14T19:08:20Z","author_association":"CONTRIBUTOR","body":"So I finally have something for this that kinda works. It doesn't fully work and I'd like some guidance. I can't post the code right now because I'm traveling. Such is life. Any way, I'd like giluidance on two things:\n1. Since there is no good way to parse the request during the reduce phase I'm parsing what I need on the shards and sending it back. Is that right/normal?\n2.  I can make queries during the reduce phase and block, waiting for them to return pretty easy. That seems to work on when I start the server but badly in tests, presumably because they have a lower bound on tr thread pool. Is it OK to make blocking calls in the reduce step?  Anything else seems like a pretty invasive change for this feature which doesn't have a ton of traction. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28387289","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-28387289","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":28387289,"node_id":"MDEyOklzc3VlQ29tbWVudDI4Mzg3Mjg5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-11-13T11:25:35Z","updated_at":"2013-11-13T11:25:35Z","author_association":"CONTRIBUTOR","body":"moved over to `0.90.8` I will look at this soon as well \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/41382297","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-41382297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":41382297,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzgyMjk3","user":{"login":"timbunce","id":62403,"node_id":"MDQ6VXNlcjYyNDAz","avatar_url":"https://avatars2.githubusercontent.com/u/62403?v=4","gravatar_id":"","url":"https://api.github.com/users/timbunce","html_url":"https://github.com/timbunce","followers_url":"https://api.github.com/users/timbunce/followers","following_url":"https://api.github.com/users/timbunce/following{/other_user}","gists_url":"https://api.github.com/users/timbunce/gists{/gist_id}","starred_url":"https://api.github.com/users/timbunce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timbunce/subscriptions","organizations_url":"https://api.github.com/users/timbunce/orgs","repos_url":"https://api.github.com/users/timbunce/repos","events_url":"https://api.github.com/users/timbunce/events{/privacy}","received_events_url":"https://api.github.com/users/timbunce/received_events","type":"User","site_admin":false},"created_at":"2014-04-25T11:20:55Z","updated_at":"2014-04-25T11:20:55Z","author_association":"NONE","body":"Any news on this, or the similar #2842?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/41406676","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-41406676","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":41406676,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDA2Njc2","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-04-25T15:39:01Z","updated_at":"2014-04-25T15:39:01Z","author_association":"CONTRIBUTOR","body":"I think now that we have templates we can implement this much simpler - I think we should revisit it soon, thanks for pinging @timbunce \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/46638123","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-46638123","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":46638123,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjM4MTIz","user":{"login":"brupm","id":336,"node_id":"MDQ6VXNlcjMzNg==","avatar_url":"https://avatars3.githubusercontent.com/u/336?v=4","gravatar_id":"","url":"https://api.github.com/users/brupm","html_url":"https://github.com/brupm","followers_url":"https://api.github.com/users/brupm/followers","following_url":"https://api.github.com/users/brupm/following{/other_user}","gists_url":"https://api.github.com/users/brupm/gists{/gist_id}","starred_url":"https://api.github.com/users/brupm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brupm/subscriptions","organizations_url":"https://api.github.com/users/brupm/orgs","repos_url":"https://api.github.com/users/brupm/repos","events_url":"https://api.github.com/users/brupm/events{/privacy}","received_events_url":"https://api.github.com/users/brupm/received_events","type":"User","site_admin":false},"created_at":"2014-06-20T02:03:43Z","updated_at":"2014-06-20T02:03:43Z","author_association":"NONE","body":":+1: \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/47299754","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-47299754","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":47299754,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mjk5NzU0","user":{"login":"brupm","id":336,"node_id":"MDQ6VXNlcjMzNg==","avatar_url":"https://avatars3.githubusercontent.com/u/336?v=4","gravatar_id":"","url":"https://api.github.com/users/brupm","html_url":"https://github.com/brupm","followers_url":"https://api.github.com/users/brupm/followers","following_url":"https://api.github.com/users/brupm/following{/other_user}","gists_url":"https://api.github.com/users/brupm/gists{/gist_id}","starred_url":"https://api.github.com/users/brupm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brupm/subscriptions","organizations_url":"https://api.github.com/users/brupm/orgs","repos_url":"https://api.github.com/users/brupm/repos","events_url":"https://api.github.com/users/brupm/events{/privacy}","received_events_url":"https://api.github.com/users/brupm/received_events","type":"User","site_admin":false},"created_at":"2014-06-27T01:36:54Z","updated_at":"2014-06-27T01:36:54Z","author_association":"NONE","body":"This would be awesome to have. I ended up having to do it outside ES. \n1. Get the suggestions \n2. Perform another ES search to validate the existence\n3. Present only existing phases to users\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/47656434","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-47656434","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":47656434,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjU2NDM0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-01T13:37:09Z","updated_at":"2014-07-01T13:37:09Z","author_association":"CONTRIBUTOR","body":"@areek something you could take a look at?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/47698214","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-47698214","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":47698214,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Njk4MjE0","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2014-07-01T19:17:20Z","updated_at":"2014-07-01T19:17:20Z","author_association":"CONTRIBUTOR","body":"@clintongormley already started looking into it!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48221665","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48221665","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48221665,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MjIxNjY1","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2014-07-07T18:39:43Z","updated_at":"2014-07-07T18:39:43Z","author_association":"CONTRIBUTOR","body":"After looking into it, I have come up with the following API for the suggestion filter option:\n\n``` bash\ncurl -XPOST 'localhost:9200/_search' -d {\n    \"suggest\": {\n        \"text\": \"Xor the Got-Jewel\",\n        \"simple_phrase\": {\n            \"phrase\": {\n                \"field\": \"body\",\n                \"size\": 5,\n                \"shard_size\": 10,\n                \"confidence\": 2,\n                \"filter\": {\n                    \"match\": {\n                        \"body\": \"{{suggestion}}\"\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\nThe filter option above is just a query template with the magic variable \"suggestion\", which will be populated once phrase suggestions are made.\nFor the first iteration, I intend to make local queries for the filter instead of hitting all the shards and also restrict the size of the suggestions to a maximum of 20, when filter option is used.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48283192","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48283192","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48283192,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MjgzMTky","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-08T08:06:59Z","updated_at":"2014-07-08T08:06:59Z","author_association":"CONTRIBUTOR","body":"@areek Just a note: `match` is a query, not a filter.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48343115","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48343115","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48343115,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MzQzMTE1","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2014-07-08T14:26:12Z","updated_at":"2014-07-08T14:26:12Z","author_association":"CONTRIBUTOR","body":"@clintongormley Currently the filter param takes queries! The reason the name is filter, is to indicate that the query is used to filter out the suggestions after being generated\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48345968","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48345968","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48345968,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MzQ1OTY4","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2014-07-08T14:44:11Z","updated_at":"2014-07-08T14:44:11Z","author_association":"CONTRIBUTOR","body":"Its confusing to take queries and call it filter, I think.  Why not make it\ntake filters?\n\nOn Tue, Jul 8, 2014 at 10:26 AM, Areek Zillur notifications@github.com\nwrote:\n\n> @clintongormley https://github.com/clintongormley Currently the filter\n> param takes queries! The reason the name is filter, is to indicate that the\n> query is used to filter out the suggestions after being generated\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/elasticsearch/elasticsearch/issues/3482#issuecomment-48343115\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48395868","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48395868","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48395868,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4Mzk1ODY4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-08T20:32:25Z","updated_at":"2014-07-08T20:32:25Z","author_association":"CONTRIBUTOR","body":"Agree with @nik9000 about confusing.  `filter` means filters, not queries.  In that case should be called `query` to be consistent with other APIs.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48413654","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48413654","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48413654,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDEzNjU0","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2014-07-08T23:44:07Z","updated_at":"2014-07-08T23:44:07Z","author_association":"CONTRIBUTOR","body":"It does seem confusing, the updated API looks like the following:\n\n``` bash\ncurl -XPOST 'localhost:9200/_search' -d {\n    \"suggest\": {\n        \"text\": \"Xor the Got-Jewel\",\n        \"simple_phrase\": {\n            \"phrase\": {\n                \"field\": \"body\",\n                \"size\": 5,\n                \"shard_size\": 10,\n                \"confidence\": 2,\n                \"filter\": {\n                    \"template\": {\n                        \"body\": \"{{suggestion}}\"\n                    },\n                    \"preference\": \"_only_local\"\n                }\n            }\n        }\n    }\n}\n```\n\nThe change was mainly due to adding the `preference` param in the filter object. Calling it `query` would also confuse users at least with respect to the reason for providing such an option in the suggest API. Thoughts?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48447442","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48447442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48447442,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDQ3NDQy","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-09T09:19:43Z","updated_at":"2014-07-09T09:19:43Z","author_association":"CONTRIBUTOR","body":"@areek I assume that any query can be run there? it's not limited to just `template` queries?  Also, if the user wants to use a `template` query with other parameters, I assume they can just specify `params` and the `suggestion` value will be added to any manually specified params?\n\nEither way, `filter` is the wrong name for that section.  Wherever we have `filter` or `*_filter`, it means that we are in \"filter context\" and only filter clauses can be accepted.\n\nI'd be perfectly happy just renaming it to `query`, but if you want something slightly more descriptive then why not use `post_query`?  We use `post_filter` in the top level of search requests to say: \"this filter will be applied to the `hits` array after the query has been run and after the aggregations have been calculated\". This functionality seems similar.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48521271","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48521271","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48521271,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NTIxMjcx","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-07-09T19:17:24Z","updated_at":"2014-07-09T19:17:24Z","author_association":"CONTRIBUTOR","body":"what about:\n\n``` Json\n\n\"collate\" : {\n  \"filter|query\" : { ... }   \n  \"preference\": \"_only_local\"\n}\n```\n\nthen folks can pick if we should parse it as a query or not. The template engine doesn't care really it's just string replacements.... we can document it that it is passed through mustache.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48535347","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48535347","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48535347,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NTM1MzQ3","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2014-07-09T21:16:54Z","updated_at":"2014-07-09T21:16:54Z","author_association":"CONTRIBUTOR","body":"@s1monw I like `collate`, I will go ahead and change it to that format and document the use of mustache under the covers.\n\n@clintongormley all your assumptions are correct, except that the `params` support is not there, the reason for the template is to allow for the magic `suggestion` variable.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48593823","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48593823","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48593823,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NTkzODIz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-10T11:39:29Z","updated_at":"2014-07-10T11:39:29Z","author_association":"CONTRIBUTOR","body":"@areek i'm thinking that users might want to use a [`template` query](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-template-query.html#query-dsl-template-query) here. Couldn't you just check if there are params already defined, and merge `suggestion` variable into them?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48637114","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48637114","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48637114,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NjM3MTE0","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2014-07-10T17:32:01Z","updated_at":"2014-07-10T17:32:01Z","author_association":"CONTRIBUTOR","body":"@clintongormley I will end up doing that, thanks for suggesting.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48674273","html_url":"https://github.com/elastic/elasticsearch/issues/3482#issuecomment-48674273","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3482","id":48674273,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4Njc0Mjcz","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2014-07-10T22:42:31Z","updated_at":"2014-07-10T22:42:31Z","author_association":"CONTRIBUTOR","body":"So the updated API looks like the following:\n\n``` bash\ncurl -XPOST 'localhost:9200/_search' -d {\n    \"suggest\": {\n        \"text\": \"Xor the Got-Jewel\",\n        \"simple_phrase\": {\n            \"phrase\": {\n                \"field\": \"body\",\n                \"size\": 5,\n                \"shard_size\": 10,\n                \"confidence\": 2,\n                \"collate\": {\n                    \"query\": {\n                        \"{{field_name}}\": \"{{suggestion}}\"\n                    },\n                    \"preference\": \"_primary\",\n                    \"params\": {\"field_name\": \"title\"}\n                }\n            }\n        }\n    }\n}\n```\n\n`collate` can also take a `filter` instead of `query` (as suggested by @s1monw) and optional `params` can be used, to inject the template `query` or `filter` with additional params (as suggested by @clintongormley).\n","performed_via_github_app":null}]