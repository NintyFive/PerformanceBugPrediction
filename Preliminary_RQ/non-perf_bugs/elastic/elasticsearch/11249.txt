{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11249","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11249/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11249/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11249/events","html_url":"https://github.com/elastic/elasticsearch/issues/11249","id":78425410,"node_id":"MDU6SXNzdWU3ODQyNTQxMA==","number":11249,"title":"Corrupted shard","user":{"login":"Hocdoc","id":3492813,"node_id":"MDQ6VXNlcjM0OTI4MTM=","avatar_url":"https://avatars0.githubusercontent.com/u/3492813?v=4","gravatar_id":"","url":"https://api.github.com/users/Hocdoc","html_url":"https://github.com/Hocdoc","followers_url":"https://api.github.com/users/Hocdoc/followers","following_url":"https://api.github.com/users/Hocdoc/following{/other_user}","gists_url":"https://api.github.com/users/Hocdoc/gists{/gist_id}","starred_url":"https://api.github.com/users/Hocdoc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hocdoc/subscriptions","organizations_url":"https://api.github.com/users/Hocdoc/orgs","repos_url":"https://api.github.com/users/Hocdoc/repos","events_url":"https://api.github.com/users/Hocdoc/events{/privacy}","received_events_url":"https://api.github.com/users/Hocdoc/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":182334038,"node_id":"MDU6TGFiZWwxODIzMzQwMzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.6.0","name":"v1.6.0","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2015-05-20T08:16:05Z","updated_at":"2015-06-08T16:37:30Z","closed_at":"2015-06-08T16:37:29Z","author_association":"NONE","active_lock_reason":null,"body":"After restarting Elasticsearch 1.5.2 (just a `sudo service elasticsearch restart`) on my single node server with about 600GB data one shard cannot get recovered and the cluster stays in the red status. I haven't noticed any problems before the restart. I'm using the indices without replicas.\n\nI am using a GCE instance with persistent disks and there is enough free space for Elasticsearch there (>170GB). \n\nError log:\n\n```\n[2015-05-20 07:48:29,774][WARN ][indices.cluster          ] [test1] [[gardenhose-2015-week20][2]] marking and sending shard failed due to [failed recovery]\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [gardenhose-2015-week20][2] failed recovery\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:162)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.index.engine.EngineCreationFailureException: [gardenhose-2015-week20][2] failed to upgrade 3x segments\n        at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:121)\n        at org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:32)\n        at org.elasticsearch.index.shard.IndexShard.newEngine(IndexShard.java:1262)\n        at org.elasticsearch.index.shard.IndexShard.createNewEngine(IndexShard.java:1257)\n        at org.elasticsearch.index.shard.IndexShard.prepareForTranslogRecovery(IndexShard.java:784)\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:226)\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:112)\n        ... 3 more\nCaused by: java.io.EOFException: read past EOF: NIOFSIndexInput(path=\"/mnt/elasticsearch-test1/test/nodes/0/indices/gardenhose-2015-week20/2/index/segments_c9\")\n        at org.apache.lucene.store.BufferedIndexInput.refill(BufferedIndexInput.java:336)\n        at org.apache.lucene.store.BufferedIndexInput.readByte(BufferedIndexInput.java:54)\n        at org.apache.lucene.store.DataInput.readInt(DataInput.java:98)\n        at org.apache.lucene.store.BufferedIndexInput.readInt(BufferedIndexInput.java:183)\n        at org.elasticsearch.common.lucene.Lucene.indexNeeds3xUpgrading(Lucene.java:767)\n        at org.elasticsearch.common.lucene.Lucene.upgradeLucene3xSegmentsMetadata(Lucene.java:778)\n        at org.elasticsearch.index.engine.InternalEngine.upgrade3xSegments(InternalEngine.java:1084)\n        at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:119)\n        ... 9 more\n```\n","closed_by":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"performed_via_github_app":null}