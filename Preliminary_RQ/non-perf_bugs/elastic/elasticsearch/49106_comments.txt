[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/554010062","html_url":"https://github.com/elastic/elasticsearch/issues/49106#issuecomment-554010062","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49106","id":554010062,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDAxMDA2Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-11-14T18:10:15Z","updated_at":"2019-11-14T18:10:15Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security (:Security/Authentication)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/554362519","html_url":"https://github.com/elastic/elasticsearch/issues/49106#issuecomment-554362519","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49106","id":554362519,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDM2MjUxOQ==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2019-11-15T13:41:25Z","updated_at":"2019-11-15T13:41:25Z","author_association":"CONTRIBUTOR","body":"Authentication with API Keys or tokens is thought to appear as if coming from the user itself, i.e. be transparent. Hence the API key name or id are not exposed in the user metadata. There is a lapse here, because the realm that did the authentication in case of API Key authentication is _es_api_key , but the realm name is not exposed in `Set Security User Processor`.\r\n\r\nIf we were to expose this information to an ingest processor then I would be inclined to add a new processor.\r\n\r\n@bytebilly can you please detail a little more the use case for this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/554863574","html_url":"https://github.com/elastic/elasticsearch/issues/49106#issuecomment-554863574","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49106","id":554863574,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDg2MzU3NA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-11-18T05:52:28Z","updated_at":"2019-11-18T05:52:28Z","author_association":"CONTRIBUTOR","body":"@albertzaharovits ES 7.5 will support [required pipelines](https://github.com/elastic/elasticsearch/pull/46847). This allows an admin to force that documents include information about how they were ingested.\r\nFor models where ingest tools (e.g. beats) are authenticating with API keys, knowing which API key performed the ingestion is necessary in order to know which client ingested the document.\r\n\r\nBecause we have not been able to enforce a pipeline until now, we haven't really kept `Set Security User Processor` up to date because it was so easy to by-pass.\r\nSince that has changed, we ought to expand that processor with additional fields (e.g. authentication type, realm name, and API key id/name). \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/554930365","html_url":"https://github.com/elastic/elasticsearch/issues/49106#issuecomment-554930365","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49106","id":554930365,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NDkzMDM2NQ==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2019-11-18T09:27:18Z","updated_at":"2019-11-18T09:27:18Z","author_association":"CONTRIBUTOR","body":"Thank you for the context @tvernum . I can now clearly see the need for it. Upon further reflection I think that the API Key id/name should be part of the `User` object we attach to the `ThreadContext` during authentication, and afterwards it should be simple for the `Set Security User Processor` to pull that into a doc field. Please let me know if this doesn't jibe with your idea for it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/555286144","html_url":"https://github.com/elastic/elasticsearch/issues/49106#issuecomment-555286144","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49106","id":555286144,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NTI4NjE0NA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-11-19T01:16:36Z","updated_at":"2019-11-19T01:16:36Z","author_association":"CONTRIBUTOR","body":"It probably makes sense for it to be on the `User` object for other reasons, but some of that information (original realm, key-id) is already in the `Authentication` object's metadata (and the name would be easy to add), so I think it's already fairly simple to add support in the `Set Security User Processor`.\r\n\r\nI prefer adding to the existing processor (as new optional fields) because then it becomes possible to have a single object in the ingested doc that contains full information about which user ingested it, and how they authenticated.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/555370207","html_url":"https://github.com/elastic/elasticsearch/issues/49106#issuecomment-555370207","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49106","id":555370207,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NTM3MDIwNw==","user":{"login":"bytebilly","id":52658645,"node_id":"MDQ6VXNlcjUyNjU4NjQ1","avatar_url":"https://avatars0.githubusercontent.com/u/52658645?v=4","gravatar_id":"","url":"https://api.github.com/users/bytebilly","html_url":"https://github.com/bytebilly","followers_url":"https://api.github.com/users/bytebilly/followers","following_url":"https://api.github.com/users/bytebilly/following{/other_user}","gists_url":"https://api.github.com/users/bytebilly/gists{/gist_id}","starred_url":"https://api.github.com/users/bytebilly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bytebilly/subscriptions","organizations_url":"https://api.github.com/users/bytebilly/orgs","repos_url":"https://api.github.com/users/bytebilly/repos","events_url":"https://api.github.com/users/bytebilly/events{/privacy}","received_events_url":"https://api.github.com/users/bytebilly/received_events","type":"User","site_admin":false},"created_at":"2019-11-19T07:23:33Z","updated_at":"2019-11-19T07:23:33Z","author_association":"NONE","body":"I agree on improving the `Set Security User Processor`, this will make easier for users to build their pipelines since they don't have to know in advance it authentication comes from users or keys.","performed_via_github_app":null}]