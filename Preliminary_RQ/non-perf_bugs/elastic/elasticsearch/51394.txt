{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51394","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51394/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51394/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51394/events","html_url":"https://github.com/elastic/elasticsearch/issues/51394","id":554615425,"node_id":"MDU6SXNzdWU1NTQ2MTU0MjU=","number":51394,"title":"Breaking change in 7.x.y for date format","user":{"login":"faxm0dem","id":112638,"node_id":"MDQ6VXNlcjExMjYzOA==","avatar_url":"https://avatars2.githubusercontent.com/u/112638?v=4","gravatar_id":"","url":"https://api.github.com/users/faxm0dem","html_url":"https://github.com/faxm0dem","followers_url":"https://api.github.com/users/faxm0dem/followers","following_url":"https://api.github.com/users/faxm0dem/following{/other_user}","gists_url":"https://api.github.com/users/faxm0dem/gists{/gist_id}","starred_url":"https://api.github.com/users/faxm0dem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/faxm0dem/subscriptions","organizations_url":"https://api.github.com/users/faxm0dem/orgs","repos_url":"https://api.github.com/users/faxm0dem/repos","events_url":"https://api.github.com/users/faxm0dem/events{/privacy}","received_events_url":"https://api.github.com/users/faxm0dem/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-01-24T09:00:08Z","updated_at":"2020-01-24T21:58:56Z","closed_at":"2020-01-24T21:58:56Z","author_association":"NONE","active_lock_reason":null,"body":"During my upgrade from 6.8.6 to 7.5.1 I discovered that the date formats don't parse anymore.\r\nThere's a difference in how timezones are parsed (`Z`).\r\n\r\nIn 6.8.6 this works:\r\n\r\n```\r\n6.8.6☠ PUT test\r\nHTTP/1.1 200 OK\r\ncontent-length: 63\r\ncontent-type: application/json; charset=UTF-8\r\n\r\n{\r\n    \"acknowledged\": true,\r\n    \"index\": \"test\",\r\n    \"shards_acknowledged\": true\r\n}\r\n\r\n6.8.6☠ PUT test/_doc/_mapping <<<'{\"properties\":{\"time\":{\"type\":\"date\",\"format\":\"'\"YYYY-MM-dd'T'HH:mm:ssZ\"'\"}}}'\r\nHTTP/1.1 200 OK\r\nWarning: 299 Elasticsearch-6.8.6-3d9f765 \"[types removal] Specifying types in put mapping requests is deprecated. To be compatible with 7.0, the mapping definition should not be nested under the type name, and the parameter include_type_name must be provided and set to false.\"\r\ncontent-length: 21\r\ncontent-type: application/json; charset=UTF-8\r\n\r\n{\r\n    \"acknowledged\": true\r\n}\r\n\r\n6.8.6☠ POST test/_doc <<<'{\"time\":\"2019-01-23T12:10:00+01:00\"}'\r\nHTTP/1.1 201 Created\r\nLocation: /test/_doc/697C1m8Bzi_qg7-P99RF\r\ncontent-length: 171\r\ncontent-type: application/json; charset=UTF-8\r\n\r\n{\r\n    \"_id\": \"697C1m8Bzi_qg7-P99RF\",\r\n    \"_index\": \"test\",\r\n    \"_primary_term\": 1,\r\n    \"_seq_no\": 0,\r\n    \"_shards\": {\r\n        \"failed\": 0,\r\n        \"successful\": 2,\r\n        \"total\": 2\r\n    },\r\n    \"_type\": \"_doc\",\r\n    \"_version\": 1,\r\n    \"result\": \"created\"\r\n}\r\n```\r\n\r\nIn 7.5.1 it fails:\r\n\r\n```\r\n7.5.1☠ PUT test\r\nHTTP/1.1 200 OK\r\ncontent-length: 63\r\ncontent-type: application/json; charset=UTF-8\r\n\r\n{\r\n    \"acknowledged\": true,\r\n    \"index\": \"test\",\r\n    \"shards_acknowledged\": true\r\n}\r\n\r\n7.5.1☠ PUT test/_mapping <<<'{\"properties\":{\"time\":{\"type\":\"date\",\"format\":\"'\"YYYY-MM-dd'T'HH:mm:ssZ\"'\"}}}'\r\nHTTP/1.1 200 OK\r\ncontent-length: 21\r\ncontent-type: application/json; charset=UTF-8\r\n\r\n{\r\n    \"acknowledged\": true\r\n}\r\n\r\n7.5.1☠ POST test/_doc <<<'{\"time\":\"2019-01-23T12:10:00+01:00\"}'\r\nHTTP/1.1 400 Bad Request\r\ncontent-length: 720\r\ncontent-type: application/json; charset=UTF-8\r\n\r\n{\r\n    \"error\": {\r\n        \"caused_by\": {\r\n            \"caused_by\": {\r\n                \"reason\": \"date_time_parse_exception: Text '2019-01-23T12:10:00+01:00' could not be parsed at index 19\",\r\n                \"type\": \"date_time_parse_exception\"\r\n            },\r\n            \"reason\": \"failed to parse date field [2019-01-23T12:10:00+01:00] with format [YYYY-MM-dd'T'HH:mm:ssZ]\",\r\n            \"type\": \"illegal_argument_exception\"\r\n        },\r\n        \"reason\": \"failed to parse field [time] of type [date] in document with id '_enA1m8BLwBLCwEtLLjx'. Preview of field's value: '2019-01-23T12:10:00+01:00'\",\r\n        \"root_cause\": [\r\n            {\r\n                \"reason\": \"failed to parse field [time] of type [date] in document with id '_enA1m8BLwBLCwEtLLjx'. Preview of field's value: '2019-01-23T12:10:00+01:00'\",\r\n                \"type\": \"mapper_parsing_exception\"\r\n            }\r\n        ],\r\n        \"type\": \"mapper_parsing_exception\"\r\n    },\r\n    \"status\": 400\r\n}\r\n```\r\n\r\nAfter some trial and error, I discovered that I needed to specify as many `Z` as tere were characters for the timezone. So this format works in 7.5.1: `YYYY-MM-dd'T'HH:mm:ssZZZZZ`, but it doesn't in 6.8.6.","closed_by":{"login":"faxm0dem","id":112638,"node_id":"MDQ6VXNlcjExMjYzOA==","avatar_url":"https://avatars2.githubusercontent.com/u/112638?v=4","gravatar_id":"","url":"https://api.github.com/users/faxm0dem","html_url":"https://github.com/faxm0dem","followers_url":"https://api.github.com/users/faxm0dem/followers","following_url":"https://api.github.com/users/faxm0dem/following{/other_user}","gists_url":"https://api.github.com/users/faxm0dem/gists{/gist_id}","starred_url":"https://api.github.com/users/faxm0dem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/faxm0dem/subscriptions","organizations_url":"https://api.github.com/users/faxm0dem/orgs","repos_url":"https://api.github.com/users/faxm0dem/repos","events_url":"https://api.github.com/users/faxm0dem/events{/privacy}","received_events_url":"https://api.github.com/users/faxm0dem/received_events","type":"User","site_admin":false},"performed_via_github_app":null}