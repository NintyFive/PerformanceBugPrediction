[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/339982254","html_url":"https://github.com/elastic/elasticsearch/issues/27134#issuecomment-339982254","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27134","id":339982254,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTk4MjI1NA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-10-27T14:09:41Z","updated_at":"2017-10-27T14:09:41Z","author_association":"MEMBER","body":"> No docs should be returned, because in the all test docs contain \"la\" and \"hoya\" within 100 tokens of eachother.\r\n\r\nThe `span_not` query removes matches which overlap with another SpanQuery **or which are within x tokens before or y tokens after another SpanQuery**.\r\nIn the example query, documents that contain `hoya` alone are considered as a match. This is the expected behavior, `hoya la hoya` will match because `hoya` is within 1 token of `la hoya`.\r\nAs you noticed `pre` and `post` can be used to control the `x` and `y` which default to 0.\r\nI opened #27150 to clarify this behavior in the documentation.\r\n\r\nIf you want to remove `span_near` matches exclusively you can use a simple `bool` query:\r\n\r\n```\r\n{  \r\n   \"query\":{  \r\n      \"bool\":{  \r\n         \"must\":[  \r\n            {  \r\n               \"span_term\":{  \r\n                  \"field1\":\"hoya\"\r\n               }\r\n            }\r\n         ],\r\n         \"must_not\":[  \r\n            {  \r\n               \"span_near\":{  \r\n                  \"clauses\":[  \r\n                     {  \r\n                        \"span_term\":{  \r\n                           \"field1\":\"la\"\r\n                        }\r\n                     },\r\n                     {  \r\n                        \"span_term\":{  \r\n                           \"field1\":\"hoya\"\r\n                        }\r\n                     }\r\n                  ],\r\n                  \"slop\":0,\r\n                  \"in_order\":true\r\n               }\r\n            }\r\n         ]\r\n      }\r\n   }\r\n}\r\n```\r\n\r\nThe `span_not` query  implies a relation between the `include` and `exclude` clause which is why it's an advanced case that requires some understanding of `span` queries in general.\r\n\r\n\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/339989413","html_url":"https://github.com/elastic/elasticsearch/issues/27134#issuecomment-339989413","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27134","id":339989413,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTk4OTQxMw==","user":{"login":"gcampbell-epiq","id":7549112,"node_id":"MDQ6VXNlcjc1NDkxMTI=","avatar_url":"https://avatars2.githubusercontent.com/u/7549112?v=4","gravatar_id":"","url":"https://api.github.com/users/gcampbell-epiq","html_url":"https://github.com/gcampbell-epiq","followers_url":"https://api.github.com/users/gcampbell-epiq/followers","following_url":"https://api.github.com/users/gcampbell-epiq/following{/other_user}","gists_url":"https://api.github.com/users/gcampbell-epiq/gists{/gist_id}","starred_url":"https://api.github.com/users/gcampbell-epiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gcampbell-epiq/subscriptions","organizations_url":"https://api.github.com/users/gcampbell-epiq/orgs","repos_url":"https://api.github.com/users/gcampbell-epiq/repos","events_url":"https://api.github.com/users/gcampbell-epiq/events{/privacy}","received_events_url":"https://api.github.com/users/gcampbell-epiq/received_events","type":"User","site_admin":false},"created_at":"2017-10-27T14:35:27Z","updated_at":"2017-10-27T14:35:27Z","author_association":"NONE","body":"Thanks, Jim. I'll look into filing a bug with Lucene on the other issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/339989671","html_url":"https://github.com/elastic/elasticsearch/issues/27134#issuecomment-339989671","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27134","id":339989671,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTk4OTY3MQ==","user":{"login":"gcampbell-epiq","id":7549112,"node_id":"MDQ6VXNlcjc1NDkxMTI=","avatar_url":"https://avatars2.githubusercontent.com/u/7549112?v=4","gravatar_id":"","url":"https://api.github.com/users/gcampbell-epiq","html_url":"https://github.com/gcampbell-epiq","followers_url":"https://api.github.com/users/gcampbell-epiq/followers","following_url":"https://api.github.com/users/gcampbell-epiq/following{/other_user}","gists_url":"https://api.github.com/users/gcampbell-epiq/gists{/gist_id}","starred_url":"https://api.github.com/users/gcampbell-epiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gcampbell-epiq/subscriptions","organizations_url":"https://api.github.com/users/gcampbell-epiq/orgs","repos_url":"https://api.github.com/users/gcampbell-epiq/repos","events_url":"https://api.github.com/users/gcampbell-epiq/events{/privacy}","received_events_url":"https://api.github.com/users/gcampbell-epiq/received_events","type":"User","site_admin":false},"created_at":"2017-10-27T14:36:18Z","updated_at":"2017-10-27T14:36:18Z","author_association":"NONE","body":"Closed by accident, sorry.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/340405884","html_url":"https://github.com/elastic/elasticsearch/issues/27134#issuecomment-340405884","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27134","id":340405884,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDQwNTg4NA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-10-30T10:37:09Z","updated_at":"2017-10-30T10:37:09Z","author_association":"MEMBER","body":">  I'll look into filing a bug with Lucene on the other issue.\r\n\r\nIt's not really a bug, just an overflow if you use a very high `dist` value. Don't do that and use a `must_not` clause instead. `dist` (and the others)  could be limited to some values on the es side but that's really a detail if you know what this option does.","performed_via_github_app":null}]