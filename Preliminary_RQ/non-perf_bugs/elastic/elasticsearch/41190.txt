{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41190","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41190/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41190/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41190/events","html_url":"https://github.com/elastic/elasticsearch/issues/41190","id":433214579,"node_id":"MDU6SXNzdWU0MzMyMTQ1Nzk=","number":41190,"title":"Incorrect date value (pushed back by 3 months) stored in index","user":{"login":"varunsharma27","id":18154526,"node_id":"MDQ6VXNlcjE4MTU0NTI2","avatar_url":"https://avatars1.githubusercontent.com/u/18154526?v=4","gravatar_id":"","url":"https://api.github.com/users/varunsharma27","html_url":"https://github.com/varunsharma27","followers_url":"https://api.github.com/users/varunsharma27/followers","following_url":"https://api.github.com/users/varunsharma27/following{/other_user}","gists_url":"https://api.github.com/users/varunsharma27/gists{/gist_id}","starred_url":"https://api.github.com/users/varunsharma27/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/varunsharma27/subscriptions","organizations_url":"https://api.github.com/users/varunsharma27/orgs","repos_url":"https://api.github.com/users/varunsharma27/repos","events_url":"https://api.github.com/users/varunsharma27/events{/privacy}","received_events_url":"https://api.github.com/users/varunsharma27/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-04-15T10:47:05Z","updated_at":"2019-04-15T11:26:59Z","closed_at":"2019-04-15T11:26:59Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.5.4\r\n\r\n**JVM version** (`java -version`): 1.8.0_171\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Ubuntu 17.10\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nValue of date field with custom formatting `YYYY/MM/DD hh:mm:ss a` is pushed back by 3 months and this messes up with all the queries. `_source` remains intact as JSON is saved as-is in Elasticsearch.\r\n![image](https://user-images.githubusercontent.com/18154526/56126826-b4296400-5f73-11e9-9a0e-b567974f670b.png)\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Set index mapping:\r\n```\r\nPUT date-test\r\n{\r\n  \"mappings\": {\r\n    \"doc\": {\r\n      \"properties\": {\r\n        \"INCIDENTDATE\": {\r\n          \"type\": \"date\"\r\n        },\r\n        \"INCIDENTDATETIME\": {\r\n          \"type\": \"date\",\r\n          \"format\": \"YYYY/MM/DD hh:mm:ss a\"\r\n        },\r\n        \"INCIDENTID\": {\r\n          \"type\": \"long\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n 2. Put Data:\r\n```\r\nPUT date-test/doc/663183\r\n{\r\n  \"INCIDENTDATETIME\": \"2018/04/27 03:11:00 PM\",\r\n  \"INCIDENTDATE\": \"2018-04-27T00:00:00.000Z\",\r\n  \"INCIDENTID\": 663183\r\n}\r\n```\r\n 3. Run the agg to get `actual` stored value of `INCIDENTDATETIME`\r\n```\r\nGET date-test/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [\r\n        {\r\n          \"match\": {\r\n            \"_id\": \"663183\"\r\n          }\r\n        },\r\n        {\r\n          \"range\": {\r\n            \"INCIDENTDATE\": {\r\n              \"gte\": 1523833200000,\r\n              \"lte\": 1525042800000,\r\n              \"format\": \"epoch_millis\"\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  \"aggs\": {\r\n    \"dateHist:INCIDENTDATETIME\": {\r\n      \"date_histogram\": {\r\n        \"field\": \"INCIDENTDATETIME\",\r\n        \"interval\": \"1h\",\r\n        \"min_doc_count\": 1\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nThe time is pushed back by 3 months:\r\n![image](https://user-images.githubusercontent.com/18154526/56126772-952ad200-5f73-11e9-866e-e976bdbad22a.png)\r\n\r\nYou may also change to `range` filter to `INCIDENTDATETIME` and no documents would be returned in that case.\r\n**Provide logs (if relevant)**: None","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}