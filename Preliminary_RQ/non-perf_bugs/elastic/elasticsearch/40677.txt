{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/40677","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40677/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40677/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40677/events","html_url":"https://github.com/elastic/elasticsearch/issues/40677","id":427577651,"node_id":"MDU6SXNzdWU0Mjc1Nzc2NTE=","number":40677,"title":"[CI] CcrRollingUpgradeIT.testBiDirectionalIndexFollowing fails reproducibly in 6.7","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"labels":[{"id":912824565,"node_id":"MDU6TGFiZWw5MTI4MjQ1NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CCR","name":":Distributed/CCR","color":"0e8a16","default":false,"description":"Issues around the Cross Cluster State Replication features"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1283161565,"node_id":"MDU6TGFiZWwxMjgzMTYxNTY1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.7.1","name":"v6.7.1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2019-04-01T08:35:50Z","updated_at":"2019-04-02T09:52:10Z","closed_at":"2019-04-02T09:52:09Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"CcrRollingUpgradeIT.testBiDirectionalIndexFollowing is failing in the 6.7 BWC tests:\r\n\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.7+bwc-tests/216/console\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.7+bwc-tests/217/console\r\n\r\nThe exception is:\r\n\r\n```\r\n   > Throwable #1: org.elasticsearch.client.ResponseException: method [PUT], host [http://[::1]:40247], URI [/follower_index6/_ccr/follow], status line [HTTP/1.1 400 Bad Request]\r\n   > {\"error\":{\"root_cause\":[{\"type\":\"remote_transport_exception\",\"reason\":\"[node-1][127.0.0.1:42344][indices:admin/xpack/ccr/put_follow]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"no index stats available for the leader index\"},\"status\":400}\r\n   >    at __randomizedtesting.SeedInfo.seed([3191D00E20B9D5EB:E9516F3EA88AB21D]:0)\r\n   >    at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:936)\r\n   >    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:233)\r\n   >    at org.elasticsearch.upgrades.CcrRollingUpgradeIT.followIndex(CcrRollingUpgradeIT.java:315)\r\n   >    at org.elasticsearch.upgrades.CcrRollingUpgradeIT.testBiDirectionalIndexFollowing(CcrRollingUpgradeIT.java:250)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:567)\r\n   >    at java.base/java.lang.Thread.run(Thread.java:835)\r\n   > Caused by: org.elasticsearch.client.ResponseException: method [PUT], host [http://[::1]:40247], URI [/follower_index6/_ccr/follow], status line [HTTP/1.1 400 Bad Request]\r\n   > {\"error\":{\"root_cause\":[{\"type\":\"remote_transport_exception\",\"reason\":\"[node-1][127.0.0.1:42344][indices:admin/xpack/ccr/put_follow]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"no index stats available for the leader index\"},\"status\":400}\r\n   >    at org.elasticsearch.client.RestClient$1.completed(RestClient.java:552)\r\n   >    at org.elasticsearch.client.RestClient$1.completed(RestClient.java:537)\r\n   >    at org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n   >    at org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n   >    at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n   >    ... 1 more\r\n```\r\n\r\nThis reproduces locally every time on a CentOS 7 machine using:\r\n\r\n```\r\n./gradlew :x-pack:qa:rolling-upgrade-multi-cluster:v6.7.0#bwcTest -Dtests.seed=3191D00E20B9D5EB -Dtests.class=org.elasticsearch.upgrades.CcrRollingUpgradeIT\r\n```","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}