{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29326","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29326/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29326/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29326/events","html_url":"https://github.com/elastic/elasticsearch/issues/29326","id":310231116,"node_id":"MDU6SXNzdWUzMTAyMzExMTY=","number":29326,"title":"2.4.1 disk.watermark.low doesn't work","user":{"login":"iPush","id":899754,"node_id":"MDQ6VXNlcjg5OTc1NA==","avatar_url":"https://avatars2.githubusercontent.com/u/899754?v=4","gravatar_id":"","url":"https://api.github.com/users/iPush","html_url":"https://github.com/iPush","followers_url":"https://api.github.com/users/iPush/followers","following_url":"https://api.github.com/users/iPush/following{/other_user}","gists_url":"https://api.github.com/users/iPush/gists{/gist_id}","starred_url":"https://api.github.com/users/iPush/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iPush/subscriptions","organizations_url":"https://api.github.com/users/iPush/orgs","repos_url":"https://api.github.com/users/iPush/repos","events_url":"https://api.github.com/users/iPush/events{/privacy}","received_events_url":"https://api.github.com/users/iPush/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-03-31T10:35:24Z","updated_at":"2018-04-03T02:53:24Z","closed_at":"2018-04-01T22:19:30Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 2.4.1\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):j ava version \"1.8.0_101\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_101-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.101-b13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):Linux A02-R05-I220-73.JD.LOCAL 2.6.32-504.16.2.el6.x86_64 #1 SMP Wed Apr 22 06:48:29 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\n\r\n 1. disk section of elasticsearch.yml\r\ncluster.routing.allocation.allow_rebalance: indices_all_active\r\ncluster.routing.allocation.disk.watermark.high: 100gb\r\ncluster.routing.allocation.disk.watermark.low: 200gb\r\n\r\n 2. \r\n[admin@A02-R05-I220-73 config]$ curl -s localhost:9200/_cat/allocation\r\n881   1.1tb   1.1tb 493.5gb 1.6tb 70\r\n881   1.1tb   1.1tb 492.5gb 1.6tb 70 \r\n147  74.7gb  75.7gb   1.5tb 1.6tb  4 \r\n880   1.1tb   1.1tb 518.2gb 1.6tb 69 \r\n881   1.1tb   1.1tb 501.6gb 1.6tb 70 \r\n881     1tb     1tb 548.9gb 1.6tb 67 \r\n880   1.1tb   1.1tb 493.8gb 1.6tb 70\r\n880   1.1tb   1.1tb 530.9gb 1.6tb 68 \r\n881   1.1tb   1.1tb 538.1gb 1.6tb 67 \r\n878 811.2gb   814gb   8.8tb 9.5tb  8 \r\n881   1.1tb   1.1tb   513gb 1.6tb 69 \r\n881     1tb     1tb 560.4gb 1.6tb 66 \r\n879 977.6gb   1.3tb 297.4gb 1.6tb 82 \r\n880   1.1tb   1.1tb 491.8gb 1.6tb 70\r\n881   1.1tb   1.2tb 132.9gb 1.3tb 90  ******** WEIRD ONE **********\r\n881   1.1tb   1.1tb 537.4gb 1.6tb 67 \r\n880   1.1tb   1.1tb 520.2gb 1.6tb 68 \r\n881   1.1tb   1.1tb 481.9gb 1.6tb 71 \r\n878   889gb 894.3gb   8.7tb 9.5tb  9 1\r\n881   1.1tb   1.1tb 541.5gb 1.6tb 67 \r\n\r\n3. the WEIRD ONE , disk.available < 200G, but es still allocates new shards to it.\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}