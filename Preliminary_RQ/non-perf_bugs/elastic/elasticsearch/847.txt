{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/847","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/847/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/847/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/847/events","html_url":"https://github.com/elastic/elasticsearch/issues/847","id":752869,"node_id":"MDU6SXNzdWU3NTI4Njk=","number":847,"title":"Search that works with curl and SearchPhaseExecutionException when playing with Java","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2011-04-11T07:55:18Z","updated_at":"2013-02-25T09:58:27Z","closed_at":"2011-05-13T19:52:13Z","author_association":"MEMBER","active_lock_reason":null,"body":"Issue described in the mailing list : http://elasticsearch-users.115913.n3.nabble.com/Search-that-works-with-curl-but-throw-SearchPhaseExecutionException-when-using-Java-tp2762593p2762593.html\n\nPushing document in a clean ES index :\n    curl -XPUT http://localhost:9200/test/dossier/1 -d '{\"conformite\":\"CONFORME\", \"direction\":\"DIRECTION\", \"domaine\":{\"reglementationsConcernees\":[\"REG\"], \"supportsDeclaratifsForES\":[{\"SupportDeclaratif\":{\"specificite\":{\"SpecifSDec\":{\"regime\":\"1234\"}}, \"typesVerifications\":[\"DOC\"], \"controlesPhysiques\":[{\"ControleMarchandise\":{\"conclusions\":[{\"Conclusion\":{\"reconnu\":\"1\", \"typePrecision\":\"VIDE\", \"conclusionCtrl\":\"CONFORME\", \"declare\":\"1\", \"typeAttributMarchandise\":\"NOMENCLATURE\"}}, {\"Conclusion\":{\"reconnu\":\"586.0\", \"typePrecision\":\"VIDE\", \"conclusionCtrl\":\"CONFORME\", \"declare\":\"586.0\", \"typeAttributMarchandise\":\"MASSE_NETTE\"}}]}}], \"bureauDouane\":{\"ServiceAdministrationDouane\":{\"europa\":\"FR00000\", \"nom\":\"Bureau\"}}, \"conclusion\":\"null\", \"infractions\":[], \"date\":\"2011-04-01T08:00:00.000+0000\", \"reference\":\"11111\", \"controlesDocumentaires\":[{\"ControleDocument\":{\"categorieLibelle\":\"Libelle\", \"typePrecision\":\"null\", \"categorieCode\":\"9999\", \"typeConclusionControle\":\"CONFORME\"}}, {\"ControleDocument\":{\"categorieLibelle\":\"Facture\", \"typePrecision\":\"null\", \"categorieCode\":\"8888\", \"typeConclusionControle\":\"CONFORME\"}}]}}]}, \"type\":\"DOUANE\", \"sources\":[{\"type\":\"CRIT\"}], \"dateDebut\":\"2011-04-01T10:00:00.000+0000\", \"etat\":\"VALIDE\", \"agentsRoles\":[{\"personne\":{\"Agent\":{\"nom\":\"MOI\", \"personnesIdentifiantsForES\":[{\"identifiant\":\"login\"}]}}, \"typesRoles\":[\"REDACTEUR\"]}], \"lieuControle\":\"Bureau\", \"service\":{\"ServiceAdministrationDouane\":{\"europa\":\"FR00000\", \"nom\":\"Bureau\"}}, \"personnesControlees\":[{\"personne\":{\"PersonneMorale\":{\"nom\":\"MYCOMP\", \"personnesIdentifiantsForES\":[{\"identifiant\":\"MYEORI\"}, {\"identifiant\":\"MYSIRET\"}]}}, \"role\":\"DECLARANT\"}], \"identifiant\":\"66566767\"}'\n\nWorks.\n\nSearch it with curl :\n    curl -XGET \"http://localhost:9200/test/dossier/_search\" -d '{\"query\":{\"term\":{\"dossier.domaine.supportsDeclaratifsForES.SupportDeclaratif.reference\":\"11111\"}}}'\n\nWorks.\n\nDo it with Java :\n    SearchResponse response = client.prepareSearch(\"test\")\n          .setSearchType(SearchType.DFS_QUERY_THEN_FETCH)\n          .setQuery(termQuery(\"dossier.domaine.supportsDeclaratifsForES.SupportDeclaratif.reference\", \"11111\"))\n          .setExplain(true)\n          .execute()\n          .actionGet();\n\nFails with a SearchPhaseExecutionException.\n    Failed :\n    org.elasticsearch.action.search.SearchPhaseExecutionException: Failed to execute phase [dfs], total failure; shardFailures {[1IOMpS32QuSLMWkQkGG4iQ][test][0]: RemoteTransportException[[Lord Dark Wind][inet[/10.115.1.111:9300]][search/phase/dfs]]; nested: SearchParseException[[test][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [_na_]]]; nested: RuntimeException[Internal error: this code path should never get executed]; }{[1IOMpS32QuSLMWkQkGG4iQ][test][2]: RemoteTransportException[[Lord Dark Wind][inet[/10.115.1.111:9300]][search/phase/dfs]]; nested: SearchParseException[[test][2]: from[-1],size[-1]: Parse Failure [Failed to parse source [_na_]]]; nested: RuntimeException[Internal error: this code path should never get executed]; }{[1IOMpS32QuSLMWkQkGG4iQ][test][3]: RemoteTransportException[[Lord Dark Wind][inet[/10.115.1.111:9300]][search/phase/dfs]]; nested: SearchParseException[[test][3]: from[-1],size[-1]: Parse Failure [Failed to parse source [_na_]]]; nested: RuntimeException[Internal error: this code path should never get executed]; }{[1IOMpS32QuSLMWkQkGG4iQ][test][1]: RemoteTransportException[[Lord Dark Wind][inet[/10.115.1.111:9300]][search/phase/dfs]]; nested: SearchParseException[[test][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [_na_]]]; nested: RuntimeException[Internal error: this code path should never get executed]; }{[1IOMpS32QuSLMWkQkGG4iQ][test][4]: RemoteTransportException[[Lord Dark Wind][inet[/10.115.1.111:9300]][search/phase/dfs]]; nested: SearchParseException[[test][4]: from[-1],size[-1]: Parse Failure [Failed to parse source [_na_]]]; nested: RuntimeException[Internal error: this code path should never get executed]; }\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.onFirstPhaseResult(TransportSearchTypeAction.java:248)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.access$400(TransportSearchTypeAction.java:75)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$3.onFailure(TransportSearchTypeAction.java:198)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$1.handleException(SearchServiceTransportAction.java:119)\n        at org.elasticsearch.transport.netty.MessageChannelHandler.handleException(MessageChannelHandler.java:158)\n        at org.elasticsearch.transport.netty.MessageChannelHandler.handlerResponseError(MessageChannelHandler.java:149)\n        at org.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(MessageChannelHandler.java:100)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:80)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:545)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:754)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:302)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:317)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:299)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:214)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:80)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:545)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:540)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:274)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:261)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:349)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.processSelectedKeys(NioWorker.java:280)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:200)\n        at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:44)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:636)\n\nI would like to attach a maven project to reproduce the bug but I can't find a way to do it in github issues...\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}