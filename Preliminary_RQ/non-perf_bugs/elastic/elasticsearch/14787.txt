{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14787","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14787/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14787/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14787/events","html_url":"https://github.com/elastic/elasticsearch/issues/14787","id":117227264,"node_id":"MDU6SXNzdWUxMTcyMjcyNjQ=","number":14787,"title":"Dynamic (inline) groovy scripts that parse JSON do not work with 2.0","user":{"login":"plebedev","id":5315507,"node_id":"MDQ6VXNlcjUzMTU1MDc=","avatar_url":"https://avatars2.githubusercontent.com/u/5315507?v=4","gravatar_id":"","url":"https://api.github.com/users/plebedev","html_url":"https://github.com/plebedev","followers_url":"https://api.github.com/users/plebedev/followers","following_url":"https://api.github.com/users/plebedev/following{/other_user}","gists_url":"https://api.github.com/users/plebedev/gists{/gist_id}","starred_url":"https://api.github.com/users/plebedev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/plebedev/subscriptions","organizations_url":"https://api.github.com/users/plebedev/orgs","repos_url":"https://api.github.com/users/plebedev/repos","events_url":"https://api.github.com/users/plebedev/events{/privacy}","received_events_url":"https://api.github.com/users/plebedev/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":11,"created_at":"2015-11-16T21:56:39Z","updated_at":"2016-04-01T19:44:04Z","closed_at":"2016-04-01T18:53:55Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I'm trying to migrate from 1.7 to 2.0 and I can't get my existing dynamic groovy script to work with ES. \nFirst, I added this line to elasticsearch.yml:\n_script.inline: on_\n\nWith just this line I'm getting an error when I try to do bulk update with the following script for each update action:\n`final Script updateScript = new Script(\"event = new groovy.json.JsonSlurper().parseText(_event);ctx._source.events += event\", \n                                           ScriptType.INLINE, \"groovy\", ImmutableMap.of(\"_event\", eventJson));`\n\nI'm getting the error when I execute the action:\n_GroovyScriptExecutionException[failed to run inline script [event = new groovy.json.JsonSlurper().parseText(_event);ctx._source.events += event] using lang [groovy]]; nested: NotSerializableExceptionWrapper[Could not initialize class groovy.json.internal.JsonParserCharArray];_\n\nWhen I add these lines to elasticsearch.yml:\n_script.engine.groovy.inline.aggs: on\nscript.engine.groovy.inline.mapping: on\nscript.engine.groovy.inline.search: on\nscript.engine.groovy.inline.update: on\nscript.engine.groovy.inline.plugin: on_\n\nand try to execute an update with the same script, I get this error:\n_GroovyScriptExecutionException[failed to run inline script [event = new groovy.json.JsonSlurper().parseText(_event);ctx._source.events += event] using lang [groovy]]; nested: NotSerializableExceptionWrapper; nested: SecurityException[access denied (\"java.util.PropertyPermission\" \"groovy.json.internKeys\" \"read\")];_\n\nI tried to add \n`permission java.util.PropertyPermission \"groovy.json.internKeys\", \"read\";`\nto java.policy file but it did not help.\n\nI see  `permission java.util.PropertyPermission \"*\", \"read,write\";`\nin org/elasticsearch/bootstrap/security.policy, so it is not clear to me why I'm getting this permission error unless groovy runs with its own security manager that does not \n\nThe same script with 1.7 worked.\n\nI have few other scripts for score functions that do not use JSON, and these work fine.\n\nThanks,\nPeter.\n","closed_by":{"login":"plebedev","id":5315507,"node_id":"MDQ6VXNlcjUzMTU1MDc=","avatar_url":"https://avatars2.githubusercontent.com/u/5315507?v=4","gravatar_id":"","url":"https://api.github.com/users/plebedev","html_url":"https://github.com/plebedev","followers_url":"https://api.github.com/users/plebedev/followers","following_url":"https://api.github.com/users/plebedev/following{/other_user}","gists_url":"https://api.github.com/users/plebedev/gists{/gist_id}","starred_url":"https://api.github.com/users/plebedev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/plebedev/subscriptions","organizations_url":"https://api.github.com/users/plebedev/orgs","repos_url":"https://api.github.com/users/plebedev/repos","events_url":"https://api.github.com/users/plebedev/events{/privacy}","received_events_url":"https://api.github.com/users/plebedev/received_events","type":"User","site_admin":false},"performed_via_github_app":null}