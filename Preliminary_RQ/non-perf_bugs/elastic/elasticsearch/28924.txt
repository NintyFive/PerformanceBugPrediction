{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28924","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28924/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28924/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28924/events","html_url":"https://github.com/elastic/elasticsearch/issues/28924","id":303101500,"node_id":"MDU6SXNzdWUzMDMxMDE1MDA=","number":28924,"title":"Search for a parent and all it's children in one query in elastic search","user":{"login":"RishuK","id":8846064,"node_id":"MDQ6VXNlcjg4NDYwNjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/8846064?v=4","gravatar_id":"","url":"https://api.github.com/users/RishuK","html_url":"https://github.com/RishuK","followers_url":"https://api.github.com/users/RishuK/followers","following_url":"https://api.github.com/users/RishuK/following{/other_user}","gists_url":"https://api.github.com/users/RishuK/gists{/gist_id}","starred_url":"https://api.github.com/users/RishuK/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RishuK/subscriptions","organizations_url":"https://api.github.com/users/RishuK/orgs","repos_url":"https://api.github.com/users/RishuK/repos","events_url":"https://api.github.com/users/RishuK/events{/privacy}","received_events_url":"https://api.github.com/users/RishuK/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-03-07T13:38:44Z","updated_at":"2018-03-07T17:19:41Z","closed_at":"2018-03-07T16:07:49Z","author_association":"NONE","active_lock_reason":null,"body":"Referring to the examples mentioned in the official documentation of building a parent-child relationship - https://www.elastic.co/guide/en/elasticsearch/reference/current/parent-join.html\r\n\r\nThe link has provided question-answer join relationship where question is a parent and answer is a child type.\r\n\r\nIf you need to search for all parents matching some text along with their children matching some text specific to children in one query, how would you do that?\r\n\r\nLet's say they have key-value pairs in the json document as below and we search for parents matching a text in the question and children matching a value in answer-text.\r\n\r\nParent --> question --> \"question-text\" : \"Geography: Where is Mt. Everest?\"\r\nChild --> answer --> \"answer-text\" : \"Nepal?\"\r\nWe do not want just parents or just children in the result but all parents with their associated children which matched the query.\r\n\r\nI know inner hits is an option but could not figure out the usage - https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-inner-hits.html\r\n\r\nI hope the question is clear, can add more details if needed.\r\n\r\nI also tried the example mentioned here for parent-child inner hits:\r\n\r\nExample:\r\n\r\nPOST labelling_index/_search\r\n    {\r\n      \"query\": {\r\n        \"has_child\": {\r\n          \"type\": \"child\",\r\n          \"query\": {\r\n            \"match\": {\r\n              \"number\": 2\r\n            }\r\n          },\r\n          \"inner_hits\": {}    \r\n        }\r\n      }\r\n    }\r\nThis gives me the matching children of all parents. How do I add a filter to the parent and query only for specific parents in the same query (along with the child filter)? Is it possible to filter parent records on a specific field in the same query?","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}