{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25920","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25920/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25920/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25920/events","html_url":"https://github.com/elastic/elasticsearch/issues/25920","id":245874332,"node_id":"MDU6SXNzdWUyNDU4NzQzMzI=","number":25920,"title":"Null pointer exception on _exists_ query with an empty index that has no type","user":{"login":"msimos","id":11743255,"node_id":"MDQ6VXNlcjExNzQzMjU1","avatar_url":"https://avatars3.githubusercontent.com/u/11743255?v=4","gravatar_id":"","url":"https://api.github.com/users/msimos","html_url":"https://github.com/msimos","followers_url":"https://api.github.com/users/msimos/followers","following_url":"https://api.github.com/users/msimos/following{/other_user}","gists_url":"https://api.github.com/users/msimos/gists{/gist_id}","starred_url":"https://api.github.com/users/msimos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msimos/subscriptions","organizations_url":"https://api.github.com/users/msimos/orgs","repos_url":"https://api.github.com/users/msimos/repos","events_url":"https://api.github.com/users/msimos/events{/privacy}","received_events_url":"https://api.github.com/users/msimos/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2017-07-26T22:33:40Z","updated_at":"2017-08-01T14:46:03Z","closed_at":"2017-08-01T14:46:03Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**:\r\n\r\n5.5.1\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\n\r\n1.8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\nFedora Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nUsing an exists query results in a null pointer exception when using an empty index without any type. The query should not throw an exception and should just return zero results.\r\n\r\n**Steps to reproduce**:\r\n```\r\nPUT xyz1\r\n\r\nGET xyz1/_search\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"query\": \"_exists_:req_size\"\r\n    }\r\n  }\r\n}\r\n```\r\nResults in:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"query_shard_exception\",\r\n        \"reason\": \"failed to create query: {\\n  \\\"query_string\\\" : {\\n    \\\"query\\\" : \\\"_exists_:req_size\\\",\\n    \\\"fields\\\" : [ ],\\n    \\\"use_dis_max\\\" : true,\\n    \\\"tie_breaker\\\" : 0.0,\\n    \\\"default_operator\\\" : \\\"or\\\",\\n    \\\"auto_generate_phrase_queries\\\" : false,\\n    \\\"max_determinized_states\\\" : 10000,\\n    \\\"enable_position_increments\\\" : true,\\n    \\\"fuzziness\\\" : \\\"AUTO\\\",\\n    \\\"fuzzy_prefix_length\\\" : 0,\\n    \\\"fuzzy_max_expansions\\\" : 50,\\n    \\\"phrase_slop\\\" : 0,\\n    \\\"escape\\\" : false,\\n    \\\"split_on_whitespace\\\" : true,\\n    \\\"boost\\\" : 1.0\\n  }\\n}\",\r\n        \"index_uuid\": \"RHs-MtYOSKaQvIEgSqra4Q\",\r\n        \"index\": \"xyz1\"\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"xyz1\",\r\n        \"node\": \"tqrXTcKQTiCVMqZcNd8brg\",\r\n        \"reason\": {\r\n          \"type\": \"query_shard_exception\",\r\n          \"reason\": \"failed to create query: {\\n  \\\"query_string\\\" : {\\n    \\\"query\\\" : \\\"_exists_:req_size\\\",\\n    \\\"fields\\\" : [ ],\\n    \\\"use_dis_max\\\" : true,\\n    \\\"tie_breaker\\\" : 0.0,\\n    \\\"default_operator\\\" : \\\"or\\\",\\n    \\\"auto_generate_phrase_queries\\\" : false,\\n    \\\"max_determinized_states\\\" : 10000,\\n    \\\"enable_position_increments\\\" : true,\\n    \\\"fuzziness\\\" : \\\"AUTO\\\",\\n    \\\"fuzzy_prefix_length\\\" : 0,\\n    \\\"fuzzy_max_expansions\\\" : 50,\\n    \\\"phrase_slop\\\" : 0,\\n    \\\"escape\\\" : false,\\n    \\\"split_on_whitespace\\\" : true,\\n    \\\"boost\\\" : 1.0\\n  }\\n}\",\r\n          \"index_uuid\": \"RHs-MtYOSKaQvIEgSqra4Q\",\r\n          \"index\": \"xyz1\",\r\n          \"caused_by\": {\r\n            \"type\": \"null_pointer_exception\",\r\n            \"reason\": null\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nIf you add a mapping a different field name, then it works as you'd expect.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\nThis is from the Elasticsearch log file:\r\n\r\n```\r\nCaused by: java.lang.NullPointerException\r\n        at org.apache.lucene.queryparser.classic.ExistsFieldQueryExtension.query(ExistsFieldQueryExtension.java:40) ~[elasticsearch-5.5.1.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.apache.lucene.queryparser.classic.MapperQueryParser.getFieldQuery(MapperQueryParser.java:150) ~[elasticsearch-5.5.1.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.apache.lucene.queryparser.classic.QueryParserBase.handleBareTokenQuery(QueryParserBase.java:851) ~[lucene-queryparser-6.6.0.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.apache.lucene.queryparser.classic.QueryParser.Term(QueryParser.java:469) ~[lucene-queryparser-6.6.0.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.apache.lucene.queryparser.classic.QueryParser.Clause(QueryParser.java:355) ~[lucene-queryparser-6.6.0.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.apache.lucene.queryparser.classic.QueryParser.Query(QueryParser.java:244) ~[lucene-queryparser-6.6.0.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.apache.lucene.queryparser.classic.QueryParser.TopLevelQuery(QueryParser.java:215) ~[lucene-queryparser-6.6.0.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.apache.lucene.queryparser.classic.QueryParserBase.parse(QueryParserBase.java:111) ~[lucene-queryparser-6.6.0.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.apache.lucene.queryparser.classic.MapperQueryParser.parse(MapperQueryParser.java:824) ~[elasticsearch-5.5.1.jar:6.6.0 5c7a7b65d2aa7ce5ec96458315c661a18b320241 - ishan - 2017-05-30 07:30:08]\r\n        at org.elasticsearch.index.query.QueryStringQueryBuilder.doToQuery(QueryStringQueryBuilder.java:1036) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n```","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}