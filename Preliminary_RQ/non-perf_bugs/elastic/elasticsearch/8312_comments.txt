[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65631328","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-65631328","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":65631328,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NjMxMzI4","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"created_at":"2014-12-04T13:30:11Z","updated_at":"2014-12-04T13:30:11Z","author_association":"CONTRIBUTOR","body":"@gibrown have you seen increased segment memory usage after switching to `doc_values`? I've seen 2-8x increase (from 32mb to 70-270mb) per index with 120m events.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68455512","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-68455512","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":68455512,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NDU1NTEy","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-31T17:18:49Z","updated_at":"2014-12-31T17:21:50Z","author_association":"CONTRIBUTOR","body":"The JVM heap size is practically limited to 32GB - above this and the JVM can no longer use compressed pointers (resulting in more memory usage for the same data), and garbage collections become slower.  \n\nBy far the biggest user of the heap for most users is in-memory fielddata, used for sorting, aggregations and scripts. In-memory fielddata is slow to load, as it has to read the whole inverted index and uninvert it.  If the fielddata cache fills up, old data is evicted causing heap churn and bad performance (as fielddata is reloaded and evicted again.)\n\nDoc values provide the same function as in-memory fielddata, but the datastructure is written to disk at index time.  This results in more disk usage and somewhat slower indexing and mergging (because there is more I/O).  Aggregations and sorting are about 20% slower than they are with in-memory fielddata. \n\nThe advantages are:\n- less heap usage and faster garbage collections\n- no longer limited by the amount of fielddata that can fit into 32GB of heap - instead the file system caches can make use of all the available RAM \n- fewer latency spikes caused by reloading a large segment into memory\n\nUnfortunately, there is no way to back-fill these values without reindexing.  The proposal is to make doc values the default for all fields except `analyzed` string fields (which are not supported by doc values anyway).\n\nSome users will end up writing much more data than they need, but to be clear: this is a default setting which can be changed as appropriate.  It is similar to the fact that we index term positions by default on all `analyzed` string fields, so as to make phrase queries work out of the box.\n\nBefore making this decision, we need to understand the full impact of doc-values-by-default, by running the following tests:\n- ssd vs spinning disk\n- merge throttling enabled/disabled\n- non-string fields vs all not_analyzed fields\n- metric, logging, wikipedia\n- aggs\n- sorting asc and desc\n- multiple aggs and sorting combined\n\nAnd measuring the following:\n- Node stats after indexing (and always starting from zero)\n- number of segments before optimize\n- index size before/after optimize\n- indexing rate (docs/s)\n- query rate (docs/s)\n- query rate during heavy indexing\n- query rate during heavy indexing with eager loading\n- query rate during heavy indexing with eager global ordinals\n- logs for GC messages and index throttling messages\n\nWe need to do this at large scale with a billion documents, on nodes that are properly tuned (eg ES_HEAP, mlockall etc)\n\nTwo further proposals:\n- Turn off fielddata loading for `analyzed` string fields by default.  It is too easy to blow up memory usage by sorting or aggregating on an analyzed string field, and it is seldom what the user intended.  If the user really does want to run aggregations on an analyzed string field, then it is an easy option to enable on an existing index.\n- Default `not_analyzed` string fields to have `ignore_above` set to (eg) 255 characters, as it seldom makes sense to index or write doc values for such large terms\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/78903123","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-78903123","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":78903123,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTAzMTIz","user":{"login":"bharvidixit","id":10341430,"node_id":"MDQ6VXNlcjEwMzQxNDMw","avatar_url":"https://avatars3.githubusercontent.com/u/10341430?v=4","gravatar_id":"","url":"https://api.github.com/users/bharvidixit","html_url":"https://github.com/bharvidixit","followers_url":"https://api.github.com/users/bharvidixit/followers","following_url":"https://api.github.com/users/bharvidixit/following{/other_user}","gists_url":"https://api.github.com/users/bharvidixit/gists{/gist_id}","starred_url":"https://api.github.com/users/bharvidixit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bharvidixit/subscriptions","organizations_url":"https://api.github.com/users/bharvidixit/orgs","repos_url":"https://api.github.com/users/bharvidixit/repos","events_url":"https://api.github.com/users/bharvidixit/events{/privacy}","received_events_url":"https://api.github.com/users/bharvidixit/received_events","type":"User","site_admin":false},"created_at":"2015-03-13T10:20:53Z","updated_at":"2015-03-13T10:21:33Z","author_association":"NONE","body":"@clintongormley what if i enable doc_values=true for the metadata _id field? Will it have some effect?  \"_id\": {\n          \"store\": true,\n          \"index\": \"not_analyzed\",\n          \"doc_values\": true,\n          \"path\": \"id\"\n        }\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/81378471","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-81378471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":81378471,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzc4NDcx","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-03-16T03:24:27Z","updated_at":"2015-03-16T03:24:27Z","author_association":"CONTRIBUTOR","body":"@bharvidixit Actually we are also thinking about having doc values enabled on `_uid` too. This way, random sorting (which mostly merges a seed with a hash of the _uid to be reproducible) would not need to load fielddata on the _uid field (which takes a lot of memory all the time since this field is unique by definition). And it could also help have consistent pagination by tie-breaking on the `_uid` instead of the internal lucene doc ids (since they are not the same on all copies of a shard).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87075133","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-87075133","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":87075133,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MDc1MTMz","user":{"login":"gibrown","id":820871,"node_id":"MDQ6VXNlcjgyMDg3MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/820871?v=4","gravatar_id":"","url":"https://api.github.com/users/gibrown","html_url":"https://github.com/gibrown","followers_url":"https://api.github.com/users/gibrown/followers","following_url":"https://api.github.com/users/gibrown/following{/other_user}","gists_url":"https://api.github.com/users/gibrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gibrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gibrown/subscriptions","organizations_url":"https://api.github.com/users/gibrown/orgs","repos_url":"https://api.github.com/users/gibrown/repos","events_url":"https://api.github.com/users/gibrown/events{/privacy}","received_events_url":"https://api.github.com/users/gibrown/received_events","type":"User","site_admin":false},"created_at":"2015-03-27T20:10:54Z","updated_at":"2015-03-27T20:10:54Z","author_association":"CONTRIBUTOR","body":"Awesome, Thanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87075967","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-87075967","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":87075967,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MDc1OTY3","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"created_at":"2015-03-27T20:15:32Z","updated_at":"2015-03-27T20:15:32Z","author_association":"CONTRIBUTOR","body":":+1: \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88660280","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-88660280","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":88660280,"node_id":"MDEyOklzc3VlQ29tbWVudDg4NjYwMjgw","user":{"login":"jknewman3","id":6268028,"node_id":"MDQ6VXNlcjYyNjgwMjg=","avatar_url":"https://avatars0.githubusercontent.com/u/6268028?v=4","gravatar_id":"","url":"https://api.github.com/users/jknewman3","html_url":"https://github.com/jknewman3","followers_url":"https://api.github.com/users/jknewman3/followers","following_url":"https://api.github.com/users/jknewman3/following{/other_user}","gists_url":"https://api.github.com/users/jknewman3/gists{/gist_id}","starred_url":"https://api.github.com/users/jknewman3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jknewman3/subscriptions","organizations_url":"https://api.github.com/users/jknewman3/orgs","repos_url":"https://api.github.com/users/jknewman3/repos","events_url":"https://api.github.com/users/jknewman3/events{/privacy}","received_events_url":"https://api.github.com/users/jknewman3/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T23:12:46Z","updated_at":"2015-04-02T16:46:55Z","author_association":"NONE","body":"Is it possible to set eager loading, or something like that, for doc_values? \nIt would be helpful for us to always have the most recently added data in cache.\nAnd, yeah, warmers could do it for us. Just wondering if eager applies only to JVM.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89023989","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-89023989","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":89023989,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MDIzOTg5","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-04-02T19:50:28Z","updated_at":"2015-04-02T19:50:28Z","author_association":"MEMBER","body":"@jknewman3 See discussions on #8693\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89054442","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-89054442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":89054442,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MDU0NDQy","user":{"login":"jknewman3","id":6268028,"node_id":"MDQ6VXNlcjYyNjgwMjg=","avatar_url":"https://avatars0.githubusercontent.com/u/6268028?v=4","gravatar_id":"","url":"https://api.github.com/users/jknewman3","html_url":"https://github.com/jknewman3","followers_url":"https://api.github.com/users/jknewman3/followers","following_url":"https://api.github.com/users/jknewman3/following{/other_user}","gists_url":"https://api.github.com/users/jknewman3/gists{/gist_id}","starred_url":"https://api.github.com/users/jknewman3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jknewman3/subscriptions","organizations_url":"https://api.github.com/users/jknewman3/orgs","repos_url":"https://api.github.com/users/jknewman3/repos","events_url":"https://api.github.com/users/jknewman3/events{/privacy}","received_events_url":"https://api.github.com/users/jknewman3/received_events","type":"User","site_admin":false},"created_at":"2015-04-02T21:47:29Z","updated_at":"2015-04-02T21:47:29Z","author_association":"NONE","body":"Ah, that helps a lot. Thanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/128312060","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-128312060","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":128312060,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODMxMjA2MA==","user":{"login":"bolee","id":2450909,"node_id":"MDQ6VXNlcjI0NTA5MDk=","avatar_url":"https://avatars1.githubusercontent.com/u/2450909?v=4","gravatar_id":"","url":"https://api.github.com/users/bolee","html_url":"https://github.com/bolee","followers_url":"https://api.github.com/users/bolee/followers","following_url":"https://api.github.com/users/bolee/following{/other_user}","gists_url":"https://api.github.com/users/bolee/gists{/gist_id}","starred_url":"https://api.github.com/users/bolee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bolee/subscriptions","organizations_url":"https://api.github.com/users/bolee/orgs","repos_url":"https://api.github.com/users/bolee/repos","events_url":"https://api.github.com/users/bolee/events{/privacy}","received_events_url":"https://api.github.com/users/bolee/received_events","type":"User","site_admin":false},"created_at":"2015-08-06T09:53:32Z","updated_at":"2015-08-06T09:53:32Z","author_association":"NONE","body":"how to set doc_value=true, via api to set every field?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/128313166","html_url":"https://github.com/elastic/elasticsearch/issues/8312#issuecomment-128313166","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8312","id":128313166,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODMxMzE2Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-08-06T10:00:01Z","updated_at":"2015-08-06T10:00:01Z","author_association":"CONTRIBUTOR","body":"@bolee please ask questions like that in the forum: https://discuss.elastic.co/\n","performed_via_github_app":null}]