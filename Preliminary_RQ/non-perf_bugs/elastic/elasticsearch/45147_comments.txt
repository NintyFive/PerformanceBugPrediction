[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/517761456","html_url":"https://github.com/elastic/elasticsearch/issues/45147#issuecomment-517761456","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45147","id":517761456,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNzc2MTQ1Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-02T16:19:54Z","updated_at":"2019-08-02T16:19:54Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/517761585","html_url":"https://github.com/elastic/elasticsearch/issues/45147#issuecomment-517761585","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45147","id":517761585,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNzc2MTU4NQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-08-02T16:20:18Z","updated_at":"2019-08-02T16:20:18Z","author_association":"MEMBER","body":"Labeling Security since it seems the NPE is related to `CompositeRolesStore`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/525423135","html_url":"https://github.com/elastic/elasticsearch/issues/45147#issuecomment-525423135","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45147","id":525423135,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTQyMzEzNQ==","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2019-08-27T18:19:54Z","updated_at":"2019-08-27T19:30:29Z","author_association":"MEMBER","body":"+1  It appears to be failing when we are trying to get _xpack usage stats `bit_set_cache` for security's document level security (even in Gold subscription environments where the license does not grant access to DLS functionality)\r\n\r\n`/_xpack/usage` API throws the same NPE when requested directly via curl (as expected).  Note that `/_xpack` API works fine (because this one is higher level and does not try to determine if DLS/FLS is enabled):\r\n\r\n```\r\n[2019-08-27T12:05:40,141][WARN ][r.suppressed             ] [test_node] path: /_xpack/usage, params: {}\r\norg.elasticsearch.transport.RemoteTransportException: [test_node][IP:9300][cluster:monitor/xpack/usage]\r\nCaused by: java.lang.NullPointerException\r\n\tat org.elasticsearch.xpack.security.authz.store.CompositeRolesStore.usageStats(CompositeRolesStore.java:439) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.SecurityFeatureSet.usage(SecurityFeatureSet.java:133) ~[?:?]\r\n\tat org.elasticsearch.xpack.core.action.TransportXPackUsageAction.lambda$masterOperation$0(TransportXPackUsageAction.java:70) ~[?:?]\r\n\tat org.elasticsearch.xpack.core.common.IteratingActionListener.onResponse(IteratingActionListener.java:117) ~[?:?]\r\n\tat org.elasticsearch.xpack.core.action.TransportXPackUsageAction$2.onResponse(TransportXPackUsageAction.java:75) ~[?:?]\r\n\tat org.elasticsearch.xpack.core.action.TransportXPackUsageAction$2.onResponse(TransportXPackUsageAction.java:70) ~[?:?]\r\n\tat org.elasticsearch.xpack.flattened.FlattenedFeatureSet.usage(FlattenedFeatureSet.java:52) ~[?:?]\r\n\tat org.elasticsearch.xpack.core.action.TransportXPackUsageAction.lambda$masterOperation$0(TransportXPackUsageAction.java:70) ~[?:?]\r\n\tat org.elasticsearch.xpack.core.common.IteratingActionListener.run(IteratingActionListener.java:102) ~[?:?]\r\n\tat org.elasticsearch.xpack.core.action.TransportXPackUsageAction.masterOperation(TransportXPackUsageAction.java:93) ~[?:?]\r\n\tat org.elasticsearch.xpack.core.action.TransportXPackUsageAction.masterOperation(TransportXPackUsageAction.java:31) ~[?:?]\r\n\tat org.elasticsearch.action.support.master.TransportMasterNodeAction.masterOperation(TransportMasterNodeAction.java:127) ~[elasticsearch-7.3.0.jar:7.3.0]\r\n\tat org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$1.doRun(TransportMasterNodeAction.java:200) ~[elasticsearch-7.3.0.jar:7.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:758) ~[elasticsearch-7.3.0.jar:7.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-7.3.0.jar:7.3.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/525525667","html_url":"https://github.com/elastic/elasticsearch/issues/45147#issuecomment-525525667","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45147","id":525525667,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTUyNTY2Nw==","user":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"created_at":"2019-08-27T23:46:42Z","updated_at":"2019-08-27T23:46:42Z","author_association":"CONTRIBUTOR","body":"If you are looking for a **workaround**, you can enable the `dls_fls` by setting `xpack.security.dls_fls.enabled` to true. (By default it is set to true even if you do not have a license to use that feature).\r\nIf you have explicitly disabled that setting then you hit this bug.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/635775704","html_url":"https://github.com/elastic/elasticsearch/issues/45147#issuecomment-635775704","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45147","id":635775704,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNTc3NTcwNA==","user":{"login":"cawoodm","id":498834,"node_id":"MDQ6VXNlcjQ5ODgzNA==","avatar_url":"https://avatars2.githubusercontent.com/u/498834?v=4","gravatar_id":"","url":"https://api.github.com/users/cawoodm","html_url":"https://github.com/cawoodm","followers_url":"https://api.github.com/users/cawoodm/followers","following_url":"https://api.github.com/users/cawoodm/following{/other_user}","gists_url":"https://api.github.com/users/cawoodm/gists{/gist_id}","starred_url":"https://api.github.com/users/cawoodm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cawoodm/subscriptions","organizations_url":"https://api.github.com/users/cawoodm/orgs","repos_url":"https://api.github.com/users/cawoodm/repos","events_url":"https://api.github.com/users/cawoodm/events{/privacy}","received_events_url":"https://api.github.com/users/cawoodm/received_events","type":"User","site_admin":false},"created_at":"2020-05-29T05:55:38Z","updated_at":"2020-05-29T05:55:46Z","author_association":"CONTRIBUTOR","body":"> If you are looking for a workaround, you can enable the dls_fls by setting xpack.security.dls_fls.enabled to true. (By default it is set to true even if you do not have a license to use that feature).\r\n\r\n@bizybot : Don't you mean we should set `xpack.security.dls_fls.enabled: false` if we don't have a license??","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/635778245","html_url":"https://github.com/elastic/elasticsearch/issues/45147#issuecomment-635778245","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45147","id":635778245,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNTc3ODI0NQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-05-29T06:03:28Z","updated_at":"2020-05-29T06:03:28Z","author_association":"CONTRIBUTOR","body":"@cawoodm No, the bug here is that we were incorrectly trying to collect monitoring data about the bitset cache when DLS & FLS where disabled (so the cache did not exist).\r\n\r\n>  If you have explicitly disabled that setting then you hit this bug.\r\n\r\nYou should only see this bug if someone explicitly disabled that feature (regardless of whether or not its permitted on the current license).\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/635784344","html_url":"https://github.com/elastic/elasticsearch/issues/45147#issuecomment-635784344","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45147","id":635784344,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNTc4NDM0NA==","user":{"login":"cawoodm","id":498834,"node_id":"MDQ6VXNlcjQ5ODgzNA==","avatar_url":"https://avatars2.githubusercontent.com/u/498834?v=4","gravatar_id":"","url":"https://api.github.com/users/cawoodm","html_url":"https://github.com/cawoodm","followers_url":"https://api.github.com/users/cawoodm/followers","following_url":"https://api.github.com/users/cawoodm/following{/other_user}","gists_url":"https://api.github.com/users/cawoodm/gists{/gist_id}","starred_url":"https://api.github.com/users/cawoodm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cawoodm/subscriptions","organizations_url":"https://api.github.com/users/cawoodm/orgs","repos_url":"https://api.github.com/users/cawoodm/repos","events_url":"https://api.github.com/users/cawoodm/events{/privacy}","received_events_url":"https://api.github.com/users/cawoodm/received_events","type":"User","site_admin":false},"created_at":"2020-05-29T06:21:48Z","updated_at":"2020-05-29T06:21:48Z","author_association":"CONTRIBUTOR","body":"Oh. Well we have ELK 7.7 Basic and no `*dls_fls*` setting in elasticsearch.yml yet still we see on startup:\r\n```\r\n[2020-05-29T07:50:43,317][ERROR][o.e.x.m.c.c.ClusterStatsCollector] [ecom-repository01] collector [cluster_stats] failed to collect data\r\norg.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:551) ~[elasticsearch-7.7.0.jar:7.7.0]\r\n...\r\n```","performed_via_github_app":null}]