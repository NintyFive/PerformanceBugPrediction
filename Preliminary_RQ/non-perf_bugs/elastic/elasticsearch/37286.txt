{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37286","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37286/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37286/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37286/events","html_url":"https://github.com/elastic/elasticsearch/issues/37286","id":397664285,"node_id":"MDU6SXNzdWUzOTc2NjQyODU=","number":37286,"title":"es server always restart because of reading metadata file incorrectly","user":{"login":"kkewwei","id":16730433,"node_id":"MDQ6VXNlcjE2NzMwNDMz","avatar_url":"https://avatars1.githubusercontent.com/u/16730433?v=4","gravatar_id":"","url":"https://api.github.com/users/kkewwei","html_url":"https://github.com/kkewwei","followers_url":"https://api.github.com/users/kkewwei/followers","following_url":"https://api.github.com/users/kkewwei/following{/other_user}","gists_url":"https://api.github.com/users/kkewwei/gists{/gist_id}","starred_url":"https://api.github.com/users/kkewwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kkewwei/subscriptions","organizations_url":"https://api.github.com/users/kkewwei/orgs","repos_url":"https://api.github.com/users/kkewwei/repos","events_url":"https://api.github.com/users/kkewwei/events{/privacy}","received_events_url":"https://api.github.com/users/kkewwei/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-01-10T04:07:57Z","updated_at":"2020-07-23T07:53:18Z","closed_at":"2020-07-23T07:53:18Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"ES_VERSION: 5.6.8\r\nJVM version : JDK1.8.0_112\r\nOS version : linux\r\n**Description of the problem including expected versus actual behavior**:\r\nIt is often not appearing. when the machine is turned off because of hardware malfunction, the es server left the cluster for a long time passively. Aftertime the machine is ok and the es server restarts, the es service can automatically identify metadata as planed, but it reports those error logs and down. as the result es keeps cycling restarting and down\r\n**Provide logs (if relevant)**:\r\n1) Error injecting constructor, ElasticsearchException[java.io.IOException: failed to read [id:0, legacy:false, file:/data1/es_data/lc_gh_3/nodes/0/indices/rDD73n7GR7uw_vE0Fk1FrA/_state/state-0.st]]; nested: IOException[failed to read [id:0, legacy:false, file:/data1/es_data/lc_gh_3/nodes/0/indices/rDD73n7GR7uw_vE0Fk1FrA/_state/state-0.st]]; nested: CorruptStateException[org.apache.lucene.index.CorruptIndexException: codec footer mismatch (file truncated?): actual footer=758728244 vs expected footer=-1071082520 (resource=BufferedChecksumIndexInput(SimpleFSIndexInput(path=\"/data1/es_data/lc_gh_3/nodes/0/indices/rDD73n7GR7uw_vE0Fk1FrA/_state/state-0.st\")))]; nested: CorruptIndexException[codec footer mismatch (file truncated?): actual footer=758728244 vs expected footer=-1071082520 (resource=BufferedChecksumIndexInput(SimpleFSIndexInput(path=\"/data1/es_data/lc_gh_3/nodes/0/indices/rDD73n7GR7uw_vE0Fk1FrA/_state/state-0.st\")))];\r\n  at org.elasticsearch.gateway.GatewayMetaState.<init>(Unknown Source)\r\n  while locating org.elasticsearch.gateway.GatewayMetaState\r\n    for parameter 4 at org.elasticsearch.gateway.GatewayService.<init>(Unknown Source)\r\n  while locating org.elasticsearch.gateway.GatewayService\r\nCaused by: ElasticsearchException[java.io.IOException: failed to read [id:0, legacy:false, file:/data1/es_data/lc_gh_3/nodes/0/indices/rDD73n7GR7uw_vE0Fk1FrA/_state/state-0.st]]; nested: IOException[failed to read [id:0, legacy:false, file:/data1/es_data/lc_gh_3/nodes/0/indices/rDD73n7GR7uw_vE0Fk1FrA/_state/state-0.st]]; nested: CorruptStateException[org.apache.lucene.index.CorruptIndexException: codec footer mismatch (file truncated?): actual footer=758728244 vs expected footer=-1071082520 (resource=BufferedChecksumIndexInput(SimpleFSIndexInput(path=\"/data1/es_data/lc_gh_3/nodes/0/indices/rDD73n7GR7uw_vE0Fk1FrA/_state/state-0.st\")))]; nested: CorruptIndexException[codec footer mismatch (file truncated?): actual footer=758728244 vs expected footer=-1071082520 (resource=BufferedChecksumIndexInput(SimpleFSIndexInput(path=\"/data1/es_data/lc_gh_3/nodes/0/indices/rDD73n7GR7uw_vE0Fk1FrA/_state/state-0.st\")))];\r\n        at org.elasticsearch.ExceptionsHelper.maybeThrowRuntimeAndSuppress(ExceptionsHelper.java:190)\r\n        at org.elasticsearch.gateway.MetaDataStateFormat.loadLatestState(MetaDataStateFormat.java:334)\r\n        at org.elasticsearch.common.util.IndexFolderUpgrader.upgrade(IndexFolderUpgrader.java:90)\r\n        at org.elasticsearch.common.util.IndexFolderUpgrader.upgradeIndicesIfNeeded(IndexFolderUpgrader.java:128)\r\n        at org.elasticsearch.gateway.GatewayMetaState.<init>(GatewayMetaState.java:91)\r\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\r\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\r\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\r\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)\r\n        at org.elasticsearch.common.inject.DefaultConstructionProxyFactory$1.newInstance(DefaultConstructionProxyFactory.java:49)\r\n        at org.elasticsearch.common.inject.ConstructorInjector.construct(ConstructorInjector.java:86)\r\n        at org.elasticsearch.common.inject.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:116)\r\n        at org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter$1.call(ProviderToInternalFactoryAdapter.java:47)\r\n        at org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:825)\r\n        at org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:43)\r\n        at org.elasticsearch.common.inject.Scopes$1$1.get(Scopes.java:59)\r\n        at org.elasticsearch.common.inject.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:50)\r\n        at org.elasticsearch.common.inject.SingleParameterInjector.inject(SingleParameterInjector.java:42)\r\n        at org.elasticsearch.common.inject.SingleParameterInjector.getAll(SingleParameterInjector.java:66)\r\n        at org.elasticsearch.common.inject.ConstructorInjector.construct(ConstructorInjector.java:85)\r\n        at org.elasticsearch.common.inject.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:116)\r\n        at org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter$1.call(ProviderToInternalFactoryAdapter.java:47)\r\n        at org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:825)\r\n        at org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:43)\r\n        at org.elasticsearch.common.inject.Scopes$1$1.get(Scopes.java:59)\r\n        at org.elasticsearch.common.inject.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:50)\r\n        at org.elasticsearch.common.inject.InjectorBuilder$1.call(InjectorBuilder.java:191)\r\n        at org.elasticsearch.common.inject.InjectorBuilder$1.call(InjectorBuilder.java:183)\r\n        at org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:818)\r\n        at org.elasticsearch.common.inject.InjectorBuilder.loadEagerSingletons(InjectorBuilder.java:183)\r\n        at org.elasticsearch.common.inject.InjectorBuilder.loadEagerSingletons(InjectorBuilder.java:173)\r\n        at org.elasticsearch.common.inject.InjectorBuilder.injectDynamically(InjectorBuilder.java:161)\r\n        at org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:96)\r\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:96)\r\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:70)\r\n        at org.elasticsearch.common.inject.ModulesBuilder.createInjector(ModulesBuilder.java:42)\r\n        at org.elasticsearch.node.Node.<init>(Node.java:499)\r\n        at org.elasticsearch.node.Node.<init>(Node.java:245)\r\n        at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:233)\r\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:233)\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:342)\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:132)\r\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:123)\r\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:70)\r\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}