[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28873800","html_url":"https://github.com/elastic/elasticsearch/issues/4214#issuecomment-28873800","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4214","id":28873800,"node_id":"MDEyOklzc3VlQ29tbWVudDI4ODczODAw","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2013-11-20T09:31:54Z","updated_at":"2013-11-20T09:31:54Z","author_association":"MEMBER","body":"Hi,\n\nIf the count returns the right number it means that the document were indexed on at least some of the shards but potentially not on all replicas. ES uses sync replication and an indexing request will return when the data is stored safely according to your replication settings.\n\nWhile this obviously abuses the system (and yes BulkProcessor is the way to go and will probably be faster as well because of having to allocate so much memory and GC it), I'd like to figure you why things hang for you as they shouldn't.\n\nCan you please send the code you are using (or a small recreation if the code is long). I would also like to know the version of ES you are using plus the index settings (number of shards & replicas etc.)?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28905061","html_url":"https://github.com/elastic/elasticsearch/issues/4214#issuecomment-28905061","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4214","id":28905061,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTA1MDYx","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2013-11-20T16:38:00Z","updated_at":"2013-11-20T16:38:00Z","author_association":"MEMBER","body":"also, were there any exception that you maybe saw in your code? for example, and OOM?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28915793","html_url":"https://github.com/elastic/elasticsearch/issues/4214#issuecomment-28915793","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4214","id":28915793,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTE1Nzkz","user":{"login":"madheshr","id":5872998,"node_id":"MDQ6VXNlcjU4NzI5OTg=","avatar_url":"https://avatars3.githubusercontent.com/u/5872998?v=4","gravatar_id":"","url":"https://api.github.com/users/madheshr","html_url":"https://github.com/madheshr","followers_url":"https://api.github.com/users/madheshr/followers","following_url":"https://api.github.com/users/madheshr/following{/other_user}","gists_url":"https://api.github.com/users/madheshr/gists{/gist_id}","starred_url":"https://api.github.com/users/madheshr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/madheshr/subscriptions","organizations_url":"https://api.github.com/users/madheshr/orgs","repos_url":"https://api.github.com/users/madheshr/repos","events_url":"https://api.github.com/users/madheshr/events{/privacy}","received_events_url":"https://api.github.com/users/madheshr/received_events","type":"User","site_admin":false},"created_at":"2013-11-20T18:37:26Z","updated_at":"2013-11-20T23:56:24Z","author_association":"NONE","body":"Hi\nThanks for the quick response.\n\n@bleskes:  While i would expect some kind of delay in replication, in my scenario i had set number of replicas to 0. I also set the refresh interval to -1 (for the initial bulk index).  My idea was to change it later.  Is this causing the problem?\n\n@kimchy:  No, i did not see any OOM or other exception.  The code prints the Start timestamp as expected and it just hangs.\n\n Here's the piece of code.  My elasticsearch version is\nVersion: 0.90.5, Build: c8714e8/2013-09-17T12:50:20Z, JVM: 1.6.0_65.  Also the size of each document is very small  (only in the range of 400 - 500 Bytes)\n\n```\npublic static void main(String[] args)\n{\n\n    try\n    {\n\n        // Initialization \n        prop.load(DataLoader.class.getClassLoader().getResourceAsStream(\n            \"config.properties\"));\n        clusterName = prop.getProperty(\"CLUSTER_NAME\");\n            hostName = prop.getProperty(\"HOST_NAME\");\n            portNo = Integer.parseInt(prop.getProperty(\"PORT_NO\"));\n\n        dateFormat = new SimpleDateFormat(\"yyyy/MM/dd HH:mm:ss.SSS\");\n\n\n        Settings settings = ImmutableSettings\n            .settingsBuilder()\n            .put(\"cluster.name\",clusterName)\n            .build();\n         client = new TransportClient(settings)\n           .addTransportAddress(new InetSocketTransportAddress(hostName,portNo));\n\n        // Building the index with specific settings\n        Builder settings = ImmutableSettings.settingsBuilder()\n                .put(\"index.number_of_shards\", 10)\n                   .put(\"index.number_of_replicas\", 0)\n                   .put(\"refresh_interval\",-1);\n\n            CreateIndexRequestBuilder cirb = client.admin().indices().prepareCreate(prop.getProperty(\"INDEX_NAME\"));\n            cirb.setSettings(settings);\n            CreateIndexResponse createIndexResponse = cirb.execute().actionGet();\n\n            //if (!createIndexResponse.isAcknowledged()) throw new Exception(\"Could not create index\");\n\n        if(args.length>0)\n            fileName = args[0];\n        else\n            fileName = prop.getProperty(\"INPUT_FILE\");\n    } catch (IOException e)\n    {\n        // TODO Auto-generated catch block\n        System.out.println(\"Error initializing..check property file / classpath\");\n    } catch (Exception e)\n    {\n        // TODO Auto-generated catch block\n        e.printStackTrace();\n    }\n    try\n    {       \n            System.out.println(\"Trying to read From File    \"+fileName);\n            reader = new BufferedReader(new FileReader(fileName));\n            String line = null;\n            while ((line = reader.readLine()) != null) \n            {\n                //System.out.println(line);\n                // Forming the bulk request\n                bulkRequest.add(client.prepareIndex(prop.getProperty(\"INDEX_NAME\"),prop.getProperty(\"INDEX_TYPE\"))   \n                            .setSource(line));\n            }\n\n            System.out.println(\"Number of requests in Bulk batch = \"+bulkRequest.numberOfActions());\n            System.out.println(\"START TIME:  \"+dateFormat.format(new Date()));\n\n            BulkResponse bulkResponse = bulkRequest.execute().actionGet();\n            if (bulkResponse.hasFailures()) {\n\n                // process failures by iterating through each bulk response item\n                System.out.println(\"RESPONSE ERRORS\");\n            }\n            System.out.println(\"END   TIME:  \"+dateFormat.format(new Date()));\n            System.out.println(\"All done\");\n\n            //changeIndexSettings();\n\n    } \n    catch(ActionRequestValidationException ex)\n    {\n        System.out.println(\"Validation Exception\"+ex.getMessage());\n\n    }\n    catch (IOException ioe) \n    {\n        System.err.println(\"oops \" + ioe.getMessage());\n    }\n    catch(Exception e)\n    {\n        System.out.println(\"Exception occured.....\");\n        e.printStackTrace();\n\n    }\n    finally\n    {\n        try\n        {\n\n            reader.close();\n            client.close();\n\n        } catch (IOException e)\n        {\n            // TODO Auto-generated catch block\n            System.out.println(\"File Error\");\n            e.printStackTrace();\n        }\n    }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28916492","html_url":"https://github.com/elastic/elasticsearch/issues/4214#issuecomment-28916492","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4214","id":28916492,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTE2NDky","user":{"login":"madheshr","id":5872998,"node_id":"MDQ6VXNlcjU4NzI5OTg=","avatar_url":"https://avatars3.githubusercontent.com/u/5872998?v=4","gravatar_id":"","url":"https://api.github.com/users/madheshr","html_url":"https://github.com/madheshr","followers_url":"https://api.github.com/users/madheshr/followers","following_url":"https://api.github.com/users/madheshr/following{/other_user}","gists_url":"https://api.github.com/users/madheshr/gists{/gist_id}","starred_url":"https://api.github.com/users/madheshr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/madheshr/subscriptions","organizations_url":"https://api.github.com/users/madheshr/orgs","repos_url":"https://api.github.com/users/madheshr/repos","events_url":"https://api.github.com/users/madheshr/events{/privacy}","received_events_url":"https://api.github.com/users/madheshr/received_events","type":"User","site_admin":false},"created_at":"2013-11-20T18:45:24Z","updated_at":"2013-11-20T18:45:24Z","author_association":"NONE","body":"Hi\n\n I have posted a detailed response on the Github issues page itself.  Hope\nthat works better.\n\nThanks\nMadhesh\n\nOn Wed, Nov 20, 2013 at 8:38 AM, Shay Banon notifications@github.comwrote:\n\n> also, were there any exception that you maybe saw in your code? for\n> example, and OOM?\n> \n> —\n> Reply to this email directly or view it on GitHubhttps://github.com/elasticsearch/elasticsearch/issues/4214#issuecomment-28905061\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29069253","html_url":"https://github.com/elastic/elasticsearch/issues/4214#issuecomment-29069253","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4214","id":29069253,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDY5MjUz","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2013-11-22T12:35:02Z","updated_at":"2013-11-22T12:35:02Z","author_association":"MEMBER","body":"Hi @madheshr \n\nThanks for the code. I tried to reproduce both on 0.90.5 and current version but failed. I added a test to our testing infrastructure, so it will keep on trying for us.\n\nBefore diving deeper, can I ask to try it again with 0.90.7? We've done some work on shard allocation and error handling in that area and I would like to double check this isn't already fixed.\n\nIf it fails for you, can I ask you for the data file you are using? Maybe the content of the document is important. Also, how many nodes are you using?\n\nCheers,\nBoaz\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/51641087","html_url":"https://github.com/elastic/elasticsearch/issues/4214#issuecomment-51641087","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4214","id":51641087,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNjQxMDg3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-08-08T18:36:29Z","updated_at":"2014-08-08T18:36:29Z","author_association":"CONTRIBUTOR","body":"No feedback since last year. Closing\n","performed_via_github_app":null}]