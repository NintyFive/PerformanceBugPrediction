{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48860","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48860/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48860/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48860/events","html_url":"https://github.com/elastic/elasticsearch/issues/48860","id":517722923,"node_id":"MDU6SXNzdWU1MTc3MjI5MjM=","number":48860,"title":"Default_operator ‘AND’ with query_string and multiple fields does not work properly","user":{"login":"Flinou","id":1483500,"node_id":"MDQ6VXNlcjE0ODM1MDA=","avatar_url":"https://avatars1.githubusercontent.com/u/1483500?v=4","gravatar_id":"","url":"https://api.github.com/users/Flinou","html_url":"https://github.com/Flinou","followers_url":"https://api.github.com/users/Flinou/followers","following_url":"https://api.github.com/users/Flinou/following{/other_user}","gists_url":"https://api.github.com/users/Flinou/gists{/gist_id}","starred_url":"https://api.github.com/users/Flinou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Flinou/subscriptions","organizations_url":"https://api.github.com/users/Flinou/orgs","repos_url":"https://api.github.com/users/Flinou/repos","events_url":"https://api.github.com/users/Flinou/events{/privacy}","received_events_url":"https://api.github.com/users/Flinou/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-11-05T11:44:10Z","updated_at":"2019-11-05T13:36:46Z","closed_at":"2019-11-05T13:13:09Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): \r\n\r\n> 7.2.0\r\n\r\n**JVM version** (`java -version`):\r\n\r\n> \r\n> openjdk version \"11.0.1\" 2018-10-16\r\n> OpenJDK Runtime Environment 18.9 (build 11.0.1+13)\r\n> OpenJDK 64-Bit Server VM 18.9 (build 11.0.1+13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\n> Linux 4b495c31e063 3.10.0-862.9.1.el7.x86_64 #1 SMP Mon Jul 16 16:29:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI have some issues trying to make default_operator 'AND' work with query_string on multiple fields. \r\nI have an index containing a document with those fields  : \r\n\r\n> \"content\" : \"attention pour la revision\"\r\n> \"main_title\" : \"voiture est dans le garage\"\r\n\r\nIf I launch the request below : \r\n```\r\nGET testeur/_search\r\n    {\r\n      \"query\": {\r\n        \"query_string\": {\r\n          \"query\": \"attention voiture\",\r\n          \"default_operator\": \"AND\",\r\n          \"fields\": [\"content\",\"main_title\"]\r\n        }\r\n      }\r\n   }\r\n\r\n```\r\nThe document is not retrieved. This behaviour does not seem consistent.\r\nThe document is retrieved specifying the operator AND directly in the query field though. \r\n\r\nExample : \r\n```\r\nGET testeur/_search\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"query\": \"attention AND voiture\",\r\n      \"fields\": [\"content\",\"main_title\"]\r\n    }\r\n  }\r\n}\r\n```\r\n**Steps to reproduce**:\r\n\r\n 1. Document creation : \r\n```\r\nPOST testeur/_doc/document\r\n{\r\n  \"content\": \"attention dans la revision\",\r\n  \"main_title\" : \"fichier dans la voiture\"\r\n}\r\n```\r\n\r\n 2. Get with default_operator AND\r\n```\r\nGET testeur/_search\r\n    {\r\n      \"query\": {\r\n        \"query_string\": {\r\n          \"query\": \"attention voiture\",\r\n          \"default_operator\": \"AND\",\r\n          \"fields\": [\"content\",\"main_title\"]\r\n        }\r\n      }\r\n    }\r\n```\r\n\r\n 3. Get with AND directly in the \"query\" field : \r\n```\r\nGET testeur/_search\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"query\": \"attention AND voiture\",\r\n      \"fields\": [\"content\",\"main_title\"]\r\n    }\r\n  }\r\n}\r\n```","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}