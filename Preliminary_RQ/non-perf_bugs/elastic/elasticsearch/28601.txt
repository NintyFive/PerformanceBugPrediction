{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601/events","html_url":"https://github.com/elastic/elasticsearch/issues/28601","id":295824040,"node_id":"MDU6SXNzdWUyOTU4MjQwNDA=","number":28601,"title":"Build fails with \"Could not dispatch a message to the daemon.\"","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":912911731,"node_id":"MDU6TGFiZWw5MTI5MTE3MzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.4.0","name":"v6.4.0","color":"DDDDDD","default":false,"description":""},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2018-02-09T10:31:57Z","updated_at":"2020-11-11T21:42:01Z","closed_at":"2018-05-11T21:32:16Z","author_association":"MEMBER","active_lock_reason":null,"body":"Example build failures:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=sles/2027/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=ubuntu/2027/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+bwc-tests/592/console\r\n\r\nAt first glance it seems like an issue with runbld as the end of the build output shows gradle reporting build success but runbld claiming that the wrapped process (i.e. gradle) exited with an error code:\r\n```\r\n07:17:50 BUILD SUCCESSFUL in 1h 16m 44s\r\n07:17:50 2566 actionable tasks: 2486 executed, 80 up-to-date\r\n07:17:50 Stopped 1 worker daemon(s).\r\n07:17:50 VCS Checkout Cache (/var/lib/jenkins/workspace/elastic+elasticsearch+master+multijob-unix-compatibility/os/sles/.gradle/vcsWorkingDirs) has not been cleaned up in 0 days\r\n07:17:54 runbld>>> <<<<<<<<<<<< SCRIPT EXECUTION END <<<<<<<<<<<<\r\n07:17:54 runbld>>> DURATION: 5453640ms\r\n07:17:54 runbld>>> STDOUT: 5054108 bytes\r\n07:17:54 runbld>>> STDERR: 50026 bytes\r\n07:17:54 runbld>>> WRAPPED PROCESS: FAILURE (1)\r\n07:17:54 runbld>>> Searching for build metadata in /var/lib/jenkins/workspace/elastic+elasticsearch+master+multijob-unix-compatibility/os/sles\r\n07:17:57 runbld>>> Storing build metadata: bwc_refspec_distribution:bwc-snapshot-6.x=c0561382a1fbe472df00f0e53098efcb19ccd380\r\n07:17:57 WARNING: An illegal reflective access operation has occurred\r\n07:17:57 WARNING: Illegal reflective access by clojure.lang.Reflector (file:/usr/local/src/runbld-1.5.9/runbld) to method com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl.parse(org.xml.sax.InputSource,org.xml.sax.helpers.DefaultHandler)\r\n07:17:57 WARNING: Please consider reporting this to the maintainers of clojure.lang.Reflector\r\n07:17:57 WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations\r\n07:17:57 WARNING: All illegal access operations will be denied in a future release\r\n07:18:15 runbld>>> FAILURES: 0\r\n07:18:16 runbld>>> BUILD: https://5086a1f436ee16623a447bdf25881bbc.us-east-1.aws.found.io:9243/build-1498188341992/t/20180209054652-D3C6ABEF\r\n07:21:54 runbld>>> MAILING: build-elasticsearch@e***.co\r\n07:21:55 runbld>>> Mail sent.  Output: {:code 0, :error :SUCCESS, :message \"messages sent\"}\r\n07:21:55 \r\n07:24:49 runbld>>> NOTIFYING SLACK\r\n07:24:54 Build step 'Execute shell' marked build as failure\r\n07:24:54 Archiving artifacts\r\n07:24:55 Sending e-mails to: infra-root+build@elastic.co\r\n07:24:57 Recording test results\r\n07:25:06 Finished: FAILURE\r\n```\r\n\r\nHowever if you search for `FAILURE` in the logs something like the following shows up:\r\n```\r\n07:17:49 :qa:wildfly:integTestCluster#configure (Thread[Task worker for ':' Thread 3,5,main]) completed. Took 0.0 secs.\r\n07:17:49 :qa:wildfly:integTestCluster#start (Thread[Task worker for ':' Thread 3,5,main]) started.\r\n07:17:49 \r\n07:17:49 :qa:wildfly:integTestCluster#start\r\n07:17:49 FAILURE: Build failed with an exception.\r\n07:17:49 \r\n07:17:49 * What went wrong:\r\n07:17:49 Could not dispatch a message to the daemon.\r\n07:17:49 \r\n07:17:49 * Try:\r\n07:17:49 Run with --stacktrace option to get the stack trace. Run with --debug option to get more log output. Run with --scan to get full insights.\r\n07:17:49 \r\n07:17:49 * Get more help at https://help.gradle.org\r\n07:17:49 Task ':qa:wildfly:integTestCluster#start' is not up-to-date because:\r\n07:17:49   Task has not declared any outputs.\r\n```\r\n\r\nThis failure seems to relate to the gradle daemon which according to the `gradle.properties` file in the root of the repo should not be used with our builds. Its also curious that this failure does not stop the build but rather it continues without any apparent further error.\r\n\r\nin the above build failure examples the two master builds (2027os=ubuntu and 2027os=sles) the failure seems to happen during the `:qa:wildfly:integTestCluster` tasks but in the 6.x bwc build it seems to happen in `:qa:verify-version-constants:v6.1.2#oldClusterTestCluster` tasks but these two gradle modules do not seem to share any groovy code so I am not sure what the common link between them could be.\r\n\r\nI did see in https://docs.gradle.org/current/userguide/gradle_daemon.html#sec:what_can_go_wrong_with_daemon that you can add `--no-daemon` to the command line to prevent the daemon form being used but I'm not sure if that is in fact something we should do, since the `gradle.properties` file should be stopping the daemon from being used anyway.\r\n\r\n/cc @jasontedor @rjernst ","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}