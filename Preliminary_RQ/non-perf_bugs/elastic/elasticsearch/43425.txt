{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43425","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43425/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43425/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43425/events","html_url":"https://github.com/elastic/elasticsearch/issues/43425","id":458645540,"node_id":"MDU6SXNzdWU0NTg2NDU1NDA=","number":43425,"title":"[CI] HistoryTemplateTransformMappingsTests testTransformFields fails with NPE","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-06-20T13:03:32Z","updated_at":"2019-10-07T20:28:53Z","closed_at":"2019-10-07T20:28:53Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Couldn't reproduce this. Happened once, not muting the test yet.\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.1+release-tests/57/console\r\n\r\n```\r\n  1> [2019-06-20T07:00:03,617][INFO ][o.e.x.w.h.HistoryTemplateTransformMappingsTests] [testTransformFields] [HistoryTemplateTransformMappingsTests#testTransformFields]: cleaned up after test\r\n  1> [2019-06-20T07:00:03,618][INFO ][o.e.x.w.h.HistoryTemplateTransformMappingsTests] [testTransformFields] after test\r\n  2> REPRODUCE WITH: ./gradlew :x-pack:plugin:watcher:test --tests \"org.elasticsearch.xpack.watcher.history.HistoryTemplateTransformMappingsTests.testTransformFields\" -Dtests.seed=BBEA64F9246FD0BE -Dtests.security.manager=true -Dbuild.snapshot=false -Dtests.jvm.argline=\"-Dbuild.snapshot=false\" -Dtests.locale=cs -Dtests.timezone=Asia/Tomsk -Dcompiler.java=12 -Druntime.java=8\r\n  2> java.lang.NullPointerException\r\n        at __randomizedtesting.SeedInfo.seed([BBEA64F9246FD0BE:2F3CED486D934AB5]:0)\r\n        at org.elasticsearch.xpack.watcher.history.HistoryTemplateTransformMappingsTests.lambda$testTransformFields$1(HistoryTemplateTransformMappingsTests.java:85)\r\n        at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\r\n        at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\r\n        at java.util.HashMap$ValueSpliterator.forEachRemaining(HashMap.java:1628)\r\n        at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\r\n        at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\r\n        at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)\r\n        at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n        at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)\r\n        at org.elasticsearch.xpack.watcher.history.HistoryTemplateTransformMappingsTests.lambda$testTransformFields$2(HistoryTemplateTransformMappingsTests.java:88)\r\n        at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:856)\r\n        at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:842)\r\n        at org.elasticsearch.xpack.watcher.history.HistoryTemplateTransformMappingsTests.testTransformFields(HistoryTemplateTransformMappingsTests.java:74)\r\n  1> [2019-06-20T07:00:03,638][INFO ][o.e.n.Node               ] [suite] stopping ...\r\n  1> [2019-06-20T07:00:03,638][INFO ][o.e.x.w.WatcherService   ] [suite] stopping watch service, reason [shutdown initiated]\r\n  1> [2019-06-20T07:00:03,647][INFO ][o.e.c.s.ClusterApplierService] [node_s1] master node changed {previous [{node_s0}{Wni2cs7ySv-VFI7MFhVDqA}{xSekpQUlQ324gbs5NbnSbg}{127.0.0.1}{127.0.0.1:49524}{xpack.installed=true}], current []}, term: 1, version: 43, reason: becoming candidate: onLeaderFailure\r\n  1> [2019-06-20T07:00:03,657][WARN ][o.e.c.NodeConnectionsService] [node_s1] failed to connect to node {node_s0}{Wni2cs7ySv-VFI7MFhVDqA}{xSekpQUlQ324gbs5NbnSbg}{127.0.0.1}{127.0.0.1:49524}{xpack.installed=true} (tried [1] times)\r\n  1> org.elasticsearch.transport.ConnectTransportException: [node_s0][127.0.0.1:49524] connect_exception\r\n  1> \tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onFailure(TcpTransport.java:1299) ~[elasticsearch-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.action.ActionListener.lambda$toBiConsumer$2(ActionListener.java:99) ~[elasticsearch-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.common.concurrent.CompletableContext.lambda$addListener$0(CompletableContext.java:42) ~[elasticsearch-core-7.1.2.jar:7.1.2]\r\n  1> \tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_212]\r\n  1> \tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_212]\r\n  1> \tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_212]\r\n  1> \tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_212]\r\n  1> \tat org.elasticsearch.common.concurrent.CompletableContext.completeExceptionally(CompletableContext.java:57) ~[elasticsearch-core-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.nio.SocketChannelContext.connect(SocketChannelContext.java:119) ~[elasticsearch-nio-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.nio.EventHandler.handleConnect(EventHandler.java:97) ~[elasticsearch-nio-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.transport.nio.TestingSocketEventHandler.handleConnect(TestingSocketEventHandler.java:43) ~[framework-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.nio.NioSelector.attemptConnect(NioSelector.java:406) ~[elasticsearch-nio-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.nio.NioSelector.setUpNewChannels(NioSelector.java:423) ~[elasticsearch-nio-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.nio.NioSelector.preSelect(NioSelector.java:260) ~[elasticsearch-nio-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:153) ~[elasticsearch-nio-7.1.2.jar:7.1.2]\r\n  1> \tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:129) ~[elasticsearch-nio-7.1.2.jar:7.1.2]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n  1> Caused by: java.net.ConnectException: Connection refused\r\n  1> \tat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:?]\r\n  1> \tat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:?]\r\n  1> \tat org.elasticsearch.nio.SocketChannelContext.connect(SocketChannelContext.java:116) ~[elasticsearch-nio-7.1.2.jar:7.1.2]\r\n  1> \t... 8 more\r\n  1> [2019-06-20T07:00:03,660][INFO ][o.e.n.Node               ] [suite] stopped\r\n  1> [2019-06-20T07:00:03,660][INFO ][o.e.n.Node               ] [suite] closing ...\r\n  1> [2019-06-20T07:00:03,688][INFO ][o.e.n.Node               ] [suite] closed\r\n  1> [2019-06-20T07:00:03,688][INFO ][o.e.n.Node               ] [suite] stopping ...\r\n  1> [2019-06-20T07:00:03,692][INFO ][o.e.x.w.WatcherService   ] [suite] stopping watch service, reason [shutdown initiated]\r\n  1> [2019-06-20T07:00:03,703][INFO ][o.e.n.Node               ] [suite] stopped\r\n  1> [2019-06-20T07:00:03,703][INFO ][o.e.n.Node               ] [suite] closing ...\r\n  1> [2019-06-20T07:00:03,733][INFO ][o.e.n.Node               ] [suite] closed\r\n```","closed_by":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}