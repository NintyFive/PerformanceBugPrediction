{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48547","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48547/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48547/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48547/events","html_url":"https://github.com/elastic/elasticsearch/issues/48547","id":512714241,"node_id":"MDU6SXNzdWU1MTI3MTQyNDE=","number":48547,"title":"Method threw 'java.lang.NoSuchFieldError' exception. Cannot evaluate org.elasticsearch.action.index.IndexRequest.toString()","user":{"login":"tadijam64","id":21061194,"node_id":"MDQ6VXNlcjIxMDYxMTk0","avatar_url":"https://avatars3.githubusercontent.com/u/21061194?v=4","gravatar_id":"","url":"https://api.github.com/users/tadijam64","html_url":"https://github.com/tadijam64","followers_url":"https://api.github.com/users/tadijam64/followers","following_url":"https://api.github.com/users/tadijam64/following{/other_user}","gists_url":"https://api.github.com/users/tadijam64/gists{/gist_id}","starred_url":"https://api.github.com/users/tadijam64/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tadijam64/subscriptions","organizations_url":"https://api.github.com/users/tadijam64/orgs","repos_url":"https://api.github.com/users/tadijam64/repos","events_url":"https://api.github.com/users/tadijam64/events{/privacy}","received_events_url":"https://api.github.com/users/tadijam64/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-10-25T20:48:11Z","updated_at":"2019-10-28T10:52:45Z","closed_at":"2019-10-28T10:52:45Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**: Comparison between Elasticsearch, Solr and OOTB Lucene in Adobe Experience Manager\r\n\r\nBug report\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): Tried 7.0.1 and **7.4.1**\r\n\r\n**Plugins installed**: [--]\r\n\r\n**JVM version** (`java -version`): 1.8.0_191\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): macOs\r\n\r\n**Description of the problem including expected versus actual behavior**: I expect to be able to index content, but cannot resolve an error from the title\r\n\r\n**Steps to reproduce**: This is done on AEM reference WeRetail project. Here is complete code:\r\nhttps://github.com/tadijam64/search-engines-comparison-on-we-retail/tree/elasticsearch-servlet-impl (one of the versions)\r\n\r\n\r\nI am trying to use **Elasticsearch** with AEM. Documentation of Elasticsearh says that only elasticsearch-high-level-client is needed, but it did not work for me because transitive dependencies were not imported. This is my code:\r\n\r\n```\r\n Session session = resourceResolver.adaptTo(Session.class);\r\n XContentBuilder builder = this.elasticsearchService.crawlContent(session);\r\n\r\nIndexRequest indexRequest = new IndexRequest(indexName);\r\nindexRequest.id(version);\r\ntry\r\n{\r\n           indexRequest.source(builder);\r\n           IndexResponse indexResponse = client.index(indexRequest, RequestOptions.DEFAULT);\r\n           writeResponse(indexResponse, response);\r\n}\r\n```\r\n\r\nIt breaks on this line: IndexResponse indexResponse = client.index(indexRequest, RequestOptions.DEFAULT); \r\nwith the following exception from the log:\r\n\r\n> 25.10.2019 22:41:30.887 *ERROR* [0:0:0:0:0:0:0:1 [1572035909141] GET /content/we-retail/language-masters/en/equipment.indexElasticsearchPages.json/_jcr_content/root/header/search HTTP/1.1] org.apache.sling.servlets.resolver.internal.SlingServletResolver Original error class java.lang.NoClassDefFoundError\r\n> java.lang.NoClassDefFoundError: Could not initialize class org.elasticsearch.rest.BytesRestResponse\r\n\r\nThis are **Maven** parts regarding the Elasticsearch:\r\n_(SInce it could not add all transitive dependencies, I added all of them manually)_\r\n\r\n```\r\n<!-- Elasticsearch -->\r\n            <dependency>\r\n                <groupId>org.elasticsearch.client</groupId>\r\n                <artifactId>elasticsearch-rest-high-level-client</artifactId>\r\n                <version>7.0.1</version>\r\n            </dependency>\r\n            <dependency>\r\n                <groupId>org.elasticsearch.client</groupId>\r\n                <artifactId>elasticsearch-rest-client</artifactId>\r\n                <version>7.0.1</version>\r\n            </dependency>\r\n            <dependency>\r\n                <groupId>org.elasticsearch</groupId>\r\n                <artifactId>elasticsearch</artifactId>\r\n                <version>7.0.1</version>\r\n            </dependency>\r\n            <dependency>\r\n                <groupId>org.elasticsearch</groupId>\r\n                <artifactId>elasticsearch-x-content</artifactId>\r\n                <version>7.0.1</version>\r\n            </dependency>\r\n            <dependency>\r\n                <groupId>org.elasticsearch</groupId>\r\n                <artifactId>elasticsearch-core</artifactId>\r\n                <version>7.0.1</version>\r\n            </dependency>\r\n            <dependency>\r\n                <groupId>org.elasticsearch.plugin</groupId>\r\n                <artifactId>rank-eval-client</artifactId>\r\n                <version>7.0.1</version>\r\n            </dependency>\r\n            <dependency>\r\n                <groupId>org.apache.commons</groupId>\r\n                <artifactId>commons-imaging</artifactId>\r\n                <version>1.0-alpha1</version>\r\n                <scope>test</scope>\r\n            </dependency>\r\n            <dependency>\r\n                <groupId>org.elasticsearch.plugin</groupId>\r\n                <artifactId>lang-mustache-client</artifactId>\r\n                <version>7.0.1</version>\r\n            </dependency>\r\n            <dependency>\r\n                <groupId>org.apache.httpcomponents</groupId>\r\n                <artifactId>httpasyncclient</artifactId>\r\n                <version>4.1.4</version>\r\n            </dependency>\r\n```\r\nMaven bundle plugin to embed third party dependencies:\r\n\r\n```\r\n<plugin>\r\n                <groupId>org.apache.felix</groupId>\r\n                <artifactId>maven-bundle-plugin</artifactId>\r\n                <extensions>true</extensions>\r\n                <configuration>\r\n                    <instructions>\r\n                        <Embed-Dependency>org.apache.servicemix.bundles.solr-solrj, noggit, zookeeper,\r\n                            elasticsearch-rest-high-level-client;scope=compile|runtime,\r\n                            elasticsearch;scope=compile|runtime,\r\n                            elasticsearch-rest-client;scope=compile|runtime,\r\n                            elasticsearch-x-content;scope=compile|runtime,\r\n                            elasticsearch-core;scope=compile|runtime,\r\n                            rank-eval-client;scope=compile|runtime,\r\n                            lang-mustache-client;scope=compile|runtime,\r\n                            httpasyncclient;scope=compile|runtime;\r\n                        </Embed-Dependency>\r\n                        <Embed-Transitive>true</Embed-Transitive>\r\n                        <Embed-Directory>OSGI-INF/lib</Embed-Directory>\r\n                        <Export-Package>we.retail.core.model*</Export-Package>\r\n                        <_exportcontents>\r\n                            org.elasticsearch.*,\r\n                            org.elasticsearch.client.*,\r\n                            org.elasticsearch.plugin.*,\r\n                            org.apache.commons.*\r\n                        </_exportcontents>\r\n                        <Import-Package>\r\n                            *;resolution:=optional;\r\n                        </Import-Package>\r\n                        <Private-Package>we.retail.core*</Private-Package>\r\n                        <Sling-Model-Packages>\r\n                            we.retail.core.model\r\n                        </Sling-Model-Packages>\r\n                        <_fixupmessages>\"Classes found in the wrong directory\";is:=warning</_fixupmessages>\r\n                    </instructions>\r\n                </configuration>\r\n            </plugin>\r\n```\r\n**Note**: _<_fixupmessages>\"Classes found in the wrong directory\";is:=warning</_fixupmessages>_\r\nThis was needed because I am getting the following error when embeding org.elasticsearch:\r\n\r\n```\r\n[WARNING] Bundle com.adobe.cq.sample:we.retail.core:bundle:3.0.0-SNAPSHOT : Classes found in the wrong directory: {META-INF/versions/9/org/elasticsearch/monitor/jvm/JvmPid.class=org.elasticsearch.monitor.jvm.JvmPid}\r\n[WARNING] Bundle com.adobe.cq.sample:we.retail.core:bundle:3.0.0-SNAPSHOT : Classes found in the wrong directory: {META-INF/versions/9/org/elasticsearch/core/internal/io/Streams.class=org.elasticsearch.core.internal.io.Streams}\r\n[INFO]\r\n```\r\nAlso there are some warnings on build similar to this one:\r\n\r\n`[WARNING] Bundle com.adobe.cq.sample:we.retail.core:bundle:3.0.0-SNAPSHOT : Export org.elasticsearch.common.lucene.search.function,  has 1,  private references [org.apache.lucene.index], \r\n`\r\n\r\nI have no clue how to solve using elasticsearch in my project. I am doing comparison between elasticsearch, solr and pure lucene in my project to do a research on performance, ease of using these search engines, community etc..\r\nI have provided all info I got, so I hope someone will have at least some ideas how to solve this.\r\n\r\nThanks in advance.","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}