{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4424","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4424/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4424/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4424/events","html_url":"https://github.com/elastic/elasticsearch/issues/4424","id":24164136,"node_id":"MDU6SXNzdWUyNDE2NDEzNg==","number":4424,"title":"dynamic templates not handled properly","user":{"login":"ristov","id":6163650,"node_id":"MDQ6VXNlcjYxNjM2NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/6163650?v=4","gravatar_id":"","url":"https://api.github.com/users/ristov","html_url":"https://github.com/ristov","followers_url":"https://api.github.com/users/ristov/followers","following_url":"https://api.github.com/users/ristov/following{/other_user}","gists_url":"https://api.github.com/users/ristov/gists{/gist_id}","starred_url":"https://api.github.com/users/ristov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ristov/subscriptions","organizations_url":"https://api.github.com/users/ristov/orgs","repos_url":"https://api.github.com/users/ristov/repos","events_url":"https://api.github.com/users/ristov/events{/privacy}","received_events_url":"https://api.github.com/users/ristov/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"assignees":[{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2013-12-12T08:45:20Z","updated_at":"2014-12-29T11:04:09Z","closed_at":"2014-12-29T11:04:09Z","author_association":"NONE","active_lock_reason":null,"body":"I've set up dynamic templates in config/default-mapping.json, and have new index created for each day. Occasionally, definitions in config/default-mapping.json are not used properly. The file has the following content:\n\n```\n{\n    \"_default_\" : {\n        \"dynamic_templates\" : [\n            {\n                \"template_1\" : {\n                    \"match\" : \"http_domain\",\n                    \"mapping\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                    }\n                }\n            },\n            {\n                \"template_2\" : {\n                    \"match\" : \"client\",\n                    \"mapping\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                    }\n                }\n            },\n            {\n                \"template_3\" : {\n                    \"match\" : \"username\",\n                    \"mapping\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                    }\n                }\n            },\n            {\n                \"template_4\" : {\n                    \"match\" : \"ids_sig_text\",\n                    \"mapping\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                    }\n                }\n            },\n            {\n                \"template_5\" : {\n                    \"match\" : \"reason\",\n                    \"mapping\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                    }\n                }\n            },\n            {\n                \"template_6\" : {\n                    \"match\" : \"action\",\n                    \"mapping\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                    }\n                }\n            }\n        ]\n    }\n}\n```\n\nIn most cases, the definitions are handled properly, but for some days, the above fields are split into terms which should not happen. This also happened for today and when querying the index mapping, I saw the following strange result:\n\n curl -XGET 'http://zapata.ad4.seb.net:9200/rsyslog-2013-12-12/_mapping?pretty=true'\n\n```\n{\n  \"rsyslog-2013-12-12\" : {\n    \"logs\" : {\n      \"dynamic_templates\" : [ {\n        \"template_1\" : {\n          \"mapping\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n          \"match\" : \"wwwdomain\"\n        }\n      } ],\n\n...\n...\n    \"events\" : {\n      \"dynamic_templates\" : [ {\n        \"template_1\" : {\n          \"mapping\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n          \"match\" : \"wwwdomain\"\n        }\n      }, {\n        \"template_2\" : {\n          \"mapping\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n          \"match\" : \"client\"\n        }\n      }, {\n        \"template_3\" : {\n          \"mapping\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n          \"match\" : \"username\"\n        }\n      }, {\n        \"template_4\" : {\n          \"mapping\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n          \"match\" : \"ids_sig_text\"\n        }\n      }, {\n        \"template_5\" : {\n          \"mapping\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n          \"match\" : \"reason\"\n        }\n      }, {\n        \"template_6\" : {\n          \"mapping\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n          \"match\" : \"action\"\n        }\n      } ],\n\n...\n...\n```\n\nAs you can see, the mappings are different for \"logs\" and \"events\" although usually they are one and the same. Also \"wwwdomain\" is a field which I removed more than a month ago from my default-mapping.json file, and it is not used as a fieldname in any of my documents anymore.\n\nI have seen the same behavior both for elasticsearch 0.90.3 and 0.90.7. What puzzles me most is why is a deleted configuration file entry reappearing in mappings, even though it was last used more than a month ago with 0.90.3, while I am currently running 0.90.7. I have checked all my elasticsearch config files with grep and wwwdomain does not appear anywhere.\n\nregards,\nristo\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}