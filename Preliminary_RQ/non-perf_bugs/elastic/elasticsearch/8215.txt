{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8215","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8215/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8215/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8215/events","html_url":"https://github.com/elastic/elasticsearch/issues/8215","id":46694243,"node_id":"MDU6SXNzdWU0NjY5NDI0Mw==","number":8215,"title":"Put mapping property update for _default_ type performs a complete replacement instead of a merge","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-10-24T00:50:50Z","updated_at":"2016-11-26T11:46:06Z","closed_at":"2016-11-26T11:46:06Z","author_association":"MEMBER","active_lock_reason":null,"body":"Consider the following example.    We are trying to add eager loading of field data to an existing property across all document types in an index:\n\nhttps://gist.github.com/ppf2/2f49184d1c34a1c9b9b0\n\nThis works as expected for custom types.  If you look at the mapping defined for the custom_type type, there are 2 hostname fields (hostname and hostname2), if you update just hostname, it will successfully apply the change and do a merge such that hostname2 is retained and unchanged but hostname is updated.\n\n```\nPUT /test_mapping/custom_type/_mapping\n{\n    \"properties\": {\n      \"hostname\": {\n        \"type\": \"string\",\n        \"index\": \"not_analyzed\",\n        \"doc_values\": true,\n        \"fielddata\": {\n          \"loading\": \"eager_global_ordinals\"\n        }\n      }\n    }\n}\n```\n\nBut if you execute the same update against `_default_` type, it performs a complete replace of the type. As a result, all other properties in the `_default_` type are deleted and it ends up with just the hostname property.  It doesn't just override the existing values within the property definition with the requested update but essentially create a new `_default_` type definition based on what is passed in via the put mapping API.  The doc description is a bit ambiguous \"Any mapping specified in the create-index or put-mapping request _override values_ set in the `_default_` mapping.\".   Is there a reason why we are not performing a merge?  The concern here is that this can cause unexpected loss in the default properties since it behaves differently from all the custom types.  So if the end users are going through all the types one by one and updating just 1 property, when they get to `_default_`, they can inadvertently cause the default type to drop everything else from its definition.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}