{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31532","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31532/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31532/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31532/events","html_url":"https://github.com/elastic/elasticsearch/issues/31532","id":334878349,"node_id":"MDU6SXNzdWUzMzQ4NzgzNDk=","number":31532,"title":"Deprecate \"value scripts\" on aggregations?","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":189346177,"node_id":"MDU6TGFiZWwxODkzNDYxNzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edeprecation","name":">deprecation","color":"ce18a7","default":false,"description":null},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-06-22T13:29:04Z","updated_at":"2018-07-05T17:28:56Z","closed_at":"2018-07-05T17:28:56Z","author_association":"MEMBER","active_lock_reason":null,"body":"Today, there is a (little-documented) feature where specifying a `field` + `script` on an aggregation will run the script in \"value script\" mode.  Each value in the `field` will be passed to the script under the `_value` variable so that the script can modify it, before letting the aggregation collect it.\r\n\r\nThis is a very trappy API, because there are no safeguards from the user specifying a \"normal\" script that tries to access regular fields.  It can lead to confusion like https://github.com/elastic/elasticsearch/issues/20773 and https://github.com/elastic/elasticsearch/issues/11728\r\n\r\nIn #20733, we decided to add a `value_script` and deprecate `field` + `script` combo.  Which is certainly doable, but I'm wondering if we should just deprecate the concept of value scripts entirely?  I'm not sure how widespread usage actually is?\r\n\r\nBesides being confusing, value scripts adds a fair amount of complexity to the code when trying to resolve the ValuesSource, adds another set of Scorer wrappers (`ValuesSource.Numeric.WithScript`, `ValuesSource.WithScript`)  and adds a bespoke `setNextAggregationValue()` in the script implementation solely to satisfy this feature.  ","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}