{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767/events","html_url":"https://github.com/elastic/elasticsearch/issues/43767","id":462144659,"node_id":"MDU6SXNzdWU0NjIxNDQ2NTk=","number":43767,"title":"[ML] Data frame GET _stats response is confusing ","user":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""},{"id":1434538947,"node_id":"MDU6TGFiZWwxNDM0NTM4OTQ3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.4.0","name":"v7.4.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"assignees":[{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2019-06-28T17:52:28Z","updated_at":"2019-07-23T09:48:23Z","closed_at":"2019-07-23T09:48:23Z","author_association":"NONE","active_lock_reason":null,"body":"Found in `7.3.0-SNAPSHOT`\r\n\r\nContinuous data frame `GET _stats` returns the following. Hopefully we can make this response a little less confusing:\r\n\r\n- `indexer_state` - a value of `started` means it is idle whereas `indexing` means it is either searching or indexing. This is not precise, but is inherited from rollups so might be best to leave as is. Also having two states is confusing.\r\n- `checkpoint` - this is the last known completed (current) checkpoint. This could be confused with the currently underway checkpoint. \r\n- `progress` - this is the progress of the currently underway checkpoint. By calling it `progress` and leaving at the top level, it gives a false impression that it is somehow indicative of the whole transform. `percent_complete` indicates the progress of a single checkpoint. With batch data frames there is only ever 1 checkpoint, so the other values make sense. However for continuous the `total_docs` and `doc_remaining` should ideally be reset. `progress` could be renamed to `checkpoint_progress` or combined with the `checkpointing` info to keep together. \r\n- `current_position` - this is the position of the cursor for the composite agg and will only be visible whilst the composite agg search is _scrolling_. This is context for the currently underway checkpoint. If a composite agg is not in progress, then this entire object is missing. A small nit, but its sporadic existence is weird.\r\n- `checkpointing` \r\n  - we show both `timestamp_millis` and  `time_upper_bound_millis` where the latter is `timestamp_millis - sync.delay`. Do we need both? \r\n  - `current` refers to the current completed checkpoint whereas `in_progress` refers to the currently underway checkpoint. This is confusing in conjunction with `progress`. Perhaps we could just keep upper and lower bound? \r\n  - `in_progress` sometimes does not exist.\r\n  - Should `progress` and `current_position` and maybe `indexer_state` sit here?\r\n- Many of these stats refer to the next checkpoint `checkpoint: 101` - this is not clear\r\n\r\nTo summarise the priority points, \r\n- `progress.total_docs` `progress.docs_remaining` and is incorrect for continuous. This is `checkpoint_progress` for the next checkpoint.\r\n- there is slightly confusing usage of the terms `current*` and `*progress` which may lead to confusion when trying to operationally manage and/or troubleshoot.\r\n\r\n\r\n\r\n```\r\n{\r\n  \"count\" : 1,\r\n  \"transforms\" : [\r\n    {\r\n      \"id\" : \"sycn1844\",\r\n      \"state\" : {\r\n        \"task_state\" : \"started\",\r\n        \"indexer_state\" : \"indexing\",\r\n        \"current_position\" : {\r\n          \"hashtag\" : \"abcd1234\"\r\n        },\r\n        \"checkpoint\" : 100,\r\n        \"progress\" : {\r\n          \"total_docs\" : 1900883,\r\n          \"docs_remaining\" : 1722762,\r\n          \"percent_complete\" : 9.370434687458408\r\n        }\r\n      },\r\n      \"stats\" : {\r\n        \"pages_processed\" : 559,\r\n        \"documents_processed\" : 4207753,\r\n        \"documents_indexed\" : 278783,\r\n        \"trigger_count\" : 2,\r\n        \"index_time_in_ms\" : 14467,\r\n        \"index_total\" : 558,\r\n        \"index_failures\" : 0,\r\n        \"search_time_in_ms\" : 284161,\r\n        \"search_total\" : 559,\r\n        \"search_failures\" : 0\r\n      },\r\n      \"checkpointing\" : {\r\n        \"current\" : {\r\n          \"timestamp\" : \"2019-06-28T16:44:12.497Z\",\r\n          \"timestamp_millis\" : 1561740252497,\r\n          \"time_upper_bound\" : \"2019-06-28T16:43:12.497Z\",\r\n          \"time_upper_bound_millis\" : 1561740192497\r\n        },\r\n        \"in_progress\" : {\r\n          \"timestamp\" : \"2019-06-28T16:50:29.172Z\",\r\n          \"timestamp_millis\" : 1561740629172,\r\n          \"time_upper_bound\" : \"2019-06-28T16:49:29.172Z\",\r\n          \"time_upper_bound_millis\" : 1561740569172\r\n        },\r\n        \"operations_behind\" : 27000\r\n      }\r\n    }\r\n  ]\r\n}\r\n```","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}