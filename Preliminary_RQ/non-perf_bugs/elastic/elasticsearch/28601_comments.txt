[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/364405720","html_url":"https://github.com/elastic/elasticsearch/issues/28601#issuecomment-364405720","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601","id":364405720,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NDQwNTcyMA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-02-09T11:11:21Z","updated_at":"2018-02-09T11:11:21Z","author_association":"MEMBER","body":"So from reading more it seems that the gradle daemon is run regardless of the settings but is started and shut down for the build if you disable it so it only survives for that single build.\r\n\r\n@danielmitterdorfer and I concentrated just on https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+bwc-tests/592/console and found output indicating where the daemon log file is located:\r\n```\r\n03:30:51 The client will now receive all logging from the daemon (pid: 1151). The daemon log file: /var/lib/jenkins/.gradle/daemon/4.5/daemon-1151.out.log\r\n```\r\n\r\nLooking at that file on the CI worker it looks like the daemon shuts down after the `:qa:verify-version-constants:v6.2.2-SNAPSHOT#bwcTest` task because it believes the build is completed when actually only the inner gradle build is completed and the main gradle build is still running:\r\n```\r\nSkipping task ':qa:verify-version-constants:v6.2.2-SNAPSHOT#oldClusterTest' as it has no actions.\r\n:qa:verify-version-constants:v6.2.2-SNAPSHOT#oldClusterTest (Thread[Task worker for ':',5,main]) completed. Took 0.0 secs.\r\n:qa:verify-version-constants:v6.2.2-SNAPSHOT#bwcTest (Thread[Task worker for ':',5,main]) started.\r\n:qa:verify-version-constants:v6.2.2-SNAPSHOT#bwcTest\r\nSkipping task ':qa:verify-version-constants:v6.2.2-SNAPSHOT#bwcTest' as it has no actions.\r\n:qa:verify-version-constants:v6.2.2-SNAPSHOT#bwcTest (Thread[Task worker for ':',5,main]) completed. Took 0.0 secs.\r\n:qa:verify-version-constants:bwcTest (Thread[Task worker for ':',5,main]) started.\r\n:qa:verify-version-constants:bwcTest\r\nSkipping task ':qa:verify-version-constants:bwcTest' as it has no actions.\r\n:qa:verify-version-constants:bwcTest (Thread[Task worker for ':',5,main]) completed. Took 0.0 secs.\r\n\r\nDeprecated Gradle features were used in this build, making it incompatible with Gradle 5.0.\r\nSee https://docs.gradle.org/4.5/userguide/command_line_interface.html#sec:command_line_warnings\r\n\r\nBUILD SUCCESSFUL in 3h 39m 42s\r\n3054 actionable tasks: 2672 executed, 382 up-to-date\r\nStopped 1 worker daemon(s).\r\nVCS Checkout Cache (/var/lib/jenkins/workspace/elastic+elasticsearch+6.x+bwc-tests/.gradle/vcsWorkingDirs) has not been cleaned up in 0 days\r\n07:10:32.295 [DEBUG] [org.gradle.launcher.daemon.server.exec.ExecuteBuild] The daemon has finished executing the build.\r\n07:10:32.298 [DEBUG] [org.gradle.launcher.daemon.server.DaemonStateCoordinator] daemon stop has been requested. Sleeping until state changes.\r\n07:10:32.298 [DEBUG] [org.gradle.launcher.daemon.server.DaemonStateCoordinator] Command execution: finished waiting for DaemonCommandExecution[command = Build{id=cbe5c808-c805-4cb3-972f-9777f1bacc6e.1, currentDir=/var/lib/jenkins/workspace/elastic+elasticsearch+6.x+bwc-tests}, connection = DefaultDaemonConnection: socket connection from /0:0:0:0:0:0:0:1:39608 to /0:0:0:0:0:0:0:1:58944]. Result org.gradle.launcher.daemon.server.DaemonStateCoordinator@76bc6ad8 with state StopRequested\r\n...\r\n...\r\n...\r\n...\r\n07:11:27.819 [DEBUG] [org.gradle.launcher.daemon.server.health.LowMemoryDaemonExpirationStrategy] Received memory status update: {Total: 16722612224, Free: 12247891968}\r\n07:11:27.819 [DEBUG] [org.gradle.process.internal.health.memory.MemoryManager] Emitting JVM memory status event {Maximum: 1431830528, Committed: 920649728}\r\n07:11:32.303 [DEBUG] [org.gradle.launcher.daemon.server.DefaultIncomingConnectionHandler] Received finished message: null\r\n07:11:32.303 [DEBUG] [org.gradle.launcher.daemon.server.SynchronizedDispatchConnection] thread 14: stopping connection\r\n07:11:32.303 [DEBUG] [org.gradle.internal.remote.internal.inet.SocketConnection] Discarding EOFException: java.io.EOFException\r\n07:11:32.303 [DEBUG] [org.gradle.launcher.daemon.server.SynchronizedDispatchConnection] thread 15: received null\r\n07:11:32.303 [DEBUG] [org.gradle.launcher.daemon.server.DefaultDaemonConnection] thread 15: Received end-of-input from client.\r\n07:11:32.304 [DEBUG] [org.gradle.launcher.daemon.server.SynchronizedDispatchConnection] thread 14: stopping connection\r\n07:11:32.343 [DEBUG] [org.gradle.cache.internal.LockOnDemandCrossProcessCacheAccess] Releasing file lock for file hash cache (/var/lib/jenkins/.gradle/caches/4.5/fileHashes)\r\n07:11:32.345 [DEBUG] [org.gradle.cache.internal.btree.BTreePersistentIndexedCache] Closing cache fileHashes.bin (/var/lib/jenkins/.gradle/caches/4.5/fileHashes/fileHashes.bin)\r\n07:11:32.345 [DEBUG] [org.gradle.cache.internal.btree.BTreePersistentIndexedCache] Closing cache resourceHashesCache.bin (/var/lib/jenkins/.gradle/caches/4.5/fileHashes/resourceHashesCache.bin)\r\n07:11:32.345 [DEBUG] [org.gradle.cache.internal.DefaultFileLockManager] Releasing lock on file hash cache (/var/lib/jenkins/.gradle/caches/4.5/fileHashes).\r\n07:11:32.345 [DEBUG] [org.gradle.cache.internal.DefaultFileLockManager] Releasing lock on cache directory workerMain (/var/lib/jenkins/.gradle/caches/4.5/workerMain).\r\nDaemon vm is shutting down... The daemon has exited normally or was terminated in response to a user interrupt.\r\n07:11:32.351 [DEBUG] [org.gradle.launcher.daemon.registry.PersistentDaemonRegistry] Removing daemon address: [5e448acc-1014-4927-bf01-d61488a8d021 port:39608, addresses:[/0:0:0:0:0:0:0:1%lo, /127.0.0.1]]\r\n07:11:32.351 [DEBUG] [org.gradle.cache.internal.DefaultFileLockManager] Waiting to acquire exclusive lock on daemon addresses registry.\r\n07:11:32.351 [DEBUG] [org.gradle.cache.internal.DefaultFileLockManager] Lock acquired on daemon addresses registry.\r\n07:11:32.352 [DEBUG] [org.gradle.cache.internal.DefaultFileLockManager] Releasing lock on daemon addresses registry.\r\n```\r\n\r\n(I have the full daemon log locally if needed)\r\n\r\nWhats weird here is that I would have thought that either an inner build finishing would always cause a  shut down of the gradle daemon or never, its strange that most of the time this seems to work as we intend but only occassionally does the daemon wrongly get shut down.\r\n\r\nI am a bit lost as to where to go next with this so any advice is very welcome.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/364470754","html_url":"https://github.com/elastic/elasticsearch/issues/28601#issuecomment-364470754","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601","id":364470754,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NDQ3MDc1NA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-02-09T15:45:40Z","updated_at":"2018-02-09T15:45:40Z","author_association":"MEMBER","body":"Another instance of this: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=amazon/2027/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/364516607","html_url":"https://github.com/elastic/elasticsearch/issues/28601#issuecomment-364516607","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601","id":364516607,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NDUxNjYwNw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-02-09T18:25:27Z","updated_at":"2018-02-09T18:25:27Z","author_association":"CONTRIBUTOR","body":"I get this locally when I run builds in parallel and there is an error.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/365242949","html_url":"https://github.com/elastic/elasticsearch/issues/28601#issuecomment-365242949","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601","id":365242949,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTI0Mjk0OQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2018-02-13T11:43:35Z","updated_at":"2018-02-13T11:43:35Z","author_association":"MEMBER","body":"I gathered a bit more information about these failures. They started on August 3, 2017 with `build.last-success.commit-id` 8ef7438d6c874586a97d29687facf162390d7923. We have disabled the Gradle daemon in 2f95e4a86c41b5da4e2c1a20cf337498f9496a01 on November 25, 2017 so we already ran for a while in this configuration before the failures have occurred.\r\n\r\nWe have 63 build failures until today. I have attached the [build ids of the failed builds](https://github.com/elastic/elasticsearch/files/1719620/failed-builds.csv.zip) for reference.\r\n\r\nLooking at the build stats, the only commonality that we see is that the builds have only failed on Linux (that may or may not be a coincidence). Distro, uptime, JDK version or Gradle version do not seem to make a difference.\r\n\r\nI also checked with our infrastructure team: We are not allowing concurrent builds in CI so I think we can also rule out concurrent builds as a cause.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388491177","html_url":"https://github.com/elastic/elasticsearch/issues/28601#issuecomment-388491177","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601","id":388491177,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODQ5MTE3Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-05-11T21:32:16Z","updated_at":"2018-05-11T21:32:16Z","author_association":"MEMBER","body":"We have not seen this occur in awhile. We can reopen this if it occurs again. Closing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/421090221","html_url":"https://github.com/elastic/elasticsearch/issues/28601#issuecomment-421090221","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601","id":421090221,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTA5MDIyMQ==","user":{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false},"created_at":"2018-09-13T17:37:20Z","updated_at":"2018-09-13T17:37:20Z","author_association":"CONTRIBUTOR","body":"I saw this happen today. It does not seem to be related or triggered in the same place, at all.\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.4+intake/150/\r\n\r\nIm not sure its yet worth opening the issue up, or if this is pure coincidence. If more trickle in, I will reopen.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/493903895","html_url":"https://github.com/elastic/elasticsearch/issues/28601#issuecomment-493903895","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28601","id":493903895,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzkwMzg5NQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-05-20T09:13:23Z","updated_at":"2019-05-20T09:13:23Z","author_association":"CONTRIBUTOR","body":"Another occurrence: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+multijob-unix-compatibility/os=sles-12/203/console","performed_via_github_app":null}]