{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8558","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8558/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8558/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8558/events","html_url":"https://github.com/elastic/elasticsearch/issues/8558","id":49427641,"node_id":"MDU6SXNzdWU0OTQyNzY0MQ==","number":8558,"title":"Offsets spuriously lost from field after indexing a separate type with matching field name","user":{"login":"robinhughes","id":1805645,"node_id":"MDQ6VXNlcjE4MDU2NDU=","avatar_url":"https://avatars3.githubusercontent.com/u/1805645?v=4","gravatar_id":"","url":"https://api.github.com/users/robinhughes","html_url":"https://github.com/robinhughes","followers_url":"https://api.github.com/users/robinhughes/followers","following_url":"https://api.github.com/users/robinhughes/following{/other_user}","gists_url":"https://api.github.com/users/robinhughes/gists{/gist_id}","starred_url":"https://api.github.com/users/robinhughes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robinhughes/subscriptions","organizations_url":"https://api.github.com/users/robinhughes/orgs","repos_url":"https://api.github.com/users/robinhughes/repos","events_url":"https://api.github.com/users/robinhughes/events{/privacy}","received_events_url":"https://api.github.com/users/robinhughes/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-11-19T17:38:37Z","updated_at":"2014-11-24T11:33:33Z","closed_at":"2014-11-24T11:33:33Z","author_association":"NONE","active_lock_reason":null,"body":"If there are two mappings within the index that have a matching field name - one configured with and  one without `index_options: offsets` then we can add a document of the first type (i.e. the mapping with offsets), and query it successfully using the postings highlighter.\n\nBut after adding several documents of the second type (i.e. the mapping without offsets), the same query (returning the same single original document only) fails with the exception:\n\n`IllegalArgumentException[field 'title' was indexed without offsets, cannot highlight`\n\nThis failure takes about 10 seconds to reproduce when using refresh_interval: 1s, and indexing the documents with a 1s pause between documents. This suggests that perhaps it is something in the index refresh processing that is getting confused between the mappings when updating the index.\n\nThe failure only happens after adding several extra documents of the second type over a period spanning several refresh_intervals. Attempts to recreate the issue with a longer refresh_interval resulted in many more documents of the second type having to be added before the issue arose.\n\nThe following gist is a short shell script that demonstrates this issue with elasticsearch 1.4.0:\n\nhttps://gist.github.com/robinhughes/4b1f381a94dd905d71a6\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}