[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/225163982","html_url":"https://github.com/elastic/elasticsearch/issues/18530#issuecomment-225163982","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18530","id":225163982,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNTE2Mzk4Mg==","user":{"login":"gfyoung","id":9273653,"node_id":"MDQ6VXNlcjkyNzM2NTM=","avatar_url":"https://avatars0.githubusercontent.com/u/9273653?v=4","gravatar_id":"","url":"https://api.github.com/users/gfyoung","html_url":"https://github.com/gfyoung","followers_url":"https://api.github.com/users/gfyoung/followers","following_url":"https://api.github.com/users/gfyoung/following{/other_user}","gists_url":"https://api.github.com/users/gfyoung/gists{/gist_id}","starred_url":"https://api.github.com/users/gfyoung/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gfyoung/subscriptions","organizations_url":"https://api.github.com/users/gfyoung/orgs","repos_url":"https://api.github.com/users/gfyoung/repos","events_url":"https://api.github.com/users/gfyoung/events{/privacy}","received_events_url":"https://api.github.com/users/gfyoung/received_events","type":"User","site_admin":false},"created_at":"2016-06-10T12:00:35Z","updated_at":"2016-06-10T12:01:05Z","author_association":"CONTRIBUTOR","body":"`S3BlobContainer`conforms <a href=\"https://github.com/elastic/elasticsearch/blob/e7eb664c78dce2451dbeb55db0c0b761a65b295b/plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/blobstore/S3BlobContainer.java#L114\">here</a>, and `AzureBlobContainer`conforms <a href=\"https://github.com/elastic/elasticsearch/blob/c4d3bf472bc5eaa18a1f1ffac727110a33f89b42/plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobContainer.java#L123\">here</a>.\nThe other two implementations do not conform though as you pointed out.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/225202315","html_url":"https://github.com/elastic/elasticsearch/issues/18530#issuecomment-225202315","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18530","id":225202315,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNTIwMjMxNQ==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-06-10T14:46:14Z","updated_at":"2016-06-10T14:46:14Z","author_association":"CONTRIBUTOR","body":"@gfyoung Actually, the `S3BlobContainer` does not yet conform, because this [line](https://github.com/elastic/elasticsearch/blob/e7eb664c78dce2451dbeb55db0c0b761a65b295b/plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/blobstore/S3BlobContainer.java#L112) calls `S3BlobStore.client()#deleteObject`.  The `S3BlobStore.client()` returns an instance of `AmazonS3`.  If you look at the javadoc for `AmazonS3#deleteObject`, they say that the absence of the object will not throw an exception:\n\nhttp://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/AmazonS3.html#deleteObject(java.lang.String,%20java.lang.String)\n\nThe exception handling [line](https://github.com/elastic/elasticsearch/blob/e7eb664c78dce2451dbeb55db0c0b761a65b295b/plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/blobstore/S3BlobContainer.java#L114) you linked to only gets triggered if there are actual errors during deleting the object in S3, not if the object itself does not exist.\n\nI believe its the same with `AzureBlobContainer`.  \n\nInstead, in both S3 and Azure, we should first check for the presence of the object and if it does not exist, throw an `IOException` before deleting.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/225202491","html_url":"https://github.com/elastic/elasticsearch/issues/18530#issuecomment-225202491","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18530","id":225202491,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNTIwMjQ5MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-06-10T14:46:52Z","updated_at":"2016-06-10T14:47:18Z","author_association":"MEMBER","body":"> `S3BlobContainer`conforms <a href=\"https://github.com/elastic/elasticsearch/blob/e7eb664c78dce2451dbeb55db0c0b761a65b295b/plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/blobstore/S3BlobContainer.java#L114\">here</a>, and `AzureBlobContainer`conforms <a href=\"https://github.com/elastic/elasticsearch/blob/c4d3bf472bc5eaa18a1f1ffac727110a33f89b42/plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobContainer.java#L123\">here</a>.\n> The other two implementations do not conform though as you pointed out.\n\nThis is not correct. The documentation for `AmazonS3#deleteObject` specifies:\n\n```\n     * If attempting to delete an object that does not exist,\n     * Amazon S3 returns\n     * a success message instead of an error message.\n```\n\nIt's not clear what the Azure service does as it's not specified in the docs, it would have to be tested.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/225202971","html_url":"https://github.com/elastic/elasticsearch/issues/18530#issuecomment-225202971","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18530","id":225202971,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNTIwMjk3MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-06-10T14:48:31Z","updated_at":"2016-06-10T14:48:31Z","author_association":"MEMBER","body":"Also, it's important to note that some exceptions that are being wrapped into `IOException`s probably should not be, for example, general client exceptions and URI syntax exceptions.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/225205087","html_url":"https://github.com/elastic/elasticsearch/issues/18530#issuecomment-225205087","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18530","id":225205087,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNTIwNTA4Nw==","user":{"login":"gfyoung","id":9273653,"node_id":"MDQ6VXNlcjkyNzM2NTM=","avatar_url":"https://avatars0.githubusercontent.com/u/9273653?v=4","gravatar_id":"","url":"https://api.github.com/users/gfyoung","html_url":"https://github.com/gfyoung","followers_url":"https://api.github.com/users/gfyoung/followers","following_url":"https://api.github.com/users/gfyoung/following{/other_user}","gists_url":"https://api.github.com/users/gfyoung/gists{/gist_id}","starred_url":"https://api.github.com/users/gfyoung/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gfyoung/subscriptions","organizations_url":"https://api.github.com/users/gfyoung/orgs","repos_url":"https://api.github.com/users/gfyoung/repos","events_url":"https://api.github.com/users/gfyoung/events{/privacy}","received_events_url":"https://api.github.com/users/gfyoung/received_events","type":"User","site_admin":false},"created_at":"2016-06-10T14:55:44Z","updated_at":"2016-06-10T14:57:58Z","author_association":"CONTRIBUTOR","body":"@abeyad : Hmmm...okay I see, so the correct fix would to call `blobExists` first **before** attempting the actual deletion.\n\n@jasontedor : With regards to exceptions, where do we draw the line with regards to the statement <a href=\"https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/common/blobstore/BlobContainer.java#L98\">here</a> in the contract?  I agree that URI syntax errors should be excluded, but others are not as clear in my mind (e.g. exceptions associated with `Files.deleteIfExists`).\n\nAlso, I do agree that testing needs to be done, but I'm not sure how to do it as I stated <a href=\"https://github.com/elastic/elasticsearch/pull/18815#issuecomment-225190213\">here</a> in the PR.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/225208606","html_url":"https://github.com/elastic/elasticsearch/issues/18530#issuecomment-225208606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18530","id":225208606,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNTIwODYwNg==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-06-10T15:07:50Z","updated_at":"2016-06-10T15:07:50Z","author_association":"CONTRIBUTOR","body":"> Hmmm...okay I see, so the correct fix would to call blobExists first before attempting the actual deletion.\n\n@gfyoung yes that's correct\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/225265662","html_url":"https://github.com/elastic/elasticsearch/issues/18530#issuecomment-225265662","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18530","id":225265662,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNTI2NTY2Mg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2016-06-10T18:51:38Z","updated_at":"2016-06-10T18:51:38Z","author_association":"MEMBER","body":"> It's not clear what the Azure service does as it's not specified in the docs, it would have to be tested.\n\nSame for Google Cloud Storage, I don't see any documentation about what it does.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/229898211","html_url":"https://github.com/elastic/elasticsearch/issues/18530#issuecomment-229898211","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18530","id":229898211,"node_id":"MDEyOklzc3VlQ29tbWVudDIyOTg5ODIxMQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-07-01T09:12:41Z","updated_at":"2016-07-01T09:12:41Z","author_association":"MEMBER","body":"Reopening as the commit was reverted, see https://github.com/elastic/elasticsearch/pull/18815#issuecomment-229898122\n","performed_via_github_app":null}]