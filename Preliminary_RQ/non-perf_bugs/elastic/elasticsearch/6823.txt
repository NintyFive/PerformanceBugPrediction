{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6823","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6823/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6823/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6823/events","html_url":"https://github.com/elastic/elasticsearch/issues/6823","id":37602171,"node_id":"MDU6SXNzdWUzNzYwMjE3MQ==","number":6823,"title":"Command to add apt-key does not work under sudo","user":{"login":"arowla","id":166715,"node_id":"MDQ6VXNlcjE2NjcxNQ==","avatar_url":"https://avatars3.githubusercontent.com/u/166715?v=4","gravatar_id":"","url":"https://api.github.com/users/arowla","html_url":"https://github.com/arowla","followers_url":"https://api.github.com/users/arowla/followers","following_url":"https://api.github.com/users/arowla/following{/other_user}","gists_url":"https://api.github.com/users/arowla/gists{/gist_id}","starred_url":"https://api.github.com/users/arowla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arowla/subscriptions","organizations_url":"https://api.github.com/users/arowla/orgs","repos_url":"https://api.github.com/users/arowla/repos","events_url":"https://api.github.com/users/arowla/events{/privacy}","received_events_url":"https://api.github.com/users/arowla/received_events","type":"User","site_admin":false},"labels":[{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"assignees":[{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2014-07-10T20:34:29Z","updated_at":"2019-08-16T08:11:47Z","closed_at":"2014-07-23T09:13:25Z","author_association":"NONE","active_lock_reason":null,"body":"This command, as given on the instructions for using the Elasticsearch repositories (http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/setup-repositories.html), only works as root.\n\n```\nwget -O - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | apt-key add -\n```\n\nA user using non-passwordless sudo must modify the flags to wget so as to properly respond to the sudo password prompt, as well as use sudo for the apt-key portion of the command, ala:\n\n```\nwget -qO - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | sudo apt-key add -\n```\n\nSince it's generally regarded as bad practice to run as root, I'd argue that the command included in the instructions should be the version that works with sudo. Or at the very least, there should be a note that the command needs to be run as root. The error message encountered when running as a non-root user is difficult to read and unhelpful at best.\n\n```\n$ wget -O - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | apt-key add -\n--2014-07-10 20:30:29--  http://packages.elasticsearch.org/GPG-KEY-elasticsearch\nResolving packages.elasticsearch.org (packages.elasticsearch.org)... 54.231.2.113\nConnecting to packages.elasticsearch.org (packages.elasticsearch.org)|54.231.2.113|:80... ERROR: This command can only be used by root.\nconnected.\nHTTP request sent, awaiting response... 200 OK\nLength: 1768 (1.7K) [binary/octet-stream]\nSaving to: ‘STDOUT’\n\n 0% [                                                                                                                                            ] 0           --.-K/s   in 0s\n\n\nCannot write to ‘-’ (Broken pipe).\n```\n\nHappy to submit a pull request if it makes sense.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}