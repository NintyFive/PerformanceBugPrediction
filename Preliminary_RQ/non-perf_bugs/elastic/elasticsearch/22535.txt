{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22535","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22535/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22535/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22535/events","html_url":"https://github.com/elastic/elasticsearch/issues/22535","id":199903401,"node_id":"MDU6SXNzdWUxOTk5MDM0MDE=","number":22535,"title":"Verify a registered repository in 6.0 does not contain incompatible data only","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":777829541,"node_id":"MDU6TGFiZWw3Nzc4Mjk1NDE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.3","name":"v6.0.3","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-01-10T18:52:51Z","updated_at":"2018-03-26T13:08:26Z","closed_at":"2018-03-26T13:08:26Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When a user upgrades to a 6.0 cluster, they must have done so from a 5.x cluster.  However, it is possible that the user upgraded from 2.x -> 5.x and then from 5.x -> 6.x without having registered their snapshot repository on the 5.x version.  This will mean that once the user is on a 6.x cluster, they will no longer be able to read their repository data from 2.x (as we only allow backward compatibility with the last major version).  We removed the ability to read all of the 2.x snapshot data from 6.x in #22004.\r\n\r\nHowever, we could improve this situation by preventing a user from even registering a repository on 6.x if that repository contains no valid 5.x repository data (i.e. the `index-N` file) and in addition we detect the presence of 2.x data in the repository (through the presence of the old `index` file).  The presence of `index` and the absence of any `index-N` is an indication that the repository was never used in a 5.x cluster and was only used in a 2.x cluster.  Instead of creating a scenario where the repository data files could be deleted or silently dropping snapshots, we could fail to register the repository in such a situation so the user is alerted that their repository seems to only contain pre 5.x files.","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}