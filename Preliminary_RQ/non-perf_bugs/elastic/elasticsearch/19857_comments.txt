[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238544957","html_url":"https://github.com/elastic/elasticsearch/issues/19857#issuecomment-238544957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19857","id":238544957,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODU0NDk1Nw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T13:00:39Z","updated_at":"2016-08-09T13:00:39Z","author_association":"MEMBER","body":"I tested your recreation with ES 2.3.3 and it worked fine. The index is created as expected and it fails if `action.auto_create_index` is set to false.  I am closing the issue since I am not able to reproduce, feel free to reopen if you find a recreation that does not work.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/240534396","html_url":"https://github.com/elastic/elasticsearch/issues/19857#issuecomment-240534396","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19857","id":240534396,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MDUzNDM5Ng==","user":{"login":"mouadino","id":1884531,"node_id":"MDQ6VXNlcjE4ODQ1MzE=","avatar_url":"https://avatars0.githubusercontent.com/u/1884531?v=4","gravatar_id":"","url":"https://api.github.com/users/mouadino","html_url":"https://github.com/mouadino","followers_url":"https://api.github.com/users/mouadino/followers","following_url":"https://api.github.com/users/mouadino/following{/other_user}","gists_url":"https://api.github.com/users/mouadino/gists{/gist_id}","starred_url":"https://api.github.com/users/mouadino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mouadino/subscriptions","organizations_url":"https://api.github.com/users/mouadino/orgs","repos_url":"https://api.github.com/users/mouadino/repos","events_url":"https://api.github.com/users/mouadino/events{/privacy}","received_events_url":"https://api.github.com/users/mouadino/received_events","type":"User","site_admin":false},"created_at":"2016-08-17T20:18:24Z","updated_at":"2016-08-18T09:29:51Z","author_association":"NONE","body":"@jimferenczi Sadly I cannot reopen the issue but I am updating here with reproducible steps.\n\n### Configuration\n\nInstall both elasticsearch versions 2.1.0 and 2.3.0, for each do the following:\n\nChange configuration so that `action.auto_create_index: true` and `index.mapper.dynamic: false`. \n\nTrying to create now a document fail as expected, \n\n```\nPOST /twitter:0/tweet/1/_update\n{\n  \"doc\": {\n    \"message\": \"test\"\n  },\n  \"doc_as_upsert\": true\n}\n\n{\n  \"error\": {\n    \"root_cause\": [\n      {\n        \"type\": \"type_missing_exception\",\n        \"reason\": \"type[[tweet, trying to auto create mapping, but dynamic mapping is disabled]] missing\",\n        \"index\": \"twitter:0\"\n      }\n    ],\n    \"type\": \"type_missing_exception\",\n    \"reason\": \"type[[tweet, trying to auto create mapping, but dynamic mapping is disabled]] missing\",\n    \"index\": \"twitter:0\"\n  },\n  \"status\": 404\n}    \n```\n\nCreate a template: \n\n```\nPUT /_template/twitter\n{\n  \"template\": \"*\",\n  \"order\": 0,\n  \"mappings\": {\n    \"tweet\": {\n      \"_source\": {\n        \"enabled\": true\n      },\n      \"properties\": {\n        \"message\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n```\n\n### Issue:\n\nNow this is what happen when doing an upsert with both elasticsearch versions:\n\n```\nPOST /twitter:0/tweet/1/_update\n{\n  \"doc\": {\n    \"message\": \"test\"\n  },\n  \"doc_as_upsert\": true\n}\n```\n\n**Elasticsearch 2.1.0:**\n\n```\n{\n  \"_index\": \"twitter:0\",\n  \"_type\": \"tweet\",\n  \"_id\": \"1\",\n  \"_version\": 1,\n  \"_shards\": {\n    \"total\": 2,\n    \"successful\": 1,\n    \"failed\": 0\n  }\n}\n```\n\n**Elasticsearch 2.3.0:**\n\n```\n{\n  \"error\": {\n    \"root_cause\": [\n      {\n        \"type\": \"index_not_found_exception\",\n        \"reason\": \"no such index\",\n        \"resource.type\": \"index_expression\",\n        \"resource.id\": \"twitter:0\",\n        \"index\": \"twitter:0\"\n      }\n    ],\n    \"type\": \"index_not_found_exception\",\n    \"reason\": \"no such index\",\n    \"resource.type\": \"index_expression\",\n    \"resource.id\": \"twitter:0\",\n    \"index\": \"twitter:0\"\n  },\n  \"status\": 404\n}\n```\n\nThanks again for looking at this bug\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/240674890","html_url":"https://github.com/elastic/elasticsearch/issues/19857#issuecomment-240674890","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19857","id":240674890,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MDY3NDg5MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-08-18T09:43:49Z","updated_at":"2016-08-18T09:43:49Z","author_association":"CONTRIBUTOR","body":"thanks for the recreation @mouadino \n\nI hoped this would be fixed by https://github.com/elastic/elasticsearch/pull/19478 but apparently not.  This still fails on 2.4.0.  \n\nI think that theoretically this should work, but it might be complicated.  The logic should be:\n- does the index exist?\n- if not, can i create the index? (check auto create)\n- is there a matching template?\n- create the index with the mappings\n- does the mapping exist?\n- if not, can i create the mapping? (check index.mapper.dynamic)\n- create the mapping\n\nThe downside here is that (with auto create true, and mapper dynamic false) you can end up creating an index even though you can't create the type.  But i think that makes sense.\n\n@jimferenczi could you take a look please?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/240681718","html_url":"https://github.com/elastic/elasticsearch/issues/19857#issuecomment-240681718","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19857","id":240681718,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MDY4MTcxOA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-08-18T10:11:27Z","updated_at":"2016-08-18T10:11:27Z","author_association":"MEMBER","body":"> I hoped this would be fixed by #19478 but apparently not. This still fails on 2.4.0.\n\nWhen set at the node level we don't check if a template would have matched.  https://github.com/elastic/elasticsearch/pull/19478 fixed the case where it is set at the index level for instance within the template:\n\n```\n{\n  \"template\": \"*\",\n  \"order\":0,\n  \"settings\": {\n    \"index.mapper.dynamic\": false\n  },\n  \"mappings\": {\n    \"tweet\": {\n      \"_source\":{\n        \"enabled\":true\n      },\n      \"properties\": {\n        \"message\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n```\n\n... this works with the downside that @clintongormley mentioned:\n\n> The downside here is that (with auto create true, and mapper dynamic false) you can end up creating an index even though you can't create the type.\n\nSince it is not possible to set this setting at the node level in 5.x I don't think we should try to fix it in 2.x but rather document the alternative ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/240690095","html_url":"https://github.com/elastic/elasticsearch/issues/19857#issuecomment-240690095","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19857","id":240690095,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MDY5MDA5NQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-08-18T10:53:36Z","updated_at":"2016-08-18T10:53:36Z","author_association":"CONTRIBUTOR","body":"> Since it is not possible to set this setting at the node level in 5.x I don't think we should try to fix it in 2.x but rather document the alternative ?\n\nAhhh thanks, I'd forgotten about that. Same reason i closed a similar issue previously.\n\n+1 to docs\n","performed_via_github_app":null}]