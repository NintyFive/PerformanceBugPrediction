[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478976162","html_url":"https://github.com/elastic/elasticsearch/issues/40731#issuecomment-478976162","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40731","id":478976162,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODk3NjE2Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-04-02T12:37:39Z","updated_at":"2019-04-02T12:37:39Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/479453485","html_url":"https://github.com/elastic/elasticsearch/issues/40731#issuecomment-479453485","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40731","id":479453485,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3OTQ1MzQ4NQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-04-03T11:41:59Z","updated_at":"2019-04-03T11:41:59Z","author_association":"CONTRIBUTOR","body":"Examined this build: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=openjdk12,ES_RUNTIME_JAVA=zulu8,nodes=immutable&&linux&&docker/335/consoleText\r\n\r\nHere upgraded-node-1 seems to die due to an assertion:\r\n\r\n```\r\n2019-04-02T18:03:09,757][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [upgraded-node-1] fatal error in thread [elasticsearch[upgraded-node-1][management][T#4]], exiting\r\njava.lang.AssertionError: shard [reindexed_index][0], node[hL16jyhTSAifGdmjplE2jg], relocating [RSLEQgbRRrSV7Ou06v1rJw], [P], s[RELOCATING], a[id=Sm6H5wWSRuKxEJ61RKWP2A, rId=jNGWG1sfQQuaiL-4LEK7Xg], expected_shard_size[3689] is not a primary shard in primary mode\r\n        at org.elasticsearch.index.shard.IndexShard.assertPrimaryMode(IndexShard.java:1587) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.shard.IndexShard.syncRetentionLeases(IndexShard.java:2051) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.IndexService.lambda$sync$12(IndexService.java:833) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.shard.IndexShard.lambda$runUnderPrimaryPermit$16(IndexShard.java:2571) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:269) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:236) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationPermit(IndexShard.java:2519) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.shard.IndexShard.runUnderPrimaryPermit(IndexShard.java:2575) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.IndexService.sync(IndexService.java:832) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.IndexService.syncRetentionLeases(IndexService.java:815) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.IndexService.access$900(IndexService.java:99) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.index.IndexService$AsyncRetentionLeaseSyncTask.runInternal(IndexService.java:1002) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.AbstractAsyncTask.run(AbstractAsyncTask.java:141) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:677) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_202]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_202]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_202]\r\n```\r\n\r\nThanks @DaveCTurner for helping me find this! Seems like a problem maybe with relocation hand-off related to retention lease syncing?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/479490306","html_url":"https://github.com/elastic/elasticsearch/issues/40731#issuecomment-479490306","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40731","id":479490306,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3OTQ5MDMwNg==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-04-03T13:31:37Z","updated_at":"2019-04-03T13:31:37Z","author_association":"MEMBER","body":"Relates to https://github.com/elastic/elasticsearch/pull/40386#pullrequestreview-218343687","performed_via_github_app":null}]