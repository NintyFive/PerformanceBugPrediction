{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3878","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3878/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3878/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3878/events","html_url":"https://github.com/elastic/elasticsearch/issues/3878","id":20825432,"node_id":"MDU6SXNzdWUyMDgyNTQzMg==","number":3878,"title":"Search using BooleanQueryBuilder and GeoShapeQueryBuilder results in \"Current context not an ARRAY but OBJECT\"","user":{"login":"sowelie","id":2085036,"node_id":"MDQ6VXNlcjIwODUwMzY=","avatar_url":"https://avatars0.githubusercontent.com/u/2085036?v=4","gravatar_id":"","url":"https://api.github.com/users/sowelie","html_url":"https://github.com/sowelie","followers_url":"https://api.github.com/users/sowelie/followers","following_url":"https://api.github.com/users/sowelie/following{/other_user}","gists_url":"https://api.github.com/users/sowelie/gists{/gist_id}","starred_url":"https://api.github.com/users/sowelie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sowelie/subscriptions","organizations_url":"https://api.github.com/users/sowelie/orgs","repos_url":"https://api.github.com/users/sowelie/repos","events_url":"https://api.github.com/users/sowelie/events{/privacy}","received_events_url":"https://api.github.com/users/sowelie/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":56772237,"node_id":"MDU6TGFiZWw1Njc3MjIzNw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.6","name":"v0.90.6","color":"e0e0e0","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"assignees":[{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2013-10-10T18:20:05Z","updated_at":"2016-04-04T15:47:58Z","closed_at":"2013-10-11T15:53:36Z","author_association":"NONE","active_lock_reason":null,"body":"First of all, thanks for building such an amazing service. I am loving my experience with ElasticSearch so far.\n\nWhat I've run into is that trying to use the BooleanQueryBuilder in conjunction with the GeoShapeQueryBuilder is resulting in the following exception.\n\n```\norg.elasticsearch.search.builder.SearchSourceBuilderException: Failed to build search source\n    at org.elasticsearch.search.builder.SearchSourceBuilder.buildAsBytes(SearchSourceBuilder.java:579)\n    at org.elasticsearch.action.search.SearchRequest.source(SearchRequest.java:258)\n    at org.elasticsearch.action.search.SearchRequestBuilder.doExecute(SearchRequestBuilder.java:839)\n    at org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:85)\n    at org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:59)\n    at com.tomtom.lbs.vectordb.data.services.ElasticSearchService.search(ElasticSearchService.java:119)\n    ... 38 more\nCaused by: org.elasticsearch.common.jackson.core.JsonGenerationException: Current context not an ARRAY but OBJECT\n    at org.elasticsearch.common.jackson.core.base.GeneratorBase._reportError(GeneratorBase.java:444)\n    at org.elasticsearch.common.jackson.dataformat.smile.SmileGenerator.writeEndArray(SmileGenerator.java:553)\n    at org.elasticsearch.common.xcontent.json.JsonXContentGenerator.writeEndArray(JsonXContentGenerator.java:59)\n    at org.elasticsearch.common.xcontent.XContentBuilder.endArray(XContentBuilder.java:227)\n    at org.elasticsearch.index.query.BoolQueryBuilder.doXArrayContent(BoolQueryBuilder.java:182)\n    at org.elasticsearch.index.query.BoolQueryBuilder.doXContent(BoolQueryBuilder.java:149)\n    at org.elasticsearch.index.query.BaseQueryBuilder.toXContent(BaseQueryBuilder.java:65)\n    at org.elasticsearch.search.builder.SearchSourceBuilder.toXContent(SearchSourceBuilder.java:601)\n    at org.elasticsearch.search.builder.SearchSourceBuilder.buildAsBytes(SearchSourceBuilder.java:576)\n    ... 43 more\n```\n\nHere is my code to build and execute the query:\n\n``` java\nGeoShapeQueryBuilder geoQuery = QueryBuilders.geoShapeQuery(\"searchGeometry\", new RectangleImpl(y1, y2, x1, x2, SpatialContext.GEO));\nBoolQueryBuilder query = QueryBuilders.boolQuery();\n\nif (featureIds.length > 0)\n        query.must(QueryBuilders.termQuery(\"featureType\", featureIds[0]));\n\nquery.must(geoQuery);\n\nSearchRequestBuilder request = esClient.prepareSearch(\"index_name\")\n        .setSearchType(SearchType.QUERY_THEN_FETCH)\n        .setQuery(query)\n        .setFrom(0)\n        .setSize(maxResults)\n        .setExplain(false);\n\nSearchResponse response = request.execute().actionGet();\n```\n\nAm I doing something wrong?  I have a feeling I am but it looks right to me.\n\nThis isn't a big deal for me, because I can just build a JSON query manually and that works perfectly fine.  However it'd be nice to be able to use the QueryBuilders as make the code much easier to read.\n\nThanks!\n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}