[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/60968605","html_url":"https://github.com/elastic/elasticsearch/issues/8277#issuecomment-60968605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8277","id":60968605,"node_id":"MDEyOklzc3VlQ29tbWVudDYwOTY4NjA1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-29T17:34:57Z","updated_at":"2014-10-29T17:34:57Z","author_association":"CONTRIBUTOR","body":"Hi @Elachance \n\nI've created a replication of the steps you describe which demonstrates that things work correctly:\n\n```\nDELETE /_all\nDELETE _template/*\n\nPUT /_template/couchbase\n{\n  \"template\": \"*\",\n  \"mappings\": {\n    \"couchbaseCheckpoint\": {\n      \"_source\": {\n        \"includes\": [\n          \"meta.*\",\n          \"doc.*\"\n        ]\n      },\n      \"dynamic_templates\": [\n        {\n          \"store_no_index\": {\n            \"mapping\": {\n              \"index\": \"no\",\n              \"include_in_all\": false,\n              \"store\": \"no\"\n            },\n            \"match\": \"*\"\n          }\n        }\n      ],\n      \"properties\": {\n        \"meta\": {\n          \"include_in_all\": false,\n          \"type\": \"object\"\n        }\n      }\n    }\n  }\n}\n\nPUT /foo/bar/1\n{}\n\nGET /_mapping\n\nDELETE /foo\n\nPUT /_template/couchbase\n{\n  \"template\": \"couch-*\",\n  \"mappings\": {\n    \"couchbaseCheckpoint\": {\n      \"_source\": {\n        \"includes\": [\n          \"meta.*\",\n          \"doc.*\"\n        ]\n      },\n      \"dynamic_templates\": [\n        {\n          \"store_no_index\": {\n            \"mapping\": {\n              \"index\": \"no\",\n              \"include_in_all\": false,\n              \"store\": \"no\"\n            },\n            \"match\": \"*\"\n          }\n        }\n      ],\n      \"properties\": {\n        \"meta\": {\n          \"include_in_all\": false,\n          \"type\": \"object\"\n        }\n      }\n    }\n  }\n}\n\nPUT /foo/bar/1\n{}\n\nPUT /couch-foo\n\nGET /_mapping\n```\n\nI think the likeliest problem is that you missed out on some step above, or that couchbase overwrote your template?  Either way, could you check your steps again and, if still not working, provide a curl recreation which demonstrates the problem?\n\nthanks    \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61016733","html_url":"https://github.com/elastic/elasticsearch/issues/8277#issuecomment-61016733","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8277","id":61016733,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMDE2NzMz","user":{"login":"Elachance","id":3589443,"node_id":"MDQ6VXNlcjM1ODk0NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/3589443?v=4","gravatar_id":"","url":"https://api.github.com/users/Elachance","html_url":"https://github.com/Elachance","followers_url":"https://api.github.com/users/Elachance/followers","following_url":"https://api.github.com/users/Elachance/following{/other_user}","gists_url":"https://api.github.com/users/Elachance/gists{/gist_id}","starred_url":"https://api.github.com/users/Elachance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Elachance/subscriptions","organizations_url":"https://api.github.com/users/Elachance/orgs","repos_url":"https://api.github.com/users/Elachance/repos","events_url":"https://api.github.com/users/Elachance/events{/privacy}","received_events_url":"https://api.github.com/users/Elachance/received_events","type":"User","site_admin":false},"created_at":"2014-10-29T22:32:40Z","updated_at":"2014-10-29T22:32:40Z","author_association":"NONE","body":"``` json\ncurl -XDELETE http://localhost:9200/_all?pretty=yes\n{\n  \"acknowledged\" : true\n}\ncurl -XDELETE http://localhost:9200/_template/*?pretty=yes\n{\n  \"acknowledged\" : true\n}\ncurl -XPUT http://localhost:9200/_template/couchbase?pretty=true -d @couchbase_template.json\n{\n  \"acknowledged\" : true\n}\ncurl -XPUT http://localhost:9200/test?pretty=true\n{\n  \"acknowledged\" : true\n}\ncurl -XGET http://localhost:9200/_mapping?pretty=true\n{\n  \"test\" : {\n    \"mappings\" : {\n      \"_default_\" : {\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      },\n      \"couchbaseCheckpoint\" : {\n        \"dynamic_templates\" : [ {\n          \"store_no_index\" : {\n            \"mapping\" : {\n              \"include_in_all\" : false,\n              \"index\" : \"no\",\n              \"store\" : \"no\"\n            },\n            \"match\" : \"*\"\n          }\n        } ],\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\", \"doc.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      }\n    }\n  }\n}\ncurl -XDELETE http://localhost:9200/test?pretty=yes\n{\n  \"acknowledged\" : true\n}\nvi couchbase_template.json\n```\n\nHere is where I changed the template to have \"couch-_\" instead of \"_\"\n\n``` json\ncurl -XPUT http://localhost:9200/_template/couchbase?pretty=true -d @couchbase_template.json\n{\n  \"acknowledged\" : true\n}\ncurl -XPUT http://localhost:9200/test?pretty=true\n{\n  \"acknowledged\" : true\n}\ncurl -XPUT http://localhost:9200/couch-foo?pretty=true\n{\n  \"acknowledged\" : true\n}\ncurl -XGET http://localhost:9200/_mapping?pretty=true\n{\n  \"couch-foo\" : {\n    \"mappings\" : {\n      \"_default_\" : {\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      },\n      \"couchbaseCheckpoint\" : {\n        \"dynamic_templates\" : [ {\n          \"store_no_index\" : {\n            \"mapping\" : {\n              \"include_in_all\" : false,\n              \"index\" : \"no\",\n              \"store\" : \"no\"\n            },\n            \"match\" : \"*\"\n          }\n        } ],\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\", \"doc.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      }\n    }\n  },\n  \"test\" : {\n    \"mappings\" : {\n      \"_default_\" : {\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      },\n      \"couchbaseCheckpoint\" : {\n        \"dynamic_templates\" : [ {\n          \"store_no_index\" : {\n            \"mapping\" : {\n              \"include_in_all\" : false,\n              \"index\" : \"no\",\n              \"store\" : \"no\"\n            },\n            \"match\" : \"*\"\n          }\n        } ],\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\", \"doc.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nJust to make sure it was using the template I wanted I did this:\n\n``` json\ncurl -XGET localhost:9200/_template/?pretty=true\n{\n  \"couchbase\" : {\n    \"order\" : 10,\n    \"template\" : \"couch-*\",\n    \"settings\" : { },\n    \"mappings\" : {\n      \"_default_\" : {\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"include_in_all\" : false,\n            \"type\" : \"object\"\n          }\n        }\n      },\n      \"couchbaseCheckpoint\" : {\n        \"_source\" : {\n          \"includes\" : [ \"doc.*\" ]\n        },\n        \"dynamic_templates\" : [ {\n          \"store_no_index\" : {\n            \"mapping\" : {\n              \"include_in_all\" : false,\n              \"index\" : \"no\",\n              \"store\" : \"no\"\n            },\n            \"match\" : \"*\"\n          }\n        } ]\n      }\n    },\n    \"aliases\" : { }\n  }\n}\n```\n\nSo the template is right, but the mappings still get messed up. Is there any way the transport-couchbase plugin could be sneaking the original template in somewhere?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61071251","html_url":"https://github.com/elastic/elasticsearch/issues/8277#issuecomment-61071251","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8277","id":61071251,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMDcxMjUx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-30T10:26:07Z","updated_at":"2014-10-30T10:26:07Z","author_association":"CONTRIBUTOR","body":"Hmm this is very odd.  What version of Elasticsearch are you using?  I wonder if this is an old bug.\n\nCould you also try deleting all templates before putting your new version:\n\n```\nDELETE /_template/*\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61113894","html_url":"https://github.com/elastic/elasticsearch/issues/8277#issuecomment-61113894","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8277","id":61113894,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMTEzODk0","user":{"login":"Elachance","id":3589443,"node_id":"MDQ6VXNlcjM1ODk0NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/3589443?v=4","gravatar_id":"","url":"https://api.github.com/users/Elachance","html_url":"https://github.com/Elachance","followers_url":"https://api.github.com/users/Elachance/followers","following_url":"https://api.github.com/users/Elachance/following{/other_user}","gists_url":"https://api.github.com/users/Elachance/gists{/gist_id}","starred_url":"https://api.github.com/users/Elachance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Elachance/subscriptions","organizations_url":"https://api.github.com/users/Elachance/orgs","repos_url":"https://api.github.com/users/Elachance/repos","events_url":"https://api.github.com/users/Elachance/events{/privacy}","received_events_url":"https://api.github.com/users/Elachance/received_events","type":"User","site_admin":false},"created_at":"2014-10-30T15:40:18Z","updated_at":"2014-10-30T15:40:18Z","author_association":"NONE","body":"Elasticsearch Version 1.3.0, transport-couchbase version 2.0.0\n\n``` json\ncurl -XDELETE http://localhost:9200/_template/*?pretty=yes\n{\n  \"acknowledged\" : true\n}\ncurl -XGET localhost:9200/_template/?pretty=true\n{ }\ncurl -XGET http://localhost:9200/_mapping?pretty=true\n{ }\ncurl -XPUT http://localhost:9200/_template/couchbase?pretty=true -d @couchbase_template.json\n{\n  \"acknowledged\" : true\n}\ncurl -XGET localhost:9200/_template/?pretty=true\n{\n  \"couchbase\" : {\n    \"order\" : 10,\n    \"template\" : \"couch-*\",\n    \"settings\" : { },\n    \"mappings\" : {\n      \"_default_\" : {\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"include_in_all\" : false,\n            \"type\" : \"object\"\n          }\n        }\n      },\n      \"couchbaseCheckpoint\" : {\n        \"_source\" : {\n          \"includes\" : [ \"doc.*\" ]\n        },\n        \"dynamic_templates\" : [ {\n          \"store_no_index\" : {\n            \"mapping\" : {\n              \"include_in_all\" : false,\n              \"index\" : \"no\",\n              \"store\" : \"no\"\n            },\n            \"match\" : \"*\"\n          }\n        } ]\n      }\n    },\n    \"aliases\" : { }\n  }\n}\ncurl -XPUT http://localhost:9200/foo?pretty=true\n{\n  \"acknowledged\" : true\n}\ncurl -XPUT http://localhost:9200/couch-foo?pretty=true\n{\n  \"acknowledged\" : true\n}\ncurl -XGET http://localhost:9200/_mapping?pretty=true\n{\n  \"foo\" : {\n    \"mappings\" : {\n      \"_default_\" : {\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      },\n      \"couchbaseCheckpoint\" : {\n        \"dynamic_templates\" : [ {\n          \"store_no_index\" : {\n            \"mapping\" : {\n              \"include_in_all\" : false,\n              \"index\" : \"no\",\n              \"store\" : \"no\"\n            },\n            \"match\" : \"*\"\n          }\n        } ],\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\", \"doc.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      }\n    }\n  },\n  \"couch-foo\" : {\n    \"mappings\" : {\n      \"_default_\" : {\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      },\n      \"couchbaseCheckpoint\" : {\n        \"dynamic_templates\" : [ {\n          \"store_no_index\" : {\n            \"mapping\" : {\n              \"include_in_all\" : false,\n              \"index\" : \"no\",\n              \"store\" : \"no\"\n            },\n            \"match\" : \"*\"\n          }\n        } ],\n        \"_source\" : {\n          \"includes\" : [ \"meta.*\", \"doc.*\" ]\n        },\n        \"properties\" : {\n          \"meta\" : {\n            \"type\" : \"object\",\n            \"include_in_all\" : false\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nNo dice :(\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61258208","html_url":"https://github.com/elastic/elasticsearch/issues/8277#issuecomment-61258208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8277","id":61258208,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjU4MjA4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-31T13:17:00Z","updated_at":"2014-10-31T13:17:00Z","author_association":"CONTRIBUTOR","body":"OK  I've tried the steps above with 1.3.0 and I'm not seeing what you're seeing.  Try removing the couchbase plugin and repeating the steps above.  See if it changes things.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61310177","html_url":"https://github.com/elastic/elasticsearch/issues/8277#issuecomment-61310177","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8277","id":61310177,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMzEwMTc3","user":{"login":"Elachance","id":3589443,"node_id":"MDQ6VXNlcjM1ODk0NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/3589443?v=4","gravatar_id":"","url":"https://api.github.com/users/Elachance","html_url":"https://github.com/Elachance","followers_url":"https://api.github.com/users/Elachance/followers","following_url":"https://api.github.com/users/Elachance/following{/other_user}","gists_url":"https://api.github.com/users/Elachance/gists{/gist_id}","starred_url":"https://api.github.com/users/Elachance/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Elachance/subscriptions","organizations_url":"https://api.github.com/users/Elachance/orgs","repos_url":"https://api.github.com/users/Elachance/repos","events_url":"https://api.github.com/users/Elachance/events{/privacy}","received_events_url":"https://api.github.com/users/Elachance/received_events","type":"User","site_admin":false},"created_at":"2014-10-31T18:48:24Z","updated_at":"2014-10-31T18:48:24Z","author_association":"NONE","body":"Turns out there was an old version of the template in /etc/elasticsearch/templates that was screwing up mappings. All fixed now! Thanks for your help.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61370344","html_url":"https://github.com/elastic/elasticsearch/issues/8277#issuecomment-61370344","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8277","id":61370344,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMzcwMzQ0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-01T14:45:31Z","updated_at":"2014-11-01T14:45:31Z","author_association":"CONTRIBUTOR","body":"Ah right, thanks for letting us know\n","performed_via_github_app":null}]