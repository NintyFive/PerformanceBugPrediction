{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336/events","html_url":"https://github.com/elastic/elasticsearch/issues/3336","id":16793856,"node_id":"MDU6SXNzdWUxNjc5Mzg1Ng==","number":3336,"title":"memory leak while scrolling over index","user":{"login":"schmir","id":40620,"node_id":"MDQ6VXNlcjQwNjIw","avatar_url":"https://avatars3.githubusercontent.com/u/40620?v=4","gravatar_id":"","url":"https://api.github.com/users/schmir","html_url":"https://github.com/schmir","followers_url":"https://api.github.com/users/schmir/followers","following_url":"https://api.github.com/users/schmir/following{/other_user}","gists_url":"https://api.github.com/users/schmir/gists{/gist_id}","starred_url":"https://api.github.com/users/schmir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmir/subscriptions","organizations_url":"https://api.github.com/users/schmir/orgs","repos_url":"https://api.github.com/users/schmir/repos","events_url":"https://api.github.com/users/schmir/events{/privacy}","received_events_url":"https://api.github.com/users/schmir/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"assignees":[{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2013-07-16T05:57:08Z","updated_at":"2013-07-17T14:05:37Z","closed_at":"2013-07-17T13:43:17Z","author_association":"NONE","active_lock_reason":null,"body":"(I've tried to report this via the google group. Either I'm being moderated or google doesn't like me. sorry for posting it twice)\n\nI'm trying to scroll over all documents of an ElasticSearch Index using\na match_all query. I've set ES_HEAP_SIZE to 8G but I'm not able to\ncomplete the operation, because elasticsearch runs out of memory (see\nlog at the end of this mail).\n\nThe head plugin tells me the index size is around 400GB with around 9.5M\ndocuments. I'm using a single document type with the following mapping:\n\n<pre>\n{\n    \"src_doc\": {\n        \"_all\": {\n            \"enabled\": false\n        }, \n        \"_source\": {\n            \"enabled\": false\n        }, \n        \"properties\": {\n            \"content\": {\n                \"type\": \"binary\"\n            }, \n            \"exception\": {\n                \"index\": \"no\", \n                \"store\": true, \n                \"type\": \"string\"\n            }, \n            \"last_update\": {\n                \"format\": \"YYYY-MM-dd\", \n                \"store\": true, \n                \"type\": \"date\"\n            }, \n            \"title\": {\n                \"index\": \"no\", \n                \"store\": true, \n                \"type\": \"string\"\n            }, \n            \"uid\": {\n                \"index\": \"no\", \n                \"type\": \"string\"\n            }, \n            \"url\": {\n                \"index\": \"no\", \n                \"store\": true, \n                \"type\": \"string\"\n            }\n        }\n    }\n}\n</pre>\n\n\nI'm using ElasticSearch 0.90.2, but the issue has already been in\n0.90.0. The Cluster is a single node, which is not being used otherwise.\n\nHere's the log:\n\n<pre>\n2013-07-12T13:59:39.40468 java.lang.OutOfMemoryError: Java heap space\n2013-07-12T13:59:39.43523 Dumping heap to java_pid8908.hprof ...\n2013-07-12T14:00:14.69555 Heap dump file created [8513498041 bytes in 35.278 secs]\n2013-07-12T14:00:14.73700 [2013-07-12 16:00:14,702][WARN ][http.netty               ] [graph.8908] Caught exception while handling client http traffic, closing connection [id: 0x8d823a3d, /127.0.0.1:52874 => /127.0.0.1:9250]\n2013-07-12T14:00:14.73702 java.lang.OutOfMemoryError: Java heap space\n2013-07-12T14:00:14.73702   at java.nio.HeapByteBuffer.<init>(HeapByteBuffer.java:57)\n2013-07-12T14:00:14.73702   at java.nio.ByteBuffer.allocate(ByteBuffer.java:331)\n2013-07-12T14:00:14.73702   at org.elasticsearch.common.netty.buffer.CompositeChannelBuffer.toByteBuffer(CompositeChannelBuffer.java:649)\n2013-07-12T14:00:14.73703   at org.elasticsearch.common.netty.buffer.AbstractChannelBuffer.toByteBuffer(AbstractChannelBuffer.java:530)\n2013-07-12T14:00:14.73703   at org.elasticsearch.common.netty.channel.socket.nio.SocketSendBufferPool.acquire(SocketSendBufferPool.java:77)\n2013-07-12T14:00:14.73703   at org.elasticsearch.common.netty.channel.socket.nio.SocketSendBufferPool.acquire(SocketSendBufferPool.java:46)\n2013-07-12T14:00:14.73703   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.write0(AbstractNioWorker.java:194)\n2013-07-12T14:00:14.73703   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.writeFromTaskLoop(AbstractNioWorker.java:152)\n2013-07-12T14:00:14.73704   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioChannel$WriteTask.run(AbstractNioChannel.java:335)\n2013-07-12T14:00:14.73704   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.processTaskQueue(AbstractNioSelector.java:366)\n2013-07-12T14:00:14.73705   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:290)\n2013-07-12T14:00:14.73706   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:90)\n2013-07-12T14:00:14.73706   at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n2013-07-12T14:00:14.73706   at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n2013-07-12T14:00:14.73706   at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n2013-07-12T14:00:14.73706   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n2013-07-12T14:00:14.73707   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n2013-07-12T14:00:14.73707   at java.lang.Thread.run(Thread.java:722)\n2013-07-12T14:00:18.29386 [2013-07-12 16:00:18,293][WARN ][http.netty               ] [graph.8908] Caught exception while handling client http traffic, closing connection [id: 0xd2b513bc, /127.0.0.1:52875 => /127.0.0.1:9250]\n2013-07-12T14:00:18.29388 java.lang.OutOfMemoryError: Java heap space\n2013-07-12T14:00:18.29388   at java.nio.HeapByteBuffer.<init>(HeapByteBuffer.java:57)\n2013-07-12T14:00:18.29388   at java.nio.ByteBuffer.allocate(ByteBuffer.java:331)\n2013-07-12T14:00:18.29388   at org.elasticsearch.common.netty.buffer.CompositeChannelBuffer.toByteBuffer(CompositeChannelBuffer.java:649)\n2013-07-12T14:00:18.29389   at org.elasticsearch.common.netty.buffer.AbstractChannelBuffer.toByteBuffer(AbstractChannelBuffer.java:530)\n2013-07-12T14:00:18.29389   at org.elasticsearch.common.netty.channel.socket.nio.SocketSendBufferPool.acquire(SocketSendBufferPool.java:77)\n2013-07-12T14:00:18.29389   at org.elasticsearch.common.netty.channel.socket.nio.SocketSendBufferPool.acquire(SocketSendBufferPool.java:46)\n2013-07-12T14:00:18.29389   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.write0(AbstractNioWorker.java:194)\n2013-07-12T14:00:18.29389   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.writeFromTaskLoop(AbstractNioWorker.java:152)\n2013-07-12T14:00:18.29390   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioChannel$WriteTask.run(AbstractNioChannel.java:335)\n2013-07-12T14:00:18.29390   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.processTaskQueue(AbstractNioSelector.java:366)\n2013-07-12T14:00:18.29391   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:290)\n2013-07-12T14:00:18.29391   at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:90)\n2013-07-12T14:00:18.29391   at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n2013-07-12T14:00:18.29391   at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n2013-07-12T14:00:18.29391   at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n2013-07-12T14:00:18.29391   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n2013-07-12T14:00:18.29392   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n2013-07-12T14:00:18.29392   at java.lang.Thread.run(Thread.java:722)\n</pre>\n\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}