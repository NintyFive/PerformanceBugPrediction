{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5748","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5748/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5748/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5748/events","html_url":"https://github.com/elastic/elasticsearch/issues/5748","id":31162960,"node_id":"MDU6SXNzdWUzMTE2Mjk2MA==","number":5748,"title":"Force smooth shard allocation","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2014-04-09T14:42:35Z","updated_at":"2014-09-04T23:00:10Z","closed_at":"2014-04-09T18:12:20Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"So I have one index that will get tons more traffic then all the others.  For that reason its pretty important that its shards get spread out reasonably evenly even in the face of things like rolling restarts, failed nodes, and the like.  I'm pretty sure the distribution is reasonably random right now.  Could Elasticsearch bias towards smoothly distributing the shards?\n\nThis came up because I started load testing Elasticsearch and saw this:\n![bad_distribution](https://cloud.githubusercontent.com/assets/215970/2656564/6426017c-bff3-11e3-8c31-918f0319c908.png)\nThat is, elastic1003 isn't seeing any load at all and elastic105 and elastic1011 aren't shouldering their fair share.\n\nOn digging, I got this:\n\n```\nmanybubbles@elastic1008:~$ curl -s 'localhost:9200/_cat/shards/enwiki_content_1395837666' | perl -pe 's/.*(elastic.*)/\\1/' | sort | uniq -c \n      3 elastic1001 \n      2 elastic1002 \n      2 elastic1004 \n      1 elastic1005 \n      3 elastic1006 \n      3 elastic1007 \n      4 elastic1008 \n      3 elastic1009 \n      2 elastic1010 \n      1 elastic1011 \n      4 elastic1012 \n      3 elastic1013 \n      3 elastic1014 \n      3 elastic1015 \n      3 elastic1016 \n```\n\nWhich shows that elastic1003 doesn't have any of the shards and elastic1005 and elastic1011 only have one each.\n\nAnnoying work around: I can use the allocation api to shift shards from the nodes with more to the nodes with fewer.  It'd be much better if it were automatic.\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}