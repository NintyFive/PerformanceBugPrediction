[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476496288","html_url":"https://github.com/elastic/elasticsearch/issues/40441#issuecomment-476496288","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40441","id":476496288,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjQ5NjI4OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T06:45:59Z","updated_at":"2019-03-26T06:45:59Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476545209","html_url":"https://github.com/elastic/elasticsearch/issues/40441#issuecomment-476545209","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40441","id":476545209,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjU0NTIwOQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T09:38:16Z","updated_at":"2019-03-26T09:38:16Z","author_association":"CONTRIBUTOR","body":"This is the same as https://github.com/elastic/elasticsearch/issues/37117#issuecomment-466949747, which seems to have been fixed in 7.1 and above by #39099 - see https://github.com/elastic/elasticsearch/issues/37117#issuecomment-476114159.\r\n\r\n@jpountz how risky would it be to backport #39099 to the 6.7 branch?  CI will be running on 6.7 for another 18 months or so, so this failure will continue to plague us for a long time if the problem is left unfixed on the 6.7 branch.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476554575","html_url":"https://github.com/elastic/elasticsearch/issues/40441#issuecomment-476554575","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40441","id":476554575,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjU1NDU3NQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T10:04:00Z","updated_at":"2019-03-26T10:04:00Z","author_association":"CONTRIBUTOR","body":"@droberts195 It looks ok risk-wise. I will give it a try now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476646622","html_url":"https://github.com/elastic/elasticsearch/issues/40441#issuecomment-476646622","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40441","id":476646622,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjY0NjYyMg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T13:47:53Z","updated_at":"2019-03-26T13:47:53Z","author_association":"CONTRIBUTOR","body":"@droberts195 I just backported to 7.0. On 6.7 I only backported the part that makes the map synchronized as the other changes relate to the introduction of ref-counting on open shards, which I think is unsafe for 6.7. Let's see whether this is enough to make things better.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476651972","html_url":"https://github.com/elastic/elasticsearch/issues/40441#issuecomment-476651972","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40441","id":476651972,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjY1MTk3Mg==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T13:56:20Z","updated_at":"2019-03-26T13:56:20Z","author_association":"CONTRIBUTOR","body":"Great, thanks for doing that so quickly @jpountz.  In a few weeks' time I will check the [build-stats](https://build-stats.elastic.co/app/kibana#/discover?_g=(refreshInterval:(pause:!t,value:0),time:(from:now-1y,mode:quick,to:now))&_a=(columns:!(_source),index:e58bf320-7efd-11e8-bf69-63c8ef516157,interval:auto,query:(language:lucene,query:'stacktrace:%22org.elasticsearch.indices.IndicesQueryCache.close%22'),sort:!(time,desc))) link that tracks failures with `org.elasticsearch.indices.IndicesQueryCache.close` in a stack trace and see what the pattern looks like.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/485812316","html_url":"https://github.com/elastic/elasticsearch/issues/40441#issuecomment-485812316","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40441","id":485812316,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NTgxMjMxNg==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-04-23T13:53:11Z","updated_at":"2019-04-23T13:53:11Z","author_association":"CONTRIBUTOR","body":"No test failure with `org.elasticsearch.indices.IndicesQueryCache.close` in its stack trace has been observed since 25th March, which is the day before the fix was backported to 6.7.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/487906638","html_url":"https://github.com/elastic/elasticsearch/issues/40441#issuecomment-487906638","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40441","id":487906638,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzkwNjYzOA==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2019-04-30T10:47:06Z","updated_at":"2019-04-30T10:47:06Z","author_association":"MEMBER","body":"Bah a new failure on the 6.7 branch. This is the only failure I can find since the fix went in. \r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.7+multijob-unix-compatibility/os=centos-7&&immutable/138/console\r\n\r\n```\r\njava.lang.AssertionError: 2\r\n\tat __randomizedtesting.SeedInfo.seed([70F57926E973817:E8BA0B69A990269A]:0)\r\n\tat org.elasticsearch.indices.IndicesQueryCache.close(IndicesQueryCache.java:190)\r\n\tat org.elasticsearch.core.internal.io.IOUtils.closeWhileHandlingException(IOUtils.java:145)\r\n\tat org.elasticsearch.core.internal.io.IOUtils.closeWhileHandlingException(IOUtils.java:130)\r\n\tat org.elasticsearch.indices.IndicesService.doClose(IndicesService.java:298)\r\n\tat org.elasticsearch.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:112)\r\n\tat org.elasticsearch.core.internal.io.IOUtils.close(IOUtils.java:103)\r\n\tat org.elasticsearch.core.internal.io.IOUtils.close(IOUtils.java:61)\r\n\tat org.elasticsearch.node.NodeService.close(NodeService.java:135)\r\n\tat org.elasticsearch.core.internal.io.IOUtils.close(IOUtils.java:103)\r\n\tat org.elasticsearch.core.internal.io.IOUtils.close(IOUtils.java:85)\r\n\tat org.elasticsearch.node.Node.close(Node.java:946)\r\n\tat org.elasticsearch.test.InternalTestCluster$NodeAndClient.close(InternalTestCluster.java:1011)\r\n\tat org.elasticsearch.test.InternalTestCluster.stopNodesAndClients(InternalTestCluster.java:1670)\r\n\tat org.elasticsearch.test.InternalTestCluster.stopNodesAndClient(InternalTestCluster.java:1656)\r\n\tat org.elasticsearch.test.InternalTestCluster.stopRandomDataNode(InternalTestCluster.java:1550)\r\n\tat org.elasticsearch.xpack.ml.integration.BasicDistributedJobsIT.testFailOverBasics_withDataFeeder(BasicDistributedJobsIT.java:122)\r\n``` \r\n\r\nLooks like the partial fix described in https://github.com/elastic/elasticsearch/issues/40441#issuecomment-476646622 was not sufficient, reopening. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/654758505","html_url":"https://github.com/elastic/elasticsearch/issues/40441#issuecomment-654758505","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40441","id":654758505,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDc1ODUwNQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-07-07T10:28:07Z","updated_at":"2020-07-07T10:28:07Z","author_association":"CONTRIBUTOR","body":"We haven't seen this problem recently, and given that the only failure was on the 6.7 branch and 6.7 is no longer being maintained I will close it.","performed_via_github_app":null}]