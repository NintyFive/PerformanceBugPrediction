{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27109","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27109/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27109/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27109/events","html_url":"https://github.com/elastic/elasticsearch/issues/27109","id":268405195,"node_id":"MDU6SXNzdWUyNjg0MDUxOTU=","number":27109,"title":"IndexFolderUpgrader breaks all shards if there is any legacy shard left","user":{"login":"XANi","id":147394,"node_id":"MDQ6VXNlcjE0NzM5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/147394?v=4","gravatar_id":"","url":"https://api.github.com/users/XANi","html_url":"https://github.com/XANi","followers_url":"https://api.github.com/users/XANi/followers","following_url":"https://api.github.com/users/XANi/following{/other_user}","gists_url":"https://api.github.com/users/XANi/gists{/gist_id}","starred_url":"https://api.github.com/users/XANi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XANi/subscriptions","organizations_url":"https://api.github.com/users/XANi/orgs","repos_url":"https://api.github.com/users/XANi/repos","events_url":"https://api.github.com/users/XANi/events{/privacy}","received_events_url":"https://api.github.com/users/XANi/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-10-25T13:49:32Z","updated_at":"2018-03-14T10:39:07Z","closed_at":"2018-03-14T02:30:32Z","author_association":"NONE","active_lock_reason":null,"body":"ES during upgrade from 2.x to 5.x will exit with helpful message that you need to go back to 2.x and upgrade any legacy shards (and due to my mistake I still had some 1.x ones I didn't notice).\r\n\r\nExcept that check is done AFTER other shards got renamed to shard id\r\n\r\n    [2017-10-25T14:21:15,471][INFO ][o.e.c.u.IndexFolderUpgrader] [audit-2016.12/ynleThN9SaageB6sqLKJIg] upgrading [/datafs/es/logcluster/nodes/0/indices/audit-2016.12] to new naming convention\r\n    [2017-10-25T14:21:15,472][INFO ][o.e.c.u.IndexFolderUpgrader] [audit-2016.12/ynleThN9SaageB6sqLKJIg] moved from [/datafs/es/logcluster/nodes/0/indices/audit-2016.12] to [/datafs/es/logcluster/nodes/0/indices/ynleThN9SaageB6sqLKJIg]\r\n\r\nwhich means that going back to 2.x to do the migration stops being an option (it loses any info of shard's real name) as that will just turn shard names into garbage with no option to go back\r\n\r\nIMO it should run any legacy checks before modifying data in any way\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}