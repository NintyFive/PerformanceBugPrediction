[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/638421120","html_url":"https://github.com/elastic/elasticsearch/issues/57614#issuecomment-638421120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57614","id":638421120,"node_id":"MDEyOklzc3VlQ29tbWVudDYzODQyMTEyMA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2020-06-03T19:42:31Z","updated_at":"2020-06-03T19:42:31Z","author_association":"MEMBER","body":"> Provide the same text as input at https://www.atilika.org/ where you can test kuromoji analyzer.\r\nIt provides two tokens （株）, 巴商会.\r\nSeems the kuromoji analyzer is working as expected but the corresponding ES plugin is having an issue processing this text.\r\n\r\nThe `unidic` dictionary that is used internally by Lucene contains an entry for `（株）`. This means that it considers the full-width parenthesis as part of the token. The Kuromoji tokenizer is setup to remove punctuations by default (discard_punctuation is true) so the token is removed because it starts with a full-width parenthesis. However the expectation in the code is that punctuations are separated from other tokens  which is why the check is done only on the first character. This dictionary entry breaks this assumption so the fix should be in Lucene.\r\nI opened https://issues.apache.org/jira/browse/LUCENE-9390 to discuss the possible mitigations so I hope you don't mind if I close this issue.  In the meantime, the workaround is to use a custom user dictionary that overrides the tokenization for  `（株）`.\r\n\r\n\r\n","performed_via_github_app":null}]