[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297938560","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-297938560","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":297938560,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzkzODU2MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T08:22:10Z","updated_at":"2017-04-28T08:22:10Z","author_association":"CONTRIBUTOR","body":"Please provide a complete recreation of the problem in this issue, and we'll be happy to help.  ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297943343","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-297943343","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":297943343,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzk0MzM0Mw==","user":{"login":"paulohss","id":11402394,"node_id":"MDQ6VXNlcjExNDAyMzk0","avatar_url":"https://avatars1.githubusercontent.com/u/11402394?v=4","gravatar_id":"","url":"https://api.github.com/users/paulohss","html_url":"https://github.com/paulohss","followers_url":"https://api.github.com/users/paulohss/followers","following_url":"https://api.github.com/users/paulohss/following{/other_user}","gists_url":"https://api.github.com/users/paulohss/gists{/gist_id}","starred_url":"https://api.github.com/users/paulohss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulohss/subscriptions","organizations_url":"https://api.github.com/users/paulohss/orgs","repos_url":"https://api.github.com/users/paulohss/repos","events_url":"https://api.github.com/users/paulohss/events{/privacy}","received_events_url":"https://api.github.com/users/paulohss/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T08:45:34Z","updated_at":"2017-04-28T08:45:34Z","author_association":"NONE","body":"Hi, \r\n\r\nThanks for the reply. \r\n\r\nIve got a index with a date field that contains all possible \"day of month\" within it. \r\n\r\nAfter running the mentioned Painless script, some of the days are not returned. \r\nFor example, \"05\", \"02\" don't show up in the response. Whereas \"01\", \"31\" appears normally. \r\n\r\nThe data sample I have has all days of month, from 1 to 31.\r\n\r\nI can provide you the data sample (which exemplifies the issue)  via Dropbox, however, I will need your email. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298026417","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-298026417","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":298026417,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODAyNjQxNw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T15:17:31Z","updated_at":"2017-04-28T15:17:31Z","author_association":"CONTRIBUTOR","body":"> I can provide you the data sample (which exemplifies the issue) via Dropbox, however, I will need your email.\r\n\r\nMy email is in my github profile and I can have a look at some point. You are better off providing a recreation bash script or a sequence of CONSOLE commands via gist. So long as it doesn't take hundreds of items.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298266207","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-298266207","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":298266207,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI2NjIwNw==","user":{"login":"paulohss","id":11402394,"node_id":"MDQ6VXNlcjExNDAyMzk0","avatar_url":"https://avatars1.githubusercontent.com/u/11402394?v=4","gravatar_id":"","url":"https://api.github.com/users/paulohss","html_url":"https://github.com/paulohss","followers_url":"https://api.github.com/users/paulohss/followers","following_url":"https://api.github.com/users/paulohss/following{/other_user}","gists_url":"https://api.github.com/users/paulohss/gists{/gist_id}","starred_url":"https://api.github.com/users/paulohss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulohss/subscriptions","organizations_url":"https://api.github.com/users/paulohss/orgs","repos_url":"https://api.github.com/users/paulohss/repos","events_url":"https://api.github.com/users/paulohss/events{/privacy}","received_events_url":"https://api.github.com/users/paulohss/received_events","type":"User","site_admin":false},"created_at":"2017-05-01T00:07:55Z","updated_at":"2017-05-01T00:07:55Z","author_association":"NONE","body":"All right, I've managed to create a small set of data that indeed replicates the issue.\r\nPlease, find the steps to reproduce it in the text file attached:\r\n\r\n[Es bug 24383.txt](https://github.com/elastic/elasticsearch/files/967107/Es.bug.24383.txt)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298465753","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-298465753","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":298465753,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODQ2NTc1Mw==","user":{"login":"paulohss","id":11402394,"node_id":"MDQ6VXNlcjExNDAyMzk0","avatar_url":"https://avatars1.githubusercontent.com/u/11402394?v=4","gravatar_id":"","url":"https://api.github.com/users/paulohss","html_url":"https://github.com/paulohss","followers_url":"https://api.github.com/users/paulohss/followers","following_url":"https://api.github.com/users/paulohss/following{/other_user}","gists_url":"https://api.github.com/users/paulohss/gists{/gist_id}","starred_url":"https://api.github.com/users/paulohss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulohss/subscriptions","organizations_url":"https://api.github.com/users/paulohss/orgs","repos_url":"https://api.github.com/users/paulohss/repos","events_url":"https://api.github.com/users/paulohss/events{/privacy}","received_events_url":"https://api.github.com/users/paulohss/received_events","type":"User","site_admin":false},"created_at":"2017-05-02T00:14:31Z","updated_at":"2017-05-02T00:15:03Z","author_association":"NONE","body":"Hi @nik9000, @clintongormley\r\nJust wondering if you received the script with the data sample.\r\n\r\nThanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298539644","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-298539644","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":298539644,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODUzOTY0NA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-05-02T07:58:11Z","updated_at":"2017-05-02T07:58:11Z","author_association":"MEMBER","body":"@paulohss the `terms` aggregation returns the top 10 term sorted by frequency so the result you're seeing is expected. Instead you should maybe use a `date_histogram`: https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-datehistogram-aggregation.html\r\nIf you don't know how to use it please open a new topic in the discuss forum:\r\nhttps://discuss.elastic.co/c/elasticsearch and I'll be happy to help there.\r\nWe reserve github for verified bugs and new features.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298544319","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-298544319","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":298544319,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODU0NDMxOQ==","user":{"login":"paulohss","id":11402394,"node_id":"MDQ6VXNlcjExNDAyMzk0","avatar_url":"https://avatars1.githubusercontent.com/u/11402394?v=4","gravatar_id":"","url":"https://api.github.com/users/paulohss","html_url":"https://github.com/paulohss","followers_url":"https://api.github.com/users/paulohss/followers","following_url":"https://api.github.com/users/paulohss/following{/other_user}","gists_url":"https://api.github.com/users/paulohss/gists{/gist_id}","starred_url":"https://api.github.com/users/paulohss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulohss/subscriptions","organizations_url":"https://api.github.com/users/paulohss/orgs","repos_url":"https://api.github.com/users/paulohss/repos","events_url":"https://api.github.com/users/paulohss/events{/privacy}","received_events_url":"https://api.github.com/users/paulohss/received_events","type":"User","site_admin":false},"created_at":"2017-05-02T08:08:42Z","updated_at":"2017-05-02T08:15:57Z","author_association":"NONE","body":"Sorry @jimczi , but it doesn't seem right.\r\n\r\nIf you try it with GetDayOfWeek() it works just fine.\r\nIt fails only when using DayOfMonth() and Hour().\r\n\r\n\r\nDate Histogram is not helpful in this user case. I explain:\r\n\r\n------------------------------------------------------------------------------------------------------------\r\n\r\nCurrently Elastic provides a way to aggregate by \"Quarter\" and \"Week of the Year\", \"Day of Month\" through date histogram. Although it doesn't yield unique buckets as a response \r\nIt still does the job, however, when it comes to filtering, the task gets complicated. \r\n\r\nFor example, let's assume I've got the following data:\r\n\r\n1 - 2016/01/12 - Peter\r\n2 - 2013/05/22 - Charles\r\n3 - 2005/07/11 - Mary\r\n4 - 1999/11/09 - Jerry\r\n5 - 1997/09/30 - Charles\r\n\r\n\r\nIf I were to aggregate this data and filter as following:\r\n\r\n      A) Only the \"Monday's\" and \"Thursday's\"\r\n      B) Regardless the year, month or day\r\n      C) With time zone support\r\n\r\nI'm able to simply run this query:\r\n\r\n{\r\n  \"size\": 0,\r\n  \"aggs\": {\r\n    \"groupby\": {\r\n      \"terms\": {\r\n        \"script\": {\r\n          \"inline\": \"ZonedDateTime.ofInstant(Instant.ofEpochMilli(doc['LAST_MODIFIED_DATE'].value), ZoneId.of('+05:00')).getDayOfWeek()\"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"script\": {\r\n            \"script\": {\r\n              \"inline\": \" (ZonedDateTime.ofInstant(Instant.ofEpochMilli(doc['LAST_MODIFIED_DATE'].value), ZoneId.of('+05:00')).getDayOfWeek() == DayOfWeek.TUESDAY)  || (ZonedDateTime.ofInstant(Instant.ofEpochMilli(doc['LAST_MODIFIED_DATE'].value), ZoneId.of('+05:00')).getDayOfWeek() == DayOfWeek.THURSDAY) \"\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n\r\n\r\nUnfortunately, there is no way to achieve this for  \"Quarter\" and \"Week of the Year\" and\"Day Of Month\".  At least, I couldn't find it anywhere in the official/unofficial docs and forums.\r\n\r\n(Imagine try to filter all day \"01\" of each month throughout years worth of data using range filters....)\r\n\r\nI was oriented by an Elastic forum collaborator (below) to open a request in here, so I'm doing it.\r\n\r\nThanks all and, please, few free to clarify it even further.\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298554145","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-298554145","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":298554145,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODU1NDE0NQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-05-02T08:32:16Z","updated_at":"2017-05-02T08:32:16Z","author_association":"MEMBER","body":"> If you try it with GetDayOfWeek() it works just fine.\r\nIt fails only when using DayOfMonth() and Hour().\r\n\r\nThere are 7 days in the week so a terms aggregation of size 10 will return all days. For month or hours you'll need to change the size of your terms aggregation in order to ensure that all buckets are returned (since the default value of 10 is not enough):\r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html#_size","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298555001","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-298555001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":298555001,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODU1NTAwMQ==","user":{"login":"paulohss","id":11402394,"node_id":"MDQ6VXNlcjExNDAyMzk0","avatar_url":"https://avatars1.githubusercontent.com/u/11402394?v=4","gravatar_id":"","url":"https://api.github.com/users/paulohss","html_url":"https://github.com/paulohss","followers_url":"https://api.github.com/users/paulohss/followers","following_url":"https://api.github.com/users/paulohss/following{/other_user}","gists_url":"https://api.github.com/users/paulohss/gists{/gist_id}","starred_url":"https://api.github.com/users/paulohss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulohss/subscriptions","organizations_url":"https://api.github.com/users/paulohss/orgs","repos_url":"https://api.github.com/users/paulohss/repos","events_url":"https://api.github.com/users/paulohss/events{/privacy}","received_events_url":"https://api.github.com/users/paulohss/received_events","type":"User","site_admin":false},"created_at":"2017-05-02T08:34:07Z","updated_at":"2017-05-02T08:34:07Z","author_association":"NONE","body":"Will try.\r\n\r\nThanks for the response.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298800935","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-298800935","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":298800935,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODgwMDkzNQ==","user":{"login":"paulohss","id":11402394,"node_id":"MDQ6VXNlcjExNDAyMzk0","avatar_url":"https://avatars1.githubusercontent.com/u/11402394?v=4","gravatar_id":"","url":"https://api.github.com/users/paulohss","html_url":"https://github.com/paulohss","followers_url":"https://api.github.com/users/paulohss/followers","following_url":"https://api.github.com/users/paulohss/following{/other_user}","gists_url":"https://api.github.com/users/paulohss/gists{/gist_id}","starred_url":"https://api.github.com/users/paulohss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulohss/subscriptions","organizations_url":"https://api.github.com/users/paulohss/orgs","repos_url":"https://api.github.com/users/paulohss/repos","events_url":"https://api.github.com/users/paulohss/events{/privacy}","received_events_url":"https://api.github.com/users/paulohss/received_events","type":"User","site_admin":false},"created_at":"2017-05-03T00:55:36Z","updated_at":"2017-05-03T00:55:36Z","author_association":"NONE","body":"Hi @jimczi ,\r\n\r\nIt worked all right, thanks for the guidance.\r\nFinal question (I've already thrown this one in the discuss forum, they've told come here):\r\n\r\nFor example, as we discussed, I'm able to aggregate by 'hour' with time zone support, using this script:\r\n\r\nZonedDateTime.ofInstant(Instant.ofEpochMilli(doc['LAST_MODIFIED_DATE'].value), ZoneId.of('UTC')).getHour()\r\n\r\nSame for 'getDayOfMonth()' or 'getDayOfWeek()'.\r\n\r\n\r\nIs there a similar way to do it for 'week of the year' and 'quarter'?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329000214","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-329000214","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":329000214,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTAwMDIxNA==","user":{"login":"tiangolo","id":1326112,"node_id":"MDQ6VXNlcjEzMjYxMTI=","avatar_url":"https://avatars0.githubusercontent.com/u/1326112?v=4","gravatar_id":"","url":"https://api.github.com/users/tiangolo","html_url":"https://github.com/tiangolo","followers_url":"https://api.github.com/users/tiangolo/followers","following_url":"https://api.github.com/users/tiangolo/following{/other_user}","gists_url":"https://api.github.com/users/tiangolo/gists{/gist_id}","starred_url":"https://api.github.com/users/tiangolo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tiangolo/subscriptions","organizations_url":"https://api.github.com/users/tiangolo/orgs","repos_url":"https://api.github.com/users/tiangolo/repos","events_url":"https://api.github.com/users/tiangolo/events{/privacy}","received_events_url":"https://api.github.com/users/tiangolo/received_events","type":"User","site_admin":false},"created_at":"2017-09-12T22:17:23Z","updated_at":"2017-09-12T22:17:23Z","author_association":"NONE","body":"@paulohss That last comment ended up being quite helpful for what I'm needing... :smile: \r\n\r\nI think you can get a week of the year by taking the day of the year and dividing it by 7 (7 days a week). I'm doing something similar to get 15 minute buckets of the day.\r\n\r\nI think something like this could work for that (I just tried it):\r\n\r\n```\r\n{\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  },\r\n  \"size\": 0, \r\n  \"aggs\": {\r\n    \"by_hour\": {\r\n      \"terms\": {\r\n        \"size\": 1000, \r\n        \"script\": {\r\n          \"lang\": \"painless\",\r\n          \"source\": \"ZonedDateTime zonedDateTime = ZonedDateTime.ofInstant(Instant.ofEpochMilli(doc.created_at_desktop.value), ZoneId.of(params.tz)); return zonedDateTime.getDayOfYear() / 7\",\r\n          \"params\": {\"tz\": \"-05:00\"}\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329015710","html_url":"https://github.com/elastic/elasticsearch/issues/24383#issuecomment-329015710","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24383","id":329015710,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTAxNTcxMA==","user":{"login":"paulohss","id":11402394,"node_id":"MDQ6VXNlcjExNDAyMzk0","avatar_url":"https://avatars1.githubusercontent.com/u/11402394?v=4","gravatar_id":"","url":"https://api.github.com/users/paulohss","html_url":"https://github.com/paulohss","followers_url":"https://api.github.com/users/paulohss/followers","following_url":"https://api.github.com/users/paulohss/following{/other_user}","gists_url":"https://api.github.com/users/paulohss/gists{/gist_id}","starred_url":"https://api.github.com/users/paulohss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulohss/subscriptions","organizations_url":"https://api.github.com/users/paulohss/orgs","repos_url":"https://api.github.com/users/paulohss/repos","events_url":"https://api.github.com/users/paulohss/events{/privacy}","received_events_url":"https://api.github.com/users/paulohss/received_events","type":"User","site_admin":false},"created_at":"2017-09-12T23:44:16Z","updated_at":"2017-09-12T23:44:16Z","author_association":"NONE","body":"Cool!\n\nThanks\n\nOn Wed, Sep 13, 2017 at 8:18 AM, Sebasti√°n Ram√≠rez <notifications@github.com\n> wrote:\n\n> @paulohss <https://github.com/paulohss> That last comment ended up being\n> quite helpful for what I'm needing... üòÑ\n>\n> I think you can get a week of the year by taking the day of the year and\n> dividing it by 7 (7 days a week). I'm doing something similar to get 15\n> minute buckets of the day.\n>\n> I think something like this could work for that (I just tried it):\n>\n> {\n>   \"query\": {\n>     \"match_all\": {}\n>   },\n>   \"size\": 0,\n>   \"aggs\": {\n>     \"by_hour\": {\n>       \"terms\": {\n>         \"size\": 1000,\n>         \"script\": {\n>           \"lang\": \"painless\",\n>           \"source\": \"ZonedDateTime zonedDateTime = ZonedDateTime.ofInstant(Instant.ofEpochMilli(doc.created_at_desktop.value), ZoneId.of(params.tz)); return zonedDateTime.getDayOfYear() / 7\",\n>           \"params\": {\"tz\": \"-05:00\"}\n>         }\n>       }\n>     }\n>   }\n> }\n>\n> ‚Äî\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/24383#issuecomment-329000214>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AK38mmvNdkba2HzQKg0QqaDxz0wuepMLks5shwMzgaJpZM4NLFxz>\n> .\n>\n\n\n\n-- \n\nAbra√ßos,\nPaulo Henrique\n","performed_via_github_app":null}]