{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6701","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6701/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6701/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6701/events","html_url":"https://github.com/elastic/elasticsearch/issues/6701","id":37058026,"node_id":"MDU6SXNzdWUzNzA1ODAyNg==","number":6701,"title":"\"copy_to\" behaviour in nested fields doesn't match the mapping","user":{"login":"tstibbs","id":4869014,"node_id":"MDQ6VXNlcjQ4NjkwMTQ=","avatar_url":"https://avatars1.githubusercontent.com/u/4869014?v=4","gravatar_id":"","url":"https://api.github.com/users/tstibbs","html_url":"https://github.com/tstibbs","followers_url":"https://api.github.com/users/tstibbs/followers","following_url":"https://api.github.com/users/tstibbs/following{/other_user}","gists_url":"https://api.github.com/users/tstibbs/gists{/gist_id}","starred_url":"https://api.github.com/users/tstibbs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tstibbs/subscriptions","organizations_url":"https://api.github.com/users/tstibbs/orgs","repos_url":"https://api.github.com/users/tstibbs/repos","events_url":"https://api.github.com/users/tstibbs/events{/privacy}","received_events_url":"https://api.github.com/users/tstibbs/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2014-07-03T08:55:26Z","updated_at":"2015-01-21T13:35:14Z","closed_at":"2014-08-01T07:08:33Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I have a nested field, containing some fields with the 'copy_to' attribute. I index a document. Then, I look at the mappings - these show the 'copy_to' field as appearing in the root object, not the nested objects.\n\n(See https://gist.github.com/tstibbs/dc36483f96f8d1471385 for the necessary commands to reproduce.)\n\nHowever, the fields appear to be copied into the 'copy_to' field in the nested object.\n\nIf the 'copied' field is created in the root object, the following query should return my document (but it doesn't):\n\n```\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"match\" : {\n            \"copied\" : \"rover\"\n          }\n        },\n        {\n          \"nested\": {\n            \"path\": \"children\",\n            \"score_mode\": \"avg\",\n            \"query\": {\n              \"match\": {\n                \"colour\": \"red\"\n              }\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nIf the 'copied' field is created in each child, then following query should match (it does):\n\n```\n{\n  \"query\": {\n    \"nested\": {\n      \"path\": \"children\",\n      \"score_mode\": \"avg\",\n      \"query\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"match\": {\n                \"copied\": \"rover\"\n              }\n            },\n            {\n              \"match\": {\n                \"colour\": \"red\"\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\nTo me, the current behaviour makes sense - the fields are copied to a field within the item itself. However, I think the issue is that the mapping doesn't match the behaviour, and the documentation doesn't specify which is correct.\n\nSo, I can't currently use this feature, because I don't know which issue is the bug!\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}