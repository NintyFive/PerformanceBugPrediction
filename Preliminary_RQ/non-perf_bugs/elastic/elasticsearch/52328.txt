{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52328","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52328/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52328/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52328/events","html_url":"https://github.com/elastic/elasticsearch/issues/52328","id":564803375,"node_id":"MDU6SXNzdWU1NjQ4MDMzNzU=","number":52328,"title":"Feature flag outside XPack plugins boundaries","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"labels":[{"id":1690690117,"node_id":"MDU6TGFiZWwxNjkwNjkwMTE3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/EQL","name":":Query Languages/EQL","color":"0e8a16","default":false,"description":"EQL querying"},{"id":73544,"node_id":"MDU6TGFiZWw3MzU0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Enon-issue","name":">non-issue","color":"cfcfcf","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-02-13T16:29:26Z","updated_at":"2020-02-18T08:47:40Z","closed_at":"2020-02-18T08:47:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Inside EQL's telemetry code (and actually any XPack plugin that needs to expose usage data and summarized info), there is a pair of actions that need to be registered on the plugin side, but also two that need to be registered on the xpack core side.\r\n\r\nXPack core actions:\r\n- https://github.com/elastic/elasticsearch/blob/master/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/action/XPackInfoFeatureAction.java#L31\r\n- https://github.com/elastic/elasticsearch/blob/master/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/action/XPackUsageFeatureAction.java#L31\r\n\r\nEQL actions registration (draft PR): https://github.com/elastic/elasticsearch/pull/52248/files#diff-65a84ede375062e6ddafed077d89e530R109-R123\r\n\r\nIf the EQL side Usage and Info actions are hidden behind the `enabled` flag then [PingAndInfoIT.testXPackInfo fails](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+pull-request-1/15863/console) and, also, [MiscellaneousDocumentationIT.testXPackUsage](https://github.com/elastic/elasticsearch/blob/master/client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/MiscellaneousDocumentationIT.java#L149) fails.\r\nIdeally, the same feature flag value should be able to allow/forbid the action registration on the XPack code side, but it doesn't look like something easily doable.\r\n\r\nThe current approach is the one from the draft PR where Info and Usage actions are always registered which means eql will appear as available but disabled\r\n```\r\n    \"eql\" : {\r\n      \"available\" : true,\r\n      \"enabled\" : false\r\n    }\r\n```\r\nwhen `/_xpack` or `/_xpack/usage` is called on the rest layer.\r\n\r\nOpening this issue for discussion about any other approach than the current one for eql, as shown in the links above.\r\n@jasontedor @henningandersen @colings86 ","closed_by":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}