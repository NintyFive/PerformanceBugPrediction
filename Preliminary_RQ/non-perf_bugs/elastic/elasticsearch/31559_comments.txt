[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399982272","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-399982272","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":399982272,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTk4MjI3Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-25T14:58:19Z","updated_at":"2018-06-25T14:58:19Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400715920","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-400715920","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":400715920,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDcxNTkyMA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-06-27T15:26:57Z","updated_at":"2018-06-27T15:26:57Z","author_association":"MEMBER","body":"We discussed this briefly in our team meeting. No one really had opinions on the way to go, so I asked @tvernum to start with trying the format where application privileges is a top level item within roles.\r\n\r\n```json\r\n{\r\n  \"application\": {\r\n     \"manage_privileges\": {\r\n         \"applications\": [ \"kibana\" ]\r\n      }\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400743223","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-400743223","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":400743223,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDc0MzIyMw==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-06-27T16:31:16Z","updated_at":"2018-06-27T16:31:16Z","author_association":"CONTRIBUTOR","body":"I just got this digested. I also favor the last option which @jaymode suggested we turn into a POC. IMO the other syntax options are confusing outside the role mapping API.\r\n\r\nThere are a few things that I have found difficult to grasp fully, which I want to pass through other's mind:\r\nGiven a role with the previous partial definition:\r\n```json\r\n{\r\n  \"application\": {\r\n     \"manage\": {\r\n         \"applications\": [ \"kibana\" ]\r\n      }\r\n  },\r\n  \"roles\": {\r\n    \"manage\": {\r\n       \"names\": [ \"sales_*\" ]\r\n    }\r\n  }\r\n}\r\n```\r\nit allows for the users that are mapped under it:\r\n1. to define privileges only under the `kibana` application **and**, for the `sales_*` roles that it can manage, assigning privileges only for the `kibana` application? https://github.com/elastic/elasticsearch/issues/29820#issuecomment-384130783\r\n2. while defining those `sales_*` roles, their `application manage` and `role manage` privileges be a subset of the ones for this role?\r\nThis effectively also binds roles to applications, so not sure if this is how it's supposed to work...\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400752680","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-400752680","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":400752680,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDc1MjY4MA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-06-27T16:53:53Z","updated_at":"2018-06-27T16:53:53Z","author_association":"MEMBER","body":"@albertzaharovits the `roles` top level item was just an example of another object; there is no relationship between that item and the `application` item. For now, I would just leave off the `roles` item when thinking about this and just look at the example I used in my last comment.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400760650","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-400760650","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":400760650,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDc2MDY1MA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-06-27T17:11:16Z","updated_at":"2018-06-27T17:11:16Z","author_association":"CONTRIBUTOR","body":"@jaymode understood, thanks. It might come as if I am trying to complicate things, but that's not the case.\r\nThe whole thing unfolded when thinking about this `application manage privilege` that you considered in isolation in https://github.com/elastic/elasticsearch/issues/31559#issuecomment-400715920 as just another privilege that must have been granted by some role, and how would that role look like.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400923833","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-400923833","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":400923833,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDkyMzgzMw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-06-28T06:15:47Z","updated_at":"2018-06-28T06:15:47Z","author_association":"CONTRIBUTOR","body":"It's a minor detail, but it's also the first issue I ran into while trying to implement this.\r\nRight now on the [application privileges branch](https://github.com/elastic/elasticsearch/tree/security-app-privs) the application privileges themselves are in `application` (*) field.\r\n\r\nAn example from the [rest test](https://github.com/elastic/elasticsearch/blob/security-app-privs/x-pack/plugin/src/test/resources/rest-api-spec/test/privileges/20_has_application_privs.yml#L34-L60)\r\n```\r\n            {\r\n              \"cluster\": [],\r\n              \"indices\": [\r\n                {\r\n                  \"names\": \"engineering-*\",\r\n                  \"privileges\": [\"read\"]\r\n                }\r\n              ],\r\n              \"applications\": [\r\n                {\r\n                  \"application\": \"myapp\",\r\n                  \"privileges\": [\"user\"],\r\n                  \"resources\": [\"*\"]\r\n                },\r\n                {\r\n                  \"application\": \"myapp\",\r\n                  \"privileges\": [\"read\"],\r\n                  \"resources\": [\"engineering/*\"]\r\n                }\r\n              ]\r\n            }\r\n```\r\n\r\n(*) OK, technically it's `applications`, but that's because `indices` is plural as well.\r\n\r\nI'm going to move ahead by putting this new stuff under a `\"security\"` field, for example\r\n```\r\n {\r\n  \"security\": {\r\n    \"application\": {\r\n      \"manage\": {\r\n        \"applications\": [\r\n          \"kibana\"\r\n        ]\r\n      }\r\n    },\r\n    \"roles\": {\r\n      \"manage\": {\r\n        \"names\": [\r\n          \"sales_*\"\r\n        ]\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nbut it will be simple enough to change.\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/402387613","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-402387613","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":402387613,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjM4NzYxMw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-07-04T07:21:14Z","updated_at":"2018-07-04T07:21:14Z","author_association":"CONTRIBUTOR","body":"This has evolved a little in implementation, to the point where the role descriptor now looks like this:\r\n\r\n```\r\n{\r\n  \"cluster\": [ \"monitor\", \"manage_ml\" ],\r\n  \"policy\": {\r\n    \"application\": {\r\n      \"manage\": {\r\n        \"applications\": [ \"app1\", \"app2\" ]\r\n      }\r\n    }\r\n  },\r\n  \"index\": [{\r\n      \"names\": [ \"idx1\", \"idx2\" ],\r\n      \"privileges\": [ \"read\", \"write\" ],\r\n  }],\r\n  \"applications\": [ {\r\n      \"application\": \"app1\"\r\n      \"resources\": [ \"object-123\", \"object-456\" ],\r\n      \"privileges\": [ \"read\", \"delete\" ],\r\n  }]\r\n}\r\n```\r\n\r\nThe privileges under `policy` are always cluster level privileges, so it could make sense to combine them with the \"cluster\" key. If we weren't concerned with BWC then we could go with something like one of these options:\r\n```\r\n{\r\n  \"cluster\": {\r\n    \"global\" : [ \"monitor\", \"manage_ml\" ],\r\n    \"application\": {\r\n      \"manage\": {\r\n        \"applications\": [ \"app1\", \"app2\" ]\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n```\r\n{\r\n  \"cluster\": {\r\n    \"monitor\" :  \"*\",\r\n    \"ml\" : {\r\n      \"manage\" : \"*\"\r\n    },\r\n    \"application\": {\r\n      \"manage\": {\r\n        \"applications\": [ \"app1\", \"app2\" ]\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n_(I'm ignoring index and application privileges for these examples)_\r\n\r\nBut that's not really an option for a minor - for the Get Role API, users expect \"cluster\" to be a string array.\r\n\r\nSo either:\r\n1. We leave the \"limited privileges\" as a separate entry in the role, and find a better name than \"policy\". (Any ideas??)\r\n2. We create a new key  (\"cluster_v2\" for example's sake, but we'd need something better) in the role definition that supports a structure like the above but lives longside the existing \"cluster\" key.\r\n\r\nFrom a simplicity point of view option 1 is easier.\r\nOption 2 requires having special handling in the Put Role API to know what to do if the old and new keys are both present, and to translate the new object into the old object as part of the Get Role API.\r\n\r\nBut, we do need to work out what key to use for the object field, and I don't have any good ideas... ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/402456086","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-402456086","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":402456086,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjQ1NjA4Ng==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-07-04T11:51:34Z","updated_at":"2018-07-04T11:51:34Z","author_association":"CONTRIBUTOR","body":"I prefer option 1. Option 2 sounds too much of a contraption to me. How would you translate the cluster privileges that have been *put* with the new api, but need to be *get* in the old format so as not to break bwc?\r\n\r\nI have another suggestion though. We already support explicit privileges in the form of `cluster:*` values. Could we add `manage:*` as a pattern? That is:\r\n```\r\n{\r\n  \"cluster\": [ \"monitor\", \"manage_ml\", \"manage:app1\", \"manage:app2\" ],\r\n  \"index\": [{\r\n      \"names\": [ \"idx1\", \"idx2\" ],\r\n      \"privileges\": [ \"read\", \"write\" ],\r\n  }],\r\n  \"applications\": [ {\r\n      \"application\": \"app1\"\r\n      \"resources\": [ \"object-123\", \"object-456\" ],\r\n      \"privileges\": [ \"read\", \"delete\" ],\r\n  }]\r\n}\r\n```\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407362362","html_url":"https://github.com/elastic/elasticsearch/issues/31559#issuecomment-407362362","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31559","id":407362362,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzM2MjM2Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T10:42:13Z","updated_at":"2018-07-24T10:42:13Z","author_association":"CONTRIBUTOR","body":"This naming thing is hard...  Ideally, I think we will need to move to something like this in the longer term, as it will enable us to be more fine grained with cluster perms:\r\n\r\n```\r\n{\r\n  \"cluster\": {\r\n    \"monitor\" :  \"*\",\r\n    \"ml\" : {\r\n      \"manage\" : \"*\"\r\n    },\r\n    \"application\": {\r\n      \"manage\": {\r\n        \"applications\": [ \"app1\", \"app2\" ]\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nBut there is no bwc way i can see for how to get there.  So option 1 seems to be the only route.  Better names than policy? Hmmm, maybe `global` would work?","performed_via_github_app":null}]