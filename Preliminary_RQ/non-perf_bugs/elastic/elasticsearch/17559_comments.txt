[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206338596","html_url":"https://github.com/elastic/elasticsearch/issues/17559#issuecomment-206338596","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17559","id":206338596,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjMzODU5Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T12:00:07Z","updated_at":"2016-04-06T12:00:07Z","author_association":"CONTRIBUTOR","body":"This is a known issue with mappings in 1.x.  In 2.0 you are no longer allowed to have fields with the same name but different mappings in different types. See #8870\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/228706027","html_url":"https://github.com/elastic/elasticsearch/issues/17559#issuecomment-228706027","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17559","id":228706027,"node_id":"MDEyOklzc3VlQ29tbWVudDIyODcwNjAyNw==","user":{"login":"mohdnavedshaikh","id":16662459,"node_id":"MDQ6VXNlcjE2NjYyNDU5","avatar_url":"https://avatars1.githubusercontent.com/u/16662459?v=4","gravatar_id":"","url":"https://api.github.com/users/mohdnavedshaikh","html_url":"https://github.com/mohdnavedshaikh","followers_url":"https://api.github.com/users/mohdnavedshaikh/followers","following_url":"https://api.github.com/users/mohdnavedshaikh/following{/other_user}","gists_url":"https://api.github.com/users/mohdnavedshaikh/gists{/gist_id}","starred_url":"https://api.github.com/users/mohdnavedshaikh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohdnavedshaikh/subscriptions","organizations_url":"https://api.github.com/users/mohdnavedshaikh/orgs","repos_url":"https://api.github.com/users/mohdnavedshaikh/repos","events_url":"https://api.github.com/users/mohdnavedshaikh/events{/privacy}","received_events_url":"https://api.github.com/users/mohdnavedshaikh/received_events","type":"User","site_admin":false},"created_at":"2016-06-27T10:11:28Z","updated_at":"2016-06-27T10:11:28Z","author_association":"NONE","body":"Hi @clintongormley ,\n\nI have some what same kind of issue.Kindly, help me to resolve the issue i am recieving .\n\nI have below aggregation query:\n\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"bool\": {\n            \"must\": [\n              {\n                \"nested\": {\n                  \"query\": {\n                    \"term\": {\n                      \"skus.rack_status\": \"Y\"\n                    }\n                  },\n                  \"path\": \"skus\"\n                }\n              },\n              {\n                \"terms\": {\n                  \"boutique_id\": [\n                    \"14404\"\n                  ]\n                }\n              }\n            ]\n          }\n        },\n        {\n          \"nested\": {\n            \"filter\": {\n              \"bool\": {\n                \"must\": {\n                  \"match_all\": {}\n                }\n              }\n            },\n            \"path\": \"skus\"\n          }\n        }\n      ]\n    }\n  },\n  \"aggregations\": {\n    \"presaleFilter\": {\n      \"terms\": {\n        \"field\": \"is_presale\"\n      }\n    },\n    \"filterCondition\": {\n      \"filter\": {\n        \"bool\": {\n          \"must\": {\n            \"nested\": {\n              \"filter\": {\n                \"bool\": {\n                  \"must\": [\n                    {\n                      \"match_all\": {}\n                    },\n                    {\n                      \"range\": {\n                        \"skus.inv\": {\n                          \"from\": 0,\n                          \"to\": null,\n                          \"include_lower\": false,\n                          \"include_upper\": true\n                        }\n                      }\n                    }\n                  ]\n                }\n              },\n              \"path\": \"skus\"\n            }\n          }\n        }\n      },\n      \"aggregations\": {\n        \"topCategoryFilter\": {\n          \"terms\": {\n            \"field\": \"category_id\",\n            \"size\": 2147483647\n          },\n          \"aggregations\": {\n            \"subCategoryFilter\": {\n              \"terms\": {\n                \"field\": \"sub_category_id\",\n                \"size\": 2147483647\n              }\n            }\n          }\n        },\n        **\"brandFilter\": {\n          \"terms\": {\n            \"field\": \"brand_id\",\n            \"size\": 2147483647\n          }**\n        }, \"productClass\": {\n          \"terms\": {\n            \"field\": \"product_class_id\",\n            \"size\": 2147483647\n          }\n        },\n        \"skuFilter\": {\n          \"nested\": {\n            \"path\": \"skus\"\n          },\n          \"aggregations\": {\n            \"sizeValues\": {\n              \"nested\": {\n                \"path\": \"skus.attribute\"\n              },\n              \"aggregations\": {\n                \"attributeId\": {\n                  \"terms\": {\n                    \"field\": \"skus.attribute.attribute_id\",\n                    \"size\": 2147483647\n                  },\n                  \"aggregations\": {\n                    \"attributeValue\": {\n                      \"terms\": {\n                        \"field\": \"skus.attribute.attribute_value\",\n                        \"size\": 2147483647\n                      }\n                    }\n                  }\n                }\n              }\n            },\n            \"fromAge\": {\n              \"terms\": {\n                \"field\": \"skus.from_age\"\n              },\n              \"aggregations\": {\n                \"toAge\": {\n                  \"terms\": {\n                    \"field\": \"skus.to_age\",\n                    \"size\": 2147483647\n                  }\n                },\n                \"from_to_age\": {\n                  \"reverse_nested\": {}\n                }\n              }\n            },\n            \"gender\": {\n              \"terms\": {\n                \"field\": \"skus.gender\",\n                \"size\": 2147483647\n              },\n              \"aggregations\": {\n                \"gender_to_skus\": {\n                  \"reverse_nested\": {}\n                }\n              }\n            },\n            \"min_price\": {\n              \"min\": {\n                \"field\": \"skus.sale_price\"\n              }\n            },\n            \"max_price\": {\n              \"max\": {\n                \"field\": \"skus.sale_price\"\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"from\": 0,\n  \"size\": 56\n}\n\nThe highlighted if commented out then i get response else i get below given  exception : \n\norg.elasticsearch.ElasticsearchException: java.lang.NumberFormatException: Invalid shift value in prefixCoded bytes (is encoded value really an INT?)\n    at org.elasticsearch.index.fielddata.plain.AbstractIndexFieldData.load(AbstractIndexFieldData.java:80)\n    at org.elasticsearch.search.aggregations.support.ValuesSource$MetaData.load(ValuesSource.java:88)\n    at org.elasticsearch.search.aggregations.support.AggregationContext.numericField(AggregationContext.java:159)\n    at org.elasticsearch.search.aggregations.support.AggregationContext.valuesSource(AggregationContext.java:137)\n    at org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.create(ValuesSourceAggregatorFactory.java:53)\n    at org.elasticsearch.search.aggregations.AggregatorFactories.createAndRegisterContextAware(AggregatorFactories.java:53)\n    at org.elasticsearch.search.aggregations.AggregatorFactories.createSubAggregators(AggregatorFactories.java:71)\n    at org.elasticsearch.search.aggregations.Aggregator.<init>(Aggregator.java:191)\n    at org.elasticsearch.search.aggregations.bucket.BucketsAggregator.<init>(BucketsAggregator.java:39)\n    at org.elasticsearch.search.aggregations.bucket.SingleBucketAggregator.<init>(SingleBucketAggregator.java:32)\n    at org.elasticsearch.search.aggregations.bucket.filter.FilterAggregator.<init>(FilterAggregator.java:45)\n    at org.elasticsearch.search.aggregations.bucket.filter.FilterAggregator$Factory.create(FilterAggregator.java:86)\n    at org.elasticsearch.search.aggregations.AggregatorFactories.createAndRegisterContextAware(AggregatorFactories.java:53)\n    at org.elasticsearch.search.aggregations.AggregatorFactories.createTopLevelAggregators(AggregatorFactories.java:157)\n    at org.elasticsearch.search.aggregations.AggregationPhase.preProcess(AggregationPhase.java:79)\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:100)\n    at org.elasticsearch.search.SearchService.loadOrExecuteQueryPhase(SearchService.java:301)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:312)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.common.util.concurrent.UncheckedExecutionException: java.lang.NumberFormatException: Invalid shift value in prefixCoded bytes (is encoded value really an INT?)\n    at org.elasticsearch.common.cache.LocalCache$Segment.get(LocalCache.java:2203)\n    at org.elasticsearch.common.cache.LocalCache.get(LocalCache.java:3937)\n    at org.elasticsearch.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4739)\n    at org.elasticsearch.indices.fielddata.cache.IndicesFieldDataCache$IndexFieldCache.load(IndicesFieldDataCache.java:167)\n    at org.elasticsearch.index.fielddata.plain.AbstractIndexFieldData.load(AbstractIndexFieldData.java:74)\n    ... 23 more\nCaused by: java.lang.NumberFormatException: Invalid shift value in prefixCoded bytes (is encoded value really an INT?)\n    at org.apache.lucene.util.NumericUtils.getPrefixCodedIntShift(NumericUtils.java:209)\n    at org.elasticsearch.index.fielddata.ordinals.OrdinalsBuilder$2.accept(OrdinalsBuilder.java:445)\n    at org.apache.lucene.index.FilteredTermsEnum.next(FilteredTermsEnum.java:244)\n    at org.elasticsearch.index.fielddata.RamAccountingTermsEnum.next(RamAccountingTermsEnum.java:82)\n    at org.elasticsearch.index.fielddata.ordinals.OrdinalsBuilder$3.next(OrdinalsBuilder.java:472)\n    at org.elasticsearch.index.fielddata.plain.PackedArrayIndexFieldData.loadDirect(PackedArrayIndexFieldData.java:109)\n    at org.elasticsearch.index.fielddata.plain.PackedArrayIndexFieldData.loadDirect(PackedArrayIndexFieldData.java:49)\n    at org.elasticsearch.indices.fielddata.cache.IndicesFieldDataCache$IndexFieldCache$1.call(IndicesFieldDataCache.java:180)\n    at org.elasticsearch.indices.fielddata.cache.IndicesFieldDataCache$IndexFieldCache$1.call(IndicesFieldDataCache.java:167)\n    at org.elasticsearch.common.cache.LocalCache$LocalManualCache$1.load(LocalCache.java:4742)\n    at org.elasticsearch.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3527)\n    at org.elasticsearch.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2319)\n    at org.elasticsearch.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2282)\n    at org.elasticsearch.common.cache.LocalCache$Segment.get(LocalCache.java:2197)\n    ... 27 more\n\nThank You in advance.\n","performed_via_github_app":null}]