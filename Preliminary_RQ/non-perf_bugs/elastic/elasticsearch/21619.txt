{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21619","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21619/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21619/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21619/events","html_url":"https://github.com/elastic/elasticsearch/issues/21619","id":190009156,"node_id":"MDU6SXNzdWUxOTAwMDkxNTY=","number":21619,"title":"Cumulative sums show progress despite lack of new events","user":{"login":"wsw70","id":1345886,"node_id":"MDQ6VXNlcjEzNDU4ODY=","avatar_url":"https://avatars2.githubusercontent.com/u/1345886?v=4","gravatar_id":"","url":"https://api.github.com/users/wsw70","html_url":"https://github.com/wsw70","followers_url":"https://api.github.com/users/wsw70/followers","following_url":"https://api.github.com/users/wsw70/following{/other_user}","gists_url":"https://api.github.com/users/wsw70/gists{/gist_id}","starred_url":"https://api.github.com/users/wsw70/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wsw70/subscriptions","organizations_url":"https://api.github.com/users/wsw70/orgs","repos_url":"https://api.github.com/users/wsw70/repos","events_url":"https://api.github.com/users/wsw70/events{/privacy}","received_events_url":"https://api.github.com/users/wsw70/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-11-17T10:44:19Z","updated_at":"2017-03-31T14:05:17Z","closed_at":"2017-03-31T14:05:17Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n**Elasticsearch version**:\r\n\r\n```\r\n\"version\": {\r\n\"number\": \"2.4.1\",\r\n\"build_hash\": \"c67dc32e24162035d18d6fe1e952c4cbcbe79d16\",\r\n\"build_timestamp\": \"2016-09-27T18:57:55Z\",\r\n\"build_snapshot\": false,\r\n\"lucene_version\": \"5.5.2\"\r\n},\r\n```\r\n\r\n**Plugins installed**: [kopf]\r\n\r\n**JVM version**: \r\n\r\n````\r\njava version \"1.7.0_121\"\r\nOpenJDK Runtime Environment (rhel-2.6.8.1.el6_8-x86_64 u121-b00)\r\nOpenJDK 64-Bit Server VM (build 24.121-b00, mixed mode)\r\n````\r\n\r\n**OS version**: Various Linux (CentOS, Debian)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen computing a cumulative sum, the sum raises despite a lack of new events\r\n\r\n_This was initially posted as a question on both [StackOverflow ](http://stackoverflow.com/questions/40615399/are-cumulative-sums-approximate)and [discuss.elastic.co](https://discuss.elastic.co/t/are-cumulative-sums-approximate/66215). I now believe this is a bug._\r\n\r\n\r\n**Steps to reproduce**:\r\n\r\nThe following search\r\n\r\n```\r\nGET /data/v/_search\r\n{\r\n   \"query\": {\r\n      \"bool\": {\r\n         \"should\": [\r\n            {\r\n               \"bool\": {\r\n                  \"must\": [\r\n                     {\r\n                        \"range\": {\r\n                           \"HOST_START_iso\": {\r\n                              \"lt\": \"now-1d\"\r\n                           }\r\n                        }\r\n                     }\r\n                  ]\r\n               }\r\n            }\r\n         ]\r\n      }\r\n   },\r\n    \"size\": 10\r\n}\r\n```\r\n\r\ngives the same amount of events for   `\"lt\": \"now-1d\"`,  `\"lt\": \"now-2d\"`, `\"lt\": \"now-3d\"`, etc. - this is correct as there were no new events in the last few days.\r\n\r\nAt the same time, the search\r\n\r\n```\r\n{\r\n   \"size\":0,\r\n   \"aggs\":{\r\n      \"vulns_day\":{\r\n         \"date_histogram\":{\r\n            \"field\":\"HOST_START_iso\",\r\n            \"interval\":\"day\"\r\n         },\r\n         \"aggs\":{\r\n            \"dates_stats\":{\r\n               \"stats\":{\r\n                  \"field\":\"HOST_START_iso\"\r\n               }\r\n            },\r\n            \"vulns_cumulated\":{\r\n               \"cumulative_sum\":{\r\n                  \"buckets_path\":\"dates_stats.count\"\r\n               }\r\n            }\r\n         }\r\n      }\r\n   }\r\n}\r\n```\r\n\r\nShows progression.  As an example (to highlight the scale of the change) on day `n` there were `2,406,013` accumulated events and on `n+1` - `2,411,455`. This is a change of `5,442` events (where the change was supposed to be 0), or about `0.2%`.\r\n\r\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}