{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3285","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3285/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3285/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3285/events","html_url":"https://github.com/elastic/elasticsearch/issues/3285","id":16309632,"node_id":"MDU6SXNzdWUxNjMwOTYzMg==","number":3285,"title":"custom_score query within has_child query does not recognize child document fields within the script property","user":{"login":"apasumarthi","id":4928920,"node_id":"MDQ6VXNlcjQ5Mjg5MjA=","avatar_url":"https://avatars0.githubusercontent.com/u/4928920?v=4","gravatar_id":"","url":"https://api.github.com/users/apasumarthi","html_url":"https://github.com/apasumarthi","followers_url":"https://api.github.com/users/apasumarthi/followers","following_url":"https://api.github.com/users/apasumarthi/following{/other_user}","gists_url":"https://api.github.com/users/apasumarthi/gists{/gist_id}","starred_url":"https://api.github.com/users/apasumarthi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apasumarthi/subscriptions","organizations_url":"https://api.github.com/users/apasumarthi/orgs","repos_url":"https://api.github.com/users/apasumarthi/repos","events_url":"https://api.github.com/users/apasumarthi/events{/privacy}","received_events_url":"https://api.github.com/users/apasumarthi/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2013-07-03T09:46:20Z","updated_at":"2014-07-03T09:58:27Z","closed_at":"2014-07-03T09:58:27Z","author_association":"NONE","active_lock_reason":null,"body":"custom_score query within has_child query does not recognize child document fields within the score script.\n\nI have two document types, \"Forums\" and \"ForumStats\". Forums is a parent type and ForumStats is a child type. I had set the mapping correctly.\n\nWhen I issue query like the one below on forums type, ES complains that the field \"avgPostsPerMinute\" is not found in \"Forums\" type, which I feel is wrong as the script is supposed to look at child document fields.\n\nNote: \"avgPostsPerMinute\" field belongs to ForumStats type.\n\n{\n  \"size\": 20,\n  \"sort\": {\n    \"_score\": \"desc\"\n  },\n  \"query\": {\n    \"has_child\": {\n      \"type\": \"forumstats\",\n      \"score_type\": \"sum\",\n      \"query\": {\n        \"custom_score\": {\n          \"script\": \"doc['avgPostsPerMin'].value\",\n          \"query\": {\n            \"match_all\": {}\n          }\n        }\n      }\n    }\n  }\n}\n\nIf I set the script to a value that doe snot refer to child document type, then the query runs and I get a score for the parent document correctly.\n\nPlease review this and let me know if this is by design or a bug. If it is by design, it looks odd as the custom score query is running on child documents and I would expect ES to recognize the child document fields within the script property.\n\nThanks & Regards,\nAditya.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}