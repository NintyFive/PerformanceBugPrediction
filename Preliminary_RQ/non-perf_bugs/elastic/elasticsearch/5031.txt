{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5031","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5031/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5031/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5031/events","html_url":"https://github.com/elastic/elasticsearch/issues/5031","id":27005992,"node_id":"MDU6SXNzdWUyNzAwNTk5Mg==","number":5031,"title":"Startup error with 1.0.0RCx - java.lang.NoClassDefFoundError: org/elasticsearch/ElasticSearchIllegalArgumentException","user":{"login":"jensihnow","id":1306057,"node_id":"MDQ6VXNlcjEzMDYwNTc=","avatar_url":"https://avatars0.githubusercontent.com/u/1306057?v=4","gravatar_id":"","url":"https://api.github.com/users/jensihnow","html_url":"https://github.com/jensihnow","followers_url":"https://api.github.com/users/jensihnow/followers","following_url":"https://api.github.com/users/jensihnow/following{/other_user}","gists_url":"https://api.github.com/users/jensihnow/gists{/gist_id}","starred_url":"https://api.github.com/users/jensihnow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jensihnow/subscriptions","organizations_url":"https://api.github.com/users/jensihnow/orgs","repos_url":"https://api.github.com/users/jensihnow/repos","events_url":"https://api.github.com/users/jensihnow/events{/privacy}","received_events_url":"https://api.github.com/users/jensihnow/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-02-05T22:08:42Z","updated_at":"2014-02-09T13:15:51Z","closed_at":"2014-02-05T22:17:58Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nwhile testing with the Chef cookbook and the latest elasticsearch versions 1.0.0RC1 and RC2 I ran into a startup error. I tried openjdk with Version 6 and 7 both failed. The same configurations works, if I use 0.90.11 as version.\n\nTrace:\n\n```\n[2014-02-05 18:40:25,247][INFO ][node                     ] [Kiber the Cruel] version[1.0.0.RC2], pid[22688], build[a9d736e/2014-02-03T15:02:11Z]\n[2014-02-05 18:40:25,248][INFO ][node                     ] [Kiber the Cruel] initializing ...\n[2014-02-05 18:40:25,248][DEBUG][node                     ] [Kiber the Cruel] using home [/usr/local/elasticsearch-1.0.0.RC2], config [/usr/local/elasticsearch-1.0.0.RC2/config], data [[/usr/local/elasticsearch-1.0.0.RC2/data]], logs [/usr/local/elasticsearch-1.0.0.RC2/logs], work [/usr/local/elasticsearch-1.0.0.RC2/work], plugins [/usr/local/elasticsearch-1.0.0.RC2/plugins]\n[2014-02-05 18:40:25,254][TRACE][plugins                  ] [Kiber the Cruel] --- adding plugin [/usr/local/elasticsearch-1.0.0.RC2/plugins/cloud-aws]\n[2014-02-05 18:40:25,261][TRACE][plugins                  ] [Kiber the Cruel] found a jvm plugin [cloud-aws], [Cloud AWS Plugin]\n[2014-02-05 18:40:25,270][INFO ][plugins                  ] [Kiber the Cruel] loaded [cloud-aws], sites []\n[2014-02-05 18:40:25,310][DEBUG][common.compress.lzf      ] using [UnsafeChunkDecoder] decoder\n[2014-02-05 18:40:25,316][TRACE][env                      ] [Kiber the Cruel] obtaining node lock on /usr/local/elasticsearch-1.0.0.RC2/data/elasticsearch/nodes/0 ...\n[2014-02-05 18:40:25,327][DEBUG][env                      ] [Kiber the Cruel] using node location [[/usr/local/elasticsearch-1.0.0.RC2/data/elasticsearch/nodes/0]], local_node_id [0]\n[2014-02-05 18:40:25,335][TRACE][env                      ] [Kiber the Cruel] node data locations details:\n -> /usr/local/elasticsearch-1.0.0.RC2/data/elasticsearch/nodes/0, free_space [77gb], usable_space [76.2gb]\n\n[2014-02-05 18:40:26,482][TRACE][monitor.sigar            ] [Kiber the Cruel] sigar loaded successfully\n[2014-02-05 18:40:26,615][DEBUG][bootstrap                ] Exception\norg.elasticsearch.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: org/elasticsearch/ElasticSearchIllegalArgumentException\n        at org.elasticsearch.common.cache.LocalCache$Segment.get(LocalCache.java:2199)\n        at org.elasticsearch.common.cache.LocalCache.get(LocalCache.java:3934)\n        at org.elasticsearch.common.cache.LocalCache.getOrLoad(LocalCache.java:3938)\n        at org.elasticsearch.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4821)\n        at org.elasticsearch.common.inject.internal.FailableCache.get(FailableCache.java:51)\n        at org.elasticsearch.common.inject.ConstructorInjectorStore.get(ConstructorInjectorStore.java:50)\n        at org.elasticsearch.common.inject.ConstructorBindingImpl.initialize(ConstructorBindingImpl.java:50)\n        at org.elasticsearch.common.inject.InjectorImpl.initializeBinding(InjectorImpl.java:372)\n        at org.elasticsearch.common.inject.BindingProcessor$1$1.run(BindingProcessor.java:148)\n        at org.elasticsearch.common.inject.BindingProcessor.initializeBindings(BindingProcessor.java:204)\n        at org.elasticsearch.common.inject.InjectorBuilder.initializeStatically(InjectorBuilder.java:119)\n        at org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:102)\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:93)\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:70)\n        at org.elasticsearch.common.inject.ModulesBuilder.createInjector(ModulesBuilder.java:59)\n        at org.elasticsearch.node.internal.InternalNode.<init>(InternalNode.java:187)\n        at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:159)\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:68)\n        at org.elasticsearch.bootstrap.Bootstrap.main(Bootstrap.java:201)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:32)\nCaused by: java.lang.NoClassDefFoundError: org/elasticsearch/ElasticSearchIllegalArgumentException\n        at java.lang.Class.getDeclaredConstructors0(Native Method)\n        at java.lang.Class.privateGetDeclaredConstructors(Class.java:2493)\n        at java.lang.Class.getDeclaredConstructors(Class.java:1901)\n        at org.elasticsearch.common.inject.spi.InjectionPoint.forConstructorOf(InjectionPoint.java:177)\n        at org.elasticsearch.common.inject.ConstructorInjectorStore.createConstructor(ConstructorInjectorStore.java:59)\n        at org.elasticsearch.common.inject.ConstructorInjectorStore.access$000(ConstructorInjectorStore.java:29)\n...skipping...\norg.elasticsearch.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: org/elasticsearch/ElasticSearchIllegalArgumentException\n        at org.elasticsearch.common.cache.LocalCache$Segment.get(LocalCache.java:2199)\n        at org.elasticsearch.common.cache.LocalCache.get(LocalCache.java:3934)\n        at org.elasticsearch.common.cache.LocalCache.getOrLoad(LocalCache.java:3938)\n        at org.elasticsearch.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4821)\n        at org.elasticsearch.common.inject.internal.FailableCache.get(FailableCache.java:51)\n        at org.elasticsearch.common.inject.ConstructorInjectorStore.get(ConstructorInjectorStore.java:50)\n        at org.elasticsearch.common.inject.ConstructorBindingImpl.initialize(ConstructorBindingImpl.java:50)\n        at org.elasticsearch.common.inject.InjectorImpl.initializeBinding(InjectorImpl.java:372)\n        at org.elasticsearch.common.inject.BindingProcessor$1$1.run(BindingProcessor.java:148)\n        at org.elasticsearch.common.inject.BindingProcessor.initializeBindings(BindingProcessor.java:204)\n        at org.elasticsearch.common.inject.InjectorBuilder.initializeStatically(InjectorBuilder.java:119)\n        at org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:102)\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:93)\n        at org.elasticsearch.common.inject.Guice.createInjector(Guice.java:70)\n        at org.elasticsearch.common.inject.ModulesBuilder.createInjector(ModulesBuilder.java:59)\n        at org.elasticsearch.node.internal.InternalNode.<init>(InternalNode.java:187)\n        at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:159)\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:68)\n        at org.elasticsearch.bootstrap.Bootstrap.main(Bootstrap.java:201)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:32)\nCaused by: java.lang.NoClassDefFoundError: org/elasticsearch/ElasticSearchIllegalArgumentException\n        at java.lang.Class.getDeclaredConstructors0(Native Method)\n        at java.lang.Class.privateGetDeclaredConstructors(Class.java:2493)\n        at java.lang.Class.getDeclaredConstructors(Class.java:1901)\n        at org.elasticsearch.common.inject.spi.InjectionPoint.forConstructorOf(InjectionPoint.java:177)\n        at org.elasticsearch.common.inject.ConstructorInjectorStore.createConstructor(ConstructorInjectorStore.java:59)\n        at org.elasticsearch.common.inject.ConstructorInjectorStore.access$000(ConstructorInjectorStore.java:29)\n        at org.elasticsearch.common.inject.ConstructorInjectorStore$1.create(ConstructorInjectorStore.java:37)\n        at org.elasticsearch.common.inject.ConstructorInjectorStore$1.create(ConstructorInjectorStore.java:33)\n        at org.elasticsearch.common.inject.internal.FailableCache$1.load(FailableCache.java:39)\n        at org.elasticsearch.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3524)\n        at org.elasticsearch.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2317)\n        at org.elasticsearch.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2280)\n        at org.elasticsearch.common.cache.LocalCache$Segment.get(LocalCache.java:2195)\n        ... 19 more\nCaused by: java.lang.ClassNotFoundException: org.elasticsearch.ElasticSearchIllegalArgumentException\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:366)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:354)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:425)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:358)\n        ... 32 more \n```\n\nRight now it looks like there is something wrong in /usr/local/etc/elasticsearch/elasticsearch-env.sh (nothing changed!) and/or the startup script.\n\nI tried to  start ES manually with\n`sudo su elasticsearch -c \"ES_INCLUDE=/usr/local/etc/elasticsearch/elasticsearch-env.sh /usr/local/bin/elasticsearch -p /usr/local/var/run/elasticsearch/ESTEST_DEV_MASTER_i_f4715cd4.pid`\nbut it failed with the same error.\n\nIs there any important change in 1.0.0 which might impact the startup procedure/ of the Chef cookbook?\n\nThanks\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}