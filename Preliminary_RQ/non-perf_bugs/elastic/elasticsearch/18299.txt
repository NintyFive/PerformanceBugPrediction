{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18299","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18299/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18299/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18299/events","html_url":"https://github.com/elastic/elasticsearch/issues/18299","id":154540749,"node_id":"MDU6SXNzdWUxNTQ1NDA3NDk=","number":18299,"title":"Unable to delete snapshot “index and alias names need to be unique”","user":{"login":"jdlourenco","id":2598539,"node_id":"MDQ6VXNlcjI1OTg1Mzk=","avatar_url":"https://avatars0.githubusercontent.com/u/2598539?v=4","gravatar_id":"","url":"https://api.github.com/users/jdlourenco","html_url":"https://github.com/jdlourenco","followers_url":"https://api.github.com/users/jdlourenco/followers","following_url":"https://api.github.com/users/jdlourenco/following{/other_user}","gists_url":"https://api.github.com/users/jdlourenco/gists{/gist_id}","starred_url":"https://api.github.com/users/jdlourenco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdlourenco/subscriptions","organizations_url":"https://api.github.com/users/jdlourenco/orgs","repos_url":"https://api.github.com/users/jdlourenco/repos","events_url":"https://api.github.com/users/jdlourenco/events{/privacy}","received_events_url":"https://api.github.com/users/jdlourenco/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-05-12T17:43:17Z","updated_at":"2018-01-17T21:19:22Z","closed_at":"2016-05-13T11:42:46Z","author_association":"NONE","active_lock_reason":null,"body":"I already searched for a similar issue and posted about this in [here](https://discuss.elastic.co/t/unable-to-delete-snapshot-index-and-alias-names-need-to-be-unique/49676) and got no reply.\nI looks like a bug so I'm opening this issue.\n\n**Elasticsearch version**:\n2.1.2\n\n**JVM version**:\njava version \"1.8.0_72\"\nJava(TM) SE Runtime Environment (build 1.8.0_72-b15)\nJava HotSpot(TM) 64-Bit Server VM (build 25.72-b15, mixed mode)\n\n**OS version**:\nRed Hat Enterprise Linux Server release 6.7 (Santiago)\n\n**Description of the problem including expected versus actual behavior**:\nI am unable to delete snapshots created in a previous version of **elasticsearch** containing indices and aliases with the same name.\nI am currently using 2.1.2 and I have created the snapshots back in 1.7.2.\n\nWhen I try to delete a snapshot using:\n\n`curl -s -XDELETE localhost:9200/_snapshot/repoX/snapY?pretty`\n\nI get the following error message:\n\n```\n{\n  \"error\" : {\n  \"root_cause\" : [ {\n  \"type\" : \"remote_transport_exception\",\n  \"reason\" : \"[cluster:admin/snapshot/delete]\"\n  } ],\n  \"type\" : \"illegal_state_exception\",\n  \"reason\" : \"index and alias names need to be unique, but alias [indexZ] and index [indexZ] have the same name\"\n  },\n  \"status\" : 500\n}\n```\n\nThis seems to be due to the restriction that I think was introduced in 2.0.0 that index and alias names must be unique in a cluster.\n\nI would expect deleting a snapshot to always work, despite it containing invalid indices and aliases names, since I am disposing of it.\n\nThis is preventing me from releasing valuable disk space in a production system.\n\n**Steps to reproduce**:\n1. Create an index and alias with the same name in a version of elasticsearch where this is allowed (e.g. 1.7.2).\n2. Create a snapshot including that index and that alias.\n3. Upgrade to a version of elasticsearch where index and alias names must be unique (e.g. 2.1.2), first deleting either the index or the alias to ensure uniqueness\n4. Try to delete the snapshot created in the previous elasticsearch version.\n\n**Provide logs (if relevant)**:\n\n```\n[2016-05-12 18:25:52,981][INFO ][rest.suppressed          ] /_snapshot/repoX/snapY Params: {pretty=, repository=repoX, snapshot=snapY}\nRemoteTransportException[[****][****:9300][cluster:admin/snapshot/delete]]; nested: IllegalStateException[index and alias names need to be unique, but alias [indexZ] and index [indexZ] have the same name];\nCaused by: java.lang.IllegalStateException: index and alias names need to be unique, but alias [indexZ] and index [indexZ] have the same name\n        at org.elasticsearch.cluster.metadata.MetaData$Builder.build(MetaData.java:1037)\n        at org.elasticsearch.repositories.blobstore.BlobStoreRepository.readSnapshotMetaData(BlobStoreRepository.java:490)\n        at org.elasticsearch.repositories.blobstore.BlobStoreRepository.deleteSnapshot(BlobStoreRepository.java:310)\n        at org.elasticsearch.snapshots.SnapshotsService$8.run(SnapshotsService.java:997)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}