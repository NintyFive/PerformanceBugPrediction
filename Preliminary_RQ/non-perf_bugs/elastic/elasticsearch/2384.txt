{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2384","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2384/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2384/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2384/events","html_url":"https://github.com/elastic/elasticsearch/issues/2384","id":8147920,"node_id":"MDU6SXNzdWU4MTQ3OTIw","number":2384,"title":"Unable to highlight full field values for multi-valued fields","user":{"login":"outoftime","id":14214,"node_id":"MDQ6VXNlcjE0MjE0","avatar_url":"https://avatars3.githubusercontent.com/u/14214?v=4","gravatar_id":"","url":"https://api.github.com/users/outoftime","html_url":"https://github.com/outoftime","followers_url":"https://api.github.com/users/outoftime/followers","following_url":"https://api.github.com/users/outoftime/following{/other_user}","gists_url":"https://api.github.com/users/outoftime/gists{/gist_id}","starred_url":"https://api.github.com/users/outoftime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/outoftime/subscriptions","organizations_url":"https://api.github.com/users/outoftime/orgs","repos_url":"https://api.github.com/users/outoftime/repos","events_url":"https://api.github.com/users/outoftime/events{/privacy}","received_events_url":"https://api.github.com/users/outoftime/received_events","type":"User","site_admin":false},"labels":[{"id":18508797,"node_id":"MDU6TGFiZWwxODUwODc5Nw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.19.12","name":"v0.19.12","color":"DDDDDD","default":false,"description":null},{"id":17100272,"node_id":"MDU6TGFiZWwxNzEwMDI3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.20.0","name":"v0.20.0","color":"DDDDDD","default":false,"description":null},{"id":17100279,"node_id":"MDU6TGFiZWwxNzEwMDI3OQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.0.Beta1","name":"v0.90.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2012-11-06T18:28:53Z","updated_at":"2012-12-03T11:49:44Z","closed_at":"2012-12-03T11:38:37Z","author_association":"NONE","active_lock_reason":null,"body":"I've noticed that at some point in the recent past, ES support for highlighting multi-valued fields has improved considerably, in that now each value is returned in its own fragment. This is fantastic! However, I have noticed that it seems impossible to return multiple highlighted values from the same field in their entirety, in the case where there are multiple matching fields per document. When using the default options for highlight, ES will return a fragment for each value, but that fragment may be incomplete -- this is as expected. When setting `number_of_fragments` to zero, however, ES will return at most one fragment, corresponding to a single field value.\n\n[This reduction](http://hastebin.com/raw/tawowayitu) demonstrates the behavior:\n\n``` bash\ncurl -XDELETE \"http://localhost:9200/test?pretty=true\"\necho \"\"\ncurl -XPUT \"http://localhost:9200/test?pretty=true\"\necho \"\"\n\ncurl -XPUT \"http://localhost:9200/test/doc/_mapping?pretty=true\" -d '\n{\n  \"doc\": {\n    \"properties\": {\n      \"tags\": {\n        \"type\": \"string\",\n        \"index\":\"analyzed\",\n        \"term_vector\":\"with_positions_offsets\"\n      }\n    }\n  }\n}\n'\necho \"\"\n\ncurl -XPUT \"http://localhost:9200/test/doc/1?pretty=true&refresh=true\" -d '\n{\n  \"tags\": [\n    \"this is a really long tag i would like to highlight\",\n    \"here is another one that is very long and has the tag token near the end\"\n  ]\n}\n'\necho \"\"\n\ncurl -XGET \"http://localhost:9200/test/doc/_search?pretty=true\" -d '\n{\n  \"query\": {\"query_string\": {\"query\":\"tag\", \"fields\": [\"tags\"]}},\n  \"highlight\": {\"fields\": {\"tags\": {}}},\n  \"fields\": []\n}\n'\necho \"\"\n\ncurl -XGET \"http://localhost:9200/test/doc/_search?pretty=true\" -d '\n{\n  \"query\": {\"query_string\": {\"query\":\"tag\", \"fields\": [\"tags\"]}},\n  \"highlight\": {\"fields\": {\"tags\": {\"number_of_fragments\": 0}}},\n  \"fields\": []\n}\n'\necho \"\"\n\ncurl -XGET \"http://localhost:9200/test/doc/_search?pretty=true\" -d '\n{\n  \"query\": {\"query_string\": {\"query\":\"tag\", \"fields\": [\"tags\"]}},\n  \"highlight\": {\"fields\": {\"tags\": {\"fragment_size\": 4096}}},\n  \"fields\": []\n}\n'\necho \"\"\n```\n\nIt would be great to get support for full-fragment multi-valued highlighting! Thank you!\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}