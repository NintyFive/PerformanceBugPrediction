[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/173895448","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-173895448","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":173895448,"node_id":"MDEyOklzc3VlQ29tbWVudDE3Mzg5NTQ0OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-22T11:47:08Z","updated_at":"2016-01-22T11:47:08Z","author_association":"CONTRIBUTOR","body":"Hi @zdrummond \n\nYou're using extended bounds, so there may well be buckets with no data in them.  Are you absolutely sure that there are docs that should be in that bucket?  Could you post a simple curl recreation showing: the create index/put mapping command, indexing some docs, then running the agg which shows the problem?\n\nAlso, what version of ES are you on?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/174015188","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-174015188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":174015188,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NDAxNTE4OA==","user":{"login":"zdrummond","id":1627527,"node_id":"MDQ6VXNlcjE2Mjc1Mjc=","avatar_url":"https://avatars3.githubusercontent.com/u/1627527?v=4","gravatar_id":"","url":"https://api.github.com/users/zdrummond","html_url":"https://github.com/zdrummond","followers_url":"https://api.github.com/users/zdrummond/followers","following_url":"https://api.github.com/users/zdrummond/following{/other_user}","gists_url":"https://api.github.com/users/zdrummond/gists{/gist_id}","starred_url":"https://api.github.com/users/zdrummond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zdrummond/subscriptions","organizations_url":"https://api.github.com/users/zdrummond/orgs","repos_url":"https://api.github.com/users/zdrummond/repos","events_url":"https://api.github.com/users/zdrummond/events{/privacy}","received_events_url":"https://api.github.com/users/zdrummond/received_events","type":"User","site_admin":false},"created_at":"2016-01-22T19:11:14Z","updated_at":"2016-01-22T19:11:14Z","author_association":"NONE","body":"Thanks @clintongormley for the quick response.\n\nWe are on 2.1.0\n\nUnfortunately I can not reliable reproduce the problem, I wish I could.\n\nAs for the ' absolutely sure that there are docs that should be in that bucket'.. as sure as I can be. If you note above my aggs are on **timestamp** by **sum(size)** by **collection_id**. The **timestamp** By **size** always works. The **collection_id** is the item that sometimes works and sometimes does not. \n\nThe example above also shows two events I picked from the same time range. Their keys are all the same (but values differ). They both have collection_id. Yet one ends up in a bucket, and the other ends up in a null bucket. \n\nNote: this is at a high level ELK... I have a chart that has missing data, but i was able to narrow down the issue to the empty bucket issue with aggs in ES. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/174945693","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-174945693","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":174945693,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NDk0NTY5Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-26T10:27:27Z","updated_at":"2016-01-26T10:27:27Z","author_association":"CONTRIBUTOR","body":"Hiya @zdrummond \n\nIs there any chance that you could provide us (privately) with a copy of the index and the full query that is being sent?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/175138041","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-175138041","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":175138041,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NTEzODA0MQ==","user":{"login":"zdrummond","id":1627527,"node_id":"MDQ6VXNlcjE2Mjc1Mjc=","avatar_url":"https://avatars3.githubusercontent.com/u/1627527?v=4","gravatar_id":"","url":"https://api.github.com/users/zdrummond","html_url":"https://github.com/zdrummond","followers_url":"https://api.github.com/users/zdrummond/followers","following_url":"https://api.github.com/users/zdrummond/following{/other_user}","gists_url":"https://api.github.com/users/zdrummond/gists{/gist_id}","starred_url":"https://api.github.com/users/zdrummond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zdrummond/subscriptions","organizations_url":"https://api.github.com/users/zdrummond/orgs","repos_url":"https://api.github.com/users/zdrummond/repos","events_url":"https://api.github.com/users/zdrummond/events{/privacy}","received_events_url":"https://api.github.com/users/zdrummond/received_events","type":"User","site_admin":false},"created_at":"2016-01-26T17:45:36Z","updated_at":"2016-01-26T17:45:36Z","author_association":"NONE","body":"I think so. How would I get it to you?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/175139417","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-175139417","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":175139417,"node_id":"MDEyOklzc3VlQ29tbWVudDE3NTEzOTQxNw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-26T17:48:53Z","updated_at":"2016-01-26T17:48:53Z","author_association":"CONTRIBUTOR","body":"You could put it in dropbox or S3 and send me the link?  clinton at elastic dot co\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/182328618","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-182328618","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":182328618,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MjMyODYxOA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2016-02-10T11:48:09Z","updated_at":"2016-02-10T11:48:09Z","author_association":"MEMBER","body":"@zdrummond I took a look at the data you provided us. It looks like there are documents that have a `collection_id` field but do not have a `collection_id.raw` field. You can see this if you add a missing aggregation alongside `\"3\"` looking at the field `collection_id.raw`.\n\nDid you add the multifield for `collection_id.raw` after you have done some indexing into 07-01-2016? Or maybe the template mapping for your logstash indices is not being applied correctly anymore?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/182585288","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-182585288","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":182585288,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MjU4NTI4OA==","user":{"login":"zdrummond","id":1627527,"node_id":"MDQ6VXNlcjE2Mjc1Mjc=","avatar_url":"https://avatars3.githubusercontent.com/u/1627527?v=4","gravatar_id":"","url":"https://api.github.com/users/zdrummond","html_url":"https://github.com/zdrummond","followers_url":"https://api.github.com/users/zdrummond/followers","following_url":"https://api.github.com/users/zdrummond/following{/other_user}","gists_url":"https://api.github.com/users/zdrummond/gists{/gist_id}","starred_url":"https://api.github.com/users/zdrummond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zdrummond/subscriptions","organizations_url":"https://api.github.com/users/zdrummond/orgs","repos_url":"https://api.github.com/users/zdrummond/repos","events_url":"https://api.github.com/users/zdrummond/events{/privacy}","received_events_url":"https://api.github.com/users/zdrummond/received_events","type":"User","site_admin":false},"created_at":"2016-02-10T21:17:57Z","updated_at":"2016-02-10T21:17:57Z","author_association":"NONE","body":"So the good news is, removing `.raw` in fact makes the query return the correct results. \n\nThe bad news is, we have made no any mapping changes, and the issue is persistent, not just on that date. Also, if there is a mapping issue, I would understand it across different sources, but this is coming from the same source (a single server responsible for one job)\n\nThat said, we have pretty much just set up ELK and started sending it data. We likely need to clean up the mappings holistically. Maybe if we nail down the mappings across all sources this issue would clear up.                                                                                                                    \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/182777526","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-182777526","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":182777526,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Mjc3NzUyNg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2016-02-11T09:17:59Z","updated_at":"2016-02-11T09:17:59Z","author_association":"MEMBER","body":"Do you use a custom template in your logstash output at all?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183520196","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-183520196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":183520196,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzUyMDE5Ng==","user":{"login":"pmorton","id":563222,"node_id":"MDQ6VXNlcjU2MzIyMg==","avatar_url":"https://avatars0.githubusercontent.com/u/563222?v=4","gravatar_id":"","url":"https://api.github.com/users/pmorton","html_url":"https://github.com/pmorton","followers_url":"https://api.github.com/users/pmorton/followers","following_url":"https://api.github.com/users/pmorton/following{/other_user}","gists_url":"https://api.github.com/users/pmorton/gists{/gist_id}","starred_url":"https://api.github.com/users/pmorton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pmorton/subscriptions","organizations_url":"https://api.github.com/users/pmorton/orgs","repos_url":"https://api.github.com/users/pmorton/repos","events_url":"https://api.github.com/users/pmorton/events{/privacy}","received_events_url":"https://api.github.com/users/pmorton/received_events","type":"User","site_admin":false},"created_at":"2016-02-12T23:06:09Z","updated_at":"2016-02-12T23:06:09Z","author_association":"NONE","body":"@colings86 We allowed logstash to use the default dynamic template. We did not specify a mapping we have logstash setup to tag these messages as the same type so they should share the same schema.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183655232","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-183655232","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":183655232,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MzY1NTIzMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-13T12:10:39Z","updated_at":"2016-02-13T12:10:39Z","author_association":"CONTRIBUTOR","body":"I wonder if the docs with the missing `.raw` field are all from the first documents in the index, ie whether there was some race condition.  Or alternatively, whether all the documents missing the `.raw` field are on the same shard.\n\nA number of mapping bugs have been cleaned up in 2.2.0 - also wonder if this problem has already been solved.  @zdrummond any chance you can upgrade and see if the issue disappears on new indices?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185301554","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-185301554","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":185301554,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTMwMTU1NA==","user":{"login":"zdrummond","id":1627527,"node_id":"MDQ6VXNlcjE2Mjc1Mjc=","avatar_url":"https://avatars3.githubusercontent.com/u/1627527?v=4","gravatar_id":"","url":"https://api.github.com/users/zdrummond","html_url":"https://github.com/zdrummond","followers_url":"https://api.github.com/users/zdrummond/followers","following_url":"https://api.github.com/users/zdrummond/following{/other_user}","gists_url":"https://api.github.com/users/zdrummond/gists{/gist_id}","starred_url":"https://api.github.com/users/zdrummond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zdrummond/subscriptions","organizations_url":"https://api.github.com/users/zdrummond/orgs","repos_url":"https://api.github.com/users/zdrummond/repos","events_url":"https://api.github.com/users/zdrummond/events{/privacy}","received_events_url":"https://api.github.com/users/zdrummond/received_events","type":"User","site_admin":false},"created_at":"2016-02-17T17:07:16Z","updated_at":"2016-02-17T17:07:16Z","author_association":"NONE","body":"Sure. We will plan a roll out of 2.2\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/188368161","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-188368161","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":188368161,"node_id":"MDEyOklzc3VlQ29tbWVudDE4ODM2ODE2MQ==","user":{"login":"zdrummond","id":1627527,"node_id":"MDQ6VXNlcjE2Mjc1Mjc=","avatar_url":"https://avatars3.githubusercontent.com/u/1627527?v=4","gravatar_id":"","url":"https://api.github.com/users/zdrummond","html_url":"https://github.com/zdrummond","followers_url":"https://api.github.com/users/zdrummond/followers","following_url":"https://api.github.com/users/zdrummond/following{/other_user}","gists_url":"https://api.github.com/users/zdrummond/gists{/gist_id}","starred_url":"https://api.github.com/users/zdrummond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zdrummond/subscriptions","organizations_url":"https://api.github.com/users/zdrummond/orgs","repos_url":"https://api.github.com/users/zdrummond/repos","events_url":"https://api.github.com/users/zdrummond/events{/privacy}","received_events_url":"https://api.github.com/users/zdrummond/received_events","type":"User","site_admin":false},"created_at":"2016-02-24T17:32:11Z","updated_at":"2016-02-24T17:32:11Z","author_association":"NONE","body":"@clintongormley and @colings86 We upgraded to 2.2 and we also did some hand mapping of data types and now the issue is resolved. Thanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/189957725","html_url":"https://github.com/elastic/elasticsearch/issues/16164#issuecomment-189957725","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16164","id":189957725,"node_id":"MDEyOklzc3VlQ29tbWVudDE4OTk1NzcyNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-28T22:26:08Z","updated_at":"2016-02-28T22:26:08Z","author_association":"CONTRIBUTOR","body":"thanks @zdrummond \n","performed_via_github_app":null}]