{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/58134","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58134/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58134/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58134/events","html_url":"https://github.com/elastic/elasticsearch/issues/58134","id":639084302,"node_id":"MDU6SXNzdWU2MzkwODQzMDI=","number":58134,"title":"Elasticsearch RestClient Error javax.net.ssl.SSLPeerUnverifiedException","user":{"login":"wmeg-aprico","id":46023178,"node_id":"MDQ6VXNlcjQ2MDIzMTc4","avatar_url":"https://avatars0.githubusercontent.com/u/46023178?v=4","gravatar_id":"","url":"https://api.github.com/users/wmeg-aprico","html_url":"https://github.com/wmeg-aprico","followers_url":"https://api.github.com/users/wmeg-aprico/followers","following_url":"https://api.github.com/users/wmeg-aprico/following{/other_user}","gists_url":"https://api.github.com/users/wmeg-aprico/gists{/gist_id}","starred_url":"https://api.github.com/users/wmeg-aprico/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wmeg-aprico/subscriptions","organizations_url":"https://api.github.com/users/wmeg-aprico/orgs","repos_url":"https://api.github.com/users/wmeg-aprico/repos","events_url":"https://api.github.com/users/wmeg-aprico/events{/privacy}","received_events_url":"https://api.github.com/users/wmeg-aprico/received_events","type":"User","site_admin":false},"labels":[{"id":912838655,"node_id":"MDU6TGFiZWw5MTI4Mzg2NTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Network","name":":Security/Network","color":"0e8a16","default":false,"description":"SSL/TLS, Security for NIO/Netty"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967499607,"node_id":"MDU6TGFiZWwxOTY3NDk5NjA3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Security","name":"Team:Security","color":"fef2c0","default":false,"description":"Meta label for security team"},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-06-15T19:24:50Z","updated_at":"2020-06-17T08:21:02Z","closed_at":"2020-06-17T05:08:09Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.8.8\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Lentos\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI'am configuring pls/ssl in a multi-node cluster. I generated certificate using the following command:\r\n\r\nbin/elasticsearch-certutil cert --ca elastic-stack-ca.p12 --name filename-cert --in cluster.yml\r\nand then, I generated a CA certificate as follows:\r\n\r\nopenssl pkcs12 -in filename-cert.p12 -cacerts -nokeys -chain > client-ca.cer\r\n\r\nI set xpack.security.transport.ssl.verification_mode: full in elasticsearch side\r\nI set elasticsearch.ssl.verificationMode: full in Kibana side.\r\n\r\nBoth Kibana and Elasticsearch are working as expected. However, my java client does not work and fails with the following exception: Caused by: javax.net.ssl.SSLPeerUnverifiedException: Host name 'xxx-xxx-xxx-xx' does not match the certificate subject provided by the peer (CN=xxx-node-1)\r\n\r\nIn my code, I enabled hostname verification as follows: \r\n\r\ncb.setHttpClientConfigCallback(http -> {\r\n                    http.disableAuthCaching();\r\n                    http.setSSLHostnameVerifier((s, session) -> true);\r\n                    http.setSSLContext(ssl);\r\n                    return http.setDefaultCredentialsProvider(cp);\r\n                });\r\n\r\nCould you please provide me with more details on haw to fix the issue.\r\n\r\nThank you in advance.\r\nBest Regards.\r\nWael\r\n\r\n\r\n","closed_by":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"performed_via_github_app":null}