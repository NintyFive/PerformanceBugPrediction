[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/317355602","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-317355602","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":317355602,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNzM1NTYwMg==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2017-07-24T08:35:32Z","updated_at":"2017-07-24T08:35:32Z","author_association":"CONTRIBUTOR","body":">_source is disabled in the mappings for index [data-product-5]\r\n\r\nThis error looks significant. It' saying there was an attempt to retrieve the JSON of a matching doc but the index being hit has specifically disabled the storage of the `_source` field which contains JSON. This is normally only ever disabled when space-saving is paramount and you don't want a whole host of elasticsearch features that rely on this content being stored.  Was this a deliberate configuration on your part?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/317513141","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-317513141","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":317513141,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNzUxMzE0MQ==","user":{"login":"qwerty4030","id":874677,"node_id":"MDQ6VXNlcjg3NDY3Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/874677?v=4","gravatar_id":"","url":"https://api.github.com/users/qwerty4030","html_url":"https://github.com/qwerty4030","followers_url":"https://api.github.com/users/qwerty4030/followers","following_url":"https://api.github.com/users/qwerty4030/following{/other_user}","gists_url":"https://api.github.com/users/qwerty4030/gists{/gist_id}","starred_url":"https://api.github.com/users/qwerty4030/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwerty4030/subscriptions","organizations_url":"https://api.github.com/users/qwerty4030/orgs","repos_url":"https://api.github.com/users/qwerty4030/repos","events_url":"https://api.github.com/users/qwerty4030/events{/privacy}","received_events_url":"https://api.github.com/users/qwerty4030/received_events","type":"User","site_admin":false},"created_at":"2017-07-24T18:29:25Z","updated_at":"2017-07-24T18:29:25Z","author_association":"CONTRIBUTOR","body":"No we definitely do not have `_source` disabled, as I mentioned the code works fine sometimes. I'm not sure if this helps, but this index was created in 2.x and restored via snapshot in the 5.3 cluster:\r\n```\r\n\"version\": {\r\n          \"created\": \"2040099\",\r\n          \"upgraded\": \"5030399\"\r\n        }\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323976500","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-323976500","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":323976500,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzk3NjUwMA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2017-08-22T09:47:00Z","updated_at":"2017-08-22T09:47:00Z","author_association":"CONTRIBUTOR","body":">not sure if this helps, but this index was created in 2.x and restored via snapshot in the 5.3 cluster:\r\n\r\n\r\nHaving a hard time recreating this. \r\nI've just created a single-field, single-shard index with 100k docs in 2.4.0, snapshotted it and restored into 5.3.3 where I've been able to scroll through all docs without an issue.\r\nWe'll need to dig deeper on your config either by supplying the index or at least mappings, scroll queries and example doc. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327825772","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-327825772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":327825772,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzgyNTc3Mg==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2017-09-07T14:57:48Z","updated_at":"2017-09-07T14:57:48Z","author_association":"MEMBER","body":"There might be a related issue in https://discuss.elastic.co/t/nullpointerexception-in-scroll/98717","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327877506","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-327877506","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":327877506,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzg3NzUwNg==","user":{"login":"qwerty4030","id":874677,"node_id":"MDQ6VXNlcjg3NDY3Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/874677?v=4","gravatar_id":"","url":"https://api.github.com/users/qwerty4030","html_url":"https://github.com/qwerty4030","followers_url":"https://api.github.com/users/qwerty4030/followers","following_url":"https://api.github.com/users/qwerty4030/following{/other_user}","gists_url":"https://api.github.com/users/qwerty4030/gists{/gist_id}","starred_url":"https://api.github.com/users/qwerty4030/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwerty4030/subscriptions","organizations_url":"https://api.github.com/users/qwerty4030/orgs","repos_url":"https://api.github.com/users/qwerty4030/repos","events_url":"https://api.github.com/users/qwerty4030/events{/privacy}","received_events_url":"https://api.github.com/users/qwerty4030/received_events","type":"User","site_admin":false},"created_at":"2017-09-07T18:01:36Z","updated_at":"2017-09-07T18:01:36Z","author_association":"CONTRIBUTOR","body":"This has occurred again a couple of times in the last few days. I noticed a different NPE in the ES logs:\r\n```\r\n[2017-09-07T13:13:09,214][DEBUG][o.e.a.s.TransportSearchScrollAction] [data3] Failed to execute fetch phase\r\norg.elasticsearch.transport.RemoteTransportException: [data6][10.206.38.201:9300][indices:data/read/search[phase/fetch/id/scroll]]\r\nCaused by: java.lang.NullPointerException\r\n\tat org.elasticsearch.search.fetch.subphase.MatchedQueriesFetchSubPhase.lambda$hitsExecute$0(MatchedQueriesFetchSubPhase.java:52) ~[elasticsearch-5.3.3.jar:5.3.3]\r\n\tat java.util.TimSort.countRunAndMakeAscending(TimSort.java:360) ~[?:1.8.0_131]\r\n\tat java.util.TimSort.sort(TimSort.java:234) ~[?:1.8.0_131]\r\n\tat java.util.Arrays.sort(Arrays.java:1438) ~[?:1.8.0_131]\r\n\tat org.elasticsearch.search.fetch.subphase.MatchedQueriesFetchSubPhase.hitsExecute(MatchedQueriesFetchSubPhase.java:52) ~[elasticsearch-5.3.3.jar:5.3.3]\r\n\tat org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:168) ~[elasticsearch-5.3.3.jar:5.3.3]\r\n\tat org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:417) ~[elasticsearch-5.3.3.jar:5.3.3]\r\n\tat org.elasticsearch.action.search.SearchTransportService$11.messageReceived(SearchTransportService.java:384) ~[elasticsearch-5.3.3.jar:5.3.3]\r\n\tat org.elasticsearch.action.search.SearchTransportService$11.messageReceived(SearchTransportService.java:381) ~[elasticsearch-5.3.3.jar:5.3.3]\r\n\t...\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327947036","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-327947036","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":327947036,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzk0NzAzNg==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2017-09-07T22:44:07Z","updated_at":"2017-09-07T22:44:07Z","author_association":"MEMBER","body":"This seems to be a different issue. In the first set of stacktraces, it looked like search context was disappearing. In this stack trace we are dealing with nulls in SearchHit array. I can come up with some reasonable explanation how search context could disappear (some sort of race condition between context cleanup and use). However, SearchHits array here is a local variable and I don't really see any code paths that could lead to having nulls in it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372714642","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-372714642","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":372714642,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjcxNDY0Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T15:51:22Z","updated_at":"2018-03-13T15:51:22Z","author_association":"MEMBER","body":"@qwerty4030 do you still experience this issue? It looks like we are still not able to reproduce.\r\n/cc @elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373243496","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-373243496","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":373243496,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzI0MzQ5Ng==","user":{"login":"qwerty4030","id":874677,"node_id":"MDQ6VXNlcjg3NDY3Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/874677?v=4","gravatar_id":"","url":"https://api.github.com/users/qwerty4030","html_url":"https://github.com/qwerty4030","followers_url":"https://api.github.com/users/qwerty4030/followers","following_url":"https://api.github.com/users/qwerty4030/following{/other_user}","gists_url":"https://api.github.com/users/qwerty4030/gists{/gist_id}","starred_url":"https://api.github.com/users/qwerty4030/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwerty4030/subscriptions","organizations_url":"https://api.github.com/users/qwerty4030/orgs","repos_url":"https://api.github.com/users/qwerty4030/repos","events_url":"https://api.github.com/users/qwerty4030/events{/privacy}","received_events_url":"https://api.github.com/users/qwerty4030/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T02:51:26Z","updated_at":"2018-03-15T02:51:26Z","author_association":"CONTRIBUTOR","body":"@cbuescher Unfortunately I don't have access to this cluster anymore. I was hoping the stacktraces would be enough to figure it out. Hopefully its fixed in a later version!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375320123","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-375320123","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":375320123,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTMyMDEyMw==","user":{"login":"talanb","id":959228,"node_id":"MDQ6VXNlcjk1OTIyOA==","avatar_url":"https://avatars2.githubusercontent.com/u/959228?v=4","gravatar_id":"","url":"https://api.github.com/users/talanb","html_url":"https://github.com/talanb","followers_url":"https://api.github.com/users/talanb/followers","following_url":"https://api.github.com/users/talanb/following{/other_user}","gists_url":"https://api.github.com/users/talanb/gists{/gist_id}","starred_url":"https://api.github.com/users/talanb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talanb/subscriptions","organizations_url":"https://api.github.com/users/talanb/orgs","repos_url":"https://api.github.com/users/talanb/repos","events_url":"https://api.github.com/users/talanb/events{/privacy}","received_events_url":"https://api.github.com/users/talanb/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T14:11:55Z","updated_at":"2018-03-22T14:11:55Z","author_association":"NONE","body":"@cbuescher I am the lead dev on this cluster now and we are still seeing this error. Over the last 30 days we have 81 occurrences of this exception. /cc @qwerty4030 ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375331240","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-375331240","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":375331240,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTMzMTI0MA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T14:43:23Z","updated_at":"2018-03-22T14:43:23Z","author_association":"MEMBER","body":"The two main reasons for this exception seem to be using the original scroll id for all scroll requests, and/or timing out of the search context. \r\nSince from your initial description you seem confident to rule those out, I'd suggest going back to the ask by @markharwood for you config, index mappings, scroll queries and example documents, if possible.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375335410","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-375335410","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":375335410,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTMzNTQxMA==","user":{"login":"talanb","id":959228,"node_id":"MDQ6VXNlcjk1OTIyOA==","avatar_url":"https://avatars2.githubusercontent.com/u/959228?v=4","gravatar_id":"","url":"https://api.github.com/users/talanb","html_url":"https://github.com/talanb","followers_url":"https://api.github.com/users/talanb/followers","following_url":"https://api.github.com/users/talanb/following{/other_user}","gists_url":"https://api.github.com/users/talanb/gists{/gist_id}","starred_url":"https://api.github.com/users/talanb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talanb/subscriptions","organizations_url":"https://api.github.com/users/talanb/orgs","repos_url":"https://api.github.com/users/talanb/repos","events_url":"https://api.github.com/users/talanb/events{/privacy}","received_events_url":"https://api.github.com/users/talanb/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T14:54:58Z","updated_at":"2018-03-22T14:54:58Z","author_association":"NONE","body":"@cbuescher I'll start putting that information together. One thing that I noticed while researching this error this morning is that at the time that the error occurred we have a gap in the monitoring graphs. I've attached two screenshots that show this. I've only checked 2 of the occurrences so far but the two that I checked both exhibit the same gap in the graphs\r\n\r\nThe gap appears in the primary master node as well as in at least one of the data nodes. These images are for the primary master node.\r\n\r\n![25820_monitoring_master1](https://user-images.githubusercontent.com/959228/37778021-ecdecc80-2db6-11e8-8fe6-1b8cfd72aa8c.png)\r\n![25820_monitoring_overview](https://user-images.githubusercontent.com/959228/37778022-ecf4393a-2db6-11e8-94a2-ea93811cc1c6.png)\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/402477464","html_url":"https://github.com/elastic/elasticsearch/issues/25820#issuecomment-402477464","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25820","id":402477464,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjQ3NzQ2NA==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2018-07-04T13:21:04Z","updated_at":"2018-07-04T13:21:04Z","author_association":"CONTRIBUTOR","body":"No further feedback received. @talanb / @qwerty4030  if you have the requested \r\ninformation please add it in a comment and we can look at re-opening \r\nthis issue.","performed_via_github_app":null}]