{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/63672","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63672/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63672/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63672/events","html_url":"https://github.com/elastic/elasticsearch/issues/63672","id":721464919,"node_id":"MDU6SXNzdWU3MjE0NjQ5MTk=","number":63672,"title":"[CI] Failure in ConcurrentSnapshotsIT  testConcurrentSnapshotWorksWithOldVersionRepo","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-10-14T13:35:34Z","updated_at":"2020-10-14T13:45:39Z","closed_at":"2020-10-14T13:45:39Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Both in 7.x and master there seems to be an NPE in:\r\n```\r\n\r\njava.lang.NullPointerException: null\r\n  | at org.elasticsearch.snapshots.InFlightShardSnapshotStates.assertGenerationConsistency(InFlightShardSnapshotStates.java:107) ~[main/:?] |  \r\n  | at org.elasticsearch.snapshots.InFlightShardSnapshotStates.addStateInformation(InFlightShardSnapshotStates.java:79) ~[main/:?] |  \r\n  | at org.elasticsearch.snapshots.InFlightShardSnapshotStates.forRepo(InFlightShardSnapshotStates.java:68) ~[main/:?] |  \r\n  | at org.elasticsearch.cluster.SnapshotsInProgress.assertConsistentEntries(SnapshotsInProgress.java:749) ~[main/:?] |  \r\n  | at org.elasticsearch.cluster.SnapshotsInProgress.<init>(SnapshotsInProgress.java:763) ~[main/:?] |  \r\n  | at org.elasticsearch.cluster.SnapshotsInProgress.of(SnapshotsInProgress.java:758) ~[main/:?] |  \r\n  | at org.elasticsearch.snapshots.SnapshotsService$2.execute(SnapshotsService.java:434) ~[main/:?] |  \r\n  | at org.elasticsearch.repositories.blobstore.BlobStoreRepository$1.execute(BlobStoreRepository.java:371) ~[main/:?] |  \r\n  | at org.elasticsearch.cluster.ClusterStateUpdateTask.execute(ClusterStateUpdateTask.java:47) ~[main/:?] |  \r\n  | at org.elasticsearch.cluster.service.MasterService.executeTasks(MasterService.java:702) ~[main/:?] |  \r\n  | at org.elasticsearch.cluster.service.MasterService.calculateTaskOutputs(MasterService.java:324) ~[main/:?] |  \r\n  | at org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:219) [main/:?] |  \r\n  | at org.elasticsearch.cluster.service.MasterService.access$000(MasterService.java:73) [main/:?] |  \r\n  | at org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:151) [main/:?] |  \r\n  | at org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) [main/:?] |  \r\n  | at org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) [main/:?] |  \r\n  | at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:678) [main/:?] |  \r\n  | at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:252) [main/:?] |  \r\n  | at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:215) [main/:?] |  \r\n  | at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_241] |  \r\n  | at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_241] |  \r\n  | at java.lang.Thread.run(Thread.java:748) [?:1.8.0_241]\r\n```\r\n\r\nSample build scans:\r\n* https://gradle-enterprise.elastic.co/s/g25empdhtuyzc/tests/:server:internalClusterTest/org.elasticsearch.snapshots.ConcurrentSnapshotsIT/testConcurrentSnapshotWorksWithOldVersionRepo#1\r\n* https://gradle-enterprise.elastic.co/s/njjsq64oksovm/tests/:server:internalClusterTest/org.elasticsearch.snapshots.ConcurrentSnapshotsIT/testConcurrentSnapshotWorksWithOldVersionRepo#1\r\n* https://gradle-enterprise.elastic.co/s/g25empdhtuyzc/tests/:server:internalClusterTest/org.elasticsearch.snapshots.ConcurrentSnapshotsIT/testConcurrentSnapshotWorksWithOldVersionRepo#1\r\n\r\nHistory in the past 7 days: https://gradle-enterprise.elastic.co/scans/tests?list.size=50&list.sortColumn=startTime&list.sortOrder=desc&search.buildToolTypes=gradle&search.buildToolTypes=maven&search.relativeStartTime=P7D&search.timeZoneId=Europe/Bucharest&tests.container=org.elasticsearch.snapshots.ConcurrentSnapshotsIT&tests.sortField=FAILED&tests.test=testConcurrentSnapshotWorksWithOldVersionRepo&tests.unstableOnly=true","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}