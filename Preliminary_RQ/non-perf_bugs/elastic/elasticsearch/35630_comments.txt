[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/439480598","html_url":"https://github.com/elastic/elasticsearch/issues/35630#issuecomment-439480598","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35630","id":439480598,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTQ4MDU5OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-11-16T18:17:27Z","updated_at":"2018-11-16T18:17:27Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440084240","html_url":"https://github.com/elastic/elasticsearch/issues/35630#issuecomment-440084240","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35630","id":440084240,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDA4NDI0MA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-11-19T23:49:51Z","updated_at":"2018-11-19T23:52:29Z","author_association":"MEMBER","body":"Can you please provide the actual script your are using with `doc`? While the error message is confusing, this basically just means you are trying to dereference `null` (where the returned type is `def` in painless).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440207964","html_url":"https://github.com/elastic/elasticsearch/issues/35630#issuecomment-440207964","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35630","id":440207964,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDIwNzk2NA==","user":{"login":"jzzfs","id":9054705,"node_id":"MDQ6VXNlcjkwNTQ3MDU=","avatar_url":"https://avatars1.githubusercontent.com/u/9054705?v=4","gravatar_id":"","url":"https://api.github.com/users/jzzfs","html_url":"https://github.com/jzzfs","followers_url":"https://api.github.com/users/jzzfs/followers","following_url":"https://api.github.com/users/jzzfs/following{/other_user}","gists_url":"https://api.github.com/users/jzzfs/gists{/gist_id}","starred_url":"https://api.github.com/users/jzzfs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzzfs/subscriptions","organizations_url":"https://api.github.com/users/jzzfs/orgs","repos_url":"https://api.github.com/users/jzzfs/repos","events_url":"https://api.github.com/users/jzzfs/events{/privacy}","received_events_url":"https://api.github.com/users/jzzfs/received_events","type":"User","site_admin":false},"created_at":"2018-11-20T09:41:48Z","updated_at":"2018-11-20T09:41:48Z","author_association":"NONE","body":"\r\n```\r\nGET dev__oct_2018/_search\r\n{\r\n  \"size\": 0,\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [],\r\n      \"should\": [],\r\n      \"must_not\": [],\r\n      \"filter\": []\r\n    }\r\n  },\r\n  \"aggs\": {\r\n    \"the hard way\": {\r\n      \"scripted_metric\": {\r\n        \"init_script\": {\r\n          \"source\": \"params._agg['commits'] = [];\"\r\n        },\r\n        \"map_script\": {\r\n          \"source\": \"Debug.explain(doc)\"\r\n        },\r\n        \"combine_script\": {\r\n          \"source\": \"return 0.0\"\r\n        },\r\n        \"reduce_script\": {\r\n          \"source\": \"return 0.0\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nreturns\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"null_pointer_exception\",\r\n        \"reason\": null\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"dev__oct_2018\",\r\n        \"node\": \"C2dBtzqBQOOiH5G5IGQPkQ\",\r\n        \"reason\": {\r\n          \"type\": \"null_pointer_exception\",\r\n          \"reason\": null\r\n        }\r\n      }\r\n    ],\r\n    \"caused_by\": {\r\n      \"type\": \"null_pointer_exception\",\r\n      \"reason\": null,\r\n      \"caused_by\": {\r\n        \"type\": \"null_pointer_exception\",\r\n        \"reason\": null\r\n      }\r\n    }\r\n  },\r\n  \"status\": 500\r\n}\r\n```\r\n\r\nHere's the ES footprint:\r\n```\r\n{\r\n  \"name\": \"C2dBtzq\",\r\n  \"cluster_name\": \"elasticsearch\",\r\n  \"cluster_uuid\": \"tNRb2YK5Rzi0bm06kF05rQ\",\r\n  \"version\": {\r\n    \"number\": \"6.3.1\",\r\n    \"build_flavor\": \"default\",\r\n    \"build_type\": \"zip\",\r\n    \"build_hash\": \"eb782d0\",\r\n    \"build_date\": \"2018-06-29T21:59:26.107521Z\",\r\n    \"build_snapshot\": false,\r\n    \"lucene_version\": \"7.3.1\",\r\n    \"minimum_wire_compatibility_version\": \"5.6.0\",\r\n    \"minimum_index_compatibility_version\": \"5.0.0\"\r\n  },\r\n  \"tagline\": \"You Know, for Search\"\r\n}\r\n```\r\n\r\n### Note 1\r\nI unfortunately cannot share the mapping b/c of NDA but, in essence, all my other percentile, nested, stats etc aggs are working just fine. This scripted metric agg is the only one causing trouble.\r\n\r\n### Note 2\r\nThe above issue pertains to localhost and the abovementioned build.\r\nI tried this agg on my live server which has the following footprint:\r\n```\r\n{\r\n  \"name\": \"wQnVrAN\",\r\n  \"cluster_name\": \"elasticsearch\",\r\n  \"cluster_uuid\": \"cobqE0w3SPu0LVLwv9MhxA\",\r\n  \"version\": {\r\n    \"number\": \"6.4.3\",\r\n    \"build_flavor\": \"oss\",\r\n    \"build_type\": \"tar\",\r\n    \"build_hash\": \"fe40335\",\r\n    \"build_date\": \"2018-10-30T23:17:19.084789Z\",\r\n    \"build_snapshot\": false,\r\n    \"lucene_version\": \"7.4.0\",\r\n    \"minimum_wire_compatibility_version\": \"5.6.0\",\r\n    \"minimum_index_compatibility_version\": \"5.0.0\"\r\n  },\r\n  \"tagline\": \"You Know, for Search\"\r\n}\r\n```\r\nand the response is\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"script_exception\",\r\n        \"reason\": \"runtime error\",\r\n        \"painless_class\": \"org.elasticsearch.index.fielddata.ScriptDocValues.Doubles\",\r\n        \"to_string\": \"[112043.0]\",\r\n        \"java_class\": \"org.elasticsearch.index.fielddata.ScriptDocValues$Doubles\",\r\n        \"script_stack\": [\r\n          \"Debug.explain(doc.id)\",\r\n          \"                 ^---- HERE\"\r\n        ],\r\n        \"script\": \"Debug.explain(doc.id)\",\r\n        \"lang\": \"painless\"\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"dev__oct_2018\",\r\n        \"node\": \"wQnVrAN8QwabKDmXd5ADeg\",\r\n        \"reason\": {\r\n          \"type\": \"script_exception\",\r\n          \"reason\": \"runtime error\",\r\n          \"painless_class\": \"org.elasticsearch.index.fielddata.ScriptDocValues.Doubles\",\r\n          \"to_string\": \"[112043.0]\",\r\n          \"java_class\": \"org.elasticsearch.index.fielddata.ScriptDocValues$Doubles\",\r\n          \"script_stack\": [\r\n            \"Debug.explain(doc.id)\",\r\n            \"                 ^---- HERE\"\r\n          ],\r\n          \"script\": \"Debug.explain(doc.id)\",\r\n          \"lang\": \"painless\",\r\n          \"caused_by\": {\r\n            \"type\": \"painless_explain_error\",\r\n            \"reason\": null\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"status\": 500\r\n}\r\n```\r\n\r\nwhich is what I would expect! The thing is, the live data passed through the same sync pipeline as my localhost index. So I suppose the newer, live build takes care of these null pointers.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440370552","html_url":"https://github.com/elastic/elasticsearch/issues/35630#issuecomment-440370552","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35630","id":440370552,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDM3MDU1Mg==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-11-20T17:53:45Z","updated_at":"2018-11-20T17:53:45Z","author_association":"MEMBER","body":"I'm not able to reproduce this. I created an index with a single doc, then ran:\r\n\r\n```\r\nGET _search\r\n{\r\n  \"size\": 0,\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  },\r\n  \"aggs\": {\r\n    \"myagg\": {\r\n      \"scripted_metric\": {\r\n        \"map_script\": {\r\n          \"source\": \"Debug.explain(doc)\"\r\n        },\r\n        \"combine_script\": {\r\n          \"source\": \"return 0.0\"\r\n        },\r\n        \"reduce_script\": {\r\n          \"source\": \"return 0.0\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nAnd I get the expected explain response:\r\n```\r\n{\"error\":{\"root_cause\":[{\"type\":\"script_exception\",\"reason\":\"runtime error\",\"to_string\":\"org.elasticsearch.search.lookup.LeafDocLookup@21023a5b\",\"java_class\":\"org.elasticsearch.search.lookup.LeafDocLookup\",\"script_stack\":[\"Debug.explain(doc)\",\"              ^---- HERE\"],\"script\":\"Debug.explain(doc)\",\"lang\":\"painless\"}],\"type\":\"search_phase_execution_exception\",\"reason\":\"all shards failed\",\"phase\":\"query\",\"grouped\":true,\"failed_shards\":[{\"shard\":0,\"index\":\"index\",\"node\":\"XzGHrcTcQJytGhRENO2WLw\",\"reason\":{\"type\":\"script_exception\",\"reason\":\"runtime error\",\"to_string\":\"org.elasticsearch.search.lookup.LeafDocLookup@21023a5b\",\"java_class\":\"org.elasticsearch.search.lookup.LeafDocLookup\",\"script_stack\":[\"Debug.explain(doc)\",\"              ^---- HERE\"],\"script\":\"Debug.explain(doc)\",\"lang\":\"painless\",\"caused_by\":{\"type\":\"painless_explain_error\",\"reason\":null}}}]},\"status\":400}\r\n```\r\n\r\nThe example you gave that \"works\" is also not the same as what you first pasted. The latter looks for an `id` field in doc, while the former just tries to explain `doc` (which is what I ran). And this also does not match the title of this issue (which implies the error is when accessing params). Since you can't share your actual data/query, could you please try to provide a minimal recreation? Something like \"index these docs, run this query, see failure\" ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440995156","html_url":"https://github.com/elastic/elasticsearch/issues/35630#issuecomment-440995156","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35630","id":440995156,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDk5NTE1Ng==","user":{"login":"jzzfs","id":9054705,"node_id":"MDQ6VXNlcjkwNTQ3MDU=","avatar_url":"https://avatars1.githubusercontent.com/u/9054705?v=4","gravatar_id":"","url":"https://api.github.com/users/jzzfs","html_url":"https://github.com/jzzfs","followers_url":"https://api.github.com/users/jzzfs/followers","following_url":"https://api.github.com/users/jzzfs/following{/other_user}","gists_url":"https://api.github.com/users/jzzfs/gists{/gist_id}","starred_url":"https://api.github.com/users/jzzfs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzzfs/subscriptions","organizations_url":"https://api.github.com/users/jzzfs/orgs","repos_url":"https://api.github.com/users/jzzfs/repos","events_url":"https://api.github.com/users/jzzfs/events{/privacy}","received_events_url":"https://api.github.com/users/jzzfs/received_events","type":"User","site_admin":false},"created_at":"2018-11-22T11:04:29Z","updated_at":"2018-11-22T11:04:29Z","author_association":"NONE","body":"I'm not able to reproduce it with dummy data:\r\n\r\n#### PUT script_test_index\r\n---\r\n#### POST script_test_index/record\r\n```\r\n{\r\n  \"index\": 0,\r\n  \"guid\": \"dc3cbef6-d46d-4ee6-b8ff-0f84343c9593\",\r\n  \"isActive\": false,\r\n  \"balance\": \"$3,032.44\",\r\n  \"picture\": \"http://placehold.it/32x32\",\r\n  \"age\": 23,\r\n  \"eyeColor\": \"green\",\r\n  \"name\": \"Caroline Wooten\",\r\n  \"gender\": \"female\",\r\n  \"company\": \"EWAVES\",\r\n  \"email\": \"carolinewooten@ewaves.com\",\r\n  \"phone\": \"+1 (921) 448-2839\",\r\n  \"address\": \"324 Pilling Street, Vaughn, Illinois, 9521\",\r\n  \"about\": \"\"\"\r\nAd culpa non eu mollit eiusmod voluptate. Lorem cillum consectetur aliquip pariatur cillum deserunt tempor reprehenderit in irure voluptate. Nostrud enim officia commodo aliquip amet laborum ea excepteur. Nulla do ipsum exercitation irure minim reprehenderit tempor deserunt adipisicing dolore. Est minim consectetur nulla dolor minim sint dolor magna laborum. Aliqua dolore in do nulla laborum voluptate voluptate voluptate consequat.\r\n\"\"\",\r\n  \"registered\": \"2015-10-24T01:53:17 -02:00\",\r\n  \"latitude\": -25.320813,\r\n  \"longitude\": -164.551767,\r\n  \"tags\": [\r\n    \"occaecat\",\r\n    \"sit\",\r\n    \"fugiat\",\r\n    \"nulla\",\r\n    \"excepteur\",\r\n    \"consequat\",\r\n    \"velit\"\r\n  ],\r\n  \"friends\": [\r\n    {\r\n      \"id\": 0,\r\n      \"name\": \"Noemi Kemp\"\r\n    },\r\n    {\r\n      \"id\": 1,\r\n      \"name\": \"June Hogan\"\r\n    },\r\n    {\r\n      \"id\": 2,\r\n      \"name\": \"Sasha Massey\"\r\n    }\r\n  ],\r\n  \"greeting\": \"Hello, Caroline Wooten! You have 3 unread messages.\",\r\n  \"favoriteFruit\": \"strawberry\"\r\n}\r\n```\r\n---\r\n#### GET script_test_index/_search\r\n```\r\n{\r\n  \"size\": 0,\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [],\r\n      \"should\": [],\r\n      \"must_not\": [],\r\n      \"filter\": []\r\n    }\r\n  },\r\n  \"aggs\": {\r\n    \"the hard way\": {\r\n      \"scripted_metric\": {\r\n        \"init_script\": {\r\n          \"source\": \"params._agg['tmp'] = [];\"\r\n        },\r\n        \"map_script\": {\r\n          \"source\": \"Debug.explain(doc)\"\r\n        },\r\n        \"combine_script\": {\r\n          \"source\": \"return 0.0\"\r\n        },\r\n        \"reduce_script\": {\r\n          \"source\": \"return 0.0\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n---\r\nThis time I'm not getting any 500s but there is a shard failure.\r\n\r\n#### Response of the last operation\r\n```\r\n{\r\n  \"took\": 87,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 4,\r\n    \"skipped\": 0,\r\n    \"failed\": 1,\r\n    \"failures\": [\r\n      {\r\n        \"shard\": 2,\r\n        \"index\": \"script_test_index\",\r\n        \"node\": \"C2dBtzqBQOOiH5G5IGQPkQ\",\r\n        \"reason\": {\r\n          \"type\": \"null_pointer_exception\",\r\n          \"reason\": null\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"hits\": {\r\n    \"total\": 0,\r\n    \"max_score\": 0,\r\n    \"hits\": []\r\n  },\r\n  \"aggregations\": {\r\n    \"the hard way\": {\r\n      \"value\": 0\r\n    }\r\n  }\r\n}\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/442277034","html_url":"https://github.com/elastic/elasticsearch/issues/35630#issuecomment-442277034","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35630","id":442277034,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MjI3NzAzNA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-11-28T00:55:40Z","updated_at":"2018-11-28T00:55:40Z","author_association":"MEMBER","body":"Given that this is not reproducible, I hope you don't mind that I close this issue. If you come up with a reproduction in the future, please don't hesitate to comment here and we can reopen.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/451958476","html_url":"https://github.com/elastic/elasticsearch/issues/35630#issuecomment-451958476","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35630","id":451958476,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTk1ODQ3Ng==","user":{"login":"qballer","id":1002622,"node_id":"MDQ6VXNlcjEwMDI2MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/1002622?v=4","gravatar_id":"","url":"https://api.github.com/users/qballer","html_url":"https://github.com/qballer","followers_url":"https://api.github.com/users/qballer/followers","following_url":"https://api.github.com/users/qballer/following{/other_user}","gists_url":"https://api.github.com/users/qballer/gists{/gist_id}","starred_url":"https://api.github.com/users/qballer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qballer/subscriptions","organizations_url":"https://api.github.com/users/qballer/orgs","repos_url":"https://api.github.com/users/qballer/repos","events_url":"https://api.github.com/users/qballer/events{/privacy}","received_events_url":"https://api.github.com/users/qballer/received_events","type":"User","site_admin":false},"created_at":"2019-01-07T14:48:43Z","updated_at":"2019-01-07T14:48:43Z","author_association":"NONE","body":"I'm having a similar issue:  \r\nhttps://stackoverflow.com/questions/54075711/trying-to-pass-params-to-elasticsearch-getting-null-pointer-exception\r\nif anyone can help me.","performed_via_github_app":null}]