{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31364","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31364/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31364/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31364/events","html_url":"https://github.com/elastic/elasticsearch/issues/31364","id":332837759,"node_id":"MDU6SXNzdWUzMzI4Mzc3NTk=","number":31364,"title":"Packaging tests fail on ownership check","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-06-15T16:21:04Z","updated_at":"2020-11-11T21:50:52Z","closed_at":"2018-06-18T10:36:07Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I haven't been able to dig much into this failure due to limited time (and the fact that my limited knowledge around Vagrant and bats tests also makes me much slower), but this seed reproduces a failure with the bats tests. Here is a relevant sample from https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.3+packaging-tests/154/consoleFull:\r\n\r\n```\r\n08:12:54 ok 187 [SYSTEMD] install elasticsearch\r\n08:12:54 ok 188 [SYSTEMD] daemon reload after install\r\n08:12:54 ok 189 [SYSTEMD] daemon isn't enabled on restart\r\n08:12:54 ok 190 [SYSTEMD] enable\r\n08:13:02 ok 191 [SYSTEMD] start\r\n08:13:03 ok 192 [SYSTEMD] start (running)\r\n08:13:03 ok 193 [SYSTEMD] is active (running)\r\n08:13:03 ok 194 [SYSTEMD] status (running)\r\n08:13:04 ok 195 [SYSTEMD] test elasticsearch\r\n08:13:12 ok 196 [SYSTEMD] restart\r\n08:13:12 ok 197 [SYSTEMD] stop (running)\r\n08:13:12 ok 198 [SYSTEMD] status (stopping)\r\n08:13:12 ok 199 [SYSTEMD] stop (stopped)\r\n08:13:13 ok 200 [SYSTEMD] status (stopped)\r\n08:13:21 ok 201 [SYSTEMD] delete PID_DIR and restart\r\n08:13:29 ok 202 [SYSTEMD] start Elasticsearch with custom JVM options\r\n08:13:32 ok 203 [SYSTEMD] masking systemd-sysctl\r\n08:13:42 ok 204 [SYSTEMD] service file sets limits\r\n08:13:53 ok 205 [SYSTEMD] test runtime directory\r\n08:14:01 ok 206 [SYSTEMD] GC logs exist\r\n08:14:01 ok 207 # skip (sysvinit is supported, but systemd too) [INIT.D] remove any leftover configuration to start elasticsearch on restart\r\n08:14:01 ok 207 # skip (sysvinit is supported, but systemd too) [INIT.D] remove any leftover configuration to start elasticsearch on restart\r\n08:14:01 ok 208 # skip (sysvinit is supported, but systemd too) [INIT.D] install elasticsearch\r\n08:14:01 ok 208 # skip (sysvinit is supported, but systemd too) [INIT.D] install elasticsearch\r\n08:14:01 ok 209 # skip (sysvinit is supported, but systemd too) [INIT.D] elasticsearch fails if startup script is not executable\r\n08:14:01 ok 209 # skip (sysvinit is supported, but systemd too) [INIT.D] elasticsearch fails if startup script is not executable\r\n08:14:01 ok 210 # skip (sysvinit is supported, but systemd too) [INIT.D] daemon isn't enabled on restart\r\n08:14:01 ok 210 # skip (sysvinit is supported, but systemd too) [INIT.D] daemon isn't enabled on restart\r\n08:14:01 ok 211 # skip (sysvinit is supported, but systemd too) [INIT.D] start\r\n08:14:01 ok 211 # skip (sysvinit is supported, but systemd too) [INIT.D] start\r\n08:14:02 ok 212 # skip (sysvinit is supported, but systemd too) [INIT.D] status (running)\r\n08:14:02 ok 212 # skip (sysvinit is supported, but systemd too) [INIT.D] status (running)\r\n08:14:02 ok 213 # skip (sysvinit is supported, but systemd too) [INIT.D] test elasticsearch\r\n08:14:02 ok 213 # skip (sysvinit is supported, but systemd too) [INIT.D] test elasticsearch\r\n08:14:02 ok 214 # skip (sysvinit is supported, but systemd too) [INIT.D] restart\r\n08:14:02 ok 214 # skip (sysvinit is supported, but systemd too) [INIT.D] restart\r\n08:14:02 ok 215 # skip (sysvinit is supported, but systemd too) [INIT.D] stop (running)\r\n08:14:02 ok 215 # skip (sysvinit is supported, but systemd too) [INIT.D] stop (running)\r\n08:14:02 ok 216 # skip (sysvinit is supported, but systemd too) [INIT.D] status (stopped)\r\n08:14:02 ok 216 # skip (sysvinit is supported, but systemd too) [INIT.D] status (stopped)\r\n08:14:02 ok 217 # skip (sysvinit is supported, but systemd too) [INIT.D] start Elasticsearch with custom JVM options\r\n08:14:02 ok 217 # skip (sysvinit is supported, but systemd too) [INIT.D] start Elasticsearch with custom JVM options\r\n08:14:02 ok 218 # skip (sysvinit is supported, but systemd too) [INIT.D] delete PID_DIR and restart\r\n08:14:02 ok 218 # skip (sysvinit is supported, but systemd too) [INIT.D] delete PID_DIR and restart\r\n08:14:02 ok 219 # skip (sysvinit is supported, but systemd too) [INIT.D] GC logs exist\r\n08:14:02 ok 219 # skip (sysvinit is supported, but systemd too) [INIT.D] GC logs exist\r\n08:14:02 ok 220 # skip (sysvinit is supported, but systemd too) [INIT.D] sysctl is run when the value set is too small\r\n08:14:02 ok 220 # skip (sysvinit is supported, but systemd too) [INIT.D] sysctl is run when the value set is too small\r\n08:14:02 ok 221 # skip (sysvinit is supported, but systemd too) [INIT.D] sysctl is not run when it already has a larger or equal value set\r\n08:14:02 ok 221 # skip (sysvinit is supported, but systemd too) [INIT.D] sysctl is not run when it already has a larger or equal value set\r\n08:14:02 ok 222 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] install old version\r\n08:14:02 ok 222 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] install old version\r\n08:14:02 ok 223 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] start old version\r\n08:14:02 ok 223 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] start old version\r\n08:14:02 ok 224 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] check elasticsearch version is old version\r\n08:14:02 ok 224 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] check elasticsearch version is old version\r\n08:14:02 ok 225 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] index some documents into a few indexes\r\n08:14:02 ok 225 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] index some documents into a few indexes\r\n08:14:02 ok 226 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] verify that the documents are there\r\n08:14:02 ok 226 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] verify that the documents are there\r\n08:14:02 ok 227 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] stop old version\r\n08:14:02 ok 227 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] stop old version\r\n08:14:02 ok 228 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] install version under test\r\n08:14:02 ok 228 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] install version under test\r\n08:14:02 ok 229 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] start version under test\r\n08:14:02 ok 229 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] start version under test\r\n08:14:02 ok 230 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] check elasticsearch version is version under test\r\n08:14:02 ok 230 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] check elasticsearch version is version under test\r\n08:14:03 ok 231 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] verify that the documents are there after restart\r\n08:14:03 ok 231 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] verify that the documents are there after restart\r\n08:14:03 ok 232 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] stop version under test\r\n08:14:03 ok 232 # skip (upgrade cannot happen from pre 6.3.0 to elasticsearch-oss) [UPGRADE] stop version under test\r\n08:14:05 ok 233 [REINSTALL] install\r\n08:14:05 ok 234 [REINSTALL] purge elasticsearch\r\n08:14:05 ok 235 [REINSTALL] chown directories\r\n08:14:07 ok 236 [REINSTALL] reinstall elasticsearch\r\n08:14:07 ok 237 [REINSTALL] check ownership\r\n08:14:07 :qa:vagrant:vagrantOpensuse42#batsPackagingTest FAILED\r\n08:14:07 REPRODUCE WITH: ./gradlew :qa:vagrant:vagrantOpensuse42#batsPackagingTest -Dtests.seed=724533D49F2B2E52 \r\n08:14:07 :qa:vagrant:vagrantOpensuse42#batsPackagingTest (Thread[Task worker for ':' Thread 3,5,main]) completed. Took 13 mins 51.006 secs.\r\n08:14:07 :qa:vagrant:vagrantOpensuse42#halt (Thread[Task worker for ':' Thread 3,5,main]) started.\r\n08:14:07 :qa:vagrant:vagrantOpensuse42#halt\r\n08:14:07 Task ':qa:vagrant:vagrantOpensuse42#halt' is not up-to-date because:\r\n08:14:07   Task has not declared any outputs.\r\n08:14:07 Starting process 'command 'vagrant''. Working directory: /var/lib/jenkins/workspace/elastic+elasticsearch+6.3+packaging-tests/qa/vagrant Command: vagrant halt opensuse-42\r\n08:14:07 Successfully started process 'command 'vagrant''\r\n08:14:08 ==> opensuse-42: Removing cache buckets symlinks...\r\n08:14:10 ==> opensuse-42: Attempting graceful shutdown of VM...\r\n08:14:20 :qa:vagrant:vagrantOpensuse42#halt (Thread[Task worker for ':' Thread 3,5,main]) completed. Took 12.102 secs.\r\n08:14:20 \r\n08:14:20 \r\n08:14:20 FAILURE: Build failed with an exception.\r\n08:14:20 Deprecated Gradle features were used in this build, making it incompatible with Gradle 5.0.\r\n08:14:20 See https://docs.gradle.org/4.5/userguide/command_line_interface.html#sec:command_line_warnings\r\n08:14:20 \r\n08:14:20 393 actionable tasks: 392 executed, 1 up-to-date\r\n08:14:20 * What went wrong:\r\n08:14:20 Execution failed for task ':qa:vagrant:vagrantOpensuse42#batsPackagingTest'.\r\n08:14:20 > Process 'command 'vagrant'' finished with non-zero exit value 1\r\n```","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}