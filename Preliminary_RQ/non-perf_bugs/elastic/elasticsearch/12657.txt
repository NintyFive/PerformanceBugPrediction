{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12657","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12657/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12657/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12657/events","html_url":"https://github.com/elastic/elasticsearch/issues/12657","id":99062186,"node_id":"MDU6SXNzdWU5OTA2MjE4Ng==","number":12657,"title":"Throw An Error For Missing or Bad Config Values for AWS-Cloud Plugin","user":{"login":"hjc","id":1062500,"node_id":"MDQ6VXNlcjEwNjI1MDA=","avatar_url":"https://avatars3.githubusercontent.com/u/1062500?v=4","gravatar_id":"","url":"https://api.github.com/users/hjc","html_url":"https://github.com/hjc","followers_url":"https://api.github.com/users/hjc/followers","following_url":"https://api.github.com/users/hjc/following{/other_user}","gists_url":"https://api.github.com/users/hjc/gists{/gist_id}","starred_url":"https://api.github.com/users/hjc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hjc/subscriptions","organizations_url":"https://api.github.com/users/hjc/orgs","repos_url":"https://api.github.com/users/hjc/repos","events_url":"https://api.github.com/users/hjc/events{/privacy}","received_events_url":"https://api.github.com/users/hjc/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-08-04T21:05:22Z","updated_at":"2018-02-14T13:46:21Z","closed_at":"2015-08-05T15:56:07Z","author_association":"NONE","active_lock_reason":null,"body":"I ran into a stack trace today that referenced an [old issue](https://github.com/elastic/elasticsearch-cloud-aws/issues/31#issuecomment-127756166) related to the `aws-cloud` plugin. The issue basically boils down to this: I had `cloud.aws.secret` as my config value and not `cloud.aws.secret_key` (the latter is correct).\n\nNow, elasticsearch failed to boot (as one would expect), but the main issue was the error message it gave me on boot failure did not clearly indicate that I had bad or missing config values. It just referenced proxy objects and circular references. It took me a good deal of tinkering in my config to figure out my root cause.\n\nNow, what do I think can be done about this? In my opinion, a very nice feature to add to the AWS-Cloud plugin would be something that verifies that the given config values for the `cloud.aws` namespace are all present and correct. In my scenario, it would have noticed that `cloud.aws.access_key` was set, but `cloud.aws.secret_key` was not, and would have thrown an error indicating just that, which would have saved me 10-20 minutes.\n\nHowever, I think this can be taken a step **further** and a new feature could be added to elasticsearch itself that would make this even easier. This new feature would basically amount to throwing an error any time an unknown config value is encountered. So, in my case, an error would be thrown because neither elasticsearch, or any of its installed plugins, has `cloud.aws.secret` listed as a valid config value. This would have alerted me to my issue almost immediately and would have been a wonderful user experience that would have made DevOps faster, and more pleasant. Basically, the way I envision this working, is that elasticsearch would have its own set of allowed config values and then all ES plugins installed are also allowed to have a set of allowed config values; upon boot, ES parses it's config file and references every key found with itself and its plugins, and then throws an error the second it finds an unknown key. \n\nTo me, the former is merely an improvement to the `cloud-aws` plugin, but the latter is an actual elasticsearch improvement that should make DevOps management of elasticsearch easier in general (no more guessing about the validity of your config; if you put in a bum key name, elasticsearch just doesn't boot). Extrapolating on all of this, adding another runnable to `bin` that validates an elasticsearch config, ensuring all keys present are expected keys with valid values, would be pretty great too. That tool could then be integrated into more elaborate build systems, such as Jenkins, to verify the validity of any new ES configs before deploying them (though I'm not sure how many people regularly edit their ES configs and deploy those through some sort of CI process).\n\nIf any of this is unclear, or there are any questions, I am more than happy to answer them.\n\nThe comment that started this whole thing, and what prompted David to refer me to create this issue can be found [here](https://github.com/elastic/elasticsearch-cloud-aws/issues/31#issuecomment-127754817).\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}