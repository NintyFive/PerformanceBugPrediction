{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17076","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17076/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17076/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17076/events","html_url":"https://github.com/elastic/elasticsearch/issues/17076","id":140237708,"node_id":"MDU6SXNzdWUxNDAyMzc3MDg=","number":17076,"title":"per_field_analyzer in term vectors api should work even if field does not store term vectors","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"assignees":[{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2016-03-11T17:04:41Z","updated_at":"2018-03-20T21:21:53Z","closed_at":"2018-03-20T21:21:53Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Tested with elasticsearch version 2.2\n\nThe purpose of `per_field_analyzer` is to get a term vector as created by an analyzer different from the one the field is indexed with. I would expect to get a term vector for a field even if it does not have term vectors stored. Instead I get an NPE:\n\n```\n\nPOST test/doc/1\n{\n  \"text\": \"I am a happy hippo\"\n}\n\n\nGET  test/doc/1/_termvectors\n{\n  \"per_field_analyzer\": {\n    \"text\": \"keyword\"\n  }\n}\n```\n\nIf I set `\"term_vector\": \"yes\"`, in the mapping first all works as expected:\n\n```\nPUT test \n{\n  \"mappings\": {\n    \"doc\": {\n      \"properties\": {\n        \"text\": {\n          \"term_vector\": \"yes\",\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n\nPOST test/doc/1\n{\n  \"text\": \"I am a happy hippo\"\n}\n\nGET  test/doc/1/_termvectors\n{\n  \"per_field_analyzer\": {\n    \"text\": \"keyword\"\n  }\n}\n```\n\nresults in (as expected): \n\n```\n{\n  \"_index\": \"test\",\n  \"_type\": \"doc\",\n  \"_id\": \"1\",\n  \"_version\": 1,\n  \"found\": true,\n  \"took\": 1,\n  \"term_vectors\": {\n    \"text\": {\n      \"field_statistics\": {\n        \"sum_doc_freq\": 5,\n        \"doc_count\": 1,\n        \"sum_ttf\": 5\n      },\n      \"terms\": {\n        \"I am a happy hippo\": {\n          \"term_freq\": 1,\n          \"tokens\": [\n            {\n              \"position\": 0,\n              \"start_offset\": 0,\n              \"end_offset\": 18\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n```\n","closed_by":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"performed_via_github_app":null}