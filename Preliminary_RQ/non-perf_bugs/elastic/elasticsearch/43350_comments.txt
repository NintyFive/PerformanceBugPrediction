[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/503315346","html_url":"https://github.com/elastic/elasticsearch/issues/43350#issuecomment-503315346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43350","id":503315346,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzMxNTM0Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-06-18T21:16:52Z","updated_at":"2019-06-18T21:16:52Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/507025760","html_url":"https://github.com/elastic/elasticsearch/issues/43350#issuecomment-507025760","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43350","id":507025760,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzAyNTc2MA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-06-30T10:39:51Z","updated_at":"2019-06-30T10:39:51Z","author_association":"CONTRIBUTOR","body":"Thanks for the suggestion @vigyasharma. You've clearly put some effort into this idea. We discussed this recently as a team and drew two conclusions:\r\n\r\n1. We do not want to weaken the hard `*.routing.allocation.total_shards_per_node` limits. These limits are for users who know that each node would fail with more than a certain number of shards, so ignoring these limits would result in a cascade of failures.\r\n\r\n2. You have not provided enough surrounding context to judge its other merits.\r\n\r\nTo expand on this second point, it sounds like you might be misusing the `total_shards_per_node` settings, and the problem you describe might be addressed by setting them appropriately. If you are setting `total_shards_per_node: N` but in fact your nodes can tolerate more than `N` shards then you should be setting this limit higher. Also if you are heavily indexing into an index (necessitating the `total_shards_per_node` setting) but then stopping the heavy indexing later then you should also be relaxing or even removing the `total_shards_per_node` setting on this index to reflect the change in resource constraints. It is normal for the resource constraints on an index to change over time as its access pattern changes, and adjusting settings like `total_shards_per_node` to reflect this will allow the balancer to do its job properly. This would be the case if, for instance, you are using time-based indices to collect logs.\r\n\r\nWould you please describe your cluster and its configuration in significantly more detail? Also, would you prepare a failing test case (e.g. an `ESAllocationTestCase`) that reflects the configuration of your cluster and that your proposal would fix?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/512241865","html_url":"https://github.com/elastic/elasticsearch/issues/43350#issuecomment-512241865","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43350","id":512241865,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjI0MTg2NQ==","user":{"login":"vigyasharma","id":869395,"node_id":"MDQ6VXNlcjg2OTM5NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/869395?v=4","gravatar_id":"","url":"https://api.github.com/users/vigyasharma","html_url":"https://github.com/vigyasharma","followers_url":"https://api.github.com/users/vigyasharma/followers","following_url":"https://api.github.com/users/vigyasharma/following{/other_user}","gists_url":"https://api.github.com/users/vigyasharma/gists{/gist_id}","starred_url":"https://api.github.com/users/vigyasharma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vigyasharma/subscriptions","organizations_url":"https://api.github.com/users/vigyasharma/orgs","repos_url":"https://api.github.com/users/vigyasharma/repos","events_url":"https://api.github.com/users/vigyasharma/events{/privacy}","received_events_url":"https://api.github.com/users/vigyasharma/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T12:55:19Z","updated_at":"2019-07-17T12:55:19Z","author_association":"CONTRIBUTOR","body":"Thanks @DaveCTurner for discussing this with the team, and apologies for the delay in response (I was on a vacation).\r\n\r\nI don't think this should weaken the `total_shards_per_node` limits. That decider remains untouched for advanced customers to use. \r\n\r\nLet me provide more context on where this change helps.\r\n\r\nThe problem with `*.routing.allocation.total_shards_per_node` is that you need full context around all indexes and overall cluster workload, to reason about `shards_per_node` limits. Several large organizations have different teams owning a set of indices in a shared cluster. The cluster itself may be managed by a central admin team, while index creations and settings are owned by each index owner team.\r\n\r\nIn such scenarios, overall cluster workload may go down due to one team scaling down their traffic, while other teams are still unaware of these changes. This makes *revising* the setting at index level non trivial and a cluster management overhead.\r\n\r\nMost users add this setting at index level to avoid collocating shards on one node during node replacements and new node additions (i.e. the workaround to problem addressed in this issue). If shard balancer can **handle this implicitly**, it removes the cognitive and management overhead of setting or revising these limits.\r\n\r\nAdmins can scale down their fleet if net workload is reduced without individual indexes getting impacted.\r\n```\r\ne.g. Say an index has 10 shards in an index and there are 6 nodes in the cluster\r\n\r\nTo be resilient to 2 node failures with max index spread: \r\n    index.routing.allocation.total_shards_per_node = 3\r\n\r\nBut if the admin reduces the cluster to 4 nodes, the setting must be revised to 5\r\nSimilarly, the cluster can't be scaled down to 3 nodes without making it yellow.\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/512346606","html_url":"https://github.com/elastic/elasticsearch/issues/43350#issuecomment-512346606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43350","id":512346606,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjM0NjYwNg==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T16:05:05Z","updated_at":"2019-07-17T16:05:05Z","author_association":"CONTRIBUTOR","body":"Welcome back @vigyasharma, hope you had a good break. \r\n\r\nThe concerns you describe are broadly addressed by the plan for finer-grained constraints laid out in https://github.com/elastic/elasticsearch/issues/17213#issuecomment-383974707 and (as I commented there in reply to you a few months back) predicting the constraints dynamically is out of scope for now. Let's walk before we start to try and run, and let's try and keep this conversation focussed on this particular issue.\r\n\r\nJust a reminder that we're waiting for more details about your proposal:\r\n\r\n> Would you please describe your cluster and its configuration in significantly more detail? Also, would you prepare a failing test case (e.g. an `ESAllocationTestCase`) that reflects the configuration of your cluster and that your proposal would fix?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/524830284","html_url":"https://github.com/elastic/elasticsearch/issues/43350#issuecomment-524830284","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43350","id":524830284,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNDgzMDI4NA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-08-26T11:52:18Z","updated_at":"2019-08-26T11:52:18Z","author_association":"CONTRIBUTOR","body":"Closing this as no further details were provided.","performed_via_github_app":null}]