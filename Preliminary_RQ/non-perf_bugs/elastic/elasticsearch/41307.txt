{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41307","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41307/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41307/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41307/events","html_url":"https://github.com/elastic/elasticsearch/issues/41307","id":434311121,"node_id":"MDU6SXNzdWU0MzQzMTExMjE=","number":41307,"title":"Timeout for primary relocation handoff seems too long","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-04-17T14:21:32Z","updated_at":"2019-10-02T13:57:26Z","closed_at":"2019-10-02T13:57:26Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Today we wait for 30 minutes to block all operations when performing a primary relocation handoff:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/4bd8e7b9f49ed091a53ce2717d65dc0ecb77b8d8/server/src/main/java/org/elasticsearch/index/shard/IndexShard.java#L636\r\n\r\nHowever this behaves badly if a write task gets stuck, for instance in the case fixed in https://github.com/elastic/elasticsearch/pull/36770. The effect is that the block cannot be put in place (because there is an in-flight operation) but the pending block prevents any further operations from taking place until it eventually fails.\r\n\r\nI think we should consider reducing this timeout, because it seems preferable to fail the primary relocation (and therefore resume write operations) much sooner than 30 minutes.","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}