{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7817","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7817/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7817/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7817/events","html_url":"https://github.com/elastic/elasticsearch/issues/7817","id":43476890,"node_id":"MDU6SXNzdWU0MzQ3Njg5MA==","number":7817,"title":"search + highlight + sorting -> missing results","user":{"login":"mfolnovic","id":20919,"node_id":"MDQ6VXNlcjIwOTE5","avatar_url":"https://avatars3.githubusercontent.com/u/20919?v=4","gravatar_id":"","url":"https://api.github.com/users/mfolnovic","html_url":"https://github.com/mfolnovic","followers_url":"https://api.github.com/users/mfolnovic/followers","following_url":"https://api.github.com/users/mfolnovic/following{/other_user}","gists_url":"https://api.github.com/users/mfolnovic/gists{/gist_id}","starred_url":"https://api.github.com/users/mfolnovic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mfolnovic/subscriptions","organizations_url":"https://api.github.com/users/mfolnovic/orgs","repos_url":"https://api.github.com/users/mfolnovic/repos","events_url":"https://api.github.com/users/mfolnovic/events{/privacy}","received_events_url":"https://api.github.com/users/mfolnovic/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"assignees":[{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2014-09-22T12:47:46Z","updated_at":"2014-11-08T16:14:57Z","closed_at":"2014-11-08T16:14:57Z","author_association":"NONE","active_lock_reason":null,"body":"Hi!\n\nI'm experiencing a weird issue with highlighting. \n\nWhen I execute search with highlighting on, I'm getting different number of results based on which sort I choose.\n\nIf I run this command (no highlighting, size 500), I'm always getting 500:\n\n```\ncurl -XGET 'http://localhost:9200/_all/_search?pretty' -d '{\n  \"query\": {     \n    \"filtered\": {\n      \"query\": {\n        \"bool\": {\n          \"should\": [\n            {\n              \"query_string\": {\n                \"query\": \"*\",\n                \"fields\": [\n                  \"text\"\n                ]\n              }\n            }\n          ]\n        }\n      },\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"match_all\": {}\n            }\n          ]\n        }\n      }\n    }\n  },\n  \"size\": 500,\n  \"sort\": [\n    {\n      \"@timestamp\": {\n        \"order\": \"asc\",\n        \"ignore_unmapped\": true\n      }\n    }\n  ]\n}' | grep '_source' | wc -l\n```\n\nBut, if I run this command (highlighting, size 500), I'm always getting <500 (always the same, 421 for my data):\n\n```\ncurl -XGET 'http://localhost:9200/_all/_search?pretty' -d '{\n  \"query\": {     \n    \"filtered\": {\n      \"query\": {\n        \"bool\": {\n          \"should\": [\n            {\n              \"query_string\": {\n                \"query\": \"*\",\n                \"fields\": [\n                  \"text\"\n                ]\n              }\n            }\n          ]\n        }\n      },\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"match_all\": {}\n            }\n          ]\n        }\n      }\n    }\n  },\n  \"highlight\": {\n    \"fields\": {\n      \"text\": {}\n    },\n    \"fragment_size\": 100,\n    \"pre_tags\": [\n      \"@start-highlight@\"\n    ],\n    \"post_tags\": [\n      \"@end-highlight@\"\n    ]\n  },\n  \"size\": 500,\n  \"sort\": [\n    {\n      \"@timestamp\": {\n        \"order\": \"asc\",\n        \"ignore_unmapped\": true\n      }\n    }\n  ]\n}' | grep '_source' | wc -l\n```\n\nIf I choose some other sort (desc, or other column), I'll get different number. Of course, there are cases when I get 500.\n\nYou can see that those queries were generated by Kibana, but I'm running those directly on ES - so it's not a problem in Kibana. I read documentation and couldn't conclude that this query is invalid - sorry if it is, and it's Kibana bug.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}