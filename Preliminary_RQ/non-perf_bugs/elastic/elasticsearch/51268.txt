{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51268","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51268/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51268/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51268/events","html_url":"https://github.com/elastic/elasticsearch/issues/51268","id":553102644,"node_id":"MDU6SXNzdWU1NTMxMDI2NDQ=","number":51268,"title":"[CI] Java8 with FIPS, 7.x PreBuiltXPackTransportClientTests testPluginInstalled failure","user":{"login":"williamrandolph","id":3253644,"node_id":"MDQ6VXNlcjMyNTM2NDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/3253644?v=4","gravatar_id":"","url":"https://api.github.com/users/williamrandolph","html_url":"https://github.com/williamrandolph","followers_url":"https://api.github.com/users/williamrandolph/followers","following_url":"https://api.github.com/users/williamrandolph/following{/other_user}","gists_url":"https://api.github.com/users/williamrandolph/gists{/gist_id}","starred_url":"https://api.github.com/users/williamrandolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/williamrandolph/subscriptions","organizations_url":"https://api.github.com/users/williamrandolph/orgs","repos_url":"https://api.github.com/users/williamrandolph/repos","events_url":"https://api.github.com/users/williamrandolph/events{/privacy}","received_events_url":"https://api.github.com/users/williamrandolph/received_events","type":"User","site_admin":false},"labels":[{"id":912838879,"node_id":"MDU6TGFiZWw5MTI4Mzg4Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Security","name":":Security/Security","color":"0e8a16","default":false,"description":"Security issues without another label"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1967499607,"node_id":"MDU6TGFiZWwxOTY3NDk5NjA3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Security","name":"Team:Security","color":"fef2c0","default":false,"description":"Meta label for security team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2020-01-21T20:12:17Z","updated_at":"2020-10-07T19:52:11Z","closed_at":"2020-10-07T19:52:11Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Example build failure\r\n\r\nBuild scan: https://gradle-enterprise.elastic.co/s/x2lhlum73adfw\r\nJenkins job: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+matrix-java-periodic/ES_BUILD_JAVA=openjdk13,ES_RUNTIME_JAVA=java8fips,nodes=general-purpose/464/\r\n\r\n## Reproduction line\r\nThere's no reproduction line, but this does reproduce locally if you follow the setup instructions [from the dev wiki](https://github.com/elastic/elasticsearch-team/blob/master/onboarding-and-how-we-work/test-triage.md#test-triage-for-java-8-fips-jvm-failures):\r\n```\r\nJAVA_HOME=$JAVA13_HOME ./gradlew :x-pack:transport-client:test -Druntime.java=8FIPS -Djavax.net.ssl.keyStorePassword=password -Djavax.net.ssl.trustStorePassword=password\r\n\r\n```\r\n\r\nThis failure reproduces on the `7.6` branch, but not on the `7.5` branch. This may have something to do with 7.6 requiring Java 13 for Java Home while 7.5 only requires Java 12.\r\n\r\n## Example relevant log:\r\n```\r\norg.elasticsearch.xpack.client.PreBuiltXPackTransportClientTests > testPluginInstalled FAILED\r\n    java.lang.RuntimeException: ElasticsearchSecurityException[failed to load SSL configuration [xpack.security.http.ssl]]; nested: ElasticsearchException[failed to initialize the SSLContext]; nested: KeyManagementException[FIPS mode: only SunJSSE TrustManagers may be used];\r\n        at __randomizedtesting.SeedInfo.seed([A420D36ED63916A5:AC87BDE1BD2C343B]:0)\r\n        at org.elasticsearch.xpack.core.XPackClientPlugin.getTransports(XPackClientPlugin.java:676)\r\n        at org.elasticsearch.common.network.NetworkModule.<init>(NetworkModule.java:128)\r\n        at org.elasticsearch.client.transport.TransportClient.buildTemplate(TransportClient.java:198)\r\n        at org.elasticsearch.client.transport.TransportClient.<init>(TransportClient.java:296)\r\n        at org.elasticsearch.transport.client.PreBuiltTransportClient.<init>(PreBuiltTransportClient.java:130)\r\n        at org.elasticsearch.xpack.client.PreBuiltXPackTransportClient.<init>(PreBuiltXPackTransportClient.java:47)\r\n        at org.elasticsearch.xpack.client.PreBuiltXPackTransportClient.<init>(PreBuiltXPackTransportClient.java:42)\r\n        at org.elasticsearch.xpack.client.PreBuiltXPackTransportClient.<init>(PreBuiltXPackTransportClient.java:38)\r\n        at org.elasticsearch.xpack.client.PreBuiltXPackTransportClientTests.testPluginInstalled(PreBuiltXPackTransportClientTests.java:24)\r\n\r\n        Caused by:\r\n        ElasticsearchSecurityException[failed to load SSL configuration [xpack.security.http.ssl]]; nested: ElasticsearchException[failed to initialize the SSLContext]; nested: KeyManagementException[FIPS mode: only SunJSSE TrustManagers may be used];\r\n            at org.elasticsearch.xpack.core.ssl.SSLService.loadConfiguration(SSLService.java:527)\r\n            at org.elasticsearch.xpack.core.ssl.SSLService.lambda$loadSSLConfigurations$4(SSLService.java:500)\r\n            at java.util.HashMap.forEach(HashMap.java:1289)\r\n            at org.elasticsearch.xpack.core.ssl.SSLService.loadSSLConfigurations(SSLService.java:500)\r\n            at org.elasticsearch.xpack.core.ssl.SSLService.<init>(SSLService.java:145)\r\n            at org.elasticsearch.xpack.core.XPackClientPlugin.getTransports(XPackClientPlugin.java:674)\r\n            ... 8 more\r\n\r\n            Caused by:\r\n            ElasticsearchException[failed to initialize the SSLContext]; nested: KeyManagementException[FIPS mode: only SunJSSE TrustManagers may be used];\r\n                at org.elasticsearch.xpack.core.ssl.SSLService.createSslContext(SSLService.java:456)\r\n                at org.elasticsearch.xpack.core.ssl.SSLService.createSslContext(SSLService.java:432)\r\n                at java.util.HashMap.computeIfAbsent(HashMap.java:1127)\r\n                at org.elasticsearch.xpack.core.ssl.SSLService.loadConfiguration(SSLService.java:524)\r\n                ... 13 more\r\n\r\n                Caused by:\r\n                java.security.KeyManagementException: FIPS mode: only SunJSSE TrustManagers may be used\r\n                    at sun.security.ssl.SSLContextImpl.chooseTrustManager(SSLContextImpl.java:120)\r\n                    at sun.security.ssl.SSLContextImpl.engineInit(SSLContextImpl.java:83)\r\n                    at javax.net.ssl.SSLContext.init(SSLContext.java:282)\r\n                    at org.elasticsearch.xpack.core.ssl.SSLService.createSslContext(SSLService.java:449)\r\n                    ... 16 more\r\n\r\n```\r\n\r\n## Frequency\r\nThe 7.x FIPS Java matrix tests have been failing since at least December 11th. Since these tests run twice per day, there have been 82 failures on the record. 38 of these failures involve `testPluginInstalled`.","closed_by":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"performed_via_github_app":null}