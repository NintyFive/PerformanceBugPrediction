[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/195074802","html_url":"https://github.com/elastic/elasticsearch/issues/17058#issuecomment-195074802","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17058","id":195074802,"node_id":"MDEyOklzc3VlQ29tbWVudDE5NTA3NDgwMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-10T22:13:23Z","updated_at":"2016-03-10T22:13:50Z","author_association":"MEMBER","body":"This can already be done today with `ES_JAVA_OPTS`:\n\n```\n$ ES_JAVA_OPTS=\"-XX:-HeapDumpOnOutOfMemoryError\" ./bin/elasticsearch\n```\n\nLet's verify:\n\n```\n$ ./bin/elasticsearch\n```\n\nThen from another shell:\n\n``` bash\n$ curl -sS -XGET localhost:9200/_nodes | jq '.. | .pid? | select(. != null)'\n39947\n$ jcmd 39947 VM.flags | tr ' ' '\\n' | grep HeapDumpOnOutOfMemoryError\n-XX:+HeapDumpOnOutOfMemoryError\n```\n\nshowing that `HeapDumpOnOutOfMemoryError` is enabled. Now with `ES_JAVA_OPTS`:\n\n```\n$ ES_JAVA_OPTS=\"-XX:-HeapDumpOnOutOfMemoryError\" ./bin/elasticsearch\n```\n\nand from another shell:\n\n``` bash\n$ curl -sS -XGET localhost:9200/_nodes | jq '.. | .pid? | select(. != null)'\n40671\n$ jcmd 40671 VM.flags | tr ' ' '\\n' | grep HeapDumpOnOutOfMemoryError\n-XX:-HeapDumpOnOutOfMemoryError\n```\n\nshowing that `HeapDumpOnOutOfMemoryError` is disabled.\n\nUsing `ES_JAVA_OPTS` just causes the flag to be on the command line twice, but the `ES_JAVA_OPTS` flags come last so they win.\n\nI must say this though: if the heap is dumping so frequently that the heap dumping taking a long time is an issue, this is just a _symptom_ of a problem, not the true problem. The true problem is that the heap is dumping all the time, and that is what should be solved, not that the heaps take a long time to dump. And if you want to solve the heap dumping all the time, it helps having heap dumps to look at to find out why! So, using this flag is taking away information that can be used to solve the true problem.\n","performed_via_github_app":null}]