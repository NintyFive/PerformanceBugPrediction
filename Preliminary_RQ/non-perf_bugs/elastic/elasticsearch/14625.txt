{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14625","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14625/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14625/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14625/events","html_url":"https://github.com/elastic/elasticsearch/issues/14625","id":115911755,"node_id":"MDU6SXNzdWUxMTU5MTE3NTU=","number":14625,"title":"Disruption rules in MockTransportService should match all bound addresses of a node","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"labels":[{"id":146854632,"node_id":"MDU6TGFiZWwxNDY4NTQ2MzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Network","name":":Distributed/Network","color":"0e8a16","default":false,"description":"Http and internode communication implementations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-11-09T16:22:37Z","updated_at":"2015-11-12T16:22:32Z","closed_at":"2015-11-12T16:22:32Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Currently, disruption rules apply only to the main bound address of a node. As consequence, integration tests that use Network Partitions must currently ensure that nodes are bound to a single local interface (e.g. 127.0.0.1 / IPv4) in order to correctly work. This is ugly as it requires setting `network.host` explicitly to `127.0.0.1` in all such tests.\n\nImplementation details:\nUnicastZenPing creates fake DiscoveryNode for each local network interface. If multiple interfaces are active, it creates one for IPv4 and one for IPv6 for each node. To add disruptions, MockTransportService provides methods that take as parameter a node to disrupt, but this only adds disruptions rules that match on the main bound address `DiscoveryNode.address()` of the node. This means that no rules exist to intercept connections trough other bound addresses.\n\nSolution:\nDisruption rules in MockTransportService should match all bound addresses of a node.\n\nAs future enhancement, the interface of MockTransportService / NetworkPartition could also be expanded so that disruptions can be specified directly on a per TransportAddress level. This provides more fine-granular testing possibilities (where connection over one interface works but the other not).\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}