{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28167","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28167/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28167/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28167/events","html_url":"https://github.com/elastic/elasticsearch/issues/28167","id":287358035,"node_id":"MDU6SXNzdWUyODczNTgwMzU=","number":28167,"title":"[Jenkins] Failure in org.elasticsearch.index.engine.InternalEngineTests.testTranslogReplayWithFailure","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"assignees":[{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-01-10T08:53:13Z","updated_at":"2018-02-13T20:26:26Z","closed_at":"2018-01-26T17:03:19Z","author_association":"MEMBER","active_lock_reason":null,"body":"Failed on 6.x: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-unix-compatibility/os=amazon/521/console\r\n\r\nReproduce command (reproduces locally for me):\r\n```\r\n./gradlew :core:test -Dtests.seed=5AB1CBA8567E99FC -Dtests.class=org.elasticsearch.index.engine.InternalEngineTests -Dtests.method=\"testTranslogReplayWithFailure\" -Dtests.security.manager=true -Dtests.locale=he -Dtests.timezone=Atlantic/Reykjavik\r\n```\r\n\r\nException:\r\n```\r\nERROR   1.13s | InternalEngineTests.testTranslogReplayWithFailure <<< FAILURES!\r\n   > Throwable #1: [index][[index][0]] FlushFailedEngineException[Flush failed]; nested: CorruptIndexException[failed engine (reason: [refresh failed source[version_table_flush]]) (resource=preexisting_corruption)]; nested: IOException[failed engine (reason: [refresh failed source[version_table_flush]])]; nested: CorruptIndexException[Problem reading index from store(MockDirectoryWrapper(RAMDirectory@4bec077e lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@62757fd8)) (resource=store(MockDirectoryWrapper(RAMDirectory@4bec077e lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@62757fd8)))]; nested: FileNotFoundException[a random IOException (_1.cfs)];\r\n   >    at __randomizedtesting.SeedInfo.seed([5AB1CBA8567E99FC:B360CB91E358DFA1]:0)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.refreshLastCommittedSegmentInfos(InternalEngine.java:1558)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.flush(InternalEngine.java:1520)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.recoverFromTranslogInternal(InternalEngine.java:458)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.recoverFromTranslog(InternalEngine.java:394)\r\n   >    at org.elasticsearch.index.engine.EngineTestCase.createEngine(EngineTestCase.java:341)\r\n   >    at org.elasticsearch.index.engine.EngineTestCase.createEngine(EngineTestCase.java:302)\r\n   >    at org.elasticsearch.index.engine.EngineTestCase.createEngine(EngineTestCase.java:291)\r\n   >    at org.elasticsearch.index.engine.EngineTestCase.createEngine(EngineTestCase.java:260)\r\n   >    at org.elasticsearch.index.engine.InternalEngineTests.testTranslogReplayWithFailure(InternalEngineTests.java:2430)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:564)\r\n   >    at java.base/java.lang.Thread.run(Thread.java:844)\r\n   > Caused by: org.apache.lucene.index.CorruptIndexException: failed engine (reason: [refresh failed source[version_table_flush]]) (resource=preexisting_corruption)\r\n   >    at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:635)\r\n   >    at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:615)\r\n   >    at org.elasticsearch.index.store.Store.readCommittedSegmentsInfo(Store.java:193)\r\n   >    at org.elasticsearch.index.store.Store.readLastCommittedSegmentsInfo(Store.java:185)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.refreshLastCommittedSegmentInfos(InternalEngine.java:1549)\r\n   >    ... 44 more\r\n   > Caused by: java.io.IOException: failed engine (reason: [refresh failed source[version_table_flush]])\r\n   >    at org.elasticsearch.index.engine.Engine.failEngine(Engine.java:914)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.refresh(InternalEngine.java:1392)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.flush(InternalEngine.java:1515)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.recoverFromTranslogInternal(InternalEngine.java:458)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.recoverFromTranslog(InternalEngine.java:394)\r\n   >    at org.elasticsearch.index.engine.EngineTestCase.createEngine(EngineTestCase.java:341)\r\n   >    at org.elasticsearch.index.engine.EngineTestCase.createEngine(EngineTestCase.java:302)\r\n   >    at org.elasticsearch.index.engine.EngineTestCase.createEngine(EngineTestCase.java:291)\r\n   >    at org.elasticsearch.index.engine.EngineTestCase.createEngine(EngineTestCase.java:260)\r\n   >    at org.elasticsearch.index.engine.InternalEngineTests.testTranslogReplayWithFailure(InternalEngineTests.java:2418)\r\n   >    at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.lang.Thread.run(Thread.java:844)\r\n   > Caused by: org.apache.lucene.index.CorruptIndexException: Problem reading index from store(MockDirectoryWrapper(RAMDirectory@4bec077e lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@62757fd8)) (resource=store(MockDirectoryWrapper(RAMDirectory@4bec077e lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@62757fd8)))\r\n   >    at org.apache.lucene.index.SegmentCoreReaders.<init>(SegmentCoreReaders.java:140)\r\n   >    at org.apache.lucene.index.SegmentReader.<init>(SegmentReader.java:78)\r\n   >    at org.apache.lucene.index.ReadersAndUpdates.getReader(ReadersAndUpdates.java:208)\r\n   >    at org.apache.lucene.index.ReadersAndUpdates.getReadOnlyClone(ReadersAndUpdates.java:258)\r\n   >    at org.apache.lucene.index.StandardDirectoryReader.open(StandardDirectoryReader.java:105)\r\n   >    at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:490)\r\n   >    at org.apache.lucene.index.StandardDirectoryReader.doOpenFromWriter(StandardDirectoryReader.java:293)\r\n   >    at org.apache.lucene.index.StandardDirectoryReader.doOpenIfChanged(StandardDirectoryReader.java:268)\r\n   >    at org.apache.lucene.index.StandardDirectoryReader.doOpenIfChanged(StandardDirectoryReader.java:258)\r\n   >    at org.apache.lucene.index.FilterDirectoryReader.doOpenIfChanged(FilterDirectoryReader.java:104)\r\n   >    at org.apache.lucene.index.DirectoryReader.openIfChanged(DirectoryReader.java:140)\r\n   >    at org.apache.lucene.search.SearcherManager.refreshIfNeeded(SearcherManager.java:156)\r\n   >    at org.apache.lucene.search.SearcherManager.refreshIfNeeded(SearcherManager.java:58)\r\n   >    at org.apache.lucene.search.ReferenceManager.doMaybeRefresh(ReferenceManager.java:176)\r\n   >    at org.apache.lucene.search.ReferenceManager.maybeRefreshBlocking(ReferenceManager.java:253)\r\n   >    at org.elasticsearch.index.engine.InternalEngine.refresh(InternalEngine.java:1382)\r\n   >    ... 44 more\r\n   > Caused by: java.io.FileNotFoundException: a random IOException (_1.cfs)\r\n   >    at org.apache.lucene.store.MockDirectoryWrapper.maybeThrowIOExceptionOnOpen(MockDirectoryWrapper.java:575)\r\n   >    at org.apache.lucene.store.MockDirectoryWrapper.openInput(MockDirectoryWrapper.java:744)\r\n   >    at org.apache.lucene.store.FilterDirectory.openInput(FilterDirectory.java:99)\r\n   >    at org.apache.lucene.codecs.lucene50.Lucene50CompoundReader.<init>(Lucene50CompoundReader.java:78)\r\n   >    at org.apache.lucene.codecs.lucene50.Lucene50CompoundFormat.getCompoundReader(Lucene50CompoundFormat.java:71)\r\n   >    at org.apache.lucene.index.SegmentCoreReaders.<init>(SegmentCoreReaders.java:99)\r\n   >    ... 59 more\r\n```","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}