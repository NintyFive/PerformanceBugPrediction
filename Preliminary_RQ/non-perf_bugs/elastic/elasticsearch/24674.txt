{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24674","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24674/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24674/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24674/events","html_url":"https://github.com/elastic/elasticsearch/issues/24674","id":228695117,"node_id":"MDU6SXNzdWUyMjg2OTUxMTc=","number":24674,"title":"500 and array index out of bounds exception returned in specific case","user":{"login":"steveodonovan","id":18128367,"node_id":"MDQ6VXNlcjE4MTI4MzY3","avatar_url":"https://avatars3.githubusercontent.com/u/18128367?v=4","gravatar_id":"","url":"https://api.github.com/users/steveodonovan","html_url":"https://github.com/steveodonovan","followers_url":"https://api.github.com/users/steveodonovan/followers","following_url":"https://api.github.com/users/steveodonovan/following{/other_user}","gists_url":"https://api.github.com/users/steveodonovan/gists{/gist_id}","starred_url":"https://api.github.com/users/steveodonovan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/steveodonovan/subscriptions","organizations_url":"https://api.github.com/users/steveodonovan/orgs","repos_url":"https://api.github.com/users/steveodonovan/repos","events_url":"https://api.github.com/users/steveodonovan/events{/privacy}","received_events_url":"https://api.github.com/users/steveodonovan/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-05-15T12:14:54Z","updated_at":"2018-03-22T17:28:48Z","closed_at":"2018-03-22T17:28:48Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version**:\r\n\r\n```\r\n\"version\": {\r\n    \"number\": \"5.3.0\",\r\n    \"build_hash\": \"3adb13b\",\r\n    \"build_date\": \"2017-03-23T03:31:50.652Z\",\r\n    \"build_snapshot\": false,\r\n    \"lucene_version\": \"6.4.1\"\r\n  }\r\n```\r\n\r\nreproducible on 5.4.0 but not on 5.2.0\r\n\r\n**Plugins installed**: [\r\nanalysis-icu,\r\nanalysis-kuromoji,\r\nanalysis-phonetic,\r\nanalysis-smartcn,\r\nanalysis-stempel,\r\nanalysis-ukrainian,\r\nmapper-attachments,\r\nmapper-size\r\n]\r\n\r\n**JVM version** (`java -version`): \r\n\r\n1.8.0_121\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nMacOS Sierra\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nA 500 is being returned with an array index out of bounds exception when running the query outlined below. (response and logs included)\r\n\r\nif I remove the following from the query it will pass.\r\n\r\n```\r\n       {\r\n          \"match_phrase_prefix\" : {\r\n            \"space_name.lowercase\" : {\r\n              \"query\" : \"Research\",\r\n              \"slop\" : 0,\r\n              \"max_expansions\" : 10,\r\n              \"boost\" : 5.0\r\n            }\r\n          }\r\n        },\r\n```\r\n\r\nSimilarly if I remove the highlighting from the query it also runs without error.\r\n\r\n**Steps to reproduce**:\r\n\r\nRunning the following query \r\n\r\n```\r\n{\r\n  \"size\" : 10,\r\n  \"query\" : {\r\n    \"bool\" : {\r\n      \"should\" : [\r\n        {\r\n          \"match_phrase\" : {\r\n            \"space_name\" : {\r\n              \"query\" : \"Research\",\r\n              \"slop\" : 10,\r\n              \"boost\" : 5.0\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"match_phrase_prefix\" : {\r\n            \"space_name.lowercase\" : {\r\n              \"query\" : \"Research\",\r\n              \"slop\" : 0,\r\n              \"max_expansions\" : 10,\r\n              \"boost\" : 5.0\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"match_phrase\" : {\r\n            \"space_name.partial_back\" : {\r\n              \"query\" : \"Research\",\r\n              \"slop\" : 10,\r\n              \"boost\" : 1.0\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"match_phrase\" : {\r\n            \"space_name.partial\" : {\r\n              \"query\" : \"Research\",\r\n              \"slop\" : 10,\r\n              \"boost\" : 1.0\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"match_phrase\" : {\r\n            \"space_name.partial_middle\" : {\r\n              \"query\" : \"Research\",\r\n              \"slop\" : 10,\r\n              \"boost\" : 1.0\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      \"disable_coord\" : false,\r\n      \"adjust_pure_negative\" : true,\r\n      \"minimum_should_match\" : \"1\",\r\n      \"boost\" : 1.0\r\n    }\r\n  },\r\n  \"highlight\" : {\r\n    \"pre_tags\" : [\r\n      \"\"\r\n    ],\r\n    \"post_tags\" : [\r\n      \"\"\r\n    ],\r\n    \"fields\" : {\r\n      \"space_name\" : { },\r\n      \"space_name.*\" : { }\r\n    }\r\n  },\r\n  \"ext\" : { }\r\n}\r\n```\r\n\r\nagainst the following index \r\n\r\n```\r\n{\r\n  \"template\": \"i_users_*\",\r\n  \"settings\": {\r\n    \"number_of_shards\": 10,\r\n    \"number_of_replicas\": 1,\r\n    \"index.mapping.total_fields.limit\": \"100\",\r\n    \"index.mapping.depth.limit\": \"1\",\r\n    \"index.mapping.nested_fields.limit\": \"1\",\r\n    \"index.search.slowlog.threshold.query.warn\": \"100ms\",\r\n    \"index.search.slowlog.threshold.fetch.warn\": \"100ms\",\r\n    \"analysis\": {\r\n      \"char_filter\": {\r\n        \"zwj_char_filter\": {\r\n          \"type\": \"mapping\",\r\n          \"mappings\": [\r\n            \"\\\\u200D=>\"\r\n          ]\r\n        },\r\n        \"emoticons_char_filter\": {\r\n          \"type\": \"mapping\",\r\n          \"mappings_path\": \"analysis/emoticons.txt\"\r\n        }\r\n      },\r\n      \"filter\": {\r\n        \"autocomplete_filter\": {\r\n          \"type\": \"edge_ngram\",\r\n          \"min_gram\": 1,\r\n          \"max_gram\": 50\r\n        },\r\n        \"filter_ngrams\": {\r\n          \"type\": \"ngram\",\r\n          \"min_gram\": 1,\r\n          \"max_gram\": 50\r\n        },\r\n        \"filter_email\": {\r\n          \"type\": \"pattern_capture\",\r\n          \"preserve_original\": 1,\r\n          \"patterns\": [\r\n            \"([^@]+)\",\r\n            \"(\\\\p{L}+)\",\r\n            \"(\\\\d+)\",\r\n            \"@(.+)\"\r\n          ]\r\n        },\r\n        \"english_emoji_synonym_filter\": {\r\n          \"type\": \"synonym\",\r\n          \"synonyms_path\": \"analysis/cldr-emoji-annotation-synonyms-en.txt\"\r\n        },\r\n        \"punctuation_filter\": {\r\n          \"type\": \"pattern_replace\",\r\n          \"pattern\": \"\\\\p{Punct}|\\\\uFE0E|\\\\uFE0F|\\\\uD83C\\\\uDFFB|\\\\uD83C\\\\uDFFC|\\\\uD83C\\\\uDFFD|\\\\uD83C\\\\uDFFE|\\\\uD83C\\\\uDFFF\",\r\n          \"replace\": \"\"\r\n        },\r\n        \"remove_empty_filter\": {\r\n          \"type\": \"length\",\r\n          \"min\": 1\r\n        },\r\n        \"filter_doublemetaphone\": {\r\n          \"type\": \"phonetic\",\r\n          \"encoder\": \"doublemetaphone\",\r\n          \"replace\": false\r\n        }\r\n      },\r\n      \"analyzer\": {\r\n        \"search_name_analyzer\": {\r\n          \"type\": \"custom\",\r\n          \"tokenizer\": \"standard\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"icu_folding\"\r\n          ]\r\n        },\r\n        \"email_analyzer\": {\r\n          \"filter\": [\r\n            \"filter_email\",\r\n            \"lowercase\",\r\n            \"unique\"\r\n          ],\r\n          \"tokenizer\": \"uax_url_email\"\r\n        },\r\n        \"doublemetaphone_analyzer\": {\r\n          \"type\": \"custom\",\r\n          \"tokenizer\": \"standard\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"icu_folding\",\r\n            \"filter_doublemetaphone\"\r\n          ]\r\n        },\r\n        \"emoji_aware_analyzer\": {\r\n          \"char_filter\": [\r\n            \"zwj_char_filter\",\r\n            \"emoticons_char_filter\"\r\n          ],\r\n          \"tokenizer\": \"whitespace\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"punctuation_filter\",\r\n            \"remove_empty_filter\",\r\n            \"english_emoji_synonym_filter\"\r\n          ]\r\n        },\r\n        \"partial_name\": {\r\n          \"char_filter\": [\r\n            \"zwj_char_filter\",\r\n            \"emoticons_char_filter\"\r\n          ],\r\n          \"tokenizer\": \"whitespace\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"punctuation_filter\",\r\n            \"remove_empty_filter\",\r\n            \"english_emoji_synonym_filter\",\r\n            \"autocomplete_filter\"\r\n          ]\r\n        },\r\n        \"full_name\": {\r\n          \"char_filter\": [\r\n            \"zwj_char_filter\",\r\n            \"emoticons_char_filter\"\r\n          ],\r\n          \"tokenizer\": \"whitespace\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"punctuation_filter\",\r\n            \"remove_empty_filter\",\r\n            \"english_emoji_synonym_filter\"\r\n          ]\r\n        },\r\n        \"autocomplete_analyzer\": {\r\n          \"type\": \"custom\",\r\n          \"tokenizer\": \"standard\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"icu_folding\",\r\n            \"autocomplete_filter\"\r\n          ]\r\n        },\r\n        \"partial_middle_name\": {\r\n          \"char_filter\": [\r\n            \"zwj_char_filter\",\r\n            \"emoticons_char_filter\"\r\n          ],\r\n          \"tokenizer\": \"whitespace\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"punctuation_filter\",\r\n            \"remove_empty_filter\",\r\n            \"english_emoji_synonym_filter\",\r\n            \"filter_ngrams\"\r\n          ]\r\n        },\r\n        \"keyword_lowercase\": {\r\n          \"char_filter\": [\r\n            \"zwj_char_filter\",\r\n            \"emoticons_char_filter\"\r\n          ],\r\n          \"tokenizer\": \"keyword\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"punctuation_filter\",\r\n            \"remove_empty_filter\",\r\n            \"english_emoji_synonym_filter\"\r\n          ]\r\n        },\r\n        \"partial_name_back\": {\r\n          \"char_filter\": [\r\n            \"zwj_char_filter\",\r\n            \"emoticons_char_filter\"\r\n          ],\r\n          \"tokenizer\": \"whitespace\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"punctuation_filter\",\r\n            \"remove_empty_filter\",\r\n            \"english_emoji_synonym_filter\",\r\n            \"reverse\",\r\n            \"autocomplete_filter\",\r\n            \"reverse\"\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"mappings\": {\r\n    \"relation\": {\r\n      \"_source\": {\r\n        \"enabled\": true\r\n      },\r\n      \"properties\": {\r\n        \"id\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"connection_id\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"identity_id\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"identity_ext_id\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"identity_name\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"autocomplete_analyzer\",\r\n          \"search_analyzer\": \"search_name_analyzer\",\r\n          \"term_vector\": \"with_positions_offsets\",\r\n          \"fields\": {\r\n            \"raw\": {\r\n              \"type\": \"keyword\"\r\n            },\r\n            \"metaphone\": {\r\n              \"type\": \"text\",\r\n              \"analyzer\": \"doublemetaphone_analyzer\",\r\n              \"search_analyzer\": \"search_name_analyzer\",\r\n              \"term_vector\": \"with_positions_offsets\"\r\n            }\r\n          }\r\n        },\r\n        \"identity_email\": {\r\n          \"type\": \"keyword\",\r\n          \"fields\": {\r\n            \"searchable\": {\r\n              \"type\": \"text\",\r\n              \"analyzer\": \"email_analyzer\"\r\n            }\r\n          }\r\n        },\r\n        \"identity_type\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"identity_is_blocked\": {\r\n          \"type\": \"boolean\"\r\n        },\r\n        \"identity_state\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"identity_org\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"identity_photo_url\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"identity_created_at\": {\r\n          \"type\": \"date\",\r\n          \"format\": \"epoch_millis\"\r\n        },\r\n        \"identity_updated_at\": {\r\n          \"type\": \"date\",\r\n          \"format\": \"epoch_millis\"\r\n        },\r\n        \"identity_created_by\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"identity_updated_by\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"space_id\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"space_type\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"space_name\": {\r\n          \"analyzer\": \"full_name\",\r\n          \"term_vector\": \"with_positions_offsets\",\r\n          \"type\": \"text\",\r\n          \"fields\": {\r\n            \"raw\": {\r\n              \"type\": \"keyword\"\r\n            },\r\n            \"lowercase\": {\r\n              \"analyzer\": \"keyword_lowercase\",\r\n              \"type\": \"text\"\r\n            },\r\n            \"partial_back\": {\r\n              \"search_analyzer\": \"full_name\",\r\n              \"analyzer\": \"partial_name_back\",\r\n              \"term_vector\": \"with_positions_offsets\",\r\n              \"type\": \"text\"\r\n            },\r\n            \"partial\": {\r\n              \"search_analyzer\": \"full_name\",\r\n              \"analyzer\": \"partial_name\",\r\n              \"term_vector\": \"with_positions_offsets\",\r\n              \"type\": \"text\"\r\n            },\r\n            \"partial_middle\": {\r\n              \"search_analyzer\": \"full_name\",\r\n              \"analyzer\": \"partial_middle_name\",\r\n              \"term_vector\": \"with_positions_offsets\",\r\n              \"type\": \"text\"\r\n            }\r\n          }\r\n        },\r\n        \"version\": {\r\n          \"type\": \"long\"\r\n        },\r\n        \"created_at\": {\r\n          \"type\": \"date\",\r\n          \"format\": \"epoch_millis\"\r\n        },\r\n        \"updated_at\": {\r\n          \"type\": \"date\",\r\n          \"format\": \"epoch_millis\"\r\n        },\r\n        \"created_by\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"updated_by\": {\r\n          \"type\": \"keyword\"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"aliases\": {\r\n    \"a_users\": {\r\n    },\r\n    \"a_users_search\": {\r\n    }\r\n  }\r\n}\r\n\r\n```\r\n\r\nwith the following matching entry\r\n\r\n```\r\n{\r\n        \"_index\": \"i_users_v3\",\r\n        \"_type\": \"relation\",\r\n        \"_id\": \"FUxatlCDNNEmxPNPHQiXBcltQjPSbU\",\r\n        \"_score\": 1,\r\n        \"_source\": {\r\n          \"id\": \"FUxatlCDNNEmxPNPHQiXBcltQjPSbU\",\r\n          \"identity_id\": \"AVwL7fP1EtaL7sU-_-ew\",\r\n          \"identity_ext_id\": \"487fd102-5295-45ac-ad57-5873aa3fc59e\",\r\n          \"identity_name\": \"28f47d97-c2bb-4da5-8649-2792daf6ae2e\",\r\n          \"identity_type\": \"nKdYkLPTSDnihg\",\r\n          \"identity_email\": \"imyYXggeVPeusou\",\r\n          \"identity_org\": \"testOrg\",\r\n          \"identity_is_blocked\": true,\r\n          \"identity_state\": \"ACTIVE\",\r\n          \"identity_photo_url\": \"bsZWwdspkHdWf\",\r\n          \"identity_created_at\": 1494848762845,\r\n          \"identity_updated_at\": 1494848762845,\r\n          \"identity_created_by\": \"-1111111\",\r\n          \"identity_updated_by\": \"-111111110\",\r\n          \"space_id\": \"ed5fff0a-4f2f-4674-9c13-d0c8b7a1e8b8\",\r\n          \"space_name\": \"Design Research + Steve\",\r\n          \"space_type\": \"VDtwZFJDSr\",\r\n          \"created_at\": 1494848790602,\r\n          \"updated_at\": 1494848790602,\r\n          \"created_by\": \"B\",\r\n          \"updated_by\": \"SHUPXeEjfBR\",\r\n          \"version\": 1494848790602\r\n        }\r\n      }\r\n```\r\n\r\nreturns the following \r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"array_index_out_of_bounds_exception\",\r\n        \"reason\": \"0\"\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"i_users_v3\",\r\n        \"node\": \"w6IdPgYmR8q_f2iFDc3TtA\",\r\n        \"reason\": {\r\n          \"type\": \"array_index_out_of_bounds_exception\",\r\n          \"reason\": \"0\"\r\n        }\r\n      }\r\n    ],\r\n    \"caused_by\": {\r\n      \"type\": \"array_index_out_of_bounds_exception\",\r\n      \"reason\": \"0\"\r\n    }\r\n  },\r\n  \"status\": 500\r\n}\r\n```\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\norg.elasticsearch.transport.RemoteTransportException: [w6IdPgY][127.0.0.1:9325][indices:data/read/search[phase/query]]\r\nCaused by: org.elasticsearch.search.fetch.FetchPhaseExecutionException: Fetch Failed [Failed to highlight field [space_name]]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.FastVectorHighlighter.highlight(FastVectorHighlighter.java:202) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.HighlightPhase.hitExecute(HighlightPhase.java:124) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:163) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:294) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:271) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:331) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:328) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:618) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:613) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_121]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_121]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_121]\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 0\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.getKey(FieldQuery.java:293) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.getTermSet(FieldQuery.java:348) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.saveTerms(FieldQuery.java:329) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.<init>(FieldQuery.java:69) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.CustomFieldQuery.<init>(CustomFieldQuery.java:56) ~[elasticsearch-5.3.0.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.FastVectorHighlighter.highlight(FastVectorHighlighter.java:91) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.HighlightPhase.hitExecute(HighlightPhase.java:124) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:163) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:294) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:271) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:331) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:328) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:618) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:613) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_121]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_121]\r\n\tat java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_121]\r\n[2017-05-15T12:48:07,760][DEBUG][o.e.a.s.TransportSearchAction] [w6IdPgY] All shards failed for phase: [query]\r\norg.elasticsearch.transport.RemoteTransportException: [w6IdPgY][127.0.0.1:9325][indices:data/read/search[phase/query]]\r\nCaused by: org.elasticsearch.search.fetch.FetchPhaseExecutionException: Fetch Failed [Failed to highlight field [space_name]]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.FastVectorHighlighter.highlight(FastVectorHighlighter.java:202) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.HighlightPhase.hitExecute(HighlightPhase.java:124) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:163) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:294) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:271) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:331) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:328) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:618) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:613) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_121]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_121]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_121]\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 0\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.getKey(FieldQuery.java:293) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.getTermSet(FieldQuery.java:348) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.saveTerms(FieldQuery.java:329) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.<init>(FieldQuery.java:69) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.CustomFieldQuery.<init>(CustomFieldQuery.java:56) ~[elasticsearch-5.3.0.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.FastVectorHighlighter.highlight(FastVectorHighlighter.java:91) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.HighlightPhase.hitExecute(HighlightPhase.java:124) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:163) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:294) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:271) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:331) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:328) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:618) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:613) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_121]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_121]\r\n\tat java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_121]\r\n[2017-05-15T12:48:07,761][WARN ][r.suppressed             ] path: /a_identities_spaces/relation/_search, params: {index=a_identities_spaces, type=relation}\r\norg.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onInitialPhaseResult(AbstractSearchAsyncAction.java:223) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.access$100(AbstractSearchAsyncAction.java:58) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:148) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:51) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1032) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1134) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1112) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$7.onFailure(TransportService.java:629) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.onFailure(ThreadContext.java:598) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:39) [elasticsearch-5.3.0.jar:5.3.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_121]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_121]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_121]\r\nCaused by: org.elasticsearch.transport.RemoteTransportException: [w6IdPgY][127.0.0.1:9325][indices:data/read/search[phase/query]]\r\nCaused by: org.elasticsearch.search.fetch.FetchPhaseExecutionException: Fetch Failed [Failed to highlight field [space_name]]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.FastVectorHighlighter.highlight(FastVectorHighlighter.java:202) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.HighlightPhase.hitExecute(HighlightPhase.java:124) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:163) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:294) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:271) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:331) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:328) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:618) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:613) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\t... 3 more\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 0\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.getKey(FieldQuery.java:293) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.getTermSet(FieldQuery.java:348) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.saveTerms(FieldQuery.java:329) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.FieldQuery.<init>(FieldQuery.java:69) ~[lucene-highlighter-6.4.1.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.apache.lucene.search.vectorhighlight.CustomFieldQuery.<init>(CustomFieldQuery.java:56) ~[elasticsearch-5.3.0.jar:6.4.1 72f75b2503fa0aa4f0aff76d439874feb923bb0e - jpountz - 2017-02-01 14:44:23]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.FastVectorHighlighter.highlight(FastVectorHighlighter.java:91) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.subphase.highlight.HighlightPhase.hitExecute(HighlightPhase.java:124) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:163) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:294) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:271) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:331) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:328) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:618) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:613) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.3.0.jar:5.3.0]\r\n\t... 3 more\r\n```\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}