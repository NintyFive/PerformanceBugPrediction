{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26507","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26507/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26507/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26507/events","html_url":"https://github.com/elastic/elasticsearch/issues/26507","id":255238073,"node_id":"MDU6SXNzdWUyNTUyMzgwNzM=","number":26507,"title":"ES error logs on type mismatch (at ingestion) could be clearer","user":{"login":"smgduncan","id":30104826,"node_id":"MDQ6VXNlcjMwMTA0ODI2","avatar_url":"https://avatars0.githubusercontent.com/u/30104826?v=4","gravatar_id":"","url":"https://api.github.com/users/smgduncan","html_url":"https://github.com/smgduncan","followers_url":"https://api.github.com/users/smgduncan/followers","following_url":"https://api.github.com/users/smgduncan/following{/other_user}","gists_url":"https://api.github.com/users/smgduncan/gists{/gist_id}","starred_url":"https://api.github.com/users/smgduncan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smgduncan/subscriptions","organizations_url":"https://api.github.com/users/smgduncan/orgs","repos_url":"https://api.github.com/users/smgduncan/repos","events_url":"https://api.github.com/users/smgduncan/events{/privacy}","received_events_url":"https://api.github.com/users/smgduncan/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-09-05T10:57:08Z","updated_at":"2017-09-05T20:31:30Z","closed_at":"2017-09-05T20:31:30Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n5.5.2 Docker Image:\r\n[elasticsearch@1fac82d84533 bin]$ elasticsearch -V \r\nVersion: 5.5.2, Build: b2f0c09/2017-08-14T12:33:14.154Z, JVM: **1.8.0_141**\r\n\r\n**Plugins installed**: X-Pack (30 day trial) (as included in the Docker version.\r\n\r\n**JVM version** (`java -version`):\r\n1.8.0_141\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n[elasticsearch@1fac82d84533 bin]$ uname -a\r\nLinux 1fac82d84533 4.9.41-moby #1 SMP Fri Aug 18 01:58:38 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nThis issue was originally flagged by a customer.  They were submitting an out of range integer value (via Logstash), which was being correctly rejected by Elasticsearch, resulting in various \r\n\"Could not index event to Elasticsearch\" caused by \"number_format_exception\" errors in the Logstash logs.  They were unable to determine the root cause by reviewing the Elasticsearch logs.\r\n\r\nExpected behaviour: Able to determine the root cause (value exceeded range of the integer type, and hence should be mapped to a Long) easily from the elasticsearch.log.\r\n\r\nActual behaviour: Was not obvious.\r\n\r\nRequest: Can the log entries for this error be made a little clearer?\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Create an index with an integer data type, e.g:\r\n\r\nPUT integertest\r\n{\r\n  \"mappings\": {\r\n    \"numeric_type\": {\r\n      \"properties\": {\r\n        \"integer\": {\r\n          \"type\": \"integer\"\r\n        },\r\n        \"long\": {\r\n          \"type\": \"long\"\r\n        },\r\n        \"float\": {\r\n          \"type\": \"float\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n 2. Attempt to put an entry in with an out of range integer:\r\n\r\nput integertest/numeric_type/2\r\n{\r\n  \"integer\" : 2287862150\r\n}\r\n\r\n3.  This will result in the following error output in the Console:\r\n\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"mapper_parsing_exception\",\r\n        \"reason\": \"failed to parse [integer]\"\r\n      }\r\n    ],\r\n    \"type\": \"mapper_parsing_exception\",\r\n    \"reason\": \"failed to parse [integer]\",\r\n    \"caused_by\": {\r\n      \"type\": \"json_parse_exception\",\r\n      \"reason\": \"Numeric value (2287862150) out of range of int\\n at [Source: org.elasticsearch.common.bytes.BytesReference$MarkSupportingStreamInputWrapper@4270b78a; line: 2, column: 25]\"\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n\r\n4. The output in the elasticsearch.log was not as easy to interpret:\r\n[2017-09-05T10:52:35,882][DEBUG][o.e.a.b.TransportShardBulkAction] [8trXFm_] [integertest][2] failed to execute bulk item (index) BulkShardRequest [[integertest][2]] containing [index {[integertest][numeric_type][2], source[{\r\n  \"integer\" : 2287862150\r\n}\r\n]}]\r\norg.elasticsearch.index.mapper.MapperParsingException: failed to parse [integer]\r\n\tat org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:298) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:468) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseValue(DocumentParser.java:591) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.DocumentParser.innerParseObject(DocumentParser.java:396) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObjectOrNested(DocumentParser.java:373) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.DocumentParser.internalParseDocument(DocumentParser.java:93) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:66) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:277) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.shard.IndexShard.prepareIndex(IndexShard.java:529) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.shard.IndexShard.prepareIndexOnPrimary(IndexShard.java:506) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.prepareIndexOperationOnPrimary(TransportShardBulkAction.java:450) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.executeIndexRequestOnPrimary(TransportShardBulkAction.java:458) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.executeBulkItemRequest(TransportShardBulkAction.java:143) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:113) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:69) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:939) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:908) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:113) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.onResponse(TransportReplicationAction.java:322) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.onResponse(TransportReplicationAction.java:264) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$1.onResponse(TransportReplicationAction.java:888) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$1.onResponse(TransportReplicationAction.java:885) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.shard.IndexShardOperationsLock.acquire(IndexShardOperationsLock.java:151) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationLock(IndexShard.java:1657) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.acquirePrimaryShardReference(TransportReplicationAction.java:897) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.access$400(TransportReplicationAction.java:93) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.doRun(TransportReplicationAction.java:281) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:260) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:252) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler$1.doRun(SecurityServerTransportInterceptor.java:258) ~[?:?]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:110) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.lambda$messageReceived$0(SecurityServerTransportInterceptor.java:307) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:59) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$authorizeAsync$5(ServerTransportFilter.java:191) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:127) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:121) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:109) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.authorizeAsync(ServerTransportFilter.java:193) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$inbound$2(ServerTransportFilter.java:162) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:59) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:212) ~[x-pack-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:246) ~[x-pack-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:257) [x-pack-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:210) [x-pack-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:159) [x-pack-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:122) [x-pack-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.inbound(ServerTransportFilter.java:145) [x-pack-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:314) [x-pack-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) [elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:644) [elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.5.2.jar:5.5.2]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_141]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_141]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_141]\r\nCaused by: com.fasterxml.jackson.core.JsonParseException: Numeric value (2287862150) out of range of int\r\n at [Source: org.elasticsearch.common.bytes.BytesReference$MarkSupportingStreamInputWrapper@58aafc98; line: 2, column: 25]\r\n\tat com.fasterxml.jackson.core.JsonParser._constructError(JsonParser.java:1702) ~[jackson-core-2.8.6.jar:2.8.6]\r\n\tat com.fasterxml.jackson.core.base.ParserMinimalBase._reportError(ParserMinimalBase.java:558) ~[jackson-core-2.8.6.jar:2.8.6]\r\n\tat com.fasterxml.jackson.core.base.ParserBase.convertNumberToInt(ParserBase.java:928) ~[jackson-core-2.8.6.jar:2.8.6]\r\n\tat com.fasterxml.jackson.core.base.ParserBase._parseIntValue(ParserBase.java:866) ~[jackson-core-2.8.6.jar:2.8.6]\r\n\tat com.fasterxml.jackson.core.base.ParserBase.getIntValue(ParserBase.java:694) ~[jackson-core-2.8.6.jar:2.8.6]\r\n\tat org.elasticsearch.common.xcontent.json.JsonXContentParser.doIntValue(JsonXContentParser.java:165) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.common.xcontent.support.AbstractXContentParser.intValue(AbstractXContentParser.java:155) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$6.parse(NumberFieldMapper.java:610) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$6.parse(NumberFieldMapper.java:589) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper.parseCreateField(NumberFieldMapper.java:1058) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\tat org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:287) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n\t... 56 more","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}