{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42796","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42796/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42796/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42796/events","html_url":"https://github.com/elastic/elasticsearch/issues/42796","id":451380165,"node_id":"MDU6SXNzdWU0NTEzODAxNjU=","number":42796,"title":"[CI] Deprecation warnings cause failures for 2 tests in MixedClusterClientYamlTestSuiteIT in 6.8","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1343732839,"node_id":"MDU6TGFiZWwxMzQzNzMyODM5","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.8.0","name":"v6.8.0","color":"DDDDDD","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"assignees":[{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-06-03T09:27:41Z","updated_at":"2019-06-05T02:14:59Z","closed_at":"2019-06-05T02:14:59Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Build link: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.8+bwc-tests/112/console\r\n\r\nTwo tests failed:\r\n\r\nReproduce 1:\r\n\r\n```\r\n./gradlew :qa:mixed-cluster:v5.6.0#mixedClusterTestRunner -Dtests.seed=50C77143AD9C6ABC -Dtests.class=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT -Dtests.method=\"test {p0=update/11_shard_header/Update check shard header}\" -Dtests.security.manager=true -Dtests.locale=es-CL -Dtests.timezone=Asia/Atyrau -Dcompiler.java=12 -Druntime.java=8\r\n```\r\n\r\nFailure 1:\r\n\r\n```\r\nFAILURE 0.30s | MixedClusterClientYamlTestSuiteIT.test {p0=update/11_shard_header/Update check shard header} <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: Failure at [update/11_shard_header:23]: got unexpected warning header [\r\n   > \t299 Elasticsearch-6.8.1-SNAPSHOT-8c087df \"Usage of internal versioning for optimistic concurrency control is deprecated and will be removed. Please use the `if_seq_no` and `if_primary_term` parameters instead. (request for index [foobar], type [baz], id [1])\"\r\n   > ]\r\n   > \tat __randomizedtesting.SeedInfo.seed([50C77143AD9C6ABC:D8934E9903600744]:0)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:412)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:389)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: java.lang.AssertionError: got unexpected warning header [\r\n   > \t299 Elasticsearch-6.8.1-SNAPSHOT-8c087df \"Usage of internal versioning for optimistic concurrency control is deprecated and will be removed. Please use the `if_seq_no` and `if_primary_term` parameters instead. (request for index [foobar], type [baz], id [1])\"\r\n   > ]\r\n   > \tat org.elasticsearch.test.rest.yaml.section.DoSection.checkWarningHeaders(DoSection.java:330)\r\n   > \tat org.elasticsearch.test.rest.yaml.section.DoSection.execute(DoSection.java:258)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:405)\r\n   > \t... 37 more\r\n```\r\n\r\nReproduce 2:\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :qa:mixed-cluster:v5.6.0#mixedClusterTestRunner -Dtests.seed=50C77143AD9C6ABC -Dtests.class=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT -Dtests.method=\"test {p0=update/60_refresh/refresh=wait_for waits until changes are visible in search}\" -Dtests.security.manager=true -Dtests.locale=es-CL -Dtests.timezone=Asia/Atyrau -Dcompiler.java=12 -Druntime.java=8\r\n```\r\n\r\nFailure 2:\r\n\r\n```\r\nFAILURE 1.16s | MixedClusterClientYamlTestSuiteIT.test {p0=update/60_refresh/refresh=wait_for waits until changes are visible in search} <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: Failure at [update/60_refresh:99]: got unexpected warning header [\r\n   > \t299 Elasticsearch-6.8.1-SNAPSHOT-8c087df \"Usage of internal versioning for optimistic concurrency control is deprecated and will be removed. Please use the `if_seq_no` and `if_primary_term` parameters instead. (request for index [update_60_refresh_1], type [test], id [update_60_refresh_id1])\"\r\n   > ]\r\n   > \tat __randomizedtesting.SeedInfo.seed([50C77143AD9C6ABC:D8934E9903600744]:0)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:412)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:389)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: java.lang.AssertionError: got unexpected warning header [\r\n   > \t299 Elasticsearch-6.8.1-SNAPSHOT-8c087df \"Usage of internal versioning for optimistic concurrency control is deprecated and will be removed. Please use the `if_seq_no` and `if_primary_term` parameters instead. (request for index [update_60_refresh_1], type [test], id [update_60_refresh_id1])\"\r\n   > ]\r\n   > \tat org.elasticsearch.test.rest.yaml.section.DoSection.checkWarningHeaders(DoSection.java:330)\r\n   > \tat org.elasticsearch.test.rest.yaml.section.DoSection.execute(DoSection.java:258)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:405)\r\n   > \t... 37 more\r\n```\r\n\r\nI could not reproduce the first but I do reproduce the second reliably on my machine.","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}