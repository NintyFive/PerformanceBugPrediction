{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1086","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1086/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1086/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1086/events","html_url":"https://github.com/elastic/elasticsearch/issues/1086","id":1153132,"node_id":"MDU6SXNzdWUxMTUzMTMy","number":1086,"title":"mvel's pow() truncates decimals","user":{"login":"ieure","id":35252,"node_id":"MDQ6VXNlcjM1MjUy","avatar_url":"https://avatars1.githubusercontent.com/u/35252?v=4","gravatar_id":"","url":"https://api.github.com/users/ieure","html_url":"https://github.com/ieure","followers_url":"https://api.github.com/users/ieure/followers","following_url":"https://api.github.com/users/ieure/following{/other_user}","gists_url":"https://api.github.com/users/ieure/gists{/gist_id}","starred_url":"https://api.github.com/users/ieure/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ieure/subscriptions","organizations_url":"https://api.github.com/users/ieure/orgs","repos_url":"https://api.github.com/users/ieure/repos","events_url":"https://api.github.com/users/ieure/events{/privacy}","received_events_url":"https://api.github.com/users/ieure/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2011-07-01T21:28:21Z","updated_at":"2013-04-05T14:20:44Z","closed_at":"2013-04-05T14:20:44Z","author_association":"NONE","active_lock_reason":null,"body":"I'm trying to score documents by a blend of text match and distance from a lat, lon by adding the reciprocal of the distance from the origin point to the score. Unfortunately, `pow()` discards all decimal places, which leads to anything within 1km going to Infinity since `pow(0, -1)` -> Infinity.\n\nI added these `script_fields` to debug this issue:\n\n```\n\"script_fields\": {\n    \"_distance_recip\": {\"script\": \"pow(doc['geometry.coordinates'].distanceInKm(lat, lon), -1)\"},\n    \"params\": {\"lat\": 37.803460000000001, \"lon\": -122.44002},\n    \"_distance\": {\"script\": \"doc['geometry.coordinates'].distanceInKm(lat, lon)\",\n                  \"params\": {\"lat\": 37.803460000000001, \"lon\": -122.44002},}}\n```\n\nAnd I got these results back:\n\n```\n\"_distance_recip\": \"Infinity\", \n\"_distance\": 0.68799850202738555\n\n\"_distance_recip\": \"Infinity\", \n\"_distance\": 0.52009691901279231\n\n\"_distance_recip\": 1.0, \n\"_distance\": 1.90754297084453\n\n\"_distance_recip\": 1.0, \n\"_distance\": 1.275160615266868\n\n\"_distance_recip\": 0.5, \n\"_distance\": 2.5103734638225164\n\n\"_distance_recip\": 0.5, \n\"_distance\": 2.4968355466598258\n```\n\nAll these values are consistent with truncating the float to an int, which is not what I would expect at all.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}