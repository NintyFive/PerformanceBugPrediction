[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/590809368","html_url":"https://github.com/elastic/elasticsearch/issues/52751#issuecomment-590809368","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52751","id":590809368,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MDgwOTM2OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-02-25T10:58:06Z","updated_at":"2020-02-25T10:58:06Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/Snapshot/Restore)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/591377762","html_url":"https://github.com/elastic/elasticsearch/issues/52751#issuecomment-591377762","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52751","id":591377762,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MTM3Nzc2Mg==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2020-02-26T11:24:43Z","updated_at":"2020-02-26T11:36:05Z","author_association":"MEMBER","body":"This is a little strange. Both failures are due to a snapshot taking more than 60s and thus timing out.\r\n\r\nStrangely enough there are a number of pretty much exactly 1 minute pauses between steps of the test in the failing test runs:\r\n\r\n```\r\n[2020-02-25T10:21:31,693][DEBUG][o.e.c.c.C.CoordinatorPublication] [integTest-0] publication ended successfully: Publication{term=1, version=91}\r\n[2020-02-25T10:21:31,712][INFO ][o.e.s.SnapshotsService   ] [integTest-0] snapshot [repository-fs:snapshot-two/fDbDM4UgRk6bJHp9Jik-JQ] completed with state [SUCCESS]\r\n[2020-02-25T10:21:31,713][DEBUG][o.e.c.c.PublicationTransportHandler] [integTest-0] received diff cluster state version [92] with uuid [C0lrIKJCSqOYXdwdHCKooQ], diff size [153]\r\n[2020-02-25T10:21:31,718][DEBUG][o.e.c.c.C.CoordinatorPublication] [integTest-0] publication ended successfully: Publication{term=1, version=92}\r\n[2020-02-25T10:22:31,843][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [docs/smIw4WYvSzeEDerNpwvQOQ] deleting index\r\n[2020-02-25T10:22:31,846][DEBUG][o.e.c.c.PublicationTransportHandler] [integTest-0] received diff cluster state version [93] with uuid [TxmLm0hRTPG20dgGjZPTcA], diff size [200]\r\n```\r\n\r\nI can't reproduce these pauses locally so far and this seems to have been a fairly rare situation. The exact `60s` are suspicious but looking at the failed runs both happened when these ITs were executed in parallel to a bunch of other integration tests so I wonder if this may have just been accidental slowness.\r\nIt's hard to imagine that a standard snapshot to a local fs repository would lock up here but not elsewhere when we probably do hundreds if not thousands of these snapshots during a full test run.\r\n\r\n\r\nThen again, the fact that subsequent repo operations are failing because of an ongoing snapshot implies that the snapshotting is stuck somehow (might be because of slow cluster state updates judging by the logs above).\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/591456989","html_url":"https://github.com/elastic/elasticsearch/issues/52751#issuecomment-591456989","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52751","id":591456989,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MTQ1Njk4OQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2020-02-26T14:35:05Z","updated_at":"2020-02-26T14:35:05Z","author_association":"MEMBER","body":"After talking this through in the distribution sync just now I'm gonna close this one. There's no way of figuring out why this test was so slow. I don't see how it could be anything but an infra issue really => let's see if it happens again. We had other tests time out too recently so an infra issue isn't so unlikely.","performed_via_github_app":null}]