{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8616","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8616/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8616/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8616/events","html_url":"https://github.com/elastic/elasticsearch/issues/8616","id":49826630,"node_id":"MDU6SXNzdWU0OTgyNjYzMA==","number":8616,"title":"Aggregation woes","user":{"login":"NodexTech","id":6095811,"node_id":"MDQ6VXNlcjYwOTU4MTE=","avatar_url":"https://avatars1.githubusercontent.com/u/6095811?v=4","gravatar_id":"","url":"https://api.github.com/users/NodexTech","html_url":"https://github.com/NodexTech","followers_url":"https://api.github.com/users/NodexTech/followers","following_url":"https://api.github.com/users/NodexTech/following{/other_user}","gists_url":"https://api.github.com/users/NodexTech/gists{/gist_id}","starred_url":"https://api.github.com/users/NodexTech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NodexTech/subscriptions","organizations_url":"https://api.github.com/users/NodexTech/orgs","repos_url":"https://api.github.com/users/NodexTech/repos","events_url":"https://api.github.com/users/NodexTech/events{/privacy}","received_events_url":"https://api.github.com/users/NodexTech/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-11-23T14:10:04Z","updated_at":"2014-12-31T16:52:56Z","closed_at":"2014-12-31T16:52:56Z","author_association":"NONE","active_lock_reason":null,"body":"Here is the mapping of my index - https://gist.github.com/NodexTech/02c8b95eef3abc3f1a44\nPlease note the \"facets\" object and that the fields inside it are NOT analyzed and have doc_values:true which should give me values such as non case folded or tokenized bucket values. This works as expected UNTIL an aggregation (ranged in this case) is added to the query at which point the return reverts back to retrieving the bucket values from the index and NOT the document.\n\nHere is the query - https://gist.github.com/NodexTech/a673df667fed9255898f\n\nSometimes the query fails and returns NO aggregations for \"contract_type\" (arbitrary field) and sometimes it gives the right answers which leads me to believe it's cache related as I can change the date on the query (i/e go back 3 months) and it will work as expected.\n\nIt's very odd behavior, I am fairly new to ES and I am surprised that this would be a bug and not found by unit testing etc but I picked it up in a matter of using ES for less than a week so it might have slipped someone by!\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}