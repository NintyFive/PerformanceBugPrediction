{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15062","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15062/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15062/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15062/events","html_url":"https://github.com/elastic/elasticsearch/issues/15062","id":119182663,"node_id":"MDU6SXNzdWUxMTkxODI2NjM=","number":15062,"title":"Plugin policy not being applied on Windows","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"labels":[{"id":146832994,"node_id":"MDU6TGFiZWwxNDY4MzI5OTQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Plugins","name":":Core/Infra/Plugins","color":"0e8a16","default":false,"description":"Plugin API and infrastructure"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":73544,"node_id":"MDU6TGFiZWw3MzU0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Enon-issue","name":">non-issue","color":"cfcfcf","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"assignees":[{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2015-11-27T11:42:48Z","updated_at":"2016-01-10T09:01:23Z","closed_at":"2016-01-08T21:10:58Z","author_association":"MEMBER","active_lock_reason":null,"body":"Due to a particularity in dealing with drive letters, the security policy files for plugins are read but never matched on Windows.\n\nAfter much hairy pulling, the issue was discovered to be caused in `Security.java#getPluginPermissions()` in particular\n`codebases.add(jar.toRealPath().toUri().toURL());`\n\nFor the given `Path` which points to `e:\\tmp\\repository-hdfs\\elasticsearch-3.0.0-SNAPSHOT\\plugins\\lang-groovy\\groovy-all-2.4.4-indy.jar`, we get the following behaviour:\n\n`jar.toAbsolutePath()` -> `e:\\tmp\\repository-hdfs\\elasticsearch-3.0.0-SNAPSHOT\\plugins\\lang-groovy\\groovy-all-2.4.4-indy.jar`\n\n`jar.toRealPath()` -> `E:\\tmp\\repository-hdfs\\elasticsearch-3.0.0-SNAPSHOT\\plugins\\lang-groovy\\groovy-all-2.4.4-indy.jar`\n\nThus the policy is keyed under a upper case `E` but the `ProtectionDomain`/`CodeBase` is using the lower case version:\n\n```\naccess: domain that failed ProtectionDomain  (file:/e:/tmp/repository-hdfs/elasticsearch-3.0.0-SNAPSHOT/plugins/lang-groovy/groovy-all-2.4.4-indy.jar <no signer certificates>)\n java.net.FactoryURLClassLoader@52af26ee\n <no principals>\n java.security.Permissions@7d30007d (\n (\"java.io.FilePermission\" \"\\e:\\tmp\\repository-hdfs\\elasticsearch-3.0.0-SNAPSHOT\\plugins\\lang-groovy\\groovy-all-2.4.4-indy.jar\" \"read\")\n)\n```\n\nUnfortunately the `URLClassLoader` relies on sun specific classes in retrieving the URL but it looks like it does not rely on the `java.nio` package. Potential solutions would be using `absolutePath` instead though that does not handle symlinks or adding a special check for Windows (which likely might actually work only on Oracle/Sun JDK as it is platform and implementation specific) that lowercases the drive letter.\nI wonder who this behaves with things like SMB or other crazy URLs.\n","closed_by":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}