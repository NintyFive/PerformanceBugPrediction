{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30445","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30445/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30445/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30445/events","html_url":"https://github.com/elastic/elasticsearch/issues/30445","id":320990197,"node_id":"MDU6SXNzdWUzMjA5OTAxOTc=","number":30445,"title":"[CI] TransportSamlLogoutActionTests.testLogoutInvalidatesToken PrivilegedActionException","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"assignees":[{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2018-05-07T23:15:12Z","updated_at":"2018-06-13T14:54:40Z","closed_at":"2018-05-09T03:03:20Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Was able to reproduce locally.\r\n\r\nReproduce:\r\n\r\n```\r\n./gradlew :x-pack:plugin:security:test \\\r\n  -Dtests.seed=1182D37B3D2E4ECE \\\r\n  -Dtests.class=org.elasticsearch.xpack.security.action.saml.TransportSamlLogoutActionTests \\\r\n  -Dtests.method=\"testLogoutInvalidatesToken\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=az-Latn \\\r\n  -Dtests.timezone=Europe/Isle_of_Man\r\n```\r\n\r\nStack:\r\n\r\n```\r\n  2> REPRODUCE WITH: ./gradlew :x-pack:plugin:security:test -Dtests.seed=1182D37B3D2E4ECE -Dtests.class=org.elasticsearch.xpack.security.action.saml.TransportSamlLogoutActionTests -Dtests.method=\"testLogoutInvalidatesToken\" -Dtests.security.manager=true -Dtests.locale=az-Latn -Dtests.timezone=Europe/Isle_of_Man\r\nERROR   1.01s | TransportSamlLogoutActionTests.testLogoutInvalidatesToken <<< FAILURES!\r\n   > Throwable #1: java.security.PrivilegedActionException: net.shibboleth.utilities.java.support.component.ComponentInitializationException: Error refreshing metadata during init\r\n   >    at java.base/java.security.AccessController.doPrivileged(Native Method)\r\n   >    at org.elasticsearch.xpack.security.authc.saml.SamlRealm.initialiseResolver(SamlRealm.java:595)\r\n   >    at org.elasticsearch.xpack.security.authc.saml.SamlRealm.parseFileSystemMetadata(SamlRealm.java:560)\r\n   >    at org.elasticsearch.xpack.security.authc.saml.SamlRealm.initializeResolver(SamlRealm.java:486)\r\n   >    at org.elasticsearch.xpack.security.authc.saml.SamlRealm.create(SamlRealm.java:184)\r\n   >    at org.elasticsearch.xpack.security.action.saml.TransportSamlLogoutActionTests.setup(TransportSamlLogoutActionTests.java:201)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:564)\r\n   >    at java.base/java.lang.Thread.run(Thread.java:844)\r\n   > Caused by: net.shibboleth.utilities.java.support.component.ComponentInitializationException: Error refreshing metadata during init\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractReloadingMetadataResolver.initMetadataResolver(AbstractReloadingMetadataResolver.java:264)\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractMetadataResolver.doInitialize(AbstractMetadataResolver.java:287)\r\n   >    at net.shibboleth.utilities.java.support.component.AbstractInitializableComponent.initialize(AbstractInitializableComponent.java:61)\r\n   >    at org.elasticsearch.xpack.security.authc.saml.SamlRealm.lambda$initialiseResolver$10(SamlRealm.java:596)\r\n   >    ... 41 more\r\n   > Caused by: net.shibboleth.utilities.java.support.resolver.ResolverException: net.shibboleth.utilities.java.support.resolver.ResolverException: Unable to unmarshall metadata\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractReloadingMetadataResolver.refresh(AbstractReloadingMetadataResolver.java:297)\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractReloadingMetadataResolver.initMetadataResolver(AbstractReloadingMetadataResolver.java:262)\r\n   >    ... 44 more\r\n   > Caused by: net.shibboleth.utilities.java.support.resolver.ResolverException: Unable to unmarshall metadata\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractReloadingMetadataResolver.unmarshallMetadata(AbstractReloadingMetadataResolver.java:344)\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractReloadingMetadataResolver.processNewMetadata(AbstractReloadingMetadataResolver.java:381)\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractReloadingMetadataResolver.refresh(AbstractReloadingMetadataResolver.java:291)\r\n   >    ... 45 more\r\n   > Caused by: org.opensaml.core.xml.io.UnmarshallingException: org.opensaml.core.xml.io.UnmarshallingException: Invalid key usage type: signing\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractMetadataResolver.unmarshallMetadata(AbstractMetadataResolver.java:355)\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractReloadingMetadataResolver.unmarshallMetadata(AbstractReloadingMetadataResolver.java:340)\r\n   >    ... 47 more\r\n   > Caused by: org.opensaml.core.xml.io.UnmarshallingException: Invalid key usage type: signing\r\n   >    at org.opensaml.saml.saml2.metadata.impl.KeyDescriptorUnmarshaller.processAttribute(KeyDescriptorUnmarshaller.java:61)\r\n   >    at org.opensaml.core.xml.io.AbstractXMLObjectUnmarshaller.unmarshallAttribute(AbstractXMLObjectUnmarshaller.java:197)\r\n   >    at org.opensaml.core.xml.io.AbstractXMLObjectUnmarshaller.unmarshall(AbstractXMLObjectUnmarshaller.java:94)\r\n   >    at org.opensaml.core.xml.io.AbstractXMLObjectUnmarshaller.unmarshallChildElement(AbstractXMLObjectUnmarshaller.java:311)\r\n   >    at org.opensaml.core.xml.io.AbstractXMLObjectUnmarshaller.unmarshall(AbstractXMLObjectUnmarshaller.java:106)\r\n   >    at org.opensaml.core.xml.io.AbstractXMLObjectUnmarshaller.unmarshallChildElement(AbstractXMLObjectUnmarshaller.java:311)\r\n   >    at org.opensaml.core.xml.io.AbstractXMLObjectUnmarshaller.unmarshall(AbstractXMLObjectUnmarshaller.java:106)\r\n   >    at org.opensaml.saml.metadata.resolver.impl.AbstractMetadataResolver.unmarshallMetadata(AbstractMetadataResolver.java:352)\r\n   >    ... 48 moreThrowable #2: java.lang.NullPointerException\r\n   >    at org.elasticsearch.xpack.security.action.saml.TransportSamlLogoutActionTests.cleanup(TransportSamlLogoutActionTests.java:207)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:564)\r\n   >    at java.base/java.lang.Thread.run(Thread.java:844)\r\n\r\n```","closed_by":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"performed_via_github_app":null}