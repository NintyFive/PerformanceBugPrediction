[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/408728610","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-408728610","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":408728610,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODcyODYxMA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-30T02:20:13Z","updated_at":"2018-07-30T02:20:13Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409055171","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-409055171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":409055171,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTA1NTE3MQ==","user":{"login":"jdu-mydevices","id":33299623,"node_id":"MDQ6VXNlcjMzMjk5NjIz","avatar_url":"https://avatars1.githubusercontent.com/u/33299623?v=4","gravatar_id":"","url":"https://api.github.com/users/jdu-mydevices","html_url":"https://github.com/jdu-mydevices","followers_url":"https://api.github.com/users/jdu-mydevices/followers","following_url":"https://api.github.com/users/jdu-mydevices/following{/other_user}","gists_url":"https://api.github.com/users/jdu-mydevices/gists{/gist_id}","starred_url":"https://api.github.com/users/jdu-mydevices/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdu-mydevices/subscriptions","organizations_url":"https://api.github.com/users/jdu-mydevices/orgs","repos_url":"https://api.github.com/users/jdu-mydevices/repos","events_url":"https://api.github.com/users/jdu-mydevices/events{/privacy}","received_events_url":"https://api.github.com/users/jdu-mydevices/received_events","type":"User","site_admin":false},"created_at":"2018-07-31T00:31:20Z","updated_at":"2018-07-31T00:31:20Z","author_association":"NONE","body":"I searched the index again today, got some rollup result. I don't know when these result created.\r\nIf I recreate the index using another name `rollup_data_hours1`, after executed `GET _xpack/rollup/job/_all`,\r\nI got \r\n```\r\n      \"stats\": {\r\n        \"pages_processed\": 490,\r\n        \"documents_processed\": 405231,\r\n        \"rollups_indexed\": 15543,\r\n        \"trigger_count\": 473\r\n      }\r\n```\r\n\r\nBut I tried several times of search, no data returned.\r\n```\r\nGET /rollup_data_hours1/_search\r\n{\r\n      \"query\": {\r\n        \"match_all\": {}\r\n      }\r\n}\r\n```\r\n\r\nMaybe it's an timing issue?\r\nHow often will the job executed when `\"cron\": \"* */5 * * * ?\"`?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409206727","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-409206727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":409206727,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTIwNjcyNw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-07-31T12:41:34Z","updated_at":"2018-07-31T12:41:34Z","author_association":"MEMBER","body":"Hi @jdu-mydevices, I think the issue is just with the cron schedules.  Rollup uses the same [cron scheduling system as Watcher](https://www.elastic.co/guide/en/watcher/current/trigger.html#schedule-cron).  So you're two cron schedules are:\r\n\r\n- `* */5 * * * ?` : every five minutes\r\n- `* */30 * * * ?` : every 30 minutes\r\n\r\nWhen you create a job, it is created in a \"paused\" state (`stopped` is the status if you were to check the GetJobs API).  The job is created, can be interacted with, but isn't doing anything right now.\r\n\r\nAfter you start the job with the StartJob API, it moves to `started` state, but it isn't actively indexing yet.  It won't begin indexing until the cron is triggered (and the state will become `indexing`). So in this case, they won't start executing until five and 30 minutes after you started the job.\r\n\r\nDoes that help?\r\n\r\n> Also, I hope the result of metrics \"avg\" can also return the \"sum\" value in the result. now I can get _count only, so need to use the sum directly and then use sum/count to get the average.\r\n\r\nUnfortunately, right now Rollup can't do this.  It would be an obvious optimization to make in the future, but we skipped it in the first release for simplicity.  If you want the other metrics (`sum`, etc) you'll have to explicitly include it in the config too.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409308486","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-409308486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":409308486,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTMwODQ4Ng==","user":{"login":"jdu-mydevices","id":33299623,"node_id":"MDQ6VXNlcjMzMjk5NjIz","avatar_url":"https://avatars1.githubusercontent.com/u/33299623?v=4","gravatar_id":"","url":"https://api.github.com/users/jdu-mydevices","html_url":"https://github.com/jdu-mydevices","followers_url":"https://api.github.com/users/jdu-mydevices/followers","following_url":"https://api.github.com/users/jdu-mydevices/following{/other_user}","gists_url":"https://api.github.com/users/jdu-mydevices/gists{/gist_id}","starred_url":"https://api.github.com/users/jdu-mydevices/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdu-mydevices/subscriptions","organizations_url":"https://api.github.com/users/jdu-mydevices/orgs","repos_url":"https://api.github.com/users/jdu-mydevices/repos","events_url":"https://api.github.com/users/jdu-mydevices/events{/privacy}","received_events_url":"https://api.github.com/users/jdu-mydevices/received_events","type":"User","site_admin":false},"created_at":"2018-07-31T17:46:46Z","updated_at":"2018-07-31T17:46:46Z","author_association":"NONE","body":"Thanks @polyfractal!\r\nYeah, I know the schedules are 5 minutes and 30 minutes. But the problem was there were no indices created even after I waited several hours. I think there maybe some issues in the schedule. I'll try a newer version. Or maybe multiple jobs caused the issue. I'll clear all the jobs and indices and test again. \r\nI'm sure the jobs were started because when running the start command, I got the error `reason\": \"Cannot start task for Rollup Job [rollup_data_hours_job] because state was [STARTED]\"\r\n  }`. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409378185","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-409378185","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":409378185,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTM3ODE4NQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-07-31T21:45:15Z","updated_at":"2018-07-31T21:45:15Z","author_association":"MEMBER","body":"Hm ok, I agree it'd be best to start with a fresh cluster (delete all the jobs, remove all the rollup indices) and see if you can recreate it.  If you can find something that reproduces please paste the sequence of commands here and I'll investigate.  Definitely want to check it out if you've found a bug! A reproducible example would help a bunch.\r\n\r\nThanks!\r\n\r\nNote: it's possible for rollup jobs to point to the same rollup index, so perhaps the jobs were accidentally pointing to the same location and that's why it looked like the rollup index was never created?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409420644","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-409420644","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":409420644,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTQyMDY0NA==","user":{"login":"jdu-mydevices","id":33299623,"node_id":"MDQ6VXNlcjMzMjk5NjIz","avatar_url":"https://avatars1.githubusercontent.com/u/33299623?v=4","gravatar_id":"","url":"https://api.github.com/users/jdu-mydevices","html_url":"https://github.com/jdu-mydevices","followers_url":"https://api.github.com/users/jdu-mydevices/followers","following_url":"https://api.github.com/users/jdu-mydevices/following{/other_user}","gists_url":"https://api.github.com/users/jdu-mydevices/gists{/gist_id}","starred_url":"https://api.github.com/users/jdu-mydevices/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdu-mydevices/subscriptions","organizations_url":"https://api.github.com/users/jdu-mydevices/orgs","repos_url":"https://api.github.com/users/jdu-mydevices/repos","events_url":"https://api.github.com/users/jdu-mydevices/events{/privacy}","received_events_url":"https://api.github.com/users/jdu-mydevices/received_events","type":"User","site_admin":false},"created_at":"2018-08-01T01:39:17Z","updated_at":"2018-08-01T01:40:49Z","author_association":"NONE","body":"Seems it's a bug. I reproduced it again after deleted all the jobs and indices.\r\nAnd I am sure two jobs were started normally.\r\nI'll confirm again to see if the rollup result created.\r\nThere is no other special scripts, just what I posted above.\r\nBy the way, this time I changed 30 min to 15 min.\r\nThere were only about 10000 hits totally.\r\n```\r\nPOST _xpack/rollup/job/rollup_data_minutes_job/_start\r\n{\r\n  \"started\": true\r\n}\r\nPOST _xpack/rollup/job/rollup_data_hours_job/_start\r\n{\r\n  \"started\": true\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409622660","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-409622660","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":409622660,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTYyMjY2MA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-08-01T15:52:06Z","updated_at":"2018-08-01T15:52:06Z","author_association":"MEMBER","body":"I just noticed that you are rolling up a rollup index:  `\"index_pattern\": \"rollup_data_minutes*\",`\r\n\r\nThis is _technically_ possible today, but I would consider it an anti-pattern.  The fields/naming conventions inside of rollup docs are internal conventions, and liable to change if we ever need to reconfigure how data is stored.  That's why we provide the `_rollup_search` endpoint, to translate our internal conventions into something useful.\r\n\r\nIf you want both minute and hourly rollups, just configure two rollup jobs on the source data with the appropriate intervals.  I would not recommend rolling up a rollup index.  We may officially support that in the future, or may make it explicitly disallowed.  In either case it isn't tested right now.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409636441","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-409636441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":409636441,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTYzNjQ0MQ==","user":{"login":"jdu-mydevices","id":33299623,"node_id":"MDQ6VXNlcjMzMjk5NjIz","avatar_url":"https://avatars1.githubusercontent.com/u/33299623?v=4","gravatar_id":"","url":"https://api.github.com/users/jdu-mydevices","html_url":"https://github.com/jdu-mydevices","followers_url":"https://api.github.com/users/jdu-mydevices/followers","following_url":"https://api.github.com/users/jdu-mydevices/following{/other_user}","gists_url":"https://api.github.com/users/jdu-mydevices/gists{/gist_id}","starred_url":"https://api.github.com/users/jdu-mydevices/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdu-mydevices/subscriptions","organizations_url":"https://api.github.com/users/jdu-mydevices/orgs","repos_url":"https://api.github.com/users/jdu-mydevices/repos","events_url":"https://api.github.com/users/jdu-mydevices/events{/privacy}","received_events_url":"https://api.github.com/users/jdu-mydevices/received_events","type":"User","site_admin":false},"created_at":"2018-08-01T16:30:38Z","updated_at":"2018-08-01T16:30:38Z","author_association":"NONE","body":"Yes, I've tried configure two rollup jobs on the source data and it was working. But because the source data have about 8billion indicies, I think it will save some time to rollup hourly data based on minute rollups. Since what I am trying to do is not officially support, I will configure multiple jobs on the source data.\r\nthanks @polyfractal! ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409642142","html_url":"https://github.com/elastic/elasticsearch/issues/32446#issuecomment-409642142","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32446","id":409642142,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTY0MjE0Mg==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-08-01T16:46:55Z","updated_at":"2018-08-01T16:46:55Z","author_association":"MEMBER","body":"Noted!  We're waiting to decide if we should officially support \"chaining\" jobs together like you did, depending on how many people request the feature.  Or perhaps jobs that accept multiple intervals and internally do the same thing.  \r\n\r\nSo this is a useful data point, although I am sorry it isn't working for you right now.\r\n\r\nIf the jobs are going too slow, you might consider raising the `page_size`.  This controls how many buckets we ask the composite aggregation to return.  As long as you have sufficient memory on the node, a larger page size should help speed up the jobs.\r\n\r\nI'm going to go ahead and close this issue, but feel free to re-open if you run into problems with the regular jobs!","performed_via_github_app":null}]