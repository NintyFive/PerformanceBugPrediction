{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1575","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1575/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1575/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1575/events","html_url":"https://github.com/elastic/elasticsearch/issues/1575","id":2673357,"node_id":"MDU6SXNzdWUyNjczMzU3","number":1575,"title":"Two different indexes with the same nested object name causing ArrayIndexOutOfBoundsException","user":{"login":"jasongilman","id":192983,"node_id":"MDQ6VXNlcjE5Mjk4Mw==","avatar_url":"https://avatars1.githubusercontent.com/u/192983?v=4","gravatar_id":"","url":"https://api.github.com/users/jasongilman","html_url":"https://github.com/jasongilman","followers_url":"https://api.github.com/users/jasongilman/followers","following_url":"https://api.github.com/users/jasongilman/following{/other_user}","gists_url":"https://api.github.com/users/jasongilman/gists{/gist_id}","starred_url":"https://api.github.com/users/jasongilman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasongilman/subscriptions","organizations_url":"https://api.github.com/users/jasongilman/orgs","repos_url":"https://api.github.com/users/jasongilman/repos","events_url":"https://api.github.com/users/jasongilman/events{/privacy}","received_events_url":"https://api.github.com/users/jasongilman/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":204518,"node_id":"MDU6TGFiZWwyMDQ1MTg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.18.7","name":"v0.18.7","color":"DDDDDD","default":false,"description":null},{"id":174398,"node_id":"MDU6TGFiZWwxNzQzOTg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.19.0.RC1","name":"v0.19.0.RC1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2011-12-28T18:12:08Z","updated_at":"2011-12-28T20:20:19Z","closed_at":"2011-12-28T20:20:19Z","author_association":"NONE","active_lock_reason":null,"body":"If two different mappings are created within an index that both have a nested object with the same name an ArrayIndexOutOfBoundsException can occur during searches.  See this gist to reproduce: https://gist.github.com/1528898\n\nThe gist creates an index called main with two mappings alpha and bravo.  Alpha and bravo both have a nested object called charlies.  The gist indexes two alphas and a bravo.  Only the bravo has a nested document.  When searching for an alpha using a nested query an ArrayIndexOutOfBoundsException can occur.  This error only occurs if the alpha was indexed before the bravo.\n\nThis issue is related to the group discussion here: https://groups.google.com/group/elasticsearch/browse_thread/thread/486e7568f82c216a \n\nThe stack trace for the exception:\n\n```\norg.elasticsearch.search.query.QueryPhaseExecutionException: [main][1]: query[filtered(ConstantScore(org.elasticsearch.common.lucene.search.AndFilter@91837b24))->FilterCacheFilterWrapper(_type:alpha)],from[0],size[10]: Query Failed [Failed to execute main query]\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:221)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:238)\n    at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:134)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:80)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:205)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:192)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:178)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n    at java.lang.Thread.run(Thread.java:680)\nCaused by: java.lang.ArrayIndexOutOfBoundsException: -1\n    at org.apache.lucene.util.OpenBitSetIterator.advance(OpenBitSetIterator.java:166)\n    at org.elasticsearch.common.lucene.docset.AndDocIdSet$AndDocIdSetIterator.advance(AndDocIdSet.java:127)\n    at org.apache.lucene.search.DeletionAwareConstantScoreQuery$DeletionConstantScorer.advance(DeletionAwareConstantScoreQuery.java:91)\n    at org.apache.lucene.search.FilteredQuery$2.score(FilteredQuery.java:157)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:581)\n    at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:199)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:445)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:426)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:342)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:330)\n    at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:217)\n    ... 9 more\n```\n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}