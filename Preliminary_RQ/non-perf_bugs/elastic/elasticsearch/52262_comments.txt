[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/585649848","html_url":"https://github.com/elastic/elasticsearch/issues/52262#issuecomment-585649848","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52262","id":585649848,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTY0OTg0OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-02-13T10:09:26Z","updated_at":"2020-02-13T10:09:26Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo (:Analytics/Aggregations)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/585742610","html_url":"https://github.com/elastic/elasticsearch/issues/52262#issuecomment-585742610","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52262","id":585742610,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTc0MjYxMA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2020-02-13T12:58:52Z","updated_at":"2020-02-13T12:58:52Z","author_association":"MEMBER","body":"Terms agg definitely supports numerics and longs.  This appears to be an issue with `include`/`exclude`, probably some kind of parsing issue so that the parsed include value (parsed as bytes and converted to `long` later) is not matching the indexed `long` value.\r\n\r\nI tested briefly and a terms agg + query works as expected:\r\n\r\n```\r\nPOST long_bucketing_index/_search?\r\n{\r\n  \"query\": {\r\n    \"terms\": {\r\n      \"category_id\": [\"135314378855756999\", \"1353143788557567278\"]\r\n    }\r\n  },\r\n  \"aggs\": {\r\n    \"category\": {\r\n      \"terms\": {\r\n        \"field\": \"category_id\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nAs does a plain terms agg (no query or `include`).  Haven't had a chance to dig into the code to see what's going on, but I think this is indeed a bug.  Thanks for the report!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/624089007","html_url":"https://github.com/elastic/elasticsearch/issues/52262#issuecomment-624089007","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52262","id":624089007,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNDA4OTAwNw==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2020-05-05T14:27:59Z","updated_at":"2020-05-05T14:27:59Z","author_association":"MEMBER","body":"@jdcohen220 sorry for the delay and thank you for the detailed reproduction script. I was able to reproduce the issue on 7.5.1, but it is no longer reproducible on 7.6.2 and above. Could you try upgrading and let us know if you are still experiencing the issue.\r\n\r\nThe issue with \r\n```\r\n  \"category\": {\r\n      \"terms\": {\r\n        \"field\": \"category_id\",\r\n        \"include\": [\r\n          \"1353*\"\r\n        ]\r\n      }\r\n    }\r\n```\r\nis a bit different. In the `keyword_bucketing_index` it doesn't return anything because it is supposed to match only terms like `135`, `1353`, `13533`, `135333`, `13533333` and so on. Based on your example, I think you meant  `\"1353.*\"` here. \r\n\r\nIn case of `long_bucketing_index` in master we parse this value earlier now and therefore the error message changed. So, now it returns:\r\n```\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"number_format_exception\",\r\n        \"reason\" : \"For input string: \\\"1353.*\\\"\"\r\n      }\r\n    ],\r\n```\r\n@polyfractal, @not-napoleon not sure if this is a bug or a feature :smile: \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/626820632","html_url":"https://github.com/elastic/elasticsearch/issues/52262#issuecomment-626820632","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52262","id":626820632,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNjgyMDYzMg==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2020-05-11T16:48:34Z","updated_at":"2020-05-11T16:48:34Z","author_association":"MEMBER","body":"Since it is no longer reproducible I am going to close the issue. ","performed_via_github_app":null}]