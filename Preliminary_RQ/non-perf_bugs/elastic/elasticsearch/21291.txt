{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21291","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21291/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21291/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21291/events","html_url":"https://github.com/elastic/elasticsearch/issues/21291","id":186933135,"node_id":"MDU6SXNzdWUxODY5MzMxMzU=","number":21291,"title":"Context Suggester category filtering is not cumulative","user":{"login":"kabcampbell","id":15573793,"node_id":"MDQ6VXNlcjE1NTczNzkz","avatar_url":"https://avatars1.githubusercontent.com/u/15573793?v=4","gravatar_id":"","url":"https://api.github.com/users/kabcampbell","html_url":"https://github.com/kabcampbell","followers_url":"https://api.github.com/users/kabcampbell/followers","following_url":"https://api.github.com/users/kabcampbell/following{/other_user}","gists_url":"https://api.github.com/users/kabcampbell/gists{/gist_id}","starred_url":"https://api.github.com/users/kabcampbell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kabcampbell/subscriptions","organizations_url":"https://api.github.com/users/kabcampbell/orgs","repos_url":"https://api.github.com/users/kabcampbell/repos","events_url":"https://api.github.com/users/kabcampbell/events{/privacy}","received_events_url":"https://api.github.com/users/kabcampbell/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":20,"created_at":"2016-11-02T22:06:32Z","updated_at":"2018-09-29T22:53:21Z","closed_at":"2018-03-23T14:52:12Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**: 5.0.0\r\n\r\n**Plugins installed**: None\r\n\r\n**JVM version**: 1.8.0_101\r\n\r\n**OS version**: Ubuntu 16.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI have added multiple context mappings to a completion suggester field. In version 2.x and earlier, when filtering on those contexts, suggestions were only returned if they matched all of the contexts. But that does not seem to be the case with 5.0.0. \r\n\r\n**Steps to reproduce**:\r\n 1. Mapping for my suggest field:\r\n\r\n```\r\n\"suggest\": {\r\n  \"type\": \"completion\",\r\n  \"contexts\": [\r\n      {\r\n        \"name\": \"companyContext\",\r\n        \"type\": \"category\"\r\n     },\r\n     {\r\n        \"name\": \"usersContext\", \r\n        \"type\": \"category\"\r\n     }                     \r\n  ]\r\n}\r\n```\r\n2. Index a document with suggest field contexts populated:\r\n\r\n```\r\n\"suggest\": {\r\n    \"input\": \"test team site\",\r\n    \"contexts\": {\r\n        \"companyContext\": \"vendor\",\r\n        \"usersContext\": [\"chad\", \"fred\"]            \r\n    }        \r\n}\r\n```\r\n\r\n 3. Run a query supplying only one matching context:\r\n```\r\n\"suggest\": {\r\n   \"suggestions\": {\r\n        \"text\": \"tes\",\r\n        \"completion\": {\r\n            \"field\": \"suggest\",\r\n            \"contexts\":{\r\n                \"companyContext\": \"vendor\",\r\n                \"usersContext\": \"bill\"\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\nI would expect that this would not return the indexed document, because the usersContext is not a match. And that was the behavior in 2.x. But in 5.0.0, the document that matches only the companyContext is returned.\r\n\r\n\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}