{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2340","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2340/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2340/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2340/events","html_url":"https://github.com/elastic/elasticsearch/issues/2340","id":7714630,"node_id":"MDU6SXNzdWU3NzE0NjMw","number":2340,"title":"With cache turned off I'm getting the following error: nested: ClassCastException[org.apache.lucene.util.FixedBitSet cannot be cast to org.elasticsearch.common.lucene.docset.FixedBitDocSet]","user":{"login":"troszok","id":17826,"node_id":"MDQ6VXNlcjE3ODI2","avatar_url":"https://avatars0.githubusercontent.com/u/17826?v=4","gravatar_id":"","url":"https://api.github.com/users/troszok","html_url":"https://github.com/troszok","followers_url":"https://api.github.com/users/troszok/followers","following_url":"https://api.github.com/users/troszok/following{/other_user}","gists_url":"https://api.github.com/users/troszok/gists{/gist_id}","starred_url":"https://api.github.com/users/troszok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/troszok/subscriptions","organizations_url":"https://api.github.com/users/troszok/orgs","repos_url":"https://api.github.com/users/troszok/repos","events_url":"https://api.github.com/users/troszok/events{/privacy}","received_events_url":"https://api.github.com/users/troszok/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":16235704,"node_id":"MDU6TGFiZWwxNjIzNTcwNA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.19.11","name":"v0.19.11","color":"DDDDDD","default":false,"description":null},{"id":17100272,"node_id":"MDU6TGFiZWwxNzEwMDI3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.20.0","name":"v0.20.0","color":"DDDDDD","default":false,"description":null},{"id":17100279,"node_id":"MDU6TGFiZWwxNzEwMDI3OQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.0.Beta1","name":"v0.90.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2012-10-19T12:47:51Z","updated_at":"2012-10-25T16:38:07Z","closed_at":"2012-10-22T18:04:52Z","author_association":"NONE","active_lock_reason":null,"body":"While I develop I wanted to do be sure that nothing is cached so I turned off cache by placing:\n\n```\nindex.cache.filter.type: none\n```\n\nas I found in: http://elasticsearch-users.115913.n3.nabble.com/Disable-cache-td3825105.html\n\nI started getting following error:\n\n```\n{\"error\":\"SearchPhaseExecutionException[Failed to execute phase [query], total failure; shardFailures {[_TbZZ8pnTjCqa6SuzvttqQ][sentences][0]: QueryPhaseExecutionException[[sentences][0]: query[filtered(ConstantScore(NotDeleted(+authority_name:Cons. Stato +regulations.norm_number:[163 TO 163])))->org.elasticsearch.index.search.nested.NonNestedDocsFilter@a2a5984b],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ClassCastException[org.apache.lucene.util.FixedBitSet cannot be cast to org.elasticsearch.common.lucene.docset.FixedBitDocSet]; }{[_TbZZ8pnTjCqa6SuzvttqQ][sentences][2]: QueryPhaseExecutionException[[sentences][2]: query[filtered(ConstantScore(NotDeleted(+authority_name:Cons. Stato +regulations.norm_number:[163 TO 163])))->org.elasticsearch.index.search.nested.NonNestedDocsFilter@a2a5984b],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ClassCastException[org.apache.lucene.util.FixedBitSet cannot be cast to org.elasticsearch.common.lucene.docset.FixedBitDocSet]; }{[_TbZZ8pnTjCqa6SuzvttqQ][sentences][3]: QueryPhaseExecutionException[[sentences][3]: query[filtered(ConstantScore(NotDeleted(+authority_name:Cons. Stato +regulations.norm_number:[163 TO 163])))->org.elasticsearch.index.search.nested.NonNestedDocsFilter@a2a5984b],from[0],size[10]: Query Failed [Failed to execute main query]]; nested: ClassCastException[org.apache.lucene.util.FixedBitSet cannot be cast to org.elasticsearch.common.lucene.docset.FixedBitDocSet]; }]\n```\n\nWhen executing the following query:\n\n```\ncurl http://localhost:9200/sentences/_search -d '\n{\n    \"query\": {\n        \"filtered\": {\n            \"query\": {\n                \"match_all\": { }   \n            },\n            \"filter\": {\n                \"and\": [\n                    { \"term\": { \"authority_name\": \"Cons. Stato\" } },\n                    { \"term\": { \"regulations.norm_number\": 163 } }\n                ]\n            }\n        }\n    },\n    \"facets\": {\n        \"regulation_name\": {\n            \"terms\": { \"field\": \"name\" },\n            \"facet_filter\": [ { \"term\": { \"norm_number\": 163 } } ],\n            \"nested\": \"regulations\"\n        }\n    }\n}'\n```\n\nThe error is gone after cancelling the cache line from the config. \n\nI don't know internals of ES so I cannot say if nested facet_filter should work or not with cache\nturned off but I think the error is a little bit misleading and I lost a little bit of time searching for solution. \n\nI spoke on irc about that and someone asked me to open a ticket so here it is ;)\n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}