{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38798","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38798/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38798/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38798/events","html_url":"https://github.com/elastic/elasticsearch/issues/38798","id":409394212,"node_id":"MDU6SXNzdWU0MDkzOTQyMTI=","number":38798,"title":"Disabling xpack watcher causes NPE when Elasticsearch is shutdown","user":{"login":"ctluce","id":1627924,"node_id":"MDQ6VXNlcjE2Mjc5MjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1627924?v=4","gravatar_id":"","url":"https://api.github.com/users/ctluce","html_url":"https://github.com/ctluce","followers_url":"https://api.github.com/users/ctluce/followers","following_url":"https://api.github.com/users/ctluce/following{/other_user}","gists_url":"https://api.github.com/users/ctluce/gists{/gist_id}","starred_url":"https://api.github.com/users/ctluce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctluce/subscriptions","organizations_url":"https://api.github.com/users/ctluce/orgs","repos_url":"https://api.github.com/users/ctluce/repos","events_url":"https://api.github.com/users/ctluce/events{/privacy}","received_events_url":"https://api.github.com/users/ctluce/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"assignees":[{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-02-12T16:42:19Z","updated_at":"2019-02-13T23:13:14Z","closed_at":"2019-02-13T23:13:14Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 6.6.0, Build: default/tar/a9861f4/2019-01-24T11:27:09.439740Z, JVM: 1.8.0_181\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_181\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_181-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux 4.14.94-73.73.amzn1.x86_64 #1 SMP Tue Jan 22 20:25:24 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen xpack watcher is disabled and Elasticsearch is shutdown an NPE is thrown.  When xpack watcher is disabled Elasticsearch should not throw NPE when shutting down.  With xpack watcher enabled then NPE is not thrown.\r\n\r\n**Steps to reproduce**:\r\n 1. Download Elasticsearch 6.6.0\r\n 2. Add xpack.watcher.enabled: false to elasticsearch.yml\r\n 3. Start Elasticsearch then stop it, NPE is thrown.\r\n\r\n**Provide logs (if relevant)**:\r\n[2019-02-12T11:39:27,043][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [Oec7bQh] uncaught exception in thread [Thread-2]\r\njava.lang.NullPointerException: null\r\n\tat org.elasticsearch.xpack.watcher.Watcher.close(Watcher.java:700) ~[?:?]\r\n\tat org.elasticsearch.core.internal.io.IOUtils.close(IOUtils.java:103) ~[elasticsearch-core-6.6.0.jar:6.6.0]\r\n\tat org.elasticsearch.core.internal.io.IOUtils.close(IOUtils.java:85) ~[elasticsearch-core-6.6.0.jar:6.6.0]\r\n\tat org.elasticsearch.node.Node.close(Node.java:919) ~[elasticsearch-6.6.0.jar:6.6.0]\r\n\tat org.elasticsearch.core.internal.io.IOUtils.close(IOUtils.java:103) ~[elasticsearch-core-6.6.0.jar:6.6.0]\r\n\tat org.elasticsearch.core.internal.io.IOUtils.close(IOUtils.java:61) ~[elasticsearch-core-6.6.0.jar:6.6.0]\r\n\tat org.elasticsearch.bootstrap.Bootstrap$4.run(Bootstrap.java:184) ~[elasticsearch-6.6.0.jar:6.6.0]","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}