{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25304","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25304/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25304/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25304/events","html_url":"https://github.com/elastic/elasticsearch/issues/25304","id":237050418,"node_id":"MDU6SXNzdWUyMzcwNTA0MTg=","number":25304,"title":"Null pointer exception when using _score in a script query","user":{"login":"msimos","id":11743255,"node_id":"MDQ6VXNlcjExNzQzMjU1","avatar_url":"https://avatars3.githubusercontent.com/u/11743255?v=4","gravatar_id":"","url":"https://api.github.com/users/msimos","html_url":"https://github.com/msimos","followers_url":"https://api.github.com/users/msimos/followers","following_url":"https://api.github.com/users/msimos/following{/other_user}","gists_url":"https://api.github.com/users/msimos/gists{/gist_id}","starred_url":"https://api.github.com/users/msimos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msimos/subscriptions","organizations_url":"https://api.github.com/users/msimos/orgs","repos_url":"https://api.github.com/users/msimos/repos","events_url":"https://api.github.com/users/msimos/events{/privacy}","received_events_url":"https://api.github.com/users/msimos/received_events","type":"User","site_admin":false},"labels":[{"id":534335216,"node_id":"MDU6TGFiZWw1MzQzMzUyMTY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.4.0","name":"v5.4.0","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-06-19T23:20:10Z","updated_at":"2017-06-20T11:40:50Z","closed_at":"2017-06-20T11:40:50Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**:\r\n\r\nElasticsearch 5.4.0\r\n\r\n**Plugins installed**: []\r\n\r\nX-Pack\r\n\r\n**JVM version** (`java -version`):\r\n\r\n1.8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\nFedora Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nThis example:\r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-using.html#_request_examples\r\n\r\nResults in a null pointer exception:\r\n\r\n        \"reason\": {\r\n          \"type\": \"null_pointer_exception\",\r\n          \"reason\": null\r\n        }\r\n\r\nIn the logs you see:\r\n\r\nCaused by: java.lang.NullPointerException\r\n        at org.elasticsearch.painless.ScriptImpl.getScore(ScriptImpl.java:187) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl$$Lambda$2467/72004285.apply(Unknown Source) ~[?:?]\r\n        at org.elasticsearch.painless.ScriptImpl.run(ScriptImpl.java:133) ~[?:?]\r\n        at org.elasticsearch.index.query.ScriptQueryBuilder$ScriptQuery$1$1.get(ScriptQueryBuilder.java:186) ~[elasticsearch-5.4.0.jar:5.4.0]\r\n\r\nIs this appropriate to access _score in a script query? And would it be correct to instead use a script_score instead to calculate the score. Not sure if this is a bug or just a documentation issue since the error doesn't tell you anything about what is wrong. \r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Copy and paste the example here:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-using.html#_request_examples\r\n\r\n 2. Run query and it results in a null pointer exception\r\n\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}