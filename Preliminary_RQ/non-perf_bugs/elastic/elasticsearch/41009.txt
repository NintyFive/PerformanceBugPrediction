{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41009","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41009/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41009/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41009/events","html_url":"https://github.com/elastic/elasticsearch/issues/41009","id":430960972,"node_id":"MDU6SXNzdWU0MzA5NjA5NzI=","number":41009,"title":"Shared filesystem repository does not respect readonly setting","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1169037769,"node_id":"MDU6TGFiZWwxMTY5MDM3NzY5","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.6.1","name":"v6.6.1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-04-09T13:14:46Z","updated_at":"2019-04-17T07:34:08Z","closed_at":"2019-04-17T07:34:08Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"A user reports the following exception when restoring a snapshot from a readonly filesystem:\r\n\r\n```\r\n[2019-04-05T21:46:35,634][WARN ][o.e.s.RestoreService ] [REDACTED] [REDACTED:REDACTED] failed to restore snapshot \r\norg.elasticsearch.ElasticsearchException: failed to create blob container \r\nat org.elasticsearch.common.blobstore.fs.FsBlobStore.blobContainer(FsBlobStore.java:71) ~[elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.repositories.blobstore.BlobStoreRepository.getSnapshotIndexMetaData(BlobStoreRepository.java:591) ~[elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.snapshots.RestoreService.restoreSnapshot(RestoreService.java:210) [elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.action.admin.cluster.snapshots.restore.TransportRestoreSnapshotAction.masterOperation(TransportRestoreSnapshotAction.java:91) [elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.action.admin.cluster.snapshots.restore.TransportRestoreSnapshotAction.masterOperation(TransportRestoreSnapshotAction.java:49) [elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.action.support.master.TransportMasterNodeAction.masterOperation(TransportMasterNodeAction.java:124) [elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$2.doRun(TransportMasterNodeAction.java:211) [elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:759) [elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.6.1.jar:6.6.1] \r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?] \r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?] \r\nat java.lang.Thread.run(Thread.java:834) [?:?] \r\nCaused by: java.nio.file.FileSystemException: REDACTED: Read-only file system \r\nat sun.nio.fs.UnixException.translateToIOException(UnixException.java:100) ~[?:?] \r\nat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111) ~[?:?] \r\nat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116) ~[?:?] \r\nat sun.nio.fs.UnixFileSystemProvider.createDirectory(UnixFileSystemProvider.java:385) ~[?:?] \r\nat java.nio.file.Files.createDirectory(Files.java:689) ~[?:?] \r\nat java.nio.file.Files.createAndCheckIsDirectory(Files.java:796) ~[?:?] \r\nat java.nio.file.Files.createDirectories(Files.java:782) ~[?:?] \r\nat org.elasticsearch.common.blobstore.fs.FsBlobStore.buildAndCreate(FsBlobStore.java:88) ~[elasticsearch-6.6.1.jar:6.6.1] \r\nat org.elasticsearch.common.blobstore.fs.FsBlobStore.blobContainer(FsBlobStore.java:69) ~[elasticsearch-6.6.1.jar:6.6.1] \r\n... 11 more \r\n```\r\n\r\nThe following line looks to be bogus, because it checks for the `readonly` property of the node's settings rather than the repository metadata:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/022726011ce1d9e4748fd39293a3aeae6954b3ac/server/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobStore.java#L45\r\n\r\nRelates #26909\r\n\r\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}