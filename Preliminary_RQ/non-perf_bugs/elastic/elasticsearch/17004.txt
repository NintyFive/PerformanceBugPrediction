{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17004","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17004/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17004/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17004/events","html_url":"https://github.com/elastic/elasticsearch/issues/17004","id":139285231,"node_id":"MDU6SXNzdWUxMzkyODUyMzE=","number":17004,"title":"Consider adding RFC822 file type (email files) parser to the Tika processor","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-03-08T14:01:19Z","updated_at":"2018-07-12T19:49:47Z","closed_at":"2018-07-12T19:49:47Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"As a consequence of the clean up in the mapper attachments plugin (https://github.com/elastic/elasticsearch-mapper-attachments/issues/163) only few basic file types parsers have been kept around and for a good reason, as Tika tries to parse a very wide range of types.\n\nI believe the .eml (rfc822) file type parser to be one of the basics and, if possible, to be added back on the list of allowed types (https://github.com/elastic/elasticsearch/blob/v2.2.0/plugins/mapper-attachments/src/main/java/org/elasticsearch/mapper/attachments/TikaImpl.java#L57-L71).\n\nAttached is a sample email file that is using base64 already to encode the content of the file itself. With ES 2.1.2 (and mapper attachments plugin 3.1.2) using the following [gist](https://gist.github.com/astefan/3e4d357ebf472b6709af) and [taking a look at the indexed content and content_type](https://gist.github.com/astefan/ee3d71d029911adfe31e) would reveal the following:\n\n```\n            \"fields\": {\n               \"indexedBody.content_type\": [\n                  \"message\",\n                  \"rfc822\"\n               ],\n               \"indexedBody.content\": [\n                  \"as\",\n                  \"awesome\",\n                  \"elasticsearch\",\n                  \"is\",\n                  \"lucene\",\n                  \"well\"\n               ]\n            }\n```\n\nWith ES 2.2.0 and mapper attachments plugin, the same setup and query shows that the file type is not properly recognized anymore, the already base64 encoded text is not decoded properly and the .eml file is considered a simple text file:\n\n```\n            \"fields\": {\n               \"indexedBody.content_type\": [\n                  \"1252\",\n                  \"charset\",\n                  \"plain\",\n                  \"text\",\n                  \"windows\"\n               ],\n               \"indexedBody.content\": [\n                  \"1.0\",\n                  \"6003.1\",\n                  \"8\",\n                  \"_part_0_663220121.1456846121442\",\n                  \"alternative\",\n                  \"base64\",\n                  \"bcc\",\n                  \"boundary\",\n.....\n                  \"multipart\",\n                  \"plain\",\n                  \"rwxhc3rpy3nlyxjjacbpcybhd2vzb21liq\",\n                  \"subject\",\n                  \"test\",\n                  \"test.com\",\n...\n               ]\n            }\n```\n\n[test_mail_01.eml.txt](https://github.com/elastic/elasticsearch/files/163248/test_mail_01.eml.txt)\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}