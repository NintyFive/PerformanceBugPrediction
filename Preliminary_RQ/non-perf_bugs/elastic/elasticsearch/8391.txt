{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8391","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8391/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8391/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8391/events","html_url":"https://github.com/elastic/elasticsearch/issues/8391","id":48101713,"node_id":"MDU6SXNzdWU0ODEwMTcxMw==","number":8391,"title":"1.4.0 Children aggregation returns empty buckets","user":{"login":"marekmalek","id":1080280,"node_id":"MDQ6VXNlcjEwODAyODA=","avatar_url":"https://avatars3.githubusercontent.com/u/1080280?v=4","gravatar_id":"","url":"https://api.github.com/users/marekmalek","html_url":"https://github.com/marekmalek","followers_url":"https://api.github.com/users/marekmalek/followers","following_url":"https://api.github.com/users/marekmalek/following{/other_user}","gists_url":"https://api.github.com/users/marekmalek/gists{/gist_id}","starred_url":"https://api.github.com/users/marekmalek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marekmalek/subscriptions","organizations_url":"https://api.github.com/users/marekmalek/orgs","repos_url":"https://api.github.com/users/marekmalek/repos","events_url":"https://api.github.com/users/marekmalek/events{/privacy}","received_events_url":"https://api.github.com/users/marekmalek/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-11-07T16:32:17Z","updated_at":"2014-11-07T17:22:11Z","closed_at":"2014-11-07T17:22:11Z","author_association":"NONE","active_lock_reason":null,"body":"I have been trying to test this feature with guide data as follow:\n\n```\nPUT /company\n{\n  \"mappings\": {\n    \"branch\": {},\n    \"employee\": {\n      \"_parent\": {\n        \"type\": \"branch\" \n      }\n    }\n  }\n}\n\nPOST /company/branch/_bulk\n{ \"index\": { \"_id\": \"london\" }}\n{ \"name\": \"London Westminster\", \"city\": \"London\", \"country\": \"UK\" }\n{ \"index\": { \"_id\": \"liverpool\" }}\n{ \"name\": \"Liverpool Central\", \"city\": \"Liverpool\", \"country\": \"UK\" }\n{ \"index\": { \"_id\": \"paris\" }}\n{ \"name\": \"Champs Élysées\", \"city\": \"Paris\", \"country\": \"France\" }\n\nPOST /company/employee/_bulk\n{ \"index\": { \"_id\": 2, \"parent\": \"london\" }}\n{ \"name\": \"Mark Thomas\", \"dob\": \"1982-05-16\", \"hobby\": \"diving\" }\n{ \"index\": { \"_id\": 3, \"parent\": \"liverpool\" }}\n{ \"name\": \"Barry Smith\", \"dob\": \"1979-04-01\", \"hobby\": \"hiking\" }\n{ \"index\": { \"_id\": 4, \"parent\": \"paris\" }}\n{ \"name\": \"Adrien Grand\", \"dob\": \"1987-05-11\", \"hobby\": \"horses\" }\n```\n\nand execute the same query as here:\nhttp://www.elasticsearch.org/guide/en/elasticsearch/guide/current/children-agg.html\n\n```\nGET /company/branch/_search?search_type=count\n{\n  \"aggs\": {\n    \"country\": {\n      \"terms\": { \n        \"field\": \"country\"\n      },\n      \"aggs\": {\n        \"employees\": {\n          \"children\": { \n            \"type\": \"employee\"\n          },\n          \"aggs\": {\n            \"hobby\": {\n              \"terms\": { \n                \"field\": \"hobby\"\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nA response is:\n\n```\n{\n   \"took\": 87,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 3,\n      \"max_score\": 0,\n      \"hits\": []\n   },\n   \"aggregations\": {\n      \"country\": {\n         \"doc_count_error_upper_bound\": 0,\n         \"sum_other_doc_count\": 0,\n         \"buckets\": [\n            {\n               \"key\": \"uk\",\n               \"doc_count\": 2,\n               \"employees\": {\n                  \"doc_count\": 2,\n                  \"hobby\": {\n                     \"doc_count_error_upper_bound\": 0,\n                     \"sum_other_doc_count\": 0,\n                     \"buckets\": []\n                  }\n               }\n            },\n            {\n               \"key\": \"france\",\n               \"doc_count\": 1,\n               \"employees\": {\n                  \"doc_count\": 1,\n                  \"hobby\": {\n                     \"doc_count_error_upper_bound\": 0,\n                     \"sum_other_doc_count\": 0,\n                     \"buckets\": []\n                  }\n               }\n            }\n         ]\n      }\n   }\n}\n```\n\nAs you can see countries are grouped correctly but buckets for hobbies are empty.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}