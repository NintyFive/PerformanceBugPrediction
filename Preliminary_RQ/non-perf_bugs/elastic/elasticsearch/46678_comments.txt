[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530922091","html_url":"https://github.com/elastic/elasticsearch/issues/46678#issuecomment-530922091","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46678","id":530922091,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDkyMjA5MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T17:19:21Z","updated_at":"2019-09-12T17:19:21Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/531028202","html_url":"https://github.com/elastic/elasticsearch/issues/46678#issuecomment-531028202","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46678","id":531028202,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTAyODIwMg==","user":{"login":"rtkgjacobs","id":42047335,"node_id":"MDQ6VXNlcjQyMDQ3MzM1","avatar_url":"https://avatars0.githubusercontent.com/u/42047335?v=4","gravatar_id":"","url":"https://api.github.com/users/rtkgjacobs","html_url":"https://github.com/rtkgjacobs","followers_url":"https://api.github.com/users/rtkgjacobs/followers","following_url":"https://api.github.com/users/rtkgjacobs/following{/other_user}","gists_url":"https://api.github.com/users/rtkgjacobs/gists{/gist_id}","starred_url":"https://api.github.com/users/rtkgjacobs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rtkgjacobs/subscriptions","organizations_url":"https://api.github.com/users/rtkgjacobs/orgs","repos_url":"https://api.github.com/users/rtkgjacobs/repos","events_url":"https://api.github.com/users/rtkgjacobs/events{/privacy}","received_events_url":"https://api.github.com/users/rtkgjacobs/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T22:17:11Z","updated_at":"2019-09-12T22:17:11Z","author_association":"NONE","body":"Don't hesitate to reach out to me if you need more data, material or assistance in investigation of this reported issue. Thanks. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/531029336","html_url":"https://github.com/elastic/elasticsearch/issues/46678#issuecomment-531029336","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46678","id":531029336,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTAyOTMzNg==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T22:21:36Z","updated_at":"2019-09-12T22:21:36Z","author_association":"MEMBER","body":"> Don't hesitate to reach out to me if you need more data, material or assistance in investigation of this reported issue. \r\n\r\nThanks @gregwjacobs :).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/531788847","html_url":"https://github.com/elastic/elasticsearch/issues/46678#issuecomment-531788847","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46678","id":531788847,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTc4ODg0Nw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-09-16T13:58:11Z","updated_at":"2019-09-16T13:58:11Z","author_association":"CONTRIBUTOR","body":"The stack trace suggests that the problem is with an update request whose response has somehow lost the id field.\r\n\r\n@rtkgjacobs can you share the full input with me? Please send an e-mail to yannick AT elastic co\r\n\r\nThank you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/531794521","html_url":"https://github.com/elastic/elasticsearch/issues/46678#issuecomment-531794521","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46678","id":531794521,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTc5NDUyMQ==","user":{"login":"rtkgjacobs","id":42047335,"node_id":"MDQ6VXNlcjQyMDQ3MzM1","avatar_url":"https://avatars0.githubusercontent.com/u/42047335?v=4","gravatar_id":"","url":"https://api.github.com/users/rtkgjacobs","html_url":"https://github.com/rtkgjacobs","followers_url":"https://api.github.com/users/rtkgjacobs/followers","following_url":"https://api.github.com/users/rtkgjacobs/following{/other_user}","gists_url":"https://api.github.com/users/rtkgjacobs/gists{/gist_id}","starred_url":"https://api.github.com/users/rtkgjacobs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rtkgjacobs/subscriptions","organizations_url":"https://api.github.com/users/rtkgjacobs/orgs","repos_url":"https://api.github.com/users/rtkgjacobs/repos","events_url":"https://api.github.com/users/rtkgjacobs/events{/privacy}","received_events_url":"https://api.github.com/users/rtkgjacobs/received_events","type":"User","site_admin":false},"created_at":"2019-09-16T14:10:25Z","updated_at":"2019-09-16T14:10:25Z","author_association":"NONE","body":"(emailed pcap of above captured issue directly to yannick)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/531847127","html_url":"https://github.com/elastic/elasticsearch/issues/46678#issuecomment-531847127","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46678","id":531847127,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTg0NzEyNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-09-16T16:11:01Z","updated_at":"2019-09-16T16:11:01Z","author_association":"CONTRIBUTOR","body":"Quick update here. While I have not tried yet to reproduce this with the provided inputs, I was able to identify an issue when using auto-generated IDs + the [ingest drop processor](https://www.elastic.co/guide/en/elasticsearch/reference/master/drop-processor.html) (which looks to be used by filebeat as well) where such a NullPointerException could be produced.\r\n\r\nThe issue is that [`markCurrentItemAsDropped()`](https://github.com/elastic/elasticsearch/blob/192845be8df9879c5afb2def898a696f04a72493/server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java#L672) is creating an `UpdateResponse` with no id when the request contains auto-generated IDs. The response serialization is lenient for our REST/XContent format (i.e. we will send `\"id\" : null`) but the internal transport format (used for communication between nodes) assumes for this field to be non-null, which means that it can't be serialized between nodes. Bulk requests with ingest functionality are processed on the coordinating node if the node has the ingest capability, and only otherwise sent to a different node. This means that, in order to reproduce this, one needs two nodes, with the coordinating node not having the ingest functionality, just as @rtkgjacobs has outlined in the opening post.\r\n\r\nI'm looking into our options on how to patch this.","performed_via_github_app":null}]