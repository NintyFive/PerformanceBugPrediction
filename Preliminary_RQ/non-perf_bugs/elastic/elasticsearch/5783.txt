{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5783","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5783/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5783/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5783/events","html_url":"https://github.com/elastic/elasticsearch/issues/5783","id":31367280,"node_id":"MDU6SXNzdWUzMTM2NzI4MA==","number":5783,"title":"HasChild query picks wrong type","user":{"login":"MrHash","id":390925,"node_id":"MDQ6VXNlcjM5MDkyNQ==","avatar_url":"https://avatars3.githubusercontent.com/u/390925?v=4","gravatar_id":"","url":"https://api.github.com/users/MrHash","html_url":"https://github.com/MrHash","followers_url":"https://api.github.com/users/MrHash/followers","following_url":"https://api.github.com/users/MrHash/following{/other_user}","gists_url":"https://api.github.com/users/MrHash/gists{/gist_id}","starred_url":"https://api.github.com/users/MrHash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MrHash/subscriptions","organizations_url":"https://api.github.com/users/MrHash/orgs","repos_url":"https://api.github.com/users/MrHash/repos","events_url":"https://api.github.com/users/MrHash/events{/privacy}","received_events_url":"https://api.github.com/users/MrHash/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"assignees":[{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2014-04-11T22:26:50Z","updated_at":"2014-07-11T06:53:34Z","closed_at":"2014-04-22T15:29:42Z","author_association":"NONE","active_lock_reason":null,"body":"Given the following setup:\n\n```\ncurl -XPUT 'http://localhost:9200/haschildtest/'\n\ncurl -XPUT 'localhost:9200/haschildtest/posts/_mapping' -d '\n{\n   \"posts\":{\n      \"_parent\":{\n         \"type\":\"features\"\n      },\n      \"_routing\":{\n         \"required\":true\n      }\n   }\n}'\n\ncurl -XPUT 'localhost:9200/haschildtest/features/feature1' -d '\n{\n   \"title\": \"feature title 1\"\n}'\n\ncurl -XPUT 'localhost:9200/haschildtest/posts/post1?parent=feature1' -d '\n{\n   \"specials\":{\n      \"title\": \"jack\"\n   }\n}'\n\ncurl -XPUT 'localhost:9200/haschildtest/specials/special1' -d '\n{\n   \"title\": \"this somehow interferes with the has_child query\"\n}'\n```\n\nThis query runs correctly:\n\n```\ncurl -XPOST 'localhost:9200/haschildtest/features/_search?pretty=true' -d '\n{\n   \"query\": {\n      \"has_child\": {\n         \"type\": \"posts\",\n         \"query\": {\n            \"match\": {\n               \"specials.title\": \"jack\"\n            }\n         }\n      }\n   }\n}'\n```\n\nWhereas this query with the parent type specifed after the query, fails:\n\n```\ncurl -XPOST 'localhost:9200/haschildtest/features/_search?pretty=true' -d '\n{\n   \"query\": {\n      \"has_child\": {\n         \"query\": {\n            \"match\": {\n               \"specials.title\": \"jack\"\n            }\n         },\n         \"type\": \"posts\"\n      }\n   }\n}'\n```\n\nSomehow the second example is picking the `specials` type `title` field instead of the type specified in the `has_child` block. I have tested this on ES 1.0.2 and took me a while to figure out what was going on...\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}