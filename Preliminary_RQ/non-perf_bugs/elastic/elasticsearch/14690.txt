{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14690","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14690/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14690/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14690/events","html_url":"https://github.com/elastic/elasticsearch/issues/14690","id":116356471,"node_id":"MDU6SXNzdWUxMTYzNTY0NzE=","number":14690,"title":"Newrelic agent with 2.0.0","user":{"login":"krisb78","id":222033,"node_id":"MDQ6VXNlcjIyMjAzMw==","avatar_url":"https://avatars3.githubusercontent.com/u/222033?v=4","gravatar_id":"","url":"https://api.github.com/users/krisb78","html_url":"https://github.com/krisb78","followers_url":"https://api.github.com/users/krisb78/followers","following_url":"https://api.github.com/users/krisb78/following{/other_user}","gists_url":"https://api.github.com/users/krisb78/gists{/gist_id}","starred_url":"https://api.github.com/users/krisb78/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krisb78/subscriptions","organizations_url":"https://api.github.com/users/krisb78/orgs","repos_url":"https://api.github.com/users/krisb78/repos","events_url":"https://api.github.com/users/krisb78/events{/privacy}","received_events_url":"https://api.github.com/users/krisb78/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"assignees":[{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2015-11-11T15:22:43Z","updated_at":"2015-11-12T23:09:12Z","closed_at":"2015-11-12T23:09:12Z","author_association":"NONE","active_lock_reason":null,"body":"Posting this in case its related to https://github.com/elastic/elasticsearch/issues/13785 \n\nI'm trying to run ES 2.0.0 with a newrelic agent, but I'm getting\n\n```\nException in thread \"main\" java.lang.IllegalStateException: failed to load bundle [] due to jar hell\nLikely root cause: java.security.AccessControlException: access denied (\"java.io.FilePermission\" \"/usr/local/newrelic/newrelic.jar\" \"read\")\n```\n\nSee complete log below:\n\n```\nroot@cubitsearch-client-1:~# sudo -u elasticsearch /usr/bin/java -Xms3g -Xmx3g -Xmn200m -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Dnewrelic.config.file=/usr/local/newrelic/elasticsearch.yml -javaagent:/usr/local/newrelic/newrelic.jar -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/elasticsearch-2.0.0.jar:/usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch start -Des.default.path.home=/usr/share/elasticsearch -Des.default.path.logs=/var/log/elasticsearch -Des.default.path.data=/var/lib/elasticsearch -Des.default.path.work=/tmp/elasticsearch -Des.default.path.conf=/etc/elasticsearch -Des.max-open-files=true\nNov 11, 2015 12:16:17 +0000 [1946 1] com.newrelic INFO: New Relic Agent: Loading configuration file \"/usr/local/newrelic/elasticsearch.yml\"\nNov 11, 2015 12:16:17 +0000 [1946 1] com.newrelic WARN: New Relic Agent: Unable to write log file: /var/log/newrelic/newrelic_agent.log. Please check permissions on the file and directory.\nlog4j:WARN No appenders could be found for logger (com.newrelic.agent.deps.org.apache.http.client.protocol.RequestAddCookies).\nlog4j:WARN Please initialize the log4j system properly.\nlog4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.\n[2015-11-11 12:16:54,791][INFO ][bootstrap                ] max_open_files [4096]\n[2015-11-11 12:16:56,233][INFO ][node                     ] [cubitsearch-client-1] version[2.0.0], pid[1946], build[de54438/2015-10-22T08:09:48Z]\n[2015-11-11 12:16:56,233][INFO ][node                     ] [cubitsearch-client-1] initializing ...\nException in thread \"main\" java.lang.IllegalStateException: failed to load bundle [] due to jar hell\nLikely root cause: java.security.AccessControlException: access denied (\"java.io.FilePermission\" \"/usr/local/newrelic/newrelic.jar\" \"read\")\n    at java.security.AccessControlContext.checkPermission(AccessControlContext.java:372)\n    at java.security.AccessController.checkPermission(AccessController.java:559)\n    at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\n    at java.lang.SecurityManager.checkRead(SecurityManager.java:888)\n    at java.util.zip.ZipFile.<init>(ZipFile.java:206)\n    at java.util.zip.ZipFile.<init>(ZipFile.java:145)\n    at java.util.jar.JarFile.<init>(JarFile.java:154)\n    at java.util.jar.JarFile.<init>(JarFile.java:91)\n    at org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:173)\n    at org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:340)\n    at org.elasticsearch.plugins.PluginsService.<init>(PluginsService.java:113)\n    at org.elasticsearch.node.Node.<init>(Node.java:144)\n    at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:145)\n    at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:170)\n    at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:270)\n    at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)\nRefer to the log for complete error details.\n```\n\nI tried setting a custom java policy for my `elasticsearch` user by creating `/usr/share/elasticsearch/.java.policy` with the following content:\n\n```\ngrant codeBase \"file:/usr/local/newrelic/-\" {\n       permission java.security.AllPermission;\n       permission java.net.SocketPermission \"*.newrelic.com\", \"connect,accept,resolve\";\n};\n```\n\n, but to no effect.\n\nI also tried to add the above to the global java policy, but it didn't work either.\n\nI managed to get the agent to work by disabling the security manager entirely (`-Dsecurity.manager.enabled=false`), but I don't really want to do this in production.\n","closed_by":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"performed_via_github_app":null}