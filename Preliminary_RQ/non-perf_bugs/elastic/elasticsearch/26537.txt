{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26537","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26537/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26537/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26537/events","html_url":"https://github.com/elastic/elasticsearch/issues/26537","id":255986208,"node_id":"MDU6SXNzdWUyNTU5ODYyMDg=","number":26537,"title":"Incorrect search results with transport client","user":{"login":"igorbunova","id":10805589,"node_id":"MDQ6VXNlcjEwODA1NTg5","avatar_url":"https://avatars0.githubusercontent.com/u/10805589?v=4","gravatar_id":"","url":"https://api.github.com/users/igorbunova","html_url":"https://github.com/igorbunova","followers_url":"https://api.github.com/users/igorbunova/followers","following_url":"https://api.github.com/users/igorbunova/following{/other_user}","gists_url":"https://api.github.com/users/igorbunova/gists{/gist_id}","starred_url":"https://api.github.com/users/igorbunova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/igorbunova/subscriptions","organizations_url":"https://api.github.com/users/igorbunova/orgs","repos_url":"https://api.github.com/users/igorbunova/repos","events_url":"https://api.github.com/users/igorbunova/events{/privacy}","received_events_url":"https://api.github.com/users/igorbunova/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-09-07T15:52:33Z","updated_at":"2017-09-08T09:19:56Z","closed_at":"2017-09-08T09:19:08Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** : 5.5.1\r\n\r\n**Plugins installed**: ingest-geoip, ingest-user-agent, repository-s3, x-pack\r\n\r\n**JVM version** :1.8.0_141\r\n\r\n**OS version** :Linux 3.13.0-29-generic amd6\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI have 2 nodes in the cluster. The first is master:true, data:true. The second is master:false, data:true\r\nI have an index with 5 shards and 0 replicas and 3 shards are allocated on the first node and 2 on the second.\r\nI connect to the master node with the java transport client and perform a search query with it.\r\nIn the response it says that it has 5 successful shards.\r\nThen I perform the same query with the REST API pointed to the master node host.\r\nIt also says that it has 5 successful shards and the total amount of documents matches to the value from the tcp client response.\r\n**But results are different**.\r\nIt seems that tcp client fetches results from the master node only.\r\n\r\nAt the same time, when I use get by id requests and explains for concrete identifiers the results are equals, insert/update and delete also works correctly on this environment.\r\n\r\n\r\n**Steps to reproduce**:\r\n 1.setup the cluster with 2 nodes. Both with the data and one of them should be master\r\n 2. Create an index with 2+ shards and add some documents there. It is important to have documents with the same matching term on each shard.\r\n3. Connect to the master node with java transport client and perform a search query by the matching term.\r\n4. Perform the same query with REST API pointed to the master node.\r\n5. Compare results\r\n  \r\n\r\n","closed_by":{"login":"igorbunova","id":10805589,"node_id":"MDQ6VXNlcjEwODA1NTg5","avatar_url":"https://avatars0.githubusercontent.com/u/10805589?v=4","gravatar_id":"","url":"https://api.github.com/users/igorbunova","html_url":"https://github.com/igorbunova","followers_url":"https://api.github.com/users/igorbunova/followers","following_url":"https://api.github.com/users/igorbunova/following{/other_user}","gists_url":"https://api.github.com/users/igorbunova/gists{/gist_id}","starred_url":"https://api.github.com/users/igorbunova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/igorbunova/subscriptions","organizations_url":"https://api.github.com/users/igorbunova/orgs","repos_url":"https://api.github.com/users/igorbunova/repos","events_url":"https://api.github.com/users/igorbunova/events{/privacy}","received_events_url":"https://api.github.com/users/igorbunova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}