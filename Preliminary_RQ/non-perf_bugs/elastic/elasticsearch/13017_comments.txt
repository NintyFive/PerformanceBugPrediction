[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/133067020","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-133067020","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":133067020,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMzA2NzAyMA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-08-20T16:29:23Z","updated_at":"2015-08-20T16:29:23Z","author_association":"MEMBER","body":"This seems like a bug maybe? why are we not consuming the token there?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/133070901","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-133070901","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":133070901,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMzA3MDkwMQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-08-20T16:39:42Z","updated_at":"2015-08-20T16:39:42Z","author_association":"MEMBER","body":"Looks like it has been introduced by #11414\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/133080276","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-133080276","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":133080276,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMzA4MDI3Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-08-20T17:16:58Z","updated_at":"2015-08-20T17:16:58Z","author_association":"MEMBER","body":"I think you misunderstood. The assertion code is correct, it means there was leftover stuff at the end of parsing. But _why_ is there leftover stuff in this case. what is the document you are sending, I only see the mapping in the original description? My hunch is, we need to fully consume the parser for mappings that are disabled.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/133096765","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-133096765","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":133096765,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMzA5Njc2NQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-08-20T17:51:03Z","updated_at":"2015-08-20T17:51:03Z","author_association":"MEMBER","body":"What I don't get is why I can create this mapping and index documents in elasticsearch but cannot do exactly the same thing in integration tests.\n\nHere is the document I index: https://github.com/tlrx/elasticsearch/commit/94712121dd524c48f2dc40c787efd1eb6375d799#diff-82784da2187574da5398ae215c8a6795R276\n\nThis test fails on my computer and I don't get why.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/133098493","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-133098493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":133098493,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMzA5ODQ5Mw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-08-20T17:57:41Z","updated_at":"2015-08-20T17:57:41Z","author_association":"MEMBER","body":"Assertions are enabled in tests, but not when running with bin/elasticsearch.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/133099329","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-133099329","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":133099329,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMzA5OTMyOQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-08-20T18:00:50Z","updated_at":"2015-08-20T18:00:50Z","author_association":"CONTRIBUTOR","body":"Why isn't this a real check\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/133099891","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-133099891","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":133099891,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMzA5OTg5MQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-08-20T18:03:11Z","updated_at":"2015-08-20T18:03:11Z","author_association":"MEMBER","body":"@rjernst Yes I know, but the test I linked to seems good to me and I don't see why this assertion throws up. Can you please have a quick look to the code and/or try to reproduce?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134171816","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-134171816","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":134171816,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDE3MTgxNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-08-24T12:27:35Z","updated_at":"2015-08-24T12:27:35Z","author_association":"CONTRIBUTOR","body":"this is a bug.  The following fails with assertions enabled:\n\n```\nPUT my_index\n{\n  \"mappings\": {\n    \"my_type\": {\n      \"enabled\": false\n    }\n  }\n}\n\nPUT my_index/my_type/1\n{\n  \"foo\": \"bar\"\n}\n```\n\nThe whole type is disabled, which means the _source should be stored but nothing should be indexed.  It looks like we're just skipping parsing completely instead of consuming the tokens.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134287940","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-134287940","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":134287940,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDI4Nzk0MA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-08-24T16:25:16Z","updated_at":"2015-08-24T16:25:16Z","author_association":"MEMBER","body":"I have a test reproducing the issue and am investigating.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/134892860","html_url":"https://github.com/elastic/elasticsearch/issues/13017#issuecomment-134892860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13017","id":134892860,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDg5Mjg2MA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-08-26T08:11:25Z","updated_at":"2015-08-26T08:11:25Z","author_association":"MEMBER","body":"@rjernst Thanks for the work you have done :) Unfortunately I reopen this bug because indexing a document (like @clinton suggested) now fails with a `NullPointerException` (I tested on latest snapshot - build e8834cc78c13a507e2851908f8d51489e7888570).\n\nAs far as I understand the code it seems that your fix skips the document parsing when the type is disabled. So field mappers like `UidFieldMapper` are not used, resulting in a null `uid` thrown [here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/index/shard/IndexShard.java#L515). \n\nI'm not familiar with this part of the code but if you don't have time to look further please let me know and I'll try to have a look.\n","performed_via_github_app":null}]