{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42345","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42345/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42345/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42345/events","html_url":"https://github.com/elastic/elasticsearch/issues/42345","id":447076763,"node_id":"MDU6SXNzdWU0NDcwNzY3NjM=","number":42345,"title":"[CI] ZenDiscoveryIT.testNodeFailuresAreProcessedOnce fails","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-05-22T11:16:39Z","updated_at":"2019-05-22T12:52:46Z","closed_at":"2019-05-22T12:52:46Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Example build failure\r\n\r\n## Reproduction line \r\ndoes not reproduce locally\r\n```\r\n./gradlew :server:integTest --tests \"org.elasticsearch.cluster.coordination.ZenDiscoveryIT.testNodeFailuresAreProcessedOnce\" -Dtests.seed=CAC4A2E7E349B590 -Dtests.security.manager=true -Dtests.locale=fr-NC -Dtests.timezone=Asia/Ulaanbaatar -Dcompiler.java=12 -Druntime.java=11\r\n```\r\n\r\n## Example relevant log:\r\n```\r\njava.lang.AssertionError: \r\nExpected: (<1> or <2>)\r\n     but: was <0>\r\n\tat __randomizedtesting.SeedInfo.seed([CAC4A2E7E349B590:2A7AB0418BCD0AD4]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.cluster.coordination.ZenDiscoveryIT.testNodeFailuresAreProcessedOnce(ZenDiscoveryIT.java:129)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n...\r\n```\r\n\r\n```\r\n[2019-05-22T06:19:25,971][WARN ][o.e.c.NodeConnectionsService] [node_t0] failed to connect to {node_t2}{m0223nFaR4mX7YXQD97i-Q}{4Vq_y6ljS7OjYhJdofOckw}{127.0.0.1}{127.0.0.1:38751} (tried [1] times)\r\norg.elasticsearch.transport.ConnectTransportException: [node_t2][127.0.0.1:38751] connect_exception\r\n\tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onFailure(TcpTransport.java:972) ~[main/:?]\r\n\tat org.elasticsearch.action.ActionListener.lambda$toBiConsumer$3(ActionListener.java:161) ~[main/:?]\r\n\tat org.elasticsearch.common.concurrent.CompletableContext.lambda$addListener$0(CompletableContext.java:42) ~[elasticsearch-core-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:859) ~[?:?]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:837) ~[?:?]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\r\n\tat org.elasticsearch.common.concurrent.CompletableContext.completeExceptionally(CompletableContext.java:57) ~[elasticsearch-core-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.SocketChannelContext.connect(SocketChannelContext.java:120) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.EventHandler.handleConnect(EventHandler.java:97) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.nio.TestEventHandler.handleConnect(TestEventHandler.java:97) ~[framework-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.attemptConnect(NioSelector.java:405) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.setUpNewChannels(NioSelector.java:422) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.preSelect(NioSelector.java:261) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:153) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:129) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: java.net.ConnectException: Connection refused\r\n\tat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:?]\r\n\tat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:779) ~[?:?]\r\n\tat org.elasticsearch.nio.SocketChannelContext.connect(SocketChannelContext.java:117) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\t... 8 more\r\n```\r\n\r\n```\r\n[2019-05-22T06:19:30,196][WARN ][o.e.c.c.Coordinator      ] [node_tm0] failed to validate incoming join request from node [{node_t1}{QJFAdnDbQS6toxmBVzJkzw}{Uh15CadwS2-5yHZkysjo2g}{127.0.0.1}{127.0.0.1:39919}]\r\norg.elasticsearch.transport.RemoteTransportException: [node_t1][127.0.0.1:39919][internal:cluster/coordination/join/validate]\r\nCaused by: java.lang.IllegalArgumentException: Unknown NamedWriteable [org.elasticsearch.cluster.metadata.MetaData$Custom][custom_md]\r\n\tat org.elasticsearch.common.io.stream.NamedWriteableRegistry.getReader(NamedWriteableRegistry.java:112) ~[main/:?]\r\n\tat org.elasticsearch.common.io.stream.NamedWriteableAwareStreamInput.readNamedWriteable(NamedWriteableAwareStreamInput.java:45) ~[main/:?]\r\n\tat org.elasticsearch.common.io.stream.NamedWriteableAwareStreamInput.readNamedWriteable(NamedWriteableAwareStreamInput.java:39) ~[main/:?]\r\n\tat org.elasticsearch.cluster.metadata.MetaData.readFrom(MetaData.java:899) ~[main/:?]\r\n\tat org.elasticsearch.cluster.ClusterState.readFrom(ClusterState.java:764) ~[main/:?]\r\n\tat org.elasticsearch.cluster.coordination.ValidateJoinRequest.readFrom(ValidateJoinRequest.java:40) ~[main/:?]\r\n\tat org.elasticsearch.common.io.stream.Streamable.lambda$newWriteableReader$0(Streamable.java:51) ~[main/:?]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.newRequest(RequestHandlerRegistry.java:56) ~[main/:?]\r\n\tat org.elasticsearch.transport.InboundHandler.handleRequest(InboundHandler.java:179) ~[main/:?]\r\n\tat org.elasticsearch.transport.InboundHandler.messageReceived(InboundHandler.java:121) ~[main/:?]\r\n\tat org.elasticsearch.transport.InboundHandler.inboundMessage(InboundHandler.java:105) ~[main/:?]\r\n\tat org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:660) ~[main/:?]\r\n\tat org.elasticsearch.transport.TcpTransport.consumeNetworkReads(TcpTransport.java:684) ~[main/:?]\r\n\tat org.elasticsearch.transport.nio.MockNioTransport$MockTcpReadWriteHandler.consumeReads(MockNioTransport.java:246) ~[framework-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.SocketChannelContext.handleReadBytes(SocketChannelContext.java:215) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.BytesChannelContext.read(BytesChannelContext.java:47) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.EventHandler.handleRead(EventHandler.java:119) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.nio.TestEventHandler.handleRead(TestEventHandler.java:121) ~[framework-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.handleRead(NioSelector.java:397) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.processKey(NioSelector.java:246) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:172) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:129) ~[elasticsearch-nio-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n```\r\n\r\nOccurrence seems rare, not muting yet.","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}