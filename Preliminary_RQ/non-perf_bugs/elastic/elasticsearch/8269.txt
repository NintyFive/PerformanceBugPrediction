{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8269","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8269/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8269/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8269/events","html_url":"https://github.com/elastic/elasticsearch/issues/8269","id":47134198,"node_id":"MDU6SXNzdWU0NzEzNDE5OA==","number":8269,"title":"Inconsistent integer numbers with exponential part","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2014-10-29T10:57:03Z","updated_at":"2014-10-31T18:04:49Z","closed_at":"2014-10-31T18:04:49Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"```\nweb245 ~ # curl 'http://web245:9200/statistics-super-fast-201406/_search?pretty' -d '{\"size\": 0, \"aggs\": { \"filtered\": { \"filter\": { \"query\": { \"query_string\": { \"query\": \"_type:events AND @timestamp:2014-06-01\" } } }, \"aggs\": { \"sum\": { \"sum\": { \"field\": \"@value\" } } } } } }'\n{\n  \"took\" : 355,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 38864898,\n    \"max_score\" : 0.0,\n    \"hits\" : [ ]\n  },\n  \"aggregations\" : {\n    \"filtered\" : {\n      \"doc_count\" : 1326965,\n      \"sum\" : {\n        \"value\" : 1.20356041461966131E18\n      }\n    }\n  }\n}\n```\n\n```\nweb245 ~ # curl 'http://web245:9200/statistics-super-fast-201406/_search?pretty' -d '{\"size\": 0, \"aggs\": { \"filtered\": { \"filter\": { \"query\": { \"query_string\": { \"query\": \"_type:events AND @timestamp:2014-06-01\" } } }, \"aggs\": { \"sum\": { \"sum\": { \"field\": \"@value\" } } } } } }'\n{\n  \"took\" : 465,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 38864898,\n    \"max_score\" : 0.0,\n    \"hits\" : [ ]\n  },\n  \"aggregations\" : {\n    \"filtered\" : {\n      \"doc_count\" : 1326965,\n      \"sum\" : {\n        \"value\" : 1.20356041461968358E18\n      }\n    }\n  }\n}\n```\n\nTo compare them easily:\n\n`1.20356041461966131E18`\n`1.20356041461968358E18`\n\nThe index is completely cold, no updates happened between queries. Same happens with facets.\n\nI am doing reindexing with compaction and my checks failed for some indices, this is the reason.\n\nBelow is the diff for 180 days (first and last day should be discarded)\n\n``` diff\n--- slow.txt    2014-10-29 11:59:19.000000000 +0300\n+++ fast.txt    2014-10-29 12:30:19.000000000 +0300\n@@ -1,5 +1,4 @@\n \"time\",\"_type:events\"\n-\"2014-05-02T03:00:00\",148035486204\n \"2014-05-03T03:00:00\",206274109000\n \"2014-05-04T03:00:00\",208608806764\n \"2014-05-05T03:00:00\",217063816673\n@@ -26,12 +25,12 @@\n \"2014-05-26T03:00:00\",226269192968\n \"2014-05-27T03:00:00\",218775134426\n \"2014-05-28T03:00:00\",215284624266\n-\"2014-05-29T03:00:00\",1015987720526389800\n-\"2014-05-30T03:00:00\",156505613309490800\n+\"2014-05-29T03:00:00\",1015987720541722500\n+\"2014-05-30T03:00:00\",156505613321714850\n \"2014-05-31T03:00:00\",12004020735428\n-\"2014-06-01T03:00:00\",1203560414599458800\n+\"2014-06-01T03:00:00\",1203560414619775500\n \"2014-06-02T03:00:00\",112970958246073\n-\"2014-06-03T03:00:00\",150547467159098050\n+\"2014-06-03T03:00:00\",150547467167122800\n \"2014-06-04T03:00:00\",201503104830\n \"2014-06-05T03:00:00\",193058631009\n \"2014-06-06T03:00:00\",175652820687\n@@ -179,4 +178,3 @@\n \"2014-10-26T03:00:00\",195305183271\n \"2014-10-27T03:00:00\",205336038145\n \"2014-10-28T03:00:00\",18642642544668\n-\"2014-10-29T03:00:00\",18489805001076\n```\n\nThose days are actually outliers, they have the biggest sums:\n\n```\nÎ» cat slow.txt | awk -F, '{ print $2, $1 }' | sort -n | tail\n37077344518816 \"2014-09-22T03:00:00\"\n37079209536035 \"2014-10-01T03:00:00\"\n37082482578643 \"2014-10-25T03:00:00\"\n37086732785585 \"2014-10-23T03:00:00\"\n37087873971618 \"2014-09-19T03:00:00\"\n112970958246073 \"2014-06-02T03:00:00\"\n150547467159098050 \"2014-06-03T03:00:00\"\n156505613309490800 \"2014-05-30T03:00:00\"\n1015987720526389800 \"2014-05-29T03:00:00\"\n1203560414599458800 \"2014-06-01T03:00:00\"\n```\n\n1203560414599458800 log 2 is 60.06201426993902, so there are some bits available :)\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}