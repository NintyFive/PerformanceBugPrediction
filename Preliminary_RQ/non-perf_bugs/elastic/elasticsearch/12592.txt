{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12592","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12592/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12592/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12592/events","html_url":"https://github.com/elastic/elasticsearch/issues/12592","id":98677266,"node_id":"MDU6SXNzdWU5ODY3NzI2Ng==","number":12592,"title":"Aggregate results by query input params","user":{"login":"reshadman","id":5187816,"node_id":"MDQ6VXNlcjUxODc4MTY=","avatar_url":"https://avatars0.githubusercontent.com/u/5187816?v=4","gravatar_id":"","url":"https://api.github.com/users/reshadman","html_url":"https://github.com/reshadman","followers_url":"https://api.github.com/users/reshadman/followers","following_url":"https://api.github.com/users/reshadman/following{/other_user}","gists_url":"https://api.github.com/users/reshadman/gists{/gist_id}","starred_url":"https://api.github.com/users/reshadman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reshadman/subscriptions","organizations_url":"https://api.github.com/users/reshadman/orgs","repos_url":"https://api.github.com/users/reshadman/repos","events_url":"https://api.github.com/users/reshadman/events{/privacy}","received_events_url":"https://api.github.com/users/reshadman/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-08-03T05:52:17Z","updated_at":"2015-08-05T12:15:15Z","closed_at":"2015-08-03T07:52:03Z","author_association":"NONE","active_lock_reason":null,"body":"I have two indexes, the first one called **areas** is an index containing of multiple polygons, and second one is an index containing of multiple **points** indicating  the document's lat/lon on earth, the index is called **stores**.\n\nThe problem is that I want to attach areas(polygons) that contain the **store's point** (lat/lon) inside of them, to the store's document as an embedded object. So I can easily find that a document on **stores** index has which areas.\n\nIn an **RDBMS** I was able to join this two table and find the needed records, In elasticsearch I can iterate over **areas** index documents one by one and perform a query to find the **stores** that fit in the **area's** polygon, and then perform an update on the **store** document, as the number of **areas** are huge, I have to perform over 50,000 queries on elasticsearch.\n\nA good solution would be sending a bulk list of areas with the query and tell elasticsearch to aggregate returning results by them the answer would be something like this:\n- Polygon A : [store1, store2, store3],\n- Polygon B : [store1, store4, store5]\n\nI didn't find anyway to implement this and I switched back to RDBMS solution which is not very optimized and fast too, but it is faster in design.\n\nIs there anyway to implement this with elasticsearch?\n\nI also planned for writing a plugin which does this functionality if it is not possible currently.  \n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}