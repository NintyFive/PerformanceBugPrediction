[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/13285746","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-13285746","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":13285746,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMjg1NzQ2","user":{"login":"Filirom1","id":295554,"node_id":"MDQ6VXNlcjI5NTU1NA==","avatar_url":"https://avatars1.githubusercontent.com/u/295554?v=4","gravatar_id":"","url":"https://api.github.com/users/Filirom1","html_url":"https://github.com/Filirom1","followers_url":"https://api.github.com/users/Filirom1/followers","following_url":"https://api.github.com/users/Filirom1/following{/other_user}","gists_url":"https://api.github.com/users/Filirom1/gists{/gist_id}","starred_url":"https://api.github.com/users/Filirom1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Filirom1/subscriptions","organizations_url":"https://api.github.com/users/Filirom1/orgs","repos_url":"https://api.github.com/users/Filirom1/repos","events_url":"https://api.github.com/users/Filirom1/events{/privacy}","received_events_url":"https://api.github.com/users/Filirom1/received_events","type":"User","site_admin":false},"created_at":"2013-02-08T11:02:20Z","updated_at":"2013-02-08T11:02:20Z","author_association":"NONE","body":"Deleting the index is not the solution:\n\n```\n$ curl -X DELETE http://tpsmdt03s:9023/4f072ea3a623374256000001\n[2013-02-08 11:55:29,855][INFO ][cluster.metadata         ] [tpsmdt01s] [4f072ea3a623374256000001] deleting index\n{\"ok\":true,\"acknowledged\":false}\n```\n\n```\n$ curl -XPOST http://localhost:9023/4f072ea3a623374256000001/user2/ -d '{\n    \"name2\" : \"Shay Banon\"\n}'\n[2013-02-08 12:01:24,479][INFO ][cluster.metadata         ] [tpsmdt01s] [4f072ea3a623374256000001] creating index, cause [auto(index api)], shards [6]/[1], mappings []\n[2013-02-08 12:01:25,057][WARN ][cluster.metadata         ] [tpsmdt01s] failed to dynamically refresh the mapping in cluster_state from shard\njava.lang.NullPointerException\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/13292001","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-13292001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":13292001,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMjkyMDAx","user":{"login":"Filirom1","id":295554,"node_id":"MDQ6VXNlcjI5NTU1NA==","avatar_url":"https://avatars1.githubusercontent.com/u/295554?v=4","gravatar_id":"","url":"https://api.github.com/users/Filirom1","html_url":"https://github.com/Filirom1","followers_url":"https://api.github.com/users/Filirom1/followers","following_url":"https://api.github.com/users/Filirom1/following{/other_user}","gists_url":"https://api.github.com/users/Filirom1/gists{/gist_id}","starred_url":"https://api.github.com/users/Filirom1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Filirom1/subscriptions","organizations_url":"https://api.github.com/users/Filirom1/orgs","repos_url":"https://api.github.com/users/Filirom1/repos","events_url":"https://api.github.com/users/Filirom1/events{/privacy}","received_events_url":"https://api.github.com/users/Filirom1/received_events","type":"User","site_admin":false},"created_at":"2013-02-08T14:19:08Z","updated_at":"2013-02-08T14:19:08Z","author_association":"NONE","body":"What I understand is that the cluster state is in a poor state.\nIt can not be updated because a NullPointerException is thrown at [MetaDataMappingService.java#L130](https://github.com/elasticsearch/elasticsearch/blob/v0.19.11/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java#L130)\n\nFinally the Exception is catched at [MetaDataMappingService.java#L145](https://github.com/elasticsearch/elasticsearch/blob/v0.19.11/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java#L145) and the state is rolled back to the previsous one (the bad one).\nIt will be impossible for us to go away from this Error, because the cluster state is saved on disk and will be restored after a cold cluster restart.\n\nIndex creation and deletion are very slow:\n\n```\n$ time curl -XPOST http://localhost:9023/test2/user3/ -d '{\n    \"name\" : \"Shay Banon\"\n}'\n{\"ok\":true,\"_index\":\"test2\",\"_type\":\"user3\",\"_id\":\"OHCEGwWsRgKfQi-DMalzPA\",\"_version\":1}\nreal    0m43.143s\nuser    0m0.003s\nsys 0m0.002s\n\n$ time curl -XDELETE http://localhost:9023/test2/\n{\"ok\":true,\"acknowledged\":false}\nreal    0m10.027s\nuser    0m0.001s\nsys 0m0.004s\n\n```\n\nBut once created, indexation are fast:\n\n```\n$ time curl -XPOST http://localhost:9023/test2/user3/ -d '{\n    \"name\" : \"Shay Banon\"\n}'\n{\"ok\":true,\"_index\":\"test2\",\"_type\":\"user3\",\"_id\":\"qGgGgHxNR3297PkdNA94Lg\",\"_version\":1}\nreal    0m0.010s\nuser    0m0.002s\nsys 0m0.003s\n```\n\nAnd querying works:\n\n```\n$ time curl http://localhost:9023/test2/_search?q=name:Shay\n{\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":6,\"successful\":6,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":0.19178301,\"hits\":[{\"_index\":\"test2\",\"_type\":\"user3\",\"_id\":\"0jNFPBz-RieGCQ-vctYOoA\",\"_score\":0.19178301, \"_source\" : {\"name\":\"Shay Banon\"}}]}}\nreal    0m0.008s\nuser    0m0.002s\nsys 0m0.002s\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/13479585","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-13479585","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":13479585,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNDc5NTg1","user":{"login":"Filirom1","id":295554,"node_id":"MDQ6VXNlcjI5NTU1NA==","avatar_url":"https://avatars1.githubusercontent.com/u/295554?v=4","gravatar_id":"","url":"https://api.github.com/users/Filirom1","html_url":"https://github.com/Filirom1","followers_url":"https://api.github.com/users/Filirom1/followers","following_url":"https://api.github.com/users/Filirom1/following{/other_user}","gists_url":"https://api.github.com/users/Filirom1/gists{/gist_id}","starred_url":"https://api.github.com/users/Filirom1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Filirom1/subscriptions","organizations_url":"https://api.github.com/users/Filirom1/orgs","repos_url":"https://api.github.com/users/Filirom1/repos","events_url":"https://api.github.com/users/Filirom1/events{/privacy}","received_events_url":"https://api.github.com/users/Filirom1/received_events","type":"User","site_admin":false},"created_at":"2013-02-13T08:52:05Z","updated_at":"2013-02-13T08:52:05Z","author_association":"NONE","body":"Ok now, I have a better understanding of what happens on the cluster.\n\nThe long index creation time is not related to the NullPointerException : https://groups.google.com/d/msg/elasticsearch/hHniXBx8su8/VfEArmcpqQgJ\n\nI am now able to reproduce the NullPointerException:\nTwo indexations in parallel, and one deletion on the same index/type.\n\n```\ncurl -XPOST http://tpsmdt11s:9023/twitter/user -d '{\n    \"name\" : \"Shay Banon\"\n}' &\ncurl -XPOST http://tpsmdt11s:9023/twitter/user -d '{\n    \"name\" : \"Hello You\"\n}' &\ncurl -XDELETE http://tpsmdt11s:9023/twitter/user &\n```\n\n```\n[2013-02-13 09:48:21,369][INFO ][cluster.metadata         ] [tpsmdt11s] [twitter] update_mapping [user] (dynamic)\n[2013-02-13 09:48:21,386][INFO ][cluster.metadata         ] [tpsmdt11s] [twitter] update_mapping [user] (dynamic)\n[2013-02-13 09:48:21,401][INFO ][cluster.metadata         ] [tpsmdt11s] [[twitter]] remove_mapping [user]\n[2013-02-13 09:48:21,479][WARN ][cluster.metadata         ] [tpsmdt11s] failed to dynamically refresh the mapping in cluster_state from shard\njava.lang.NullPointerException\n```\n\nThe same logs in DEBUG : https://gist.github.com/Filirom1/4943162.\n\nI use a 4 nodes cluster in 0.19.11\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/13579547","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-13579547","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":13579547,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNTc5NTQ3","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2013-02-14T21:27:12Z","updated_at":"2013-02-14T21:27:12Z","author_association":"MEMBER","body":"Can you reproduce the NullPointerException issue with 0.20.5 or master? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22390962","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-22390962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":22390962,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzkwOTYy","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2013-08-09T12:26:34Z","updated_at":"2013-08-09T12:26:34Z","author_association":"MEMBER","body":"Closing this as it is quite stale. Happy to reopen, if this still happens with a current 0.90.3 release. Please tell us!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/27969248","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-27969248","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":27969248,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTY5MjQ4","user":{"login":"lindstromhenrik","id":866643,"node_id":"MDQ6VXNlcjg2NjY0Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/866643?v=4","gravatar_id":"","url":"https://api.github.com/users/lindstromhenrik","html_url":"https://github.com/lindstromhenrik","followers_url":"https://api.github.com/users/lindstromhenrik/followers","following_url":"https://api.github.com/users/lindstromhenrik/following{/other_user}","gists_url":"https://api.github.com/users/lindstromhenrik/gists{/gist_id}","starred_url":"https://api.github.com/users/lindstromhenrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lindstromhenrik/subscriptions","organizations_url":"https://api.github.com/users/lindstromhenrik/orgs","repos_url":"https://api.github.com/users/lindstromhenrik/repos","events_url":"https://api.github.com/users/lindstromhenrik/events{/privacy}","received_events_url":"https://api.github.com/users/lindstromhenrik/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T14:32:43Z","updated_at":"2013-11-07T14:32:43Z","author_association":"CONTRIBUTOR","body":"I can't reproduce this locally but I can confirm that we see this error in 0.90.5:\n[2013-11-07 15:26:39,574][WARN ][cluster.action.index     ] [NODE] failed to dynamically update the mapping in cluster_state from shard\njava.lang.NullPointerException\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28008493","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-28008493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":28008493,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDA4NDkz","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T21:32:14Z","updated_at":"2013-11-07T21:32:14Z","author_association":"MEMBER","body":"do you have a stack trace as you could paste here?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28012777","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-28012777","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":28012777,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDEyNzc3","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2013-11-07T22:23:46Z","updated_at":"2013-11-07T22:23:46Z","author_association":"MEMBER","body":"I think the NPE here might be related to `ClusterState#toString` method, probably solved with this commit: https://github.com/elasticsearch/elasticsearch/commit/123bc98d81ebd9777f9f739a51c6db00bc2bad5d\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28040860","html_url":"https://github.com/elastic/elasticsearch/issues/2633#issuecomment-28040860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2633","id":28040860,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDQwODYw","user":{"login":"lindstromhenrik","id":866643,"node_id":"MDQ6VXNlcjg2NjY0Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/866643?v=4","gravatar_id":"","url":"https://api.github.com/users/lindstromhenrik","html_url":"https://github.com/lindstromhenrik","followers_url":"https://api.github.com/users/lindstromhenrik/followers","following_url":"https://api.github.com/users/lindstromhenrik/following{/other_user}","gists_url":"https://api.github.com/users/lindstromhenrik/gists{/gist_id}","starred_url":"https://api.github.com/users/lindstromhenrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lindstromhenrik/subscriptions","organizations_url":"https://api.github.com/users/lindstromhenrik/orgs","repos_url":"https://api.github.com/users/lindstromhenrik/repos","events_url":"https://api.github.com/users/lindstromhenrik/events{/privacy}","received_events_url":"https://api.github.com/users/lindstromhenrik/received_events","type":"User","site_admin":false},"created_at":"2013-11-08T07:05:47Z","updated_at":"2013-11-08T07:05:47Z","author_association":"CONTRIBUTOR","body":"I'm working on getting the stack but I haven't been able to reproduce this in an environment that allows me to do this. \n\nRegarding the \"toString()\" fix we don't use templates so I don't think that is the problem.\n\nMy working hypothesis at the moment after looking at the mappings for indices that fails is that they all contain mappings where we have the same property name at different levels and that this also makes the merging of mappings to fail, causing a refresh-mapping giving the same NPE.\n","performed_via_github_app":null}]