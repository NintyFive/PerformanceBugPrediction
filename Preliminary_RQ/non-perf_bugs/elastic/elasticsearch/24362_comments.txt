[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297934473","html_url":"https://github.com/elastic/elasticsearch/issues/24362#issuecomment-297934473","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24362","id":297934473,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzkzNDQ3Mw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T08:01:05Z","updated_at":"2017-04-28T08:01:05Z","author_association":"MEMBER","body":"I think this is a fair tradeoff. Especially since it would still allow the addition of additional nested fields, so it would only affect indices where no nested fields have been defined.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299455750","html_url":"https://github.com/elastic/elasticsearch/issues/24362#issuecomment-299455750","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24362","id":299455750,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTQ1NTc1MA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-05-05T12:48:49Z","updated_at":"2017-05-05T12:48:49Z","author_association":"CONTRIBUTOR","body":"Discussed in Fixit-Friday: we will benchmark the overhead of a field that always has the same value. If it does not matter, we can add a meta-data field that identifies nested documents, otherwise we can either:\r\n - enforce nested mappings to be configured at index-creation time and only add the metadata field for root docs when there are nested mappings\r\n - or add an option to disable the fied that identifies root documents so that users who do not need the feature can get some performance back","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/344544860","html_url":"https://github.com/elastic/elasticsearch/issues/24362#issuecomment-344544860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24362","id":344544860,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NDU0NDg2MA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-11-15T10:04:53Z","updated_at":"2017-11-15T10:04:53Z","author_association":"CONTRIBUTOR","body":"I looked at this yesterday and after a closer look I think we can get the best of both worlds without indexing / adding anything to the documents. Today we index `_version`, `_seq_id`, and `_primary_term` for every nested document. While this is unnecessary and we can omit it we can use a `DocValuesFieldExistsQuery` once we don't index this for nested document. The values for these fields are all dummy values anyway so they have no real value for the user.  Yet, when we look at the place where these dummy values are added we see that there is a reason for this:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java#L247\r\n\r\n```Java\r\n// In the case of nested docs, let's fill nested docs with seqNo=1 and\r\n// primaryTerm=0 so that Lucene doesn't write a Bitset for documents\r\n// that don't have the field. This is consistent with the default value\r\n// for efficiency.\r\n```\r\n\r\nThis is a good reason for at least `_seq_id` and `_version` but given that we only access `_primary_term` rarely it might be ok to drop the value for nested docs in such a case. This would allow us to find parents very easily without paying any extra cost on indexing.\r\n\r\n@bleskes I wonder what you think if this is a feasible solution?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373674923","html_url":"https://github.com/elastic/elasticsearch/issues/24362#issuecomment-373674923","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24362","id":373674923,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzY3NDkyMw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T10:41:52Z","updated_at":"2018-03-16T10:41:52Z","author_association":"MEMBER","body":"@elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418369409","html_url":"https://github.com/elastic/elasticsearch/issues/24362#issuecomment-418369409","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24362","id":418369409,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODM2OTQwOQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-09-04T13:36:04Z","updated_at":"2018-09-04T13:36:04Z","author_association":"CONTRIBUTOR","body":"We discussed it, this issue incorporated two things:\r\n - the need to identify root documents efficiently, which @s1monw addressed as explained above\r\n - the removal of the `_type` field, which still needs to be addressed\r\n\r\nWe agreed to rename `_type` to `_nested` to address the second point.","performed_via_github_app":null}]