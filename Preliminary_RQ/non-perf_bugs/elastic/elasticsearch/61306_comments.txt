[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/675800773","html_url":"https://github.com/elastic/elasticsearch/issues/61306#issuecomment-675800773","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61306","id":675800773,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NTgwMDc3Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-08-19T01:34:13Z","updated_at":"2020-08-19T01:34:13Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-docs (>docs)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/675800774","html_url":"https://github.com/elastic/elasticsearch/issues/61306#issuecomment-675800774","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61306","id":675800774,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NTgwMDc3NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-08-19T01:34:13Z","updated_at":"2020-08-19T01:34:13Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/Allocation)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/677962577","html_url":"https://github.com/elastic/elasticsearch/issues/61306#issuecomment-677962577","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61306","id":677962577,"node_id":"MDEyOklzc3VlQ29tbWVudDY3Nzk2MjU3Nw==","user":{"login":"Leaf-Lin","id":39002973,"node_id":"MDQ6VXNlcjM5MDAyOTcz","avatar_url":"https://avatars3.githubusercontent.com/u/39002973?v=4","gravatar_id":"","url":"https://api.github.com/users/Leaf-Lin","html_url":"https://github.com/Leaf-Lin","followers_url":"https://api.github.com/users/Leaf-Lin/followers","following_url":"https://api.github.com/users/Leaf-Lin/following{/other_user}","gists_url":"https://api.github.com/users/Leaf-Lin/gists{/gist_id}","starred_url":"https://api.github.com/users/Leaf-Lin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Leaf-Lin/subscriptions","organizations_url":"https://api.github.com/users/Leaf-Lin/orgs","repos_url":"https://api.github.com/users/Leaf-Lin/repos","events_url":"https://api.github.com/users/Leaf-Lin/events{/privacy}","received_events_url":"https://api.github.com/users/Leaf-Lin/received_events","type":"User","site_admin":false},"created_at":"2020-08-20T23:54:57Z","updated_at":"2020-08-20T23:54:57Z","author_association":"CONTRIBUTOR","body":"Another proposal (a temporarily workaround before permenant fix becomes available) to avoid hotspots when adding new node is to: \r\n1. Use [index shard allocation filtering](https://www.elastic.co/guide/en/elasticsearch/reference/current/shard-allocation-filtering.html) in the templates, preventing that new indices can go to the new node (via `_exclude`). \r\n2. Add the new node. \r\n3. Await until the number of shards is balanced across the hosts.\r\n4. Remove the exclude restriction form the templates.\r\n5. Remove the index allocation exclude restriction from the already created indices - we have to be careful here so we do not remove any other allocation exclude rules the indices may have prior to this operation. It is usually as simple of just setting the value to `null`, but if there were any other allocation exclude rules that's not valid and we have to keep them. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/690862948","html_url":"https://github.com/elastic/elasticsearch/issues/61306#issuecomment-690862948","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61306","id":690862948,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MDg2Mjk0OA==","user":{"login":"VimCommando","id":1674688,"node_id":"MDQ6VXNlcjE2NzQ2ODg=","avatar_url":"https://avatars1.githubusercontent.com/u/1674688?v=4","gravatar_id":"","url":"https://api.github.com/users/VimCommando","html_url":"https://github.com/VimCommando","followers_url":"https://api.github.com/users/VimCommando/followers","following_url":"https://api.github.com/users/VimCommando/following{/other_user}","gists_url":"https://api.github.com/users/VimCommando/gists{/gist_id}","starred_url":"https://api.github.com/users/VimCommando/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VimCommando/subscriptions","organizations_url":"https://api.github.com/users/VimCommando/orgs","repos_url":"https://api.github.com/users/VimCommando/repos","events_url":"https://api.github.com/users/VimCommando/events{/privacy}","received_events_url":"https://api.github.com/users/VimCommando/received_events","type":"User","site_admin":false},"created_at":"2020-09-11T04:13:26Z","updated_at":"2020-09-11T04:17:36Z","author_association":"NONE","body":"From a Slack thread on this topic, let me throw this out as a part of the recipe:\r\n\r\nFile this under “Things that should be simple, but are not”. I think it ends up to be:\r\n`total_shards_per_node = (primary + (replicas * primary)) / (nodes - allowed_failures)`\r\nWhere:\r\n- `primary` is number of primary shards\r\n- `replicas` is number of replica sets\r\n- `nodes` is number of participating _data_ nodes (factor in hot/warm data tier)\r\n- `allowed_failures` is how many nodes can be down at a time\r\n\r\nSo for example, if you have 14 primary shards, 1 replica set, 12 nodes, and want to allow 2 node failures:\r\n```\r\ntotal_shards_per_node \r\n  = (primary + (replicas * primary)) / (nodes - allowed_failures)\r\n  = (14 + (14 * 1)) / (12 - 2) \r\n  = 28 / 10\r\n  = 2.8\r\n```\r\nwhich would round up to 3","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/690875692","html_url":"https://github.com/elastic/elasticsearch/issues/61306#issuecomment-690875692","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61306","id":690875692,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MDg3NTY5Mg==","user":{"login":"kunisen","id":30574753,"node_id":"MDQ6VXNlcjMwNTc0NzUz","avatar_url":"https://avatars2.githubusercontent.com/u/30574753?v=4","gravatar_id":"","url":"https://api.github.com/users/kunisen","html_url":"https://github.com/kunisen","followers_url":"https://api.github.com/users/kunisen/followers","following_url":"https://api.github.com/users/kunisen/following{/other_user}","gists_url":"https://api.github.com/users/kunisen/gists{/gist_id}","starred_url":"https://api.github.com/users/kunisen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kunisen/subscriptions","organizations_url":"https://api.github.com/users/kunisen/orgs","repos_url":"https://api.github.com/users/kunisen/repos","events_url":"https://api.github.com/users/kunisen/events{/privacy}","received_events_url":"https://api.github.com/users/kunisen/received_events","type":"User","site_admin":false},"created_at":"2020-09-11T05:05:09Z","updated_at":"2020-09-11T05:12:48Z","author_association":"NONE","body":"I tend to think it a bit simpler like \"set this number to replica # + 1\" as a getting started.\r\nAlso maybe good to consider the combination w/ awareness (e.g. Rack/Zone) for advanced tuning if needed.","performed_via_github_app":null}]