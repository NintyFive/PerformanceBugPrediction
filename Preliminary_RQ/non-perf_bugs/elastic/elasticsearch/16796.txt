{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16796","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16796/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16796/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16796/events","html_url":"https://github.com/elastic/elasticsearch/issues/16796","id":136072003,"node_id":"MDU6SXNzdWUxMzYwNzIwMDM=","number":16796,"title":"Phrases in span_near","user":{"login":"cknv","id":123179,"node_id":"MDQ6VXNlcjEyMzE3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/123179?v=4","gravatar_id":"","url":"https://api.github.com/users/cknv","html_url":"https://github.com/cknv","followers_url":"https://api.github.com/users/cknv/followers","following_url":"https://api.github.com/users/cknv/following{/other_user}","gists_url":"https://api.github.com/users/cknv/gists{/gist_id}","starred_url":"https://api.github.com/users/cknv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cknv/subscriptions","organizations_url":"https://api.github.com/users/cknv/orgs","repos_url":"https://api.github.com/users/cknv/repos","events_url":"https://api.github.com/users/cknv/events{/privacy}","received_events_url":"https://api.github.com/users/cknv/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":110557212,"node_id":"MDU6TGFiZWwxMTA1NTcyMTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/high%20hanging%20fruit","name":"high hanging fruit","color":"fc6149","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2016-02-24T14:09:48Z","updated_at":"2020-05-19T08:19:09Z","closed_at":"2018-06-01T13:49:20Z","author_association":"NONE","active_lock_reason":null,"body":"I am using `span_near` queries and while I can put in `span_terms` and even `span_or`, I am missing a `span_phrase` clause in the query dsl.\n\nAs I understand it, a regular `phrase` clause, is very similar (at least conceptually) to a `span_near`, where the slop is 0 and the terms are the phrase that has been run through the same analyzer as the field uses.\n\nHowever: while I could construct that `span_near` and its `span_terms` by hand, I would have to be very careful making the terms (getting it close is easy; getting it right is hard) and I would only be able to cover one analyzer at a time, which is hardly ideal.\nAlternatively, I could also ask elasticsearch to analyze the phrase for me (according to the fields analyzer), and then use that in the query, but that would cost me an extra round trip. Not to mention that the query construction is actually in a library that is currently blissfully unaware of the actual elasticsearch nodes, it just builds the query.\n\nSo having elasticsearch take the phrase and construct a lucene `SpanNearQuery` or something akin to that, would be very nice, and save me a lot of trouble.\n\nMaybe the dsl could look something like:\n\n``` json\n{\n    \"span_phrase\": {\n        \"<field>\": \"<phrase>\"\n    }\n}\n```\n\nWhich I could then embed in my `span_near`, like any other span clause.\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}