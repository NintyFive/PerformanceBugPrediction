{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51865","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51865/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51865/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51865/events","html_url":"https://github.com/elastic/elasticsearch/issues/51865","id":559748764,"node_id":"MDU6SXNzdWU1NTk3NDg3NjQ=","number":51865,"title":"scroll ids getting exhausted quickly in 7.5.2 compared to 7.3.2 with the same scroll context settings","user":{"login":"pkartikk","id":16114576,"node_id":"MDQ6VXNlcjE2MTE0NTc2","avatar_url":"https://avatars0.githubusercontent.com/u/16114576?v=4","gravatar_id":"","url":"https://api.github.com/users/pkartikk","html_url":"https://github.com/pkartikk","followers_url":"https://api.github.com/users/pkartikk/followers","following_url":"https://api.github.com/users/pkartikk/following{/other_user}","gists_url":"https://api.github.com/users/pkartikk/gists{/gist_id}","starred_url":"https://api.github.com/users/pkartikk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pkartikk/subscriptions","organizations_url":"https://api.github.com/users/pkartikk/orgs","repos_url":"https://api.github.com/users/pkartikk/repos","events_url":"https://api.github.com/users/pkartikk/events{/privacy}","received_events_url":"https://api.github.com/users/pkartikk/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":1967498216,"node_id":"MDU6TGFiZWwxOTY3NDk4MjE2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Search","name":"Team:Search","color":"fef2c0","default":false,"description":"Meta label for search team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-02-04T14:17:29Z","updated_at":"2020-07-28T12:24:27Z","closed_at":"2020-07-28T12:24:27Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.5.2\r\n\r\n**Plugins installed**: Default installation\r\n\r\n**JVM version** (`java -version`): openjdk version \"13.0.1\" 2019-10-15\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux 4.4.0-87-generic #110-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**: When we are querying documents from Elasticsearch 7.5.2, the ScrollIds are getting exhausted quickly. The default limit is 500. This limit gets exhausted very quickly with very less load (less than 1000 documents). We haven't observed the same issue with the same API in version 7.3.2 with millions of documents.\r\n\r\n```\r\norg.elasticsearch.ElasticsearchStatusException: Elasticsearch exception [type=search_phase_execution_exception, reason=all shards failed]\r\n        at org.elasticsearch.rest.BytesRestResponse.errorFromXContent(BytesRestResponse.java:177)\r\n        at org.elasticsearch.client.RestHighLevelClient.parseEntity(RestHighLevelClient.java:1727)\r\n        at org.elasticsearch.client.RestHighLevelClient.parseResponseException(RestHighLevelClient.java:1704)\r\n        at org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1467)\r\n        at org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1424)\r\n        at org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1394)\r\n        at org.elasticsearch.client.RestHighLevelClient.search(RestHighLevelClient.java:930)\r\n        at com.bmc.truesight.saas.ims.es.dao.CIDocRepositoryImpl.getCIDocByTenant(CIDocRepositoryImpl.java:603)\r\n        ... 31 common frames omitted\r\n        Suppressed: org.elasticsearch.client.ResponseException: method [POST], host [machine-name:9200], URI [/ci_index_ims/_search?typed_keys=true&ignore_unavailable=false&expand_wildcards=open&allow_no_indices=true&ignore_throttled=true&scroll=60000ms&search_type=dfs_query_then_fetch&batched_reduce_size=512&ccs_minimize_roundtrips=true], status line [HTTP/1.1 500 Internal Server Error]\r\n{\"error\":{\"root_cause\":[{\"type\":\"exception\",\"reason\":\"Trying to create too many scroll contexts. Must be less than or equal to: [500]. This limit can be set by changing the [search.max_open_scroll_context] setting.\"}],\"type\":\"search_phase_execution_exception\",\"reason\":\"all shards failed\",\"phase\":\"dfs\",\"grouped\":true,\"failed_shards\":[{\"shard\":0,\"index\":\"ci_index_ims\",\"node\":\"fU1CWJ5NSX6whkIYHQz-sQ\",\"reason\":{\"type\":\"exception\",\"reason\":\"Trying to create too many scroll contexts. Must be less than or equal to: [500]. This limit can be set by changing the [search.max_open_scroll_context] setting.\"}}]},\"status\":500}\r\n                at org.elasticsearch.client.RestClient.convertResponse(RestClient.java:253)\r\n                at org.elasticsearch.client.RestClient.performRequest(RestClient.java:231)\r\n                at org.elasticsearch.client.RestClient.performRequest(RestClient.java:205)\r\n                at org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1454)\r\n                ... 35 common frames omitted\r\n```\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Settings:\r\n\r\n{\r\n   \"analysis\": {\r\n      \"analyzer\": {\r\n         \"keyword_analyzer\": {\r\n            \"filter\": \"lowercase\",\r\n            \"tokenizer\": \"keyword\"\r\n         }\r\n      }\r\n   }\r\n}\r\n\r\n 2. Mapping:\r\n\r\n{\r\n              \"properties\": {\r\n                             \"ack\": {\r\n                                           \"type\": \"object\",\r\n                                           \"properties\": {\r\n                                                          \"slot1\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot2\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"fielddata\": true,\r\n                                                                        \"fields\": {\r\n                                                                                      \"keyword\": {\r\n                                                                                                     \"type\": \"keyword\",\r\n                                                                                                     \"ignore_above\": 256\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot3\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot4\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot5\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot6\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot7\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot9\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot10\": {\r\n                                           \"type\": \"object\",\r\n                                           \"properties\": {\r\n                                                          \"slot1\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot2\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"fielddata\": true,\r\n                                                                        \"fields\": {\r\n                                                                                      \"keyword\": {\r\n                                                                                                     \"type\": \"keyword\",\r\n                                                                                                     \"ignore_above\": 256\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot3\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot4\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot5\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot6\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot12\": {\r\n                                           \"type\": \"object\",\r\n                                           \"properties\": {\r\n                                                          \"slot1\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot2\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"fielddata\": true,\r\n                                                                        \"fields\": {\r\n                                                                                      \"keyword\": {\r\n                                                                                                     \"type\": \"keyword\",\r\n                                                                                                     \"ignore_above\": 256\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot3\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot4\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot5\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot6\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"child_doc_type\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot13\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot14\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot_join\": {\r\n                                           \"type\": \"join\",\r\n                                           \"eager_global_ordinals\": true,\r\n                                           \"relations\": {\r\n                                                          \"slot_parent\": [\r\n                                                                        \"slot_child_1\",\r\n                                                                        \"slot_child_2\"\r\n                                                          ]\r\n                                           }\r\n                             },\r\n                             \"slot15\": {\r\n                                           \"type\": \"keyword\",\r\n                                           \"fields\": {\r\n                                                          \"ignore_case\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"analyzer\": \"keyword_analyzer\"\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot16\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot17\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true\r\n                             },\r\n                             \"slot18\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true\r\n                             },\r\n                             \"slot19\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot20\": {\r\n                                           \"type\": \"object\",\r\n                                           \"properties\": {\r\n                                                          \"slot1\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot2\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"fielddata\": true,\r\n                                                                        \"fields\": {\r\n                                                                                      \"keyword\": {\r\n                                                                                                     \"type\": \"keyword\",\r\n                                                                                                     \"ignore_above\": 256\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot3\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot4\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot5\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot6\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot21\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot22\": {\r\n                                           \"type\": \"keyword\",\r\n                                           \"fields\": {\r\n                                                          \"ignore_case\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"analyzer\": \"keyword_analyzer\"\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot23\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot24\": {\r\n                                           \"type\": \"keyword\",\r\n                                           \"fields\": {\r\n                                                          \"ignore_case\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"analyzer\": \"keyword_analyzer\"\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot25\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot26\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot27\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot28\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot29\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot30\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"is_parent\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot48\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot31\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot32\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true\r\n                             },\r\n                             \"slot33\": {\r\n                                           \"type\": \"object\",\r\n                                           \"properties\": {\r\n                                                          \"slot1\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot2\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"fielddata\": true,\r\n                                                                        \"fields\": {\r\n                                                                                      \"keyword\": {\r\n                                                                                                     \"type\": \"keyword\",\r\n                                                                                                     \"ignore_above\": 256\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot3\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot4\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot5\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          },\r\n                                                          \"slot6\": {\r\n                                                                        \"type\": \"object\",\r\n                                                                        \"properties\": {\r\n                                                                                      \"count\": {\r\n                                                                                                     \"type\": \"long\"\r\n                                                                                      },\r\n                                                                                      \"slot_level\": {\r\n                                                                                                     \"type\": \"text\",\r\n                                                                                                     \"fielddata\": true,\r\n                                                                                                     \"fields\": {\r\n                                                                                                                   \"keyword\": {\r\n                                                                                                                                 \"type\": \"keyword\",\r\n                                                                                                                                 \"ignore_above\": 256\r\n                                                                                                                   }\r\n                                                                                                     }\r\n                                                                                      }\r\n                                                                        }\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"parent_id\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot11\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot34\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot35\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot36\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot37\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                         }\r\n                                           }\r\n                             },\r\n                             \"slot38\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot39\": {\r\n                                           \"type\": \"keyword\",\r\n                                           \"fields\": {\r\n                                                          \"ignore_case\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"analyzer\": \"keyword_analyzer\"\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot40\": {\r\n                                           \"type\": \"keyword\",\r\n                                           \"fields\": {\r\n                                                          \"ignore_case\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"analyzer\": \"keyword_analyzer\"\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot41\": {\r\n                                           \"type\": \"keyword\",\r\n                                           \"fields\": {\r\n                                                          \"ignore_case\": {\r\n                                                                        \"type\": \"text\",\r\n                                                                        \"analyzer\": \"keyword_analyzer\"\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot42\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot43\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot44\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot1\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot4\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot5\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot6\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot3\": {\r\n                                           \"type\": \"long\"\r\n                             },\r\n                             \"slot45\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             },\r\n                             \"slot46\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                         }\r\n                                           }\r\n                             },\r\n                             \"slot47\": {\r\n                                           \"type\": \"text\",\r\n                                           \"fielddata\": true,\r\n                                           \"fields\": {\r\n                                                          \"keyword\": {\r\n                                                                        \"type\": \"keyword\",\r\n                                                                        \"ignore_above\": 256\r\n                                                          }\r\n                                           }\r\n                             }\r\n              }\r\n}\r\n\r\n 3. Search:\r\n\r\n{\r\n  \"from\": 0,\r\n  \"size\": 200,\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [\r\n        {\r\n          \"has_parent\": {\r\n            \"query\": {\r\n              \"bool\": {\r\n                \"must\": [\r\n                  {\r\n                    \"term\": {\r\n                      \"slot35.keyword\": {\r\n                        \"value\": \"value_0\",\r\n                        \"boost\": 1\r\n                      }\r\n                    }\r\n                  },\r\n                  {\r\n                    \"term\": {\r\n                      \"slot38\": {\r\n                        \"value\": \"value_1\",\r\n                        \"boost\": 1\r\n                      }\r\n                    }\r\n                  },\r\n                  {\r\n                    \"bool\": {\r\n                      \"adjust_pure_negative\": true,\r\n                      \"boost\": 1\r\n                    }\r\n                  }\r\n                ],\r\n                \"adjust_pure_negative\": true,\r\n                \"boost\": 1\r\n              }\r\n            },\r\n            \"parent_type\": \"slot_parent\",\r\n            \"score\": true,\r\n            \"ignore_unmapped\": false,\r\n            \"boost\": 1,\r\n            \"inner_hits\": {\r\n              \"ignore_unmapped\": false,\r\n              \"from\": 0,\r\n              \"size\": 3,\r\n              \"version\": false,\r\n              \"seq_no_primary_term\": false,\r\n              \"explain\": false,\r\n              \"track_scores\": false\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"term\": {\r\n            \"child_doc_type\": {\r\n              \"value\": \"value_2\",\r\n              \"boost\": 1\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"bool\": {\r\n            \"should\": [\r\n              {\r\n                \"range\": {\r\n                  \"slot33.slot5.count\": {\r\n                    \"from\": 0,\r\n                    \"to\": null,\r\n                    \"include_lower\": false,\r\n                    \"include_upper\": true,\r\n                    \"boost\": 1\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"range\": {\r\n                  \"slot33.slot4.count\": {\r\n                    \"from\": 0,\r\n                    \"to\": null,\r\n                    \"include_lower\": false,\r\n                    \"include_upper\": true,\r\n                    \"boost\": 1\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"range\": {\r\n                  \"slot33.slot6.count\": {\r\n                    \"from\": 0,\r\n                    \"to\": null,\r\n                    \"include_lower\": false,\r\n                    \"include_upper\": true,\r\n                    \"boost\": 1\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"range\": {\r\n                  \"slot33.slot1.count\": {\r\n                    \"from\": 0,\r\n                    \"to\": null,\r\n                    \"include_lower\": false,\r\n                    \"include_upper\": true,\r\n                    \"boost\": 1\r\n                  }\r\n                }\r\n              }\r\n            ],\r\n            \"adjust_pure_negative\": true,\r\n            \"boost\": 1\r\n          }\r\n        }\r\n      ],\r\n      \"adjust_pure_negative\": true,\r\n      \"boost\": 1\r\n    }\r\n  },\r\n  \"sort\": [\r\n    {\r\n      \"slot1\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot4\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot5\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot6\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot3\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot33.slot1.count\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot33.slot4.count\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot33.slot5.count\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot33.slot6.count\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot33.slot3.count\": {\r\n        \"order\": \"desc\"\r\n      }\r\n    },\r\n    {\r\n      \"slot24\": {\r\n        \"order\": \"asc\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n We see the following exception:\r\n\r\n```\r\norg.elasticsearch.transport.RemoteTransportException: [machine_name][machine IP:9300][indices:data/read/search[phase/query]]\r\nCaused by: org.elasticsearch.ElasticsearchException: Trying to create too many scroll contexts. Must be less than or equal to: [500]. This limit can be set by changing the [search.max_open_scroll_context] setting.\r\n             at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:542) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:348) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.search.SearchService.lambda$executeQueryPhase$1(SearchService.java:340) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.action.ActionListener.lambda$map$2(ActionListener.java:146) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:58) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-7.5.2.jar:7.5.2]\r\n             at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n             at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n             at java.lang.Thread.run(Thread.java:830) [?:?]\r\n```\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}