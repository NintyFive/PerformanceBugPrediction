[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/300725011","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-300725011","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":300725011,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDcyNTAxMQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2017-05-11T08:47:54Z","updated_at":"2017-05-11T08:47:54Z","author_association":"MEMBER","body":"It looks like a bug to me. Is sniffing enabled on your transport client?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/300742532","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-300742532","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":300742532,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDc0MjUzMg==","user":{"login":"fangqiao","id":17473990,"node_id":"MDQ6VXNlcjE3NDczOTkw","avatar_url":"https://avatars3.githubusercontent.com/u/17473990?v=4","gravatar_id":"","url":"https://api.github.com/users/fangqiao","html_url":"https://github.com/fangqiao","followers_url":"https://api.github.com/users/fangqiao/followers","following_url":"https://api.github.com/users/fangqiao/following{/other_user}","gists_url":"https://api.github.com/users/fangqiao/gists{/gist_id}","starred_url":"https://api.github.com/users/fangqiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fangqiao/subscriptions","organizations_url":"https://api.github.com/users/fangqiao/orgs","repos_url":"https://api.github.com/users/fangqiao/repos","events_url":"https://api.github.com/users/fangqiao/events{/privacy}","received_events_url":"https://api.github.com/users/fangqiao/received_events","type":"User","site_admin":false},"created_at":"2017-05-11T09:57:09Z","updated_at":"2017-05-11T09:57:09Z","author_association":"NONE","body":"Yes it is enabled. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/300882863","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-300882863","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":300882863,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDg4Mjg2Mw==","user":{"login":"jloisel","id":3208716,"node_id":"MDQ6VXNlcjMyMDg3MTY=","avatar_url":"https://avatars1.githubusercontent.com/u/3208716?v=4","gravatar_id":"","url":"https://api.github.com/users/jloisel","html_url":"https://github.com/jloisel","followers_url":"https://api.github.com/users/jloisel/followers","following_url":"https://api.github.com/users/jloisel/following{/other_user}","gists_url":"https://api.github.com/users/jloisel/gists{/gist_id}","starred_url":"https://api.github.com/users/jloisel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jloisel/subscriptions","organizations_url":"https://api.github.com/users/jloisel/orgs","repos_url":"https://api.github.com/users/jloisel/repos","events_url":"https://api.github.com/users/jloisel/events{/privacy}","received_events_url":"https://api.github.com/users/jloisel/received_events","type":"User","site_admin":false},"created_at":"2017-05-11T18:50:04Z","updated_at":"2017-05-11T18:50:04Z","author_association":"NONE","body":"Same issue here. We have:\r\n- Spring Boot v1.5.3.RELEASE,\r\n- Switched from Elasticsearch 5.3.2 to 5.4.0,\r\n- using Transport Client with sniff enabled.\r\n\r\nClient and Elasticsearch both on the same machine, connecting through localhost:\r\n- When using TransportClient 5.3.2 to connect to Elastic 5.4.0 => OK,\r\n- 5.4.0 to 5.4.0 => KO.\r\n\r\nThe exception we have on startup:\r\n> org.elasticsearch.transport.ReceiveTimeoutTransportException: [][127.0.0.1:9300][cluster:monitor/state] request_id [7] timed out after [5000ms]\r\n\tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:925) ~[elasticsearch-5.4.0.jar:5.4.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569) [elasticsearch-5.4.0.jar:5.4.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) [na:1.8.0_131]","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/300909794","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-300909794","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":300909794,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDkwOTc5NA==","user":{"login":"nwadams","id":879170,"node_id":"MDQ6VXNlcjg3OTE3MA==","avatar_url":"https://avatars1.githubusercontent.com/u/879170?v=4","gravatar_id":"","url":"https://api.github.com/users/nwadams","html_url":"https://github.com/nwadams","followers_url":"https://api.github.com/users/nwadams/followers","following_url":"https://api.github.com/users/nwadams/following{/other_user}","gists_url":"https://api.github.com/users/nwadams/gists{/gist_id}","starred_url":"https://api.github.com/users/nwadams/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nwadams/subscriptions","organizations_url":"https://api.github.com/users/nwadams/orgs","repos_url":"https://api.github.com/users/nwadams/repos","events_url":"https://api.github.com/users/nwadams/events{/privacy}","received_events_url":"https://api.github.com/users/nwadams/received_events","type":"User","site_admin":false},"created_at":"2017-05-11T20:36:44Z","updated_at":"2017-05-11T20:36:44Z","author_association":"NONE","body":"I am seeing this issue as well on some nodes connecting to ES. We run a service that has multiple machines that each connect to ES, some of them are able to connect successfully and others do not. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/300911523","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-300911523","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":300911523,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDkxMTUyMw==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2017-05-11T20:44:03Z","updated_at":"2017-05-11T20:44:03Z","author_association":"MEMBER","body":"Thanks for reporting, I think I know where the issue is.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/300913187","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-300913187","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":300913187,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDkxMzE4Nw==","user":{"login":"nwadams","id":879170,"node_id":"MDQ6VXNlcjg3OTE3MA==","avatar_url":"https://avatars1.githubusercontent.com/u/879170?v=4","gravatar_id":"","url":"https://api.github.com/users/nwadams","html_url":"https://github.com/nwadams","followers_url":"https://api.github.com/users/nwadams/followers","following_url":"https://api.github.com/users/nwadams/following{/other_user}","gists_url":"https://api.github.com/users/nwadams/gists{/gist_id}","starred_url":"https://api.github.com/users/nwadams/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nwadams/subscriptions","organizations_url":"https://api.github.com/users/nwadams/orgs","repos_url":"https://api.github.com/users/nwadams/repos","events_url":"https://api.github.com/users/nwadams/events{/privacy}","received_events_url":"https://api.github.com/users/nwadams/received_events","type":"User","site_admin":false},"created_at":"2017-05-11T20:51:05Z","updated_at":"2017-05-11T21:15:05Z","author_association":"NONE","body":"Thanks @tlrx. I'm not sure if you are also aware, but I also saw errors that looked like the following when I disabled sniffing. \r\n\r\n```\r\n20:38:44.935 [elasticsearch[_client_][generic][T#2]] DEBUG - failed to connect to discovered node [{i-0562d98cb14e42358}{Gzbd-MEzRo-OHMUoEajvXA}{x6V2--f3SS-NzVk5wAQQYg}{10.178.212.242}{127.0.0.1:4374}{aws_availability_zone=us-east-1a}]\r\nConnectTransportException[[i-0562d98cb14e42358][127.0.0.1:4374] handshake failed. unexpected remote node {i-01bae8d9b0f31ac54}{MUjAv_3JR5KmzEdn-eJeSA}{qJdTT_oaSRCJ1TLO1W2A6w}{10.158.100.27}{10.158.100.27:9300}{aws_availability_zone=us-east-1b}]\r\n\tat org.elasticsearch.transport.TransportService.lambda$connectToNode$3(TransportService.java:319)\r\n\tat org.elasticsearch.transport.TcpTransport.connectToNode(TcpTransport.java:466)\r\n\tat org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:315)\r\n\tat org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:302)\r\n\tat org.elasticsearch.client.transport.TransportClientNodesService$NodeSampler.validateNewNodes(TransportClientNodesService.java:374)\r\n\tat org.elasticsearch.client.transport.TransportClientNodesService$SimpleNodeSampler.doSample(TransportClientNodesService.java:442)\r\n\tat org.elasticsearch.client.transport.TransportClientNodesService$NodeSampler.sample(TransportClientNodesService.java:358)\r\n\tat org.elasticsearch.client.transport.TransportClientNodesService$ScheduledNodeSampler.run(TransportClientNodesService.java:391)\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\nIf it helps we have a service discovery framework to discover services: (https://medium.com/airbnb-engineering/smartstack-service-discovery-in-the-cloud-4b8a080de619). We \"randomly\" pick an ES box to connect to and then use sniffing (if enabled) to discover the rest. Even though ES is running on 9200/9300 we use a different port on our client machines because of the service discovery framework does the correct routing. Both the service discovery port and the \"direct access\" port are reachable over the network. \r\n\r\nI am rolling back our transport client version to 5.3.2 and will report back on the results.\r\nUpdate: 5.3.2 works great","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301048431","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-301048431","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":301048431,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTA0ODQzMQ==","user":{"login":"githubdoramon","id":8230135,"node_id":"MDQ6VXNlcjgyMzAxMzU=","avatar_url":"https://avatars0.githubusercontent.com/u/8230135?v=4","gravatar_id":"","url":"https://api.github.com/users/githubdoramon","html_url":"https://github.com/githubdoramon","followers_url":"https://api.github.com/users/githubdoramon/followers","following_url":"https://api.github.com/users/githubdoramon/following{/other_user}","gists_url":"https://api.github.com/users/githubdoramon/gists{/gist_id}","starred_url":"https://api.github.com/users/githubdoramon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/githubdoramon/subscriptions","organizations_url":"https://api.github.com/users/githubdoramon/orgs","repos_url":"https://api.github.com/users/githubdoramon/repos","events_url":"https://api.github.com/users/githubdoramon/events{/privacy}","received_events_url":"https://api.github.com/users/githubdoramon/received_events","type":"User","site_admin":false},"created_at":"2017-05-12T11:03:32Z","updated_at":"2017-05-12T11:03:32Z","author_association":"NONE","body":"Same here... 5.4.0 to 5.4.0 fails.... but 5.3.0 to 5.4.0 works","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/304649984","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-304649984","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":304649984,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDY0OTk4NA==","user":{"login":"jinnah79","id":10922194,"node_id":"MDQ6VXNlcjEwOTIyMTk0","avatar_url":"https://avatars2.githubusercontent.com/u/10922194?v=4","gravatar_id":"","url":"https://api.github.com/users/jinnah79","html_url":"https://github.com/jinnah79","followers_url":"https://api.github.com/users/jinnah79/followers","following_url":"https://api.github.com/users/jinnah79/following{/other_user}","gists_url":"https://api.github.com/users/jinnah79/gists{/gist_id}","starred_url":"https://api.github.com/users/jinnah79/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jinnah79/subscriptions","organizations_url":"https://api.github.com/users/jinnah79/orgs","repos_url":"https://api.github.com/users/jinnah79/repos","events_url":"https://api.github.com/users/jinnah79/events{/privacy}","received_events_url":"https://api.github.com/users/jinnah79/received_events","type":"User","site_admin":false},"created_at":"2017-05-29T12:30:20Z","updated_at":"2017-05-29T12:30:20Z","author_association":"NONE","body":"Same here... 5.4.0 to 5.4.0 fails.... but 5.3.0 to 5.4.0 works","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/334795839","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-334795839","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":334795839,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNDc5NTgzOQ==","user":{"login":"debraj-manna","id":8141860,"node_id":"MDQ6VXNlcjgxNDE4NjA=","avatar_url":"https://avatars0.githubusercontent.com/u/8141860?v=4","gravatar_id":"","url":"https://api.github.com/users/debraj-manna","html_url":"https://github.com/debraj-manna","followers_url":"https://api.github.com/users/debraj-manna/followers","following_url":"https://api.github.com/users/debraj-manna/following{/other_user}","gists_url":"https://api.github.com/users/debraj-manna/gists{/gist_id}","starred_url":"https://api.github.com/users/debraj-manna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/debraj-manna/subscriptions","organizations_url":"https://api.github.com/users/debraj-manna/orgs","repos_url":"https://api.github.com/users/debraj-manna/repos","events_url":"https://api.github.com/users/debraj-manna/events{/privacy}","received_events_url":"https://api.github.com/users/debraj-manna/received_events","type":"User","site_admin":false},"created_at":"2017-10-06T15:54:42Z","updated_at":"2017-10-06T15:54:42Z","author_association":"NONE","body":"I am seeing a similar exception in 2.3.1. Below is the exception:-\r\n\r\n```\r\nINFO [2017-08-08 20:14:18,019] [U:3,129,F:822,T:3,950,M:3,950] elasticsearch.client.transport:[TransportClientNodesService$SniffNodesSampler$1$1:handleException:455] - [elasticsearch[Edward \"Ned\" Buckman][generic][T#61]] - [Edward \"Ned\" Buckman] failed to get local cluster state for {#transport#-1}{127.0.0.1}{localhost/127.0.0.1:9300}, disconnecting...\r\nReceiveTimeoutTransportException[[][localhost/127.0.0.1:9300][cluster:monitor/state] request_id [341654] timed out after [5001ms]]\r\n\tat org.elasticsearch.transport.TransportService$TimeoutHandler.run(TransportService.java:679)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\nIs the issue not fixed in 2.3.1?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/335102848","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-335102848","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":335102848,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNTEwMjg0OA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2017-10-09T09:10:40Z","updated_at":"2017-10-09T09:10:40Z","author_association":"MEMBER","body":"> Is the issue not fixed in 2.3.1?\r\n\r\nI didn't test in 2.3.1 since the fix fixed a bug introduced in #22828 for 5.4.0. It's possible that this bug exists in 2.3.1 but this version is EOL and not supported anymore.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/335103793","html_url":"https://github.com/elastic/elasticsearch/issues/24575#issuecomment-335103793","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24575","id":335103793,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNTEwMzc5Mw==","user":{"login":"debraj-manna","id":8141860,"node_id":"MDQ6VXNlcjgxNDE4NjA=","avatar_url":"https://avatars0.githubusercontent.com/u/8141860?v=4","gravatar_id":"","url":"https://api.github.com/users/debraj-manna","html_url":"https://github.com/debraj-manna","followers_url":"https://api.github.com/users/debraj-manna/followers","following_url":"https://api.github.com/users/debraj-manna/following{/other_user}","gists_url":"https://api.github.com/users/debraj-manna/gists{/gist_id}","starred_url":"https://api.github.com/users/debraj-manna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/debraj-manna/subscriptions","organizations_url":"https://api.github.com/users/debraj-manna/orgs","repos_url":"https://api.github.com/users/debraj-manna/repos","events_url":"https://api.github.com/users/debraj-manna/events{/privacy}","received_events_url":"https://api.github.com/users/debraj-manna/received_events","type":"User","site_admin":false},"created_at":"2017-10-09T09:15:05Z","updated_at":"2017-10-09T09:15:05Z","author_association":"NONE","body":"ok thanks for the update.\n\nSent from GMail on Android\n\nOn Oct 9, 2017 2:42 PM, \"Tanguy Leroux\" <notifications@github.com> wrote:\n\n> Is the issue not fixed in 2.3.1?\n>\n> I didn't test in 2.3.1 since the fix fixed a bug introduced in #22828\n> <https://github.com/elastic/elasticsearch/pull/22828> for 5.4.0. It's\n> possible that this bug exists in 2.3.1 but this version is EOL and not\n> supported anymore.\n>\n> â€”\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/24575#issuecomment-335102848>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AHw8JPzLkGBjp7CpN19QJ6_lhFvamNlLks5sqeOCgaJpZM4NWYB_>\n> .\n>\n","performed_via_github_app":null}]