[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/223547152","html_url":"https://github.com/elastic/elasticsearch/issues/18719#issuecomment-223547152","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719","id":223547152,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzU0NzE1Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-06-03T10:37:32Z","updated_at":"2016-06-03T10:37:32Z","author_association":"CONTRIBUTOR","body":">  but there is no question that using term for an array of terms to match absolutely worked before, and has stopped working without bothering to explain itself.\n\nSorry @pineapplemachine but the `term` filter never worked like this.  In 5.0 we have done a major refactoring of query parsing that will now complain appropriately.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/223548736","html_url":"https://github.com/elastic/elasticsearch/issues/18719#issuecomment-223548736","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719","id":223548736,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzU0ODczNg==","user":{"login":"pineapplemachine","id":7266412,"node_id":"MDQ6VXNlcjcyNjY0MTI=","avatar_url":"https://avatars2.githubusercontent.com/u/7266412?v=4","gravatar_id":"","url":"https://api.github.com/users/pineapplemachine","html_url":"https://github.com/pineapplemachine","followers_url":"https://api.github.com/users/pineapplemachine/followers","following_url":"https://api.github.com/users/pineapplemachine/following{/other_user}","gists_url":"https://api.github.com/users/pineapplemachine/gists{/gist_id}","starred_url":"https://api.github.com/users/pineapplemachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pineapplemachine/subscriptions","organizations_url":"https://api.github.com/users/pineapplemachine/orgs","repos_url":"https://api.github.com/users/pineapplemachine/repos","events_url":"https://api.github.com/users/pineapplemachine/events{/privacy}","received_events_url":"https://api.github.com/users/pineapplemachine/received_events","type":"User","site_admin":false},"created_at":"2016-06-03T10:47:13Z","updated_at":"2016-06-03T10:47:29Z","author_association":"NONE","body":"This is a diff from when we added a query using an array of terms given to `term`:\n\n```\n    def get_bulk(self, bots):\n        \"\"\"Get information for many bots at once.\"\"\"\n        bot_ids = [bot.resource_id.to_string() for bot in bots]\n        BotStorage.logger.error(bot_ids)\n        return elasticsearch.helpers.scan(\n            self.connection,\n            index=BotStorage.index_name, doc_type=BotStorage.doc_type,\n            query={'filter': {'term': {'_id': bot_ids}}}\n        )\n```\n\nI have output from when this was written on 25 May that was as intended - that is, one document was received and processed per id passed to the query. I am and have been using version 1.6.0 of Elasticsearch's python API.\n\nIt _did_ work, though that it ever did may be the real bug here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/223550275","html_url":"https://github.com/elastic/elasticsearch/issues/18719#issuecomment-223550275","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719","id":223550275,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzU1MDI3NQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-06-03T10:56:27Z","updated_at":"2016-06-03T10:56:27Z","author_association":"CONTRIBUTOR","body":"> It did work, though that it ever did may be the real bug here.\n\nThis test:\n\n```\nPUT test/doc/1?refresh\n{\n  \"tag\": \"foo\"\n}\n\nPUT test/doc/2?refresh\n{\n  \"tag\": \"bar\"\n}\n\nGET test/_search\n{\n  \"query\": {\n    \"constant_score\": {\n      \"filter\": {\n        \"term\": {\n          \"tag\": [\n            \"foo\",\n            \"bar\"\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\nreturns a single document:\n\n```\n{\n  \"took\": 93,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": 1,\n    \"max_score\": 1,\n    \"hits\": [\n      {\n        \"_index\": \"test\",\n        \"_type\": \"doc\",\n        \"_id\": \"2\",\n        \"_score\": 1,\n        \"_source\": {\n          \"tag\": \"bar\"\n        }\n      }\n    ]\n  }\n}\n```\n\nTested on 0.20.5, 0.90.0, 1.0.0, 1.1.0, 1.2.1, 1.3.0, 1.4.0, 1.5.0, 1.6.0, 1.7.0.\n\nIn 2.0.0, it throws the exception:\n\n```\n\"[term] query does not support array of values\"\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/223551582","html_url":"https://github.com/elastic/elasticsearch/issues/18719#issuecomment-223551582","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719","id":223551582,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzU1MTU4Mg==","user":{"login":"pineapplemachine","id":7266412,"node_id":"MDQ6VXNlcjcyNjY0MTI=","avatar_url":"https://avatars2.githubusercontent.com/u/7266412?v=4","gravatar_id":"","url":"https://api.github.com/users/pineapplemachine","html_url":"https://github.com/pineapplemachine","followers_url":"https://api.github.com/users/pineapplemachine/followers","following_url":"https://api.github.com/users/pineapplemachine/following{/other_user}","gists_url":"https://api.github.com/users/pineapplemachine/gists{/gist_id}","starred_url":"https://api.github.com/users/pineapplemachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pineapplemachine/subscriptions","organizations_url":"https://api.github.com/users/pineapplemachine/orgs","repos_url":"https://api.github.com/users/pineapplemachine/repos","events_url":"https://api.github.com/users/pineapplemachine/events{/privacy}","received_events_url":"https://api.github.com/users/pineapplemachine/received_events","type":"User","site_admin":false},"created_at":"2016-06-03T11:04:19Z","updated_at":"2016-06-03T11:04:19Z","author_association":"NONE","body":"I checked the commit history and the output we were getting when we added the feature the diff was from. `term` acted as `terms` in 1.5.2 on one system and in 1.7.2 on another starting no later than May 23 - and I recall similarly misusing it to test other features a week or so previous - and abruptly ending around May 31.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/223552325","html_url":"https://github.com/elastic/elasticsearch/issues/18719#issuecomment-223552325","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719","id":223552325,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzU1MjMyNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-06-03T11:08:47Z","updated_at":"2016-06-03T11:08:47Z","author_association":"CONTRIBUTOR","body":"@pineapplemachine I've given you a test showing that this isn't true.  If I've made a mistake somewhere, then please provide a test which proves the opposite.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/223554547","html_url":"https://github.com/elastic/elasticsearch/issues/18719#issuecomment-223554547","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719","id":223554547,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzU1NDU0Nw==","user":{"login":"pineapplemachine","id":7266412,"node_id":"MDQ6VXNlcjcyNjY0MTI=","avatar_url":"https://avatars2.githubusercontent.com/u/7266412?v=4","gravatar_id":"","url":"https://api.github.com/users/pineapplemachine","html_url":"https://github.com/pineapplemachine","followers_url":"https://api.github.com/users/pineapplemachine/followers","following_url":"https://api.github.com/users/pineapplemachine/following{/other_user}","gists_url":"https://api.github.com/users/pineapplemachine/gists{/gist_id}","starred_url":"https://api.github.com/users/pineapplemachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pineapplemachine/subscriptions","organizations_url":"https://api.github.com/users/pineapplemachine/orgs","repos_url":"https://api.github.com/users/pineapplemachine/repos","events_url":"https://api.github.com/users/pineapplemachine/events{/privacy}","received_events_url":"https://api.github.com/users/pineapplemachine/received_events","type":"User","site_admin":false},"created_at":"2016-06-03T11:22:01Z","updated_at":"2016-06-03T11:22:01Z","author_association":"NONE","body":"I tried setting my system clock to May 23, and the test you provided still passed, and the filters that were mistakenly functional before still returned only one document.\n\nOther than traveling back in time, it seems I cannot produce a test because the incorrect behavior was transient. I can only point to our commit history and the results we were getting from our term filter usage until we noticed it was no longer functional around 31 May.\n","performed_via_github_app":null}]