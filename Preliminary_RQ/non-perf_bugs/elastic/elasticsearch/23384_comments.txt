[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373775598","html_url":"https://github.com/elastic/elasticsearch/issues/23384#issuecomment-373775598","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384","id":373775598,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mzc3NTU5OA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T16:50:26Z","updated_at":"2018-03-16T16:51:50Z","author_association":"CONTRIBUTOR","body":"The logic for leaf and bucket aggregations is by necessity, different.\r\n\r\n\"Bucket\" aggregations like `histogram` work by assigning docs to buckets and maintaining a doc count for each bucket.\r\n\r\nGiven these two docs:\r\n\r\n    {  \"myvalue\": 1 }\r\n    {  \"myvalue\": [1, 2, 2, 4] }\r\n\r\n.. the histogram agg correctly reports the following doc counts:\r\n\r\n     [\r\n        { \"key\": 1,  \"doc_count\": 2  },\r\n        { \"key\": 2, \"doc_count\": 1 },\r\n        { \"key\": 3, \"doc_count\": 0 },\r\n        { \"key\": 4, \"doc_count\": 1}\r\n     ]\r\n\r\n\"Leaf\" aggregations like `avg` compute results from _value_ instances - a doc may contain none, one or many values and these are added up and divided by the total number of value instances. In the above example there are 5 values instances summing to 10 so the average is 10/5 = 2.\r\n\r\nI'm unclear as to what results you are expecting or what new query syntax would be required to produce them so can you share some examples? Thanks\r\n\r\ncc @elastic/es-search-aggs\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/381092381","html_url":"https://github.com/elastic/elasticsearch/issues/23384#issuecomment-381092381","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384","id":381092381,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MTA5MjM4MQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-04-13T10:18:30Z","updated_at":"2018-04-13T10:18:30Z","author_association":"MEMBER","body":"No further feedback. Please comment if you have more details on the questions asked and we can look at re-opening this issue","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/381130908","html_url":"https://github.com/elastic/elasticsearch/issues/23384#issuecomment-381130908","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384","id":381130908,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MTEzMDkwOA==","user":{"login":"sundarv85","id":11090193,"node_id":"MDQ6VXNlcjExMDkwMTkz","avatar_url":"https://avatars0.githubusercontent.com/u/11090193?v=4","gravatar_id":"","url":"https://api.github.com/users/sundarv85","html_url":"https://github.com/sundarv85","followers_url":"https://api.github.com/users/sundarv85/followers","following_url":"https://api.github.com/users/sundarv85/following{/other_user}","gists_url":"https://api.github.com/users/sundarv85/gists{/gist_id}","starred_url":"https://api.github.com/users/sundarv85/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sundarv85/subscriptions","organizations_url":"https://api.github.com/users/sundarv85/orgs","repos_url":"https://api.github.com/users/sundarv85/repos","events_url":"https://api.github.com/users/sundarv85/events{/privacy}","received_events_url":"https://api.github.com/users/sundarv85/received_events","type":"User","site_admin":false},"created_at":"2018-04-13T13:12:43Z","updated_at":"2018-04-13T13:12:48Z","author_association":"NONE","body":"@colings86 @markharwood Sorry about the delay in getting back.\r\n\r\n@markharwood From your example, \r\n\r\n> \r\n> ```\r\n> {  \"myvalue\": 1 }\r\n> {  \"myvalue\": [1, 2, 2, 4] }\r\n> ```\r\n> .. the histogram agg correctly reports the following doc counts:\r\n> \r\n> ```\r\n>  [\r\n>     { \"key\": 1,  \"doc_count\": 2  },\r\n>     { \"key\": 2, \"doc_count\": 1 },\r\n>     { \"key\": 3, \"doc_count\": 0 },\r\n>     { \"key\": 4, \"doc_count\": 1}\r\n>  ]\r\n> ```\r\n> \r\n\r\nHere, we would prefer to get the count for `key:2` as `2` instead of `1`. As you see,` [1,2,2,4] ` even though it is only one document, `1, 2, 4` each get one doc count. However, the duplicate `2` is not given another additional count, rather only one.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/382366738","html_url":"https://github.com/elastic/elasticsearch/issues/23384#issuecomment-382366738","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384","id":382366738,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MjM2NjczOA==","user":{"login":"sundarv85","id":11090193,"node_id":"MDQ6VXNlcjExMDkwMTkz","avatar_url":"https://avatars0.githubusercontent.com/u/11090193?v=4","gravatar_id":"","url":"https://api.github.com/users/sundarv85","html_url":"https://github.com/sundarv85","followers_url":"https://api.github.com/users/sundarv85/followers","following_url":"https://api.github.com/users/sundarv85/following{/other_user}","gists_url":"https://api.github.com/users/sundarv85/gists{/gist_id}","starred_url":"https://api.github.com/users/sundarv85/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sundarv85/subscriptions","organizations_url":"https://api.github.com/users/sundarv85/orgs","repos_url":"https://api.github.com/users/sundarv85/repos","events_url":"https://api.github.com/users/sundarv85/events{/privacy}","received_events_url":"https://api.github.com/users/sundarv85/received_events","type":"User","site_admin":false},"created_at":"2018-04-18T12:18:34Z","updated_at":"2018-04-18T12:18:34Z","author_association":"NONE","body":"@colings86 could this issue be looked at again? \r\n\r\nImagine a time series where we store one document per minute, multiple occurrences within that minute could easily be captured in an array. Since this histogram is not working on arrays, we have to split the document into separate entires just because of this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385453195","html_url":"https://github.com/elastic/elasticsearch/issues/23384#issuecomment-385453195","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23384","id":385453195,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTQ1MzE5NQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T16:31:16Z","updated_at":"2018-04-30T16:31:16Z","author_association":"MEMBER","body":"@sundarv85 We discussed this internally and I've opened https://github.com/elastic/elasticsearch/issues/30268 which suggests adding a value_count to the buckets which would return the number of values that fell into that bucket. I'm going to keep this issue closed in favour of that one which generalises to all bucket aggregations","performed_via_github_app":null}]