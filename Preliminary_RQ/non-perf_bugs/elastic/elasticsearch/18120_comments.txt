[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/216954565","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-216954565","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":216954565,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNjk1NDU2NQ==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-05-04T18:18:51Z","updated_at":"2016-05-04T18:18:51Z","author_association":"CONTRIBUTOR","body":"Ditto - wouldn't replicate on OSX here. Any chance of a quick Windows test @costin ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/234473540","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-234473540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":234473540,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNDQ3MzU0MA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-07-22T07:26:32Z","updated_at":"2016-07-22T07:26:32Z","author_association":"MEMBER","body":"This fails around 3/4 times a month in our CI. @jpountz pushed https://github.com/elastic/elasticsearch/commit/cad959b to ease debugging which fields are null.\n\nIt does not only fail on Windows. \n\nAs far as I can see the null field is not always the same: I've seen `_superset_size` being null, and also  `_subset_freq`. Here is the latest failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/1601/console .\n\n@markharwood would you mind taking another look? maybe @colings86 would like to check as well?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254432674","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-254432674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":254432674,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDQzMjY3NA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-10-18T07:49:15Z","updated_at":"2016-10-18T07:49:15Z","author_association":"CONTRIBUTOR","body":"@markharwood is this still a problem?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254743574","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-254743574","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":254743574,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDc0MzU3NA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T08:08:32Z","updated_at":"2016-10-19T08:08:32Z","author_association":"CONTRIBUTOR","body":"I've not seen any examples of failures in the available history:\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/311/testReport/junit/org.elasticsearch.search.aggregations.bucket/SignificantTermsSignificanceScoreIT/history/?start=25 \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254752063","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-254752063","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":254752063,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDc1MjA2Mw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T08:46:55Z","updated_at":"2016-10-19T08:46:55Z","author_association":"MEMBER","body":"This is still a problem, last failure was two days ago: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+g1gc/328/console . Still happens a few times a month.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254754799","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-254754799","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":254754799,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDc1NDc5OQ==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T08:58:31Z","updated_at":"2016-10-19T08:58:31Z","author_association":"CONTRIBUTOR","body":"OK, thanks. Will take a look\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254784631","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-254784631","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":254784631,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDc4NDYzMQ==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T11:20:16Z","updated_at":"2016-10-19T11:20:16Z","author_association":"CONTRIBUTOR","body":"Could not reproduce with that seed over many iterations.\n\nThe debug code that Adrien added shows that the very first parameter it tries to retrieve (subset_freq) is null.\nThis is also the first of many non-null parameters set in ScriptHeuristic.initialize():\n\n```\npublic void initialize(ExecutableScript executableScript) {\n    this.executableScript = executableScript;\n    this.executableScript.setNextVar(\"_subset_freq\", subsetDfHolder);\n    this.executableScript.setNextVar(\"_subset_size\", subsetSizeHolder);\n    this.executableScript.setNextVar(\"_superset_freq\", supersetDfHolder);\n    this.executableScript.setNextVar(\"_superset_size\", supersetSizeHolder);\n}\n```\n\nI notice elsewhere that there is a reference to the fact that the test framework can sometimes invoke script.run() before initialization is complete:\n\n```\n@Override\npublic double getScore(long subsetFreq, long subsetSize, long supersetFreq, long supersetSize) {\n    if (executableScript == null) {\n        //In tests, wehn calling assertSearchResponse(..) the response is streamed one additional time with an arbitrary version, see assertVersionSerializable(..).\n        // Now, for version before 1.5.0 the score is computed after streaming the response but for scripts the script does not exists yet.\n        // assertSearchResponse() might therefore fail although there is no problem.\n        // This should be replaced by an exception in 2.0.\n        ESLoggerFactory.getLogger(\"script heuristic\").warn(\"cannot compute score - script has not been initialized yet.\");\n        return 0;\n    }\n    subsetSizeHolder.value = subsetSize;\n    supersetSizeHolder.value = supersetSize;\n    subsetDfHolder.value = subsetFreq;\n    supersetDfHolder.value = supersetFreq;\n    return ((Number) executableScript.run()).doubleValue();\n}\n```\n\nIf this is possible/acceptable then maybe we should reverse the order of the operations in the initialize method - set the script variables up _and only then_ set this.executableScript to the fully initialized object. Any failure to set the variables properly will result in a null script which when getScore() is called will log the appropriate error message \"script has not been initialized yet\". \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254794184","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-254794184","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":254794184,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDc5NDE4NA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T12:11:35Z","updated_at":"2016-10-19T12:11:35Z","author_association":"MEMBER","body":"I remember talking to @brwe about that warning when she created the script score but I don't remember exactly why we needed it. @brwe do you remember?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255087945","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-255087945","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":255087945,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTA4Nzk0NQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-10-20T12:09:31Z","updated_at":"2016-10-20T12:09:31Z","author_association":"MEMBER","body":"Here's another one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.0+java9-periodic/367/console\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255106743","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-255106743","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":255106743,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTEwNjc0Mw==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2016-10-20T13:33:08Z","updated_at":"2016-10-20T13:33:08Z","author_association":"CONTRIBUTOR","body":"Added what could be a fix in master: https://github.com/elastic/elasticsearch/commit/4a815bf6654b5e271942a62d3f2b0dc04c408de9\n\nWill push to other branches if we conclude that this makes the difference\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255162201","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-255162201","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":255162201,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTE2MjIwMQ==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-10-20T16:47:41Z","updated_at":"2016-10-20T16:47:41Z","author_association":"CONTRIBUTOR","body":"@colings86 I do not remember all of it but believe this was an < 2.0 problem and we should really replace the log message for script = null with an assertion. \n@markharwood I do not think that changing the order is a fix here but also do not fully understand what is going on yet. I will dig.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255412092","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-255412092","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":255412092,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTQxMjA5Mg==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-10-21T15:42:41Z","updated_at":"2016-10-21T15:42:41Z","author_association":"CONTRIBUTOR","body":"I think the problem is that the ScriptHeuristic object is reused and hence accessed from different threads concurrently. How exactly this happens and if it is a problem of our tests only I cannot say yet because I am struggling to navigate aggregations. Will continue Monday. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255728956","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-255728956","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":255728956,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTcyODk1Ng==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-10-24T12:40:16Z","updated_at":"2016-10-24T12:40:16Z","author_association":"CONTRIBUTOR","body":"If a coordinating node routes search requests to local shards they will not be streamed but the same aggregations builder object will be used for each individual shards that the request is executed on. When the aggregation is build significant terms heuristic is reused and hence several shards can end up with the same ScriptHeuristic object and also modify it concurrently. Instead the builders should make a copy and pass these to the aggregators. Hope I got the nomenclature right. I can work on a fix. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255735349","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-255735349","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":255735349,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTczNTM0OQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2016-10-24T13:08:29Z","updated_at":"2016-10-24T13:08:29Z","author_association":"MEMBER","body":"@brwe that makes sense, we have to do something similar for the Scripted Metric Aggregation\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255741809","html_url":"https://github.com/elastic/elasticsearch/issues/18120#issuecomment-255741809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18120","id":255741809,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTc0MTgwOQ==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2016-10-24T13:35:08Z","updated_at":"2016-10-24T13:35:08Z","author_association":"CONTRIBUTOR","body":"One correction to what I wrote above: The script must be be reused either because we set variables in it. We need one instance per shard.\n","performed_via_github_app":null}]