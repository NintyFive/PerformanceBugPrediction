{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43184","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43184/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43184/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43184/events","html_url":"https://github.com/elastic/elasticsearch/issues/43184","id":455509710,"node_id":"MDU6SXNzdWU0NTU1MDk3MTA=","number":43184,"title":"Watcher: getting painless script errors having null in email admin watches","user":{"login":"Leaf-Lin","id":39002973,"node_id":"MDQ6VXNlcjM5MDAyOTcz","avatar_url":"https://avatars3.githubusercontent.com/u/39002973?v=4","gravatar_id":"","url":"https://api.github.com/users/Leaf-Lin","html_url":"https://github.com/Leaf-Lin","followers_url":"https://api.github.com/users/Leaf-Lin/followers","following_url":"https://api.github.com/users/Leaf-Lin/following{/other_user}","gists_url":"https://api.github.com/users/Leaf-Lin/gists{/gist_id}","starred_url":"https://api.github.com/users/Leaf-Lin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Leaf-Lin/subscriptions","organizations_url":"https://api.github.com/users/Leaf-Lin/orgs","repos_url":"https://api.github.com/users/Leaf-Lin/repos","events_url":"https://api.github.com/users/Leaf-Lin/events{/privacy}","received_events_url":"https://api.github.com/users/Leaf-Lin/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-06-13T02:48:26Z","updated_at":"2019-10-08T22:20:13Z","closed_at":"2019-10-08T22:20:13Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.1.1\r\n**Plugins installed**: no\r\n**JVM version** (`java -version`): On Elastic Cloud\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): On Elastic Cloud\r\n\r\n**Description of the problem including expected versus actual behavior**: \r\nI thought this has been fixed in https://github.com/elastic/elasticsearch/pull/32923.\r\nBut I noticed a cluster running 7.1.1 is still getting the following error:\r\n```\r\n[instance-0000000006] failed to execute [script] transform for [h0rBJUPOSgeB-ZGRbrQ60A_elasticsearch_cluster_status_77a4d766-3da2-4b2b-92d9-451de304e9cf-2019-06-13T02:31:50.556Z]\r\norg.elasticsearch.script.ScriptException: runtime error\r\n\tat org.elasticsearch.painless.PainlessScript.convertToScriptException(PainlessScript.java:94) ~[?:?]\r\n\tat org.elasticsearch.painless.PainlessScript$Script.execute(ctx.vars.email_recipient = (ctx.payload.kibana_settings.hits.total > 0 && ctx.payload.kibana_settings.hits.hits[0]._source.kibana_settings.xpack != null) ? ctx.payload.kibana_settings.hits.hits[0]._source.kibana_settings.xpack.default_admin_email : null;ct ...:1152) ~[?:?]\r\n\tat org.elasticsearch.xpack.watcher.transform.script.ExecutableScriptTransform.doExecute(ExecutableScriptTransform.java:49) ~[x-pack-watcher-7.1.1.jar:7.1.1]\r\n\tat org.elasticsearch.xpack.watcher.transform.script.ExecutableScriptTransform.execute(ExecutableScriptTransform.java:38) ~[x-pack-watcher-7.1.1.jar:7.1.1]\r\n\tat org.elasticsearch.xpack.watcher.transform.script.ExecutableScriptTransform.execute(ExecutableScriptTransform.java:23) ~[x-pack-watcher-7.1.1.jar:7.1.1]\r\n\tat org.elasticsearch.xpack.watcher.execution.ExecutionService.executeInner(ExecutionService.java:505) ~[x-pack-watcher-7.1.1.jar:7.1.1]\r\n\tat org.elasticsearch.xpack.watcher.execution.ExecutionService.execute(ExecutionService.java:309) ~[x-pack-watcher-7.1.1.jar:7.1.1]\r\n\tat org.elasticsearch.xpack.watcher.execution.ExecutionService.lambda$executeAsync$5(ExecutionService.java:410) ~[x-pack-watcher-7.1.1.jar:7.1.1]\r\n\tat org.elasticsearch.xpack.watcher.execution.ExecutionService$WatchExecutionTask.run(ExecutionService.java:605) [x-pack-watcher-7.1.1.jar:7.1.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [elasticsearch-7.1.1.jar:7.1.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_144]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_144]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_144]\r\nCaused by: java.lang.IndexOutOfBoundsException: Index: 0, Size: 0\r\n\tat java.util.ArrayList.rangeCheck(ArrayList.java:653) ~[?:1.8.0_144]\r\n\tat java.util.ArrayList.get(ArrayList.java:429) ~[?:1.8.0_144]\r\n\tat org.elasticsearch.painless.PainlessScript$Script.execute(ctx.vars.email_recipient = (ctx.payload.kibana_settings.hits.total > 0 && ctx.payload.kibana_settings.hits.hits[0]._source.kibana_settings.xpack != null) ? ctx.payload.kibana_settings.hits.hits[0]._source.kibana_settings.xpack.default_admin_email : null;ct ...:429) ~[?:?]\r\n\t... 11 more\r\n```\r\n\r\n**Steps to reproduce**:\r\n\r\nThe admin email has not been set up. \r\nAnd just having the default system watchers.\r\n\r\n","closed_by":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}