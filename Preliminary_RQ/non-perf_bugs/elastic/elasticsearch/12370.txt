{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12370","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12370/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12370/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12370/events","html_url":"https://github.com/elastic/elasticsearch/issues/12370","id":96304781,"node_id":"MDU6SXNzdWU5NjMwNDc4MQ==","number":12370,"title":"Distance Score query gives wrong sort order","user":{"login":"Molenx","id":1297129,"node_id":"MDQ6VXNlcjEyOTcxMjk=","avatar_url":"https://avatars2.githubusercontent.com/u/1297129?v=4","gravatar_id":"","url":"https://api.github.com/users/Molenx","html_url":"https://github.com/Molenx","followers_url":"https://api.github.com/users/Molenx/followers","following_url":"https://api.github.com/users/Molenx/following{/other_user}","gists_url":"https://api.github.com/users/Molenx/gists{/gist_id}","starred_url":"https://api.github.com/users/Molenx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Molenx/subscriptions","organizations_url":"https://api.github.com/users/Molenx/orgs","repos_url":"https://api.github.com/users/Molenx/repos","events_url":"https://api.github.com/users/Molenx/events{/privacy}","received_events_url":"https://api.github.com/users/Molenx/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-07-21T12:30:51Z","updated_at":"2015-07-23T10:23:21Z","closed_at":"2015-07-23T10:23:21Z","author_association":"NONE","active_lock_reason":null,"body":"Using _geo_distance query gives me correct order by closest distance, geoCenter field is created using a transform in the mapping. \n\n```\n{\n  \"from\": 0,\n  \"size\": 200,\n  \"sort\": [\n    {\n      \"_geo_distance\": {\n        \"geoCenter\": {\n          \"lat\": 29.745703,\n          \"lon\": -95.740514\n        },\n        \"order\": \"asc\",\n        \"unit\": \"mi\",\n        \"distance_type\": \"plane\"\n      }\n    }\n  ]\n}\n```\n\nHowever using Distance Score query on the same field gives wrong sort, every 4th item or so in the results gets lower score even though it closer, the deeper you go through the results the more wrong sorts I get, tried using different score functions and parameters but still getting same wrong sort consistently.\n\n```\n{\n  \"from\": 0,\n  \"size\": 100,\n  \"script_fields\": {\n    \"MilesAway\": {\n      \"script\": \"doc['geoCenter'].distanceInMiles(lat,lon)\",\n      \"params\": {\n        \"lat\": 29.745703,\n        \"lon\": -95.740514\n      }\n    }\n  },\n  \"_source\": {\n    \"include\": [\n      \"doc.*\"\n    ]\n  },\n  \"query\": {\n    \"function_score\": {\n      \"functions\": [\n        {\n          \"gauss\": {\n            \"geoCenter\": {\n              \"origin\": {\n                \"lat\": 29.745703,\n                \"lon\": -95.740514\n              },\n              \"scale\": \"500m\",\n              \"offset\": \"1km\",\n              \"decay\": 0.99\n            }\n          }\n        }\n      ]\n    }\n  }\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}