[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/293817261","html_url":"https://github.com/elastic/elasticsearch/issues/24082#issuecomment-293817261","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24082","id":293817261,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MzgxNzI2MQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2017-04-13T07:44:08Z","updated_at":"2017-04-13T07:44:08Z","author_association":"MEMBER","body":"Hi @jasw! I just ran the reproduction scenario on a fresh install of Elasticsearch 2.4.4 and Elasticsearch 5.0.0. Both versions behave identical, so I cannot confirm your claim that Elasticsearch 5.0.0 behaves differently. Also, the query does not do what you think it does. Hence, I'll close it as it is not a bug.\r\n\r\nHowever, I think I have a solution for your problem and will soon follow up on the related Discuss thread that you have created recently: https://discuss.elastic.co/t/query-string-query-escaping-spaces-in-v2-3/81254","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/293835606","html_url":"https://github.com/elastic/elasticsearch/issues/24082#issuecomment-293835606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24082","id":293835606,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MzgzNTYwNg==","user":{"login":"jasw","id":107973,"node_id":"MDQ6VXNlcjEwNzk3Mw==","avatar_url":"https://avatars3.githubusercontent.com/u/107973?v=4","gravatar_id":"","url":"https://api.github.com/users/jasw","html_url":"https://github.com/jasw","followers_url":"https://api.github.com/users/jasw/followers","following_url":"https://api.github.com/users/jasw/following{/other_user}","gists_url":"https://api.github.com/users/jasw/gists{/gist_id}","starred_url":"https://api.github.com/users/jasw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasw/subscriptions","organizations_url":"https://api.github.com/users/jasw/orgs","repos_url":"https://api.github.com/users/jasw/repos","events_url":"https://api.github.com/users/jasw/events{/privacy}","received_events_url":"https://api.github.com/users/jasw/received_events","type":"User","site_admin":false},"created_at":"2017-04-13T09:11:16Z","updated_at":"2017-04-13T09:13:05Z","author_association":"NONE","body":"@danielmitterdorfer  Thank you very much. Thats really insightful.   I think my question has been addressed by your suggest perfectly. However, I tried to use the 2.4 fresh installed elastic search docker (the 2.4 version points to 2.4.4) and 5.0 version (points to 5.3.0). The behaviours for the same search on the same data did give different answers. \r\n\r\nNote, I am very happy for this ticket to be closed as I have a better solution thanks to your suggestion. Can you please update the document on the escaping part?  I do think your explanation would help a lot of people like me. \r\n\r\nHere is what I have tried:\r\n\r\n\r\n```\r\ndocker run -d -p 9200:9200 -e \"http.host=0.0.0.0\" -e \"transport.host=127.0.0.1\" -e \"xpack.security.enabled=false\" docker.elastic.co/elasticsearch/elasticsearch:5.3.0\r\n```\r\n\r\n You can see it is running 5.3.0\r\n```\r\ncurl -XGET 'localhost:9200/'\r\n{\r\n  \"name\" : \"UYb3yL1\",\r\n  \"cluster_name\" : \"docker-cluster\",\r\n  \"cluster_uuid\" : \"Dvhqa5W-SZ2L10MYDTmE4A\",\r\n  \"version\" : {\r\n    \"number\" : \"5.3.0\",\r\n    \"build_hash\" : \"3adb13b\",\r\n    \"build_date\" : \"2017-03-23T03:31:50.652Z\",\r\n    \"build_snapshot\" : false,\r\n    \"lucene_version\" : \"6.4.1\"\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}\r\n```\r\n\r\nThe search returns one match:\r\n```\r\ncurl -XGET 'localhost:9200/my_index/_search?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n       \"query\" : \"*A\\\\ B\\\\ C\\\\ *\",\r\n      \"fields\": [\"city\",\"city.raw\"]\r\n    }\r\n  }\r\n}\r\n'\r\n\r\n{\r\n  \"took\" : 31,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 1,\r\n    \"max_score\" : 1.0,\r\n    \"hits\" : [\r\n      {\r\n        \"_index\" : \"my_index\",\r\n        \"_type\" : \"my_type\",\r\n        \"_id\" : \"1\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"city\" : \"A B C Cleaning\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nNow run it on Elastic Search 2.4.4\r\n\r\n```\r\n curl -XGET 'localhost:32772/my_index/_search?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"query\": {\r\n    \"query_string\": {\r\n       \"query\" : \"*A\\\\ B\\\\ C\\\\ *\",\r\n      \"fields\": [\"city\",\"city.raw\"]\r\n    }\r\n  }\r\n}\r\n'\r\n\r\n{\r\n  \"took\" : 34,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 0,\r\n    \"max_score\" : null,\r\n    \"hits\" : [ ]\r\n  }\r\n}\r\n```\r\n\r\n\r\nData in 2.4.4 and 5.3.0 are identical (9200 ports is for 5.3.0 and 32772 is for 2.4.4):\r\n\r\n```\r\ncurl -XGET  http://localhost:9200/my_index/_search\\?pretty -d '\r\n{\r\n    \"aggs\" : {\r\n        \"genres\" : {\r\n            \"terms\" : { \"field\" : \"city.raw\" }\r\n        }\r\n    }\r\n}'\r\n{\r\n  \"took\" : 4,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 2,\r\n    \"max_score\" : 1.0,\r\n    \"hits\" : [\r\n      {\r\n        \"_index\" : \"my_index\",\r\n        \"_type\" : \"my_type\",\r\n        \"_id\" : \"2\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"city\" : \"Cleaning\"\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"my_index\",\r\n        \"_type\" : \"my_type\",\r\n        \"_id\" : \"1\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"city\" : \"A B C Cleaning\"\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"aggregations\" : {\r\n    \"genres\" : {\r\n      \"doc_count_error_upper_bound\" : 0,\r\n      \"sum_other_doc_count\" : 0,\r\n      \"buckets\" : [\r\n        {\r\n          \"key\" : \"A B C Cleaning\",\r\n          \"doc_count\" : 1\r\n        },\r\n        {\r\n          \"key\" : \"Cleaning\",\r\n          \"doc_count\" : 1\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n```\r\ncurl -XGET  http://localhost:32772/my_index/_search\\?pretty -d '\r\n{\r\n    \"aggs\" : {\r\n        \"genres\" : {\r\n            \"terms\" : { \"field\" : \"city.raw\" }\r\n        }\r\n    }\r\n}'\r\n{\r\n  \"took\" : 480,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 2,\r\n    \"max_score\" : 1.0,\r\n    \"hits\" : [ {\r\n      \"_index\" : \"my_index\",\r\n      \"_type\" : \"my_type\",\r\n      \"_id\" : \"2\",\r\n      \"_score\" : 1.0,\r\n      \"_source\" : {\r\n        \"city\" : \"Cleaning\"\r\n      }\r\n    }, {\r\n      \"_index\" : \"my_index\",\r\n      \"_type\" : \"my_type\",\r\n      \"_id\" : \"1\",\r\n      \"_score\" : 1.0,\r\n      \"_source\" : {\r\n        \"city\" : \"A B C Cleaning\"\r\n      }\r\n    } ]\r\n  },\r\n  \"aggregations\" : {\r\n    \"genres\" : {\r\n      \"doc_count_error_upper_bound\" : 0,\r\n      \"sum_other_doc_count\" : 0,\r\n      \"buckets\" : [ {\r\n        \"key\" : \"A B C Cleaning\",\r\n        \"doc_count\" : 1\r\n      }, {\r\n        \"key\" : \"Cleaning\",\r\n        \"doc_count\" : 1\r\n      } ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nSo they DO look like behaving differently. \r\n\r\nAppreciate your help Daniel! \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/293857744","html_url":"https://github.com/elastic/elasticsearch/issues/24082#issuecomment-293857744","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24082","id":293857744,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Mzg1Nzc0NA==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2017-04-13T10:54:56Z","updated_at":"2017-04-13T10:55:33Z","author_association":"MEMBER","body":"I can confirm that the behavior you describe has changed with Elasticsearch 5.1.1 but as we've both found out, your requirements are best met by a different query anyway.\r\n\r\n> Can you please update the document on the escaping part?\r\n\r\nI am not sure what you mean by \"escaping part\"? Do you mean that we should document that double quotes need to be escaped when used within a JSON string?, i.e. this:\r\n\r\n```\r\nGET /my_index/_search\r\n{\r\n    \"query\": {\r\n        \"query_string\": {\r\n           \"fields\": [\"city\"],\r\n           \"query\": \"\\\"A B C\\\"\"\r\n        }\r\n    }\r\n}\r\n```","performed_via_github_app":null}]