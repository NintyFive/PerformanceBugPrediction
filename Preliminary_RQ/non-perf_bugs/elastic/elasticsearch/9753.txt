{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9753","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9753/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9753/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9753/events","html_url":"https://github.com/elastic/elasticsearch/issues/9753","id":58151916,"node_id":"MDU6SXNzdWU1ODE1MTkxNg==","number":9753,"title":"Combining Multiple Queries with 'OR' or 'AND'","user":{"login":"shimanbb","id":582863,"node_id":"MDQ6VXNlcjU4Mjg2Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/582863?v=4","gravatar_id":"","url":"https://api.github.com/users/shimanbb","html_url":"https://github.com/shimanbb","followers_url":"https://api.github.com/users/shimanbb/followers","following_url":"https://api.github.com/users/shimanbb/following{/other_user}","gists_url":"https://api.github.com/users/shimanbb/gists{/gist_id}","starred_url":"https://api.github.com/users/shimanbb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shimanbb/subscriptions","organizations_url":"https://api.github.com/users/shimanbb/orgs","repos_url":"https://api.github.com/users/shimanbb/repos","events_url":"https://api.github.com/users/shimanbb/events{/privacy}","received_events_url":"https://api.github.com/users/shimanbb/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-02-19T00:33:28Z","updated_at":"2015-02-19T08:55:44Z","closed_at":"2015-02-19T08:55:44Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n# Question\n\nI am trying to combine 2 user search queries using AND and OR as operation. I am aware of combining queries where we can merge filters, but I want to merge entire queries like { {BIG Elastic Query1} AND {BIG Elastic Query2} }.\n# Details\n\nFor instance say a user performs a search for \"batman in movies type with filters of Christian and Bale\" and another query \"Dark Knight in type tvshows with filters of Christopher Nolan\". I want to combine both queries so I can look for both batman movies and Dark Knight tvshows, but not Dark knight movies or batman tvshows.\n\nFor example, for the given queries\nI just want to run Query1 OR Query2 in the elasticsearch.\n# Query 1:\n\n``` JSON\n{\n   \"query\": {\n      \"filtered\": {\n         \"query\": { \n            \"query_string\":{  \n               \"query\":\"Batman\",\n               \"default_operator\":\"AND\",\n               \"fields\":[  \n                  \"Movies._all\"\n               ]\n            }\n         },\n         \"filter\": {\n            \"bool\": {\n               \"must\": [  \n                  {  \n                     \"query\":{  \n                        \"filtered\":{  \n                           \"filter\":{  \n                              \"and\":[  \n                                 {  \n                                    \"term\":{  \n                                       \"cast.firstName\":\"Christian\"\n                                    }\n                                 },\n                                 {  \n                                    \"term\":{  \n                                       \"cast.lastName\":\"Bale\"\n                                    }\n                                 }\n                              ]\n                           }\n                        }\n                     }\n                  }\n               ]\n            }\n         }\n      }\n   }\n}\n```\n# Query2:\n\n``` JSON\n{\n   \"query\": {\n      \"filtered\": {\n         \"query\": { \n            \"query_string\":{  \n               \"query\":\"Dark Knight\",\n               \"default_operator\":\"AND\",\n               \"fields\":[  \n                  \"tvshows._all\"\n               ]\n            }\n         },\n         \"filter\": {\n            \"bool\": {\n               \"must\": [  \n                  {  \n                     \"query\":{  \n                        \"filtered\":{  \n                           \"filter\":{  \n                              \"and\":[  \n                                 {  \n                                    \"term\":{  \n                                       \"director.firstName\":\"Christopher\"\n                                    }\n                                 },\n                                 {  \n                                    \"term\":{  \n                                       \"director.lastName\":\"Nolan\"\n                                    }\n                                 }\n                              ]\n                           }\n                        }\n                     }\n                  }\n               ]\n            }\n         }\n      }\n   }\n}\n```\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}