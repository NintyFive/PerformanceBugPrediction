{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21010","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21010/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21010/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21010/events","html_url":"https://github.com/elastic/elasticsearch/issues/21010","id":183871428,"node_id":"MDU6SXNzdWUxODM4NzE0Mjg=","number":21010,"title":"Elasticsearch cluster not recovers from disconnection","user":{"login":"guenhter","id":16029571,"node_id":"MDQ6VXNlcjE2MDI5NTcx","avatar_url":"https://avatars2.githubusercontent.com/u/16029571?v=4","gravatar_id":"","url":"https://api.github.com/users/guenhter","html_url":"https://github.com/guenhter","followers_url":"https://api.github.com/users/guenhter/followers","following_url":"https://api.github.com/users/guenhter/following{/other_user}","gists_url":"https://api.github.com/users/guenhter/gists{/gist_id}","starred_url":"https://api.github.com/users/guenhter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guenhter/subscriptions","organizations_url":"https://api.github.com/users/guenhter/orgs","repos_url":"https://api.github.com/users/guenhter/repos","events_url":"https://api.github.com/users/guenhter/events{/privacy}","received_events_url":"https://api.github.com/users/guenhter/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-10-19T05:50:37Z","updated_at":"2016-10-19T09:10:45Z","closed_at":"2016-10-19T09:10:45Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:\n5.0.0-RC1\nuse elasticsearch-docker\n\n**Plugins installed**: []\nNot by myself. Only already installed plugins from elasticsearch-docker\n\n**JVM version**:\nJVM from elasticsearch-docker\n\n**OS version**:\nDebian 8.6\nLinux apollo 4.7.0-0.bpo.1-amd64 #1 SMP Debian 4.7.5-1~bpo8+2 (2016-10-01) x86_64 GNU/Linux\n\n**Description of the problem including expected versus actual behavior**:\nCluster running on two nodes. Only one of them is configured as master, but both are data nodes.\nIt is running within docker swarm (and also use the overlay network of docker).\nThe plain cluster (which is idle because nothing is currently writing to it) nodes sometimes loses their connection to each other but it seems that they don't recover from tag (at least not always)\n\nIts not (at least not only) a networking issue, because when I remove and re-add the data node, everything is fine again.\n\n```\ncurl -u elastic http://138.201.138.161:9201/_cat/health\nEnter host password for user 'elastic':\n1476855078 07:31:18 docker-cluster yellow 1 1 7 7 0 0 6 0 - 53.8%\n```\n\n**Steps to reproduce**:\n1. Setup docker 1.12.2 in swarm mode (with at least two nodes)\n2. Run two nodes (one master one only data)\n3. Just leave them over night\n4. In the morning, the cluster state is yellow because the connection is lost\n\n```\ndocker network create --driver overlay elastic\ndocker service create \\\n              --name es_1 \\\n              --network elastic \\\n              -p 9201:9200 -p 9301:9301 \\\n              -e \"discovery.zen.ping.unicast.hosts=es_1:9301\" \\\n              -e ES_JAVA_OPTS=\"-Xms256m -Xmx256m\" \\\n              -e \"discovery.zen.minimum_master_nodes=1\" \\\n              -e \"transport.tcp.port=9301\" \\\n              --mount type=bind,source=/etc/localtime,destination=/etc/localtime,readonly \\\n              --mount type=bind,source=/etc/timezone,destination=/etc/timezone,readonly \\\n              --mount type=volume,source=elasticsearch,destination=/usr/share/elasticsearch/data \\\n              docker.elastic.co/elasticsearch/elasticsearch\ndocker service create \\\n              --name es_2 \\\n              --network elastic \\\n              -p 9202:9200 -p 9302:9302 \\\n              -e \"discovery.zen.ping.unicast.hosts=es_1:9301\" \\\n              -e ES_JAVA_OPTS=\"-Xms256m -Xmx256m\" \\\n              -e \"discovery.zen.minimum_master_nodes=1\" \\\n              -e \"transport.tcp.port=9302\" \\\n              --mount type=bind,source=/etc/localtime,destination=/etc/localtime,readonly \\\n              --mount type=bind,source=/etc/timezone,destination=/etc/timezone,readonly \\\n              --mount type=volume,source=elasticsearch,destination=/usr/share/elasticsearch/data \\\n              docker.elastic.co/elasticsearch/elasticsearch\n```\n\n*\\* Logs\n[es_log_data_node.txt](https://github.com/elastic/elasticsearch/files/538038/es_log_data_node.txt)\n[es_log_master_node.txt](https://github.com/elastic/elasticsearch/files/538037/es_log_master_node.txt)\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}