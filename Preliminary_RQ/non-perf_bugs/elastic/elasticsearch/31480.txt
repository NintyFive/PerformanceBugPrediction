{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31480","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31480/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31480/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31480/events","html_url":"https://github.com/elastic/elasticsearch/issues/31480","id":334234169,"node_id":"MDU6SXNzdWUzMzQyMzQxNjk=","number":31480,"title":"CCS:  Handling missing index in downstream clusters","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"}],"state":"closed","locked":false,"assignee":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"assignees":[{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2018-06-20T20:18:59Z","updated_at":"2018-06-21T14:44:53Z","closed_at":"2018-06-21T14:43:53Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.2.1\r\n\r\n**Steps to reproduce**:\r\n\r\nNot sure if it's the expected behavior or a documentation issue.\r\n\r\nCreate a ccs setup with a ccs cluster with a downstream cluster_one that has an index called test, and cluster_two without the same index name.\r\n\r\nGET cluster_one:test,cluster_two:test/_search\r\n\r\nResults in:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"index_not_found_exception\",\r\n        \"reason\": \"no such index\",\r\n        \"index_uuid\": \"_na_\",\r\n        \"resource.type\": \"index_or_alias\",\r\n        \"resource.id\": \"test\",\r\n        \"index\": \"test\"\r\n      }\r\n    ],\r\n    \"type\": \"transport_exception\",\r\n    \"reason\": \"unable to communicate with remote cluster [cluster_two]\",\r\n    \"caused_by\": {\r\n      \"type\": \"index_not_found_exception\",\r\n      \"reason\": \"no such index\",\r\n      \"index_uuid\": \"_na_\",\r\n      \"resource.type\": \"index_or_alias\",\r\n      \"resource.id\": \"test\",\r\n      \"index\": \"test\"\r\n    }\r\n  },\r\n  \"status\": 500\r\n}\r\n```\r\n\r\nCertainly, if I set `\"search.remote.cluster_two.skip_unavailable\": true`, it will work and skip over cluster_two without throwing the error.  \r\n\r\nAlternatively, without setting skip_unavailable, I can also simply add `ignore_unavailable=true` to the _search call to avoid this error.\r\n\r\nIn our current [doc](https://www.elastic.co/guide/en/elasticsearch/reference/6.3/modules-cross-cluster-search.html#_skipping_disconnected_clusters), we present skip_unavailable as a setting for dealing with disconnected clusters or when the search is against a downstream cluster(s) where no nodes belonging to them are available.\r\n\r\nIs it the expected behavior for it to fail with a 500 error if the query is requesting data from an index from a set of downstream clusters where one of them may not have the index (but all the nodes in all downstream clusters are available)?   If it is the expected behavior, it will be helpful to update our documentation to talk about skip_unavailable not only in the context of node availability/connection, but also for the no index use case.\r\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}