{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41927","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41927/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41927/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41927/events","html_url":"https://github.com/elastic/elasticsearch/issues/41927","id":441514145,"node_id":"MDU6SXNzdWU0NDE1MTQxNDU=","number":41927,"title":"Strictness of strict_date_optional_time date format in 7.0.0","user":{"login":"russcam","id":208231,"node_id":"MDQ6VXNlcjIwODIzMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/208231?v=4","gravatar_id":"","url":"https://api.github.com/users/russcam","html_url":"https://github.com/russcam","followers_url":"https://api.github.com/users/russcam/followers","following_url":"https://api.github.com/users/russcam/following{/other_user}","gists_url":"https://api.github.com/users/russcam/gists{/gist_id}","starred_url":"https://api.github.com/users/russcam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russcam/subscriptions","organizations_url":"https://api.github.com/users/russcam/orgs","repos_url":"https://api.github.com/users/russcam/repos","events_url":"https://api.github.com/users/russcam/events{/privacy}","received_events_url":"https://api.github.com/users/russcam/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-05-08T01:47:59Z","updated_at":"2019-05-08T01:54:05Z","closed_at":"2019-05-08T01:54:04Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.0.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\n\r\njava version \"1.8.0_201\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_201-b09)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\n```ps\r\nGet-CimInstance Win32_OperatingSystem | Select-Object Caption, Version, ServicePackMajorVersion, OSArchitecture | Format-List\r\n```\r\nCaption                 : Microsoft Windows 10 Pro\r\nVersion                 : 10.0.17763\r\nServicePackMajorVersion : 0\r\nOSArchitecture          : 64-bit\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nThe strictness of the default formatting applied to a `date` property between 6.7.2 and 7.0.0 causes requests that succeeded against 6.7.2 to fail against 7.0.0.\r\n\r\nI think this may possibly be related to `strict_date_optional_time` requiring 3 places for sub second values in 7.0.0.\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/37758bb58306a9a319ec46e42aa8aead7a3acc5d/server/src/main/java/org/elasticsearch/common/time/DateFormatters.java#L113\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Start Elasticsearch 6.7.2\r\n 2. Execute the following requests\r\n\r\n```json\r\nPUT http://localhost:9200/default_index?pretty=true \r\n{\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"createdDate\": {\r\n          \"type\": \"date\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST http://localhost:9200/default_index/_doc?pretty=true&refresh=wait_for \r\n{\r\n  \"createdDate\": \"2019-05-07T12:00:00.01\"\r\n}\r\n```\r\n 3. See that 6.7.2 happily accepts the date string `\"2019-05-07T12:00:00.01\"`\r\n 4. Stop Elasticsearch 6.7.2 and start Elasticsearch 7.0.0 \r\n 5. Execute the following requests\r\n\r\n```json\r\nPUT http://localhost:9200/default_index?pretty=true \r\n{\"mappings\":{\"properties\":{\"createdDate\":{\"type\":\"date\"}}}}\r\n\r\nPOST http://localhost:9200/default_index/_doc?pretty=true&refresh=wait_for \r\n{\"createdDate\":\"2019-05-07T12:00:00.01\"}\r\n```\r\n  \r\n  See that indexing the document with date string fails \"2019-05-07T12:00:00.01\"\r\n\r\n```json\r\nStatus: 400\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"mapper_parsing_exception\",\r\n        \"reason\" : \"failed to parse field [createdDate] of type [date] in document with id '0LUdlWoB3J8uIm0O7hI4'\"\r\n      }\r\n    ],\r\n    \"type\" : \"mapper_parsing_exception\",\r\n    \"reason\" : \"failed to parse field [createdDate] of type [date] in document with id '0LUdlWoB3J8uIm0O7hI4'\",\r\n    \"caused_by\" : {\r\n      \"type\" : \"illegal_argument_exception\",\r\n      \"reason\" : \"failed to parse date field [2019-05-07T12:00:00.01] with format [strict_date_optional_time||epoch_millis]\",\r\n      \"caused_by\" : {\r\n        \"type\" : \"date_time_parse_exception\",\r\n        \"reason\" : \"Failed to parse with all enclosed parsers\"\r\n      }\r\n    }\r\n  },\r\n  \"status\" : 400\r\n}\r\n```\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}