{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3030","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3030/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3030/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3030/events","html_url":"https://github.com/elastic/elasticsearch/issues/3030","id":14274838,"node_id":"MDU6SXNzdWUxNDI3NDgzOA==","number":3030,"title":"has_child fails with certain documents","user":{"login":"nmpolo","id":1206982,"node_id":"MDQ6VXNlcjEyMDY5ODI=","avatar_url":"https://avatars3.githubusercontent.com/u/1206982?v=4","gravatar_id":"","url":"https://api.github.com/users/nmpolo","html_url":"https://github.com/nmpolo","followers_url":"https://api.github.com/users/nmpolo/followers","following_url":"https://api.github.com/users/nmpolo/following{/other_user}","gists_url":"https://api.github.com/users/nmpolo/gists{/gist_id}","starred_url":"https://api.github.com/users/nmpolo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nmpolo/subscriptions","organizations_url":"https://api.github.com/users/nmpolo/orgs","repos_url":"https://api.github.com/users/nmpolo/repos","events_url":"https://api.github.com/users/nmpolo/events{/privacy}","received_events_url":"https://api.github.com/users/nmpolo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2013-05-13T18:34:20Z","updated_at":"2013-05-13T18:45:34Z","closed_at":"2013-05-13T18:45:34Z","author_association":"NONE","active_lock_reason":null,"body":"I currently have the following document structure:\n- Organisation\n- User (child of organisation)\n- Sickness (child of user)\n- Periods (nested document in sickness)\n\nI'm trying to find User documents which have sickness documents that match a date range. However, the majority of User documents fail to be matched even though they should be returned - some documents do match though. If I search directly for Sickness documents, the correct ones are returned.\n\nThe query I'm using is like this:\nquery: {\n  bool: {\n    must: [\n    {\n      bool: {\n        must: [\n        {\n          bool: {\n            must: [\n            {\n              range: {\n                periods.start: {\n                  to: \"2013-05-13 19:29:29\"\n                }\n              }\n            },\n            {\n              range: {\n                periods.end: {\n                  from: \"2013-05-13 19:29:29\"\n                }\n              }\n            }\n          ]\n          }\n      }\n      ]\n      }\n    }\n    ]\n  }\n}\n\nIf, however, I remove the Organisation document (and specify that User documents have no parent), then the query works absolutely fine and all the correct User documents are returned.\n\nIs there some issue with using has_child on documents that also have a parent document?\n","closed_by":{"login":"nmpolo","id":1206982,"node_id":"MDQ6VXNlcjEyMDY5ODI=","avatar_url":"https://avatars3.githubusercontent.com/u/1206982?v=4","gravatar_id":"","url":"https://api.github.com/users/nmpolo","html_url":"https://github.com/nmpolo","followers_url":"https://api.github.com/users/nmpolo/followers","following_url":"https://api.github.com/users/nmpolo/following{/other_user}","gists_url":"https://api.github.com/users/nmpolo/gists{/gist_id}","starred_url":"https://api.github.com/users/nmpolo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nmpolo/subscriptions","organizations_url":"https://api.github.com/users/nmpolo/orgs","repos_url":"https://api.github.com/users/nmpolo/repos","events_url":"https://api.github.com/users/nmpolo/events{/privacy}","received_events_url":"https://api.github.com/users/nmpolo/received_events","type":"User","site_admin":false},"performed_via_github_app":null}