[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307038866","html_url":"https://github.com/elastic/elasticsearch/issues/25113#issuecomment-307038866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25113","id":307038866,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzAzODg2Ng==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2017-06-08T08:41:10Z","updated_at":"2017-06-08T08:41:10Z","author_association":"MEMBER","body":"I could quickly reproduce the issue, but my systemd skills fail me to get more debug logs for now...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308607890","html_url":"https://github.com/elastic/elasticsearch/issues/25113#issuecomment-308607890","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25113","id":308607890,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODYwNzg5MA==","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2017-06-15T02:05:50Z","updated_at":"2017-06-15T02:05:50Z","author_association":"MEMBER","body":"This is still occurring on 5.4.1 (upgrading from 5.3.0) and only affects ES when the node is configured as the tribe node.  In this case, the repro is on CentOS, haven't tried other setup yet.\r\n\r\nYou will see that when it initializes the node, it does originally determine the right location for the config directory `using config [/etc/elasticsearch]`.\r\n\r\n```\r\n[2017-06-14T21:55:08,882][INFO ][o.e.n.Node               ] [] initializing ...\r\n[2017-06-14T21:55:08,981][TRACE][o.e.e.NodeEnvironment    ] obtaining node lock on /var/lib/elasticsearch/nodes/0 ...\r\n[2017-06-14T21:55:08,988][TRACE][o.e.e.NodeEnvironment    ] found state file: [id:52, legacy:false, file:/var/lib/elasticsearch/nodes/0/_state/node-52.st]\r\n[2017-06-14T21:55:09,026][TRACE][o.e.e.NodeEnvironment    ] state id [52] read from [node-52.st]\r\n[2017-06-14T21:55:09,044][DEBUG][o.e.e.NodeEnvironment    ] [hCQ8y9c] using node location [[NodePath{path=/var/lib/elasticsearch/nodes/0, spins=null}]], local_lock_id [0]\r\n[2017-06-14T21:55:09,046][DEBUG][o.e.e.NodeEnvironment    ] [hCQ8y9c] node data locations details:\r\n -> /var/lib/elasticsearch/nodes/0, free_space [28gb], usable_space [28gb], total_space [37.4gb], spins? [unknown], mount [/ (rootfs)], type [rootfs]\r\n[2017-06-14T21:55:09,046][INFO ][o.e.e.NodeEnvironment    ] [hCQ8y9c] heap size [1.9gb], compressed ordinary object pointers [true]\r\n[2017-06-14T21:55:09,090][INFO ][o.e.n.Node               ] node name [hCQ8y9c] derived from node ID [hCQ8y9c4RGOtOkR16H2W2A]; set [node.name] to override\r\n[2017-06-14T21:55:09,090][INFO ][o.e.n.Node               ] version[5.4.1], pid[7095], build[2cfe0df/2017-05-29T16:05:51.443Z], OS[Linux/3.10.0-123.9.2.el7.x86_64/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_121/25.121-b13]\r\n[2017-06-14T21:55:09,090][INFO ][o.e.n.Node               ] JVM arguments [-Xms2g, -Xmx2g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+DisableExplicitGC, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -Djdk.io.permissionsUseCanonicalPath=true, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j.skipJansi=true, -XX:+HeapDumpOnOutOfMemoryError, -Des.path.home=/usr/share/elasticsearch]\r\n[2017-06-14T21:55:09,090][DEBUG][o.e.n.Node               ] using config [/etc/elasticsearch], data [[/var/lib/elasticsearch]], logs [/var/log/elasticsearch], plugins [/usr/share/elasticsearch/plugins]\r\n[2017-06-14T21:55:09,098][TRACE][o.e.p.PluginsService     ] --- adding plugin [/usr/share/elasticsearch/plugins/x-pack]\r\n```\r\n\r\nBut when it tries to initialize the tribe client (eg. t1), it is somehow deciding to use `using config [/usr/share/elasticsearch/config]` instead.  Because this is occurring when we initialize the tribe client (t1), it doesn't seem like a packaging type of issue?\r\n\r\n```\r\n[2017-06-14T21:55:15,795][DEBUG][o.e.a.ActionModule       ] Using REST wrapper from plugin org.elasticsearch.xpack.XPackPlugin\r\n[2017-06-14T21:55:15,888][INFO ][o.e.n.Node               ] [hCQ8y9c/t1] initializing ...\r\n[2017-06-14T21:55:15,901][INFO ][o.e.n.Node               ] [hCQ8y9c/t1] node name [hCQ8y9c/t1], node ID [W_ZzMJq2Q-yNPgEj1BAUjg]\r\n[2017-06-14T21:55:15,901][INFO ][o.e.n.Node               ] [hCQ8y9c/t1] version[5.4.1], pid[7095], build[2cfe0df/2017-05-29T16:05:51.443Z], OS[Linux/3.10.0-123.9.2.el7.x86_64/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_121/25.121-b13]\r\n[2017-06-14T21:55:15,901][INFO ][o.e.n.Node               ] [hCQ8y9c/t1] JVM arguments [-Xms2g, -Xmx2g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+DisableExplicitGC, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -Djdk.io.permissionsUseCanonicalPath=true, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j.skipJansi=true, -XX:+HeapDumpOnOutOfMemoryError, -Des.path.home=/usr/share/elasticsearch]\r\n[2017-06-14T21:55:15,901][DEBUG][o.e.n.Node               ] [hCQ8y9c/t1] using config [/usr/share/elasticsearch/config], data [[/usr/share/elasticsearch/data]], logs [/var/log/elasticsearch], plugins [/usr/share/elasticsearch/plugins]\r\n[2017-06-14T21:55:15,904][TRACE][o.e.p.PluginsService     ] --- adding plugin [/usr/share/elasticsearch/plugins/x-pack]\r\n```\r\n\r\nThis explains why the problem is only reproducible for the tribe node, since regular nodes do not have tribe clients (t1) to initialize.\r\n\r\nOne workaround is to set `path.conf: /etc/elasticsearch` in the yml of the tribe node.\r\n\r\n@clintongormley Thoughts on tagging this to the upcoming 5.4.2 release?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308608242","html_url":"https://github.com/elastic/elasticsearch/issues/25113#issuecomment-308608242","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25113","id":308608242,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODYwODI0Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-06-15T02:08:33Z","updated_at":"2017-06-15T02:08:33Z","author_association":"MEMBER","body":"Since a workaround exists I do not think we should block the 5.4.2 release for this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372197414","html_url":"https://github.com/elastic/elasticsearch/issues/25113#issuecomment-372197414","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25113","id":372197414,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjE5NzQxNA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-03-12T05:27:44Z","updated_at":"2018-03-12T05:27:44Z","author_association":"MEMBER","body":"Tribe node has been removed for 7.0, so I'm going to close this issue.","performed_via_github_app":null}]