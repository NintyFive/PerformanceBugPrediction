[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320782174","html_url":"https://github.com/elastic/elasticsearch/issues/26087#issuecomment-320782174","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26087","id":320782174,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDc4MjE3NA==","user":{"login":"samuel-miller","id":29641892,"node_id":"MDQ6VXNlcjI5NjQxODky","avatar_url":"https://avatars0.githubusercontent.com/u/29641892?v=4","gravatar_id":"","url":"https://api.github.com/users/samuel-miller","html_url":"https://github.com/samuel-miller","followers_url":"https://api.github.com/users/samuel-miller/followers","following_url":"https://api.github.com/users/samuel-miller/following{/other_user}","gists_url":"https://api.github.com/users/samuel-miller/gists{/gist_id}","starred_url":"https://api.github.com/users/samuel-miller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuel-miller/subscriptions","organizations_url":"https://api.github.com/users/samuel-miller/orgs","repos_url":"https://api.github.com/users/samuel-miller/repos","events_url":"https://api.github.com/users/samuel-miller/events{/privacy}","received_events_url":"https://api.github.com/users/samuel-miller/received_events","type":"User","site_admin":false},"created_at":"2017-08-07T21:12:58Z","updated_at":"2017-08-07T21:12:58Z","author_association":"NONE","body":"just replicated without any additional hosts, the host has 60+GB of memory, and yet I'm apparently running out of heap space\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320925733","html_url":"https://github.com/elastic/elasticsearch/issues/26087#issuecomment-320925733","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26087","id":320925733,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDkyNTczMw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2017-08-08T11:15:24Z","updated_at":"2017-08-08T11:15:24Z","author_association":"MEMBER","body":"Hi, are you doing any other operation on the cluster prior to starting snapshoting? From the first loglines it looks there is some GC going on already, any idea what might be going on at that point? Also please explain what you mean by \"60+GB of memory\", from the above info it looks like your JVM gets 16GB (which I think should be enough).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321015917","html_url":"https://github.com/elastic/elasticsearch/issues/26087#issuecomment-321015917","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26087","id":321015917,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTAxNTkxNw==","user":{"login":"samuel-miller","id":29641892,"node_id":"MDQ6VXNlcjI5NjQxODky","avatar_url":"https://avatars0.githubusercontent.com/u/29641892?v=4","gravatar_id":"","url":"https://api.github.com/users/samuel-miller","html_url":"https://github.com/samuel-miller","followers_url":"https://api.github.com/users/samuel-miller/followers","following_url":"https://api.github.com/users/samuel-miller/following{/other_user}","gists_url":"https://api.github.com/users/samuel-miller/gists{/gist_id}","starred_url":"https://api.github.com/users/samuel-miller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuel-miller/subscriptions","organizations_url":"https://api.github.com/users/samuel-miller/orgs","repos_url":"https://api.github.com/users/samuel-miller/repos","events_url":"https://api.github.com/users/samuel-miller/events{/privacy}","received_events_url":"https://api.github.com/users/samuel-miller/received_events","type":"User","site_admin":false},"created_at":"2017-08-08T16:52:39Z","updated_at":"2017-08-08T16:52:39Z","author_association":"NONE","body":"The underlying host has 60+ GB of memory; if the answer is bumping the JVM settings to something higher than 16GB, that isn't a problem. However, I've read that diminishing returns severely impact anything over 32GB, so I don't really want to do that, unless it will fix the problem.\r\n\r\nYes, when I start ES on the host, ES began by initiating 150+ GC threads. I was using this host to also run Logstash, Kibana and Apache for an ELK stack. I've disabled all of my Beats log shippers for the time being, because being unable to snapshot the indices prevents this from being ready for production. Without the input the host cpu/memory metrics look very underutilized, but even now (with an extremely low cpu/io utilization), running the curl snapshot command kills the process on this host.  \r\n\r\nIf there is another more reliable way to take snapshots to be stored on S3, I'd be interested in anything to get this cluster to be stable.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322453884","html_url":"https://github.com/elastic/elasticsearch/issues/26087#issuecomment-322453884","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26087","id":322453884,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjQ1Mzg4NA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2017-08-15T12:32:10Z","updated_at":"2017-08-15T12:32:10Z","author_association":"MEMBER","body":"Hi @samuel-miller, I talked to somebody more familiar with the S3 repository and it looks like your nodes were already  pretty close to the OOM (not sure why) and the S3 just triggers the OOM.\r\nThe error happened in the repository verification step, which is just a small write on the repository, so this alone shouldn't cause it. \r\nSo the interesting question is how the heap situation looks like before trying to do the snapshot. Given that you seem to supply a reasonable amount of heap it would be interesting to see where all that goes. However, an analysis of that might go beyond what we usually provide here on Github, as we try to limit this to bug reports and feature request. We have a [forum](https://discuss.elastic.co) that would be better suited for this kind of discussion. Would you mind me closing this issue and reopening a thread in the Forums once you can provide more information about heap usage etc?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322498119","html_url":"https://github.com/elastic/elasticsearch/issues/26087#issuecomment-322498119","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26087","id":322498119,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjQ5ODExOQ==","user":{"login":"samuel-miller","id":29641892,"node_id":"MDQ6VXNlcjI5NjQxODky","avatar_url":"https://avatars0.githubusercontent.com/u/29641892?v=4","gravatar_id":"","url":"https://api.github.com/users/samuel-miller","html_url":"https://github.com/samuel-miller","followers_url":"https://api.github.com/users/samuel-miller/followers","following_url":"https://api.github.com/users/samuel-miller/following{/other_user}","gists_url":"https://api.github.com/users/samuel-miller/gists{/gist_id}","starred_url":"https://api.github.com/users/samuel-miller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuel-miller/subscriptions","organizations_url":"https://api.github.com/users/samuel-miller/orgs","repos_url":"https://api.github.com/users/samuel-miller/repos","events_url":"https://api.github.com/users/samuel-miller/events{/privacy}","received_events_url":"https://api.github.com/users/samuel-miller/received_events","type":"User","site_admin":false},"created_at":"2017-08-15T15:16:19Z","updated_at":"2017-08-15T15:16:19Z","author_association":"NONE","body":"Christoph,\n\nPlease go ahead and close the issue, I believe the root cause was that the\nElasticsearch cluster was underscaled for the volume of data coming in, and\nwe had no buffer to regulate it. Since adding such a buffer (in the form of\na kafka cluster) the problem appears to have been mitigated. Thank you.\n\nSamuel Miller\n\nOn Tue, Aug 15, 2017 at 5:32 AM, Christoph Büscher <notifications@github.com\n> wrote:\n\n> Hi @samuel-miller <https://github.com/samuel-miller>, I talked to\n> somebody more familiar with the S3 repository and it looks like your nodes\n> were already pretty close to the OOM (not sure why) and the S3 just\n> triggers the OOM.\n> The error happened in the repository verification step, which is just a\n> small write on the repository, so this alone shouldn't cause it.\n> So the interesting question is how the heap situation looks like before\n> trying to do the snapshot. Given that you seem to supply a reasonable\n> amount of heap it would be interesting to see where all that goes. However,\n> an analysis of that might go beyond what we usually provide here on Github,\n> as we try to limit this to bug reports and feature request. We have a\n> forum <https://discuss.elastic.co> that would be better suited for this\n> kind of discussion. Would you mind me closing this issue and reopening a\n> thread in the Forums once you can provide more information about heap usage\n> etc?\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/26087#issuecomment-322453884>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AcRMpCNzDaV0fTDtSPIx3DS3dN_qbrCCks5sYY_1gaJpZM4Ov82R>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322499374","html_url":"https://github.com/elastic/elasticsearch/issues/26087#issuecomment-322499374","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26087","id":322499374,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjQ5OTM3NA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2017-08-15T15:20:52Z","updated_at":"2017-08-15T15:21:46Z","author_association":"MEMBER","body":"@samuel-miller thanks, and don't hesitate to open another issue in the [discuss forums](https://discuss.elastic.co) if you run into other problems, we welcome discussions about scaling/memory consumption etc... there and try to help.","performed_via_github_app":null}]