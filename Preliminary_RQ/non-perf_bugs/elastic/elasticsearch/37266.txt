{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37266","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37266/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37266/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37266/events","html_url":"https://github.com/elastic/elasticsearch/issues/37266","id":397400501,"node_id":"MDU6SXNzdWUzOTc0MDA1MDE=","number":37266,"title":"multiple test failures in ChildQuerySearchIT","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":73544,"node_id":"MDU6TGFiZWw3MzU0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Enon-issue","name":">non-issue","color":"cfcfcf","default":false,"description":null},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-01-09T14:40:29Z","updated_at":"2019-02-07T10:02:19Z","closed_at":"2019-01-09T22:11:23Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## Example build failure\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA=openjdk12,ES_RUNTIME_JAVA=zulu11,nodes=virtual&&linux/169/console\r\n\r\nBut this failed on intake too:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/1120/console\r\n\r\n## Reproduction line \r\ndoes not reproduce locally\r\n```\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testParentChildQueriesViaScrollApi\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testParentChildQueriesViaScrollApi\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testParentChildQueriesViaScrollApi\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testSimpleQueryRewrite\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testSimpleQueryRewrite\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testNamedFilters\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testNamedFilters\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testScoreForParentChildQueriesWithFunctionScore\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testScoreForParentChildQueriesWithFunctionScore\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n\r\nREPRODUCE WITH: ./gradlew :modules:parent-join:integTestRunner \\\r\n  -Dtests.seed=C74D403BEAA3E517 \\\r\n  -Dtests.class=org.elasticsearch.join.query.ChildQuerySearchIT \\\r\n  -Dtests.method=\"testParentChildCaching\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=cgg-UG \\\r\n  -Dtests.timezone=America/Detroit \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11\r\n```\r\n\r\n## Example relevant log:\r\n```\r\n06:51:29 ERROR   0.05s | ChildQuerySearchIT.testDeletedParent <<< FAILURES!\r\n06:51:29    > Throwable #1: NoNodeAvailableException[None of the configured nodes were available: [{node_s1}{5TFPbgbaSwmKh78Ox8oiFw}{X7JH7fPoRMK_Hwyc3FmsmA}{127.0.0.1}{127.0.0.1:33019}]]; nested: NodeNotConnectedException[[node_s1][127.0.0.1:33019] Node not connected];\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportClientNodesService$RetryListener.onFailure(TransportClientNodesService.java:295)\r\n06:51:29    > \tat org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:53)\r\n06:51:29    > \tat org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:534)\r\n06:51:29    > \tat org.elasticsearch.action.TransportActionNodeProxy.execute(TransportActionNodeProxy.java:48)\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportProxyClient.lambda$execute$0(TransportProxyClient.java:57)\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportClientNodesService.execute(TransportClientNodesService.java:254)\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportProxyClient.execute(TransportProxyClient.java:57)\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportClient.doExecute(TransportClient.java:386)\r\n06:51:29    > \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:393)\r\n06:51:29    > \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:382)\r\n06:51:29    > \tat org.elasticsearch.client.support.AbstractClient$IndicesAdmin.execute(AbstractClient.java:1217)\r\n06:51:29    > \tat org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:45)\r\n06:51:29    > \tat org.elasticsearch.action.ActionRequestBuilder.get(ActionRequestBuilder.java:52)\r\n06:51:29    > \tat org.elasticsearch.test.TestCluster.wipeAllTemplates(TestCluster.java:167)\r\n06:51:29    > \tat org.elasticsearch.test.TestCluster.wipe(TestCluster.java:80)\r\n06:51:29    > \tat org.elasticsearch.test.ESIntegTestCase.lambda$beforeInternal$0(ESIntegTestCase.java:378)\r\n06:51:29    > \tat com.carrotsearch.randomizedtesting.RandomizedContext.runWithPrivateRandomness(RandomizedContext.java:187)\r\n06:51:29    > \tat com.carrotsearch.randomizedtesting.RandomizedContext.runWithPrivateRandomness(RandomizedContext.java:211)\r\n06:51:29    > \tat org.elasticsearch.test.ESIntegTestCase.beforeInternal(ESIntegTestCase.java:386)\r\n06:51:29    > \tat org.elasticsearch.test.ESIntegTestCase.setupTestCluster(ESIntegTestCase.java:2217)\r\n06:51:29    > \tat jdk.internal.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)\r\n06:51:29    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n06:51:29    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n06:51:29    > \tat java.base/java.lang.Thread.run(Thread.java:834)\r\n06:51:29    > Caused by: NodeNotConnectedException[[node_s1][127.0.0.1:33019] Node not connected]\r\n06:51:29    > \tat org.elasticsearch.transport.ConnectionManager.getConnection(ConnectionManager.java:156)\r\n06:51:29    > \tat org.elasticsearch.transport.TransportService.getConnection(TransportService.java:558)\r\n06:51:29    > \tat org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:530)\r\n06:51:29    > \t... 51 moreThrowable #2: NoNodeAvailableException[None of the configured nodes were available: [{node_s1}{5TFPbgbaSwmKh78Ox8oiFw}{X7JH7fPoRMK_Hwyc3FmsmA}{127.0.0.1}{127.0.0.1:33019}]]; nested: NodeNotConnectedException[[node_s1][127.0.0.1:33019] Node not connected];\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportClientNodesService$RetryListener.onFailure(TransportClientNodesService.java:295)\r\n06:51:29    > \tat org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:53)\r\n06:51:29    > \tat org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:534)\r\n06:51:29    > \tat org.elasticsearch.action.TransportActionNodeProxy.execute(TransportActionNodeProxy.java:48)\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportProxyClient.lambda$execute$0(TransportProxyClient.java:57)\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportClientNodesService.execute(TransportClientNodesService.java:254)\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportProxyClient.execute(TransportProxyClient.java:57)\r\n06:51:29    > \tat org.elasticsearch.client.transport.TransportClient.doExecute(TransportClient.java:386)\r\n06:51:29    > \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:393)\r\n06:51:29    > \tat org.elasticsearch.client.FilterClient.doExecute(FilterClient.java:65)\r\n06:51:29    > \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:393)\r\n06:51:29    > \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:382)\r\n06:51:29    > \tat org.elasticsearch.client.support.AbstractClient$ClusterAdmin.execute(AbstractClient.java:676)\r\n06:51:29    > \tat org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:45)\r\n06:51:29    > \tat org.elasticsearch.action.ActionRequestBuilder.get(ActionRequestBuilder.java:52)\r\n06:51:29    > \tat org.elasticsearch.test.ESIntegTestCase.ensureClusterStateConsistency(ESIntegTestCase.java:1139)\r\n06:51:29    > \tat org.elasticsearch.test.ESIntegTestCase.afterInternal(ESIntegTestCase.java:573)\r\n06:51:29    > \tat org.elasticsearch.test.ESIntegTestCase.cleanUpCluster(ESIntegTestCase.java:2231)\r\n06:51:29    > \tat jdk.internal.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)\r\n06:51:29    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n06:51:29    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n06:51:29    > \tat java.base/java.lang.Thread.run(Thread.java:834)\r\n06:51:29    > Caused by: NodeNotConnectedException[[node_s1][127.0.0.1:33019] Node not connected]\r\n06:51:29    > \tat org.elasticsearch.transport.ConnectionManager.getConnection(ConnectionManager.java:156)\r\n06:51:29    > \tat org.elasticsearch.transport.TransportService.getConnection(TransportService.java:558)\r\n06:51:29    > \tat org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:530)\r\n06:51:29    > \t... 48 more\r\n06:51:29   1> [2019-01-08T23:50:08,328][INFO ][o.e.n.Node               ] [suite] stopping ...\r\n```\r\n\r\n## Frequency\r\nYesterday saw 10 failures on master build alone.","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}