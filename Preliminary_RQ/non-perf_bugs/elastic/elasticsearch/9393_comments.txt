[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71484823","html_url":"https://github.com/elastic/elasticsearch/issues/9393#issuecomment-71484823","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393","id":71484823,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNDg0ODIz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-26T16:06:23Z","updated_at":"2015-01-26T16:06:23Z","author_association":"CONTRIBUTOR","body":"Hi @perryn \n\nThe answer is: it depends :(\n\nIf you include the type name in the URL, then yes you do need to specify the type name in the field path.  Otherwise you don't.  This ambiguity will be cleaned up by #8870.\n\nIn the meantime I agree that that error should be made friendlier.  /cc @martijnvg \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71544540","html_url":"https://github.com/elastic/elasticsearch/issues/9393#issuecomment-71544540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393","id":71544540,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTQ0NTQw","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-01-26T21:44:05Z","updated_at":"2015-01-26T21:44:05Z","author_association":"MEMBER","body":"@perryn The use of type qualification is needed in the case the type is set on the search request. Basically the type sets the scope the search request operates in. I guess you set this to the parent type, so when not specifying the child type it couldn't a field you would like to use because it doesn't exist in the context of the parent type.\n\nYou should be able the create sub aggregations under the children aggregations that operates on buckets that come from the parent space. This is what the `children` aggregator does, it pushed buckets from the parent space into the children space.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71565403","html_url":"https://github.com/elastic/elasticsearch/issues/9393#issuecomment-71565403","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393","id":71565403,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTY1NDAz","user":{"login":"perryn","id":40276,"node_id":"MDQ6VXNlcjQwMjc2","avatar_url":"https://avatars3.githubusercontent.com/u/40276?v=4","gravatar_id":"","url":"https://api.github.com/users/perryn","html_url":"https://github.com/perryn","followers_url":"https://api.github.com/users/perryn/followers","following_url":"https://api.github.com/users/perryn/following{/other_user}","gists_url":"https://api.github.com/users/perryn/gists{/gist_id}","starred_url":"https://api.github.com/users/perryn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/perryn/subscriptions","organizations_url":"https://api.github.com/users/perryn/orgs","repos_url":"https://api.github.com/users/perryn/repos","events_url":"https://api.github.com/users/perryn/events{/privacy}","received_events_url":"https://api.github.com/users/perryn/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T00:06:45Z","updated_at":"2015-01-27T00:06:45Z","author_association":"NONE","body":"Hi @martijnvg \n\nYou are right I was performing a search on the parent type.  That explains why I need to qualify fields from the child type, but it also implies to me that I _can_ use fields from the parent type. What I am seeing is that I can only use fields from the child type _and_ I must qualify them too.\n\nI am not sure if your second paragraph is saying this is expected or not?\n\n To be clear, what I am trying to do is\n- children aggregation\n  - date_histogram agg using timestamp field from child type\n    - terms agg using string field from parent type \n      - sum agg using number field from child type\n\nWhat I am seeing is that the terms aggregation creates 0 buckets.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71603044","html_url":"https://github.com/elastic/elasticsearch/issues/9393#issuecomment-71603044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393","id":71603044,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjAzMDQ0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T07:51:10Z","updated_at":"2015-01-27T07:51:10Z","author_association":"MEMBER","body":"@perryn What you're seeing is expected. The aggregations wrapped in the `children` aggregations can't refer to any parent type field. I was referring to how fields are resolved in general from the mappings. So in your case with the correct type prefix the correct field was resolved, but no documents would pass through the `terms` agg, because child docs don't have the defined field.\n\nHowever buckets created on the parent level can be pushed in the child space. For example if you define something like this:\n- `terms` agg using string field from parent type\n  - `children` agg\n    - `date_histogram` agg using timestamp field from child type\n      - `sum` agg using number field from child type\n\nThen `terms` agg buckets can connect to the buckets created by the `date_histogram` via the `children` aggregation. \n\nThe example you shared would be possible if there was a `parent` aggregation:\n- `children` aggregation\n  - `date_histogram` agg using timestamp field from child type\n    - `parent` aggregation\n      - `terms` agg using string field from parent type \n        - `sum` agg using number field from child type\n\nThe parent aggregation doesn't exist yet.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71742843","html_url":"https://github.com/elastic/elasticsearch/issues/9393#issuecomment-71742843","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393","id":71742843,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzQyODQz","user":{"login":"perryn","id":40276,"node_id":"MDQ6VXNlcjQwMjc2","avatar_url":"https://avatars3.githubusercontent.com/u/40276?v=4","gravatar_id":"","url":"https://api.github.com/users/perryn","html_url":"https://github.com/perryn","followers_url":"https://api.github.com/users/perryn/followers","following_url":"https://api.github.com/users/perryn/following{/other_user}","gists_url":"https://api.github.com/users/perryn/gists{/gist_id}","starred_url":"https://api.github.com/users/perryn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/perryn/subscriptions","organizations_url":"https://api.github.com/users/perryn/orgs","repos_url":"https://api.github.com/users/perryn/repos","events_url":"https://api.github.com/users/perryn/events{/privacy}","received_events_url":"https://api.github.com/users/perryn/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T22:34:59Z","updated_at":"2015-01-27T22:34:59Z","author_association":"NONE","body":"Hi @martijnvg,\n\nThanks for taking the time to clear that up :).\n\n I think this issue can be reduced to 'provide a more illuminating error message' . I am happy to have a crack at it if you would like - I presume there is more to it than changing the error string in AggregatorFactory?  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161974999","html_url":"https://github.com/elastic/elasticsearch/issues/9393#issuecomment-161974999","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393","id":161974999,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTk3NDk5OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-12-04T14:02:09Z","updated_at":"2015-12-04T14:02:09Z","author_association":"CONTRIBUTOR","body":"This ambiguity has been cleared up by #8870, and I've opened https://github.com/elastic/elasticsearch-definitive-guide/issues/449 to fix the guide docs\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202984573","html_url":"https://github.com/elastic/elasticsearch/issues/9393#issuecomment-202984573","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393","id":202984573,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjk4NDU3Mw==","user":{"login":"tj","id":25254,"node_id":"MDQ6VXNlcjI1MjU0","avatar_url":"https://avatars2.githubusercontent.com/u/25254?v=4","gravatar_id":"","url":"https://api.github.com/users/tj","html_url":"https://github.com/tj","followers_url":"https://api.github.com/users/tj/followers","following_url":"https://api.github.com/users/tj/following{/other_user}","gists_url":"https://api.github.com/users/tj/gists{/gist_id}","starred_url":"https://api.github.com/users/tj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tj/subscriptions","organizations_url":"https://api.github.com/users/tj/orgs","repos_url":"https://api.github.com/users/tj/repos","events_url":"https://api.github.com/users/tj/events{/privacy}","received_events_url":"https://api.github.com/users/tj/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T16:25:15Z","updated_at":"2016-03-29T16:25:15Z","author_association":"NONE","body":"woah confusing error message. I just had a typo in the field name for date_histogram and got the \"aggregation must use addResults() to collect child\" bit\n","performed_via_github_app":null}]