[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446987941","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-446987941","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":446987941,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njk4Nzk0MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T14:30:23Z","updated_at":"2018-12-13T14:30:23Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446990249","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-446990249","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":446990249,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njk5MDI0OQ==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T14:37:21Z","updated_at":"2018-12-13T14:37:21Z","author_association":"CONTRIBUTOR","body":"Looks like this has been fixed since ec0036b and 971a707c608 (that had the failures).\r\nClosing, sorry for the noise.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446991557","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-446991557","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":446991557,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njk5MTU1Nw==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T14:40:59Z","updated_at":"2018-12-13T14:42:11Z","author_association":"MEMBER","body":"That just reproducibly failed for me on 6.x with \r\n```\r\n./gradlew :server:test -Dtests.seed=F8CECC92C3103FA6 -Dtests.class=org.elasticsearch.index.query.MultiMatchQueryBuilderTests -Dtests.method=\"testMustRewrite\" -Dtests.security.manager=true -Dtests.jvms=4 -Dtests.locale=ar-JO -Dtests.timezone=EST5EDT -Dcompiler.java=11 -Druntime.java=11\r\n```\r\nSo, I don't think it is fixed (at least in 6.x)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446996992","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-446996992","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":446996992,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njk5Njk5Mg==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T14:55:55Z","updated_at":"2018-12-13T14:56:21Z","author_association":"MEMBER","body":"I do find weird things when putting this test using `@Repeat` in the test class, sometimes I get the above error message, but I also got (happens on master as well)\r\n\r\n```\r\njava.lang.NumberFormatException: For input string: \"hello\"\r\n\r\n\tat __randomizedtesting.SeedInfo.seed([D7A075C2C79DDB22:C3A2C5854E85F27]:0)\r\n\tat java.base/jdk.internal.math.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:2054)\r\n\tat java.base/jdk.internal.math.FloatingDecimal.parseDouble(FloatingDecimal.java:110)\r\n\tat java.base/java.lang.Double.parseDouble(Double.java:543)\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberType.hasDecimalPart(NumberFieldMapper.java:846)\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$6.termQuery(NumberFieldMapper.java:599)\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberFieldType.termQuery(NumberFieldMapper.java:922)\r\n\tat org.elasticsearch.index.search.MatchQuery.termQuery(MatchQuery.java:303)\r\n\tat org.elasticsearch.index.search.MatchQuery.blendTermQuery(MatchQuery.java:535)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery.access$201(MultiMatchQuery.java:48)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery$QueryBuilder.blendTerm(MultiMatchQuery.java:145)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery.blendTermQuery(MultiMatchQuery.java:343)\r\n\tat org.elasticsearch.index.search.MatchQuery.parse(MatchQuery.java:264)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery.parseAndApply(MultiMatchQuery.java:62)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery.access$100(MultiMatchQuery.java:48)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery$QueryBuilder.parseGroup(MultiMatchQuery.java:127)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery$QueryBuilder.buildGroupedQueries(MultiMatchQuery.java:115)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery.parse(MultiMatchQuery.java:95)\r\n\tat org.elasticsearch.index.query.MultiMatchQueryBuilder.doToQuery(MultiMatchQueryBuilder.java:825)\r\n\tat org.elasticsearch.index.query.AbstractQueryBuilder.toQuery(AbstractQueryBuilder.java:98)\r\n\tat org.elasticsearch.index.query.MultiMatchQueryBuilderTests.testDefaultField(MultiMatchQueryBuilderTests.java:353)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n```\r\n\r\nI have not yet determined if this there is state somewhere in test or the run order of tests, that may be an issue","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447004579","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-447004579","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":447004579,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzAwNDU3OQ==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T15:15:56Z","updated_at":"2018-12-13T15:15:56Z","author_association":"MEMBER","body":"I think this is the offending code, which only exists in 6.x, but not in master https://github.com/elastic/elasticsearch/blob/6.x/server/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java#L277-L283","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447515233","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-447515233","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":447515233,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzUxNTIzMw==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2018-12-15T00:07:59Z","updated_at":"2018-12-15T00:09:27Z","author_association":"CONTRIBUTOR","body":"This fails reproducibly on current 6.x for me with \r\n```\r\n./gradlew :server:test -Dtests.seed=D16EE929C3DB3AEB -Dtests.class=org.elasticsearch.index.query.MultiMatchQueryBuilderTests -Dtests.method=\"testToQuery\" -Dtests.security.manager=true -Dtests.locale=it-CH -Dtests.timezone=Asia/Jakarta -Dcompiler.java=11 -Druntime.java=8\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447799101","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-447799101","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":447799101,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Nzc5OTEwMQ==","user":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"created_at":"2018-12-17T10:38:37Z","updated_at":"2018-12-17T10:38:37Z","author_association":"CONTRIBUTOR","body":"Failing on 6.x with `testMustRewrite`. It looks like @spinscale 's PR won't fix this one\r\n\r\n```\r\n./gradlew :server:test \\                             \r\n  -Dtests.seed=7704427605772256 \\\r\n  -Dtests.class=org.elasticsearch.index.query.MultiMatchQueryBuilderTests \\\r\n  -Dtests.method=\"testMustRewrite\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=sr-Latn-ME \\\r\n  -Dtests.timezone=America/Chihuahua \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\n```\r\nERROR   2.41s | MultiMatchQueryBuilderTests.testMustRewrite <<< FAILURES!\r\n   > Throwable #1: ElasticsearchParseException[failed to parse date field [LmzQeGPTQO] with format [strict_date_optional_time||epoch_millis]]; nested: ElasticsearchParseException[failed to parse date field [LmzQeGPTQO] with format [strict_date_optional_time]]; nested: IllegalArgumentException[Parse failure at index [0] of [LmzQeGPTQO]];\r\n   >    at __randomizedtesting.SeedInfo.seed([7704427605772256:C3EB314B7D2024D6]:0)\r\n   >    at org.elasticsearch.common.time.DateFormatters$MergedDateFormatter.lambda$toDateMathParser$2(DateFormatters.java:1544)\r\n   >    at org.elasticsearch.index.mapper.DateFieldMapper$DateFieldType.parseToMilliseconds(DateFieldMapper.java:317)\r\n   >    at org.elasticsearch.index.mapper.DateFieldMapper$DateFieldType.rangeQuery(DateFieldMapper.java:283)\r\n   >    at org.elasticsearch.index.mapper.DateFieldMapper$DateFieldType.termQuery(DateFieldMapper.java:261)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery.blendTerms(MultiMatchQuery.java:270)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery.blendTerm(MultiMatchQuery.java:257)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery$CrossFieldsQueryBuilder.blendTerm(MultiMatchQuery.java:230)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery.blendTermQuery(MultiMatchQuery.java:349)\r\n   >    at org.elasticsearch.index.search.MatchQuery.parse(MatchQuery.java:269)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery.parseAndApply(MultiMatchQuery.java:61)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery.access$100(MultiMatchQuery.java:47)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery$QueryBuilder.parseGroup(MultiMatchQuery.java:126)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery$CrossFieldsQueryBuilder.buildGroupedQueries(MultiMatchQuery.java:204)\r\n   >    at org.elasticsearch.index.search.MultiMatchQuery.parse(MultiMatchQuery.java:94)\r\n   >    at org.elasticsearch.index.query.MultiMatchQueryBuilder.doToQuery(MultiMatchQueryBuilder.java:824)\r\n   >    at org.elasticsearch.index.query.AbstractQueryBuilder.toQuery(AbstractQueryBuilder.java:104)\r\n   >    at org.elasticsearch.test.AbstractQueryTestCase.testMustRewrite(AbstractQueryTestCase.java:804)\r\n   >    at java.lang.Thread.run(Thread.java:748)\r\n   >    Suppressed: ElasticsearchParseException[failed to parse date field [LmzQeGPTQO] with format [epoch_millis]]; nested: IllegalArgumentException[Parse failure at index [0] of [LmzQeGPTQO]];\r\n   >            at org.elasticsearch.common.joda.JodaDateMathParser.parseDateTime(JodaDateMathParser.java:215)\r\n   >            at org.elasticsearch.common.joda.JodaDateMathParser.parse(JodaDateMathParser.java:67)\r\n   >            at org.elasticsearch.common.time.DateFormatters$MergedDateFormatter.lambda$toDateMathParser$2(DateFormatters.java:1540)\r\n   >            ... 53 more\r\n   >    Caused by: java.lang.IllegalArgumentException: Parse failure at index [0] of [LmzQeGPTQO]\r\n   >            at org.elasticsearch.common.joda.JodaDateMathParser.parseDateTime(JodaDateMathParser.java:208)\r\n   >            ... 55 more\r\n   > Caused by: ElasticsearchParseException[failed to parse date field [LmzQeGPTQO] with format [strict_date_optional_time]]; nested: IllegalArgumentException[Parse failure at index [0] of [LmzQeGPTQO]];\r\n   >    at org.elasticsearch.common.joda.JodaDateMathParser.parseDateTime(JodaDateMathParser.java:215)\r\n   >    at org.elasticsearch.common.joda.JodaDateMathParser.parse(JodaDateMathParser.java:67)\r\n   >    at org.elasticsearch.common.time.DateFormatters$MergedDateFormatter.lambda$toDateMathParser$2(DateFormatters.java:1540)\r\n   >    ... 53 more\r\n   > Caused by: java.lang.IllegalArgumentException: Parse failure at index [0] of [LmzQeGPTQO]\r\n   >    at org.elasticsearch.common.joda.JodaDateMathParser.parseDateTime(JodaDateMathParser.java:208)\r\n   >    ... 55 more\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448021946","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-448021946","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":448021946,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODAyMTk0Ng==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-12-17T22:24:07Z","updated_at":"2018-12-17T22:24:07Z","author_association":"CONTRIBUTOR","body":"@spinscale Alex, I have created a fix for this test: #36742. The fix also workswith your PR #36604","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/461192968","html_url":"https://github.com/elastic/elasticsearch/issues/36598#issuecomment-461192968","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36598","id":461192968,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MTE5Mjk2OA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2019-02-06T21:23:23Z","updated_at":"2019-02-06T21:23:23Z","author_association":"CONTRIBUTOR","body":"This was addressed in #36742","performed_via_github_app":null}]