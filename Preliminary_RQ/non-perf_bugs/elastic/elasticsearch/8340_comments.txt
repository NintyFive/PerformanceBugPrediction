[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61658717","html_url":"https://github.com/elastic/elasticsearch/issues/8340#issuecomment-61658717","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8340","id":61658717,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNjU4NzE3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-04T15:40:35Z","updated_at":"2014-11-04T15:40:35Z","author_association":"CONTRIBUTOR","body":"It appears you have some permission problem?\n\n> C:\\TestResults\\QuickSearch\\data\\elasticsearch\\nodes\\0\\indices\\qs_rm_3\\0\\index_8.si (Access is denied)\n\n@imotov or could this be due to Windows locking the file when being access by another process?\n\n@asafc64 what version are you on?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61659368","html_url":"https://github.com/elastic/elasticsearch/issues/8340#issuecomment-61659368","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8340","id":61659368,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNjU5MzY4","user":{"login":"asafc64","id":6837849,"node_id":"MDQ6VXNlcjY4Mzc4NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/6837849?v=4","gravatar_id":"","url":"https://api.github.com/users/asafc64","html_url":"https://github.com/asafc64","followers_url":"https://api.github.com/users/asafc64/followers","following_url":"https://api.github.com/users/asafc64/following{/other_user}","gists_url":"https://api.github.com/users/asafc64/gists{/gist_id}","starred_url":"https://api.github.com/users/asafc64/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asafc64/subscriptions","organizations_url":"https://api.github.com/users/asafc64/orgs","repos_url":"https://api.github.com/users/asafc64/repos","events_url":"https://api.github.com/users/asafc64/events{/privacy}","received_events_url":"https://api.github.com/users/asafc64/received_events","type":"User","site_admin":false},"created_at":"2014-11-04T15:44:13Z","updated_at":"2014-11-04T15:44:13Z","author_association":"NONE","body":"permission problem - I don't think so, since it succeeds most of the times.\naccess by another process - I verified that only one instance of ElasticSearch is running.\nversion - 1.3.4\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61667835","html_url":"https://github.com/elastic/elasticsearch/issues/8340#issuecomment-61667835","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8340","id":61667835,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNjY3ODM1","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-11-04T16:30:39Z","updated_at":"2014-11-04T16:30:39Z","author_association":"MEMBER","body":"@asafc64 could you tell us how your test is structured? What sort of cleanup are you doing before/after the test? In particular, do you close the index or delete it? How do you perform these operations? Do you wait for their completion? What operations are performed in the test preceding the test that fails?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61769639","html_url":"https://github.com/elastic/elasticsearch/issues/8340#issuecomment-61769639","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8340","id":61769639,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNzY5NjM5","user":{"login":"asafc64","id":6837849,"node_id":"MDQ6VXNlcjY4Mzc4NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/6837849?v=4","gravatar_id":"","url":"https://api.github.com/users/asafc64","html_url":"https://github.com/asafc64","followers_url":"https://api.github.com/users/asafc64/followers","following_url":"https://api.github.com/users/asafc64/following{/other_user}","gists_url":"https://api.github.com/users/asafc64/gists{/gist_id}","starred_url":"https://api.github.com/users/asafc64/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asafc64/subscriptions","organizations_url":"https://api.github.com/users/asafc64/orgs","repos_url":"https://api.github.com/users/asafc64/repos","events_url":"https://api.github.com/users/asafc64/events{/privacy}","received_events_url":"https://api.github.com/users/asafc64/received_events","type":"User","site_admin":false},"created_at":"2014-11-05T07:33:17Z","updated_at":"2014-11-05T07:33:17Z","author_association":"NONE","body":"When the environment is loaded, its creates a snap shot, and before every test it's being restored.\nEvery 5-9 successful restorings, one fails.\nRestore procedure:\n1. Close index.\n2. Restore index.\n3. Get RecoveryStatus until all shards are done.\n4. Open index.\n\nBy the way, \nsome times I get this error although I check that all shards are done:\n_[2014-11-05 07:57:21,288][WARN ][snapshots                ] [Elektro] [EsBackups:qs_rm_alias] failed to restore snapshot\norg.elasticsearch.snapshots.ConcurrentSnapshotExecutionException: [EsBackups:qs_rm_alias] Restore process is already running in this cluster\n    at org.elasticsearch.snapshots.RestoreService$1.execute(RestoreService.java:139)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:328)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:153)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n    at java.lang.Thread.run(Unknown Source)_\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62235476","html_url":"https://github.com/elastic/elasticsearch/issues/8340#issuecomment-62235476","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8340","id":62235476,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMjM1NDc2","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-11-08T00:28:55Z","updated_at":"2014-11-08T00:28:55Z","author_association":"MEMBER","body":"@asafc64 on the step 3 when shards are reported done there is still some additional operations that should take place before the restore process is really over. So,  it's not very reliable method of checking restore status in tests. Opening index after restore is not needed, because restore will open automatically once restore is complete. I would recommend the following approach\n1. Close Index\n2. Running restore with `wait_for_completion=true`\n3. Run cluster health for the restored index with `wait_for_status=green`\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62256063","html_url":"https://github.com/elastic/elasticsearch/issues/8340#issuecomment-62256063","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8340","id":62256063,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMjU2MDYz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-08T12:28:47Z","updated_at":"2014-11-08T12:28:47Z","author_association":"CONTRIBUTOR","body":"@imotov is there some additional status that we should report in recovery status to indicate that the process isn't quite complete?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63338727","html_url":"https://github.com/elastic/elasticsearch/issues/8340#issuecomment-63338727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8340","id":63338727,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzM4NzI3","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T17:11:53Z","updated_at":"2014-11-17T17:11:53Z","author_association":"MEMBER","body":"@clintongormley, I am not sure what we can/should do here since the recoveries are reported on the shard level. I think there is a couple of concurrency-related things going on there. First of all there is slight delay in shard status propagation through the cluster between the moment when a shard is done recovering and the moment when a cluster knows that it got started. There is also a global restore clean up stage that is performed once all shards are restored. So, when all shards are restored the restore process is still technically running. I think the recovery API is good to monitor the recovery/restore progress of shards, but it's not a good method to check if restore is done or not globally. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63339521","html_url":"https://github.com/elastic/elasticsearch/issues/8340#issuecomment-63339521","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8340","id":63339521,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzM5NTIx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T17:16:48Z","updated_at":"2014-11-17T17:16:48Z","author_association":"CONTRIBUTOR","body":"@imotov fair enough.  Plus the docs already tell you how to monitor a restore: http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-snapshots.html#_monitoring_snapshot_restore_progress\n","performed_via_github_app":null}]