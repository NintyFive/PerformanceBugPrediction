{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/62853","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62853/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62853/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62853/events","html_url":"https://github.com/elastic/elasticsearch/issues/62853","id":707980651,"node_id":"MDU6SXNzdWU3MDc5ODA2NTE=","number":62853,"title":"Several tests fail with \"failed to process cluster event\" due to timeout","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2020-09-24T08:44:48Z","updated_at":"2020-09-25T19:26:00Z","closed_at":"2020-09-25T19:25:03Z","author_association":"MEMBER","active_lock_reason":null,"body":"I noticed several tests failing with related error messages:\r\n\r\n* `failed to process cluster event (delete_repository [*]) within 30s`\r\n* `failed to process cluster event (put-mapping [idx/iv7FVCFrT7K3iGZ0c-6X2w]) within 13s`\r\n* `failed to process cluster event (delete-index [[test-idx/TdYM8OZkRkOHagTQzNiCFQ]]) within 30s`\r\n\r\nFrom initial analysis it's hard to tell whether they have different root causes or whether there is one underlying cause. However, it appears to me that the issues is not due the individual test case hence I have raised only one issue but please feel free to split this into individual issues if further analysis uncovers that this makes sense.\r\n\r\n**Build scan**:\r\n\r\n* https://gradle-enterprise.elastic.co/s/hig7ipu7fpa4m\r\n* https://gradle-enterprise.elastic.co/s/7ulfjotymwkpe\r\n* https://gradle-enterprise.elastic.co/s/xdv5j7sg3z3j2\r\n* https://gradle-enterprise.elastic.co/s/rpm3r3o7nztss\r\n\r\n**Repro line**:\r\n\r\n```\r\n# taken from the most recent failure in https://gradle-enterprise.elastic.co/s/hig7ipu7fpa4m\r\n./gradlew ':x-pack:plugin:security:internalClusterTest' --tests \"org.elasticsearch.integration.FieldLevelSecurityTests.testParentChild\" -Dtests.seed=3E1FD9F52E1FDC19 -Dtests.security.manager=true -Dtests.locale=en-GB -Dtests.timezone=Pacific/Gambier -Druntime.java=11\r\n```\r\n\r\n**Reproduces locally?**:\r\n\r\nNo\r\n\r\n**Applicable branches**:\r\n\r\n* master\r\n* 7.9\r\n\r\n**Failure history**:\r\n\r\nAccording to [build stats](https://build-stats.elastic.co/app/kibana#/discover?_g=(refreshInterval:(pause:!t,value:0),time:(from:now-6M,mode:quick,to:now))&_a=(columns:!(sys.os,branch),index:e58bf320-7efd-11e8-bf69-63c8ef516157,interval:auto,query:(language:lucene,query:'%22failed%20to%20process%20cluster%20event%22%20AND%20NOT%20branch:%22pull-request%22'),sort:!(time,desc))), this failure has occured four times within the last 30 days; 12 times in the last 6 months (excluding pull request builds).\r\n\r\n**Failure excerpt**:\r\n\r\n```\r\n05:03:42   2> org.elasticsearch.cluster.metadata.ProcessClusterEventTimeoutException: failed to process cluster event (delete_repository [*]) within 30s\r\n05:03:42         at __randomizedtesting.SeedInfo.seed([3E1FD9F52E1FDC19:27DEB90468F17E06]:0)\r\n05:03:42         at org.elasticsearch.cluster.service.MasterService$Batcher.lambda$onTimeout$0(MasterService.java:143)\r\n05:03:42         at java.util.ArrayList.forEach(ArrayList.java:1540)\r\n05:03:42         at org.elasticsearch.cluster.service.MasterService$Batcher.lambda$onTimeout$1(MasterService.java:142)\r\n05:03:42         at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:674)\r\n05:03:42         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n05:03:42         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n05:03:42         at java.lang.Thread.run(Thread.java:834)\r\n```","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}