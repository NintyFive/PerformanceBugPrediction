[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353352738","html_url":"https://github.com/elastic/elasticsearch/issues/27935#issuecomment-353352738","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27935","id":353352738,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzM1MjczOA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-12-21T13:38:16Z","updated_at":"2017-12-21T13:38:16Z","author_association":"CONTRIBUTOR","body":"Can you try to identify the document that triggers this behaviour? I suspect it might have eg. `3.0` instead of `3` as a value, which makes Elasticsearch index it as a `float`. Maybe check whether you have a proxy between your client and Elasticsearch that might rewrite the json document and transform something that is an integer when it leaves the client-side into a float when it reaches Elasticsearch.\r\n\r\ncc @elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353455947","html_url":"https://github.com/elastic/elasticsearch/issues/27935#issuecomment-353455947","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27935","id":353455947,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzQ1NTk0Nw==","user":{"login":"Fluxx","id":5892,"node_id":"MDQ6VXNlcjU4OTI=","avatar_url":"https://avatars2.githubusercontent.com/u/5892?v=4","gravatar_id":"","url":"https://api.github.com/users/Fluxx","html_url":"https://github.com/Fluxx","followers_url":"https://api.github.com/users/Fluxx/followers","following_url":"https://api.github.com/users/Fluxx/following{/other_user}","gists_url":"https://api.github.com/users/Fluxx/gists{/gist_id}","starred_url":"https://api.github.com/users/Fluxx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fluxx/subscriptions","organizations_url":"https://api.github.com/users/Fluxx/orgs","repos_url":"https://api.github.com/users/Fluxx/repos","events_url":"https://api.github.com/users/Fluxx/events{/privacy}","received_events_url":"https://api.github.com/users/Fluxx/received_events","type":"User","site_admin":false},"created_at":"2017-12-21T20:57:26Z","updated_at":"2017-12-21T20:57:26Z","author_association":"NONE","body":"@jpountz thanks for the reply. I did spend some time trying to find documents in the index which were indexed as a `float`, and was unable to. I'm fairly confident this is not occurring, as the particular field is one extract programmatically out of thrift struct, whose field is the `i32` thrift type. Though I do acknowledge that a rogue document being indexed with a `float` value there would be the likely culprit.\r\n\r\nWe do not have a proxy between our logging application and elasticache either.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353459619","html_url":"https://github.com/elastic/elasticsearch/issues/27935#issuecomment-353459619","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27935","id":353459619,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzQ1OTYxOQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2017-12-21T21:15:55Z","updated_at":"2017-12-21T21:15:55Z","author_association":"MEMBER","body":"Do you have any index or dynamic templates configured?\r\n\r\nIs there an application processing the thrift datastructure and converting it to JSON to send to ES? Or are you using something like Logstash?\r\n\r\nI ask because various languages have weird edge-cases. For example, PHP (everyone's favorite punching bag) will cast an integer to double if it is greater than MAX_INT so as to prevent overflow.  There are also oddities with how it numerics are encoded to JSON in PHP.  It implicitly truncates `3.0` to `3` unless you tell it otherwise.\r\n\r\nPerhaps your language has similar oddities?\r\n\r\nIf you know the mappings ahead of time (since you have the thrift schema) setting explicit mappings in ES would be the easiest solution.  If you make the mappings strict, any future rogue documents will throw an exception and you might be able to identify what the culprit is.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373669561","html_url":"https://github.com/elastic/elasticsearch/issues/27935#issuecomment-373669561","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27935","id":373669561,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzY2OTU2MQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-03-16T10:22:18Z","updated_at":"2018-03-16T10:22:18Z","author_association":"MEMBER","body":"We were unable to identify the cause here, most likely a client problem. Closing, but feel free to reopen if you find out more.","performed_via_github_app":null}]