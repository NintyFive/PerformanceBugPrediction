[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/56157039","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-56157039","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":56157039,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MTU3MDM5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-09-19T09:41:31Z","updated_at":"2014-09-19T09:41:31Z","author_association":"CONTRIBUTOR","body":"can you tell what your test is doing or maybe even share it?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/56174218","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-56174218","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":56174218,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MTc0MjE4","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-09-19T13:07:01Z","updated_at":"2014-09-19T13:07:01Z","author_association":"NONE","body":"It happens for different tests - there doesn't seem to be a pattern.\nThe tests index some documents & then run searches or aggregations...some tests use scrolling api.\n\nOur tests are configured thus:\n\n```\n@ElasticsearchIntegrationTest.ClusterScope(scope = TEST, numClientNodes = 0, numDataNodes = 1)\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/56353019","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-56353019","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":56353019,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MzUzMDE5","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-09-22T10:08:23Z","updated_at":"2014-09-22T10:08:23Z","author_association":"NONE","body":"What does it actually mean that \"not acked\" - does it think the operation time out?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/56488136","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-56488136","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":56488136,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDg4MTM2","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2014-09-23T08:15:36Z","updated_at":"2014-09-23T08:15:36Z","author_association":"MEMBER","body":"Hi @nickminutello every time a cluster state update needs to happen (happens when you delete an index for instance), it needs to be processed on the master node first. Once the master is done with that, it sends the new cluster state to all the other nodes in the cluster, which ack that once they processed it. If the response that you get is not acked, that means that at least one of the nodes didn't ack within the ack timeout (`timeout` request parameter, defaults to 30 seconds). The operation itself didn't timeout, only the processing on some of the non master nodes did. When retrieving the cluster state via cluster state api you would still get the latest one since the call goes to the master by default, which always has the most up-to-date version of it, but some of the non master nodes might be lagging behind. You can use the `local` flag to retrieve the local cluster state taken from the node that you hit with your call. It woud be interesting to understand which node(s) is not acking the delete index and why. Anything else that is running concurrently while testing?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/56494588","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-56494588","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":56494588,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDk0NTg4","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-09-23T09:25:48Z","updated_at":"2014-09-23T09:25:48Z","author_association":"NONE","body":"No, the tests are running on a TeamCity build agent. As far as I am aware, thats all that is happening.\nIn particular, the failure is happening in a test teardown (in the index deletion).\n\nGiven our usage of the following annotation:\n\n``` java\n@ElasticsearchIntegrationTest.ClusterScope(scope = TEST, numClientNodes = 0, numDataNodes = 1)\n```\n\nThere should only be one (master) node, right? So I dont understand where the timeout occurred.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57143573","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-57143573","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":57143573,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTQzNTcz","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-09-29T10:41:10Z","updated_at":"2014-09-29T10:41:25Z","author_association":"NONE","body":"The intermittent failing tests are creating havoc with our CI ... and I am no nearer to understanding the cause :(\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57355814","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-57355814","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":57355814,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzU1ODE0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-09-30T18:03:02Z","updated_at":"2014-09-30T18:03:02Z","author_association":"CONTRIBUTOR","body":"@nickminutello i'd suggest showing the code in your test, either here or in a gist.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57648568","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-57648568","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":57648568,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NjQ4NTY4","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-10-02T15:34:52Z","updated_at":"2014-10-02T15:34:52Z","author_association":"NONE","body":"I will try paste the contents of a test - its nothing too exciting - and the failures are very much at random (you never know which test might fail in cleanup)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59072025","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-59072025","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":59072025,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MDcyMDI1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-14T16:13:23Z","updated_at":"2014-10-14T16:13:23Z","author_association":"CONTRIBUTOR","body":"Hi @nickminutello \n\nAny more info on this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/61335044","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-61335044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":61335044,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMzM1MDQ0","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-31T21:37:05Z","updated_at":"2014-10-31T21:37:05Z","author_association":"CONTRIBUTOR","body":"@nickminutello can you share this testcase that hits this? is it reproducible?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62300510","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-62300510","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":62300510,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMzAwNTEw","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-11-09T11:43:55Z","updated_at":"2014-11-09T11:43:55Z","author_association":"CONTRIBUTOR","body":"@nickminutello I think you may be hitting #8405 \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63343385","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-63343385","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":63343385,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMzQzMzg1","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T17:41:08Z","updated_at":"2014-11-17T17:45:01Z","author_association":"NONE","body":"It could be - but given our tests only index a small amount of data, I cant see it taking longer than 30s to delete.\nHOWEVER, we could be timing out because our build-agent is heavily overloaded (its running on a linux vm - which is on a host that is heavily over-subscribed). We have _never_ been able to reproduce it locally (maybe because we arent re-creating the same overloaded OS behaviour)\n\nSo we probably are seeing some kind of \"timeout\" - but its not clear from the error message that there was a timeout. \n\nIn any case, where is this timeout value set? I couldnt see anything from the elastic test support code that indicated any kind of timeout being used.\n\nIn any case, here is our testcase. \nNote that there are no assertions - since its not the test that fails - just the index deletion on cleanup.\n\n``` java\n@ElasticsearchIntegrationTest.ClusterScope(scope = TEST, numClientNodes = 0, numDataNodes = 1)\npublic class ElasticBugsMoo extends ElasticsearchIntegrationTest\n{\n    private static final String INDEX = \"bugindex\";\n    private final ObjectMapper json = new ObjectMapper();\n\n    public ElasticBugsMoo()\n    {\n        json.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false);\n        json.configure(SerializationFeature.WRITE_BIGDECIMAL_AS_PLAIN, true);\n        json.configure(DeserializationFeature.USE_BIG_DECIMAL_FOR_FLOATS, true);\n        json.configure(JsonGenerator.Feature.ESCAPE_NON_ASCII, true);\n        json.registerModule(new JodaModule());\n    }\n\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal)\n    {\n        return settingsBuilder()\n            .put(\"path.data\", \"target/elastic-test-data\")\n            .build();\n    }\n\n    private void index(String id, String type, String content) throws IOException\n    {\n        //noinspection unchecked\n        index(INDEX, type, id, json.readValue(content, Map.class));\n    }\n\n    @Test\n    public void deleteIndexFailedNotAcked() throws IOException\n    {\n        String settingsSource = \"{\\\"analysis\\\":{\\\"analyzer\\\":{\\\"logistics_index\\\":{\\\"tokenizer\\\":\\\"whitespace\\\",\\\"filter\\\":[\\\"lowercase\\\"]},\\\"logistics_search\\\":{\\\"tokenizer\\\":\\\"whitespace\\\",\\\"filter\\\":[\\\"lowercase\\\"]},\\\"default_index\\\":{\\\"type\\\":\\\"combo\\\",\\\"deduplication\\\":\\\"true\\\",\\\"sub_analyzers\\\":[\\\"logistics_index\\\",\\\"standard\\\"]},\\\"default_search\\\":{\\\"type\\\":\\\"combo\\\",\\\"deduplication\\\":\\\"true\\\",\\\"sub_analyzers\\\":[\\\"logistics_search\\\",\\\"standard\\\"]}}},\\\"number_of_replicas\\\":0}\";\n        admin()\n            .indices()\n            .prepareCreate(INDEX)\n            .setSettings(settingsSource)\n            .execute()\n            .actionGet();\n\n        String propertiesSource = \"{\\\"properties\\\":{\\\"contractualLocationCity\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"quantityUnitOfMeasure\\\":{\\\"index\\\":\\\"no\\\",\\\"type\\\":\\\"string\\\"},\\\"contractualLocationCountry\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"isAllocationNotInvoiced\\\":{\\\"type\\\":\\\"boolean\\\"},\\\"quotaStatusLabel\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"isFullyAllocated\\\":{\\\"type\\\":\\\"boolean\\\"},\\\"contractualLocation\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"allocatedQuantity\\\":{\\\"type\\\":\\\"double\\\"},\\\"quantityNormalisedUnitOfMeasure\\\":{\\\"index\\\":\\\"no\\\",\\\"type\\\":\\\"string\\\"},\\\"isInvoicedFinal\\\":{\\\"type\\\":\\\"boolean\\\"},\\\"quotaId\\\":{\\\"type\\\":\\\"long\\\"},\\\"counterParty\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"allocationStatus\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"quantity\\\":{\\\"type\\\":\\\"double\\\"},\\\"allocatedQuantityUnitOfMeasure\\\":{\\\"index\\\":\\\"no\\\",\\\"type\\\":\\\"string\\\"},\\\"customTokens\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"tradeRef\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"unallocatedQuantity\\\":{\\\"type\\\":\\\"double\\\"},\\\"contract\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"contractualLocationCode\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"shape\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"quotaStatus\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"invoiceStatus\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"unallocatedQuantityNormalisedUnitOfMeasure\\\":{\\\"index\\\":\\\"no\\\",\\\"type\\\":\\\"string\\\"},\\\"allocatedQuantityNormalised\\\":{\\\"type\\\":\\\"double\\\"},\\\"isActive\\\":{\\\"type\\\":\\\"boolean\\\"},\\\"shipmentDate\\\":{\\\"format\\\":\\\"date\\\",\\\"type\\\":\\\"date\\\"},\\\"completedDate\\\":{\\\"format\\\":\\\"date\\\",\\\"type\\\":\\\"date\\\"},\\\"groupCompany\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"allocationStatusLabel\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"invoiceQuantity\\\":{\\\"type\\\":\\\"double\\\"},\\\"resolvedIds\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"expectedSalesMonth\\\":{\\\"format\\\":\\\"date\\\",\\\"type\\\":\\\"date\\\"},\\\"expectedSalesLocationCity\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"isCancelled\\\":{\\\"type\\\":\\\"boolean\\\"},\\\"neptuneQuotaId\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"contractDutyPaid\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"unallocatedQuantityNormalised\\\":{\\\"type\\\":\\\"double\\\"},\\\"contractIncotermsCode\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"groupCompanyCode\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"grade\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"invoiceQuantityUnitOfMeasure\\\":{\\\"index\\\":\\\"no\\\",\\\"type\\\":\\\"string\\\"},\\\"unallocatedQuantityUnitOfMeasure\\\":{\\\"index\\\":\\\"no\\\",\\\"type\\\":\\\"string\\\"},\\\"counterPartyCode\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"allocatedQuantityNormalisedUnitOfMeasure\\\":{\\\"index\\\":\\\"no\\\",\\\"type\\\":\\\"string\\\"},\\\"isPurchase\\\":{\\\"type\\\":\\\"boolean\\\"},\\\"trafficOperatorFullName\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"groupCompanyId\\\":{\\\"include_in_all\\\":false,\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"expectedSalesLocation\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"intentIncotermsCode\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"trafficOperatorSid\\\":{\\\"include_in_all\\\":false,\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"quantityNormalised\\\":{\\\"type\\\":\\\"double\\\"},\\\"commodity\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"contractIncoterms\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"expectedSalesLocationCode\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"brand\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"quotaType\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"expectedSalesLocationCountry\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"},\\\"quotaRef\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"boost\\\":2.0,\\\"type\\\":\\\"string\\\"},\\\"comments\\\":{\\\"type\\\":\\\"string\\\"},\\\"intentIncoterms\\\":{\\\"index\\\":\\\"not_analyzed\\\",\\\"type\\\":\\\"string\\\"}}}\";\n        admin()\n            .indices()\n            .preparePutMapping(INDEX)\n            .setType(\"quota\")\n            .setSource(propertiesSource)\n            .execute()\n            .actionGet();\n\n        index(\"1563150401\", \"quota\", \"{\\\"allocatedQuantity\\\":1000.0000,\\\"allocatedQuantityNormalised\\\":1000.0000,\\\"allocatedQuantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"allocatedQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"allocationStatus\\\":\\\"PARTIALLY_ALLOCATED\\\",\\\"allocationStatusLabel\\\":\\\"Partially Allocated\\\",\\\"brand\\\":\\\"ACME\\u2122\\\",\\\"comments\\\":\\\"TIC-P.26884TSHS\\\",\\\"commodity\\\":\\\"0# (99.995%) sand\\\",\\\"completedDate\\\":\\\"2014-11-16\\\",\\\"contract\\\":\\\"contract\\\",\\\"contractDutyPaid\\\":null,\\\"counterParty\\\":\\\"Corporacion de Acero \\\\\\\"Corpacero\\\\\\\"\\\",\\\"counterPartyCode\\\":\\\"\\u804DZ\\uDB7C\\uDF82L\\uB86A\\uDAE4\\uDE90\\\",\\\"customTokens\\\":[\\\"Flat square\\\",\\\"99.995%\\\"],\\\"expectedSalesMonth\\\":\\\"2014-11-17\\\",\\\"grade\\\":\\\"99.97%\\\",\\\"groupCompany\\\":\\\"GROUP-COMPANY-NAME-\\uD8AD\\uDCA9\\\\u0003\\u7CDF\\uC753\\uDB14\\uDE39\\uAEDB\\u00FA\\uE682'\\u5720\\\",\\\"groupCompanyCode\\\":\\\"GROUP-COMPANY-CODE-\\uD8AD\\uDCA9\\\\u0003\\u7CDF\\uC753\\uDB14\\uDE39\\uAEDB\\u00FA\\uE682'\\u5720\\\",\\\"groupCompanyId\\\":\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"invoiceQuantity\\\":1000.0000,\\\"invoiceQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"invoiceStatus\\\":\\\"NOTFINALINVOICED\\\",\\\"isActive\\\":true,\\\"isAllocationNotInvoiced\\\":false,\\\"isCancelled\\\":false,\\\"isFullyAllocated\\\":false,\\\"isInvoicedFinal\\\":false,\\\"isPurchase\\\":true,\\\"neptuneQuotaId\\\":\\\"neptune-quota-id\\\",\\\"quantity\\\":1000.0000,\\\"quantityNormalised\\\":1000.0000,\\\"quantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"quantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"quotaId\\\":1563150401,\\\"quotaRef\\\":\\\"6775.2\\\",\\\"quotaStatus\\\":\\\"COMPLETED\\\",\\\"quotaStatusLabel\\\":\\\"Completed\\\",\\\"quotaType\\\":\\\"PURCHASE\\\",\\\"resolvedIds\\\":[\\\"2CBD832AD9BE44FBA0C8E70E0E7A529E\\\",\\\"0EAB028E816D458DA1F765C6374C9386\\\",\\\"02C11D517A2F49AD8A53F255659E9260\\\",\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"1569C43411D24E61A9C7D40D98F106C8\\\",\\\"811FD5137CB04E67AE90B08E5D8DAA53\\\",\\\"8BFD8633E4214B60957A1357069EE0B3\\\",\\\"E75A29FBE34D4461A9C8E5951CD15207\\\",\\\"2269C24D7A7844F7A7DAFB763FC75EE8\\\",\\\"55C445000CA14A3AA8A15FE37AF59015\\\",\\\"532150BA73844BEBA101B4EED9D9AD97\\\",\\\"3410FEF0BCAC4C55B686E31738177DBB\\\",\\\"8EBB9138B839470393003185BCF9FE02\\\"],\\\"shape\\\":\\\"Flat(square)\\\",\\\"shipmentDate\\\":\\\"2014-12-02\\\",\\\"tradeRef\\\":\\\"edm-trade-id\\\",\\\"trafficOperatorFullName\\\":\\\"Unknown User\\\",\\\"trafficOperatorSid\\\":\\\"UNKNOWN-USER-SID-8EBB9138B839470393003185BCF9FE02\\\",\\\"unallocatedQuantity\\\":1000.0000,\\\"unallocatedQuantityNormalised\\\":1000.0000,\\\"unallocatedQuantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"unallocatedQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\"}\");\n        index(\"1459932957\", \"quota\", \"{\\\"allocatedQuantity\\\":1000.0000,\\\"allocatedQuantityNormalised\\\":1000.0000,\\\"allocatedQuantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"allocatedQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"allocationStatus\\\":\\\"PARTIALLY_ALLOCATED\\\",\\\"allocationStatusLabel\\\":\\\"Partially Allocated\\\",\\\"brand\\\":\\\"Any Brand\\\",\\\"comments\\\":\\\"comments...\\\",\\\"commodity\\\":\\\"\\\\f\\uED97i\\u0146+\\u0438\\\",\\\"completedDate\\\":\\\"2014-11-16\\\",\\\"contract\\\":\\\"contract\\\",\\\"contractDutyPaid\\\":null,\\\"customTokens\\\":[],\\\"expectedSalesMonth\\\":\\\"2014-11-17\\\",\\\"grade\\\":null,\\\"groupCompany\\\":\\\"GROUP-COMPANY-NAME-\\uD8AD\\uDCA9\\\\u0003\\u7CDF\\uC753\\uDB14\\uDE39\\uAEDB\\u00FA\\uE682'\\u5720\\\",\\\"groupCompanyCode\\\":\\\"GROUP-COMPANY-CODE-\\uD8AD\\uDCA9\\\\u0003\\u7CDF\\uC753\\uDB14\\uDE39\\uAEDB\\u00FA\\uE682'\\u5720\\\",\\\"groupCompanyId\\\":\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"invoiceQuantity\\\":1000.0000,\\\"invoiceQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"invoiceStatus\\\":\\\"NOTFINALINVOICED\\\",\\\"isActive\\\":true,\\\"isAllocationNotInvoiced\\\":false,\\\"isCancelled\\\":false,\\\"isFullyAllocated\\\":false,\\\"isInvoicedFinal\\\":false,\\\"isPurchase\\\":true,\\\"neptuneQuotaId\\\":\\\"neptune-quota-id\\\",\\\"quantity\\\":1000.0000,\\\"quantityNormalised\\\":1000.0000,\\\"quantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"quantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"quotaId\\\":1459932957,\\\"quotaRef\\\":\\\"6775.1\\\",\\\"quotaStatus\\\":\\\"COMPLETED\\\",\\\"quotaStatusLabel\\\":\\\"Completed\\\",\\\"quotaType\\\":\\\"PURCHASE\\\",\\\"resolvedIds\\\":[\\\"F06881353B9D4756BE580C0931189A94\\\",\\\"39E34BCAED5E450892391204C6865816\\\",\\\"10AB18CA8AAD4EE0922D8BAE8DB35688\\\",\\\"64A670281F7A4F1499754F631C5B4251\\\",\\\"6B4987E5DC114C4D80B1B6EE1F8388E4\\\",\\\"423E598F4829480DBDC40D61DC54306E\\\",\\\"9647CA439B234C068DD93D542E8382EA\\\",\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"19E31892366C4B4C9715BB6FA6843E9D\\\",\\\"F61B663E722444E4B48D62BB27CE8365\\\",\\\"532150BA73844BEBA101B4EED9D9AD97\\\",\\\"5DDCECD3E741439F9BC60A6B9D03CF74\\\",\\\"C945503A0C8B48209781634BE290FA86\\\"],\\\"shape\\\":\\\"Any Shape\\\",\\\"shipmentDate\\\":\\\"2014-12-02\\\",\\\"tradeRef\\\":\\\"edm-trade-id\\\",\\\"trafficOperatorFullName\\\":\\\"Unknown User\\\",\\\"trafficOperatorSid\\\":\\\"UNKNOWN-USER-SID-423E598F4829480DBDC40D61DC54306E\\\",\\\"unallocatedQuantity\\\":1000.0000,\\\"unallocatedQuantityNormalised\\\":1000.0000,\\\"unallocatedQuantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"unallocatedQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\"}\");\n        index(\"688731920\", \"quota\",\n            \"{\\\"allocatedQuantity\\\":1000.0000,\\\"allocatedQuantityNormalised\\\":1000.0000,\\\"allocatedQuantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"allocatedQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"allocationStatus\\\":\\\"PARTIALLY_ALLOCATED\\\",\\\"allocationStatusLabel\\\":\\\"Partially Allocated\\\",\\\"brand\\\":\\\"Any Brand\\\",\\\"comments\\\":\\\"comments...\\\",\\\"commodity\\\":\\\"\\\\f\\uED97i\\u0146+\\u0438\\\",\\\"completedDate\\\":\\\"2014-11-16\\\",\\\"contract\\\":\\\"contract\\\",\\\"contractDutyPaid\\\":null,\\\"customTokens\\\":[],\\\"expectedSalesMonth\\\":\\\"2014-11-17\\\",\\\"grade\\\":null,\\\"groupCompany\\\":\\\"GROUP-COMPANY-NAME-\\uD8AD\\uDCA9\\\\u0003\\u7CDF\\uC753\\uDB14\\uDE39\\uAEDB\\u00FA\\uE682'\\u5720\\\",\\\"groupCompanyCode\\\":\\\"GROUP-COMPANY-CODE-\\uD8AD\\uDCA9\\\\u0003\\u7CDF\\uC753\\uDB14\\uDE39\\uAEDB\\u00FA\\uE682'\\u5720\\\",\\\"groupCompanyId\\\":\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"invoiceQuantity\\\":1000.0000,\\\"invoiceQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"invoiceStatus\\\":\\\"NOTFINALINVOICED\\\",\\\"isActive\\\":true,\\\"isAllocationNotInvoiced\\\":false,\\\"isCancelled\\\":false,\\\"isFullyAllocated\\\":false,\\\"isInvoicedFinal\\\":false,\\\"isPurchase\\\":true,\\\"neptuneQuotaId\\\":\\\"neptune-quota-id\\\",\\\"quantity\\\":1000.0000,\\\"quantityNormalised\\\":1000.0000,\\\"quantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"quantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"quotaId\\\":688731920,\\\"quotaRef\\\":\\\"6775.3\\\",\\\"quotaStatus\\\":\\\"COMPLETED\\\",\\\"quotaStatusLabel\\\":\\\"Completed\\\",\\\"quotaType\\\":\\\"PURCHASE\\\",\\\"resolvedIds\\\":[\\\"39E34BCAED5E450892391204C6865816\\\",\\\"E01323877943405A8717807EC25ADBDE\\\",\\\"532150BA73844BEBA101B4EED9D9AD97\\\",\\\"5D2F1F0B6B09476BA7657F436C279207\\\",\\\"8A2F58C04C994D61A087D3F727EF73C6\\\",\\\"8054C6A5A0D6410D94B466DE013EECCE\\\",\\\"D166F80523A840FFB18CA85243DDB112\\\",\\\"C065B002179C481BBC1BF80FE87642BF\\\",\\\"096144BAFCDE416D89D0A5107163D11A\\\",\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"BBF3316A0A1342EFB0AB2AE855D749DD\\\",\\\"EE4A459BED5C42928B60A357BA6D1363\\\",\\\"3994E00006CA49F78BCFB017DD5F01C4\\\"],\\\"shape\\\":\\\"Any Shape\\\",\\\"shipmentDate\\\":\\\"2014-12-02\\\",\\\"tradeRef\\\":\\\"edm-trade-id\\\",\\\"trafficOperatorFullName\\\":\\\"Unknown User\\\",\\\"trafficOperatorSid\\\":\\\"UNKNOWN-USER-SID-E01323877943405A8717807EC25ADBDE\\\",\\\"unallocatedQuantity\\\":1000.0000,\\\"unallocatedQuantityNormalised\\\":1000.0000,\\\"unallocatedQuantityNormalisedUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\",\\\"unallocatedQuantityUnitOfMeasure\\\":\\\"\\uE697\\uDB31\\uDD41\\\\u0013\\u00A3\\u04C8\\uE215\\\"}\");\n\n        refresh();\n\n        String searchSource1 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"0#\\\"}}},{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"(99.995%)\\\"}}},{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"sand\\\"}}}]}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource2 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"tic-p.26884tshs\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource3 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":[{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"corporacion\\\"}}},{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"de\\\"}}},{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"acero\\\"}}},{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"\\\\\\\"corpacero\\\\\\\"\\\"}}}]}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource4 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"99.97%\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource5 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"acme\\u2122\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource6 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"flat(square)\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource7 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"99.97\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource8 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"99.995\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource9 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"99.995%\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource10 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"0#\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n        String searchSource11 = \"{\\\"from\\\":0,\\\"size\\\":1000,\\\"query\\\":{\\\"filtered\\\":{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\":{\\\"prefix\\\":{\\\"_all\\\":{\\\"prefix\\\":\\\"nofindy\\\"}}}}},\\\"filter\\\":{\\\"and\\\":{\\\"filters\\\":[{\\\"type\\\":{\\\"value\\\":\\\"quota\\\"}},{\\\"terms\\\":{\\\"groupCompanyId\\\":[\\\"D99DCC1027854A4A922C37DFCCA383DC\\\",\\\"NO_GROUP_COMPANY\\\"]}}]}}}},\\\"aggregations\\\":{\\\"aggregated_quantity_allocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"allocatedQuantityNormalised\\\"}},\\\"aggregated_quantity_quantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"quantityNormalised\\\"}},\\\"aggregated_quantity_unallocatedQuantityNormalised\\\":{\\\"sum\\\":{\\\"field\\\":\\\"unallocatedQuantityNormalised\\\"}}}}\";\n\n        List<String> searchSources = newArrayList(\n            searchSource1,\n            searchSource2,\n            searchSource3,\n            searchSource4,\n            searchSource5,\n            searchSource6,\n            searchSource7,\n            searchSource8,\n            searchSource9,\n            searchSource10,\n            searchSource11\n        );\n\n        for (String searchSource : searchSources)\n        {\n            SearchResponse response = client()\n                .prepareSearch(INDEX)\n                .setSource(searchSource)\n                .execute()\n                .actionGet();\n        }\n    }\n\n    private String prettyPrint(String aggregationSource) throws IOException\n    {\n        return json.writerWithDefaultPrettyPrinter().writeValueAsString(json.readValue(aggregationSource, Map.class));\n    }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63505911","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-63505911","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":63505911,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNTA1OTEx","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-11-18T17:07:22Z","updated_at":"2014-11-18T17:07:22Z","author_association":"CONTRIBUTOR","body":"@nickminutello indeed that test only creates a tiny index.\n\nIn #8528 we were seeing this same issue (not caused by #8405) and as far as I can tell it was just a \"IO system is too slow\", i.e. there are not apparent thread deadlocks.  It's just that the flush took > 30 seconds ... so your theory that your heavily loaded build box could lead to this timeout makes sense.\n\nThe time is DeleteIndexRequest.setTimeout() but that's being created & sent/ack'd inside TestCluster.wipeIndices and I don't think TestCluster has a way to set the timeout on that request.\n\nYou could also try disabling check index for your test (set MockFSDirectoryService.CHECK_INDEX_ON_CLOSE to false in your settings when you create the index)... that prevents the test infra from doing a flush after the test finishes.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63781078","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-63781078","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":63781078,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNzgxMDc4","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-11-20T09:25:06Z","updated_at":"2014-11-20T09:25:06Z","author_association":"NONE","body":"Is the 30s a default timeout for all requests? Is the default timeout configurable?\n\nI will try disable the check to see if that helps.  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64668567","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-64668567","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":64668567,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NjY4NTY3","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-11-26T16:08:34Z","updated_at":"2014-11-26T16:08:44Z","author_association":"NONE","body":"I havent had a chance to try disabling the check yet.\nBut where does this 30s come from?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64672285","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-64672285","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":64672285,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NjcyMjg1","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-11-26T16:30:51Z","updated_at":"2014-11-26T16:30:51Z","author_association":"CONTRIBUTOR","body":"> But where does this 30s come from?\n\nI explained this above:\n\n> The time is DeleteIndexRequest.setTimeout() but that's being created & sent/ack'd inside TestCluster.wipeIndices and I don't think TestCluster has a way to set the timeout on that request.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64674327","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-64674327","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":64674327,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Njc0MzI3","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2014-11-26T16:43:22Z","updated_at":"2014-11-26T16:43:22Z","author_association":"NONE","body":"I guess I am not expressing my question properly - or I am not understanding your answer - either way, apologies and thanks for the patience.\n\nI guess what I am trying to say is I dont see any explicit call to DeleteIndexRequest.setTimeout()\nWhat I see is:\n\n``` java\n assertAcked(client().admin().indices().prepareDelete(indices));\n```\n\nSo it looks to me like no timeout is being set?\nSo my question is where _is_ it being set/defaulted?\n\nSorry if I am being slow...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64776956","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-64776956","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":64776956,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Nzc2OTU2","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T11:09:23Z","updated_at":"2014-11-27T11:09:23Z","author_association":"CONTRIBUTOR","body":"> So my question is where is it being set/defaulted?\n\nDeleteIndexRequest inherits setTimeout from MasterNodeOperationRequest, and if you look at the sources for that class you see it has an instance variable \"timeout\" that is initialized to 30 sec.\n\nYou could perhaps just invoke the delete index from the end of your test case, and at that point set a larger timeout?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76510661","html_url":"https://github.com/elastic/elasticsearch/issues/7798#issuecomment-76510661","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7798","id":76510661,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NTEwNjYx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-02-28T04:54:07Z","updated_at":"2015-02-28T04:54:07Z","author_association":"CONTRIBUTOR","body":"No more info provided. Closing for now\n","performed_via_github_app":null}]