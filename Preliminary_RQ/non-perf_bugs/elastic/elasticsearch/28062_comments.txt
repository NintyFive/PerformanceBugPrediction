[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355065672","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355065672","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355065672,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTA2NTY3Mg==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2018-01-03T17:02:08Z","updated_at":"2018-01-03T17:02:08Z","author_association":"MEMBER","body":"Indeed no reclamation seems of the old space seems to happen.\r\n\r\na heap dump (which may contain sensitive information as it is a memory copy) might shed some more light on this. Have you tried taking and analysing one? Or did you go out of memory and potentially one has already been written to disk?\r\n\r\nDid you do a restart between 08:51 and 11:01? Somehow there is suddently a ton of free memory? The message at 10:52 indicates that a small cluster state update also took a mere 44 seconds.\r\n\r\nJust to verify: You did not accidentally keep opening new scrolls and the others had a crazy high timeout or something? Checking the number of open search contexts in the stats API would help to verify this.\r\n\r\nAlso has an out of memory exception occured somewhere in the logs already?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355259460","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355259460","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355259460,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTI1OTQ2MA==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-04T11:26:33Z","updated_at":"2018-01-04T11:26:33Z","author_association":"NONE","body":"The elastic process was reaped by the OS between 08:51 and 11:01 which is why the memory usage suddenly dropped. \r\n\r\nI've just checked the code again, and we're not opening new scrolls (this was a prime suspect on our side too). Though the scroll size was bumped to 4000, instead of 100 as previously stated. \r\n\r\nWe don't have output from the _stats endpoint for this period. At the moment, the number of open search contexts is 0. When we run a similar scroll operation again, I can update this ticket with the number of open search contexts.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355603086","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355603086","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355603086,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTYwMzA4Ng==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-05T16:45:04Z","updated_at":"2018-01-16T09:15:50Z","author_association":"NONE","body":"We had another node disappear briefly from the cluster. The disconnection error from another node is as follows:\r\n```\r\norg.elasticsearch.transport.NodeDisconnectedException: [box2-2][10.10.10.164:9300][indices:monitor/stats[n]] disconnected\r\n[2018-01-03T19:36:22,333][DEBUG][o.e.a.a.i.s.TransportIndicesStatsAction] [box3-1] failed to execute [indices:monitor/stats] on node [urTijqtcTG-5_Fp4WlcJBQ]\r\norg.elasticsearch.transport.NodeNotConnectedException: [box2-2][10.10.10.164:9300] Node not connected\r\n        at org.elasticsearch.transport.TcpTransport.getConnection(TcpTransport.java:654) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.transport.TcpTransport.getConnection(TcpTransport.java:116) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.transport.TransportService.getConnection(TransportService.java:530) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:493) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction$AsyncAction.sendNodeRequest(TransportBroadcastByNodeAction.java:322) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction$AsyncAction.start(TransportBroadcastByNodeAction.java:311) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction.doExecute(TransportBroadcastByNodeAction.java:234) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction.doExecute(TransportBroadcastByNodeAction.java:79) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:170) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:142) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:84) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.client.node.NodeClient.executeLocally(NodeClient.java:83) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:72) [elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:408) [elasticsearch-5.5.1.jar:5.5.1]\r\n```\r\n\r\nThe logs from the node that died is as follows. It looks like there was some huge and long GC periods.\r\n\r\n```\r\n[2018-01-03T19:34:19,439][INFO ][o.e.m.j.JvmGcMonitorService] [box2-2] [gc][369756] overhead, spent [312ms] collecting in the last [1.1s]\r\n[2018-01-03T19:36:03,999][WARN ][o.e.m.j.JvmGcMonitorService] [box2-2] [gc][old][369757][135] duration [1.7m], collections [1]/[1.7m], total [1.7m]/[22m], memory [28.7gb]->[27.7gb]/[29.8gb], all_pool\r\ns {[young] [7.6mb]->[183.3mb]/[865.3mb]}{[survivor] [108.1mb]->[0b]/[108.1mb]}{[old] [28.6gb]->[27.5gb]/[28.9gb]}\r\n[2018-01-03T19:36:04,000][WARN ][o.e.m.j.JvmGcMonitorService] [box2-2] [gc][369757] overhead, spent [1.7m] collecting in the last [1.7m]\r\n[2018-01-03T19:36:03,995][WARN ][o.e.a.b.TransportShardBulkAction] [box2-2] [[news_1487808000000][2]] failed to perform indices:data/write/bulk[s] on replica [news_1487808000000][2], node[kCkNOqdFTeu\r\nWmMExF_P1Pg], [R], s[STARTED], a[id=zXh2iS9ZQzmoZ2Mdefs_7Q]\r\norg.elasticsearch.transport.RemoteTransportException: [box1-3][10.10.10.168:9300][indices:data/write/bulk[s][r]]\r\nCaused by: java.lang.IllegalStateException: active primary shard cannot be a replication target before  relocation hand off [news_1487808000000][2], node[kCkNOqdFTeuWmMExF_P1Pg], [P], s[STARTED], a[id=z\r\nXh2iS9ZQzmoZ2Mdefs_7Q], state is [STARTED]\r\n        at org.elasticsearch.index.shard.IndexShard.verifyReplicationTarget(IndexShard.java:1141) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationLock(IndexShard.java:1666) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncReplicaAction.doRun(TransportReplicationAction.java:566) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(TransportReplicationAction.java:451) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(TransportReplicationAction.java:441) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1544) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_141]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_141]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_141]\r\n[2018-01-03T19:36:03,987][WARN ][o.e.a.b.TransportShardBulkAction] [box2-2] [[historic_news_dj_1306368000000][1]] failed to perform indices:data/write/bulk[s] on replica [historic_news_dj_1306368000000][1], \r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355603762","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355603762","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355603762,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTYwMzc2Mg==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-05T16:47:37Z","updated_at":"2018-01-16T09:16:14Z","author_association":"NONE","body":"> Also has an out of memory exception occured somewhere in the logs already?\r\n\r\nFrom the logs, the original elastic node was not reaped by the OS. It ran out of memory.\r\n```\r\n[2017-12-30T10:27:45,760][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [box2-2] fatal error in thread [Thread-684115], exiting\r\njava.lang.OutOfMemoryError: Java heap space\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355604308","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355604308","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355604308,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTYwNDMwOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-01-05T16:49:37Z","updated_at":"2018-01-05T16:49:37Z","author_association":"MEMBER","body":"Can you verify if in your startup logs you have `-Dio.netty.recycler.maxCapacityPerThread=0` (you can also get this from the nodes API)?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355605390","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355605390","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355605390,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTYwNTM5MA==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-05T16:53:25Z","updated_at":"2018-01-05T16:53:25Z","author_association":"NONE","body":"`-Dio.netty.recycler.maxCapacityPerThread=0` is set in our jvm.options file. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355606422","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355606422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355606422,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTYwNjQyMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-01-05T16:57:09Z","updated_at":"2018-01-05T16:57:09Z","author_association":"MEMBER","body":"Okay, as @spinscale asked:\r\n\r\n>a heap dump (which may contain sensitive information as it is a memory copy) might shed some more light on this. Have you tried taking and analysing one? Or did you go out of memory and potentially one has already been written to disk?\r\n\r\nWe are not going to be able to help you without a heap dump analysis.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355606541","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355606541","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355606541,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTYwNjU0MQ==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-05T16:57:32Z","updated_at":"2018-01-05T16:58:26Z","author_association":"NONE","body":"Some more details about our cluster.\r\n\r\n* 9 nodes\r\n  * Each node has 128GB memory, 30GB allocated to elastic\r\n  * 4 x 4 JBOD disks on each node\r\n  * 8 physical CPU cores on each node\r\n  * 2507 shards on the cluster, over 251 indexes.\r\n\r\n  ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355607804","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355607804","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355607804,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTYwNzgwNA==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-05T17:02:26Z","updated_at":"2018-01-05T17:02:26Z","author_association":"NONE","body":"@jasontedor @spinscale \r\n\r\nA heap dump is going to be 30GB in size. Could you tell us what tell tale signs we should be looking for in a heap dump?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355613843","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355613843","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355613843,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTYxMzg0Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-01-05T17:26:25Z","updated_at":"2018-01-05T17:26:25Z","author_association":"MEMBER","body":"You need to find out what is consuming the majority of the heap.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/355937918","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-355937918","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":355937918,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NTkzNzkxOA==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-08T11:06:07Z","updated_at":"2018-01-16T09:16:47Z","author_association":"NONE","body":"The following is the output from `GET /_nodes/stats/indices/search` while we're scrolling over 9719627 documents across 62 indexes. The documents span 3 years of data.\r\n\r\nThe number of `open_contexts` does not increase. \r\n\r\nWill attempt to generate an inspect a heap dump.\r\n\r\n```\r\n{\r\n    \"_nodes\": {\r\n        \"total\": 8,\r\n        \"successful\": 8,\r\n        \"failed\": 0\r\n    },\r\n    \"cluster_name\": \"super-cluster\",\r\n    \"nodes\": {\r\n        \"Ac6MqR9tROioMFgKsfK-Xg\": {\r\n            \"timestamp\": 1515409198083,\r\n            \"name\": \"box3-1\",\r\n            \"host\": \"box3-1\",\r\n            \"roles\": [\r\n                \"master\",\r\n                \"data\",\r\n                \"ingest\"\r\n            ],\r\n            \"indices\": {\r\n                \"search\": {\r\n                    \"open_contexts\": 41,\r\n                    \"query_total\": 6803151,\r\n                    \"query_time_in_millis\": 14470298,\r\n                    \"query_current\": 0,\r\n                    \"fetch_total\": 12529,\r\n                    \"fetch_time_in_millis\": 1734415,\r\n                    \"fetch_current\": 0,\r\n                    \"scroll_total\": 1034,\r\n                    \"scroll_time_in_millis\": 3656412643,\r\n                    \"scroll_current\": 42,\r\n                    \"suggest_total\": 0,\r\n                    \"suggest_time_in_millis\": 0,\r\n                    \"suggest_current\": 0\r\n                }\r\n            }\r\n        },\r\n        \"fEEZg21jSi63Q7Ki_4A9zA\": {\r\n            \"timestamp\": 1515409198082,\r\n            \"name\": \"box2-1\",\r\n            \"host\": \"box2-1\",\r\n            \"roles\": [\r\n                \"master\",\r\n                \"data\",\r\n                \"ingest\"\r\n            ],\r\n            \"indices\": {\r\n                \"search\": {\r\n                    \"open_contexts\": 36,\r\n                    \"query_total\": 3169912,\r\n                    \"query_time_in_millis\": 920046,\r\n                    \"query_current\": 0,\r\n                    \"fetch_total\": 259,\r\n                    \"fetch_time_in_millis\": 3945,\r\n                    \"fetch_current\": 0,\r\n                    \"scroll_total\": 120,\r\n                    \"scroll_time_in_millis\": 24498384,\r\n                    \"scroll_current\": 36,\r\n                    \"suggest_total\": 0,\r\n                    \"suggest_time_in_millis\": 0,\r\n                    \"suggest_current\": 0\r\n                }\r\n            }\r\n        },\r\n        \"uToW7PcsTLe6TtmP639JDw\": {\r\n            \"timestamp\": 1515409198083,\r\n            \"name\": \"box3-2\",\r\n            \"host\": \"box3-2\",\r\n            \"roles\": [\r\n                \"master\",\r\n                \"data\",\r\n                \"ingest\"\r\n            ],\r\n            \"indices\": {\r\n                \"search\": {\r\n                    \"open_contexts\": 45,\r\n                    \"query_total\": 19005631,\r\n                    \"query_time_in_millis\": 43362682,\r\n                    \"query_current\": 0,\r\n                    \"fetch_total\": 457662,\r\n                    \"fetch_time_in_millis\": 40447166,\r\n                    \"fetch_current\": 0,\r\n                    \"scroll_total\": 12384,\r\n                    \"scroll_time_in_millis\": 6440899159,\r\n                    \"scroll_current\": 50,\r\n                    \"suggest_total\": 0,\r\n                    \"suggest_time_in_millis\": 0,\r\n                    \"suggest_current\": 0\r\n                }\r\n            }\r\n        },\r\n        \"kCkNOqdFTeuWmMExF_P1Pg\": {\r\n            \"timestamp\": 1515409198083,\r\n            \"name\": \"box1-3\",\r\n            \"host\": \"box1-3\",\r\n            \"roles\": [\r\n                \"master\",\r\n                \"data\",\r\n                \"ingest\"\r\n            ],\r\n            \"indices\": {\r\n                \"search\": {\r\n                    \"open_contexts\": 38,\r\n                    \"query_total\": 18600539,\r\n                    \"query_time_in_millis\": 49222913,\r\n                    \"query_current\": 0,\r\n                    \"fetch_total\": 440033,\r\n                    \"fetch_time_in_millis\": 44770292,\r\n                    \"fetch_current\": 0,\r\n                    \"scroll_total\": 12121,\r\n                    \"scroll_time_in_millis\": 5895367424,\r\n                    \"scroll_current\": 41,\r\n                    \"suggest_total\": 0,\r\n                    \"suggest_time_in_millis\": 0,\r\n                    \"suggest_current\": 0\r\n                }\r\n            }\r\n        },\r\n        \"urTijqtcTG-5_Fp4WlcJBQ\": {\r\n            \"timestamp\": 1515409198083,\r\n            \"name\": \"box2-2\",\r\n            \"host\": \"box2-2\",\r\n            \"roles\": [\r\n                \"master\",\r\n                \"data\",\r\n                \"ingest\"\r\n            ],\r\n            \"indices\": {\r\n                \"search\": {\r\n                    \"open_contexts\": 37,\r\n                    \"query_total\": 7877251,\r\n                    \"query_time_in_millis\": 16841893,\r\n                    \"query_current\": 0,\r\n                    \"fetch_total\": 9133,\r\n                    \"fetch_time_in_millis\": 22955430,\r\n                    \"fetch_current\": 0,\r\n                    \"scroll_total\": 1055,\r\n                    \"scroll_time_in_millis\": 4011974305,\r\n                    \"scroll_current\": 41,\r\n                    \"suggest_total\": 0,\r\n                    \"suggest_time_in_millis\": 0,\r\n                    \"suggest_current\": 0\r\n                }\r\n            }\r\n        },\r\n        \"bU_fxjk_SliE0DTSerCdsA\": {\r\n            \"timestamp\": 1515409198083,\r\n            \"name\": \"box2-3\",\r\n            \"host\": \"box2-3\",\r\n            \"roles\": [\r\n                \"master\",\r\n                \"data\",\r\n                \"ingest\"\r\n            ],\r\n            \"indices\": {\r\n                \"search\": {\r\n                    \"open_contexts\": 46,\r\n                    \"query_total\": 7082100,\r\n                    \"query_time_in_millis\": 9959213,\r\n                    \"query_current\": 0,\r\n                    \"fetch_total\": 8536,\r\n                    \"fetch_time_in_millis\": 530097,\r\n                    \"fetch_current\": 0,\r\n                    \"scroll_total\": 1249,\r\n                    \"scroll_time_in_millis\": 4468727118,\r\n                    \"scroll_current\": 50,\r\n                    \"suggest_total\": 0,\r\n                    \"suggest_time_in_millis\": 0,\r\n                    \"suggest_current\": 0\r\n                }\r\n            }\r\n        },\r\n        \"-_KLxepPTSWUyXV7K0Phcg\": {\r\n            \"timestamp\": 1515409198083,\r\n            \"name\": \"box3-3\",\r\n            \"host\": \"box3-3\",\r\n            \"roles\": [\r\n                \"master\",\r\n                \"data\",\r\n                \"ingest\"\r\n            ],\r\n            \"indices\": {\r\n                \"search\": {\r\n                    \"open_contexts\": 29,\r\n                    \"query_total\": 19578142,\r\n                    \"query_time_in_millis\": 51957058,\r\n                    \"query_current\": 0,\r\n                    \"fetch_total\": 477278,\r\n                    \"fetch_time_in_millis\": 41974012,\r\n                    \"fetch_current\": 0,\r\n                    \"scroll_total\": 12157,\r\n                    \"scroll_time_in_millis\": 7535575289,\r\n                    \"scroll_current\": 31,\r\n                    \"suggest_total\": 0,\r\n                    \"suggest_time_in_millis\": 0,\r\n                    \"suggest_current\": 0\r\n                }\r\n            }\r\n        },\r\n        \"rTxbE6QrTTGoiEv1pFr2RQ\": {\r\n            \"timestamp\": 1515409198083,\r\n            \"name\": \"box1-2\",\r\n            \"host\": \"box1-2\",\r\n            \"roles\": [\r\n                \"master\",\r\n                \"data\",\r\n                \"ingest\"\r\n            ],\r\n            \"indices\": {\r\n                \"search\": {\r\n                    \"open_contexts\": 38,\r\n                    \"query_total\": 8176481,\r\n                    \"query_time_in_millis\": 15678450,\r\n                    \"query_current\": 0,\r\n                    \"fetch_total\": 10176,\r\n                    \"fetch_time_in_millis\": 16098189,\r\n                    \"fetch_current\": 0,\r\n                    \"scroll_total\": 1124,\r\n                    \"scroll_time_in_millis\": 4570583655,\r\n                    \"scroll_current\": 39,\r\n                    \"suggest_total\": 0,\r\n                    \"suggest_time_in_millis\": 0,\r\n                    \"suggest_current\": 0\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/358984161","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-358984161","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":358984161,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODk4NDE2MQ==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-19T14:41:57Z","updated_at":"2018-01-19T14:41:57Z","author_association":"NONE","body":"We're working on getting the heap dump. We had the `-XX:+HeapDumpOnOutOfMemoryError` flag set but we hadn't specified `-XX:HeapDumpPath`. We have this specified now so the next time we get and `OutOfMemory` exception we will have a heap dump.\r\n\r\nOur master node became unresponsive yesterday as a result of long GC pauses, but it eventually recovered. \r\nOnce the master became unresponsive, the other nodes started GC'ing more frequently and for longer until they eventually ran out of memory.\r\n\r\n```\r\nsuper-cluster-2018-01-18.log:[2018-01-18T22:55:27,361][WARN ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200157] overhead, spent [513ms] collecting in the last [1s]\r\nsuper-cluster-2018-01-18.log:[2018-01-18T22:55:37,769][INFO ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200167] overhead, spent [547ms] collecting in the last [1.4s]\r\nsuper-cluster-2018-01-18.log:[2018-01-18T22:55:43,775][INFO ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200173] overhead, spent [276ms] collecting in the last [1s]\r\nsuper-cluster-2018-01-18.log:[2018-01-18T22:57:14,217][WARN ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200175] overhead, spent [1.4m] collecting in the last [1.4m]\r\nsuper-cluster-2018-01-18.log:[2018-01-18T22:57:15,266][WARN ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200176] overhead, spent [587ms] collecting in the last [1s]\r\nsuper-cluster-2018-01-18.log:[2018-01-18T22:58:29,821][WARN ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200177] overhead, spent [1.2m] collecting in the last [1.2m]\r\nsuper-cluster-2018-01-18.log:[2018-01-18T22:59:37,090][WARN ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200178] overhead, spent [1.1m] collecting in the last [1.1m]\r\nsuper-cluster-2018-01-18.log:[2018-01-18T23:00:43,707][WARN ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200179] overhead, spent [1.1m] collecting in the last [1.1m]\r\nsuper-cluster-2018-01-18.log:[2018-01-18T23:01:39,442][WARN ][o.e.m.j.JvmGcMonitorService] [box1-2] [gc][200180] overhead, spent [55.3s] collecting in the last [55.7s]\r\n```\r\nFrom the logs you can see a step change in the time spent in GC from 22:57 when the master dropped off.\r\n\r\nThe next time an OutOfMemory occurs, we will have a heap dump.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/359029044","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-359029044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":359029044,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTAyOTA0NA==","user":{"login":"ripjarphil","id":24223157,"node_id":"MDQ6VXNlcjI0MjIzMTU3","avatar_url":"https://avatars2.githubusercontent.com/u/24223157?v=4","gravatar_id":"","url":"https://api.github.com/users/ripjarphil","html_url":"https://github.com/ripjarphil","followers_url":"https://api.github.com/users/ripjarphil/followers","following_url":"https://api.github.com/users/ripjarphil/following{/other_user}","gists_url":"https://api.github.com/users/ripjarphil/gists{/gist_id}","starred_url":"https://api.github.com/users/ripjarphil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ripjarphil/subscriptions","organizations_url":"https://api.github.com/users/ripjarphil/orgs","repos_url":"https://api.github.com/users/ripjarphil/repos","events_url":"https://api.github.com/users/ripjarphil/events{/privacy}","received_events_url":"https://api.github.com/users/ripjarphil/received_events","type":"User","site_admin":false},"created_at":"2018-01-19T17:07:25Z","updated_at":"2018-01-19T17:18:51Z","author_association":"NONE","body":"We're seeing a lot of GC pauses at the moment. The output of `hot_threads` is attached.\r\nIt looks like we're spending a lot of CPU time doing `merges` and `management`.\r\n\r\nIs this normal? What could be the cause of this?\r\n\r\n[hot_threads.txt](https://github.com/elastic/elasticsearch/files/1647351/hot_threads.txt)\r\n\r\nJust to add more detail, we're not doing any queries. All nodes have 0 open search contexts. We're indexing about 110 documents/second. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372886022","html_url":"https://github.com/elastic/elasticsearch/issues/28062#issuecomment-372886022","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28062","id":372886022,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjg4NjAyMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T02:41:20Z","updated_at":"2018-03-14T02:41:20Z","author_association":"MEMBER","body":"No additional feedback, closing.","performed_via_github_app":null}]