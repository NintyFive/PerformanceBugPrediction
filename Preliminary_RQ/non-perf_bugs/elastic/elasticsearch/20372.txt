{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20372","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20372/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20372/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20372/events","html_url":"https://github.com/elastic/elasticsearch/issues/20372","id":175536894,"node_id":"MDU6SXNzdWUxNzU1MzY4OTQ=","number":20372,"title":"ArrayIndexOutOfBoundsException in WriteRequest with TransportClient 5.0.0-alpha5","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"labels":[{"id":146829143,"node_id":"MDU6TGFiZWwxNDY4MjkxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Transport%20API","name":":Core/Infra/Transport API","color":"0e8a16","default":false,"description":"Transport client API"},{"id":73544,"node_id":"MDU6TGFiZWw3MzU0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Enon-issue","name":">non-issue","color":"cfcfcf","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2016-09-07T15:41:46Z","updated_at":"2016-09-09T07:33:19Z","closed_at":"2016-09-09T07:21:19Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**: 5.0.0-alpha5\n**Plugins installed**: []\n**JVM version**: 1.8\n**OS version**: Mac OS\n**Description of the problem including expected versus actual behavior**:\n\nError when injecting data from a TransportClient (in Java)\n\n**Steps to reproduce**:\n\nBasically, I have a node running at 127.0.0.1:9300:\n\n```\n[2016-09-07 17:25:21,003][INFO ][node                     ] [3UMcJFq] version[5.0.0-alpha5], pid[14725], build[d327dd4/2016-08-04T08:59:39.568Z], OS[Mac OS X/10.11.6/x86_64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_60/25.60-b23]\n[2016-09-07 17:25:30,651][INFO ][io.netty.util.internal.PlatformDependent] Your platform does not provide complete low-level API for accessing direct buffers reliably. Unless explicitly requested, heap buffer will always be preferred to avoid potential system unstability.\n...\n[2016-09-07 17:25:50,272][INFO ][transport                ] [3UMcJFq] publish_address {127.0.0.1:9300}, bound_addresses {[fe80::1]:9300}, {[::1]:9300}, {127.0.0.1:9300}\n```\n\nThen I'm starting a client like this:\n\n``` java\n        this.esClient = new PreBuiltTransportClient(Settings.EMPTY)\n                .addTransportAddress(new InetSocketTransportAddress(new InetSocketAddress(\"127.0.0.1\", 9300)));\n```\n\nAnd indexing with:\n\n``` java\n    public void save(Person person) throws JsonProcessingException {\n        byte[] bytes = mapper.writeValueAsBytes(person);\n        esClient.index(new IndexRequest(\"person\", \"person\", person.getReference()).source(bytes)).actionGet();\n    }\n```\n\n**Provide logs (if relevant)**:\n\nLogs on the client side:\n\n```\n17:34:25.352 [ERROR] f.p.d.l.s.PersonService - Houston, we have a problem!\njava.lang.ArrayIndexOutOfBoundsException: 97\n    at org.elasticsearch.action.support.WriteRequest$RefreshPolicy.readFrom(WriteRequest.java:101) ~[elasticsearch-5.0.0-alpha5.jar:5.0.0-alpha5]\n    at org.elasticsearch.action.support.replication.ReplicatedWriteRequest.readFrom(ReplicatedWriteRequest.java:64) ~[elasticsearch-5.0.0-alpha5.jar:5.0.0-alpha5]\n    at org.elasticsearch.action.index.IndexRequest.readFrom(IndexRequest.java:630) ~[elasticsearch-5.0.0-alpha5.jar:5.0.0-alpha5]\n    at org.elasticsearch.transport.TcpTransport.handleRequest(TcpTransport.java:1296) ~[elasticsearch-5.0.0-alpha5.jar:5.0.0-alpha5]\n    at org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:1198) ~[elasticsearch-5.0.0-alpha5.jar:5.0.0-alpha5]\n    at org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:74) ~[transport-netty4-client-5.0.0-alpha5.jar:5.0.0-alpha5]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:372) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:358) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:350) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:293) ~[netty-codec-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:280) ~[netty-codec-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:396) ~[netty-codec-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:248) ~[netty-codec-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:372) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:358) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:350) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.ChannelInboundHandlerAdapter.channelRead(ChannelInboundHandlerAdapter.java:86) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:372) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:358) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:350) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1334) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:372) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:358) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:926) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:129) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:571) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:474) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:428) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:398) ~[netty-transport-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:877) ~[netty-common-4.1.4.Final-elastic-SNAPSHOT.jar:4.1.4.Final-SNAPSHOT]\n    at java.lang.Thread.run(Thread.java:745) [?:1.8.0_60]\n```\n\nNothing in server logs.\n\nI did not test yet the alpha6-SNAPSHOT (master branch). May be it has been fixed in the meantime.\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}