[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373322133","html_url":"https://github.com/elastic/elasticsearch/issues/29079#issuecomment-373322133","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29079","id":373322133,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzMyMjEzMw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T09:59:40Z","updated_at":"2018-03-15T09:59:40Z","author_association":"MEMBER","body":"You can't add the `filters` aggregation as a `source` in the `composite` aggregation as it only accepts `term`, `histogram` and `date_histogram` sources. However you can have a `filters` aggregation as a sub-aggregation as below:\r\n```\r\nGET */_search\r\n{\r\n  \"size\": 0,\r\n  \"aggs\": {\r\n    \"data\": {\r\n      \"composite\": {\r\n        \"size\": 100,\r\n        \"sources\": [\r\n          {\r\n            \"personname\": {\r\n              \"terms\": {\r\n                \"field\": \"personname.keyword\"\r\n              }\r\n            }\r\n          }\r\n        ]\r\n      },\r\n      \"aggs\": {\r\n        \"test\": {\r\n          \"filters\": {\r\n            \"filters\": {\r\n              \"query\": {\r\n                \"query_string\": {\r\n                  \"query\": \"all\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nThis means that although the `filters` aggregation is not involved in selecting the \"page\" for the aggregation it will still be returned for every bucket of the `composite` aggregation.\r\n\r\nDoes this work for your use-case?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373322232","html_url":"https://github.com/elastic/elasticsearch/issues/29079#issuecomment-373322232","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29079","id":373322232,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzMyMjIzMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T10:00:01Z","updated_at":"2018-03-15T10:00:01Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373395422","html_url":"https://github.com/elastic/elasticsearch/issues/29079#issuecomment-373395422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29079","id":373395422,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzM5NTQyMg==","user":{"login":"thekofimensah","id":23384471,"node_id":"MDQ6VXNlcjIzMzg0NDcx","avatar_url":"https://avatars0.githubusercontent.com/u/23384471?v=4","gravatar_id":"","url":"https://api.github.com/users/thekofimensah","html_url":"https://github.com/thekofimensah","followers_url":"https://api.github.com/users/thekofimensah/followers","following_url":"https://api.github.com/users/thekofimensah/following{/other_user}","gists_url":"https://api.github.com/users/thekofimensah/gists{/gist_id}","starred_url":"https://api.github.com/users/thekofimensah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thekofimensah/subscriptions","organizations_url":"https://api.github.com/users/thekofimensah/orgs","repos_url":"https://api.github.com/users/thekofimensah/repos","events_url":"https://api.github.com/users/thekofimensah/events{/privacy}","received_events_url":"https://api.github.com/users/thekofimensah/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T14:30:13Z","updated_at":"2018-03-15T14:30:13Z","author_association":"NONE","body":"Thanks for the recommendation but that doesn't really get my use case taken care of. There's not much difference between that and a normal aggregation set. I'm pushing data into the new Vega visuals and they require certain formats of data. Thanks for the post","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373401281","html_url":"https://github.com/elastic/elasticsearch/issues/29079#issuecomment-373401281","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29079","id":373401281,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzQwMTI4MQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T14:46:37Z","updated_at":"2018-03-15T14:46:37Z","author_association":"MEMBER","body":"The difference is that the composite aggregation allows you to page through all the terms in personname.keyword whereas the terms aggregation would only provide the top N terms. \r\n\r\nWhat is it that you are hoping to get from having the filters aggregation in the sources section of the composite aggregation?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373404207","html_url":"https://github.com/elastic/elasticsearch/issues/29079#issuecomment-373404207","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29079","id":373404207,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzQwNDIwNw==","user":{"login":"thekofimensah","id":23384471,"node_id":"MDQ6VXNlcjIzMzg0NDcx","avatar_url":"https://avatars0.githubusercontent.com/u/23384471?v=4","gravatar_id":"","url":"https://api.github.com/users/thekofimensah","html_url":"https://github.com/thekofimensah","followers_url":"https://api.github.com/users/thekofimensah/followers","following_url":"https://api.github.com/users/thekofimensah/following{/other_user}","gists_url":"https://api.github.com/users/thekofimensah/gists{/gist_id}","starred_url":"https://api.github.com/users/thekofimensah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thekofimensah/subscriptions","organizations_url":"https://api.github.com/users/thekofimensah/orgs","repos_url":"https://api.github.com/users/thekofimensah/repos","events_url":"https://api.github.com/users/thekofimensah/events{/privacy}","received_events_url":"https://api.github.com/users/thekofimensah/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T14:54:49Z","updated_at":"2018-03-15T14:54:49Z","author_association":"NONE","body":"I only put one filter in there but a real example there are a couple.. I'd like to do the pagation through all the terms with filters instead of categorizing by term. I can't get my aggregation from the field itself, I need to get to filtering by the value of the fields. \r\n\r\nI know this sounds nuts, but is there a way you can think of where I can do a composite agg but then limit my results only to the top 10 result sets. I need the data in the form of {person A: value1, filtera:value1}{personA:value2,filtera:value1} etc... but only the top results. This is a workaround I'm trying to create :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373408068","html_url":"https://github.com/elastic/elasticsearch/issues/29079#issuecomment-373408068","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29079","id":373408068,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzQwODA2OA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T15:05:15Z","updated_at":"2018-03-15T15:05:15Z","author_association":"MEMBER","body":">  is there a way you can think of where I can do a composite agg but then limit my results only to the top 10 result sets.\r\n\r\nNo, the intention of the composite agg is to provide a way to systematically page through all results. Inn order to get the top 10 results you would need to use the terms aggregation with a filters sub-aggregation. If you then need to flatten the response for use in your visualisation this flattening will need to be done client side.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376462561","html_url":"https://github.com/elastic/elasticsearch/issues/29079#issuecomment-376462561","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29079","id":376462561,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjQ2MjU2MQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-03-27T09:42:54Z","updated_at":"2018-03-27T09:42:54Z","author_association":"MEMBER","body":"I agree with @colings86 if you need to flatten the top N results of an aggregation the `composite` aggregation is not the solution. You'll have to perform the flattening on the client side. \r\nI am going to close this issue because the `composite` aggregation can already have a `filter` aggregation as a `sub-aggregation` but the feature request described here is different and cannot be addressed with this aggregation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/498391335","html_url":"https://github.com/elastic/elasticsearch/issues/29079#issuecomment-498391335","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29079","id":498391335,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODM5MTMzNQ==","user":{"login":"iukea1","id":35882815,"node_id":"MDQ6VXNlcjM1ODgyODE1","avatar_url":"https://avatars1.githubusercontent.com/u/35882815?v=4","gravatar_id":"","url":"https://api.github.com/users/iukea1","html_url":"https://github.com/iukea1","followers_url":"https://api.github.com/users/iukea1/followers","following_url":"https://api.github.com/users/iukea1/following{/other_user}","gists_url":"https://api.github.com/users/iukea1/gists{/gist_id}","starred_url":"https://api.github.com/users/iukea1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iukea1/subscriptions","organizations_url":"https://api.github.com/users/iukea1/orgs","repos_url":"https://api.github.com/users/iukea1/repos","events_url":"https://api.github.com/users/iukea1/events{/privacy}","received_events_url":"https://api.github.com/users/iukea1/received_events","type":"User","site_admin":false},"created_at":"2019-06-03T19:22:41Z","updated_at":"2019-06-03T19:22:41Z","author_association":"NONE","body":"yo you guys should make it so you can exclude stuff with composite","performed_via_github_app":null}]