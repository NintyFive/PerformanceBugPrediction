[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388053428","html_url":"https://github.com/elastic/elasticsearch/issues/30517#issuecomment-388053428","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30517","id":388053428,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODA1MzQyOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-05-10T13:29:49Z","updated_at":"2018-05-10T13:29:49Z","author_association":"MEMBER","body":"@matt-isett I am confused what is being asked for here that is not already in the docs? From the notes section that you link to:\r\n\r\n```\r\n. Swapping needs to be disabled for performance and node stability. This can be\r\nachieved through any of the methods mentioned in the\r\n<<setup-configuration-memory,{es} docs>>. If you opt for the\r\n`bootstrap.memory_lock: true` approach, apart from defining it through any of\r\nthe <<docker-configuration-methods,configuration methods>>, you will\r\nadditionally need the `memlock: true` ulimit, either defined in the\r\nhttps://docs.docker.com/engine/reference/commandline/dockerd/#default-ulimits[Docker Daemon]\r\nor specifically set for the container. This is demonstrated above in the\r\n<<docker-prod-cluster-composefile,docker-compose.yml>>. If using `docker run`:\r\n+\r\n--\r\n  -e \"bootstrap.memory_lock=true\" --ulimit memlock=-1:-1\r\n--\r\n```\r\n\r\nThis mentions `memlock`, this links to the [disable swapping](https://www.elastic.co/guide/en/elasticsearch/reference/6.2/setup-configuration-memory.html) section of the Elasticsearch docs, and this includes Docker-specific instructions. What specifically do you think needs to be different here?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388082142","html_url":"https://github.com/elastic/elasticsearch/issues/30517#issuecomment-388082142","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30517","id":388082142,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODA4MjE0Mg==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2018-05-10T15:06:28Z","updated_at":"2018-05-10T15:06:28Z","author_association":"CONTRIBUTOR","body":"@jasontedor @matt-isett is asking a different thing here. Our existing documentation describes how to set `memlock` to unlimited **inside the container**, however, this will inherit the defaults that the Docker (systemd) service got started with. The `docker` systemd unit file does not set `LimitMEMLOCK`, so it inherits whatever is the systemd default (or things like `user@.service`) which _may_ even differ per distro:\r\n\r\n```\r\n$ lsb_release -d && systemctl show | grep -i memlock\r\nDescription:\tUbuntu 16.04.3 LTS\r\nDefaultLimitMEMLOCK=65536\r\nDefaultLimitMEMLOCKSoft=65536\r\n\r\n$ lsb_release -d && systemctl show | grep -i memlock\r\nDescription:\tCentOS Linux release 7.4.1708 (Core) \r\nDefaultLimitMEMLOCK=65536\r\n\r\nlsb_release -d && systemctl show | grep -i memlock\r\nDescription:\topenSUSE Leap 42.3\r\nDefaultLimitMEMLOCK=65536\r\n\r\nlsb_release -d && systemctl show | grep -i memlock\r\nDescription:\tSUSE Linux Enterprise Server 12 SP3\r\nDefaultLimitMEMLOCK=65536\r\n\r\n$ lsb_release -d && systemctl show | grep -i memlock\r\nDescription:\tFedora release 27 (Twenty Seven)\r\nDefaultLimitMEMLOCK=65536\r\nDefaultLimitMEMLOCKSoft=65536\r\n```\r\n\r\n@jarpy explains how he was able to override this in Ubuntu (Xenial I think) by editing the Docker unit file: https://github.com/elastic/elasticsearch-docker/issues/152#issuecomment-372903395","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388089466","html_url":"https://github.com/elastic/elasticsearch/issues/30517#issuecomment-388089466","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30517","id":388089466,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODA4OTQ2Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-05-10T15:30:07Z","updated_at":"2018-05-10T15:30:07Z","author_association":"MEMBER","body":"Thanks for clarifying @dliappis. A few comments:\r\n - we should not be recommending editing unit files, but instead adding an unit override (e.g., in `/etc/systemd/system/docker.service.d/`).\r\n - as the [disable swapping](https://www.elastic.co/guide/en/elasticsearch/reference/6.2/setup-configuration-memory.html) that I link to mention, memory locking is not our preferred option, so we should be careful to not over-highlight this particular situation; as the docs that I link to note:\r\n\r\n> The preferred option is to completely disable swap. If this is not an option, whether or not to prefer minimizing swappiness versus memory locking is dependent on your environment.\r\n\r\nThis is consistent with your comment:\r\n\r\n> Do note however, that while this recommendation makes sense if the only thing Docker is running is Elasticsearch, it may not make sense in a mixed environment where other containers are running that may take advantage of infinity to do crazy things.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388089939","html_url":"https://github.com/elastic/elasticsearch/issues/30517#issuecomment-388089939","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30517","id":388089939,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODA4OTkzOQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-10T15:31:28Z","updated_at":"2018-05-10T15:31:28Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388111374","html_url":"https://github.com/elastic/elasticsearch/issues/30517#issuecomment-388111374","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30517","id":388111374,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODExMTM3NA==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2018-05-10T16:43:05Z","updated_at":"2018-05-10T16:43:05Z","author_association":"CONTRIBUTOR","body":"Agreed @jasontedor . My personal sentiment is that setting `LimitMEMLOCK=infinity` as the default in Docker sounds like opening the floodgates (not to mention that changing this in k8s maybe an more complicated thing). I will however defer to @jarpy 's opinion on the matter.\r\n\r\nOne minor comment:\r\n\r\n> we should not be recommending editing unit files, but instead adding an unit override (e.g., in /etc/systemd/system/docker.service.d/).\r\n\r\nUsing `systemctl edit` will actually automatically create the unit override (e.g. as in the command in https://github.com/elastic/elasticsearch-docker/issues/152#issuecomment-372903395).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388113417","html_url":"https://github.com/elastic/elasticsearch/issues/30517#issuecomment-388113417","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30517","id":388113417,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODExMzQxNw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-05-10T16:50:08Z","updated_at":"2018-05-10T16:50:40Z","author_association":"MEMBER","body":"> My personal sentiment is that setting `LimitMEMLOCK=infinity` as the default in Docker sounds like opening the floodgates (not to mention that changing this in k8s maybe an more complicated thing).\r\n\r\nAgree. And if we document them all it ends up looking like we are highlighting this as important when it's not even the approach we recommend.\r\n\r\n> Using `systemctl edit` will actually automatically create the unit override (e.g. as in the command in https://github.com/elastic/elasticsearch-docker/issues/152#issuecomment-372903395).\r\n\r\nRight; I'm trying to avoid us sowing confusion from:\r\n\r\n>@jarpy explains how he was able to override this in Ubuntu (Xenial I think) by editing the Docker unit file: [elastic/elasticsearch-docker#152 (comment)](https://github.com/elastic/elasticsearch-docker/issues/152#issuecomment-372903395)\r\n\r\nThe phrase that I think can lead to confusion here is \"**the** Docker unit file\" (emphasis added).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388119188","html_url":"https://github.com/elastic/elasticsearch/issues/30517#issuecomment-388119188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30517","id":388119188,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODExOTE4OA==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2018-05-10T17:09:19Z","updated_at":"2018-05-10T17:09:19Z","author_association":"CONTRIBUTOR","body":"Ah I see how what I said earlier could cause confusion. Apologies :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390643367","html_url":"https://github.com/elastic/elasticsearch/issues/30517#issuecomment-390643367","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30517","id":390643367,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDY0MzM2Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-05-21T12:44:31Z","updated_at":"2018-05-21T12:44:31Z","author_association":"MEMBER","body":"No additional feedback, closing.","performed_via_github_app":null}]