{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2916","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2916/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2916/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2916/events","html_url":"https://github.com/elastic/elasticsearch/issues/2916","id":13376251,"node_id":"MDU6SXNzdWUxMzM3NjI1MQ==","number":2916,"title":"terms_stats query - exclude terms from result","user":{"login":"philayres","id":294874,"node_id":"MDQ6VXNlcjI5NDg3NA==","avatar_url":"https://avatars0.githubusercontent.com/u/294874?v=4","gravatar_id":"","url":"https://api.github.com/users/philayres","html_url":"https://github.com/philayres","followers_url":"https://api.github.com/users/philayres/followers","following_url":"https://api.github.com/users/philayres/following{/other_user}","gists_url":"https://api.github.com/users/philayres/gists{/gist_id}","starred_url":"https://api.github.com/users/philayres/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philayres/subscriptions","organizations_url":"https://api.github.com/users/philayres/orgs","repos_url":"https://api.github.com/users/philayres/repos","events_url":"https://api.github.com/users/philayres/events{/privacy}","received_events_url":"https://api.github.com/users/philayres/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2013-04-18T22:15:28Z","updated_at":"2014-02-21T16:02:43Z","closed_at":"2014-02-21T16:02:43Z","author_association":"NONE","active_lock_reason":null,"body":"I currently have a terms facet  that excludes certain terms from its results, using the **exclude** option. I tried the same with a term_stats facet but the same results are not dropped.\n\nI have looked at the Elasticsearch documentation (http://www.elasticsearch.org/guide/reference/api/search/facets/terms-stats-facet/) and see that the term_stats facet doesn't appear to have an exclude option. Since I don't always trust my full interpretation of the elasticsearch docs I was looking to see if anybody had found a workaround (beyond processing out the results client-side), so I tried this same question on Stackoverflow http://stackoverflow.com/questions/16046240/elasticsearch-terms-stats-query-exclude-terms-from-result\n\nThis facet doesn't work as expected (as I expect anyway):\n\n```\n\"keywords_bad\":{\n  \"terms_stats\":{\n    \"size\":100,\n    \"value_field\":\"retweet_count\",\n    \"exclude\":[\"http\",\"consected\"],\n    \"order\":\"total\",\n    \"key_field\":\"text\"\n  }\n}\n```\n\nwhereas this facet works as expected:\n\n```\n\"keywords_good\":{    \n  \"terms\":{\n    \"size\":100,\n    \"exclude\":[\"http\",\"consected\"],\n    \"order\":\"count\",\n    \"field\":\"text\"\n  }\n}\n```\n\nThis seems a little inconsistent, and logically I can't think why exclude would be unreasonable in the terms_stats face. Adding the exclude option to the facet is what I would like to see.\n\nSo, I guess this issue is really a feature request. I took a look at the ES source for facets and I'll admit that I can read it, but I think my Java is a little rusty to contribute. So I'd like to define what I see the problem as, and if anybody thinks they can assist I'm open to help out with review, testing or whatever. \n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}