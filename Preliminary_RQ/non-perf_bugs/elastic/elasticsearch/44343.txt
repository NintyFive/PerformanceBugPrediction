{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44343","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44343/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44343/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44343/events","html_url":"https://github.com/elastic/elasticsearch/issues/44343","id":468118507,"node_id":"MDU6SXNzdWU0NjgxMTg1MDc=","number":44343,"title":"[CI] Failure in SecurityCachePermissionTests","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"labels":[{"id":912838655,"node_id":"MDU6TGFiZWw5MTI4Mzg2NTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Network","name":":Security/Network","color":"0e8a16","default":false,"description":"SSL/TLS, Security for NIO/Netty"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2019-07-15T13:10:03Z","updated_at":"2019-07-16T07:27:32Z","closed_at":"2019-07-16T07:27:31Z","author_association":"MEMBER","active_lock_reason":null,"body":"This failure (https://scans.gradle.com/s/df24fs45kcg6k/) seems to point at a real issue in the SSL NIO transport.\r\n\r\nThis is what happened:\r\n\r\n```\r\n\r\n1> [2019-07-15T03:07:48,093][WARN ][o.e.t.TcpTransport       ] [node_s1] exception caught on transport layer [TcpNioSocketChannel{localAddress=null, remoteAddress=127.0.0.1/127.0.0.1:35148}], closing connection\r\n--\r\n1> java.lang.IllegalArgumentException: Cannot change mode after SSL traffic has started\r\n1> \tat sun.security.ssl.SSLEngineImpl.setUseClientMode(SSLEngineImpl.java:1990) ~[?:?]\r\n1> \tat org.elasticsearch.xpack.security.transport.nio.SSLDriver.init(SSLDriver.java:75) ~[main/:?]\r\n1> \tat org.elasticsearch.xpack.security.transport.nio.SSLChannelContext.register(SSLChannelContext.java:60) ~[main/:?]\r\n1> \tat org.elasticsearch.nio.EventHandler.handleRegistration(EventHandler.java:65) ~[elasticsearch-nio-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\n1> \tat org.elasticsearch.nio.NioSelector.registerChannel(NioSelector.java:437) ~[elasticsearch-nio-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\n1> \tat org.elasticsearch.nio.NioSelector.setUpNewChannels(NioSelector.java:429) ~[elasticsearch-nio-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\n1> \tat org.elasticsearch.nio.NioSelector.preSelect(NioSelector.java:261) ~[elasticsearch-nio-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\n1> \tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:155) ~[elasticsearch-nio-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\n1> \tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:131) ~[elasticsearch-nio-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\n1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n1> [2019-07-15T03:07:48,125][INFO ][o.e.n.Node               ] [suite] stopped\r\n1> [2019-07-15T03:07:48,125][INFO ][o.e.n.Node               ] [suite] closing ...\r\n1> [2019-07-15T03:07:48,134][INFO ][o.e.n.Node               ] [suite] closed\r\n2> jul 15, 2019 3:07:48 AM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n2> WARNING: Uncaught exception in thread: Thread[elasticsearch[node_s2][transport_worker][T#1],5,TGRP-SecurityCachePermissionTests]\r\n2> java.lang.NullPointerException\r\n2> \tat __randomizedtesting.SeedInfo.seed([AB646A88558E1481]:0)\r\n2> \tat org.elasticsearch.nio.SelectionKeyUtils.isWriteInterested(SelectionKeyUtils.java:99)\r\n2> \tat org.elasticsearch.nio.EventHandler.postHandling(EventHandler.java:184)\r\n2> \tat org.elasticsearch.nio.NioSelector.writeToChannel(NioSelector.java:357)\r\n2> \tat org.elasticsearch.nio.NioSelector.handleQueuedWrites(NioSelector.java:468)\r\n2> \tat org.elasticsearch.nio.NioSelector.preSelect(NioSelector.java:262)\r\n2> \tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:155)\r\n2> \tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:131)\r\n2> \tat java.lang.Thread.run(Thread.java:748)\r\n\r\n\r\n```\r\n\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:security:test --tests \"org.elasticsearch.integration.SecurityCachePermissionTests\" -Dtests.seed=AB646A88558E1481 -Dtests.security.manager=true -Dtests.locale=en-US -Dtests.timezone=UTC -Dcompiler.java=12 -Druntime.java=8\r\n```\r\n\r\nLooking into it. Looks like we're trying to write to a broken channel that couldn't be properly connected and then NPE out because we don't have a selection key.","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}