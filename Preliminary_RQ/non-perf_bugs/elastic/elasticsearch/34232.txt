{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34232/events","html_url":"https://github.com/elastic/elasticsearch/issues/34232","id":365944876,"node_id":"MDU6SXNzdWUzNjU5NDQ4NzY=","number":34232,"title":"search_after unexpected/undocumented behaviour","user":{"login":"patrykk21","id":39259934,"node_id":"MDQ6VXNlcjM5MjU5OTM0","avatar_url":"https://avatars1.githubusercontent.com/u/39259934?v=4","gravatar_id":"","url":"https://api.github.com/users/patrykk21","html_url":"https://github.com/patrykk21","followers_url":"https://api.github.com/users/patrykk21/followers","following_url":"https://api.github.com/users/patrykk21/following{/other_user}","gists_url":"https://api.github.com/users/patrykk21/gists{/gist_id}","starred_url":"https://api.github.com/users/patrykk21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/patrykk21/subscriptions","organizations_url":"https://api.github.com/users/patrykk21/orgs","repos_url":"https://api.github.com/users/patrykk21/repos","events_url":"https://api.github.com/users/patrykk21/events{/privacy}","received_events_url":"https://api.github.com/users/patrykk21/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-10-02T15:09:09Z","updated_at":"2018-11-30T13:31:16Z","closed_at":"2018-11-30T13:31:16Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`curl localhost:9200`):\r\n\"version\" : {\r\n    \"number\" : \"6.2.4\",\r\n    \"build_hash\" : \"ccec39f\",\r\n    \"build_date\" : \"2018-04-12T20:37:28.497551Z\",\r\n    \"build_snapshot\" : false,\r\n    \"lucene_version\" : \"7.2.1\",\r\n    \"minimum_wire_compatibility_version\" : \"5.6.0\",\r\n    \"minimum_index_compatibility_version\" : \"5.0.0\"\r\n  }\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_181\"\r\nOpenJDK Runtime Environment (build 1.8.0_181-8u181-b13-0ubuntu0.16.04.1-b13)\r\nOpenJDK 64-Bit Server VM (build 25.181-b13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux ********* 4.4.0-127-generic #153-Ubuntu SMP Sat May 19 10:58:46 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen using the search_after [API](https://www.elastic.co/guide/en/elasticsearch/reference/master/search-request-search-after.html), it doesn't look for an exact match on `_id` but for a partial one.\r\n\r\nMore specific example:\r\n\r\nI've set a query like so (ruby):\r\n```\r\n{:sort=>[{:timestamp=>\"desc\"}, {:_id=>\"desc\"}],\r\n:search_after=>[\"1538490843000\", \"fd5e06f3-ded0-4cc1-8dc5-f798f3165ca2\"]}\r\n```\r\n\r\nSo I'd expect ElasticSearch to look for a record with an `_id` of `fd5e06f3-ded0-4cc1-8dc5-f798f3165ca2`.\r\n\r\nHowever using:\r\n```\r\n{:sort=>[{:timestamp=>\"desc\"}, {:_id=>\"desc\"}],\r\n:search_after=>[\"1538490843000\", \"fd5e06f3\"]}\r\n```\r\nOR\r\n```\r\n{:sort=>[{:timestamp=>\"desc\"}, {:_id=>\"desc\"}],\r\n:search_after=>[\"1538490843000\", \"f798f3165ca2\"]}\r\n```\r\n\r\nRespectively the first part of the UUID and the last part of the UUID the same result is yielded, at least for my data.\r\n\r\nBasically what I'm understanding is that the matching between the `_id` and the value I provided for the `search_after` API is not an exact (boolean) match, but rather a partial one. If the string I'm passing fits completely into an `_id` of one of the records, then the results after that specific record get yielded.\r\n\r\nThe expected behaviour is to not have a partial matching but an exact (or boolean) matching. Therefore only the record with the same exact `_id` of the value I'm passing should be used as a starting point.\r\n\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Create an index with timestamp, identifier\r\n 2. Insert some data into the index and have two consecutive values have the beginning of their `_id` value being equal; and the same timestamp. For example \"test12345\" and test \"test45678\" with a timestamp of your choice.\r\n 3. Run a search_after with a sorting of [timestamp, _id] and values of [chosen_timestamp, \"test\"]\r\n\r\nYou'll see yielded results starting right after one of the documents having an `_id` starting with \"test\" yielded, however none of the documents exactly matches the given `_id`.\r\n\r\nThis has been quite a hassle for me and might not even be an undesired behaviour but it is surely not documented or at least it wasn't findable for me.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n\r\n\r\nI'm not sure if this is really an issue but I'd like to know if this is an expected behaviour or rather a lacking documentation issue. Either way, let me know. \r\n\r\nThank you\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}