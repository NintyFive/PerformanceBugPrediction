[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/351827543","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-351827543","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":351827543,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MTgyNzU0Mw==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2017-12-14T20:31:41Z","updated_at":"2017-12-14T20:31:41Z","author_association":"CONTRIBUTOR","body":"Looks like this is not ES issue. This comes from the Apache Lucene (ES 5.6 used a different Lucene version).  Particularly, an error comes from  Lucene's classes of `WordnetSynonymParser` and `SynonymMap`.\r\n\r\nYou should raise this issue in: https://issues.apache.org/jira/projects/LUCENE","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/351838983","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-351838983","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":351838983,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MTgzODk4Mw==","user":{"login":"techpeace","id":2220,"node_id":"MDQ6VXNlcjIyMjA=","avatar_url":"https://avatars2.githubusercontent.com/u/2220?v=4","gravatar_id":"","url":"https://api.github.com/users/techpeace","html_url":"https://github.com/techpeace","followers_url":"https://api.github.com/users/techpeace/followers","following_url":"https://api.github.com/users/techpeace/following{/other_user}","gists_url":"https://api.github.com/users/techpeace/gists{/gist_id}","starred_url":"https://api.github.com/users/techpeace/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/techpeace/subscriptions","organizations_url":"https://api.github.com/users/techpeace/orgs","repos_url":"https://api.github.com/users/techpeace/repos","events_url":"https://api.github.com/users/techpeace/events{/privacy}","received_events_url":"https://api.github.com/users/techpeace/received_events","type":"User","site_admin":false},"created_at":"2017-12-14T21:19:33Z","updated_at":"2017-12-14T21:19:33Z","author_association":"NONE","body":"Thanks for running that down! Not sure when I'll have time to report that to them though, TBH.\r\n\r\nFor anybody else that needs WordNet support, though, the workaround at the moment is to just downgrade to 5.6.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352032753","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352032753","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352032753,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjAzMjc1Mw==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2017-12-15T15:25:23Z","updated_at":"2017-12-15T15:25:23Z","author_association":"CONTRIBUTOR","body":"@techpeace thanks. I have created a Lucene issue for this problem: https://issues.apache.org/jira/browse/LUCENE-8100","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352042093","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352042093","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352042093,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjA0MjA5Mw==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2017-12-15T16:00:58Z","updated_at":"2017-12-15T16:00:58Z","author_association":"CONTRIBUTOR","body":"@techpeace What analyzers are you using for indexing synonyms?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352053070","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352053070","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352053070,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjA1MzA3MA==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2017-12-15T16:43:35Z","updated_at":"2017-12-15T16:43:35Z","author_association":"CONTRIBUTOR","body":"++ to see the analysis chain; e.g. are you running `StopFilter` before the syn filter?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352053809","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352053809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352053809,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjA1MzgwOQ==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2017-12-15T16:46:23Z","updated_at":"2017-12-15T16:46:23Z","author_association":"CONTRIBUTOR","body":"It looks as though the problem is the analyzer used to parse the synonyms file.  SynonymMap checks that the analysis output is a continuous stream rather than a graph, and the (fairly cryptic!) error message @techpeace reports above indicates that either there are extra tokens or gaps in the stream.\r\n\r\nIn 5.6 elasticsearch used a predefined tokenizer (whitespace by default) and optionally lowercased everything, in 6.0 it uses the analysis chain defined on that field *up to* the synonym filter.  So at a guess your analysis chain is producing a graph somehow, which then makes the SynonymMap fail.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352089211","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352089211","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352089211,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjA4OTIxMQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-12-15T19:18:49Z","updated_at":"2017-12-15T19:18:49Z","author_association":"MEMBER","body":"It can also happens with `TokenFilter` that repeats some term like a phonetic filter that preserves the original term or the repeat token filter. Stacked tokens are not allowed when analyzing synonym rules, see https://github.com/elastic/elasticsearch/issues/27481#issuecomment-346806566\r\nAnyway your analysis chain contains the answer...\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352101873","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352101873","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352101873,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjEwMTg3Mw==","user":{"login":"techpeace","id":2220,"node_id":"MDQ6VXNlcjIyMjA=","avatar_url":"https://avatars2.githubusercontent.com/u/2220?v=4","gravatar_id":"","url":"https://api.github.com/users/techpeace","html_url":"https://github.com/techpeace","followers_url":"https://api.github.com/users/techpeace/followers","following_url":"https://api.github.com/users/techpeace/following{/other_user}","gists_url":"https://api.github.com/users/techpeace/gists{/gist_id}","starred_url":"https://api.github.com/users/techpeace/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/techpeace/subscriptions","organizations_url":"https://api.github.com/users/techpeace/orgs","repos_url":"https://api.github.com/users/techpeace/repos","events_url":"https://api.github.com/users/techpeace/events{/privacy}","received_events_url":"https://api.github.com/users/techpeace/received_events","type":"User","site_admin":false},"created_at":"2017-12-15T20:18:45Z","updated_at":"2017-12-15T20:18:45Z","author_association":"NONE","body":"I'm new to Elasticsearch, so I will admit to not knowing what the analysis chain is, nor how to report its contents. What I can say is that this was a stock Elasticsearch install, and I did nothing (I'm aware of) to configure the analysis chain. I was using [the searchkick library](https://github.com/ankane/searchkick) inside of a Rails app.\r\n\r\nI'd be happy to stand up another instance running 6.0.0 and report the contents of the analysis chain if somebody could fill me in on how to do that. I can also open an issue on searchkick if it's determined that's where the problem resides.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352172840","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352172840","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352172840,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjE3Mjg0MA==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2017-12-16T09:46:11Z","updated_at":"2017-12-16T09:46:11Z","author_association":"CONTRIBUTOR","body":"If you run this against your ES instance it should tell us how the synonym has been analyzed.  You'll need to replace ```[elasticsearch-url]```, ```[index]``` and ```[field]``` with the relevant examples from your setup.\r\n\r\n```\r\ncurl -XGET '[elasticsearch-url]/[index]/_analyze?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"field\" : \"[field]\",\r\n  \"text\" : \"physical entity\"\r\n}\r\n'\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352378762","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352378762","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352378762,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjM3ODc2Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-12-18T09:57:50Z","updated_at":"2017-12-18T09:57:50Z","author_association":"MEMBER","body":"I checked the code in https://github.com/ankane/searchkick, each field is defined with a `shingle` filter that build n-grams of size 1 and 2. This means that the synonym rule `physical entity` creates three tokens, `physical`, `entity` and `physical entity` (the shingle of size 2). This filter is set **before** the synonym filter so it breaks the synonym map with an ambiguous rule, synonym inputs cannot have multiple forms. I hope you don't mind if I close this issue, the breaking change is documented so you should open an issue in the searchkick repository directly (you can add a link to this issue to provide more infos for the searchkick maintainers).\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/352399557","html_url":"https://github.com/elastic/elasticsearch/issues/27798#issuecomment-352399557","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27798","id":352399557,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MjM5OTU1Nw==","user":{"login":"techpeace","id":2220,"node_id":"MDQ6VXNlcjIyMjA=","avatar_url":"https://avatars2.githubusercontent.com/u/2220?v=4","gravatar_id":"","url":"https://api.github.com/users/techpeace","html_url":"https://github.com/techpeace","followers_url":"https://api.github.com/users/techpeace/followers","following_url":"https://api.github.com/users/techpeace/following{/other_user}","gists_url":"https://api.github.com/users/techpeace/gists{/gist_id}","starred_url":"https://api.github.com/users/techpeace/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/techpeace/subscriptions","organizations_url":"https://api.github.com/users/techpeace/orgs","repos_url":"https://api.github.com/users/techpeace/repos","events_url":"https://api.github.com/users/techpeace/events{/privacy}","received_events_url":"https://api.github.com/users/techpeace/received_events","type":"User","site_admin":false},"created_at":"2017-12-18T11:25:34Z","updated_at":"2017-12-18T11:25:34Z","author_association":"NONE","body":"Thanks so much for the help, everyone! I'll open an issue on searchkick directly.","performed_via_github_app":null}]