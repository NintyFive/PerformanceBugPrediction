{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28407","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28407/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28407/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28407/events","html_url":"https://github.com/elastic/elasticsearch/issues/28407","id":292115221,"node_id":"MDU6SXNzdWUyOTIxMTUyMjE=","number":28407,"title":"[BUG Report] About aggregations request with scroll, only the first results can be output?","user":{"login":"penglongli","id":7887287,"node_id":"MDQ6VXNlcjc4ODcyODc=","avatar_url":"https://avatars1.githubusercontent.com/u/7887287?v=4","gravatar_id":"","url":"https://api.github.com/users/penglongli","html_url":"https://github.com/penglongli","followers_url":"https://api.github.com/users/penglongli/followers","following_url":"https://api.github.com/users/penglongli/following{/other_user}","gists_url":"https://api.github.com/users/penglongli/gists{/gist_id}","starred_url":"https://api.github.com/users/penglongli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/penglongli/subscriptions","organizations_url":"https://api.github.com/users/penglongli/orgs","repos_url":"https://api.github.com/users/penglongli/repos","events_url":"https://api.github.com/users/penglongli/events{/privacy}","received_events_url":"https://api.github.com/users/penglongli/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-01-27T12:00:09Z","updated_at":"2018-01-27T12:07:04Z","closed_at":"2018-01-27T12:02:16Z","author_association":"NONE","active_lock_reason":null,"body":"## Version\r\nElasticsearch:\r\n```\r\n\"version\" : {\r\n    \"number\" : \"5.0.0\",\r\n    \"build_hash\" : \"253032b\",\r\n    \"build_date\" : \"2016-10-26T05:11:34.737Z\",\r\n    \"build_snapshot\" : false,\r\n    \"lucene_version\" : \"6.2.0\"\r\n  }\r\n```\r\nJava:\r\n```\r\nopenjdk version \"1.8.0_102\"\r\n```\r\n\r\nOS:\r\n```\r\nLinux 10-10-166-129 3.13.0-46-generic #79-Ubuntu SMP Tue Mar 10 20:06:50 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\nDocker(It's a old version):\r\n```\r\nDocker version 1.12.2, build bb80604\r\n```\r\n\r\nAlso, we are using `elasticsearch:5` docker image\r\n\r\n## Description\r\n\r\n### What i want\r\nI want to search 1 hour data from elasticsearch by `Range` and `Scroll`.\r\n\r\n### What my steps\r\n\r\n**First**\r\nI Used `Range` And `Scroll ` search the first 10000 size data\r\n```\r\nGET logstash-2018.01.22/_search?scroll=1m\r\n{\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"must\": [{\r\n                \"range\": {\r\n                    \"time_iso8601\": {\r\n                        \"gte\": 1516636800000,\r\n                        \"lte\": 1516658400000,\r\n                        \"format\": \"epoch_millis\"\r\n                    }\r\n                }\r\n            }]\r\n        }\r\n    },\r\n    \"size\": 10000\r\n}\r\n```\r\n\r\nAnd i got the data:\r\n\r\n```\r\n{\r\n    \"_scroll_id\": \"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAZtkCFmdORS1zNU9RVExxOVZ6VGJKTEtBcFEAAAAAAJdFnxZFeVVudDVaM1RJLW9pUWI4WkpQR3BRAAAAAABm2QMWZ05FLXM1T1FUTHE5VnpUYkpMS0FwUQAAAAAAE7BuFnQ2aFh2aVBQVDlpR3dSc1ppa1Uza2cAAAAAAJdFoBZFeVVudDVaM1RJLW9pUWI4WkpQR3BR\",\r\n    \"took\": 3354,\r\n    \"timed_out\": false,\r\n    \"_shards\": {\r\n      \"total\": 5,\r\n      \"successful\": 5,\r\n      \"failed\": 0\r\n    },\r\n    \"hits\": {\r\n      \"total\": 506943,\r\n      \"max_score\": 1,\r\n      \"hits\": [\r\n        {\r\n          \"_index\": \"logstash-2018.01.22\",\r\n          \"_type\": \"logs\",\r\n          \"_id\": \"AWEe4DVE5NOBHBeKKltZ\"\r\n        }]\r\n    }\r\n    ................................\r\n    ................................\r\n    ................................\r\n    ................................\r\n    ................................\r\n    ................................\r\n}\r\n```\r\n\r\n**Second**\r\nUse `scroll_id` to search\r\n```\r\nGET /_search/scroll\r\n{\r\n    \"scroll\": \"1m\",\r\n    \"scroll_id\": \"{DnF1ZXJ5VGhlbkZldGNoBQAAAAAAZtkCFmdORS1zNU9RVExxOVZ6VGJKTEtBcFEAAAAAAJdFnxZFeVVudDVaM1RJLW9pUWI4WkpQR3BRAAAAAABm2QMWZ05FLXM1T1FUTHE5VnpUYkpMS0FwUQAAAAAAE7BuFnQ2aFh2aVBQVDlpR3dSc1ppa1Uza2cAAAAAAJdFoBZFeVVudDVaM1RJLW9pUWI4WkpQR3BR}\"\r\n}\r\n```\r\n\r\nAnd i got the data:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"Cannot parse scroll id\"\r\n      }\r\n    ],\r\n    \"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"Cannot parse scroll id\",\r\n    \"caused_by\": {\r\n      \"type\": \"illegal_argument_exception\",\r\n      \"reason\": \"Illegal base64 character 7b\"\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\n## Whether BUG or Feature\r\n\r\nI don't know if it is a question of my operation. I saw a passage on this page: https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-scroll.html:\r\n```\r\nIf the request specifies aggregations, only the initial search response will contain the aggregations results.\r\n```\r\n\r\nIf waht i met is meets the passage, does Elastic have a plan to add this feature?\r\n\r\nOr there have another way to resolve wht i want do:\r\n```\r\nsearch 1 hour data from elasticsearch\r\n```\r\n\r\nThank youÔºÅ","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}