{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5836","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5836/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5836/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5836/events","html_url":"https://github.com/elastic/elasticsearch/issues/5836","id":31650849,"node_id":"MDU6SXNzdWUzMTY1MDg0OQ==","number":5836,"title":"\"Best-effort Highlighting\", regardless of mapping and highlight parameters.","user":{"login":"eeeebbbbrrrr","id":5117238,"node_id":"MDQ6VXNlcjUxMTcyMzg=","avatar_url":"https://avatars3.githubusercontent.com/u/5117238?v=4","gravatar_id":"","url":"https://api.github.com/users/eeeebbbbrrrr","html_url":"https://github.com/eeeebbbbrrrr","followers_url":"https://api.github.com/users/eeeebbbbrrrr/followers","following_url":"https://api.github.com/users/eeeebbbbrrrr/following{/other_user}","gists_url":"https://api.github.com/users/eeeebbbbrrrr/gists{/gist_id}","starred_url":"https://api.github.com/users/eeeebbbbrrrr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eeeebbbbrrrr/subscriptions","organizations_url":"https://api.github.com/users/eeeebbbbrrrr/orgs","repos_url":"https://api.github.com/users/eeeebbbbrrrr/repos","events_url":"https://api.github.com/users/eeeebbbbrrrr/events{/privacy}","received_events_url":"https://api.github.com/users/eeeebbbbrrrr/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2014-04-16T15:17:51Z","updated_at":"2016-11-10T19:18:42Z","closed_at":"2016-11-10T19:18:42Z","author_association":"NONE","active_lock_reason":null,"body":"ES' hit highlighting abilities are really sophisticated, but I'd like to suggest the API be made a bit more flexible.\n\nOne use case we have is the user performs their query against the `_all` field, and our UI needs to highlight matching terms in whatever specific fields the user happens to be viewing.\n\nThe fact that the `{\"highlight\"}` API lets you wildcard field names is pretty great, until you simply specify `\"*\"`.  What happens is that ES will complain that certain fields aren't necessarily compatible with the highlighting options specified.  For example, you might see:\n\n```\n[2014-04-09 16:48:07,009][DEBUG][action.search.type       ] [Miles Warren] [6838] Failed to execute fetch phase\norg.elasticsearch.ElasticsearchIllegalArgumentException: the field [edit_date] should be indexed with term vector with position offsets to be used with fast vector highlighter\n        at org.elasticsearch.search.highlight.FastVectorHighlighter.highlight(FastVectorHighlighter.java:68)\n        at org.elasticsearch.search.highlight.HighlightPhase.hitExecute(HighlightPhase.java:126)\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:211)\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:444)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteFetch(SearchServiceTransportAction.java:406)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.executeFetch(TransportSearchQueryThenFetchAction.java:150)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$2.run(TransportSearchQueryThenFetchAction.java:134)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\n```\n\n(\"edit_date\" is defined as a date field and of course has no \"index_options\" on it).\n\nAnd if you hack a bit at the ES sources to silently ignore these errors you'll see it also complains about ES' core fields such as `_id`, `_timestamp`, `_source`, etc.\n\nWhat I'd like to propose is an option in the `{ \"highlight\" }` API to be lenient about mismatches between field mapping definitions and highlight parameters.  So if the highlight parameters aren't compatible with the mapping, ES will just move on to the next field, rather than bomb the entire request.  \n\nCall it a best-efforts highlighting for \"all\" fields.\n\nMaybe it could fall back to decreasingly less sophisticated highlighters, until it just can't do anything.  So if the request indicates the `fvh` be used, and that's not compatible with a particular field, it tries the `postings` highlighter, then the `plain` highlighter, then nothing.\n\nAdditionally, I'd like to see a highlight parameter to exclude fields.  Another use case we have is, \"I want to highlight all matched fields (whatever they are), except this array of 'large text' fields that I'm not currently showing the user\" -- this would really be a bit of a performance optimization, from the client.  Our data model includes a couple of large text fields (10k+) per document that wouldn't need to be highlighted except at very specific times -- the other fields are small and generally need to be highlighted in one call to ES.\n\nThoughts?\n\nIf y'all think this is a good idea, I'm happy to fork, do the work, make a pull request, and work with the committer(s) until it's accepted.  I basically need to do this anyways, so I'd rather have buy-in instead of maintaining my own patched version of ES.\n\nI thought about doing this as a plugin, but it looked like I'd have to duplicate quite a bit of core ES classes, which doesn't seem maintainable in the long run.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}