{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17116","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17116/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17116/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17116/events","html_url":"https://github.com/elastic/elasticsearch/issues/17116","id":141038000,"node_id":"MDU6SXNzdWUxNDEwMzgwMDA=","number":17116,"title":"Add option to combine several query scores with multiply or other","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":28,"created_at":"2016-03-15T17:04:23Z","updated_at":"2019-08-30T14:46:58Z","closed_at":"2017-03-31T13:38:12Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Currently we can use a bool query to combine the result of different queriers as sum or dismax which does max. But sometimes people might want to combine the results of several queries in different ways, for example: http://stackoverflow.com/questions/31755642/how-can-i-multiply-the-score-of-two-queries-together-in-elasticsearch\n\n`function_score` could be changed to enable multiply, min, and average. \nCurrently `function_score` can only make use of the score of one query and then combine that with some functions. But that could be changed by replacing the filter for each function with a query and then give access to the individual scores of these queries inside the functions\n\nSomething like this (not even trying to name stuff...):  \n\n```\nPOST _search\n{\n  \"query\": {\n    \"function_score\": {\n      \"query\": {\n        // here be a query or not, resulting score can be used later via _score\n      },\n      \"functions\": [\n        {\n          \"query\": {\n            // another fancy query, maybe even another function_score?, resulting score can be used via _xyz_score\n          }, \n          \"boost_mode\": \"multiply\", // need this here now too because we need to know how to combine the function with the _xyz_score\n          \"script_score\": {\n            \"script\": \"_xyz_score * _score\"\n          }\n        },\n        {\n          \"query\": {\n            // even more query!, resulting score can be used via _xyz_score\n          }, \n          \"boost_mode\": \"sum\", // need this here now too because we need to know how to combine the function with the _xyz_score\n          \"script_score\": {\n            \"script\": \"_xyz_score * doc['b'].value\"\n          }\n        },\n        ...\n      ],\n      \"score_mode\": \"multiply\"\n    }\n  }\n}\n```\n\nI think there was an issue about that already somewhere but I cannot find it.\nThis might relate to https://github.com/elastic/elasticsearch/issues/10049 because people could then make arbitrary complicated combinations using scripts and nesting function score queries. It would be crude though.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}