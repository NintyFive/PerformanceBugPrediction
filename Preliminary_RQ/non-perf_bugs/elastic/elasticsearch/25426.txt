{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25426","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25426/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25426/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25426/events","html_url":"https://github.com/elastic/elasticsearch/issues/25426","id":238823334,"node_id":"MDU6SXNzdWUyMzg4MjMzMzQ=","number":25426,"title":"Cross-Cluster-Search with non-matching wildcard does local search instead","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2017-06-27T11:43:47Z","updated_at":"2017-06-28T18:41:37Z","closed_at":"2017-06-28T18:41:37Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version**: 5.5.0-SNAPSHOT\r\n**Plugins installed**: None\r\n\r\n**Steps to reproduce**:\r\n\r\nA cross-cluster-search that has a remote wildcard that doesn't match anything, ends up running a local search across all indices.\r\n\r\nThat is: `GET /my_remote:does_not_exist*/_search` behaves like `GET /_search`\r\n\r\nReproduction:\r\n```\r\n# Start \"local\" cluster\r\n$ bin/elasticsearch -Epath.data=./data.local -Epath.logs=logs.local -Ecluster.name=local -Etransport.tcp.port=9300 -Ehttp.port=9200 -d\r\n\r\n# Start \"remote\" cluster\r\n$ bin/elasticsearch -Epath.data=./data.remote -Epath.logs=logs.remote -Ecluster.name=remote -Etransport.tcp.port=9310 -Ehttp.port=9210 -d\r\n\r\n# Put local index\r\n$ curl -XPUT http://localhost:9200/test-index/doc/1 -d'{ \"cluster\": \"local\" }'\r\n{\"_index\":\"test-index\",\"_type\":\"doc\",\"_id\":\"1\",\"_version\":1,\"result\":\"created\",\"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\"created\":true}\r\n\r\n# Put remote index\r\n$ curl -XPUT http://localhost:9210/remote-index/doc/1 -d'{ \"cluster\": \"remote\" }'\r\n{\"_index\":\"remote-index\",\"_type\":\"doc\",\"_id\":\"1\",\"_version\":1,\"result\":\"created\",\"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\"created\":true}\r\n\r\n# Put cluster seed\r\n$ curl -XPUT 'http://localhost:9200/_cluster/settings?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"transient\": {\r\n    \"search.remote.remote_cluster.seeds\": \"127.0.0.1:9310\"\r\n  }\r\n}'\r\n{\r\n  \"acknowledged\" : true,\r\n  \"persistent\" : { },\r\n  \"transient\" : {\r\n    \"search\" : {\r\n      \"remote\" : {\r\n        \"remote_cluster\" : {\r\n          \"seeds\" : \"127.0.0.1:9310\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n# Search remote cluster, find remote index [correct]\r\n$ curl 'http://localhost:9200/remote_cluster:*/_search'\r\n{\"took\":152,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":1.0,\"hits\":[{\"_index\":\"remote_cluster:remote-index\",\"_type\":\"doc\",\"_id\":\"1\",\"_score\":1.0,\"_source\":{ \"cluster\": \"remote\" }}]}}\r\n\r\n# Search for non-existent index, get appropriate error [correct]\r\n$ curl 'http://localhost:9200/remote_cluster:does_not_exist/_search'\r\n{\"error\":{\"root_cause\":[{\"type\":\"index_not_found_exception\",\"reason\":\"no such index\",\"index_uuid\":\"_na_\",\"resource.type\":\"index_or_alias\",\"resource.id\":\"does_not_exist\",\"index\":\"does_not_exist\"}],\"type\":\"transport_exception\",\"reason\":\"unable to communicate with remote cluster [remote_cluster]\",\"caused_by\":{\"type\":\"index_not_found_exception\",\"reason\":\"no such index\",\"index_uuid\":\"_na_\",\"resource.type\":\"index_or_alias\",\"resource.id\":\"does_not_exist\",\"index\":\"does_not_exist\"}},\"status\":500}\r\n\r\n# Search for non-existent wildcard, find local documents [incorrect]\r\n$ curl 'http://localhost:9200/remote_cluster:does_not_exist*/_search'\r\n{\"took\":20,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":1.0,\"hits\":[{\"_index\":\"test-index\",\"_type\":\"doc\",\"_id\":\"1\",\"_score\":1.0,\"_source\":{ \"cluster\": \"local\" }}]}}\r\n```\r\n\r\n","closed_by":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"performed_via_github_app":null}