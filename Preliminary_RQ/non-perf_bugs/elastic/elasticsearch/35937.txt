{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/35937","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35937/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35937/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35937/events","html_url":"https://github.com/elastic/elasticsearch/issues/35937","id":384696096,"node_id":"MDU6SXNzdWUzODQ2OTYwOTY=","number":35937,"title":"[CI] CCRIT::testAutoFollowing failure","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"labels":[{"id":912824565,"node_id":"MDU6TGFiZWw5MTI4MjQ1NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CCR","name":":Distributed/CCR","color":"0e8a16","default":false,"description":"Issues around the Cross Cluster State Replication features"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-11-27T09:22:00Z","updated_at":"2018-12-04T14:55:16Z","closed_at":"2018-12-04T14:55:16Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"found in: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/343/consoleFull\r\n\r\nReproduces with:\r\n\r\n```\r\n./gradlew :client:rest-high-level:integTestRunner -Dtests.seed=EDFC74BFA921E27B -Dtests.class=org.elasticsearch.client.CCRIT -Dtests.method=\"testAutoFollowing\" -Dtests.security.manager=true -Dtests.locale=es-AR -Dtests.timezone=Australia/Victoria -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n\r\nrelevant logs:\r\n\r\n```\r\n\r\n  1> [2018-11-27T20:07:44,174][INFO ][o.e.c.CCRIT              ] [testAutoFollowing] before test\r\n  1> [2018-11-27T20:07:44,359][INFO ][o.e.c.CCRIT              ] [testAutoFollowing] initializing REST clients against [http://[::1]:43809]\r\n  1> [2018-11-27T20:07:46,727][INFO ][o.e.c.CCRIT              ] [testAutoFollowing] after test\r\n  2> REPRODUCE WITH: ./gradlew :client:rest-high-level:integTestRunner -Dtests.seed=EDFC74BFA921E27B -Dtests.class=org.elasticsearch.client.CCRIT -Dtests.method=\"testAutoFollowing\" -Dtests.security.manager=true -Dtests.locale=es-AR -Dtests.timezone=Australia/Victoria -Dcompiler.java=11 -Druntime.java=8\r\n  2> REPRODUCE WITH: ./gradlew :client:rest-high-level:integTestRunner -Dtests.seed=EDFC74BFA921E27B -Dtests.class=org.elasticsearch.client.CCRIT -Dtests.method=\"testAutoFollowing\" -Dtests.security.manager=true -Dtests.locale=es-AR -Dtests.timezone=Australia/Victoria -Dcompiler.java=11 -Druntime.java=8\r\nERROR   2.61s | CCRIT.testAutoFollowing <<< FAILURES!\r\n   > Throwable #1: ElasticsearchStatusException[Elasticsearch exception [type=illegal_argument_exception, reason=no shard follow tasks for [copy-logs-20200101]]]\r\n   >    at org.elasticsearch.rest.BytesRestResponse.errorFromXContent(BytesRestResponse.java:177)\r\n   >    at org.elasticsearch.client.RestHighLevelClient.parseEntity(RestHighLevelClient.java:1703)\r\n   >    at org.elasticsearch.client.RestHighLevelClient.parseResponseException(RestHighLevelClient.java:1679)\r\n   >    at org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1444)\r\n   >    at org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1416)\r\n   >    at org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1383)\r\n   >    at org.elasticsearch.client.CcrClient.pauseFollow(CcrClient.java:106)\r\n   >    at org.elasticsearch.client.CCRIT.testAutoFollowing(CCRIT.java:156)\r\n   >    at java.lang.Thread.run(Thread.java:748)\r\n   >    Suppressed: org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:43809], URI [/copy-logs-20200101/_ccr/pause_follow], status line [HTTP/1.1 400 Bad Request]\r\n   > {\"error\":{\"root_cause\":[{\"type\":\"illegal_argument_exception\",\"reason\":\"no shard follow tasks for [copy-logs-20200101]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"no shard follow tasks for [copy-logs-20200101]\"},\"status\":400}\r\n   >            at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:687)\r\n   >            at org.elasticsearch.client.RestClient.performRequest(RestClient.java:218)\r\n   >            at org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1431)\r\n   >            ... 41 more\r\n   >    Caused by: org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:43809], URI [/copy-logs-20200101/_ccr/pause_follow], status line [HTTP/1.1 400 Bad Request]\r\n   > {\"error\":{\"root_cause\":[{\"type\":\"illegal_argument_exception\",\"reason\":\"no shard follow tasks for [copy-logs-20200101]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"no shard follow tasks for [copy-logs-20200101]\"},\"status\":400}\r\n   >            at org.elasticsearch.client.RestClient$1.completed(RestClient.java:307)\r\n   >            at org.elasticsearch.client.RestClient$1.completed(RestClient.java:292)\r\n   >            at org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n   >            at org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n   >            at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n   >            at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n   >            at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n   >            at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n   >            at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n   >            at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n   >            at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n   >            at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n   >            at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n   >            at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n   >            at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n   >            at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n   >            ... 1 moreThrowable #2: org.apache.http.ConnectionClosedException: Connection closed\r\n   >    at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:700)\r\n   >    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:218)\r\n   >    at org.elasticsearch.test.rest.ESRestTestCase.wipeCluster(ESRestTestCase.java:362)\r\n   >    at org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:193)\r\n   >    at java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: org.apache.http.ConnectionClosedException: Connection closed\r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.endOfInput(HttpAsyncRequestExecutor.java:344)\r\n   >    at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:261)\r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n   >    ... 1 more\r\n  2> NOTE: leaving temporary files on disk at: /home/hendrik/work/git-elastic-prod/elasticsearch/client/rest-high-level/build/testrun/integTestRunner/J0/temp/org.elasticsearch.client.CCRIT_EDFC74BFA921E27B-001\r\n  2> NOTE: test params are: codec=Asserting(Lucene80): {}, docValues:{}, maxPointsInLeafNode=513, maxMBSortInHeap=5.825471116586035, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@99b1b2), locale=es-AR, timezone=Australia/Victoria\r\n  2> NOTE: Linux 4.15.0-39-generic amd64/Oracle Corporation 1.8.0_181 (64-bit)/cpus=4,threads=1,free=438407176,total=514850816\r\n  2> NOTE: All tests run in this JVM: [CCRIT]\r\nCompleted [1/1] in 4.26s, 1 test, 1 error <<< FAILURES!\r\n```\r\n\r\nand\r\n\r\n```\r\n[2018-11-27T10:07:46,227][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-0] fatal error in thread [elasticsearch[node-0][masterService#updateTask][T#1]], exiting\r\njava.lang.AssertionError: null\r\n        at org.elasticsearch.xpack.ccr.action.AutoFollowCoordinator$AutoFollower.lambda$recordLeaderIndexAsFollowFunction$8(AutoFollowCoordinator.java:398) ~[?:?]\r\n        at java.util.HashMap.compute(HashMap.java:1228) ~[?:?]\r\n        at org.elasticsearch.xpack.ccr.action.AutoFollowCoordinator$AutoFollower.lambda$recordLeaderIndexAsFollowFunction$9(AutoFollowCoordinator.java:397) ~[?:?]\r\n        at org.elasticsearch.xpack.ccr.action.AutoFollowCoordinator$2$1.execute(AutoFollowCoordinator.java:196) ~[?:?]\r\n        at org.elasticsearch.cluster.ClusterStateUpdateTask.execute(ClusterStateUpdateTask.java:47) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.MasterService.executeTasks(MasterService.java:643) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.MasterService.calculateTaskOutputs(MasterService.java:272) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:202) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:137) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:627) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n        at java.lang.Thread.run(Thread.java:834) [?:?]\r\n\r\n```","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}