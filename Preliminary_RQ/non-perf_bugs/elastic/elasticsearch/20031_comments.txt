[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/240491560","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-240491560","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":240491560,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MDQ5MTU2MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-08-17T17:50:24Z","updated_at":"2016-08-17T17:50:24Z","author_association":"CONTRIBUTOR","body":"thanks @aphyr - we'll dive into it\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/243528663","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-243528663","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":243528663,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MzUyODY2Mw==","user":{"login":"jeffknupp","id":1280137,"node_id":"MDQ6VXNlcjEyODAxMzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1280137?v=4","gravatar_id":"","url":"https://api.github.com/users/jeffknupp","html_url":"https://github.com/jeffknupp","followers_url":"https://api.github.com/users/jeffknupp/followers","following_url":"https://api.github.com/users/jeffknupp/following{/other_user}","gists_url":"https://api.github.com/users/jeffknupp/gists{/gist_id}","starred_url":"https://api.github.com/users/jeffknupp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeffknupp/subscriptions","organizations_url":"https://api.github.com/users/jeffknupp/orgs","repos_url":"https://api.github.com/users/jeffknupp/repos","events_url":"https://api.github.com/users/jeffknupp/events{/privacy}","received_events_url":"https://api.github.com/users/jeffknupp/received_events","type":"User","site_admin":false},"created_at":"2016-08-30T18:09:54Z","updated_at":"2016-08-30T18:09:54Z","author_association":"NONE","body":"Will this block the 5.0 release (it seems as though it should, since resiliency is one of the features being heavily touted in the new version)?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/247924814","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-247924814","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":247924814,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NzkyNDgxNA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-09-19T07:16:04Z","updated_at":"2016-09-19T11:03:38Z","author_association":"MEMBER","body":"@aphyr thanks again for the clear description. Responding to the separate issues you mention:\n\n1) Dirty reads - as discussed before this is possible with Elasticsearch. We are working on adding documentation to make it clear.\n2) Replica/Primary divergence - the nature of primary backup replication allows replicas to be out of sync with each other while operations are in flight (not committed). A Primary failure at the moment will mean that the new primary is potentially out of sync with the other replicas but unlike the old primary it has no knowledge of which non-acked documents were still in flight and are missing from some of the replicas. Currently this is only fixed with the next replica relocation or recovery - which takes too long to correct it self. Dirty reads exposes this as well. We are currently working on document level primary/replica syncing method (see #10708) which will be used immediately upon primary promotion.\n3) Loss of acknowledge writes - this one was interesting :)   @ywelsch and I tracked it down and this is what happens:\n\nWith 5.0 we added the [notion of \"in sync copies\"](#14739) to keep track of valid copies. The valid copies are used to track which copies are allowed to become primaries. That set of what we call allocation ids is tracked in the cluster state. In the test  a change to this set that was committed   by the master was lost during a partition, causing a stale shard copy to be promoted to primary when the partition healed. This caused data loss. This issue is addressed in #20384 and will be part of the imminent 5.0 beta1 release. With it in place we run Jepsen for almost two days straight with no data loss. However, as mentioned in the ticket, there is still a very small chance of this happening. We have added an [entry to our resiliency page](https://www.elastic.co/guide/en/elasticsearch/resiliency/current/index.html#_repeated_network_partitions_can_cause_cluster_state_updates_to_be_lost_status_ongoing) about this. We are working to fix that too, although that will take quite a bit longer and will not make it for the 5.0 release.\n\n@aphyr I would love it if you can verify our findings. I will be happy to supply a snapshot build of beta1.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/249009190","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-249009190","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":249009190,"node_id":"MDEyOklzc3VlQ29tbWVudDI0OTAwOTE5MA==","user":{"login":"aphyr","id":3748,"node_id":"MDQ6VXNlcjM3NDg=","avatar_url":"https://avatars3.githubusercontent.com/u/3748?v=4","gravatar_id":"","url":"https://api.github.com/users/aphyr","html_url":"https://github.com/aphyr","followers_url":"https://api.github.com/users/aphyr/followers","following_url":"https://api.github.com/users/aphyr/following{/other_user}","gists_url":"https://api.github.com/users/aphyr/gists{/gist_id}","starred_url":"https://api.github.com/users/aphyr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aphyr/subscriptions","organizations_url":"https://api.github.com/users/aphyr/orgs","repos_url":"https://api.github.com/users/aphyr/repos","events_url":"https://api.github.com/users/aphyr/events{/privacy}","received_events_url":"https://api.github.com/users/aphyr/received_events","type":"User","site_admin":false},"created_at":"2016-09-22T19:50:22Z","updated_at":"2016-09-22T19:50:22Z","author_association":"NONE","body":"Hi @bleskes. I'd be delighted to work on verification. I've got an ongoing contract that's keeping me pretty busy right now, but if you'd like to send me an email (aphyr@jepsen.io) I'll reach out when I've got availability for more testing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376551258","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-376551258","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":376551258,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjU1MTI1OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-27T14:43:02Z","updated_at":"2018-03-27T14:43:02Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390066523","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-390066523","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":390066523,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDA2NjUyMw==","user":{"login":"saiergong","id":4198386,"node_id":"MDQ6VXNlcjQxOTgzODY=","avatar_url":"https://avatars1.githubusercontent.com/u/4198386?v=4","gravatar_id":"","url":"https://api.github.com/users/saiergong","html_url":"https://github.com/saiergong","followers_url":"https://api.github.com/users/saiergong/followers","following_url":"https://api.github.com/users/saiergong/following{/other_user}","gists_url":"https://api.github.com/users/saiergong/gists{/gist_id}","starred_url":"https://api.github.com/users/saiergong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saiergong/subscriptions","organizations_url":"https://api.github.com/users/saiergong/orgs","repos_url":"https://api.github.com/users/saiergong/repos","events_url":"https://api.github.com/users/saiergong/events{/privacy}","received_events_url":"https://api.github.com/users/saiergong/received_events","type":"User","site_admin":false},"created_at":"2018-05-18T01:30:46Z","updated_at":"2018-05-18T01:34:12Z","author_association":"NONE","body":"i wonder when primary shard send operation to its replicas, and one of the  replicas acknowleged this request to primary but the other replica did not conform, and primary not acknowlege to client. then a read request send to the acknowleged replica,Can it read the latest data that has not been acknowlege to the client?@bleskes ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390068364","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-390068364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":390068364,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDA2ODM2NA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-05-18T01:41:15Z","updated_at":"2018-05-18T01:41:15Z","author_association":"MEMBER","body":"@saiergong Yes.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390070897","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-390070897","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":390070897,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDA3MDg5Nw==","user":{"login":"saiergong","id":4198386,"node_id":"MDQ6VXNlcjQxOTgzODY=","avatar_url":"https://avatars1.githubusercontent.com/u/4198386?v=4","gravatar_id":"","url":"https://api.github.com/users/saiergong","html_url":"https://github.com/saiergong","followers_url":"https://api.github.com/users/saiergong/followers","following_url":"https://api.github.com/users/saiergong/following{/other_user}","gists_url":"https://api.github.com/users/saiergong/gists{/gist_id}","starred_url":"https://api.github.com/users/saiergong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saiergong/subscriptions","organizations_url":"https://api.github.com/users/saiergong/orgs","repos_url":"https://api.github.com/users/saiergong/repos","events_url":"https://api.github.com/users/saiergong/events{/privacy}","received_events_url":"https://api.github.com/users/saiergong/received_events","type":"User","site_admin":false},"created_at":"2018-05-18T01:56:46Z","updated_at":"2018-05-18T01:56:46Z","author_association":"NONE","body":"many thanks @jasontedor , but do we think its ok? or we have plan to resolve this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390074118","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-390074118","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":390074118,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDA3NDExOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-05-18T02:17:55Z","updated_at":"2018-05-18T02:17:55Z","author_association":"MEMBER","body":"@saiergong Indeed it is not ideal however we consider it to be a lower priority than the other problems that we are currently trying to solve.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390078559","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-390078559","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":390078559,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDA3ODU1OQ==","user":{"login":"saiergong","id":4198386,"node_id":"MDQ6VXNlcjQxOTgzODY=","avatar_url":"https://avatars1.githubusercontent.com/u/4198386?v=4","gravatar_id":"","url":"https://api.github.com/users/saiergong","html_url":"https://github.com/saiergong","followers_url":"https://api.github.com/users/saiergong/followers","following_url":"https://api.github.com/users/saiergong/following{/other_user}","gists_url":"https://api.github.com/users/saiergong/gists{/gist_id}","starred_url":"https://api.github.com/users/saiergong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saiergong/subscriptions","organizations_url":"https://api.github.com/users/saiergong/orgs","repos_url":"https://api.github.com/users/saiergong/repos","events_url":"https://api.github.com/users/saiergong/events{/privacy}","received_events_url":"https://api.github.com/users/saiergong/received_events","type":"User","site_admin":false},"created_at":"2018-05-18T02:49:35Z","updated_at":"2018-05-18T02:49:35Z","author_association":"NONE","body":"i know , thanks @jasontedor ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/586861069","html_url":"https://github.com/elastic/elasticsearch/issues/20031#issuecomment-586861069","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20031","id":586861069,"node_id":"MDEyOklzc3VlQ29tbWVudDU4Njg2MTA2OQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2020-02-17T07:56:03Z","updated_at":"2020-02-17T07:56:03Z","author_association":"CONTRIBUTOR","body":"All known issues raised here related to divergence and lost updates of documents have been fixed as part of the [sequence numbers effort](https://github.com/elastic/elasticsearch/issues/10708) and the [new cluster coordination subsystem](https://github.com/elastic/elasticsearch/issues/32006) introduced in ES 7, with tests in place that run checks similar to what the Jepsen Elasticsearch tests do.\r\n\r\nDirty reads are [documented](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-replication.html) in the Elasticsearch reference docs, and I've opened a dedicated issue (#52400) to track any related work on this.","performed_via_github_app":null}]