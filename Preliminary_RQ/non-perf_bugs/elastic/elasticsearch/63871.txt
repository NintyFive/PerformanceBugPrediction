{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/63871","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63871/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63871/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63871/events","html_url":"https://github.com/elastic/elasticsearch/issues/63871","id":724472954,"node_id":"MDU6SXNzdWU3MjQ0NzI5NTQ=","number":63871,"title":"[Transform] Transform fails for unsigned long fields","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":73544,"node_id":"MDU6TGFiZWw3MzU0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Enon-issue","name":">non-issue","color":"cfcfcf","default":false,"description":null},{"id":92913658,"node_id":"MDU6TGFiZWw5MjkxMzY1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/blocker","name":"blocker","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-10-19T10:11:58Z","updated_at":"2020-10-20T18:16:36Z","closed_at":"2020-10-20T18:16:36Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"https://github.com/elastic/elasticsearch/pull/60050 introduced a new field type `unsigned_long`. Transform fails in certain combinations if the source index uses a field mapped to `unsigned_long`.\r\n\r\nRepro steps:\r\n\r\n```\r\nPUT test_ul\r\n{\r\n  \"mappings\": {\r\n    \"properties\": {\r\n      \"metric\": {\r\n        \"type\": \"unsigned_long\"\r\n      },\r\n      \"id\": {\r\n        \"type\": \"keyword\"\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST test_ul/_doc/1\r\n{\r\n  \"id\": \"a\",\r\n  \"metric\": 3333\r\n}\r\n\r\nPOST test_ul/_doc/2\r\n{\r\n  \"id\": \"b\",\r\n  \"metric\": 3352\r\n}\r\n\r\nPOST test_ul/_doc/3\r\n{\r\n  \"id\": \"c\",\r\n  \"metric\": 1222\r\n}\r\n\r\nPOST test_ul/_doc/4\r\n{\r\n  \"id\": \"d\",\r\n  \"metric\": 4452345\r\n}\r\n\r\nPUT _transform/ul1\r\n{\r\n  \"source\": {\r\n    \"index\": \"test_ul\"\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"ul1\"\r\n  }, \r\n  \"pivot\": {\r\n    \"group_by\": {\r\n      \"id\": {\r\n        \"terms\": {\r\n          \"field\": \"id\"\r\n        }\r\n      }\r\n    },\r\n    \"aggregations\": {\r\n      \"m\": {\r\n        \"max\": {\r\n          \"field\": \"metric\"\r\n        }\r\n      },\r\n      \"a\": {\r\n        \"avg\": {\r\n          \"field\": \"metric\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST _transform/ul1/_start\r\nGET _transform/ul1/_stats\r\n```\r\n\r\nfailure:\r\n\r\n```\r\n\"reason\" : \"Failed to index documents into destination index due to permanent error: [org.elasticsearch.xpack.transform.transforms.BulkIndexingException: Bulk index experienced [4] failures and at least 1 irrecoverable [org.elasticsearch.xpack.transform.transforms.TransformException: Destination index mappings are incompatible with the transform configuration.; org.elasticsearch.index.mapper.MapperParsingException: failed to parse field [m] of type [unsigned_long] in document with id 'YWq29udX231QplrSgrzYJUMAAAAAAAAA'. Preview of field's value: '3333.0'; java.lang.IllegalArgumentException: For input string: [3333.0].]. Other failures:; org.elasticsearch.xpack.transform.transforms.TransformException: Destination index mappings are incompatible with the transform configuration.; org.elasticsearch.index.mapper.MapperParsingException: failed to parse field [m] of type [unsigned_long] in document with id 'YWq29udX231QplrSgrzYJUMAAAAAAAAA'. Preview of field's value: '3333.0'; java.lang.IllegalArgumentException: For input string: [3333.0].]\",\r\n```\r\n\r\nRoot cause: Transform indexes the output as string as it does not know that `unsigned_long` is a numeric type, which is due to the addition of `unsigned_long` as plugin.\r\n\r\n\r\n**Non-Issue**: Because `unsigned_long` support has not been released yet, this issue is not a bug by definition. It's still important to fix.\r\n\r\n**Blocker**: In order to not become a bug, I classify it as blocker.","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}