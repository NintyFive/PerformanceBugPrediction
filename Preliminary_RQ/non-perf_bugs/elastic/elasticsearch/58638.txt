{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/58638","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58638/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58638/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58638/events","html_url":"https://github.com/elastic/elasticsearch/issues/58638","id":646887712,"node_id":"MDU6SXNzdWU2NDY4ODc3MTI=","number":58638,"title":"elasticsearch rollup: how the rolled response and live response combine","user":{"login":"benjam1n77","id":45965231,"node_id":"MDQ6VXNlcjQ1OTY1MjMx","avatar_url":"https://avatars2.githubusercontent.com/u/45965231?v=4","gravatar_id":"","url":"https://api.github.com/users/benjam1n77","html_url":"https://github.com/benjam1n77","followers_url":"https://api.github.com/users/benjam1n77/followers","following_url":"https://api.github.com/users/benjam1n77/following{/other_user}","gists_url":"https://api.github.com/users/benjam1n77/gists{/gist_id}","starred_url":"https://api.github.com/users/benjam1n77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benjam1n77/subscriptions","organizations_url":"https://api.github.com/users/benjam1n77/orgs","repos_url":"https://api.github.com/users/benjam1n77/repos","events_url":"https://api.github.com/users/benjam1n77/events{/privacy}","received_events_url":"https://api.github.com/users/benjam1n77/received_events","type":"User","site_admin":false},"labels":[{"id":912843355,"node_id":"MDU6TGFiZWw5MTI4NDMzNTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Rollup","name":":Analytics/Rollup","color":"0e8a16","default":false,"description":"Turn fine-grained time-based data into coarser-grained data"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-06-28T10:15:29Z","updated_at":"2020-07-01T15:48:05Z","closed_at":"2020-07-01T15:48:04Z","author_association":"NONE","active_lock_reason":null,"body":"When I use _rollup_search api, the searchRequest become into a multisearchRequest including an original SearchRequest and a rewritten SearchRequest, and I get a multisearchResponse including a live Response and a rolled Response. But I am a little confused of how the live Response and rolled Response combine. For example, \r\n\r\nthe live response:\r\n```\r\n{\r\n  \"timeline\": {\r\n    \"buckets\": [\r\n      {\r\n        \"key_as_string\": \"2018-01-23T20:00:00.000Z\",\r\n        \"key\": 1516737600000,\r\n        \"nodes\": {\r\n          \"doc_count_error_upper_bound\": 0,\r\n          \"sum_other_doc_count\": 0,\r\n          \"buckets\": [\r\n            {\r\n              \"key\": \"a\",\r\n              \"doc_count\": 2,\r\n              \"max_temperature\": {\r\n                \"value\": 620.0\r\n              },\r\n              \"avg_voltage\": {\r\n                \"value\": 6.349999904632568\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n   }\r\n}\r\n```\r\n\r\nthe rolled response：\r\n```\r\n{\r\n  \"timeline\": {\r\n    \"buckets\": [\r\n      {\r\n        \"key_as_string\": \"2018-01-23T20:00:00.000Z\",\r\n        \"key\": 1516737600000,\r\n        \"nodes\": {\r\n          \"doc_count_error_upper_bound\": 0,\r\n          \"sum_other_doc_count\": 0,\r\n          \"buckets\": [\r\n            {\r\n              \"key\": \"b\",\r\n              \"doc_count\": 1,\r\n              \"max_temperature\": {\r\n                \"value\": 410.0\r\n              },\r\n              \"avg_voltage\": {\r\n                \"value\": 5.5\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nwhat I expect  of  the combined result：\r\n```\r\n{\r\n  \"timeline\": {\r\n    \"buckets\": [\r\n      {\r\n        \"key_as_string\": \"2018-01-23T20:00:00.000Z\",\r\n        \"key\": 1516737600000,\r\n        \"nodes\": {\r\n          \"doc_count_error_upper_bound\": 0,\r\n          \"sum_other_doc_count\": 0,\r\n          \"buckets\": [\r\n            {\r\n              \"key\": \"a\",\r\n              \"doc_count\": 2,\r\n              \"max_temperature\": {\r\n                \"value\": 620.0\r\n              },\r\n              \"avg_voltage\": {\r\n                \"value\": 6.349999904632568\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"b\",\r\n              \"doc_count\": 1,\r\n              \"max_temperature\": {\r\n                \"value\": 410.0\r\n              },\r\n              \"avg_voltage\": {\r\n                \"value\": 5.5\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nbut the fact is :\r\n```\r\n{\r\n  \"timeline\": {\r\n    \"buckets\": [\r\n      {\r\n        \"key_as_string\": \"2018-01-23T20:00:00.000Z\",\r\n        \"key\": 1516737600000,\r\n        \"nodes\": {\r\n          \"doc_count_error_upper_bound\": 0,\r\n          \"sum_other_doc_count\": 0,\r\n          \"buckets\": [\r\n            {\r\n              \"key\": \"a\",\r\n              \"doc_count\": 2,\r\n              \"max_temperature\": {\r\n                \"value\": 620.0\r\n              },\r\n              \"avg_voltage\": {\r\n                \"value\": 6.349999904632568\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nThe bucket in rolled response is overlapped by it in live response in a unresonable way : outer layer bucket is overlapped, not inner layer bucket. Will you reconsider the design of rollup in the next version? \r\n\r\n\r\n","closed_by":{"login":"csoulios","id":1561376,"node_id":"MDQ6VXNlcjE1NjEzNzY=","avatar_url":"https://avatars2.githubusercontent.com/u/1561376?v=4","gravatar_id":"","url":"https://api.github.com/users/csoulios","html_url":"https://github.com/csoulios","followers_url":"https://api.github.com/users/csoulios/followers","following_url":"https://api.github.com/users/csoulios/following{/other_user}","gists_url":"https://api.github.com/users/csoulios/gists{/gist_id}","starred_url":"https://api.github.com/users/csoulios/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/csoulios/subscriptions","organizations_url":"https://api.github.com/users/csoulios/orgs","repos_url":"https://api.github.com/users/csoulios/repos","events_url":"https://api.github.com/users/csoulios/events{/privacy}","received_events_url":"https://api.github.com/users/csoulios/received_events","type":"User","site_admin":false},"performed_via_github_app":null}