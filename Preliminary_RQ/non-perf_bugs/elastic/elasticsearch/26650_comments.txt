[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/330151096","html_url":"https://github.com/elastic/elasticsearch/issues/26650#issuecomment-330151096","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26650","id":330151096,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMDE1MTA5Ng==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2017-09-18T07:57:44Z","updated_at":"2017-09-18T07:57:44Z","author_association":"MEMBER","body":"I tried to reproduce the issue with the following statements:\r\n\r\n```\r\nDELETE /my-index-*\r\nDELETE /_template/26650\r\n\r\nPUT _template/26650\r\n{\r\n  \"template\": \"my-index-*\",\r\n  \"mappings\": {\r\n    \"my_type\": {\r\n        \"dynamic_templates\": [\r\n          {\r\n            \"long_fields\": {\r\n              \"match\": \"*\",\r\n              \"match_mapping_type\": \"long\",\r\n              \"mapping\": {\r\n                \"type\": \"long\"\r\n              }\r\n            }\r\n          },\r\n          {\r\n            \"string_fields\": {\r\n              \"match\": \"hll_*\",\r\n              \"mapping\": {\r\n                \"type\": \"binary\"\r\n              }\r\n            }\r\n          },\r\n          {\r\n            \"string_fields\": {\r\n              \"match\": \"*\",\r\n              \"match_mapping_type\": \"string\",\r\n              \"mapping\": {\r\n                \"type\": \"keyword\"\r\n              }\r\n            }\r\n          }\r\n        ]\r\n    }\r\n  }\r\n}\r\n\r\nPOST /my-index-1/my_type\r\n{\r\n    \"app_id\": 3,\r\n\t\"description\": \"some text\"\r\n}\r\n\r\nPOST /my-index-1/my_type\r\n{\r\n    \"app_id\": 4,\r\n\t\"hll_assets\": \"an asset\"\r\n}\r\n\r\nPOST /my-index-2/my_type\r\n{\r\n    \"app_id\": 3,\r\n\t\"hll_assets\": \"an asset\"\r\n}\r\n\r\nPOST /my-index-2/my_type\r\n{\r\n    \"app_id\": 4,\r\n\t\"description\": \"some other text\"\r\n}\r\n\r\nGET /my-index-*/_mapping\r\n```\r\n\r\nFor both indices I get:\r\n\r\n```json\r\n\"properties\": {\r\n  \"app_id\": {\r\n    \"type\": \"long\"\r\n  },\r\n  \"description\": {\r\n    \"type\": \"keyword\"\r\n  },\r\n  \"hll_assets\": {\r\n    \"type\": \"binary\"\r\n  }\r\n}\r\n```\r\n\r\nSo I think there is something missing in your original description.\r\n\r\nWhat do you mean by the following question?\r\n\r\n> maybe there is a difference in behavior when you create the mapping from the template vs when you update the mapping?\r\n\r\nIf you update the mapping of an index by e.g. adding a new field then dynamic templates will not apply to that field (because it already exists then). So there are certainly differences but I am not sure what you are after.\r\n\r\n> My 2 dynamic_templates are named \"string_fields\", If that's the problem ES should send an error and refuse the template creation\r\n\r\nThis is not a problem because dynamic templates are stored in a list internally and their order is preserved. The name does not matter although I think we should really enforce unique names here to avoid confusion.\r\n\r\nCan you please try to refine your reproduction scenario as I could not reproduce the behavior you are describing? Are there mappings or dynamic templates updated in between?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/330267134","html_url":"https://github.com/elastic/elasticsearch/issues/26650#issuecomment-330267134","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26650","id":330267134,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMDI2NzEzNA==","user":{"login":"champtar","id":3536755,"node_id":"MDQ6VXNlcjM1MzY3NTU=","avatar_url":"https://avatars1.githubusercontent.com/u/3536755?v=4","gravatar_id":"","url":"https://api.github.com/users/champtar","html_url":"https://github.com/champtar","followers_url":"https://api.github.com/users/champtar/followers","following_url":"https://api.github.com/users/champtar/following{/other_user}","gists_url":"https://api.github.com/users/champtar/gists{/gist_id}","starred_url":"https://api.github.com/users/champtar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/champtar/subscriptions","organizations_url":"https://api.github.com/users/champtar/orgs","repos_url":"https://api.github.com/users/champtar/repos","events_url":"https://api.github.com/users/champtar/events{/privacy}","received_events_url":"https://api.github.com/users/champtar/received_events","type":"User","site_admin":false},"created_at":"2017-09-18T15:51:59Z","updated_at":"2017-09-18T15:51:59Z","author_association":"NONE","body":"Hi @danielmitterdorfer \r\n\r\nI'm not able to reproduce it, but it did happen ...\r\n\r\nMy question was maybe there is a difference if first document is\r\n```\r\nPOST /my-index-1/my_type\r\n{\r\n  \"k\": \"aaa\",\r\n  \"hll_ip\": \"ZXMgcm9ja3M=\"\r\n}\r\n```\r\nrather than\r\n```\r\nPOST /my-index-1/my_type\r\n{\r\n  \"k\": \"aaa\",\r\n  \"hll_ip\": \"ZXMgcm9ja3M=\",\r\n  \"hll_assets\": \"ZXMgcm9ja3M=\"\r\n}\r\n```\r\nie if we update the properties list (new field in second document) instead of having the full list at index creation (in the first document)\r\nIf this change anything, my hll_* fields are big  (~12k) \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/330459179","html_url":"https://github.com/elastic/elasticsearch/issues/26650#issuecomment-330459179","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26650","id":330459179,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMDQ1OTE3OQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2017-09-19T07:52:04Z","updated_at":"2017-09-19T07:52:04Z","author_association":"MEMBER","body":"> I'm not able to reproduce it, but it did happen ...\r\n\r\nOh, I am not questioning at all that it did happen. It's just that I could not come up with a scenario to reproduce it. I could see this happen with an explicit mapping update right after creating an index, i.e.:\r\n\r\n1. Create an index including the dynamic template definition (as the [examples in the docs](https://www.elastic.co/guide/en/elasticsearch/reference/5.6/dynamic-templates.html) show)\r\n2. Index a document without a `hll_assets` field\r\n3. Define an explicit mapping for `hll_assets` to `keyword` via the PUT mapping API\r\n4. Index a document with `hll_assets`. As the mapping was defined explicitly already in step 3, the dynamic template does not apply (because a mapping for the field `hll_assets` already exists)\r\n\r\nBut I could not read anything like that from your description so I don't think that you are doing such things.\r\n\r\nThe scenario that you are describing in your previous comment is perfectly fine (i.e. there is no need that `hll_assets` is contained in every document). Also the length of the field contents does not play a role here.\r\n\r\nOne other possibility that I could imagine is that you first create an index, add documents and then add the dynamic templates later with the PUT mapping API. If a field is already present when you add the dynamic template is added, it's too late (similar to the scenario that I've described above).\r\n\r\nI'd close this issue for now as we both cannot reproduce the behavior at the moment. However, please comment on this ticket again if you find a scenario that reproduces it. Thank you for your help!","performed_via_github_app":null}]