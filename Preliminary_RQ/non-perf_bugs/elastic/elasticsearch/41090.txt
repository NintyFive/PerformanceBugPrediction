{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41090","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41090/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41090/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41090/events","html_url":"https://github.com/elastic/elasticsearch/issues/41090","id":431675585,"node_id":"MDU6SXNzdWU0MzE2NzU1ODU=","number":41090,"title":"Error upgrading from (<= 6.5) to 6.7.x","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1296382697,"node_id":"MDU6TGFiZWwxMjk2MzgyNjk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.7.2","name":"v6.7.2","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-04-10T19:32:28Z","updated_at":"2019-04-11T18:54:23Z","closed_at":"2019-04-11T18:54:23Z","author_association":"MEMBER","active_lock_reason":null,"body":"While upgrading from version 6.5.x (or a previous version) to 6.7.x, there is a bug that puts a `null` value into the cluster metadata state in certain situations. \r\n\r\nIf there exists any ML Anomaly jobs or Datafeeds and there are NO persistent tasks in the cluster state, then the ml config migration process puts a `null` value into the the new cluster state and attempts to update the state. This, of course, fails as the Diff check sees the null value and throws an NPE. \r\n\r\nThis issue can be worked around in any of the following ways:\r\n* Delete Jobs and datafeeds\r\n* Set the cluster setting `xpack.ml.enable_config_migration` to `false`. It is a dynamic setting.\r\n* Open any ML job so that a persistent task gets created. \r\n\r\nbefore setting `xpack.ml.enable_config_migration: true` again, the jobs either need to be deleted, or open one of the jobs. That will then allow the migration to take place. ","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}