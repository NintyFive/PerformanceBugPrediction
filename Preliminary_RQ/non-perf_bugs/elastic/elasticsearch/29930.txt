{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29930","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29930/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29930/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29930/events","html_url":"https://github.com/elastic/elasticsearch/issues/29930","id":317449564,"node_id":"MDU6SXNzdWUzMTc0NDk1NjQ=","number":29930,"title":"add a higher level authentication cache","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-02-10T17:51:39Z","updated_at":"2018-06-21T20:58:57Z","closed_at":"2018-06-21T20:58:57Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"*Original comment by @jaymode:*\n\nToday we cache authentication credentials (hashed and salted) in per realm caches. This is problematic when we have many realms because authentication will still occur on realms in the chain before the cached one and with LDAP realms this means network connections and added latency.\n\nFor example take the following config:\n\n``` yaml\nshield:\n  authc:\n    realms:\n      default:\n        type: esusers\n        order: 0\n      ldap1:\n        type: ldap\n        order: 1\n        ...\n      ldap2:\n        type: ldap\n        order: 2\n        ...\n      active_directory:\n        type: active_directory\n        order: 3\n```\n\nIf a active directory user tries to authenticate, then they will go through the chain and finally authenticate at the AD realm. On the next authentication attempt, the chain is traversed and each realm is tried until the AD realm is hit and we can find the user in the cache. This can kill performance and responsiveness of applications.\n\nFrom @uboness one option is:\n\n> grouping realms by supported token type and put caches per group\n\n\n","closed_by":{"login":"tomcallahan","id":15988488,"node_id":"MDQ6VXNlcjE1OTg4NDg4","avatar_url":"https://avatars1.githubusercontent.com/u/15988488?v=4","gravatar_id":"","url":"https://api.github.com/users/tomcallahan","html_url":"https://github.com/tomcallahan","followers_url":"https://api.github.com/users/tomcallahan/followers","following_url":"https://api.github.com/users/tomcallahan/following{/other_user}","gists_url":"https://api.github.com/users/tomcallahan/gists{/gist_id}","starred_url":"https://api.github.com/users/tomcallahan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomcallahan/subscriptions","organizations_url":"https://api.github.com/users/tomcallahan/orgs","repos_url":"https://api.github.com/users/tomcallahan/repos","events_url":"https://api.github.com/users/tomcallahan/events{/privacy}","received_events_url":"https://api.github.com/users/tomcallahan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}