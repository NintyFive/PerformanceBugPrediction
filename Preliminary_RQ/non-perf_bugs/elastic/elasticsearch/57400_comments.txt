[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/636662614","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-636662614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":636662614,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNjY2MjYxNA==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-06-01T07:25:24Z","updated_at":"2020-06-01T09:23:57Z","author_association":"CONTRIBUTOR","body":"@jpountz  Can you look this issue? Thanks. If you need some other information, just tell me.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/636781609","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-636781609","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":636781609,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNjc4MTYwOQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-06-01T10:51:48Z","updated_at":"2020-06-01T10:54:23Z","author_association":"CONTRIBUTOR","body":"I find this issue :\r\n https://issues.apache.org/jira/browse/LUCENE-8017\r\n\r\n![image](https://user-images.githubusercontent.com/5183061/83402235-ed06ef80-a438-11ea-8ffa-9e3320b947ec.png)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/636828112","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-636828112","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":636828112,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNjgyODExMg==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-06-01T12:20:39Z","updated_at":"2020-06-01T12:20:39Z","author_association":"CONTRIBUTOR","body":"In those top class, the FunctionScoreQuery or ScriptQuery would reference the `LeafReaderContext`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/638031646","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-638031646","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":638031646,"node_id":"MDEyOklzc3VlQ29tbWVudDYzODAzMTY0Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-06-03T08:01:31Z","updated_at":"2020-06-03T08:01:31Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Search)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/649717963","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-649717963","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":649717963,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTcxNzk2Mw==","user":{"login":"Bukhtawar","id":12809319,"node_id":"MDQ6VXNlcjEyODA5MzE5","avatar_url":"https://avatars0.githubusercontent.com/u/12809319?v=4","gravatar_id":"","url":"https://api.github.com/users/Bukhtawar","html_url":"https://github.com/Bukhtawar","followers_url":"https://api.github.com/users/Bukhtawar/followers","following_url":"https://api.github.com/users/Bukhtawar/following{/other_user}","gists_url":"https://api.github.com/users/Bukhtawar/gists{/gist_id}","starred_url":"https://api.github.com/users/Bukhtawar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bukhtawar/subscriptions","organizations_url":"https://api.github.com/users/Bukhtawar/orgs","repos_url":"https://api.github.com/users/Bukhtawar/repos","events_url":"https://api.github.com/users/Bukhtawar/events{/privacy}","received_events_url":"https://api.github.com/users/Bukhtawar/received_events","type":"User","site_admin":false},"created_at":"2020-06-25T17:29:09Z","updated_at":"2020-06-25T17:29:09Z","author_association":"CONTRIBUTOR","body":"I have noticed a similar issue in 7.4 as well. I believe this issue is still not fixed. @romseygeek can you please confirm\r\n\r\n\r\n<img width=\"1272\" alt=\"Screenshot 2020-06-25 at 12 53 18 PM\" src=\"https://user-images.githubusercontent.com/12809319/85769056-44963380-b737-11ea-8179-50d3facc06d4.png\">\r\n\r\n\r\n<img width=\"1276\" alt=\"Screenshot 2020-06-25 at 12 59 25 PM\" src=\"https://user-images.githubusercontent.com/12809319/85769076-49f37e00-b737-11ea-92cc-8ed208c70678.png\">\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/660867482","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-660867482","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":660867482,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MDg2NzQ4Mg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T07:56:33Z","updated_at":"2020-07-20T07:56:33Z","author_association":"CONTRIBUTOR","body":"@Bukhtawar This particular issue is fixed in Lucene 8.3/Elasticsearch 7.5.\r\n\r\n@wuyunfeng Sorry for the late response. Your boolean queries are large, they must be indirectly referencing queries that either reference readers or large objects. It might be due to GlobalOrdinalsWithScoreQuery like @Bukhtawar but it might be something else as well. If/when this reproduces, could you look at the queries that your boolean queries are referencing? Upgrading to a more recent version might help too as we fixed a couple bugs that could explain this since 6.5.3 was released.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/660869843","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-660869843","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":660869843,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MDg2OTg0Mw==","user":{"login":"Bukhtawar","id":12809319,"node_id":"MDQ6VXNlcjEyODA5MzE5","avatar_url":"https://avatars0.githubusercontent.com/u/12809319?v=4","gravatar_id":"","url":"https://api.github.com/users/Bukhtawar","html_url":"https://github.com/Bukhtawar","followers_url":"https://api.github.com/users/Bukhtawar/followers","following_url":"https://api.github.com/users/Bukhtawar/following{/other_user}","gists_url":"https://api.github.com/users/Bukhtawar/gists{/gist_id}","starred_url":"https://api.github.com/users/Bukhtawar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bukhtawar/subscriptions","organizations_url":"https://api.github.com/users/Bukhtawar/orgs","repos_url":"https://api.github.com/users/Bukhtawar/repos","events_url":"https://api.github.com/users/Bukhtawar/events{/privacy}","received_events_url":"https://api.github.com/users/Bukhtawar/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T08:01:25Z","updated_at":"2020-07-20T08:01:25Z","author_association":"CONTRIBUTOR","body":"Thanks @jpountz for confirming","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/660951959","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-660951959","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":660951959,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MDk1MTk1OQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T10:45:27Z","updated_at":"2020-07-20T10:46:00Z","author_association":"CONTRIBUTOR","body":"@jpountz  We have a lot of `match` or `match_phrase` query in our `boolean` query, and a `script_score ` for custom scoring, and `aggs` for some field which like below （I just hidden some field name and specified value）:\r\n\r\n```\r\n\r\n{\r\n    \"query\":{\r\n        \"function_score\":{\r\n            \"query\":{\r\n                \"bool\":{\r\n                    \"must\":[\r\n                        {\r\n                            \"bool\":{\r\n                                \"should\":[\r\n                                    {\r\n                                        \"match_phrase\":{\r\n                                            \"fieldEnt.py\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":1\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"fieldEnt.content\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":9,\r\n                                                \"operator\":\"and\",\r\n                                                \"analyzer\":\"ik_max_word\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"fieldRN\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":1,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"scope\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":1,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"addr\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":1,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"fieldP\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":30,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"shareholders\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":10,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"directors\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":20,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"coreNames\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":30,\r\n                                                \"operator\":\"and\",\r\n                                                \"analyzer\":\"ik_max_word\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"keyNames\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":1000,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match_phrase\":{\r\n                                            \"markName\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":10\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"formerNames\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":30,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"projectBrandName\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":50,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match\":{\r\n                                            \"abbrNames\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":200,\r\n                                                \"operator\":\"and\"\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match_phrase\":{\r\n                                            \"siteName\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":5\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match_phrase\":{\r\n                                            \"siteUrl\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":5\r\n                                            }\r\n                                        }\r\n                                    },\r\n                                    {\r\n                                        \"match_phrase\":{\r\n                                            \"icpNo\":{\r\n                                                \"query\":\"Some Value\",\r\n                                                \"boost\":5\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                ]\r\n                            }\r\n                        }\r\n                    ]\r\n                }\r\n            },\r\n            \"script_score\":{\r\n                \"script\":{\r\n                    \"inline\":\"int entweight=10000;if(doc[\\\"weight\\\"].value==1) {entweight=10000;if(doc[\\\"entType\\\"].value==\\\"Some Value\\\") {entweight = entweight - 100;}if(doc[\\\"entType\\\"].value==\\\"Some Value\\\" || doc[\\\"entType\\\"].value==null) {entweight=500;if(doc[\\\"openStatus\\\"].value==\\\"注销\\\" || doc[\\\"openStatus\\\"].value==\\\"Some Value\\\") {entweight=5;}} else if(doc[\\\"openStatus\\\"].value==\\\"Some Value\\\" || doc[\\\"openStatus\\\"].value==\\\"Some Value\\\") {entweight=1000;}if(doc[\\\"weight\\\"].value==4) {entweight=0;}}return  Math.sqrt(doc[\\\"zxScore\\\"].value)*10*8.5 + _score+entweight;\"\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"from\":0,\r\n    \"size\":50,\r\n    \"aggs\":{\r\n        \"provinceCode\":{\r\n            \"terms\":{\r\n                \"field\":\"provinceCode\",\r\n                \"size\":300\r\n            }\r\n        },\r\n        \"regCapLevel\":{\r\n            \"terms\":{\r\n                \"field\":\"regCapLevel\",\r\n                \"size\":300\r\n            }\r\n        },\r\n        \"entType\":{\r\n            \"terms\":{\r\n                \"field\":\"entType\",\r\n                \"size\":300\r\n            }\r\n        },\r\n        \"openStatus\":{\r\n            \"terms\":{\r\n                \"field\":\"openStatus\",\r\n                \"size\":300\r\n            }\r\n        },\r\n        \"startYear\":{\r\n            \"terms\":{\r\n                \"field\":\"startYear\",\r\n                \"size\":300\r\n            }\r\n        },\r\n        \"discredited\":{\r\n            \"terms\":{\r\n                \"field\":\"discredited\",\r\n                \"size\":300\r\n            }\r\n        }\r\n    },\r\n    \"highlight\":{\r\n        \"fields\":[\r\n            {\r\n                \"fieldEnt.content\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"fieldRN\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"fieldP\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"directors\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"addr\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"scope\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"markName\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"shareholders\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"formerNames\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"projectBrandName\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"siteUrl\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"siteName\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"icpNo\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"keyNames\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"coreNames\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            },\r\n            {\r\n                \"abbrNames\":{\r\n                    \"type\":\"unified\"\r\n                }\r\n            }\r\n        ]\r\n    }\r\n}'\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/660953119","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-660953119","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":660953119,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MDk1MzExOQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T10:47:58Z","updated_at":"2020-07-20T10:47:58Z","author_association":"CONTRIBUTOR","body":"In my `MAT` analysis result, I cannot see the `the queries that your boolean queries are referencing`, but I can provide the origin query, does it ok?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661086626","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661086626","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661086626,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTA4NjYyNg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T14:48:09Z","updated_at":"2020-07-20T14:48:09Z","author_association":"CONTRIBUTOR","body":"I don't think that the query you shared is responsible for the memory we're seeing retained by the cache. Even though your queries have many clauses, MAT reports that your boolean queries consume 25MB of heap, which is a lot for a query. So I'd be curious to see what type of queries are used as clauses of these boolean queries. Are some of your indices using parent/child relationships? You might be affected by the same bug as @Bukhtawar.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661092524","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661092524","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661092524,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTA5MjUyNA==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T14:57:58Z","updated_at":"2020-07-20T15:00:24Z","author_association":"CONTRIBUTOR","body":"@jpountz I would confirm that tomorrow, and now  I just know our user maybe using `nested-object` and the `nested query`. After we add more nodes to our ES Cluster, this fullgc have not appear again.  I know `nested-object` use parent-child relation in indexing time, and use `special handling` in query phase like `docid` order in parent and child.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661095096","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661095096","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661095096,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTA5NTA5Ng==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T15:02:18Z","updated_at":"2020-07-20T15:14:52Z","author_association":"CONTRIBUTOR","body":" `consume 25MB of heap ` you means some - the cached `bitset`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661110185","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661110185","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661110185,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTExMDE4NQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T15:27:37Z","updated_at":"2020-07-20T15:27:37Z","author_association":"CONTRIBUTOR","body":"No, I was looking at the \"Accumulated Objects in Dominator Tree\" table that you shared a screenshot of.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661633551","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661633551","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661633551,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTYzMzU1MQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T04:58:13Z","updated_at":"2020-07-21T04:58:43Z","author_association":"CONTRIBUTOR","body":"@jpountz  our user have nested query likes below:\r\n\r\n```\r\n{\r\n   \"query\": {\r\n      \"function_score\": {\r\n         \"query\": {\r\n            \"bool\": {\r\n               \"must\": [\r\n                  {\r\n                     \"nested\": {\r\n                        \"path\": \"eid\",\r\n                        \"query\": {\r\n                           \"bool\": {\r\n                              \"must\": [\r\n                                 {\r\n                                    \"match\": {\r\n                                       \"eid.bdCode\": {\r\n                                          \"query\": \"value\",\r\n                                          \"boost\": 1,\r\n                                          \"operator\": \"and\"\r\n                                       }\r\n                                    }\r\n                                 }\r\n                              ]\r\n                           }\r\n                        }\r\n                     }\r\n                  }\r\n               ]\r\n            }\r\n         },\r\n         \"script_score\": {\r\n            \"script\": {\r\n               \"inline\": \"_score\"\r\n            }\r\n         }\r\n      }\r\n   },\r\n   \"from\": 0,\r\n   \"size\": 10,\r\n   \"aggs\": {\r\n      \"ops\": {\r\n         \"terms\": {\r\n            \"field\": \"opsField\",\r\n            \"size\": 300\r\n         }\r\n      }\r\n   }\r\n}\r\n```\r\nThis query would use `ESToParentBlockJoinQuery(ES)/ToParentBlockJoinQuery(Lucene)`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661637572","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661637572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661637572,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTYzNzU3Mg==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T05:13:13Z","updated_at":"2020-07-21T05:16:03Z","author_association":"CONTRIBUTOR","body":"I noticed this Lucene PR: https://github.com/apache/lucene-solr/pull/963/ ,  some comments add by @jimczi \r\n\r\n```\r\n     // disable caching because this query relies on a top reader context\r\n      // and holds a bitset of matching ordinals that cannot be accounted in\r\n      // the memory used by the cache\r\n```\r\nToParentBlockJoinQuery holds a `BitSetProducer` which cached by ES's `BitsetFilterCache`, `BitsetFilterCache` and `BitSetProducer` would  reference the `readers ` ,is this the reason for our ES cluster `fullgc` periodically?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661725489","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661725489","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661725489,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTcyNTQ4OQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T08:50:32Z","updated_at":"2020-07-21T08:50:32Z","author_association":"CONTRIBUTOR","body":"@wuyunfeng This looks like a likely cause of the problem you are seeing to me.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661728861","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661728861","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661728861,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTcyODg2MQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T08:57:05Z","updated_at":"2020-07-21T08:57:54Z","author_association":"CONTRIBUTOR","body":"@jpountz  the reason is what I mentioned?  and all other query is just some simple `match` or `match_phrase` query.\r\n\r\n> ToParentBlockJoinQuery holds a `BitSetProducer` which cached by ES's `BitsetFilterCache`, `BitsetFilterCache` and `BitSetProducer` would  reference the `readers ` ,is this the reason for our ES cluster `fullgc` periodically?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661731097","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661731097","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661731097,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTczMTA5Nw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T09:01:12Z","updated_at":"2020-07-21T09:01:12Z","author_association":"CONTRIBUTOR","body":"Yes this is correct. I can't be 100% sure but this looks plausible given the symptoms and the query you shared.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661745941","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661745941","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661745941,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTc0NTk0MQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T09:29:25Z","updated_at":"2020-07-21T09:29:25Z","author_association":"CONTRIBUTOR","body":"@jpountz Can we add the same cache policy for `ToParentBlockJoinQuery` like this PR : https://github.com/apache/lucene-solr/pull/963\r\n\r\nI will continue to pay attention all query sent to ES today.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661753806","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661753806","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661753806,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTc1MzgwNg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T09:45:07Z","updated_at":"2020-07-21T09:45:07Z","author_association":"CONTRIBUTOR","body":"@wuyunfeng Sorry I got confused and mixed up issues. I don't think that `ToParentBlockJoinQuery` has a problem. It doesn't directly reference a bitset like `GlobalOrdinals(WithScore)Query`, and the reader keys do not reference the readers (it used to be the case long ago, but this has been fixed in Lucene 7.0/Elasticsearch 6.0).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661768139","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661768139","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661768139,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTc2ODEzOQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T10:14:19Z","updated_at":"2020-07-21T10:14:19Z","author_association":"CONTRIBUTOR","body":"> I will continue to pay attention all query sent to ES today.\r\n\r\nIMO the most efficient strategy would be to further analyze the heap dump next time you get one.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661780959","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661780959","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661780959,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTc4MDk1OQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T10:43:09Z","updated_at":"2020-07-21T11:03:51Z","author_association":"CONTRIBUTOR","body":"@jpountz \r\n\r\n>  I don't think that ToParentBlockJoinQuery has a problem. It doesn't directly reference a bitset like GlobalOrdinals(WithScore)Query\r\n\r\n`ToParentBlockJoinQuery` reference the `parentBits` by `BitsetFilterCache` which cached in `Cache<IndexReader.CacheKey, Cache<Query, Value>> loadedFilters` (not reference any top reader)\r\n\r\n> IMO the most efficient strategy would be to further analyze the heap dump next time you get one.\r\n\r\nOK. I will close this issue .  Do you mind reopening this issue when I get the heap dump next time ?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661782451","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661782451","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661782451,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTc4MjQ1MQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T10:46:45Z","updated_at":"2020-07-21T10:46:45Z","author_association":"CONTRIBUTOR","body":"> but this has been fixed in Lucene 7.0/Elasticsearch 6.0\r\n\r\nCan you share the PR or issue for this bug-fix?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661788691","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661788691","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661788691,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTc4ODY5MQ==","user":{"login":"wuyunfeng","id":5183061,"node_id":"MDQ6VXNlcjUxODMwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/5183061?v=4","gravatar_id":"","url":"https://api.github.com/users/wuyunfeng","html_url":"https://github.com/wuyunfeng","followers_url":"https://api.github.com/users/wuyunfeng/followers","following_url":"https://api.github.com/users/wuyunfeng/following{/other_user}","gists_url":"https://api.github.com/users/wuyunfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/wuyunfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuyunfeng/subscriptions","organizations_url":"https://api.github.com/users/wuyunfeng/orgs","repos_url":"https://api.github.com/users/wuyunfeng/repos","events_url":"https://api.github.com/users/wuyunfeng/events{/privacy}","received_events_url":"https://api.github.com/users/wuyunfeng/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T11:02:13Z","updated_at":"2020-07-21T11:24:55Z","author_association":"CONTRIBUTOR","body":"![image](https://user-images.githubusercontent.com/5183061/88047632-81ade400-cb84-11ea-9e82-013bebd58dbc.png)\r\n\r\nBTW, the long[]  consume almost 20G+ JVM memory, does it is the `bitset`?\r\n\r\n![image](https://user-images.githubusercontent.com/5183061/88047684-94c0b400-cb84-11ea-89a0-35d15b3eeec6.png)\r\n\r\nSegmentReader consume almost 17G+.\r\n\r\nI just confused with this two object `SegmentReader` and `long[]`\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661805876","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-661805876","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":661805876,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTgwNTg3Ng==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2020-07-21T11:43:29Z","updated_at":"2020-07-21T11:43:29Z","author_association":"CONTRIBUTOR","body":"Hard to tell, these long[] could be bitsets, but Lucene and Elasticsearch also use large long[] arrays elsewhere so I wouldn't jump to conclusions.\r\n\r\nMy suspicion is that you're seeing so much RAM usage for SegmentReader because it indirectly points to many of the long[] arrays that are in your heap. This typically happens because caches register listeners on to readers, which makes the readers references all caches.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/713994080","html_url":"https://github.com/elastic/elasticsearch/issues/57400#issuecomment-713994080","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57400","id":713994080,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMzk5NDA4MA==","user":{"login":"arielzach","id":64101789,"node_id":"MDQ6VXNlcjY0MTAxNzg5","avatar_url":"https://avatars0.githubusercontent.com/u/64101789?v=4","gravatar_id":"","url":"https://api.github.com/users/arielzach","html_url":"https://github.com/arielzach","followers_url":"https://api.github.com/users/arielzach/followers","following_url":"https://api.github.com/users/arielzach/following{/other_user}","gists_url":"https://api.github.com/users/arielzach/gists{/gist_id}","starred_url":"https://api.github.com/users/arielzach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arielzach/subscriptions","organizations_url":"https://api.github.com/users/arielzach/orgs","repos_url":"https://api.github.com/users/arielzach/repos","events_url":"https://api.github.com/users/arielzach/events{/privacy}","received_events_url":"https://api.github.com/users/arielzach/received_events","type":"User","site_admin":false},"created_at":"2020-10-21T23:40:42Z","updated_at":"2020-10-21T23:40:42Z","author_association":"NONE","body":"I don't know what state this issue is in but I'm having a similar problem with ES7.8, I'm using the docker version:\r\n\r\ndocker.elastic.co/elasticsearch/elasticsearch:7.8.0\r\n\r\n![image](https://user-images.githubusercontent.com/64101789/96801000-0820ce80-13dd-11eb-81b0-ea10ea1b8e72.png)\r\n![image](https://user-images.githubusercontent.com/64101789/96801050-238bd980-13dd-11eb-8427-d03b09cd71ca.png)\r\n![image](https://user-images.githubusercontent.com/64101789/96801070-2dadd800-13dd-11eb-9688-10170bb431f0.png)\r\n![image](https://user-images.githubusercontent.com/64101789/96801083-37cfd680-13dd-11eb-8568-b90870820407.png)\r\n![image](https://user-images.githubusercontent.com/64101789/96801176-677ede80-13dd-11eb-9e90-fea925d0560d.png)\r\n\r\n@wuyunfeng could you solve this problem?\r\n","performed_via_github_app":null}]