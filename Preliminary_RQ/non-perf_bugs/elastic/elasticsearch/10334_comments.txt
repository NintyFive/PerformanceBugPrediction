[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87975283","html_url":"https://github.com/elastic/elasticsearch/issues/10334#issuecomment-87975283","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10334","id":87975283,"node_id":"MDEyOklzc3VlQ29tbWVudDg3OTc1Mjgz","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-03-31T07:28:36Z","updated_at":"2015-03-31T08:52:14Z","author_association":"MEMBER","body":"@mariusdw This is a bug. Elasticsearch mistakes the `comments` to be a nested object field and in your example it is just an object field.\n\nThis error will be fixed, but your mapping design (an object field that has a nested object field) raises a question. Elasticsearch indexes the `messages` json objects in a special way so that it can be used by nested query, nested sorting, inner hits etc. But the parent field is an object field and no special indexing happens there, so the nested features only work on the `messages` nested level. Is there a special reason why you chose this? It only makes sense if you have a single comment per field, otherwise I sugegst that you change the `comments` field to be of type `nested` too.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88000395","html_url":"https://github.com/elastic/elasticsearch/issues/10334#issuecomment-88000395","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10334","id":88000395,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MDAwMzk1","user":{"login":"mariusdw","id":11732659,"node_id":"MDQ6VXNlcjExNzMyNjU5","avatar_url":"https://avatars2.githubusercontent.com/u/11732659?v=4","gravatar_id":"","url":"https://api.github.com/users/mariusdw","html_url":"https://github.com/mariusdw","followers_url":"https://api.github.com/users/mariusdw/followers","following_url":"https://api.github.com/users/mariusdw/following{/other_user}","gists_url":"https://api.github.com/users/mariusdw/gists{/gist_id}","starred_url":"https://api.github.com/users/mariusdw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mariusdw/subscriptions","organizations_url":"https://api.github.com/users/mariusdw/orgs","repos_url":"https://api.github.com/users/mariusdw/repos","events_url":"https://api.github.com/users/mariusdw/events{/privacy}","received_events_url":"https://api.github.com/users/mariusdw/received_events","type":"User","site_admin":false},"created_at":"2015-03-31T08:54:15Z","updated_at":"2015-03-31T08:54:15Z","author_association":"NONE","body":"Hi Martijn. Thanks for your reply. The example was just to reproduce the issue that I am experiencing with my real data structure. I kind of modified the example given in the elastic documentation to achieve this and maybe in the process of trying to simplify, used an example that isn't \"practical\" :)\n\nMaybe I should rather explain my real data structure. In our system, we store configuration for various hardware devices. There are two levels of settings that can be configured: \n1. Individual settings - settings that apply to an individual device only.\n2. Group settings - settings that apply to all devices unless overridden by an individual setting.\n\nEach configuration server reports these settings (together with some other data) to a central server that stores it as JSON documents in elasticsearch. We then do interesting things like check which percentage of devices that has a certain setting is online etc.\n\nAs there will only ever be one \"group settings\" for all devices of a certain type, I have decided to store this as a simple singular object inside my document. The individual settings for each device is then stored inside this single object as nested documents. \n\nLooking at your answer I think a simple workaround for me for now would be to change the \"group settings\" to also be a nested document. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88241504","html_url":"https://github.com/elastic/elasticsearch/issues/10334#issuecomment-88241504","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10334","id":88241504,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MjQxNTA0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-03-31T20:55:01Z","updated_at":"2015-03-31T20:55:01Z","author_association":"MEMBER","body":"@mariusdw That decision to use object field makes perfect sense. When PR #10353 gets in inner hits will work again with your mapping. \n\nChanging the group settings to nested field will make it work for now, but does increase memory usage (due the fact that you have a nested `nested` field). I suggest that you move back to object field when 1.5.1 gets out.\n","performed_via_github_app":null}]