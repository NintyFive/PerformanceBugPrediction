[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67335739","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-67335739","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":67335739,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzM1NzM5","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2014-12-17T15:12:32Z","updated_at":"2014-12-17T15:12:32Z","author_association":"CONTRIBUTOR","body":"+1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372784996","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-372784996","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":372784996,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjc4NDk5Ng==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T19:12:53Z","updated_at":"2018-03-13T19:12:53Z","author_association":"CONTRIBUTOR","body":"@jpountz Are any of these concerns still relevant?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385032041","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-385032041","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":385032041,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTAzMjA0MQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-04-27T17:00:52Z","updated_at":"2018-04-27T17:00:52Z","author_association":"MEMBER","body":"I think this issue will be addressed by the work in https://github.com/elastic/elasticsearch/pull/29611","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385396542","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-385396542","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":385396542,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTM5NjU0Mg==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T13:23:05Z","updated_at":"2018-04-30T13:23:27Z","author_association":"CONTRIBUTOR","body":"@rjernst @jdconrad  PR #29611 addresses only the 3rd point that Adrien raised here:  \"get returns an empty list instead of null...\"\r\n\r\nThe 1st and 2nd points are still relevant.\r\nIn particular, for the 2nd point 500 is thrown for `doc['missing_field']?.value`\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385398751","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-385398751","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":385398751,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTM5ODc1MQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T13:31:34Z","updated_at":"2018-04-30T13:31:34Z","author_association":"CONTRIBUTOR","body":"The whole \"throw an exception on unmapped field\" behavior has grown on me somewhat. It is a little funky to because it isn't like any other map, but it is kind of useful to know that a field isn't mapped at all rather than if it doesn't have a value.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385418306","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-385418306","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":385418306,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTQxODMwNg==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T14:38:57Z","updated_at":"2018-04-30T14:39:39Z","author_association":"CONTRIBUTOR","body":"Currently with PR #29611:\r\n1. `doc['mapped_field_no_value']` returns `null`\r\n2. `doc['unmapped_field']` throws 500.\r\n \r\nI understand @nik9000 suggestion to distinguish between these cases, and don't return `null` for the 2nd case.\r\n\r\nBut I think it is incorrect to throw 500 Internal Server Error for the incorrect user action.  For the unmapped field case,  we can instead return `400 BAD_REQUEST` or `404 NOT_FOUND`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385425999","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-385425999","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":385425999,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTQyNTk5OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T15:02:21Z","updated_at":"2018-04-30T15:02:21Z","author_association":"MEMBER","body":"> doc['unmapped_field'] throws 500\r\n\r\nAre you sure? It throws an IllegalArgumentException, which should map to a 400.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385463980","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-385463980","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":385463980,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTQ2Mzk4MA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T17:09:22Z","updated_at":"2018-04-30T17:09:22Z","author_association":"CONTRIBUTOR","body":"@rjernst  Thanks, Ryan.  I see in the code `IllegalArgumentException`, but at the end a user will get 500 :\r\n\r\nThe following query:\r\n```json\r\nGET  index-script/_search\r\n {\r\n\t\"query\" : {\r\n\t\t\t\"match_all\" : {} \r\n\t },\r\n\t \"script_fields\" : {\r\n\t\t \"fvalue\" : {\r\n\t\t\t \"script\" : {\r\n\t\t\t\t \"source\" : \"doc['unmapped_field'].value\"\r\n\t\t\t }\r\n\t\t }\r\n       }\r\n}\r\n```\r\nreturns:\r\n\r\n< HTTP/1.1 500 Internal Server Error\r\n< content-type: application/json; charset=UTF-8\r\n\r\n```java\r\n{\r\n\t\"error\": {\r\n\t\t\"root_cause\": [\r\n\t\t\t{\r\n\t\t\t\t\"type\": \"script_exception\",\r\n\t\t\t\t\"reason\": \"runtime error\",\r\n\t\t\t\t\"script_stack\": [\r\n\t\t\t\t\t\"org.elasticsearch.search.lookup.LeafDocLookup.get(LeafDocLookup.java:81)\",\r\n\t\t\t\t\t\"org.elasticsearch.search.lookup.LeafDocLookup.get(LeafDocLookup.java:39)\",\r\n\t\t\t\t\t\"doc['unmapped_field'].value\",\r\n\t\t\t\t\t\"    ^---- HERE\"\r\n\t\t\t\t],\r\n\t\t\t\t\"script\": \"doc['unmapped_field'].value\",\r\n\t\t\t\t\"lang\": \"painless\"\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"type\": \"search_phase_execution_exception\",\r\n\t\t\"reason\": \"all shards failed\",\r\n\t\t\"phase\": \"query\",\r\n\t\t\"grouped\": true,\r\n\t\t\"failed_shards\": [\r\n\t\t\t{\r\n\t\t\t\t\"shard\": 0,\r\n\t\t\t\t\"index\": \"index-script\",\r\n\t\t\t\t\"node\": \"mTG3MInFRD2Y4KnePrO-Xw\",\r\n\t\t\t\t\"reason\": {\r\n\t\t\t\t\t\"type\": \"script_exception\",\r\n\t\t\t\t\t\"reason\": \"runtime error\",\r\n\t\t\t\t\t\"script_stack\": [\r\n\t\t\t\t\t\t\"org.elasticsearch.search.lookup.LeafDocLookup.get(LeafDocLookup.java:81)\",\r\n\t\t\t\t\t\t\"org.elasticsearch.search.lookup.LeafDocLookup.get(LeafDocLookup.java:39)\",\r\n\t\t\t\t\t\t\"doc['unmapped_field'].value\",\r\n\t\t\t\t\t\t\"    ^---- HERE\"\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"script\": \"doc['unmapped_field'].value\",\r\n\t\t\t\t\t\"lang\": \"painless\",\r\n\t\t\t\t\t\"caused_by\": {\r\n\t\t\t\t\t\t\"type\": \"illegal_argument_exception\",\r\n\t\t\t\t\t\t\"reason\": \"No field found for [unmapped_field] in mapping with types []\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t\"status\": 500\r\n}\r\n```\r\n\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385467106","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-385467106","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":385467106,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTQ2NzEwNg==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T17:20:18Z","updated_at":"2018-04-30T17:20:18Z","author_association":"CONTRIBUTOR","body":"Seems like it should be a 400 for an IllegalArgumentException, maybe we should consider using an exception type that does output a 400 for these cases.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385512883","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-385512883","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":385512883,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTUxMjg4Mw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T20:06:12Z","updated_at":"2018-04-30T20:06:12Z","author_association":"MEMBER","body":"The 500 is because SearchPhaseExecutionException assumes any shard failure is a 500. I think that needs to be (separately) fixed. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577842576","html_url":"https://github.com/elastic/elasticsearch/issues/8990#issuecomment-577842576","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8990","id":577842576,"node_id":"MDEyOklzc3VlQ29tbWVudDU3Nzg0MjU3Ng==","user":{"login":"stu-elastic","id":24232742,"node_id":"MDQ6VXNlcjI0MjMyNzQy","avatar_url":"https://avatars0.githubusercontent.com/u/24232742?v=4","gravatar_id":"","url":"https://api.github.com/users/stu-elastic","html_url":"https://github.com/stu-elastic","followers_url":"https://api.github.com/users/stu-elastic/followers","following_url":"https://api.github.com/users/stu-elastic/following{/other_user}","gists_url":"https://api.github.com/users/stu-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/stu-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stu-elastic/subscriptions","organizations_url":"https://api.github.com/users/stu-elastic/orgs","repos_url":"https://api.github.com/users/stu-elastic/repos","events_url":"https://api.github.com/users/stu-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/stu-elastic/received_events","type":"User","site_admin":false},"created_at":"2020-01-23T19:42:05Z","updated_at":"2020-01-23T19:42:05Z","author_association":"CONTRIBUTOR","body":"> containsKey only looks at the mappings regardless of the current document\r\n\r\nIf we don't have a mapping for the field, the current document can't have the field.  We cannot get an accessor for the field otherwise.\r\n\r\n> get throws an exception if the field is not mapped (should it return null instead?)\r\n\r\nThis is desired behavior and allows user to differentiate between missing value and unmapped.  It is not \"mappy\" behavior, agreed.  We should change the type to something other than `Map`.  See: https://github.com/elastic/elasticsearch/issues/51373\r\n\r\n> get returns an empty list instead of null if the document has no values (while fielddata has the ability to know if a given field exists in a particular document)\r\n\r\nThis is fixed by https://github.com/elastic/elasticsearch/pull/29611\r\n\r\n> doc['unmapped_field'] throws 500.\r\n\r\nPushed to https://github.com/elastic/elasticsearch/issues/51371\r\n","performed_via_github_app":null}]