[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/121583139","html_url":"https://github.com/elastic/elasticsearch/issues/12254#issuecomment-121583139","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12254","id":121583139,"node_id":"MDEyOklzc3VlQ29tbWVudDEyMTU4MzEzOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-07-15T11:03:35Z","updated_at":"2015-07-15T11:03:35Z","author_association":"CONTRIBUTOR","body":"@martijnvg any ideas here?\n\n@ppf2 as a side note, this is a particularly poor way to use warmers.  Just sorting on `listprice` would have the same effect, or updating the mapping for the field to (eg) load global ordinals eagerly.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/121667323","html_url":"https://github.com/elastic/elasticsearch/issues/12254#issuecomment-121667323","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12254","id":121667323,"node_id":"MDEyOklzc3VlQ29tbWVudDEyMTY2NzMyMw==","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2015-07-15T16:22:23Z","updated_at":"2015-07-15T16:22:23Z","author_association":"MEMBER","body":"@clintongormley btw, the repro is really just for quick demonstration purposes using groovy equivalent, the end user actually has a more elaborate native script being used which is not getting executed by the warmer.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/122237818","html_url":"https://github.com/elastic/elasticsearch/issues/12254#issuecomment-122237818","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12254","id":122237818,"node_id":"MDEyOklzc3VlQ29tbWVudDEyMjIzNzgxOA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-07-17T10:22:38Z","updated_at":"2015-07-17T10:22:38Z","author_association":"MEMBER","body":"warmers queries are executed with search_type=count if no sort is specified and therefor scores are never computed. The function_score scripts are only invoked if scores are computed, so that is why the script doesn't get invoked during warming.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/122238206","html_url":"https://github.com/elastic/elasticsearch/issues/12254#issuecomment-122238206","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12254","id":122238206,"node_id":"MDEyOklzc3VlQ29tbWVudDEyMjIzODIwNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-07-17T10:23:52Z","updated_at":"2015-07-17T10:23:52Z","author_association":"CONTRIBUTOR","body":"thanks @martijnvg - sounds like this should be documented\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/122366276","html_url":"https://github.com/elastic/elasticsearch/issues/12254#issuecomment-122366276","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12254","id":122366276,"node_id":"MDEyOklzc3VlQ29tbWVudDEyMjM2NjI3Ng==","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2015-07-17T18:28:53Z","updated_at":"2015-07-17T18:28:53Z","author_association":"MEMBER","body":"```\n  \"sort\": [\n    {\n      \"_score\": {\n        \"order\": \"desc\"\n      }\n    }\n  ]\n```\n\nThanks for the feedback.  Per comments above, I attempted a fix by adding an explicit sort to the _score.\n\nThe results are:\n1.  At the time the put warmer is called with the sort in place, it fires the script successfully\n2.  But when the node is restarted, the warmer still does not execute the script.\n\nI discussed with @martijnvg , it sounds like there is actually a bug here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/167038763","html_url":"https://github.com/elastic/elasticsearch/issues/12254#issuecomment-167038763","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12254","id":167038763,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NzAzODc2Mw==","user":{"login":"masaruh","id":572174,"node_id":"MDQ6VXNlcjU3MjE3NA==","avatar_url":"https://avatars3.githubusercontent.com/u/572174?v=4","gravatar_id":"","url":"https://api.github.com/users/masaruh","html_url":"https://github.com/masaruh","followers_url":"https://api.github.com/users/masaruh/followers","following_url":"https://api.github.com/users/masaruh/following{/other_user}","gists_url":"https://api.github.com/users/masaruh/gists{/gist_id}","starred_url":"https://api.github.com/users/masaruh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/masaruh/subscriptions","organizations_url":"https://api.github.com/users/masaruh/orgs","repos_url":"https://api.github.com/users/masaruh/repos","events_url":"https://api.github.com/users/masaruh/events{/privacy}","received_events_url":"https://api.github.com/users/masaruh/received_events","type":"User","site_admin":false},"created_at":"2015-12-24T04:09:43Z","updated_at":"2015-12-24T04:09:43Z","author_association":"CONTRIBUTOR","body":"I think I found the cause. While it's parsing `sort` part, it omits sorting if query has one sort criteria and if it's sorting on `_score` in descending order (https://github.com/elastic/elasticsearch/blob/v2.1.1/core/src/main/java/org/elasticsearch/search/sort/SortParseElement.java#L101-L117). Then, SearchService thinks it doesn't have sort and changes query to size=0 (https://github.com/elastic/elasticsearch/blob/v2.1.1/core/src/main/java/org/elasticsearch/search/SearchService.java#L1148-L1153).\n\nSo, if you change the sort part from `desc` to `asc`, the script will be executed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170382385","html_url":"https://github.com/elastic/elasticsearch/issues/12254#issuecomment-170382385","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12254","id":170382385,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDM4MjM4NQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-10T19:05:52Z","updated_at":"2016-01-10T19:05:52Z","author_association":"CONTRIBUTOR","body":"Warmers have been removed. Closing\n","performed_via_github_app":null}]