{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45672","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45672/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45672/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45672/events","html_url":"https://github.com/elastic/elasticsearch/issues/45672","id":481743762,"node_id":"MDU6SXNzdWU0ODE3NDM3NjI=","number":45672,"title":"Error about injecting contructor after upgrading indexes from 2.4.6 to 5.0/5.1.2","user":{"login":"rgarcia6520","id":31358002,"node_id":"MDQ6VXNlcjMxMzU4MDAy","avatar_url":"https://avatars1.githubusercontent.com/u/31358002?v=4","gravatar_id":"","url":"https://api.github.com/users/rgarcia6520","html_url":"https://github.com/rgarcia6520","followers_url":"https://api.github.com/users/rgarcia6520/followers","following_url":"https://api.github.com/users/rgarcia6520/following{/other_user}","gists_url":"https://api.github.com/users/rgarcia6520/gists{/gist_id}","starred_url":"https://api.github.com/users/rgarcia6520/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rgarcia6520/subscriptions","organizations_url":"https://api.github.com/users/rgarcia6520/orgs","repos_url":"https://api.github.com/users/rgarcia6520/repos","events_url":"https://api.github.com/users/rgarcia6520/events{/privacy}","received_events_url":"https://api.github.com/users/rgarcia6520/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-08-16T19:03:25Z","updated_at":"2019-08-19T10:14:02Z","closed_at":"2019-08-19T10:14:01Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** 2.4.6\r\n\r\n**Plugins installed**: [elasticsearch-migration]\r\n\r\n**JVM version** openjdk 1.8.0_141\r\n\r\n**OS version** Linux 64b5280735b3 3.13.0-168-generic #218-Ubuntu\r\n(Elasticsearch official docker container Elasticsearch:2)\r\n\r\nUpgrading cluster from 2.4.6 to 5.0, indices are confirmed as 2.X indices from the upgrade-assistant plugin. When starting cluster using existing graylog2 indices, we get an error about \"Injecting Constructor\" and elasitcsearch is unable to fully start.\r\n\r\nWhat we expect to see happen:\r\nStart cluster with 2.X indices on version 5.0.4 and see successful imports of indices and initialization of cluster.\r\n\r\nLogs from error and cluster:\r\n4) Error injecting constructor, java.lang.IllegalStateException: unable to upgrade the mappings for the index [[graylog2_12/Xljr968HSfatfnjqYPxY2g]]\r\n  at org.elasticsearch.gateway.GatewayMetaState.<init>(Unknown Source)\r\n  while locating org.elasticsearch.gateway.GatewayMetaState\r\n    for parameter 4 at org.elasticsearch.gateway.GatewayService.<init>(Unknown Source)\r\n  while locating org.elasticsearch.gateway.GatewayService\r\n\r\ncurl -XGET 'http://HOST:9200/graylog2_12/_mapping' \r\n{\"graylog2_12\":{\"mappings\":{\"message\":{\"_source\":{\"compress\":true},\"_timestamp\":{},\"_ttl\":{\"enabled\":true},\"dynamic_templates\":[{\"store_generic\":{\"mapping\":{\"index\":\"not_analyzed\"},\"match\":\"*\"}}],\"properties\":{\"drupaluid\":{\"type\":\"long\"},\"facility\":{\"type\":\"string\",\"index\":\"not_analyzed\"},\"full_message\":{\"type\":\"string\",\"analyzer\":\"standard\"},\"gl2_remote_ip\":{\"type\":\"string\",\"index\":\"not_analyzed\"},\"gl2_remote_port\":{\"type\":\"long\"},\"gl2_source_input\":{\"type\":\"string\",\"index\":\"not_analyzed\"},\"gl2_source_node\":{\"type\":\"string\",\"index\":\"not_analyzed\"},\"level\":{\"type\":\"long\"},\"message\":{\"type\":\"string\",\"analyzer\":\"standard\"},\"remoteip\":{\"type\":\"string\",\"index\":\"not_analyzed\"},\"source\":{\"type\":\"string\",\"analyzer\":\"analyzer_keyword\"},\"streams\":{\"type\":\"string\",\"index\":\"not_analyzed\"},\"timestamp\":{\"type\":\"date\",\"doc_values\":true,\"format\":\"epoch_millis||yyyy-MM-dd HH:mm:ss.SSS\"},\"wdmessage\":{\"type\":\"string\",\"index\":\"not_analyzed\"},\"wdtype\":{\"type\":\"string\",\"index\":\"not_analyzed\"}}}}}}\r\n","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}