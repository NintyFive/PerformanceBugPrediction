[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416198738","html_url":"https://github.com/elastic/elasticsearch/issues/33145#issuecomment-416198738","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33145","id":416198738,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjE5ODczOA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T11:38:20Z","updated_at":"2018-08-27T11:38:49Z","author_association":"CONTRIBUTOR","body":"@ddorian Can you please elaborate on what exactly are you suggesting as an optimization?\r\nI get it is something related to disabling global ordinals in the case of a join relation, but I cannot fathom exactly for what field to disable global ordinals for and in which case that is supposed to improve performance.\r\n\r\nHint: An example would go a long way!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416199679","html_url":"https://github.com/elastic/elasticsearch/issues/33145#issuecomment-416199679","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33145","id":416199679,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjE5OTY3OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T11:42:40Z","updated_at":"2018-08-27T11:42:40Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416205586","html_url":"https://github.com/elastic/elasticsearch/issues/33145#issuecomment-416205586","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33145","id":416205586,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjIwNTU4Ng==","user":{"login":"ddorian","id":1592898,"node_id":"MDQ6VXNlcjE1OTI4OTg=","avatar_url":"https://avatars3.githubusercontent.com/u/1592898?v=4","gravatar_id":"","url":"https://api.github.com/users/ddorian","html_url":"https://github.com/ddorian","followers_url":"https://api.github.com/users/ddorian/followers","following_url":"https://api.github.com/users/ddorian/following{/other_user}","gists_url":"https://api.github.com/users/ddorian/gists{/gist_id}","starred_url":"https://api.github.com/users/ddorian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ddorian/subscriptions","organizations_url":"https://api.github.com/users/ddorian/orgs","repos_url":"https://api.github.com/users/ddorian/repos","events_url":"https://api.github.com/users/ddorian/events{/privacy}","received_events_url":"https://api.github.com/users/ddorian/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T12:08:33Z","updated_at":"2018-08-27T12:08:33Z","author_association":"NONE","body":"@albertzaharovits in cases where the _id you're joining is a `number` since aggregations on `number` don't need global ordinals.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416206340","html_url":"https://github.com/elastic/elasticsearch/issues/33145#issuecomment-416206340","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33145","id":416206340,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjIwNjM0MA==","user":{"login":"ddorian","id":1592898,"node_id":"MDQ6VXNlcjE1OTI4OTg=","avatar_url":"https://avatars3.githubusercontent.com/u/1592898?v=4","gravatar_id":"","url":"https://api.github.com/users/ddorian","html_url":"https://github.com/ddorian","followers_url":"https://api.github.com/users/ddorian/followers","following_url":"https://api.github.com/users/ddorian/following{/other_user}","gists_url":"https://api.github.com/users/ddorian/gists{/gist_id}","starred_url":"https://api.github.com/users/ddorian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ddorian/subscriptions","organizations_url":"https://api.github.com/users/ddorian/orgs","repos_url":"https://api.github.com/users/ddorian/repos","events_url":"https://api.github.com/users/ddorian/events{/privacy}","received_events_url":"https://api.github.com/users/ddorian/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T12:11:50Z","updated_at":"2018-08-27T12:11:50Z","author_association":"NONE","body":"From the docs\r\nquestion parent:\r\n```\r\nPUT my_index/_doc/1?refresh\r\n{\r\n  \"text\": \"This is a question\",\r\n  \"my_join_field\": \"question\" \r\n}\r\n```\r\nanswer child:\r\n```\r\nPUT my_index/_doc/3?routing=1&refresh \r\n{\r\n  \"text\": \"This is an answer\",\r\n  \"my_join_field\": {\r\n    \"name\": \"answer\", \r\n    \"parent\": \"1\" \r\n  }\r\n}\r\n```\r\n\r\nWe can set an option, that guarantees that all `_id` are `number`, and then don't use global-ordinals on the join field.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416324567","html_url":"https://github.com/elastic/elasticsearch/issues/33145#issuecomment-416324567","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33145","id":416324567,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjMyNDU2Nw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T18:36:11Z","updated_at":"2018-08-27T18:36:11Z","author_association":"MEMBER","body":"That's an interesting idea but `global ordinals` are also used because they provide a dense mapping. \r\nFor queries for instance we use a bitset to record the global ordinals of the parent that matches the query and then use this bitset to filter children. Without a dense mapping we'd need to use a `Set` to record the `Integer` (assuming that the ids are integers) and this would require a lot of memory if the query matches a lot of parents. The advantage of global ordinals is that they are shared so we don't need to use a `Set` or remaps integers to a dense mapping on a per query basis. If you want to avoid using global ordinals you can force merge your index to 1 segment. Indices with a single segment  use the segment ordinals (computed on flush) directly. Though force merging should only be used if you don't update documents so it is a good fit for time based indices (append-only case).\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416337301","html_url":"https://github.com/elastic/elasticsearch/issues/33145#issuecomment-416337301","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33145","id":416337301,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjMzNzMwMQ==","user":{"login":"ddorian","id":1592898,"node_id":"MDQ6VXNlcjE1OTI4OTg=","avatar_url":"https://avatars3.githubusercontent.com/u/1592898?v=4","gravatar_id":"","url":"https://api.github.com/users/ddorian","html_url":"https://github.com/ddorian","followers_url":"https://api.github.com/users/ddorian/followers","following_url":"https://api.github.com/users/ddorian/following{/other_user}","gists_url":"https://api.github.com/users/ddorian/gists{/gist_id}","starred_url":"https://api.github.com/users/ddorian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ddorian/subscriptions","organizations_url":"https://api.github.com/users/ddorian/orgs","repos_url":"https://api.github.com/users/ddorian/repos","events_url":"https://api.github.com/users/ddorian/events{/privacy}","received_events_url":"https://api.github.com/users/ddorian/received_events","type":"User","site_admin":false},"created_at":"2018-08-27T19:17:44Z","updated_at":"2018-08-27T19:17:44Z","author_association":"NONE","body":"Hmmm, this maybe can be fixed with a per-shard dictionary. \r\nDon't know how that works and it's cons.\r\n\r\nHave no other idea for now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423078394","html_url":"https://github.com/elastic/elasticsearch/issues/33145#issuecomment-423078394","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33145","id":423078394,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzA3ODM5NA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T07:50:57Z","updated_at":"2018-09-20T07:50:57Z","author_association":"MEMBER","body":"> Have no other idea for now.\r\n\r\nI am closing this issue for now since global ordinals are a lightweight per-shard dictionary that work for all type of ids. Switching to different implementations based on the type of the ids would complicate the code and is not guaranteed to be faster. ","performed_via_github_app":null}]