[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/387150786","html_url":"https://github.com/elastic/elasticsearch/issues/29725#issuecomment-387150786","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29725","id":387150786,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzE1MDc4Ng==","user":{"login":"cmcconnell1","id":14812439,"node_id":"MDQ6VXNlcjE0ODEyNDM5","avatar_url":"https://avatars3.githubusercontent.com/u/14812439?v=4","gravatar_id":"","url":"https://api.github.com/users/cmcconnell1","html_url":"https://github.com/cmcconnell1","followers_url":"https://api.github.com/users/cmcconnell1/followers","following_url":"https://api.github.com/users/cmcconnell1/following{/other_user}","gists_url":"https://api.github.com/users/cmcconnell1/gists{/gist_id}","starred_url":"https://api.github.com/users/cmcconnell1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmcconnell1/subscriptions","organizations_url":"https://api.github.com/users/cmcconnell1/orgs","repos_url":"https://api.github.com/users/cmcconnell1/repos","events_url":"https://api.github.com/users/cmcconnell1/events{/privacy}","received_events_url":"https://api.github.com/users/cmcconnell1/received_events","type":"User","site_admin":false},"created_at":"2018-05-07T18:02:09Z","updated_at":"2018-05-07T18:02:09Z","author_association":"NONE","body":"Thanks for creating this issue.\r\nWe too want to define/create roles with as minimal access as possible.\r\nIn this case, specifically for automated snapshots only.\r\n\r\nI've read the ES docs, but not seeing what I think we need:\r\nref: https://www.elastic.co/guide/en/x-pack/6.2/defining-roles.html\r\nref: https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-roles.html\r\n\r\nWhat I did find on search-guard (third party plugin) doc site makes sense to me:\r\nref: https://docs.search-guard.com/latest/snapshot-restore\r\n\r\n> Required permissions\r\n> A role definition in roles.yml which allows snapshot and restore operations on all indices looks like:\r\n\r\n```\r\nsg_snapshot_restore:\r\n  cluster:\r\n    - cluster:admin/repository/put\r\n    - cluster:admin/repository/get\r\n    - cluster:admin/snapshot/status\r\n    - cluster:admin/snapshot/get\r\n    - cluster:admin/snapshot/create\r\n    - cluster:admin/snapshot/restore\r\n    - cluster:admin/snapshot/delete\r\n  indices:\r\n    '*':\r\n      '*':\r\n        - indices:data/write/index\r\n        - indices:admin/create\r\n```\r\n\r\nIt would be ideal to have a documented official Elastic doc/procedure in which we could create roles (via yaml files as shown above, etc.) as needed.  \r\n\r\nOn that note, similar to [AWS IAM creds policy validator,](https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_testing-policies.html) it would be extremely helpful to have a method of determining all requisite cred's for specific access/commands, etc.\r\n\r\nThanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/387902409","html_url":"https://github.com/elastic/elasticsearch/issues/29725#issuecomment-387902409","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29725","id":387902409,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzkwMjQwOQ==","user":{"login":"cmcconnell1","id":14812439,"node_id":"MDQ6VXNlcjE0ODEyNDM5","avatar_url":"https://avatars3.githubusercontent.com/u/14812439?v=4","gravatar_id":"","url":"https://api.github.com/users/cmcconnell1","html_url":"https://github.com/cmcconnell1","followers_url":"https://api.github.com/users/cmcconnell1/followers","following_url":"https://api.github.com/users/cmcconnell1/following{/other_user}","gists_url":"https://api.github.com/users/cmcconnell1/gists{/gist_id}","starred_url":"https://api.github.com/users/cmcconnell1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmcconnell1/subscriptions","organizations_url":"https://api.github.com/users/cmcconnell1/orgs","repos_url":"https://api.github.com/users/cmcconnell1/repos","events_url":"https://api.github.com/users/cmcconnell1/events{/privacy}","received_events_url":"https://api.github.com/users/cmcconnell1/received_events","type":"User","site_admin":false},"created_at":"2018-05-09T23:12:44Z","updated_at":"2018-05-09T23:12:44Z","author_association":"NONE","body":"Ran this by Elastic support and got the below validation / elastic API command and the reference to this issue.\r\n\r\nHopefully the below saves others some time as it wasn't clear to me what specific cred's and syntax were required for creating a snapshots user/role.\r\n```\r\n# create custom role allowing all creds/permissions for snapshots\r\nPOST /_xpack/security/role/manage_snapshots\r\n{\r\n  \"cluster\": [ \"cluster:admin/repository/put\",\"cluster:admin/repository/get\",\"cluster:admin/snapshot/status\",\"cluster:admin/snapshot/get\",\"cluster:admin/snapshot/create\",\"cluster:admin/snapshot/restore\",\"cluster:admin/snapshot/delete\"],\r\n  \"indices\": [\r\n    {\r\n      \"names\": [ \"*\" ],\r\n      \"privileges\": [\"write\",\"read\",\"create\"]\r\n}\r\n  ]\r\n}\r\n```\r\n\r\nIt would be very helpful to have requisite cred's like the above documented in the ES snapshot/roles docs.\r\nI searched. but didn't find anything in the docs.\r\n\r\nThanks!  ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/512167058","html_url":"https://github.com/elastic/elasticsearch/issues/29725#issuecomment-512167058","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29725","id":512167058,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjE2NzA1OA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T08:58:24Z","updated_at":"2019-07-17T08:58:24Z","author_association":"CONTRIBUTOR","body":"In 6.7 (https://github.com/elastic/elasticsearch/pull/35820) we have added a cluster-level privilege named `create_snapshot`. In addition, we have also introduced a reserved role named `snapshot_user`. The cluster privilege grants permissions to create and view snapshots. The role packs together index privileges with the `create_snapshot` cluster privilege, such that the user can also view the indices it is snapshotting. \r\n\r\nSee also:\r\nhttps://www.elastic.co/guide/en/elastic-stack-overview/current/built-in-roles.html\r\nhttps://www.elastic.co/guide/en/elastic-stack-overview/current/security-privileges.html","performed_via_github_app":null}]