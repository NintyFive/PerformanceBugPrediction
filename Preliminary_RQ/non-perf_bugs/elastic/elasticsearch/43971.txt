{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43971","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43971/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43971/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43971/events","html_url":"https://github.com/elastic/elasticsearch/issues/43971","id":464203486,"node_id":"MDU6SXNzdWU0NjQyMDM0ODY=","number":43971,"title":"Resolve fallout from version bumps in CI","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2019-07-04T10:58:12Z","updated_at":"2020-11-11T21:48:41Z","closed_at":"2019-09-27T07:23:08Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"## The Problem \r\n\r\nDepending on the order in which versions are bumped on different branches, we could be getting build failures when checking out and building BWC versions. \r\n\r\nUnreleased versions are mapped  to branches and asserted that the version produced there is the one we are expecting. \r\nIf  this version was bumped on the current branch but not on the BWC branch or the other way around, these won't match up and the build will fail with a message similar to:\r\n```\r\n02:28:09 > Building 7.3.0 didn't generate expected file /private/var/lib/jenkins/workspace/elastic+elasticsearch+master+multijob-darwin-compatibility/distribution/bwc/minor/build/bwc/checkout-7.x/distribution/archives/darwin-tar/build/distributions/elasticsearch-7.3.0-SNAPSHOT-darwin-x86_64.tar.gz\r\n```\r\n\r\nWe don't want these failures on intake and all the notifications that go with it.\r\n\r\n## Periodic jobs\r\n\r\nFor periodic jobs that use \"lat good commit\"  we fix the revision of BWC versions that we need to check out too, so we shouldn't run into this problem there even if a version bump happens between when the intake job( that sets last good commit ) and the periodic job runs.\r\nThis however seems broken as there were failures recently despite this mechanism: \r\n```\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-darwin-compatibility/62/console\r\n```\r\nThe build was using last good commit ( from the logs):\r\n```\r\n02:19:39 runbld>>> Using last successful commit e84a79a from the job elastic+elasticsearch+master+intake with the build id 20190703181815-589A85DE that was started at 2019-07-03T18:18:17.190Z and finished 1m 16s ago\r\n02:19:39 runbld>>> BUILD_METADATA found in Elasticsearch.\r\n02:19:39 runbld>>> BUILD_METADATA: bwc_refspec_distribution:bwc:bugfix=7c9aa15746b1bf48740df2390bb3066b59148832;bwc_refspec_distribution:bwc:minor=553f783e735b24a5eea3730d3ce97c7af74bfcc2\r\n02:19:39 runbld>>> >>>>>>>>>>>> SCRIPT EXECUTION BEGIN >>>>>>>>>>>>\r\n```\r\n\r\nWe need to look at and fix this.\r\n\r\n## PR checks \r\n\r\nPr checks on branches that didn't merge the version bump in will fail in a similar way.\r\n\r\n## Leniency \r\n\r\nWe could be lenient and allow a one off error when comparing versions ( e.x. accept 7.4 when we were expecting 7.3 ), but that should be considered only as a last resort. ","closed_by":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"performed_via_github_app":null}