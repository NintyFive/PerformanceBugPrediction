{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/198","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/198/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/198/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/198/events","html_url":"https://github.com/elastic/elasticsearch/issues/198","id":208520,"node_id":"MDU6SXNzdWUyMDg1MjA=","number":198,"title":"Occassionally, queries return results from the wrong index","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2010-05-28T08:36:24Z","updated_at":"2011-07-27T16:59:15Z","closed_at":"2011-07-27T16:59:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hiya\n\nSee the query below - I query the alias `ia_object` which points to the index `ia_object_1274409377`, for objects of type `notice`, but the resuts returned include results from my other index `iannounce_object_1274399922` of types other than `notice`.\n\nI'm wondering if one node has dispatched the query, then picked up the wrong resultset?\n\n```\ncurl -XGET 'http://idb2:9200/ia_object/notice/_search?search_type=dfs_query_then_fetch'  -d '\n{\n   \"sort\" : [\n      {\n         \"score\" : \"desc\"\n      }\n   ],\n   \"fields\" : [],\n   \"from\" : 0,\n   \"query\" : {\n      \"filtered\" : {\n         \"filter\" : {\n            \"bool\" : {\n               \"must\" : [\n                  {\n                     \"term\" : {\n                        \"sub_type\" : \"engagement\"\n                     }\n                  },\n                  {\n                     \"term\" : {\n                        \"status\" : \"active\"\n                     }\n                  },\n                  {\n                     \"term\" : {\n                        \"location_id\" : \"40\"\n                     }\n                  }\n               ]\n            }\n         },\n         \"query\" : {\n            \"dis_max\" : {\n               \"queries\" : [\n                  {\n                     \"query_string\" : {\n                        \"fields\" : [\n                           \"name\"\n                        ],\n                        \"boost\" : 1,\n                        \"query\" : \"\\\"David Mcgeoch\\\"~7\"\n                     }\n                  },\n                  {\n                     \"filtered\" : {\n                        \"filter\" : {\n                           \"term\" : {\n                              \"has_name\" : \"0\"\n                           }\n                        },\n                        \"query\" : {\n                           \"query_string\" : {\n                              \"fields\" : [\n                                 \"text\"\n                              ],\n                              \"boost\" : 1.3,\n                              \"query\" : \"\\\"David Mcgeoch\\\"~7\"\n                           }\n                        }\n                     }\n                  },\n                  {\n                     \"query_string\" : {\n                        \"boost\" : 1,\n                        \"query\" : \"David Mcgeoch\"\n                     }\n                  }\n               ],\n               \"tie_breaker\" : 0.7\n            }\n         }\n      }\n   },\n   \"size\" : 300\n}\n'\n# {\n#    \"hits\" : {\n#       \"hits\" : [\n#          {\n#             \"_index\" : \"iannounce_object_1274399922\",\n#             \"_id\" : \"3686897\",\n#             \"_type\" : \"memorial\"\n#          },\n#          {\n#             \"_index\" : \"ia_object_1274409377\",\n#             \"_id\" : \"1336845\",\n#             \"_type\" : \"notice\"\n#          },\n#          {\n#             \"_index\" : \"iannounce_object_1274399922\",\n#             \"_id\" : \"2081719\",\n#             \"_type\" : \"memorial\"\n#          },\n#          {\n#             \"_index\" : \"iannounce_object_1274399922\",\n#             \"_id\" : \"384424\",\n#             \"_type\" : \"memorial\"\n#          },\n#          {\n#             \"_index\" : \"iannounce_object_1274399922\",\n#             \"_id\" : \"234160\",\n#             \"_type\" : \"memorial\"\n#          },\n#          {\n#             \"_index\" : \"iannounce_object_1274399922\",\n#             \"_id\" : \"238852\",\n#             \"_type\" : \"memorial\"\n#          },\n\n[ SNIPPED ]\n\n#       ],\n#       \"total\" : 7390\n#    },\n#    \"_shards\" : {\n#       \"failed\" : 0,\n#       \"successful\" : 5,\n#       \"total\" : 5\n#    }\n# }\n```\n\nThere were some errors in the ES log around that time:\n\n```\n[07:14:35,985][DEBUG][action.search.type       ] [Ringleader] Failed to execute fetch phase\norg.elasticsearch.transport.RemoteTransportException: [Hulkling][inet[/192.168.10.50:9300]][search/phase/fetch/id]\nCaused by: org.elasticsearch.search.SearchContextMissingException: No search context found for id [9785964], timed out\n        at org.elasticsearch.search.SearchService.findContext(SearchService.java:274)\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:257)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchFetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:444)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchFetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:435)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$3.run(MessageChannelHandler.java:175)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\n[07:14:35,986][DEBUG][action.search.type       ] [Ringleader] Failed to execute fetch phase\norg.elasticsearch.transport.RemoteTransportException: [Hulkling][inet[/192.168.10.50:9300]][search/phase/fetch/id]\nCaused by: org.elasticsearch.search.SearchContextMissingException: No search context found for id [9785961], timed out\n        at org.elasticsearch.search.SearchService.findContext(SearchService.java:274)\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:257)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchFetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:444)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchFetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:435)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$3.run(MessageChannelHandler.java:175)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\n[07:14:35,986][DEBUG][action.search.type       ] [Ringleader] Failed to execute fetch phase\norg.elasticsearch.transport.RemoteTransportException: [Hulkling][inet[/192.168.10.50:9300]][search/phase/fetch/id]\nCaused by: org.elasticsearch.search.SearchContextMissingException: No search context found for id [9785965], timed out\n        at org.elasticsearch.search.SearchService.findContext(SearchService.java:274)\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:257)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchFetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:444)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchFetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:435)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$3.run(MessageChannelHandler.java:175)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\n[07:14:35,991][DEBUG][action.search.type       ] [Ringleader] Failed to execute fetch phase\norg.elasticsearch.transport.RemoteTransportException: [Hulkling][inet[/192.168.10.50:9300]][search/phase/fetch/id]\nCaused by: org.elasticsearch.search.SearchContextMissingException: No search context found for id [9785963], timed out\n        at org.elasticsearch.search.SearchService.findContext(SearchService.java:274)\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:257)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchFetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:444)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchFetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:435)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$3.run(MessageChannelHandler.java:175)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\n[07:14:36,212][DEBUG][action.search.type       ] [Ringleader] Failed to execute fetch phase\norg.elasticsearch.search.SearchContextMissingException: No search context found for id [4594371], timed out\n        at org.elasticsearch.search.SearchService.findContext(SearchService.java:274)\n        at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:257)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteFetch(SearchServiceTransportAction.java:309)\n        at org.elasticsearch.action.search.type.TransportSearchDfsQueryThenFetchAction$AsyncAction.executeFetch(TransportSearchDfsQueryThenFetchAction.java:226)\n        at org.elasticsearch.action.search.type.TransportSearchDfsQueryThenFetchAction$AsyncAction.access$700(TransportSearchDfsQueryThenFetchAction.java:64)\n        at org.elasticsearch.action.search.type.TransportSearchDfsQueryThenFetchAction$AsyncAction$4.run(TransportSearchDfsQueryThenFetchAction.java:199)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}