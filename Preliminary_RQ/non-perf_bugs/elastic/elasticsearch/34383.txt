{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34383","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34383/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34383/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34383/events","html_url":"https://github.com/elastic/elasticsearch/issues/34383","id":368717881,"node_id":"MDU6SXNzdWUzNjg3MTc4ODE=","number":34383,"title":"Long lived api keys/tokens","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"assignees":[{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false}],"milestone":null,"comments":15,"created_at":"2018-10-10T15:16:55Z","updated_at":"2019-02-05T03:21:58Z","closed_at":"2019-02-05T03:21:58Z","author_association":"MEMBER","active_lock_reason":null,"body":"The security codebase already supports the use of access tokens for\r\ninteractive access. These tokens are based on the OAuth2 spec; there is\r\na short-lived access token and a refresh token with a lifetime of 24 hours.\r\nThese tokens are not suitable for Hadoop jobs or recurring scheduled tasks.\r\n\r\nHadoop jobs typically require a token that may need to be refreshed but\r\nthe token needs to remain the same after refresh; our current tokens\r\nalways generate a new access and refresh token upon refresh. Another\r\npattern of Hadoop jobs is that once they are complete the tokens are\r\nnot invalidated but instead rely on a expiration time of something like\r\na week.\r\n\r\nThe security tokens are not a fit for recurring/scheduled jobs as they\r\ncan only be refreshed for 24 hours. If the system that would refresh the\r\ntoken is down for greater than 24 hours, which could be possible over a\r\nweekend or holiday, the jobs would require updating to function again.\r\n\r\nAfter discussion, we've settled upon adding long lived tokens that would\r\nbe akin to API tokens. The properties of these tokens are as follows:\r\n\r\n* Tokens will store the authentication information of the user that\r\ncreated them\r\n* By default, tokens have no expiration. A cluster level setting will\r\nbe available to specify a maximum lifetime\r\n* When creating a token, a maximum lifetime can be specified for cases\r\nwhere the token is expected to stop working after a certain amount of\r\ntime\r\n\r\nIn terms of APIs, we will be adding:\r\n\r\nCreate a token with optional expiration, which is a `TimeValue`.\r\n\r\n```\r\nPOST /_security/token\r\n{\r\n  \"expiration\": \"7d\"\r\n}\r\n```\r\n\r\nList security tokens. Optionally restrict by username and/or realm.\r\n\r\n```\r\nGET /_security/token\r\n{\r\n  \"username\": \"john.doe\",\r\n  \"realm\": \"ldap1\"\r\n}\r\n```\r\n\r\nList specific token\r\n\r\n```\r\nGET /_security/token/<token>\r\n```\r\n\r\nRemove a token.\r\n\r\n```\r\nDELETE /_security/token/<token>\r\n```\r\n\r\nIn order to use these tokens, they will be passed over HTTP using the\r\n`Authorization` header. The value must be prefixed with `Bearer `.\r\n\r\nIn order to use this token, security must take the value and find the \r\ndocument with this id. If the document does not exist or the search fails,\r\nthe token may not be used. Once security has retrieved a document with\r\nthis ID, it must make sure to verify the token has not expired.\r\n\r\nInvalidation or a removal of a token should remove the token document\r\nfrom the security index.\r\n\r\nTokens must store enough information to re-build authentication and\r\nsupport determining if the token has expired.\r\n\r\nFuture considerations:\r\n\r\n* The ability to limit the scope of a token\r\n* keep track of last used time\r\n","closed_by":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"performed_via_github_app":null}