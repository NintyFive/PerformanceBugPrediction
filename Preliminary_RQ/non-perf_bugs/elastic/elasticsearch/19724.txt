{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19724","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19724/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19724/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19724/events","html_url":"https://github.com/elastic/elasticsearch/issues/19724","id":168674428,"node_id":"MDU6SXNzdWUxNjg2NzQ0Mjg=","number":19724,"title":"ConcurrentModificationException when creating new TransportClient","user":{"login":"itaifrenkel","id":387337,"node_id":"MDQ6VXNlcjM4NzMzNw==","avatar_url":"https://avatars2.githubusercontent.com/u/387337?v=4","gravatar_id":"","url":"https://api.github.com/users/itaifrenkel","html_url":"https://github.com/itaifrenkel","followers_url":"https://api.github.com/users/itaifrenkel/followers","following_url":"https://api.github.com/users/itaifrenkel/following{/other_user}","gists_url":"https://api.github.com/users/itaifrenkel/gists{/gist_id}","starred_url":"https://api.github.com/users/itaifrenkel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itaifrenkel/subscriptions","organizations_url":"https://api.github.com/users/itaifrenkel/orgs","repos_url":"https://api.github.com/users/itaifrenkel/repos","events_url":"https://api.github.com/users/itaifrenkel/events{/privacy}","received_events_url":"https://api.github.com/users/itaifrenkel/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-08-01T15:30:57Z","updated_at":"2016-08-02T02:57:14Z","closed_at":"2016-08-02T02:57:14Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3.2\n\n**JVM version**: 1.8.0_40\n\n**OS version**: linux ubuntu 12.04\n\n**Description of the problem including expected versus actual behavior**:\n\nWe got ConcurrentModificationException in our ci suite sporadicly when creating new Transport Client.\n\n**Steps to reproduce**:\n This  happens if someone modifies System properties while creating new transport client.\nWe think that System.getProperties() in InternalSettingsPreparer.initializeSettings() should be passed to Settings only after copying it to a new HashMap. we are not calling system.setProperty, but still we are getting this sporadic failure in our ci.\n\nfrom the elasticsearch code we think that this was fixed in v5 but we didn't validate it since we havent upgraded to v5\n\n**Provide logs (if relevant)**:\njava.util.ConcurrentModificationException\n    at java.util.Hashtable$Enumerator.next(Hashtable.java:1367) ~[?:1.8.0_40]\n    at org.elasticsearch.common.settings.Settings$Builder.putProperties(Settings.java:1096)\n    at org.elasticsearch.node.internal.InternalSettingsPreparer.initializeSettings(InternalSettingsPreparer.java:124)\n    at org.elasticsearch.node.internal.InternalSettingsPreparer.prepareSettings(InternalSettingsPreparer.java:63)\n    at org.elasticsearch.client.transport.TransportClient$Builder.build(TransportClient.java:117) \n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}