[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148112719","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-148112719","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":148112719,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODExMjcxOQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-10-14T16:44:57Z","updated_at":"2015-10-14T16:44:57Z","author_association":"CONTRIBUTOR","body":"@nickminutello can you tell us which version this is?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148112889","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-148112889","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":148112889,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODExMjg4OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-10-14T16:45:43Z","updated_at":"2015-10-14T16:45:43Z","author_association":"MEMBER","body":"@nik9000 It's visible in `elasticsearch-1.7.1.jar:na` in the stack trace.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148225108","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-148225108","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":148225108,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODIyNTEwOA==","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2015-10-14T22:47:33Z","updated_at":"2015-10-14T22:47:33Z","author_association":"NONE","body":"Sorry. Yes 1.7.1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148383293","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-148383293","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":148383293,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODM4MzI5Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-10-15T13:18:50Z","updated_at":"2015-10-15T13:18:50Z","author_association":"CONTRIBUTOR","body":"@nickminutello Is this with a custom plugin that uses its own exceptions?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148388794","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-148388794","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":148388794,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODM4ODc5NA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-10-15T13:37:10Z","updated_at":"2015-10-15T13:37:10Z","author_association":"CONTRIBUTOR","body":"> Sorry. Yes 1.7.1\n\nThanks! Sorry. I should have seen it in the stack trace. I'll try and remember to look there next time. Thanks for filing the whole stack trace, btw.\n\n> @nickminutello Is this with a custom plugin that uses its own exceptions?\n\nI don't think so - if I had to guess I'd say its just an exception we didn't test well. IIRC in 2.0 exception passing is done differently so the unserializable exception is probably exclusive to 1.7.\n\nIm' not 100% sure on the root cause. I guess it could be a jar hell thing - I've not looked into the full story of equals and hashcode for package and class objects but if it was easy to do we'd have seen it in testing or production somewhere else. \n\nSo I'm not sure. What does the environment look like where you run this? Do you modify the white and black lists? If so, what do you have them set to?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/149464126","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-149464126","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":149464126,"node_id":"MDEyOklzc3VlQ29tbWVudDE0OTQ2NDEyNg==","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2015-10-20T07:40:43Z","updated_at":"2015-10-20T07:40:52Z","author_association":"NONE","body":"No. No custom plugins.\nNot sure of the root cause of the issue either.\nA possibility is perhaps two different cluster members running on different version jvms?\n\nBut a static analysis of the code would suggest its not going to work as expected? (or am I missing something?).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/149940987","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-149940987","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":149940987,"node_id":"MDEyOklzc3VlQ29tbWVudDE0OTk0MDk4Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-10-21T15:53:29Z","updated_at":"2015-10-21T16:12:40Z","author_association":"MEMBER","body":"It is possible for different versions of the JVM to cause serialization issues in the transport layer (addressed in #11910). The most common cause that we've seen is due to changes in 6u45 and 7u21 for the serialization of [`java.net.InetAddress`](http://hg.openjdk.java.net/jdk7u/jdk7u-dev/jdk/rev/7ca8a40795d8). I see that the machine this exception occurred on was running 7u65; are you running any machines in your cluster on a version of the JVM prior to 7u21? That said, the exception message that you present here is slightly different than what we normally see when the differences in serialization lead to issues.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/152600909","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-152600909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":152600909,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MjYwMDkwOQ==","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2015-10-30T17:52:33Z","updated_at":"2015-10-30T17:52:33Z","author_association":"NONE","body":"The issue occurs when one node JVM is 1.8 and the other is 1.7 (see above).\n\nHowever, is it the case that this is just exposing the _actual_ bug (relying on Object.equals()) above?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/152615148","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-152615148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":152615148,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MjYxNTE0OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-10-30T18:50:25Z","updated_at":"2015-10-30T19:38:20Z","author_association":"MEMBER","body":"Is it possible for you to either take the 1.7 system to 1.8 or the 1.8 system to 1.7 and see if the issue reproduces? This still feels like it might be a cross JVM version serialization issue so let's confirm that or rule it out. Mixing minor versions is generally okay (not 100%, e.g., 6u45 and 7u21) but crossing major versions seems ripe for trouble.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153721338","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-153721338","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":153721338,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzcyMTMzOA==","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2015-11-04T13:36:28Z","updated_at":"2015-11-04T13:36:28Z","author_association":"NONE","body":"Running both on 1.8 reproduces this bug, so the JVM mismatch is a bit of a red herring.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153722888","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-153722888","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":153722888,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzcyMjg4OA==","user":{"login":"nickminutello","id":298274,"node_id":"MDQ6VXNlcjI5ODI3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/298274?v=4","gravatar_id":"","url":"https://api.github.com/users/nickminutello","html_url":"https://github.com/nickminutello","followers_url":"https://api.github.com/users/nickminutello/followers","following_url":"https://api.github.com/users/nickminutello/following{/other_user}","gists_url":"https://api.github.com/users/nickminutello/gists{/gist_id}","starred_url":"https://api.github.com/users/nickminutello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickminutello/subscriptions","organizations_url":"https://api.github.com/users/nickminutello/orgs","repos_url":"https://api.github.com/users/nickminutello/repos","events_url":"https://api.github.com/users/nickminutello/events{/privacy}","received_events_url":"https://api.github.com/users/nickminutello/received_events","type":"User","site_admin":false},"created_at":"2015-11-04T13:44:30Z","updated_at":"2015-11-04T13:44:46Z","author_association":"NONE","body":"The root cause exception is:\n\n```\norg.elasticsearch.indices.recovery.DelayRecoveryException: source node does not have the shard listed in its state as allocated on the node\n    at org.elasticsearch.indices.recovery.RecoverySource.recover(RecoverySource.java:108)\n    at org.elasticsearch.indices.recovery.RecoverySource.access$200(RecoverySource.java:49)\n    at org.elasticsearch.indices.recovery.RecoverySource$StartRecoveryTransportRequestHandler.messageReceived(RecoverySource.java:146)\n    at org.elasticsearch.indices.recovery.RecoverySource$StartRecoveryTransportRequestHandler.messageReceived(RecoverySource.java:132)\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:279)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:36)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\nBut I can see now that the bug that is the subject of this issue is not actually in elastic - but in commons-io?\n\nFundamentally, the **private ObjectStreamClass verify(ObjectStreamClass streamClass)** is broken.\nThe CLASS_WHITELIST.contains(aClass) and PKG_WHITELIST.contains(aClass.getPackage()) is unlikely to work as the author intends.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/176776029","html_url":"https://github.com/elastic/elasticsearch/issues/14117#issuecomment-176776029","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14117","id":176776029,"node_id":"MDEyOklzc3VlQ29tbWVudDE3Njc3NjAyOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-29T14:15:15Z","updated_at":"2016-01-29T14:15:15Z","author_association":"CONTRIBUTOR","body":"@jasontedor @nickminutello anything more on this bug?  Haven't heard reports of this elsewhere, and 2.0 doesn't use java serialization, so I'm tempted to close this?\n","performed_via_github_app":null}]