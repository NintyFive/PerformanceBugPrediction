{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/62174","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62174/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62174/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/62174/events","html_url":"https://github.com/elastic/elasticsearch/issues/62174","id":696902519,"node_id":"MDU6SXNzdWU2OTY5MDI1MTk=","number":62174,"title":"Format field for date histogram does not work with Transforms","user":{"login":"djaswal","id":5740568,"node_id":"MDQ6VXNlcjU3NDA1Njg=","avatar_url":"https://avatars3.githubusercontent.com/u/5740568?v=4","gravatar_id":"","url":"https://api.github.com/users/djaswal","html_url":"https://github.com/djaswal","followers_url":"https://api.github.com/users/djaswal/followers","following_url":"https://api.github.com/users/djaswal/following{/other_user}","gists_url":"https://api.github.com/users/djaswal/gists{/gist_id}","starred_url":"https://api.github.com/users/djaswal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djaswal/subscriptions","organizations_url":"https://api.github.com/users/djaswal/orgs","repos_url":"https://api.github.com/users/djaswal/repos","events_url":"https://api.github.com/users/djaswal/events{/privacy}","received_events_url":"https://api.github.com/users/djaswal/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":1977209897,"node_id":"MDU6TGFiZWwxOTc3MjA5ODk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:ML","name":"Team:ML","color":"fef2c0","default":false,"description":"Meta label for the ML team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-09-09T15:14:31Z","updated_at":"2020-09-21T11:12:27Z","closed_at":"2020-09-21T11:08:02Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch version (bin/elasticsearch --version): 7.9.1\r\n\r\nPlugins installed: []\r\n\r\nJVM version (java -version): openjdk version \"1.8.0_265\"\r\nOpenJDK Runtime Environment (build 1.8.0_265-8u265-b01-0ubuntu2~18.04-b01)\r\nOpenJDK 64-Bit Server VM (build 25.265-b01, mixed mode)\r\n\r\nOS Version: Ubuntu 18.04\r\n\r\nDescription of the problem including expected versus actual behavior:\r\nTransforms that include date histogram with format value do not work with the following error:\r\n`\"error\": {\r\n        \"root_cause\": [\r\n            {\r\n                \"type\": \"x_content_parse_exception\",\r\n                \"reason\": \"[1:47] [data_frame_date_histogram_group] unknown field [format]\"\r\n            }\r\n        ],`\r\n\r\nSteps to reproduce:\r\n\r\n1. Create Index \r\n```json\r\n{\r\n   \"mappings\":{\r\n      \"properties\":{\r\n         \"date\":{\r\n            \"type\":\"date\",\r\n            \"format\":\"yyyy-MM-dd HH:mm:ss\"\r\n         },\r\n         \"voltage\":{\r\n            \"type\":\"long\"\r\n         }\r\n      }\r\n   }\r\n}\r\n```\r\n\r\n2. Add test items\r\n```json\r\nPOST test_index/_doc/1\r\n{\r\n    \"date\": \"2015-01-01 12:10:30\",\r\n    \"voltage\":1\r\n}\r\n```\r\n```json\r\nPOST test_index/_doc/2\r\n{\r\n    \"date\": \"2015-02-01 12:10:30\",\r\n    \"voltage\":1\r\n}\r\n```\r\n```json\r\nPOST test_index/_doc/3\r\n{\r\n    \"date\": \"2015-03-01 12:10:30\",\r\n    \"voltage\":5\r\n}\r\n```\r\n```json\r\nPOST test_index/_doc/4\r\n{\r\n    \"date\": \"2015-04-01 12:10:30\",\r\n    \"voltage\":10\r\n}\r\n```\r\n3. Try transform preview\r\n\r\n```json\r\nPOST _transform/_preview\r\n{\r\n   \"dest\":{\r\n      \"index\":\"hourly_data_aggregations\"\r\n   },\r\n   \"source\":{\r\n      \"index\":\"test_index\"\r\n   },\r\n   \"pivot\":{\r\n      \"group_by\":{\r\n         \"dateTime\":{\r\n            \"date_histogram\":{\r\n               \"field\":\"date\",\r\n\t\t\"calendar_interval\": \"1M\",\r\n\t\t\"format\": \"yyyy-MM-dd HH:mm:ss\"\r\n            }\r\n         }\r\n      },\r\n      \"aggregations\":{\r\n         \"avgVoltage\":{\r\n            \"avg\":{\r\n               \"field\":\"voltage\"\r\n            }\r\n         }\r\n      }\r\n   }\r\n}\r\n```\r\nERROR:\r\n```\r\n\"error\": {\r\n        \"root_cause\": [\r\n            {\r\n                \"type\": \"x_content_parse_exception\",\r\n                \"reason\": \"[1:47] [data_frame_date_histogram_group] unknown field [format]\"\r\n            }\r\n        ],\r\n```","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}