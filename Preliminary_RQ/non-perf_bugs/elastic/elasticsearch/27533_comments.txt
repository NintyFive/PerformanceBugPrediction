[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347188242","html_url":"https://github.com/elastic/elasticsearch/issues/27533#issuecomment-347188242","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27533","id":347188242,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzE4ODI0Mg==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2017-11-27T13:56:13Z","updated_at":"2017-11-27T13:59:20Z","author_association":"CONTRIBUTOR","body":"Hello @c0da \r\n\r\nThe index you are trying to migrate to v6 has been migrated in the past from v2 to v5.\r\nUnfortunately you have hit a double corner case:\r\n1. the automatic migrate tool does not handle it (and causes the error you reported)\r\n2. a bug preventing the removal of the `archived` index settings namespace https://github.com/elastic/elasticsearch/issues/27537\r\n\r\nThe workaround is to recreate the indices and reindex manually:\r\n1. identify indices requiring upgrade with: [GET /_xpack/migration/assistance](https://www.elastic.co/guide/en/elasticsearch/reference/6.0/migration-api-assistance.html)\r\n2. [get index settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-get-settings.html) and remove the archived namespace and any settings that have been [changed breakingly](https://www.elastic.co/guide/en/elasticsearch/reference/current/breaking_60_indices_changes.html)\r\n3. create the new index with the new settings\r\n4. use the the [reindex API](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-reindex.html)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347869469","html_url":"https://github.com/elastic/elasticsearch/issues/27533#issuecomment-347869469","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27533","id":347869469,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzg2OTQ2OQ==","user":{"login":"c0da","id":604852,"node_id":"MDQ6VXNlcjYwNDg1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/604852?v=4","gravatar_id":"","url":"https://api.github.com/users/c0da","html_url":"https://github.com/c0da","followers_url":"https://api.github.com/users/c0da/followers","following_url":"https://api.github.com/users/c0da/following{/other_user}","gists_url":"https://api.github.com/users/c0da/gists{/gist_id}","starred_url":"https://api.github.com/users/c0da/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/c0da/subscriptions","organizations_url":"https://api.github.com/users/c0da/orgs","repos_url":"https://api.github.com/users/c0da/repos","events_url":"https://api.github.com/users/c0da/events{/privacy}","received_events_url":"https://api.github.com/users/c0da/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T14:04:19Z","updated_at":"2017-11-29T14:04:19Z","author_association":"NONE","body":"Thank you @albertzaharovits ! I'll give it a try and let you know.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/360183925","html_url":"https://github.com/elastic/elasticsearch/issues/27533#issuecomment-360183925","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27533","id":360183925,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDE4MzkyNQ==","user":{"login":"c0da","id":604852,"node_id":"MDQ6VXNlcjYwNDg1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/604852?v=4","gravatar_id":"","url":"https://api.github.com/users/c0da","html_url":"https://github.com/c0da","followers_url":"https://api.github.com/users/c0da/followers","following_url":"https://api.github.com/users/c0da/following{/other_user}","gists_url":"https://api.github.com/users/c0da/gists{/gist_id}","starred_url":"https://api.github.com/users/c0da/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/c0da/subscriptions","organizations_url":"https://api.github.com/users/c0da/orgs","repos_url":"https://api.github.com/users/c0da/repos","events_url":"https://api.github.com/users/c0da/events{/privacy}","received_events_url":"https://api.github.com/users/c0da/received_events","type":"User","site_admin":false},"created_at":"2018-01-24T16:07:07Z","updated_at":"2018-01-24T16:07:07Z","author_association":"NONE","body":"Thank you again, @albertzaharovits ! Your workaround worked like a charm!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/370530431","html_url":"https://github.com/elastic/elasticsearch/issues/27533#issuecomment-370530431","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27533","id":370530431,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MDUzMDQzMQ==","user":{"login":"tomsommer","id":149171,"node_id":"MDQ6VXNlcjE0OTE3MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/149171?v=4","gravatar_id":"","url":"https://api.github.com/users/tomsommer","html_url":"https://github.com/tomsommer","followers_url":"https://api.github.com/users/tomsommer/followers","following_url":"https://api.github.com/users/tomsommer/following{/other_user}","gists_url":"https://api.github.com/users/tomsommer/gists{/gist_id}","starred_url":"https://api.github.com/users/tomsommer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomsommer/subscriptions","organizations_url":"https://api.github.com/users/tomsommer/orgs","repos_url":"https://api.github.com/users/tomsommer/repos","events_url":"https://api.github.com/users/tomsommer/events{/privacy}","received_events_url":"https://api.github.com/users/tomsommer/received_events","type":"User","site_admin":false},"created_at":"2018-03-05T19:15:05Z","updated_at":"2018-03-05T19:15:05Z","author_association":"NONE","body":"This is not solved by #27537 though","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/455351950","html_url":"https://github.com/elastic/elasticsearch/issues/27533#issuecomment-455351950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27533","id":455351950,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTM1MTk1MA==","user":{"login":"andrew-goldstein","id":4459398,"node_id":"MDQ6VXNlcjQ0NTkzOTg=","avatar_url":"https://avatars3.githubusercontent.com/u/4459398?v=4","gravatar_id":"","url":"https://api.github.com/users/andrew-goldstein","html_url":"https://github.com/andrew-goldstein","followers_url":"https://api.github.com/users/andrew-goldstein/followers","following_url":"https://api.github.com/users/andrew-goldstein/following{/other_user}","gists_url":"https://api.github.com/users/andrew-goldstein/gists{/gist_id}","starred_url":"https://api.github.com/users/andrew-goldstein/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrew-goldstein/subscriptions","organizations_url":"https://api.github.com/users/andrew-goldstein/orgs","repos_url":"https://api.github.com/users/andrew-goldstein/repos","events_url":"https://api.github.com/users/andrew-goldstein/events{/privacy}","received_events_url":"https://api.github.com/users/andrew-goldstein/received_events","type":"User","site_admin":false},"created_at":"2019-01-17T22:14:50Z","updated_at":"2019-01-17T22:14:50Z","author_association":"NONE","body":"If while migrating from v2 you run into this issue, where the `index.archived.index.routing.allocation.disable_allocation` setting prevents migration of an index via the assistant UI, you may execute the procedure documented at https://www.elastic.co/guide/en/kibana/current/migrating-6.0-index.html\r\nfor every index that contains the `index.archived.index.routing.allocation.disable_allocation` setting.\r\n\r\nPlease note that the documented procedure does not migrate existing index settings. That's generally fine for the `.kibana` index, however if you are migrating other indexes, and you wish to preserve their settings, you must do the following (for each index being migrated):\r\n\r\n1) Copy the current index settings from the output of the following (example) `GET` request, run in the Kibana Dev Tools. If, for example, your index was named `index_test`, execute the following `GET` request:\r\n\r\n`GET /index_test/_settings`\r\n\r\n2) In a text editor, remove the `index.archived.index.routing.allocation.disable_allocation` setting from the output above.\r\n\r\n3) Use the modified settings above (that omit `index.archived.index.routing.allocation.disable_allocation`) when executing the `PUT` described in step 2 of https://www.elastic.co/guide/en/kibana/current/migrating-6.0-index.html\r\n\r\n\r\nTo be clear, the extra steps above are only required if you have specific index settings you wish to retain.","performed_via_github_app":null}]