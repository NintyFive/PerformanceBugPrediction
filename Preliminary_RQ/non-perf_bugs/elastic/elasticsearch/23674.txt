{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23674","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23674/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23674/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23674/events","html_url":"https://github.com/elastic/elasticsearch/issues/23674","id":215747349,"node_id":"MDU6SXNzdWUyMTU3NDczNDk=","number":23674,"title":"Significant text - new aggregation type","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null},{"id":620636309,"node_id":"MDU6TGFiZWw2MjA2MzYzMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.0-alpha2","name":"v6.0.0-alpha2","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"assignees":[{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false}],"milestone":null,"comments":12,"created_at":"2017-03-21T13:55:13Z","updated_at":"2019-06-02T13:35:31Z","closed_at":"2017-05-24T12:46:43Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"There are a number of concerns with using the existing `significant_terms` aggregation on `text` fields:\r\n\r\n1) **Memory costs**: access to the text in documents is reliant on setting `fielddata:true` which is prohibitively expensive for most indexes.\r\n2) **Unintelligible results** techniques such as stemming make raw index terms hard for users to interpret - terms may first need \"de-stemming\" for presentation back to end users.\r\n3) **Weak signals** Individual terms aren't always useful - identifying significant _phrases_ however can be much more interesting\r\n4) **Misleading suggestions** Statistical analysis of word use in free-text is often hampered by duplications found in noisy data. Retweets, email reply chains or boiler-plate copyright notices tend to amplify the significance of the same paragraphs or any typos they contain. Removal of near-duplicate text in samples is required and fortunately similar documents rank similarly so duplicate text is often closely related in search result samples.\r\n\r\nThe core logic in the existing `significant_terms` aggregation originally came from a different project that did all of the above on free text and most of the above concerns were introduced as part of porting/trimming this logic to work with the data model imposed by the elasticsearch aggregations framework (designed for access to structured field data and doc values).\r\n\r\nFor this new `significant_text` aggregation I propose we examine Token streams from a sample of high-ranking documents where we have access to position information and raw text. Raw token streams can be obtained using the existing TermVectors api and by feeding this through a sequence of special TokenFilters we can further process the stream to remove duplicate paragraphs, spot phrase candidates and otherwise gather the information required to find useful suggestions from free text.\r\n\r\nAs a first step we could just look to introduce a `significant_text` aggregation that gathers the statistics for terms using the TermVectors api as an alternative to field data to address issue 1). This is the major pain-point for most users.\r\nThe other issues 2, 3 and 4 are nice-to-haves and can be tackled at a later stage once we have laid the foundations of analysing streams of text that can be processed using TokenFilters.\r\n","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}