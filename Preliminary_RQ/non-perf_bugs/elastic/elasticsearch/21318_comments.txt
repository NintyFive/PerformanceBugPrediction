[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258270328","html_url":"https://github.com/elastic/elasticsearch/issues/21318#issuecomment-258270328","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21318","id":258270328,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODI3MDMyOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-11-03T20:52:18Z","updated_at":"2016-11-03T21:20:58Z","author_association":"MEMBER","body":"This does not reproduce for me.\n\n```\n16:48:47 ⌁58% [jason:~] $ curl -XPOST localhost:9200/m?pretty=1 -d '\n{\n  \"settings\": {\n    \"number_of_shards\": 1,\n    \"number_of_replicas\": 0\n  }\n}'\n{\n  \"acknowledged\" : true\n}\n16:49:03 ⌁58% [jason:~] $ curl -XPOST localhost:9200/_aliases?pretty=1 -d '\n{\n  \"actions\": [\n    { \"add\": { \"index\": \"m\", \"alias\": \"a\" } }\n  ]\n}'\n{\n  \"acknowledged\" : true\n}\n16:49:09 ⌁58% [jason:~] $ !!:gs/\"a\"/\"b\"\ncurl -XPOST localhost:9200/_aliases?pretty=1 -d '\n{\n  \"actions\": [\n    { \"add\": { \"index\": \"m\", \"alias\": \"b\" } }\n  ]\n}'\n{\n  \"acknowledged\" : true\n}\n16:49:13 ⌁58% [jason:~] $ curl -XPOST localhost:9200/a/n/1?pretty=1 -d '{\"f\": \"v\"}'\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"1\",\n  \"_version\" : 1,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"created\" : true\n}\n16:49:20 ⌁58% [jason:~] $ curl -XGET localhost:9200/a/n/1?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"1\",\n  \"_version\" : 1,\n  \"found\" : true,\n  \"_source\" : {\n    \"f\" : \"v\"\n  }\n}\n16:49:30 ⌁58% [jason:~] $ curl -XGET localhost:9200/b/n/1?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"1\",\n  \"_version\" : 1,\n  \"found\" : true,\n  \"_source\" : {\n    \"f\" : \"v\"\n  }\n}\n16:49:32 ⌁58% [jason:~] $ curl -XGET localhost:9200/m/n/1?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"1\",\n  \"_version\" : 1,\n  \"found\" : true,\n  \"_source\" : {\n    \"f\" : \"v\"\n  }\n}\n16:51:16 ⌁57% [jason:~] $ curl -XGET localhost:9200/a/_search?pretty=1 -d '\n{\n  \"query\": {\n    \"match_all\": {}\n  }\n}'\n{\n  \"took\" : 2,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 1.0,\n    \"hits\" : [ {\n      \"_index\" : \"m\",\n      \"_type\" : \"n\",\n      \"_id\" : \"1\",\n      \"_score\" : 1.0,\n      \"_source\" : {\n        \"f\" : \"v\"\n      }\n    } ]\n  }\n}\n16:51:26 ⌁57% [jason:~] $ curl -XGET localhost:9200/b/_search?pretty=1 -d '\n{\n  \"query\": {\n    \"match_all\": {}\n  }\n}'\n{\n  \"took\" : 1,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 1.0,\n    \"hits\" : [ {\n      \"_index\" : \"m\",\n      \"_type\" : \"n\",\n      \"_id\" : \"1\",\n      \"_score\" : 1.0,\n      \"_source\" : {\n        \"f\" : \"v\"\n      }\n    } ]\n  }\n}\n16:51:30 ⌁57% [jason:~] $ curl -XGET localhost:9200/m/_search?pretty=1 -d '\n{\n  \"query\": {\n    \"match_all\": {}\n  }\n}'\n{\n  \"took\" : 1,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 1.0,\n    \"hits\" : [ {\n      \"_index\" : \"m\",\n      \"_type\" : \"n\",\n      \"_id\" : \"1\",\n      \"_score\" : 1.0,\n      \"_source\" : {\n        \"f\" : \"v\"\n      }\n    } ]\n  }\n}\n```\n\nIf you have an actual reproduction, that would be really helpful otherwise I will have to close this as unable to reproduce.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258280770","html_url":"https://github.com/elastic/elasticsearch/issues/21318#issuecomment-258280770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21318","id":258280770,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODI4MDc3MA==","user":{"login":"dzhang22","id":2986446,"node_id":"MDQ6VXNlcjI5ODY0NDY=","avatar_url":"https://avatars2.githubusercontent.com/u/2986446?v=4","gravatar_id":"","url":"https://api.github.com/users/dzhang22","html_url":"https://github.com/dzhang22","followers_url":"https://api.github.com/users/dzhang22/followers","following_url":"https://api.github.com/users/dzhang22/following{/other_user}","gists_url":"https://api.github.com/users/dzhang22/gists{/gist_id}","starred_url":"https://api.github.com/users/dzhang22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dzhang22/subscriptions","organizations_url":"https://api.github.com/users/dzhang22/orgs","repos_url":"https://api.github.com/users/dzhang22/repos","events_url":"https://api.github.com/users/dzhang22/events{/privacy}","received_events_url":"https://api.github.com/users/dzhang22/received_events","type":"User","site_admin":false},"created_at":"2016-11-03T21:33:20Z","updated_at":"2016-11-03T21:33:20Z","author_association":"NONE","body":"Thanks for creating the example.\n\nBelow is the reproduction of the problem. \nWith 1 shard and 0 replica, x can be found under both a, b, m. With 5 shards and 1 replica, x cannot be found under b, m.\n\nWhy is this?\n\n============= with 1 shard and 0 replica =================\nubuntu$ curl -XPOST localhost:9200/m?pretty=1 -d '\n {\n   \"settings\": {\n     \"number_of_shards\": 1,\n     \"number_of_replicas\": 0\n   }\n }'\n{\n  \"acknowledged\" : true\n}\n\nubuntu$ curl -XPUT localhost:9200/m/_alias/a -d '\n {\n   \"routing\": \"a\",\n   \"filter\": {\n     \"term\": {\n       \"account_id\": \"a\"\n     }\n   }\n }'\n{\"acknowledged\":true}\n\nubuntu$ curl -XPUT localhost:9200/m/_alias/b -d '\n {\n   \"routing\": \"b\",\n   \"filter\": {\n     \"term\": {\n       \"account_id\": \"b\"\n     }\n   }\n }'\n{\"acknowledged\":true}\n\nubuntu$ curl -XGET http://localhost:9200/m/_alias?pretty\n{\n  \"m\" : {\n    \"aliases\" : {\n      \"a\" : {\n        \"filter\" : {\n          \"term\" : {\n            \"account_id\" : \"a\"\n          }\n        },\n        \"index_routing\" : \"a\",\n        \"search_routing\" : \"a\"\n      },\n      \"b\" : {\n        \"filter\" : {\n          \"term\" : {\n            \"account_id\" : \"b\"\n          }\n        },\n        \"index_routing\" : \"b\",\n        \"search_routing\" : \"b\"\n      }\n    }\n  }\n}\n\nubuntu$ curl -XPOST localhost:9200/a/n/x?pretty=1 -d '{\"account_id\": \"a\", \"message_id\": \"x\"}'\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"x\",\n  \"_version\" : 1,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"created\" : true\n}\n\nubuntu$ curl -XGET localhost:9200/a/n/x?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"x\",\n  \"_version\" : 1,\n  \"_routing\" : \"a\",\n  \"found\" : true,\n  \"_source\" : {\n    \"account_id\" : \"a\",\n    \"message_id\" : \"x\"\n  }\n}\n\nubuntu$ curl -XGET localhost:9200/b/n/x?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"x\",\n  \"_version\" : 1,\n  \"_routing\" : \"a\",\n  \"found\" : true,\n  \"_source\" : {\n    \"account_id\" : \"a\",\n    \"message_id\" : \"x\"\n  }\n}\n\nubuntu$ curl -XGET localhost:9200/m/n/x?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"x\",\n  \"_version\" : 1,\n  \"_routing\" : \"a\",\n  \"found\" : true,\n  \"_source\" : {\n    \"account_id\" : \"a\",\n    \"message_id\" : \"x\"\n  }\n}\n\n============= with more shards and replica =================\nubuntu$ curl -XPOST localhost:9200/m?pretty=1 -d '\n {\n   \"settings\": {\n     \"number_of_shards\": 5,\n     \"number_of_replicas\": 1\n   }\n }'\n{\n  \"acknowledged\" : true\n}\n\nubuntu$ curl -XPUT localhost:9200/m/_alias/a -d '\n {\n   \"routing\": \"a\",\n   \"filter\": {\n     \"term\": {\n       \"account_id\": \"a\"\n     }\n   }\n }'\n{\"acknowledged\":true}\n\nubuntu$ curl -XPUT localhost:9200/m/_alias/b -d '\n {\n   \"routing\": \"b\",\n   \"filter\": {\n     \"term\": {\n       \"account_id\": \"b\"\n     }\n   }\n }'\n{\"acknowledged\":true}\n\nubuntu$ curl -XGET http://localhost:9200/m/_alias?pretty\n{\n  \"m\" : {\n    \"aliases\" : {\n      \"a\" : {\n        \"filter\" : {\n          \"term\" : {\n            \"account_id\" : \"a\"\n          }\n        },\n        \"index_routing\" : \"a\",\n        \"search_routing\" : \"a\"\n      },\n      \"b\" : {\n        \"filter\" : {\n          \"term\" : {\n            \"account_id\" : \"b\"\n          }\n        },\n        \"index_routing\" : \"b\",\n        \"search_routing\" : \"b\"\n      }\n    }\n  }\n}\n\nubuntu$ curl -XPOST localhost:9200/a/n/x?pretty=1 -d '{\"account_id\": \"a\", \"message_id\": \"x\"}'\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"x\",\n  \"_version\" : 1,\n  \"_shards\" : {\n    \"total\" : 2,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"created\" : true\n}\n\nubuntu$ curl -XGET localhost:9200/a/n/x?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"x\",\n  \"_version\" : 1,\n  \"_routing\" : \"a\",\n  \"found\" : true,\n  \"_source\" : {\n    \"account_id\" : \"a\",\n    \"message_id\" : \"x\"\n  }\n}\n\nubuntu$ curl -XGET localhost:9200/b/n/x?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"x\",\n  \"found\" : false\n}\n\nubuntu$ curl -XGET localhost:9200/m/n/x?pretty=1\n{\n  \"_index\" : \"m\",\n  \"_type\" : \"n\",\n  \"_id\" : \"x\",\n  \"found\" : false\n}\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258284726","html_url":"https://github.com/elastic/elasticsearch/issues/21318#issuecomment-258284726","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21318","id":258284726,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODI4NDcyNg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-11-03T21:50:01Z","updated_at":"2016-11-03T21:50:01Z","author_association":"MEMBER","body":"It is because of the routing that you have, you're not hitting the shard that contains the document. With one shard, all routing will hit the sole shard. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258290376","html_url":"https://github.com/elastic/elasticsearch/issues/21318#issuecomment-258290376","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21318","id":258290376,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODI5MDM3Ng==","user":{"login":"dzhang22","id":2986446,"node_id":"MDQ6VXNlcjI5ODY0NDY=","avatar_url":"https://avatars2.githubusercontent.com/u/2986446?v=4","gravatar_id":"","url":"https://api.github.com/users/dzhang22","html_url":"https://github.com/dzhang22","followers_url":"https://api.github.com/users/dzhang22/followers","following_url":"https://api.github.com/users/dzhang22/following{/other_user}","gists_url":"https://api.github.com/users/dzhang22/gists{/gist_id}","starred_url":"https://api.github.com/users/dzhang22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dzhang22/subscriptions","organizations_url":"https://api.github.com/users/dzhang22/orgs","repos_url":"https://api.github.com/users/dzhang22/repos","events_url":"https://api.github.com/users/dzhang22/events{/privacy}","received_events_url":"https://api.github.com/users/dzhang22/received_events","type":"User","site_admin":false},"created_at":"2016-11-03T22:14:30Z","updated_at":"2016-11-03T22:14:30Z","author_association":"NONE","body":"With one shard, since the alias has a filter, is it supposed that x should not appear under b? In another word, \"curl -XGET localhost:9200/b/n/x?pretty=1\" should return Found=False?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258294333","html_url":"https://github.com/elastic/elasticsearch/issues/21318#issuecomment-258294333","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21318","id":258294333,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODI5NDMzMw==","user":{"login":"dzhang22","id":2986446,"node_id":"MDQ6VXNlcjI5ODY0NDY=","avatar_url":"https://avatars2.githubusercontent.com/u/2986446?v=4","gravatar_id":"","url":"https://api.github.com/users/dzhang22","html_url":"https://github.com/dzhang22","followers_url":"https://api.github.com/users/dzhang22/followers","following_url":"https://api.github.com/users/dzhang22/following{/other_user}","gists_url":"https://api.github.com/users/dzhang22/gists{/gist_id}","starred_url":"https://api.github.com/users/dzhang22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dzhang22/subscriptions","organizations_url":"https://api.github.com/users/dzhang22/orgs","repos_url":"https://api.github.com/users/dzhang22/repos","events_url":"https://api.github.com/users/dzhang22/events{/privacy}","received_events_url":"https://api.github.com/users/dzhang22/received_events","type":"User","site_admin":false},"created_at":"2016-11-03T22:33:59Z","updated_at":"2016-11-03T22:33:59Z","author_association":"NONE","body":"How to reopen this issue so that it's visible to others who might have more insights?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258296218","html_url":"https://github.com/elastic/elasticsearch/issues/21318#issuecomment-258296218","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21318","id":258296218,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODI5NjIxOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-11-03T22:43:44Z","updated_at":"2016-11-03T22:43:54Z","author_association":"MEMBER","body":"> With one shard, since the alias has a filter, is it supposed that x should not appear under b?\n\n@dzhang22 Alias filters do not apply to gets, only to searches.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/258296403","html_url":"https://github.com/elastic/elasticsearch/issues/21318#issuecomment-258296403","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21318","id":258296403,"node_id":"MDEyOklzc3VlQ29tbWVudDI1ODI5NjQwMw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-11-03T22:44:36Z","updated_at":"2016-11-03T22:44:36Z","author_association":"MEMBER","body":"Relates #3861\n","performed_via_github_app":null}]