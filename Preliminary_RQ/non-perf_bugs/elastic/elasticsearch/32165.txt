{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32165","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32165/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32165/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32165/events","html_url":"https://github.com/elastic/elasticsearch/issues/32165","id":342301982,"node_id":"MDU6SXNzdWUzNDIzMDE5ODI=","number":32165,"title":"Feature request: minimum_nested_match","user":{"login":"robtesch","id":30407321,"node_id":"MDQ6VXNlcjMwNDA3MzIx","avatar_url":"https://avatars1.githubusercontent.com/u/30407321?v=4","gravatar_id":"","url":"https://api.github.com/users/robtesch","html_url":"https://github.com/robtesch","followers_url":"https://api.github.com/users/robtesch/followers","following_url":"https://api.github.com/users/robtesch/following{/other_user}","gists_url":"https://api.github.com/users/robtesch/gists{/gist_id}","starred_url":"https://api.github.com/users/robtesch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robtesch/subscriptions","organizations_url":"https://api.github.com/users/robtesch/orgs","repos_url":"https://api.github.com/users/robtesch/repos","events_url":"https://api.github.com/users/robtesch/events{/privacy}","received_events_url":"https://api.github.com/users/robtesch/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-07-18T12:13:34Z","updated_at":"2018-07-30T15:52:21Z","closed_at":"2018-07-30T15:52:21Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\nI would love to see an option of a nested query where instead of returning parent docs where any nested doc matches a nested query, there could be an option to return only parent docs when some minimum number of nested docs matched. Similar to the way we set up minimum_should_match. In my particular case I would want to only return parent docs where ALL the nested docs match a specific query.\r\n\r\nExample:\r\n\r\n```\r\nPUT test\r\n{\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"comments\": {\r\n          \"type\": \"nested\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n```\r\nPUT test/_doc/1?refresh\r\n{\r\n  \"title\": \"Test title\",\r\n  \"comments\": [\r\n    {\r\n      \"author\": \"kimchy\",\r\n      \"number\": 1\r\n    },\r\n    {\r\n      \"author\": \"nik9000\",\r\n      \"number\": 2\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n```\r\nPUT test/_doc/2?refresh\r\n{\r\n  \"title\": \"Test title 2\",\r\n  \"comments\": [\r\n    {\r\n      \"author\": \"kimchy\",\r\n      \"number\": 1\r\n    },\r\n    {\r\n      \"author\": \"kimchy\",\r\n      \"number\": 2\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nThen, in order to only match doc 2, where all the nested docs match the query:\r\n\r\n```\r\nPOST test/_search\r\n{\r\n  \"query\": {\r\n    \"nested\": {\r\n      \"path\": \"comments\",\r\n      \"query\": {\r\n        \"match\": {\"comments.author\" : \"kimchy\"}\r\n      },\r\n      \"minimum_nested_match\": \"100%\",\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nPerhaps there is already some way of doing this that I don't know about?","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}