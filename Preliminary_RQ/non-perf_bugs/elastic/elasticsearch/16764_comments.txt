[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/189930926","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-189930926","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":189930926,"node_id":"MDEyOklzc3VlQ29tbWVudDE4OTkzMDkyNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-28T19:36:11Z","updated_at":"2016-02-28T19:36:11Z","author_association":"CONTRIBUTOR","body":"@cbuescher has this already been dealt with in the suggester refactoring?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/190200941","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-190200941","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":190200941,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDIwMDk0MQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-02-29T13:01:21Z","updated_at":"2016-02-29T13:01:21Z","author_association":"MEMBER","body":"@clintongormley no, this is internal logic in the DirectCandidateGenerator that hasn't been changes by the refactoring, so it should be treated as a separate issue. The line pointed out was added by this commit (8235b89e9cd4f222ee689d47ca2ef4686b7a6971), so I assume there is a reason in overwriting the threshold when the suggest mode is ALWAYS.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/190224464","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-190224464","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":190224464,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDIyNDQ2NA==","user":{"login":"micpalmia","id":663003,"node_id":"MDQ6VXNlcjY2MzAwMw==","avatar_url":"https://avatars1.githubusercontent.com/u/663003?v=4","gravatar_id":"","url":"https://api.github.com/users/micpalmia","html_url":"https://github.com/micpalmia","followers_url":"https://api.github.com/users/micpalmia/followers","following_url":"https://api.github.com/users/micpalmia/following{/other_user}","gists_url":"https://api.github.com/users/micpalmia/gists{/gist_id}","starred_url":"https://api.github.com/users/micpalmia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/micpalmia/subscriptions","organizations_url":"https://api.github.com/users/micpalmia/orgs","repos_url":"https://api.github.com/users/micpalmia/repos","events_url":"https://api.github.com/users/micpalmia/events{/privacy}","received_events_url":"https://api.github.com/users/micpalmia/received_events","type":"User","site_admin":false},"created_at":"2016-02-29T14:06:03Z","updated_at":"2016-02-29T14:11:19Z","author_association":"CONTRIBUTOR","body":"The line has been _edited_ in the commit to have a separate logic when the suggest mode is `ALWAYS`, but shouldn't have been there in the first place, because whatever the suggest mode, that logic is already implemented at Lucene level (I think).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/190258473","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-190258473","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":190258473,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDI1ODQ3Mw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-02-29T15:33:39Z","updated_at":"2016-02-29T15:33:39Z","author_association":"MEMBER","body":"@micpalmia you are right. Looking at the code, the spellchecker inside DirectCandidateGenerator seems to get reused to calculate suggestions for each term in the phrase. To me it looks like the overwrite of the original value is needed to take into account the different term frequencies of all tokens in the phrase. The original `min_doc_freq` still comes into play via `frequencyPlateau`, so I'm not sure this is a bug. Maybe @s1monw can help here. Do you experience a particular problem with the `min_doc_freq` parameter for a particular setting?  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/190262479","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-190262479","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":190262479,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDI2MjQ3OQ==","user":{"login":"micpalmia","id":663003,"node_id":"MDQ6VXNlcjY2MzAwMw==","avatar_url":"https://avatars1.githubusercontent.com/u/663003?v=4","gravatar_id":"","url":"https://api.github.com/users/micpalmia","html_url":"https://github.com/micpalmia","followers_url":"https://api.github.com/users/micpalmia/followers","following_url":"https://api.github.com/users/micpalmia/following{/other_user}","gists_url":"https://api.github.com/users/micpalmia/gists{/gist_id}","starred_url":"https://api.github.com/users/micpalmia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/micpalmia/subscriptions","organizations_url":"https://api.github.com/users/micpalmia/orgs","repos_url":"https://api.github.com/users/micpalmia/repos","events_url":"https://api.github.com/users/micpalmia/events{/privacy}","received_events_url":"https://api.github.com/users/micpalmia/received_events","type":"User","site_admin":false},"created_at":"2016-02-29T15:44:26Z","updated_at":"2016-02-29T15:44:26Z","author_association":"CONTRIBUTOR","body":"Yes, I noticed a problem trying to tune a phrase suggester (that's why I realized something was fishy). I'm going to try producing a working sample showing the issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/190274861","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-190274861","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":190274861,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDI3NDg2MQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-02-29T16:20:26Z","updated_at":"2016-02-29T16:20:26Z","author_association":"CONTRIBUTOR","body":"@micpalmia we store the original frequency in the `DirectSpellchecker` ctor and then use it as the `frequencyPlateau` which is then in-turn returned from `thresholdFrequency(frequency, dictSize)` so it looks fine to me?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/224603645","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-224603645","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":224603645,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNDYwMzY0NQ==","user":{"login":"kaglowka","id":6314663,"node_id":"MDQ6VXNlcjYzMTQ2NjM=","avatar_url":"https://avatars1.githubusercontent.com/u/6314663?v=4","gravatar_id":"","url":"https://api.github.com/users/kaglowka","html_url":"https://github.com/kaglowka","followers_url":"https://api.github.com/users/kaglowka/followers","following_url":"https://api.github.com/users/kaglowka/following{/other_user}","gists_url":"https://api.github.com/users/kaglowka/gists{/gist_id}","starred_url":"https://api.github.com/users/kaglowka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaglowka/subscriptions","organizations_url":"https://api.github.com/users/kaglowka/orgs","repos_url":"https://api.github.com/users/kaglowka/repos","events_url":"https://api.github.com/users/kaglowka/events{/privacy}","received_events_url":"https://api.github.com/users/kaglowka/received_events","type":"User","site_admin":false},"created_at":"2016-06-08T14:18:39Z","updated_at":"2016-06-08T14:19:35Z","author_association":"NONE","body":"I've been playing around with a perfectly usual suggester case and no matter what value I use as min_doc_freq (either ridiculously high integer or any float value), I get equal results.\n\nI'm rather new to ElasticSearch so I don't exactly understand its inner mechanisms, but if the way min_doc_freq works is much subtler than that, maybe the documentation should be improved?\n\nI'm quoting my exact query so all parameters are explicitly set, but the same occurs for default parameters.\n\n```\n\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"suggest\": {\n    \"simple_phrase\": {\n      \"phrase\": {\n        \"field\": \"text_bigram\",\n        \"confidence\": 2.0,\n        \"smoothing\": {\n          \"stupid_backoff\": {\n            \"discount\": 0.1\n          }\n        },\n        \"gram_size\": 3,\n        \"direct_generator\": [\n          {\n            \"min_doc_freq\": 1000000,\n            \"max_term_freq\": 0.0001,\n            \"field\": \"text_raw\",\n            \"suggest_mode\": \"always\",\n            \"min_word_length\": 1,\n            \"max_edits\": 2\n          }\n        ],\n        \"real_word_error_likelihood\": 0.95,\n        \"max_errors\": 2,\n        \"size\": 3\n      },\n      \"text\": \"some text\"\n    }\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/224616646","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-224616646","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":224616646,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNDYxNjY0Ng==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-06-08T14:58:39Z","updated_at":"2016-06-08T14:58:39Z","author_association":"CONTRIBUTOR","body":"as said above with `\"suggest_mode\": \"always\",` the `\"min_doc_freq\": 1000000,` will be ignored since we always suggest!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302626470","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-302626470","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":302626470,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjYyNjQ3MA==","user":{"login":"azhuchkov","id":765471,"node_id":"MDQ6VXNlcjc2NTQ3MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/765471?v=4","gravatar_id":"","url":"https://api.github.com/users/azhuchkov","html_url":"https://github.com/azhuchkov","followers_url":"https://api.github.com/users/azhuchkov/followers","following_url":"https://api.github.com/users/azhuchkov/following{/other_user}","gists_url":"https://api.github.com/users/azhuchkov/gists{/gist_id}","starred_url":"https://api.github.com/users/azhuchkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azhuchkov/subscriptions","organizations_url":"https://api.github.com/users/azhuchkov/orgs","repos_url":"https://api.github.com/users/azhuchkov/repos","events_url":"https://api.github.com/users/azhuchkov/events{/privacy}","received_events_url":"https://api.github.com/users/azhuchkov/received_events","type":"User","site_admin":false},"created_at":"2017-05-19T07:06:51Z","updated_at":"2017-05-19T07:06:51Z","author_association":"NONE","body":"I use `\"suggest_mode\": \"missing\"` and it seems that `min_doc_freq` is totally ignored.\r\nPlayed with `accuracy` which i couldn't find documentation for: for values greater `0.9` the suggester stops advise anything.\r\nI'm using Elasticsearch `v2.4.4` .","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375472062","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-375472062","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":375472062,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTQ3MjA2Mg==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T22:01:50Z","updated_at":"2018-03-22T22:01:50Z","author_association":"CONTRIBUTOR","body":"This still occurs in master - phrase suggester will return a suggestion for a term that has a document frequency lower than `min_doc_freq`, regardless of `suggest_mode`\r\n\r\n```\r\nPUT doc-freq\r\n{\r\n  \"settings\": {\r\n    \"index\": {\r\n      \"number_of_shards\": 1,\r\n      \"number_of_replicas\": 0,\r\n      \"analysis\": {\r\n        \"analyzer\": {\r\n          \"trigram\": {\r\n            \"type\": \"custom\",\r\n            \"tokenizer\": \"standard\",\r\n            \"filter\": [\"standard\", \"shingle\"]\r\n          }\r\n        },\r\n        \"filter\": {\r\n          \"shingle\": {\r\n            \"type\": \"shingle\",\r\n            \"min_shingle_size\": 2,\r\n            \"max_shingle_size\": 3\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"message\": {\r\n          \"type\": \"text\",\r\n          \"fields\": {\r\n            \"suggest\": {\r\n              \"type\": \"text\",\r\n              \"analyzer\": \"trigram\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPUT doc-freq/_doc/1\r\n{\r\n  \"message\": \"potato vodka\"\r\n}\r\n\r\nPUT doc-freq/_doc/2\r\n{\r\n  \"message\": \"potato chips\"\r\n}\r\n\r\nPUT doc-freq/_doc/3\r\n{\r\n  \"message\": \"potato head\"\r\n}\r\n\r\n\r\nGET doc-freq/_search\r\n{\r\n  \"suggest\": {\r\n    \"text\": \"potayo bread\",\r\n    \"small_potatoes\": {\r\n      \"phrase\": {\r\n        \"field\": \"message.suggest\",\r\n        \"direct_generator\": [\r\n          {\r\n            \"field\": \"message.suggest\",\r\n            \"min_doc_freq\": 5,\r\n            \"suggest_mode\": \"popular\"\r\n          }\r\n        ]\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nSuggest result\r\n\r\n```\r\n{\r\n  \"took\": 1,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 1,\r\n    \"successful\": 1,\r\n    \"skipped\": 0,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 0,\r\n    \"max_score\": 0,\r\n    \"hits\": []\r\n  },\r\n  \"suggest\": {\r\n    \"small_potatoes\": [\r\n      {\r\n        \"text\": \"potayo\",\r\n        \"offset\": 0,\r\n        \"length\": 6,\r\n        \"options\": [\r\n          {\r\n            \"text\": \"potato\",\r\n            \"score\": 0.57332504\r\n          }\r\n        ]\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n@elastic/es-search-aggs ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/477595267","html_url":"https://github.com/elastic/elasticsearch/issues/16764#issuecomment-477595267","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16764","id":477595267,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzU5NTI2Nw==","user":{"login":"xrammit","id":3740851,"node_id":"MDQ6VXNlcjM3NDA4NTE=","avatar_url":"https://avatars3.githubusercontent.com/u/3740851?v=4","gravatar_id":"","url":"https://api.github.com/users/xrammit","html_url":"https://github.com/xrammit","followers_url":"https://api.github.com/users/xrammit/followers","following_url":"https://api.github.com/users/xrammit/following{/other_user}","gists_url":"https://api.github.com/users/xrammit/gists{/gist_id}","starred_url":"https://api.github.com/users/xrammit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xrammit/subscriptions","organizations_url":"https://api.github.com/users/xrammit/orgs","repos_url":"https://api.github.com/users/xrammit/repos","events_url":"https://api.github.com/users/xrammit/events{/privacy}","received_events_url":"https://api.github.com/users/xrammit/received_events","type":"User","site_admin":false},"created_at":"2019-03-28T13:30:16Z","updated_at":"2019-03-28T13:30:16Z","author_association":"NONE","body":"I experience the same issue as @andyb-elastic. Is there a solution, workaround or fix to get min_doc_freq working with the phrase suggester?","performed_via_github_app":null}]