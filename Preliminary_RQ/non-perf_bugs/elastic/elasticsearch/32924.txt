{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32924","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32924/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32924/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32924/events","html_url":"https://github.com/elastic/elasticsearch/issues/32924","id":351349547,"node_id":"MDU6SXNzdWUzNTEzNDk1NDc=","number":32924,"title":"Translog stuck shipping under 10mbs","user":{"login":"danielkasen","id":31549908,"node_id":"MDQ6VXNlcjMxNTQ5OTA4","avatar_url":"https://avatars1.githubusercontent.com/u/31549908?v=4","gravatar_id":"","url":"https://api.github.com/users/danielkasen","html_url":"https://github.com/danielkasen","followers_url":"https://api.github.com/users/danielkasen/followers","following_url":"https://api.github.com/users/danielkasen/following{/other_user}","gists_url":"https://api.github.com/users/danielkasen/gists{/gist_id}","starred_url":"https://api.github.com/users/danielkasen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielkasen/subscriptions","organizations_url":"https://api.github.com/users/danielkasen/orgs","repos_url":"https://api.github.com/users/danielkasen/repos","events_url":"https://api.github.com/users/danielkasen/events{/privacy}","received_events_url":"https://api.github.com/users/danielkasen/received_events","type":"User","site_admin":false},"labels":[{"id":152510590,"node_id":"MDU6TGFiZWwxNTI1MTA1OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Recovery","name":":Distributed/Recovery","color":"0e8a16","default":false,"description":"Anything around constructing a new shard, either from a local or a remote source."},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2018-08-16T20:05:50Z","updated_at":"2018-09-17T21:59:34Z","closed_at":"2018-08-17T12:58:17Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.3.2\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): openJDK 8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Ubuntu 14.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nTranslog during recovery is extremely slow. Watching the network traffic between the primary and the replica catching up the translog is only shipped at about 8mbs. Testing shows that traffic between these hosts can top 300Mbs and no other activity is occuring during this time.  Setting the max_bytes_per_sec to a high level doesn't have any effect either.\r\n\r\n```max_bytes_per_sec\": \"2000mb\"```\r\n\r\n\r\nFull Cluster Settings:\r\n```{\r\n  \"persistent\": {\r\n    \"cluster\": {\r\n      \"routing\": {\r\n        \"use_adaptive_replica_selection\": \"true\",\r\n        \"rebalance\": {\r\n          \"enable\": \"none\"\r\n        },\r\n        \"allocation\": {\r\n          \"disk\": {\r\n            \"watermark\": {\r\n              \"low\": \"400gb\",\r\n              \"flood_stage\": \"50gb\",\r\n              \"high\": \"200gb\"\r\n            }\r\n          },\r\n          \"node_initial_primaries_recoveries\": \"45\",\r\n          \"awareness\": {\r\n            \"attributes\": \"rack_id\"\r\n          },\r\n          \"balance\": {\r\n            \"threshold\": \"2.6f\",\r\n            \"shard\": \"0.40f\"\r\n          },\r\n          \"enable\": \"all\",\r\n          \"allow_rebalance\": \"indices_all_active\",\r\n          \"cluster_concurrent_rebalance\": \"10\",\r\n          \"node_concurrent_recoveries\": \"15\"\r\n        }\r\n      },\r\n      \"info\": {\r\n        \"update\": {\r\n          \"interval\": \"30s\"\r\n        }\r\n      }\r\n    },\r\n    \"indices\": {\r\n      \"breaker\": {\r\n        \"fielddata\": {\r\n          \"limit\": \"21%\"\r\n        },\r\n        \"request\": {\r\n          \"limit\": \"40%\"\r\n        },\r\n        \"total\": {\r\n          \"limit\": \"70%\"\r\n        }\r\n      },\r\n      \"recovery\": {\r\n        \"max_bytes_per_sec\": \"2000mb\"\r\n      }\r\n    },\r\n    \"search\": {\r\n      \"default_search_timeout\": \"30s\",\r\n      \"low_level_cancellation\": \"true\"\r\n    },\r\n    \"discovery\": {\r\n      \"zen\": {\r\n        \"minimum_master_nodes\": \"4\"\r\n      }\r\n    },\r\n    \"xpack\": {\r\n      \"monitoring\": {\r\n        \"collection\": {\r\n          \"enabled\": \"true\"\r\n        },\r\n        \"history\": {\r\n          \"duration\": \"14d\"\r\n        }\r\n      }\r\n    },\r\n    \"network\": {\r\n      \"breaker\": {\r\n        \"inflight_requests\": {\r\n          \"limit\": \"90%\"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"transient\": {}\r\n}```","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}