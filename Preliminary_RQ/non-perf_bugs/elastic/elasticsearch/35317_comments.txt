[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436415497","html_url":"https://github.com/elastic/elasticsearch/issues/35317#issuecomment-436415497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35317","id":436415497,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjQxNTQ5Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-11-06T21:30:15Z","updated_at":"2018-11-06T21:30:15Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436562605","html_url":"https://github.com/elastic/elasticsearch/issues/35317#issuecomment-436562605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35317","id":436562605,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjU2MjYwNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-11-07T09:36:07Z","updated_at":"2018-11-07T09:36:07Z","author_association":"MEMBER","body":"> This, however, breaks when the index is entirely empty (even if the mapping has the timestamp field), or if all the documents in the index are lacking the timestamp.\r\n\r\nThe error is thrown only if the field is unmapped so I guess that it happened because `logstash-2015.05.21` was created without the `utc_time` field. \r\n\r\n> We could fix this by setting missing_bucket: true on the date_histogram, and then adding an exists(timestamp) filter to the composite's query.\r\n\r\nThis would disable the optimization in the `composite` aggregation when the query matches all documents. However I don't think we should throw an error if the field is unmapped so I opened https://github.com/elastic/elasticsearch/pull/35331 to remove this limitation. It was there because such query is guaranteed to never create any bucket but this is not the expected behavior. We should just return an empty response in that case.","performed_via_github_app":null}]