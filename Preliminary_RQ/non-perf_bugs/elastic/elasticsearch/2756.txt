{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2756","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2756/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2756/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2756/events","html_url":"https://github.com/elastic/elasticsearch/issues/2756","id":11850694,"node_id":"MDU6SXNzdWUxMTg1MDY5NA==","number":2756,"title":"change geo_shape default configuration","user":{"login":"jillesvangurp","id":819187,"node_id":"MDQ6VXNlcjgxOTE4Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/819187?v=4","gravatar_id":"","url":"https://api.github.com/users/jillesvangurp","html_url":"https://github.com/jillesvangurp","followers_url":"https://api.github.com/users/jillesvangurp/followers","following_url":"https://api.github.com/users/jillesvangurp/following{/other_user}","gists_url":"https://api.github.com/users/jillesvangurp/gists{/gist_id}","starred_url":"https://api.github.com/users/jillesvangurp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jillesvangurp/subscriptions","organizations_url":"https://api.github.com/users/jillesvangurp/orgs","repos_url":"https://api.github.com/users/jillesvangurp/repos","events_url":"https://api.github.com/users/jillesvangurp/events{/privacy}","received_events_url":"https://api.github.com/users/jillesvangurp/received_events","type":"User","site_admin":false},"labels":[{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":29805870,"node_id":"MDU6TGFiZWwyOTgwNTg3MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.0.RC1","name":"v0.90.0.RC1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2013-03-10T10:29:43Z","updated_at":"2013-03-20T14:10:31Z","closed_at":"2013-03-20T14:02:28Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Currently geo_shape defaults to the geohash implementation and a rather high tree_levels setting. I've been testing with some open street map data consisting of about 120K points, polygons, and linestrings in the Brandenburg area on Simon Willnauer's lucene 4.2 branch which is about to be merged in the next few days. The pre lucene 4.2 geo_shape seems to have severe accuracy problems currently.\n\nWhen I index this data with the default settings (geohash, tree_levels=24), I end up with nearly a GB of index data (the raw data is 35MB). Indexing takes nearly ten minutes using the bulk api, batches of 500, and with six threads Reducing the tree_levels to 9 reduces the index size substantially. However with this setting, the accuracy drops significantly and such indiceses are useless for searching unless you find margins of errors measured in kilometers acceptable.\n\nI've also tested with the quadtree implementation. The default setting for this offers very poor accuracy and returns tens of thousands of results for queries that should return only a few dozen results. However, increasing the tree_levels to 20 results in pretty good accuracy (a few tens of meters margin of error) and an index size of only 72MB, which is very reasonable and it indexes in seconds. Increasing the tree_levels to 25 increases the index size to half a GB and the accuracy improves to being comparable with geohash at its default settings.\n\nBased on this, I would like the defaults for geo_shape to be changed as follows:\n1) make quadtree the default implementation. I think that overall it offers better index size, indexing speed than geo_hash. A smaller index size also means it probably performs better on queries and uses less memory.\n2) increase default tree_levels for quadtree to 20. This seems to give a reasonable tradeoff between index size, indexing speed, and accuracy. The user can increase it for better accuracy. The current default does not provide anywhere near acceptable levels of accuracy.\n","closed_by":{"login":"jillesvangurp","id":819187,"node_id":"MDQ6VXNlcjgxOTE4Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/819187?v=4","gravatar_id":"","url":"https://api.github.com/users/jillesvangurp","html_url":"https://github.com/jillesvangurp","followers_url":"https://api.github.com/users/jillesvangurp/followers","following_url":"https://api.github.com/users/jillesvangurp/following{/other_user}","gists_url":"https://api.github.com/users/jillesvangurp/gists{/gist_id}","starred_url":"https://api.github.com/users/jillesvangurp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jillesvangurp/subscriptions","organizations_url":"https://api.github.com/users/jillesvangurp/orgs","repos_url":"https://api.github.com/users/jillesvangurp/repos","events_url":"https://api.github.com/users/jillesvangurp/events{/privacy}","received_events_url":"https://api.github.com/users/jillesvangurp/received_events","type":"User","site_admin":false},"performed_via_github_app":null}