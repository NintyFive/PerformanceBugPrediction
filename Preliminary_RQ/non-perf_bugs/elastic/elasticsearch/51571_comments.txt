[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/579453135","html_url":"https://github.com/elastic/elasticsearch/issues/51571#issuecomment-579453135","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51571","id":579453135,"node_id":"MDEyOklzc3VlQ29tbWVudDU3OTQ1MzEzNQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-28T20:59:49Z","updated_at":"2020-01-28T20:59:49Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/579653518","html_url":"https://github.com/elastic/elasticsearch/issues/51571#issuecomment-579653518","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51571","id":579653518,"node_id":"MDEyOklzc3VlQ29tbWVudDU3OTY1MzUxOA==","user":{"login":"przemekwitek","id":19312454,"node_id":"MDQ6VXNlcjE5MzEyNDU0","avatar_url":"https://avatars3.githubusercontent.com/u/19312454?v=4","gravatar_id":"","url":"https://api.github.com/users/przemekwitek","html_url":"https://github.com/przemekwitek","followers_url":"https://api.github.com/users/przemekwitek/followers","following_url":"https://api.github.com/users/przemekwitek/following{/other_user}","gists_url":"https://api.github.com/users/przemekwitek/gists{/gist_id}","starred_url":"https://api.github.com/users/przemekwitek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/przemekwitek/subscriptions","organizations_url":"https://api.github.com/users/przemekwitek/orgs","repos_url":"https://api.github.com/users/przemekwitek/repos","events_url":"https://api.github.com/users/przemekwitek/events{/privacy}","received_events_url":"https://api.github.com/users/przemekwitek/received_events","type":"User","site_admin":false},"created_at":"2020-01-29T08:44:54Z","updated_at":"2020-01-29T11:36:32Z","author_association":"CONTRIBUTOR","body":"I confirm the issue reproduces locally:\r\n\r\n```\r\n./gradlew ':x-pack:plugin:ml:qa:native-multi-node-tests:integTestRunner' --tests \"org.elasticsearch.xpack.ml.integration.RegressionIT.testTwoJobsWithSameRandomizeSeedUseSameTrainingSet\" -Dtests.seed=E3C249C1E87C9FA7\r\n```\r\n\r\nInvestigating...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/579717643","html_url":"https://github.com/elastic/elasticsearch/issues/51571#issuecomment-579717643","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51571","id":579717643,"node_id":"MDEyOklzc3VlQ29tbWVudDU3OTcxNzY0Mw==","user":{"login":"przemekwitek","id":19312454,"node_id":"MDQ6VXNlcjE5MzEyNDU0","avatar_url":"https://avatars3.githubusercontent.com/u/19312454?v=4","gravatar_id":"","url":"https://api.github.com/users/przemekwitek","html_url":"https://github.com/przemekwitek","followers_url":"https://api.github.com/users/przemekwitek/followers","following_url":"https://api.github.com/users/przemekwitek/following{/other_user}","gists_url":"https://api.github.com/users/przemekwitek/gists{/gist_id}","starred_url":"https://api.github.com/users/przemekwitek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/przemekwitek/subscriptions","organizations_url":"https://api.github.com/users/przemekwitek/orgs","repos_url":"https://api.github.com/users/przemekwitek/repos","events_url":"https://api.github.com/users/przemekwitek/events{/privacy}","received_events_url":"https://api.github.com/users/przemekwitek/received_events","type":"User","site_admin":false},"created_at":"2020-01-29T11:41:43Z","updated_at":"2020-01-29T11:41:43Z","author_association":"CONTRIBUTOR","body":"Ok, I've found the issue.\r\nThis test case indexes 10 documents and has training percent set to 50.\r\nHowever, it can be that all of the random calls return numbers higher than `0.5` which causes all the examples to be excluded from training:\r\n```\r\n[2020-01-29T12:30:07,830][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.6923209054412393; 50.0\r\n[2020-01-29T12:30:07,830][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.755324823152699; 50.0\r\n[2020-01-29T12:30:07,831][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.5600728068340819; 50.0\r\n[2020-01-29T12:30:07,831][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.7280525932090374; 50.0\r\n[2020-01-29T12:30:07,832][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.8775797848144333; 50.0\r\n[2020-01-29T12:30:07,833][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.8040889874637709; 50.0\r\n[2020-01-29T12:30:07,833][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.8704748173643492; 50.0\r\n[2020-01-29T12:30:07,833][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.7303731017813292; 50.0\r\n[2020-01-29T12:30:07,834][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.86768681822612; 50.0\r\n[2020-01-29T12:30:07,834][WARN ][stderr                   ] [integTest-0] XXX XXX XXX true; 0.9086306223273044; 50.0\r\n```\r\n\r\nSo increasing the number of docs would solve the issue. However, I'm going to fix the `DatasetSplittingCustomProcessor` as well as for some reason it doesn't keep one row for training as it's supposed to in this snippet:\r\n```\r\n    @Override\r\n    public void process(String[] row) {\r\n        if (canBeUsedForTraining(row)) {\r\n            if (isFirstRow) {\r\n                // Let's make sure we have at least one training row\r\n                isFirstRow = false;\r\n            } else if (isRandomlyExcludedFromTraining()) {\r\n                row[dependentVariableIndex] = EMPTY;\r\n            }\r\n        }\r\n    }\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/585077878","html_url":"https://github.com/elastic/elasticsearch/issues/51571#issuecomment-585077878","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51571","id":585077878,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTA3Nzg3OA==","user":{"login":"przemekwitek","id":19312454,"node_id":"MDQ6VXNlcjE5MzEyNDU0","avatar_url":"https://avatars3.githubusercontent.com/u/19312454?v=4","gravatar_id":"","url":"https://api.github.com/users/przemekwitek","html_url":"https://github.com/przemekwitek","followers_url":"https://api.github.com/users/przemekwitek/followers","following_url":"https://api.github.com/users/przemekwitek/following{/other_user}","gists_url":"https://api.github.com/users/przemekwitek/gists{/gist_id}","starred_url":"https://api.github.com/users/przemekwitek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/przemekwitek/subscriptions","organizations_url":"https://api.github.com/users/przemekwitek/orgs","repos_url":"https://api.github.com/users/przemekwitek/repos","events_url":"https://api.github.com/users/przemekwitek/events{/privacy}","received_events_url":"https://api.github.com/users/przemekwitek/received_events","type":"User","site_admin":false},"created_at":"2020-02-12T07:55:25Z","updated_at":"2020-02-12T07:55:25Z","author_association":"CONTRIBUTOR","body":"Closing the issue as the immediate problem is solved i.e. the test no longer fails.\r\nMaking error reporting in case of too little training examples more robust is out of scope of this GH issue.","performed_via_github_app":null}]