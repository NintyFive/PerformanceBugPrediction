[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252586059","html_url":"https://github.com/elastic/elasticsearch/issues/20828#issuecomment-252586059","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20828","id":252586059,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjU4NjA1OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T10:53:21Z","updated_at":"2016-10-10T10:53:21Z","author_association":"MEMBER","body":"The processors limitation isn't directly about physical memory. In general it's about limiting the number of threads; with the various thread pools that are sized as a function of the number of logical processors, Elasticsearch creates a tremendous number of threads. \n- this can lead to `OutOfMemoryException` if `ulimit -u` is too low (note that the message in this case is `unable to create native threads`, I've always considered `OutOfMemoryException` to a be poor choice for this underlying cause)\n- each thread does have a fixed memory cost (1 MB per thread for its stack with the JVM defaults on a 64-bit JVM) although this is off heap; on a machine with 32 logical processors Elasticsearch creates hundreds of threads\n- these threads have to be scheduled on actual cores; if there are way more runnable threads than there are actual cores, the OS will just spend all its time context switching across the threads and this is bad for performance\n\nI do wonder what the underlying reason for this question is though?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252594171","html_url":"https://github.com/elastic/elasticsearch/issues/20828#issuecomment-252594171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20828","id":252594171,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjU5NDE3MQ==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T11:34:26Z","updated_at":"2016-10-10T11:34:26Z","author_association":"CONTRIBUTOR","body":"Thanks @jasontedor. I was a bit mislead (and didn't look at the error itself properly in https://github.com/elastic/elasticsearch/issues/3478) by the description of the previous issue where the author mentioned RAM size.\n\n> if there are way more runnable threads than there are actual cores, the OS will just spend all its time context switching across the threads\n\nThe size of the thread pools is sized according to the number of processors and on a machine with X cores (X<=32) we create the thread pools according to our defaults for each type of pool. So, the number of runnable threads compared to the number of cores should have the same ratio for 32 cores or 48 cores.\n\nWe also support the multi nodes per physical machine scenario where a 48 cores machine divided by 3 ES nodes (with proper `processors` setting) would create more threads in total than a single ES node on the same machine since a `processors: 16` wouldn't break the 32 limit.\n\n> if `ulimit -u` is too low\n\nAnd this can be adjusted accordingly I suppose.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252594863","html_url":"https://github.com/elastic/elasticsearch/issues/20828#issuecomment-252594863","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20828","id":252594863,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjU5NDg2Mw==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T11:37:44Z","updated_at":"2016-10-10T11:37:44Z","author_association":"CONTRIBUTOR","body":"No hidden reason :-), just want to understand the limits and the recommendations we can make.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252681579","html_url":"https://github.com/elastic/elasticsearch/issues/20828#issuecomment-252681579","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20828","id":252681579,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjY4MTU3OQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T17:10:11Z","updated_at":"2016-10-10T17:10:19Z","author_association":"CONTRIBUTOR","body":"I agree with @astefan that there is something we should do there. Either we should remove this artificial limit so that the default configuration can make use of all resources of a machine, or we should keep it and add a note to our setup instructions to configure the number of processors in the `elasticsearch.yml` on machines that have more than 32 processors.\n\nMy preference would be to remove this limit and make Elasticsearch more reasonable about the number of threads. For instance there is no reason to have different threadpools for `bulk` and `index`, or for `search` and `get`: these are exactly the same operations.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252682037","html_url":"https://github.com/elastic/elasticsearch/issues/20828#issuecomment-252682037","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20828","id":252682037,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjY4MjAzNw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T17:12:11Z","updated_at":"2016-10-10T17:12:11Z","author_association":"CONTRIBUTOR","body":"Also for the record, the situation might already be a bit better today than when the limit was introduced, for instance we divided the size of the `search` threadpool by 2 and removed the `percolate` thread pool (since percolation is now a `search` operation).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252687501","html_url":"https://github.com/elastic/elasticsearch/issues/20828#issuecomment-252687501","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20828","id":252687501,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjY4NzUwMQ==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T17:34:06Z","updated_at":"2016-10-10T17:34:06Z","author_association":"CONTRIBUTOR","body":"> My preference would be to remove this limit and make Elasticsearch more reasonable about the number of threads.\n\n+1\n\nOn my 72 core box I have to override that default 32 max core count.\n","performed_via_github_app":null}]