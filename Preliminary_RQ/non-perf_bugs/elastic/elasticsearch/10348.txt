{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10348","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10348/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10348/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10348/events","html_url":"https://github.com/elastic/elasticsearch/issues/10348","id":65522402,"node_id":"MDU6SXNzdWU2NTUyMjQwMg==","number":10348,"title":"Provide a query profiling api","user":{"login":"kamaradclimber","id":503537,"node_id":"MDQ6VXNlcjUwMzUzNw==","avatar_url":"https://avatars1.githubusercontent.com/u/503537?v=4","gravatar_id":"","url":"https://api.github.com/users/kamaradclimber","html_url":"https://github.com/kamaradclimber","followers_url":"https://api.github.com/users/kamaradclimber/followers","following_url":"https://api.github.com/users/kamaradclimber/following{/other_user}","gists_url":"https://api.github.com/users/kamaradclimber/gists{/gist_id}","starred_url":"https://api.github.com/users/kamaradclimber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamaradclimber/subscriptions","organizations_url":"https://api.github.com/users/kamaradclimber/orgs","repos_url":"https://api.github.com/users/kamaradclimber/repos","events_url":"https://api.github.com/users/kamaradclimber/events{/privacy}","received_events_url":"https://api.github.com/users/kamaradclimber/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"assignees":[{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2015-03-31T18:58:53Z","updated_at":"2015-04-05T14:41:14Z","closed_at":"2015-04-05T14:41:14Z","author_association":"NONE","active_lock_reason":null,"body":"It would be useful to get a query profiling api to help users understand which part of the query/filter/aggregation takes time.\n## Context\n\nWhen preparing queries that will be run frequently, it is hard to predict query performance on large datasets.\nCauses I can think of:\n- filters caches already created or not\n- data being indexed (invalidating caches at each merge?)\n- field cardinality\n- custom parameters defined in mapping (e.g precision for longs)\n- query/filter operand orders\n\nCurrent solution, involves testing each query/filter part (each operand) independently (at least) 3 times to warm caches, with and without data being written. This gives hints but does not help building complex queries/filters/aggregations. \n## Suggestion\n\nHaving a query profiling api could help users find:\n- whether query/filter is slow or fast compared to fetch\n- whether a filter is properly cached or if cache has to be created\n- whether order has impact on query time\n- if given filter/query operand improves the query time (or not)\n- if times is spent on \"shard phase\"  or on \"merge phase\" (maybe not using the correct terms)\n\nIt seems to have been asked [before](http://elasticsearch-users.115913.n3.nabble.com/Tracing-query-execution-td3648329.html).\nSeveral databases provide this kind of api: [sql server](https://technet.microsoft.com/en-us/library/ms178071%28v=sql.105%29.aspx) (through execution plan), [solr](https://wiki.apache.org/solr/CommonQueryParameters) (debug=timing/query), [mongodb](http://docs.mongodb.org/manual/reference/method/cursor.explain/)\n\nI understand than ES query model is different from solr, but I think there is a possible improvement to help testing thoughfully instead of following the numerous advices (\"term\" query is faster than xxx, \"filter x\" is better because it can be cached) that we currently find on the net.\n\nI'd be happy to provide more details on my use case if necessary (target is to store time series in ES).\n\nWhat do you think?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}