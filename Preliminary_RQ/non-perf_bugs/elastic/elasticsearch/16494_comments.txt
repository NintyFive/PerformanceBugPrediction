[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/181258725","html_url":"https://github.com/elastic/elasticsearch/issues/16494#issuecomment-181258725","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16494","id":181258725,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MTI1ODcyNQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-02-08T08:50:51Z","updated_at":"2016-02-08T08:50:51Z","author_association":"CONTRIBUTOR","body":"Putting aside your passive aggressive voice on this ticket, I think you are totally missing to communicate your usecase. Are you embedding Elasticsearch, if so there is no jarhell checks. Are you using Elasticsaerch as a client application then there is not jarhell check. Are you building a plugin then you have to provide a clean classpath that's just what we agreed on which prevents bugs rather than being one. If you are using our test-framework and running into jarhell then you can disable this now with `2.2`. \n\nA general advice or a personal note, if you feel like you need help on an open source project no matter if backed by a company or a foundation it's wise to be friendly and to explain your problem on a technical level. Statements like this:\n\n> Setting aside the huge bugs with running under a security manager which the Elasticsearch developers appear to be unwilling to fix but which can be worked around for now by granting additional security privileges to the wildcard code source, JarHell then proceeds to crash, complaining about other issues. Some of its complaints are legit, others not so much.\n\nare not helpful and don't make anybody want to help you. Even further is a reference of your attitude on the internet which I think needs to be put out there with care. I don't expect you to respond to this but I felt like I am putting it out there. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/181554067","html_url":"https://github.com/elastic/elasticsearch/issues/16494#issuecomment-181554067","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16494","id":181554067,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MTU1NDA2Nw==","user":{"login":"trejkaz","id":43236,"node_id":"MDQ6VXNlcjQzMjM2","avatar_url":"https://avatars2.githubusercontent.com/u/43236?v=4","gravatar_id":"","url":"https://api.github.com/users/trejkaz","html_url":"https://github.com/trejkaz","followers_url":"https://api.github.com/users/trejkaz/followers","following_url":"https://api.github.com/users/trejkaz/following{/other_user}","gists_url":"https://api.github.com/users/trejkaz/gists{/gist_id}","starred_url":"https://api.github.com/users/trejkaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trejkaz/subscriptions","organizations_url":"https://api.github.com/users/trejkaz/orgs","repos_url":"https://api.github.com/users/trejkaz/repos","events_url":"https://api.github.com/users/trejkaz/events{/privacy}","received_events_url":"https://api.github.com/users/trejkaz/received_events","type":"User","site_admin":false},"created_at":"2016-02-08T20:26:43Z","updated_at":"2016-02-08T20:26:43Z","author_association":"NONE","body":"We're embedding it, but the JarHell checks are still being done.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/181565167","html_url":"https://github.com/elastic/elasticsearch/issues/16494#issuecomment-181565167","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16494","id":181565167,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MTU2NTE2Nw==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-02-08T20:58:24Z","updated_at":"2016-02-08T20:58:24Z","author_association":"CONTRIBUTOR","body":"are you installing plugins?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/181591014","html_url":"https://github.com/elastic/elasticsearch/issues/16494#issuecomment-181591014","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16494","id":181591014,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MTU5MTAxNA==","user":{"login":"trejkaz","id":43236,"node_id":"MDQ6VXNlcjQzMjM2","avatar_url":"https://avatars2.githubusercontent.com/u/43236?v=4","gravatar_id":"","url":"https://api.github.com/users/trejkaz","html_url":"https://github.com/trejkaz","followers_url":"https://api.github.com/users/trejkaz/followers","following_url":"https://api.github.com/users/trejkaz/following{/other_user}","gists_url":"https://api.github.com/users/trejkaz/gists{/gist_id}","starred_url":"https://api.github.com/users/trejkaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trejkaz/subscriptions","organizations_url":"https://api.github.com/users/trejkaz/orgs","repos_url":"https://api.github.com/users/trejkaz/repos","events_url":"https://api.github.com/users/trejkaz/events{/privacy}","received_events_url":"https://api.github.com/users/trejkaz/received_events","type":"User","site_admin":false},"created_at":"2016-02-08T22:10:06Z","updated_at":"2016-02-08T22:10:06Z","author_association":"NONE","body":"Yeah, we have the analysis-icu and analysis-kuromoji plugins present.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/181594617","html_url":"https://github.com/elastic/elasticsearch/issues/16494#issuecomment-181594617","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16494","id":181594617,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MTU5NDYxNw==","user":{"login":"trejkaz","id":43236,"node_id":"MDQ6VXNlcjQzMjM2","avatar_url":"https://avatars2.githubusercontent.com/u/43236?v=4","gravatar_id":"","url":"https://api.github.com/users/trejkaz","html_url":"https://github.com/trejkaz","followers_url":"https://api.github.com/users/trejkaz/followers","following_url":"https://api.github.com/users/trejkaz/following{/other_user}","gists_url":"https://api.github.com/users/trejkaz/gists{/gist_id}","starred_url":"https://api.github.com/users/trejkaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trejkaz/subscriptions","organizations_url":"https://api.github.com/users/trejkaz/orgs","repos_url":"https://api.github.com/users/trejkaz/repos","events_url":"https://api.github.com/users/trejkaz/events{/privacy}","received_events_url":"https://api.github.com/users/trejkaz/received_events","type":"User","site_admin":false},"created_at":"2016-02-08T22:17:46Z","updated_at":"2016-02-08T22:17:46Z","author_association":"NONE","body":"Sample test:\n\n```\nimport java.io.File;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\nimport java.nio.file.Paths;\n\nimport org.elasticsearch.client.Client;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.node.Node;\nimport org.junit.Rule;\nimport org.junit.Test;\nimport org.junit.rules.TemporaryFolder;\n\nimport static org.elasticsearch.node.NodeBuilder.*;\n\npublic class TestEmbeddedElasticSearch\n{\n    @Rule\n    public final TemporaryFolder temporaryFolder = new TemporaryFolder();\n\n    @Test\n    public void test() throws Exception\n    {\n        try (Node node = createNode();\n             Client client = node.client())\n        {\n\n        }\n    }\n\n    private Node createNode() throws Exception\n    {\n        File nodeHome = temporaryFolder.newFolder();\n        Path pluginsPath = Paths.get(\"storage-core/build/elasticsearch-plugins\");\n        if (!Files.exists(pluginsPath))\n        {\n            throw new IllegalStateException(\"Could not find ES plugins path. Tests will fail. Plugin path: \" + pluginsPath);\n        }\n\n        return nodeBuilder()\n            .settings(Settings.settingsBuilder()\n                              .put(\"path.home\", nodeHome.getAbsolutePath())\n                              .put(\"path.plugins\", pluginsPath.toString())\n                              .put(\"index.number_of_shards\", 1)\n                              .put(\"index.number_of_replicas\", 0)\n                              .put(\"node.http.enabled\", \"false\"))\n            .local(true)\n            .node();\n    }\n}\n```\n\nFails with:\n\n```\njava.lang.IllegalStateException: failed to load bundle [] due to jar hell\n\n    at org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:421)\n    at org.elasticsearch.plugins.PluginsService.<init>(PluginsService.java:129)\n    at org.elasticsearch.node.Node.<init>(Node.java:146)\n    at org.elasticsearch.node.Node.<init>(Node.java:128)\n    at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:145)\n    at org.elasticsearch.node.NodeBuilder.node(NodeBuilder.java:152)\n    at TestEmbeddedElasticSearch.createNode(TestEmbeddedElasticSearch.java:49)\n    at TestEmbeddedElasticSearch.test(TestEmbeddedElasticSearch.java:25)\n    ...junit launcher stuff...\nCaused by: java.lang.IllegalStateException: jar hell!\nclass: org.apache.commons.logging.impl.NoOpLog\njar1: /Users/daniel/.gradle/caches/modules-2/files-2.1/commons-logging/commons-logging/1.1.3/f6f66e966c70a83ffbdb6f17a0919eaf7c8aca7f/commons-logging-1.1.3.jar\njar2: /Users/daniel/.gradle/caches/modules-2/files-2.1/org.slf4j/jcl-over-slf4j/1.7.12/adef7a9e1263298255fdb5cb107ff171d07c82f3/jcl-over-slf4j-1.7.12.jar\n    at org.elasticsearch.bootstrap.JarHell.checkClass(JarHell.java:280)\n    at org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:186)\n    at org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:419)\n    ... 30 more\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/181611583","html_url":"https://github.com/elastic/elasticsearch/issues/16494#issuecomment-181611583","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16494","id":181611583,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MTYxMTU4Mw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-02-08T23:00:18Z","updated_at":"2016-02-08T23:00:18Z","author_association":"MEMBER","body":"@trejkaz I see your test is trying to run an elasticsearch node in the same process as your tests, along with having plugins already installed in a \"special directory\". This won't work because the plugin service is meant to be used by elasticsearch running as a server, which is what starting a node in the way you are does.  In the master branch of ES, we have removed NodeBuilder and replaced it with simply constructing a Node, which takes \"classpath plugins\". These are what tests use (like ESIntegTestCase), as they expect the plugins and ES to be in the same test process. I would recommend using that test case as a base, or creating a subclass of `Node` to use the constructor that is now exposed in master.\n\nHowever, a better solution to test the real integration here would be to start ES in a separate process. This is what our integration tests do in 2.x and master, and it has proven to be very useful for testing how things interact with ES in a realistic way.  If developing a plugin, and using the shared POM in 2.x (or the gradle plugin in master), you can utilize the existing build infrastructure to start the ES node and install plugins before integ tests start.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/181677849","html_url":"https://github.com/elastic/elasticsearch/issues/16494#issuecomment-181677849","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16494","id":181677849,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MTY3Nzg0OQ==","user":{"login":"trejkaz","id":43236,"node_id":"MDQ6VXNlcjQzMjM2","avatar_url":"https://avatars2.githubusercontent.com/u/43236?v=4","gravatar_id":"","url":"https://api.github.com/users/trejkaz","html_url":"https://github.com/trejkaz","followers_url":"https://api.github.com/users/trejkaz/followers","following_url":"https://api.github.com/users/trejkaz/following{/other_user}","gists_url":"https://api.github.com/users/trejkaz/gists{/gist_id}","starred_url":"https://api.github.com/users/trejkaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trejkaz/subscriptions","organizations_url":"https://api.github.com/users/trejkaz/orgs","repos_url":"https://api.github.com/users/trejkaz/repos","events_url":"https://api.github.com/users/trejkaz/events{/privacy}","received_events_url":"https://api.github.com/users/trejkaz/received_events","type":"User","site_admin":false},"created_at":"2016-02-09T02:49:23Z","updated_at":"2016-02-09T02:49:23Z","author_association":"NONE","body":"This workaround works, using\n\n```\n    Environment environment = InternalSettingsPreparer.prepareEnvironment(settings, null);\n    Collection<Class<? extends Plugin>> plugins = ImmutableList.of(AnalysisICUPlugin.class, AnalysisKuromojiPlugin.class);\n    return new Node(environment, Version.CURRENT, plugins){}.start();\n```\n\ninstead of the builder. The settings are identical. And in many ways, having the plugins loaded from the classpath is much nicer anyway.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/181922340","html_url":"https://github.com/elastic/elasticsearch/issues/16494#issuecomment-181922340","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16494","id":181922340,"node_id":"MDEyOklzc3VlQ29tbWVudDE4MTkyMjM0MA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-02-09T15:49:44Z","updated_at":"2016-02-09T15:49:44Z","author_association":"CONTRIBUTOR","body":"oh great you found a solution.\n","performed_via_github_app":null}]