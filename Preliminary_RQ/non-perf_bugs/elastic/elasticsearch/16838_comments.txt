[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/189979873","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-189979873","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":189979873,"node_id":"MDEyOklzc3VlQ29tbWVudDE4OTk3OTg3Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-29T00:24:56Z","updated_at":"2016-02-29T00:24:56Z","author_association":"CONTRIBUTOR","body":"@colings86 any thoughts on this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/190210463","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-190210463","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":190210463,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDIxMDQ2Mw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2016-02-29T13:25:24Z","updated_at":"2016-02-29T13:25:24Z","author_association":"MEMBER","body":"I managed to reproduce this on the master branch and now know why this is happening but I don't have a solution as to how we can fix it short of just documenting that you can't order by an aggregation within a nested aggregation.\n\nThe issue is that the `NestedAggregatorFactory.createInternal()` method calls `AggregatorFactory.asMultiBucketAggregator()`. This creates a wrapper around the `NestedAggregator` that will create a separate instance of `NestedAggregator` for each parent bucket. We do this in the `NestedAggregator` to ensure the doc ids are delivered in order because with a single instance and multi-valued nested fields we could get documents not in order. Some of the aggregations rely on the fact that documents are collected in order. For example, we could collect (doc1, bucket1), (doc2, bucket1), (doc1, bucket2), (doc2, bucket2) which would be out of order, so by having separate instances we are guaranteeing docId order since each instance will only collect one bucket.\n\nI tried to change the `AggregationPath.validate()` method to use the underlying aggregator (the first instance of it at least) but then it fails later because we need to retrieve the value from the aggregator and there is no way of getting the value from a particular instance form the wrapper.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/204847403","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-204847403","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":204847403,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNDg0NzQwMw==","user":{"login":"aresn","id":1193680,"node_id":"MDQ6VXNlcjExOTM2ODA=","avatar_url":"https://avatars2.githubusercontent.com/u/1193680?v=4","gravatar_id":"","url":"https://api.github.com/users/aresn","html_url":"https://github.com/aresn","followers_url":"https://api.github.com/users/aresn/followers","following_url":"https://api.github.com/users/aresn/following{/other_user}","gists_url":"https://api.github.com/users/aresn/gists{/gist_id}","starred_url":"https://api.github.com/users/aresn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aresn/subscriptions","organizations_url":"https://api.github.com/users/aresn/orgs","repos_url":"https://api.github.com/users/aresn/repos","events_url":"https://api.github.com/users/aresn/events{/privacy}","received_events_url":"https://api.github.com/users/aresn/received_events","type":"User","site_admin":false},"created_at":"2016-04-03T01:40:14Z","updated_at":"2016-04-03T01:40:14Z","author_association":"NONE","body":"I managed to somehow face this issue again. The \"path\" parameter in moving average can not point to a nested aggregation because nested aggregation is not a single bucket aggregation.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/215712571","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-215712571","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":215712571,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNTcxMjU3MQ==","user":{"login":"byronvoorbach","id":4427161,"node_id":"MDQ6VXNlcjQ0MjcxNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/4427161?v=4","gravatar_id":"","url":"https://api.github.com/users/byronvoorbach","html_url":"https://github.com/byronvoorbach","followers_url":"https://api.github.com/users/byronvoorbach/followers","following_url":"https://api.github.com/users/byronvoorbach/following{/other_user}","gists_url":"https://api.github.com/users/byronvoorbach/gists{/gist_id}","starred_url":"https://api.github.com/users/byronvoorbach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byronvoorbach/subscriptions","organizations_url":"https://api.github.com/users/byronvoorbach/orgs","repos_url":"https://api.github.com/users/byronvoorbach/repos","events_url":"https://api.github.com/users/byronvoorbach/events{/privacy}","received_events_url":"https://api.github.com/users/byronvoorbach/received_events","type":"User","site_admin":false},"created_at":"2016-04-29T13:34:17Z","updated_at":"2016-04-29T13:34:17Z","author_association":"CONTRIBUTOR","body":"Is there any way to get around this 'issue'?? I'm running into the same issues\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/229055699","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-229055699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":229055699,"node_id":"MDEyOklzc3VlQ29tbWVudDIyOTA1NTY5OQ==","user":{"login":"jambanagar","id":19401843,"node_id":"MDQ6VXNlcjE5NDAxODQz","avatar_url":"https://avatars3.githubusercontent.com/u/19401843?v=4","gravatar_id":"","url":"https://api.github.com/users/jambanagar","html_url":"https://github.com/jambanagar","followers_url":"https://api.github.com/users/jambanagar/followers","following_url":"https://api.github.com/users/jambanagar/following{/other_user}","gists_url":"https://api.github.com/users/jambanagar/gists{/gist_id}","starred_url":"https://api.github.com/users/jambanagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jambanagar/subscriptions","organizations_url":"https://api.github.com/users/jambanagar/orgs","repos_url":"https://api.github.com/users/jambanagar/repos","events_url":"https://api.github.com/users/jambanagar/events{/privacy}","received_events_url":"https://api.github.com/users/jambanagar/received_events","type":"User","site_admin":false},"created_at":"2016-06-28T13:54:08Z","updated_at":"2016-06-28T13:54:08Z","author_association":"NONE","body":"@clintongormley @colings86 Any update on this please? We are badly stuck without this...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/229268173","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-229268173","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":229268173,"node_id":"MDEyOklzc3VlQ29tbWVudDIyOTI2ODE3Mw==","user":{"login":"sylcjl","id":15008189,"node_id":"MDQ6VXNlcjE1MDA4MTg5","avatar_url":"https://avatars0.githubusercontent.com/u/15008189?v=4","gravatar_id":"","url":"https://api.github.com/users/sylcjl","html_url":"https://github.com/sylcjl","followers_url":"https://api.github.com/users/sylcjl/followers","following_url":"https://api.github.com/users/sylcjl/following{/other_user}","gists_url":"https://api.github.com/users/sylcjl/gists{/gist_id}","starred_url":"https://api.github.com/users/sylcjl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sylcjl/subscriptions","organizations_url":"https://api.github.com/users/sylcjl/orgs","repos_url":"https://api.github.com/users/sylcjl/repos","events_url":"https://api.github.com/users/sylcjl/events{/privacy}","received_events_url":"https://api.github.com/users/sylcjl/received_events","type":"User","site_admin":false},"created_at":"2016-06-29T06:29:25Z","updated_at":"2016-06-29T06:33:15Z","author_association":"NONE","body":"+1\n\nmy question on stackoverflow\nhttp://stackoverflow.com/questions/38089711/how-can-i-sort-aggregations-buckets-by-metric-results\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/230844915","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-230844915","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":230844915,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMDg0NDkxNQ==","user":{"login":"sawyercade","id":2049712,"node_id":"MDQ6VXNlcjIwNDk3MTI=","avatar_url":"https://avatars2.githubusercontent.com/u/2049712?v=4","gravatar_id":"","url":"https://api.github.com/users/sawyercade","html_url":"https://github.com/sawyercade","followers_url":"https://api.github.com/users/sawyercade/followers","following_url":"https://api.github.com/users/sawyercade/following{/other_user}","gists_url":"https://api.github.com/users/sawyercade/gists{/gist_id}","starred_url":"https://api.github.com/users/sawyercade/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sawyercade/subscriptions","organizations_url":"https://api.github.com/users/sawyercade/orgs","repos_url":"https://api.github.com/users/sawyercade/repos","events_url":"https://api.github.com/users/sawyercade/events{/privacy}","received_events_url":"https://api.github.com/users/sawyercade/received_events","type":"User","site_admin":false},"created_at":"2016-07-06T17:28:10Z","updated_at":"2016-07-06T17:28:27Z","author_association":"NONE","body":"+1 for this as well. Very big use case scenario for us.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/231966043","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-231966043","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":231966043,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMTk2NjA0Mw==","user":{"login":"kagrela","id":5849450,"node_id":"MDQ6VXNlcjU4NDk0NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/5849450?v=4","gravatar_id":"","url":"https://api.github.com/users/kagrela","html_url":"https://github.com/kagrela","followers_url":"https://api.github.com/users/kagrela/followers","following_url":"https://api.github.com/users/kagrela/following{/other_user}","gists_url":"https://api.github.com/users/kagrela/gists{/gist_id}","starred_url":"https://api.github.com/users/kagrela/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kagrela/subscriptions","organizations_url":"https://api.github.com/users/kagrela/orgs","repos_url":"https://api.github.com/users/kagrela/repos","events_url":"https://api.github.com/users/kagrela/events{/privacy}","received_events_url":"https://api.github.com/users/kagrela/received_events","type":"User","site_admin":false},"created_at":"2016-07-12T07:57:32Z","updated_at":"2016-07-12T07:57:32Z","author_association":"NONE","body":"+1 as this is showstoper for us to upgrade from es v1  to es v2\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/231969158","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-231969158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":231969158,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMTk2OTE1OA==","user":{"login":"whizz","id":657954,"node_id":"MDQ6VXNlcjY1Nzk1NA==","avatar_url":"https://avatars2.githubusercontent.com/u/657954?v=4","gravatar_id":"","url":"https://api.github.com/users/whizz","html_url":"https://github.com/whizz","followers_url":"https://api.github.com/users/whizz/followers","following_url":"https://api.github.com/users/whizz/following{/other_user}","gists_url":"https://api.github.com/users/whizz/gists{/gist_id}","starred_url":"https://api.github.com/users/whizz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/whizz/subscriptions","organizations_url":"https://api.github.com/users/whizz/orgs","repos_url":"https://api.github.com/users/whizz/repos","events_url":"https://api.github.com/users/whizz/events{/privacy}","received_events_url":"https://api.github.com/users/whizz/received_events","type":"User","site_admin":false},"created_at":"2016-07-12T08:12:59Z","updated_at":"2016-07-12T08:12:59Z","author_association":"NONE","body":"We were bitten by the same thing. FWIW, we worked around it temporarily by ordering the aggregations in the application code after they are returned from ES.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/242742060","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-242742060","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":242742060,"node_id":"MDEyOklzc3VlQ29tbWVudDI0Mjc0MjA2MA==","user":{"login":"voldern","id":22524,"node_id":"MDQ6VXNlcjIyNTI0","avatar_url":"https://avatars1.githubusercontent.com/u/22524?v=4","gravatar_id":"","url":"https://api.github.com/users/voldern","html_url":"https://github.com/voldern","followers_url":"https://api.github.com/users/voldern/followers","following_url":"https://api.github.com/users/voldern/following{/other_user}","gists_url":"https://api.github.com/users/voldern/gists{/gist_id}","starred_url":"https://api.github.com/users/voldern/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/voldern/subscriptions","organizations_url":"https://api.github.com/users/voldern/orgs","repos_url":"https://api.github.com/users/voldern/repos","events_url":"https://api.github.com/users/voldern/events{/privacy}","received_events_url":"https://api.github.com/users/voldern/received_events","type":"User","site_admin":false},"created_at":"2016-08-26T13:55:36Z","updated_at":"2016-08-26T13:55:36Z","author_association":"NONE","body":"This missing feature is preventing us from upgrading to ES 2.X. Is there any plans to support this in the near future?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/242744288","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-242744288","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":242744288,"node_id":"MDEyOklzc3VlQ29tbWVudDI0Mjc0NDI4OA==","user":{"login":"jambanagar","id":19401843,"node_id":"MDQ6VXNlcjE5NDAxODQz","avatar_url":"https://avatars3.githubusercontent.com/u/19401843?v=4","gravatar_id":"","url":"https://api.github.com/users/jambanagar","html_url":"https://github.com/jambanagar","followers_url":"https://api.github.com/users/jambanagar/followers","following_url":"https://api.github.com/users/jambanagar/following{/other_user}","gists_url":"https://api.github.com/users/jambanagar/gists{/gist_id}","starred_url":"https://api.github.com/users/jambanagar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jambanagar/subscriptions","organizations_url":"https://api.github.com/users/jambanagar/orgs","repos_url":"https://api.github.com/users/jambanagar/repos","events_url":"https://api.github.com/users/jambanagar/events{/privacy}","received_events_url":"https://api.github.com/users/jambanagar/received_events","type":"User","site_admin":false},"created_at":"2016-08-26T14:03:59Z","updated_at":"2016-08-26T14:04:22Z","author_association":"NONE","body":"@clintongormley Nested architecture is an important functionality in ES. Most companies build atleast at minimum some sort of functionality with nested mappings. This bug renders ES useless. Any updates?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252060263","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-252060263","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":252060263,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjA2MDI2Mw==","user":{"login":"calvinps","id":6371960,"node_id":"MDQ6VXNlcjYzNzE5NjA=","avatar_url":"https://avatars2.githubusercontent.com/u/6371960?v=4","gravatar_id":"","url":"https://api.github.com/users/calvinps","html_url":"https://github.com/calvinps","followers_url":"https://api.github.com/users/calvinps/followers","following_url":"https://api.github.com/users/calvinps/following{/other_user}","gists_url":"https://api.github.com/users/calvinps/gists{/gist_id}","starred_url":"https://api.github.com/users/calvinps/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calvinps/subscriptions","organizations_url":"https://api.github.com/users/calvinps/orgs","repos_url":"https://api.github.com/users/calvinps/repos","events_url":"https://api.github.com/users/calvinps/events{/privacy}","received_events_url":"https://api.github.com/users/calvinps/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T19:12:09Z","updated_at":"2016-10-06T19:12:09Z","author_association":"NONE","body":"+1 sorting after the fact in our application isn't a viable option due to number of results. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268335539","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-268335539","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":268335539,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODMzNTUzOQ==","user":{"login":"idozorenko","id":2431753,"node_id":"MDQ6VXNlcjI0MzE3NTM=","avatar_url":"https://avatars2.githubusercontent.com/u/2431753?v=4","gravatar_id":"","url":"https://api.github.com/users/idozorenko","html_url":"https://github.com/idozorenko","followers_url":"https://api.github.com/users/idozorenko/followers","following_url":"https://api.github.com/users/idozorenko/following{/other_user}","gists_url":"https://api.github.com/users/idozorenko/gists{/gist_id}","starred_url":"https://api.github.com/users/idozorenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idozorenko/subscriptions","organizations_url":"https://api.github.com/users/idozorenko/orgs","repos_url":"https://api.github.com/users/idozorenko/repos","events_url":"https://api.github.com/users/idozorenko/events{/privacy}","received_events_url":"https://api.github.com/users/idozorenko/received_events","type":"User","site_admin":false},"created_at":"2016-12-20T19:31:26Z","updated_at":"2016-12-20T19:31:26Z","author_association":"NONE","body":"I have made a fix to sort which has nested aggregations in path. Also you might have multi-value buckets in path (you should just specify bucket key in path like \"colors.red>stats.variance\").\r\nI might create a pull request or just give a link to the commit in fork of ES 5.1.2 if anyone is interested. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268336381","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-268336381","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":268336381,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODMzNjM4MQ==","user":{"login":"RubieV","id":8270394,"node_id":"MDQ6VXNlcjgyNzAzOTQ=","avatar_url":"https://avatars3.githubusercontent.com/u/8270394?v=4","gravatar_id":"","url":"https://api.github.com/users/RubieV","html_url":"https://github.com/RubieV","followers_url":"https://api.github.com/users/RubieV/followers","following_url":"https://api.github.com/users/RubieV/following{/other_user}","gists_url":"https://api.github.com/users/RubieV/gists{/gist_id}","starred_url":"https://api.github.com/users/RubieV/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RubieV/subscriptions","organizations_url":"https://api.github.com/users/RubieV/orgs","repos_url":"https://api.github.com/users/RubieV/repos","events_url":"https://api.github.com/users/RubieV/events{/privacy}","received_events_url":"https://api.github.com/users/RubieV/received_events","type":"User","site_admin":false},"created_at":"2016-12-20T19:34:27Z","updated_at":"2016-12-20T19:34:27Z","author_association":"NONE","body":"That would be great, or link in your fork?\n\nOp di 20 dec. 2016 20:32 schreef idozorenko <notifications@github.com>:\n\n> I have made a fix to sort which has nested aggregations in path. Also you\n> might have multi-value buckets in path (you should just specify bucket key\n> in path like \"colors.red>stats.variance\").\n> I might create a pull request or just give a link to the commit in fork of\n> ES 5.1.2 if anyone is interested.\n>\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/16838#issuecomment-268335539>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AH4yOnC_e-o0zAsgVPxT6MWYR8jdUBwNks5rKC03gaJpZM4HkeIN>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268449151","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-268449151","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":268449151,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODQ0OTE1MQ==","user":{"login":"kagrela","id":5849450,"node_id":"MDQ6VXNlcjU4NDk0NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/5849450?v=4","gravatar_id":"","url":"https://api.github.com/users/kagrela","html_url":"https://github.com/kagrela","followers_url":"https://api.github.com/users/kagrela/followers","following_url":"https://api.github.com/users/kagrela/following{/other_user}","gists_url":"https://api.github.com/users/kagrela/gists{/gist_id}","starred_url":"https://api.github.com/users/kagrela/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kagrela/subscriptions","organizations_url":"https://api.github.com/users/kagrela/orgs","repos_url":"https://api.github.com/users/kagrela/repos","events_url":"https://api.github.com/users/kagrela/events{/privacy}","received_events_url":"https://api.github.com/users/kagrela/received_events","type":"User","site_admin":false},"created_at":"2016-12-21T06:43:02Z","updated_at":"2016-12-21T06:43:02Z","author_association":"NONE","body":">I might create a pull request\r\n\r\n:+1:","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268514930","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-268514930","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":268514930,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODUxNDkzMA==","user":{"login":"idozorenko","id":2431753,"node_id":"MDQ6VXNlcjI0MzE3NTM=","avatar_url":"https://avatars2.githubusercontent.com/u/2431753?v=4","gravatar_id":"","url":"https://api.github.com/users/idozorenko","html_url":"https://github.com/idozorenko","followers_url":"https://api.github.com/users/idozorenko/followers","following_url":"https://api.github.com/users/idozorenko/following{/other_user}","gists_url":"https://api.github.com/users/idozorenko/gists{/gist_id}","starred_url":"https://api.github.com/users/idozorenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idozorenko/subscriptions","organizations_url":"https://api.github.com/users/idozorenko/orgs","repos_url":"https://api.github.com/users/idozorenko/repos","events_url":"https://api.github.com/users/idozorenko/events{/privacy}","received_events_url":"https://api.github.com/users/idozorenko/received_events","type":"User","site_admin":false},"created_at":"2016-12-21T12:46:34Z","updated_at":"2016-12-21T12:46:34Z","author_association":"NONE","body":"As I'm not a contributor, I will just share my commit to ES 5.1 branch here. Please let me know if you have any questions.\r\n\r\nhttps://github.com/elastic/elasticsearch/commit/8f601a3c241cb652a889870d93fd32b3d226ef41\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268515330","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-268515330","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":268515330,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODUxNTMzMA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-12-21T12:48:50Z","updated_at":"2016-12-21T12:48:50Z","author_association":"CONTRIBUTOR","body":"@idozorenko feel free to submit a PR so that we can review the code - thanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299609004","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-299609004","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":299609004,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTYwOTAwNA==","user":{"login":"IdanWo","id":20516325,"node_id":"MDQ6VXNlcjIwNTE2MzI1","avatar_url":"https://avatars1.githubusercontent.com/u/20516325?v=4","gravatar_id":"","url":"https://api.github.com/users/IdanWo","html_url":"https://github.com/IdanWo","followers_url":"https://api.github.com/users/IdanWo/followers","following_url":"https://api.github.com/users/IdanWo/following{/other_user}","gists_url":"https://api.github.com/users/IdanWo/gists{/gist_id}","starred_url":"https://api.github.com/users/IdanWo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IdanWo/subscriptions","organizations_url":"https://api.github.com/users/IdanWo/orgs","repos_url":"https://api.github.com/users/IdanWo/repos","events_url":"https://api.github.com/users/IdanWo/events{/privacy}","received_events_url":"https://api.github.com/users/IdanWo/received_events","type":"User","site_admin":false},"created_at":"2017-05-06T02:04:12Z","updated_at":"2017-05-06T02:04:12Z","author_association":"NONE","body":"Does this problem also occur in reverse_nested aggs? (not direct nested)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299622931","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-299622931","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":299622931,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTYyMjkzMQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-05-06T07:49:00Z","updated_at":"2017-05-06T07:49:00Z","author_association":"MEMBER","body":"yes","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299837273","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-299837273","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":299837273,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTgzNzI3Mw==","user":{"login":"akashmpatel91","id":4576690,"node_id":"MDQ6VXNlcjQ1NzY2OTA=","avatar_url":"https://avatars1.githubusercontent.com/u/4576690?v=4","gravatar_id":"","url":"https://api.github.com/users/akashmpatel91","html_url":"https://github.com/akashmpatel91","followers_url":"https://api.github.com/users/akashmpatel91/followers","following_url":"https://api.github.com/users/akashmpatel91/following{/other_user}","gists_url":"https://api.github.com/users/akashmpatel91/gists{/gist_id}","starred_url":"https://api.github.com/users/akashmpatel91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akashmpatel91/subscriptions","organizations_url":"https://api.github.com/users/akashmpatel91/orgs","repos_url":"https://api.github.com/users/akashmpatel91/repos","events_url":"https://api.github.com/users/akashmpatel91/events{/privacy}","received_events_url":"https://api.github.com/users/akashmpatel91/received_events","type":"User","site_admin":false},"created_at":"2017-05-08T11:00:35Z","updated_at":"2017-05-08T11:00:35Z","author_association":"NONE","body":"+1 for this issue. We have exact same problem and same query is running with AWS ES 1.5. \r\n\r\nCan any one tell us about the status for this bug fix? This is very critical feature for us and can not move forward without this functionality? Does any one suggest to use ES 1.5 instead of 5.X version? (Personally i do not think we should do this)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299938097","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-299938097","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":299938097,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTkzODA5Nw==","user":{"login":"brettahale","id":1056398,"node_id":"MDQ6VXNlcjEwNTYzOTg=","avatar_url":"https://avatars3.githubusercontent.com/u/1056398?v=4","gravatar_id":"","url":"https://api.github.com/users/brettahale","html_url":"https://github.com/brettahale","followers_url":"https://api.github.com/users/brettahale/followers","following_url":"https://api.github.com/users/brettahale/following{/other_user}","gists_url":"https://api.github.com/users/brettahale/gists{/gist_id}","starred_url":"https://api.github.com/users/brettahale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brettahale/subscriptions","organizations_url":"https://api.github.com/users/brettahale/orgs","repos_url":"https://api.github.com/users/brettahale/repos","events_url":"https://api.github.com/users/brettahale/events{/privacy}","received_events_url":"https://api.github.com/users/brettahale/received_events","type":"User","site_admin":false},"created_at":"2017-05-08T17:45:16Z","updated_at":"2017-05-08T17:45:16Z","author_association":"NONE","body":"We didn't want to wait for a fix or to upgrade so we ended up restructuring\nour data to be a parent/child relationship vs nested. So far so good.\n\nOn Mon, May 8, 2017 at 5:01 AM, akashmpatel91 <notifications@github.com>\nwrote:\n\n> +1 for this issue. We have exact same problem and same query is running\n> with AWS ES 1.5.\n>\n> Can any one tell us about the status for this bug fix? This is very\n> critical feature for us and can not move forward without this\n> functionality? Does any one suggest to use ES 1.5 instead of 5.X version?\n> (Personally i do not think we should do this)\n>\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/16838#issuecomment-299837273>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABAejttN4mvEjco7X7BmwNBNVOOoopaQks5r3vX7gaJpZM4HkeIN>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299963988","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-299963988","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":299963988,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTk2Mzk4OA==","user":{"login":"akashmpatel91","id":4576690,"node_id":"MDQ6VXNlcjQ1NzY2OTA=","avatar_url":"https://avatars1.githubusercontent.com/u/4576690?v=4","gravatar_id":"","url":"https://api.github.com/users/akashmpatel91","html_url":"https://github.com/akashmpatel91","followers_url":"https://api.github.com/users/akashmpatel91/followers","following_url":"https://api.github.com/users/akashmpatel91/following{/other_user}","gists_url":"https://api.github.com/users/akashmpatel91/gists{/gist_id}","starred_url":"https://api.github.com/users/akashmpatel91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akashmpatel91/subscriptions","organizations_url":"https://api.github.com/users/akashmpatel91/orgs","repos_url":"https://api.github.com/users/akashmpatel91/repos","events_url":"https://api.github.com/users/akashmpatel91/events{/privacy}","received_events_url":"https://api.github.com/users/akashmpatel91/received_events","type":"User","site_admin":false},"created_at":"2017-05-08T19:18:59Z","updated_at":"2017-05-08T19:18:59Z","author_association":"NONE","body":"@brettahale, Please note that \"parent-child relations can make queries hundreds of times slower\" as per ES documentation https://www.elastic.co/guide/en/elasticsearch/reference/master/tune-for-search-speed.html. \r\n\r\nWe did POC and it is correct, we are handling 5-6 billions documents and query is taking 6-7 sec to return results. With nested document query is returning results in 400 ms.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/300021449","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-300021449","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":300021449,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDAyMTQ0OQ==","user":{"login":"brettahale","id":1056398,"node_id":"MDQ6VXNlcjEwNTYzOTg=","avatar_url":"https://avatars3.githubusercontent.com/u/1056398?v=4","gravatar_id":"","url":"https://api.github.com/users/brettahale","html_url":"https://github.com/brettahale","followers_url":"https://api.github.com/users/brettahale/followers","following_url":"https://api.github.com/users/brettahale/following{/other_user}","gists_url":"https://api.github.com/users/brettahale/gists{/gist_id}","starred_url":"https://api.github.com/users/brettahale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brettahale/subscriptions","organizations_url":"https://api.github.com/users/brettahale/orgs","repos_url":"https://api.github.com/users/brettahale/repos","events_url":"https://api.github.com/users/brettahale/events{/privacy}","received_events_url":"https://api.github.com/users/brettahale/received_events","type":"User","site_admin":false},"created_at":"2017-05-08T23:46:15Z","updated_at":"2017-05-08T23:46:15Z","author_association":"NONE","body":"Agreed, wasn't ideal but we were able to deliver our feature. I'd like to\nsee a fix here as well but after a chat with ES support, it sounded like a\nfoundational change that wasn't likely going to get fixed anytime soon.\n\nOn Mon, May 8, 2017 at 1:19 PM, akashmpatel91 <notifications@github.com>\nwrote:\n\n> @brettahale <https://github.com/brettahale>, Please note that\n> \"parent-child relations can make queries hundreds of times slower\" as per\n> ES documentation https://www.elastic.co/guide/en/elasticsearch/reference/\n> master/tune-for-search-speed.html.\n>\n> We did POC and it is correct, we are handling 5-6 billions documents and\n> query is taking 6-7 sec to return results. With nested document query is\n> returning results in 400 ms.\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/16838#issuecomment-299963988>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABAeju3EHsROM1hWyII36f5pPpPeVK0bks5r32rQgaJpZM4HkeIN>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302506302","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-302506302","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":302506302,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjUwNjMwMg==","user":{"login":"akashmpatel91","id":4576690,"node_id":"MDQ6VXNlcjQ1NzY2OTA=","avatar_url":"https://avatars1.githubusercontent.com/u/4576690?v=4","gravatar_id":"","url":"https://api.github.com/users/akashmpatel91","html_url":"https://github.com/akashmpatel91","followers_url":"https://api.github.com/users/akashmpatel91/followers","following_url":"https://api.github.com/users/akashmpatel91/following{/other_user}","gists_url":"https://api.github.com/users/akashmpatel91/gists{/gist_id}","starred_url":"https://api.github.com/users/akashmpatel91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akashmpatel91/subscriptions","organizations_url":"https://api.github.com/users/akashmpatel91/orgs","repos_url":"https://api.github.com/users/akashmpatel91/repos","events_url":"https://api.github.com/users/akashmpatel91/events{/privacy}","received_events_url":"https://api.github.com/users/akashmpatel91/received_events","type":"User","site_admin":false},"created_at":"2017-05-18T18:43:13Z","updated_at":"2017-05-18T18:43:13Z","author_association":"NONE","body":"Hello team, any update on this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307872436","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-307872436","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":307872436,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzg3MjQzNg==","user":{"login":"IdanWo","id":20516325,"node_id":"MDQ6VXNlcjIwNTE2MzI1","avatar_url":"https://avatars1.githubusercontent.com/u/20516325?v=4","gravatar_id":"","url":"https://api.github.com/users/IdanWo","html_url":"https://github.com/IdanWo","followers_url":"https://api.github.com/users/IdanWo/followers","following_url":"https://api.github.com/users/IdanWo/following{/other_user}","gists_url":"https://api.github.com/users/IdanWo/gists{/gist_id}","starred_url":"https://api.github.com/users/IdanWo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IdanWo/subscriptions","organizations_url":"https://api.github.com/users/IdanWo/orgs","repos_url":"https://api.github.com/users/IdanWo/repos","events_url":"https://api.github.com/users/IdanWo/events{/privacy}","received_events_url":"https://api.github.com/users/IdanWo/received_events","type":"User","site_admin":false},"created_at":"2017-06-12T18:12:47Z","updated_at":"2017-06-13T18:35:46Z","author_association":"NONE","body":"Our workaround was to copy some fields from the parent docs into its nested docs, so we can still make terms aggregation on the nested docs but sort by fields \"found\" in the parent docs. This allowed us to omit the reverse_nested aggregation between the bucket and the sub bucket. Not ideal, but works in our cases. Of course, a fix would be much appreciated.\r\n\r\nEdit:\r\nApparently, there was no need for a workaround in my case.\r\nSee the comment below.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308208189","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-308208189","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":308208189,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODIwODE4OQ==","user":{"login":"IdanWo","id":20516325,"node_id":"MDQ6VXNlcjIwNTE2MzI1","avatar_url":"https://avatars1.githubusercontent.com/u/20516325?v=4","gravatar_id":"","url":"https://api.github.com/users/IdanWo","html_url":"https://github.com/IdanWo","followers_url":"https://api.github.com/users/IdanWo/followers","following_url":"https://api.github.com/users/IdanWo/following{/other_user}","gists_url":"https://api.github.com/users/IdanWo/gists{/gist_id}","starred_url":"https://api.github.com/users/IdanWo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IdanWo/subscriptions","organizations_url":"https://api.github.com/users/IdanWo/orgs","repos_url":"https://api.github.com/users/IdanWo/repos","events_url":"https://api.github.com/users/IdanWo/events{/privacy}","received_events_url":"https://api.github.com/users/IdanWo/received_events","type":"User","site_admin":false},"created_at":"2017-06-13T18:34:06Z","updated_at":"2017-06-14T06:20:15Z","author_association":"NONE","body":"@colings86: Actually I did managed to use Terms aggregation, a sub Reverse_Nested aggregation and a sub Cardinality aggregation for ordering. Something like that:\r\n```\r\n{\r\n    \"aggs\" : {\r\n        \"AllMovieNames\" : {\r\n            \"terms\" : { \"field\" : \"MovieName\" },\r\n            \"order\": {\r\n            \"backToActors>distinctActorsCount\":\"desc\"\r\n            },\r\n           \"size\": 10\r\n        },\r\n\t\t\"aggs\":\r\n\t\t{\r\n\t\t\t\"backToActors\":{\t\t\r\n\t\t\t\t\"reverse_nested\":{},\r\n\t\t\t\t\"aggs\":{\r\n\t\t\t\t\t\"distinctActorsCount\":{\r\n\t\t\t\t\t\t\"cardinality\":{\r\n\t\t\t\t\t\t\t\"field\":\"ActorName\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\t\r\n\t\t}\t\t\t\r\n    }\t\r\n}\r\n```\r\nNo exception message was thrown, and the order was just as expected.\r\n\r\nAre you sure the problem occur in both Nested and Reverse_Nested sub aggregation? \r\nI'm using ElasticSearch 5.3.2.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309718632","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-309718632","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":309718632,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTcxODYzMg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-06-20T10:58:33Z","updated_at":"2017-06-20T10:58:33Z","author_association":"MEMBER","body":"@IdanWo sorry, actually you are right, this problem doesn't occur on the `reverse_nested` aggregation, the only single bucket aggregation it should affect is the `nested` aggregation because thats the only single bucket aggregation that uses `AggregatorFactory.asMultiBucketAggregator()`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/316073796","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-316073796","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":316073796,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNjA3Mzc5Ng==","user":{"login":"ggarciao","id":1259730,"node_id":"MDQ6VXNlcjEyNTk3MzA=","avatar_url":"https://avatars2.githubusercontent.com/u/1259730?v=4","gravatar_id":"","url":"https://api.github.com/users/ggarciao","html_url":"https://github.com/ggarciao","followers_url":"https://api.github.com/users/ggarciao/followers","following_url":"https://api.github.com/users/ggarciao/following{/other_user}","gists_url":"https://api.github.com/users/ggarciao/gists{/gist_id}","starred_url":"https://api.github.com/users/ggarciao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ggarciao/subscriptions","organizations_url":"https://api.github.com/users/ggarciao/orgs","repos_url":"https://api.github.com/users/ggarciao/repos","events_url":"https://api.github.com/users/ggarciao/events{/privacy}","received_events_url":"https://api.github.com/users/ggarciao/received_events","type":"User","site_admin":false},"created_at":"2017-07-18T14:04:04Z","updated_at":"2017-07-18T14:06:25Z","author_association":"NONE","body":"I'm another victim of this insidious bug:\r\n\r\nSituation:\r\n\r\n- Document ROOT with two nested documents NESTED1 and NESTED2.\r\n- Term aggregation over a field in ROOT.NESTED1 (nested aggregation -to NESTED1- then term aggregation)\r\n- Sum aggregation over a field in ROOT.NESTED2 (inside the previous term aggregation, reverse nested aggregation -back to ROOT-, nested aggregation -to NESTED2- then sum aggregation)\r\n\r\nI cannot use the sum aggregation to sort the term aggregation because an error is thrown saying that the nested aggregation -to NESTED2- does not returns a single-bucket aggregation\r\n\r\n**Can someone update us with the status of this bug?**\r\n\r\n(I'm using ElasticSearch 5.4)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320168052","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-320168052","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":320168052,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDE2ODA1Mg==","user":{"login":"akashmpatel91","id":4576690,"node_id":"MDQ6VXNlcjQ1NzY2OTA=","avatar_url":"https://avatars1.githubusercontent.com/u/4576690?v=4","gravatar_id":"","url":"https://api.github.com/users/akashmpatel91","html_url":"https://github.com/akashmpatel91","followers_url":"https://api.github.com/users/akashmpatel91/followers","following_url":"https://api.github.com/users/akashmpatel91/following{/other_user}","gists_url":"https://api.github.com/users/akashmpatel91/gists{/gist_id}","starred_url":"https://api.github.com/users/akashmpatel91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akashmpatel91/subscriptions","organizations_url":"https://api.github.com/users/akashmpatel91/orgs","repos_url":"https://api.github.com/users/akashmpatel91/repos","events_url":"https://api.github.com/users/akashmpatel91/events{/privacy}","received_events_url":"https://api.github.com/users/akashmpatel91/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T06:31:46Z","updated_at":"2017-08-04T06:31:46Z","author_association":"NONE","body":"Hello Team, any update on this Bug fix? It is not working only in 5.x version. Can you please provide ETA for this bug to be fixed? This is very important feature for term aggregation and blocking many clients.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320349905","html_url":"https://github.com/elastic/elasticsearch/issues/16838#issuecomment-320349905","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16838","id":320349905,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDM0OTkwNQ==","user":{"login":"matthenricks","id":5382926,"node_id":"MDQ6VXNlcjUzODI5MjY=","avatar_url":"https://avatars3.githubusercontent.com/u/5382926?v=4","gravatar_id":"","url":"https://api.github.com/users/matthenricks","html_url":"https://github.com/matthenricks","followers_url":"https://api.github.com/users/matthenricks/followers","following_url":"https://api.github.com/users/matthenricks/following{/other_user}","gists_url":"https://api.github.com/users/matthenricks/gists{/gist_id}","starred_url":"https://api.github.com/users/matthenricks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthenricks/subscriptions","organizations_url":"https://api.github.com/users/matthenricks/orgs","repos_url":"https://api.github.com/users/matthenricks/repos","events_url":"https://api.github.com/users/matthenricks/events{/privacy}","received_events_url":"https://api.github.com/users/matthenricks/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T20:49:20Z","updated_at":"2017-08-04T22:28:31Z","author_association":"NONE","body":"Hi All, I was able to get around this by doing something similar to the following. For this, there was only one nested value that will match the interval condition - but you could get creative :)\r\n\r\nMapping:\r\n```\r\n    \"trendingpopularityjson\": {\r\n            \"type\": \"nested\",\r\n            \"include_in_parent\": true,\r\n            \"properties\": {\r\n              \"interval\": {\r\n                \"type\": \"integer\"\r\n              },\r\n              \"trendingpopularity\": {\r\n                \"type\": \"integer\"\r\n              }\r\n            }\r\n          }\r\n```\r\n\r\nAggregation to sum inside. This would avoid the nested aggregation - making it easy :\r\n\r\n```\r\n                    \"Trend\": {\r\n                      \"sum\": {\r\n                        \"script\": {\r\n                          \"inline\": \"def d = doc['trendingpopularityjson.interval']; for (int i = 0; i < d.length; ++i) { if (d[i] == params.interval) { return doc['trendingpopularityjson.trendingpopularity'][i] } }\",\r\n                          \"params\": {\r\n                            \"interval\": 2\r\n                          },\r\n                          \"lang\": \"painless\"\r\n                        }\r\n                      }\r\n                    }\r\n```","performed_via_github_app":null}]