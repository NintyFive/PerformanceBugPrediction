{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14063","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14063/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14063/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14063/events","html_url":"https://github.com/elastic/elasticsearch/issues/14063","id":110956296,"node_id":"MDU6SXNzdWUxMTA5NTYyOTY=","number":14063,"title":"Analyzer unassigned when using 'integer' type","user":{"login":"missinglink","id":738069,"node_id":"MDQ6VXNlcjczODA2OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/738069?v=4","gravatar_id":"","url":"https://api.github.com/users/missinglink","html_url":"https://github.com/missinglink","followers_url":"https://api.github.com/users/missinglink/followers","following_url":"https://api.github.com/users/missinglink/following{/other_user}","gists_url":"https://api.github.com/users/missinglink/gists{/gist_id}","starred_url":"https://api.github.com/users/missinglink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/missinglink/subscriptions","organizations_url":"https://api.github.com/users/missinglink/orgs","repos_url":"https://api.github.com/users/missinglink/repos","events_url":"https://api.github.com/users/missinglink/events{/privacy}","received_events_url":"https://api.github.com/users/missinglink/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-10-12T11:31:31Z","updated_at":"2015-10-12T13:06:09Z","closed_at":"2015-10-12T12:12:39Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When assigning an `analyzer` to an `integer` field, the analyzer definition is removed from the mapping.\n\nIn the example below I would like to remove non-numeric characters from a house number and store the results as `integer` types in order to use a `range` filter (eg. so `[\"1A\"]` => `[1]` or `[\"apt 4\"]` => `[4]`)\n\nWhen posting the mapping to ES, it is removing the `analyzer` for the `integer` field but not for the `string` field.\n\nThis results in an unexpected error such as `MapperParsingException[failed to parse [myInteger]]; nested: NumberFormatException[For input string: \\\"apartment 1A\\\"];`.\n\nI looked through the docs and couldn't find mention of this behaviour.\n\n``` bash\n#!/bin/bash\n\n################################################\n# Analyzer unassigned when using 'integer' type\n################################################\n\nES='localhost:9200';\n\n# drop index\ncurl -XDELETE \"$ES/address?pretty=true\";\n\n# create index\ncurl -XPUT \"$ES/address?pretty=true\" -d'\n{\n  \"settings\": {\n    \"analysis\": {\n      \"analyzer\": {\n        \"numberify\": {\n          \"type\": \"custom\",\n          \"tokenizer\": \"standard\",\n          \"char_filter\": [\"convert_non_numeric_chars_to_spaces\"]\n        }\n      },\n      \"char_filter\": {\n        \"convert_non_numeric_chars_to_spaces\": {\n          \"type\": \"pattern_replace\",\n          \"pattern\": \"[^0-9]\",\n          \"replacement\": \" \"\n        }\n      }\n    }\n  },\n  \"mappings\": {\n    \"housenumber\": {\n      \"properties\": {\n        \"myString\": {\n          \"type\": \"string\",\n          \"analyzer\": \"numberify\"\n        },\n        \"myInteger\": {\n          \"type\": \"integer\",\n          \"analyzer\": \"numberify\"\n        }\n      }\n    }\n  }\n}';\n```\n\n``` bash\n# retrieve index mapping\ncurl -XGET \"$ES/address/_mapping?pretty=true\"\n\n# !!! analyzer has been removed from 'integer' field but not string field !!!\n\n# \"myInteger\" : {\n#   \"type\" : \"integer\"\n# },\n# \"myString\" : {\n#   \"type\" : \"string\",\n#   \"analyzer\" : \"numberify\"\n# }\n```\n\n``` bash\n# index a doc\ncurl -XPOST \"$ES/address/housenumber/1?pretty=true\" -d'\n{\n  \"myInteger\": \"apartment 1A\",\n  \"myString\": \"apartment 1A\"\n}';\n\n# {\n#   \"error\" : \"MapperParsingException[failed to parse [myInteger]]; nested: NumberFormatException[For input string: \\\"apartment 1A\\\"]; \",\n#   \"status\" : 400\n# }\n```\n\n``` bash\n# expected for input 'apartment 1A'\n\n\"myInteger\": 1,\n\"myString\": \"1\"\n```\n\n``` bash\n{\n  \"status\" : 200,\n  \"name\" : \"Mahkizmo\",\n  \"cluster_name\" : \"elasticsearch\",\n  \"version\" : {\n    \"number\" : \"1.7.2\",\n    \"build_hash\" : \"e43676b1385b8125d647f593f7202acbd816e8ec\",\n    \"build_timestamp\" : \"2015-09-14T09:49:53Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.10.4\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}